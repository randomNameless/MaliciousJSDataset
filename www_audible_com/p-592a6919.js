const t=((t,n=21)=>(i=n)=>{let e="",r=i;for(;r--;)e+=t[Math.random()*t.length|0];return e})("0123456789abcdef",8),n=new Map,i=new Map;function e(t){const i=n.get(t);if(i)return Object.freeze(Object.assign({},i))}function r(t,n){for(var i=0;i<n.length;i++){var e=n[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function o(t,n,i){return n&&r(t.prototype,n),i&&r(t,i),t}var u=function(){function t(t){var n=this,i=this;this._status="Initial",this.onChange=function(t,n){i.options.onChange&&i.options.onChange(t,n)},this.onConnect=function(t){try{return n.status="Connected",n.options.onChange&&n.options.onChange(t,t),Promise.resolve(new Promise((function(t){n.resolvePromise=t})))}catch(t){return Promise.reject(t)}},this.onDisconnect=function(){i.status="Connecting",i.start()},this.options=t}var n=t.prototype;return n.start=function(){var t=this,n=0;this.status="Connecting";var i=function(){return t.status},e=c(this.options.attempts)||10,r=function(){if("Connected"!==i()){var r=new CustomEvent(t.options.contextName,{bubbles:!0,cancelable:!0,composed:!0,detail:{onConnect:t.onConnect,onChange:t.onChange,onDisconnect:t.onDisconnect}});c(t.options.element).dispatchEvent(r),"Connected"!==i()?++n>=e&&(t._interval&&clearInterval(t._interval),t.status="Timeout"):"Connected"===i()&&t._interval&&clearInterval(t._interval)}};return(c(this.options.pollingMs)||100)>0&&e>1&&(this._interval=setInterval(r,c(this.options.pollingMs)||100)),r(),this},n.stop=function(){return this._interval&&clearInterval(this._interval),this.resolvePromise&&this.resolvePromise(),this.status="Initial",this},o(t,[{key:"status",set:function(t){this._status=t,this.options.onStatus&&this.options.onStatus(t)},get:function(){return this._status}}]),t}(),s=function(){function t(t){var n=this;this.__listeners=[],this.connectListener=function(t){try{t.stopPropagation(),n.__listeners=[].concat(n.__listeners,[t.detail]);var i=function(i,e){try{var r=Promise.resolve(t.detail.onConnect(n.__current)).then((function(){}))}catch(t){return e(!0,t)}return r&&r.then?r.then(e.bind(null,!1),e.bind(null,!0)):e(!1,r)}(0,(function(i,e){var r,o;if(n.__listeners=(o=(r=n.__listeners).indexOf(t.detail),r.slice(0,o).concat(r.slice(o+1,r.length))),i)throw e;return e}));return Promise.resolve(i&&i.then?i.then((function(){})):void 0)}catch(t){return Promise.reject(t)}},this.options=t,this.__current=c(t.initialState)}var n=t.prototype;return n.start=function(){return c(this.options.element).addEventListener(this.options.contextName,this.connectListener),this},n.stop=function(){return c(this.options.element).removeEventListener(this.options.contextName,this.connectListener),this.__listeners.map((function(t){t.onDisconnect()})),this.__listeners=[],this},o(t,[{key:"context",set:function(t){var n=this.__current;this.__current=t,this.__listeners.forEach((function(i){return i.onChange(t,n)}))},get:function(){return c(this.__current)}},{key:"listeners",get:function(){return Object.freeze([].concat(this.__listeners))}}]),t}();function c(t){return"function"==typeof typeof t?t():t}const h=function(){const e=Symbol(),r=function(){let n,e=0;do{if(n=t(),e+=1,e>=8)throw new Error("Unable to generate unique id for context")}while(i.has(n));return n}();return i.set(r,e),n.set(e,{id:r,defaultValue:void 0}),e}();export{s as c,e as g,u as s,h as t}