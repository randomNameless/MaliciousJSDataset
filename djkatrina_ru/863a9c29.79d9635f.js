"use strict";(self.webpackChunkvkwidgets=self.webpackChunkvkwidgets||[]).push([[4038],{538484:(t,e,s)=>{s.d(e,{browser:()=>n,browserFeatures:()=>c,mobPlatforms:()=>i,redirectToMVK:()=>d});s(126350),s(982499);var a=s(179983),o=s(161933);const r=navigator.userAgent.toLowerCase(),n={version:(r.match(/.+(?:me|ox|on|rv|it|era|opr|ie|edge)[\/: ]([\d.]+)/)||[0,"0"])[1],opera:/opera/i.test(r)||/opr/i.test(r),vivaldi:/vivaldi/i.test(r),amigo:/amigo.*mrchrome soc/i.test(r),msie:/msie/i.test(r)&&!/opera/i.test(r)||/trident\//i.test(r)||/edge/i.test(r),msie6:/msie 6/i.test(r)&&!/opera/i.test(r),msie7:/msie 7/i.test(r)&&!/opera/i.test(r),msie8:/msie 8/i.test(r)&&!/opera/i.test(r),msie9:/msie 9/i.test(r)&&!/opera/i.test(r),msie_edge:/edge/i.test(r)&&!/opera/i.test(r),mozilla:/firefox/i.test(r),yabrowser:/yabrowser/i.test(r),whale:/whale/i.test(r),chrome:/chrome/i.test(r)&&!/edge/i.test(r),safari:!/chrome/i.test(r)&&/webkit|safari|khtml/i.test(r),iphone:/iphone/i.test(r),ipod:/ipod/i.test(r),iphone4:/iphone.*OS 4/i.test(r),ipod4:/ipod.*OS 4/i.test(r),ipad:/ipad/i.test(r),ios:/.+(ipod|ipad|iphone.*os)/i.test(r),android:/android/i.test(r),bada:/bada/i.test(r),mobile:/iphone|ipod|ipad|opera mini|opera mobi|iemobile|android/i.test(r),msie_mobile:/iemobile/i.test(r),safari_mobile:/iphone|ipod|ipad/i.test(r),opera_mobile:/opera mini|opera mobi/i.test(r),opera_mini:/opera mini/i.test(r),mac:/mac/i.test(r),windows7:/windows nt 6.1/i.test(r),windowsVista:/windows nt 6.0/i.test(r),windowsXp:/windows nt (5.2|5.1)/i.test(r),search_bot:/(yandex|google|stackrambler|aport|slurp|msnbot|bingbot|twitterbot|ia_archiver|facebookexternalhit)/i.test(r),smart_tv:/smart-tv|smarttv/i.test(r)};const i={1:1,2:1,3:1,4:1,5:1,8:1},c=(window,{wheelEvent:"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":n.mozilla?"MozMousePixelScroll":"DOMMouseScroll",hasBoundingClientRect:"getBoundingClientRect"in document.createElement("div"),cmaEnabled:navigator.credentials&&navigator.credentials.preventSilentAccess&&window.vk&&vk.cma});function d(){const[t,e]=location.href.split("?"),s=new URLSearchParams(e),r={};for(let t of s)r[t[0]]=t[1];if(r){if("1"===r.m)return;if(r.force_redirect_to_mvk){delete r.force_redirect_to_mvk;const e=(0,a.toQueryString)(r);return void(window.location=t.replace(o.VK_ORIGIN_REGEX_STRICT,"https://m."+(0,o.getHostName)())+(e?"?"+e:""))}}if(o.VK_URL_REGEX.test(t)&&!new RegExp("^"+o.VK_HOST_REGEX_UNSAFE.source+"\\/@").test(t)){const e=Object.assign(r,{force_redirect_to_mvk:1}),s=t+"?"+(0,a.toQueryString)(e);window.location=s}}},179983:(t,e,s)=>{s.d(e,{fromQueryString:()=>d,toQueryString:()=>c});let a={};const o=t=>"function"==typeof t,r=t=>Array.isArray(t),n=function(t){if(a[t])return t;try{return encodeURIComponent(t)}catch(t){return""}},i=function(t){try{return decodeURIComponent(t)}catch(e){return a[t]=1,t}};function c(t,e){const s=[];for(const e in t)if(t.hasOwnProperty(e)&&null!=t[e]&&!o(t[e]))if(r(t[e]))for(let a=0,r=0,i=t[e].length;a<i;++a)null==t[e][a]||o(t[e][a])||(s.push(n(e)+"["+r+"]="+n(t[e][a])),++r);else s.push(n(e)+"="+n(t[e]));return e||s.sort(),s.join("&")}function d(t){if(!t)return{};const e={};t=t.split("&");for(let s=0;s<t.length;s++){const a=t[s].split("=");if(a[0]){const t=i(a[1]+"");if("[]"===a[0].substr(a.length-2)){const s=i(a[0].substr(0,a.length-2));e[s]||(e[s]=[]),e[s].push(t)}else e[i(a[0])]=t}}return e}},982499:(t,e,s)=>{s.d(e,{getCookie:()=>i,setCookie:()=>d});var a=s(9467),o=s(419299),r=s(932216),n=s(538484);function i(t){return function(){window._cookies={};const t=document.cookie.split(";"),e=/^[\s]*([^\s]+?)$/i;for(let s=0,a=t.length;s<a;s++){const a=t[s].split("=");2===a.length&&(_cookies[a[0].match(e)[1]]=unescape(a[1].match(e)?a[1].match(e)[1]:""))}}(),"https:"!==location.protocol&&"localhost"!==location.hostname&&(0,o.statlogsValueEvent)("read_unsecure_cookie",t,location.href),_cookies[t]}function c(t,e){const s=(0,a.getCookieGroups)(),o=function(){const t=i("remixcpl");if(!t)return[];const e=t.split(",");return e.forEach(((t,s)=>{e[s]=parseInt(t)})),e}();let n=t,c=null;if(!(0,a.partConfigEnabled)("need_check_allowed_cookie"))return!0;if(!isNaN(parseInt(e))&&parseInt(e)<0)return!0;"remix"===n.substr(0,5)&&(n=n.substr(5)),s.hasOwnProperty(t)?c=parseInt(s[t]):s.hasOwnProperty(n)?c=parseInt(s[n]):"q_"===n.substr(0,2)&&s.hasOwnProperty("q_")&&(c=parseInt(s.q_)),(null===c||isNaN(c))&&(0,r.logError)(`Undefined cookie group for cookie ${t} (${n})`);return 1===c||!(isNaN(c)||!o.includes(c))}function d(t,e,s,o,r="None",i=window.locDomain,d={}){if(!c(t,s))return!1;const l=t+"="+escape(e),h=d.withoutSubdomains?".":"",u="; path=/"+(i?"; domain="+h+i:""),g="https:"===location.protocol;let S=!!o;(0,a.partConfigEnabled)("cookie_secure_default_true")&&(S=!1!==o);const m=g&&S?"; secure":"",p=S&&n.browser.chrome&&parseInt(n.browser.version)>=71&&(0,a.partConfigEnabled)("cookie_class_samesite")?`; SameSite=${r}`:"";let w="";if(s){const t=new Date;t.setTime(t.getTime()+24*s*60*60*1e3),w="; expires="+t.toGMTString()}return document.cookie=l+w+u+p+m,!0}},126350:(t,e,s)=>{function a(t=window.browser){return!(!t.mac||t.iphone||t.ipad||t.ipod||!(navigator.maxTouchPoints>1))}s.d(e,{isIPadOS:()=>a})},419299:(t,e,s)=>{s.d(e,{statlogsValueEvent:()=>p});var a=s(982499),o=s(161933),r=s(126607),n=s(644825),i=s(9467),c=s(853559),d=s(11271);let l,h,u,g;(0,o.isMvk)()?(l="lock_m_stats_cookie_lock",h="remixmstsl",u="lock_m_stats_cookie_locked_stats",g="remixmsts"):(l="lockkk_stats_cookie_lock",g="remixsts",h="remixstsl",u="lock_stats_cookie_locked_stats");const S=[],m={get stats(){return(r.ls.checkVersion()?JSON.parse(r.ls.get(u)):this._stats)||[]},push(t){const e=this.stats;e.push(...t),r.ls.checkVersion()?r.ls.set(u,JSON.stringify(e)):this._stats=e},clear(){r.ls.checkVersion()?r.ls.remove(u):delete this._stats}};function p(t,e,...s){if(void 0===t||void 0===e)return;if(S.forEach((a=>a(t,e,...s))),(0,i.partConfigEnabled)("local_storage_statlogs_value_event")&&![c.ADBLOCK_CONFIG_KEY,d.WASM_SUPPORT_CONFIG_KEY].includes(t))return void(0,n.saveStatlogEvents)({name:t,value:e,keys:s});const o=[Math.round(Date.now()/1e3),t,e].concat(s);_((()=>{if((0,i.partConfigEnabled)("mvk_stats_cookie_soft_clean_up")){if("1"===(0,a.getCookie)(h))return void m.push([o]);(0,a.setCookie)(h,"1")}w(o)}))}function w(t){let e;try{e=JSON.parse((0,a.getCookie)(g)),e=e.data}catch(t){e=[]}if(e=[...e,...m.stats],t&&e.push(t),0===e.length)return;const s=1000000001*Math.random();let o=e.slice(-100);const r=(0,i.getConfigValue)("statlogs_cookie_size_limit")??3500;let n=0,c=0;for(;n<r&&c<e.length;){const t=e[c],s=(d=JSON.stringify(t),encodeURIComponent(d).length);if(s>=r)e.splice(c,1);else{if(n+s>=r)break;n+=s,c++}}var d;o=e.slice(0,c);const l=e.slice(c);m.clear(),l.length>0&&m.push(l),m.clear(),o.length>0&&((0,i.partConfigEnabled)("statlog_host_domain")?((0,i.partConfigEnabled)("statlogs_clear_all_domains_cookie_MVKC-7414")&&(0,a.setCookie)(g,"",-1),(0,a.setCookie)(g,JSON.stringify({data:o,uniqueId:s}),.01,void 0,void 0,window.location.host,{withoutSubdomains:!0})):((0,i.partConfigEnabled)("statlogs_clear_all_domains_cookie_MVKC-7414")&&(0,a.setCookie)(g,"",-1,void 0,void 0,window.location.host,{withoutSubdomains:!0}),(0,a.setCookie)(g,JSON.stringify({data:o,uniqueId:s}),.01)))}function _(t,e){if(r.ls.checkVersion()){if(!0!==r.ls.get(l)){r.ls.set(l,!0);try{t()}catch(t){}return void r.ls.set(l,!1)}e||setTimeout((()=>_(t,!0)),100)}else t()}(0,i.partConfigEnabled)("mvk_stats_cookie_soft_clean_up")&&(window.addEventListener("beforeunload",(()=>{w(null)})),window.ajax&&window.ajax.onResponse((()=>{w(null)})))},9467:(t,e,s)=>{s.d(e,{calculateTimeOffsets:()=>i,getConfigValue:()=>r,getCookieGroups:()=>n,partConfigEnabled:()=>o});var a=s(982499);function o(t){const{pe:e={}}=window.vk||{};return!!e[t]}function r(t){const{cfg:e={}}=window.vk||{};return e[t]}function n(){const{acl:t={}}=window.vk||{};return t}function i(){const t=window.vk.ts;if(t&&!window.browser.opera_mobile){const e=new Date;let s=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())/1e3-t;s-=10800,s/=60,s=s.toFixed(0),s*=60,s<-55800?s+=86400:s>37800&&(s-=86400);let o=0,r=Math.abs(s);[-12,-11,-10,-9.5,-9,-8,-7,-6,-5,-4.5,-4,-3.5,-3,-2,-1,0,1,2,3,3.5,4,4.5,5,5.5,5.75,6,6.5,7,8,8.75,9,9.5,10,10.5,11,12,12.75,13,14].forEach((t=>{const e=Math.round(3600*(t-3)),a=Math.abs(s-e);a<r&&(r=a,o=e)}));const n=(0,a.getCookie)("remixdt");return void 0!==n&&function(t){if(!0===t)return 1;return parseInt(t)||0}(n)===o||(0,a.setCookie)("remixdt",o,365),o}return 0}},722007:(t,e,s)=>{s.d(e,{api:()=>a,login:()=>o,removeLoginCache:()=>r});const a=(t,e,s,a={})=>window.vkApi?window.vkApi.api(t,e,s,a):Promise.reject(new Error("[VKJS][API]: api didn't allowed. Use makeAuthAndApiGlobal function")),o=(t,e,s,a)=>window.vkApi?window.vkApi.login(t,e,s,a):Promise.reject(new Error("[VKJS]: login didn't allowed. Use makeAuthAndApiGlobal function")),r=(t,e)=>window.vkApi?window.vkApi.removeLoginCache(t,e):console.error("[VKJS]: removeLoginCache didn't allowed. Use makeAuthAndApiGlobal function")},724084:(t,e,s)=>{s.d(e,{getBrowserFingerprint:()=>o});var a=s(982499);function o(){return(0,a.getCookie)("remixgp")}},932216:(t,e,s)=>{s.d(e,{logError:()=>r,logEvalError:()=>i,logUnknownError:()=>n});var a=s(9467),o=s(441878);function r(t,e={}){(0,o.logError)(t,e),(0,a.partConfigEnabled)("webinf_show_error_logs")&&window?.console.error(t)}function n(t){if(t instanceof Error)return void r(t);let e="unknown error";if("string"==typeof t&&(e=t),"object"==typeof t&&null!==t&&"message"in t){const{message:s}=t;"string"==typeof s&&(e=s)}r(new Error(e))}function i(t,e){(0,a.partConfigEnabled)("web_inline_grouping_fix")||(e&&e.length>2e3&&(e=`${e.slice(0,1e3)}...${e.slice(-1e3)}`),t.message+=`: ${e}`),r(t)}},126607:(t,e,s)=>{s.d(e,{ls:()=>c});var a=s(843165);function o(){try{return void 0!==window.localStorage&&null!==window.localStorage&&void 0!==window.JSON}catch(t){return!1}}function r(t,e){if(void 0===t)return!1;i(t);try{return a.vkLocalStorage.setItem(t,JSON.stringify(e))}catch(t){return!1}}function n(t){if(void 0===t)return!1;try{return JSON.parse(a.vkLocalStorage.getItem(t))}catch(t){return!1}}function i(t){try{a.vkLocalStorage.removeItem(t)}catch(t){}}const c={checkVersion:o,remove:i,get:n,set:r},d=t=>void 0!==t?`${t}_@id:${window.vk.id}`:void 0,l=t=>(...e)=>{const[s,...a]=e,o=[d(s),...a];return t(...o)},h={checkVersion:o,remove:l(i),get:t=>{const e=l(n)(t);if(null===e){const e=n(t);if(null!==e)return h.set(t,e),i(t),e}return e},set:l(r)}},161933:(t,e,s)=>{s.d(e,{DOMAIN:()=>a,VK_DOMAIN_REGEX:()=>u,VK_HOST_REGEX_GROUP_UNSAFE:()=>l,VK_HOST_REGEX_UNSAFE:()=>d,VK_ORIGIN_PREFIX_REGEX:()=>S,VK_ORIGIN_REGEX_STRICT:()=>g,VK_POSSIBLE_SITE_HOSTS:()=>r,VK_SITES_REGEX_SOURCE_UNSAFE:()=>c,VK_SITE_REGEX_SOURCE_UNSAFE:()=>i,VK_URL_REGEX:()=>m,VK_URL_REGEX_STRICT:()=>p,getGlobalObject:()=>E,getHostName:()=>k,isMvk:()=>w,isMvkVKVideo:()=>v,isPWA:()=>b,isVkMe:()=>_,isVkVideo:()=>f});const a="vk.com",o=t=>t.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1"),r=["vk.com","vk.ru","vkvideo.ru",k()].filter(((t,e,s)=>s.indexOf(t)===e)),n=r.concat(["vkontakte.ru","vk.me","userapi.com"]),i=o(k()),c=r.map(o).join("|"),d=new RegExp("("+n.map(o).join("|")+")"),l=new RegExp(n.map(o).join("|")),h=(new RegExp("^"+d.source+"$"),new RegExp(`([a-zA-Z0-9\\.\\_\\-]+\\.)?${d.source}`)),u=new RegExp("^"+h.source+"$"),g=(new RegExp(`^(https?:\\/\\/)?${h.source}$`),new RegExp(`^(https?:\\/\\/)${h.source}$`)),S=new RegExp(`^(https?:\\/\\/)${h.source}`),m=new RegExp(`^(https?:\\/\\/)?${h.source}($|\\/(.*))`),p=new RegExp(`^(https?:\\/\\/)${h.source}($|\\/(.*))`);function w(){return!!window.isMVK}function _(){return!!window.vkmeConfig?.anonymBroadcastInitArgs}const f=()=>{const t=E();return Boolean(t.vk?.isVideoStandalone||t.cur?.isVideoStandalone)},v=()=>w()&&f();function b(){return window.vk?.platform?.startsWith?.("pwa")}function k(){return E().vk?.__domain||"vk.com"}function E(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}}},843165:(t,e,s)=>{s.d(e,{bestAvailableStorage:()=>p,getSessionStorage:()=>u,isStorageAvailable:()=>i,vkLocalStorage:()=>l,vkSessionStorage:()=>g});class a{setItem(t,e){this.data[t]=String(e)}removeItem(t){delete this.data[t]}clear(){this.data={}}get length(){return Object.keys(this.data).length}key(t){return Object.keys(this.data)[t]}constructor(){this.data={},this.getItem=t=>this.data.hasOwnProperty(t)?this.data[t]:null,this.keys=()=>Object.keys(this.data)}}const o="vk-ls-dummy",r=Math.random().toString(),n={localStorage:null,sessionStorage:null};function i(t){if(null===n[t])try{const e=window[t];e.setItem(o,r),n[t]=r===e.getItem(o),e.removeItem(o)}catch(e){n[t]=!1}return n[t]}let c;function d(){return c||(c=i("localStorage")?window.localStorage:new a,c)}const l={setItem:(t,e)=>d().setItem(t,e),getItem:t=>d().getItem(t),removeItem:t=>d().removeItem(t),clear:()=>d().clear(),length:()=>d().length,key:t=>d().key(t),keys(){const t=d();return t instanceof a?t.keys():Object.keys(t)},getPrefixedKeys:t=>l.keys().filter((e=>e.startsWith(t)))};let h;function u(){return h||(h=i("sessionStorage")?window.sessionStorage:new a,h)}const g={setItem:(t,e)=>u().setItem(t,e),getItem:t=>u().getItem(t),removeItem:t=>u().removeItem(t),clear:()=>u().clear(),length:()=>u().length,key:t=>u().key(t),keys(){const t=u();return t instanceof a?t.keys():Object.keys(t)},getPrefixedKeys:t=>g.keys().filter((e=>e.startsWith(t)))};let S;function m(){return S||(S=i("localStorage")?window.localStorage:i("sessionStorage")?window.sessionStorage:new a,S)}const p={setItem:(t,e)=>m().setItem(t,e),getItem:t=>m().getItem(t),removeItem:t=>m().removeItem(t),clear:()=>m().clear(),length:()=>m().length,key:t=>m().key(t),keys(){const t=m();return t instanceof a?t.keys():Object.keys(t)},getPrefixedKeys:t=>p.keys().filter((e=>e.startsWith(t)))}},644825:(t,e,s)=>{s.d(e,{saveBenchmarkMainStats:()=>A,saveCustomStats:()=>v,saveNetworkStats:()=>f,saveProductionStats:()=>b,saveStatlogEvents:()=>_,saveStoryViewStats:()=>E,saveWebPerfStats:()=>y,writeAndSendWebStats:()=>k});var a=s(860656),o=s(769685),r=s(142705),n=s(161933),i=s(9467),c=s(724084),d=s(419299);const l=()=>({get st(){return window.vk.statsMeta.st},get platform(){return window.vk?.statsMeta?.platform?window.vk?.statsMeta?.platform:(0,n.isMvk)()?"mvk":"web2"},get time(){return window.vk.statsMeta.time},get hash(){return window.vk.statsMeta.hash},get wsTransport(){return window.vk.wsTransport},get userId(){return window.vk.id},get started(){return window.vk.started},get itemId(){return window.cur?.item_id},get itemOwnerId(){return window.cur?.item_owner_id},get itemType(){return window.cur?.item_type}}),h=()=>({get isDebuggerMode(){return(0,i.partConfigEnabled)("web_stats_transport_debugger")}});function u(t,e){return`${t.wsTransport}/web-stats/${t.st?"s":"p"}${e&&`?${e}`}`}function g(){const t=(0,i.getConfigValue)("akashi_endpoint");return String(t)}const S=(0,a.makeSharedState)("webStats",(()=>{const t={hostName:(0,n.getHostName)(),options:h(),statlogsValueEvent:d.statlogsValueEvent,getBrowserFingerprint:c.getBrowserFingerprint,statsMeta:l(),smallerChunks:!1,createUrl:u};return new o.WebStats(t)}),{version:1}),m=(0,a.makeSharedState)("akashi",(()=>{const t={hostName:(0,n.getHostName)(),options:h(),localStorage:new r.CustomStorage,sessionStorage:new r.CustomStorage,getBrowserFingerprint:c.getBrowserFingerprint,statsMeta:l(),smallerChunks:!1,createUrl:g};return new o.WebStats(t)}),{version:1}),p=S(),w=m(),_=p.saveStatlogEvents.bind(p),f=p.saveNetworkStats.bind(p),v=p.saveCustomStats.bind(p),b=p.saveProductionStats.bind(p),k=p.writeAndSendWebStats.bind(p),E=(p.saveStoryViewBaseStats.bind(p),p.saveStoryViewStats.bind(p)),y=p.saveWebPerfStats.bind(p),A=p.saveBenchmarkMainStats.bind(p);(0,i.partConfigEnabled)("switch_to_akashi")?w.saveVkResStats.bind(w):p.saveVkResStats.bind(p)},853559:(t,e,s)=>{s.d(e,{ADBLOCK_CONFIG_KEY:()=>a});const a="unique_adblock_users"},11271:(t,e,s)=>{s.d(e,{WASM_SUPPORT_CONFIG_KEY:()=>a});const a="users_wasm_support"},448205:(t,e,s)=>{s.d(e,{API_ERROR_APP_AUTH:()=>i,API_ERROR_AUTH:()=>a,API_ERROR_AUTH_ANONYMOUS_TOKEN_HAS_EXPIRED:()=>d,API_ERROR_CAPTCHA:()=>n,API_ERROR_CUA_2_CONFIRMATION_REQUIRED:()=>l,API_ERROR_FLOOD:()=>r,API_ERROR_RATE_LIMIT:()=>c,API_ERROR_TOO_MANY:()=>o});const a=5,o=6,r=9,n=14,i=28,c=29,d=1114,l=11500},815204:(t,e,s)=>{s.d(e,{PendingTask:()=>a});class a{constructor(){this.get=()=>this.promise,this.resolve=t=>this.resolveHandler(t),this.reject=t=>this.rejectHandler(t),this.promise=new Promise(((t,e)=>{this.resolveHandler=t,this.rejectHandler=e}))}}},946114:(t,e,s)=>{s.d(e,{RequestTask:()=>o});var a=s(960632);class o{setAccessToken(t){this.bodyParams.access_token=t}setGrouping(t){this.grouping=t}setParams(t){this.methodParams=t}canGroupInExecute(){return!this.method.includes("execute")&&(!!this.apiConfig.accessToken&&(!this.methodParams.v&&(!1!==this.grouping&&(void 0===this.fetchOptions.method&&(void 0===this.fetchOptions.headers&&void 0===this.fetchOptions.signal)))))}toString(){const t={};return"object"==typeof this.methodParams&&Object.keys(this.methodParams).forEach((e=>{const s=this.methodParams[e];null!=s&&(t[e]="object"==typeof s?String(s):s)})),`API.${this.method}(${JSON.stringify(t)})`}constructor(t,e,s={},o={},r={}){this.resolve=()=>{},this.reject=()=>{},this.method=t,this.methodParams=e,this.fetchOptions=r,this.overrideApiConfig=o,this.apiConfig=Object.assign({},s,o),this.grouping=this.apiConfig.grouping,this.queryParams=(0,a.getApiQueryParams)(this.apiConfig),this.apiConfig.captureAsyncStacktrace&&(this.asyncBaseError=new Error("Async error"));const n=(0,a.getApiBodyParams)(this.apiConfig);this.bodyParams=Object.assign({},e,n),this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}},49768:(t,e,s)=>{s.d(e,{Retries:()=>o});class a{constructor(t=1/0){this.tries=0,this.increment=()=>{this.tries++},this.get=()=>this.tries,this.isExceeded=()=>this.tries>=this.maxTries,this.maxTries=t}}class o{constructor(){this.retries=new Map,this.get=t=>this.retries.get(t),this.create=(t,e)=>(this.retries.set(t,new a(e)),this.retries.get(t)),this.delete=t=>{this.retries.delete(t)}}}},664224:(t,e,s)=>{s.d(e,{API_VERSION:()=>a});const a="5.131"},995537:(t,e,s)=>{s.d(e,{api:()=>v,apiBeacon:()=>y,setApiConfig:()=>f});var a=s(448205),o=s(815204),r=s(946114),n=s(49768),i=s(424618),c=s(549491),d=s(127814),l=s(386404),h=s(960632);let u={domain:"api.vk.com",maxRetries:10,grouping:!0};const g=new n.Retries,S=new n.Retries;let m=null,p=null,w=null;const _=[];function f(t){t=Object.assign({},u,t),u=t}function v(t,e,s={},a={}){const o=new r.RequestTask(t,e,u,s,a);return o.canGroupInExecute()?(_.push(o),w&&window.clearTimeout(w),w=window.setTimeout((()=>{b(_,s,a,o.apiConfig.enableForks)}),0)):(o.setGrouping(!1),E(o)),o.promise}async function b(t,e,s={},a){if(1===t.length){const e=t.shift();E(e),e.setGrouping(!1)}else{const o=[],n=[],i=[];for(let e=0;e<t.length;e+=1){if(!t[e].canGroupInExecute())continue;const s=t.splice(e,1)[0];if(e-=1,o.push(s),a&&0!==t.length&&(n.push(`'${s.method}': fork(${s})`),i.push(`wait(forks['${s.method}'])`)),o.length>=25)break}let c=`return [${o.join(",")}];`;if(a){const t=o[o.length-1];c=`\n        var forks = { ${n.join(",")} };\n\n        return [${i.join(",")},${t}];\n      `}const d=new r.RequestTask("execute",{code:c},u,e,s);d.setGrouping(!0),E(d);try{const t=await d.promise;let e=0;t.response.forEach(((s,a)=>{!1===s?((0,h.rejectWithApiError)(o[a],{type:l.APIErrorType.API_ERROR,error:t.execute_errors[e]}),e+=1):o[a].resolve(s)}))}catch(t){o.forEach((e=>(0,h.rejectWithApiError)(e,t)))}}t.length>0&&window.setTimeout((()=>b(t,e,s,a)),1e3)}function k(t){try{return window.localStorage?.getItem(t)}catch(t){return null}}async function E(t){const e=t.methodParams.captcha_sid,s=t.methodParams.session;(m&&m.sid!==e||p&&p.session!==s)&&(0,h.rejectWithApiError)(t,{type:l.APIErrorType.API_ERROR,error:{error_code:0,error_msg:"Ddos limit exceeded",error_text:"Ddos limit exceeded"}});const{domain:r,formattedExecuteResponse:n}=t.apiConfig,u=(0,i.makeParams)(t.queryParams),w=`https://${r}/method/${t.method}?${u}`,_=Object.assign({[c.CUA_STATE_PARAM]:(k(c.STORAGE_CUA_STATE)||"").trim()||void 0,[c.CUA_SESSION_PARAM]:s||void 0},t.methodParams,t.bodyParams),v=(0,h.getRequestHash)(w,t.methodParams),b=S.get(v)||S.create(v,t.apiConfig.maxRetries),y=g.get(v)||g.create(v,t.apiConfig.maxRetries);try{await(0,d.waitTimeExp)(b.get()||y.get());const r=await(0,i.corsRequest)(w,_,t.fetchOptions),c=await r.json();if(void 0!==c.response)return S.delete(v),g.delete(v),m&&m.sid===e&&(m.task?.resolve(void 0),m=null,t.apiConfig.onCaptchaSuccess?.()),p&&p.session===s&&(p.task?.resolve(void 0),p=null,t.apiConfig.onCuaSuccess?.()),c.execute_errors?void(n||t.grouping?t.resolve({response:c.response||[],execute_errors:c.execute_errors}):t.resolve({...c.response,execute_errors:c.execute_errors})):void(t.grouping?t.resolve({response:c.response}):t.resolve(c.response));const u=c.error;if(!u)return void(0,h.rejectWithApiError)(t,{type:l.APIErrorType.API_ERROR,error:{error_code:0,error_msg:"Unknown",error_text:"Unknown"}});if(t.apiConfig.onCaptcha&&u?.error_code===a.API_ERROR_CAPTCHA)return void async function(t,e,s){if(!e.apiConfig.onCaptcha)return;const{captcha_sid:a,captcha_img:r,captcha_height:n,captcha_width:i,captcha_attempt:c,captcha_ts:d,is_refresh_enabled:h,is_sound_captcha_available:u,captcha_track:g,is_enabled_vkui:S,uiux_changes:p,redirect_uri:w}=t;if(m){if(m.sid!==s)return await m.task.get(),void await E(e);{const t=new o.PendingTask;t.get().then(m.task.resolve).catch(m.task.reject),m={sid:a,task:t}}}else m={sid:a,task:new o.PendingTask};try{const t=await e.apiConfig.onCaptcha({captcha_sid:a,captcha_img:r,captcha_height:n,captcha_width:i,is_refresh_enabled:h,is_sound_captcha_available:u,captcha_track:g,is_enabled_vkui:S,uiux_changes:p,redirect_uri:w}),s={captcha_ts:d,captcha_attempt:c},o=Object.assign({},e.methodParams,t,s);e.setParams(o),E(e)}catch(t){m=null,e.reject({type:l.APIErrorType.API_ERROR,error:t})}}(u,t,e);if(m&&m.sid===e&&(m.task?.resolve(void 0),m=null,t.apiConfig.onCaptchaSuccess?.()),t.apiConfig.onCua&&u?.error_code===a.API_ERROR_CUA_2_CONFIRMATION_REQUIRED)return void async function(t,e){if(!e.apiConfig.onCua)return;const{cua_session:s}=t;if(p){if(p.session!==s)return await p.task.get(),void await E(e);{const t=new o.PendingTask;t.get().then(p.task.resolve).catch(p.task.reject),p={session:s,task:t}}}else p={session:s,task:new o.PendingTask};try{const t=await e.apiConfig.onCua({cua_session:s}),a=Object.assign({},e.methodParams,t);e.setParams(a),E(e)}catch(t){p=null,e.reject({type:l.APIErrorType.API_ERROR,error:t})}}(u,t);if(p&&p.session===e&&(p.task?.resolve(void 0),p=null,t.apiConfig.onCuaSuccess?.()),0===t.apiConfig.maxRetries)return void(0,h.rejectWithApiError)(t,{type:l.APIErrorType.API_ERROR,error:u});if(b.isExceeded()||y.isExceeded())return S.delete(v),g.delete(v),void(0,h.rejectWithApiError)(t,{type:l.APIErrorType.API_ERROR,error:{error_code:0,error_msg:"Maximum of api retries exceeded",error_text:u.error_text}});if((0,h.isNotAllowedToMakeMoreRequests)(u.error_code))return y.increment(),S.delete(v),void E(t);g.delete(v);const k=!t.overrideApiConfig?.accessToken&&(u.error_code===a.API_ERROR_AUTH||u.error_code===a.API_ERROR_APP_AUTH||u.error_code===a.API_ERROR_AUTH_ANONYMOUS_TOKEN_HAS_EXPIRED);if(t.apiConfig.onTokenExpired&&k){const e=await t.apiConfig.onTokenExpired();return b.increment(),f({accessToken:e}),t.setAccessToken(e),void E(t)}S.delete(v),(0,h.rejectWithApiError)(t,{type:l.APIErrorType.API_ERROR,error:c.error})}catch(s){m&&m.sid===e&&(m=null,t.apiConfig.onCaptchaSuccess?.()),t.reject({type:l.APIErrorType.NETWORK_ERROR,error:s})}}function y(t,e,s){const a=new r.RequestTask(t,e,u,s),{domain:o}=a.apiConfig,n=(0,i.makeParams)(a.queryParams),c=`https://${o}/method/${a.method}?${n}`,d=Object.assign({},a.methodParams,a.bodyParams);return navigator.sendBeacon(c,(0,i.toFormData)(d))}},386404:(t,e,s)=>{var a,o;s.d(e,{APIErrorType:()=>o}),function(t){t.INPUT="input",t.ALERT="alert",t.FULLSCREEN="fullscreen"}(a||(a={})),function(t){t.API_ERROR="api_error",t.NETWORK_ERROR="network_error"}(o||(o={}))},960632:(t,e,s)=>{s.d(e,{getApiBodyParams:()=>i,getApiQueryParams:()=>n,getRequestHash:()=>c,isNotAllowedToMakeMoreRequests:()=>d,rejectWithApiError:()=>l});var a=s(448205),o=s(424618),r=s(664224);const n=t=>{const e={v:t.version||r.API_VERSION};return t.appId&&(e.client_id=t.appId),e},i=t=>({access_token:t.accessToken}),c=(t,e={})=>`${t}-${(0,o.makeParams)(Object.assign({},e))}`,d=t=>t===a.API_ERROR_RATE_LIMIT||t===a.API_ERROR_FLOOD||t===a.API_ERROR_TOO_MANY,l=(t,e)=>{if(!t.apiConfig.throwFullErrors)return void t.reject(e);const s=new Error("Api request failed",t.asyncBaseError?{cause:t.asyncBaseError}:void 0);Object.entries(e).forEach((([t,e])=>{s[t]=e})),t.reject(s)}},549491:(t,e,s)=>{s.d(e,{CUA_SESSION_PARAM:()=>r,CUA_STATE_PARAM:()=>o,STORAGE_CUA_STATE:()=>a});const a="cua_state",o="cua_state",r="cua_session"},424618:(t,e,s)=>{s.d(e,{corsRequest:()=>i,makeParams:()=>r,toFormData:()=>n});var a=s(549491);const o=[a.CUA_STATE_PARAM,a.CUA_SESSION_PARAM];function r(t){return Object.keys(t).map((e=>{let s=t[e];return e=encodeURIComponent(e||""),s=encodeURIComponent(void 0===s?"":s),o.includes(e)&&!s?null:`${e}=${s}`})).filter(Boolean).join("&")}function n(t){const e=new FormData;for(const s in t)t.hasOwnProperty(s)&&("string"==typeof t[s]?e.append(s,t[s]):e.append(s,JSON.stringify(t[s])));return e}function i(t,e,s={}){const a=r(e);return fetch(t,{method:"POST",body:a,mode:"cors",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},...s})}},127814:(t,e,s)=>{s.d(e,{ONE_MINUTE_MS:()=>a,getRandomWaitTime:()=>o,waitTimeExp:()=>r});const a=6e4,o=(t=500,e=1500)=>window.FORCED_API_WAIT_TIME?window.FORCED_API_WAIT_TIME:~~(Math.random()*(e-t+1)+t),r=t=>{return 0===t?Promise.resolve():(e=(t=>{if(0===t)return 0;if(window.FORCED_API_WAIT_TIME)return window.FORCED_API_WAIT_TIME;const e=Math.random(),s=100*Math.pow(2,t)/2;return s+s*e})(t),new Promise((t=>{setTimeout((()=>t()),e)})));var e}},441878:(t,e,s)=>{s.d(e,{logError:()=>o});var a=s(981693);function o(t,{breadcrumb:e,environment:s,hasDummyStacktrace:o}={}){const r=(0,a.getGlobalObject)().__SENTRY__?.hub;if(r)return o&&t.stack&&delete t.stack,r.captureException(t,{captureContext:t=>(s&&t.setTags({module:s}),e&&t.addBreadcrumb({message:e.message,category:"custom",data:e.data}),t)})}},981693:(t,e,s)=>{function a(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}}s.d(e,{getGlobalObject:()=>a})},860656:(t,e,s)=>{s.d(e,{makeSharedState:()=>i});const a="__SHARED_STATE_KEY";(()=>{const t=self.hasOwnProperty(a)?self[a]:Object.create(null);Object.defineProperty(self,a,{configurable:!0,value:t})})();const o=()=>self[a],r=t=>o()[t],n=(t,e)=>{o()[t]=e};function i(t,e,s){const a=function(t,e){let s=t.replace(/[^a-zA-Z0-9-]/gi,"_").toLowerCase();0!==e&&(s+=`__${e}`);return s}(t,s.version);return a in o()||n(a,e()),()=>r(a)}},769685:(t,e,s)=>{s.d(e,{WebStats:()=>d});var a=s(402815),o=s(972611),r=s(407674),n=s(966358),i=s(879639),c=s(310808);class d{sendWebStats(t,e){return this.api.sendWebStats(t,e)}writeAndSendWebStats(t,e,s,a){return this.api.writeAndSendWebStats(t,e,s,a)}saveStatlogEvents(t){return this.api.saveStatlogEvents(t)}saveProductionStats(t,e){return this.api.saveProductionStats(t,e)}saveNetworkStats(t){return this.api.saveNetworkStats(t)}saveStoryViewBaseStats(t){return this.api.saveStoryViewBaseStats(t)}saveStoryViewStats(t){return this.api.saveStoryViewStats(t)}saveWebPerfStats(t){return this.api.saveWebPerfStats(t)}saveBenchmarkMainStats(t){return this.api.saveBenchmarkMainStats(t)}saveVkResStats(t){return this.api.saveVkResStats(t)}constructor({options:t,statsMeta:e,hostName:s,statlogsValueEvent:d,getBrowserFingerprint:l,sessionStorage:h,localStorage:u,smallerChunks:g,apiParams:S,createUrl:m}){this.saveCustomStats=t=>this.api.saveCustomStats(t),this.debug=new o.Debug({options:t}),this.webStatsStorage=new r.WebStatsStorage({statsMeta:e,debug:this.debug,sessionStorage:h,localStorage:u}),this.maxBodyChunkSize=g?a.MAX_BODY_SIZE_SMALL_CHUNK:a.MAX_BODY_SIZE_NORMAL_CHUNK,this.batchers=new n.Batchers({statsMeta:e,statlogsValueEvent:d,webStatsStorage:this.webStatsStorage,maxBodyChunkSize:this.maxBodyChunkSize}),this.batchedWebStatsTransport=new i.BatchedWebStatsTransport({statsMeta:e,hostName:s,debug:this.debug,statlogsValueEvent:d,getBrowserFingerprint:l,batchers:this.batchers,webStatsStorage:this.webStatsStorage,maxBodyChunkSize:this.maxBodyChunkSize,apiParams:S,createUrl:m}),this.api=new c.Api({webStatsStorage:this.webStatsStorage,debug:this.debug,webStatsBatchedTransport:this.batchedWebStatsTransport,options:t,localStorage:u})}}},402815:(t,e,s)=>{s.d(e,{AVAILABLE_STATS:()=>S,BOOST_COOLDOWN_MS:()=>c,BOOST_DEBOUNCE_LIMIT_MS:()=>i,BOOST_DEBOUNCE_MS:()=>n,BOOST_DURATION:()=>l,COOLDOWN_MS:()=>r,DEBOUNCE_LIMIT_MS:()=>o,DEBOUNCE_MS:()=>a,MAX_BODY_SIZE_NORMAL_CHUNK:()=>u,MAX_BODY_SIZE_SMALL_CHUNK:()=>h,PROCESSING_LIMIT:()=>d,Stats:()=>g});const a=1e4,o=2e4,r=2e4,n=1e3,i=2e3,c=5e3,d=500,l=3e4,h=.5*Math.pow(10,6),u=1.8*Math.pow(10,6);var g;!function(t){t.BenchmarkMainStats="benchmarkMainStats",t.CustomStats="customStats",t.NetworkStats="networkStats",t.ProductionStats="productionStats",t.StatlogEvents="statlogEvents",t.StoryViewStats="storyViewStats",t.WebPerfStats="webPerfStats",t.VkResStats="vkResStats"}(g||(g={}));const S=["benchmarkMainStats","customStats","networkStats","productionStats","statlogEvents","storyViewStats","webPerfStats","vkResStats"]},310808:(t,e,s)=>{s.d(e,{Api:()=>n});var a=s(142705),o=s(668813),r=s(402815);class n{pushToWebStats(t,e){const s=this.webStatsStorage.getWebStatsStringValue(t);return this.webStatsStorage.getWebStatDataLs().replace(`"${t}":${s}`,`"${t}":${s.replace(/]$/,`${"[]"===s?"":","}${JSON.stringify(e)}]`)}`)}transformStatlogEvent({name:t,value:e,keys:s=[]}){const a=[Math.round(Number(Date.now())/1e3),t,e,...s];return this.options?.isDebuggerMode&&console.log("Data was transformed!"),a}sendWebStats(t,e){t===r.Stats.StatlogEvents&&(e=this.transformStatlogEvent(e));const s=(0,o.getEmptyStatsData)();s[t]=[e];const a=JSON.stringify(s);return new Promise(((t,s)=>{this.webStatsBatchedTransport.sendStat(a,(()=>t()),s),this.debug.logWebStatsEvent("sendWebStatsEvent",e)}))}writeAndSendWebStats(t,e,s,a){const o=this.pushToWebStats(e,s);this.webStatsStorage.writeLocked((()=>{this.localStorage.setItem(this.webStatsStorage.lsDataKey,o),this.webStatsBatchedTransport.saveAndSendStats(o,a)})),this.debug.logWebStatsEvent(t,s)}saveStatlogEvents(t){const e=this.transformStatlogEvent(t);return this.writeAndSendWebStats("saveStatlogEvents",r.Stats.StatlogEvents,e)}saveNetworkStats(t){return this.writeAndSendWebStats("saveNetworkStats",r.Stats.NetworkStats,t)}saveStoryViewBaseStats(t){return this.writeAndSendWebStats("saveStoryViewStats",r.Stats.StoryViewStats,t)}saveStoryViewStats(t){return this.saveStoryViewBaseStats(t)}saveWebPerfStats(t){return this.writeAndSendWebStats("saveWebPerfStats",r.Stats.WebPerfStats,t)}saveBenchmarkMainStats(t){return this.writeAndSendWebStats("saveBenchmarkMainStats",r.Stats.BenchmarkMainStats,t)}saveVkResStats(t){return this.writeAndSendWebStats("saveVkResStats",r.Stats.VkResStats,[...t.details])}constructor({webStatsStorage:t,debug:e,options:s,localStorage:o,webStatsBatchedTransport:n}){this.saveProductionStats=(t,e)=>this.writeAndSendWebStats("saveProductionStats",r.Stats.ProductionStats,t,e),this.saveCustomStats=t=>this.writeAndSendWebStats("saveCustomStats",r.Stats.CustomStats,t),this.webStatsStorage=t,this.debug=e,this.options=s,this.localStorage=o||a.localStorage,this.webStatsBatchedTransport=n}}},879639:(t,e,s)=>{s.d(e,{BatchedWebStatsTransport:()=>n});var a=s(722007),o=s(668813),r=s(402815);class n{isBatchBoostRequired(){const t=this.statsMeta.started||Date.now();return Date.now()-t<=r.BOOST_DURATION}debounceMs(){return this.isBatchBoostRequired()?r.BOOST_DEBOUNCE_MS:r.DEBOUNCE_MS}limitMs(){return this.isBatchBoostRequired()?r.BOOST_DEBOUNCE_LIMIT_MS:r.DEBOUNCE_LIMIT_MS}cooldownMs(){return this.isBatchBoostRequired()?r.BOOST_COOLDOWN_MS:r.COOLDOWN_MS}penaltyMs(){return this.debounceMs()*this.sendAttempt**.5}onCooldown(){return!(Date.now()-this.webStatsStorage.getLastSendTime()>this.cooldownMs()+this.penaltyMs())}tillCooldownMs(){return Math.max(0,this.webStatsStorage.getLastSendTime()+this.cooldownMs()-Date.now()+this.penaltyMs())}tillLimitMs(){return Math.max(0,this.webStatsStorage.getLastSendTime()+this.limitMs()-Date.now())}checkWebStatsLater(){this.isSendingWebStats||this.timeoutID||(this.timeoutID=(0,o.getWindow)()?.setTimeout((()=>{const t=this.webStatsStorage.getWebStatDataLs();this.timeoutID=void 0,t.length>o.emptyStatsDataLs.length&&this.saveAndSendStats(t)}),Math.max(Math.min(this.tillLimitMs(),this.debounceMs()),this.tillCooldownMs())))}sendStatsWithBatching(t){const e=t.length>this.maxBodyChunkSize;let s=e?this.batchers.getMaximumWebStats(t):t,a=!1;if(!s)return this.isSendingWebStats=!1,this.webStatsStorage.clearLsData();s=(0,o.appendStatsMeta)(++this.sendAttempt,s,this.statsMeta),this.sendStats(s,(r=>{const n=Date.now();this.isSendingWebStats=!1,r<500&&(e&&200===r?Object.keys((0,o.getEmptyStatsData)()).forEach((t=>this.webStatsStorage.pullFromWebStats(t,s))):this.webStatsStorage.clearLsData(),this.sendAttempt=0,a=!0),(e||400===r)&&(0,o.logProcessingTime)(Date.now()-n,`${e?"prune":"clean"}${400===r?"-fail":""}`,this.statsMeta,this.statlogsValueEvent,`${t.length>>>20}M ${s.length>>>20}M`),this.checkWebStatsLater()}),(()=>{this.isSendingWebStats=!1,!a&&this.webStatsStorage.clearLsData()}))}idlizeCall(t,e){const s=e=>setTimeout((()=>t()),e);return e?.force?s(0):(0,o.getWindow)()?.requestIdleCallback?window.requestIdleCallback((()=>s(this.debounceMs())),{timeout:this.debounceMs()/2}):s(this.debounceMs())}sendStats(t,e,s){const a=new URLSearchParams,r=this.getBrowserFingerprint();r&&a.set("device_id",r);const n=a.toString(),i=this.createUrl(this.statsMeta,n),c=(t,a)=>{if(a)return void this.sendApi(t,e,s,a);const o=new XMLHttpRequest;o.withCredentials=i.includes(`tau.${this.hostName}`),o.onreadystatechange=()=>{o.readyState===XMLHttpRequest.DONE&&e(o.status)},o.onerror=s,o.open("POST",i,!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.send(t)};(0,o.getApiConfig)(this.apiParams).then((s=>{(0,o.canSendBeacon)(this.hostName,this.statsMeta)?(0,o.sendBeacon)(i,t,s).then((()=>e(200))).catch((()=>c(t,s))):c(t,s)}))}sendStat(t,e,s){t=(0,o.appendStatsMeta)(1,t,this.statsMeta),this.sendStats(t,e,s)}saveAndSendStats(t,e){const s=t.length>=this.maxBodyChunkSize,a=e?.force||s;if(t.length<=o.emptyStatsDataLs.length)this.debug.logWebStatsEvent("WebStats empty data.","");else{if(!this.isSendingWebStats)return a||this.timeoutID||!this.onCooldown()?(this.isSendingWebStats=!0,this.idlizeCall((()=>{const t=this.webStatsStorage.getWebStatDataLs();if(t.length>o.emptyStatsDataLs.length&&(a||!this.onCooldown()))return this.webStatsStorage.setLastSendTime(),this.sendStatsWithBatching(t);clearTimeout(this.timeoutID),this.isSendingWebStats=!1,this.timeoutID=void 0}),{...e,force:a})):(this.debug.logWebStatsEvent("WebStats delayed.",this.timeoutID),this.checkWebStatsLater());this.debug.logWebStatsEvent("WebStats sending.",this.isSendingWebStats)}}constructor({statsMeta:t,hostName:e,debug:s,statlogsValueEvent:r,getBrowserFingerprint:n,batchers:i,webStatsStorage:c,maxBodyChunkSize:d,apiParams:l,createUrl:h}){this.sendAttempt=0,this.isSendingWebStats=!1,this.sendApi=async(t,e,s,r)=>{try{const s=JSON.stringify((0,o.transformEventsToArray)(t));await(0,a.api)(r.method,{events:s,...r.body},r.overrideApiConfig),e(200)}catch{s()}},this.statsMeta=t,this.hostName=e,this.debug=s,this.statlogsValueEvent=r,this.getBrowserFingerprint=n,this.batchers=i,this.webStatsStorage=c,this.maxBodyChunkSize=d,this.apiParams=l,this.createUrl=h}}},966358:(t,e,s)=>{s.d(e,{Batchers:()=>r});var a=s(402815),o=s(668813);class r{batchStaleWebStats(t,e){const[s,a]=e,r=`{"${s}":[${JSON.parse(a).reduce(((e,s,a)=>e.length<this.maxBodyChunkSize-t.length?`${e}${0===a?"":","}${JSON.stringify(s)}`:e),"")}]}`;return"{}"===t?r:(0,o.concatJSONS)(t,r)||t}getMaximumWebStats(t){const e=Date.now(),s=t=>`{${t?.map((([t,e])=>`"${t}":${e}`)).join(",")}}`,[r,n]=Object.keys((0,o.getEmptyStatsData)()).reduce(((e,s)=>{const a=this.webStatsStorage.getWebStatsStringValue(s,t);return"[]"===a?e:[...e,[s,a]]}),[]).sort((([,t],[,e])=>e.length-t.length)).reduce((([t,e],[a,o])=>{const r=[[a,o]];return o.length+s(t).length<this.maxBodyChunkSize?[t.concat(r),e]:[t,e.concat(r)]}),[[],[]]),i=s(r);if((0,o.logProcessingTime)(Date.now()-e,"chunk",this.statsMeta,this.statlogsValueEvent),Date.now()-e<a.PROCESSING_LIMIT&&n[0]&&i.length<.1*this.maxBodyChunkSize){const t=Date.now();try{const e=this.batchStaleWebStats(i,n.reverse()[0]);return(0,o.logProcessingTime)(Date.now()-t,"batch",this.statsMeta,this.statlogsValueEvent),e}catch(e){return(0,o.logProcessingTime)(Date.now()-t,"batch-fail",this.statsMeta,this.statlogsValueEvent),""}}return i}constructor({statsMeta:t,statlogsValueEvent:e,webStatsStorage:s,maxBodyChunkSize:a}){this.statsMeta=t,this.statlogsValueEvent=e,this.webStatsStorage=s,this.maxBodyChunkSize=a}}},972611:(t,e,s)=>{s.d(e,{Debug:()=>a});class a{logWebStatsEvent(t,e){this.options?.isDebuggerMode&&console.log(`[new transport debug] ${t}`,e)}constructor({options:t}){this.options=t}}},407674:(t,e,s)=>{s.d(e,{WebStatsStorage:()=>r});var a=s(142705),o=s(668813);class r{writeLocked(t){if("locked"!==this.sessionStorage.getItem(this.lockName)){this.debug.logWebStatsEvent("writeLocked","lock"),this.sessionStorage.setItem(this.lockName,"locked");try{t()}catch(t){}return this.debug.logWebStatsEvent("writeLocked","free"),void this.sessionStorage.setItem(this.lockName,"free")}setTimeout((()=>this.writeLocked(t)),100)}getWebStatDataLs(){return this.localStorage.getItem(this.lsDataKey)||o.emptyStatsDataLs}serializeDataToLs(t){return this.localStorage.setItem(this.lsDataKey,JSON.stringify(t))}getWebStatsStringValue(t,e=this.getWebStatDataLs()){const s=Object.keys((0,o.getEmptyStatsData)()).filter((e=>e!==t)).join("|"),a=e?.match(new RegExp(`"${t}":(\\[.*?\\])(?:,"(${s})":\\[|}$)`))?.[1]||"";return(0,o.isArrayLike)(a)?a:"[]"}fetchDataFromLs(){let t,e=!0;try{const s=this.getWebStatDataLs();if(!s)throw new Error("empty data");t=(0,o.getEmptyStatsData)();const a=JSON.parse(s);Object.keys(t).forEach((s=>{Array.isArray(a[s])&&(e=!1,t[s]=a[s])}))}catch(e){t=(0,o.getEmptyStatsData)()}return{webStatsData:t,isEmpty:e}}clearLsData(t){t&&this.debug.logWebStatsEvent("WebStats cleared. "+(t?"Reason: LS is broken.":""),t),this.writeLocked((()=>this.localStorage.setItem(this.lsDataKey,"")))}setLastSendTime(t=Number(new Date)){this.sessionStorage.setItem(this.lsMetaKey,t.toString())}getLastSendTime(){return parseInt(`${this.sessionStorage.getItem(this.lsMetaKey)||0}`)}getWebStatsItemsCount(t){return Object.values(t).reduce(((t,e)=>t+=e.length),0)}pullFromWebStats(t,e){const s=this.getWebStatsStringValue(t,e);if("[]"!==s){const t=this.getWebStatDataLs().replace(s.slice(1,-1),"").replace(/\[\,/,"[");this.writeLocked((()=>this.localStorage.setItem(this.lsDataKey,t)))}}constructor({statsMeta:t,debug:e,localStorage:s,sessionStorage:o}){this.lsDataKey=`XHR_STATS_TRANSPORT_DATA_${t.platform}`,this.lsMetaKey=`XHR_STATS_TRANSPORT_META_${t.platform}`,this.lockName=`XHR_STATS_TRANSPORT_DATA_LOCK_${t.platform}`,this.debug=e,this.localStorage=s||a.localStorage,this.sessionStorage=o||a.sessionStorage}}},142705:(t,e,s)=>{s.d(e,{CustomStorage:()=>o,localStorage:()=>h,sessionStorage:()=>S});var a=s(668813);class o{setItem(t,e){this.data[t]=String(e)}getItem(t){return this.data.hasOwnProperty(t)?this.data[t]:null}removeItem(t){delete this.data[t]}clear(){this.data={}}get length(){return Object.keys(this.data).length}key(t){return Object.keys(this.data)[t]}constructor(){this.data={},this.keys=()=>Object.keys(this.data)}}const r="vk-ls-dummy",n=Math.random().toString(),i={localStorage:null,sessionStorage:null};function c(t){if(null===i[t])try{const e=(0,a.getWindow)()?.[t];e?.setItem(r,n),i[t]=n===e?.getItem(r),e?.removeItem(r)}catch(e){i[t]=!1}return i[t]}let d;function l(){return d||(d=c("localStorage")?window.localStorage:new o,d)}const h={setItem:(t,e)=>l().setItem(t,e),getItem:t=>l().getItem(t),removeItem:t=>l().removeItem(t),clear:()=>l().clear(),get length(){return l().length},key:t=>l().key(t),keys(){const t=l();return t instanceof o?t.keys():Object.keys(t)},getPrefixedKeys:t=>h.keys().filter((e=>e.startsWith(t)))};let u;function g(){return u||(u=c("sessionStorage")?window.sessionStorage:new o,u)}const S={setItem:(t,e)=>g().setItem(t,e),getItem:t=>g().getItem(t),removeItem:t=>g().removeItem(t),clear:()=>g().clear(),get length(){return g().length},key:t=>g().key(t),keys(){const t=g();return t instanceof o?t.keys():Object.keys(t)},getPrefixedKeys:t=>S.keys().filter((e=>e.startsWith(t)))}},668813:(t,e,s)=>{s.d(e,{appendStatsMeta:()=>l,canSendBeacon:()=>h,concatJSONS:()=>i,emptyStatsDataLs:()=>S,getApiConfig:()=>p,getEmptyStatsData:()=>g,getWindow:()=>m,isArrayLike:()=>n,logProcessingTime:()=>u,sendBeacon:()=>d,transformEventsToArray:()=>c});var a=s(995537),o=s(402815);const r=t=>t.startsWith("{")&&t.endsWith("}"),n=t=>t.startsWith("[")&&t.endsWith("]"),i=(t,e)=>[t,e].every(r)?`${t.slice(0,-1)},${e.substring(1)}`:"{}",c=t=>{try{const e=JSON.parse(t),s=Object.entries(e),a=[];return s.forEach((t=>{const[e,s]=t;o.AVAILABLE_STATS.includes(e)&&Array.isArray(s)&&a.push(...s)})),a}catch{return[]}};function d(t,e,s){try{if(!(s?(0,a.apiBeacon)(s.method,{events:c(e),...s.body},s.overrideApiConfig):navigator.sendBeacon(t,e)))return Promise.reject(new Error("Beacon not sent"))}catch(t){return Promise.reject(new Error("Beacon fail"))}return Promise.resolve()}const l=(t,e,s)=>{const{userId:a,st:o,platform:n,time:c,hash:d,itemId:l,itemOwnerId:h,itemType:u}=s;return i(JSON.stringify({id:a,st:o,platform:n,attempt:t,signTime:c,sign:d,...l&&{itemId:l},...u&&{itemType:u},...h&&{itemOwnerId:h}}),r(e)?e:"{}")};function h(t,e){return"sendBeacon"in navigator&&!e.wsTransport.includes(`tau.${t}`)}function u(t,e,s,a,o){a?.("web_stats_batching_time",t,s.platform,e,o)}const g=()=>({statlogEvents:[],productionStats:[],storyViewStats:[],networkStats:[],customStats:[],webPerfStats:[],benchmarkMainStats:[],vkResStats:[]}),S=JSON.stringify(g()),m=()=>"undefined"!=typeof window?window:void 0,p=async t=>{if(!t)return;const{additionalBody:e,method:s,domain:a,version:o,appId:r,getToken:n}=t;return{body:e,overrideApiConfig:{domain:a,version:o,appId:r,accessToken:await n()},method:s}}}}]);try{stManager?.done("dist/api/widgets/chunks/863a9c29.79d9635f.js")}catch(t){}