$.fn.zawazawaRecentTopicsWikiwikiStyle=function(options){options=$.extend({url:null,key:null,headingColor:"#973D21"},options);var GROUPING_RANGE={"5分":5*60*1e3,"10分":10*60*1e3,"15分":15*60*1e3,"30分":30*60*1e3,"1時間":60*60*1e3,"3時間":3*60*60*1e3,"6時間":6*60*60*1e3,"12時間":12*60*60*1e3,"24時間":24*60*60*1e3};var $container=this;function timeToRange(time){if(!time){return""}var ts=time.valueOf();var now=(new Date).valueOf();var diff=now-ts;for(var label in GROUPING_RANGE){if(diff<GROUPING_RANGE[label]){return label+"以内に投稿"}}var y=time.getFullYear();var m=time.getMonth()+1;var d=time.getDate();if(m<10){m="0"+m}if(d<10){d="0"+d}return y+"-"+m+"-"+d}function createTimeRangeHeading(t){if(t.indexOf("以内")!=-1){return $("<strong>").append($("<font>").attr("color",options.headingColor).append($('<span class="recentdetail">').text(t)))}else{return $("<strong>").text(t)}}function createList(items){$container.html("");var $list=null;var prevRange=null;$.each(items,function(){var linkTag;if(!this["lastCommentedAt"]){return}var range=timeToRange(this["lastCommentedAt"]);if(prevRange!=range){if($list){$container.append($list)}$list=$('<ul class="recent_list">');$container.append(createTimeRangeHeading(range))}if(this["embeddedSites"]&&this["embeddedSites"][options.key]){var siteOverride=this["embeddedSites"][options.key];linkTag=$("<a>").attr("href",siteOverride["url"]).text(siteOverride["name"])}else{linkTag=$("<a>").attr("href",this["url"]).text(this["topicTitle"])}$("<li>").append(linkTag).appendTo($list);prevRange=range});if($list){$container.append($list)}}function replaceToDateObject(item){if(item["lastCommentedAt"]){item["lastCommentedAt"]=new Date(item["lastCommentedAt"])}}$(function(){$.ajax(options.url,{dataType:"jsonp"}).done(function(data){$.each(data["topics"],function(){replaceToDateObject(this)});createList(data["topics"])})})};
