var ADPlacementTrackingMap = {
    // FamilyTree.com 300x250
    'ad-placement-97': {
        'genealogybank': '103780',
        'myheritage': '103790',
        'beenverified': '103760',
        'peoplefinders': '103770'
    },
    // FamilyTree.com 728x90
    'ad-placement-98': {
        'genealogybank': '103830',
        'myheritage': '103840',
        'beenverified': '103810',
        'peoplefinders': '103820'
    },
    // are you my cousin
    'ad-placement-92': {
        'genealogybank': '103440',
        'myheritage': '103450',
        'beenverified': '103420',
        'peoplefinders': '103430'
    },
    // are you my cousin 2
    'ad-placement-95': {
        'genealogybank': '103670',
        'myheritage': '103680',
        'beenverified': '103650',
        'peoplefinders': '103660'
    },
    'takemeback728x90': {
        'genealogybank': '102460',
        'myheritage': '102470',
        'beenverified': '102480',
        'peoplefinders': '102490'
    },
    'theindependentgenealogist': {
        'genealogybank': '102720',
        'myheritage': '102730',
        'beenverified': '102740',
        'peoplefinders': '102750'
    },
    'theideadoor': {
        'genealogybank': '102670',
        'myheritage': '102680',
        'beenverified': '102690',
        'peoplefinders': '102700'
    },
    'takemeback300x250': {
        'genealogybank': '102510',
        'myheritage': '102520',
        'beenverified': '102530',
        'peoplefinders': '102540'
    },
    'genlookups': {
		'ancestry': '107910',
		//'findagrave': '107920',
		//'newspapers': '108650',
        //'genealogybank': '100780',
        'myheritage': '100810',
        //'beenverified': '101160',
        //'findmypast': '101230',
        'peoplefinders': '101170'
    },
    'genlookups300x250': {
		'ancestry': '107930',
		//'findagrave': '107940'
		//'newspapers': '108660',
        'myheritage': '101810',
        //'beenverified': '101820',
        //'findmypast': '101830',
        'peoplefinders': '101840',
		'genealogybank': '101800'
    },
    'families.com': {
        'genealogybank': '101180',
        'myheritage': '101190',
        'beenverified': '101200',
        'peoplefinders': '101210'
    },
    'legacy-L7': {
        'genealogybank': '101250',
        'myheritage': '101240',
        'beenverified': '101260',
        'findmypast': '101270',
        'peoplefinders': '101280'
    },
    'legacy-L16': {
        'genealogybank': '101690',
        'myheritage': '101700',
        'beenverified': '101710',
        'findmypast': '101720',
        'peoplefinders': '101730'
    },
    'legacy-L15': {
        'genealogybank': '101640',
        'myheritage': '101650',
        'beenverified': '101660',
        'findmypast': '101670',
        'peoplefinders': '101680'
    },
    'eyearbook': {
        'genealogybank': '103610',
        'myheritage': '103620',
        'beenverified': '103590',
        'findmypast': '103630',
        'peoplefinders': '103600'
    },
    'familytreemagazine': {
        'genealogybank': '101750',
        'myheritage': '101760',
        'beenverified': '101770',
        'findmypast': '101780',
        'peoplefinders': '101790'
    },
    'geneabloggers': {
        'genealogybank': '101870',
        'myheritage': '101880',
        'beenverified': '101890',
        'findmypast': '101900',
        'peoplefinders': '101910'
    },
    'findagrave': {
        'beenverified': '101990',
        'peoplefinders': '102000',
    },
    'cindislist400x250': {
        'genealogybank': '102410',
        'myheritage': '102420',
        'beenverified': '102430',
        'peoplefinders': '102440'
    },
    'gensoft': {
        'genealogybank': '102610',
        'myheritage': '102620',
        'beenverified': '102630',
        'peoplefinders': '102640'
    },
    'adperfect': {
        'genealogybank': '101430',
        'myheritage': '101440',
        'beenverified': '101450',
        'findmypast': '101460',
        'peoplefinders': '101470'
    },
    // Abundant Genealogy
    'ad-multilink-84': {
        'genealogybank': '102980',
        'myheritage': '102990',
        'beenverified': '102960',
        'peoplefinders': '102970'
    },
    // Genealogy Bargains
    'ad-multilink-85': {
        'genealogybank': '103030',
        'myheritage': '103040',
        'beenverified': '103010',
        'peoplefinders': '103020'
    },
    // DNA Bargains
    'ad-multilink-86': {
        'genealogybank': '103080',
        'myheritage': '103090',
        'beenverified': '103060',
        'peoplefinders': '103070'
    },
    // Family History Hound
    'ad-placement-87': {
        'genealogybank': '103130',
        'myheritage': '103140',
        'beenverified': '103110',
        'peoplefinders': '103120'
    },
    // The Conway Daily Sun AncestryData Multilink Search Box
    'ad-placement-105': {
        'genealogybank': '104190',
        'myheritage': '104200',
        'beenverified': '104170',
        'peoplefinders': '104180'
    },
    // The Conway Daily Sun AncestryData Multilink Search Banner
    'ad-placement-106': {
         'genealogybank': '104240',
         'myheritage': '104250',
         'beenverified': '104220',
         'peoplefinders': '104230'
    },
    // TownNews
    'ad-placement-145': {
         'genealogybank': '106810',
         'myheritage': '106820',
         'beenverified': '106790',
         'peoplefinders': '106800'
    },
    // obit central 728x90
    'obitcentral':{
	'ancestry': '107890',
	'findagrave': '107900',
        'peoplefinders': '107860',
        'myheritage': '107870',
	//'beenverified': '107850'
    },

    //rootspoint
    'rootspointadmlsb':{
        'genealogybank':'105890',
        'myheritage':'105900',
        'beenverified':'105870',
        'peoplefinders':'105880'
    },
    // PeopleFinders Network 300x250
    'ad-placement-162': {
		'ancestry': '108030',
		'findagrave': '108010',
        'newspapers': '107990',
        'myheritage': '108000'
    },
	// PeopleFinders Network 300x600
    'ad-placement-167': {
		'ancestry': '108210',
		'findagrave': '108220',
        'newspapers': '108190',
        'myheritage': '108200'
    }
};

function getTrackingID(soure,advertiser) {
    return ADPlacementTrackingMap[source][advertiser];
}

var AncestryDataCore = {
    getQSparam: function(key,default_) {
            var vars = [],
                hash = {};
            var q = window.location.href.split('?');
            q = q.length > 0 ? q[1] : '';
            if(q != undefined && q.length > 0){
                q = q.substring(0, q.length).split('&');
                for(var i = 0; i < q.length; i++){
                    var kv = q[i].split('=');
                    if (kv[0] === key) {
                        return kv[1];
                    }
                }
            }
            return default_;
        }
};

var ADadvertisers = [
    //{
    //    name: 'spokeo',
    //    label: 'Spokeo',
    //    logo: '-logo-97x23.jpg',
    //    trackingID: '100950',
    //    url: "http://www.spokeo.com/{{fname}}-{{lname}}?g=name_ima_01"
    //},

    {
        name: 'ancestry',
        label: 'Ancestry',
        logo: 'ancestry-logo.png',
        url: 'https://click.linksynergy.com/deeplink?id=7fb4MJKPv0s&mid=50138&murl=https%3A%2F%2Fwww.ancestry.com%2Fcs%2Fpartner-records%3FflowId%3DpartnersBirth%26gsfn%3D{{fname}}%26gsln%3D{{lname}}%26location%3D{{state}}'
    },

    /*{
        name: 'findagrave',
        label: 'FindAGrave',
        logo: 'findagrave-logo.png',
	launchWindow: true,
        url: 'https://www.findagrave.com/memorial/search?firstname={{fname}}&middlename=&lastname={{lname}}&birthyear=&birthyearfilter=&deathyear=&deathyearfilter=&location={{state}}&locationId=&memorialid=&mcid=&linkedToName=&datefilter=&orderby=r&plot=&utm_source=referral&utm_medium=iMedia&utm_campaign=iMediaADW'
    },*/
    
    
	{
        name: 'newspapers',
        label: 'Newspapers.com',
        logo: 'newspapers-logo-112x20.jpg',
		launchWindow: true,
        url: 'https://www.newspapers.com/search?query={{fname}}+{{lname}}&s_place=&date_field=&xid=500&lnd=1'
    },
	
	
   {
        name: 'myheritage',
        label: 'MyHeritage',
        logo: 'myheritage-logo-115x20.jpg',
        launchWindow: true,
        url: 'https://cm.myheritage.com/search-records-6/?firstName={{fname}}&lastName={{lname}}&category=1&action=summary&utm_source=partner_imediasales&utm_medium=partner&utm_campaign=Widget2024_datappc&tr_funnel=supersearch'
		//'https://www.myheritage.com/research?action=query&formId=master&formMode=0&qname=Name+fn.{{fname}}+fnmo.2+fnmsvos.1+fnmsmi.1+ln.{{lname}}+lnmo.4+lnmsdm.1+lnmsmf3.1+lnmsrs.1&utm_source=partner_imediasales&utm_medium=partner&utm_campaign=ancestrydata_widget_mar16&tr_device=&tr_placement=ancestrydata.com&tr_funnel=supersearch'
        //url: 'https://c.ancestrydata.com/mhsite/research?action=query&formId=master&formMode=0&qname=Name+fn.{{fname}}+fnmo.2+fnmsvos.1+fnmsmi.1+ln.{{lname}}+lnmo.4+lnmsdm.1+lnmsmf3.1+lnmsrs.1&utm_source=partner_imediasales&utm_medium=partner&utm_campaign=ancestrydata_multilink_widget_mar16&tr_ad_group=ancestrydata.com&tr_funnel=supersearch'
    },
	
	{
        name: 'peoplefinders',
        label: 'PeopleFinders',
        logo: 'peoplefinders-logo-104x20.jpg',
        url: 'https://www.peoplefinders.com/public-records/searchresults?search=Public&fn={{fname}}&mn=&ln={{lname}}&city=&state={{state}}&utm_source=imedia&utm_campaign=728adw'
    },
    
//    {
//        name: 'findmypast',
//        label: 'FindMyPast',
//        logo: '',
//        url: 'https://c.ancestrydata.com/findmypastsearch/results/world-records?FirstName={{fname}}&LastName={{lname}}'
//    },      
//    {
//        name: 'instantcheckmate',
//        label: 'Instant Checkmate',
//        logo: 'instantcheckmate-logo-99x20.jpg',
//        trackingID: '100800',
//        url: 'https://tcgtrkr.com/?a=217&oc=1&c=1&s1=ancestrydata'
//    }
 /*   {
        name: 'beenverified',
        label: 'BeenVerified',
        logo: 'beenverified-logo-134x20.jpg',
        launchWindow: true,
        url: 'https://www.jumptracker.com/aff_c?offer_id=199&aff_id=3835&aff_sub=ADW&fn={{fname}}&ln={{lname}}&town=&state='
        //url: 'https://www.beenverified.com/seg?utm_source=imedia&utm_campaign=widget_imedia&utm_medium=channel_partner&fn={{fname}}&ln={{lname}}&state={{state}}&age='
    },
*/


    /*{
        name: 'genealogybank',
        label: 'GenealogyBank',
        logo: 'genealogybank-logo-97x23.jpg',
        url: "https://c.ancestrydata.com/genbanksite/explore/all?lname={{lname}}&fname={{fname}}&pq=1&prebuy=no&kbid=139422&intver=&s_referrer=Imedia_Netwk&utm_source=Imedia_Netwk&s_trackval=DA_IMA_CPCADWdgt_042015_0&utm_campaign=DA_IMA_CPCADWdgt_042015_0&s_siteloc=CPCADWidget&utm_medium=CPCADWidget&x=0&y=0"
    },*/
    
];

function getQSparam(key,default_) {
	var vars = [],
		hash = {};
	var q = window.location.href.split('?');
	q = q.length > 0 ? q[1] : '';
	if(q != undefined && q.length > 0){
		q = q.substring(0, q.length).split('&');
		for(var i = 0; i < q.length; i++){
			var kv = q[i].split('=');
			if (kv[0] === key) {
				return kv[1];
			}
		}
	}
	return default_;
}

var trackingID = getQSparam('trackingID', (typeof SourceTrackingID == 'undefined'?'':SourceTrackingID));
var referrer = getQSparam('referrer','') || getQSparam('source','');

var fname = getQSparam('fname','');
var lname = getQSparam('lname','');
var state = getQSparam('state','');
var source = getQSparam('source','');
jQuery(document).ready(function(){
	if (trackingID) {                    
		jQuery('body').append('<img style="display: none" src="https://trk.ancestrydata.com/px.png?itrack='+trackingID+'">');
	}
		
	var trimAdvertisers = [];
	jQuery.each(ADadvertisers,function(i) {
		var item = ADadvertisers[i];
		var trackingID = getTrackingID(source,item['name']);
		if (trackingID) {
			trimAdvertisers.push(item);
		}    
	});
	ADadvertisers = trimAdvertisers;           
	jQuery.each(ADadvertisers,function(i) {
		var item = ADadvertisers[i];
		//console.log(item);                
		var url = item['url'];				
		
		if(i == 0){
			jQuery("#search-direct").click(function(){
				var lname = jQuery('#last_name').val(),
				fname = jQuery('#first_name').val(),
				state = (typeof(jQuery('#state option').filter(":selected").text()) != 'undefined')?jQuery('#state option').filter(":selected").text():'';
				//alert(0);
				if (fname || lname) {
					jQuery('#first_name').removeClass("error");
					jQuery('#last_name').removeClass("error");
					//alert(1);
					trackingID = getTrackingID(source,item['name']);
					url = url.replace('{{fname}}',fname);
					url = url.replace('{{lname}}',lname);
					url = url.replace('{{state}}', state);
					//jQuery("#search-direct").attr("href", url);
					if (trackingID) {
						jQuery('body').append('<img style="display: none" src="https://trk.ancestrydata.com/px.png?itrack='+trackingID+'">');
						var timestamp = new Date().getTime().toString();
						jQuery('body').append('<img style="display: none" src="https://trk.ancestrydata.com/px.png?ctrack='+trackingID+'&rand='+timestamp+'">');
					}
					window.open(url);
				}else{
					jQuery('#first_name').addClass("error");
					jQuery('#last_name').addClass("error");
				}
			});
			
		}				
		jQuery('#advertiser-tabs').append('<li id="tab-'+i+'" class="dropdown-item btn-primary">'+item['label']+'</li>');
		jQuery('#tab-'+i).click(function(){
			var lname = jQuery('#last_name').val(),
				fname = jQuery('#first_name').val(),
				state = (typeof(jQuery('#state option').filter(":selected").text()) != 'undefined')?jQuery('#state option').filter(":selected").text():'';
			//alert(2);
			//alert("fname-"+fname+", lname-"+lname);
			if (fname || lname) {
				jQuery('#first_name').removeClass("error");
				jQuery('#last_name').removeClass("error");
				//alert(3);
				trackingID = getTrackingID(source,item['name']);
				url = url.replace('{{fname}}',fname);
				url = url.replace('{{lname}}',lname);
				url = url.replace('{{state}}',state);
				//jQuery("#search-direct").attr("href", url);
				if (trackingID) {
					jQuery('body').append('<img style="display: none" src="https://trk.ancestrydata.com/px.png?itrack='+trackingID+'">');
					var timestamp = new Date().getTime().toString();
					jQuery('body').append('<img style="display: none" src="https://trk.ancestrydata.com/px.png?ctrack='+trackingID+'&rand='+timestamp+'">');
				}
				window.open(url);
			}else{
				jQuery('#first_name').addClass("error");
				jQuery('#last_name').addClass("error");
			}					
		}); 
	});
});
