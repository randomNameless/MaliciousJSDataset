class botDetectorAjax{static moderateUrl="https://moderate.cleantalk.org/api3.0/frontend_data";static endpoints={moderate:["frontend_data"]};static send(a,n){return new Promise((e,o)=>{let r;if(-1===this.endpoints.moderate.indexOf(a))o(new Error("Method name unknown. "+a));else{r=new URL(this.moderateUrl);let t=new XMLHttpRequest;t.open("POST",r),t.timeout=15e3,t.setRequestHeader("Content-Type","application/json"),n.method_name=a,t.send(JSON.stringify(n)),t.onload=()=>{e(t.response)},t.onerror=()=>{o(new Error("Connection error. "+r.toString()))}}})}}class botDetectorLocalStorage{static maxLifetime=600;static get(t,e){void 0===e&&(e="value");t=localStorage.getItem(t);if(null!==t)try{var o=JSON.parse(t);return o.hasOwnProperty(e)?o[e]:o}catch(t){return new Error(t)}return!1}static set(t,e){e={value:e,timestamp:Math.floor((new Date).getTime()/1e3)};localStorage.setItem(t,JSON.stringify(e))}static isAlive(t,e){return void 0===e&&(e=this.maxLifetime),this.get(t,"timestamp")+e>Math.floor((new Date).getTime()/1e3)}static isSet(t){return null!==localStorage.getItem(t)}static delete(t){localStorage.removeItem(t)}}class TypoData{fieldData={fieldName:"",fieldType:"",isAutocompleteExist:!1,isAutocomplete:!1,label:"",isUseBuffer:!1,speedDelta:0,firstKeyTimestamp:0,lastKeyTimestamp:0,lastDelta:0,countOfKey:0};fields=document.querySelectorAll("input[type=text], input[type=email], textarea");data=[];gatheringFields(){Array.prototype.slice.call(this.fields).forEach((t,e)=>{var o=Object.assign({},this.fieldData);t.name&&(o.fieldName=t.name),t.nodeName&&(o.fieldType=t.nodeName),t.autocomplete&&"off"!==t.autocomplete&&(o.isAutocompleteExist=!0,o.isAutocomplete=t.autocomplete),t.labels&&0<t.labels.length&&(o.label=t.labels[0].innerText),this.data.push(Object.assign({},o))})}setListeners(){this.fields.forEach((t,e)=>{t.addEventListener("paste",t=>{t&&"object"==typeof t&&t instanceof ClipboardEvent?t.clipboardData.getData("text"):void 0!==window.clipboardData&&window.clipboardData.getData("text"),this.data[e].isUseBuffer=!0})}),this.fields.forEach((t,r)=>{t.addEventListener("input",t=>{this.data[r].countOfKey++;var e,o=+new Date;1===this.data[r].countOfKey?(this.data[r].lastKeyTimestamp=o,this.data[r].firstKeyTimestamp=o):(e=o-this.data[r].lastKeyTimestamp,2===this.data[r].countOfKey?(this.data[r].lastKeyTimestamp=o,this.data[r].lastDelta=e):2<this.data[r].countOfKey&&(this.data[r].speedDelta+=Math.abs(this.data[r].lastDelta-e),this.data[r].lastKeyTimestamp=o,this.data[r].lastDelta=e))})})}}function isFromExcludedFromEventTokenField(t,e){if(void 0!==t.attributes.method&&"get"===t.method)return!0;let o=!1;try{var r=getAllDescendantNodes(t),a={selfAttributes:void 0!==t.attributes&&t.attributes,children:void 0!==r&&r!==[]&&r,parent:void 0!==t.parentNode&&t.parentNode.attributes};if(void 0!==e)for(var n in e){var c=e[n];if("object"==typeof c&&c.hasOwnProperty("signs_to_check")){var s=!(!c.signs_to_check.hasOwnProperty("form_attributes")||""===c.signs_to_check.form_attributes)&&c.signs_to_check.form_attributes,i=!(!c.signs_to_check.hasOwnProperty("form_parent_attributes")||""===c.signs_to_check.form_parent_attributes)&&c.signs_to_check.form_parent_attributes,d=!(!c.signs_to_check.hasOwnProperty("form_children_attributes")||""===c.signs_to_check.form_children_attributes)&&c.signs_to_check.form_children_attributes;if(s&&a.selfAttributes)o=checkAttributesExclusions(a.selfAttributes,s);else if(i&&a.parent)o=checkAttributesExclusions(a.parent,i);else if(d&&a.children)for(var l in a.children){if(o)break;void 0===a.children[l]||isChildExcludedCtServiceField(a.children[l])||(o=checkAttributesExclusions(a.children[l].attributes,d))}if(o)return c}}}catch(t){console.warn("CleanTalk Bot Detector exclusion check error: "+t.message)}return o}function getPregMatchBool(t,e){if("string"==typeof t&&"string"==typeof e){if(""===t||""===e)return!1;if(t.match(e))return!0}return!1}function checkAttributesExclusions(t,e){let o=!1;for(var r in t){if(o)break;"object"==typeof t[r]&&null!==t[r]&&"string"==typeof t[r].nodeValue&&(o=getPregMatchBool(t[r].nodeValue,e))}return o}function getAllDescendantNodes(t,e=[]){e.push(...t.childNodes);for(const o of t.childNodes)getAllDescendantNodes(o,e);return e}function isChildExcludedCtServiceField(t){return"string"==typeof t.id&&(-1!==t.id.indexOf("apbct__email_id")||-1!==t.id.indexOf("apbct_event_id")||-1!==t.id.indexOf("apbct_visible_fields")||-1!==t.id.indexOf("ct_checkjs"))||"string"==typeof t.name&&-1!==t.name.indexOf("ct_no_cookie_hidden_field")}function botDetectorOnAnimationStart(t){("onautofillstart"===t.animationName?botDetectorAutocomplete:botDetectorCancelAutocomplete)(t.target)}function botDetectorOnInput(t){("insertReplacementText"!==t.inputType&&"data"in t?botDetectorCancelAutocomplete:botDetectorAutocomplete)(t.target)}function botDetectorAutocomplete(t){var e;t.hasAttribute("autocompleted")||(t.setAttribute("autocompleted",""),e=new window.CustomEvent("onautocomplete",{bubbles:!0,cancelable:!0,detail:null}),t.dispatchEvent(e)||(t.value=""))}function botDetectorCancelAutocomplete(t){t.hasAttribute("autocompleted")&&(t.removeAttribute("autocompleted"),t.dispatchEvent(new window.CustomEvent("onautocomplete",{bubbles:!0,cancelable:!1,detail:null})))}let botDetectorVersion="1.1.26",botDetectorTimeMs=(new Date).getTime(),botDetectorMouseData=[],botDetectorMouseDataFlag=!0,botDetectorMouseDataCounter=0,botDetectorEventsHandledFields=[],botDetectorCronInterval=5e3,botDetectorFormsExclusions;function botDetectorInit(){[["bot_detector_pointer_data",0],["bot_detector_screen_info",botDetectorGetScreenInfo()],["bot_detector_headless",navigator.webdriver]].forEach(t=>{botDetectorLocalStorage.set(t[0],t[1])});var t=botDetectorLocalStorage.get("bot_detector_page_hits")?botDetectorLocalStorage.get("bot_detector_page_hits"):0,t=(botDetectorLocalStorage.set("bot_detector_page_hits",parseInt(t)+1),botDetectorLocalStorage.get("bot_detector_user_agent")?botDetectorLocalStorage.get("bot_detector_user_agent"):window.navigator.userAgent);botDetectorLocalStorage.set("bot_detector_user_agent",t),botDetectorFormsExclusions=botDetectorGetFormsExclusions(),botDetectorStartFormsListeners(),botDetectorSetBrowserCookieSupportFlag(),botDetectorSetReferrers(),botDetectorStartCron([botDetectorSetCronTask(botDetectorCronSendTypoData,"cronTypoData",botDetectorCronInterval,500)]),botDetectorFrontendData("DOMContentLoaded"),setInterval(()=>{botDetectorLocalStorage.isSet("bot_detector_event_token")&&!botDetectorLocalStorage.isAlive("bot_detector_event_token")&&botDetectorFrontendData("automaticRefresh")},3e3);document.typoData=new TypoData,document.typoData.gatheringFields(),document.typoData.setListeners()}function botDetectorGetFormsExclusions(){let t=[];try{t=(t="object"==typeof ctPublic&&!0===ctPublic.hasOwnProperty("bot_detector_forms_excluded"))?JSON.parse(atob(ctPublic.bot_detector_forms_excluded)):[]}catch{}return t}function botDetectorStartFormsListeners(){var e=document.forms;if(0<e.length)for(let t=0;t<e.length;t++)e[t].addEventListener("submit",()=>{botDetectorFrontendData("submit")});botDetectorStartFieldsListening(e)}function botDetectorAttachEventHandler(t,e,o){"function"==typeof window.addEventListener?t.addEventListener(e,o):t.attachEvent(e,o)}function botDetectorRemoveEventHandler(t,e,o){"function"==typeof window.removeEventListener?t.removeEventListener(e,o):t.detachEvent(e,o)}function botDetectorGetScreenInfo(){return{fullWidth:document.documentElement.scrollWidth,fullHeight:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight),visibleWidth:document.documentElement.clientWidth,visibleHeight:document.documentElement.clientHeight}}function botDetectorMouseStopData(){window.removeEventListener("mousemove",botDetectorGetMouseData)}function botDetectorGetMouseData(t){botDetectorMouseDataFlag&&(botDetectorMouseData.push([Math.round(t.clientY),Math.round(t.clientX),Math.round((new Date).getTime()-botDetectorTimeMs)]),botDetectorMouseDataFlag=!1,new Promise(t=>{setTimeout(()=>t(),150)}).then(()=>{botDetectorLocalStorage.set("bot_detector_pointer_data",botDetectorMouseData),botDetectorMouseDataCounter++,botDetectorMouseDataFlag=!0}),50<=botDetectorMouseDataCounter&&botDetectorMouseStopData())}function botDetectorSetHasScrolled(){botDetectorLocalStorage.isSet("bot_detector_has_scrolled")&&botDetectorLocalStorage.isAlive("bot_detector_has_scrolled")&&botDetectorLocalStorage.get("bot_detector_has_scrolled")||(botDetectorLocalStorage.set("bot_detector_has_scrolled",!0),botDetectorFrontendData("scrolled"))}function botDetectorSetMouseMoved(){botDetectorLocalStorage.isSet("bot_detector_mouse_moved")&&botDetectorLocalStorage.isAlive("bot_detector_mouse_moved")&&botDetectorLocalStorage.get("bot_detector_mouse_moved")||(botDetectorLocalStorage.set("bot_detector_mouse_moved",!0),botDetectorFrontendData("mousemoved"))}function botDetectorStartFieldsListening(e){if((!botDetectorLocalStorage.isSet("bot_detector_has_key_up")&&!botDetectorLocalStorage.get("bot_detector_has_key_up")||!botDetectorLocalStorage.isSet("bot_detector_has_input_focused")&&!botDetectorLocalStorage.get("bot_detector_has_input_focused"))&&0<e.length)for(let t=0;t<e.length;t++){var o=e[t].querySelectorAll("input,textarea");for(let t=0;t<o.length;t++)"hidden"!==o[t].type&&(botDetectorEventsHandledFields.push(o[t]),botDetectorAttachEventHandler(o[t],"focus",botDetectorFunctionHasInputFocused),botDetectorAttachEventHandler(o[t],"keyup",botDetectorFunctionHasKeyUp))}}function botDetectorStopFieldsListening(e,o){if(void 0!==botDetectorEventsHandledFields&&0<botDetectorEventsHandledFields.length)for(let t=0;t<botDetectorEventsHandledFields.length;t++)botDetectorRemoveEventHandler(botDetectorEventsHandledFields[t],e,o)}let botDetectorFunctionHasInputFocused=function(){botDetectorLocalStorage.isSet("bot_detector_has_input_focused")&&botDetectorLocalStorage.get("bot_detector_has_input_focused")||botDetectorLocalStorage.set("bot_detector_has_input_focused",!0),botDetectorStopFieldsListening("focus",botDetectorFunctionHasInputFocused)},botDetectorFunctionHasKeyUp=function(){botDetectorLocalStorage.isSet("bot_detector_has_key_up")&&botDetectorLocalStorage.get("bot_detector_has_key_up")||botDetectorLocalStorage.set("bot_detector_has_key_up",!0),botDetectorStopFieldsListening("keyup",botDetectorFunctionHasKeyUp)};function botDetectorSetReferrers(){botDetectorLocalStorage.set("bot_detector_referrer",window.location.href),botDetectorLocalStorage.set("bot_detector_referrer_previous",document.referrer)}function botDetectorSetBrowserCookieSupportFlag(){if(!botDetectorLocalStorage.isSet("bot_detector_browser_supports_cookies")||!botDetectorLocalStorage.isAlive("bot_detector_browser_supports_cookies")||!botDetectorLocalStorage.get("bot_detector_browser_supports_cookies")){let e=navigator.cookieEnabled;if(!e)try{document.cookie="testcookie="+encodeURIComponent("testcookievalue")+"; path=/",e=-1!==document.cookie.indexOf("testcookie")}catch(t){e=!1}botDetectorLocalStorage.set("bot_detector_browser_supports_cookies",e)}}function botDetectorCreateClientInfo(){return{agent:"bot_detector_"+botDetectorVersion,timestamp:Math.floor((new Date).getTime()/1e3)}}function botDetectorFrontendData(t){var e=botDetectorCreateClientInfo();botDetectorLocalStorage.isSet("bot_detector_headless")&&(e.headless=botDetectorLocalStorage.get("bot_detector_headless")),botDetectorLocalStorage.isSet("bot_detector_page_hits")&&(e.page_hits=botDetectorLocalStorage.get("bot_detector_page_hits")),botDetectorLocalStorage.isSet("bot_detector_has_scrolled")&&(e.has_scrolled=botDetectorLocalStorage.get("bot_detector_has_scrolled")),botDetectorLocalStorage.isSet("bot_detector_mouse_moved")&&(e.mouse_moved=botDetectorLocalStorage.get("bot_detector_mouse_moved")),botDetectorLocalStorage.isSet("bot_detector_pointer_data")&&(e.pointer_data=botDetectorLocalStorage.get("bot_detector_pointer_data")),botDetectorLocalStorage.isSet("bot_detector_screen_info")&&(e.screen_info=botDetectorLocalStorage.get("bot_detector_screen_info")),botDetectorLocalStorage.isSet("bot_detector_user_agent")&&(e.user_agent=botDetectorLocalStorage.get("bot_detector_user_agent")),botDetectorLocalStorage.isSet("bot_detector_referrer")&&(e.REFFERRER=botDetectorLocalStorage.get("bot_detector_referrer")),botDetectorLocalStorage.isSet("bot_detector_referrer_previous")&&(e.REFFERRER_PREVIOUS=botDetectorLocalStorage.get("bot_detector_referrer_previous")),botDetectorLocalStorage.isSet("bot_detector_browser_supports_cookies")&&(e.cookies_enabled=botDetectorLocalStorage.get("bot_detector_browser_supports_cookies")),botDetectorLocalStorage.isSet("bot_detector_has_input_focused")&&(e.has_input_focused=botDetectorLocalStorage.get("bot_detector_has_input_focused")),botDetectorLocalStorage.isSet("bot_detector_has_key_up")&&(e.has_key_up=botDetectorLocalStorage.get("bot_detector_has_key_up")),"submit"===t&&document.typoData&&(e.typo=document.typoData.data),botDetectorSendClientInfoToCloud(e,t)}function botDetectorSendClientInfoToCloud(t,e){e={event_token:botDetectorLocalStorage.isSet("bot_detector_event_token")&&botDetectorLocalStorage.isAlive("bot_detector_event_token")?botDetectorLocalStorage.get("bot_detector_event_token"):null,js_event:e,page_url:window.location.href,data:t};1<Object.keys(t).length&&botDetectorAjax.send("frontend_data",e).then(t=>{try{var e=JSON.parse(t);"SUCCESS"===e.data.operation_status?(botDetectorLocalStorage.set("bot_detector_event_token",e.event_token),setEventTokenFieldsToForms(e.event_token)):console.log("API error: "+e.error_no+" - "+e.error_message)}catch(t){console.log("Can not parse the response. "+t.toString())}}).catch(t=>{console.log(t.toString())})}function botDetectorStartCron(t){if(localStorage.removeItem("bot_detector_cron_log"),void 0!==t&&0<t.length)for(let o=0;o<t.length;o++){let e=t[o];void 0!==e._function&&void 0!==e.period&&void 0!==e.cronName&&e&&setTimeout(()=>{setInterval(()=>{if(e._function(e.cronName)){let t=localStorage.getItem("bot_detector_cron_log");(t=t?JSON.parse(t):{})[o]={task:e,last_run:Math.floor((new Date).getTime()/1e3)},localStorage.setItem("bot_detector_cron_log",JSON.stringify(t))}},e.period)},e.startDelay)}}function botDetectorSetCronTask(t,e,o,r=0){return!(void 0===t||"function"!=typeof t||void 0===o||"number"!=typeof o||void 0===e||"string"!=typeof e||32<e.length)&&{_function:t,cronName:e,period:o,startDelay:r}}function botDetectorCronSendTypoData(t){if(document.typoData&&document.typoData.data&&document.typoData.data)for(const o in document.typoData.data){var e;if(0!==document.typoData.data[o].lastKeyTimestamp&&document.typoData.data[o].lastKeyTimestamp>+new Date-botDetectorCronInterval)return(e=botDetectorCreateClientInfo()).typo=document.typoData.data,botDetectorSendClientInfoToCloud(e,t),!0}return!1}function setEventTokenFieldsToForms(e){if("string"!=typeof e||64!==e.length)console.warn("CleanTalk API error: no valid bot detector event token found in server response.");else{var o=document.forms;if(botDetectorLocalStorage.delete("ct_bot_detector_form_exclusion"),0<o.length)for(let t=0;t<o.length;t++){var r=isFromExcludedFromEventTokenField(o[t],botDetectorFormsExclusions);if(!1!==r){let t;try{t=JSON.stringify(r)}catch{t=JSON.stringify("JSON error")}botDetectorLocalStorage.set("ct_bot_detector_form_exclusion",t)}else setEventTokenFormField(o[t],e,t)}}}function setEventTokenFormField(e,o,r){if(void 0!==e.elements.ct_bot_detector_event_token)e.elements.ct_bot_detector_event_token.value=o;else{var a=document.createElement("input");a.setAttribute("type","hidden");let t=100+Math.floor(899*Math.random());t=t.toString()+r.toString().substring(-1),a.setAttribute("id","ct_bot_detector_event_token_"+t),a.setAttribute("name","ct_bot_detector_event_token"),a.value=o,e.append(a)}}"loading"!==document.readyState?botDetectorInit():document.addEventListener("DOMContentLoaded",botDetectorInit),window.addEventListener("mousemove",botDetectorGetMouseData),window.addEventListener("mousemove",botDetectorSetMouseMoved),window.addEventListener("scroll",botDetectorSetHasScrolled),window.addEventListener("animationstart",botDetectorOnAnimationStart,!0),window.addEventListener("input",botDetectorOnInput,!0);