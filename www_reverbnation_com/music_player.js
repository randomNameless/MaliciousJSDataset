(function(e,l){var m=parseInt,p=isNaN,q=function(){var b=navigator.userAgent.toLowerCase(),c=!!b.match(/(iphone|ipad|ipod)/i),e=!!b.match(/android/i),b=!!b.match(/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i),g;b?(g=document.createElement("audio"),g=!!("function"===typeof g.canPlayType&&""!==g.canPlayType('audio/mpeg; codecs="mp3"'))):g=!1;return{isMobile:b,ios:c,android:e,mobileWithMp3:g}}(),r=function(){var b=!1,c={setAllowDebug:function(c){b=!!c},notifyError:function(b,c){if(l.Hoptoad)try{e.isArray(c)||
(c=[c]);var h=n.getInstance(),k={};k.pass=Object.toJSON(h.pass);k.browser=Object.toJSON(q);var a={message:b,component:"music_player",stack:c.join("\n\n"),params:k};Hoptoad.notify(a)}catch(d){}}};e.each(["log","info","error",""],function(){var f=this;c[f]=function(){var c=l.console;b()&&c&&(c[f].apply?c[f].apply(c,arguments):e.each(Array.prototype.slice.call(arguments),function(){c[f](this)}))}});return c}(),s=Reverb.extend(Object,{constructor:function(b){var c=e(document.createElement("div")).data("event_target",
this);e.extend(this,b||{},{bind:c.bind.bind(c),unbind:c.unbind.bind(c),trigger:c.trigger.bind(c)})}}),n=Reverb.extend(s,{constructor:function(b){if(n.$instance)throw Error("PlayerCore is a singleton. Use PlayerCore.init and PlayerCore.getInstance");var c=this,f=document.location.href;b=b||{};n.superclass.constructor.call(c,{playlist:[],pass:b.pass,force_debug:!!f.match(/force_debug=true/),empty_state:"discover",channel:"",volume:100*b.volume});r.setAllowDebug(!(!c.force_debug&&!b.debugMode));l.SM2_DEFER=
!0;require(["modules/player"],function(f){var h={DEBUG_ENABLED:!(!c.force_debug&&!b.debugMode),blankAudio:{}};b.blank_mp3&&(h.blankAudio.mp3=b.blank_mp3);b.volume&&(h.volume=b.volume);b.client&&(h.clientID=b.client);b.server&&(h.webServer=b.server);b.pass&&(h.initialKey=b.pass);var k=f(h);c._Player=k;Reverb.Cookies.clear("rn_player");k.bootstrapPromise.then(function(){e.get("/controller/audio_player/get_xml/?player=InlineAudioPlayer",function(a){c.setPlaylist(a,!0);c.trigger("ready",c)});c.overrideExisting()},
function(a){r.notifyError("Could not initialize the player.",["Error Type: "+a]);c.trigger("player_core:init_error",{error:a})});f=function(a,b){var e=!1,f=null,h=null;return function(){var g=c.getCurrentSongId();f!=g&&(f=g,e=!1);e||(g=b(),h!=g&&(a(),h=g,e=!0),l.setTimeout(function(){e=!1},500))}};k.onWhileLoading(f(function(){c.trigger("player_core:update_max_progress",k.getBufferPercentage())},k.getBufferPercentage));var a=null;k.onWhilePlaying(f(function(){c.trigger("player_core:update_max_progress",
k.getBufferPercentage());var d=k.getPosition(),b=k.getDuration();c.trigger("player_core:song_progress",[100*d/b,d,b]);c.promoter_player&&c.trueSecondPlayed(d,b);if((b=(d=c.getCurrentSong())&&d.id)&&b!==a)a=b,c.trigger("player_core:song_load",d);c.trigger("player_core:progress",d)},k.getPosition));k.onFinish(function(){c.notifyChange("next");c.trigger("player_core:song_finish",c.getCurrentSong());c.playingIndex<c.playlist.length-1&&c.next()});k.onStateChange(function(){k.playing?(c.trigger("player_core:song_play",
c.getCurrentSong()),c.notifyChange("resume")):k.initializing||(c.trigger("player_core:song_pause",c.getCurrentSong()),c.notifyChange("pause"))})});c.from_page_object=null},setPlaylist:function(b,c){var f=this,g,h,k=!0;g="string"==(typeof b).toLowerCase()?e(e.parseXML(b)):e(b);f.playlist=[];g.find("songs song").each(function(a){var d=f.parseXml(e(this));d.index=a;f.playlist.push(d)});g=g.find("songs");var a=g.attr("channel_name"),d=[];g.hasAttr("channel_genres")&&(d=g.attr("channel_genres").split("+"));
f.trigger("player_core:update_channel",{channel:a,genres:d});if(f.playlist.length){if(h=m(g.attr("selected_index")),f.playingIndex=h,f.trigger("player_core:playlist_reset",[f.playlist,h]),/true/.test(g.attr("play_now")+"")){a=f.playlist[h];g=/true/.test(g.attr("reverb_radio")+"");if(f.playAll||g||c)(!n.Browser.isMobile||f._Player._hasInitializedForMobile())&&f.playIndex(h),k=!1;f.notifyChange("queue",{sid:a.id,artist_id:a.artist_id,context:a.context});k&&f.trigger("player_core:song_changed",a)}}else f.trigger("player_core:playlist_reset",
[[],0]);f.playAll=!1;f.setPlayingIndex(h);f.trigger("playlist_updated",f)},getPlaylist:function(){return(this.playlist||[]).slice(0)},overrideExisting:function(){var b=this;l.inline_player_reload_xml_direct=function(c,e){"boolean"==typeof e&&e&&(b.playAll=!0);b.setPlaylist(c)};l.playSongNow=function(c,f,g){b._Player&&b._Player.initializeForMobile();g=g||{};f=f||g.from_page_object;if(""!=c){var h=(c+"").split(",")[0],k=h.split("_"),a="song",d=k[0];1<k.length&&(a=k[0],d=k[1]);h.match(/^all_artist_songs/)?
b.playAll=!0:(b.from_page_object=f,"song"===a&&b.notifyChange("queue",{sid:d}));null==f&&CURRENT_PAGE_OBJECT&&(f=CURRENT_PAGE_OBJECT);f&&(g.from_page_object=f);c="/audio_player/add_to_beginning/"+c+("?"+e.param(g));ajax_post(c)}};l.playArtistFirstSong=function(c,e){b._Player&&b._Player.initializeForMobile();""!=c&&(b.from_page_object=e,b.notifyChange("queue",{artist_id:c}),ajax_post("/audio_player/add_artist_first/"+c))};l.playMusicianFirstSong=function(c){b._Player&&b._Player.initializeForMobile();
""!=c&&(b.notifyChange("queue",{musician_id:c}),ajax_post("/audio_player/add_musician_first/"+c))};l.playLabelRandomSong=function(c,e){b._Player&&b._Player.initializeForMobile();""!=c&&(b.from_page_object=e,ajax_post("/audio_player/add_label_random/"+c))};l.inlineAudioPlayer=function(){return{pauseSong:function(){b.getCurrentSongId()&&b.pause()},resumeSong:function(){b.getCurrentSongId()&&(b._Player.paused?b._Player.resume():b._Player.play())}}}},parseXml:function(b){var c={},f=e(b);e.each("artist downloadable download_url url link mini_profile_url image image_large id title artist_id lyrics duration favorite context".split(" "),
function(b,e){c[e]=f.attr(e)});c.title_display=56<c.title.length?c.title.substr(0,56)+"...":c.title;c.artist_display=56<c.artist.length?c.artist.substr(0,56)+"...":c.artist;c.link&&(c.link=c.link.replace(/^[^\/]*(?:\/[^\/]*){2}/,""));c.mini_profile_url&&(c.mini_profile_url=c.mini_profile_url.replace(/^[^\/]*(?:\/[^\/]*){2}/,""));c.lyrics=/1/.test(c.lyrics+"");c.downloadable=/true/.test(c.downloadable+"");c.favorite=/true/.test(c.favorite+"");return c},playSound:function(b,c){var e;if(b.hasOwnProperty("client"))throw e=
Error("Do not pass client ID to playSound function..."),r.notifyError(e.message,e.stack.split("\n")),e;e=b.song_id;delete b.song_id;if(!e||"{}"!==JSON.stringify(b))throw e=Error("PlayerCore.getInstance().playSound() only supports song_id.  Extra parameters: "+JSON.stringify(b)),r.notifyError(e.message,e.stack.split("\n")),e;this._Player.play(e,{from_page_object:c||this.from_page_object});this.from_page_object=null},playSong:function(b){this.playSound({song_id:b})},playIndex:function(b){this.playingIndex=
null==b||void 0==b?NaN:b;this.trigger("player_core:update_playing_index",b);!p(b)&&this.playlist[b]?(b=this.playlist[b],b.context&&null===this.from_page_object&&(this.from_page_object=b.context),this.playSong(b.id),this.notifyChange("play"),this.trigger("player_core:song_changed",b),this.trigger("song_play",this)):this.reset()},setPass:function(b){this.pass=b},setPlayingIndex:function(b){b=m(b);var c=p(b)?{}:this.playlist[b]||{};this.playingIndex=b;void 0==c.index&&(this.playingIndex=NaN)},setPromoterPlayer:function(b){this.promoter_player=
b},trueSecondPlayed:function(b,c){function e(a,d){var b;b=null!=h.tspSongData?h.tspSongData:h.tspSongData={sid:void 0};k!=b.sid&&(h.tspSongData.secondArray=[],h.tspSongData=null,h.tspSongData=void 0,delete h.tspSongData,g("create new true second played date for sid: "+k),h.tspSongData={sid:k,secondAccepted:0,secondArray:[]});h.tspSongData.secondArray[a]=a;b=h.tspSongData;for(var c=-1,f=0;f<b.secondArray.length;f++)b.secondArray[f]==f&&c++;b.secondAccepted=0>c?0:c>=d?d:c;h.trigger("player_core:trueSecondPlayed",
{song_id:k,seconds:b.secondAccepted});g("second tracking for sid: "+k+", accepted: "+b.secondAccepted+"/"+d)}function g(a){h.force_debug&&console.log("SecondTracking(tsp): "+a)}var h=this,k=h.getCurrentSongId();null!=k&&(!p(b)&&!p(c))&&e(m(b/1E3),m(c/1E3))},notifyChange:function(b,c){var f,g,h={command:b};if(jQuery.isPlainObject(c))e.extend(h,c);else if(f=m(c),p(f)&&(f=m(this.playingIndex)),g=this.playlist[f])h.sid=m(g.id),h.artist_id=m(g.artist_id),h.index=m(g.index),h.context=g.context;jQuery(window).trigger("player_command",
h);"removeall"==b?ajax_post("/audio_player/clear_queue"):"play"==b?ajax_post("/audio_player/set_now_playing_index/"+f):"remove"==b&&ajax_post("/audio_player/remove_from_queue/"+f)},reset:function(){this._Player.stop();this.setPlayingIndex(null);this.trigger("player_core:song_changed",null)},setFavorite:function(b,c){e.each(this.playlist,function(){this.id==b&&(this.favorite=!!c)})},getCurrentSong:function(){var b=!p(this.playingIndex)&&this._Player.currentSongId();return b?_.find(this.playlist,function(c){return c.id==
b})||{id:b}:this.playlist[this.playingIndex]},getCurrentSongId:function(){var b=this.getCurrentSong();return b&&b.id},getPlayingIndex:function(){return this.playingIndex},isPlaying:function(){return this._Player.playing},next:function(){this.notifyChange("next");this.playIndex(this.playingIndex+1)},previous:function(){this.notifyChange("previous");this.playIndex(this.playingIndex-1)},pause:function(){this._Player.pause()},play:function(){!p(this.playingIndex)&&this._Player.currentSongId()?this._Player.play():
this.playlist&&this.playIndex(this.playlist[this.playingIndex]?this.playingIndex:0)},setVolume:function(b){this._Player.setVolume(b/100)},setPosition:function(b){this._Player.currentSongId()&&this._Player.seekTo(this._Player.getDuration()*(b/100))}},function(){return{SONG_STATE_PLAYING:1,SONG_STATE_STOPPED:0,getInstance:function(){if(!this.$instance)throw Error("Player not initialized yet. Use Reverb.playerReady ");return this.$instance},init:function(b){this.$instance||(this.$instance=new this(b||
{}));return this.$instance},setup:function(b){this.init(b).bind("ready",function(b,e){jQuery(window).trigger("player_ready")});return this.$instance},setPass:function(b){this.getInstance().setPass(b)},setFavorite:function(){var b=this.getInstance();b.setFavorite.apply(b,arguments)},showDiscoveryMode:function(){var b=this;l.setTimeout(function(){b.getInstance().showDiscoveryMode()},0)},Browser:q,Console:r,STATES:{song_info:"song_info",discover:"discover_music"}}});l.PlayerCore=n})(jQuery,window);
(function(e,l){var m=parseInt,p=parseFloat,q=isNaN,r={featured_artists:{name:"Featured Artists"},familiar_artists:{name:"Familiar Artists"},reverb_picks:{name:"ReverbNation Picks"},top_artists:{name:"Global Chart Toppers",editableGenres:!0},latest_artists:{name:"Latest Artists"},trending_artists:{name:"Trending Artists",editableGenres:!0},favorite_artists:{name:"Favorite Artists"},hometown:{name:"Local Chart Toppers",editableGenres:!0},"":{name:"Custom"}},s=Reverb.extend(Object,{constructor:function(a){var d=
e(document.createElement("div")).data("event_target",this);e.extend(this,a||{},{bind:d.bind.bind(d),unbind:d.unbind.bind(d),trigger:d.trigger.bind(d)})}}),n=Reverb.extend(s,{constructor:function(){n.superclass.constructor.apply(this,arguments);this.attachEvents()},attachEvents:function(){},getEl:function(){return this.el}}),b=Reverb.extend(n,{constructor:function(a){b.superclass.constructor.call(this,e.extend({value:0,maxValue:100},a||{}));this.originalValue=this.value;this.value=null;this.reset()},
attachEvents:function(){var a=this,d=e(document.body);a.el.bind("mousedown",function(b){b.preventDefault();if(!e(b.target).is(".extra_ui")&&(b=e(this),!b.hasClass("disabled"))){var c=b.offset().left,f=b.width(),h,g=function(d){l.clearTimeout(h);h=l.setTimeout(function(){a.setValue(100*((d.pageX-c)/f))},10)};d.bind({mousemove:g,mouseup:function(b){a.setValue(100*((b.pageX-c)/f));d.unbind("mouseup",arguments.callee).unbind("mousemove",g)}})}})},setValue:function(a,d){var b=this.value;0>a&&(a=0);a>this.maxValue&&
(a=this.maxValue);b!=a&&(this.value=a,this.getProgressEl().css("width",a+"%"),!0!==d&&this.trigger("change"));return this},getProgressEl:function(){this.progressEl||(this.progressEl=this.el.find(".progress"));return this.progressEl},getValue:function(){return this.value},setMaxValue:function(a){100<a&&(a=100);this.maxValue=a;return this},getMaxValue:function(){return this.maxValue},reset:function(){return this.setValue(this.originalValue)},disable:function(){var a=this.el;a.hasClass("disabled")||
a.addClass("disabled");return this},enable:function(){var a=this.el;a.hasClass("disabled")&&a.removeClass("disabled");return this},setEnabled:function(a){this[a?"enable":"disable"].call(this)}}),c=Reverb.extend(b,{constructor:function(){c.superclass.constructor.apply(this,arguments);this.loadEl=e('<div class="load_progress"><div class="progrss_animation"></div> </div>').appendTo(this.el)},setMaxValue:function(){c.superclass.setMaxValue.apply(this,arguments);var a=this.getMaxValue();100<=a?this.loadEl.hide():
this.loadEl.show().css("width",a+"%");return this}}),f=Reverb.extend(n,{constructor:function(a){var d=this;a=e.extend({el:e("#player_control"),buttonCache:{}},a||{});var c=p(Reverb.Cookies.get("rn_mpv")||100);q(c)&&(c=100);a.volumeSlider=new b({el:a.el.find(".volume_slider"),value:c});a.volumeBtn=a.el.find(".volume_btn");a.savedVolume=c;f.superclass.constructor.call(d,a);d.reset();Reverb.playerReady(function(){setTimeout(function(){d.volumeSlider.trigger("change")})})},attachEvents:function(){var a=
this;a.el.delegate(".disabled","click",function(a){a.preventDefault()});a.el.delegate("[data-command]:not(.disabled)","click",function(d){d.preventDefault();d=e(this).data("command");a.trigger("command",d)});a.volumeSlider.bind("change",function(){var d=a.getVolume();a.volumeBtn.toggleClass("muted",!d);Reverb.Cookies.set("rn_mpv",d);a.trigger("command","volume")});a.volumeBtn.bind("click",function(d){d.preventDefault();e(this).hasClass("muted")?a.setVolume(a.savedVolume):(a.savedVolume=a.getVolume(),
a.setVolume(0))})},update:function(a){var d=this;e.each(Object.keys(a),function(){d.setButtonState(this,a[this])});return d},setEnabled:function(a){a=!!a;if(this.enabled!=a)this.el.find(".buttons a")[a?"removeClass":"addClass"]("disabled");return this},setVolume:function(a){this.volumeSlider.setValue(a)},getVolume:function(){return this.volumeSlider.getValue()},getButton:function(a){var d=this.buttonCache[a];if(d)return d;this.buttonCache[a]=this.el.find("[data-command="+a+"]");return this.getButton(a)},
setButtonState:function(a,d){var b=this.getButton(a);d&&b.hasClass("disabled")?b.removeClass("disabled"):!d&&!b.hasClass("disabled")&&b.addClass("disabled");return this},setPlaying:function(a){var d=this.getButton("play"),b=this.getButton("pause");a?(d.hide(),b.show()):(b.hide(),d.show())},reset:function(){this.setEnabled(!1);this.getButton("play").show();this.getButton("pause").hide()},updateSongInfo:function(){var a=k.getInstance(),d=a.getPlayingIndex(),b=a.getPlaylist().length,a=a.isPlaying();
this.update({next:void 0!==d&&d<b-1,prev:0<d,pause:a,play:!a&&0<b});this.setPlaying(a)}}),g=Reverb.extend(n,{constructor:function(a){var d=this;a=e.extend({el:e("#player_about")},a||{});a.progressSlider=new c({el:a.el.find(".progress_slider"),value:0});g.superclass.constructor.call(d,a);d.progressSlider.bind("change",function(){d.trigger("command","progress")});d.timeProgressEl=d.el.find(".time_progress");d.reset();d.showFeedback()},getToggleBtn:function(){this.toggle_btn||(this.toggle_btn=this.el.find(".toggle_playlist"));
return this.toggle_btn},getProgressSlider:function(){return this.progressSlider},attachEvents:function(){var a=this;a.el.delegate(".disabled","click",function(a){a.preventDefault()});a.el.delegate("[data-command]:not(.disabled)","click",function(d){d.preventDefault();d=e(this);var b=d.attr("data-command");"recommend"==b&&d.hasClass("check")&&(b="unrecommend");a.trigger("command",b)})},setData:function(a){var d=this.el;a=e.extend({title:"",title_display:"",artist:"",artist_display:"",link:"",mini_profile_url:"",
image:Reverb.BLANK_IMAGE,favorite:!1,downloadable:!1,id:null},a||{});d.find("[data-role=title]").html(a.title);d.find("[data-role=artist]").html(a.artist);d.find("[data-role=image]").attr("src",a.image);a.mini_profile_url?d.find("[data-role=link]").removeAttr("href").attr("data-display","modal").data("display","modal").attr("data-url",a.mini_profile_url).data("url",a.mini_profile_url):d.find("[data-role=link]").attr("href",a.link.replace(/^[^\/]*(?:\/[^\/]*){2}/,"")).removeAttr("data-display").removeData("display").removeAttr("data-url").removeData("url");
var b=d.find("[data-command=recommend]");a.favorite?b.hasClass("check")||b.addClass("check"):b.removeClass("check");a.id?(this.setEnabled(!0),a.downloadable||d.find("[data-command=download]").addClass("disabled")):this.setEnabled(!1)},setEnabled:function(a){var d=".song_actions a",d=(a=!!a)?d+".disabled":d+":not(.disabled)";this.progressSlider.setEnabled(a);this.el.find(d)[a?"removeClass":"addClass"]("disabled")},setActiveCard:function(a){if(this.active_card!=a){var d=this.el,b=d.find(".cards"),c=
d.find("[data-card="+a+"]");c.length&&(b.stop(!0,!0).fadeOut(function(){d.find("[data-card]:not([data-card="+a+"])").removeClass("active");c.addClass("active");b.fadeIn(function(){b.css("opacity",1)})}),this.active_card=a)}},getActiveCard:function(){return this.active_card},reset:function(){this.setData({});this.progressSlider.setValue(0).setMaxValue(0);this.setTimeProgress(0)},getTimeProgressEl:function(){return this.timeProgressEl},setTimeProgress:function(a){var d=Math.floor(a%36E5/6E4);a=Math.floor(a%
36E5%6E4/1E3)+"";1==a.length&&(a="0"+a);this.getTimeProgressEl().html(d+":"+a)},showFeedback:function(a){var d={flash_missing:'Your browser needs to install Flash to play songs. Click <a href="http://get.adobe.com/flashplayer" target="_blank">here</a> to get it.',initializing:"Initializing the player...",failure:"The player did not initialize correctly.",retrying:"The player did not initialize correctly. Retrying..."};this.el.find("[data-card=feedback]").html(d[a]||d.initializing)}}),h=Reverb.extend(n,
{constructor:function(a){h.superclass.constructor.call(this,e.extend({el:e("#player_queue"),template:e("#player_queue_item_template").data("template")||"",collapsed:!0,navigationHistory:[]},a||{}))},attachEvents:function(){var a=this;a.el.delegate(".player_queue_item .toggle","click",function(a){a.preventDefault();e(this).closest(".player_queue_item").toggleClass("expanded")});a.el.delegate("[data-command]","click",function(d){d.preventDefault();d=e(this);var b=d.closest(".player_queue_item").data("index");
d.hasClass("disabled")||a.trigger("command",[e(this).attr("data-command"),b])});a.el.find("#custom_channel_form a.genre-pill").click(function(a){a.preventDefault();e(this).toggleClass("selected")});a.el.find("#custom_channel_form .custom-channel-header__controls a[data-action]").click(function(a){var b=e(this).data("action");a.preventDefault();switch(b){case "all":e("#custom_channel_form a.genre-pill").addClass("selected");break;case "none":e("#custom_channel_form a.genre-pill").removeClass("selected");
break;case "cancel":e("#custom_channel_form a.genre-pill").removeClass("selected");e("#custom_channel_form a.genre-pill[data-originally-selected]").addClass("selected");break;case "save":e("#custom_channel_form").submit()}});a.el.find("#custom_channel_form").on("ajax:before",function(a){a=e(this);var b=a.find("select#reverb_radio_genres_player_select");a=a.find("a.genre-pill.selected");var c;b.find("option").remove();a.each(function(){c=e(this);e("<option selected></option>").appendTo(b).val(c.data("genre"))})})},
setData:function(a){a=a?a.index:NaN;var d=this.el;d.find(".player_queue_item.playing").removeClass("playing");q(a)||d.find(".player_queue_item[data-index="+a+"]").addClass("playing")},setPlayingIndex:function(a){a=m(a);var d=this.el;d.find(".player_queue_item.playing").removeClass("playing");q(a)||d.find(".player_queue_item[data-index="+a+"]").addClass("playing")},resetPlaylist:function(a){var d=this,b=d.el.find(".player_queue_list"),c=document.createDocumentFragment(),f=b.data("jsp"),h=f&&f.getPercentScrolledY(),
g=f&&f.getContentPositionY();b.empty();e.each(a,function(a){a=d.formatPlaylistNode(this,a);a[0]&&c.appendChild(a[0])});b[0]&&b[0].appendChild(c);a.length?d.showPlaylistMode():d.showDiscoveryMode();f=b.data("jsp");1==h?f.scrollToPercentY(1):null!=g&&60<g&&f.scrollToY(g);return d},resetQueueScroller:function(){var a=this.el.find(".player_queue_list");require(["vendor/jquery.jscrollpane"],function(){a.jScrollPane&&a.find(".player_queue_item:first").length?(a.attr("style",""),a.data("jsp",null),a.show().jScrollPane({verticalGutter:0}),
a.css({display:""})):a.attr("style","")});return this},formatPlaylistNode:function(a,d){var b=e(e.trim(this.template.format(a)));b.attr("data-index",d);a.mini_profile_url&&b.find("a[href='"+a.link+"']").removeAttr("href").attr("data-display","modal").attr("data-url",a.mini_profile_url);a.downloadable||b.find("[data-command=download]").addClass("disabled");a.lyrics||b.find("[data-command=lyrics]").addClass("disabled");return b},showPlaylistMode:function(){return this.setActiveCard("queue_items").resetQueueScroller()},
showDiscoveryMode:function(){return this.setActiveCard("queue_discover")},showCustomChannelMode:function(){return this.setActiveCard("queue_custom_channel")},setActiveCard:function(a,d){if(a){var b=this.el.find("[data-card="+a+"]:not(.active_card)");b.length&&(this.el.find(".active_card").removeClass("active_card"),b.addClass("active_card"),d||(b=this.navigationHistory.slice(-9),this.lastHistoryStep&&b.push(this.lastHistoryStep),this.lastHistoryStep=a,this.navigationHistory=b),this.trigger("active_card_changed",
[a]));return this}},back:function(){this.setActiveCard(this.navigationHistory.pop())},getActiveCard:function(){return this.el.find("[data-card].active_card").attr("data-card")},setTitle:function(a){this.el.find("[data-role=title]").html(a)},toggle:function(){return this.el.hasClass("collapsed")?this.expand():this.collapse()},collapse:function(a){var d=this.el;if(d.hasClass("collapsed"))Reverb.callback(a);else return d.addClass("collapsed"),Reverb.callback(a),this.trigger("collapse"),this},expand:function(a){var d=
this.el;if(d.hasClass("collapsed"))return d.removeClass("collapsed"),Reverb.callback(a),this.trigger("expand"),this;Reverb.callback(a)}}),k=Reverb.extend(s,{constructor:function(a){if(k.$instance)throw Error("MusicPlayer is a singleton. Use MusicPlayer.init and MusicPlayer.getInstance");var d=this;a=a||{};k.superclass.constructor.call(d,{playerCore:PlayerCore.setup(a),playerQueue:new h,playerAbout:new g,playerControl:new f,empty_state:"discover",channel:""});e.each("getCurrentSong trueSecondPlayed setPass playSong getPlaylist getPlayingIndex playIndex isPlaying setVolume setPosition play pause next previous setPromoterPlayer".split(" "),
function(a,b){d.delegate(b,d.playerCore)});a=e.proxy(this.updateSongInfo,this);this.playerCore.bind({ready:function(){d.trigger("ready")},"player_core:playlist_reset":e.proxy(this.playlistReset,this),"player_core:song_changed":e.proxy(this.songChanged,this),"player_core:song_finish":a,"player_core:song_play":a,"player_core:song_pause":a,"player_core:update_channel":e.proxy(this.updateCurrentChannel,this),"player_core:song_load":e.proxy(this.songLoaded,this),"player_core:update_max_progress":e.proxy(this.songDataLoaded,
this),"player_core:song_progress":e.proxy(this.progress,this),"player_core:init_error":e.proxy(this.initError,this)});this.playerCore.bind("player_core:trueSecondPlayed",function(a,b){d.trigger("music_player:trueSecondPlayed",b)});this.playerQueue.bind("active_card_changed",function(a,b){d.trigger("music_player:active_card_changed",b)})},delegate:function(a,b){this[a]=function(){var c=b[a].apply(b,arguments);return c==b?this:c}},songDataLoaded:function(a,b){this.playerAbout.getProgressSlider().setMaxValue(b)},
initError:function(a,b){this.playerAbout.showFeedback("FLASHBLOCK"==b?"flash_missing":"failure")},progress:function(a,b,c,e){this.playerAbout.getProgressSlider().setValue(b,!0);this.playerAbout.setTimeProgress(c)},songLoaded:function(a,b){},updateCurrentChannel:function(a,b){var c=b.genres;this.setChannel(b.channel);this.setSelectedGenres(c)},setChannel:function(a){this.channel=a;this.playerQueue.setTitle(this.getChannelTitle());this.playerQueue.el.find("#reverb_radio_channel").val(a)},setSelectedGenres:function(a){this.playerQueue.el.find("#custom_channel_form").find("a.genre-pill").each(function(){var b=
e(this),c=b.data("genre");b.removeDataAttr("originally-selected");-1!=a.indexOf(c)&&b.addClass("selected").dataAttr("originally-selected",!0)})},getChannelTitle:function(){var a;if(this.channel&&(a=r[this.channel])){var b="Channel - "+a.name;a.editableGenres&&(b+=' <a href="javascript:;" data-command="select_channel_genres">(edit genres)</a>');return b}return""},updateSongInfo:function(a,b){this.playerAbout.setData(b);this.playerQueue.setData(b);this.playerControl.updateSongInfo(b)},songChanged:function(a,
b){this.playerAbout.reset();this.updateSongInfo(a,b)},playlistReset:function(a,b,c){this.playerQueue.resetPlaylist(b);this.playerQueue.setPlayingIndex(c);b.length?this.playerQueue.setActiveCard("queue_items"):this.playerQueue.setTitle("");this.playAll=!1;a=this.klass.STATES[b.length?"song_info":this.empty_state];this.playerAbout.setActiveCard(a);"song_info"==a&&this.playerAbout.setData(this.getCurrentSong());this.playerControl.updateSongInfo(this.getCurrentSong());this.trigger("playlist_updated",
this)},parseXml:function(a){var b={},c=e(a);e.each("artist downloadable download_url url link mini_profile_url image id title artist_id lyrics duration favorite".split(" "),function(a,e){b[e]=c.attr(e)});b.title_display=56<b.title.length?b.title.substr(0,56)+"...":b.title;b.artist_display=56<b.artist.length?b.artist.substr(0,56)+"...":b.artist;b.link&&(b.link=b.link.replace(/^[^\/]*(?:\/[^\/]*){2}/,""));b.mini_profile_url&&(b.mini_profile_url=b.mini_profile_url.replace(/^[^\/]*(?:\/[^\/]*){2}/,""));
b.lyrics=/1/.test(b.lyrics+"");b.downloadable=/true/.test(b.downloadable+"");b.favorite=/true/.test(b.favorite+"");return b},initEvents:function(){var a=this.playerQueue,b=this.playerAbout,c=this.playerControl,f=e(document.body),g=!1;e(l).bind({modal_proxy_show:function(){l.clearTimeout(void 0);g=!0},modal_proxy_hide:function(){l.setTimeout(function(){g=!1},50)}});a.bind("expand",function(){var b=!1;f.bind("click",function t(c){c=e(c.target);b||(b=!0,a.bind("collapse",function u(){a.unbind("collapse",
u);f.unbind("click",t)}));!g&&(!c.is("#music_player")&&!c.parents("#music_player:first").length&&c.is(":visible"))&&a.collapse()})});e("#music_player").delegate("#music_player a[href]:not([href^='#']):not([href^=javascript])","click",function(a){a.preventDefault();Reverb.Navigate.go_to_page_url(e(this).attr("href"))});e(l).bind("page_change",a.collapse.bind(a));a.bind({command:this.handleQueueCommand.bind(this),collapse:function(){b.getToggleBtn().removeClass("opened")},expand:function(){b.getToggleBtn().addClass("opened")}});
b.bind({command:this.handleAboutCommand.bind(this)});c.bind({command:this.handleControlCommand.bind(this)})},notifyChange:function(a,b){var c,f,g={command:a};if(e.isPlainObject(b))e.extend(g,b);else if(c=m(b),q(c)&&(c=m(this.playingIndex)),f=this.getPlaylist()[c])g.sid=m(f.id),g.artist_id=m(f.artist_id),g.index=m(f.index);e(window).trigger("player_command",g);"removeall"==a?ajax_post("/audio_player/clear_queue"):"play"==a?ajax_post("/audio_player/set_now_playing_index/"+c):"remove"==a&&ajax_post("/audio_player/remove_from_queue/"+
c)},reset:function(){this.playerControl.reset();this.playerAbout.reset();this.playerCore.reset()},setFavorite:function(a,b){e.each(this.getPlaylist(),function(){this.id==a&&(this.favorite=!!b)});0<=this.getPlayingIndex()&&this.playerAbout.setData(this.getCurrentSong())},sendCommand:function(a){this.handleControlCommand(null,a)},showDiscoveryMode:function(){this.playerQueue.showDiscoveryMode().expand()},_initializeForMobile:function(){this.playerCore&&this.playerCore._Player&&this.playerCore._Player.initializeForMobile()},
handleQueueCommand:function(a,b,c){a=this.getPlaylist()[c];switch(b){case "show_playlist":this.playerQueue.showPlaylistMode().expand();break;case "show_discover":this.playerQueue.showDiscoveryMode().expand();break;case "discover_local":this._initializeForMobile();e.post("/c/audio_player/music_now?reverb_radio[channel]=hometown");break;case "discover_global":this._initializeForMobile();e.post("/c/audio_player/music_now?reverb_radio[channel]=top_artists");break;case "discover_trending":this._initializeForMobile();
e.post("/c/audio_player/music_now?reverb_radio[channel]=trending_artists");break;case "discover_my_favorites":this._initializeForMobile();e.post("/c/audio_player/music_now?reverb_radio[channel]=favorite_artists");break;case "discover_featured":this._initializeForMobile();e.post("/c/audio_player/music_now?reverb_radio[channel]=featured_artists");break;case "discover_alt_rock_indie":this._initializeForMobile();e.post("/c/audio_player/music_now?reverb_radio[channel]=reverb_picks&reverb_radio[genres]=alternative,indie,rock");
break;case "discover_electro_pop_dance":this._initializeForMobile();e.post("/c/audio_player/music_now?reverb_radio[channel]=reverb_picks&reverb_radio[genres]=electronica,dj,dance");break;case "discover_hiphop_rap_rbsoul":this._initializeForMobile();e.post("/c/audio_player/music_now?reverb_radio[channel]=reverb_picks&reverb_radio[genres]=hiphop,rap,rbsoul");break;case "discover_custom_channel":this.setChannel("reverb_picks");this.playerQueue.showCustomChannelMode().expand();break;case "select_channel_genres":this.playerQueue.showCustomChannelMode().expand();
break;case "back":this.playerQueue.back();break;case "fan":modal_open("/artist/become_fan/"+a.artist_id,null,{method:"POST"});break;case "favorite":ajax_post("/library/add?item_id=song_"+a.id);break;case "lyrics":modal_open("/artist/song_show_lyrics/"+a.id);break;case "remove_song":b=a.index+0;this.notifyChange("remove",b);b==this.getPlayingIndex()&&(this.isPlaying()?this.playIndex(b+1):this.playIndex(null));break;case "share_playlist":modal_open("/playlist/share_queue");break;case "clear_playlist":this.playIndex(null);
this.notifyChange("removeall");break;case "toggle":this.playerQueue.toggle();break;case "play":this.playIndex(a.index);break;case "share":modal_open("/page_object/share_song/"+a.id);break;case "download":modal_open("/audio_player/download_song/"+a.id+"?modal=true/")}},handleAboutCommand:function(a,b){var c=this.getCurrentSong(),f=e("#profile_songs_container"),f=f&&f.is(":visible");switch(b){case "discover":this.playerQueue.showDiscoveryMode().expand();break;case "toggle_playlist":this.playerQueue.toggle();
break;case "progress":this.setPosition(this.playerAbout.getProgressSlider().getValue());break;case "share":c&&modal_open("/page_object/share_song/"+c.id+(f?"?onshare=record_lp_shares":""));break;case "download":c&&modal_open("/audio_player/download_song/"+c.id+"?modal=true/");break;case "recommend":c&&ajax_post("/library/add?item_id=song_"+c.id);break;case "unrecommend":c&&ajax_post("/library/remove?item_id=song_"+c.id)}},handleControlCommand:function(a,b){switch(b){case "volume":this.setVolume(this.playerControl.getVolume());
break;case "play":this.play();break;case "pause":this.pause();break;case "prev":this.previous();break;case "next":this.next()}}},function(){return{getInstance:function(){if(!this.$instance)throw Error("Player not initialized yet. Use Reverb.playerReady ");return this.$instance},init:function(a){this.$instance||(this.$instance=new this(a||{}));return this.$instance},setup:function(a){var b=this;b.init(a).bind("ready",function(){b.$instance.initEvents();e(window).trigger("player_ready")})},setPass:function(a){this.getInstance().setPass(a)},
setFavorite:function(){var a=this.getInstance();a.setFavorite.apply(a,arguments)},showDiscoveryMode:function(){var a=this;l.setTimeout(function(){a.getInstance().showDiscoveryMode()},0)},STATES:{song_info:"song_info",discover:"discover_music"}}});l.MusicPlayer=k})(jQuery,window);function mainVideoPlayerCommand(e){var l=e.command;e=e.id;"ready"!=l&&"play"!=l&&"share"==l&&modal_open("/page_object/share_video/"+e)};
