/*!
 * clipboard.js v1.5.16
 * https://zenorocha.github.io/clipboard.js
 *
 * Licensed MIT Â© Zeno Rocha
 */
(function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Clipboard=t()}})(function(){var t;return function t(e,n,i){function o(a,c){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!c&&l)return l(a,!0);if(r)return r(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var u=n[a]={exports:{}};e[a][0].call(u.exports,function(t){var n=e[a][1][t];return o(n||t)},u,u.exports,t,e,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,e,n){function i(t,e){for(;t&&t.nodeType!==o;){if(t.matches(e))return t;t=t.parentNode}}var o=9;if(Element&&!Element.prototype.matches){var r=Element.prototype;r.matches=r.matchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector||r.webkitMatchesSelector}e.exports=i},{}],2:[function(t,e,n){function i(t,e,n,i,r){var a=o.apply(this,arguments);return t.addEventListener(n,a,r),{destroy:function(){t.removeEventListener(n,a,r)}}}function o(t,e,n,i){return function(n){n.delegateTarget=r(n.target,e),n.delegateTarget&&i.call(t,n)}}var r=t("./closest");e.exports=i},{"./closest":1}],3:[function(t,e,n){n.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},n.nodeList=function(t){var e=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===e||"[object HTMLCollection]"===e)&&"length"in t&&(0===t.length||n.node(t[0]))},n.string=function(t){return"string"==typeof t||t instanceof String},n.fn=function(t){var e=Object.prototype.toString.call(t);return"[object Function]"===e}},{}],4:[function(t,e,n){function i(t,e,n){if(!t&&!e&&!n)throw new Error("Missing required arguments");if(!c.string(e))throw new TypeError("Second argument must be a String");if(!c.fn(n))throw new TypeError("Third argument must be a Function");if(c.node(t))return o(t,e,n);if(c.nodeList(t))return r(t,e,n);if(c.string(t))return a(t,e,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function o(t,e,n){return t.addEventListener(e,n),{destroy:function(){t.removeEventListener(e,n)}}}function r(t,e,n){return Array.prototype.forEach.call(t,function(t){t.addEventListener(e,n)}),{destroy:function(){Array.prototype.forEach.call(t,function(t){t.removeEventListener(e,n)})}}}function a(t,e,n){return l(document.body,t,e,n)}var c=t("./is"),l=t("delegate");e.exports=i},{"./is":3,delegate:2}],5:[function(t,e,n){function i(t){var e;if("SELECT"===t.nodeName)t.focus(),e=t.value;else if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName)t.focus(),t.setSelectionRange(0,t.value.length),e=t.value;else{t.hasAttribute("contenteditable")&&t.focus();var n=window.getSelection(),i=document.createRange();i.selectNodeContents(t),n.removeAllRanges(),n.addRange(i),e=n.toString()}return e}e.exports=i},{}],6:[function(t,e,n){function i(){}i.prototype={on:function(t,e,n){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){function i(){o.off(t,i),e.apply(n,arguments)}var o=this;return i._=e,this.on(t,i,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),i=0,o=n.length;i<o;i++)n[i].fn.apply(n[i].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),i=n[t],o=[];if(i&&e)for(var r=0,a=i.length;r<a;r++)i[r].fn!==e&&i[r].fn._!==e&&o.push(i[r]);return o.length?n[t]=o:delete n[t],this}},e.exports=i},{}],7:[function(e,n,i){(function(o,r){if("function"==typeof t&&t.amd)t(["module","select"],r);else if(void 0!==i)r(n,e("select"));else{var a={exports:{}};r(a,o.select),o.clipboardAction=a.exports}})(this,function(t,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=n(e),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function(){function t(e){i(this,t),this.resolveOptions(e),this.initSelection()}return a(t,[{key:"resolveOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=t.action,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var t=this,e="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return t.removeFake()},this.fakeHandler=document.body.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[e?"right":"left"]="-9999px";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.addEventListener("focus",window.scrollTo(0,n)),this.fakeElem.style.top=n+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,o.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,o.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var t=void 0;try{t=document.execCommand(this.action)}catch(e){t=!1}this.handleResult(t)}},{key:"handleResult",value:function(t){this.emitter.emit(t?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=t,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(t){if(void 0!==t){if(!t||"object"!==(void 0===t?"undefined":r(t))||1!==t.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&t.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(t.hasAttribute("readonly")||t.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=t}},get:function(){return this._target}}]),t}();t.exports=c})},{select:5}],8:[function(e,n,i){(function(o,r){if("function"==typeof t&&t.amd)t(["module","./clipboard-action","tiny-emitter","good-listener"],r);else if(void 0!==i)r(n,e("./clipboard-action"),e("tiny-emitter"),e("good-listener"));else{var a={exports:{}};r(a,o.clipboardAction,o.tinyEmitter,o.goodListener),o.clipboard=a.exports}})(this,function(t,e,n,i){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t,e){var n="data-clipboard-"+t;if(e.hasAttribute(n))return e.getAttribute(n)}var s=o(e),u=o(n),f=o(i),d=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),h=function(t){function e(t,n){r(this,e);var i=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.resolveOptions(n),i.listenClick(t),i}return c(e,t),d(e,[{key:"resolveOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof t.action?t.action:this.defaultAction,this.target="function"==typeof t.target?t.target:this.defaultTarget,this.text="function"==typeof t.text?t.text:this.defaultText}},{key:"listenClick",value:function(t){var e=this;this.listener=(0,f.default)(t,"click",function(t){return e.onClick(t)})}},{key:"onClick",value:function(t){var e=t.delegateTarget||t.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new s.default({action:this.action(e),target:this.target(e),text:this.text(e),trigger:e,emitter:this})}},{key:"defaultAction",value:function(t){return l("action",t)}},{key:"defaultTarget",value:function(t){var e=l("target",t);if(e)return document.querySelector(e)}},{key:"defaultText",value:function(t){return l("text",t)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}]),e}(u.default);t.exports=h})},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)});
"use strict";YP.Favourites=(function($YPCA){var favourites={settings:{},_init:function(){favourites._addRemoveToFavMerchandPage();favourites._eventsFavFavouritePage();favourites._addEventListeners();YP.Common.tooltipInit()},_addEventListeners:function(){$YPCA(document).on('User/LogOut',function(){$YPCA('.jsMerchantFav .jsBtnFav').removeClass("btn-addtofav");});},_addRemoveToFavMerchandPage:function(){$YPCA(document).on('click','.jsBtnFav',function(e){e.preventDefault();var $btn=$YPCA(this);if(!YP.Yid.isAuthenticated()&&YP.Utils.isDefined($btn.data('analytics-step1'))){YPCA.Analytics.clicks($btn,$btn.data('analytics-step1'));}
YP.Yid.login(function(loginStatus){favourites.publicFunctions.setFavourite($btn,$btn.data('analytics-confirm'),loginStatus.isSignUpAutologin);},'FAVOURITE');});},_eventsFavFavouritePage:function(){$YPCA('.jsDeleteFav').click(function(e){e.preventDefault();e.stopPropagation();favourites._removeFavFavouritePage($YPCA(this));});},_removeFavFavouritePage:function($elem){$YPCA.ajax({type:"POST",url:$elem.attr("href"),success:function(data){$elem.closest(".listing").addClass('listing--removed');},contentType:"application/json"});},_listener:function(){$YPCA(document).on('User/LogOut',function(){$YPCA('.jsMerchantFav .jsBtnFav').removeClass("btn-addtofav");});},publicFunctions:{setFavourite:function($btn,jsonAnalytics,isSignUpAutologin){var requestType=$btn.hasClass('btn-addtofav')?"DELETE":"POST",merchantId=$btn.attr('data-id');$YPCA.ajax({type:requestType,url:$btn.attr('data-urlajax'),success:function(data){$YPCA('.jsBtnFav[data-id="'+merchantId+'"]').parent().html(data);if(requestType==='POST'&&!isSignUpAutologin){YP.User.showUnconfirmedEmailModal();}
if(YP.Utils.isDefined(jsonAnalytics)){YPCA.Analytics.clicks($btn,jsonAnalytics);}},contentType:"application/json"});}}};$YPCA(function(){favourites._init();});return favourites.publicFunctions;})($YPCA);
"use strict";YP.Merchant=(function($YPCA,window){var $body=$YPCA('body'),merchantSettings={facebook:{},settings:{},isMerchantPage:$body.hasClass('ypg_merchant'),triggerFixed:$YPCA('.jsShowCTA').length!==0?$YPCA('.jsShowCTA').offset().top+$YPCA(".jsShowCTA").height():false,triggerOpacity:($body.hasClass('ypg_merchant')&&$YPCA(".controls").length!==0?$YPCA(".controls").offset().top-30:0),menuShowMore:false,config:{showMore:null,showLess:null,NUMBER_OF_WORDS:4,LENGTH_LIMIT:30}},merchant={_init:function(){merchant._addHolidayTitle();merchant._collapseScapText();merchant._addEventListener();merchant._setConfig();merchant._dynamicAddImageTop();merchant._comingFromEmail();merchant._setMerchantPageDisplay();merchant._comingFromBestReview();merchant._tabGestion();merchant._defaultTab();merchant._viewReviewFromSerp();merchant._viewInfoFromSerp();merchant._tripAdviserFromSerp();merchant._openPhotoInGallery();merchant._openMonoWidget();if($YPCA('.jsTextMenu').length>0){merchant._menuTextNav();merchant._toggleDineToClass();var $menuNav=$YPCA('#menu-nav');if(typeof $menuNav.okayNav!=="undefined"){$menuNav.okayNav({swipe_enabled:false});}
merchant._menuAddTooltip();}
merchant.attachDomListeners();$YPCA('.fromDirection:visible').focus();if($YPCA('body').hasClass('expandMapList')){$YPCA('.mainContainer').addClass('mLoc jsListingMerchantCards');$YPCA('.directionContent').hide();$YPCA('.resultList').show();$YPCA('.sponsoredListings .resultList').show();}
if(YP.Utils.isDefined(YP.Serp)){YP.Serp.showSerpDeals();}
merchant._dealerMobileMap();merchant._copyLink();merchant._checkHashParams();merchant._addPhotoEventListener();merchant._setVerticalBar();merchantSettings.$urlMyTime=$YPCA('.jsMytimeIframe').data('src');merchant._load();},_load:function(){if(YPCA.Utils.isDefined(merchantSettings.settings.sponsoredListingsUrl)&&merchantSettings.settings.sponsoredListingsUrl!==''){$YPCA.ajax({url:merchantSettings.settings.sponsoredListingsUrl,type:'get',dataType:'html',async:true,success:function(data){$YPCA('#sponsoredListings').html(data);if(YP.Utils.urlParamHash('app')!=='true'){YPCA.Analytics.triggerPageView("analytics-resource",1);}
if(YP.Utils.isDefined(window.tc_vars_overlay)){YPCA.Analytics.sendCustomPageView(window.tc_vars_overlay,'WIDGET');}
YP.Common.tooltipInit();}});}
var $anchors=$YPCA('a[data-img-src]');if($anchors.length>0){$anchors.each(function(){var $this=$YPCA(this),imgSrc=$this.data('img-src'),imgAlt=$this.data('img-alt'),imgTitle=$this.data('img-title'),aHref=$this.data('img-src-big');$this.attr('href',aHref);$YPCA('<img/>',{onError:'replaceMissingImages(this)',src:imgSrc,alt:imgAlt,title:imgTitle}).appendTo(this);});}
if($YPCA('.sliderContent').width()<$YPCA('#slider').width()){$YPCA('a[class*="slider"]').hide();}
setTimeout(function(){var $els=$YPCA('.media-item.image-item, .media-item.video-item');$els.find('img').each(function(){var $this=$YPCA(this),$parent=$this.parent(),parentHeight=$parent.innerHeight(),parentWidth=$parent.innerWidth();$this.css($this.height()<$this.width()?{'height':parentHeight+'px','width':'auto'}:{'height':'auto','width':parentWidth+'px'});$this.css('opacity','1');});$els.find('img').each(function(){var $this=$YPCA(this),$parent=$this.parent(),parentHeight=$parent.innerHeight(),parentWidth=$parent.innerWidth(),overflow='-'+(Math.max($this.height()-parentHeight,$this.width()-parentWidth))/2+'px';$this.css($this.height()>$this.width()?{'margin-top':overflow}:{'margin-left':overflow});});},1000);if(window.location.href.indexOf('myTime')!==-1){merchant._launchMyTimeModal();}
var $jsMerchantBookingConfig=$YPCA('.jsMerchantBookingConfig');if($jsMerchantBookingConfig.length>0){var config=YP.Utils.convertDataToJSON($jsMerchantBookingConfig),bookingUrl=config.bookingWidgetUrl,d=new Date(),dateString=d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate(),minutes=(Math.ceil(d.getMinutes()/30)*30);bookingUrl=bookingUrl.replace("{{date}}",dateString).replace("{{hour}}",minutes===60?(d.getHours()+1===24?0:d.getHours()+1):d.getHours()).replace("{{minute}}",minutes===60?"00":minutes);$YPCA.get(bookingUrl,function(data){$YPCA('.jsBookingWidget').html(data);});}},_collapseScapText:function(){var $merchantScapText=$YPCA('.jsMerchantScapText');if($merchantScapText.text().length>merchantSettings.config.LENGTH_LIMIT&&YP.Utils.isDevicePhone()){merchantSettings.config.showMore=$merchantScapText.data('more');merchantSettings.config.showLess=$merchantScapText.data('less');var modifiedText=YP.Utils.createExpandCollapseText($merchantScapText.text(),merchantSettings.config.NUMBER_OF_WORDS,{showmore:merchantSettings.config.showMore,showless:merchantSettings.config.showLess});$merchantScapText.html(modifiedText);}},_addEventListener:function(){$YPCA('.jsFBShare').click(function(){merchant._triggerAskAFriend();});$YPCA(".jsBtnMore").click(function(e){e.preventDefault();$YPCA(this).closest(".jsParentContainer").toggleClass("less");});$YPCA(".jsDetailsToogle").click(function(e){e.preventDefault();var $this=$YPCA(this);$this.closest('.jsBusinessDetailsContainer').toggleClass('merchant__details--show merchant__details--hide');merchant._toggleMPDetail();if($this.hasClass('show__details')){$YPCA(document).trigger('mp/showDetails','.jsStickyMPMobileOffset');}});$YPCA(".jsModuleToogle").click(function(e){e.preventDefault();merchant._moduleToogle(this);});$YPCA('.jsPrintButton').on('click',function(){window.print();});$YPCA(".jsScrollOpenHours").click(function(){if(YP.Utils.isDevicePhone()){YP.Utils.scrollPage($YPCA('#openHours'));}});YP.Common.hoverToShowHidden(".jsHeaderChart",".jsHeaderChartTooltip",200,200);$YPCA('#ypgBody').on('click','.goToByScroll',function(e){e.preventDefault();merchant.goToByScroll(this.hash);});$YPCA(document).one('click','.jsThumbToggle',function(e){$YPCA(this).toggleClass('ypicon-thumb-full ypicon-thumb-o');$YPCA('.jsThumbToggle').addClass('cursor-default').removeAttr('data-toggle data-original-title data-placement data-analytics');return false;});$YPCA(".icon-close").click(function(e){e.preventDefault();$YPCA(this).parent().hide();});$YPCA('.jsShowMenu').click(function(e){e.preventDefault();$YPCA(this).toggleClass('shares__item--active');});$YPCA(".goToQestions").click(function(e){e.preventDefault();merchant.goToByScroll(this.hash);$YPCA('#merchantQuestions').addClass('module--show').removeClass('module--hide');});$YPCA('#jsModalContainer').on('click','.jsBtnSaveMerchant',function(e){e.preventDefault();var $btn=$YPCA(this),$jsAddressBookAnalyticsConfig=$YPCA('.jsAddressBookAnalyticsConfig');if($jsAddressBookAnalyticsConfig.length>0){merchantSettings.settings=$YPCA.extend(merchantSettings.settings,YP.Utils.getJson($jsAddressBookAnalyticsConfig));YPCA.Analytics.clicks($btn,merchantSettings.settings.analytics.add_now);}
YP.Yid.login(function(loginStatus){YP.Favourites.setFavourite($btn,$btn.data('analytics-confirm'),loginStatus.isSignUpAutologin);location.href=$YPCA('.jsUserFavoritesUrl').attr('href');},'FAVOURITE');});$YPCA('.jsViewTravelDistance').click(function(){var $elem=$YPCA(this),$loader=$YPCA('.jsLoadingIcon');if($elem.data('lat')!==''&&$elem.data('lng')!==''){$loader.removeClass('hidden');YPCA.Analytics.clicks($elem,$elem.data('analytics-intent'));YP.LocationService.fetchLocation(function(data){YP.TravelDistance.getDistance({lat:data.latitude,lng:data.longitude},{lat:$elem.data('lat'),lng:$elem.data('lng')}).then(function(result){merchant._hideTravelTimeElements({$elem:$elem,$loader:$loader});merchant._renderTravelTime(result);YPCA.Analytics.clicks($elem,$elem.data('analytics-success'));}).fail(function(result){merchant._hideTravelTimeElements({$elem:$elem,$loader:$loader});merchant._renderTravelTime(result);});},function(error){YP.Common.traceLog(error);$elem.addClass('hidden');},false);}});$YPCA('.jsBookNowDiv').on('click','.jsBookNowButton',merchant._onMyTimeClick);$YPCA('.jsLaunchBookNow').click(function(){merchant._launchMyTimeModal();});$YPCA('.jsSuggestAnUpdate').click(function(){$YPCA("#ypSuggestUpdateOwner").modal();var $config=$YPCA('#view_suggest_update');if($config.length>0){var config=YP.Utils.convertDataToJSON($config);YPCA.Analytics.pageView(config.impression_suggest_update_warning);}});},_onMyTimeClick:function(){if(!YP.Utils.urlParamHash('visitor_id',merchantSettings.$urlMyTime)&&YP.Utils.isDefined(window.tc_vars)){merchantSettings.$urlMyTime=merchantSettings.$urlMyTime+'&visitor_id='+YP.Analytics.getVisitorId()+'&session_id='+window.tc_vars.session_id+'&cf_environment='+window.tc_vars.cf_environment;$YPCA('.jsMytimeIframe').attr('src',merchantSettings.$urlMyTime);}
if(YP.Utils.convertDataToJSON($YPCA('.jsIsSafariOrIE')).safariOrIE==="true"){window.open(merchantSettings.$urlMyTime,'_blank');}else{$YPCA('.jsMyTimeBookNow').modal('show');}},_loadMap:function(){var $mapContainer=$YPCA('.jsMapOutput');if($mapContainer.length===0){$mapContainer=$YPCA('.jsStaticPrintMapContainer');}
$YPCA.get($mapContainer.data('url')).done(function(success){if($mapContainer.selector==='.jsStaticPrintMapContainer'&&$mapContainer.length>0){$mapContainer.html(success);YP.StaticMap.createStaticMap();}else{$mapContainer.html(success).promise().done(function(){if($YPCA('.jsStaticMapContainer').length>0&&YP.Utils.isDefined(YP.StaticMap)){YP.StaticMap.createStaticMap();}});}}).fail(function(){YP.Common.traceLog('error getting ajax map');});},_launchMyTimeModal:function(){if(YP.Utils.isDefined('.jsMyTimeBookNow')){$YPCA('.jsBookNowButton').trigger('click');}},_checkHashParams:function(){var params=YP.Utils.queryParametersToJSON(window.location.search);if(params.source&&params.source==='imageUpload'){var accountIsConfirmed=merchant._isAccountConfirmed();YP.Modal.show('#jsModalContainer','/ajax/photoconfirmation?accountConfirmed='+accountIsConfirmed);}
if(window.location.hash!==''&&window.location.hash!=='#'){merchant.goToByScroll(window.location.hash);}
if(YP.Utils.urlParamHash('#')==='editorsPick'){merchant.goToByScroll('#editorsPick');}
if((params.action&&params.action==='writeReview')||!isNaN(params.r)){var data={rating:params.rating||params.r,ratingAtmosphere:params.ratingA,ratingFood:params.ratingF,ratingService:params.ratingS,email:params.email};setTimeout(function(){$YPCA('.jsWriteReview').first().trigger('click',data);});}
if(YP.Utils.urlParamHash('reviewsPageNumber')!==0){window.location.href=YP.Utils.removeParam("reviewsPageNumber",window.location.href);}},_addPhotoEventListener:function(){$YPCA(".jsUploadImagePreview").click(function(e){e.preventDefault();merchant._imageUploadClick($YPCA(this));});$YPCA('.ypPostPhotoPromotion').on('hidden.bs.modal',function(){var splitUrl=YP.Utils.removeParams(['source'],window.location.href);window.history.pushState({},null,splitUrl);var $jsOtherLanguageUrl=$YPCA('.jsOtherLanguageUrl'),otherLanguageUrl=YP.Utils.removeParams(['source'],$jsOtherLanguageUrl.attr('href'));$jsOtherLanguageUrl.attr('href',otherLanguageUrl);});},_moduleToogle:function(selector){$YPCA(selector).closest('.jsModuleContainer').toggleClass('module--show module--hide');},_dynamicAddImageTop:function(){var $dataElem=$YPCA('.jsImagesConfigHandlebar');if($dataElem.length!==0){var data=YP.Utils.convertDataToJSON($dataElem),html=YP.Utils.getHandlebarHtml('#jsMediaImgTmpl',data);$YPCA('.jsEmptyMedia:first').before(html);$YPCA('.jsEmptyMediaAppend').append(html);}},_copyLink:function(){var selector='.jsCopyLink',$btn=$YPCA(selector);if($btn.length!==0){new Clipboard(selector).on('success',function(){$YPCA('.jsShares').append('<div class="copy__feedback jsCopyFeedback">'+YP.Common.getMessage('copy.link.tooltip')+'</div>');$YPCA('.jsCopyFeedback').fadeIn(400);setTimeout(function(){$YPCA('.jsCopyFeedback').fadeOut(400,function(){$YPCA(this).remove();});},1000);});}},_setVerticalBar:function(){if(!($YPCA('.jsBusinessDetailsRating').length>0&&$YPCA('.jsBookNowDiv').length>0)){$YPCA('.merchant__mytime__booknow').addClass("includeBar");}},_hideTravelTimeElements:function(opts){opts.$loader.addClass('hidden');opts.$elem.addClass('hidden');},_isAccountConfirmed:function(){var userInfo=YP.User.getUserInfo(),isConfirmed=merchantSettings.settings.uploadPhoto.user.isConfirmed==='true';if(merchantSettings.settings.uploadPhoto.isPhotoWithoutLogin==='true'&&userInfo.sessionToken===''){isConfirmed=true;}
return isConfirmed;},_toggleDineToClass:function(){$YPCA('.food-menu--item').each(function(){var $this=$YPCA(this);if($this.find('.food-menu--price__multiple').length>0){$this.addClass('food-menu--item__multipleMeal');}});},_menuAddTooltip:function(){$YPCA('.deviceDesktop .jsMenuNav.loaded .okayNav__menu-toggle').attr({'data-toggle':'tooltip','data-placement':'top','title':YP.Common.getMessage("merchant.menu.toggle")}).tooltip();},_menuTextNav:function(){var $menuNavItem=$YPCA('.jsMenuNav li'),classActiveName='active',menuContent=$YPCA('.menu__content');$YPCA('.jsMenuNav').on('click','li',function(){var $this=$YPCA(this),content_id=$this.attr('data-content');$menuNavItem.removeClass(classActiveName);menuContent.removeClass(classActiveName);$this.addClass(classActiveName);$YPCA("#"+content_id).addClass(classActiveName);$YPCA('.okayNav__menu-toggle.icon--active').trigger('click');merchant.goToByScroll('#menu');});},_removeHideBtnMenu:function($elem){var containerHeight=$elem.height(),isMenuBigger=containerHeight<=200;$YPCA('.jsMenuExpand').toggle(isMenuBigger);$YPCA('.jsMenuContainer').toggleClass('module--expandable module--hide',isMenuBigger);},_removeHideBtnMenuLoad:function(){var $jsMenuContent=$YPCA('.jsMenuContent')
if($jsMenuContent.length===1){merchant._removeHideBtnMenu($jsMenuContent);}},_renderTravelTime:function(result){var template={sizeTransport:Object.keys(result).length,transportList:result},source=Handlebars.compile($YPCA('.jsTravelTimeTemplate').html());$YPCA('.jsTravelDistanceOutput').html(source(template));},_setConfig:function(){var $config=$YPCA('#facebook-resource');if($config.length>0){merchantSettings.facebook=$YPCA.extend(merchantSettings.facebook,JSON.parse($config.html()));}
$config=$YPCA('.jsMapResource').last();if($config.length>0&&$YPCA('.mapWrap').length>0){merchantSettings.settings=$YPCA.extend(merchantSettings.settings,JSON.parse($config.html()));}
$config=$YPCA('#sponsored-listings-config');if($config.length>0){merchantSettings.settings=$YPCA.extend(merchantSettings.settings,JSON.parse($config.html()));}
$config=$YPCA('.jsUploadPhotoGenericConfig');if($config.length>0){merchantSettings.settings=$YPCA.extend(merchantSettings.settings,JSON.parse($config.html()));}},_triggerAskAFriend:function(){if(typeof FB!=='undefined'&&FB!==null){FB.ui({display:'popup',method:'share',href:merchantSettings.facebook.canonicalUrl+'?ypcampaign=askyourfriends&ypsource=facebook&ypmedium=social'},function(){if(merchantSettings.facebook.popupUrl!==''){window.open(merchantSettings.facebook.popupUrl,'_blank','height='+merchantSettings.facebook.height+',width='+merchantSettings.facebook.width);}});}},_dealerMobileMap:function(){var isMapParsed=false;$YPCA('.jsDealerToggle').on('click',function(){var $body=$YPCA('body');$body.toggleClass("dealerMap");if(!isMapParsed&&$body.hasClass('dealerMap')){YPCA.publish('Data/Parsed');isMapParsed=true;}});$YPCA('.jsResultsList').on('click','.jsPagination',function(){isMapParsed=false;});},attachDomListeners:function(){var $fallback=$YPCA('.fallback');if($fallback.length>0){$fallback.hide();}},goToByScroll:function(anchor){var $anchorDiv=$YPCA(anchor);if($anchorDiv.length>0){$YPCA('html, body').animate({scrollTop:$anchorDiv.offset().top-($YPCA('.deviceDesktop .jsHeader').height()+$YPCA('.jsHeaderWrapper').height())},500);}},_toggleMPDetail:function(){if($YPCA('.jsBusinessDetailsContainer').hasClass('merchant__details--hide')&&YP.Utils.isDevicePhone()){YP.Utils.scrollPage($YPCA('#ypgBody'));}},_imageUploadClick:function(elem){var userInfo=YP.User.getUserInfo();if(!userInfo.authenticated){YPCA.Analytics.clicks(elem,merchantSettings.settings.uploadPhoto.analytics.intent);}
if(merchantSettings.settings.uploadPhoto.isPhotoWithoutLogin==='true'){window.location=merchantSettings.settings.uploadPhoto.urlUploadPhotoPreview;}else{YP.Yid.login(function(){YPCA.Analytics.clicks(elem,merchantSettings.settings.uploadPhoto.analytics.confirm);setTimeout(function(){window.location=merchantSettings.settings.uploadPhoto.urlUploadPhotoPreview;},250);});}},_addHolidayTitle:function(){if($YPCA(".isHolidayHour").length>=1){$YPCA(".holidayTitle").show();}},_comingFromEmail:function(){if(window.location.href.indexOf("reviewApprovalEmail")>-1){var $config=$YPCA('#review_notification_email');if($config.length>0){var config=YP.Utils.convertDataToJSON($config);YPCA.Analytics.pageView(config.review_notification_email);}}},_comingFromBestReview:function(){if(YP.Utils.urlParamHash("ypgBestReview")>0&&$YPCA(".jsYpReviewTab").length>0){setTimeout(function(){if(YP.Utils.isDevicePhone()||YP.Utils.isDeviceTablet()){$YPCA('.mobile_tab_hide').hide();$YPCA(".merchant__review").show();$YPCA(".merchantContent").hide();$YPCA('.merchant_tab').removeClass("active");$YPCA('.review_merchant_tab').addClass("active");}
$YPCA(".jsYpReviewTab").click();var text=YP.Utils.urlParamHash("ypgBestReview");var reviewSection=$YPCA('[data-reviewid="'+text+'"]');if(reviewSection.length>0){var page=reviewSection.closest(".reviewPages").data("page");if(page>1){$YPCA(".reviewPage"+page).trigger("click");}
$YPCA('html, body').animate({scrollTop:($YPCA('[data-reviewid="'+text+'"]').offset().top-($YPCA(reviewSection).height()+175))},500);}},200);}},_setMerchantPageDisplay:function(){if($YPCA(".sameDay").length>0){$YPCA(".sameDay2").removeClass("sameDay2");}
if($YPCA(".openow").length>0){$YPCA(".open_hour_dropdown").html($YPCA(".openow").html());}
else if($YPCA(".openow").length<=0){$YPCA(".open_hour_dropdown").html($YPCA(".closed_today").html());}
if($YPCA(".freeText").length>0&&$YPCA(".openow").length<=0&&$YPCA(".sameday").length<=0&&$YPCA(".sameday2").length<=0){$YPCA(".open_hour_dropdown").remove();}
if($YPCA(".mlr__submenu__item__social").length===0){$YPCA(".merchant__useful_section__social").remove();}
var $body=$YPCA('body');$body.on('click',function(){$YPCA(".openHours-table").hide();});$body.on('click','.open_hour_dropdown',function(e){e.stopPropagation();var $openHoursTable=$YPCA(".openHours-table");if($openHoursTable.css('display')==='none'){$openHoursTable.show();}else{$openHoursTable.hide();}});$body.on('click','.openHours-table',function(e){e.stopPropagation();var $openHoursTable=$YPCA(".openHours-table");if($openHoursTable.css('display')==='none'){$openHoursTable.show();}else{$openHoursTable.hide();}});$body.on('click','.see-hours',function(e){e.stopPropagation();if(YP.Utils.isDevicePhone()){$YPCA('.info_merchant_tab ').trigger("click");}
$YPCA(".openHours-table").show();merchant.goToByScroll("#openHourScroll");});},_tabGestion:function(){if(!YP.Utils.isDeviceDesktop()){$YPCA('.merchant_tab').click(function(){$YPCA('.merchant_tab').removeClass("active");$YPCA(this).addClass("active");});$YPCA('.info_merchant_tab').click(function(){$YPCA('.mobile_tab_hide').hide();$YPCA(".merchant__box").show();$YPCA(".merchantContent").show();});$YPCA('.location_merchant_tab').click(function(){$YPCA('.mobile_tab_hide').hide();$YPCA(".merchant__Location").show();$YPCA(".merchantContent").hide();});$YPCA('.review_merchant_tab').click(function(){$YPCA('.mobile_tab_hide').hide();$YPCA(".merchant__review").show();$YPCA(".merchantContent").hide();});$YPCA('.details_merchant_tab').click(function(){$YPCA('.mobile_tab_hide').hide();$YPCA(".merchant__details_description").show();$YPCA(".merchantContent").hide();});$YPCA('body').on('click','.mlr__item--booknow',function(){$YPCA('.info_merchant_tab').trigger("click");merchant.goToByScroll("#moduleBookenda");});$YPCA('.listing-count, .listing__ratings__count, .ypStars-wrapper').click(function(){merchant.showMerchantContentAndReview();setTimeout(function(){merchant.goToByScroll("#ypgReviewsHeader");},700);});$YPCA('.listing__editorPick__link').click(function(){$YPCA('.info_merchant_tab').trigger("click");});}},_defaultTab(){const bodyElement=$YPCA("body");$YPCA(".merchant__details_description").show();},_viewReviewFromSerp:function(){if(window.location.href.indexOf("ypgReviewsHeader")>-1){merchant.showMerchantContentAndReview()
setTimeout(function(){merchant.goToByScroll("#ypgReviewsHeader");},700);}},_viewInfoFromSerp:function(){if(window.location.href.indexOf("moduleBookenda")>-1){$YPCA('.info_merchant_tab').trigger("click");setTimeout(function(){merchant.goToByScroll(window.location.hash);},100);}},_tripAdviserFromSerp:function(){if(window.location.href.indexOf("taReviewsHeader")>-1){merchant.showMerchantContentAndReview();setTimeout(function(){$YPCA('.jsShowAllReviews').trigger("click");},100);}},_openPhotoInGallery:function(){if(window.location.href.indexOf("photoGallery")>-1){var url=YP.Utils.urlParamHash("photoGallery");setTimeout(function(){$YPCA('[data-img-src="'+url+'"]').trigger("click");},100);}},_openMonoWidget:function(){if(window.location.href.indexOf("monoWidget")>-1){setTimeout(function(){$YPCA('.schwiz-ifr-btn').trigger("click");},100);}},showMerchantContentAndReview:function(){$YPCA(".merchant__review").show();$YPCA(".merchantContent").show();}}
$YPCA(function(){merchant._init();merchant._loadMap();});return{goToByScroll:merchant.goToByScroll};})($YPCA,window);
"use strict";var YP=window.YP||{};YP.Stars=(function($YPCA,document){var stars={_init:function(){stars._mouseoverEvent();stars._mouseleaveEvent();},publicFunctions:{selectRating:function($element){$element.siblings().andSelf().removeClass('active clicked');$element.prevAll().andSelf().addClass('active clicked');$element.parent().next('.jsRateText').html($element.attr('title'));},isRatingSelected:function($element){return $element.children('.clicked').length!==0;},resetStarsText:function(){var $rateText=$YPCA('.jsRateText');$rateText.each(function(){const self=$YPCA(this);if(!stars.publicFunctions.isRatingSelected(self.siblings('span'))){self.html(self.data('text'));}});}},_mouseoverEvent:function(){$YPCA(document).on('mouseover','.jsStarReview:not(".noHover")',function(){var self=$YPCA(this),parent=self.parent();self.siblings().andSelf().removeClass('active');parent.next('.jsRateText').html(self.attr('title'));self.closest('.jsStarsContainer').find('.jsRateText').html(self.attr('title'));self.prevAll().andSelf().addClass('active');});},_mouseleaveEvent:function(){$YPCA(document).on('mouseleave','.jsStarsRate:not(".noHover")',function(){var self=$YPCA(this),activeLength=self.children('.clicked').length;self.children('span').removeClass('active').each(function(){const selfSpan=$YPCA(this);selfSpan.toggleClass('active',selfSpan.hasClass('clicked'));});var $selfEm=self.siblings('.jsRateText');if(activeLength>0){$selfEm.html(self.children('.clicked').last().attr('title'));}else{stars.publicFunctions.resetStarsText();}});}};$YPCA(function(){stars._init();});return stars.publicFunctions;})($YPCA,document);
"use strict";YP.ReviewService=(function($YPCA){var review={defaultRequest:{sessionToken:"",merchantId:null,overallRating:0,reviewText:'',reviewTitle:'',atmosphereRating:0,foodRating:0,serviceRating:0,category:'',subCategory:'',price:'',file:'',images:null,isMobile:false,userEmailAlerts:true,userEmail:null,reviewType:null,imageTokens:[]},imageFiles:[],imageFilesData:[],tempImgData:null,imageUrl:[],imageChanged:false,templateHandlebars:'',refreshAfterClosingModal:false,loginTriggered:false,engagement:{settings:{}},settings:{constants:{BAD_REQUEST:400,MIN_CHARS_REVIEW:20,YP_REVIEWS_PAGINATION_NB_BTN:4,TIMEOUT_TIME:500},keypressTimer:null,isEmailExistInYid:false,isUserRegisteredLive:false,$ratingStarsContainer:'',$writeReviewModal:$YPCA('#jsModalContainer')},_init:function(){review._getConfig();},_activeRightNbStars:function(){var nbStars=review.settings.$ratingStarsContainer.find("span.active").length;$YPCA('#ypInput_overallRating span').removeClass('active');$YPCA('#ypInput_overallRating span:lt('+nbStars+')').addClass('active');$YPCA('.ypRateControl em').text($YPCA('#ypInput_overallRating span.star'+nbStars).attr('title'));},_addEventListeners:function(){review.keypressTimer=null;var _index;review.settings.$writeReviewModal.on('hidden.bs.modal',function(){review._removeEventListeners();YP.Analytics.hideOverlay();$YPCA('#jsModalContainer').html('');$YPCA('.jsStarReview').removeClass('active on clicked');YP.Stars.resetStarsText();$YPCA(this).off('hidden.bs.modal');});$YPCA('.jsWriteReviewForm').on('click','.jsStarsRate',function(){$YPCA('.jsGlobalRatingContainer').removeClass('error');});$YPCA('.jsWriteReviewForm').on('click','.jsStarReview',function(){review.publicFunctions.selectRating($YPCA(this));});$YPCA('.jsGlobalRatingContainer').on('click','.jsStarReview',function(){var optionalCommentField=$YPCA('.jsOptionalComment');optionalCommentField.toggleClass('hidden',$YPCA(this).data('star')<3);});$YPCA('.jsWriteReviewForm').on('keypress','.jsStarReview',review._checkSpaceOrEnterPressed);$YPCA('.jsWriteReviewForm').on('change keyup blur paste','.jsReviewEmail',review._checkEmailExistInYid);$YPCA('.jsProjectTypeDropdown').on('change',review._populateSubCategoryDropdown);$YPCA('.jsProjectPrice').on('keydown',function(){var charCode=(event.which)?event.which:event.keyCode;return YP.ValidationUtils.isDigitOnly(charCode);});$YPCA(document).on('User/LogIn',function(){if(YPCA.Utils.storageAPI.get('session','reviewInfo')!==null){review._preSubmitReview();}});$YPCA('.category__images').on('click','.jsYpDelete',function(){var imgToDel=$YPCA(this).next().attr('src');review.imageFilesData.forEach(function(img,index){if(img===imgToDel){_index=index;}});review.imageFiles.splice(_index,1);review.imageFilesData.splice(_index,1);$YPCA(this).parent().remove();review.imageChanged=true;});$YPCA('.jsAddReviewImage').click(function(){$YPCA('#UploadReviewImagefile').trigger('click');});$YPCA('#UploadReviewImagefile').change(function(){review._showPreviewImage($YPCA(this)[0]);review.imageChanged=true;$YPCA(this).val('');});$YPCA('.jsWriteReviewForm').on('keypress','.jsStarReview',review._checkSpaceOrEnterPressed);},_showPreviewImage:function(input){var $err=false;if(input.files&&input.files[0]){var reader=new FileReader(),fileSize=input.files[0].size/1048576;review.tempImgData=input.files[0];reader.onload=function(e){var image=new Image();image.src=e.target.result;review.imageFilesData.forEach(function(img){if(img===e.target.result){$err=true;$YPCA('.err1043').show();setTimeout(function(){$YPCA('.err1043').fadeTo(1000,0,function(){$YPCA('.err1043').hide();});},3500);$YPCA('.err1043').css('opacity',1);}});if(!$err&&fileSize>10){$err=true;$YPCA('.err1044').show();setTimeout(function(){$YPCA('.err1044').fadeTo(1000,0,function(){$YPCA('.err1044').hide();});},3500);$YPCA('.err1044').css('opacity',1);}
if(!$err){image.onload=function(){if(this.width<480||this.height<480){$err=true;$YPCA('.err1039').show();setTimeout(function(){$YPCA('.err1039').fadeTo(1000,0,function(){$YPCA('.err1039').hide();});},3500);$YPCA('.err1039').css('opacity',1);}
if(this.width/this.height>2.333||this.width/this.height<0.4285){$err=true;$YPCA('.err1040').show();setTimeout(function(){$YPCA('.err1040').fadeTo(1000,0,function(){$YPCA('.err1040').hide();});},3500);$YPCA('.err1040').css('opacity',1);}
if(!$err){review.imageFilesData.push(e.target.result);review.imageFiles.push(review.tempImgData);if(YP.Utils.isDeviceDesktop()){$YPCA('.jsAddReviewImage').before('<div class="ReviewImageNo"><span class="jsYpDelete ypdelete ypicon"></span><img src="'+e.target.result+'"></div>');}else{$YPCA('.jsAddReviewImage').before('<div class="ReviewImageNo"><span class="jsYpDelete tblypdelete ypicon"></span><img src="'+e.target.result+'"></div>');}}};}}
reader.readAsDataURL(input.files[0]);}},_getDataURI:function(url,callback){var image=new Image();image.crossOrigin='anonymous';var canvas=document.createElement("canvas"),canvasContext=canvas.getContext("2d");image.onload=function(){canvas.width=image.width;canvas.height=image.height;canvasContext.drawImage(image,0,0,image.naturalWidth,image.naturalHeight);callback(canvas.toDataURL());};image.src=url;},_dataURItoFile:function(dataURI){var byteString;if(dataURI.split(',')[0].indexOf('base64')>=0)
byteString=atob(dataURI.split(',')[1]);else
byteString=unescape(dataURI.split(',')[1]);var mimeString=dataURI.split(',')[0].split(':')[1].split(';')[0];var ia=new Uint8Array(byteString.length);for(var i=0;i<byteString.length;i++){ia[i]=byteString.charCodeAt(i);}
var blob=new Blob([ia],{type:mimeString});var file=new File([blob],"name");return file;},_addPostReviewModalEventListeners:function(){var analyticsClose=$YPCA('.jsClosePostReviewModal').data('analytics-close');$YPCA('.jsContactGeneralModal').on('click','.jsUnconfirmedEmail',function(e){e.preventDefault();var url=$YPCA(this).attr('href');YP.User.sendUnconfirmedEmail(url,function(){$YPCA('.jsContactGeneralModal').modal('hide');});});$YPCA('.jsContactGeneralModal').on('hidden.bs.modal',function(){if(review.refreshAfterClosingModal){location.reload();}});},_checkPrivateMode:function(){if(!YPCA.Utils.isLocalStorageNameSupported()){$YPCA('.jsReviewModalMessage').removeClass('hidden').html(review.settings.messageReviewValidation.privateMode.unsupported);review.settings.$btnSubmitWriteReview.prop('disabled',true);}},_checkSpaceOrEnterPressed:function(event){if(YP.Utils.isEnterKeyPressed(event)||YP.Utils.isSpaceKeyPressed(event)){review.publicFunctions.selectRating($YPCA(this));}},_checkEmailExistInYid:function(){var elem=$YPCA('.jsReviewEmail'),value=$YPCA.trim(elem.val());clearTimeout(review.keypressTimer);review.keypressTimer=setTimeout(function(){if(value!==''&&elem.valid()){YP.YidService.validateEmailFieldOnYID(value).done(function(data){var code=data.code;review.settings.isEmailExistInYid=false;$YPCA('.jsReviewAgreementContainer').removeClass('hidden');review._updateAnalyticsWithAccountCreated();if(code==='2'){review.settings.isEmailExistInYid=true;$YPCA('.jsReviewAgreementContainer').addClass('hidden');review._updateAnalyticsWithAccountCreated("No");}}).fail(function(){YP.Common.traceLog("cannot validate email on YID");});}},review.settings.constants.TIMEOUT_TIME);},_getConfig:function(){var $config=$YPCA('#engagement-resource'),hasConfig=$config.length>0;if(hasConfig){review.engagement.settings=$YPCA.extend(review.engagement.settings,JSON.parse($config.html()));}},_getReviewModalConfig:function(){var $config=$YPCA('.jsWriteReviewModalConfig');review.settings=$YPCA.extend(review.settings,JSON.parse($config.html()));},_fetchDropdownTemplate:function(){review.templateHandlebars=Handlebars.compile($YPCA('.jsProjectSubTypeDropdownTemplate').html());$YPCA('.jsProjectSubTypeDropdown').html(review.templateHandlebars(''));},_formReviewsAddValidationMethods:function(){$YPCA.validator.addMethod("nbStars",function(value,element,param){var starNumber=$YPCA('.jsGlobalRatingContainer .jsStarsRate .active').length,commentsLength=$YPCA('.jsReviewComment').val().length,showOneTwoStarError=!(0<starNumber&&starNumber<=param&&commentsLength<review.settings.constants.MIN_CHARS_REVIEW);return showOneTwoStarError;});},_populateSubCategoryDropdown:function(){if(this.value!==''){$YPCA.ajax({type:"GET",url:$YPCA(this).data('url'),data:'category='+encodeURIComponent(this.value),success:function(data){if(YP.Utils.isDefined(data)&&data.typeOfWork.length>0){$YPCA('.jsProjectSubTypeDropdown').html(review.templateHandlebars(data));$YPCA('.jsProjectSubTypeDropdown select').prop('disabled',false);}},error:function(){YP.Common.traceLog('error loading sub categories');}});}else{$YPCA('.jsProjectSubTypeDropdown select').val('').attr('selected',true);$YPCA('.jsProjectSubTypeDropdown select').prop('disabled',true);}},_overwriteSettings:function(elem){review.settings.reviewBody=elem.find('.jsUserReviewBody').text();review.settings.reviewTitle=elem.find('.jsUserReviewTitle').text();review.settings.nbStarsFood=elem.find('.jsUserAdditionalRating[data-type="food"]').data('rating');review.settings.nbStarsAtmosphere=elem.find('.jsUserAdditionalRating[data-type="atmosphere"]').data('rating');review.settings.nbStarsService=elem.find('.jsUserAdditionalRating[data-type="service"]').data('rating');review.settings.nbStars=elem.data('rating');review.settings.reviewId=elem.data('reviewid');review.imageUrl=[];for(var i=0;i<elem.find('.jsRatingImage').length;i++){var img=elem.find('.jsRatingImage')[i];review.imageUrl.push(img.getAttribute('data-imgurl'));}},_overwriteImages:function(elem){review.imageUrl=[];for(var i=0;i<elem.find('.jsRatingImage').length;i++){var img=elem.find('.jsRatingImage')[i];review.imageUrl.push(img.getAttribute('data-imgurl'));}},_preSubmitReview:function(){YP.Yid.loginForRating(function(loginStatus){review.publicFunctions.submitReview(loginStatus);},'REVIEW');},_removeRatingListeners:function(){$YPCA(document).off('mouseover','.ypRateControl span').off('mouseleave','.ypRate .ypRateControl');$YPCA('.reviewHead, .jsYpNoReviews').off('click');$YPCA('.ypRate .ypRateControl span').off('click').find('em').hide();},_removeEventListeners:function(){$YPCA('.jsStarsRate').off('click');$YPCA('.jsWriteReviewForm').off('click','.jsCancelWriteReview');$YPCA('.jsWriteReviewForm').off('click','.jsStarReview');$YPCA('.jsWriteReviewForm').off('keypress','.jsStarReview');$YPCA('.jsWriteReviewForm').off('keyup blur','.jsReviewEmail');$YPCA(document).off('User/LogIn');$YPCA('.jsSubmitWriteReview').off('click');},_setReviewLocally:function(){var request={merchantId:review.settings.merchantId,overallRating:$YPCA('#ypInput_overallRatingAlt .jsStarReview.active').length,reviewText:$YPCA('.jsReviewComment').val(),reviewTitle:$YPCA('.jsReviewTitleTextfield').val(),atmosphereRating:$YPCA('#ypInput_atmosphere .jsStarReview.active').length,foodRating:$YPCA('#ypInput_food .jsStarReview.active').length,serviceRating:$YPCA('#ypInput_service .jsStarReview.active').length,category:$YPCA('.jsProjectTypeDropdown').val(),subCategory:$YPCA('.jsProjectSubTypeDropdown select').val(),price:$YPCA('.jsProjectPrice').val(),isRatingOnly:$YPCA('.jsReviewComment').val()===''};request.reviewUrl=review.settings.action==='edit'?review.settings.editreviewurl:review.engagement.settings.reviewsUrl;if(YP.Utils.isDefined(review.settings.reviewId)&&review.settings.reviewId!==''){request.reviewId=review.settings.reviewId;}
YPCA.Utils.storageAPI.set('session','reviewInfo',request);},_submitReviewShort:function(request,successCallback,errorCallback){if((!$YPCA('#ownerbox').is(':checked')&&review.imageChanged&&review.imageFiles.length>0)&&review.loginTriggered===false){$YPCA('.errterms').show();$YPCA('.jsSubmitWriteReview').prop('disabled',false);setTimeout(function(){$YPCA('.errterms').fadeTo(1000,0,function(){$YPCA('.errterms').hide();});},3500);}else{$YPCA('.progressbar').show();if(review.imageFiles.length>0){review.defaultRequest.imageTokens=[];for(var i=0;i<review.imageFiles.length;i++){review._getTokens(review.imageFiles[i],successCallback,errorCallback,request);}}else{review._submitReview(request,successCallback,errorCallback);}}},_submitReview:function(request,successCallback,errorCallback){if(YP.Utils.isDefined(request.reviewUrl)){var reviewUrl=request.reviewUrl;var reviewRequest=$YPCA.extend(review.defaultRequest,request);if(reviewRequest.overallRating!==0){$YPCA.ajax({url:reviewUrl,data:JSON.stringify(reviewRequest),contentType:'application/json',type:'POST',error:errorCallback,progress:function(e){var pct=100;if(e.total){pct=(e.loaded/e.total)*100;if(pct>100){pct=100;}}
$YPCA('.progressbar div').css('width',pct+'%').delay(200);$YPCA('.progressbar').fadeOut(1500);},success:successCallback});}else{$YPCA('.jsSubmitWriteReview').prop('disabled',false);$YPCA('.jsGlobalRatingContainer').addClass('error');}
YPCA.Utils.storageAPI.set('session','reviewInfo',null);}},_getTokens:function(file,successCallback,errorCallback,request){var elem=$YPCA(this);var fd=new FormData();fd.append("file",file);$YPCA.ajax({url:'/ajax/merchant/ratingImageUpload/'+review.settings.merchantId,type:"POST",data:fd,processData:false,contentType:false}).done(function(data){if(data!==null&&data!==""&&isNaN(data)){review.defaultRequest.imageTokens.push(data);if(review.defaultRequest.imageTokens.length===review.imageFiles.length){review._submitReview(request,successCallback,errorCallback);}}else{errorCallback;$YPCA('.jsReviewModalMessage').removeClass('hidden').html(review.settings.messageReviewValidation.signup.error);$YPCA('.progressbar').fadeOut(1500);}}).fail(function(){errorCallback;$YPCA('.jsReviewModalMessage').removeClass('hidden').html(review.settings.messageReviewValidation.signup.error);$YPCA('.progressbar').fadeOut(1500);});},_triggerAnalytics:function(analyticsType){var clickAnalytics=review.settings.action==='edit'?review.settings.analytics.modify:review.settings.analytics.write;YPCA.Analytics.clicks($YPCA('.jsSubmitWriteReview'),clickAnalytics[analyticsType]);},_updateAnalyticsWithAccountCreated:function(forceValue){var defaultValue=$YPCA('.jsReviewAgreementCheckbox').is(':checked')?"Yes":"No";try{review.settings.analytics.write.intent["account_created"]=forceValue?forceValue:defaultValue;}catch(e){YP.Common.traceLog('no analytics founded for Review Submit Button Success');}},_addAccountCreatedToAnalytics:function(){$YPCA('.jsReviewAgreementCheckbox').change(function(){review._updateAnalyticsWithAccountCreated();});},_hideTypeOfWOrkSection:function(){$YPCA('.jsTypeOfWOrkPrice').hide();},_getUserReview:function(data,params){var isAllowed=params.origin==='mp'||params.origin==='profile';if(YP.Utils.isDefined(YP.Reviews)){YP.Reviews.appendTopReview(data);}
if(review.publicFunctions.userHasReviewed()&&isAllowed){review.settings.action=params.action='edit';if($YPCA('.jsUserReviewWrapper').length>0){review._overwriteSettings($YPCA('.jsUserReviewWrapper:first'));}else{review._overwriteImages($YPCA('.jsUserReviewWrapper:first'));}}
if(review.publicFunctions.hasMerchantReplies()){$YPCA(document).trigger("Reviews/UserMerchantReplies");}else{review._checkImages(data);review.publicFunctions.displayWriteReviewModal(params,review._preWriteReviewModalDisplay(params,isAllowed),function(jqXHR,textStatus){YP.Common.traceLog("Request failed: "+textStatus);});}},_checkImages:function(data){if(review.imageUrl.length===0){var elem=$YPCA($YPCA.parseHTML(data));for(var i=0;i<elem.find('.jsRatingImage').length;i++){var img=elem.find('.jsRatingImage')[i];review.imageUrl.push(img.getAttribute('data-imgurl'));}}},_getUserReviewFavorite:function(data,params){var isAllowed=params.origin==='mp'||params.origin==='profile';if(YP.Utils.isDefined(YP.Reviews)){YP.Reviews.appendTopReview(data);}
var elem=jQuery.parseXML(data);if($YPCA(elem).find('.jsBtnWriteReview').length===0&&isAllowed){review.settings.action=params.action='edit';review._overwriteSettings($YPCA(elem).find('.jsUserReviewWrapper:first'));}
if(review.publicFunctions.hasMerchantReplies()){$YPCA(document).trigger("Reviews/UserMerchantReplies");}else{review.publicFunctions.displayWriteReviewModal(params,review._preWriteReviewModalDisplay(params,isAllowed),function(jqXHR,textStatus){YP.Common.traceLog("Request failed: "+textStatus);});}},_preWriteReviewModalDisplay:function(params,isAllowed){if(params.origin==='engagement'&&params.nbStars<3){$YPCA('.jsWarningLowRatingMessage').removeClass('hidden');}
if(review.publicFunctions.userHasReviewed()&&isAllowed){review._hideTypeOfWOrkSection();}},publicFunctions:{deleteReview:function(setting){return $YPCA.ajax({type:"POST",url:setting.url,data:JSON.stringify({sessionToken:setting.sessionToken,reviewId:setting.reviewId}),contentType:"application/json"});},displayWriteReviews:function(params){review.defaultRequest.merchantId=params.merchantId;review.settings.origin=params.origin;review.settings.action=params.action;review.settings.editreviewurl=params.editReviewAjaxUrl;review.settings.reviewId=params.reviewId;YP.Yid.loginForRating(function(){review.publicFunctions.getUserReview({url:params.userReviewAjaxUrl}).done(function(data){review._getUserReview(data,params);}).fail(function(jqXHR,textStatus){YP.Common.traceLog("Request failed: "+textStatus);});},'REVIEW');},displayWriteReviewsFavorite:function(params){review.defaultRequest.merchantId=params.merchantId;review.settings.origin=params.origin;review.settings.action=params.action;review.settings.editreviewurl=params.editReviewAjaxUrl;review.settings.reviewId=params.reviewId;YP.Yid.loginForRating(function(){review.publicFunctions.getUserReview({url:params.userReviewAjaxUrl}).done(function(data){review._getUserReviewFavorite(data,params);}).fail(function(jqXHR,textStatus){YP.Common.traceLog("Request failed: "+textStatus);});},'REVIEW');},displayWriteReviewModal:function(settings,callback,errorCallback){review.settings.origin=settings.origin;review.settings.action=settings.action;review.settings.editreviewurl=settings.editReviewAjaxUrl;$YPCA.ajax({url:settings.writeReviewAjaxUrl,type:'get',dataType:'html'}).done(function(data){review.settings.$writeReviewModal.html('');if(review.settings.$writeReviewModal.html()===''){review.settings.$writeReviewModal.html(data);review._getReviewModalConfig();review._fetchDropdownTemplate();review._addAccountCreatedToAnalytics();review.settings.$btnSubmitWriteReview=$YPCA('.jsSubmitWriteReview');review.publicFunctions.initWriteReview(settings);review.publicFunctions.formReviewsValidation();review.settings.$writeReviewModal.find('.modal').modal({show:true});$YPCA('.jsCounter').text($YPCA('.jsCounter').attr('data-maxlength')-$YPCA('.jsReviewComment').val().length);$YPCA('.ReviewImageNo').remove();review.imageUrl.forEach(function(img,j){if(j<3){review._getDataURI(img,function(dataUri){review.imageFilesData.push(dataUri);review.imageFiles.push(review._dataURItoFile(dataUri));if(YP.Utils.isDeviceDesktop()){$YPCA('.jsAddReviewImage').before('<div class="ReviewImageNo"><span class="jsYpDelete ypdelete ypicon"></span><img src="'+dataUri+'"></div>');}else{$YPCA('.jsAddReviewImage').before('<div class="ReviewImageNo"><span class="jsYpDelete tblypdelete ypicon"></span><img src="'+dataUri+'"></div>');}});}});$YPCA('.loader-lds').hide();YP.Modal.hideBackdrop();if(callback){callback();}}}).fail(function(jqXHR,textStatus){YP.Common.traceLog("Request failed: "+textStatus);if(errorCallback()){errorCallback();}});},displayPostWriteReview:function(params,callbackSuccess,callbackError){var url=params.url+'?rating='+params.ratings+'&type='+params.type+"&isOptOutPhoto="+params.isOptOutPhoto+"&isRatingOnly="+params.isRatingOnly;review.refreshAfterClosingModal=params.refreshAfterClosingModal;YP.Modal.show("#jsModalContainer",url,function(){review._addPostReviewModalEventListeners();if($YPCA('.modal-backdrop').length>1){$YPCA($YPCA('.modal-backdrop')[0]).remove();}
if(callbackSuccess){callbackSuccess();}});},formReviewsValidation:function(){var $form=$YPCA("#ypgWriteReviewForm"),$counter=$YPCA('.jsCounter'),$reviewText=$YPCA('.jsReviewComment'),counterMaxLength=$counter.data('maxlength'),$submitBtn=$YPCA('.jsSubmitWriteReview');var reviewFormValidate=$form.validate({rules:{reviewEmail:{email:true,emailValidationBasic:true,required:true},reviewComment:{nbStars:2},reviewTitle:{required:false}},messages:review.settings.messageReviewValidation,invalidHandler:function(event,validator){var errors=validator.numberOfInvalids();if(errors){review._triggerAnalytics('error');}},submitHandler:function(){var starNumber=$YPCA('.jsGlobalRatingContainer .jsStarReview.active').length,$emailField=$YPCA('.jsReviewEmail');$submitBtn.prop('disabled',true);$YPCA('.jsGlobalRatingContainer').removeClass('error');$YPCA('.jsReviewModalMessage').addClass('hidden');reviewFormValidate.resetForm();review.settings.isUserRegisteredLive=false;if(starNumber===0){$YPCA('.jsGlobalRatingContainer').addClass('error');$submitBtn.prop('disabled',false);review._triggerAnalytics('error');}else{if(YP.Yid.isAuthenticated()){review._setReviewLocally();review._preSubmitReview();}else{if(review.settings.isEmailExistInYid){var email=$emailField.val();review._setReviewLocally();review.loginTriggered=true;YP.Modal.show("#jsModalContainer","/ajax/user/signin");$YPCA(document).trigger('WriteReview/Login',{userEmail:email,alertMessage:review.settings.messageReviewValidation.lostReview});}else{if($YPCA('.jsReviewAgreementCheckbox').is(':checked')){YP.YidService.createPasswordlessUser($emailField.val()).done(function(){review.settings.isUserRegisteredLive=true;$emailField.prop('readonly',true);$YPCA('.jsReviewAgreementContainer').addClass('hidden');review._updateAnalyticsWithAccountCreated("No");review._setReviewLocally();}).fail(function(jqXHR,textStatus){$YPCA('.jsReviewModalMessage').removeClass('hidden').html(review.settings.messageReviewValidation.signup.error);$submitBtn.prop('disabled',false);YP.Common.traceLog("Request failed: "+textStatus);});}else{$YPCA('.jsReviewModalMessage').removeClass('hidden').html(review.settings.messageReviewValidation.checkbox.required);$submitBtn.prop('disabled',false);}}}}},onkeyup:function(elm){reviewFormValidate.resetForm();var nbCharLeft=counterMaxLength-$reviewText.val().length;$counter.html(nbCharLeft).toggleClass('noMoreChar',nbCharLeft===0);}});},getUserReview:function(setting){return $YPCA.ajax({type:"GET",url:setting.url,contentType:"application/json"});},hideWriteReviews:function(){review.settings.$writeReviewModal.find('.modal').modal('hide');review.settings.$writeReviewModal.on('hidden.bs.modal',function(){review.settings.$writeReviewModal.html('');});},initWriteReview:function(params){review.defaultRequest.imageTokens=[];review.imageFiles=[];review.imageFilesData=[];review.loginTriggered=false;var oParams={nbStars:review.settings.nbStars?review.settings.nbStars:params.nbStars,nbStarsAtmosphere:review.settings.nbStarsAtmosphere?review.settings.nbStarsAtmosphere:params.nbStarsAtmosphere,nbStarsFood:review.settings.nbStarsFood?review.settings.nbStarsFood:params.nbStarsFood,nbStarsService:review.settings.nbStarsService?review.settings.nbStarsService:params.nbStarsService,reviewTitle:params.reviewTitle?params.reviewTitle:review.settings.reviewTitle,reviewEmail:params.email,reviewBody:params.reviewBody?params.reviewBody:review.settings.reviewBody};review.settings.$ratingStarsContainer=$YPCA('.jsWriteReviewForm .jsStarsRate');review._addEventListeners();$YPCA('.jsWriteReviewForm .jsStarsRate span:lt('+oParams.nbStars+')').addClass('active clicked');$YPCA('.jsGlobalRatingContainer .jsStarsRate + em').text($YPCA('#ypInput_overallRatingAlt .active:last').attr('title'));if(oParams.nbStars>2){$YPCA('.jsOptionalComment').removeClass('hidden');}
if(oParams.nbStarsAtmosphere){$YPCA('.jsRatingOptionAtmosphere .jsStarReview:lt('+oParams.nbStarsAtmosphere+')').addClass('active clicked');$YPCA('.jsRatingOptionAtmosphere .jsStarReview + em').text($YPCA('.jsRatingOptionAtmosphere .jsStarReview.active:last').attr('title'));}
if(oParams.nbStarsFood){$YPCA('.jsRatingOptionFood .jsStarReview:lt('+oParams.nbStarsFood+')').addClass('active clicked');$YPCA('.jsRatingOptionFood .jsStarReview + em').text($YPCA('.jsRatingOptionFood .jsStarReview.active:last').attr('title'));}
if(oParams.nbStarsService){$YPCA('.jsRatingOptionService .jsStarReview:lt('+oParams.nbStarsService+')').addClass('active clicked');$YPCA('.jsRatingOptionService .jsStarReview + em').text($YPCA('.jsRatingOptionService .jsStarReview.active:last').attr('title'));}
if(review.settings.action==='edit'){$YPCA('.jsReviewTitleTextfield').val(oParams.reviewTitle);$YPCA('.jsReviewComment').val(oParams.reviewBody);}else if(review.settings.action==='write'){$YPCA('#reviewEmail').val(oParams.reviewEmail);review._checkEmailExistInYid();}
review._formReviewsAddValidationMethods();review._checkPrivateMode();},loginAndSubmitReview:function(request,successCallback,errorCallback){YP.Yid.loginForRating(function(loginStatus){request.sessionToken=loginStatus.sessionToken;if(YP.Utils.isDefined(YP.Reviews)){YP.Reviews.getUserReviewStatus(review.merchantId,function(){if(review.settings.action==='edit'){review._overwriteSettings($YPCA('.jsUserReviewWrapper'));request.reviewUrl=review.settings.editreviewurl;}else{request.reviewUrl="/ajax/reviews/postreview";}
review._submitReviewShort(request,successCallback,errorCallback);});}else{review._submitReviewShort(request,successCallback,errorCallback);}});},hasMerchantReplies:function(){return $YPCA('.jsUserReviewWrapper[data-editable="false"]').length>0;},removeEventOnStars:function(){$YPCA('#ypInput_overallRating .jsStarReview').addClass('noHover');$YPCA('#ypInput_overallRating').addClass('noHover').data('rating','rating'+$YPCA("#ypInput_overallRating .active").length);},selectRating:function($element){return YP.Stars.selectRating($element);},submitReview:function(loginStatus){var request={sessionToken:loginStatus.sessionToken};if(YPCA.Utils.storageAPI.get('session','reviewInfo')!==null){request=$YPCA.extend(request,JSON.parse(YPCA.Utils.storageAPI.get('session','reviewInfo')));}
review._triggerAnalytics('intent');YP.ReviewService.loginAndSubmitReview(request,function(data){review.settings.$writeReviewModal.off('hidden');review._removeRatingListeners();review._activeRightNbStars();review.publicFunctions.removeEventOnStars();$YPCA('.jsSubmitWriteReview').prop('disabled',false);$YPCA(document).trigger("Reviews/PostReviewCallback",{$btnSubmit:review.settings.$btnSubmitWriteReview,origin:review.settings.origin,data:data,overallRating:request.overallRating,merchantId:request.merchantId,reviewText:request.reviewText,priceAmount:request.price,workType:request.category+','+request.subCategory,isUserRegisteredLive:review.settings.isUserRegisteredLive,analyticsData:review.settings.action==='edit'?review.settings.analytics.modify:review.settings.analytics.write,isRatingOnly:request.isRatingOnly});},function(){review._triggerAnalytics('error');});},userHasReviewed:function(){return $YPCA('.jsBtnWriteReview').length===0;}}};$YPCA(function(){review._init();});return review.publicFunctions;})($YPCA);
'use strict';var YP=window.YP||{};YP.Reviews=(function($YPCA,window,document){const modalContainerElement=$YPCA('#jsModalContainer');const ypNoReviewsElements=$YPCA('.jsYpNoReviews');const $paginationWrapper=$YPCA('.jsPaginationWrapper');var reviewSortBy="submissionTime:desc",selectedLang='all',moreAjaxLoading=true,reviews={constants:{BAD_REQUEST:400,CALLBACK_MODAL_TIMEOUT:2000,MIN_CHARS_REVIEW:20,YP_REVIEWS_PAGINATION_NB_BTN:4},settings:{},cacheElement:{$reviewsSection:$YPCA('.module.reviews')},taReviewHeader:YP.Utils.urlParamHash('#')==="taReviewsHeader",ypTabActive:$YPCA(".reviewTab_yp").hasClass('active'),taTabActive:$YPCA(".reviewTab_ta").hasClass('active'),bkTabActive:$YPCA(".reviewTab_bk").hasClass('active'),taHasReviews:false,$reviewsTop:$YPCA('.jsReviewsTop'),$paginationWrapper:$YPCA('.jsPaginationWrapper'),analyticNum:null,maxPagesReview:$paginationWrapper.data('max-pages')||1,writeReviewTop:null,user:{sessionToken:''},_init:function(){var $config=$YPCA('#reviews-config');if($config.length>0){reviews.settings={$writeReviewModal:modalContainerElement,$replyReviewModal:modalContainerElement,$deleteReviewModal:modalContainerElement};reviews.settings=$YPCA.extend(reviews.settings,JSON.parse($config.html()));reviews._addRatingListeners();reviews._addListeners();reviews._checkTabActiveReviews();reviews._showWriteReview();reviews._checkHashParams();}},_resetWriteTop:function(){reviews.writeReviewTop=false;},_removeBtnWriteReview:function(){$YPCA('.jsBtnWriteReview').remove();},_removeQueryStrings:function(){var cleanedUrl=YP.Utils.removeParams(['rating','action','r','ratingA','ratingF','ratingS','email'],window.location.href);history.pushState({},null,cleanedUrl);},_appendTopReview:function(data,callback){reviews.$reviewsTop.nextAll().remove();reviews.$reviewsTop.after(data);if($YPCA('#ypInput_overallRating').data('rating')!=='rating0'){YP.ReviewService.removeEventOnStars();}
if(callback){callback();}},_showRatesActions:function(){if($YPCA('.jsBtnWriteReview').length===0){$YPCA('.jsStarsContainer').remove();}},_displayReplyReview:function($elem){reviews.analyticNum=$elem.data('num');$YPCA(document).on('loaded',reviews.settings.$replyReviewModal,YP.Reviews.formReplyReviewValidation);},submitReplyReview:function(){var replyReview={qa:[]};$YPCA('#ypgReplyReviewForm .input-sm').each(function(){var answer={"comment":$YPCA(this).val()};replyReview.qa.push(reviews._createJson($YPCA(this).data('q'),answer));});$YPCA.ajax({type:"POST",url:$YPCA('#ypgReplyReviewForm').data('href'),data:JSON.stringify(replyReview),contentType:"application/json",success:function(jqXHR){if(jqXHR.code==="0"){$YPCA('#ypgReplyReviewOverlay .responseMessage').html(YP.Common.getMessage("modal.review.reply.submit.ok"));$YPCA('#ypgReplyReviewOverlay .modal-body').removeClass('success error').addClass('success');var successAnalytic=JSON.parse($YPCA('.jsResponseAnalytic').attr('data-analytic-success'));successAnalytic.lk_pos_num=reviews.analyticNum;YPCA.Analytics.clicks($YPCA('.jsResponseAnalytic'),successAnalytic);}else{$YPCA('#ypgReplyReviewOverlay .responseMessage').html(YP.Common.getMessage("modal.review.reply.submit.error"));$YPCA('#ypgReplyReviewOverlay .modal-body').removeClass('success error').addClass('error');}},error:function(){$YPCA('#ypgReplyReviewOverlay .modal-body').removeClass('success error').addClass('error');$YPCA('#ypgReplyReviewOverlay .responseMessage').html(YP.Common.getMessage("modal.review.reply.submit.error"));}});},_createJson:function(q,a){return{"q":q,"a":a};},_showRightYIDMessage:function(className,optionalMsg){var $reviewSection=$YPCA('#reviewPreview'),message=optionalMsg?optionalMsg:$reviewSection.data(className);if(!$reviewSection.hasClass(className)){var elem='<div class="ypalert ypalert--'+className+' jsMerchantReviewed">'+message+"</div>";$reviewSection.addClass(className).prepend(elem);reviews._showReviewErrorModal(elem);}},_showReviewErrorModal:function(elem){if($YPCA("#ypAlertReview").length>0){$YPCA(".jsAlertReviewContent").prepend(elem);$YPCA("#ypAlertReview").modal('show');$YPCA('#ypAlertReview').on('hidden.bs.modal',function(){location.reload();});}},_showErrorYIDMessage:function(msg){if($YPCA('.jsWriteReviewOverlay').is(':visible')){$YPCA('.jsReviewModalMessage').removeClass('hidden').html(msg);}else{reviews._showRightYIDMessage('error',msg);}},_postToFacebook:function(){if($YPCA('#ypgPostToFacebook').is(':checked')){YP.SocialNetworks.publishToFacebook(reviews.settings.canonicalUrl,$YPCA('#ypInput_comment').val());}},_displayMoreReviews:function(feeder){if(YPCA.Utils.isDefined(feeder)){$YPCA('.jsReviewsWrap').removeClass('show');$YPCA('#reviewDetails_'+feeder).addClass('show');$YPCA('.reviewTabs li').removeClass('active');$YPCA('li.reviewTab_'+feeder).addClass('active');}},_showOneTypeReview:function(type){if(!reviews[type+'HasReviews']&&$YPCA('.reviewTab_'+type).length!==0&&!reviews[type+'TabActive']){reviews.getMoreReviews(1,true,'reviewDetails_'+type,false);reviews[type+'HasReviews']=true;}},_showAllReview:function(){reviews.cacheElement.$reviewsSection.removeClass('previewMode');},_createTmpPagination:function(page,specialClass){var newClass=YP.Utils.isDefined(specialClass)?' '+specialClass:'';return'<li class="yp-pagination__item jsReviewItem reviewItem_'+page+'"><a href="javascript:void(0);" data-page="'+page+'" data-sortBy="" class="jsPagerReview ypgGotoReview'+newClass+'">'+page+'</a></li>';},gotoReviewPage:function($event,page,reviewSortByThis,language,languageSwitch){var currentSection=$event.closest('section').attr('id'),$reviewContainer=$YPCA('#'+currentSection+' .jsReviewsList'),$reviewPages=$YPCA('#'+currentSection+' .jsNbResults'),countPages=$reviewPages.length,currentPage=YP.Utils.isDefined($reviewPages.filter(':visible').data('page'))?$reviewPages.filter(':visible').data('page'):0,newQuery=false;if(reviewSortByThis!==''&&(reviewSortBy!==reviewSortByThis||selectedLang!==language)){$YPCA('#'+currentSection).remove('.reviewPages');reviewSortBy=reviewSortByThis;selectedLang=language;countPages=1;newQuery=true;}
if(page==='prev'){page=((currentPage-1)<=0?currentPage=1:currentPage-1);}else if(page==='next'){if(currentPage+1>reviews.maxPagesReview){currentPage=reviews.maxPagesReview;}else{currentPage=currentPage+1;}
page=currentPage;}
if(page>=1&&page<=reviews.maxPagesReview&&moreAjaxLoading){$reviewPages.hide();if(page>countPages||newQuery){moreAjaxLoading=false;if(newQuery){$reviewContainer.html('');}
reviews.getMoreReviews(page,newQuery,currentSection,languageSwitch);if(newQuery){$reviewPages.hide();$YPCA('#'+currentSection+' .reviewItem').show();var reviewItemCount=$YPCA('#'+currentSection+' .jsReviewItem').length;for(var i=reviewItemCount;i>reviews.constants.YP_REVIEWS_PAGINATION_NB_BTN;i--){$YPCA('#'+currentSection+' .reviewItem_'+i).remove();}}else{if($YPCA('#'+currentSection+' .reviewItem_'+page).length===0){var newReviewItem=reviews._createTmpPagination(page);$YPCA('#'+currentSection+' .reviewItem_'+(page-reviews.constants.YP_REVIEWS_PAGINATION_NB_BTN)).hide();$YPCA('#'+currentSection+' li.next').before(newReviewItem);}}}else{var $paginationVisible=$YPCA('#'+currentSection+' .jsReviewItem:visible');if($paginationVisible.length===reviews.constants.YP_REVIEWS_PAGINATION_NB_BTN){if(page>($YPCA('#'+currentSection+' .jsReviewItem').index($paginationVisible.eq(reviews.constants.YP_REVIEWS_PAGINATION_NB_BTN-1))+1)){$paginationVisible.eq(0).hide();}
if(page<($YPCA('#'+currentSection+' .jsReviewItem').index($paginationVisible.eq(0))+1)){$paginationVisible.eq(reviews.constants.YP_REVIEWS_PAGINATION_NB_BTN-1).hide();}
$YPCA('#'+currentSection+' .reviewItem_'+page).removeAttr('style');}}
$reviewPages.eq(page-1).show();$YPCA('#'+currentSection+' .jsReviewItem a').removeClass('active');$YPCA('#'+currentSection+' .reviewItem_'+page+' a').addClass('active');YP.Utils.scrollPage($YPCA('.jsReviewsNav'));reviews._togglePrevNextBtn(page,reviews.maxPagesReview);}},_togglePrevNextBtn:function(posPage,lastPage){$YPCA('.jsReviewsWrap:visible .jsPaginationPrev').toggleClass('hidden',posPage===1);$YPCA('.jsReviewsWrap:visible .jsPaginationNext').toggleClass('hidden',posPage===lastPage);},toggleLoadingVisuel:function(show){reviews.cacheElement.$reviewsSection.toggleClass('loading',show);},getReadReviewsAjaxUrl:function(currentSection,pageSize,page){var getThisQuery=null;if(currentSection==='reviewDetails_yp'&&YP.Utils.isDefined(pageSize)&&YP.Utils.isDefined(page)){getThisQuery=reviews.settings.readReviewsAjaxUrls.yellowPages+'&pageNumber='+page+'&pageSize='+pageSize+'&sort='+reviewSortBy+'&languageId='+selectedLang;}
else if(currentSection==='reviewDetails_ta'){getThisQuery=reviews.settings.readReviewsAjaxUrls.trip_advisor;}
return getThisQuery;},_resetPagination:function(nbResults,currentSection){$YPCA('.jsReviewItem').remove();$YPCA('.jsReviewsWrap:visible .jsReviewItem').remove();var maxPages=Math.ceil(nbResults/5),nbBtnPagination=maxPages>reviews.constants.YP_REVIEWS_PAGINATION_NB_BTN?reviews.constants.YP_REVIEWS_PAGINATION_NB_BTN:maxPages,html='';for(var i=0;i!==nbBtnPagination;i++){html+=reviews._createTmpPagination(i+1,i===0?'active':'');}
$YPCA('#'+currentSection+' .jsPaginationNext').before(html);},getMoreReviews:function(page,newQuery,currentSection,languageSwitch){var pageSize=newQuery?20:5,getThisQuery=reviews.getReadReviewsAjaxUrl(currentSection,pageSize,page);if(getThisQuery){reviews.toggleLoadingVisuel(true);$YPCA.ajax({url:getThisQuery,type:'get',dataType:'html',success:function(data){$YPCA('#'+currentSection+' .jsReviewsList').append(data);moreAjaxLoading=true;reviews.toggleLoadingVisuel(false);if(languageSwitch&&$YPCA('.jsNbResults').length!==0){var nbResults=$YPCA('.jsNbResults').data('nb-results');reviews.settings.reviewsTotal[currentSection]=nbResults;reviews._resetPagination(nbResults,currentSection);reviews._togglePrevNextBtn(1,reviews.maxPagesReview);}
reviews._refreshReviewCount();},error:function(){reviews.toggleLoadingVisuel(false);var $dropDown=$YPCA('.jsErrorTimeout'),errorHtml='<div class="alert error">'+$dropDown.data('timeout')+'</div>';$YPCA('#'+currentSection+' .reviews-content.reviewList').append(errorHtml);$YPCA('.reviews-pagination.reviewNav').hide();}});}},sortReviews:function($select,currentSection,language,languageSwitch){var reviewSortByThis=$select.val();$YPCA('#'+currentSection+' .jsSortReviews').val(reviewSortByThis);reviews.gotoReviewPage($YPCA('.jsSortReviews'),1,reviewSortByThis,language,languageSwitch);},_refreshReviewCount:function(){if($YPCA('.jsReviewCountRefreshed:first').length>0){$YPCA('.jsYPReviewCount').text($YPCA('.jsReviewCountRefreshed:first').text());}},_addRatingListeners:function(){$YPCA(document).one('click','.jsShowAllReviews',function(e){e.preventDefault();reviews._showAllReview();});$YPCA(document).on('click','.jsScrollToYpReview',function(e){if(!$YPCA('.jsYpReviewTab').parent().hasClass('active')){$YPCA('.jsYpReviewTab').trigger('click');}});$YPCA(document).on("hidden.bs.modal","#ypgWriteReviewOverlay",function(){reviews._removeQueryStrings();});$YPCA(document).on('click','.reviewTabs li:not(.reviewTab_yp) a',function(e){e.preventDefault();reviews._showOneTypeReview($YPCA(this).data('feeder'));});$YPCA(document).on('click','#ypInput_overallRating .jsStarReview:not(.noHover), .jsStarsContainer .jsStarReview:not(.noHover)',function(){var $self=$YPCA(this);YP.Merchant.goToByScroll('#ypgReviewsHeader');$YPCA('.jsGlobalRatingContainer').removeClass('error');YP.Stars.selectRating($self);var nbStars=$self.prevAll().andSelf().length;YP.ReviewService.displayWriteReviewModal({nbStars:nbStars,editReviewAjaxUrl:reviews.settings.editReviewAjaxUrl,writeReviewAjaxUrl:reviews.settings.writeReviewAjaxUrl,userReviewAjaxUrl:reviews.settings.userReviewAjaxUrl,merchantId:reviews.settings.merchantId,origin:'mp',action:'write'});});$YPCA(document).on('Reviews/PostReviewCallback',function(event,params){if(params.origin==='mp'){var result=params.data;reviews._removeBtnWriteReview();reviews._removeQueryStrings();if(result.httpStatusCode===YP_COMMON.HTTP_STATUS_CODE.SUCCESS){params.analyticsData.success.price_amount=params.priceAmount;params.analyticsData.success.work_type=params.workType;YPCA.Analytics.clicks(params.$btnSubmit,params.analyticsData.success);reviews._postCallbackReviewSuccess({isUserRegisteredLive:params.isUserRegisteredLive,reviewText:params.reviewText,result:result,overallRating:params.overallRating,isRatingOnly:params.isRatingOnly});}else{reviews._showErrorYIDMessage(result.errorMessage);YPCA.Analytics.clicks(params.$btnSubmit,params.analyticsData.error);$YPCA('.jsSubmitWriteReview').prop('disabled',true);}
reviews._resetWriteTop();}});$YPCA(document).on('Reviews/UserMerchantReplies',function(event,params){reviews._showRightYIDMessage('error',reviews.settings.editReview.messages.hasMerchantReply);});},_showWriteReview:function(){if(YP.Utils.urlParamHash('#')==='writeReview'){$YPCA('.jsBusinessDetailsContainer .jsWriteReview').trigger('click');}},_postCallbackReviewSuccess:function(data){var analyticsTypeReviewSubmit='';YP.ReviewService.hideWriteReviews();reviews._postToFacebook();reviews._showRatesActions();if(reviews.writeReviewTop){analyticsTypeReviewSubmit=data.reviewText.length>0?'writereview-confirm-rateAndReview_top_bar':'writereview-confirm-rateOnly_top_bar';}else{analyticsTypeReviewSubmit=data.reviewText.length>0?'writereview-confirm-rateAndReview':'writereview-confirm-rateOnly';}
YP.Analytics.callReviewAnalytic(analyticsTypeReviewSubmit);var userCookiesInfo=YP.User.getUserCookiesInfo();if(userCookiesInfo&&userCookiesInfo.u){var urlEmail='/yid/v1.0/user/'+userCookiesInfo.u+'/email';$YPCA.ajax({type:"get",url:urlEmail});}
if(data.isUserRegisteredLive&&data.overallRating<4){YP.Modal.show("#jsModalContainer",'/ajax/user/pwResetAndConfirm');YP.Modal.hideBackdrop();}else{YP.ReviewService.displayPostWriteReview({url:reviews.settings.postReviewPromotionAjaxUrl,ratings:data.overallRating,type:'success',refreshAfterClosingModal:false,isOptOutPhoto:reviews.settings.isOptedOutOfImages,isRatingOnly:data.isRatingOnly},function(){YPCA.Analytics.resendCurrentPageView();});}},_addListeners:function(){const reviewListElements=$YPCA('.jsReviewsList');const divReviewElements=$YPCA('div.reviews');const ypgBodyElement=$YPCA('#ypgBody');divReviewElements.on('click','.jsReplyResponse',function(e){e.preventDefault();reviews._displayReplyReview($YPCA(this));});ypNoReviewsElements.on('click',function(e){e.preventDefault();var settings={nbStars:null,editReviewAjaxUrl:reviews.settings.editReviewAjaxUrl,userReviewAjaxUrl:reviews.settings.userReviewAjaxUrl,writeReviewAjaxUrl:reviews.settings.writeReviewAjaxUrl,merchantId:reviews.settings.merchantId,origin:'mp',action:'write'};if(YP.Yid.isAuthenticated()){YP.ReviewService.displayWriteReviews(settings);}else{YP.ReviewService.displayWriteReviewModal(settings);}});ypgBodyElement.on('click','.jsWriteReview',function(e,data){e.preventDefault();var isAuthenticated=YP.Yid.isAuthenticated(),settings={nbStars:data&&reviews._isRatingValid(data.rating)?data.rating:null,nbStarsAtmosphere:data&&reviews._isRatingValid(data.ratingAtmosphere)?data.ratingAtmosphere:null,nbStarsFood:data&&reviews._isRatingValid(data.ratingFood)?data.ratingFood:null,nbStarsService:data&&reviews._isRatingValid(data.ratingService)?data.ratingService:null,editReviewAjaxUrl:reviews.settings.editReviewAjaxUrl,writeReviewAjaxUrl:reviews.settings.writeReviewAjaxUrl,userReviewAjaxUrl:reviews.settings.userReviewAjaxUrl,merchantId:reviews.settings.merchantId,origin:'mp',action:'write',email:data&&!isAuthenticated?data.email:null};if(isAuthenticated){YP.ReviewService.displayWriteReviews(settings);}else{YP.ReviewService.displayWriteReviewModal(settings);}});ypgBodyElement.on('click','.jsWriteReviewBtnTop',function(){reviews.writeReviewTop=true;});$YPCA('.jsShowAllReviews').on('click',function(e){e.preventDefault();reviews._displayMoreReviews($YPCA(this).data('feeder'));});divReviewElements.on('click','.jsPagerReview',function(e){e.preventDefault();var $self=$YPCA(this);reviews.gotoReviewPage($self,$self.data('page'),($self.data('sortBy')||''),selectedLang,false);});$YPCA('.jsSortReviews').on('change',function(e){e.preventDefault();var self=$YPCA(this);reviews.sortReviews(self,self.data('currentselection'),selectedLang,false);});$YPCA('.jsSortByLang').on('change',function(e){e.preventDefault();var $self=$YPCA(this);reviews.gotoReviewPage($self,1,reviewSortBy,$self.val(),true);$YPCA('.jsReviewsDisclaimer').toggleClass('hidden',$self.val()!=='all');});$YPCA('#anchorAnimateTA').on("click",function(){$YPCA('html, body').animate({scrollTop:$YPCA('#reviewPreview').offset().top},1000);});modalContainerElement.on("click",'.jsStarReview',function(){const self=$YPCA(this);YPCA.Analytics.clicks(self,self.data('analytics-stars-modal'));});$YPCA('.jsStarsContainer').on("click",'.jsStarReview:not(".noHover")',function(){const self=$YPCA(this);YPCA.Analytics.clicks(self,self.data('analytics-stars-mp'));});reviewListElements.on("click",'.jsEditReview',function(){var elem=$YPCA(this);YP.Yid.login(function(loginStatus){reviews.user.sessionToken=loginStatus.sessionToken;reviews.settings.reviewId=elem.data('reviewid');YP.ReviewService.displayWriteReviews({reviewBody:elem.parents('.jsReviewContentParent').find('.jsReviewContentText').text(),reviewTitle:elem.parents('.jsReviewContentParent').find('.jsReviewTitle').text(),nbStarsFood:elem.parents('.jsReviewContentParent').find('.jsAdditionalRating[data-type="food"]').data('rating'),nbStarsAtmosphere:elem.parents('.jsReviewContentParent').find('.jsAdditionalRating[data-type="atmosphere"]').data('rating'),nbStarsService:elem.parents('.jsReviewContentParent').find('.jsAdditionalRating[data-type="service"]').data('rating'),nbStars:elem.data('overallrating'),writeReviewAjaxUrl:reviews.settings.writeReviewAjaxUrl,editReviewAjaxUrl:reviews.settings.editReviewAjaxUrl,userReviewAjaxUrl:reviews.settings.userReviewAjaxUrl,merchantId:reviews.settings.merchantId,reviewId:reviews.settings.reviewId,origin:'mp',action:'edit'});});});reviewListElements.on("click",'.jsDeleteReview',function(){var elem=$YPCA(this);YP.Yid.login(function(loginStatus){reviews.user.sessionToken=loginStatus.sessionToken;reviews.settings.reviewId=elem.data('reviewid');YP.Modal.show("#jsModalContainer",reviews.settings.deleteReviewModalAjaxUrl);});});reviews.settings.$deleteReviewModal.on("click",'.jsDeleteReviewConfirm',function(){const modelReviewDeleteElements=$YPCA('.jsModalReviewDelete');YP.ReviewService.deleteReview({url:reviews.settings.removeReviewAjaxUrl,sessionToken:reviews.user.sessionToken,reviewId:reviews.settings.reviewId}).done(function(data){modelReviewDeleteElements.modal('hide');if(data.httpStatusCode===YP_COMMON.HTTP_STATUS_CODE.SUCCESS){reviews._showRightYIDMessage('success',reviews.settings.removeReview.messages.success);$YPCA('.jsReviewItemBlock[data-reviewid="'+reviews.settings.reviewId+'"]').fadeOut(250);}else{reviews._showRightYIDMessage('error',data.errorMessage);}}).fail(function(){modelReviewDeleteElements.modal('hide');reviews._showRightYIDMessage('error',reviews.settings.removeReview.messages.fail);});YP.Merchant.goToByScroll('#ypgReviewsHeader');});$YPCA('.jsYPReview').on("click",'.jsReportInappropriate',function(){var elem=$YPCA(this);YP.Yid.login(function(loginStatus){$YPCA.when(YP.Modal.show('#jsModalContainer',elem.data('url')),$YPCA.Deferred(function(deferred){$YPCA(deferred.resolve);})).done(function(){YP.Modal.hideBackdrop();setTimeout(function(){YP.ReviewInappropriate.createInappropriateReview({sessionToken:loginStatus.sessionToken,reviewId:elem.data('reviewid'),responseId:elem.data('responseid')});},reviews.constants.CALLBACK_MODAL_TIMEOUT);});});});},_checkTabActiveReviews:function(){var defaultActiveTab=$YPCA('.jsReviewContainer').data('default-open-tab'),hashParamEmpty=YP.Utils.urlParamHash('#')!=='taReviewsHeader'&&YP.Utils.urlParamHash('#')!=='ypgReviewsHeader',isYpHashParam=YP.Utils.urlParamHash('#')==='ypgReviewsHeader'&&ypNoReviewsElements.length===0;if(!$YPCA('body').hasClass('expandMapList')){if(reviews.taTabActive){reviews.getMoreReviews(1,true,'reviewDetails_ta',false);}
if($YPCA('.reviewTab_yp').length>0&&isYpHashParam){YP.Merchant.goToByScroll('#ypgReviewsHeader');$YPCA('.reviewTab_yp a').trigger('click');}
if(reviews.taReviewHeader){YP.Merchant.goToByScroll('#ypgReviewsHeader');$YPCA('_ta a').trigger('click');}
if(reviews.bkTabActive&&hashParamEmpty){$YPCA('.reviewTab_bk a').trigger('click');}}
if((YP.Utils.isDefined(defaultActiveTab)&&defaultActiveTab!=='')&&hashParamEmpty){switch(defaultActiveTab){case'TRIPADVISOR':$YPCA('.reviewTab_ta a').trigger('click');break;case'BOOKENDA':$YPCA('.reviewTab_bk a').trigger('click');break;case'YP':$YPCA('.reviewTab_yp a').trigger('click');break;default:break;}}},_checkHashParams:function(){if(window.location.href.indexOf('reviewsPageNumber')!==-1){var currentPage=YP.Utils.urlParamHash('reviewsPageNumber');$YPCA('.jsPagerReview').removeClass('active').filter('[data-page="'+currentPage+'"]').addClass('active');}},_isRatingValid:function(ratingValue){return!isNaN(ratingValue)&&ratingValue>=0&&ratingValue<=5;},publicFunctions:{appendTopReview:function(data){reviews._appendTopReview(data);},formReplyReviewValidation:function(){$YPCA("#ypgReplyReviewForm").validate({rules:{business:{required:true},name:{required:true},phone:{required:true,phoneUS:true},email:{required:true,email:true},message:{required:true}},messages:{"business":{"required":YP.Common.getMessage("modal.review.reply.error.required")},"name":{"required":YP.Common.getMessage("modal.review.reply.error.required")},"phone":{"required":YP.Common.getMessage("modal.review.reply.error.required"),"phoneUS":YP.Common.getMessage("modal.review.reply.error.phone.validation")},"email":{"required":YP.Common.getMessage("modal.review.reply.error.required"),"email":YP.Common.getMessage("modal.review.reply.error.email.validation")},"message":{"required":YP.Common.getMessage("modal.review.reply.error.required")}},submitHandler:function(){reviews.submitReplyReview();}});},getUserReviewStatus:function(mid,callback,errorCallback){YP.ReviewService.getUserReview({url:reviews.settings.userReviewAjaxUrl}).done(function(data){reviews._appendTopReview(data,callback);}).fail(function(jqXHR,textStatus){YP.Common.traceLog("Request failed: "+textStatus);errorCallback();});}}};$YPCA(function(){reviews._init();});return reviews.publicFunctions;})($YPCA,window,document);

(function($,window,undefined){var hasOnProgress=("onprogress"in $.ajaxSettings.xhr());if(!hasOnProgress){return;}
var oldXHR=$.ajaxSettings.xhr;$.ajaxSettings.xhr=function(){var xhr=oldXHR.apply(this,arguments);if(xhr instanceof window.XMLHttpRequest){xhr.addEventListener('progress',this.progress,false);}
if(xhr.upload){xhr.upload.addEventListener('progress',this.progress,false);}
return xhr;};})(jQuery,window);
