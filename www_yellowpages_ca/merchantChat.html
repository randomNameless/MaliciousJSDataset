<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>merchantChat.html</title>
</head>
<body>

<script>
"use strict";YP.MerchantChat=(function($YPCA,window,document){const chatBoxMinimizedElements=$YPCA(".chat-box-minimized");const chatBoxInputMessageElements=$YPCA(".chat-box--input-message");const chatBoxIconElements=$YPCA(".chat-box-icon");const chatBoxPictureUploadElement=$YPCA("#chat-box--picture-upload");const chatBoxElements=$YPCA(".chat-box");const chatBoxInputSendButtonElements=$YPCA(".chat-box--input-send-button");const chatBoxInputSendButtonDisabledElements=$YPCA(".chat-box--input-send-button-disabled");const chatBoxPicturesElements=$YPCA(".chat-box--pictures");const chatBoxPicturesImgElements=$YPCA(".chat-box--pictures img");const modalContainerElement=$YPCA("#jsModalContainer");const merchantChatConfigElements=$YPCA(".jsMerchantChatConfig");const windowElement=$YPCA(window);const chatBoxMessagesElements=$YPCA(".chat-box--messages");const chatBoxDataPictureIdElement=$YPCA("[data-chat-box-picture-id]");const documentElement=$YPCA(document);const chatBoxCallCtaAnchor=$YPCA(".chat-box--call-cta a");var merchantChat={MERCHANT:null,PICTURES_LIMIT:5,PAGE_SIZE:50,CURRENT_LANGUAGE:"",TIMEOUT_TO_SEND_MESSAGE:300000,LABELS:null,chatMode:"",conversation:null,currentPage:1,hasMorePages:false,loadingMoreMessages:false,_init:function(){if(!YP.Utils.isDevicePhone()&&merchantChat._merchantAcceptMessages()){merchantChat._setCurrentLanguage();merchantChat._setLabels();merchantChat._setLabelPreLoadedElements();merchantChat.MERCHANT=merchantChat._getMerchantIdAndName();merchantChat._createInitialBinds();merchantChat._addMerchantNameToChatBox();if(YP.User.getUserInfo().authenticated){merchantChat._showOrHideSpinnerLoadingMessages();if(merchantChat._hasStoredMessageToBeSent()){merchantChat._sendStoredMessage();}
else{merchantChat._getConversation();}
merchantChat._cleanChatMode("merchantChat_ChatModeNotLogged");}
else{merchantChat._getResponseTimeAndPhoneNumber();merchantChat._cleanChatMode("merchantChat_ChatModeLogged");merchantChat._showOrHideWelcomeMessage();}
merchantChat._showChatBoxModeOfCurrentSession();if(merchantChat._isLowResolutionDevice()&&!merchantChat._isPageIsScrolledDown()){merchantChat._showChatBox("icon-only");merchantChat._openChatBoxAfterScrollDown();}}},_merchantAcceptMessages:function(){return($YPCA(".mlr__item.mlr__item--message.hide-print").length>0||$YPCA(".mlr__item.mlr__item--email.hide-print").length>0);},_createInitialBinds:function(){chatBoxMinimizedElements.on('click',function(){merchantChat._showChatBox("open");merchantChat._storeCurrentChatMode("open");});chatBoxIconElements.on('click',function(){merchantChat._showChatBox("open");merchantChat._storeCurrentChatMode("open");});$YPCA(".chat-box--btn-minimize").on('click',function(){merchantChat._showChatBox("minimize");merchantChat._storeCurrentChatMode("minimize");});$YPCA(".chat-box--btn-close").on('click',function(){merchantChat._showChatBox("icon-only");merchantChat._storeCurrentChatMode("minimize");});chatBoxCallCtaAnchor.on('click',merchantChat._openOrCloseBoxPhoneNumber);chatBoxPictureUploadElement.on('change',function(){if(chatBoxPictureUploadElement.val().length>0){merchantChat._uploadPicture();}
merchantChat._enableSendButton();});chatBoxInputMessageElements.on('change',function(){merchantChat._enableSendButton();});chatBoxInputMessageElements.on('keyup',function(){merchantChat._enableSendButton();});chatBoxInputMessageElements.on('keypress',function(e){if(e.which===13&&merchantChat._isThereMessageToBeSent()){merchantChat._showCaptchaSendMessageModal();}});chatBoxInputSendButtonElements.on('click',function(){if(merchantChat._isThereMessageToBeSent()){merchantChat._showCaptchaSendMessageModal();}});modalContainerElement.on('DOMSubtreeModified',function(){merchantChat._fixChatPositionAfterModal();});$YPCA($YPCA(".action-bar__user a")[0]).on("click",function(){merchantChat._fixChatPositionAfterSideMenu("opened");});$YPCA(".jsCloseUserMenu").on("click",function(){if($YPCA(this).hasClass("jsLogoutBtn")){merchantChat._showChatBox("close");}
else{merchantChat._fixChatPositionAfterSideMenu("closed");}});$YPCA(".jsOverlayContainer").on("click",function(){merchantChat._fixChatPositionAfterSideMenu("closed");});$YPCA(".mlr__item.mlr__item--message.hide-print").on("click",function(){merchantChat._showChatBox("icon-only");});window.onbeforeprint=function(){merchantChat._saveOrRestoreChatToPrint("save");};window.onafterprint=function(){merchantChat._saveOrRestoreChatToPrint("restore");};},_setCurrentLanguage:function(){merchantChat.CURRENT_LANGUAGE=YP.Utils.isEnglishSite()?"en":"fr";},_getLabel:function(label,index){var retrievedLabel=merchantChat.LABELS[label];if(index!==undefined){return retrievedLabel[index];}
else{return retrievedLabel;}},_setLabelPreLoadedElements:function(){chatBoxInputSendButtonElements.val(merchantChat._getLabel("send"));chatBoxInputSendButtonDisabledElements.val(merchantChat._getLabel("send"));chatBoxInputMessageElements.attr("placeholder",(merchantChat._getLabel("typeAMessage")+"..."));$YPCA(".chat-box--call-cta label").html(merchantChat._getLabel("phoneNumber"));$YPCA(".chat-box-minimized label").html(merchantChat._getLabel("sendAMessage"));},_setLabels:function(){merchantChat.LABELS=JSON.parse(merchantChatConfigElements.html()).labels;},_getMerchantIdAndName:function(){return{id:JSON.parse($YPCA("#merchant-common-config").html()).merchantId,name:JSON.parse($YPCA("#reviews-config").html()).merchantName};},_addMerchantNameToChatBox:function(){var span='<span>'+merchantChat.MERCHANT.name+'</span>';$YPCA(".chat-box--header").prepend(span);},_showChatBox:function(option){switch(option){case"open":chatBoxMinimizedElements.hide();chatBoxElements.show();chatBoxIconElements.hide();break;case"minimize":chatBoxMinimizedElements.show();chatBoxElements.hide();chatBoxIconElements.hide();break;case"close":chatBoxMinimizedElements.hide();chatBoxElements.hide();chatBoxIconElements.hide();break;case"icon-only":chatBoxMinimizedElements.hide();chatBoxElements.hide();chatBoxIconElements.show();break;default:throw"Not a valid option";}},_getAppropriateStorageProperty:function(){var userLoggedIn=YP.User.getUserInfo().authenticated;var storageProperty;if(userLoggedIn){storageProperty="merchantChat_ChatModeLogged";}
else{storageProperty="merchantChat_ChatModeNotLogged";}
return storageProperty;},_storeCurrentChatMode:function(option){var storageProperty=merchantChat._getAppropriateStorageProperty();localStorage.setItem(storageProperty,option);},_restoreCurrentChatMode:function(){var storageProperty=merchantChat._getAppropriateStorageProperty();if(storageProperty==="merchantChat_ChatModeNotLogged"){localStorage.removeItem("merchantChat_ChatModeLogged");}
else{localStorage.removeItem("merchantChat_ChatModeNotLogged");}
return localStorage.getItem(storageProperty);},_cleanChatMode:function(storageProperty){localStorage.removeItem(storageProperty);},_showChatBoxModeOfCurrentSession:function(){var modeOfSession=merchantChat._restoreCurrentChatMode();if(modeOfSession!==null){merchantChat._showChatBox(modeOfSession);}
else{merchantChat._showChatBox("open");}},_fixChatPositionAfterModal:function(){if(modalContainerElement.html().length>0){var bottomValue=-windowElement.scrollTop();chatBoxElements.css("bottom",(bottomValue+"px"));chatBoxMinimizedElements.css("bottom",((bottomValue+3)+"px"));chatBoxIconElements.css("bottom",((bottomValue+3)+"px"));}
else{chatBoxElements.css("bottom","0px");chatBoxMinimizedElements.css("bottom","3px");chatBoxIconElements.css("bottom","3px");}},_fixChatPositionAfterSideMenu:function(option){if(option==="opened"){var bottomValue=-windowElement.scrollTop();chatBoxElements.css("bottom",(bottomValue+"px"));chatBoxMinimizedElements.css("bottom",((bottomValue+3)+"px"));}
else if(option==="closed"){chatBoxElements.css("bottom","0px");chatBoxMinimizedElements.css("bottom","3px");}},_showOrHideSpinnerLoadingMessages:function(){const chatBoxLoadingMessagesElements=$YPCA(".chat-box--loading-messages");if(chatBoxLoadingMessagesElements.css("display")==="none"){chatBoxLoadingMessagesElements.css("display","flex");}
else{chatBoxLoadingMessagesElements.css("display","none");}},_getConversation:function(){$YPCA.ajax({url:"/ajax/messagesPopUp",type:"POST",contentType:"application/json",data:JSON.stringify({pg:merchantChat.currentPage,count:merchantChat.PAGE_SIZE,merchantId:merchantChat.MERCHANT.id,conversationId:""}),success:function(res){merchantChat._showOrHideSpinnerLoadingMessages();if(res.length!==0){var resObj=JSON.parse(res);if(resObj.items.length>0){merchantChat.conversation=resObj;merchantChat._createResponseTime(merchantChat.conversation.messagingResponseTimeDelegate.responseTime);if(merchantChat.conversation.messagingResponseTimeDelegate.showCallCta){merchantChat._showCallCta(merchantChat.conversation.messagingResponseTimeDelegate.phoneNumber.displayNumber);}
if(merchantChat.conversation.items.length>0){merchantChat._createConversation();merchantChat._scrollDownMessages();merchantChat._scrollDownMessagesAfterLoadPictures();if(merchantChat.conversation.items.length===merchantChat.PAGE_SIZE){merchantChat._checkIfhasMorePages();}}}
else{merchantChat._getResponseTimeAndPhoneNumber();merchantChat._showOrHideWelcomeMessage();}}
else{merchantChat._getResponseTimeAndPhoneNumber();}}});},_getConversationNextPage:function(){if(!merchantChat.loadingMoreMessages){merchantChat.loadingMoreMessages=true;merchantChat.currentPage++;$YPCA.ajax({url:"/ajax/messagesPopUp",type:"POST",contentType:"application/json",data:JSON.stringify({pg:merchantChat.currentPage,count:merchantChat.PAGE_SIZE,merchantId:merchantChat.MERCHANT.id,conversationId:""}),success:function(res){merchantChat.loadingMoreMessages=false;var oldConversation=JSON.parse(res);merchantChat._createOldConversation(oldConversation);merchantChat._checkIfhasMorePages();}});}},_checkIfhasMorePages:function(){$YPCA.ajax({url:"/ajax/messagesPopUp",type:"POST",contentType:"application/json",data:JSON.stringify({pg:merchantChat.currentPage+1,count:1,merchantId:merchantChat.MERCHANT.id,conversationId:""}),success:function(res){var conversationNextPage=JSON.parse(res);if(conversationNextPage.items.length===1){merchantChat._createLoadMoreMessagesListener();merchantChat._showOrHideLoadingMoreMessagesSpinner("show");}
else{merchantChat.hasMorePages=false;merchantChat._createLoadMoreMessagesListener(true);}}});},_createLoadMoreMessagesListener:function(turnOff){chatBoxMessagesElements.off("scroll");if(turnOff===undefined||turnOff===false){chatBoxMessagesElements.scroll(function(){if(chatBoxMessagesElements.scrollTop()===0){merchantChat._getConversationNextPage();}});}},_getResponseTimeAndPhoneNumber:function(){$YPCA.ajax({url:"/ajax/messaging/merchantChatMessageDialog",type:"GET",contentType:"application/json",data:{id:merchantChat.MERCHANT.id},success:function(res){var resObj=JSON.parse(res);merchantChat._createResponseTime(resObj.messagingResponseTimeDelegate.responseTime);if(resObj.messagingResponseTimeDelegate.showCallCta){merchantChat._showCallCta(resObj.messagingResponseTimeDelegate.phoneNumber.displayNumber);}}});},_showOrHideLoadingMoreMessagesSpinner:function(option){if(option==="hide"){$YPCA(".chat-box--loading-more-messages").remove();}
else{var divSpinner='<div class="chat-box--loading-more-messages">Loading more results...</div>';chatBoxMessagesElements.prepend(divSpinner);}},_showOrHideWelcomeMessage:function(option){var divMessages=chatBoxMessagesElements;if(option==="hide"){var divWelcomeMessage=$YPCA(".chat-box--welcome-message");divWelcomeMessage.remove();divMessages.css("position","static");}
else{var divWelcomeMessageContent='';divWelcomeMessageContent+='<div class="chat-box--welcome-message">';divWelcomeMessageContent+=merchantChat._getLabel("welcomeMessage");divWelcomeMessageContent+='</div>';divMessages.css("position","relative");divMessages.append(divWelcomeMessageContent);}},_scrollDownMessages:function(){chatBoxMessagesElements.scrollTop(chatBoxMessagesElements[0].scrollHeight);},_scrollDownMessagesAfterLoadPictures:function(){$YPCA(".chat-box--messages img").on("load",function(){merchantChat._scrollDownMessages();});},_createResponseTime:function(responseTimeMessage){var divContent='';divContent+='<div>';divContent+='  <span class="ypicon"></span>';divContent+=responseTimeMessage;divContent+='</div>';$YPCA(".chat-box--response-time").html(divContent);},_showCallCta:function(displayNumber){$YPCA(".chat-box--call-cta li li").html(displayNumber);$YPCA(".chat-box--call-cta").css('display','flex');},_openOrCloseBoxPhoneNumber:function(){const chatBoxCallCtaSubList=$YPCA(".chat-box--call-cta ul li ul");if(chatBoxCallCtaSubList.css('display')==="none"){chatBoxCallCtaSubList.show();chatBoxCallCtaAnchor.hover(function(e){if(e.type==="mouseenter"){chatBoxCallCtaAnchor.css("background","#ffcd00");chatBoxCallCtaAnchor.css('border-color','#ffcd00');}
else{chatBoxCallCtaAnchor.css("background","#ffcd00");chatBoxCallCtaAnchor.css('border-color','#ffcd00');}});}
else{chatBoxCallCtaSubList.hide();chatBoxCallCtaAnchor.hover(function(e){if(e.type==="mouseenter"){chatBoxCallCtaAnchor.css("background","#ffcd00");chatBoxCallCtaAnchor.css('border-color','#ffcd00');}
else{chatBoxCallCtaAnchor.css('background','#fff');chatBoxCallCtaAnchor.css('border-color','#c4c4c4');}});}},_createConversation:function(){var divConversation='';for(var i=0;i<merchantChat.conversation.items.length;i++){divConversation+=merchantChat._createSingleMessage(merchantChat.conversation.items[i]);}
chatBoxMessagesElements.html(divConversation);},_createSingleMessage:function(message){var divMessage='';divMessage+='<div>';var divText='';var divPictures='';var divDate='';if(message.owner){divText+='  <div class="chat-box--message-text chat-box--message-sent">';divText+='    <div class="chat-box--message-triangle"></div>';divPictures+='  <div class="chat-box--message-image-sent">';divDate+='  <div class="chat-box--message-date-sent">';}
else{divText+='  <div class="chat-box--message-text chat-box--message-received">';divText+='    <div class="chat-box--message-triangle-reverse"></div>';divPictures+='  <div class="chat-box--message-image-received">';divDate+='  <div class="chat-box--message-date-received">';}
if(message.imageContent.length>0){var divPicture='';for(var i=0;i<message.imageContent.length;i++){divPicture=divPictures;divPicture+='    <img class="chat-box--message-image" src="'+message.imageContent[i].image+'">';divPicture+='  </div>';divMessage+=divPicture;}}
if(message.textContent.length>0){divText+='    <div>';divText+='      <span>'+message.textContent+'</span>';divText+='    </div>';divText+='  </div>';divMessage+=divText;}
divDate+=message.createdAt;divDate+='  </div>';divMessage+=divDate;divMessage+='</div>';return divMessage;},_createOldConversation:function(oldConversation){$YPCA($YPCA(".chat-box--messages div")[0]).attr("id","first-message-of-last-page");var divsOldConversation='';for(var i=0;i<oldConversation.items.length;i++){divsOldConversation+=merchantChat._createSingleMessage(oldConversation.items[i]);}
chatBoxMessagesElements.prepend(divsOldConversation);const firstMessageOfLastPageElement=$YPCA("#first-message-of-last-page");chatBoxMessagesElements.scrollTop((firstMessageOfLastPageElement.offset().top)-600);firstMessageOfLastPageElement.removeAttr("id");merchantChat._showOrHideLoadingMoreMessagesSpinner("hide");},_uploadPicture:function(){var pictureInput=document.getElementById("chat-box--picture-upload").files[0];var form=new FormData();form.append('file',pictureInput);var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(this.readyState===4&&this.status===200){var response=JSON.parse(this.response);var id=response.id;var thumbnail=response.thumbnail;merchantChat._addPictureHtml(id,thumbnail);chatBoxPictureUploadElement.val("");}};xhr.open('POST','/ajax/fileUpload',true);xhr.send(form);},_addPictureHtml:function(id,thumbnail){var divPicture='';divPicture+='<div data-chat-box-picture-id="'+id+'">';divPicture+='  <img src="'+thumbnail+'">';divPicture+='  <div>X</div>';divPicture+='</div>';chatBoxPicturesElements.append(divPicture);merchantChat._checkPicturesLimit();var pictureDeleteButton="[data-chat-box-picture-id="+id+"] div";$YPCA(pictureDeleteButton).on('click',function(){merchantChat._deletePictureHtml(id);});merchantChat._showChatBoxPictures(true);},_deletePictureHtml:function(id){var pictureDiv='[data-chat-box-picture-id="'+id+'"]';$YPCA(pictureDiv).remove();merchantChat._checkPicturesLimit();merchantChat._enableSendButton();if(chatBoxPicturesImgElements.length===0){merchantChat._showChatBoxPictures(false);}},_showChatBoxPictures:function(option){if(option){chatBoxPicturesElements.css('display','flex');}
else{chatBoxPicturesElements.css('display','none');}},_checkPicturesLimit:function(){const chatBoxPictureUploadIconElements=$YPCA(".chat-box--picture-upload-icon");const chatBoxInputLabelElements=$YPCA(".chat-box--input label");if(chatBoxPicturesImgElements.length>=merchantChat.PICTURES_LIMIT){chatBoxPictureUploadIconElements.css('opacity','0.5');chatBoxPictureUploadIconElements.css('cursor','not-allowed');chatBoxInputLabelElements.attr("for","");}
else{chatBoxPictureUploadIconElements.css('opacity','1');chatBoxPictureUploadIconElements.css('cursor','pointer');chatBoxInputLabelElements.attr("for","chat-box--picture-upload");}},_enableSendButton:function(){if(merchantChat._isThereMessageToBeSent()){chatBoxInputSendButtonElements.show();chatBoxInputSendButtonDisabledElements.hide();}
else{chatBoxInputSendButtonElements.hide();chatBoxInputSendButtonDisabledElements.show();}},_isThereMessageToBeSent:function(){return(chatBoxPictureUploadElement.val().length>0||chatBoxPicturesImgElements.length!==0||chatBoxInputMessageElements.val().length!==0);},_saveOrRestoreChatToPrint:function(option){if(option==="save"){if(chatBoxMinimizedElements.css('display')==="none"){if(chatBoxElements.css('display')==="none"){if(chatBoxIconElements.css('display')==="none"){merchantChat.chatMode="closed";}
else{merchantChat.chatMode="icon-only";merchantChat._showChatBox("close");}}
else{merchantChat.chatMode="opened";merchantChat._showChatBox("close");}}
else{merchantChat.chatMode="minimized";merchantChat._showChatBox("close");}}
else{switch(merchantChat.chatMode){case"opened":merchantChat._showChatBox("open");break;case"minimized":merchantChat._showChatBox("minimize");break;case"icon-only":merchantChat._showChatBox("icon-only");break;default:throw"Not a valid mode";}}},_showCaptchaSendMessageModal:function(){YP.Modal.show("#jsModalContainer","/ajax/captchaModal",function(){documentElement.off('click','.jsBtnSendSms');$YPCA('.jsBtnSendSms').on("click",function(){const gRecaptchaResponseElements=$YPCA('.g-recaptcha-response');if(gRecaptchaResponseElements.length!==0&&gRecaptchaResponseElements.val().length>0){localStorage.setItem("merchantChat_captcha",gRecaptchaResponseElements.val());$YPCA("#captchaModal").modal("hide");merchantChat._sendMessage();}
else{const captchaAndErrorCaptchaElements=$YPCA(".captcha .errorCaptca");$YPCA(".captcha iframe").css("border","1px solid #ee4036");captchaAndErrorCaptchaElements.css("background-color","#ee4036");captchaAndErrorCaptchaElements.css("border-radius","0 0 3px 3px");captchaAndErrorCaptchaElements.css("color","#fff");captchaAndErrorCaptchaElements.css("display","block");captchaAndErrorCaptchaElements.css("font-size","11px");captchaAndErrorCaptchaElements.css("padding","10px");captchaAndErrorCaptchaElements.css("width","304px");}});});},_showLoginModal:function(){YP.Modal.show("#jsModalContainer","/ajax/user/signin",function(){$YPCA.subscribeOnce('LoginProcessCompletedEvent',merchantChat._storeMessageToBeSent);});},_sendMessage:function(){if(YP.User.getUserInfo().authenticated){merchantChat._addNotConfirmedMessage();merchantChat._sendMessageAjax();merchantChat._cleanInputs();merchantChat._enableSendButton();}
else{merchantChat._showChatBox("close");merchantChat._showLoginModal();$YPCA("#ypModal").on('hidden.bs.modal',function(){merchantChat._showChatBox("open");});}},_cleanInputs:function(){chatBoxInputMessageElements.val("");chatBoxPicturesElements.html("");merchantChat._showChatBoxPictures(false);},_addNotConfirmedMessage:function(){merchantChat._showOrHideWelcomeMessage("hide");var divNotConfirmedMessage='';divNotConfirmedMessage+='<div>';var picturesLength=chatBoxDataPictureIdElement.length;var pictureId;var pictureUrl;for(var i=0;i<picturesLength;i++){pictureId=$YPCA(chatBoxDataPictureIdElement[i]).data().chatBoxPictureId;pictureUrl=$YPCA(chatBoxDataPictureIdElement[i]).find("img").attr("src");divNotConfirmedMessage+='  <div class="chat-box--message-image-sent" data-chat-box-not-confirmed-picture-id="'+pictureId+'">';divNotConfirmedMessage+='    <img class="chat-box--message-image" src="'+pictureUrl+'">';divNotConfirmedMessage+='  </div>';}
var textMessage=chatBoxInputMessageElements.val();if(textMessage.length>0){divNotConfirmedMessage+='  <div class="chat-box--message-text chat-box--message-sent">';divNotConfirmedMessage+='    <div class="chat-box--message-triangle"></div>';divNotConfirmedMessage+='    <div>';divNotConfirmedMessage+='      <span>'+textMessage+'</span>';divNotConfirmedMessage+='    </div>';divNotConfirmedMessage+='  </div>';}
divNotConfirmedMessage+='  <div class="chat-box--message-date-sent">';divNotConfirmedMessage+='    <span class="ypicon ypicon-circle-o-notch ypicon--spin chat-box--spinner-sending-message"></span>'+merchantChat._getLabel("sending");divNotConfirmedMessage+='  </div>';divNotConfirmedMessage+='</div>';chatBoxMessagesElements.append(divNotConfirmedMessage);merchantChat._scrollDownMessages();},_confirmMessage:function(){var oldestMessageNotConfirmed=$YPCA($YPCA(".ypicon.ypicon-circle-o-notch.ypicon--spin.chat-box--spinner-sending-message")[0]).parent();oldestMessageNotConfirmed.html(merchantChat._formatDateToMessage(new Date()));},_formatDateToMessage:function(date){var formattedDate="";var month=merchantChat._getLabel("months",date.getMonth());if(merchantChat.CURRENT_LANGUAGE==="en"){formattedDate+=month;formattedDate+=" ";formattedDate+=date.getDate()<10?'0'+date.getDate():date.getDate();formattedDate+=", ";formattedDate+=date.getFullYear();formattedDate+=" ";if(date.getHours()<10){formattedDate+='0'+date.getHours();}
else{if(date.getHours()<=12){formattedDate+=date.getHours();}
else{if(date.getHours()<=20){formattedDate+='0'+(date.getHours()-12);}
else{formattedDate+=(date.getHours()-12);}}}
formattedDate+=":";formattedDate+=date.getMinutes()<10?'0'+date.getMinutes():date.getMinutes();formattedDate+=" ";formattedDate+=date.getHours()<12?"AM":"PM";}
else{formattedDate+=date.getDate()<10?'0'+date.getDate():date.getDate();formattedDate+=" ";formattedDate+=month.toLowerCase();formattedDate+=" ";formattedDate+=date.getFullYear();formattedDate+=" ";formattedDate+=date.getHours()<10?'0'+date.getHours():date.getHours();formattedDate+=":";formattedDate+=date.getMinutes()<10?'0'+date.getMinutes():date.getMinutes();}
return formattedDate;},_sendMessageAjax:function(){var urlMessage;var message;if(merchantChat.conversation!==null){message=merchantChat._createMessageToBeSent();urlMessage="/ajax/messaging/sendMessage";}
else{message=merchantChat._createMessageToBeSent("firstMessage");urlMessage="/ajax/messaging/firstMessage?lang=";urlMessage+=merchantChat.CURRENT_LANGUAGE;urlMessage+="&captcha=";urlMessage+=localStorage.getItem("merchantChat_captcha");merchantChat._validateAndFixMessageWithFirstAndLastName(message);}
$YPCA.ajax({url:urlMessage,type:"POST",contentType:"application/json",data:JSON.stringify(message),success:function(res){if(res.success){if(res.code===0){merchantChat._confirmMessage();}
else if(res.code===1){merchantChat._getConversation();}}}});},_validateAndFixMessageWithFirstAndLastName:function(messageObject){if(messageObject.firstName.length===0||messageObject.lastName.length===0){messageObject.firstName=YP.User.getUserInfo().displayname;messageObject.lastName=YP.User.getUserInfo().displayname;}},_createMessageToBeSent:function(option){var messageObject={visitorId:YP.Analytics.getVisitorId()};if(option!=="firstMessage"){messageObject.conversationId=merchantChat.conversation.conversationId;}
else{messageObject.copy=false;messageObject.firstName=YP.User.getUserInfo().firstName;messageObject.lastName=YP.User.getUserInfo().lastName;messageObject.merchantId=merchantChat.MERCHANT.id;messageObject.userEmail=YP.User.getUserInfo().email;}
var textMessage=chatBoxInputMessageElements.val();messageObject.message=textMessage;var pictureElements=chatBoxDataPictureIdElement;if(pictureElements.length>0){messageObject.imageIds=[];var pictureId;for(var i=0;i<pictureElements.length;i++){pictureId=$YPCA(pictureElements[i]).data().chatBoxPictureId;messageObject.imageIds.push(pictureId);}}
return messageObject;},_hasStoredMessageToBeSent:function(){var storedString=localStorage.getItem("merchantChat_message");if(storedString!==null){var storedObject=JSON.parse(storedString);var now=new Date();return storedObject.userEmail===YP.User.getUserCookiesInfo().e&&now.getTime()<=(new Date(storedObject.createdAt).getTime()+merchantChat.TIMEOUT_TO_SEND_MESSAGE);}
else{return false;}},_storeMessageToBeSent:function(){var messageObject={message:chatBoxInputMessageElements.val()};var pictureElements=chatBoxDataPictureIdElement;if(pictureElements.length>0){messageObject.imageIds=[];var pictureId;for(var i=0;i<pictureElements.length;i++){pictureId=$YPCA(pictureElements[i]).data().chatBoxPictureId;messageObject.imageIds.push(pictureId);}}
var objectToStore={message:messageObject,userEmail:YP.User.getUserCookiesInfo().e,createdAt:new Date()};localStorage.setItem("merchantChat_message",JSON.stringify(objectToStore));merchantChat._cleanChatMode("merchantChat_ChatModeNotLogged");},_restoreMessageToBeSent:function(){var storedMessage=localStorage.getItem("merchantChat_message");if(storedMessage!==undefined){return JSON.parse(storedMessage);}},_deleteStoredMessage:function(){localStorage.removeItem("merchantChat_message");},_sendStoredMessage:function(){$YPCA.ajax({url:"/ajax/messagesPopUp",type:"POST",contentType:"application/json",data:JSON.stringify({pg:1,count:1,merchantId:merchantChat.MERCHANT.id,conversationId:""}),success:function(res){var urlMessage;var storedMessage=merchantChat._restoreMessageToBeSent();storedMessage.message.visitorId=YP.Analytics.getVisitorId();if(res.length>0){var resObj=JSON.parse(res);if(resObj.conversationId!==""){storedMessage.message.conversationId=resObj.conversationId;urlMessage="/ajax/messaging/sendMessage";}
else{storedMessage.message.copy=false;storedMessage.message.firstName=YP.User.getUserInfo().firstName;storedMessage.message.lastName=YP.User.getUserInfo().lastName;storedMessage.message.merchantId=merchantChat.MERCHANT.id;storedMessage.message.userEmail=YP.User.getUserInfo().email;urlMessage="/ajax/messaging/firstMessage?lang=";urlMessage+=merchantChat.CURRENT_LANGUAGE;urlMessage+="&captcha=";urlMessage+=localStorage.getItem("merchantChat_captcha");merchantChat._validateAndFixMessageWithFirstAndLastName(storedMessage.message);}}
$YPCA.ajax({url:urlMessage,type:"POST",contentType:"application/json",data:JSON.stringify(storedMessage.message),success:function(){merchantChat._deleteStoredMessage();merchantChat._getConversation();}});}});},_isLowResolutionDevice:function(){return windowElement.height()<900;},_isPageIsScrolledDown:function(){return windowElement.scrollTop()>350;},_openChatBoxAfterScrollDown:function(){documentElement.on('scroll',function(){if(windowElement.scrollTop()>350){documentElement.off('scroll');merchantChat._showChatBox("open");}});chatBoxIconElements.on('click',function(){documentElement.off('scroll');});}};$YPCA(function(){if(merchantChatConfigElements.length>0){merchantChat._init();}});})($YPCA,window,document);

</script>

</body>
</html>
