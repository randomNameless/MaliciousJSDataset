(function(b,c,d){var a=function(e){var f={playerId:"videoplayerobj",eventTarget:"#playercontainer",playerContainer:"#playercontainer",flowplayerUrl:"flowplayer-3.1.5.swf",enableLogging:false};c.extend(f,e);this.options=f;this.playerStates={"-1":"unstarted","0":"unstarted","1":"unstarted","2":"buffering","3":"playing","4":"paused","5":"ended"};this.eventTarget=c(this.options.eventTarget);this.playerContainer=c(this.options.playerContainer);c.extend(f,e);this.options=f;this.className="FlowplayerInterface";_.bindAll(this,"onBegin","onFinish","onPause","onResume","onSeek","onStart","onStop");this._playerState="unstarted";this._playerReady=false};a.prototype.log=function(e){if(this.options.enableLogging){console.group(this.className+": "+this.options.eventTarget);console.log(e);console.groupEnd()}};a.prototype.installFlowplayer=function(f,g,e){flowplayer(this.options.playerId,this.options.flowplayerUrl,{clip:{autoPlay:g?true:false,autoBuffering:true,onBegin:this.onBegin,onFinish:this.onFinish,onPause:this.onPause,onResume:this.onResume,onSeek:this.onSeek,onStart:this.onStart,onStop:this.onStop,url:f,start:e?Math.floor(e):0}})};a.prototype.loadVideo=function(f,g,e){this.log("loadVideo");this.log(f);this.log(g);this.log(e);this.playerContainer.html('<object id="'+this.options.playerId+'"></object>');this.installFlowplayer(f,g,e);this._playerReady=false;this.eventTarget.trigger("videoplayer.player.readychange",[false])};a.prototype.getPlayerState=function(){return this._playerState};a.prototype.setPlayerState=function(e){if(e!=this._playerState){this._playerState=e;this.eventTarget.trigger("videoplayer.player.statechange",[e])}};a.prototype.isPlayerReady=function(){return this._playerReady};a.prototype.isPlaying=function(){return this.isPlayerReady()&&this.getPlayerState()=="playing"};a.prototype.onBegin=function(){this.log("onBegin");this.setPlayerState("cued");this._playerReady=true;this.eventTarget.trigger("videoplayer.player.readychange",[true])};a.prototype.onFinish=function(){this.log("onFinish");this.setPlayerState("ended")};a.prototype.onPause=function(){this.log("onPause");this.setPlayerState("paused")};a.prototype.onResume=function(){this.log("onResume");this.setPlayerState("playing")};a.prototype.onResume=function(){this.log("onSeek");this.setPlayerState("playing")};a.prototype.onStart=function(){this.log("onStart");this.setPlayerState("playing")};a.prototype.onStop=function(){this.log("onStop");this.setPlayerState("ended")};a.prototype.getCurrentTime=function(){return flowplayer(this.options.playerId).getTime()};a.prototype.playVideo=function(){flowplayer(this.options.playerId).play()};a.prototype.pauseVideo=function(){flowplayer(this.options.playerId).pause()};b.FlowplayerInterface=a})(window,jQuery);(function(b,c,e){b.onYouTubePlayerReady={};b.ytid=1;b.onYouTubePlayerReady=function(f){var g=unescape(f);onYouTubePlayerReady[g]()};var a=function(f){var g={playerId:"videoplayerobj",eventTarget:"#playercontainer",playerContainer:"#playercontainer",enableLogging:(b.location.hostname=="dev.wn.com"),};this.options={};c.extend(this.options,g);c.extend(this.options,f);this.playerStates={"-1":"unstarted","0":"ended","1":"playing","2":"paused","3":"buffering","5":"cued"};this._volume=null;this.ytplayer=null;this.preload=false;this.autoplay=false;this.ytid=ytid++;this.eventTarget=c(this.options.eventTarget);this.playerContainer=c(this.options.playerContainer);_.bindAll(this,"onYouTubePlayerStateChange","onYouTubePlayerError","onYouTubePlayerReady","onYouTubePlayerLoading");this.className="YoutubeInterface";this.notificationUrl=null;this._playerReady=false;if(this.options.enableLogging){this.log=console.info.bind(console)}else{this.log=function(){}}};a.prototype.callback=function(f){return c.proxy(f,this)};b._isYoutubePlayerReady=false;b._onYouTubePlayerReady={};b.onYouTubeIframeAPIReady=function(){b._isYoutubePlayerReady=true;console.log("Init youtube players");for(var f in b._onYouTubePlayerReady){console.log("Init player",f);b._onYouTubePlayerReady[f]()}};function d(g,h){b.initYouTubeAPI();if(b._isYoutubePlayerReady){console.log("Init player",g);h()}else{console.log("Waiting player",g);b._onYouTubePlayerReady[g]=h}}b.initYouTubeAPI=function(){b.initYouTubeAPI=function(){};var f=document.createElement("script");f.src="https://www.youtube.com/iframe_api";var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(f,g);console.log("Load youtube players")};a.prototype.loadVideo=function(g,i,f,h){this.log("loadVideo:",g," autoplay=",i," position=",f);this._video_id=g;this._start=f;this.preload=false;this.autoplay=false;if(i=="preload"){this.preload=true}else{if(i){this.autoplay=true}}this.preload=(i=="preload");this.notificationUrl=h;if(this.ytplayer){this.ytplayer.loadVideoById({videoId:g,startSeconds:f||0,playerVars:{autoplay:this.autoplay},});this.onVideoLoaded()}else{d("ytplayer"+this.ytid,this.onYouTubePlayerLoading);this.eventTarget.trigger("videoplayer.player.readychange",[false])}};a.prototype.isPlayerReady=function(){return this._playerReady};a.prototype.isPlaying=function(){return this.isPlayerReady()&&this.getPlayerState()=="playing"};a.prototype.onVideoLoaded=function(){if(this.preload){this.ytplayer.pauseVideo();this.preload=false}};a.prototype.onYouTubePlayerLoading=function(){this.log("onYouTubePlayerLoading",this.ytid,this.autoplay);this.ytplayer=new YT.Player(this.playerContainer.attr("id"),{height:"390",width:"640",videoId:this._video_id,playerVars:{autoplay:this.autoplay},events:{onReady:this.onYouTubePlayerReady,onStateChange:this.onYouTubePlayerStateChange}})};a.prototype.onYouTubePlayerReady=function(){this.log("onYouTubePlayerReady",this.ytid);this._playerReady=true;this.onVideoLoaded();this.eventTarget.trigger("videoplayer.player.readychange",[true]);this.log("onYouTubePlayerReady done",this.ytid)};a.prototype.onYouTubePlayerStateChange=function(g){this.log("Player's new state: ",this.playerStates[g.data]);var f=this.playerStates[g.data];if(this.preload){this.ytplayer.pauseVideo();this.preload=false}this.eventTarget.trigger("videoplayer.player.statechange",[f,this.options.playerId])};a.prototype.onYouTubePlayerError=function(){if(this.notificationUrl){c.ajax({url:this.notificationUrl,dataType:"jsonp",success:function(){}})}this.log("Player stopped because of error.");this.eventTarget.trigger("videoplayer.player.statechange",["ended",this.options.playerId])};a.prototype.getPlayerState=function(){if(!this.ytplayer||!this.ytplayer.getPlayerState){return e}var f=this.ytplayer.getPlayerState();return this.playerStates[f]};a.prototype.getCurrentTime=function(){if(this.ytplayer&&this.ytplayer.getCurrentTime){return this.ytplayer.getCurrentTime()}else{return 0}};a.prototype.preloadVideo=function(){this.log("Preloading video for ",this.options.playerId);this.preload=true;var f=this.ytplayer;if(f){setTimeout(function(){f.pauseVideo();f.seekTo(0,true);f.pauseVideo()},500)}};a.prototype.seekTo=function(f){this.log("Seek to ",f," for ",this.options.playerId);if(this.ytplayer){this.ytplayer.pauseVideo();this.ytplayer.seekTo(f,true)}};a.prototype.playVideo=function(){this.log("Play video for ",this.options.playerId);if(this.ytplayer){this.ytplayer.playVideo()}};a.prototype.pauseVideo=function(){this.log("Pause video for ",this.options.playerId);if(this.ytplayer){this.ytplayer.pauseVideo()}};a.prototype.stopVideo=function(){this.log("Stop video for ",this.options.playerId);if(this.ytplayer){this.ytplayer.stopVideo()}};a.prototype.repeat=function(){if(this.ytplayer){this.ytplayer.repeat=true}};a.prototype.setVolume=function(f){if(this.ytplayer&&this.ytplayer.setVolume){this.ytplayer.setVolume(f*100)}else{this._volume=f}};a.prototype.setVolumeMute=function(f){if(this.ytplayer&&this.ytplayer.mute){this.ytplayer.mute()}else{this._volume="mute"}};a.prototype.setVolumeUnMute=function(f){if(this.ytplayer&&this.ytplayer.unMute){this.ytplayer.unMute()}else{this._volume="unmute"}};b.YoutubeInterface=a})(window,jQuery);(function(b,c){var a=function(d){var e={playerId:"videoplayerobj",eventTarget:"#playercontainer",playerContainer:"#playercontainer",enableLogging:(b.location.hostname=="dev.wn.com"),wmode:"direct"};this.options={};c.extend(this.options,e);c.extend(this.options,d);this.eventTarget=c(this.options.eventTarget);this.playerContainer=c(this.options.playerContainer);this.className="VimeoInterface";this._playerReady=false;_.bindAll(this,"onVimeoPlayerReady","onProgress","onLoading","onFinish","onPlay","onPause","onSeek");this._playerState="unstarted";this._currentTime=0;if(this.options.enableLogging){this.log=console.info.bind(console)}else{this.log=function(){}}};a.prototype.callback=function(d){return c.proxy(d,this)};a.prototype.loadVideo=function(f,h,d){this.log("loadVideo");this.log(f);this.log(h);this.log(d);var e=this;var g={id:f,width:this.playerContainer.width(),height:this.playerContainer.height(),loop:false,autoplay:false,responsive:true};c('<div class="videoplayer-vimeo" id="'+this.options.playerId+'"></div>').appendTo(this.playerContainer);this._player=new Vimeo.Player(this.options.playerId,g);this._playerReady=false;this._player.ready().then(function(){e.onVimeoPlayerReady(h,d)});this.eventTarget.trigger("videoplayer.player.readychange",[false]);this.log("done")};a.prototype.isPlayerReady=function(){return this._playerReady};a.prototype.isPlaying=function(){return this.isPlayerReady()&&this.getPlayerState()=="playing"};a.prototype.onVimeoPlayerReady=function(e,d){this.log("player ready");this.log(e);this.log(d);this._player.on("play",this.onPlay);this._player.on("pause",this.onPause);this._player.on("ended",this.onFinish);this._player.on("timeupdate",this.onProgress);this._player.on("seeked",this.onSeek);this._playerReady=true;this.eventTarget.trigger("videoplayer.player.readychange",[true]);this.setPlayerState("cued");if(d){this.log("seeking...");this.log(d);this._player.setCurrentTime(d)}if(e){this.log("starting playback...");this._player.play()}};a.prototype.getPlayerState=function(){return this._playerState};a.prototype.setPlayerState=function(d){if(d!=this._playerState){this._playerState=d;this.eventTarget.trigger("videoplayer.player.statechange",[d,this.options.playerId])}};a.prototype.onProgress=function(f,e){this.setPlayerState("playing");var d=this;this._player.getCurrentTime().then(function(g){d._currentTime=g})};a.prototype.onLoading=function(e,d){};a.prototype.onFinish=function(e){this.log("onFinish");var d=this;this._player.getCurrentTime().then(function(f){d._player.setCurrentTime(f-0.01)});this.setPlayerState("ended")};a.prototype.onPlay=function(d){this.setPlayerState("playing")};a.prototype.onPause=function(d){this.log("onPause");this.setPlayerState("paused")};a.prototype.onSeek=function(e,d){this.setPlayerState("playing")};a.prototype.getCurrentTime=function(){return this._currentTime};a.prototype.playVideo=function(){if(this._player){this._player.play()}};a.prototype.pauseVideo=function(){if(this._player){this._player.pause()}};a.prototype.seekTo=function(d){if(this._player){this._player.setCurrentTime(d)}};b.VimeoInterface=a})(window,jQuery);(function(b,c){var a=function(d){var e={playerId:"videoplayerobj",eventTarget:"#playercontainer",playerContainer:"#playercontainer",enableLogging:(b.location.hostname=="dev.wn.com"),wmode:"direct"};this.options={};c.extend(this.options,e);c.extend(this.options,d);this.eventTarget=c(this.options.eventTarget);this.playerContainer=c(this.options.playerContainer);this.className="DailyMotionInterface";this._playerReady=false;_.bindAll(this,"onPlayerReady","onProgress","onLoading","onFinish","onPlay","onPause","onSeek");this._playerState="unstarted";this._currentTime=0;if(this.options.enableLogging){this.log=console.info.bind(console)}else{this.log=function(){}}};a.prototype.callback=function(d){return c.proxy(d,this)};a.prototype.loadVideo=function(f,h,d){this.log("loadVideo");this.log(f);this.log(h);this.log(d);var e=this;var g={video:f,width:this.playerContainer.width(),height:this.playerContainer.height(),params:{autoplay:true,mute:true,"queue-enable":false,"queue-autoplay-next":false,"sharing-enable":false,start:d,autoplay:h,}};c('<div class="videoplayer-dailymotion" id="'+this.options.playerId+'"></div>').appendTo(this.playerContainer);this._player=new DM.player(this.options.playerId,g);this._playerReady=false;this._player.addEventListener("apiready",function(){e.onPlayerReady(h,d)});this.eventTarget.trigger("videoplayer.player.readychange",[false]);this.log("done")};a.prototype.onPlayerReadyWait=function(e,d){};a.prototype.isPlayerReady=function(){return this._playerReady};a.prototype.isPlaying=function(){return this.isPlayerReady()&&this.getPlayerState()=="playing"};a.prototype.onPlayerReady=function(e,d){this.log("player ready");this.log(e);this.log(d);this._player.addEventListener("play",this.onPlay);this._player.addEventListener("pause",this.onPause);this._player.addEventListener("end",this.onFinish);this._player.addEventListener("timeupdate",this.onProgress);this._player.addEventListener("seeked",this.onSeek);this._playerReady=true;this.eventTarget.trigger("videoplayer.player.readychange",[true]);this.setPlayerState("cued");if(d){this.log("seeking...");this.log(d);this._player.seek(d)}if(e){this.log("starting playback...");this._player.play()}};a.prototype.getPlayerState=function(){return this._playerState};a.prototype.setPlayerState=function(d){if(d!=this._playerState){this._playerState=d;this.eventTarget.trigger("videoplayer.player.statechange",[d,this.options.playerId])}};a.prototype.onProgress=function(f,e){this.setPlayerState("playing");var d=this;d._currentTime=this._player.currentTime};a.prototype.onLoading=function(e,d){};a.prototype.onFinish=function(e){this.log("onFinish");var d=this;this.setPlayerState("ended")};a.prototype.onPlay=function(d){this.setPlayerState("playing")};a.prototype.onPause=function(d){this.log("onPause");this.setPlayerState("paused")};a.prototype.onSeek=function(e,d){this.setPlayerState("playing")};a.prototype.getCurrentTime=function(){return this._currentTime};a.prototype.playVideo=function(){if(this._player){this._player.play()}};a.prototype.pauseVideo=function(){if(this._player){this._player.pause()}};a.prototype.seekTo=function(d){if(this._player){this._player.seek(d)}};b.DailyMotionInterface=a})(window,jQuery);(function(b,c){var a=function(e){if(!e){return}var f={playerId:"videoplayerobj",playerContainer:"#playercontainer",autorepeat:false,volume:1,volumeMute:false,replaycurrent:false,videoplayerTemplate:'<div id="<%= divId %>"></div>',enableLogging:false,enableBackendLogging:false,};this.options={};c.extend(this.options,f);c.extend(this.options,e);this.playerContainer=c(this.options.playerContainer);this.className="VideoplayerCore";this.AUTOSTART=true;this.NOAUTOSTART=false;if(this.options.enableLogging&&b.console){this.log=console.log.bind(console,this.options.playerContainer+" : ")}else{this.log=function(){}}this._playlist=[];this._currentVideo=null;this._autorepeat=this.options.autorepeat;this._volume=this.options.volume;this._volumeMute=this.options.volumeMute;this._replaycurrent=this.options.replaycurrent;this._usePlaylist=true;this._shuffle=false;this.shuffledPlaylist=[];this.backends={};this.players={};this.videoplayerTemplate=_.template(this.options.videoplayerTemplate);if(b.YoutubeInterface!==undefined){this.backends.youtube=b.YoutubeInterface}if(b.FlowplayerInterface!==undefined){this.backends.flowplayer=b.FlowplayerInterface}if(b.VimeoInterface!==undefined){this.backends.vimeo=b.VimeoInterface}if(b.YahooInterface!==undefined){this.backends.yahoo=b.YahooInterface}if(b.DailyMotionInterface!==undefined){this.backends.dailymotion=b.DailyMotionInterface}if(b.ShowplayerInterface!==undefined){this.backends.blip=b.ShowplayerInterface}if(b.JWplayerInterface!==undefined){this.backends.jwplayer=b.JWplayerInterface}this.currentPlayer=null;_.bindAll(this,"onPlayerStateChange","onPlaybackStarted","onPlaybackScheduled");this.playPriority="stopped";this.playerContainer.bind("videoplayer.player.statechange",this.onPlayerStateChange);c(document).bind("videoplayback.scheduled",this.onPlaybackScheduled);c(document).bind("videoplayback.started",this.onPlaybackStarted);this.log("VideoplayerCore constructor done.")};a.prototype.setMultiplePlayers=function(e){this.options.multiplePlayers=e};a.prototype.onPlaybackStarted=function(f,e,g){this.pausePlayers(e)};a.prototype.callback=function(e){return c.proxy(e,this)};a.prototype.videoSignature=function(e){if(!e){return"0"}return e.source+":"+e.video_id};a.prototype.isSameVideo=function(f,e){return(f)&&(e)&&(f.source==e.source)&&(f.video_id==e.video_id)};a.prototype.updateHtml=function(){this.log("Abstract function. Override in the subclass.")};a.prototype.getPlaylist=function(){return this._playlist};function d(e){var j={};var g=[];for(var h=0;h<e.length;h++){var f=a.prototype.videoSignature(e[h]);if(j[f]===undefined){j[f]=true;g.push(e[h])}}return g}a.prototype.setPlaylist=function(e){e=d(e);this.playerContainer.trigger("videoplayer.player.playlistchanging",[e]);this._playlist=e;this.shufflePlaylist();this.updateHtml();this.playerContainer.trigger("videoplayer.player.playlistchanged",[e])};a.prototype.getCurrentVideo=function(e){return this._currentVideo};a.prototype.getUsePlaylist=function(){return this._usePlaylist};a.prototype.setUsePlaylist=function(e){this._usePlaylist=e;this.updateHtml()};a.prototype.getPlaylistPosition=function(){if(!this.getUsePlaylist()){return -1}var f=this.getActualPlaylist(),e=this.getCurrentVideo();return _.indexOf(f,e)};a.prototype.getAutorepeat=function(){return this._autorepeat};a.prototype.setAutorepeat=function(e){this._autorepeat=e;this.updateHtml()};a.prototype.setReplayCurrent=function(e){this._replaycurrent=e;this.updateHtml()};a.prototype.getReplayCurrent=function(){return this._replaycurrent};a.prototype.setVolumeMute=function(){this._volumeMute=true;if(this.currentPlayer&&this.currentPlayer.setVolumeMute){this.currentPlayer.setVolumeMute()}};a.prototype.setVolumeUnMute=function(){this._volumeMute=false;if(this.currentPlayer&&this.currentPlayer.setVolumeUnMute){this.currentPlayer.setVolumeUnMute()}};a.prototype.setVolume=function(e){this._volume=e;if(this.currentPlayer&&this.currentPlayer.setVolume){this.currentPlayer.setVolume(this._volume)}};a.prototype.getVolume=function(){return this._volume};a.prototype.selectBackend=function(e){var f;if(_.isString(e)){f=e}else{f=e.source}return this.backends[f]};a.prototype.playSingleVideo=function(h,g,e){this.log("playSingleVideo");var f=this.getCurrentVideo();if(!f||!this.isSameVideo(f,h)){this.loadVideo(h,g,e)}this.playerContainer.trigger("videoplayer.player.individualvideostartedplay");this._currentVideo=h;this.setUsePlaylist(false);this.updateHtml()};a.prototype.playFromPlaylist=function(h,g,e){if(g){this.playPriority="primary"}this.log("playFromPlaylist");var f=this.getCurrentVideo();if(!this.getUsePlaylist()||!f||!this.isSameVideo(f,h)){this.loadVideo(h,g,e)}else{if(g){this.playVideo()}}this._currentVideo=h;this.setUsePlaylist(true);this.updateHtml();this.playerContainer.trigger("videoplayer.player.videostartedplay",h)};a.prototype.loadPlaylist=function(h,e){var g=this.getPlaylist();if(g.length){var e=this.getPlaylistPosition();if(e<0){e=0}var f=g[e];this.log("loading playlist with autoplay="+this.autoplay);this.playFromPlaylist(f,h?this.AUTOSTART:this.NOAUTOSTART)}};a.prototype.loadVideo=function(g,f,h){this.log("loadVideo");if(this.getReplayCurrent()){this.setReplayCurrent(false);this.setReplayCurrent(true)}if(true){var m=_.uniqueId("videoplayer-");var l=_.uniqueId("videoobject-");var k=this.videoplayerTemplate({divId:m,objectId:l});var n=c(k);this.playerContainer.html(n);var e=c("#"+m);e.width(this.playerContainer.width());e.height(this.playerContainer.height());e.css("position","absolute");e.css("top","0px");e.addClass("active");var j=this.selectBackend(g.source||"youtube");var i=new j({playerId:l,playerContainer:e,eventTarget:this.options.playerContainer,enableLogging:this.enableBackendLogging,wmode:this.options.wmode});this.currentPlayer=i;b.activePlayerId=l;i.loadVideo(g.video_id,f,h,g.notificationUrl)}this.playerContainer.trigger("videoplayer.player.videoloaded",[g]);if(f){}if(this.currentPlayer!=null&&this.currentPlayer.setVolume){this.currentPlayer.setVolume(this._volume);if(this._volumeMute){this.currentPlayer.setVolumeMute()}}};a.prototype.pausePlayers=function(e){for(var g in this.players){if(this.players[g].player.options.playerId!=e){var f=this.players[g].player;f.pauseVideo()}}if(this.currentPlayer&&this.currentPlayer.options.playerId!=e){var f=this.currentPlayer;f.pauseVideo()}};a.prototype.onPlayerStateChange=function(f,g,e){this.log("onPlayerStateChange: "+g+" for "+e);if(g=="ended"){if(this.getUsePlaylist()&&b.activePlayerId==e){this.playNextPlaylistVideo()}}if(g=="playing"){b.activePlayerId=e;c(document).trigger("videoplayback.started",[e,true])}};a.prototype.playNextPlaylistVideo=function(){if(this.getUsePlaylist()){if(this.getReplayCurrent()){this.seekTo(0);this.pauseVideo();this.playVideo();return}var g=this.getPlaylistPosition(),h=this.getActualPlaylist(),f=g+1;this.log(f);if(f<h.length){var e=h[f];this.playerContainer.trigger("videoplayer.player.playlistnext",[e]);this.playFromPlaylist(e,this.AUTOSTART)}else{if(h.length!=0){this.playerContainer.trigger("videoplayer.player.playlistended");if(this.getAutorepeat()){if(this.getShuffle()){this.shufflePlaylist()}this.playFromPlaylist(h[0],this.AUTOSTART)}}}}};a.prototype.playPrevPlaylistVideo=function(){if(this.getUsePlaylist()){var h=this.getPlaylistPosition(),i=this.getActualPlaylist(),f=h-1;this.log(f);if(f>=0){var e=i[f];var g=this.getCurrentVideo();this.playerContainer.trigger("videoplayer.player.playlistprev",[g,e]);this.playFromPlaylist(e,this.AUTOSTART)}else{if(this.getAutorepeat()){if(this.getShuffle()){this.shufflePlaylist()}this.playFromPlaylist(i[i.length-1],this.AUTOSTART)}}}};a.prototype.clearPlaylist=function(){this.setPlaylist([])};a.prototype.playPlaylist=function(){var e=this.getActualPlaylist();if(e.length){this.playFromPlaylist(e[0],this.AUTOSTART)}};a.prototype.getPlayerState=function(){return this.currentPlayer.getPlayerState()};a.prototype.isPlayerReady=function(){if(this.currentPlayer===null){return false}return this.currentPlayer.isPlayerReady()};a.prototype.isActiveState=function(){if(!this.isPlayerReady()){return false}var f=this.getPlayerState(),e=["ended","playing","paused","cued"];return _.indexOf(e,f)>=0};a.prototype.getPlaylistData=function(){var e={},j=this.getActualPlaylist(),g=this.getPlaylistPosition(),k=0,h=0;e.totalVideos=j.length;e.currentVideo=g;for(var f=0;f<j.length;f++){k+=j[f].duration;if(f<g){h+=j[f].duration}if(f==g){h+=this.getCurrentTime()}}e.totalDuration=k;e.currentPosition=h;return e};a.prototype.getCurrentBackend=function(){var e=this.selectBackend(this.getCurrentVideo());return e};a.prototype.getCurrentTime=function(){return this.currentPlayer.getCurrentTime()};a.prototype.seekTo=function(e){return this.currentPlayer.seekTo(e)};a.prototype.playVideo=function(){if(this.isPlayerReady()){try{c(document).trigger("videoplayback.scheduled",[this.options.playerContainer])}catch(f){console.log(f)}this.currentPlayer.playVideo()}};a.prototype.pauseVideo=function(){if(this.isPlayerReady()){this.currentPlayer.pauseVideo()}};a.prototype.getShuffle=function(){return this._shuffle};a.prototype.setShuffle=function(e){if((!this._shuffle)&&e){this.shufflePlaylist()}this._shuffle=e};a.prototype.shufflePlaylist=function(){var g=this.getPlaylist().slice(0);for(var j=0;j<g.length;j++){var f=Math.floor(Math.random()*g.length);var h=g[j];var e=g[f];g[j]=e;g[f]=h}this.shuffledPlaylist=g};a.prototype.getActualPlaylist=function(){return this.getShuffle()?this.shuffledPlaylist:this.getPlaylist()};b.VideoplayerCore=a})(window,jQuery);(function(b,c){var a=function(f){VideoplayerCore.apply(this,[f]);var d=this;var h={playlistContainer:"#playlistcontainer",playlistRepeat:"#playlistrepeat",playlistShuffle:"#playlistshuffle",replaycurrentCheckbox:"#replaycurrent1",playlistClear:"#playlistclear",playTrigger:".playvideo",addTrigger:".addvideo",videoInfo:".video-info",videoTitle:".video-fulltitle",videoDescription:".video-fulldescription",videoThumbnail:".video-thumbnail",playlistItem:".playlistitem",currentItemClass:"current",currentItemSelector:".current",playlistItemRemoveClass:"playlistitemremove",sortingHandle:".handle",playposition:"#playposition",nowPlaying:"#nowplaying",autoplayCheckbox:"#autoplay",autoplayCookie:"wn-videoplayer-autoplay",playlistFormatCookie:"wn-videoplayer-playlist-format",autoplay:null,playlistItemTemplate:'<li class="playlistitemli"><span class="playlistitemremove" title="Click to remove from playlist">-</span><span class="handle" title="Drag to reorder">&#8597;</span><a class="playlistitem" id="<%= id %>" href="#"><span class="ellipsis_text"><%= title %></span></a><span class="duration"><%= durationStr %></span></li>',playlistItemTemplateSwitchSelector:".videoplayer-playlist-template",controlNext:".videoplayer-control-next",controlPrev:".videoplayer-control-prev",controlPlay:".videoplayer-control-play",controlStop:".videoplayer-control-stop",controlPause:".videoplayer-control-pause",playpositionTemplate:"<%= elapsedTime %> / <%= totalTime %>",tooltipContentBody:".tooltip-content-body",emptyItemHtml:'<li class="empty">I am empty</li>',playlistLink:".playlist-link",inputOrdering:false,descriptionsholder:false,readOnly:false,wmode:"direct",getTooltip:function(j){return j.tooltipContentBody}};var e={};c.extend(e,h);c.extend(e,f);c.extend(this.options,e);this.className="Videoplayer";this.playlistContainer=c(this.options.playlistContainer);this.playlistRepeat=c(this.options.playlistRepeat);this.playlistShuffle=c(this.options.playlistShuffle);this.playposition=c(this.options.playposition);this.nowPlaying=c(this.options.nowPlaying);this.autoplayCheckbox=c(this.options.autoplayCheckbox);this.replaycurrentCheckbox=c(this.options.replaycurrentCheckbox);this.playlistClear=c(this.options.playlistClear);this.playlistLink=c(this.options.playlistLink);this.inputOrdering=this.options.inputOrdering;this.descriptionsholder=c(this.options.descriptionsholder);this.default_description="";this.use_default_description=true;this.inputOrderingTemplate=_.template('<div class="input-order"><input type="text" class="manual-order" id="ordering_<%= id %>" value="<%= order %>" size="2" /><a href="#" class="manual-order-confirm" id="ordering_<%= id %>_confirm" style="display:none;">Reorder</a></div>');this.basePlaylistLink=this.playlistLink.length?c(this.options.playlistLink).attr("href"):null;this.playlistItemTemplate=_.template(this.options.playlistItemTemplate);var i=this.getCookie(this.options.playlistFormatCookie);if(i){var g=c(i);if(g.length){this.playlistItemTemplate=_.template(g.val())}}this.playpositionTemplate=_.template(this.options.playpositionTemplate);_.bindAll(this,"onSetVolume","onPlaylistItemClick","onPlayVideo","onAddVideo","onPlaylistUpdate","onPlaylistRepeat","onPlaylistShuffle","onPlaylistRemove","onReplaycurrentClick","onAutoplayClick","onPlaylistClear","onControlPlay","onControlPause","onControlStop","onControlNext","onControlPrev","updateProgress","onPlaylistChanging","onPlaylistChange","onPlaylistTemplateSwitch");c(this.options.playTrigger).livequery(function(){c(this).click(d.onPlayVideo)});c(this.options.addTrigger).livequery(function(){c(this).click(d.onAddVideo)});this.playlistRepeat.click(this.onPlaylistRepeat);this.playlistShuffle.click(this.onPlaylistShuffle);this.autoplayCheckbox.click(this.onAutoplayClick);this.replaycurrentCheckbox.click(this.onReplaycurrentClick);this.playlistClear.click(this.onPlaylistClear);c(this.options.controlNext).click(this.onControlNext);c(this.options.controlPrev).click(this.onControlPrev);c(this.options.controlPause).click(this.onControlPause);c(this.options.controlStop).click(this.onControlStop);c(this.options.controlPlay).click(this.onControlPlay);c(this.options.playlistItemTemplateSwitchSelector).click(this.onPlaylistTemplateSwitch);this.getTooltip=this.options.getTooltip;this._sortStopTimestamp=0;this._dragging=false;if(!this.options.readOnly){this.playlistContainer.sortable({update:this.onPlaylistUpdate,start:function(){d.log("Start dragging");d._dragging=true},stop:function(){d._dragging=false;d.log("Stop dragging");d._sortStopTimestamp=new Date().getTime()}})}if(this.descriptionsholder){this.default_description=this.descriptionsholder.html();this.use_default_description=true;var d=this;jQuery(".playlistitemli").live("mouseover mouseout",function(j){if(j.type=="mouseover"){var k=c(this).find(".description-content").html();d.use_default_description=false;d.descriptionsholder.html(k)}else{d.descriptionsholder.html(d.default_description);d.use_default_description=true}});jQuery(".video-info").live("mouseover mouseout",function(j){if(j.type=="mouseover"){var k=c(this).find(".description-content").html();d.use_default_description=false;d.descriptionsholder.html(k)}else{d.descriptionsholder.html(d.default_description);d.use_default_description=true}})}jQuery("#playlist-trashcan").droppable({activeClass:"ui-state-active",hoverClass:"ui-state-hover",tolerance:"touch",accept:".playlistitemli",drop:function(j,l){var k=l.draggable.find(".playlistitem").data("video_data");var m=d.getPlaylist();m=_.reject(m,function(n){return n==k});d._ignoreNextUpdate=true;d._removedItem=k;_.defer(function(){d.setPlaylist(m);d._ignoreNextUpdate=false});this.playerContainer.trigger("videoplayer.player.videoremoved")}});if(!this.options.readOnly){jQuery(this.options.videoThumbnail).livequery(function(){c(this).draggable({helper:"clone",zIndex:5400,revert:"invalid",start:function(){d._dragging=true},stop:function(){d._dragging=false}})})}jQuery(this.options.playlistContainer).droppable({activeClass:"ui-state-active",hoverClass:"ui-state-hover",accept:this.options.videoThumbnail,drop:function(j,l){var k=d.extractVideoData(l.draggable);var m=d.getPlaylist();m.push(k);d.setPlaylist(m);jQuery("#playlistcontainer").scrollTop(1000000)}});this.autoplay=this.getCookie(this.options.autoplayCookie)=="yes";if(this.options.autoplay!=null){this.autoplay=this.options.autoplay}this.autoplayCheckbox.attr("checked",this.autoplay?"checked":"");this.replaycurrentCheckbox.attr("checked",this.replaycurrent?"checked":"");if(this.playposition){setInterval(this.updateProgress,500)}b.tmporderinitvalue=false;b.tmpordernewvalue=false;if(this.inputOrdering){c(".manual-order").live("mouseover",function(j){c(this).select()});c(".manual-order").live("focus",function(j){b.tmporderinitvalue=parseInt(c(this).val());c(this).select();confirmid=c(this).attr("id")+"_confirm"});c(".manual-order").live("keyup",function(j){if(c(this).val()!=this.tmporderinitvalue){newval=parseInt(c(this).val());confirmid=c(this).attr("id")+"_confirm";if(isNaN(newval)){return false}if(newval==undefined){return false}if(newval<0){return false}if(newval>d.getPlaylist().length){return false}if(newval==parseInt(b.tmporderinitvalue)){return false}c("#"+confirmid).show();b.tmpordernewvalue=parseInt(newval)}});c(".manual-order-confirm").live("click",function(j){d.switchPlaylistItems(b.tmporderinitvalue,b.tmpordernewvalue);c(this).hide()});c(".manual-order").live("keypress",function(j){if(j.keyCode==13){d.switchPlaylistItems(b.tmporderinitvalue,b.tmpordernewvalue);c(this).parent().find(".manual-order-confirm").hide()}})}this.playerContainer.bind("videoplayer.player.playlistchanging",this.onPlaylistChange);this.clearPlaylist();this.log("Videoplayer constructor done.")};a.prototype=new VideoplayerCore();a.prototype.updateHtml=function(x){var q=this;q.log("Updating html");var v=q.getPlaylist();var t=q.playlistContainer.children().not(".empty");q.playerContainer.trigger("videoplayer.player.playlistupdate",[v]);if(x){t.remove();t=q.playlistContainer.children().not(".empty")}var f={};_.each(v,function(i){f[q.videoSignature(i)]=true});_.each(t,function(y){var z=q.extractPlaylistItemData(y);var i=q.videoSignature(z);if(!f[i]){c(y).remove()}});t=q.playlistContainer.children().not(".empty");existingItemsDict={};_.each(t,function(i){var y=q.extractPlaylistItemData(i);existingItemsDict[q.videoSignature(y)]=i});var p;for(var s=0;s<v.length;s++){var h=v[s];var j=q.videoSignature(h);var k=existingItemsDict[j];var g=q.playlistContainer.children().not(".empty");var m;if(k){var l=q.extractPlaylistItemData(g[0]);if(l!=h){if(!s){c(k).prependTo(q.playlistContainer)}else{var u=g[s-1];c(k).insertAfter(c(u))}}m=k;if(q.inputOrdering){c(k).find(".manual-order").attr("value",(s+1))}}else{var o=_.uniqueId("playlistitem_");var e={id:o,title:h.title,durationStr:q.formatTime(h.duration),description:h.description,dateStr:h.dateStr,thumbnailUrl:h.thumbnailUrl,tooltipContentBody:h.tooltipContentBody};var w=q.playlistItemTemplate(e);p=c(w);if(q.inputOrdering){var r={id:o,order:(s+1)};inputorderelement=c(q.inputOrderingTemplate(r));c(inputorderelement).prependTo(p)}if(!s){c(p).prependTo(q.playlistContainer)}else{var u=g[s-1];c(p).insertAfter(c(u))}m=p;p=c("#"+o);p.data("video_data",h);p.click(q.onPlaylistItemClick);p.parents("li").slice(0,1).find("."+q.options.playlistItemRemoveClass).click(q.onPlaylistRemove)}var p=c(m).find(q.options.playlistItem);var d=null;var n=q.getCurrentVideo();if(n){d=n.video_id}if(q.getUsePlaylist()&&(h.video_id==d)){p.addClass(q.options.currentItemClass)}else{p.removeClass(q.options.currentItemClass)}}if(q.getCurrentVideo()!==null){q.nowPlaying.text(q.getCurrentVideo().title);q.default_description=q.getTooltip(q.getCurrentVideo());if(q.use_default_description&&q.descriptionsholder){q.descriptionsholder.html(q.default_description)}}this.playlistRepeat.attr("checked",this.getAutorepeat()?"checked":"");this.playlistShuffle.attr("checked",this.getShuffle()?"checked":"");this.updateProgress();this.log("Done updating html")};a.prototype.switchPlaylistItems=function(e,d){var f=this.getPlaylist().slice(0);tmpitem=f[d-1];f[d-1]=f[e-1];f[e-1]=tmpitem;this.setPlaylist(f);this.playlistContainer.trigger("videoplayer.playlist.orderchanged")};a.prototype.formatTime=function(h){if(h<0){h=0}var f=Math.floor(h/3600),e=Math.floor(h-f*3600),g=Math.floor(e/60),i=e-g*60,d=""+(f?f+":":"")+((g<10)&&f?"0":"")+g+":"+(i<10?"0":"")+i;return d};a.prototype.onPlaylistItemClick=function(d){this.log("onPlaylistItemClick");d.preventDefault();var g=d.currentTarget;var f=c(g).data("video_data");var e=new Date().getTime();this.log(e);this.log(this._sortStopTimestamp);this.log(e-this._sortStopTimestamp);if((f!=this._removedItem)&&((e-this._sortStopTimestamp)>=50)){this.log(f);this.playFromPlaylist(f,this.AUTOSTART)}};a.prototype.onPlayVideo=function(d){this.log("onPlayVideo");d.preventDefault();var e=this.extractVideoData(c(d.currentTarget));this.log(e);this.playSingleVideo(e,this.AUTOSTART)};a.prototype.onAddVideo=function(d){this.log("onAddVideo");d.preventDefault();var e=this.extractVideoData(c(d.currentTarget));var f=this.getPlaylist();f.push(e);this.setPlaylist(f);this.log("onAddVideo done.")};a.prototype.onPlaylistClear=function(d){d.preventDefault();this.setPlaylist([])};a.prototype.updatePlaylistFromHtml=function(){var d=this,e=_.map(d.playlistContainer.find(d.options.playlistItem),function(f){return c(f).data("video_data")});this.setPlaylist(e)};a.prototype.onPlaylistUpdate=function(d,e){this.log("onPlaylistUpdate");if(!this._ignoreNextUpdate){this._ignoreNextUpdate=false;this.updatePlaylistFromHtml()}};a.prototype.onPlaylistRemove=function(e){e.preventDefault();var d=c(e.currentTarget).parents("li");d.remove();this.updatePlaylistFromHtml()};a.prototype.onPlaylistRepeat=function(e){this.log("onPlaylistRepeat");var d=false;if(this.playlistRepeat.attr("checked")){d=true}this.setAutorepeat(d)};a.prototype.onReplaycurrentClick=function(d){this.log("onReplayCurrent");var e=false;if(this.replaycurrentCheckbox.attr("checked")){e=true}this.setReplayCurrent(e)};a.prototype.onPlaylistShuffle=function(e){this.log("onPlaylistShuffle");var d=false;if(this.playlistShuffle.attr("checked")){d=true}this.setShuffle(d)};a.prototype.extractVideoData=function(e){var d,f;d=c(e);while(d.length){f=d.metadata();if(f.source){f.title=d.find(this.options.videoTitle).text();f.description=d.find(this.options.videoDescription).html();f.thumbnailUrl=d.find(this.options.videoThumbnail).attr("src");f.tooltipContentBody=d.find(this.options.tooltipContentBody).html();return f}d=d.parent()}};a.prototype.extractPlaylistItemData=function(d){if(c(d).is(this.options.playlistItem)){return c(d).data("video_data")}return c(d).find(this.options.playlistItem).data("video_data")};a.prototype.addVideo=function(e){var d=this;var f=this.getPlaylist();_.each(e,function(g){var h=d.extractVideoData(g);f.push(h)});this.setPlaylist(f)};a.prototype.onAutoplayClick=function(d){this.log("onAutoplayClick");if(this.autoplayCheckbox.attr("checked")){this.setCookie(this.options.autoplayCookie,"yes")}else{this.removeCookie(this.options.autoplayCookie)}};a.prototype.onControlPlay=function(d){d.preventDefault();this.log("onControlPlay");this.playVideo()};a.prototype.onControlPause=function(d){d.preventDefault();this.log("onControlPause");this.pauseVideo()};a.prototype.onControlStop=function(d){d.preventDefault();this.log("onControlStop");this.currentPlayer.preloadVideo()};a.prototype.onControlNext=function(d){d.preventDefault();this.log("onControlNext");this.playNextPlaylistVideo()};a.prototype.onControlPrev=function(d){d.preventDefault();this.log("onControlPrev");this.playPrevPlaylistVideo()};a.prototype.updateProgress=function(){if(!this.playposition){return}if(this.getUsePlaylist()){if(this.isPlayerReady()){if(this.isActiveState()){var d=this.getPlaylistData();var e={totalTime:this.formatTime(d.totalDuration),elapsedTime:this.formatTime(d.currentPosition),remainingTime:this.formatTime(d.totalDuration-d.currentPosition)};var f=this.playpositionTemplate(e);this.playposition.html(f)}}else{}}else{this.playposition.text("")}};a.prototype.onPlaylistChanging=function(d,e){if(e.length){if(this.playlistContainer.is(".empty")){this.playlistContainer.removeClass("empty");this.playlistContainer.sortable("enable");this.playlistContainer.empty()}}else{if(!this.playlistContainer.is(".empty")){this.playlistContainer.addClass("empty");this.playlistContainer.sortable("disable");this.playlistContainer.append(c(this.options.emptyItemHtml))}}};a.prototype.onPlaylistChange=function(){this.updatePlaylistLink()};a.prototype.updatePlaylistLink=function(){if(this.basePlaylistLink){var e=this.getPlaylist();var f=_.map(e,function(g){return g.video_id});var d=this.basePlaylistLink+"videos="+f.join("+");this.playlistLink.attr("href",d)}};a.prototype.setPlaylistItemTemplate=function(d,e){this.options.playlistItemTemplate=d;this.playlistItemTemplate=_.template(this.options.playlistItemTemplate);if(!e){this.updateHtml(true)}};a.prototype.onPlaylistTemplateSwitch=function(e){e.preventDefault();var g=c(e.currentTarget);var d=g.attr("href");var f=c(d);this.setCookie(this.options.playlistFormatCookie,d);this.setPlaylistItemTemplate(f.val())};a.prototype.setCookie=function(f,e){var d=new Date();d.setFullYear(d.getFullYear()+10);c.cookies.set(f,e,{expiresAt:d})};a.prototype.getCookie=function(d){return c.cookies.get(d)};a.prototype.removeCookie=function(d){c.cookies.del(d)};b.Videoplayer=a})(window,jQuery);