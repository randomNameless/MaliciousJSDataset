"use strict";function selectorClassMod(e,t,a){const o=Array.from(document.querySelectorAll(e));if(o.length>0)for(const e of o)try{"add"===a?e.classList.add(t):e.classList.remove(t)}catch(r){}}function singleSelectorClassMod(e,t,a,o){if(!o)return;const r=o.querySelector(e);r&&("add"===a?r.classList.add(t):r.classList.remove(t))}function selectorClassRemove(e,t){selectorClassMod(e,t,"remove")}function selectorClassAdd(e,t){selectorClassMod(e,t,"add")}function singleSelectorClassRemove(e,t,a=document){singleSelectorClassMod(e,t,"remove",a)}function singleSelectorClassAdd(e,t,a=document){singleSelectorClassMod(e,t,"add",a)}function documentIsReady(e){"complete"===document.readyState||"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}function createCircle(e,t){for(var a,o,r,i={latitude:parseFloat(e[1]),longitude:parseFloat(e[0])},n=1.60934*t,s=64,l=[],d=n/(111.32*Math.cos(i.latitude*Math.PI/180)),c=n/110.574,p=0;p<s;p++)a=p/s*(2*Math.PI),o=d*Math.cos(a),r=c*Math.sin(a),l.push({lng:i.longitude+o,lat:i.latitude+r});return l}function getColorAndProperty(){var e=pageType,t={};return"show"==e?(t.c="brown",t.p="o"):"real_estate"==e?(t.c="green",t.p="r"):"demography"==e?(t.c="red_blue",t.p="d"):"crime"==e?(t.c="blue",t.p="c"):"schools"==e&&(t.c="purple",t.p="s"),t}function getMapImageName(){var e="",t=document.getElementById("tmp_map");return t&&(e=t.getAttribute("image-src")),e||""}function removeTemporaryMap(){isUnified||""==getMapImageName()||setTimeout(function(){var e=document.getElementById("tmp_map");null!=e&&e.classList.add("hide")},50)}documentIsReady(()=>{const e=()=>{const e=document.querySelector('meta[name="csrf-token"]').content,t=location.pathname.split("/").filter(e=>""!==e&&"crimerisk"!=e),a=["real-estate","demographics","crime","schools"],o={},r="/home_listing_partners";if(location.pathname.includes("zipcode")){const e=t[t.length-1];e&&(o.zipcode=e)}else{const e=t[1],r=t[2],i=t[3];e&&(o.state=e),r&&(o.city=r),i&&!a.includes(i)&&(o.neighborhood=i)}fetch(r,{method:"POST",body:JSON.stringify(o),headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-Token":e}}).then(e=>{if(e.ok)return e.json()})},t=document.querySelector("#home-for-sale");t&&t.addEventListener("click",e)});var primaryDataLoaded=!1;const slideoutToggle=document.getElementById("slideoutToggle"),sliderLinks=document.getElementById("sliderLinks");slideoutToggle&&sliderLinks&&slideoutToggle.addEventListener("click",function(){sliderLinks.classList.toggle("active")});var jsWorker,isMobile=window.matchMedia("only screen and (max-width: 760px)"),PALETTE={brown:["#ffff80","#fde96e","#fdd75c","#f7c349","#f5af36","#e39529","#c46e1b","#a64b12","#872a08","#6a0000"],green:["#e4efe8","#cbe0d1","#b0d0bb","#96bfa5","#7caf8e","#61a077","#489061","#388653","#357649","#326c44"],red_blue:["#da0000","#fe0000","#ff5b5b","#ff9f9f","#ffd1d1","#f6f6f6","#cfe4ef","#90c4dd","#4291c2","#2065ab","#07488f"],blue:["#0413A1","#081EDE","#303AF9","#5258EA","#7E81FC","#9294F8","#ABADFC","#BDBEFD","#DDDEFE","#F3F3FF"],purple:["#f0e8fa","#e0d1f6","#d1baf1","#c2a4ed","#b18de8","#a277e4","#9361e0","#844cdc","#7537d8","#6627d3"]},EPSILON=1e-6,element="",LO_RES=1,HI_RES=0,dataBounds=[null,null],lastZoom=0,LIdata=document.getElementById("maplite"),displayHomeSale="true"==LIdata.dataset.displayhomesale,UrlSuffix=LIdata.dataset.urlsuffix,HIGH_RES_MODE="true"==LIdata.dataset.highresmode,MAPS_LOAD_DELAY=parseInt(LIdata.dataset.mapsloaddelay),viewportBounds=[parseFloat(LIdata.dataset.boundsminy),parseFloat(LIdata.dataset.boundsminx),parseFloat(LIdata.dataset.boundsmaxy),parseFloat(LIdata.dataset.boundsmaxx)],objId=parseInt(LIdata.dataset.objid),accessToken=LIdata.dataset.accesstoken,assetHost=LIdata.dataset.assethost,captureMapImage="true"==LIdata.dataset.captureimage,isUnified="true"==LIdata.dataset.isunifiedneighborhood,workersSupported="false"!=LIdata.dataset.workerssupported&&"undefined"!=typeof Worker,crimeriskSession="true"==LIdata.dataset.crimerisksession,crimeRiskPrefix=LIdata.dataset.crimeriskprefix,noWorkerURL=LIdata.dataset.noworkerurl,mapboxCSS=LIdata.dataset.mapboxcss,mapboxJS=LIdata.dataset.mapboxjs,activetab=LIdata.dataset.activetab,objType=LIdata.dataset.objtype,showCrimeRiskCircle=("neighborhoods"==objType||"cities"==objType&&isUnified||"zip_codes"==objType)&&crimeriskSession,crimeRiskCircleRadius=LIdata.dataset.crimeriskcircleradius,pageType=LIdata.dataset.pagetype,domainURL=LIdata.dataset.domainurl,whatToRender=objType,prevWhatToRender="",mapboxLoaded=!1,initialWorkerMessageReceived=!1,mapPrimaryDisplayData=[],mapOutlineDisplayData=[],mapSecondaryDisplayData=[],mapLegalCityBoundaryData=[],mapCircleRadiusData=[],mapCircleRadiusCenterData=[],lat=parseFloat(LIdata.dataset.lat),lng=parseFloat(LIdata.dataset.lng);const polygonToggles=document.getElementById("polygon-toggles");polygonToggles&&(document.querySelector(".maplite-links").classList.contains("active")?polygonToggles.classList.add("polygon-links"):polygonToggles.classList.add("polygon-no-links"));var cvalue=MAPS_LOAD_DELAY;setTimeout(function(){if(0==workersSupported){var e=document.createElement("script");e.src=noWorkerURL,e.async=!1,document.body.appendChild(e)}var t=document.createElement("link");t.href=mapboxCSS,t.rel="stylesheet",t.type="text/css",t.onload=function(){var e=mapboxJS,t=document.createElement("script");t.src=e,t.async=!1,t.onload=function(){function e(e,t){return e[0]>=t[0][0]-EPSILON&&e[0]<=t[1][0]+EPSILON&&e[1]>=t[0][1]-EPSILON&&e[1]<=t[1][1]+EPSILON}function t(t,a){return e(t[0],a)&&e(t[1],a)}function a(){var e,t=x.getMap();0!=mapboxLoaded&&(mapPrimaryDisplayData.length>0&&(e=t.getSource("primaryLayerSource"))&&e.setData({type:"FeatureCollection",features:mapPrimaryDisplayData}),mapOutlineDisplayData.length>0&&(e=t.getSource("outlineLayerSource"))&&e.setData({type:"FeatureCollection",features:mapOutlineDisplayData}),mapSecondaryDisplayData.length>0&&(e=t.getSource("secondaryLayerSource"))&&e.setData({type:"FeatureCollection",features:mapSecondaryDisplayData}),mapCircleRadiusData.length>0&&(e=t.getSource("crime-risk-radius"))&&e.setData({type:"FeatureCollection",features:mapCircleRadiusData}),mapCircleRadiusCenterData.length>0&&(e=t.getSource("crime-risk-radius-center"))&&e.setData({type:"FeatureCollection",features:mapCircleRadiusCenterData}),mapLegalCityBoundaryData.length>0&&(e=t.getSource("legal-city-boundaries"))&&e.setData({type:"FeatureCollection",features:mapLegalCityBoundaryData}))}function o(e){function t(){}t.prototype.onAdd=function(e){this._map=e;const t=document.getElementById("control-div");return this._container=document.createElement("div"),t&&this._container.append(t),this._container.className="mapboxgl-ctrl home-listing",this._container},t.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=undefined};const a=document.getElementById("control-div");if(a){a.style.display="block";var o=new t;e.addControl(o,"top-right")}}function r(){function e(){}e.prototype.onAdd=function(e){this._map=e;const t=document.querySelector(".map-style-btn");return this._container=document.createElement("div"),t&&(t.style.display="block",this._container.append(t)),this._container.className="mapboxgl-ctrl change-style",this._container},e.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=undefined};var t=x.getMap(),a=new e;t.addControl(a,"top-left")}function i(e){return{container:"map",lnglatbounds:e,bearing:-17.6,zoom:5,scrollWheelZoom:!1,preserveDrawingBuffer:!0,style:"mapbox://styles/ckokkinos/cjqxzkw8l0orl2sqhlkxzp5xm?optimize=true"}}function n(){mapboxgl.accessToken=accessToken;var e=new mapboxgl.LngLatBounds(new mapboxgl.LngLat(viewportBounds[1],viewportBounds[0]),new mapboxgl.LngLat(viewportBounds[3],viewportBounds[2])),t=new mapboxgl.Map(i(e,""));if(isMobile.matches)t.fitBounds(e,{padding:{top:10,bottom:10,left:10,right:10},duration:0});else if(isUnified||"neighborhoods"==objType){const a={top:100,bottom:100,left:20,right:20};t.fitBounds(e,{padding:a,duration:0}),window.addEventListener("message",o=>{"overview-tab-click"==o.data.type&&(t.resize(),t.fitBounds(e,{padding:a,duration:0}))})}else if("cities"==objType)t.fitBounds(e,{padding:{top:60,bottom:60,left:10,right:10},duration:0}),t.setZoom(Math.floor(t.getZoom()));else if("states"==objType){t.fitBounds(e,{padding:{top:0,bottom:0,left:0,right:0},duration:0});var a=Math.floor(t.getZoom()-.2);t.setZoom(Math.floor(a))}else t.fitBounds(e,{padding:{top:160,bottom:160,left:10,right:10},duration:0});return t.addControl(new mapboxgl.NavigationControl,"bottom-right"),t.scrollZoom.disable(),t}function s(e){S(e),D(e),showCrimeRiskCircle?C(e):y(e),T(e)}function l(){if(!isUnified){var e=getMapImageName();""!=e&&setTimeout(function(){var t=x.getMap().getCanvas(document.querySelector("mapboxgl-canvas")),a=t.toDataURL("image/webp",.1),o=t.toDataURL("image/jpeg",.1);const r=new FormData,i=document.querySelector('meta[name="csrf-token"]').content;r.append("imageName",e),r.append("jpgBase64",o),r.append("webpBase64",a),fetch("/imagestore/saveimage/",{method:"POST",body:r,headers:{"X-CSRF-Token":i}})},2e3)}}function d(e){v(),lastZoom=e.getZoom(),prevWhatToRender=objType,e.on("load",function(){const e=document.getElementById("loading_container");e&&e.remove();var t=x.getMap(),a=new mapboxgl.Popup({offset:5,closeButton:!0,focusAfterOpen:!1});if(a.className="map-info",m(t),s(t),g(t,a),r(),displayHomeSale){o(t);for(var i=document.getElementById("map").getElementsByClassName("mapboxgl-ctrl-attrib")[0].getElementsByTagName("A"),n=0;n<i.length;n++)i[n].setAttribute("rel","noopener")}whatToRender=objType,mapboxLoaded=!0}),e.on("zoomend",function(){}),e.on("moveend",function(){viewportBounds=p(e.getBounds().toArray()),c()})}function c(){var e=x.getMap(),a=HIGH_RES_MODE,o=e.getZoom();whatToRender=objType;var r=e.getBounds().toArray();"zip_codes"==objType&&(0==lastZoom||Math.abs(o-lastZoom)<=EPSILON)?whatToRender=objType:o>11?whatToRender="neighborhoods":o<=11&&o>7?whatToRender="cities":o<=9&&(whatToRender="states");var i=(HIGH_RES_MODE=o>=10)?HI_RES:LO_RES;prevWhatToRender==whatToRender&&a==HIGH_RES_MODE&&null!=dataBounds[i]&&0!=t(r,dataBounds[i])||(M(),dataBounds[i]=r),lastZoom=o,prevWhatToRender=whatToRender}function p(e){var t=3*(e[1][1]-e[0][1])/100,a=3*(e[1][0]-e[0][0])/100;return[e[0][1]-t,e[0][0]-a,e[1][1]+t,e[1][0]+a]}function u(e){e.on("style.load",function(){m(e),s(e),a(e)})}function m(e){e.getSource("primaryLayerSource")||e.addSource("primaryLayerSource",{type:"geojson",data:{type:"FeatureCollection",features:mapPrimaryDisplayData}}),e.getSource("outlineLayerSource")||e.addSource("outlineLayerSource",{type:"geojson",data:{type:"FeatureCollection",features:mapOutlineDisplayData}}),e.getSource("secondaryLayerSource")||e.addSource("secondaryLayerSource",{type:"geojson",data:{type:"FeatureCollection",features:mapSecondaryDisplayData}}),e.getSource("legal-city-boundaries")||e.addSource("legal-city-boundaries",{type:"geojson",data:{type:"FeatureCollection",features:mapLegalCityBoundaryData}}),e.getSource("crime-risk-radius")||e.addSource("crime-risk-radius",{type:"geojson",data:{type:"FeatureCollection",features:mapCircleRadiusData}}),e.getSource("crime-risk-radius-center")||e.addSource("crime-risk-radius-center",{type:"geojson",data:{type:"FeatureCollection",features:mapCircleRadiusCenterData}})}function y(e){if("neighborhoods"==objType||isUnified&&"zip_codes"!=objType)e.getLayer("primary-line")||e.getLayer("primary-fill")||(e.addLayer({id:"primary-fill",type:"fill",source:"primaryLayerSource",layout:{},paint:{"fill-color":"#191970","fill-opacity":.25}}),e.addLayer({id:"primary-line",type:"line",source:"primaryLayerSource",layout:{},paint:{"line-color":"#191970","line-opacity":1,"line-width":2}}));else if(!e.getLayer("primary-line")&&!e.getLayer("primary-fill")){var t=["feature-state","hover"];e.addLayer({id:"primary-fill",type:"fill",source:"primaryLayerSource",layout:{},paint:{"fill-color":f(),"fill-opacity":["case",["boolean",t,!1],0,.8]}}),e.addLayer({id:"primary-line",type:"line",source:"primaryLayerSource",layout:{},paint:{"line-color":["case",["boolean",t,!1],"#b7404d","#fff"],"line-opacity":1,"line-width":["case",["boolean",t,!1],1,.2]}})}}function f(){var e=getColorAndProperty(),t=e.c,a=["get",e.p];return["case",["==",a,1],PALETTE[t][0],["==",a,2],PALETTE[t][1],["==",a,3],PALETTE[t][2],["==",a,4],PALETTE[t][3],["==",a,5],PALETTE[t][4],["==",a,6],PALETTE[t][5],["==",a,7],PALETTE[t][6],["==",a,8],PALETTE[t][7],["==",a,9],PALETTE[t][8],["==",a,10],PALETTE[t][9],PALETTE[t][0]]}function g(e,t){function a(e,a,o){e.on("mousemove",a,function(a){selectorClassRemove(".maplite-links li","active"),u!=a.features[0].properties.id&&(i(),m=o,e.getCanvas().style.cursor="pointer",h(e,t,a),e.setFeatureState({source:o,id:u},{hover:!1}),u=a.features[0].properties.id,e.setFeatureState({source:o,id:u},{hover:!0}))}),e.on("mouseleave",a,function(t){0==e.queryRenderedFeatures(t.point,{layers:[a]}).length&&i()})}function o(a){p!=a.features[0].properties.id&&(i(),e.getCanvas().style.cursor="pointer",h(e,t,a),e.setFeatureState({source:"primaryLayerSource",id:p},{hover:!1}),p=a.features[0].properties.id,e.setFeatureState({source:"primaryLayerSource",id:p},{hover:!0}),window.parent.postMessage({type:"mouse-move",hoveredStateId:p},"*"))}function r(){for(var t=["secondary-line","primary-fill"],a=new mapboxgl.Popup({offset:25,closeButton:!0}),o=0;o<t.length;o++)e.on("click",t[o],function(t){var o=t.features[0].properties.url,r=o.split("/").length<3?UrlSuffix:"";if(a.isOpen()&&a.remove(),1!=isMobile.matches)window.top.location.href=E(o,r);else{e.getCanvas().style.cursor="pointer";var i=JSON.parse(t.features[0].properties.centroid),n=domainURL+crimeRiskPrefix+o+r;(a=new mapboxgl.Popup({offset:25,closeButton:!0})).className="map-info",a.setLngLat(i).setHTML('<div><a style="font-size: 18px" target="_top" href="'+n+'">'+t.features[0].properties.name+"</a> </div>").addTo(e)}})}function i(){p&&e.setFeatureState({source:"primaryLayerSource",id:p},{hover:!1}),u&&e.setFeatureState({source:m,id:u},{hover:!1}),u=null,p=null,t.remove()}function n(e,t){t.length>0&&(p&&e.setFeatureState({source:"primaryLayerSource",id:p},{hover:!1}),p=t[0].properties.id,e.setFeatureState({source:"primaryLayerSource",id:p},{hover:!0}))}function s(){try{window.addEventListener("message",e=>{"link-mouse-enter"==e.data.type&&l(e),"link-mouse-exit"==e.data.type&&d()})}catch(e){}}function l(e){var a=x.getMap(),o=a.queryRenderedFeatures({layers:["primary-fill"],filter:["==","id",e.data.hoveredLink]});if(n(a,o),o[0]!=undefined){var r="<div>"+o[0].properties.name+"</div>",i=JSON.parse(o[0].properties.centroid);t.setLngLat(i).setHTML(r).addTo(a)}}function d(){i();x.getMap();selectorClassRemove(".maplite-links li","active")}function c(){const e=Array.from(document.querySelectorAll(".maplite-map"));for(var t of e)t.addEventListener("mouseleave",function(){i()})}var p=null,u=null,m="";a(e,"secondary-line","secondaryLayerSource"),e.on("mousemove","primary-fill",o),e.on("mouseleave","primary-fill",function(t){0==e.queryRenderedFeatures(t.point,{layers:["primary-fill"]}).length&&i()}),s(),r(),s(),c(e,t)}function L(e,t){"Satellite"==t?e.setStyle("mapbox://styles/mapbox/satellite-streets-v10"):e.setStyle("mapbox://styles/ckokkinos/cjj9zuyox4q1l2rsuj9fql56x")}function v(){const e=document.querySelectorAll(".style-btn");for(var t of e)t.addEventListener("click",function(){var e=x.getMap();L(e,this.textContent),this.textContent="Satellite"==this.textContent?"Map":"Satellite",u(e)})}function h(e,t,a){if(!isMobile.matches){if(element!=a.features[0].properties.name){var o=JSON.parse(a.features[0].properties.centroid),r="<div>"+a.features[0].properties.name+"</div>";t.setLngLat(o).setHTML(r).addTo(e),element=a.features[0].properties.name}t.addTo(e)}}function b(){var e=["get","type"];return["case",["==",e,"neighborhood"],"#b7404d",["==",e,"blockgroup"],"#ffff00","#b7404d"]}function S(e){e.getLayer("outline-line")||e.getLayer("outline-line-hover")||e.addLayer({id:"outline-line",type:"line",source:"outlineLayerSource",layout:{},paint:{"line-color":b(),"line-opacity":1,"line-width":3}})}function k(e,t,a){if(!e.getLayer(t)&&!e.getLayer(r)){var o=["feature-state","hover"],r=t+"-hover";e.addLayer({id:t,type:"fill",source:a,layout:{},paint:{"fill-color":"#b7404d","fill-opacity":0}}),e.addLayer({id:r,type:"line",source:a,layout:{},paint:{"line-color":"#b7404d","line-opacity":["case",["boolean",o,!1],1,0],"line-width":2}})}}function D(e){k(e,"secondary-line","secondaryLayerSource")}function T(e){isUnified||e.getLayer("legal-city-boundaries-outline")||e.loadImage("/polka-dotted-pattern.png",(t,a)=>{t||(e.addImage("polka-dot",a),e.addLayer({id:"legal-city-boundaries-outline",type:"line",source:"legal-city-boundaries",filter:["==",["get","id"],objId],layout:{},paint:{"line-color":"#000","line-width":2}}),e.addLayer({id:"legal-city-boundaries-fill",type:"fill",source:"legal-city-boundaries",filter:["==",["get","id"],objId],paint:{"fill-pattern":"polka-dot","fill-opacity":.2,"fill-opacity-transition":{duration:0}}}))})}function C(e){e.addLayer({id:"crime-risk-radius",type:"fill",source:"crime-risk-radius",layout:{},paint:{"fill-color":"#272e3d","fill-opacity":.1}}),e.addLayer({id:"crime-risk-radius-center",type:"circle",source:"crime-risk-radius-center",layout:{},paint:{"circle-radius":6,"circle-color":"#272e3d","circle-opacity":.8}})}function E(e,t){return crimeriskSession?domainURL+crimeRiskPrefix+e:domainURL+(activetab?e+"/"+activetab:e)+t}function I(){var e=x.getMap();viewportBounds=p(e.getBounds().toArray()),c(),d(e)}function w(e,t){return[{type:"Feature",geometry:{type:"Polygon",coordinates:[createCircle(e,t).map(e=>[e.lng,e.lat])]}}]}function R(e){return[{type:"Feature",geometry:{type:"Point",coordinates:e}}]}function M(){var e={objId:objId,objType:objType,whatToRender:whatToRender,assetHost:assetHost,workersSupported:workersSupported,excludePrimary:1==crimeriskSession&&("neighborhoods"==objType||"cities"==objType&&1==isUnified),HIGH_RES_MODE:HIGH_RES_MODE,bounds_min_x:viewportBounds[1],bounds_min_y:viewportBounds[0],bounds_max_x:viewportBounds[3],bounds_max_y:viewportBounds[2]};if(workersSupported)jsWorker.postMessage(e);else{noWorkerGetData(e);var t=setInterval(o,100);function o(){if(frameDataLoaded){clearInterval(t);var e=workersSupported?"":"no-";console.log("Initial "+e+"worker response; calling renderMap"),mapPrimaryDisplayData=primaryDisplayData,mapOutlineDisplayData=outlineDisplayData,mapSecondaryDisplayData=secondaryDisplayData,mapLegalCityBoundaryData=legalCityBoundaryData,a()}}}}function _(){(workersSupported&&initialWorkerMessageReceived&&mapboxLoaded||!workersSupported&&mapboxLoaded)&&(clearInterval(B),workersSupported||removeTemporaryMap(),a(map),primaryDataLoaded=!0)}var x=function(){function e(){return n()}var t;return{getMap:function(){return t||(t=e()),t}}}();workersSupported?(jsWorker=new Worker("/mapworker.js")).addEventListener("message",function(e){var t=e.data;if(mapPrimaryDisplayData=t[0],"zip_codes"==objType&&crimeriskSession||(mapOutlineDisplayData=t[1]),mapSecondaryDisplayData=t[2],mapLegalCityBoundaryData=t[3],crimeriskSession&&"zip_codes"==objType)var o=[lng,lat];else o=mapPrimaryDisplayData[0].properties.centroid;console.log(o),mapCircleRadiusData=w(o,crimeRiskCircleRadius),mapCircleRadiusCenterData=R(o),initialWorkerMessageReceived=!0,a(),removeTemporaryMap(),captureMapImage&&l()},!1):M(),I();var B=setInterval(_,100)},document.body.appendChild(t)},document.body.appendChild(t)},cvalue);