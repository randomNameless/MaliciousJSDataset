(function(k,m,d){var e=k.sharetools=k.sharetools||{},i,o,g,p,c,f,b,l,n,j,a,h=e.log=function(){if(!e.env.isDebugModeOn()){h=false;return h}try{return k.console&&k.console.log(arguments)}catch(q){return false}};e.VERSION="0.4.1";a=e.config=e.config||{services:{delicious:{title:"Delicious",enabled:true},digg:{title:"Digg",enabled:true},facebook:{title:"Facebook",enabled:true},google:{title:"Google",enabled:true},linkedin:{title:"Linkedin",enabled:true},reddit:{title:"Reddit",enabled:true},stumbleupon:{title:"StumbleUpon",enabled:true},tumblr:{title:"Tumblr",enabled:false},twitter:{title:"Twitter",enabled:true}}};e.enableService=function(r,q){if(a&&a.services&&a.services[r]){a.services[r].enabled=!q;e.ui.ShareToolbar.init()}};e.shortenURL=function(r){if(e.shortenURL.validURLRegex.test(r)){var q;try{q=o.net.get(f("/modules/share/service/shrink?url="+k.encodeURIComponent(r)),{timeout:5,useCache:true,async:false})}catch(t){return false}if(q&&q.wasSuccessful&&q.json){var s=q.json();if(s&&s.url){return s.url}}}return false};e.shortenURL.validURLRegex=new RegExp("^https?:\\/\\/([^\\/]+)?\\.bbc\\.(co\\.uk|com)\\/");(function(){e.util={apply:function(t,q){var s,r={};for(s in t){r[s]=t[s]}return e.util.applyTo(r,q)},applyTo:function(s,q){for(var r in q){s[r]=q[r]}return s},encodeURL:function(q){return o.data.encodeUrl(q)},decodeURL:function(q){q=q.replace(/\+/g," ");return o.data.decodeUrl(q)},loadScript:function(r,q){q=q||m.body;var s=m.createElement("script");s.async=true;s.src=r;q.appendChild(s)},getCurrentStyle:function(u,s){if(k.getComputedStyle){if(!(u instanceof o.dom.NodeList)){u=i(u)}return u.css(s)}if(u instanceof o.dom.NodeList){u=u[0]}if(s=="font-size"){s="fontSize"}var v,q,r=u.currentStyle&&u.currentStyle[s],t=u.style;v=t.left;q=u.runtimeStyle.left;u.runtimeStyle.left=u.currentStyle.left;t.left=s==="fontSize"?"1em":(r||0);r=t.pixelLeft+"px";t.left=v;u.runtimeStyle.left=q;return r===""?"auto":r},trimAndEncodeParams:function(D,B,H){H=H||1800;var y={},v,E,G,w=0,u=0,q=0,r,t={};for(var A=0;B&&A<B.length;A++){t[B[A]]=!0}for(var C in D){v=y[C]=encodeURIComponent(D[C]);E=v.length;if(E>q&&!t[C]){q=E;r=C}G=v.match(/(%[0-9a-f][0-9a-f]|[&=])/gi)||[];u+=E+C.length+G.length*2+(w>0?6:3);w++}var x=u-H;if(x>0){var F=D[r];h&&h("Facebook params too long, shortening: "+r);F=F.substring(0,F.length-x-3);F+="...";y[r]=encodeURIComponent(F)}var z="";for(C in y){z+=(z===""?"":"&")+C+"="+y[C]}return z}}})();(function(){var s="function",q={ready:false},r=function(t){return t.substring(0,1).toUpperCase()+t.substring(1)};e.ready=function(t){e.events.addListener(e,"ready",t)};e.events={fire:function(u,t,v){if(q[t]!==d){q[t]=true}if(o){o.events.fire(u,t,v)}var w="on"+r(t);if(typeof u[w]==s){u[w](v)}},addListener:function(u,t,w,v){if(q[t]){w.call(v)}return(o)?o.events.addListener(u,t,w,v):d},removeListener:function(t){return(o)?o.events.removeListener(t):false}}})();(function(){e.facebook={APP_ID:"58567469885",useFBConnect:!!(e.facebook&&e.facebook.useFBConnect),connect:(function(){var u="//connect.facebook.net/en_GB/all.js",s="//static.ak.fbcdn.net/connect/en_US/core.debug.js",t,v=false,r,q,w=function(y){var z={name:y.title,href:y.getShortUrl()};if(y.desc){z.description=y.desc}if(y.imageUrl){z.media=[{type:"image",src:y.imageUrl,href:y.getShortUrl()}]}var x;t.login(function(A){if(A&&A.session){x=new o.widgets.Mask({opacity:0.75});x.add();t.ui({method:"feed",message:y.facebookMessage,attachment:z},function(){x.remove()})}})};return{init:function(){if(k.fbAsyncInit&&typeof k.fbAsyncInit=="function"){q=k.fbAsyncInit}k.fbAsyncInit=function(){if(!t){t=k.FB;t.init({appId:e.facebook.APP_ID,status:true,cookie:true,xfbml:true,channelUrl:f("callback/facebook/channel"+(k.location.protocol=="https:"?"-ssl":"")+".html")});if(o){p(e,"facebookLoaded")}}if(q){q()}};if(k.location.search=="?fb_xd_fragment"){e.facebook.load()}},load:function(){if(!r){r=m.createElement("div");r.id="fb-root";m.body.appendChild(r)}e.util.loadScript(m.location.protocol+(e.env.isDebugModeOn()?s:u),r)},share:function(x){if(t){w(x)}else{e.facebook.load();if(!v){g(e,"facebookLoaded",function(){w(x)});v=true}}}}})(),dialog:{auth:function(t,u,s){t=t||"auth";var q=f("callback?st_cb=facebook")+"#",r=e.ui.openPopup("https://www.facebook.com/dialog/oauth",{scope:"publish_stream",client_id:e.facebook.APP_ID,redirect_uri:q,response_type:"token",state:t,display:"popup"},{width:627,height:326});e.facebook.xd.waitForMessage(t,r,function(v){if(v.access_token){e.facebook.accessToken=v.access_token}r.close();if(v.access_token&&u){u()}})},feed:function(v,u){var t=u.hasDisabledFacebookPanel||o.env.ie<7;if(!t&&!e.facebook.accessToken){e.facebook.dialog.auth("feedAuth",function(){e.facebook.dialog.feed(v,u)},v)}else{var s=e.facebook.dialog.getFeedURL(t),r,x=e.facebook.dialog.getFeedParams(v,t);s+="?"+e.util.trimAndEncodeParams(x,["link","picture","redirect_uri"]);if(t){r=e.ui.openPopupWithFullURL(s,{width:650,height:300,name:"bbcshare_facebook"});e.facebook.xd.waitForMessage("feed",r,function(y){r.close()})}else{s+="?"+e.util.encodeURL(x);var w=c('<h5 class="hd">Post to Profile</h5><div class="bbc-st-loading">Loading...</div><div><iframe id="bbc-st-facebook-iframe" src="'+s+'" frameborder="0"/></div>'),q=new e.ui.Panel(w,{id:"bbc-st-facebook-panel",height:240,width:572});r=w.get("iframe")[0].contentWindow;e.facebook.xd.waitForMessage("feed",r,function(y){q.hide()});q.show(u.hasFlashHideDisabled,u.hasForcedFlashHide)}}},getFeedParams:function(s,r){var q=f("callback?st_cb=facebook#state=feed"),t={app_id:e.facebook.APP_ID,redirect_uri:q,display:r?"popup":"iframe",link:s.url,name:s.title,locale:"en_GB",description:s.desc};if(!r){t.access_token=e.facebook.accessToken}if(s.imageUrl){t.picture=s.imageUrl}return t},getFeedURL:function(q){return"http"+(q?"":"s")+"://www.facebook.com/dialog/feed"}},xd:(function(){var t,r,s=function(w){var u=k.location.href,y=u.indexOf("?"),x,v="";if(y>=0){u=u.substring(y+1);x=u.indexOf("#");if(u.length){if(x>=0){v=u.substring(0,x)+"&"+u.substring(x+1)}else{v=x}}}return v},q={callback:(function(){var x=k.location.href,v=k.opener||k.parent,u=new RegExp("\\?.*st_cb=(\\w+).*state=(\\w+)");if(u.test(x)){var z=s(k.location),y=u.exec(x);if(y[1]=="facebook"){try{if(v&&k.addEventListener&&v.postMessage){v.postMessage(z,"*");return true}}catch(w){}if(v&&v.sharetools&&v.sharetools.facebook.xd.receiveMessage(z)){return true}}}return false})(),receiveMessage:function(u,w){var v=e.util.decodeURL(u),x=r[v.state];q.callbackData=q.callbackData||{};q.callbackData[v.state]=v;if(x&&v.st_cb=="facebook"&&(!w||w==v.state)){x(v);delete r[v.state];return true}return false},waitForMessage:function(u,w,x){r[u]=x;if(k.addEventListener&&k.postMessage){var v=function(y){if(typeof y.data=="string"&&e.facebook.xd.receiveMessage(y.data,u)){k.removeEventListener("message",v,false)}};k.addEventListener("message",v,false)}}};r=q.callbacks={};return q})(),load:function(){if(e.facebook.useFBConnect){e.facebook.connect.load()}},share:function(r,q){r=r||(q&&q.shareData)||new e.ShareData();j.log("share","facebook",q);p(e,"shareOnFacebook");p(e,"share",{network:"facebook",usingPanel:!(q&&q.hasDisabledFacebookPanel||o.env.ie<7)});if(e.facebook.useFBConnect){e.facebook.connect.share(r)}else{e.facebook.dialog.feed(r,q)}}};e.shareOnFacebook=e.facebook.share;if(e.facebook.useFBConnect){e.facebook.connect.init()}})();(function(){var r,s,u,t=false,q=false,x=false,w=function(){r=k.twttr;if(r!==d&&r.anywhere){k.clearInterval(t);t=false;p(e,"twitterLoaded")}},v=function(){if(i("iframe.twitter-anywhere-tweet-box").length>0){u.get("p.loading").remove();u.parent().parent().addClass("loadedTweetbox");k.clearInterval(q);q=false;return true}else{return false}};e.twitter={API_KEY:"zee9QwzoDJOLP1NkSGEm0A",load:function(){e.util.loadScript("http://platform.twitter.com/anywhere.js?id="+e.twitter.API_KEY+"&v=1");if(!t){t=k.setInterval(w,100)}},showSharePanel:function(z,y){if(s===d){s=new e.ui.Panel(null,{id:"bbc-st-twitter-panel",width:570,height:180})}if(!u){u=c('<div id="bbc-st-tweetbox"></div><div class="bbc-st-loading">Loading...</div>');s.getBody().append(u);q=k.setInterval(v,100);r.anywhere.config({callbackURL:f("callback/twitter/anywherecomplete.html")});r.anywhere(function(A){A("#bbc-st-tweetbox").tweetBox({height:90,width:538,defaultContent:z.twitterMessage+" - "+z.getShortUrl(),label:'Tweet about this page<link rel="stylesheet" type="text/css" media="screen" href="'+b("v1/style/"+e.styles.getBaseCssFilename()+".css")+'"/>',onTweet:function(){u.remove();u=d;s.hide()}})})}s.show(y.hasFlashHideDisabled,y.hasForcedFlashHide)},showSharePopup:function(y){e.ui.openPopup("http://twitter.com/intent/tweet",{text:y.twitterMessage+" "+y.getShortUrl()},{width:550,height:420,name:"bbcshare_twitter"})},share:function(A,z){A=A||(z&&z.shareData)||new e.ShareData();j.log("share","twitter",z);var y=z&&z.hasDisabledTwitterPanel;p(e,"shareOnTwitter");p(e,"share",{network:"twitter",usingPanel:!y});if(y){e.twitter.showSharePopup(A)}else{if(r){e.twitter.showSharePanel(A,z)}else{e.twitter.load();if(!x){g(e,"twitterLoaded",function(){e.twitter.showSharePanel(A,z)});x=true}}}}};e.shareOnTwitter=e.twitter.share})();e.shareOnDelicious=function(q,r){e.ui.openSharePopup("delicious","http://www.delicious.com/save",{v:5,noui:"",jump:"close",url:q.getShortUrl(),title:q.title},r)};e.shareOnDigg=function(r,s){var q={url:r.getShortUrl(),title:r.title};if(r.desc){q.bodytext=r.desc}e.ui.openSharePopup("digg","http://digg.com/submit",q,s)};e.shareOnGoogle=function(r,s){var q={url:r.url};e.ui.openSharePopup("google","https://plus.google.com/share",q,s,{width:750,height:500})};e.shareOnLinkedin=function(r,s){var q={mini:true,url:r.url,title:r.title,source:"BBC"};if(r.desc){q.summary=r.desc}e.ui.openSharePopup("linkedin","http://www.linkedin.com/cws/share",q,s,{width:520,height:420})};e.shareOnReddit=function(q,r){e.ui.openSharePopup("reddit","http://reddit.com/submit",{url:q.url,title:q.title},r)};e.shareOnStumbleUpon=function(q,r){e.ui.openSharePopup("stumbleupon","http://www.stumbleupon.com/submit",{url:q.url,title:q.title},r)};e.shareOnTumblr=function(r,s){var q={u:r.url,t:r.title,v:3};e.ui.openSharePopup("tumblr","http://www.tumblr.com/share",q,s,{width:480,height:460})};e.shareOn=(function(){var q={delicious:e.shareOnDelicious,digg:e.shareOnDigg,facebook:e.shareOnFacebook,google:e.shareOnGoogle,linkedin:e.shareOnLinkedin,reddit:e.shareOnReddit,stumbleupon:e.shareOnStumbleUpon,tumblr:e.shareOnTumblr,twitter:e.shareOnTwitter};return function(r,t,s){var u=q[r];if(!u){return false}return u(t,s)}})();e.ShareData=(function(q){q=function(r){if(!q.headMetadata){e.ShareData.init()}if(typeof r=="string"&&r.indexOf&&r.split){if(r.indexOf("?")>0){r=r.split("?")[1]}r=(r.indexOf("=")>=0)?e.util.decodeURL(r):{}}r=r||{};this.set(r,q.propertyKeys)};q.prototype={getShortUrl:function(){this.shortUrl=this.shortUrl||q.shortUrlCache[this.url];if(this.shortUrl){return this.shortUrl}var r=e.shortenURL(this.url);if(r&&r!==this.url){this.shortUrl=q.shortUrlCache[this.url]=r;return r}return this.url},set:function(u,t){var s,r;if(t){for(r=0;(s=t[r]);r++){this.setProperty(s,u[s])}}else{for(s in u){this.setProperty(s,u[s])}}return true},setProperty:function(r,s){r=q.propertyKeyAliases[r]||r;if(s&&r=="url"&&s.indexOf("/")===0){s="http://www.bbc.co.uk"+s}this[r]=(typeof(s)==="string"&&s)||q.headMetadata[r]||this._getDefaultValue(r)},_getDefaultValue:function(r){if(r==="message"){return this.title}if(r==="twitterMessage"){return this.message}if(r==="countUrl"){return this.url}return q.propertyDefaults[r]||q.propertyDefaults.all}};q.propertyKeys=["appId","url","countUrl","shortUrl","title","message","twitterMessage","desc","imageUrl"];q.propertyKeyAliases={appid:"appId",counturl:"countUrl",shorturl:"shortUrl",msg:"message","twitter-msg":"twitterMessage","twitter-message":"twitterMessage",description:"desc",image:"imageUrl"};q.propertyDefaults={all:"",url:k.location.href,title:m.title};q.headMetadata=d;q.shortUrlCache={};q.init=function(){var s,t,r;r=q.headMetadata={};q.shortUrlCache={};i("head meta").each(function(){s=i(this);t=s.attr("property")||s.attr("name");if(t){t=t.toLowerCase();r[t]=s.attr("content")||s.text()}});r.url=r["og:url"]||r.url;r.desc=r["og:description"]||r.description;r.title=r["og:title"]||r.title;r.imageUrl=r["og:image"]};return q})();e.setShareData=function(u,s){if(typeof(s)==="string"){s=e.toolbars[s];return s&&s.shareData.set(u)}var r,q=true;for(r in e.toolbars){q=e.setShareData(u,r)&&q}return q};e.ui=e.ui||{};e.ui.Panel=(function(){var r={theme:"light",modal:true,closeOnMaskClick:false,closeOnEsc:false,hideWindowedFlash:false,anim:"fade",template:'<div class="bbc-st-panel"><div class="panel-hd"></div><div class="panel-bd"></div><div class="panel-ft"></div><a href="#" class="panel-close" title="Close">Close</a></div>'},q;return function(v,u){if(typeof v=="string"){v=c(v).appendTo("body")}u=e.util.apply(r,u);var t,s;u.mask=q=q||new o.widgets.Mask({opacity:0.75});t=new o.widgets.Panel(v,u);this.closeButton=t.container.get(".panel-close");this.getBody=function(){return t.body};this.show=function(x,w){t.show();if(!x){e.flash.hide(t.container[0],w)}};this.hide=function(){t.hide()};g(t,"show",function(){if(!s){s=g(q,"click",this.hide)}p(this,"show",this)},this);g(t,"afterShow",function(){p(this,"afterShow",this)},this);g(t,"hide",function(){p(this,"hide",this)},this);g(t,"afterHide",function(){e.events.removeListener(s);s=null;e.flash.show(t.container[0].id);p(this,"afterHide",this)},this)}})();e.ui.SharePanel=(function(){var s={id:"bbc-st-share-panel",pointerPosition:"b",pointerRegisters:{t:{x:35,y:0},b:{x:35,y:"100%"}},hideWindowedFlash:false,anim:"fade",closeOnEsc:true,template:'<div class="bbc-st-panel bbc-st-sharepanel"><div class="infoPanel-pointerT">&nbsp;</div><div class="panel-main"><div class="panel-hd"><h5>Share this page</h5></div><div class="panel-bd"></div><div class="panel-ft"><p class="bbc-st-explain"><a href="http://www.bbc.co.uk/help/web/sharing.shtml">Read more about these links.</a></p></div><a href="#" class="panel-close" title="Close">Close</a></div><div class="infoPanel-pointerB">&nbsp;</div></div>'},q=function(v,u,t){g(v,"click",function(w){w.preventDefault();t.hide();p(t,"ctaFired",{shareNetwork:u})})},r;return function(z){var t,x,y={},A=c('<ul class="bbc-st-all"></ul>'),v=o.lang.clone(s),u=0,w;r=r||new o.widgets.Mask({opacity:0});if(r._iframe){r._iframe.addClass("bbc-st-overlay-iframe")}for(w in a.services){if(!a.services[w].enabled){continue}y[w]=c(["<li",(u===0?' class="bbc-st-first"':""),'><a href="#" title="Share this page on ',a.services[w].title,'" class="bbc-st-',w,'-cta">',a.services[w].title,"</a> <span></span></li>"].join(""));A.append(y[w]);u++;q(y[w].get("a"),w,this)}v=e.util.apply(v,{mask:r,width:210});if(z){v=e.util.apply(v,z)}t=new o.widgets.InfoPanel(A,v);x=t.body.parent().parent();this.clearCounts=function(){this.refreshCounts()};this.getBody=function(){return(t.body.length)?t.body[0]:d};this.getContainer=function(){return(t.container.length)?t.container[0]:d};this.getFooter=function(){return(t.footer.length)?t.footer[0]:d};this.getHeader=function(){return(t.header.length)?t.header[0]:d};this.hide=function(B){p(this,"hide");if(B&&typeof B.preventDefault=="function"){B.preventDefault()}t.hide()};this.refreshCounts=function(C){for(var B in y){y[B].get("span").text((C&&C[B])?C[B]:"")}};this.setContext=function(B){if(B){t.setContext(B)}};this.setDarkVariant=function(B){if(B){x.addClass("bbc-st-sharepanel-dark");x.removeClass("bbc-st-sharepanel-light")}else{x.removeClass("bbc-st-sharepanel-dark");x.addClass("bbc-st-sharepanel-light")}};this.setFullVariant=function(B){if(B){x.addClass("bbc-st-panel-full");x.removeClass("bbc-st-panel-slim")}else{x.removeClass("bbc-st-panel-full");x.addClass("bbc-st-panel-slim")}};this.setPosition=function(F,G){var I=t.opts.pointerPosition=(F)?"b":"t",J=t.opts.context,C=(J)?J.width()/2:35,B=t.opts.pointerRegisters[I].x=(G)?C:v.width-C,E=x.get(".infoPanel-pointerT"),D=x.get(".infoPanel-pointerB");if(F){E.css("visibility","hidden");D.css("visibility","")}else{E.css("visibility","");D.css("visibility","hidden")}function H(L,M){var K=L.css("background-position"),N=K.split(" ")[1];if(o.env.ie){L.css("background-position-x",(M-8)+"px");L.css("background-position-y",N)}else{L.css("background-position",(M-8)+"px "+N)}}H(E,B);H(D,B)};this.show=function(D){var L=D&&D.hasPresetPanelPosition;if(L){this.setPosition(L.top,L.right)}else{var O=t.opts.context,C=O.offset(),F={w:O[0].offsetWidth,h:O[0].offsetHeight},N=k.document,G=o.env.standardsMode?N.documentElement:N.body,E={w:G.scrollWidth,h:G.scrollHeight},H={above:C.top,below:E.h-C.top-F.h,right:E.w-C.left,left:C.left+F.w},K=270,B=210,I,J;if(H.below>=K){I=false}else{I=H.above>=K}if(H.right>=B){J=true}else{J=H.left<B}this.setPosition(I,J)}t.setPosition();p(this,"show");t.show();if(r._iframe){var M=t.container;r._iframe.css({width:M.width(),height:M.height(),top:M.css("top"),left:M.css("left")})}};g(t,"afterHide",function(){e.flash.show(t.container[0].id);p(this,"afterHide")},this);g(t,"afterShow",function(){p(this,"afterShow")},this);return this}})();e.ui.ShareToolbar=n=(function(){var s,q=0,r=function(y){y=i(y);q++;var w,z,x;if(!y.length){y=c("<div></div>")}if(!y.hasClass("bbc-st")){y.addClass("bbc-st")}this.isPaleVariant=y.hasClass("bbc-st-pale");if(this.isPaleVariant&&!y.hasClass("bbc-st-slim")){y.addClass("bbc-st-slim")}this.isFullVariant=!y.hasClass("bbc-st-slim");if(!this.isFullVariant){this.isSlimColoured=y.hasClass("bbc-st-colour")}if(this.isFullVariant&&!y.hasClass("bbc-st-full")){y.addClass("bbc-st-full")}this.isDarkVariant=!y.hasClass("bbc-st-light");this.isPanelShowing=false;this.hasCssLoadingDisabled=y.hasClass("bbc-st-disable-css-load");this.hasCountsDisabled=y.hasClass("bbc-st-disable-counts");this.hasDisabledFontReset=y.hasClass("bbc-st-disable-font-reset");this.hasForcedFlashHide=y.hasClass("bbc-st-force-flash-hide");this.hasFlashHideDisabled=y.hasClass("bbc-st-disable-flash-hide");this.hasDisabledPanels=!y.hasClass("bbc-st-use-share-overlays");this.hasDisabledFacebookPanel=!(y.hasClass("bbc-st-use-facebook-share-overlay")||!this.hasDisabledPanels);this.hasDisabledTwitterPanel=!(y.hasClass("bbc-st-use-twitter-share-overlay")||!this.hasDisabledPanels);var t=/bbc-st-panel-pos-([tb])([rl])/.exec(y[0].className);if(t){this.hasPresetPanelPosition={top:t[1]=="t",right:t[2]=="r"}}var u=y.get("a");u=(u.length)?u.attr("href"):d;this.shareData=new e.ShareData(u);this.appId=this.shareData.appId;this.id=y.prop("id");if(!this.id||this.id===""){this.id="bbc-st-toolbar-"+q;y.prop("id",this.id)}this.variantString=(this.isFullVariant?"full":"slim")+(this.isSlimColoured?"_colour":"");this.settingsString="share_toolbar-1-"+this.variantString+"-"+(this.isDarkVariant?"dark":"light")+(!this.hasDisabledPanels&&!this.hasDisabledFacebookPanel&&!this.hasDisabledTwitterPanel?"-overlays":"");var v=['<div class="bbc-st-wrapper bbc-st-rst bbc-st-v1">',(this.isFullVariant?'<h2 class="bbc-st-heading">Share this page</h2>':""),'<div class="bbc-st-count"></div>','<ul class="bbc-st-buttons">','<li class="bbc-st-share-cta"><a href="#" title="Share this page to other places">Share</a></li>','<li class="bbc-st-facebook-cta"><a href="#" title="Share this page on Facebook">Facebook</a></li>','<li class="bbc-st-twitter-cta"><a href="#" title="Share this page on Twitter">Twitter</a></li>',"</ul></div>"].join("");y.append(v);x=y.get(".bbc-st-share-cta a");this.getElement=function(){return y[0]};this.hide=function(){y.css("display","none")};this.hideSharePanel=function(){s.hide()};this.refreshCounts=function(A){if(A!==d){this.setCounts(A)}if(!this.countData||!this.countData.total){return}y.get(".bbc-st-count").html(['<span title="This page has been shared ',this.countData.total,' times">',this.countData.limitedTotal,"</span>",(this.isFullVariant?" so far":"")].join(""));s.refreshCounts(this.countData)};this.setCounts=(function(){var C=/(\d+)(\d{3})/,B=function(E){if(E<1000){return E}var D=""+E;while(C.test(D)){D=D.replace(C,"$1,$2")}return D},A=function(D){if(D>=10000000){D=Math.floor(D/1000000)+"M"}else{if(D>=1000000){D=Math.floor(D/100000)/10+"M"}else{if(D>=10000){D=Math.floor(D/1000)+"K"}else{if(D>=1000){D=Math.floor(D/100)/10+"K"}}}}return D};return function(G){var D,F,H={},E=0;for(D in G){F=G[D];if(D!="total"&&!isNaN(F)){E+=F;H[D]=B(F)}}H.total=E;H.limitedTotal=A(E);this.countData=H;return H}})();this.remove=function(){y.remove()};this.resetFontSize=function(){var C=e.util.getCurrentStyle(m.body,"font-size"),A=e.util.getCurrentStyle(y.parent(),"font-size"),B=e.util.getCurrentStyle(y,"font-size");if(typeof C=="string"){C=parseFloat(C.replace("px",""))}if(typeof A=="string"){A=parseFloat(A.replace("px",""))}if(typeof B=="string"){B=parseFloat(B.replace("px",""))}if(B!=C){y.css("font-size",(C/A)+"em")}};this.setPanelShowing=function(B){this.isPanelShowing=B===true;var A=x.parent();if(B){A.addClass("on")}else{A.removeClass("on")}};this.show=function(){y.css("display","");if(y.css("display")=="none"){y.css("display","block")}};this.showSharePanel=function(A){if(A&&typeof A.preventDefault=="function"){A.preventDefault()}w=g(s,"ctaFired",function(B){e.shareOn(B.shareNetwork,this.shareData,this)},this);z=g(s,"afterHide",function(){this.setPanelShowing(false);s.clearCounts();e.events.removeListener([w,z])},this);this.setPanelShowing(true);s.refreshCounts(this.countData);s.setDarkVariant(this.isDarkVariant);s.setFullVariant(this.isFullVariant);s.setContext(x);s.show(this);if(!this.hasFlashHideDisabled){e.flash.hide(s.getContainer(),this.hasForcedFlashHide)}};g(x,"click",this.showSharePanel,this);g(y.get(".bbc-st-facebook-cta a"),"click",function(A){A.preventDefault();e.shareOnFacebook(this.shareData,this)},this);g(y.get(".bbc-st-twitter-cta a"),"click",function(A){A.preventDefault();e.shareOnTwitter(this.shareData,this)},this);g(this,"cssLoaded",function(){if(!this.hasDisabledFontReset){this.resetFontSize()}this.show()},this)};r.prototype.toString=function(){return"ShareToolbar"};r.init=function(){s=new e.ui.SharePanel()};r.getPanel=function(){if(!s){e.ui.ShareToolbar.init()}return s};return r})();e.ui.openPopup=function(r,s,q){if(s){r+="?"+e.util.encodeURL(s)}return e.ui.openPopupWithFullURL(r,q)};e.ui.openPopupWithFullURL=(function(){var r={name:"bbcshare",width:750,height:500,status:"no",resizable:"yes",scrollbars:"yes",toolbar:"no"},q=function(s){var u=typeof k.screenX!="undefined"?k.screenX:k.screenLeft,t=typeof k.screenY!="undefined"?k.screenY:k.screenTop,w=typeof k.outerWidth!="undefined"?k.outerWidth:m.documentElement.clientWidth,v=typeof k.outerHeight!="undefined"?k.outerHeight:(m.documentElement.clientHeight-22);s.left=parseInt(u+((w-s.width)/2),10);s.top=parseInt(t+((v-s.height)/2.5),10)};return function(u,t){var w="",v,s;t=e.util.apply(r,t||{});q(t);for(v in t){if(v=="name"){continue}if(w){w+=", "}w+=v+"="+t[v]}s=k.open("",t.name,w);if(u){s.location.href=u}s.focus();return s}})();e.ui.openSharePopup=function(s,r,u,t,q){a.services[s]&&p(e,"shareOn"+a.services[s].title);p(e,"share",{network:s});j.log("share",s,t);q=q||{};q.name="bbcshare_"+s;return e.ui.openPopup(r,u,q)};j=e.iStats=(function(){var q={},r=function(v){var s=e.env.isDebugModeOn();k.bbcRequireMap=k.bbcRequireMap||{};k.bbcRequireMap["istats-1"]=k.bbcRequireMap["istats-1"]||b("v1/script/lib/istats-0.2.4.js");if(!k.require||!k.define){h&&h("Creating RequireJS wrapper");q.usingRequireWrapper=true;var u={},t={};k.require=function(z,A){var w;if(!(z instanceof Array)&&typeof z!=="string"){w=z;if((A instanceof Array)){z=A;A=arguments[2]}else{z=[]}}if(typeof z=="string"){return t[z]?A(t[z]):d}for(var y,x=0;x<z.length;x++){y=z[x];if(t[y]){A(t[y])}else{if(!u[y]){u[y]=[A]}else{u[y].push(A)}if(k.bbcRequireMap[y]){e.util.loadScript(k.bbcRequireMap[y])}else{e.util.loadScript(y)}}}return d};k.define=k.require.def=function(w,z,A){if(z){}if(w){t[w]=A();if(u[w]){for(var y,x=0;x<u[w].length;x++){y=u[w][x];y(t[w])}delete u[w]}}else{}};k.require.ready=function(w){o&&o.onDomReady(w)}}k.require({paths:k.bbcRequireMap},["istats-1"],v)};q.log=function(u,t,v,x){var w,s=function(){h&&h("Callback: iStats.log",u,t,w,x);x&&x()};if(v instanceof e.ui.ShareToolbar){w={psp_source:v.settingsString,psp_source_id:v.id,psp_source_action:v.isPanelShowing?"panel":"button",psp_share_url:v.shareData.url,psp_app_id:v.appId}}else{w={psp_source:"manual"}}t="psp_share_"+t;r(function(z){h&&h("Calling: iStats.log",u,t,w,x);try{z.log&&z.log(u,t,w,s)}catch(y){h&&h("Error calling iStats.log:",y)}})};return q})();(function(){e.flash={};var t=/.swf($|\?)/i,q=/<param\s+(?:[^>]*(?:name=["'?]\bwmode["'?][\s\/>]|\bvalue=["'?](?:opaque|transparent)["'?][\s\/>])[^>]*){2}/i,s=function(w){var x=w.offset();if(o.env.webkit&&w.css("position")=="fixed"){x.left+=k.pageXOffset;x.top+=k.pageYOffset}return x},v=function(K,I){var x=s(K),H=s(I);K={x:x.left,y:x.top,w:K.width(),h:K.height()};I={x:H.left,y:H.top,w:I.width(),h:I.height()};var F=K.x,C=K.y,G=K.x+K.w,D=K.y+K.h,B=I.x,z=I.y,A=I.x+I.w,y=I.y+I.h,w=Math.abs(F+G-B-A),L=Math.abs(C+D-z-y),J=Math.abs(G-F+A-B),E=Math.abs(C-D+z-y);return(w<=J&&L<=E)},u=function(w){var x;if((w.getAttribute("type")=="application/x-shockwave-flash"||t.test(w.getAttribute("data")||w.getAttribute("src")||"")||(w.getAttribute("classid")||"").toLowerCase()=="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000")){x=w.getAttribute("wmode");return(w.nodeName=="OBJECT"&&!q.test(w.innerHTML))||(w.nodeName!="OBJECT"&&x!="transparent"&&x!="opaque")}return false},r=(function(){var y=0,w={},z=function(A){for(var B in w){if(w[B].elem===A){return B}}return false},x=function(C,A){if(C instanceof Array&&C.indexOf){return C.indexOf(A)}for(var B in C){if(C[B]===A){return B}}return -1};return{add:function(C,B){var A=z(C[0]);if(!A){A=y++;w[A]={elem:C[0],visibility:C.css("visibility"),overlays:[]};C.css("visibility","hidden");C.parent().addClass("bbc-st-flash-hidden");p(e,"flashHide",{elem:C[0]})}w[A].overlays.push(B)},show:function(B,A){r.showIndex(z(B[0]),A,B)},showIndex:function(A,B,D){if(A!==false){var C=w[A];D=D||i(w[A].elem);var E=x(C.overlays,B);if(E>=0){C.overlays.splice(E,1)}if(!C.overlays.length){D.css("visibility",C.visibility);D.parent().removeClass("bbc-st-flash-hidden");p(e,"flashShow",{elem:D[0]});delete w[A]}}},showAll:function(B){for(var A in w){r.showIndex(A,B)}}}})();e.flash.hide=function(w,y){w=i(w);var x=w[0].id;i("embed,object").each(function(){var z=i(this);if(u(this)){if(w){if(y||v(z,w)){r.add(z,x)}else{if(z.css("visibility")=="hidden"){r.show(z,x)}}}else{r.add(z,x)}}})};e.flash.show=function(w){r.showAll(w)}})();(function(){var r=function(){i(".bbc-st").remove()},q={};e.counts={countData:{},rawCountData:{},receive:function(w){if(!w){return false}var s,t,u,v;if(w.url){if(q&&(v=q[w.url])){if(v instanceof Array){for(t=0;(u=v[t]);t++){if(u instanceof e.ui.ShareToolbar){u.refreshCounts(w)}}}else{if(v instanceof e.ui.ShareToolbar){v.refreshCounts(w)}}}}else{e.counts.map.applyAll(function(x,y){y.refreshCounts(w[x])})}p(e,"countsRefreshed",{countData:w})},refresh:function(s,t,u){for(s in q){t=q[s];if(t instanceof Array){t=q[s][0]}s=e.env.resolveServicesURL("/buzz/shares?callback=sharetools.counts.receive&url="+encodeURIComponent(s));if(s.length<2048){u=t&&t.shareData&&t.shareData.title;if(u){u="&title="+encodeURIComponent(u);if(s.length+u.length>2048){u=u.substring(0,2045-s.length)+"..."}s+=u}}e.util.loadScript(s)}},_refreshOld:function(t,s){s="";for(t in q){s=(s)?s+","+t:t}if(s){e.util.loadScript(l("v1/count.js?url="+encodeURIComponent(s)))}},setAll:function(s){e.counts.map.applyAll(function(t,u){u.refreshCounts({total:s})})},map:{add:function(t){if(t instanceof n){var s=t.shareData.countUrl,u=q[s];if(!s||!(/^(\/|https?:\/\/([^\/]+)?\.bbc\.co\.uk)/.test(s))){return}if(u instanceof Array){u.push(t)}else{if(u instanceof n){q[s]=[u,t]}else{q[s]=t}}}else{if(typeof t=="object"){for(var v in t){if(t[v] instanceof n){e.counts.map.add(t[v])}}}}},applyAll:function(v){var s,t,u;for(s in q){if(q[s] instanceof Array){for(t=0;(u=q[s][t]);t++){if(u instanceof e.ui.ShareToolbar){v(s,u)}}}else{if((u=q[s]) instanceof e.ui.ShareToolbar){v(s,u)}}}},get:function(){return q},remove:function(u){var s=u.shareData.url,v=q[s];if(v instanceof Array){for(var t in v){if(v[t]===u){delete v[t]}}if(v.length===0){delete q[s]}}else{if(v instanceof n){delete q[s]}}}}}})();(function(){var u="/modules/sharetools/",s,r={"sandbox.dev":1,sandbox:1,"int":2,test:3,stage:4,live:5,"":6},t={"www.int":true,"www.test":true,"www.stage":true,"www.live":true,"pal.int":true,"pal.test":true,"pal.stage":true,"pal.live":true,www:true,"www-staging":true,extdev:true},y=function(B){var A,z=new RegExp("^(.+)\\.bbc\\.co\\.uk$");B=B||k.location.host;if(z.test(B)){A=z.exec(B);return A&&A[1]&&t[A[1]]}return false},x,w,v,q;e.env={isSupportedDomain:y,init:function(A){A=A||e.env.name;var C,B,z=new RegExp("https?://static\\.(.+?)?\\.?bbci?\\.co\\.uk/modules/sharetools/.+");if(!A){i("script").each(function(D){C=i(this).attr("src");if(C&&z.test(C)){B=z.exec(C);if(B&&B[1]){if(A===d||r[B[1]]>r[A]){A=B[1]}}else{A=""}}});if(!A){A=""}}s=(A=="sandbox.dev");x=[(s?"pal.":"www."),A,(A===""?"":"."),"bbc.co.uk"].join("");w=["static",(A===""?"":"."),A,".bbc"+(s?"":"i")+".co.uk"].join("");v=(r[A]>3)?["feeds.",(A=="stage"?A+".":""),"bbci.co.uk"].join(""):d;q=(s?"int":(A===""?"live":A));q=["open",q,"bbc","co","uk"].join(".");e.env.name=A},resolveURL:function(z,A){if(typeof(z)!=="string"){return d}if(!A){A=y()?k.location.host:x}A=A||x;var B=(z.charAt(0)=="/")?"":u;return[k.location.protocol,"//",A,B,z].join("")},resolveStaticURL:function(z){return f(z,w)},resolveFeedURL:function(z){return f(z,v)},_resolveEnvironment:function(A,B,z){if(typeof(A)!=="string"){A=e.env.name||""}if(A==="live"){A=B?"":A}else{if(A==="sandbox"||A==="sandbox.dev"){A=z?"sandbox.dev":"int"}else{if(!r[A]){A=""}}}return A},resolveServicesURL:function(C,A,z){var B=["open"];A=e.env._resolveEnvironment(A,true,false);if(A!==""){B.push(A)}B.push(z?"bbc":"bbci");B.push("co.uk");return f(C,B.join("."))},setDebugMode:function(z){m.cookie="bbc.sharetools.debug="+(z?1:0)+";path=/;domain=.bbc.co.uk";k.location.reload()},isDebugModeOn:function(){return s||new RegExp("bbc\\.sharetools\\.debug=1").test(m.cookie)===true}};f=e.env.resolveURL;b=e.env.resolveStaticURL;l=e.env.resolveFeedURL})();e.styles=(function(){var r={base:16,slim:23,full:42},w={},u={base:false,slim:false,full:false},q={},v=function(y){var x=k.setInterval(function(){if(e.styles.isLoaded(y)){p(e.styles,y+"Loaded");k.clearInterval(x)}},100)},t=function(x,y){if(e.styles.isLoaded(x)){p(y,"cssLoaded");return false}g(e.styles,x+"Loaded",function(){p(y,"cssLoaded")});return true},s=function(y,x){x=x||y;if(x=="all"){v("slim");v("full")}else{v(x)}q[x]=y;i("head").append('<link rel="stylesheet" type="text/css" media="screen" href="'+b("v1/style/"+y+".css")+'" />')};return{getBaseCssFilename:function(){if(q.base){return q.base}for(var x in q){if(!q[x].substring(4)){return q[x]}}return"base"},injectIEStyleOverrides:function(){i("head").append(c('<style type="text/css">#bbc-st-share-panel .bbc-st-panel .infoPanel-pointerB,#bbc-st-share-panel .bbc-st-panel .infoPanel-pointerT{filter:none}#bbc-st-share-panel .bbc-st-panel-light .infoPanel-pointerB,#bbc-st-share-panel .bbc-st-panel-light .infoPanel-pointerT{filter:none}#blq-main .bbc-st-full{zoom:1;}</style>'))},isLoaded:function(x){x=x||"base";if(u.base&&u[x]){return true}if(!w[x]){w[x]=c('<div class="bbc-st-'+x+'-csstest"></div>');i("body").append(w[x])}u[x]=w[x].width()==r[x];if(u[x]){w[x].remove();w[x]=false}return(x=="base"||e.styles.isLoaded("base"))&&u[x]},load:function(A){var z=false,y=false,x=function(C){if(C.hasCssLoadingDisabled){return}if(C.isFullVariant){z=t("full",C)}else{y=t("slim",C)}};if(A instanceof n){x(A)}else{if(typeof A=="object"){for(var B in A){if(A[B] instanceof n){x(A[B])}}}}if(e.env.isDebugModeOn()){if(!e.styles.isLoaded("base")){s("base")}if(z){s("full-only","full")}if(y){s("slim-only","slim")}}else{if(z){if(y){s("all")}else{if(e.styles.isLoaded("base")){s("full-only","full")}else{s("full")}}}else{if(y){if(e.styles.isLoaded("base")){s("slim-only","slim")}else{s("slim")}}}}}}})();e.addToolbar=function(r,s,t){var q=new n(r);e.toolbars[q.id]=q;if(!q.hasCountsDisabled){e.counts.map.add(q)}if(s!==false){e.styles.load(q)}if(t!==false){if(!q.hasCountsDisabled){e.counts.refresh()}}return q};e.removeToolbar=function(q){if(q){q.remove();delete e.toolbars[q.id];if(!q.hasCountsDisabled){e.counts.map.remove(q)}}return false};e.init=function(r){o=r;i=o.dom.get;g=e.events.addListener;p=e.events.fire;c=o.dom.create;var q=i(".bbc-st");q.css("display","none");if(o.env.ie<8){a.services.google.enabled=false}e.env.init();e.sharePanel=n.getPanel();e.toolbars={};q.each(function(s){e.addToolbar(this,false,false)});if(o.env.ie){i("body").addClass("bbc-st-ie");e.styles.injectIEStyleOverrides()}e.styles.load(e.toolbars);e.counts.refresh();p(e,"ready")};if(k.gloader){k.gloader.load(["glow","1","glow.net","glow.events","glow.widgets.InfoPanel"],{async:false,onLoad:function(q){q.onDomReady(function(){e.init(q)})}})}})(this,this.document);