import{av as G,aw as U,ax as y,Z as L,J as H,b as K,F as n,l as h,L as Q,$ as P}from"./entry.be43a630.js";function Y(){const m=G(),p=U(),S=y(),{member:s,globalAuthing:c,globalAuthLogin:E,checkoutAuthLogin:b,checkoutAuthing:g,mergeCart:V,agreeLoading:q}=L(m),{registerCompleteVisible:O}=L(S),{$gtm:v}=H(),o=K(),$=n({}),M=n({email:"",password:"",isPersistent:!1}),A=n({email:"",newPassword:"",confirmNewPassword:""}),x=n({email:[{required:!0,message:"Email is required"},{type:"email",message:"Email is not valid"},{max:128,message:"Email must be less than 128"}],password:[{required:!0,message:"Password is required"}]}),R=n({email:[{required:!0,message:"Email is required"},{type:"email",message:"Email is not valid"}],newPassword:[{required:!0,message:"Password is required"},{min:8,max:128,pattern:"^(?:(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])|(?=.*[0-9])(?=.*[a-z])(?=.*[!\"~`$^+=|\\\\<>#%&'()*,\\-./:;?@[\\]_{}])|(?=.*[0-9])(?=.*[A-Z])(?=.*[!\"~`$^+=|\\\\<>#%&'()*,\\-./:;?@[\\]_{}])|(?=.*[a-z])(?=.*[A-Z])(?=.*[!\"~`$^+=|\\\\<>#%&'()*,\\-./:;?@[\\]_{}]))[0-9a-zA-Z!\"~`$^+=|\\\\<>#%&'()*,\\-./:;?@[\\]_{}]{8,128}$",message:"Password does not meet the requirements"}],confirmNewPassword:[{validator:(e,r,a)=>{r===""?a(new Error("Confirm password is required")):r!==A.newPassword?a(new Error("The two password fields must match")):a()},trigger:"blur"}]}),C=n({email:"",password:""}),w=n({email:"",newPassword:"",confirmNewPassword:""}),Z=h(()=>{var e;return N?s.value.showAlias===!0&&s.value.alias?s.value.alias:s.value.showAlias===!1&&(s.value.firstName||s.value.lastName)?`${s.value.firstName} ${s.value.lastName}`:(e=s.value.emailAddress)==null?void 0:e.substring(0,s.value.emailAddress.indexOf("@")):""}),z=h(()=>N?s.memberNo:""),N=h(()=>m.isMemberLoggedIn()),F=h(()=>m.isMemberLoggedInByCookie());function I(e,r,a){P().auth.login(r).then(t=>{k(e),o.name!=="sell"&&o.name!=="sell-start-sell"&&o.name!=="sell-contact-info"&&(V.value=t.mergeCart),v.trackEvent({event:"user-login-success",method:e==="global"?o.name:e==="checkout"?"Checkout":"OrderConfirm","user-id":t.memberNo}),dataLayer.push({event:"sign_in",evnet_name:"sign_in"}),a&&typeof a=="function"&&a()}).catch(t=>{if(t.response.status===400){const i=t.response._data.validationErrors,l=i.filter(u=>u.fieldName==="email");l.length&&(C.email=l[0].failedValidation);const d=i.filter(u=>u.fieldName==="password");d.length&&(C.password=d[0].failedValidation)}v.trackEvent({event:"user-login-fail",method:e==="global"?o.name:e==="checkout"?"Checkout":"OrderConfirm"})})}function j(e,r,a){let t=Object.assign({},r,{});(p.sellerCenter||p.startSell)&&(t.termsOfServiceConsent={versionNo:3,sectionName:"Terms of Use for Sellers"}),P().auth.join(t).then(i=>{k(e),v.trackEvent({event:"user-signup-success",method:e==="global"?o.name:e==="checkout"?"Checkout":"OrderConfirm","user-id":i.memberNo}),dataLayer.push({event:"sign_up",evnet_name:"sign_up"}),a&&typeof a=="function"&&a()}).catch(i=>{if(i.response.status===400){const l=i.response._data.validationErrors,d=l.filter(f=>f.fieldName==="email");d.length&&(w.email=d[0].failedValidation);const u=l.filter(f=>f.fieldName==="newPassword");u.length&&(w.newPassword=u[0].failedValidation);const _=l.filter(f=>f.fieldName==="confirmPassword");_.length&&(w.confirmNewPassword=_[0].failedValidation)}v.trackEvent({event:"user-signup-fail",method:e==="global"?o.name:e==="checkout"?"Checkout":"OrderConfirm"})})}function k(e){setTimeout(()=>{m.getMemberInfo().then(()=>{e==="global"&&(c.value=!1),e==="checkout"&&(g.value=!1,b.value=!0),e==="orderConfirm"&&(O.value=!0)})},100)}function B(e,r){e==="global"&&(r==="register"?(c.value=!0,E.value=!1):r==="login"?(c.value=!0,E.value=!0):c.value=!1),e==="checkout"&&(r==="register"?(g.value=!0,b.value=!1):r==="login"?(g.value=!0,b.value=!0):g.value=!1)}function J(){m.clearMemberInfo(),window.location.href="/m/logoff"}async function D(){try{await P().account.agreement(),window.location.reload()}catch(e){console.error(e),newSellerMessage("error","Error","Failed to agree to consent",null,!0)}finally{q.value=!1}}return{...Q($),loginForm:M,registerForm:A,loginRules:x,registerRules:R,loginErrors:C,registerErrors:w,memberName:Z,memberNo:z,isLogin:N,authLogin:I,authJoin:j,authChange:B,signOut:J,isLoginByCookie:F,agreeConsent:D}}export{Y as u};
