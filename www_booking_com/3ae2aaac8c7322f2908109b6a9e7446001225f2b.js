var _i_=this._i_||function(){},_r_=this._r_||function(e){return e};B.define("component/sp/plugable-access-form/dispatcher",function(e,i,r){_i_("5de:2f183c24");var s=[];return _r_({registerPlugin:function(e){_i_("5de:a6c32edf"),s.push(e),_r_()},checkReservationId:function(i,e){_i_("5de:5becded2"),this._plugin_loop(function(e){return _i_("5de:14e75647"),_r_(e.checkReservationId(i))},e),_r_()},_plugin_loop:function(t,n){_i_("5de:024d1c1c"),s.reduce(function(e,r){return _i_("5de:072b352e"),_r_(e.then(function(e){if(_i_("5de:0c6f2849"),e)return _r_(e);var i=t(r);return i&&i.then||(i=Promise.resolve(i)),_r_(i.then(function(e){return _i_("5de:3fb20091"),!0===e&&n(r),_r_(Promise.resolve(!!e))}))}))},Promise.resolve(!1)),_r_()}})}),B.define("utils/bind-all",function(e,i,r){_i_("5de:ca20d562"),r.exports=function(e){for(var i in _i_("5de:fe723711"),e)"function"==typeof e[i]&&(e[i]=e[i].bind(e));return _r_(e)},_r_()}),B.define("component/sp/plugable-access-form",function(e,i,r){"use strict";_i_("5de:291af21d");var t=window.B||window.booking,n=e("jquery"),s=e("utils/bind-all"),o=t.debug("plugable-access-form"),_=t.env,a=e("component/sp/plugable-access-form/dispatcher");return _r_(e("component").extend({init:function(){_i_("5de:8c083b26"),s(this),this.form=this.$el.find(".js-user-access-plugable-form"),this.booknumber=this.$el.find(".js-user-access-booknumber"),this.pincode=this.$el.find(".js-user-access-pin"),this.lastname=this.$el.find(".js-user-access-lastname"),this.submit=this.$el.find(".js-user-access-submit"),this.messages=this.$el.find(".js-user-access-message"),this._plugin=void 0,this.updateStage("start"),this.booknumber.on("keyup",this.resetIfEmpty),this.submit.on("click",this.onSubmit),"mdot"==_.b_site_type&&(_.b_partner_id=_.partner_id),"myreservations"==_.b_action&&_.profile_menu&&_.profile_menu.b_site_info.is_cobrand&&(n("#formwrap").find(".form-section").addClass("form-hidden-section"),n("#formwrap").find(".user_access_resend_confirmation").removeClass("form-hidden-section"),n("#formwrap").find(".user_access_manage_booking_menu").removeClass("form-hidden-section"),n("#formwrap").find(".resend-conf").addClass("resend-conf--absolute")),_r_()},resetIfEmpty:function(){_i_("5de:6f943908"),"start"!=this.stage&&""===this.booknumber.val().trim()&&(this.updateStage("reset"),this.updateStage("start")),_r_()},onSubmit:function(e){_i_("5de:a2025625");var i=this.booknumber.val(),r=this.getPinValue();if(!i)return _r_(!0);switch(this.stage){case"start":this.checkReservationId(i),this.preventDefault(e);break;case"getpin":var t=this._plugin.checkReservationAccess(i,r);t&&!this._plugin.preventDefault||this.preventDefault(e),t&&this.updateStage("loggedin")}_r_()},preventDefault:function(e){_i_("5de:bc49d347"),e.preventDefault(),e.stopPropagation(),this.clearErrors(),_r_()},checkReservationId:function(e){_i_("5de:d271f97d");var i=this;e&&a.checkReservationId(e,function(e){_i_("5de:9dbd5bf1"),e&&(i._plugin=e,i.updateStage("getpin")),_r_()}),_r_()},getPluginField:function(){var e;if(_i_("5de:7736a5bd"),this._plugin)switch(this._plugin.pinField){case"pin":e=this.pincode;break;case"lastname":e=this.lastname}return _r_(e)},getPinValue:function(){_i_("5de:21587e25");var e=this.getPluginField();if(e)return _r_(e.find("input").val());_r_()},updateStage:function(e){_i_("5de:80e2e757"),this.stage=e,o.log(e);var i=this.getPluginField();switch(this.hideAll(),e){case"start":this.form.show(),this.pincode.hide(),this.lastname.hide(),this.clearErrors();break;case"getpin":i&&i.show()}_r_()},clearErrors:function(){_i_("5de:457032e4"),n(".form-section .alert-error").remove(),n(".form-section .js-rocket-last-name-error").hide(),_r_()},hideAll:function(){_i_("5de:60099d39"),this.pincode.hide(),this.lastname.hide(),this.messages.hide(),_r_()}}))}),B.define("component/sp/plugable-access-form/tpires-plugin",["component","component/sp/plugable-access-form/dispatcher"],function(e,i){"use strict";_i_("5de:6a7be611");var r=/^\d{16,}$/;return _r_(e.extend({pluginName:"tpires",pinField:"pin",preventDefault:!0,register:function(){_i_("5de:f350b8e7"),i.registerPlugin(this),_r_()},checkReservationId:function(e){if(_i_("5de:7d73198c"),e.match(r))return _r_(!0);return _r_(!1)},checkReservationAccess:function(e,i){_i_("5de:45d4d8a1");var r=this;r.loader.show();var t=void 0;return $.ajax({method:"POST",url:"/tpi_check_login",dataType:"json",data:{res_id:e,pincode:i}}).done(function(e){if(_i_("5de:ad768b8d"),e&&e.res_link)window.location=e.res_link,r.loader.show();else{var i=e&&e[0]&&e[0].code;booking.reportError("Failed to get manageLink"+(i?": "+i:""),"TPI"),r.lastNameError.show(),r.loader.hide()}_r_()}).fail(function(e){_i_("5de:5d7301b9"),t="hide_form",booking.reportError(e,"TPI-reservations"),r.loader.hide(),_r_()}),_r_(t)},init:function(){_i_("5de:1dbdb0af"),this.register(),this.loader=$(".js-rocket-spinner"),this.lastNameError=$(".js-rocket-last-name-error"),_r_()}}))}),B.define("component/sp/plugable-access-form/rocketmiles-plugin",["require","component","component/sp/plugable-access-form/dispatcher"],function(e,i,r){"use strict";_i_("5de:9a33be10");var t=/^\d{8,10}$/,n=/^\w{5,9}$/g,s=/[A-Z]/g,o=e("jquery"),_=window.B||window.booking,a=_.debug("rocketmiles-manage-booking");return _r_(i.extend({pluginName:"rocketmiles",pinField:"lastname",preventDefault:!1,register:function(){_i_("5de:f350b8e71"),r.registerPlugin(this),_r_()},checkReservationId:function(r){if(_i_("5de:9e436c5a"),r.match(n)&&r.match(s))return _r_(!0);if(r.match(t))return _r_(new Promise(function(i,e){_i_("5de:1016b882"),o.ajax({method:"POST",url:"/is_rm_res",dataType:"json",data:{res_id:r}}).done(function(e){_i_("5de:4bdde4f9"),i(e&&!!e.is_rm),_r_()}).fail(function(){_i_("5de:dee99181"),i(!1),_r_()}),_r_()}));return _r_(!1)},checkReservationAccess:function(e,i){_i_("5de:6b78ff39");var r=this;r.loader.show();var t=void 0;return o.ajax({method:"POST",url:"/rm_res_link_validate_last_name",dataType:"json",data:{res_id:e,last_name:i}}).done(function(e){if(_i_("5de:a415bcbf"),e&&e.res_link)window.location=e.res_link,r.loader.show();else{var i=e&&e[0]&&e[0].code;_.reportError("Failed to get manageLink"+(i?": "+i:""),"Rocketmiles"),r.lastNameError.show()}_r_()}).fail(function(e){_i_("5de:fd993b80"),t="hide_form",_.reportError(e,"Rocketmiles"),a.error(e),_r_()}).always(function(){_i_("5de:2c948345"),r.loader.hide(),_r_()}),_r_(t)},init:function(){_i_("5de:53b64d82"),this.register(),this.loader=o(".js-rocket-spinner"),this.rmFrame=o(".js-rocket-iframe"),this.lastNameError=o(".js-rocket-last-name-error"),_r_()}}))}),B.define("component/sp/plugable-access-form/hotelres-plugin",["component","component/sp/plugable-access-form/dispatcher"],function(e,i){"use strict";_i_("5de:db7904f7");var r=/^\d{8,12}$/;return _r_(e.extend({pluginName:"hotelres",pinField:"pin",preventDefault:!1,register:function(){_i_("5de:f350b8e72"),i.registerPlugin(this),_r_()},checkReservationId:function(e){if(_i_("5de:7d73198c1"),e.match(r))return _r_(!0);return _r_(!1)},checkReservationAccess:function(e,i){return _i_("5de:c7adf168"),_r_(!0)},init:function(){_i_("5de:74783f5c"),this.register(),_r_()}}))});