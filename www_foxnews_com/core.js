
/** updated: 07-02-2024 04:52 PM **/
!function(LeapApp){window.leapmetrics=window.leapmetrics||[];var Leap=LeapApp;if(window.leapmetrics)if("object"==typeof window.leapmetrics)if(Array.isArray(window.leapmetrics)){if(0<window.leapmetrics.length)for(;0<window.leapmetrics.length;){var item=window.leapmetrics.shift();Leap.execute(item)}instantiate()}else window.leapmetrics.hasOwnProperty.call(window.leapmetrics,"push")||instantiate();else instantiate();else instantiate();function instantiate(){window.leapmetrics={push:function(){Leap.execute(arguments[0]||null)},pageMetrics:function(pageId){Leap.execute(function(API){API.pageMetrics(pageId)})},__def:window.leapmetrics.__def||function(){return!0}}}}(function(Modulr,DocumentReady){var version,Instance;function TrackMap(require,config,Helper){var Tracking={"auth.profile:sign-in-start":function(attrs){return{event:"Profile Sign In Started",desc:"User starts signing into a profile",options:{page_profile_type:attrs.page_profile_type||"general",page_start_source:attrs.page_start_source||"general"}}},"auth.profile:sign-in-complete":function(attrs){return{event:"Profile Sign In Completed",desc:"User successfully signs into a profile",options:{page_profile_type:attrs.page_profile_type||"general",page_start_source:attrs.page_start_source||"general"}}},"auth.profile:sign-in-error":function(attrs){return{event:"Profile Sign In Error",desc:"User experiences an error",options:{page_error_description:attrs.page_error_description||"no error description",page_error_type:attrs.page_error_type||"no error type",page_start_source:attrs.page_start_source||"general"}}},"auth.profile:sign-in-forgot-password":function(attrs){return{event:"Profile Sign In Forgot Password",desc:"User selects a CTA to retrieve password",options:{page_start_source:attrs.page_start_source||"general"}}},"auth.profile:sign-up-start":function(attrs){return{event:"Profile Sign Up Started",desc:"User starts signing up for a profile",options:{page_start_source:attrs.page_start_source||"general"}}},"auth.profile:sign-up-complete":function(attrs){return{event:"Profile Sign Up Completed",desc:"User completes signing up for a profile",options:{page_profile_type:attrs.page_profile_type||"general",page_start_source:attrs.page_start_source||"general"}}},"auth.profile:sign-up-error":function(attrs){return{event:"Profile Sign Up Error",desc:"User experiences an error",options:{page_error_description:attrs.page_error_description||"no error description",page_error_type:attrs.page_error_type||"no error type",page_start_source:attrs.page_start_source||"general"}}},"auth.profile:logout":function(attrs){return{event:"Profile Logged Out",desc:"User successfully logged out of a profile"}},share:function(attrs){var required=["page_content_shared","page_share_method"],desc="User shares any content via email, facebook, twitter, etc.";return requiredSet(required,attrs)?{event:"Share",desc:desc,options:{page_share_method:attrs.page_share_method,page_content_shared:attrs.page_content_shared}}:{error:!0,event:"Share",desc:desc,required:required,optional:[]}},"commenting:posted":function(attrs){return{event:"Comment Posted",desc:"User posts a comment on an article, thread, etc."}},"auth.mvpd:start":function(attrs){return{event:"Authentication Started",desc:"User lands on the screen to begin MVPD authentication",options:{page_start_source:attrs.page_start_source||"general"}}},"auth.mvpd:select-provider-start":function(attrs){return{event:"Authentication Select Provider Started",desc:"User lands on the screen",options:{page_start_source:attrs.page_start_source||"general"}}},"auth.mvpd:select-provider-complete":function(attrs){var eventId="Authentication Select Provider Completed",required=["page_action_type"],desc="User selects a MVPD and successfully moves on to the next step",optional={page_start_source:"general"};return requiredSet(required,attrs)?{event:eventId,desc:desc,options:{page_start_source:attrs.page_start_source||optional.page_start_source,page_action_type:attrs.page_action_type}}:{error:!0,event:eventId,desc:desc,required:required,optional:optional}},"auth.mvpd:select-provider-error":function(attrs){return{event:"Authentication Select Provider Error",desc:"User experiences a MVPD error",options:{page_error_description:attrs.page_error_description||"no error description",page_error_type:attrs.page_error_type||"no error type",page_start_source:attrs.page_start_source||"general"}}},"auth.mvpd:complete":function(attrs){return{event:"Authentication Completed",desc:"User successfully authenticates with a MVPD",options:{page_start_source:attrs.page_start_source||"general"}}},"auth.mvpd:logout":function(attrs){return{event:"Authentication Logged Out",desc:"User successfully logged out of a MVPD"}},"myFox:userRegister":function(attrs){return{event:"MyFoxUserRegister",desc:"User Registering"}},"search:start":function(attrs){return{event:"Search Started",desc:"User initiates a search"}},"AirshipNotify:in":function(attrs){return{event:"Notification Sign up",desc:"Notifications Allowed"}},"AirshipNotify:seen":function(attrs){return{event:"Notification Pop-up viewed",desc:"Push Notification Seen"}},"AirshipNotify:out":function(attrs){return{event:"Firefox Modal Opt-Out",desc:"Opt-Out"}},"search:complete":function(attrs){var desc="User completes a search",required=["page_search_term","page_num_search_results"];return requiredSet(required,attrs)?{event:"Search Completed",desc:desc,options:{page_search_term:attrs.page_search_term,page_num_search_results:attrs.page_num_search_results}}:{error:!0,event:"Search Completed",desc:desc,required:required,optional:{}}},"search:select":function(attrs){var eventId="Search Result Selected",desc="User selects a search result",required=["page_search_term","page_num_search_results","page_item_title"];return requiredSet(required,attrs)?{event:eventId,desc:desc,options:{page_search_term:attrs.page_search_term,page_num_search_results:attrs.page_num_search_results,page_item_title:attrs.page_item_title}}:{error:!0,event:eventId,desc:desc,required:required,optional:{}}},"favorites:add":function(attrs){var desc="User saves an article, favorites a show, favorites a personality, etc",required=["page_item_title","page_category_title"],optional={page_item_type:"no item type"};return requiredSet(required,attrs)?{event:"Added Favorites",desc:desc,options:{page_item_title:attrs.page_item_title,page_category_title:attrs.page_category_title,page_item_type:attrs.page_item_type||optional.page_item_type}}:{error:!0,event:"Added Favorites",desc:desc,required:required,optional:optional}},"favorites:remove":function(attrs){var desc="User removes a previously saved article, favorited show, favorited personality, etc",required=["page_item_title","page_category_title"];return requiredSet(required,attrs)?{event:"Removed Favorites",desc:desc,options:{page_item_title:attrs.page_item_title,page_category_title:attrs.page_category_title,page_item_type:attrs.page_item_type||"no item type"}}:{error:!0,event:"Removed Favorites",desc:desc,required:required}},"holasparkhp:impression":function(attrs){var eventId="Scroll point impression",desc="User scrolled HolaSpark preview fully into view",required=["page_name","page_collection_title"];return requiredSet(required,attrs)?{event:eventId,desc:desc,options:{page_name:attrs.page_name,page_collection_title:attrs.page_collection_title,page_item_title:attrs.page_item_title,page_item_horizontal_position:attrs.page_item_horizontal_position,page_item_vertical_position:attrs.page_item_vertical_position,page_impression_name:attrs.page_impression_name}}:{error:!0,event:eventId,desc:desc,required:required}},"holasparkhp:playlistaction":function(attrs){var eventId="Playlist Button Action",desc="User arrived at /live via HolaSpark preview",required=["page_name","page_collection_title","page_item_title"];return requiredSet(required,attrs)?{event:eventId,desc:desc,options:{page_name:attrs.page_name,page_action_type:attrs.page_action_type,page_collection_title:attrs.page_collection_title,page_item_title:attrs.page_item_title,page_item_horizontal_position:attrs.page_item_horizontal_position,page_item_vertical_position:attrs.page_item_vertical_position,page_playlist_length:attrs.page_playlist_length,page_impression_name:attrs.page_impression_name}}:{error:!0,event:eventId,desc:desc,required:required}},"banner:impression":function(attrs){var eventId="Banner Notification Impression",desc="User receives a banner notification",required=["page_message_title","page_message_text","page_message_type","page_message_id"];return requiredSet(required,attrs)?{event:eventId,desc:desc,options:{page_message_title:attrs.page_message_title,page_message_text:attrs.page_message_text,page_message_type:attrs.page_message_type,page_message_id:attrs.page_message_id}}:{error:!0,event:eventId,desc:desc,required:required}},"banner:action":function(attrs){var eventId="Banner Notification Action",desc="User takes action on a banner notification",required=["page_message_title","page_message_text","page_message_type","page_message_id","page_action_type"];return requiredSet(required,attrs)?{event:eventId,desc:desc,options:{page_message_title:attrs.page_message_title,page_message_text:attrs.page_message_text,page_message_type:attrs.page_message_type,page_message_id:attrs.page_message_id,page_action_type:attrs.page_action_type}}:{error:!0,event:eventId,desc:desc,required:required}},"newsletter:sign-up-start":function(attrs){var eventId="Newsletter Sign Up Started",required=["page_newsletter_list"],desc="User starts signing up for a newsletter";return requiredSet(required,attrs)?{event:eventId,desc:desc,options:{page_newsletter_list:attrs.page_newsletter_list}}:{error:!0,event:eventId,desc:desc,required:required}},"newsletter:sign-up-complete":function(attrs){var eventId="Newsletter Sign Up Completed",required=["page_newsletter_list"],desc="User successfully submits an email to sign up for newsletters";return requiredSet(required,attrs)?{event:eventId,desc:desc,options:{page_newsletter_list:attrs.page_newsletter_list}}:{error:!0,event:eventId,desc:desc,required:required}},"podcast:start":function(attrs){var required=["page_item_title"],desc="User starts a podcast";return requiredSet(required,attrs)?{event:"Podcast Started",desc:desc,options:{page_item_title:attrs.page_item_title}}:{error:!0,event:"Podcast Started",desc:desc,required:required}},"podcast:complete":function(attrs){var required=["page_item_title"],desc="User completes a podcast";return requiredSet(required,attrs)?{event:"Podcast Completed",desc:desc,options:{page_item_title:attrs.page_item_title}}:{error:!0,event:"Podcast Completed",desc:desc,required:required}},"credible:hyperlink-clicked":function(attrs){var info=attrs.pageInfo||{},page=info.page||{};return{event:"Credible Hyperlink Clicked",desc:"Credible Hyperlink Click track call",options:{page_item_title:attrs.page_item_title,name:info.name,category:info.category,referrer:page.referrer,search:info.search,title:page.title,url:page.url}}},"video:playback-started":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},playback=attrs.playback||{},video=Object.assign(video,ad,playback,content),ad=data.siteId||"";return video.ad_pod_id=attrs.ad_pod_id||"",video.content_asset_id=attrs.content_asset_id||"",video.content_pod_ids=video.video_asset_id||attrs.content_pod_ids||"",video.video_uid=video.video_asset_id||"",{event:"Video Playback Started",desc:"Track video playback start",options:video=removeNulls(video=setVideoBusinessUnits(video,ad))}},"video:playback-completed":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},attrs=attrs.playback||{},video=Object.assign(video,ad,attrs,content),ad=data.siteId||"";return video.video_is_livestream=video.livestream||"",video.video_is_fullscreen=video.full_screen||"",video.video_volume=video.sound||"",{event:"Video Playback Completed",desc:"Track video playback complete",options:video=removeNulls(video=setVideoBusinessUnits(video,ad))}},"video:content-started":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},attrs=attrs.playback||{},video=Object.assign(video,ad,attrs,content),ad=data.siteId||"";return video.video_is_livestream=video.livestream||"",video.video_asset_title=video.title||"",{event:"Video Content Started",desc:"Track video content start",options:video=removeNulls(video=setVideoBusinessUnits(video,ad))}},"video:content-playing":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},attrs=attrs.playback||{},video=Object.assign(video,ad,attrs,content),ad=data.siteId||"";return video.video_is_livestream=video.livestream||"",video.video_asset_title=video.title,{event:"Video Content Playing",desc:"Track video content playing",options:video=removeNulls(video=setVideoBusinessUnits(video,ad))}},"video:content-completed":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},attrs=attrs.playback||{},video=Object.assign(video,ad,attrs,content),ad=data.siteId||"";return video.video_is_livestream=video.livestream||"",video.video_asset_title=video.title,{event:"Video Content Completed",desc:"Track video content complete",options:video=removeNulls(video=setVideoBusinessUnits(video,ad))}},"video:ad-started":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},attrs=attrs.playback||{},video=Object.assign(video,ad,attrs),ad=data.siteId||"";return video.content=content||{},video.ad_enabled=!0,video.program=video.content.program||"",{event:"Video Ad Started",desc:"Track video ad start",options:video=removeNulls(video=setVideoBusinessUnits(video,ad))}},"video:ad-playing":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},attrs=attrs.playback||{},video=Object.assign(video,ad,attrs),ad=data.siteId||"";return video.content=content||{},video.bitrate=video.video_current_bitrate||"",video.ad_enabled=!0,video.video_seconds_viewed="1",{event:"Video Ad Playing",desc:"Track video ad playing",options:video=removeNulls(video=setVideoBusinessUnits(video,ad))}},"video:ad-completed":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},attrs=attrs.playback||{},video=Object.assign(video,ad,attrs),ad=data.siteId||"";return video.content=content||{},video.bitrate=video.video_current_bitrate||"",video.ad_enabled=!0,{event:"Video Ad Completed",desc:"Track video ad complete",options:video=removeNulls(video=setVideoBusinessUnits(video,ad))}},"video:playback-paused":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},attrs=attrs.playback||{};return{event:"Video Playback Paused",desc:"Track video playback pause",options:removeNulls(setVideoBusinessUnits(Object.assign(video,ad,attrs,content),data.siteId||""))}},"video:playback-resumed":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},attrs=attrs.playback||{};return{event:"Video Playback Resumed",desc:"Track video playback resumed",options:removeNulls(setVideoBusinessUnits(Object.assign(video,ad,attrs,content),data.siteId||""))}},"video:playback-buffer-started":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},attrs=attrs.playback||{};return{event:"Video Playback Buffer Started",desc:"Track video playback buffer started",options:removeNulls(setVideoBusinessUnits(Object.assign(video,ad,attrs,content),data.siteId||""))}},"video:playback-buffer-completed":function(attrs,data){var data=(data=data||{}).props||{},video=attrs.video||{},ad=attrs.ad||{},content=attrs.content||{},attrs=attrs.playback||{};return{event:"Video Playback Buffer Completed",desc:"Track video playback buffer completed",options:removeNulls(setVideoBusinessUnits(Object.assign(video,ad,attrs,content),data.siteId||""))}}};function requiredSet(arr,obj){for(var ret=!0,i=0;i<arr.length;i++)if(!obj[arr[i]]){ret=!1;break}return ret}function removeNulls(obj){for(var id in obj)(""===obj[id]||null===obj[id]||void 0===obj[id]||Object.prototype.toString.call("[object Array]"===[])&&obj[id].length<=0)&&delete obj[id];return obj}function setVideoBusinessUnits(obj,siteId){siteId={video_primary_business_unit:"other"!==siteId?"news":"",video_secondary_business_unit:function(siteId){var res="news";return/^fbn/.test(siteId)?res="business":/^fwx/.test(siteId)?res="fox weather":"other"===siteId&&(res=""),res}(siteId)};return obj=Object.assign(obj,siteId)}return{get:function(name,data){var attrs=data&&data.props&&data.props.attrs?data.props.attrs:{};return Tracking[name]?Tracking[name](attrs,data):null},getMapList:function(raw){var id,map={};for(id in Tracking){var item=Tracking[id]({}),eventId=item.event||item.eventId||null;eventId&&(map[id]=raw?item:eventId)}return map}}}return Modulr.setGlobalCacheParam(version=/@deployversion/i.test(version="202407021652")?Modulr.version:version),Modulr.setGlobalCacheCond([{regex:/geo\.js/,param:"cb",noStore:!0}]),DocumentReady(function(){Modulr.setReady()}),(Instance=Modulr.config({instance:"leap.metrics",baseDomain:"//static.foxnews.com",baseUrl:"/static/leap/app",shim:{"akamai.geo":{src:"https://static.foxnews.com/static/orion/scripts/core/utils/geo.js",exports:"FNC.GEO"},"util.jquery":{src:"/static/leap/ext/shims/jq.js",exports:"leapmetrics.__def.jq"},"util.lodash":{src:"/static/leap/ext/shims/ld.js",exports:"leapmetrics.__def.ld"}},paths:{"@PageInfo":"core/properties/index"}})).define("documentReady",function(){return DocumentReady}),Instance.define("jquery",["util.jquery"],function(){return window.leapmetrics.__def.jq}),Instance.define("lodash",["util.lodash"],function(){return window.leapmetrics.__def.ld}),Modulr.define("leap.metrics:core/api",["require","lodash","core/helper","core/config","@PageInfo","core/utils/meta","core/utils/promise","core/utils/log","core/utils/script.loader","core/properties/cookie","core/events/page","core/events/track","core/providers/segment/page"],function(require,_,Helper,config,PageInfo){var Meta=require("core/utils/meta"),PromiseUtil=require("core/utils/promise"),CookieProperties=require("core/properties/cookie"),Page=require("core/events/page"),Track=require("core/events/track"),log=require("core/utils/log")("segment.api"),announce=require("core/utils/log")(null,!0);config.flag&&require(["jquery","lodash"],function($,_){log("versions: jquery=v"+$().jquery+"; lodash=v"+_.VERSION+"; Modulr: v"+Modulr.version)});return function(props){var Proto=this,PROPERTIES=props||{},IS_DISABLED=(PROPERTIES.__custom={},PROPERTIES.disabled||!1),INITIALIZED=!1,EXECUTION_STACK=[],INITIALIZE_ONCE=!1;Proto.track=function(name,attrs,callback){return new PromiseUtil(function(resolve,reject){var info;if(IS_DISABLED||!name)return reject();function trigger(){Track.trigger(info).then(function(data){resolve(data)})}info={name:name,attrs:attrs,meta:Proto.meta(),siteId:Meta.getSiteId(),custom:PROPERTIES.__custom},INITIALIZED?trigger():EXECUTION_STACK.push(trigger)})},Proto.identify=function(name,attrs,callback){var info;IS_DISABLED||(info={name:name,attrs:attrs,siteId:Meta.getSiteId(),custom:PROPERTIES.__custom},name=function(){announce("todo: identify",info)},INITIALIZED?name():EXECUTION_STACK.push(name))},Proto.setProp=function(){if(INITIALIZE_ONCE)return log("[ERROR] cannot set a custom property after an initialization!");var key,val,args=arguments;PROPERTIES.__custom=PROPERTIES.__custom||{},"string"==typeof args[0]&&void 0!==args[1]?(key=args[0],"function"==typeof(val=args[1])?log("setting custom property:",key," = (function)"):log("setting custom property:",key,"=",val),PROPERTIES.__custom[key]=val):"object"!=typeof args[0]||Array.isArray(args[0])||(log("setting custom properties:",args[0]),_.merge(PROPERTIES.__custom,args[0]))},Proto.meta=function(forceReload){return Meta.get(forceReload)},Proto.pageInfo=function(){return PageInfo()},Proto.initialize=function(view,meta,reRun){var args=arguments;return new PromiseUtil(function(resolve,reject){if(IS_DISABLED)return resolve();INITIALIZE_ONCE&&!reRun&&EXECUTION_STACK.push(function(){resolve()}),INITIALIZE_ONCE=!0,log("Initializing..");info={view:"browser",meta:null,siteId:null,keyId:null,custom:{}},"object"==typeof args[0]?(obj=args[0],info.view=obj.view||info.view,info.siteId=obj.siteId||null,info.keyId=obj.keyId||null,info.custom=obj.custom||{}):info.view=view||info.view,-1<["amp","fbia"].indexOf(info.view)&&meta&&(info.meta=meta);var info,obj,conf=info;if(conf.siteId=conf.siteId||Meta.get(!0).page.siteId||"other",Meta.setSiteId(conf.siteId),"browser"===conf.view&&(conf.meta=Meta.get(!0)),conf.keyId=conf.keyId||config.SEGMENT_KEY[conf.siteId]||null,!conf.keyId||!conf.meta)return IS_DISABLED=!0,conf.keyId?conf.meta||announce('[WARNING] disabled! no meta for site: "'+conf.siteId+'"'):announce('[WARNING] disabled! no key for site: "'+conf.siteId+'"'),resolve(!1);conf.custom=_.merge(PROPERTIES.__custom,conf.custom),conf.reRun=reRun,require(["core/providers/segment/load"],function(Init){Init(conf.siteId,conf.keyId),log("Initialization done!"),PageInfo.initialize(conf.custom,function(){Page.trigger(conf).then(function(){for(resolve();0<EXECUTION_STACK.length;)EXECUTION_STACK.shift()();INITIALIZED=!0})})})})},Proto.pageMetrics=function(pageId){IS_DISABLED||announce("[ WARN ] Page Events has been deprecated!")},Proto.pageEvent=function(name,data){IS_DISABLED||announce("[ WARN ] Page Events has been deprecated!")},Proto.callPage=function(traits){require("core/providers/segment/page").callPage(traits)},Proto.cookieProps=CookieProperties}}),Modulr.define("leap.metrics:core/config",["require"],function(require){var res,config={version:"v53",deployTimestamp:"202407021652"};return config.flag=-1<window.location.search.indexOf("_leap=1"),config.env=res=!/\@buildEnv/i.test(res="prod")&&-1<["dev","stage","prod"].indexOf(res)?res:"prod",config.hostPath="//static.foxnews.com/static/leap",config.SEGMENT_KEY={fnc:"4I2fAtE5IxTlczNT3F91OckHtI5wfR7g",fbn:"8eHBndHSjYxRMyj3exjJdOCozQOktBab",fwx:"hTNfeDlIxEoJo0M65KH08sXHQtNpHgRG",nation:"zF2CN4vDTQaohrGCQnxqTIda1NSn4PEF",radio:"qB8yWKOOtThTzX7H4FhljWq4F21AR1pl",insider:"4mXEBmj4qFaNMeqCa6nSpPxjDP5d3usc"},config.EU_List=["segment"],config}),Modulr.define("leap.metrics:core/events/page",["require","core/config","core/helper","core/utils/meta","core/utils/log","core/utils/script.loader"],function(require,config,Helper,Meta){require("core/utils/log")("events.page");var ScriptLoader=require("core/utils/script.loader"),PROVIDER_LIST=["segment"];return new function(){this.trigger=function(props){var view=props.view||"browser";props.meta;return(view==="browser"?true:false)&&-1<["fbn","fnc","fwx"].indexOf(props.siteId)&&(view=props.siteId,ScriptLoader(config.hostPath+"/sites/"+view+"/metrics.js?v="+config.deployTimestamp)),Helper.executeModules(PROVIDER_LIST,props,"core/providers/$1/page")}}}),Modulr.define("leap.metrics:core/events/track",["require","core/config","core/helper","core/utils/meta","core/utils/log"],function(require,config,Helper,Meta){require("core/utils/log")("events.page");var PROVIDER_LIST=["segment"];return new function(){this.trigger=function(props){return Helper.executeModules(PROVIDER_LIST,{props:props},"core/providers/$1/track")}}}),Modulr.define("leap.metrics:core/helper",["require","core/utils/promise","core/utils/promise.iterator","core/utils/log"],function(require,PromiseUtil,PromiseIterator){var log=require("core/utils/log")("helper");return new function(){this.executeModules=function(modules,data,replacePath){return new PromiseUtil(function(resolve,reject){var dataset={};PromiseIterator(modules,function(next,i,step,stop){var moduleId=modules[i],modulePath=moduleId;replacePath&&(modulePath=replacePath.replace("$1",moduleId)),require([modulePath],function(Mod){"function"==typeof Mod.trigger?Mod.trigger(data).then(function(data){dataset[moduleId]=data||null,step()}):(log("module does not have a promise:",modules[i]),dataset[moduleId]=null,step())})},function(){resolve(dataset)})})},this.isFn=function(val){return"function"==typeof val},this.getTrackingNameDetails=function(val){var sp=val.split(":"),bool=0<sp.length;return{id:bool?sp.slice(1).join(":"):val,group:bool?sp[0]:null}},this.removeNulls=function(obj){for(var id in obj)null!==obj[id]&&void 0!==obj[id]||delete obj[id];return obj}}}),Modulr.define("leap.metrics:core/properties/_shared",["require","lodash","core/properties/cookie","core/utils/query.param"],function(require,_,CookieProperties,QueryParam){return new function(){this.getAppName=function(siteId){return siteId&&{fnc:"foxnews.com",fbn:"foxbusiness.com",fwx:"foxweather.com",insider:"insider.foxnews.com",radio:"radio.foxnews.com",nation:"foxnation",business:"foxbusiness.com",news:"foxnews.com",wnyw:"fox5ny.com",wwor:"my9nj.com",kttv:"foxla.com",wfld:"fox32chicago.com",wtxf:"fox29.com",kdfw:"fox4news.com",wttg:"fox5dc.com",kriv:"fox26houston.com",ktvu:"ktvu.com",waga:"fox5atlanta.com",wtvt:"fox13news.com",ksaz:"fox10phoenix.com",wjbk:"fox2detroit.com",kmsp:"fox9.com",wofl:"fox35orlando.com",wjzy:"fox46charlotte.com",ktbc:"fox7austin.com",wogx:"wogx.com",kcpq:"q13fox.com",coro:"coronavirusnow.com"}[siteId]||"Other"},this.getNameMap=function(siteId){var res={"section-front":"Category Landing",category:"Subcategory Landing",article:"Article Landing",video:"Video Landing",playlist:"Video Playlist",homepage:"Homepage",404:"404 Landing",other:"Other"};return"foxweather.com"!==siteId&&"fwx"!==siteId||_.merge(res,{search:"Find Section Search",article:"Articles Page Landing"}),res},this.getCookieValues=function(){return CookieProperties()},this.getCampaignTracking=function(){var cmpid=QueryParam.getVal("cmpid"),res=null,sp=cmpid&&0<cmpid.length?cmpid.split("::"):null;if(sp){for(var info=null,i=0;i<sp.length;i++){var key,item=sp[i],index=item.indexOf("=");1<index&&(info=info||{},key=item.slice(0,index),item=item.slice(index+1),info[key]=item)}res={str:cmpid,data:info||{}}}return res}}}),Modulr.define("leap.metrics:core/properties/browser",["require","jquery","lodash","core/helper","core/config","core/properties/_shared","core/utils/meta","core/utils/datetime","core/utils/query.param","akamai.geo"],function(require,$,_,Helper,config,Shared,Meta){var DateTime=require("core/utils/datetime");require("core/utils/query.param");return function(opts){var res,codes,siteId,CURRENT_TIMESTAMP=window.FNC.GEO.time.getCurrent(),cookieVals=Shared.getCookieValues(),meta=(opts=opts||{}).meta||Meta.get(!0),custom=opts.custom||{},SITE_ID=meta.page.siteId,opts=Shared.getNameMap(SITE_ID),info={name:opts[custom.custom_page_name]||custom.custom_page_name||opts[meta.page.type]||meta.page.type,category:meta.raw["prism.section"]||null,page:{title:meta.page.title,url:meta.page.url,path:meta.page.path,referrer:document.referrer||""}};function getMetaDate(dt,both){var dt=function(val){var match,res="";return-1<val.indexOf("T")?res=val.split("T"):/^([0-9]{4})\-([0-9]{1,2})\-([0-9]{1,2})(.+)(AM|PM)$/.test(val)&&(match=val.match(/^([0-9]{4})\-([0-9]{1,2})\-([0-9]{1,2})(.+)(AM|PM)$/))&&6===match.length&&(val=[match[2],match[3],match[1]].join("/")+match[4]+match[5],res=DateTime(new Date(val),"%Y-%m-%d %H:%i:%s").split(" ")),res}(dt||""),date=dt[0]||"",dt=dt[1]||"",both=both?{date:date,time:dt=dt&&dt.split(":").slice(0,2).join(":")}:date.split("-");return both}function getPageType(){var res=meta.raw["prism.section"];return res="root"===(res=-1<["category","article"].indexOf(meta.page.type)?concat([meta.raw["prism.subsection1"],meta.raw["prism.subsection2"]])||res:res)?"homepage":res}function isDeprecated(val){return"fwx"===SITE_ID?null:val}function setProp(val,deprecationCheck){var ret=function(){var res;switch(SITE_ID){case"insider":res="fox:news-insider";break;case"radio":res="fox:news-radio";break;case"nation":res="fox:news-nation";break;case"fwx":res="foxweather";break;case"fbn":res="fox:business";break;case"fnc":res="fox:news";break;default:res="other"}return res}()+":web",val=concat(val||"");return 0<val.length&&(ret+=":"+val),deprecationCheck?isDeprecated(ret):ret}function concat(val){var ret="";if(val&&"string"==typeof val)ret=val;else if(val&&Array.isArray(val)&&0<val.length){for(var agg=[],i=0;i<val.length;i++)val[i]&&agg.push(val[i]);0<agg.length&&(ret=agg.join(":"))}return ret}return info.options=(opts=[SITE_ID,config.version].join("-"),codes=Shared.getCampaignTracking(),siteId={properties:{primary_business_unit:"other"!==SITE_ID?"news":"",secondary_business_unit:(res="news",/^fbn/.test(siteId=SITE_ID)?res="business":/^fwx/.test(siteId)?res="fox weather":"other"===siteId&&(res=""),res),app_name:Shared.getAppName(SITE_ID),app_platform:"web",app_version:opts,appsflyer_id:null},traits:{dcg_profile_id:cookieVals.userProfileId||"",appsflyer_id:"",mvpd:cookieVals.mvpdId||"",network_entitlement_list:"",lastAnonymousProfileId:cookieVals.lastAnonymousProfileId||cookieVals.persistAnonId||window.localStorage.getItem("anon_fpid")||window.localStorage.getItem("persist_fpid")||"",lastKnownProfileId:cookieVals.lastKnownId||cookieVals.userProfileId||"",campaign_tracking_code:codes&&codes.str||"",campaign_int_tracking_code:custom.intcmp||"",isSignedIntoProfile:!!cookieVals.userProfileId}},/^fwx/.test(SITE_ID)&&(siteId.traits.us_privacy=cookieVals.usprivacy||function(){if(-1<document.cookie.indexOf("usprivacy")){var c=document.cookie.substr(document.cookie.indexOf("usprivacy"),14);if(c)return c.split("=")[1].split(";")[0]}return null}()),Helper.removeNulls(siteId.properties),Helper.removeNulls(siteId.traits),siteId),info.properties=function(){var pieces,searchIndex,id,d,res,modified,obj={author:meta.raw["dc.publisher"]||null,page_name:setProp(meta.raw["prism.section"])||"no name",page_type:getPageType()||"other",app_name:Shared.getAppName(SITE_ID),app_platform:"web",app_version:config.version,app_build:config.deployTimestamp,page_timePartingDay:isDeprecated(DateTime(CURRENT_TIMESTAMP,"%D")),page_timePartingHour:((res=[]).push(DateTime(d=CURRENT_TIMESTAMP,"%H")),d=parseInt(DateTime(d,"%i"),10),res.push(d<30?"00":"30"),isDeprecated(res.join(":")))};if("fwx"===SITE_ID&&"other"!==getPageType())switch(getPageType()){case"home":obj.page_name+=":landing";break;case"search":obj.page_name=(pieces=obj.page_name.split(":"),searchIndex=pieces.indexOf("search"),pieces[searchIndex]="find:"+pieces[searchIndex],pieces.join(":")),obj.page_type="find:"+obj.page_type}for(id in info.options.properties)obj[id]=info.options.properties[id];return"other"!==SITE_ID&&("category"===meta.page.type?_.merge(obj,{page_name:setProp([meta.raw["prism.subsection1"],meta.raw["prism.subsection2"]]),page_content_level_1:setProp(null,!0),page_content_level_2:setProp([meta.raw["prism.subsection1"]],!0),page_content_level_3:setProp([meta.raw["prism.subsection1"],meta.raw["prism.subsection2"]],!0),page_content_level_4:setProp([meta.raw["prism.subsection1"],meta.raw["prism.subsection2"],meta.raw["prism.subsection3"]],!0)}):"article"===meta.page.type?(d=meta.raw["classification-isa"]?meta.raw["classification-isa"].split(",")[0]:"",res=getMetaDate(meta.raw["dc.date"]),res=[meta.raw["prism.section"],res[0],res[1],res[2],(meta.raw["og:title"]||meta.raw["dc.title"]||$("title:first").text()||"").replace(/\:/g,"\\:")],_.merge(obj,{page_type:concat([meta.raw["prism.section"],d]),page_name:setProp(res),page_content_level_1:setProp(res.slice(0,1),!0),page_content_level_2:setProp(res.slice(0,2),!0),page_content_level_3:setProp(res.slice(0,3),!0),page_content_level_4:setProp(res,!0)})):("search"!==meta.page.type||/^fwx/.test(SITE_ID)||_.merge(obj,{page_name:setProp(["find:search"]),page_type:"find:search"}),_.merge(obj,{page_content_level_1:setProp(null,!0),page_content_level_2:setProp(meta.raw["prism.section"],!0),page_content_level_3:setProp([meta.raw["prism.section"],meta.raw["prism.subsection1"]],!0),page_content_level_4:setProp([meta.raw["prism.section"],meta.raw["prism.subsection1"],meta.raw["prism.subsection2"]],!0)})),_.merge(obj,{page_test_name:null,push_enabled:null,page_content_type:meta.page.type,page_content_category:(obj.page_type||"").split(":")[0]||null,page_content_distributor:"owned",page_content_originator:function(){var res=null;return res="article"===(meta.page.type||"")&&meta.raw["dc.source"]?meta.raw["dc.source"]:res}(),page_content_language:meta.raw["dc.language"]||null,page_login_state:null,page_content_type_of_story:function(source){var res=null;if("article"===meta.page.type)switch(res="original",SITE_ID){case"fnc":/fox(.+|)news/i.test(source)||(res="partners");break;case"fbn":/fox(.+|)business/i.test(source)||(res="partners")}return res}(meta.raw["dc.source"]||""),page_content_version:null,page_is_dark_mode:!1}),d={created:getMetaDate(meta.raw["dcterms.created"],!0),modified:getMetaDate(meta.raw["dcterms.modified"],!0),major:getMetaDate(meta.raw["dcterms.modified"],!0)},res=d.created,modified=d.modified,d=d.major,_.merge(obj,{page_content_original_publish_date:res.date||null,page_content_major_publish_date:d.date||null,page_content_modified_date:modified.date||null,page_content_original_publish_time:res.time||null,page_content_major_publish_time:d.time||null,page_content_modified_time:modified.time||null}),info.pageOnlyProperties=function(){var res={keywords:meta.raw.keywords||null,page_content_personality:null,page_content_author:(res=null,res="article"===(meta.page.type||"")&&meta.raw["dc.creator"]?meta.raw["dc.creator"]:res),page_content_author_secondary:null,page_content_title:meta.page.title,page_content_id:function(id){var res=null;return res=id?id.replace(/^urn\:(uuid\:|uri\:base64\:)/i,""):res}(meta.raw["dc.identifier"]||null),page_content_tags:meta.raw.classification||meta.raw["classification-isa"]||null,page_content_subcategory:(obj.page_type||"").split(":")[1]||null};return _.merge(obj,res),null}(),function(){var res,info=Shared.getCampaignTracking(),cmpid=info&&info.str?info.str:null,info=info&&info.data?info.data:null;_.merge(obj,{appsflyer_tracking_code:null,campaign_tracking_code:(res=null,res=/^org\=/.test(cmpid=cmpid)?cmpid:res),campaign_int_tracking_code:function(q){var res=null;return res=/^int_org\=/.test(q)||q&&-1<["fwx","fnc","fbn"].indexOf(SITE_ID)?q:res}(custom.intcmp||"")}),info&&_.merge(obj,{campaign_organization:info.org,campaign_agency:info.ag,campaign_marketing_channel:info.mc,campaign_source:info.src,campaign_name:info.cmp,campaign_additional:info.add})}(),Helper.removeNulls(obj)),obj}(),window.analytics.ready(function(){var user=window.analytics.user();user&&user.traits(info.options.traits)}),info}}),Modulr.define("leap.metrics:core/properties/cookie",["require","core/utils/cookie"],function(require,Cookie){return function(type,keyVal){var data=function(str){var res={};if(str)try{res=JSON.parse(str)}catch(err){}return res}(Cookie("__leap_props"));if("set"===type&&"object"==typeof keyVal){for(var id in keyVal)keyVal.hasOwnProperty.call(keyVal,id)&&(data[id]=keyVal[id]||"");Cookie("__leap_props",JSON.stringify(data),{expires:30,path:"/",domain:window.location.hostname.replace(/(.+)\.(.+)\.com$/,".$2.com")})}return data}}),Modulr.define("leap.metrics:core/properties/index",["require","lodash","core/properties/browser","core/properties/token","core/utils/promise","core/utils/log"],function(require,_,Browser,Token,Promise){function App(attrs){var res=("token"===(attrs=attrs||{}).type?Token:Browser)(attrs);return CUSTOM_OVERRIDES&&((attrs=CUSTOM_OVERRIDES(res,attrs))?"object"!=typeof attrs||Array.isArray(attrs)||(log("custom override data:",attrs),res=_.merge(res,attrs),log("custom data result:",res)):announce("[ WARNING ] custom page info overrides returned nothing!")),_.merge(res,{properties:ASYNC_PROPERTIES}),res}var log=require("core/utils/log")("@PageInfo"),announce=require("core/utils/log")(null,!0),CUSTOM_OVERRIDES=null,ASYNC_PROPERTIES={};return App.initialize=function(custom,callback){custom&&"function"==typeof custom["custom.page.info"]&&(CUSTOM_OVERRIDES=custom["custom.page.info"]),Promise.all([new Promise(function(resolve){var LOADED=!1;function formatExp(){if(!LOADED){LOADED=!0;var exp,obj={},runningExp=window.Taplytics.runningExperiments(),expArr=[];for(exp in runningExp)expArr.push(`${exp}: '${runningExp[exp]}'`);0!==expArr.length&&_.merge(obj,{page_test_name:expArr.join(", ")}),resolve(obj)}}window.Taplytics?formatExp():(document.addEventListener("taplytics:loaded",formatExp,!1),setTimeout(function(){LOADED||(LOADED=!0,announce("[ WARNING ] Taplytics did not load after 500ms"),resolve())},500))})]).then(function(payload){payload.forEach(function(data){data&&"object"==typeof data&&_.merge(ASYNC_PROPERTIES,data)}),"function"==typeof callback&&callback()})},App}),Modulr.define("leap.metrics:core/properties/token",["require","lodash","core/helper","core/config","core/properties/_shared","core/utils/meta","core/utils/datetime","akamai.geo"],function(require,_,Helper,config,Shared,Meta){var DateTime=require("core/utils/datetime");return function(opts){var CURRENT_TIMESTAMP=window.FNC.GEO.time.getCurrent(),view=opts.view,meta=opts.meta||{},opts=(opts.custom,opts=meta.prop15||"",id="other",opts=opts.replace(/\s+/g,""),/foxbusiness/i.test(opts)?id="fbn":/foxnews/i.test(opts)?id="fnc":/weather/i.test(opts)&&(id="fwx"),Shared.getAppName(id)),NAME_MAP=("amp"===view&&(id=meta.hier1.split(","),opts=Shared.getAppName(id[0])),Shared.getNameMap(opts)),id=opts,path=function(val){return val=val&&"/"+(val=(val=val.replace(/\:/g,"/")).replace(/\/$/g,""))+("amp"===view?".amp":"")}(meta.prop40||""),name=function(val){return NAME_MAP[val]||val}(meta.prop13||"article"),res=(res=["https://"],/(fnc|fbn|foxnews|foxbusiness)/.test(opts)&&res.push("www."),res.push(id+path),res.join("")),name={name:name,category:meta.prop1||null,page:{title:meta.prop12||"no title",url:res,path:path,search:""}};return name.properties={keywords:"",page_name:meta.prop1||"",page_type:meta.prop1||"",app_name:id,app_platform:"web",app_version:config.version,app_build:config.deployTimestamp,page_timePartingDay:DateTime(CURRENT_TIMESTAMP,"%D"),page_timePartingHour:function(d){var res=[],d=(res.push(DateTime(d,"%H")),parseInt(DateTime(d,"%i"),10));return res.push(d<30?"00":"30"),res.join(":")}(CURRENT_TIMESTAMP),page_test_name:null,push_enabled:null,appsflyer_tracking_code:null,campaign_tracking_code:null,campaign_int_tracking_code:null,campaign_organization:null,campaign_marketing_channel:null,campaign_source:null,campaign_name:null,campaign_additional:null,campaign_agency:null,page_content_personality:null,page_content_author:meta.prop14||null,page_content_author_secondary:null,page_content_version:null,page_content_title:meta.prop12||null,page_content_id:meta.prop11||null,page_content_type:meta.prop13||null,page_content_type_of_story:null,page_content_tags:meta.hier1||null,page_content_category:meta.prop1||null,page_content_subcategory:null,page_content_language:null,page_login_state:null,page_content_originator:meta.prop15||null,page_content_distributor:view,page_content_original_publish_date:meta.prop54||null,page_content_major_publish_date:meta.prop54||null,page_content_modified_date:meta.prop54||null,page_content_original_publish_time:null,page_content_major_publish_time:null,page_content_modified_time:null},name.options={properties:{primary_business_unit:"news",secondary_business_unit:function(siteId){return/business/.test(siteId)?"business":"news"}(meta.prop15||""),app_name:id,app_platform:"web",app_version:config.version},traits:{dcg_profile_id:"",appsflyer_id:"",mvpd:"",network_entitlement_list:"",lastAnonymousProfileId:"",lastKnownProfileId:""}},-1<opts.indexOf("foxweather")&&(res=name.options.traits,(path=function(){if(-1<document.cookie.indexOf("usprivacy")){var c=document.cookie.substr(document.cookie.indexOf("usprivacy"),14);if(c)return c.split("=")[1].split(";")[0]}return null}())&&(res.us_privacy=path)),_.merge(name.properties,name.page),Helper.removeNulls(name.properties),name}}),Modulr.define("leap.metrics:core/providers/segment/load",["require","core/config","core/utils/log","core/utils/eu"],function(require,config){var log=require("core/utils/log")("segment.load"),announce=require("core/utils/log")(null,!0);require("core/utils/eu").allowProvider("segment");return function(siteId,keyId){if(!window.analytics){keyId=keyId||config.SEGMENT_KEY[siteId];if(log("segment key id ["+siteId+"]:",keyId),!keyId)return announce("[error] no key id! for:",siteId);var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0,analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"],analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);return e.unshift(t),analytics.push(e),analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script"),t=(e.type="text/javascript",e.async=!0,e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)},analytics.SNIPPET_VERSION="4.0.0"}"fwx"!==siteId&&(keyId=null),window.analytics.load(keyId)}}}),Modulr.define("leap.metrics:core/providers/segment/page",["require","jquery","core/config","core/utils/meta","@PageInfo","core/utils/log","core/utils/promise","core/utils/datetime","core/utils/query.param","akamai.geo"],function(require,$,config,Meta,PageInfo){var log=require("core/utils/log")("segment.page.call"),PromiseUtil=require("core/utils/promise");require("core/utils/datetime"),require("core/utils/query.param");return new function(){var TRIGGERED=!1,VALID_VIEWS=(window.FNC.GEO.time.getCurrent(),["browser","amp","fbia"]),pageArgs=null,hasFired=!1;this.trigger=function(props){var meta=props.meta,view=props.view,cookies=document.cookie.split("; "),xid=function(){for(var r=null,i=0;i<cookies.length;i++)cookies[i].startsWith("xid")&&(r=cookies[i].split("=")[1]);return r}();return new PromiseUtil(function(resolve,reject){var data,info;return-1<VALID_VIEWS.indexOf(view)?("other"===props.siteId&&log("[warning] siteId not detected.",!0),TRIGGERED&&!props.reRun?resolve():(TRIGGERED=!0,void("browser"===view&&function(meta,custom){var url=meta.page.url,res=!1;if(Array.isArray(custom.noPageEvent))for(var i=0,len=custom.noPageEvent.length;i<len;i++){var item=custom.noPageEvent[i];if(-1<url.indexOf(item)){res=!0;break}}else(-1<url.indexOf("/html/video/iframe/")||-1<url.indexOf("/p/video/app/embed/iframe/")||-1<url.indexOf("/segment/player-frame")||-1<url.indexOf("/v/video-embed"))&&(res=!0);return res}(meta,props.custom)?log("no page call for:",meta.page.url):(data=-1<["amp","fbia"].indexOf(view)?PageInfo({type:"token",view:view,meta:meta,custom:props.custom}):PageInfo({type:"default",pageOnly:!0,custom:props.custom}),log("values:",(info={segment:{name:data.name,properties:data.properties,options:data.options}},data.category&&(info.segment.category=data.category),info)),data.options&&data.options.traits&&document.location.hostname.includes("foxweather.com")&&(data.options.traits.user_xid=xid),data.name&&data.properties&&data.options?(info=[data.name,data.properties,data.options,function(){resolve({type:"page",data:data})}],data.category&&info.unshift(data.category),"amp"===props.view||-1===["fbn","fnc"].indexOf(props.siteId)||data.options.traits&&(data.options.traits.lastAnonymousProfileId||data.options.traits.lastKnownProfileId)?(window.analytics.page.apply(window.analytics.page,info),hasFired=!0):pageArgs=info):(log("page call did not fire. missing required values!"),resolve({type:"page",error:!0,data:data})))))):(log("[error] Invalid page view type:",view),resolve())})},this.callPage=function(traits){if(!hasFired&&pageArgs){var traitIndex=-1;if([].forEach.call(pageArgs,function(v,idx){v.traits&&(traitIndex=idx)}),0<=traitIndex)for(var trait in traits)traits[trait]&&(pageArgs[traitIndex].traits[trait]=traits[trait]);window.analytics.page.apply(window.analytics.page,pageArgs),hasFired=!0}}}}),void 0!==Modulr?Modulr.define("leap.metrics:core/providers/segment/track.map",["require","core/config","core/helper"],TrackMap):"undefined"!=typeof module&&module.exports&&(module.exports=TrackMap()),Modulr.define("leap.metrics:core/providers/segment/track",["require","lodash","core/config","@PageInfo","core/utils/log","core/utils/promise","core/providers/segment/track.map"],function(require,_,config,PageInfo){var log=require("core/utils/log")("segment.page.track"),Map=require("core/providers/segment/track.map"),PromiseUtil=require("core/utils/promise");return new function(){this.trigger=function(data){return new PromiseUtil(function(resolve,reject){var properties,props=data.props,custom=props&&props.custom||{},custom=custom&&custom.intcmp,cookies=(props.meta,document.cookie.split("; ")),xid=function(){for(var r=null,i=0;i<cookies.length;i++)cookies[i].startsWith("xid")&&(r=cookies[i].split("=")[1]);return r}(),pageInfo=PageInfo(),trackData=Map.get(props.name,data);function done(){resolve({type:"track",data:trackData})}pageInfo&&pageInfo.properties.page_test_name&&delete pageInfo.properties.page_test_name,trackData.error?done():(properties=_.cloneDeep(pageInfo.properties),pageInfo=_.cloneDeep(pageInfo.options),_.merge(properties,trackData.options||{}),log("values:",{siteId:props.siteId,error:!!trackData.error,segment:{event:trackData.event||trackData.eventId,properties:properties,options:pageInfo}}),pageInfo&&pageInfo.traits&&document.location.hostname.includes("foxweather.com")&&(pageInfo.traits.user_xid=xid),!(pageInfo&&pageInfo.traits||{}).campaign_int_tracking_code&&custom&&(pageInfo.traits.campaign_int_tracking_code=custom),window.analytics.track(trackData.event,properties,pageInfo,function(){done()}))})}}}),Modulr.define("leap.metrics:core/utils/cookie",["require"],function(require){return function(name,value,options){if(void 0===value){var cookieValue=null;if(document.cookie&&""!==document.cookie)for(var cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){var cookie=(cookies[i]||"").replace(/^\s+|\s+$/g,"");if(cookie.substring(0,name.length+1)===name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}return cookieValue}options=options||{},null===value&&(value="",options.expires=-1);var expires="",date=(options.expires&&("number"==typeof options.expires||options.expires.toUTCString)&&("number"==typeof options.expires?(date=new Date).setTime(date.getTime()+24*options.expires*60*60*1e3):date=options.expires,expires="; expires="+date.toUTCString()),options.path?"; path="+options.path:""),domain=options.domain?"; domain="+options.domain:"",options=options.secure?"; secure":"";return document.cookie=[name,"=",encodeURIComponent(value),expires,date,domain,options].join(""),""}}),Modulr.define("leap.metrics:core/utils/datetime",["require"],function(require){return toStr=function(val){return(val=isNaN(val)?"":val).toString()},function(date,formatStr){var date={month:date.getUTCMonth(),day:date.getDay(),year:date.getFullYear(),date:date.getDate(),hour:date.getHours(),minutes:date.getMinutes(),seconds:date.getSeconds(),ampm:date.getHours()<12?"am":"pm",fullStr:date.toString()},replace=[["%m",date.month<9?"0"+(date.month+1):date.month+1],["%M:s",getUTCMonthString(date.month,"short")],["%M",getUTCMonthString(date.month)],["%d:o",function(n){if((n=(n||"").toString()).length<1)return n;var s="",num=parseInt(n,10),tens=num>99?parseInt(n.slice(n.length-2),10):num<20?num:false;if(tens>=11&&tens<20)s="th";else{var lastDigit=parseInt(n.charAt(n.length-1),10);switch(lastDigit){case 1:s="st";break;case 2:s="nd";break;case 3:s="rd";break;default:s="th";break}}return n+s}(date.date)],["%d",date.date<10?"0"+toStr(date.date):toStr(date.date)],["%D:s",getDayString(date.day,"short")],["%D",getDayString(date.day)],["%Y:r",function(n){n=parseInt(n,10);for(var numerals=[["M",1e3],["CM",900],["D",500],["CD",400],["C",100],["XC",90],["L",50],["XL",40],["X",10],["IX",9],["V",5],["IV",4],["I",1]],i,arr=[],i=0;i<numerals.length;i++){var item=numerals[i],rn=item[0],val=item[1];while(n>=val){arr.push(rn);n=n-val}}return arr.join("")}(date.year)],["%Y",date.year],["%y",toStr(date.year).substr(2)],["%h",prefixZero(12<date.hour?date.hour-12:date.hour)],["%H",prefixZero(date.hour)],["%i",prefixZero(date.minutes)],["%s",prefixZero(date.seconds)],["%ampm",date.ampm],["%AMPM",date.ampm.toUpperCase()],["%AmPm",date.ampm.charAt(0).toUpperCase()+date.ampm.charAt(1)]];if("string"==typeof formatStr&&formatStr)for(var i=0;i<replace.length;i++){var item=replace[i],fmt=item[0],item=item[1],fmt=new RegExp(fmt,"g");formatStr=formatStr.replace(fmt,item)}else formatStr=date.fullStr;return formatStr};function getDayString(n,type){return n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][n],n="short"===type?n.slice(0,3):n}function getUTCMonthString(n,type){return n=["January","February","March","April","May","June","July","August","September","October","November","December"][n]||"",n="short"===type?n.slice(0,3):n}function prefixZero(val){return val<10?"0"+toStr(val):val}var toStr}),Modulr.define("leap.metrics:core/utils/eu",["require","core/config","core/utils/load.attempt","core/utils/query.param","core/utils/log","akamai.geo"],function(require,config,LoadAttempt,QueryParam){require("core/utils/log")("EU");var codes=["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB"];return new function(){var Proto=this,EU_OVERRIDE=-1<window.location.search.indexOf("_akovr=1");function isEU(){var info=window.FNC.GEO.geo.get(),code=QueryParam.getVal("_akgeo_code")||info.countryCode||null,info=QueryParam.getVal("_akgeo_cont")||info.continent||null;return!!EU_OVERRIDE||"EU"===info&&-1<codes.indexOf(code)}Proto.enabled=function(){return!0},Proto.check=function(callback){if("function"!=typeof callback)return isEU();callback(isEU())},Proto.allowProvider=function(provider){return!Proto.check()||!!function(provider){return"string"==typeof provider&&-1<config.EU_List.indexOf(provider)}(provider)}}}),Modulr.define("leap.metrics:core/utils/load.attempt",["require"],function(require){return window,function(){function fn(){}function isNum(val){return"number"==typeof val}function isFunc(val){return"function"==typeof val}var CONST_attempts=999,CONST_timeout=500;return function(){var args=arguments,cfg=!1;isNum(args[0])&&isNum(args[1])&&isFunc(args[2])?cfg={attempts:args[0],timeout:args[1],check:args[2],success:isFunc(args[3])?args[3]:fn,expires:isFunc(args[4])?args[4]:fn}:isNum(args[0])&&isFunc(args[1])?cfg={attempts:args[0],timeout:CONST_timeout,check:args[1],success:isFunc(args[2])?args[2]:fn,expires:isFunc(args[3])?args[3]:fn}:isFunc(args[0])&&(cfg={attempts:CONST_attempts,timeout:CONST_timeout,check:args[0],success:isFunc(args[1])?args[1]:fn,expires:isFunc(args[2])?args[2]:fn});function attempt(){isAbort?(clearTimeout(timeout),isExpires="aborted",cfg.expires(isExpires)):cfg.check()?(isSuccess=!0,cfg.success(),clearTimeout(timeout)):0<cfg.attempts?timeout=setTimeout(function(){attempt()},cfg.timeout):(isExpires="expired",cfg.expires(isExpires)),cfg.attempts--}var timeout,isAbort=!1,isExpires=!1,isSuccess=!1;return attempt(),{abort:function(){isAbort=!0},success:function(success){isSuccess?success():cfg.success=success},expires:function(expires){isExpires?expires(isExpires):cfg.expires=expires}}}}()}),Modulr.define("leap.metrics:core/utils/log",["require","core/utils/cookie"],function(require,Cookie){return function(addPrefix,force){var prefix=["[LeapMetrics]",addPrefix=addPrefix?" '"+addPrefix.replace(/^\s+|\s$/g,"")+"'":""].join("")+" >>",allow=function(){if(force)return!0;if(-1<window.location.search.indexOf("_leap=0"))return Cookie("_leap",null),!1;var res=-1<window.location.search.indexOf("_leap=1");return res?Cookie("_leap","y",{path:"/",expires:null}):"y"===Cookie("_leap")&&(res=!0),res}();return function(){if(!allow)return!1;var args=Array.prototype.slice.call(arguments),args=[prefix].concat(args);if(allow&&window.console)try{return window.console.log.apply(console,args)}catch(err){}}}}),Modulr.define("leap.metrics:core/utils/meta",["require","jquery","core/helper","core/utils/log"],function(require,$,Helper){require("core/utils/log")("core.utils.meta");var announce=require("core/utils/log")(null,!0);return new function(){var Proto=this,PAGE_META={},SITE_ID=null,GENERATED=!1;Proto.setSiteId=function(id){if(id)return SITE_ID&&SITE_ID!==id?announce("[warn] SiteId can only be set once. [current:"+SITE_ID+" | attempt:"+id+")"):void(SITE_ID=id)},Proto.getSiteId=function(){var meta;return SITE_ID||(meta=Proto.get(),Proto.setSiteId(meta.page.siteId)),SITE_ID},Proto.get=function(force){var loc,opengraph,twitter,meta;return GENERATED&&!force||(GENERATED=!0,loc=window.location,opengraph={},twitter={},meta=function(){var info={};return $("head > meta").each(function(){var el=$(this),name=el.attr("name")||el.attr("property")||null;name&&(el=el.attr("content")||"",/^og\:/.test(name)&&(opengraph[name.replace(/^og\:/,"")]=el),/^twitter\:/.test(name)&&(twitter[name.replace(/^twitter\:/,"")]=el),info[name]=el)}),info.canonical=$('head > link[rel="canonical"]').attr("href")||"",info}(),force=function(){var pagetype,res,info={},host=loc.host,channel=meta["prism.channel"]||""||(/foxnews\.com$/.test(host)?"fnc":/foxbusiness\.com$/.test(host)?"fbn":"other"),section=function(val){return val||(/radio\.foxnews/.test(host)?val="radio":/insider\.foxnews/.test(host)?val="insider":/nation\.foxnews/.test(host)&&(val="nation")),val}(meta["prism.section"]||"");return info.title=meta["og:title"]||$("head > title:first").text(),info.url=loc.protocol+"//"+host+loc.pathname,info.path=loc.pathname,info.siteId=SITE_ID||function(path){var res=channel;switch(path){case"fnc/radio":res="radio";break;case"fnc/insider":res="insider";break;case"fnc/nation":res="nation"}return res=res||"other"}([channel,section].join("/")),info.type=(pagetype=meta.pagetype||meta.pageType||null,res="other",pagetype?res=/^home/i.test(pagetype)?"homepage":pagetype:"video"===section?res=/^\/playlist/.test(loc.pathname)?"playlist":"video":"radio"===info.siteId?"/"===loc.pathname&&(res="homepage"):"insider"===info.siteId&&("/"===loc.pathname?res="homepage":"article"===meta["og:type"]&&(res="article")),pagetype="radio"===info.siteId,section=info.path,pagetype&&(/^\/([0-9]{4})\/([0-9]{1,2})\/([0-9]{1,2})/.test(section)?res="article":/^\/([a-z0-9]+)/.test(section)&&(res="category")),res),info}(),PAGE_META={raw:meta,page:force,opengraph:opengraph,twitter:twitter}),PAGE_META}}}),Modulr.define("leap.metrics:core/utils/promise.iterator",["require"],function(require){return function(target,next,done){var list=[],type=null;if(Array.isArray(target))type="array",list=target;else{if("object"!=typeof target)return console.log("promiseIterator(error): target is not iterable"),done();for(var id in type="object",target)list.push({id:id,data:target[id]})}if("function"!=typeof next)return console.log("promiseIterator(error): missing next()"),done();var iter=0,len=list.length;function fin(){"function"==typeof done&&done()}!function trigger(){{var item;iter<len?(item="object"===type?list[iter].data:list[iter],next(item,"object"===type?list[iter].id:iter,function(){iter++,trigger()},function(){fin()})):fin()}}()}}),Modulr.define("leap.metrics:core/utils/promise",["require"],function(require){var n;return n=function(){"use strict";function e(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}function n(e){return e&&void 0!==e.length}function t(){}function o(e){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function r(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,o._immediateFn(function(){var o,t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){try{o=t(e._value)}catch(r){return void f(n.promise,r)}i(n.promise,o)}else(1===e._state?i:f)(n.promise,e._value)})):e._deferreds.push(n)}function i(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if(n instanceof o)return e._state=3,e._value=n,u(e);if("function"==typeof t)return c(function(e,n){return function(){e.apply(n,arguments)}}(t,n),e)}e._state=1,e._value=n,u(e)}catch(r){f(e,r)}}function f(e,n){e._state=2,e._value=n,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;n<t;n++)r(e,e._deferreds[n]);e._deferreds=null}function c(e,n){var t=!1;try{e(function(e){t||(t=!0,i(n,e))},function(e){t||(t=!0,f(n,e))})}catch(o){t||(t=!0,f(n,o))}}var a=setTimeout,l=(o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,n){var o=new this.constructor(t);return r(this,new function(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}(e,n,o)),o},o.prototype.finally=e,o.all=function(e){return new o(function(t,o){if(!n(e))return o(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);for(var f=i.length,u=0;i.length>u;u++)!function r(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var u=n.then;if("function"==typeof u)return u.call(n,function(n){r(e,n)},o)}i[e]=n,0==--f&&t(i)}catch(c){o(c)}}(u,i[u])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(n){n(e)})},o.reject=function(e){return new o(function(n,t){t(e)})},o.race=function(e){return new o(function(t,r){if(!n(e))return r(new TypeError("Promise.race accepts an array"));for(var i=0,f=e.length;i<f;i++)o.resolve(e[i]).then(t,r)})},o._immediateFn="function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){a(e,0)},o._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}());"Promise"in l?l.Promise.prototype.finally||(l.Promise.prototype.finally=e):l.Promise=o},("object"!=typeof exports||"undefined"==typeof module)&&"function"==typeof define&&define.amd?define(n):n(),Promise}),Modulr.define("leap.metrics:core/utils/query.param",["require"],function(require){return new function(){var Proto=this;Proto.getVal=function(name){var queryObj=Proto.getAll();return!(!queryObj||!queryObj[name])&&decodeURIComponent(queryObj[name])},Proto.getAll=function(){for(var ret={},vals=(window.location.search.substr(1)||"").split("&"),x=0;x<vals.length;x++){var sp=vals[x].split("="),name=sp[0]||!1,value=1<(value=sp.slice(1)).length?value.join("="):sp[1]||!1;name&&value&&(ret[name]=decodeURIComponent(value).toString())}return ret},Proto.setToString=function(queryObj){var i,ret=[];for(i in queryObj)ret.push(i+"="+queryObj[i]);return ret=ret.join("&")}}}),Modulr.define("leap.metrics:core/utils/script.loader",["require"],function(require){return function(src,callback,attr){"function"!=typeof callback&&(callback=function(){});var script=document.createElement("script");if(script.type="text/javascript",script.charset="utf-8",script.async=!0,attr&&"object"==typeof attr)for(var key in attr)script.setAttribute(key,attr[key]);script.addEventListener("load",callback,!1),script.addEventListener("error",function(){throw new Error("Error loading script: "+src)},!1),script.src=src,document.getElementsByTagName("head")[0].appendChild(script)}}),Modulr.define("leap.metrics:core/utils/session.storage",["require"],function(require){return new function(){var Proto=this;function storagePrefix(id){return"leap_sessstore__"+id}Proto.isAvailable=function(){var res=!0,testId="__coretest_sessionStorage";if("object"==typeof window.sessionStorage)try{window.sessionStorage.setItem(testId,1),window.sessionStorage.removeItem(testId)}catch(err){res=!1}return res},Proto.set=function(id,val){Proto.isAvailable()&&null!==(val="string"!=typeof val?"object"==typeof val?JSON.stringify(val):void 0!==val?val.toString():null:val)&&window.sessionStorage.setItem(storagePrefix(id),val)},Proto.get=function(id){if(!Proto.isAvailable())return null;try{return window.sessionStorage.getItem(storagePrefix(id))}catch(err){return null}},Proto.remove=function(id){if(Proto.isAvailable())try{window.sessionStorage.removeItem(storagePrefix(id))}catch(err){}}}}),new function(){var Proto=this,CORE_API=null;Proto.load=function(){var args=arguments,scripts="string"==typeof args[0]?[args[0]]:Array.isArray(args[0])?args[0]:[],callback="function"==typeof args[0]?args[0]:args[1]&&"function"==typeof args[1]?args[1]:function(){};Instance.require(["require"],function(require){function runCallback(){"function"==typeof callback&&callback(require)}var loader;(0<scripts.length?loader=function(){var src=scripts.shift();Modulr.loadScript(src,function(){(0<scripts.length?loader:runCallback)()})}:runCallback)()})},Proto.execute=function(item){function trigger(attrs,callback){Proto.load(function(require){require(["core/utils/eu"],function(){require("core/utils/eu").allowProvider("segment")||(attrs.disabled=!0),CORE_API?callback(CORE_API,require):require(["core/api"],function(API){CORE_API=CORE_API||new API(attrs),callback(CORE_API,require)})})})}"function"==typeof item?trigger({},item):"object"!=typeof item||Array.isArray(item)||"function"==typeof item.callback&&trigger(item.attrs||{},item.callback)}}}(function(){var prev,MODULR_STACK,MODULR_STACK_QUEUE,LOADED_SCRIPTS,LOADED_SCRIPTS_QUEUE,LOADED_INSTANCE_INCLUDES,LOADED_INSTANCE_INCLUDES_STACK_QUEUE,INSTANCE_LIST,MASTER_FILE,MASTER_FILE_LOADED,SHIM_QUEUE,ON_READY,READY_QUEUE,EXECUTE_LISTENER,GLOBAL_CACHE_PARAM_VAR,GLOBAL_CACHE_PARAM_COND,LOG_PREFIX,isOpera,readyRegExp;function executeReadyState(){function trigger(){for(ON_READY=!0;0<READY_QUEUE.length;)READY_QUEUE.shift()()}EXECUTE_LISTENER?EXECUTE_LISTENER(trigger):trigger()}function done(){ON_READY||executeReadyState()}function getFactory(factory,deps){return"function"==typeof factory?factory.apply(factory,deps):factory}function isExportsDefined(exports){var ex=exports.split("."),tmp=window[ex.shift()],ret=!1;if(void 0!==tmp&&(ret=!0,0<ex.length))for(;0<ex.length;)if(void 0===(tmp=tmp[ex.shift()])){ret=!1;break}return ret}function getRelativePath(){var path=window.location.pathname.split("/");return path.pop(),path=path.join("/")+"/",getDomain()+path}function getDomain(){var loc=window.location;return loc.protocol+"//"+(loc.host||loc.hostname)}function addProtocol(domain){var ret=domain,protocol=window.location.protocol;return 0!==domain.indexOf("http")?protocol+(0!==domain.indexOf("//")?"//":"")+domain:ret}function cloneArr(arr){for(var ret=[],i=0;i<arr.length;i++)ret.push(arr[i]);return ret}function removeListener(node,func,name,ieName){node.detachEvent&&!isOpera?ieName&&node.detachEvent(ieName,func):node.removeEventListener(name,func,!1)}function ltrimSlash(val){return"/"===val.charAt(0)?val.slice(1):val}function rtrimSlash(val){return"/"===val.charAt(val.length-1)?val.slice(0,val.length-1):val}function isArray(val){return val=val||!1,"[object Array]"===Object.prototype.toString.call(val)}function log(){var args=Array.prototype.slice.call(arguments);args.unshift(LOG_PREFIX);try{window.console.log.apply(window.console,args)}catch(err){window.console.log(args.join(" | "))}}function throwError(){var args=Array.prototype.slice.call(arguments);throw args.unshift(LOG_PREFIX),new Error(args.join(" "))}function UtilPromise(sender){var _resolve=[],_reject=null;this.then=this.resolve=function(cb){return"function"==typeof cb&&_resolve.push(cb),this},this.reject=function(cb){"function"==typeof cb&&(_reject=cb)},sender(function(){if(_resolve)for(var args=Array.prototype.slice.call(arguments);0<_resolve.length;){var fn=_resolve.shift();data=fn.apply(fn,args)}},function(data){var args;_reject&&(args=Array.prototype.slice.call(arguments),_reject.apply(_reject,args))})}return window,MODULR_STACK={},MODULR_STACK_QUEUE={},LOADED_SCRIPTS={},LOADED_SCRIPTS_QUEUE={},LOADED_INSTANCE_INCLUDES={},LOADED_INSTANCE_INCLUDES_STACK_QUEUE={},INSTANCE_LIST={},MASTER_FILE=[],MASTER_FILE_LOADED=[],ON_READY=!(SHIM_QUEUE={}),READY_QUEUE=[],GLOBAL_CACHE_PARAM_VAR=EXECUTE_LISTENER=null,GLOBAL_CACHE_PARAM_COND=[],LOG_PREFIX="[Modulr]",window.addEventListener?window.addEventListener("load",done,!1):window.attachEvent?window.attachEvent("onload",done):(prev=window.onload,window.onload=function(){prev(),done()}),isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),readyRegExp=/^(complete|loaded)$/,new function Modulr(CONFIG){(CONFIG=CONFIG||{}).context=CONFIG.instance||CONFIG.context||"_",CONFIG.wait="boolean"!=typeof CONFIG.wait||CONFIG.wait;var id,CONTEXT=CONFIG.context,invalid=/[^A-Za-z0-9_\-\.]/g.test(id=CONTEXT);if("string"==typeof id&&!invalid||throwError("invalid context:",CONTEXT),MODULR_STACK[CONTEXT])return log("WARNING: attempt to instantiate the same context:",CONTEXT,"\n. No configuration changes, returning instance instead.."),MODULR_STACK[CONTEXT].instance;MODULR_STACK[CONTEXT]={instance:this,stack:{}};var STACK=MODULR_STACK[CONTEXT].stack,INSTANCE_INIT=!1,Proto=this;if(Proto.version="2.0.1",Proto.getConfig=function(){return CONFIG},Proto.getInstance=function(context){return MODULR_STACK[context]?MODULR_STACK[context].instance:null},Proto.setExecuteListener=function(callback){EXECUTE_LISTENER||"function"!=typeof callback||(EXECUTE_LISTENER=callback)},Proto.getLoadedScripts=function(){var item,scripts={};for(item in LOADED_SCRIPTS){var context=(sp=item.split("||"))[0],sp=sp[1]||"";context&&sp&&(scripts[context]||(scripts[context]=[]),scripts[context].push(sp))}return scripts},Proto.define=function(id,deps,factory){!function(id){return 0<(id="string"==typeof id?id.replace(/\s+/gi,""):"").length&&"require"!==id&&"define"!==id&&"exports"!==id}(id)&&throwError("invalid id:",id),2!==arguments.length||isArray(deps)||(factory=deps,deps=[]);var ext=isExtendedInstance(id=processDepsPath(id));ext?MODULR_STACK[ext.context]?MODULR_STACK[ext.context].instance.define(ext.id,deps,factory):(MODULR_STACK_QUEUE[ext.context]||(MODULR_STACK_QUEUE[ext.context]=[]),MODULR_STACK_QUEUE[ext.context].push({ext:ext,deps:deps,factory:factory})):STACK[id]||(STACK[id]={executed:!1,exports:{},deps:deps=deps||[],factory:factory})},Proto.require=function(deps,callback){var id,stack,type,ext;return"string"==typeof deps?(stack=null,type="module",(ext=isExtendedInstance(id=processDepsPath(deps)))?"module"===ext.type?stack=MODULR_STACK[ext.context].stack[ext.id]:"instance"===ext.type&&(stack=MODULR_STACK[ext.context].instance,type="instance"):stack=STACK[id],"module"===type&&(stack&&!stack.executed&&throwError("module not yet executed:",id),stack=stack?void 0!==stack.factory?stack.factory:stack.exports:null),stack):isArray(deps)?new UtilPromise(function(resolve){function trigger(){var callback;INSTANCE_INIT?getDeps():(INSTANCE_INIT=!0,callback=function(){getDeps()},CONFIG.baseDomain=addProtocol(CONFIG.baseDomain)||getDomain(),CONFIG.baseUrl=CONFIG.baseUrl||getRelativePath(),function(callback){var src;CONFIG.masterFile?(src=setPathSrc(CONFIG.masterFile),-1<MASTER_FILE_LOADED.indexOf(src)||-1!==MASTER_FILE.indexOf(src)?callback():(MASTER_FILE.push(src),loadScript(src,null,function(){MASTER_FILE_LOADED.push(src),callback()}))):callback()}(function(){loadPackages(CONFIG.packages,function(){callback()})}))}var getDeps=function(){MODULE.get(null,deps,function(args){"function"==typeof callback?getFactory(callback,args):resolve.apply(resolve,args)})};!CONFIG.wait||ON_READY?trigger():READY_QUEUE.push(trigger)}):void 0},Proto.config=function(config){if(config.context||config.instance){for(var instance=new Modulr(config),remove=["config","getInstance","loadPackageList","setGlobalCacheParam","setGlobalCacheCond","setExecuteListener"],i=0;i<remove.length;i++){var id=remove[i];instance[id]&&delete instance[id]}return instance.loadPackage=function(packages,callback){"function"!=typeof callback&&throwError("loadPackage() requires a callback!"),isArray(packages)||"object"!=typeof packages?throwError("cannot load package list."):loadPackages(packages,callback.apply(callback,Proto.require))},instance}if(INSTANCE_INIT)return log('WARNING: Instance "'+config.instance+'" already exists! no configuration changes, returning instance instead..'),Proto.getInstance(config.instance);CONFIG=config},Proto.execModule=function(id,callback){var module=getStack(id);if("function"!=typeof callback)return!1;module?module.executed?callback(MODULE.getModuleFactory(module)):MODULE.execModule(null,null,id,function(factory){callback(factory)}):callback(null)},Proto.loadPackageList=function(packages){if(isArray(packages)||"object"!=typeof packages)throwError("cannot load package list.");else for(var id in packages)INSTANCE_LIST[id]||(INSTANCE_LIST[id]=packages[id])},Proto.setGlobalCacheParam=function(val){"string"!=typeof val&&"number"!=typeof val||(GLOBAL_CACHE_PARAM_VAR=val)},Proto.setGlobalCacheCond=function(list){Array.isArray(list)&&(GLOBAL_CACHE_PARAM_COND=GLOBAL_CACHE_PARAM_COND.concat(list))},Proto.getGlobalCacheParam=function(){return GLOBAL_CACHE_PARAM_VAR},Proto.getPackageListInfo=function(){return{master:MASTER_FILE,instances:INSTANCE_LIST}},Proto.setReady=function(){executeReadyState()},Proto.loadScript=function(src,callback){loadScript(src,null,function(){"function"==typeof callback&&callback()})},MODULR_STACK_QUEUE[CONTEXT])for(var instance=MODULR_STACK[CONTEXT].instance;0<MODULR_STACK_QUEUE[CONTEXT].length;){var item=MODULR_STACK_QUEUE[CONTEXT].shift();instance.define(item.ext.id,item.deps,item.factory)}function processDepsPath(deps){if(CONFIG.paths)for(var i in CONFIG.paths)deps=deps.replace(i,CONFIG.paths[i]);return deps.replace(/\/\//g,"/").replace(/^\//,"")}if(CONFIG.shim){var sid,arr=[];for(sid in CONFIG.shim)arr.push({id:sid,info:CONFIG.shim[sid]});for(;0<arr.length;)!function(obj){var id=obj.id,info=obj.info,obj=(setPathSrc(info.src),info.deps||[]);Proto.define(id,obj,function(){return getShimExport(info.exports)})}(arr.shift())}var MODULE=new function(){var self=this;self.get=function(moduleId,deps,callback){var arr,args=[],getDeps=(deps?arr=cloneArr(deps):moduleId&&STACK[moduleId]&&(arr=cloneArr(STACK[moduleId].deps)),function(){var id,module,ext,src,context;0===arr.length?callback(args):(module=getStack(id=processDepsPath(arr.shift())),(ext=isExtendedInstance(id))?"module"===ext.type?function(id,callback){var instance,context=(id=id.split(":"))[0]||!1,moduleId=id[1]||!1;context&&moduleId&&MODULR_STACK[context]?(instance=MODULR_STACK[context].instance,MODULR_STACK[context].stack[moduleId]?instance.execModule(moduleId,function(factory){callback(factory)}):instance.require([moduleId],function(){instance.execModule(moduleId,function(factory){callback(factory)})})):(log(["Not initialized >> CONTEXT:",context,"| module:",moduleId].join(" ")),callback(null))}(id,function(extFactory){args.push(void 0!==extFactory?extFactory:null),getDeps()}):"instance"===ext.type&&(args.push((context=ext.context,MODULR_STACK[context]?MODULR_STACK[context].instance:void throwError("Error getting instance:",context))),getDeps()):"require"===id?(args.push(Proto.require),getDeps()):"define"===id?(args.push(Proto.define),getDeps()):"exports"===id?(args.push(STACK[moduleId].exports),getDeps()):module&&!isShimModuleId(id)?module.executed?(args.push(self.getModuleFactory(module)),getDeps()):self.execModule(null,null,id,function(factory){args.push(factory),getDeps()}):isShimModuleId(id)?(ext=CONFIG.shim[id],self.loadShim(id,ext,function(factory){args.push(factory),getDeps()})):loadScript(src=self.getModulePath(id),id,function(){self.execModule("load",src,id,function(factory){args.push(factory),getDeps()})}))});getDeps()},self.loadShim=function(id,info,callback){var src=setPathSrc(info.src),module=getStack(id);isExportsDefined(info.exports)?(module.executed=!0,module.factory=getShimExport(info.exports),callback(module.factory)):SHIM_QUEUE[src]?SHIM_QUEUE[src].push(function(){self.execModule("shim",null,id,function(factory){callback(factory)})}):(SHIM_QUEUE[src]=[function(){self.execModule("shim",null,id,function(factory){callback(factory)})}],loadScript(src,id,function(){isExportsDefined(info.exports)?function(id){if(SHIM_QUEUE[id])for(;0<SHIM_QUEUE[id].length;)SHIM_QUEUE[id].shift()()}(src):throwError("shim export not found for:",id)},null,{noCacheString:info.noCacheString||null,noStore:info.noStore||null,queryParam:info.queryParam||null}))},self.execModule=function(type,src,id,callback){var module=getStack(id);module?module.executed?callback(self.getModuleFactory(module)):(self._execQueue||(self._execQueue={}),self._execQueue[id]||(self._execQueue[id]=[]),module.executing?self._execQueue[id].push(callback):(module.executing=!0,self._execQueue[id].push(callback),self.get(id,module.deps,function(args){module.factory=getFactory(module.factory,args),module.executed=!0,module.executing=!1,self.runCallbackQueue(id,self.getModuleFactory(module))}))):(log("loading external source:",src),callback({id:id,src:src,type:"external-script"}))},self.runCallbackQueue=function(id,factory){for(var queue=self._execQueue[id]||[];0<queue.length;)queue.shift()(factory)},self.getModuleFactory=function(module){return null!==module.factory?module.factory:module.exports},self.getModulePath=function(id){var base=[rtrimSlash(CONFIG.baseDomain||getDomain()),ltrimSlash(CONFIG.baseUrl||getRelativePath())].join("/");return[base=rtrimSlash(base),id=rtrimSlash(ltrimSlash(id))].join("/")+".js"}};function getStack(id){return STACK[id]||!1}function isExtendedInstance(id){var context,ret=!1;return-1<id.indexOf(":")&&(context=(id=id.split(":"))[0]||!1,id=id[1]||!1,"getInstance"===context&&id?ret={type:"instance",context:id}:context&&id&&(ret={type:"module",context:context,id:id})),ret}function loadPackages(packages,callback){if(packages){function setPackageObj(obj){for(var uid in obj)INSTANCE_LIST[uid]||(INSTANCE_LIST[uid]=obj[uid]),arr.push({uid:uid,src:obj[uid]})}var arr=[];if(isArray(packages))for(var i=0;i<packages.length;i++){var item=packages[i];"string"==typeof item&&INSTANCE_LIST[item]?arr.push({uid:item,src:INSTANCE_LIST[item]}):"object"!=typeof item||isArray(item)?throwError("cannot find package named:",item):setPackageObj(item)}else setPackageObj(packages);!function getInstance(){var obj,uid,src;0===arr.length?callback():(uid=(obj=arr.shift()).uid,src=setPathSrc(obj.src),MODULR_STACK[uid]?getInstance():LOADED_INSTANCE_INCLUDES[src]?(LOADED_INSTANCE_INCLUDES_STACK_QUEUE[src]||(LOADED_INSTANCE_INCLUDES_STACK_QUEUE[src]=[]),LOADED_INSTANCE_INCLUDES_STACK_QUEUE[src].push(function(){getInstance()})):(LOADED_INSTANCE_INCLUDES[src]=uid,loadScript(src,uid,function(){if(getInstance(),LOADED_INSTANCE_INCLUDES_STACK_QUEUE[src]){for(var srcId=src,queue=LOADED_INSTANCE_INCLUDES_STACK_QUEUE[srcId];0<queue.length;)queue.shift()();delete LOADED_INSTANCE_INCLUDES_STACK_QUEUE[srcId]}},"instance")))}()}else callback()}function setPathSrc(src){var ret=src;return 0!==src.indexOf("http")?0===src.indexOf("//")?addProtocol(src):CONFIG.baseDomain+("/"!==src.charAt(0)?"/":"")+src:ret}function isShimModuleId(id){return CONFIG.shim&&CONFIG.shim[id]}function getShimExport(scope){return window[scope.split(".")[0]]}function loadScript(src,id,callback,specType,cacheInfo){function onLoad(evt){if(!loaded&&"load"===evt.type||readyRegExp.test((evt.currentTarget||evt.srcElement).readyState)){for(loaded=!0;0<LOADED_SCRIPTS_QUEUE[scriptId].length;)LOADED_SCRIPTS_QUEUE[scriptId].shift()();delete LOADED_SCRIPTS_QUEUE[scriptId],removeListener(script,onLoad,"load","onreadystatechange"),removeListener(script,onError,"error")}}function onError(){throwError("error loading script:",src)}cacheInfo=cacheInfo||{};var loaded=!1,script=document.createElement("script"),scriptId=[CONTEXT||"",src].join("||"),noBrowserCache=cacheInfo.noCacheString||null,customCacheCond=function(src){for(var list=GLOBAL_CACHE_PARAM_COND,res=null,i=0;i<list.length;i++){var item=list[i];if("object"==typeof item&&item.regex instanceof RegExp&&item.regex.test(src)){res=item;break}}return res}(src),noStore=!(!customCacheCond||!0!==customCacheCond.noStore)||(!0===noBrowserCache?null:cacheInfo.noStore),queryParam=customCacheCond&&"string"==typeof customCacheCond.param?customCacheCond.param:cacheInfo.queryParam;id&&script.setAttribute(specType?"data-modulr-loaded-inst":"data-modulr-module",id),script.setAttribute("data-modulr-context",CONTEXT),LOADED_SCRIPTS[scriptId]?LOADED_SCRIPTS_QUEUE[scriptId].push(function(){callback(id)}):(LOADED_SCRIPTS[scriptId]=!0,LOADED_SCRIPTS_QUEUE[scriptId]=[function(){callback(id)}],script.type="text/javascript",script.charset="utf-8",script.async=!0,!script.attachEvent||script.attachEvent.toString&&script.attachEvent.toString().indexOf("[native code")<0||isOpera?(script.addEventListener("load",onLoad,!1),script.addEventListener("error",onError,!1)):script.attachEvent("onreadystatechange",onLoad),script.src=function(src){var param,c,secs,ret=src;return customCacheCond&&noStore&&queryParam?ret=src+(-1<src.indexOf("?")?"&":"?")+(queryParam?queryParam+"=":"")+(new Date).getTime():(CONFIG&&CONFIG.cacheParam||GLOBAL_CACHE_PARAM_VAR)&&!noBrowserCache&&(param=queryParam||("string"==typeof CONFIG.cacheParam?CONFIG.cacheParam:GLOBAL_CACHE_PARAM_VAR?"v":""),c=noStore?(new Date).getTime():GLOBAL_CACHE_PARAM_VAR||(secs=(c=new Date).getSeconds(),[c.getFullYear(),c.getMonth()+1,c.getDate(),c.getHours(),c.getMinutes()].join("")+(secs<=30?30:1)),ret=src+(-1<src.indexOf("?")?"&":"?")+(param?param+"=":"")+c),ret}(src),document.getElementsByTagName("head")[0].appendChild(script))}}}(),function(){function executeStack(){if(0!==stack.length)for(;0<stack.length;)stack.shift()()}var ready=!1,init=!1,stack=[];return function(callback){if("function"==typeof callback){if(ready)return callback();stack.push(callback),init||(init=!0,window.addEventListener?"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?(ready=!0,executeStack()):document.addEventListener("DOMContentLoaded",executeStack):window.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),ready=!0,executeStack())}))}}}()));