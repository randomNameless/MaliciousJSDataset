<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bundle.index.f513ba259bb9f740f517.html</title>
</head>
<body>

<script>
(self.webpackChunkreact_app=self.webpackChunkreact_app||[]).push([[826],{35009:e=>{e.exports={staticHost:"https://alpha.mirtesen.ru",server:{port:"3013"},api:{version:1,host:"127.0.0.1",path:"gqapi",protocol:"https"},chatApi:{version:1,host:"socket2.mirtesen.ru",path:"api",protocol:"https"},pollsApi:{version:1,host:"polls.mirtesen.ru",path:"graphql",protocol:"https"},testApi:{version:1,host:"gqapi-dev.mtml.ru",path:"gqapi",protocol:"http"},gqapiEndpoints:{blog:{url:"blogs"},user:{url:"user"},main:{url:"main"},upload:{url:"upload"},comments:{url:"comments"}},mode:"production",blogPostRecordsOnPage:20,postsPerPage:5,recordsPerPage:20,disableAdBlocks:!1,disableChat:!1,comet:{pathname:"/cmt/"},captcha:{schema:"v3-v2",testPhone:"+79611909184",minScore:.7,recaptchaV2:{sitekey:"6LdbM_8nAAAAACBxPuhrtykJ-qwt0LGoJ4F5O16C"},recaptchaV3:{sitekey:"6LePw-MnAAAAACsFfVXACtqqvM1rt0bK47ICu5QZ"}},recaptcha:{sitekey:"6LedqiITAAAAAGA-lXX6eARmRY5BD9CJRbihD71b"},leftSidebarBreakpoints:{platform:1219,default:1423},headerSearch:{categories:{people:"https://mirtesen.ru/search/people",groups:"https://mirtesen.ru/search/groups",posts:"https://mirtesen.ru/search/posts"}},comments:{prod:{css:"//static.mtml.ru/css/commentsBundle.css",js:"//static.mtml.ru/js/commentsBundle.js"},dev:{css:"//static.mtml.ru/css/commentsBundle.css",js:"//static.mtml.ru/js/commentsBundle.js"}},groups:{limit:20,defaultPeriod:"PERIOD_MONTH",defaultOrder:"ORDER_BY_UNIQUE_VISITORS"},errbit:{host:"https://errbit.mtml.ru",projectId:1,projectKey:"1780a68abc3c94ecccb4fdb3d2f5f3fd"},moviesCollections:{urlTpl:"https://kino.mirtesen.ru",moviesLimit:2,collectionsLimit:4,collectionsCount:48},feedTabs:[{title:"Для вас",name:"main",tooltip:"Лучшие рекомендованные посты"},{title:"ТОП",name:"top",tooltip:"Выбранные нейросетью Neuron посты"},{title:"Новое",name:"new",tooltip:"Посты пользователей для вывода в ТОП"},{title:"Друзья",name:"friends",tooltip:"Посты ваших друзей"}],mainProto:"https",mainDomain:"mirtesen.ru",iframeDomain:"gamma.mirtesen.ru",glagolDomain:"glagol.mirtesen.ru",topicDomain:"glagol.mirtesen.ru",infoDomain:"info.mirtesen.ru",arbitrationDomains:["sovetyspolzoi.mirtesen.ru","mysoccer.mirtesen.ru"],infoDomains:["info.mirtesen.ru","info.mirtesen.mt","info.localhost.ru"],glagolDomains:["glagol.mirtesen.ru","glagol.press"],baseDomains:["mirtesen.ru","olanola.com","v2.olnl.net","gamma.mirtesen.ru","delta.mirtesen.ru","mtest.ru","info.mirtesen.ru","mt.ru"],channelDomain:"mt.ru",channelDomains:["mt.ru","mt.mt"],hiddenSubscribers:["russianredaktion.mirtesen.ru","bbt.mirtesen.ru","icherski.mirtesen.ru","aurenhabichev.mirtesen.ru","mt-blogs.test","glagol.mirtesen.ru","sovetyspolzoi.mirtesen.ru"],verifiedBlogs:["russianredaktion.mirtesen.ru","glagol.mirtesen.ru","haknem.mirtesen.ru","sovetyspolzoi.mirtesen.ru"],profileUsers:[714433825,88364568],profilerRate:0,ignoreStickyButton:["maximarkets.mirtesen.ru","umarkets.mirtesen.ru","aliexpress.mirtesen.ru"],blogWithTopic:["mt.megamcpe.com"],blogWithoutTopic:["mt.milomarket.com"],panda:{mode:2,videoUrl:"https://player.mt.ru/video/"},disableAdDomains:["xn--80adgd5amgpfqs5k.xn--p1ai","s30496446919.mirtesen.ru"],elasticEndpoint:"http://10.8.8.38:9200/",showSmotriPlayer:!0}},78861:(e,t,n)=>{"use strict";n.d(t,{Ek:()=>d,Pg:()=>m,Rt:()=>p,ZP:()=>g});n(71022),n(21943),n(26296),n(5645),n(53169),n(98216),n(96751),n(88781),n(58368),n(24194),n(61968),n(64908),n(39256),n(48802),n(99695),n(42249),n(31870),n(95154),n(24064),n(87419),n(64627);var a=n(41750),s=n(99871),r=n(64962),o=n(82537),i=n(12684),l=n(54462);const c=69000023097,m="blogPost",d="channelPlainPost",p="channelRichPost";class u{static normalizeRepost=e=>{const{title:t,post_type:n,previewText:a,url:s}=e,r=e.attachments||[],i=[];let l,c=0,m=0;for(const e of r)(0,o.M2)(e)&&(c++,i.push(e)),(0,o.fr)(e)&&(m++,i.push(e));const d=i.find((e=>e?.photo?.photo_original||e?.video.image));d&&(l=(0,o.M2)(d)?d.photo.photo_original:d?.video.image);const p=(c?c+" фото":"")+(c&&m?", ":"")+(m?m+"видео":""),g=r?.find(o.MP)?.link.url||"";return{post:e,source:null,title:t||"",text:"post"===n?"":u.appendLinkIfAbsent(a,g)||p,url:s,previewImage:l,photoCounter:c,videoCounter:m,attachments:i}};static appendLinkIfAbsent=(e,t)=>e&&t?e.indexOf(t)<0?`${e} ${t}`:e:e||t||"";static normalizeLink=e=>{const{title:t,caption:n,embed:a,photo:s,url:r}=e;let o;return a?o={video:{title:t,player_html:a,caption:n,url:r,image:s?.photo_original}}:s&&(o={photo:s}),{post:null,source:n,title:t,text:"",url:r,previewImage:e?.photo?.photo_original,photoCounter:e?.photo?.photo_original&&!e.embed?1:0,videoCounter:e.embed?1:0,attachments:o?[o]:[]}};static normalizePostList(e){if(!e?.length)return[];return e.map((e=>this.normalizePost(e)))}static normalizePost(e){const t=l.Z.getConfig();let n={...e};if(!e)return e;n.seo_url=(0,o.Z9)(e)?e.seo_url:e.url,n.canonical_url=(0,o.Z9)(e)?e.canonical_url:e.url;const s=(0,o.Z9)(e)&&e.action_datetime||e.date;if(n.formattedDates=a.Z.setformattedDates(s),n=this.prepareAttachments(n),n=this._normalizeExtraData(n),!(0,o.Z9)(e)&&e.shared_post?(n.shared_post=this._normalizeExtraData(n.shared_post),n.shared_post=this.prepareAttachments(n.shared_post),n.shared_post.formattedDates=a.Z.setformattedDates(n.shared_post.date),n.shared_post.post_type="user_post"===n.shared_post.post_type&&n.shared_post.msg_type_did===c?"user_post_rich":n.shared_post.post_type):n.shared_post=null,Array.isArray(e.mentionedPersons)){const t={};for(const n of e.mentionedPersons)t[n.id]=n.display_name;n.mentionedPersons=t}else n.mentionedPersons=null;if(e.channel){const a=`${t.mainProto}://${t.channelDomain}/${e.channel.name}`,s=JSON.parse(e.channel?.avatar_info||"{}");n.channel={id:e.channel.id,photo_original:s.avatar||e.channel.avatar,isAuthenticAccount:e.channel.trusted,display_name:e.channel.title,url:a,name:e.channel.name,is_owner:e.channel.is_owner},n.url=n.seo_url=`${a}/${e.id}`}return"user_post"===n.post_type&&n.msg_type_did===c&&(n.post_type="user_post_rich"),n}static prepareAttachments=e=>{if(!e)return e;const{attachments:t}=e,n=[],a=[];if(Array.isArray(t))for(const e of t)(0,o.M2)(e)&&n.push({main:!0,url:e.photo.photo_original,width:e.photo.width,height:e.photo.height}),(0,o.fr)(e)&&a.push({id:e.video.id,pandaVideoId:e.video.pandaVideoId,player_html:e.video.player_html,caption:e.video.caption,url:e.video.url,title:e.video.title,player_data:e?.video?.player_data?JSON.parse(e.video.player_data):null});return{...e,images:n,videos:a}};static _normalizeExtraData=e=>{let t={};if(!e?.extraData)return e;const n=JSON.parse(e.extraData);if((0,o.Z9)(e))t={extraData:{...n,doFollowLinks:parseInt(n.ed_skip_nofollow||0,10)}};else{n.ed_repostId&&(t.repostId=n.ed_repostId);try{n.ed_sharedPost&&(t.shared_post=JSON.parse(n.ed_sharedPost))}catch(e){i.Z.promiseHandler("Person post, normalizeExtraData")(e)}t.title=n.ed_title||"",t=n.ed_isPromotion?{...t,preview:n.ed_preview||"",topic:n.ed_topic||"",topPostLink:n.ed_url||""}:t}return{...e,...t}};static _prepareVideo=(e,t)=>{const n=["youtu.be","youtube.com","video.mirtesen.ru","rutube.ru","vimeo.com","vnmsa.mirtesen.ru","player.vimeo.com","out.pladform.ru","ivi.ru","player.panda.video","player.mt.ru","vk.com"];let a=/(<iframe[^>]*>.*?<\/iframe>)/i;const r=(e=(e=(e=e.replace(/<div class=["']embed-container['"][^>]*>(.*?)<\/div>/gim,"$1")).replace(/<div[^>]* style=["'][^>]*>(.*?)<\/div>/gim,"$1")).replace(/<video.*?<\/video>/gi,"<div class='video-wrap'>$&</div>")).split(a),o=[];for(const e of r){if(-1===e.search(a)){o.push(e);continue}a=/<iframe\s+.*src=['"]?([^'"\s]+)/;const r=e.match(a);if(!r){o.push(e);continue}let i=r?.[1];if(i=s.Z.fixProtocol(r[1]),!i){o.push(e);continue}const l=new URL(i).hostname.toLowerCase().replace(/^www\./,"");n.includes(l)?t||o.push('<div class="video-wrap"><iframe src="'+i+'" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe></div>'):o.push(e)}return e=o.join("")};static _prepareImages=(e,t={})=>{const{alt:n="",browserName:a=""}=t,r=/(<img[^>]*\/>)/,o=e.split(r),i=[];return o.forEach((e=>{if(-1===e.search(r))return void i.push(e);-1===e.search(/alt\s?=\s?["']?[а-яА-Яa-zA-Z0-9_]+/i)&&(e=e.replace(/alt\s?=\s?["']?[^>]*?["']?/i,"").replace(/\/>/,'alt="'+escape(n)+'"/>'));const t=e.match(/src\s?=\s?["']?([^\s"']+)/i),o=e.match(/class\s?=\s?["']?([^\s"']+)/i)?.[1]||"";if(t){const n=s.Z.fixProtocol(s.Z.cropImage2(t[1]||"",{browser:a}));e=e.replace(t[1]||"",n)}e=(e=(e=(e=e.replace("<img",`<img class="POST_IMAGE ${o}"`)).replace(/width\s?=\s?["']?[а-яА-Яa-zA-Z0-9_]+["']?/i,"").replace(/\/>/,'width="620"/>')).replace(/height\s?=\s?["']?[а-яА-Яa-zA-Z0-9_]+["']?/i,"").replace(/\/>/,'height="auto"/>')).replace(/loading\s?=\s?["']?[^>]*?["']?/i,"").replace(/\/>/,'loading="lazy"/>'),i.push(e)})),e=i.join("")};static _normalizeRichText=(e,t,n)=>(e=u._prepareImages(e,{browserName:t}),e=u._prepareVideo(e,n));static normalizeText=(e,{browserName:t="",isCurrentPost:n,disableVideo:s})=>{switch(e.post_type){case"user_post":return a.Z.preparePersonPostPreview(n,e)||"";case"user_post_rich":return n?u._normalizeRichText(e.text,t,s):e.previewText||"";case"post":return n?u._normalizeRichText(e.text,t,s):"<div>"+e.preview_text+"</div>";default:return"<div>"+e.preview_text+"</div>"}};static normalizeAuthor=e=>{const{post_type:t,channel:n}=e;return"post"===t?e.group:n?e.channel:e.from};static _isContentInPost=e=>e?.previewText||e?.preview_text||e?.text||e?.body||!!e?.attachments?.length;static showUserCardSwitcher=e=>"user_post"===e.post_type;static showReasonsForShowing=e=>r.ZP.isLogged()&&"post"===e.post_type;static getViewCounterType=e=>"post"===e.post_type?"bp":"up";static showPostMedia=(e,{isCurrentPost:t})=>"user_post_rich"!==e.post_type||!t;static isLinkAttachments=e=>e.attachments?.filter((e=>(0,o.MP)(e)))?.[0];static isFontSizeFlexible=e=>"user_post"===e.post_type&&!e.shared_post&&!u.isLinkAttachments(e);static getSharedPost=e=>"post"===e.post_type||u._isContentInPost(e)?e:e.shared_post||e;static getPostType=e=>"post"===e?.post_type?m:"user_post"===e?.post_type&&e?.channel?.id?d:"user_post_rich"===e?.post_type&&e?.channel?.id?p:"user_post"!==e?.post_type||e?.channel?.id?null:"userPost";static deletePostDuplicates=(e,t=[])=>{const n=new Set(t),a=[];for(const t of e)n.has(t.id)||(n.add(t.id),a.push(t));return{uniqueItems:a,updatedUniqueIds:Array.from(n)}}}const g=u},4169:(e,t,n)=>{"use strict";var a="/index.js";n.d(t,{ZP:()=>d,rS:()=>l});n(93811),n(5645),n(17312),n(71022),n(21943);var s=n(12684),r=n(20190),o=n(30498),i=n(78861);n(41045);
/**
 * Mirtesen.
 *
 * API interface for Channels.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const l="id\nperson_id\nname\nname_changed_at\ntitle\navatar\ntrusted\navatar_info\nis_owner\nis_subscribed\ngeotag_id\n",c=`\n    ${l}\n    cover\n    cover_info\n    description\n    tags\n    \n    subscribers_num\n    posts_num\n\n`;class m extends i.ZP{static BREAKPOINTS={XS:668,SM:756,MD:952,LG:1280};static async getChannelByName(e,t={}){try{const{req:n,res:a}=t,s=await o.Z.request(`query getChannelByName($name: String!) {\n                    getChannelByName(name: $name) {\n                        ${c}\n                        }\n                    }`,{name:e},{endpoint:"main",ver:"v3"},n,a);if(s)return m._normalizeChannelInfo(s)}catch(e){s.Z.promiseHandler(a)(e)}}static async getChannelById(e,t={}){try{const{req:n,res:a,reqType:s="base"}=t,r="base"===s?l:c,i=await o.Z.request(`query getChannelById($id: Int!) {\n                    getChannelById(id: $id) {\n                        ${r}\n                        }\n                    }`,{id:e},{endpoint:"main",ver:"v3"},n,a);if(i)return m._normalizeChannelInfo(i)}catch(e){s.Z.promiseHandler(a)(e)}}static async getChannelSettings(e,t={}){try{const{req:n,res:a}=t,s=await o.Z.request("query getChannelSettings($id: Float!) {\n                  getChannelSettings(id: $id) {\n                    settings\n                  }\n                }",{id:e},{endpoint:"main",ver:"v3"},n,a);return s?JSON.parse(s?.settings):null}catch(e){s.Z.promiseHandler(a)(e)}}static async saveChannelSettings(e,t,n={}){try{const{req:a,res:s}=n;"string"!=typeof t&&(t=JSON.stringify(t));return await o.Z.request({query:"mutation setChannelSettings($channelId: Float!, $settings: String!) {\n                      setChannelSettings(channelId: $channelId, settings: $settings)\n                    }",variables:{channelId:e,settings:t},endpoint:{endpoint:"main",ver:"v3"},req:a,res:s})}catch(e){s.Z.promiseHandler(a)(e)}}static async getPostsByChannel({id:e,offset:t=0,limit:n=5,leadUserPostId:i=null,params:l={}}){try{const{req:a,res:s}=l,c=await o.Z.request(`query getUserPostsByChannel($id: Float!, $offset: Int, $limit: Int, $leadUserPostId: Float) {\n                    getUserPostsByChannel(channelId: $id, offset: $offset, limit: $limit, leadUserPostId: $leadUserPostId) {\n                        items {\n                            previewText\n                            post_type\n                            mentionedPersons {\n                              id\n                              display_name\n                            }\n                            place {\n                              display_name\n                              url\n                            }\n                            ${r.qh}\n                            ${r.hm}\n                          }\n                          nextOffset\n                        }\n                    }`,{id:e,offset:t,limit:n,leadUserPostId:i},{endpoint:"main",ver:"v3"},a,s);return c?{items:this.normalizePostList(c?.items),nextOffset:c.nextOffset}:{items:[],nextOffset:0}}catch(e){s.Z.promiseHandler(a)(e)}}static async getChannelFeed(e=10,t=0,n={}){try{const a=await o.Z.request({query:`query getUserPostsTimeline($limit: Int!, $offset: Int!, $filter: PostTransitFilter) {\n                    getUserPostsTimeline(limit: $limit, offset: $offset, filter: $filter) {\n                        items {\n                            previewText\n                            post_type\n                            mentionedPersons {\n                              id\n                              display_name\n                            }\n                            place {\n                              display_name\n                              url\n                            }\n                            ${r.qh}\n                            ${r.hm}\n                          }\n                          nextOffset\n                    }\n                }`,variables:{limit:e,offset:t,filter:n.filter},endpoint:{endpoint:"main",ver:"v3"},req:n.req,res:n.res});return a?{items:this.normalizePostList(a?.items),nextOffset:a.nextOffset}:{items:[],nextOffset:0}}catch(e){s.Z.promiseHandler(a)(e)}}static async getSubscriptionStatus(e,t,n){try{return await o.Z.request("query getChannelSubscription($id: Float!) {\n                    getChannelSubscription(id: $id) {\n                        obj_status_did\n                    }\n                }",{id:e},{endpoint:"main",ver:"v3"},t,n)||{}}catch(e){s.Z.promiseHandler(a)(e)}}static async setSubscriptionStatus(e,t){try{return await o.Z.request({query:"mutation setChannelSubscription($id: Float!, $subscribe: Boolean!) {\n                    setChannelSubscription(channelId: $id, subscribe: $subscribe)\n                }",variables:{id:e,subscribe:t},endpoint:{endpoint:"main",ver:"v3"}})}catch(e){s.Z.promiseHandler(a)(e)}}static async getUserChannels(e,t,n){try{const a=await o.Z.request({query:`query {\n                    getChannels(userId: ${e}) {\n                        ${l}\n                    }\n                }`,endpoint:{endpoint:"main",ver:"v3"},req:t,res:n});return this._normalizeChannels(a||[])}catch(e){s.Z.promiseHandler(a)(e)}}static async getUserSubscriptions(e=20,t=0,n={},i={}){try{const a=await o.Z.request({query:`query {\n                    getChannelSubscriptions(limit: ${e}, offset: ${t}) {\n                        channel {\n                            ${l}\n                        }\n                        last_post {\n                            id\n                            ${r.q3}\n                            previewText\n                        }\n                    }\n                }`,endpoint:{endpoint:"main",ver:"v3"},req:n,res:i});return this._normalizeSubscriptions(a||[])}catch(e){s.Z.promiseHandler(a)(e)}}static async getUserSubscriptionsNum(e,t){try{return await o.Z.request({query:"query {\n                    getChannelSubscriptionsNum\n                }",endpoint:{endpoint:"main",ver:"v3"},req:e,res:t})||0}catch(e){s.Z.promiseHandler(a)(e)}}static async addChannel({name:e,title:t,avatarId:n,coverId:r,coverInfo:i,avatarInfo:l,description:c,tags:m,geotag_id:d}){try{const a={name:e,title:t,avatarId:n,coverId:r,description:c,tags:m};i&&(a.coverInfo=JSON.stringify(i)),l&&(a.avatarInfo=JSON.stringify(l)),Number.isInteger(d)&&(a.geotag_id=d);return await o.Z.request({query:"mutation addChannel(\n                    $name: String!,\n                    $title: String!,\n                    $avatarId: Float,\n                    $coverId: Float\n                    $coverInfo: String\n                    $avatarInfo: String\n                    $description: String\n                    $tags: [String!]\n                    $geotag_id: Float\n                ) {\n                    addChannel(\n                        name: $name,\n                        title: $title, \n                        avatar_id: $avatarId,\n                        cover_id: $coverId\n                        cover_info: $coverInfo\n                        avatar_info: $avatarInfo\n                        description: $description\n                        tags: $tags,\n                        geotag_id: $geotag_id\n                    )\n                }",variables:a,endpoint:{endpoint:"main",ver:"v3"}})}catch(e){s.Z.promiseHandler(a)(e)}}static async editChannel({id:e,name:t,title:n,description:r,avatarId:i,coverId:l,coverInfo:c,avatarInfo:m,tags:d,geotag_id:p}){try{const a={id:e,name:t,title:n,description:r,avatarId:i,coverId:l,tags:d};c&&(a.coverInfo=JSON.stringify(c)),m&&(a.avatarInfo=JSON.stringify(m)),Number.isInteger(p)&&(a.geotag_id=p);return await o.Z.request({query:"mutation editChannel(\n                    $id: Float!\n                    $name: String,\n                    $title: String,\n                    $description: String,\n                    $avatarId: Float,\n                    $coverId: Float\n                    $coverInfo: String\n                    $avatarInfo: String\n                    $tags: [String!]\n                    $geotag_id: Float\n                ) {\n                    editChannel(\n                        id: $id,\n                        name: $name,\n                        title: $title, \n                        description: $description\n                        avatar_id: $avatarId,\n                        cover_id: $coverId,\n                        cover_info: $coverInfo,\n                        avatar_info: $avatarInfo,\n                        tags: $tags,\n                        geotag_id: $geotag_id\n                    )\n                }",variables:a,endpoint:{endpoint:"main",ver:"v3"}})}catch(e){s.Z.promiseHandler(a)(e)}}static async isChannelNameAvailable(e,t={},n={}){try{return await o.Z.request("query isChannelNameAvailable($name: String!) {\n                    isChannelNameAvailable(name: $name)\n                }",{name:e},{endpoint:"main",ver:"v3"},t,n)}catch(e){s.Z.promiseHandler(a)(e)}}static async saveChannelTelegramImport(e,t,n,r,i={},l={}){try{const a="mutation saveTelegramImport(\n                $personId: Float,\n                $boundId: Float!,\n                $type: telegramImportType!,\n                $username: String!,\n                $signature: String!,\n                $tags: [String]\n            ) {\n                saveTelegramImport(\n                    personId: $personId, \n                    boundId: $boundId, \n                    type: $type, \n                    username: $username, \n                    signature: $signature, \n                    tags: $tags\n                ) {\n                    status\n                    errors {\n                        key\n                        message\n                        text\n                    }\n                }\n            }";return await o.Z.request(a,{personId:e,boundId:t,type:"TYPE_CHANNEL",username:n,signature:"",tags:r},{endpoint:"user",ver:"v1"},i,l)}catch(e){s.Z.promiseHandler(a)(e)}}static async deleteChannelTelegramImport(e,t,n,r={},i={}){try{const a="mutation deleteTelegramImport(\n                $personId: Float,\n                $boundId: Float!,\n                $type: telegramImportType!,\n                $username: String!\n            ) {\n                deleteTelegramImport(\n                    personId: $personId, \n                    boundId: $boundId, \n                    type: $type, \n                    username: $username\n                ) {\n                    status\n                    errors {\n                        key\n                        message\n                        text\n                    }\n                }\n            }";return await o.Z.request(a,{personId:e,boundId:t,type:"TYPE_CHANNEL",username:n},{endpoint:"user",ver:"v1"},r,i)}catch(e){s.Z.promiseHandler(a)(e)}}static async getChannelTelegramImports(e,t,n={},r={}){try{const a="query listTelegramImports(\n                $personId: Float\n            ) {\n                listTelegramImports(personId: $personId) {\n                    items{\n                        personId\n                        boundId\n                        username\n                        signature\n                        status\n                        tags\n                    }\n                }\n            }";return((await o.Z.request(a,{personId:e},{endpoint:"user",ver:"v1"},n,r)).items||[]).filter((e=>e.boundId===t))}catch(e){s.Z.promiseHandler(a)(e)}}static async getTopStatus(e,t={},n={}){try{return await o.Z.request("query getUserPostById($id: Float!) {\n                    getUserPostById(id: $id) {\n                        top_status\n                    }\n                }",{id:e},{endpoint:"main",ver:"v3"},t,n)}catch(e){s.Z.promiseHandler(a)(e)}}static async _sendRequestToTop(e,t={},n={}){try{const a="mutation sendRequestToTop(\n                $id: Float!\n            ) {\n                sendRequestToTop(id: $id)\n            }";return await o.Z.request(a,{id:e},{endpoint:"main",ver:"v3"},t,n)}catch(e){s.Z.promiseHandler(a)(e)}}static async _processRequestToTop(e,t,n={},r={}){try{const a="mutation processRequestToTop(\n                $id: Float!\n                $topStatus: TopStatus! \n            ) {\n                processRequestToTop(id: $id, topStatus: $topStatus)\n            }";return await o.Z.request(a,{id:e,topStatus:t},{endpoint:"main",ver:"v3"},n,r)}catch(e){s.Z.promiseHandler(a)(e)}}static async getSandboxPosts(e=10,t=0,n={}){try{const a=await o.Z.request({query:`query getSandboxPosts($limit: Int!, $offset: Int!) {\n                    getSandboxPosts(limit: $limit, offset: $offset) {\n                        items {\n                            previewText\n                            post_type\n                            mentionedPersons {\n                              id\n                              display_name\n                            }\n                            place {\n                              display_name\n                              url\n                            }\n                            ${r.qh}\n                            ${r.hm}\n                          }\n                          nextOffset\n                    }\n                }`,variables:{limit:e,offset:t},endpoint:{endpoint:"main",ver:"v3"},req:n.req,res:n.res});return a?{items:this.normalizePostList(a?.items),nextOffset:a.nextOffset}:{items:[],nextOffset:0}}catch(e){s.Z.promiseHandler(a)(e)}}static async setPost2TopStatus(e,t,n={},a={}){return"WAIT"===t?this._sendRequestToTop(e,n,a):this._processRequestToTop(e,t,n,a)}static _normalizeChannels(e=[]){return e.map((e=>this._normalizeChannelInfo(e)))}static _normalizeChannelInfo(e){const t=JSON.parse(e.avatar_info||"{}"),n=JSON.parse(e.cover_info||"{}");return{...e,avatar_info:{...t,photo_original:e.avatar},cover_info:{...n,photo_original:e?.cover}}}static _normalizeSubscriptions(e){return e?e.map((e=>{const t=this.prepareAttachments(e.last_post)?.images||[],n=this._normalizeChannelInfo(e.channel);return{lastPost:e.last_post?{id:e.last_post.id,previewText:e.last_post.previewText,images:t}:null,...n}})):[]}static isChannelOwner=(e,t)=>e===t}const d=m},15394:(e,t,n)=>{"use strict";n.d(t,{I8:()=>c,RH:()=>m});n(93811),n(5645),n(17312),n(26296),n(53169),n(17708),n(82491);function a(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){const t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===r}(e)}(e)}function s(e){return a(e)&&!Array.isArray(e)}const r="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function o(e){return[].concat(Object.keys(e),function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((t=>e.propertyIsEnumerable(t))):[]}(e))}function i(e,t){try{return t in e}catch(e){return!1}}function l(e,t){if(!s(e)||!s(t))return{};const n={};return o(e).forEach((t=>{n[t]=c(e[t])})),o(t).forEach((s=>{(function(e,t){return i(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,s)||(i(e,s)&&a(t[s])?n[s]=m(e[s],t[s]):n[s]=c(t[s]))})),n}function c(e){return a(e)?m((t=e,Array.isArray(t)?[]:{}),e):e;var t}function m(e,t){return s(e)&&s(t)?l(e,t):Array.isArray(e)&&Array.isArray(t)?function(e,t){const n=[];for(const t of e)n.push(c(t));for(const e of t)n.push(c(e));return n}(e,t):c(t)}},36554:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var a=n(54462);
/**
 * Mirtesen.
 *
 * Elastic profiler.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */let s=null;"undefined"==typeof window&&(s=n(65121));const r=[];let o=0;class i{static gqlRequestPoolMaxSize=50;static startProfiler(e,t){if("undefined"!=typeof window)return;const n=new Date,r=a.Z.getConfig(),l=e?.cookies?.net_logger;let c=Number(r?.profilerRate||0),m=!1;c>0&&(o=o>1e9?0:++o,c=Number(100/(c>1?1:c)),m=o%c==0);let d=null;(m||l)&&(d=(l||"guest")+"__"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15));const p={requestId:d,userProfiling:!1,rateProfiling:m,cookieProfiling:!!l};if(t.finished)return!1;t.locals.profiler=p;let u=!1;const g=async()=>{try{if(u)return;u=!0;const a=t?.locals?.profiler?.requestId;if(!i.isProfilerEnabled(a))return!1;const o=new Date;await i.flushGqlPool();const l={index:"v2profiler_http_request",body:{requestId:a,method:e.method,status:t.statusCode,started:n,ended:o,time:o.getTime()-n.getTime(),cookies:JSON.stringify(e.cookies),body:JSON.stringify(e.body),uri:e.originalUrl,domain:e.get("host"),port:r.server.port,args:JSON.stringify(e.query),page:t.locals.initialState.app?.page,userId:t.locals.initialState.auth?.user?.id,userAgent:e.get("user-agent")}};await s.default.createIndex(l)}catch(e){}};t.on("finish",(()=>g())),t.on("close",(()=>g()))}static authProfiler(e,t){const n=a.Z.getConfig(),s=t?.locals?.initialState?.auth?.user?.id||null,r=(n?.profileUsers||[]).includes(s),o=t?.locals?.profiler;return!!o&&(!(o.cookieProfiling||!r)&&(o.userProfiling=!0,o.requestId=s+"__"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),!t.finished&&(t.locals.profiler=o,!0)))}static isProfilerEnabled(e){return!("undefined"!=typeof window||!e)}static async pushGqlEvent(e,t){if(!i.isProfilerEnabled(e))return!1;t.requestId=e,r.push(t),r.length>i.gqlRequestPoolMaxSize&&await i.flushGqlPool()}static async flushGqlPool(){try{if("undefined"!=typeof window)return!1;if(0===r.length)return;const e=r.map((e=>({index:"v2profiler_gqapi_request",body:{...e,apiCall:e.queryString.match(/{\s*(\w+)/)?.[1]||"undefined"}})));await s.default.createIndices({indices:e}),r.length=0}catch(e){}}static getRequestId=e=>e?.locals?.profiler?.requestId||null}const l=i},91517:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});n(71022),n(21943),n(93811),n(5645),n(17312);var a=n(41609),s=n.n(a),r=n(12684),o=n(99871);
/**
 * Mirtesen.
 *
 * Geo.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const i="https://geocoder.mirtesen.ru";const l=class{static normalizeOsmInfo=e=>{const t={propertyType:null,displayName:null,displayAddress:null,osmInfo:{localName:null,displayName:null,category:null,addressType:null},parsedAddress:{houseNumber:null,road:null,suburb:null,city:null,county:null,state:null,iso:null,region:null,postcode:null,country:null,countryCode:null}},n=(e?.address||[])[0]||{};t.osmInfo={localName:e?.localname||e?.name||n?.localname,displayName:e?.display_name,category:e?.category,type:e?.type,addressType:e?.addresstype,osmType:e?.osm_type,lon:e?.lon,lat:e?.lat},t.propertyType=this._parsePropertyType(e),t.parsedAddress={...t.parsedAddress,...this._parseOsmAddress(e)||{}};const{displayName:a,displayAddress:s}=this._getDisplayInfo(t,e);return t.displayName=this._addDisplayNamePrefix(a,t.propertyType),t.displayAddress=s,t};static makeOsmSid=e=>{const{osm_id:t,osm_type:n}=e||{};return t&&n?n.substring(0,1).toUpperCase()+t:null};static parseOsmSid=e=>{if(!e)return{};const t=e.match(/(W|R|N|P)(\d+)/i)||{};return{osmType:t[1],osmId:t[2]}};static getBoundsByGeometry=(e,t)=>{if(!t||!e)return null;let n=null,a=null,s=null,r=null,o=null;"MultiPolygon"===e?o=t.flat(2):"MultiLineString"===e?o=t.flat():"Polygon"===e&&(o=t[0]);for(const e of o)(null===s||e[0]<s)&&(s=e[0]),(null===r||e[0]>r)&&(r=e[0]),(null===n||e[1]<n)&&(n=e[1]),(null===a||e[1]>a)&&(a=e[1]);return[[s,n],[r,a]]};static async getReverseInfoWithGeoCoder(e,t,n=!1){try{let a=await fetch(i+"/reverse.php?lat="+e.toFixed(5)+"&lon="+t.toFixed(5)+"&zoom=18&format=jsonv2&layer=poi",{headers:{"Accept-Language":"ru"}});return a=await a.json(),n||a&&!a.error||(a=await fetch(i+"/reverse.php?lat="+e.toFixed(5)+"&lon="+t.toFixed(5)+"&zoom=18&format=jsonv2",{headers:{"Accept-Language":"ru"}}),a=await a.json()),a}catch(e){r.Z.promiseHandler("/index.js")(e)}}static async searchWithGeocoder(e){let t=await fetch(i+"/search.php?q="+e+"&polygon_geojson=1&format=json",{headers:{"Accept-Language":"ru"}});return t=await t.json(),t}static getOsmInfo=async e=>{if(!e)return;const{osmType:t,osmId:n}=this.parseOsmSid(e),a=await fetch(i+"/details.php?osmtype="+t+"&osmid="+n+"&addressdetails=1&polygon_geojson=1&format=json",{headers:{"Accept-Language":"ru"}});return await a.json()};static _parsePropertyType=e=>{const t=["building","public_building","apartments"],n=["village","hamlet"],a=["highway","road"],s=["city","town"],r=["suburb"],o=["state"],i=["country"];let l=null;return l="shop"===e?.category||"shop"===e?.addresstype||"shop"===e?.type?"shop":"peak"===e?.category||"peak"===e?.addresstype||"peak"===e?.type?"peak":"river"===e?.category||"river"===e?.addresstype||"river"===e?.type?"river":"mountain_pass"===e?.category||"mountain_pass"===e?.addresstype||"mountain_pass"===e?.type?"mountain_pass":"water"===e?.category||"water"===e?.addresstype||"water"===e?.type?"lake":t.includes(e?.category)||t.includes(e?.type)||t.includes(e?.addresstype)?"building":a.includes(e?.category)||a.includes(e?.type)||a.includes(e?.addresstype)?"road":n.includes(e?.category)||n.includes(e?.type)||n.includes(e?.addresstype)?"village":s.includes(e?.category)||s.includes(e?.type)||s.includes(e?.addresstype)?"city":r.includes(e?.category)||r.includes(e?.type)||r.includes(e?.addresstype)?"suburb":o.includes(e?.category)||o.includes(e?.type)||o.includes(e?.addresstype)?"state":i.includes(e?.category)||i.includes(e?.type)||i.includes(e?.addresstype)?"country":"other",l};static _parseOsmAddress=e=>{const t=e?.address||[];let n={};return Array.isArray(t)?t.map((e=>{"house_number"===e.type&&(n.houseNumber=e.localname),"highway"===e.class&&(n.road=e.localname),"suburb"!==e.place_type&&"suburb"!==e.type||(n.suburb=e.localname),8===e.admin_level&&"administrative"===e.type&&(n.suburb=e.localname),"city"!==e.place_type&&"city"!==e.type&&"town"!==e.place_type&&"town"!==e.type&&"village"!==e.place_type&&"village"!==e.type&&"hamlet"!==e.place_type&&"hamlet"!==e.type||(n.city=e.localname),"county"!==e.place_type&&"county"!==e.type||(n.county=e.localname),("state"===e.place_type||3===e.admin_level&&"administrative"===e.type)&&(n.state=e.localname),"country"!==e.place_type&&"country"!==e.type||(n.country=e.localname),"postcode"!==e.type&&"postcode"!==e.place_type||(n.postcode=e.localname)})):"object"==typeof t&&null!==t&&(n={houseNumber:t?.house_number,road:t?.road,suburb:t?.suburb,city:t?.city||t?.village||t?.hamlet,county:t?.county,state:t?.state,country:t?.country,countryCode:t?.country_code}),n};static _getDisplayInfo=(e,t)=>{let n,a;const r=t?.address||[],i=e.parsedAddress,l=e.propertyType;let c=[];if(s()(i)||("road"===l?(n=i.road,c.push(i.suburb),c.push(i.city),c.push(i.county),c.push(i.state)):"building"===l?(n=i.road+", "+i.houseNumber,c.push(i.suburb),c.push(i.city),c.push(i.state)):e?.osmInfo?.localName&&(n=e?.osmInfo?.localName,c.push(i.road),c.push(i.houseNumber),c.push(i.suburb),c.push(i.city),c.push(i.state)),c=c.filter((e=>e)),a=c.join(", ")),(!n||!a)&&e?.osmInfo?.displayName){let t=e?.osmInfo?.displayName.split(", ");"building"===l?(n=t[1]+", "+t[0],c=t.splice(2).join(", ")):(n=t[0],t=t.filter((e=>!o.Z.isNumeric(e)||e?.length<4)),c=t.slice(1,t.length-1).join(", ")),a=c}return n||s()(i)||(n=i.road,c.push(i.suburb),c.push(i.city),c.push(i.county),c.push(i.state),c=c.filter((e=>e)),a=c.join(", ")),n&&s()(a)&&!s()(r)&&Array.isArray(r)&&(r.splice(1).map((e=>{"country_code"!==e.type&&"country"!==e.type&&c.push(e.localname)})),c=c.filter((e=>e)),a=c.join(", ")),{displayName:n,displayAddress:a}};static _addDisplayNamePrefix=(e,t)=>{if(e.match(/^[а-я]/))return e;switch(t){case"river":e="река "+e;break;case"peak":e="пик "+e;break;case"mountain_pass":e="перевал "+e;break;case"lake":e="озеро "+e;break;case"suburb":e="р-н "+e;break;case"state":e="округ "+e}return e}}},30498:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var a=n(54462),s=n(12684),r=n(36554),o=n(64962),i=n(41750),l=n(41609),c=n.n(l);
/**
 * Mirtesen.
 *
 * GraphQL request util.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class m{static async request(...e){if(e){if("object"==typeof e[0]&&1===e.length){const{query:t,variables:n,endpoint:a,headers:s,req:r,res:o,dataKey:i}=e[0];return this._request(t,n,a,r,o,s,i,!1)}{const[t,n,a,s,r,o,i]=e;return this._request(t,n,a,s,r,o,i,!1)}}}static async rawRequest({query:e,variables:t={},endpoint:n,headers:a={},req:s=null,res:r=null}){return this._request(e,t,n,s,r,a,null,!0)}static async _request(...e){const[t,n={},a,r=null,o=null,l=null,c="",m=!1]=e;try{const s=this._getRequestUrl(a);if(!s)throw console.log("--args--"),console.log(e),new Error("GraphQL2. Empty request API url. Check config file");const d=await this._initRequestHeaders(l,r,o);let p=!1;const u=new Date;let g=await this._fetch(s,t,n,d,p);const h=new Date,_=g.status;this._logProfiling({started:u,ended:h,httpStatus:_,url:s,query:t,variables:n,res:o});const E=i.Z.parseHeadersCookies(g.headers);if(this._setExpressCookies(E,r,o),p&&(console.log("--response--"),console.log(g),console.log("--cookies--"),console.log(E)),m)return g;if(g=await g.json(),p&&(console.log("--response--"),console.log(g)),g.errors)throw p&&(console.log("--response.errors--"),console.log(g.errors)),new Error(g.errors);const f=c||this._extractQueryName(t);return g?.data[f]}catch(e){throw console.log(e),s.Z.promiseHandler("/index.js")(e),e}}static _extractQueryName(e=""){let t="";if(!e)throw new Error("There is no query string");const n=/^(query|mutation|subscription)\s*([a-z\d]+)/gim.exec(e);if(n&&n[2]&&(t=n[2]),!t){const n=/^(query|mutation|subscription)\s*{\s*([a-z\d]+)/gim.exec(e);n&&n[2]&&(t=n[2])}if(t)return t;throw new Error("Can not find query name")}static async _initRequestHeaders(e,t=null,n=null){const a={Authorization:"Bearer "+await o.ZP.getJwtAccessToken(t,n),...e};if(!c()(n)){const{ip:e,userAgent:t,geonameId:s,cookie:r}=o.ZP.getClientInfo(n);e&&void 0===a["Client-Ip"]&&(a["Client-Ip"]=e),t&&void 0===a["User-Agent"]&&(a["User-Agent"]=t),s&&void 0===a["X-Geoname-Id"]&&(a["X-Geoname-Id"]=s),r&&void 0===a.Cookie&&(a.Cookie=r)}return a}static _setExpressCookies(e,t,n){"undefined"!=typeof window||c()(t)||c()(n)||o.ZP._setExpressCookies(e,t,n)}static _logProfiling({started:e,ended:t,httpStatus:n,url:a,query:s,variables:o,res:i}){r.Z.pushGqlEvent(r.Z.getRequestId(i)||"",{started:e,ended:t,time:t.getTime()-e.getTime(),status:n,endpoint:a,method:"POST",queryString:s||null,variables:o||null})}static _fetch(e,t,n={},a={},s=!1){const r={Accept:"application/json","Content-Type":"application/json; charset=utf-8",...a};s&&(console.log("--query--"),console.log(t),console.log("--variables--"),console.log(n));const o=new Headers;for(const[e,t]of Object.entries(r))o.append(e,t);return fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",headers:o,body:JSON.stringify({variables:n,query:t})})}static _getRequestUrl(e){const t=a.Z.getConfig();if(!t)return null;const n={protocol:"https",host:null,port:null,path:"gqapi",endpoint:"main",ver:"v1",...t.api,...e},{host:s,port:r,path:o,endpoint:i,ver:l}=n;let{protocol:c}=n;const m="undefined"!=typeof window,d=t?.api?.host;m||s!==d||(c="http");let p="";return s&&(p+=`${c}://${s}`+(r?":"+r:"")),p+=(o?"/"+o:"")+(i?"/"+i:"")+(l?"/"+l:""),p}}},48687:(e,t,n)=>{"use strict";var a="/index.js";n.d(t,{Z:()=>m});n(71022),n(21943);var s=n(12684),r=n(30498),o=n(91517),i=n(3707);const l="\n    id\n    lon\n    lat\n    osm_id\n    osm_type\n    description\n    person_id\n    tag {\n        id\n        tag_name\n        subscribers_num\n    }\n    parent {\n        id\n        tag {\n            tag_name\n        }\n    }\n";class c{static tagType={geotag:1,hashtag:null};static getTagsById=async(e,t={})=>{try{let n=await c.getTagsByIds([e],t);return n=n||[],n.length>0?n[0]:null}catch(e){s.Z.promiseHandler(a)(e)}};static getTagsByIds=async(e,t={})=>{try{const n=await r.Z.request({query:"query getTagsByIds(\n                    $ids: [Float!]!\n                ) {\n                    getTagsByIds(ids: $ids) {\n                        id\n                        tag_name\n                        type_id\n                    }\n                }",variables:{ids:e},endpoint:{endpoint:"main",ver:"v3"},res:t.res,req:t.req});return c.normalizeTags(n||[])}catch(e){s.Z.promiseHandler(a)(e)}};static async getTagByName(e,t={}){try{const n=await r.Z.request({query:"query getTagByName($tag: String!) {\n                    getTagByName(name: $tag) {\n                        id\n                        tag_name\n                        type_id\n                    }\n                }",variables:{tag:e},endpoint:{endpoint:"main",ver:"v3"},res:t.res,req:t.req});if(n)return c._normalizeTagItem(n)}catch(e){s.Z.promiseHandler(a)(e)}}static getTagByOsmId=async(e,t={})=>{try{return await r.Z.request({query:`query getGeotagByOsmId($osmId: Float!) {\n                    getGeotagByOsmId(osmId: $osmId) {\n                        ${l}\n                    }\n                }`,variables:{osmId:e},endpoint:{endpoint:"main",ver:"v3"},res:t.res,req:t.req})}catch(e){s.Z.promiseHandler(a)(e)}};static async getTagSubscribersNumber(e,t={}){try{return await r.Z.request({query:`query {\n                    getTagSubscribersNumber (id: ${e})\n                }`,endpoint:{endpoint:"main",ver:"v3"},res:t.res,req:t.req})}catch(e){s.Z.promiseHandler(a)(e)}}static async getParentTags(e,t={}){try{const n=await r.Z.request({query:`query getParentTags {\n                    getParentTags(id: ${e}) {\n                        id\n                        tag_name\n                        type_id\n                    }\n                }`,endpoint:{endpoint:"main",ver:"v3"},res:t.res,req:t.req});if(n){const e=n.reverse();return c.normalizeTags(e||[])}}catch(e){s.Z.promiseHandler(a)(e)}}static async getGeotagById(e,t={}){try{const n=await r.Z.request({query:`query{\n                    getGeotagById(id: ${e}){\n                      ${l}\n                    }  \n                }`,endpoint:{endpoint:"main",ver:"v3"},res:t.res,req:t.req});if(n)return this._normalizeGeotag(n)}catch(e){s.Z.promiseHandler(a)(e)}}static async getTagLocation(e,t={}){try{const{req:n,res:a}=t;return await r.Z.request("query getTagLocation($id:Float!){\n                    getTagLocation(id:$id){\n                        lon\n                        lat\n                        osm_id\n                        osm_type\n                    }\n                }",{id:e},{endpoint:"main",ver:"v3"},n,a)}catch(e){s.Z.promiseHandler(a)(e)}}static async getTagSubscriptionStatus(e,t={}){const{req:n,res:o}=t;try{return await r.Z.request(`query{\n                isSubscribedToVectorAttribute(attributeType: TAG attributeId: ${e})\n            }`,null,{endpoint:"main",ver:"v3"},n,o)}catch(e){s.Z.promiseHandler(a)(e)}}static async getTagSubscriptions(e="ALL",t={}){const{req:n,res:o}=t;try{const t=await r.Z.request(`query{\n                    getSubscribedTags(tagType: ${e}) {\n                        id\n                        tag_name\n                        type_id\n                        subscribers_num\n                    }\n                }`,null,{endpoint:"main",ver:"v3"},n,o);return this.normalizeTags(t||[])}catch(e){s.Z.promiseHandler(a)(e)}}static async getCustomTags(e=0,t=10){try{const n=await r.Z.request({query:`query {\n                    getCustomGeotags(offset: ${e}, limit: ${t}) {\n                        ${l}\n                    }\n                }`,endpoint:{endpoint:"main",ver:"v3"}});return this._normalizeGeotags(n||[])}catch(e){s.Z.promiseHandler(a)(e)}}static async addCustomTagAndSubscribe(e){const t=await c.addCustomTag(e);return t&&await i.Z.setInterest("TAG",t,!0),t}static async addCustomTag({name:e,lon:t,lat:n,description:o,osmId:i,osmType:l,parentOsmId:c}){try{return await r.Z.request({query:"mutation addCustomGeotag(\n                        $name: String!\n                        $lon: Float!\n                        $lat: Float!\n                        $description: String\n                        $osmId: Float\n                        $osmType: String\n                        $parentOsmId: Float\n                    ) {\n                        addCustomGeotag (\n                            name: $name\n                            lon: $lon\n                            lat: $lat\n                            osm_id: $osmId\n                            osm_type: $osmType\n                            parent_osm_id: $parentOsmId\n                            description: $description\n                        )\n                    }\n                ",variables:{name:e,lon:Number(t),lat:Number(n),description:o,osmId:i,osmType:l,parentOsmId:c},endpoint:{endpoint:"main",ver:"v3"}})}catch(e){s.Z.promiseHandler(a)(e)}}static async deleteCustomTag(e){try{return await r.Z.request({query:`mutation {\n                    deleteCustomGeotag(id: ${e})\n                  }\n                `,endpoint:{endpoint:"main",ver:"v3"}})}catch(e){s.Z.promiseHandler(a)(e)}}static _normalizeTagItem=e=>({id:e?.id,text:e?.tag_name,icon:"#",typeId:e?.type_id,subscribersNum:e?.subscribers_num});static normalizeTags=e=>e.map((e=>c._normalizeTagItem(e)));static _normalizeGeotags=(e=[])=>e.map((e=>this._normalizeGeotag(e)));static _normalizeGeotag=e=>({id:e.id,text:e.tag?.tag_name,lon:e.lon,lat:e.lat,osmSid:o.Z.makeOsmSid(e),description:e.description,ownerId:e.person_id});static stripGeoId=e=>e?e.replace(/(\s)?\[G?\d+\]$/i,""):"";static isGeoTag=e=>!!e&&null!==e.match(/\[G?\d+\]$/i);static isCustomTag=e=>!!e&&null!==e.match(/\[G\d+\]$/i)}const m=c},3707:(e,t,n)=>{"use strict";var a="/index.js";n.d(t,{Z:()=>l});var s=n(30498),r=n(12684),o=n(47029);class i{static getInterests=async e=>{try{const t=await s.Z.request({query:"query{\n                    getVectorAttributes {\n                        pva_person_id\n                        pva_attribute_id\n                        pva_attribute_type\n                        pva_prefers\n                    }\n                }",endpoint:{endpoint:"main",ver:"v3"},res:e.res,req:e.req});return i.normalizeInterests(t||[])}catch(e){r.Z.promiseHandler(a)(e)}};static setInterest=async(e,t,n,o={})=>{try{return await s.Z.request({query:`mutation{\n                    addVectorAttribute(\n                        attributeType: ${e.toUpperCase()},\n                        attributeId: ${t}\n                        prefers: ${n}\n                        layout: LAYOUT_WEB\n                    )\n                }`,endpoint:{endpoint:"main",ver:"v3"},res:o.res,req:o.req})}catch(e){r.Z.promiseHandler(a)(e)}};static deleteManualInterest=async(e,t,n={})=>{try{return await s.Z.request({query:`mutation{\n                deleteVectorAttribute(\n                    attributeType: ${e.toUpperCase()},\n                    attributeId: ${t}\n                    layout: LAYOUT_WEB\n                )\n            }`,endpoint:{endpoint:"main",ver:"v3"},res:n.res,req:n.req})}catch(e){r.Z.promiseHandler(a)(e)}};static deleteAutoInterest=async(e,t,n={})=>{try{return await s.Z.request({query:`mutation{\n                    deleteVector(\n                        type: ${e.toUpperCase()},\n                        id: ${t}\n                        layout: LAYOUT_WEB\n                    )\n                }`,endpoint:{endpoint:"main",ver:"v3"},res:n.res,req:n.req})}catch(e){r.Z.promiseHandler(a)(e)}};static getDetailedReasonForShowing=async e=>{try{const t=await s.Z.request({query:`query {\n                    getReasonDetailsForShowing(id: ${e}) {\n                        class\n                        attribute_type\n                        attribute_id\n                        icon\n                        text\n                        image\n                    }\n                }`,endpoint:{endpoint:"main",ver:"v3"}});return i._normalizeDetailedReasons(t||[])}catch(e){if(o.Z.isClientNetworkError(e))throw e;r.Z.promiseHandler(a)(e)}};static _normalizeDetailedReasons=e=>{const t=[];let n=!1;for(const a of e)"topic"!==a.attribute_type||84===a.attribute_id||5===a.attribute_id?"site"!==a.attribute_type||n?"site"!==a.attribute_type&&t.push(a):(t.push(a),n=!0):t.push(a);return t};static normalizeInterests=e=>{const t={};for(const n of e){const e=n.pva_attribute_type.toLowerCase();t[e]||(t[e]={}),t[e]={...t[e],[n.pva_attribute_id]:n.pva_prefers}}return t}}const l=i},51605:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var a=n(12684),s=n(54462),r=n(64962),o=n(56082);const i=class{static uploadVideoToStorage=async(e,t)=>await this.uploadVideoToPanda(e,t);static uploadVideoToPanda=async(e,t)=>{try{const{videoUrl:n}=s.Z.getConfig().panda,a=(await(0,o.Z)({project:"video",body:JSON.stringify({query:"query {getUrlToUpload}"})}))?.data?.getUrlToUpload;if(!a)throw new Error("Can not get url to upload video");await new Promise(((n,s)=>{const r=new XMLHttpRequest;r.open("PUT",a),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Access-Control-Allow-Origin","*"),t&&r.upload.addEventListener("progress",t),r.addEventListener("load",(()=>{if(200!==r.status)return s(r.status+": "+r.response),void console.log("Error on upload video",r.status,r.response);n(r.response)})),r.send(e)}));const{name:i,lastModified:l,size:c,type:m}=e,d=(await(0,o.Z)({project:"video",body:JSON.stringify({query:`mutation {\n                            videoUploaded(\n                                signedUrl: "${a}",\n                                name: "${i}",\n                                lastModified: ${l},\n                                size: ${c},\n                                type: "${m}",\n                                userId: `+r.ZP.getCurrentUserId()+"\n                            )\n                        }"})}))?.data?.videoUploaded;if(!d)throw new Error("Error on videoUploaded");const p=JSON.parse(d);return{pandaVideoId:p.videoId,url:n+p.videoId,poster:"//static.mtml.ru/images/video_soon.jpg"}}catch(e){a.Z.promiseHandler("/index.js")(e)}}}},40680:(e,t,n)=>{"use strict";n.d(t,{H_:()=>i,fO:()=>o,lP:()=>l,r_:()=>a});const a="\ngroup {\n    display_name\n    url\n    photo_original\n    id\n    canViewBlogPostCreator\n    showSubscribersAmount\n    is_subscribed\n    is_member\n    is_owner\n    is_staff\n    created\n}",s="\nattachments {\n  ... on AttachmentPhoto{\n    photo {\n      id\n      photo_original\n      width\n      height\n    }\n  }\n  ... on AttachmentLink {\n    link {\n      url\n      title\n      caption\n      embed\n      photo {\n        id\n        photo_original\n        width\n        height\n      }\n    }\n  }\n  ... on AttachmentVideo {\n    video {\n      id\n      pandaVideoId\n      title\n      player_html\n      player_data\n      caption\n      url\n    }\n  }\n  ...on AttachmentForeignPoll {\n    type\n    poll {\n        title\n        color_scheme\n        votes_counter\n        fileUri\n    }\n  }\n}",r=`\nid\npost_type\nurl\ndate\nowner_id\ntags\ntext\nforeignPollId\n${s}\nfrom {\n    id\n    display_name\n    url\n    photo_original\n    isAuthenticAccount\n}`,o=`\nshared_post {\n    ... on UserPost {\n        msg_type_did\n        ${r}\n        previewText\n        extraData\n    }\n    ... on BlogPost {\n        msg_type_did\n        ${r}\n        ${a}\n        title\n        preview_text\n    }\n}`,i=`\n  id\n  from_id\n  from {\n    id,\n    display_name\n    url\n    photo_original\n    isAuthenticAccount\n    sex\n  }\n  owner_id\n  text\n  comments_count\n  marks_count\n  likes {\n    count\n    user_likes\n    can_like\n    marks_pluses\n    marks_minuses\n    user_like_attr\n    like_attr_ids {\n        id\n        count\n    }\n  }\n  fame_actions_positive_count\n  fame_actions_negative_count\n  fame_actions {\n    user_id\n    user_name\n    user_avatar\n    message\n    is_positive\n    title\n    type\n  }\n  url\n  tags\n  date\n  canEdit\n  foreignPollId\n  ${s}\n`,l=i+"\n  reposts\n  extraData\n"},2079:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(67294);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Base control.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const r=a.forwardRef(((e,t)=>{const{children:n,...r}=e;return(e=>"href"in e)(e)?a.createElement("a",s({},r,{ref:t}),n):a.createElement("button",s({},r,{ref:t}),n)})),o=(0,a.memo)(r)},87426:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var a=n(67294),s=n(94184),r=n.n(s),o=n(60982),i=n(2079);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l.apply(this,arguments)}const c=e=>{const{appearance:t="btn",isCompact:n=!1,color:s="primary",disabled:c=!1,extraClasses:m="",icon:d="",emoji:p="",label:u,rounded:g=!1,outline:h,..._}=e,E=r()(t,m,{compact:n,[`${t}-${s}`]:!!s&&"custom"!==s,rounded:g,disabled:c,[`outline-${h}`]:!!h}),f=d&&a.createElement(o.Z,{iconName:d});return a.createElement(i.Z,l({},_,{className:E,disabled:c}),p&&a.createElement("i",null,p),f,!n&&u)},m=(0,a.memo)(c)},9774:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var a=n(67294),s=n(94184),r=n.n(s);const o=({txt:e="",isLoading:t=!1,isRequired:n})=>e?a.createElement(a.Fragment,null,a.createElement("label",{className:"label"},!t&&a.createElement(a.Fragment,null,e," ",void 0!==n&&a.createElement("span",{className:"label-req-opt"},"•"," ",n?"Обязательно":"Необязательно")))):null;var i=n(56088),l=n(42501);const c=({label:e="",helper:t="",isError:n=!1,isLoading:s=!1,isRequired:c,disabled:m=!1,children:d,counter:p})=>a.createElement(l.U.Provider,{value:{isLoading:s,disabled:m}},a.createElement("div",{className:r()("form-controller",{"form-controller_error":n,"form-controller_loading":s,"form-controller_disabled":m,"form-controller_with-label":e,"form-controller_with-helper":t})},a.createElement(o,{txt:e,isLoading:s,isRequired:c}),d,a.createElement("div",{className:"info"},a.createElement(i.Z,{txt:t,isLoading:s,isError:n}),p&&a.createElement("i",{className:"counter"},p.currentLength>0&&`${p.currentLength} / `,p.maxLength))))},56088:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(67294),s=n(94184),r=n.n(s);const o=({txt:e="",isLoading:t=!1,isError:n=!1})=>e?a.createElement("i",{className:r()("helper",{helper_error:n,helper_loading:t})},!t&&e):null},65966:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var a=n(67294),s=n(94184),r=n.n(s),o=n(42501),i=n(60982);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l.apply(this,arguments)}const c=a.forwardRef((({value:e,inputPrefix:t,icon:n,onFocus:s,onBlur:c,...m},d)=>{const{isLoading:p,disabled:u}=(0,a.useContext)(o.U),[g,h]=(0,a.useState)(!1);return a.createElement(a.Fragment,null,p?a.createElement("div",{className:"input-placeholder"}):a.createElement("div",{className:r()("input-box",g&&"focused")},t&&a.createElement("span",{className:"prefix"},t),n&&a.createElement("i",{className:"prefix"},a.createElement(i.Z,{iconName:n})),a.createElement("input",l({ref:d,className:"input",value:e,disabled:u,onFocus:e=>{"function"==typeof s&&s(e),h(!0)},onBlur:e=>{"function"==typeof c&&c(e),h(!1)}},m))))}))},60982:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var a=n(67294),s=n(94184),r=n.n(s);const o=({iconName:e,extraClasses:t="",filename:n})=>a.createElement("svg",{className:r()("svg-icon",t)},a.createElement("use",{href:`/images/${n||"icons"}.svg#${e}`})),i=(0,a.memo)(o)},82099:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(67294),s=n(42501);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}const o=e=>{const t=(0,a.useRef)(),{isLoading:n,disabled:o}=(0,a.useContext)(s.U),{autoResize:i,onInput:l,...c}=e,m=e=>{e.current&&(e.current.style.height="auto",e.current.style.height=`${e.current.scrollHeight}px`)};return(0,a.useEffect)((()=>{t.current&&i&&m(t)}),[i]),a.createElement("div",{className:"textarea"},!n&&a.createElement(a.Fragment,null,a.createElement("div",{className:"input-wrap"},a.createElement("textarea",r({ref:t,disabled:o,style:{resize:i?"none":"vertical"},onInput:e=>{t.current&&i&&m(t),"function"==typeof l&&l(e)}},c)),!i&&a.createElement("svg",null,a.createElement("use",{href:"/images/icons.svg#textarea-resizer"})))))}},53223:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var a=n(67294),s=n(94184),r=n.n(s);
/**
 * Mirtesen.
 *
 * Emoji reaction.
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const o=({name:e,size:t="",extraClasses:n=""})=>a.createElement("span",{className:r()("emoji-reaction",t&&`emoji-reaction_${t}`,n)},a.createElement("i",{className:"emoji-reaction__icon",style:{backgroundImage:`url(https://mirtesen.ru/images/emoji/${e}.svg)`}})),i=(0,a.memo)(o)},24635:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var a=n(67294),s=n(99871),r=n(86418),o=n(94337);
/**
 * Mirtesen.
 *
 * Comment likes.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const i=({src:e,tag:t="img",size:n="bp",rjs:i=2,className:l="",alt:c="",style:m={},crossOrigin:d,href:p="",target:u="",key:g="",setImage:h=null,disableRetina:_=!1,children:E=null})=>{const f=a.createRef(),b=(0,o.E)();(0,a.useEffect)((()=>{f.current&&h&&h(f.current)}),[]);const{browser:y}=(0,a.useContext)(r.O),v=s.Z.cropImage2(e,{browser:y,size:n}),T=t,S=_||!s.Z.canCropImage(v)?v:i;return"img"===t?a.createElement("img",{key:g,className:l,style:m,src:v,alt:c,"data-rjs":S,crossOrigin:d,ref:f}):a.createElement(T,{key:g,className:l,style:b?{...m,backgroundImage:v?"url("+v+")":""}:void 0,href:p,title:c,target:u,"data-rjs":S},E)},l=(0,a.memo)(i)},42501:(e,t,n)=>{"use strict";n.d(t,{U:()=>a});const a=(0,n(67294).createContext)({isLoading:!1,disabled:!1})},86418:(e,t,n)=>{"use strict";n.d(t,{O:()=>a});const a=(0,n(67294).createContext)({browser:null})},94337:(e,t,n)=>{"use strict";n.d(t,{E:()=>s});var a=n(67294);function s(){const[e,t]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{t(!0)}),[]),e}},43834:(e,t,n)=>{"use strict";n.d(t,{C:()=>r,T:()=>s});var a=n(88928);const s=()=>(0,a.I0)(),r=a.v9},41045:(e,t,n)=>{"use strict";n(82537)},46325:(e,t,n)=>{"use strict"},82537:(e,t,n)=>{"use strict";n.d(t,{Z9:()=>a,MP:()=>o,M2:()=>s,fr:()=>r});n(46325),n(41045);const a=e=>"post"===e?.post_type,s=e=>!!e.photo,r=e=>!!e.video,o=e=>!!e.link},2823:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var a=n(81827);class s{static set(e,t,n,a=null,s=null){const r=this._prepareCookieOptions(n,a?.get("host"));"undefined"!=typeof window?this._setClientCookies(e,t,r):this._setServerCookies(e,t,r,a,s)}static get(e,t){let n=null;return"undefined"!=typeof window?n=this.getCookieFromStr(e,document.cookie):t&&(n=t?.cookies?.[e]||null),n}static delete(e,t,n){s.set(e,"deleted",{expires:new Date(0)},t,n)}static _setServerCookies(e,t,n,a=null,s=null){a&&s&&(s.cookie(e,t,n),a.cookies[e]="deleted"===t?null:t)}static _setClientCookies(e,t,n){let a=e+"="+(t=encodeURIComponent(t));for(const e in n)if(n.hasOwnProperty(e)){a+="; "+e;const t=n[e];!0!==t&&(a+="="+t)}document.cookie=a}static _prepareCookieOptions(e,t=""){const n={...e};let a=n.expires;if(a&&"number"==typeof a){const e=new Date;e.setTime(e.getTime()+1e3*a),a=n.expires=e}return a instanceof Date&&"undefined"!=typeof window&&(n.expires=a.toUTCString()),n.domain=n.domain||this.getCookieDomain(t)||"",n}static getCookieDomain(e=""){let t=null;if("undefined"!=typeof window){const e=window.location.hostname.split(".");t=`.${e[e.length-2]}.${e[e.length-1]}`}else e&&(t=a.Z.getDomain(e),a.Z.isBaseDomainMatched(e)&&(t="."+t));return t}static getCookieFromStr(e,t){if(!e||!t)return null;const n=t.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return n?.[1]?decodeURIComponent(n[1]):null}}const r=s},93649:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});n(71022),n(21943);var a=n(27955),s=n.n(a);const r="https?:\\/\\/mirtesen\\.ru\\/people\\/(\\d+)(?![\\w\\/])",o=/#([a-z0-9а-я_-]+)(\[(G?\d+)\])?/,i=/#'([a-z0-9а-я_ .\-]+)(\[(G?\d+)\])?'/;class l{static normalizeSpaces(e){return e?e=(e=e.replace(/(\r|\r\n)/g,"\n")).replace(/\n{4,}/g,"\n\n\n"):e}static stripTags(e){return e.replace(/(<([^>]+)>)/gi,"")}static br2nl(e){return e.replace(/\n/g,"").replace(/<br\/?><\/div>/gi,"</div>").replace(/<(div|p|br)>/gi,"\n")}static nl2br(e,t="div"){return e?e="br"===(t=t||"div")?(e=e.replace(/^(.*?)$/gim,(e=>e+"<br/>"))).replace(/<br\/>$/gi,""):e.replace(/^(.*?)$/gim,(e=>e?`<${t}>`+e+`</${t}>`:"<div> <br/></div>")):""}static isHtmlEmpty(e){return!(this.normalizeSpaces(this.stripTags(e)).length>0||e.match("<(img|iframe|video|audio|svg|canvas|script)"))}static plain2html(e,t=null){t=t||[];const n=(e=s()(e)).match(new RegExp(r,"ig"));Array.isArray(n)&&n.map((n=>{const a=n.split("/people/")[1],s=t[a];s&&(e=e.replace(n,`<a class='blog-post-user-entity' data-user-id='${a}' data-user-name='${s}' href='http://mirtesen.ru/people/${a}' target='_blank' rel='nofollow'>`+s+"</a>"))}));e=l._handleHashtags(e,((e,t)=>((e,t)=>{let n="hashtag";return t&&(n+=" hashtag_geo"),"<a class='"+n+"' target='_blank' href='/hashtags/"+encodeURIComponent(e+(t?" ["+t+"]":""))+"'>"+(t?"":"#")+e+"</a>"})(e,t)));const a=new RegExp("(src=(\"|'))?https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)","ig");return e=e.replace(a,(e=>e.match(new RegExp(r,"i"))||e.match(new RegExp("/hashtags/","i"))?e:`<a href='${e}' target='_blank' rel='nofollow'>`+e+"</a>")),e=this.normalizeSpaces(e),e=this.nl2br(e)}static plain2text(e,t=null){t=t||[];const n=(e=s()(e)).match(new RegExp(r,"ig"));return Array.isArray(n)&&n.map((n=>{const a=n.split("/people/")[1],s=t[a];s&&(e=e.replace(n,"@"+s))})),e=l._handleHashtags(e,(e=>"#"+e)),e=this.normalizeSpaces(e)}static editor2html(e){return e?e=(e=(e=e.replaceAll(/(<p[^>]*><br\/?><\/p>){3,}/g,"<p><br></p><p><br></p>")).replaceAll(/^(<p[^>]*><br\/?><\/p>){1,}/g,"")).replaceAll(/(<p[^>]*><br\/?><\/p>){1,}$/g,""):e}static _handleHashtags(e,t){let n=new RegExp(o,"ig"),a=[...e.matchAll(n)];return Array.isArray(a)&&a.map((n=>{const a=n[1]||"",s=n[3]||0;e=e.replace(n[0],t(a,s))})),n=new RegExp(i,"ig"),a=[...e.matchAll(n)],Array.isArray(a)&&a.map((n=>{const a=n[1]||"",s=n[3]||0;e=e.replace(n[0],t(a,s))})),e}}const c=l},63876:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});n(35014),n(5645),n(31331);var a=n(42940),s=function(e){return e[e.nationalPattern=2]="nationalPattern",e[e.possibleLength=3]="possibleLength",e[e.formats=4]="formats",e}(s||{}),r=function(e){return e[e.pattern=0]="pattern",e[e.format=1]="format",e[e.leadingDigits=2]="leadingDigits",e[e.internationalFormat=5]="internationalFormat",e}(r||{});const o=class{static MAX_LENGTH_COUNTRY_CODE=3;static validInternational(e){const t=this.extractCountryCode(e);if(t){const n=this.getCountriesByPhoneCode(t),a=e.replace(t,"");if(n)return this.testNationalPatterns(n,a)}return!1}static extractCountryCode(e){if("+"===e[0])for(let t=1;t<=this.MAX_LENGTH_COUNTRY_CODE;t++){const n=e.slice(1,t+1);if(this.countryCodeExitsts(n))return"+"+n}return null}static countryCodeExitsts(e){return!!this.getCountriesByPhoneCode(e)}static getCountriesByPhoneCode(e){return a.qK[e.replace("+","")]||null}static testNationalPatterns(e,t){return e.some((e=>{const n=this.numPlan(e);if(!n(s.possibleLength).some((e=>t.length===e)))return!1;const a=n(s.nationalPattern);return!!a&&a.test(t)}))}static numPlan(e){return t=>{const n=a.hW[e][t];return t===s.nationalPattern?new RegExp(n):n}}static formatInternational(e){const t=this.extractCountryCode(e);if(!t)return e;const n=e.replace(t,""),a=this.getFormat(n,t);if(!a)return e;const s=new RegExp(a[r.pattern]),o=a[r.internationalFormat]||a[r.format];return`${t} ${n.replace(s,o)}`}static getFormat(e,t){const n=this.getCountriesByPhoneCode(t)?.[0];if(!n)return null;const a=this.numPlan(n)(s.formats);for(const t of a){const n=t[r.leadingDigits];if(n?.length>0){const t=new RegExp(n[n.length-1]);if(0!==e.search(t))continue}const a=t[r.pattern];if(new RegExp("^(?:"+a+")$").test(e))return t}return null}static extractInternational(e){return e.replace(/[^+0-9]/g,"")}}},76859:(e,t,n)=>{"use strict";n.d(t,{TT:()=>d,VT:()=>p,ZP:()=>_});n(88449),n(2490),n(59849);var a=n(67294),s=n(33130),r=n(91517),o=n(60982),i=n(74535),l=n(12629),c=n(94184),m=n.n(c);
/**
 * Mirtesen.
 *
 * Hashtag map.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const d=(e,t={})=>{p(e.type,e,t)},p=(e,t,n={})=>{const a={type:"MT_APP_FLY_2_MAP",flyTo:e,osmSid:t.osmSid,lon:t.lon,lat:t.lat,animationOptions:n};setTimeout((()=>window.postMessage(a,"*")),10)},u=async(e,t,n)=>{if("undefined"==typeof window||!window.maplibregl||!window?.mt_openmap)return;n=n||{};const a=(e,t)=>{const a=l.getZoom(),s=a>14?a:14;l.flyTo({center:[e,t],zoom:s,...g,...n})},{osmSid:s,lon:o,lat:i}=t,l=window?.mt_openmap,c=await r.Z.getOsmInfo(s);let m=null,d=null;const p=c?.centroid,u=c?.geometry,h=u?.type;["Polygon","MultiPolygon","MultiLineString"].includes(h)&&(m=u?.coordinates,d=r.Z.getBoundsByGeometry(h,m)),"point"===e&&o&&i?a(o,i):"bounds"===e&&d?l.fitBounds(d,{padding:70,...g,...n}):p&&a(p?.coordinates[0],p?.coordinates[1]);let _=null;o&&i?_={lon:o,lat:i}:p&&(_={lon:p?.coordinates[0],lat:p?.coordinates[1]}),_&&(async(e,{lon:t,lat:n})=>{if(!t||!n)return!1;const a=document.createElement("div");a.className="maplibregl-marker",a.setAttribute("id","maplibregl-marker");const s=window?.mt_openmap_marker||new window.maplibregl.Marker({element:a,draggable:!1});window.mt_openmap_marker=s,s.setLngLat([t,n]).addTo(e)})(l,_),c&&(async(e,t)=>{let n;const a=t?.geometry;if(!a)return!1;const s=a?.type,o=a?.coordinates;["Polygon","MultiPolygon","MultiLineString"].includes(s)&&(n=r.Z.getBoundsByGeometry(s,a?.coordinates)),n&&["Polygon","MultiPolygon","MultiLineString"].includes(s)&&(e.getLayer("geometry-line")&&e.removeLayer("geometry-line"),e.getLayer("geometry-fill")&&e.removeLayer("geometry-fill"),e.getSource("geometry")&&e.removeSource("geometry"),e.addSource("geometry",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:s,coordinates:o}}}),e.addLayer({id:"geometry-line",type:"line",source:"geometry",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#4694FF","line-width":1}}),e.addLayer({id:"geometry-fill",type:"fill",source:"geometry",layout:{},paint:{"fill-color":"#4694FF","fill-opacity":.15}}))})(l,c)},g={animate:!0,duration:1500,easing:e=>1-Math.pow(1-e,5),essential:!0},h=({initialPosition:e})=>{const[t,n]=(0,a.useState)("default"),[r,c]=(0,a.useState)(!1);(0,l.O)("message",(async e=>{"MT_APP_FLY_2_MAP"===e.data.type&&s.Z.lazyLoad((()=>"undefined"!=typeof window&&window.maplibregl&&window.mt_openmap),(()=>{const t=r?5:500,n=e.data.animationOptions||{};r||(n.duration=0),setTimeout((()=>{u(e.data.flyTo,{osmSid:e.data.osmSid,lon:e.data.lon,lat:e.data.lat},n),setTimeout((()=>{c(!0)}),200)}),t)}),(()=>{console.log("Couldn't draw maplibregl")}))})),(0,a.useEffect)((()=>{(async()=>{s.Z.lazyLoad((()=>"undefined"!=typeof window&&void 0!==window?.maplibregl?.Map),(async()=>{const e=new window.maplibregl.Map({container:"geo-map",style:"https://tileserver.mirtesen.ru/styles/mt/style.json",antialias:!0,minZoom:4});window.mt_openmap=e,e.addControl(new window.maplibregl.NavigationControl,"top-right"),e.on("click",(async t=>{const{lat:n,lng:a}=t?.lngLat||{},s=e.getZoom();if(s<15)return void e.flyTo({center:[a,n],zoom:s+1,...g});const r={type:"MT_APP_GEOMAP_CLICK",lon:a,lat:n};window.postMessage(r,"*")})),e.on("contextmenu",(async t=>{const{lat:n,lng:a}=t?.lngLat||{};e.flyTo({center:[a,n],zoom:e.getZoom()-1,...g})})),e.on("load",(async()=>{}))}),(()=>{console.log("Couldn't load maplibregl")}))})()}),[]),(0,a.useEffect)((()=>{e&&p(e.type,{osmSid:e.osmSid,lon:e.lon,lat:e.lat},{duration:0})}),[e]),(0,a.useEffect)((()=>{r&&d(t)}),[t,r]),(0,l.O)("message",(e=>{"MT_APP_CHANGE_GEO_MARKER"===e.data.type&&n(e.data.marker)}));const d=e=>{const t=document.getElementById("maplibregl-marker");t&&(t.classList.remove(...Array.from(t.classList).filter((e=>e.includes("custom-marker")))),t.classList.add("custom-marker-"+e))},h=m()({"geo-map":!0,"geo-map_hidden":!r});return a.createElement("div",{className:"geo-map-wrapper"},a.createElement("div",{className:h,id:"geo-map"}),a.createElement("div",{className:"fly2me",onClick:()=>{window.navigator.geolocation.getCurrentPosition((e=>{const{latitude:t,longitude:n}=e.coords;p("point",{lon:n,lat:t})}),(e=>{console.log("--navigator error--"),console.log(e),i.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Не удалось определить точное местоположение. Проверьте настройки браузера"}),console.log("Geolocation Error: "+e.code)}),{enableHighAccuracy:!0,maximumAge:1e4,timeout:3600})}},a.createElement(o.Z,{iconName:"send-3"})))},_=(0,a.memo)(h)},32470:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var a=n(67294),s=n(94184),r=n.n(s),o=n(76859),i=n(48687),l=n(74535);
/**
 * Mirtesen.
 *
 * Post editor geotag preview
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const c=({tagId:e,onRemove:t})=>{const[n,s]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(async()=>{let t=null;e&&(t=await i.Z.getGeotagById(e)||null),s(t)})()}),[e]),(0,a.useEffect)((()=>{n&&i.Z.isCustomTag(n.text)&&l.Z.sendMessage({type:"MT_APP_CHANGE_GEO_MARKER",marker:"custom-tag"})}),[n]),n?a.createElement("div",{className:r()("geo-preview",i.Z.isCustomTag(n?.text)&&"custom")},a.createElement("div",{className:"geo-map-container"},a.createElement(o.ZP,{initialPosition:{osmSid:n.osmSid,lon:n.lon,lat:n.lat}})),a.createElement("div",{className:"info"},a.createElement("h4",null,i.Z.stripGeoId(n.text)),a.createElement("p",{className:"extra-text"},n.description)),a.createElement("button",{type:"button",className:"svg-remove-attach close",onClick:t})):null},m=(0,a.memo)(c)},41999:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var a=n(67294),s=n(40739),r=n(60982),o=n(21093),i=n(2079),l=n(24061),c=n(43834),m=n(74535);
/**
 * Mirtesen.
 *
 * Channel avatar
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const d=({avatarInfo:e,channelTitle:t,isOwner:n,messageId:d})=>{const p=(0,c.T)();let u;const g=e?.avatar||e?.photo_original,h=a.createElement(s.Z,{logoInfo:{userName:t,logoImg:g,size:"av116"}}),_=a.createElement(i.Z,{type:"button",className:"placeholder",onClick:()=>{p((0,l.n)(!0,void 0,d))}},a.createElement(r.Z,{iconName:"add-photo"}));return u=n?g?a.createElement(o.Z,{customListClasses:"channel-dropdown",placement:"auto-left",buttonValue:h},a.createElement(i.Z,{className:"channel-dropdown__item",onClick:()=>{p((0,l.n)(!0,e,d))}},"Изменить аватар"),a.createElement(i.Z,{className:"channel-dropdown__item",onClick:()=>{p((0,l.n)(!0,void 0,d))}},"Загрузить новый аватар"),a.createElement(i.Z,{className:"channel-dropdown__item divider highlight",onClick:()=>{m.Z.sendMessage({type:`MT_APP_${d}_DELETE_AVATAR`})}},"Удалить")):_:h,a.createElement(a.Fragment,null,a.createElement("div",{className:"channel-avatar"},u))},p=(0,a.memo)(d)},24061:(e,t,n)=>{"use strict";n.d(t,{$:()=>i,n:()=>o});var a=n(12684),s=n(81277),r=n(74535);n(41045);
/**
 * Mirtesen.
 *
 * Channel Avatar Editor Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const o=(e,t,n)=>a=>a(e?{type:"CHANNEL_AVATAR_EDITOR_INIT",avatarInfo:t,messageId:n}:{type:"CHANNEL_AVATAR_EDITOR_RESET"}),i=({messageId:e,originalImage:t,croppedImage:n,top:o,left:i,width:l})=>async(c,m)=>{try{const a=m(),c=a.app?.channel||{},[d,p]=await s.Z.uploadImages([t,n]),u={photo_original:d?.photo_original,avatar:p?.photo_original,top:o,left:i,crop_width:l},g={...c,avatarId:d.id,avatarInfo:u};r.Z.sendMessage({type:`MT_APP_${e}_SET_AVATAR`,params:g})}catch(e){r.Z.sendSystemMessage("exception"),a.Z.promiseHandler("/index.js")(e)}}},34883:(e,t,n)=>{"use strict";var a="/index.js";n.d(t,{$J:()=>E,Ec:()=>g,IE:()=>p,J3:()=>C,Lk:()=>k,NG:()=>_,Q5:()=>I,Yh:()=>w,Zl:()=>D,_Q:()=>N,a3:()=>S,dF:()=>v,dL:()=>O,gg:()=>f,iP:()=>L,k4:()=>A,kj:()=>P,nQ:()=>M,ns:()=>T,sO:()=>b,wX:()=>u});n(57640),n(9924),n(88449),n(2490),n(59849);var s=n(12684),r=n(4169),o=n(74535),i=n(64962),l=n(44908),c=n.n(l),m=n(47955),d=n(48687);
/**
 * Mirtesen.
 *
 * Add Channel Form actions
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const p=e=>async(t,n)=>{const a=n()?.channelEditor||{},{isDirty:s,tab:r}=a;if(s&&"geoPosition"!==e&&"geoPosition"!==r&&!window.confirm("У вас есть несохраненные данные, которые будут потеряны. Вы уверены, что хотите завершить редактирование?"))return!1;t(u(!1)),t({type:"CHANNEL_EDITOR_SET_TAB",tab:e,prevTab:r})},u=e=>({type:"CHANNEL_EDITOR_SET_DIRTY",value:e}),g=(e,t)=>({type:"CHANNEL_EDITOR_SET_HEADER",title:e,avatar:t});let h=null;const _=(e,t,n)=>async a=>{h&&clearTimeout(h),h=setTimeout((async()=>{const s=await n(t);a(y(e,s))}),500)},E=e=>({type:"CHANNEL_EDITOR_TOGGLE_MODAL",isOpen:e}),f=(e,t=null)=>({type:"CHANNEL_EDITOR_SET_VALUES",values:e,tab:t}),b=(e,t,n=null)=>a=>a(f({[e]:t},n)),y=(e,t)=>({type:"CHANNEL_EDITOR_SET_ERROR",field:e,message:t}),v=e=>({type:"CHANNEL_EDITOR_TOGGLE_INIT",value:e}),T=e=>({type:"CHANNEL_EDITOR_TOGGLE_SAVING",value:e}),S=e=>async t=>(t(f({channelId:e},"root")),t(E(!0))),P=()=>async(e,t)=>{try{e(T(!0));const n=t()?.channelEditor||{},{name:a,title:s,description:i,avatarId:l,avatarInfo:c}=n.info,{tagId:m}=n.geoPosition,{channelId:d}=n;let g=null;if(g=d?await r.ZP.editChannel({id:d,name:a,title:s,description:i,avatarId:l,avatarInfo:c,geotag_id:m}):await r.ZP.addChannel({name:a,title:s,description:i,avatarId:l,avatarInfo:c,geotag_id:m}),!g)return o.Z.sendSystemMessage("exception"),void e(T(!1));d?(o.Z.sendSystemMessage("save"),e(T(!1)),e(u(!1)),e(p("info"))):window.location.href=`/${a}`}catch(t){o.Z.sendSystemMessage("exception"),e(T(!1)),s.Z.promiseHandler(a)(t)}},w=()=>async(e,t)=>{try{e(T(!0));const n=t()?.channelEditor||{},{yandexMetrics:a,liveInternet:s}=n.metrics,{channelId:i}=n;if(!await r.ZP.saveChannelSettings(i,{analytics:{yandexMetricaAccountId:a.toString(),liruAccountId:s}}))return o.Z.sendSystemMessage("exception"),void e(T(!1));o.Z.sendSystemMessage("save"),e(T(!1)),e(u(!1)),e(p("metrics"))}catch(t){o.Z.sendSystemMessage("exception"),e(T(!1)),s.Z.promiseHandler(a)(t)}},I=()=>async(e,t)=>{try{e(T(!0));const n=t()?.channelEditor||{},{tags:a,geoTags:s}=n.content,{channelId:i}=n;if(!await r.ZP.editChannel({id:i,tags:c()([...a,...s])}))return o.Z.sendSystemMessage("exception"),void e(T(!1));i&&(o.Z.sendSystemMessage("save"),e(T(!1)),e(u(!1)),e(p("content")))}catch(t){o.Z.sendSystemMessage("exception"),e(T(!1)),s.Z.promiseHandler(a)(t)}},C=e=>t=>{t({type:"CHANNEL_EDITOR_SET_AVATAR",avatarId:e.avatarId,avatarInfo:e.avatarInfo}),o.Z.sendMessage({type:"MT_APP_CHANNEL_AVATAR_SAVED"})},N=()=>({type:"CHANNEL_EDITOR_DELETE_AVATAR"}),O=()=>async e=>{e(f({importKey:null},"telegramEdit")),e(p("telegramEdit"))},M=e=>async t=>{t(f({importKey:e},"telegramEdit")),t(p("telegramEdit"))},k=()=>async(e,t)=>{try{const n=t()?.channelEditor||{},{channelId:a}=n,{name:s}=n.telegramEdit,l=i.ZP.getCurrentUserId();e(T(!0));const c=await r.ZP.deleteChannelTelegramImport(l,a,s);c?.status?(o.Z.sendSystemMessage("save"),setTimeout((()=>{e(p("telegramList"))}),1500)):(e(T(!1)),o.Z.sendSystemMessage("exception"))}catch(t){o.Z.sendSystemMessage("exception"),e(T(!1)),s.Z.promiseHandler(a)(t)}},A=()=>async(e,t)=>{try{const n=t()?.channelEditor||{},{channelId:a}=n,{name:s,tags:l}=n.telegramEdit,c=i.ZP.getCurrentUserId();e(T(!0));const m=await r.ZP.saveChannelTelegramImport(i.ZP.getCurrentUserId(),a,s,l);m?.status?(o.Z.sendSystemMessage("save"),e(T(!1)),e(u(!1)),e(f({importKey:`${c}-${a}-${s}`})),e(p("telegramEdit"))):(o.Z.sendSystemMessage("exception"),e(T(!1)))}catch(t){o.Z.sendSystemMessage("exception"),e(T(!1)),s.Z.promiseHandler(a)(t)}};let x=null;const L=(e,t,n=null)=>async r=>{x&&clearTimeout(x),x=setTimeout((async()=>{try{if(!e||e.length<3)return r(f({[t]:[]}));let a=await m.Z.search(e,"TAGS");if(!Array.isArray(a))return r(f({[t]:[]}));a=a.map((e=>({id:e.id,text:e.text}))),"tag"===n?a=a.filter((e=>!d.Z.isGeoTag(e.text))):"geo"===n&&(a=a.filter((e=>d.Z.isGeoTag(e.text)))),r(f({[t]:a}))}catch(e){s.Z.promiseHandler(a)(e)}}),100)},D=e=>t=>(t(u(!0)),t({type:"CHANNEL_EDITOR_SET_GEO_POSITION",tagId:e}))},92327:(e,t,n)=>{"use strict";n.d(t,{E3:()=>s,ZP:()=>r});var a=n(15394);
/**
 * Mirtesen.
 *
 * Add Channel Form Reducer.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const s={channelId:null,isMobile:!1,tab:"info",prevTab:void 0,key:0,isOpen:!1,isReady:!0,inProcess:!1,isDirty:!1,showGeo:!1,header:{title:"",avatar:null},info:{id:null,name:"",title:"",description:"",nameChangedAt:void 0,avatarId:void 0,avatarInfo:void 0,isNameAvailable:!0,errors:{}},content:{tags:[],tagSuggestions:[],geoTags:[],geoTagSuggestions:[]},telegramEdit:{importKey:null,name:"",tags:[],tagSuggestions:[],errors:{}},telegramList:{imports:[]},metrics:{yandexMetrics:"",liveInternet:"",errors:{}},geoPosition:{tagId:void 0}},r=(e=(0,a.I8)(s),t)=>{let n=(0,a.I8)(e);const r=n.tab;switch(t.type){case"CHANNEL_EDITOR_SET_TAB":n.tab=t.tab,n.prevTab=t.prevTab,n.key=n.key+1;break;case"CHANNEL_EDITOR_SET_DIRTY":n.isDirty=t.value;break;case"CHANNEL_EDITOR_TOGGLE_MODAL":n.isOpen=t.isOpen;break;case"CHANNEL_EDITOR_SET_HEADER":n.header={title:t?.title,avatar:t?.avatar};break;case"CHANNEL_EDITOR_SET_VALUES":{const e=t.tab??r;"root"===e?n={...n,...t.values}:n[e]={...n[e],...t.values};break}case"CHANNEL_EDITOR_SET_ERROR":t.message?n[r].errors[t.field]=t.message:delete n[r].errors[t.field];break;case"CHANNEL_EDITOR_TOGGLE_SAVING":n.inProcess=t.value;break;case"CHANNEL_EDITOR_TOGGLE_INIT":n.isReady=t.value;break;case"CHANNEL_EDITOR_SET_AVATAR":n.info.avatarId=t.avatarId,n.info.avatarInfo=t.avatarInfo;break;case"CHANNEL_EDITOR_DELETE_AVATAR":n.info.avatarId=null,n.info.avatarInfo={};break;case"CHANNEL_EDITOR_SHOW_TELEGRAM_LIST":n.telegramList.imports=t.telegramList;break;case"CHANNEL_EDITOR_SET_SHOW_GEO_MAP":n.showGeo=t.show;break;case"CHANNEL_EDITOR_SET_GEO_POSITION":n.geoPosition.tagId=t.tagId;break;default:return e}return n}},30782:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";var __filename="/index.js";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67294),v2_modules_src_common_hoc_withErrorBoundary__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(55655),_components_channel_ChannelAvatar__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(41999),v2_modules_src_common_components_BaseComponents_FormControl__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9774),v2_modules_src_common_components_BaseComponents_Input__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(65966),_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(34883),v2_modules_src_common_components_BaseComponents_Textarea__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(82099),v2_modules_src_common_customHooks_useRedux__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(43834),_types__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(87690),v2_modules_src_common_customHooks_useEeventListener__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(12629),v2_modules_src_common_classes_Channel__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(4169),v2_modules_src_common_classes_ErrorHandler__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(12684),v2_modules_src_common_components_Popups_ModalPopup__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(13691),v2_modules_src_common_components_BaseComponents_Button__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(87426),_channelEditorReducer__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(92327),classnames__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(94184),classnames__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_15__),v2_modules_src_common_components_BaseComponents_BaseControl__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(2079),v2_modules_src_common_components_BaseComponents_SvgIcon__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(60982),_components_GeoMap_components_GeoPreview__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(32470);
/**
 * Mirtesen.
 *
 * Add Channel Form
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const checkChannelName=async(e="")=>{if(e.length<4)return"Введите название от 4 символов";if(!/^[a-z0-9_\-]+$/i.test(e))return"Используйте указанные символы a-z0-9_-";try{if(!await v2_modules_src_common_classes_Channel__WEBPACK_IMPORTED_MODULE_10__.ZP.isChannelNameAvailable(e))return"Адрес недоступен"}catch(e){v2_modules_src_common_classes_ErrorHandler__WEBPACK_IMPORTED_MODULE_11__.Z.promiseHandler(__filename)(e)}},checkChannelTitle=e=>{if(e.trim().length<1)return"Введите название"},duration=delta=>{const days=Math.floor(delta/1e3/60/60/24),hours=Math.floor(delta/1e3/60/60-24*days),minutes=Math.floor(delta/1e3/60-24*days*60-60*hours);let t={};return["days","hours","minutes"].forEach((q=>{eval(q)>0&&(t[q]=eval(q))})),t},ChannelEditorInfoTab=(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)((()=>{const[e,t]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),n=(0,v2_modules_src_common_customHooks_useRedux__WEBPACK_IMPORTED_MODULE_7__.C)((e=>e.channelEditor)),{inProcess:a,channelId:s,isReady:r,isDirty:o,isMobile:i,prevTab:l}=n,{title:c,name:m,errors:d,description:p,avatarInfo:u,nameChangedAt:g}=n.info,{tagId:h}=n.geoPosition,_=(0,v2_modules_src_common_customHooks_useRedux__WEBPACK_IMPORTED_MODULE_7__.T)();(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{c&&m&&!d.name&&!d.title&&!a&&o?t(!1):t(!0)}),[d,m,c,a,o]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{(async()=>{if(_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.ns)(!1)),"geoPosition"!==l)if(s){_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.dF)(!1));const e=await v2_modules_src_common_classes_Channel__WEBPACK_IMPORTED_MODULE_10__.ZP.getChannelById(s,{reqType:"full"});_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.gg)({title:e?.title,description:e?.description,name:e?.name,avatarInfo:e?.avatar_info,nameChangedAt:e?.name_changed_at})),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.gg)({tagId:e?.geotag_id},"geoPosition")),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.Ec)(e?.title,e?.avatar_info?.avatar||e?.avatar_info?.photo_original)),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.dF)(!0))}else _((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.gg)({..._channelEditorReducer__WEBPACK_IMPORTED_MODULE_14__.E3.info})),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.sO)("tagId",void 0,"geoPosition"))})()}),[]),(0,v2_modules_src_common_customHooks_useEeventListener__WEBPACK_IMPORTED_MODULE_9__.O)("message",(e=>{"MT_APP_CHANNEL_EDITOR_SET_AVATAR"===e.data.type&&(_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.wX)(!0)),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.J3)(e.data.params))),"MT_APP_CHANNEL_EDITOR_DELETE_AVATAR"===e.data.type&&(_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.wX)(!0)),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__._Q)()))}));let E=null,f=null;return g&&(E=1296e6-(Date.now()-g),f=duration(E)),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_Popups_ModalPopup__WEBPACK_IMPORTED_MODULE_12__.Z.Header,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,i&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_BaseControl__WEBPACK_IMPORTED_MODULE_16__.Z,{onClick:()=>{_(s?(0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.IE)("menu"):(0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.$J)(!1))},className:"tab-back-button"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_SvgIcon__WEBPACK_IMPORTED_MODULE_17__.Z,{iconName:"back-3"})),react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_Popups_ModalPopup__WEBPACK_IMPORTED_MODULE_12__.Z.Title,null,s?"О канале":"Создание канала"),i&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"mobile-actions"},o&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_BaseControl__WEBPACK_IMPORTED_MODULE_16__.Z,{onClick:()=>{_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.wX)(!1)),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.IE)("info"))}},"Отмена"),react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_BaseControl__WEBPACK_IMPORTED_MODULE_16__.Z,{onClick:()=>{_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.kj)())},disabled:e},"Готово")))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:classnames__WEBPACK_IMPORTED_MODULE_15___default()({fade:!0,"is-ready":r})},react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_Popups_ModalPopup__WEBPACK_IMPORTED_MODULE_12__.Z.Body,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"channel-info-tab"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_channel_ChannelAvatar__WEBPACK_IMPORTED_MODULE_2__.Z,{messageId:"CHANNEL_EDITOR",isOwner:!0,avatarInfo:u}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_FormControl__WEBPACK_IMPORTED_MODULE_3__.Z,{helper:d.title,isError:!!d.title},react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_Input__WEBPACK_IMPORTED_MODULE_4__.Z,{type:"text",value:c,name:"title",placeholder:"Введите название",autoComplete:"off",onChange:e=>{_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.wX)(!0)),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.sO)("title",e.target.value)),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.NG)("title",e.target.value,checkChannelTitle))}})),react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_FormControl__WEBPACK_IMPORTED_MODULE_3__.Z,{helper:d.name||(E>0&&f?"Может быть изменено через "+f.days+"д "+f.hours+"ч "+f.minutes+"мин.":"Может быть изменено не чаще одно раза в 15 дней.")+" От 4 символов. Можно использовать латиницу (a-z), цифры (0-9) символы _ и -.",isError:!!d.name},react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_Input__WEBPACK_IMPORTED_MODULE_4__.Z,{type:"text",value:m,name:"name",inputPrefix:"mt.ru/",autoComplete:"off",disabled:E>0,onChange:e=>{_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.wX)(!0)),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.sO)("name",e.target.value.toLowerCase())),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.NG)("name",e.target.value,checkChannelName))}})),react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_FormControl__WEBPACK_IMPORTED_MODULE_3__.Z,{isError:!!d.description,counter:{maxLength:200,currentLength:p?.length}},react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_Textarea__WEBPACK_IMPORTED_MODULE_6__.Z,{value:p,name:"description",autoComplete:"off",placeholder:"Расскажите о тематике канала",onChange:e=>{_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.wX)(!0)),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.sO)("description",e.target.value))},maxLength:200,autoResize:!0})),!h&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_FormControl__WEBPACK_IMPORTED_MODULE_3__.Z,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_Button__WEBPACK_IMPORTED_MODULE_13__.Z,{extraClasses:"geo-switch",icon:"cross",appearance:"link",label:"Указать местоположение",color:"primary",title:"Указать местоположение",onClick:()=>{_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.IE)("geoPosition"))}})),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_GeoMap_components_GeoPreview__WEBPACK_IMPORTED_MODULE_18__.Z,{tagId:h,onRemove:()=>{_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.Zl)(0)),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.wX)(!0))}}))),!i&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_Popups_ModalPopup__WEBPACK_IMPORTED_MODULE_12__.Z.Footer,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,o&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_Button__WEBPACK_IMPORTED_MODULE_13__.Z,{color:"secondary",label:"Отмена",onClick:()=>{_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.wX)(!1)),_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.IE)("info"))}}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(v2_modules_src_common_components_BaseComponents_Button__WEBPACK_IMPORTED_MODULE_13__.Z,{color:"primary",label:"Сохранить",onClick:()=>{_((0,_channelEditorActions__WEBPACK_IMPORTED_MODULE_5__.kj)())},disabled:e})))))})),__WEBPACK_DEFAULT_EXPORT__=(0,v2_modules_src_common_hoc_withErrorBoundary__WEBPACK_IMPORTED_MODULE_1__.Z)(ChannelEditorInfoTab,"ChannelEditor")},87690:(e,t,n)=>{"use strict";n(41045)},64962:(e,t,n)=>{"use strict";var a="/index.js";n.d(t,{W$:()=>u,Xk:()=>p,ZP:()=>_});n(26296),n(5645),n(53169);var s=n(54462),r=n(81827),o=n(91755),i=n(12684),l=n(2823),c=n(99871),m=n(49704),d=n.n(m);
/**
 * Mirtesen.
 *
 * Auth implementation.
 *
 * @author       Artyom Konstantinov, Yuri Kukharev.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const p="_mt_jrt",u="_mt_jat";let g=null;class h{static getAuthInfo(e=!1,t=void 0,n,a){return o.Z.getAuthInfo(e,t,n,a)}static applyLoginMiddleware(e,t,n){this.setClientInfo(e,t);const s=e.headers.authorization||e.query.mirtesenAuth;if(s)return void o.Z.setToldCookies({headers:{Authorization:"Bearer "+s},req:e,res:t}).then((()=>{n()})).catch((e=>{i.Z.promiseHandler(a)(e)}));const r=e.query.mail_key;if(r)return void o.Z.loginByMailKey(r,{req:e,res:t}).then((()=>{n()})).catch((e=>{i.Z.promiseHandler(a)(e),n()}));const l=e.query.mirtesenKey;l&&this.isAnonymous(e)?o.Z.loginByKey(l,{req:e,res:t}).then((()=>{n()})).catch((e=>{i.Z.promiseHandler(a)(e),n()})):n()}static isGuest(){return!this.isLogged()}static isLogged(){const{user:e}=this._mapStateToProps();return!(!e||!e.id)}static isDeveloper(){const{user:e}=this._mapStateToProps();return!!e?.isDeveloper}static isModerator(e=null){return e||(e=this._mapStateToProps()?.user),!!e?.isModerator}static isEditor(){const{user:e}=this._mapStateToProps();return!(!e||!e.isEditor)}static canStaff(){const{app:e,auth:t}=this._mapStateToProps();return!(!t?.user||!e?.site?.is_admin&&!e?.site?.is_owner)}static canAdminBlog(){const{app:e,auth:t}=this._mapStateToProps();return!(!t?.user||!e?.site?.is_admin&&!e?.site?.is_owner)}static canModerate(){const{app:e,auth:t}=this._mapStateToProps();return!(!t?.user||!e?.site?.is_staff)}static getCurrentUser(){const{user:e}=this._mapStateToProps();return e||null}static getCurrentUserId(){const{user:e}=this._mapStateToProps();return e&&e.id||null}static setClientInfo(e,t){t.locals.ip=e.headers["x-forwarded-for"]&&e.headers["x-forwarded-for"].split(",").pop()||e.connection.remoteAddress||e.socket.remoteAddress||e.connection.socket.remoteAddress,t.locals.port=e.get("host").split(":")[1]||80,t.locals.userAgent=e.get("user-agent"),t.locals.geonameId=e.headers["x-geoip2-geoname-id"],t.locals.cookie=c.Z.convertCookiesToString(e.cookies)}static getClientInfo(e){const{ip:t,userAgent:n,geonameId:a,cookie:s,port:r}=e.locals;return{ip:t,userAgent:n,geonameId:a,cookie:s,port:r}}static fetchMirtesenKey(e,t){return o.Z.fetchMirtesenKey(e,t)}static getMirtesenKey(){const{auth:e}=this._mapStateToProps();return e.mirtesenKey}static async getJwtAccessToken(e=null,t=null,n){return"undefined"!=typeof window?h._getClientJwtAccessToken(n):h._getServerJwtAccessToken(e,t,n)}static async _getClientJwtAccessToken(e){const t=l.Z.get(u),n=g;if(!e&&"string"==typeof n&&!h.isAccessTokenExpired(n))return n;if(!e&&"string"==typeof t&&!h.isAccessTokenExpired(t))return t;if(!e&&n&&"object"==typeof n){const e=await n;if(e?.accessToken)return e.accessToken}const a=l.Z.get(p);let s=null,r=null;a&&(s=o.Z.getJwtTokenFromApiByRefresh(a),g=s,r=await s,r?.accessToken||(l.Z.delete(u),l.Z.delete(p))),r?.accessToken||(s=o.Z.getJwtTokenFromApiByHttpCookie(),g=s,r=await s);const i=r?.accessToken,c=r?.refreshToken;return i?(g=i,this.saveJwtTokensToCookies(i,c),i):null}static async _getServerJwtAccessToken(e,t,n){const a=e?.cookies?.told,s=e?.cookies[p];if(!a&&!s||!t?.locals)return null;const r=e?.cookies[u],i=t?.locals?.jwt;if(!n&&"string"==typeof r&&!this.isAccessTokenExpired(r))return r;if(!n&&"string"==typeof i&&!this.isAccessTokenExpired(i))return i;if(!n&&"object"==typeof i)return await i;let l=null,c=null;s&&(l=o.Z.getJwtTokenFromApiByRefresh(s),t.locals.jwt=l,c=await l),!c?.accessToken&&a&&(l=o.Z.getJwtTokenFromApiByTold(a),t.locals.jwt=l,c=await l);const m=c?.accessToken,d=c?.refreshToken;return m?(t.locals.jwt=m,this.saveJwtTokensToCookies(m,d,e,t),m):null}static saveJwtTokensToCookies(e="",t="",n=null,a=null){l.Z.set(u,e,{expires:300},n,a),l.Z.set(p,t,{expires:31536e3},n,a)}static _mapStateToProps(){const e=s.Z.getStore().getState();return e?{user:e.auth.user,app:e.app,auth:e.auth}:{}}static _getCookieDomain(e){let t=r.Z.getDomain(e);return r.Z.isBaseDomainMatched(e)&&(t="."+t),t}static _setExpressCookies(e,t,n){t.cookies={...t.cookies},(e||[]).forEach((e=>{e.options.domain=this._getCookieDomain(t.get("host")),n.cookie(e.name,e.value,e.options),t.cookies[e.name]=e.value})),this.setClientInfo(t,n)}static logout(e,t){return o.Z.logout(e,t).then((n=>{if("undefined"!=typeof window){l.Z.delete(u),l.Z.delete(p),l.Z.delete("_mt_geoposition_source"),l.Z.delete("_mt_geoposition_current"),"function"==typeof window.chat_logout&&window.chat_logout();try{localStorage.clear()}catch(e){i.Z.promiseHandler(a)(e)}return n}if(e&&t)return this._setExpressCookies([{options:{},name:u,value:""},{options:{},name:p,value:""},{options:{},name:"told",value:""}],e,t),n}))}static isEnabled(e){return!/^\/(aggregator|mtop|cmt|mt-iframe|covid-informer|infinite-scrolling)$/i.test(e.path)&&!/^\/(robots\.txt|favicon\.ico|infinite-scrolling|bgt\/)/i.test(e.path)}static _getAccessTokenExpirationTime=(e=null)=>{let t=null;if(e){const n=d().decode(e);n&&(t=1e3*(n.exp-10))}return t};static isAccessTokenExpired=(e=null)=>h._getAccessTokenExpirationTime(e)<Date.now();static isAnonymous=e=>!(this.isEnabled(e)&&(e.cookies.told||e.cookies[u]||e.cookies[p]||e.cookies.htold&&(e.cookies.user_id||e.cookies.mirtesen)));static postWindowTokenMessage(){if("undefined"==typeof window||null===window.opener)return;const e={type:"mtMessengerToken",accessToken:l.Z.get(u),refreshToken:l.Z.get(p),token:l.Z.get(u)};window?.opener?.postMessage(e,"*")}static catchWindowTokenMessage({data:e,origin:t}){if(-1===["https://mirtesen.ru","http://mirtesen.ru"].indexOf(t))return;const{type:n,accessToken:a,refreshToken:s}=e;"mtMessengerToken"===n&&h.saveJwtTokensToCookies(a,s)}}const _=h},91755:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});n(26296),n(5645),n(53169);var a=n(54462),s=n(30498),r=n(27361),o=n.n(r),i=n(12684),l=n(88916),c=n(56082);const m=
/**
 * Mirtesen.
 *
 * Csrf generator
 *
 * @author       Oleg Kravchenko.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class{static getRandomInt(e,t){return Math.floor(Math.random()*(t-e)+e)}static getServerTimestamp(){return(0,c.Z)({project:"main",body:JSON.stringify({query:"query { getTimestamp }"})}).then((e=>e?.data?.getTimestamp)).catch((()=>null))}static async make(){let e=await this.getServerTimestamp();e||(e=Math.floor(Date.now()/1e3));const t=e.toString(),n=(0,l.F)(t),a=t.substr(0,2),s=t.substr(2,3),r=t.substr(5,2),o=t.substr(7,3),i=this.getRandomInt(0,10),c=this.getRandomInt(10,17),m=this.getRandomInt(17,24),d=this.getRandomInt(24,32);return i.toString().concat(c,n.slice(0,i),a,n.slice(i,c),s,n.slice(c,m),r,n.slice(m,d),o,n.slice(d),m,d)}};var d=n(82492),p=n.n(d),u=n(63876),g=n(64962),h=n(10581),_="/index.js";
/**
 * Mirtesen.
 *
 * Auth model implementation.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const E={checkSmsCode:"query ackPhone(\n        $phone: String!,\n        $code: String!,\n        $role: Role\n    ) {\n        ackPhone(phone: $phone, code: $code, role: $role) {\n            jwt\n            refreshToken\n            errors {\n              key\n              message\n            }\n        }\n    }",checkCallCode:"query ackPhoneByCall(\n        $phone: String!,\n        $code: String!,\n        $role: Role\n    ) {\n        ackPhoneByCall(phone: $phone, code: $code, role: $role) {\n            jwt\n            refreshToken\n            errors {\n              key\n              message\n            }\n        }\n    }",checkPhonePublic:"mutation checkPhonePublic(\n        $phone: String!,\n        $captcha: String,\n        $captchaScore: Float,\n    ) {\n        checkPhonePublic(phone: $phone, captcha: $captcha, captchaScore: $captchaScore) {\n            status\n            errors {\n                key\n                message\n            }\n        }\n    }",checkPhoneByCallPublic:"mutation checkPhoneByCallPublic(\n        $phone: String!,\n        $captcha: String\n    ) {\n        checkPhoneByCallPublic(phone: $phone, captcha: $captcha) {\n            status\n            errors {\n                key\n                message\n            }\n        }\n    }",confirmPhoneForUser:"mutation confirmPhoneForUser(\n        $phone: String!,\n        $code: String!,\n        $mode: phoneMode,\n        $role: Role\n    ) {\n        confirmPhoneForUser(phone: $phone, code: $code, mode: $mode, role: $role) {\n            jwt\n            refreshToken\n            errors {\n              key\n              message\n            }\n        }\n    }",getAuthInfo:"query getAuthInfo(\n        $groupId: Float\n    ) {\n        getAuthInfo(groupId: $groupId) {\n            user {\n                id\n                first_name\n                display_name\n                bdate\n                sex\n                photo_original\n                url\n                count_sites\n                count_friends\n                email\n                phone\n                isPhoneVerified\n                isDeveloper\n                isModerator\n                isEditor\n                isSelfDeleted\n            }\n            groupPrivileges {\n                is_admin\n                is_member\n                is_subscribed\n                is_staff\n                is_owner\n                can_view_members\n                canViewBlogPostCreator\n                canViewContent\n                canAddPost\n                canAddPostWithoutApprove\n            }\n            viewedTooltips {\n                id\n                viewed\n            }\n            userBalance\n        }\n    }",getTokenByCookie:"query(\n        $role: Role\n    ) {\n        getTokenByCookie(\n            role: $role\n        ) {\n            token\n            refreshToken\n        }\n    }",loginByKey:"mutation loginByKey(\n        $key: String!\n    ) {\n        loginByKey(\n            key: $key\n        ) {\n            jwt\n            refreshToken\n        }\n    }",loginByMailKey:"mutation loginByMailKey(\n        $key: String!\n    ) {\n        loginByMailKey(\n            key: $key\n        ) {\n            jwt\n            refreshToken\n       }\n    }",login:"mutation login(\n        $email: String!,\n        $password: String!,\n        $remember: Float,\n        $captcha: String,\n        $role: Role\n    ) {\n        login(\n            login: $email\n            password: $password\n            remember: $remember\n            captcha_key: $captcha\n            role: $role\n        ) {\n            jwt\n            refreshToken\n            status\n            errors {\n                key\n                message\n            }\n        }\n    }",logout:"mutation {\n        logout\n    }",registerByPhone:"mutation registerByPhone(\n        $name: String!,\n        $lastname: String,\n        $email: String,\n        $phone: String!,\n        $code: String!,\n        $mode: phoneMode,\n        $role: Role\n    ) {\n        registerByPhone(\n            name: $name,\n            lastname: $lastname,\n            email: $email,\n            phone: $phone,\n            code: $code,\n            mode: $mode,\n            role: $role\n        ) {\n            jwt\n            refreshToken\n            errors {\n              key\n              message\n            }\n        }\n    }",registerUser:"mutation registerUser(\n        $name: String!,\n        $email: String,\n        $agreement: Float!,\n        $privacy: Float!,\n        $from: String,\n        $captcha: String,\n        $role: Role\n    ) {\n        registerUser(\n            name: $name,\n            email: $email,\n            agreement: $agreement,\n            privacy: $privacy,\n            from: $from,\n            captcha_key: $captcha,\n            role: $role\n        ) {\n            jwt\n            refreshToken\n            status\n            errors {\n                key\n                message\n            }\n        }\n    }",restorePassword:"mutation restorePassword($email: String) {\n        restorePassword(email: $email) {\n            status\n            errors {\n                key\n                message\n            }\n        }\n    }",setToldCookies:"mutation {\n        setCookies\n    }",getPhoneNumberLimits:"query getPhoneNumberLimits($phone: String!) \n    {\n        getPhoneLimits(phone: $phone) {\n            smsAllowed\n            callAllowed\n            registered\n            errors {\n              key\n              message\n              text\n            }\n        }\n    }",getAuthKey:"query {\n      getAuthKey\n    }"},f=async(e,t,n,a)=>{const r="CALL"===t?E.checkCallCode:E.checkSmsCode;let o=null;try{o=await s.Z.request({query:r,variables:{phone:e,code:n,role:a},endpoint:{endpoint:"root"}})}catch(e){i.Z.promiseHandler(_)(e)}return{accessToken:o?.jwt||null,refreshToken:o?.refreshToken||null,errors:o?.errors||null}},b=async(e,t=null)=>{const n="CALL"===t?E.checkPhoneByCallPublic:E.checkPhonePublic,a="CALL"===t?"v1":"v2";let r={};r="CALL"===t?{phone:e,captcha:""}:{phone:e,captcha:"",captchaScore:1};const o=await m.make();let l=null;try{l=await s.Z.request({query:n,variables:r,headers:{Csrf:o},endpoint:{endpoint:"root",ver:a}})}catch(e){i.Z.promiseHandler(e)}const c=l?.status||null,d=l?.errors||null,p={ok:!1,params:{step:"phone",code:"",mode:t,errorMap:{}}};return c?(p.params.step="code","CALL"===t?p.timerCall=!0:p.timerSms=!0):d?d.forEach((e=>{const{key:t,message:n}=e;p.params.errorMap.phone="phone"===t&&"error_required_missed"===n?"Введите номер телефона":"phone"===t&&"error_invalid_format"===n?"Неверный формат":"phone"===t&&"error_disallowed"===n?"Пользователь заблокирован или удален":"ip"===t&&"error_disallowed"===n?"Ваш IP заблокирован":n})):p.params.errorMap.phone="Ошибка сервера, попробуйте позже",p},y=(e={})=>{const t=e?.user?.id?e.user:null;return t&&(t.userBalance=e.userBalance),{user:t,groupPrivileges:e.groupPrivileges||{},viewedTooltips:e.viewedTooltips||{}}};class v{static getAuthInfo(e=!1,t=void 0,n,a){return e?Promise.resolve(y()):s.Z.request(E.getAuthInfo,{groupId:t},{endpoint:"user"},n,a).then((e=>y(e||{})))}static logout(e,t){return s.Z.request({query:E.logout,endpoint:{endpoint:"user"},req:e,res:t})}static loginByPhone(e){const{phone:t,mode:n,code:s,step:r}=e,i=o()(a.Z.getConfig(),"auth.role",null),l={ok:!1,params:{step:e.step||"",errorMap:{}}};return t?"code"===r?f(t,n,s,i).then((e=>{const{accessToken:t,refreshToken:n,errors:a}=e;if(null!==t)return l.ok=!0,g.ZP.saveJwtTokensToCookies(t,n),this.setToldCookies();a?a.forEach((e=>{const{key:t,message:n}=e;"phone"===t&&"error_required_missed"===n?(l.params.errorMap.phone="Введите номер телефона",l.params.step="phone"):"phone"===t&&"error_invalid_format"===n?(l.params.errorMap.phone="Неверный формат",l.params.step="phone"):"phone"===t&&"error_doesnt_match"===n?(l.params.errorMap.phone="Пользователь не найден",l.params.step="phone"):"phone"===t&&"error_disallowed"===n?(l.params.errorMap.phone="Пользователь заблокирован или удален",l.params.step="phone"):l.params.errorMap.code="code"===t&&"error_required_missed"===n?"Введите код":"code"===t&&"error_doesnt_match"===n?"Неверный код":"code"===t&&"error_exceed_limit"===n?"Превышено число неудачных попыток":n})):l.params.errorMap.code="Ошибка сервера, попробуйте позже"})).then((()=>l)):b(t,n):new Promise((e=>{l.params.errorMap.phone="Введите номер телефона",e(l)}))}static loginByEmail(e){const{email:t,password:n,remember:r}=e,l=o()(a.Z.getConfig(),"auth.role",null),c={ok:!1,params:{step:e.step||"",errorMap:{}}};return t&&n?(async e=>{let t=null;e.captcha="";try{t=await s.Z.request({query:E.login,variables:e,endpoint:{endpoint:"user"}})}catch(e){i.Z.promiseHandler(_)(e)}const n=t?.jwt||null,a=t?.refreshToken||null,r=t?.status||null,o=t?.errors||null;return g.ZP.saveJwtTokensToCookies(n,a),{accessToken:n,status:r,errors:o}})({email:t,password:n,remember:r?1:0,role:l}).then((e=>{const{status:t,errors:n}=e;return t?c.ok=!0:n?n.forEach((e=>{const{key:t,message:n}=e;"password"===t&&"error_doesnt_match"===n?c.params.errorMap.password="Неправильный пароль":"password"===t?c.params.errorMap.password="Введите пароль":"login"===t&&"error_doesnt_match"===n?c.params.errorMap.email="E-mail не зарегистрирован":"login"===t?c.params.errorMap.email="Введите e-mail":"redirectUrl"===t&&0===n.indexOf("http")&&(window.top.location.href=n)})):c.params.errorMap.email="Ошибка сервера, попробуйте позже",c})):new Promise((e=>{t||(c.params.errorMap.email="Введите e-mail"),n||(c.params.errorMap.password="Введите пароль"),e(c)}))}static async loginByKey(e,t){const{req:n,res:a}=t||{};let r=null;try{r=await s.Z.request(E.loginByKey,{key:e},{endpoint:"user",ver:"v2"},n,a)}catch(e){i.Z.promiseHandler(_)(e)}const o=r?.jwt||null,l=r?.refreshToken||null;g.ZP.saveJwtTokensToCookies(o,l,n,a);const c={ok:null!==o,jwt:o};return"undefined"!=typeof window&&(c.params={step:"",errorMap:{}},null===o&&(c.params.errorMap.login="authErrorCredentials")),c}static async loginByMailKey(e,t){const{req:n,res:a}=t||{};let r=null;try{r=await s.Z.request(E.loginByMailKey,{key:e},{endpoint:"user",ver:"v2"},n,a)}catch(e){i.Z.promiseHandler(_)(e)}const o=r?.jwt||null,l=r?.refreshToken||null;g.ZP.saveJwtTokensToCookies(o,l,n,a);return{ok:null!==o,jwt:o}}static async setAuthCookies(e,t,n={}){return g.ZP.saveJwtTokensToCookies(e,t),await this.setToldCookies(n),!0}static setToldCookies(e){return s.Z.rawRequest({query:E.setToldCookies,endpoint:{endpoint:"user"},...e})}static async registerByPhone(e){const{name:t,lastname:n,email:r,phone:l,mode:c,code:m,step:d}=e,p=o()(a.Z.getConfig(),"auth.role",null),u={ok:!1,params:{step:d||"",errorMap:{}}};if(!l)return u.params.errorMap.phone="Введите номер телефона",u.params.step="phone",u;if("personal"===d)try{if(!t)return u.params.errorMap.name="Введите имя",u;const e=await(async e=>{let t=null;e.captcha="";try{t=await s.Z.request({query:E.registerByPhone,variables:e,endpoint:{endpoint:"root"}})}catch(e){i.Z.promiseHandler(e)}return{accessToken:t?.jwt||null,refreshToken:t?.refreshToken||null,errors:t?.errors||null}})({name:t,lastname:n,email:r,phone:l,code:m,mode:c,role:p}),{accessToken:a,refreshToken:o,errors:d}=e;return a&&o?(await this.setAuthCookies(a,o),u.ok=!0,u):(d?d.forEach((e=>{const{key:t,message:n}=e;"name"===t&&"error_required_missed"===n?u.params.errorMap.name="Введите имя":"email"===t&&"error_uniqueness_violated_email"===n?u.params.errorMap.email="E-mail уже зарегистрирован":"email"===t&&"error_invalid_format_email"===n?u.params.errorMap.email="Неверный формат почты":"name"===t&&"error_invalid_format_name"===n?u.params.errorMap.name="Неверный формат имени":"phone"===t&&"error_required_missed"===n?(u.params.errorMap.phone="Введите номер телефона",u.params.step="phone"):"phone"===t&&"error_invalid_format"===n?(u.params.errorMap.phone="Неверный формат",u.params.step="phone"):"phone"===t&&"error_uniqueness_violated"===n?(u.params.errorMap.phone="Телефон уже зарегистрирован",u.params.step="phone"):"code"===t&&"error_required_missed"===n?(u.params.errorMap.code="Введите код",u.params.step="code"):"code"===t&&"error_doesnt_match"===n?(u.params.errorMap.code="Неверный код",u.params.step="code"):"code"===t&&"error_exceed_limit"===n?(u.params.errorMap.code="Превышено число неудачных попыток",u.params.step="code"):u.params.errorMap.name="Ошибка сервера, попробуйте позже"})):u.params.errorMap.name="Ошибка сервера, попробуйте позже",u)}catch(e){return u.params.errorMap.name="Ошибка сервера, попробуйте позже",u}if("code"===d)try{const e=await f(l,c,m,p),{accessToken:t,errors:n}=e;return null!==t?(u.params.errorMap.phone="Телефон уже зарегистрирован",u.params.step="phone",u):(n?n.forEach((e=>{const{key:t,message:n}=e;"phone"===t&&"error_doesnt_match"===n?u.params.step="personal":"phone"===t&&"error_required_missed"===n?(u.params.errorMap.phone="Введите номер телефона",u.params.step="phone"):"phone"===t&&"error_invalid_format"===n?(u.params.errorMap.phone="Неверный формат",u.params.step="phone"):"phone"===t&&"error_doesnt_match"===n?u.params.step="personal":"phone"===t&&"error_disallowed"===n?(u.params.errorMap.phone="Телефон уже зарегистрирован",u.params.step="phone"):u.params.errorMap.code="code"===t&&"error_required_missed"===n?"Введите код":"code"===t&&"error_doesnt_match"===n?"Неверный код":"code"===t&&"error_exceed_limit"===n?"Превышено число неудачных попыток":n})):u.params.errorMap.code="Ошибка сервера, попробуйте позже",u)}catch(e){return u.params.errorMap.code="Ошибка сервера, попробуйте позже",u}return b(l,c)}static registerByEmail(e){const{email:t,name:n,phone:r,mode:l,code:c,from:m,step:d}=e,p=o()(a.Z.getConfig(),"auth.role",null),u={ok:!1,params:{step:d||"",errorMap:{}}};if("code"===d)return(async e=>{let t=null;try{t=await s.Z.request({query:E.confirmPhoneForUser,variables:e,endpoint:{endpoint:"root"}})}catch(e){i.Z.promiseHandler(e)}const n=t?.jwt||null,a=t?.refreshToken||null;return g.ZP.saveJwtTokensToCookies(n,a),{accessToken:n,errors:t?.errors||null}})({phone:r,code:c,mode:l,role:p}).then((e=>{const{accessToken:t,errors:n}=e;if(null!==t)return u.ok=!0,this.setToldCookies();n?n.forEach((e=>{const{key:t,message:n}=e;"phone"===t&&"error_required_missed"===n?(u.params.errorMap.phone="Введите номер телефона",u.params.step="phone"):"phone"===t&&"error_invalid_format"===n?(u.params.errorMap.phone="Неверный формат",u.params.step="phone"):"phone"===t&&"error_uniqueness_violated"===n?(u.params.errorMap.phone="Телефон уже зарегистрирован",u.params.step="phone"):"userId"===t&&"error_required_missed"===n?(u.params.errorMap.phone="Пользователь не указан",u.params.step="phone"):"userId"===t&&"error_doesnt_match"===n?(u.params.errorMap.phone="Пользователь не найден",u.params.step="phone"):u.params.errorMap.code="code"===t&&"error_required_missed"===n?"Введите код":"code"===t&&"error_doesnt_match"===n?"Неверный код":"code"===t&&"error_exceed_limit"===n?"Превышено число неудачных попыток":n})):u.params.errorMap.code="Ошибка сервера, попробуйте позже"})).then((()=>u));if("phone"===d)return b(r,l);const h={name:n,email:t,agreement:1,privacy:1,from:m,role:p};return t&&n?(h.captcha="",s.Z.request({query:E.registerUser,variables:h,endpoint:{endpoint:"user"}}).then((e=>{const t=e?.jwt||null,n=e?.refreshToken||null,a=e?.status||null,s=e?.errors||null;return g.ZP.saveJwtTokensToCookies(t,n),a?u.params.step="email":s?s.forEach((e=>{const{key:t,message:n}=e;"email"===t&&"error_uniqueness_violated_email"===n?u.params.errorMap.email="E-mail уже зарегистрирован":"email"===t&&"error_required_missed"===n?u.params.errorMap.email="Неверный формат почты":"name"===t&&"error_invalid_format_name"===n?u.params.errorMap.name="Неверный формат имени":u.params.errorMap.email=n})):u.params.errorMap.email="Ошибка сервера, попробуйте позже",u}))):new Promise((e=>{t||(u.params.errorMap.email="Введите e-mail"),n||(u.params.errorMap.name="Введите имя"),e(u)}))}static restorePasswordByEmail(e){const{email:t}=e,n={ok:!1,params:{step:"",errorMap:{}}};return t?s.Z.request({query:E.restorePassword,variables:{email:t},endpoint:{endpoint:"user"}}).then((e=>{const t=e?.status||null,a=e?.errors||null;return t?n.params.step="email":a?a.forEach((e=>{const{key:t,message:a}=e;n.params.errorMap.email="email"===t&&"error_doesnt_match"===a?"E-mail не зарегистрирован":a})):n.params.errorMap.email="Ошибка сервера, попробуйте позже",n})):new Promise((e=>{n.params.errorMap.email="Введите e-mail",e(n)}))}static async getJwtTokenFromApiByHttpCookie(){let e=null,t=null;try{if(!h.Z.isDomesticDomain())return null;let n=await fetch("/gqapi/auth/v1",{method:"POST",cache:"no-cache",mode:"cors",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({query:E.getTokenByCookie})});return n=await n.json(),e=n?.data?.getTokenByCookie?.token,t=n?.data?.getTokenByCookie?.refreshToken,e&&t?{accessToken:e,refreshToken:t}:null}catch(e){return i.Z.promiseHandler(_)(e),null}}static async getJwtTokenFromApiByTold(e){let t=await fetch("https://mirtesen.ru/gqapi/auth/get-access-token",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:`told=${e}&refresh=1`});return t=await t.json(),t?.accessToken&&t?.refreshToken?t:null}static async getJwtTokenFromApiByRefresh(e){let t=await fetch("https://mirtesen.ru/gqapi/auth/get-access-token",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:`refreshToken=${e}`});return t=await t.json(),t?.accessToken&&t?.refreshToken?t:null}static getPhoneLimits=async e=>{const t={smsAllowed:!0,callAllowed:!0,smsTimeLimitExceededMsg:"",callTimeLimitExceededMsg:"",errors:null};if(!u.Z.validInternational(e))return t;try{const n=await v.checkPhoneLimits(e);p()(t,n),p()(t,v._getTimeLimitsMsgFromErrors(t.errors))}catch(e){i.Z.promiseHandler(_)(e)}return t};static async checkPhoneLimits(e){const t=await s.Z.request({query:E.getPhoneNumberLimits,variables:{phone:e},endpoint:{endpoint:"root"},dataKey:"getPhoneLimits"}),n=t?.smsAllowed||!0,a=t?.callAllowed||!0,r=t?.errors||null;return{registered:t?.registered,smsAllowed:n,callAllowed:a,errors:r}}static _getTimeLimitsMsgFromErrors=e=>{const t={smsTimeLimitExceededMsg:"",callTimeLimitExceededMsg:""};return e&&0!==e.length?(e.forEach((e=>{"sms_sent_limit_exceeded"===e.key&&(t.smsTimeLimitExceededMsg=e.message||""),"call_sent_limit_exceeded"===e.key&&(t.callTimeLimitExceededMsg=e.message||"")})),t):t};static async fetchMirtesenKey(e,t){return await s.Z.request(E.getAuthKey,null,{endpoint:"user",ver:"v1"},e,t)}static savePhoneWithConfirm=e=>b(e,"SMS");static confirmPhone=async(e,t,n={})=>{try{return await s.Z.request({query:`mutation {\n                  confirmPhone(phone: "${e}", code: "${t}"){\n                     status\n                     errors {\n                        key\n                        message\n                     }\n                  }\n                }`,endpoint:{endpoint:"user",ver:"v2"},req:n.req,res:n.res})}catch(e){i.Z.promiseHandler(_)(e)}}}const T=v},93669:(e,t,n)=>{"use strict";var a="/index.js";n.d(t,{Z:()=>y});n(71022),n(21943);var s=n(30381),r=n.n(s),o=n(56082),i=n(47029),l=n(12684),c=n(99871),m=n(89835),d=n(81827),p=n(84564),u=n.n(p),g=n(40680),h=n(78861);
/**
 * Mirtesen.
 *
 * API interface for BlogPost.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const _=`\n    text\n    topic\n    tags    \n    ${g.r_}\n        attachments {\n        ... on AttachmentPhoto{\n            photo {\n                id\n                photo_original\n                title\n                width\n                height\n            }\n        }\n        ... on AttachmentVideo {\n            video {\n              id\n              pandaVideoId\n              title\n              player_html\n              player_data\n              caption\n              url\n            }\n        }\n    }\n`,E=`\n    preview_text\n    comments_count\n    post_type\n    likes {\n        count\n        user_likes\n        can_like\n        marks_pluses\n        marks_minuses\n        user_like_attr\n        like_attr_ids {\n            id\n            count\n        }\n    }\n    from_id\n    from {\n        id\n        display_name\n        url\n        photo_original  \n        isAuthenticAccount      \n    }\n    ${g.r_}\n    attachments {\n        ... on AttachmentPhoto{\n            photo {\n                id\n                photo_original\n                title\n                width\n                height\n            }\n        }\n        ... on AttachmentVideo {\n            video {\n              id\n              pandaVideoId\n              title\n              player_html\n              player_data\n              caption\n              url\n            }\n        }\n    }\n`,f={postsByIds:"query postsByIds(\n        $siteId: Float,\n        $ids: [Float]!\n    ) {\n        postsByIds(\n            siteId: $siteId,\n            ids: $ids,\n            need_likes: true,\n            extended: true\n        ) {\n            items {\n                ###fields###\n            }\n        }\n    }",sitePopularBlogPosts:"query sitePopularBlogPosts(\n        $siteId: Float!,\n        $period: period,\n        $count: Float\n    ) {\n        sitePopularBlogPosts(\n            site_id: $siteId,\n            period: $period,\n            count: $count\n        ) {\n            items {\n                ###fields###\n            }\n        }\n    }",addBlogPost:"mutation addBlogPost(\n        $siteId: Float!,\n        $title: String!,\n        $text: String!,\n        $tags: [String],\n        $photoIds: [Float],\n        $publishTime: String,\n        $referenceUrl: String,\n        $disableComments: Boolean,\n        $draft: Boolean,\n        $pollId: Float,\n        $extraData: String\n    ) {\n        addBlogPost(\n            siteId: $siteId,\n            title: $title,\n            text: $text,\n            tags: $tags,\n            photoIds: $photoIds,\n            publish_time: $publishTime,\n            reference_url: $referenceUrl,\n            close_comments: $disableComments,\n            draft: $draft,\n            foreignPollId: $pollId,\n            extraData: $extraData\n        ) {\n            id\n            errors {\n              key\n              message\n              text\n            }\n        }\n    }",editBlogPost:"mutation editBlogPost(\n        $blogPostId: Float!,\n        $title: String!,\n        $text: String!,\n        $tags: [String],\n        $photoIds: [Float],\n        $publishTime: String,\n        $referenceUrl: String,\n        $disableComments: Boolean,\n        $draft: Boolean,\n        $extraData: String\n    ) {\n        editBlogPost(\n            blogId: $blogPostId,\n            title: $title,\n            text: $text,\n            tags: $tags,\n            photoIds: $photoIds,\n            publish_time: $publishTime,\n            reference_url: $referenceUrl,\n            close_comments: $disableComments,\n            draft: $draft,\n            extraData: $extraData\n        )\n    }",deleteBlogPost:"mutation deleteBlogPost(\n        $postId: Float!\n    ) {\n        deleteBlogPost(\n            blogId: $postId\n        )\n    }",approveBlogPost:"mutation approveBlogPost(\n        $postId: Float!\n    ) {\n        approveBlogPost(\n            blogId: $postId\n        )\n    }",blogPostsList:"query blogPostsList(\n        $siteId: Float!,\n        $offset: Float,\n        $count: Float,\n        $tag: String,\n        $sort: sort,\n        $status: [status],\n        $period: period_blog_post_list,\n        $before: Float,\n        $after: Float,\n        $userId: Float\n    ) {\n        blogPostsList(\n            owner_id: $siteId, \n            need_likes: true, \n            extended: true, \n            offset: $offset, \n            count: $count,\n            tag: $tag, \n            sort: $sort,\n            status: $status,\n            period: $period,\n            before: $before,\n            after: $after,\n            user_id: $userId\n        ) {\n            items {\n                ###fields###\n            }\n        }\n    }",blogPostNeighbors:"query blogPostNeighbors(\n        $postId: Float!,\n        $direction: direction\n    ) {\n        blogPostNeighbors(\n            id: $postId,\n            direction: $direction\n        ) {\n            next\n            previous\n        }\n    }",editorStatus:"mutation editorStatus(\n        $postId: Float!,\n        $status: editorStatus!\n    ) {\n        editorStatus(\n            blogPostId: $postId,\n            status: $status\n        )\n    }",postsByStringIds:"query postsByStringIds(\n        $siteId: Float,\n        $ids: [String]!\n    ) {\n        postsByStringIds(\n            siteId: $siteId,\n            ids: $ids,\n            need_likes: true,\n            extended: true\n        ) {\n            items {\n                ###fields###\n            }\n        }\n    }",repost:"mutation repost(\n        $postId: Float!,\n        $message: String,\n        $visibilityKey: Int\n    ) {\n        repost(\n            postId: $postId,\n            text: $message,\n            visible: $visibilityKey\n        )\n    }",restoreBlogPost:"mutation restoreBlogPost(\n        $postId: Float!\n    ) {\n        restoreBlogPost(\n            blogId: $postId\n        )\n    }",searchTags:"query searchTags(\n        $text: String\n    ) {\n        searchTags(query: $text) {\n            items {\n                id\n                name\n            }\n        }\n    }"};class b extends h.ZP{static blogPostPartnerFields="\n        partner {\n            id\n            buttonCTA\n            commentsEnabled\n            countersEnabled\n            likesEnabled\n            showAuthor\n            shareEnabled\n            rotationStart\n            showGroupTitle\n            slotNumber\n            topic\n            yandexMetricaCounterId\n            showInSingleWindow\n        }\n    ";static errorsMap={emptyTitle:"Заголовок не может быть пустым",emptyText:"Текст не может быть пустым"};static _visibility=["VISLVL_ANY","VISLVL_FRIEND","VISLVL_NONE"];static _directions={prev:"PREVIOUS",next:"NEXT"};static listOfPeriods={PERIOD_DAY:{title:"Сутки",short:"day"},PERIOD_WEEK:{title:"Неделя",short:"week"},PERIOD_MONTH:{title:"Месяц",short:"month"},PERIOD_YEAR:{title:"Год",short:"year"},no_val1:{title:"За все время",short:"all"},no_val2:{title:"Период",short:"period"}};static publishDates={now:{ru:"Прямо сейчас",date:null},"after 2 hours":{ru:"Через пару часов",date:`"${r()().add(2,"h").format("DD.MM.YYYY HH:mm:00")}"`},"after 3 hours":{ru:"Через 4 часа",date:`"${r()().add(4,"h").format("DD.MM.YYYY HH:mm:00")}"`},"after 6 hours":{ru:"Через 6 часов",date:`"${r()().add(6,"h").format("DD.MM.YYYY HH:mm:00")}"`},tomorrow:{ru:"Завтра",date:`"${r()().add(1,"d").format("DD.MM.YYYY HH:mm:00")}"`},"day after tomorrow":{ru:"Послезавтра",date:`"${r()().add(2,"d").format("DD.MM.YYYY HH:mm:00")}"`},"after 3 days":{ru:"Через 3 дня",date:`"${r()().add(3,"d").format("DD.MM.YYYY HH:mm:00")}"`},"after 4 days":{ru:"Через 4 дня",date:`"${r()().add(4,"d").format("DD.MM.YYYY HH:mm:00")}"`},"after 5 days":{ru:"Через 5 дней",date:`"${r()().add(5,"d").format("DD.MM.YYYY HH:mm:00")}"`},"after 6 days":{ru:"Через 6 дней",date:`"${r()().add(6,"d").format("DD.MM.YYYY HH:mm:00")}"`},"after 7 days":{ru:"Через неделю",date:`"${r()().add(7,"d").format("DD.MM.YYYY HH:mm:00")}"`},custom:{ru:"В указанное время"}};static getBlogPostById=async(e,t={})=>{const n=await this.getBlogPostListById(e,t);return Array.isArray(n)&&n.length>0?n[0]:Promise.resolve(null)};static getBlogPostListById=(e,t={})=>{const{siteId:n}=t,s=this._getRequestFields(t),r=f.postsByIds.replace("###fields###",s);"string"==typeof e&&(e=e.split(","));const c=e.map((e=>e.trim())),m={project:"blog",body:JSON.stringify({variables:{...n&&{siteId:n},ids:c},query:r}),jwt:!0};return(0,o.Z)({...t,...m}).then((e=>{const t=e?.data?.postsByIds?.items||[];return this.normalizePostList(t)})).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};static getSitePopularBlogPosts=(e,t="PERIOD_WEEK",n=3,s)=>{const r=f.sitePopularBlogPosts.replace("###fields###",this._getRequestFields(s)),c={project:"blog",body:JSON.stringify({variables:{siteId:e,period:t,count:n},query:r}),jwt:!0};return(0,o.Z)({...s,...c}).then((e=>{const t=e.data?.sitePopularBlogPosts?.items;return this.normalizePostList(t)})).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};static getBlogPostList=e=>{const t={latest:null,commented:"commented",interesting:"rating",own:null};(e={offset:0,count:12,tag:null,sort:null,userId:null,status:null,...e}).tag=e.tag?e.tag.toLowerCase():null,e.sort=t[e.sort]?t[e.sort]:null,e.period=e.period&&!e.period.includes("no_val")?e.period:null,e.before=e.before&&r()(e.before).unix()||null,e.after=e.after&&r()(e.after).unix()||null,e.status=e.status||null;const n=f.blogPostsList.replace("###fields###",b._getRequestFields(e)),s={project:"blog",body:JSON.stringify({variables:{siteId:-parseFloat(e.siteId),offset:e.offset,count:e.count,tag:e.tag,sort:e.sort,status:e.status,period:e.period,before:e.before,after:e.after,userId:e.userId},query:n}),jwt:!0};return(0,o.Z)({...e,...s}).then((e=>{const t=e.data.blogPostsList.items;return this.normalizePostList(t)})).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};add=(e,t)=>{const{publishTime:n,disableComments:s,draft:r,pollId:c,tags:m,title:d,text:p,referenceUrl:u,photoIds:g=null,extraData:h={}}=t,_={project:"blog",body:JSON.stringify({variables:{siteId:e,title:d,text:p,tags:m,publishTime:n,referenceUrl:u,disableComments:s,draft:r,pollId:c,photoIds:g,extraData:JSON.stringify(h)},query:f.addBlogPost})};return(0,o.Z)(_).then((e=>e)).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};edit=(e,t)=>{const{publishTime:n,disableComments:s,draft:r,tags:c,title:m,text:d,referenceUrl:p,photoIds:u=null,extraData:g={}}=t,h={project:"blog",body:JSON.stringify({variables:{blogPostId:e,title:m,text:d,tags:c,publishTime:n,referenceUrl:p,disableComments:s,draft:r,photoIds:u,extraData:JSON.stringify(g)},query:f.editBlogPost})};return(0,o.Z)(h).then((e=>e)).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};searchTags=e=>{const t={project:"blog",body:JSON.stringify({variables:{text:e},query:f.searchTags}),jwt:!0};return(0,o.Z)(t).then((e=>e.data.searchTags.items)).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};deleteById=(e,t)=>{const n={project:"blog",body:JSON.stringify({variables:{postId:e},query:f.deleteBlogPost})};return(0,o.Z)({...t,...n}).then((e=>e.data.deleteBlogPost)).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};approveById=e=>{const t={project:"blog",body:JSON.stringify({variables:{postId:e},query:f.approveBlogPost})};return(0,o.Z)(t).then((e=>e.data.approveBlogPost)).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};restoreById=e=>{const t={project:"blog",body:JSON.stringify({variables:{postId:e},query:f.restoreBlogPost})};return(0,o.Z)(t).then((e=>e.data.restoreBlogPost)).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};getNeighborsId=(e,t,n)=>{const s={project:"blog",body:JSON.stringify({variables:{postId:e,direction:t},query:f.blogPostNeighbors}),jwt:!0};return(0,o.Z)({...n,...s}).then((e=>e.data.blogPostNeighbors)).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};blogPostRepost=(e,t,n)=>{const s={project:"blog",body:JSON.stringify({variables:{postId:e,message:t,visibilityKey:n},query:f.repost})};return(0,o.Z)(s).then((e=>e.data.repost)).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};setEditorStatus=(e,t)=>(0,o.Z)({project:"blog",body:JSON.stringify({variables:{postId:e,status:t},query:f.editorStatus})}).then((e=>{if(e.data&&e.data.editorStatus)return e.data.editorStatus})).catch((e=>{l.Z.promiseHandler(a)(e)}));static getReposters=(e,t=0,n=10,s={})=>{const r={project:"main",body:JSON.stringify({query:`query \n            {\n              getReposters(\n                objId:${e},\n                offset: ${t},\n                limit: ${n}\n              ) {\n                id\n                display_name\n                url\n                photo_original\n              }\n            }`}),jwt:!0};return(0,o.Z)({...s,...r}).then((e=>{if(e.errors)throw new Error(e.errors[0].message);return e?.data?.getReposters||[]})).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;l.Z.promiseHandler(a)(e)}))};static getById=(e,t={})=>{const{siteId:n}=t,s=f.postsByIds.replace("###fields###",b._getRequestFields(t)),r=Array.isArray(e),c={project:"blog",body:JSON.stringify({variables:{...n&&{siteId:n},ids:r?e:[e]},query:s}),jwt:!0};return(0,o.Z)({...t,...c}).then((e=>{const t=e?.data?.postsByIds?.items;if(!Array.isArray(t))throw new Error("blogPostsList is not an array");const n=this.normalizePostList(t);return r?n:n[0]})).catch((e=>{if(i.Z.isClientNetworkError(e))throw e;return l.Z.promiseHandler(a)(e),[]}))};static _getRequestFields=(e={})=>{const{fieldList:t="full"}=e;let{extraFields:n}=e;Array.isArray(n)&&(n=n.join("\n"));let a="";return["essential","list","full","tile"].includes(t)&&(a+="\n    id\n    title\n    url\n    seo_url\n    canonical_url\n    created\n    date\n    publish_time\n    status\n    isTitleHidden\n"),["v3Tile","v3Text"].includes(t)&&(a+="\n    id\n    title\n    url\n    seo_url\n    canonical_url\n    created\n    date\n"),["tile","v3Tile","list","full"].includes(t)&&(a+=E),["v3Text"].includes(t)&&(a+=_),["list","full"].includes(t)&&(a+="\n    modified\n    is_draft\n    is_queued\n    post_type\n    topic\n    tags    \n    close_comments\n    marks_count\n    reposts\n    recommendations\n    foreignPollId\n    isSlider\n    padRedirectUrl\n    editorStatus\n    extraData\n    notificationsCanBeSent\n    notificationsSent\n    notificationsWillBeSent\n    notificationsLimit\n    fame_actions_positive_count\n    fame_actions_negative_count\n    fame_actions {\n        user_id\n        user_name\n        user_avatar\n        message\n        is_positive\n        title\n        type\n    }\n"),["full"].includes(t)&&(a+="\n    text\n    formattedText\n    reference_url\n    reference_url_original\n"),n&&(a+=n),a};static async getSmi2Data(e){return await m.Z.getInfo("smi2Post",e)}static getDisputePageUrl(e,t="https",n="mirtesen.ru"){const a=c.Z.fixProtocol(e.seo_url||e.url).replace(/\?.+/,"");let s=new(u())(a).pathname.match(/blog\/\d+(\/[^\/?&]+)?/);return s?(s=s[1]||"",t+"://"+n+"/dispute/"+e.id+s):e.seo_url||e.url}static formPostCommentsUrl=e=>{const t=e.id;return e.smi2_id?`https://chat.mirtesen.ru/messenger/exp/?id=${e.smi2_id}&type=smi2`:"user_post"===e.post_type||"user_post_rich"===e.post_type?d.Z.addParameterToUrl(e.seo_url||e.url,"id",`comment-reply${t}`):d.Z.addParameterToUrl(b.getDisputePageUrl(e),"id",`comment-reply${t}`)}}const y=b},81773:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var a=n(41750);
/**
 * Mirtesen.
 *
 * Color helper.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class s{static gradients=[["#F2B3AB","#EF6C22"],["#A89CF1","#5374E8"],["#F19CE9","#E85377"],["#66EAEA","#50C1DA"]];static getHSLGradientByDegrees(e,t=100,n=50,{addendH:a=30,addendS:s=-20,addendL:r=0}={}){return`linear-gradient(hsl(${e}, ${t}%, ${n}%), hsl(${e+a}, ${t+s}%, ${n+r}%))`}static getHSLTextColorByDegrees(e,t=70,n=50,a=15){return`hsl(${e+a}, ${t}%, ${n}%)`}static getHSLDegreesByName=e=>{const t=s._getAlpabet(),n=360/t.length,a=e?e.trim()[0]:"";return s._getDegreesOfColorPosition(t,a,n)};static _getAlpabet(e=""){return[..."abcdefghijklmnopqrstuvwxyz".split(""),..."абвгдеёжзийклмнопрстуфхцчшщъьыэюя".split(""),...e.split("")]}static _getDegreesOfColorPosition(e,t="",n){const a=e.join("").toUpperCase().split(""),s=t?t.toUpperCase():"",r=a.indexOf(s);return"-1"!==r?Math.abs(Math.round(r*n)):Math.round(a.length/2)}static getHSLGradientByName=a.Z.compose(s.getHSLGradientByDegrees,s.getHSLDegreesByName);static getHslColorByName=a.Z.compose(s.getHSLTextColorByDegrees,s.getHSLDegreesByName);static _stringHashCode=e=>{let t=0;if(e)for(let n=0,a=e.length;n<a;n++)t=e.charCodeAt(n)+((t<<5)-t),t|=0;return t};static stringToColor=(e,t=!1)=>{const n=Math.abs(s._stringHashCode(e))%s.gradients.length,a=s.gradients[n];return t?a[1]:`linear-gradient(180deg, ${a[0]} 0%, ${a[1]} 100%)`}}const r=s},35860:(e,t,n)=>{"use strict";var a="/index.js";n.d(t,{Z:()=>h});n(71022),n(21943),n(93811),n(5645),n(17312);var s=n(30381),r=n.n(s),o=n(27361),i=n.n(o),l=n(56082),c=n(12684),m=n(47029),d=n(40680),p=n(41750);
/**
 * Mirtesen.
 *
 * API interface for Comments.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const u={comments:"query comments(\n        $resourceId: Float!,\n        $sectionId: Float!,\n        $discussionId: Float,\n        $discussionStringId: String,\n        $offset: Int,\n        $count: Int,\n        $sort: sort,\n        $startCommentId: Float\n    ) {\n        comments (\n            resource_id: $resourceId,\n            section_id: $sectionId,\n            discussion_id: $discussionId,\n            discussion_string_id: $discussionStringId,\n            offset: $offset,\n            count: $count,\n            start_comment_id: $startCommentId,\n            sort: $sort\n        ) {\n            total\n            discussion_id\n            max_comment_len\n            subscribe_status\n            real_offset\n            can_comment\n            can_comment_reasons\n            is_reposted\n            can_ban_members\n            items {\n                text\n                level\n                id\n                date\n                can_delete\n                show_raw\n                fame_actions {\n                    date\n                    user_id\n                    user_name\n                    user_avatar\n                    message\n                    type\n                    is_positive\n                    title\n                }\n                fame_actions_positive_count\n                fame_actions_negative_count\n                reply_to_user {\n                    id\n                    display_name\n                    photo_original\n                    count_friends\n                    cover\n                }\n                reply_to_comment\n                is_spam_suspiction\n                likes {\n                    count\n                    user_likes\n                    can_like\n                    marks_pluses\n                    marks_minuses\n                }\n                marks_count\n                attachments {\n                    ... on AttachmentPhoto{\n                        photo {\n                            id\n                            photo_original\n                        }\n                    }\n                }\n                user {\n                    display_name\n                    photo_original\n                    id\n                    photo_original\n                    cover\n                    count_friends\n                }\n            }\n        }\n    }",addComment:"mutation addComment(\n        $resourceId: Float!,\n        $sectionId: Float!,\n        $discussionId: Float,\n        $discussionStringId: String,\n        $message: String!,\n        $replyCommentId: Float,\n        $attachId: Float,\n        $repost: Boolean\n    ) {\n        addComment(\n            resource_id: $resourceId,\n            message: $message,\n            section_id: $sectionId,\n            discussion_id: $discussionId,\n            discussion_string_id: $discussionStringId,\n            photo_id: $attachId,\n            reply_to_comment: $replyCommentId,\n            public_comment: $repost\n        ){\n            text\n            level\n            id\n            date\n            reply_to_user {\n                id,\n                display_name\n                count_friends\n                cover\n            },\n            reply_to_comment\n            attachments {\n                ... on AttachmentPhoto{\n                    photo {\n                        id\n                        photo_original\n                    }\n                }\n           }\n           user {\n               display_name,\n               photo_original,\n               id,\n               photo_original,\n               cover,\n               count_friends\n           }\n        }\n    }"};class g{static deleteComment(e,t,n,s){const r={project:"comments",body:JSON.stringify({query:`mutation {\n                    deleteComment(\n                        resource_id: ${e},\n                        section_id: ${t},\n                        discussion_id: ${n},\n                        comment_id: ${s}\n                    )\n                }`})};return(0,l.Z)(r).then((e=>e.data.deleteComment)).catch(c.Z.promiseHandler(a))}static getLastBlogComments({siteId:e,count:t=5,fromMessageId:n=null,...s}){const r={project:"comments",body:JSON.stringify({query:`{\n                  siteLastCommentsAsMessages(\n                      siteId: ${e},\n                      count: ${t},\n                      fromMessageId: ${n}\n                    ) {\n                    items {\n                      id\n                      text\n                      date\n                      blog_post {\n                        id\n                        title\n                        seo_url\n                      }\n                      user {\n                        cover\n                        count_friends\n                        id\n                        url\n                        display_name\n                        photo_original\n                      }\n                    }\n                  }\n                }`})};return(0,l.Z)({...s,...r}).then((e=>{const t=i()(e,"data.siteLastCommentsAsMessages.items")||[];return t.items=g._normalizeComments(t),t})).catch(c.Z.promiseHandler(a))}static getMessagesAsPersonComments(e,t=5,n=null,s={}){const r={project:"comments",body:JSON.stringify({query:`{\n                    userLastCommentsAsMessages(\n                          userId: ${e},\n                          count: ${t},\n                          fromMessageId: ${n}\n                        ) {\n                        items {\n                            id\n                            text\n                            date\n                            post_type\n                            blog_post {\n                                id\n                                title\n                                seo_url\n                                url\n                                date\n                                post_type\n                                preview_text\n                                ${d.r_}\n                                from {\n                                    id\n                                    url\n                                    display_name\n                                    photo_original\n                                    isAuthenticAccount\n                                }\n                            }\n                            user {\n                                id\n                                url\n                                display_name\n                                photo_original\n                            }\n                            reply_to_user {\n                                id\n                                url\n                                display_name\n                                photo_original\n                            }\n                        }\n                    }\n                }`})};return(0,l.Z)({...s,...r}).then((e=>{const t=i()(e,"data.userLastCommentsAsMessages");return t.lastId=t?.items[t.items.length-1]?.id,t.items=g._normalizeComments(t?.items||[]),t})).catch(c.Z.promiseHandler(a))}static getCommentsByPostId(e,t={}){const{resourceId:n,sectionId:a,discussionId:s,discussionStringId:r,offset:o,count:c,startCommentId:m,sort:d}=e,p={project:"comments",body:JSON.stringify({variables:{resourceId:n,sectionId:a,discussionId:s,discussionStringId:r,offset:o,count:c,startCommentId:m,sort:d},query:u.comments}),jwt:!0};return(0,l.Z)({...t,...p}).then((e=>{const t=i()(e,"data.comments")||{};return t.items=g._normalizeComments(i()(t,"items",[])),t})).catch((e=>{console.log(e)}))}static restoreComment(e){const t={project:"comments",body:JSON.stringify({query:`mutation {\n                    restoreComment(comment_id: ${e})\n                }`})};return(0,l.Z)(t).then((e=>{if(e.data)return e.data.restoreComment})).catch(c.Z.promiseHandler(a))}static _normalizeComments(e){return e.filter((e=>{const t=i()(e,"blog_post",null);return!("blog_post"===e.post_type&&!t)})).map((e=>{e.images=[];const t=i()(e,"blog_post.date"),{date:n}=e;return Array.isArray(e.attachments)&&e.attachments.map((t=>{"object"==typeof t.photo&&e.images.push({main:!0,url:t.photo.photo_original,width:t.photo.width,height:t.photo.height})})),n&&(e.formattedDates=p.Z.setformattedDates(n)),t&&(e.blog_post.formattedDates=p.Z.setformattedDates(t)),e}))}static getSiteCommentsStats(e,t,n={}){const s=JSON.stringify(t.periodFrom||r()().subtract(7,"d").format("YYYY-MM-DD")),o=JSON.stringify(t.periodTo||r()().format("YYYY-MM-DD")),i={project:"blog",body:JSON.stringify({query:`query\n                {\n                  getSiteCommentsStats(\n                    siteId: ${e}\n                    startDate: ${s}\n                    endDate: ${o}\n                  )\n                }`})};return(0,l.Z)({...n,...i}).then((e=>JSON.parse(e.data.getSiteCommentsStats).tableData)).catch((e=>(c.Z.promiseHandler(a)(e),null)))}static getSiteStopWordsSettings(e,t,n={}){const s={project:"blog",body:JSON.stringify({query:`query\n                {\n                  getSiteStopWordsSettings(siteId: ${e}) {\n                      commonEnabled\n                      siteEnabled\n                      applyForCommentsEnabled\n                   }\n                }`})};return(0,l.Z)({...n,...s}).then((e=>e.data.getSiteStopWordsSettings)).catch(c.Z.promiseHandler(a))}static addSiteCommentsStopWord(e,t,n={}){const s={project:"blog",body:JSON.stringify({query:`mutation\n                {\n                  addSiteStopWord(\n                    id: ${e},\n                    text: "${t}"\n                  ){\n                    id\n                    text\n                  }\n                }`})};return(0,l.Z)({...n,...s}).then((e=>e.data.addSiteStopWord)).catch(c.Z.promiseHandler(a))}static removeSiteCommentsStopWord(e,t,n={}){const s={project:"blog",body:JSON.stringify({query:`mutation\n                {\n                  removeSiteStopWord(\n                    siteId: ${e},\n                    stopWordId: ${t}\n                  )\n                }`})};return(0,l.Z)({...n,...s}).then((e=>e.data.removeSiteCommentsStopWord)).catch(c.Z.promiseHandler(a))}static getSiteStopWords(e,t={}){const n={project:"blog",body:JSON.stringify({query:`query\n                {\n                  getSiteStopWords(id: ${e}) {\n                    items {\n                      id\n                      text\n                    }\n                  }\n                }`})};return(0,l.Z)({...t,...n}).then((e=>i()(e,"data.getSiteStopWords.items")||[])).catch(c.Z.promiseHandler(a))}static setSiteCommentsStopWordsSettings(e,t,n,s){const r={project:"blog",body:JSON.stringify({query:`mutation\n                {\n                  setSiteStopWordsSettings(\n                    siteId: ${e},\n                    commonEnabled: ${t},\n                    siteEnabled: ${n},\n                    applyForCommentsEnabled: ${s}\n                    ) {\n                        commonEnabled\n                        siteEnabled\n                        applyForCommentsEnabled\n                    }\n                }`})};return(0,l.Z)({...r}).then((e=>e?.data?.setSiteStopWordsSettings)).catch(c.Z.promiseHandler(a))}static getCommentators=(e,t=0,n=10,s={})=>{const r={project:"main",body:JSON.stringify({query:`query \n            {\n              getCommentators(\n                objId:${e},\n                offset: ${t},\n                limit: ${n}\n              ) {\n                id\n                display_name\n                url\n                photo_original\n              }\n            }`}),jwt:!0};return(0,l.Z)({...s,...r}).then((e=>{if(e.errors)throw new Error(e.errors[0].message);return e?.data?.getCommentators||[]})).catch((e=>{if(m.Z.isClientNetworkError(e))throw e;c.Z.promiseHandler(a)(e)}))};static addComment(e){const{resourceId:t,message:n,sectionId:a,discussionId:s,discussionStringId:r,attachId:o,replyCommentId:i,repost:c}=e;return(0,l.Z)({project:"comments",body:JSON.stringify({variables:{resourceId:t,message:n,sectionId:a,discussionId:s,discussionStringId:r,attachId:o,replyCommentId:i,repost:c},query:u.addComment}),jwt:!0}).then((e=>{if(e.data)return e.data.addComment})).catch((e=>{console.log(e)}))}}const h=g},65121:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});n(65994),n(5645),n(37487);var a=n(54462);
/**
 * Mirtesen.
 *
 * Elasticsearch Api.
 *
 * directly import this modules from v2-modules like this
 * import Elastic from 'v2-modules/lib/common/classes/Elastic';
 *
 * @author       Alexey Duybo.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const{Client:s}=n(Object(function(){var e=new Error("Cannot find module '@elastic/elasticsearch'");throw e.code="MODULE_NOT_FOUND",e}()));let r=null;class o{static connect(e=null){const t=a.Z.getConfig(),n=t&&t.elasticEndpoint;try{r=new s({node:e||n,maxRetries:1,requestTimeout:500,pingTimeout:500})}catch(e){console.log("unknown elastic adress")}}static getClient(){return r}static isConnected(){return!!o.getClient()}static createIndex({index:e,id:t,body:n}){const a=o.getClient();return a?e&&n?a.index({id:t,index:e,body:n}):Promise.reject(new Error("invalid parameters")):Promise.reject(new Error("empty elastic client"))}static createIndices({indices:e}){const t=o.getClient();if(!t)return Promise.reject(new Error("empty elastic client"));if(!e||0===e.length)return Promise.reject(new Error("invalid parameters"));const n=e.flatMap((({index:e,id:t,body:n})=>[{index:{_index:e,_id:t}},n]));return t.bulk({body:n})}}const i=o},23729:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var a=n(54462);
/**
 * Mirtesen.
 *
 * Elastic error logger.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */let s=null;"undefined"==typeof window&&(s=n(65121));const r=class{static logError(e){"development"!==a.Z.getConfig()?.mode?"undefined"!=typeof window?this.logClientError(e):this.logServerError(e):console.log(e)}static logClientError({message:e,place:t,type:n}){if("undefined"==typeof window)return;const{app:s,auth:r}=a.Z.getStore().getState(),{originalUrl:o,host:i,protocol:l}=s?.req||{};fetch("https://elk-profiler.mtml.ru:443",{method:"PUT","Content-Type":"application/json;charset=utf-8",body:JSON.stringify({reason:e,place:t,currentUrl:window.location?.href,requestUrl:l+"://"+i+o,headers:s?.req?.headers,userId:r?.user?.id||null,cookie:s?.req?.headers?.cookie,type:n})}).catch((()=>{}))}static logServerError({userId:e,errorMessage:t,uri:n,page:a,userAgent:r,time:o,source:i}){"undefined"==typeof window&&s?.default?.createIndex({index:"server_errors",body:{userId:e,errorMessage:t,uri:n,page:a,userAgent:r,time:o,source:i}}).catch((()=>{}))}}},12684:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var a=n(23729),s=n(47029);const r=class{static promiseHandler(e){return t=>{console.error?.(t),"undefined"==typeof window||s.Z.isClientNetworkError(t)||a.Z.logClientError({message:t.toString?.(),place:e,type:"warning"})}}}},56082:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var a=n(72239),s=n.n(a),r=n(54462),o=n(47029),i=n(64962),l=n(33130),c=n(36554);
/**
 * Mirtesen.
 *
 * GraphQL helper.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
let m=null;const d=(e,t,n)=>{let a="";return void 0!==e.host&&(a+=`${e.protocol}://${e.host}`+(void 0!==e.port?":"+e.port:"")),a+=(void 0!==e.path?"/"+e.path:"")+(""+(t?"/"+t:""))+`/v${n}?`,a},p=async(e,t,n,a,o="api")=>{const i=r.Z.getConfig(),c=i[o],p=i.gqapiEndpoints[e]?i.gqapiEndpoints[e].url:e,u=a||i.api.version,g=d(c,p,u);let h={Accept:"application/json"};i.partnerDomain&&(h["X-Partner-Domain"]=i.partnerDomain),3===a&&(h["Content-Type"]="application/json; charset=utf-8"),h={...h,...n};var _;return await(_=c.host,null!==m||(m=new Promise(((e,t)=>{"undefined"!=typeof window&&void 0!==_&&window.location.host!==_?"object"!=typeof window.mtCrossAuth?l.Z.loadScript(window.location.protocol+"//static.mtml.ru/js/v2/libs/cross-auth/client.js",(n=>{n||"object"!=typeof window.mtCrossAuth?t("Error loading cross auth: "+n):(window.mtCrossAuth.init(window.location.protocol+"//"+_),e(!0))})):e(!0):e(!1)}))),m)?new Promise(((e,n)=>{window.mtCrossAuth.apiCall(p,u,t,h,(t=>{e({json:()=>new Promise((e=>{e(t)}))})}),(e=>{n(new Error(e))}))})):s()(g,{method:"post",credentials:"same-origin",body:t,headers:h})},u=async(e={body:"",project:"",ver:null,headers:{},raw:!1,jwt:!1,res:void 0,apiName:"api"})=>{const t=e.apiName||"api",n=r.Z.getConfig();if(!n||!n.gqapiEndpoints||!n[t])throw new Error("GraphQLFetch: not configured");const a=e.res,s=e.project,l=e.body,m={...e.headers},u=e.ver;if(void 0!==a){const{ip:e,userAgent:t,geonameId:n,cookie:s,port:r}=i.ZP.getClientInfo(a);e&&void 0===m["Client-Ip"]&&(m["Client-Ip"]=e),t&&void 0===m["User-Agent"]&&(m["User-Agent"]=t),n&&void 0===m["X-Geoname-Id"]&&(m["X-Geoname-Id"]=n),s&&void 0===m.Cookie&&(m.Cookie=s),m["x-ip"]=e,m["x-user-agent"]=t,m["x-port"]=r}else if("undefined"!=typeof window&&window.blogStore){const{ip:e,port:t,userAgent:n}=window?.__PRELOADED_STATE__?.app?.req||{};m["x-ip"]=e,m["x-user-agent"]=n,m["x-port"]=t}let g=null;try{const r=new Date;if(e.jwt&&"undefined"!=typeof window){const e=await i.ZP.getJwtAccessToken();m.Authorization="Bearer "+(e||"none")}g=await p(s,l,m,u,t);const o=g.status;e.raw||(g=await g.json());const h=new Date,_=u||n.api.version,E=n.gqapiEndpoints[s]?n.gqapiEndpoints[s].url:s;let f=null;if(l)try{f=JSON.parse(l)}catch(e){console.log(e)}return c.Z.pushGqlEvent(c.Z.getRequestId(a),{started:r,ended:h,time:h.getTime()-r.getTime(),status:o,endpoint:d(t,E,_),method:"POST",queryString:f?.query||null,variables:f?.variables||null}),g}catch(e){if(o.Z.isClientNetworkError(e))throw e}}},81277:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});n(71022),n(21943);var a=n(12684),s=n(64962);
/**
 * Mirtesen.
 *
 * API interface for Image uploader.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class r{static uploadImageToStorage=async e=>{try{let t=await fetch(e);t=await t.blob();const n=new FormData;n.append("query","mutation {uploadPhoto {id, photo_original}}"),n.append("photo",t);const a=await s.ZP.getJwtAccessToken(),r="/gqapi/main/v1";let o=await fetch(r,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",headers:{Accept:"application/json",Authorization:"Bearer "+(a||"none")},body:n});return o=await o.json(),o?.data?.uploadPhoto||!1}catch(e){return a.Z.promiseHandler("/index.js")(e),!1}};static uploadImages=e=>Promise.all(e.map((e=>r.uploadImageToStorage(e))));static cropImage=e=>{const{image:t}=e,n=t.naturalWidth/t.width,a=t.naturalHeight/t.height,s=document.createElement("canvas"),r=s.getContext("2d");if(r)return s.width=Math.floor(e.width*n),s.height=Math.floor(e.height*a),r.drawImage(t,e.leftPx*n,e.topPx*a,e.width*n,e.height*a,0,0,s.width,s.height),s.toDataURL("image/jpeg")}}const o=r},33130:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});
/**
 * Mirtesen.
 *
 * LoadUtils.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class a{static cachedModules={};static lazyLoad(e,t,n=null){let a=0;if("function"!=typeof e||"function"!=typeof t)return!1;const s=setInterval((()=>{if(a++,a>100)return clearInterval(s),void("function"==typeof n&&n());e()&&(clearInterval(s),t())}),100)}static loadModule(e,t){return()=>(void 0===a.cachedModules[t]&&(a.cachedModules[t]=e()),a.cachedModules[t])}static loadScript(e,t={}){const{onload:n,onerror:a,id:s,async:r,charset:o}={onload:null,onerror:null,async:!0,charset:"utf-8",id:null,...t},i=document.createElement("script");i.async=r,i.src=e,i.charset=o,s&&(i.id=s),n&&(i.readyState?i.onreadystatechange=()=>{if("loaded"===i.readyState||"complete"===i.readyState)return i.onreadystatechange=null,n()}:i.onload=n),a&&(i.onerror=a);const l=[...document.getElementsByTagName("script")],c=l.findIndex((t=>t.src===e));c>-1?l[c].replaceWith(i):document.getElementsByTagName("head")[0].appendChild(i)}static loadStyle(e){const t=document.createElement("link");t.href=e,t.rel="stylesheet",t.type="text/css";[...document.getElementsByTagName("link")].findIndex((t=>t.href===e))<=-1&&document.getElementsByTagName("head")[0].appendChild(t)}}const s=a},88916:(e,t,n)=>{"use strict";function a(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function s(e,t,n,s,r,o){return a((i=a(a(t,e),a(s,o)))<<(l=r)|i>>>32-l,n);var i,l}function r(e,t,n,a,r,o,i){return s(t&n|~t&a,e,t,r,o,i)}function o(e,t,n,a,r,o,i){return s(t&a|n&~a,e,t,r,o,i)}function i(e,t,n,a,r,o,i){return s(t^n^a,e,t,r,o,i)}function l(e,t,n,a,r,o,i){return s(n^(t|~a),e,t,r,o,i)}function c(e,t){var n,s,c,m,d;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var p=1732584193,u=-271733879,g=-1732584194,h=271733878;for(n=0;n<e.length;n+=16)s=p,c=u,m=g,d=h,p=r(p,u,g,h,e[n],7,-680876936),h=r(h,p,u,g,e[n+1],12,-389564586),g=r(g,h,p,u,e[n+2],17,606105819),u=r(u,g,h,p,e[n+3],22,-1044525330),p=r(p,u,g,h,e[n+4],7,-176418897),h=r(h,p,u,g,e[n+5],12,1200080426),g=r(g,h,p,u,e[n+6],17,-1473231341),u=r(u,g,h,p,e[n+7],22,-45705983),p=r(p,u,g,h,e[n+8],7,1770035416),h=r(h,p,u,g,e[n+9],12,-1958414417),g=r(g,h,p,u,e[n+10],17,-42063),u=r(u,g,h,p,e[n+11],22,-1990404162),p=r(p,u,g,h,e[n+12],7,1804603682),h=r(h,p,u,g,e[n+13],12,-40341101),g=r(g,h,p,u,e[n+14],17,-1502002290),p=o(p,u=r(u,g,h,p,e[n+15],22,1236535329),g,h,e[n+1],5,-165796510),h=o(h,p,u,g,e[n+6],9,-1069501632),g=o(g,h,p,u,e[n+11],14,643717713),u=o(u,g,h,p,e[n],20,-373897302),p=o(p,u,g,h,e[n+5],5,-701558691),h=o(h,p,u,g,e[n+10],9,38016083),g=o(g,h,p,u,e[n+15],14,-660478335),u=o(u,g,h,p,e[n+4],20,-405537848),p=o(p,u,g,h,e[n+9],5,568446438),h=o(h,p,u,g,e[n+14],9,-1019803690),g=o(g,h,p,u,e[n+3],14,-187363961),u=o(u,g,h,p,e[n+8],20,1163531501),p=o(p,u,g,h,e[n+13],5,-1444681467),h=o(h,p,u,g,e[n+2],9,-51403784),g=o(g,h,p,u,e[n+7],14,1735328473),p=i(p,u=o(u,g,h,p,e[n+12],20,-1926607734),g,h,e[n+5],4,-378558),h=i(h,p,u,g,e[n+8],11,-2022574463),g=i(g,h,p,u,e[n+11],16,1839030562),u=i(u,g,h,p,e[n+14],23,-35309556),p=i(p,u,g,h,e[n+1],4,-1530992060),h=i(h,p,u,g,e[n+4],11,1272893353),g=i(g,h,p,u,e[n+7],16,-155497632),u=i(u,g,h,p,e[n+10],23,-1094730640),p=i(p,u,g,h,e[n+13],4,681279174),h=i(h,p,u,g,e[n],11,-358537222),g=i(g,h,p,u,e[n+3],16,-722521979),u=i(u,g,h,p,e[n+6],23,76029189),p=i(p,u,g,h,e[n+9],4,-640364487),h=i(h,p,u,g,e[n+12],11,-421815835),g=i(g,h,p,u,e[n+15],16,530742520),p=l(p,u=i(u,g,h,p,e[n+2],23,-995338651),g,h,e[n],6,-198630844),h=l(h,p,u,g,e[n+7],10,1126891415),g=l(g,h,p,u,e[n+14],15,-1416354905),u=l(u,g,h,p,e[n+5],21,-57434055),p=l(p,u,g,h,e[n+12],6,1700485571),h=l(h,p,u,g,e[n+3],10,-1894986606),g=l(g,h,p,u,e[n+10],15,-1051523),u=l(u,g,h,p,e[n+1],21,-2054922799),p=l(p,u,g,h,e[n+8],6,1873313359),h=l(h,p,u,g,e[n+15],10,-30611744),g=l(g,h,p,u,e[n+6],15,-1560198380),u=l(u,g,h,p,e[n+13],21,1309151649),p=l(p,u,g,h,e[n+4],6,-145523070),h=l(h,p,u,g,e[n+11],10,-1120210379),g=l(g,h,p,u,e[n+2],15,718787259),u=l(u,g,h,p,e[n+9],21,-343485551),p=a(p,s),u=a(u,c),g=a(g,m),h=a(h,d);return[p,u,g,h]}function m(e){var t,n="",a=32*e.length;for(t=0;t<a;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function d(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var a=8*e.length;for(t=0;t<a;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function p(e){var t,n,a="0123456789abcdef",s="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),s+=a.charAt(t>>>4&15)+a.charAt(15&t);return s}function u(e){return unescape(encodeURIComponent(e))}function g(e){return function(e){return m(c(d(e),8*e.length))}(u(e))}function h(e,t){return function(e,t){var n,a,s=d(e),r=[],o=[];for(r[15]=o[15]=void 0,s.length>16&&(s=c(s,8*e.length)),n=0;n<16;n+=1)r[n]=909522486^s[n],o[n]=1549556828^s[n];return a=c(r.concat(d(t)),512+8*t.length),m(c(o.concat(a),640))}(u(e),u(t))}function _(e,t,n){return t?n?h(t,e):p(h(t,e)):n?g(e):p(g(e))}n.d(t,{F:()=>_})},74535:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});
/**
 * Mirtesen.
 *
 * Message implementation.
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class a{static systemMessages={ignoreProfile:"Пользователь добавлен в Ваш черный список!",abuse:"Спасибо, жалоба отправлена. Мы примем меры",ignoreUser:"Автор добавлен в Ваш черный список!",ignoreAuthor:"Посты этого автора будут скрыты",ignoreBlog:"Посты этого канала будут скрыты.",ignorePost:"Этот пост будет скрыт",ignoreTopic:"Посты этой тематики больше не будут показываться в вашей ленте",banBlogMember:"Пользователь добавлен в черный список сайта",unbanBlogMember:"Пользователь удален из черного списока сайта",incorrectPhoneNumber:"Введите верный номер мобильного телефона",incorrectEmail:"Недействительный e-mail! Повторите попытку.",exception:"Произошла ошибка, попробуйте позже...",requiredField:"Обязательное поле пропущено",reservedDomain:"К сожалению, это доменное имя уже занято",reservedEmail:"Такой email уже есть в вашем списке",freeDomain:"Этот адрес свободен",tooLong:"Превышена максимальная длина",incorrectField:"Некорректно заполнено поле",imageError:"Произошла ошибка при загрузке картинки, попробуйте еще раз",confirmCode:"Введите код подтверждения",rejectedFile:"Неверный формат файла",addFriend:"Запрос на добавление в друзья отправлен",save:"Успешно сохранено",delete:"Успешно удалено",sendLetter:"На почтовый адрес отправлено письмо с подтверждением. Следуйте указанным инструкциям.",subscribed:"Вы подписаны",confirmedPhoneNumber:"Ваш телефон успешно подтвержден",successPasswordChange:"Ваш пароль был успешно изменен. Теперь вы можете авторизироваться.",successSendFeedback:"Ваш запрос успешно отправлен.",recoveryError:"При восстановлении произошла ошибка",saveError:"При сохранении произошла ошибка",passwordChageError:"Ошибка смены пароля"};static sendMessage=e=>{"undefined"!=typeof window&&window.postMessage(e,"*")};static sendSystemMessage=e=>{a.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:a.systemMessages[e]})};static sendHidePostMessage=e=>{a.sendMessage({type:"MT_APP_HIDE_POST",id:e})}}const s=a},47029:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});n(35014),n(5645),n(31331);const a=
/**
 * Mirtesen.
 *
 * Error implementation.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class{static clientNetworkErrors=[{name:"TypeError",message:"Network request failed"},{name:"TypeError",message:"NetworkError when attempting to fetch resource."},{name:"AbortError",message:"The operation was aborted"},{name:"SyntaxError",message:"Unexpected end of JSON input"},{name:"TypeError",message:"Failed to fetch"}];static isClientNetworkError(e){let t=!1;return this.clientNetworkErrors.some((n=>{if(0===n.name.indexOf(e.name.trim())&&0===n.message.indexOf(e.message.trim())&&"undefined"!=typeof window&&"undefined"!=typeof navigator)return t=!0,!0})),t}static emulateClientNetworkError(){if("undefined"!=typeof window){const e=new Error;throw e.name="TypeError",e.message="Failed to fetch",e}}}},28610:(e,t,n)=>{"use strict";var a="/index.js";n.d(t,{Z:()=>g,i:()=>p});n(17708),n(5645),n(82491),n(71022),n(21943);var s=n(50361),r=n.n(s),o=n(27361),i=n.n(o),l=n(35860),c=n(12684),m=n(30498);
/**
 * Mirtesen.
 *
 * API interface for Person.
 *
 * @author       Artem Kamysh.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const d="\nid\ndisplay_name\nscreen_name\nfirst_name\nlast_name\nnickname\nurl\nbdate\nphoto_original\nsex\ncount_friends\ncount_sites\ncover\ndescription\nunread_count\nsoc_count\njoined_date\nisDeveloper\nisEditor\nemail\nphone\nisPhoneVerified\nfavorite_topics {\n  symbol\n  value\n}\nfavorite_groups {\n  symbol\n  value\n}\nfavorite_persons {\n  symbol\n  value\n}\nisAuthenticAccount\nprofileInfo {\n  onlineStatus\n  career\n  education\n  emails {\n    email\n    status\n  }\n  maritalStatus\n  mutualFriendsNum\n  phones\n  links\n  friends {\n    items {\n      id\n      photo_original\n      url\n      display_name\n    }\n  }\n}\ncanPostToWall\ncanViewProfile\ncanViewFriends\nviewDeniedProfileReason\nisSelfDeleted\n",p="\nid\ndisplay_name\nurl\nphoto_original\nbdate\njoined_date\nisAuthenticAccount\n";class u{static getMergeAccountsCode=async(e={})=>{try{return await m.Z.request({query:"query {\n                    getMergeAccountsCode\n                }",endpoint:{endpoint:"user",ver:"v1"},req:e.req,res:e.res})||null}catch(e){c.Z.promiseHandler(a)(e)}};static getMMInfo=async(e={})=>{try{return await m.Z.request({query:"query {\n                  getMMInfo {\n                    isBound\n                    bindingUrl\n                  }\n                }",endpoint:{endpoint:"user",ver:"v1"},req:e.req,res:e.res})||null}catch(e){c.Z.promiseHandler(a)(e)}};static getById=async(e,t={})=>{try{const n=await m.Z.request({query:`query {\n                    getUserById(id: ${e}) {\n                      ${d}\n                    }\n                  }`,endpoint:{endpoint:"user",ver:"v1"},req:t.req,res:t.res});return n&&n.id?u.normalizePersonDates(n):n}catch(e){c.Z.promiseHandler(a)(e)}};static getMe=async(e={})=>{try{const t=await m.Z.request({query:`query {\n                    me {\n                      ${d}\n                    }\n                  }`,endpoint:{endpoint:"user",ver:"v1"},req:e.req,res:e.res});return t?u.normalizePersonDates(t):null}catch(e){c.Z.promiseHandler(a)(e)}};static getPersonFriends=async(e,t=20,n=0,s={})=>{try{return await m.Z.request({query:`query \n                    {\n                      friends(user_id: ${e}, offset: ${n} count: ${t}) {\n                        ${p}\n                      }\n                    }`,endpoint:{endpoint:"user",ver:"v1"},req:s.req,res:s.res})||[]}catch(e){c.Z.promiseHandler(a)(e)}};static getPersonPhotos=async(e,t=20,n=null,s={})=>{try{const a=await m.Z.request({query:`query \n                {\n                  getPhotos(ownerId: ${e}, limit: ${t}, before: ${n||null}) {\n                    items {\n                      id\n                      title\n                      link\n                      src\n                      tags\n                      type\n                      date\n                    }\n                  }\n                }`,endpoint:{endpoint:"user",ver:"v1"},req:s.req,res:s.res});return a?.items||[]}catch(e){c.Z.promiseHandler(a)(e)}};static getUsersRelationStatus=async(e,t={})=>{try{const n=await m.Z.request({query:`query \n                {\n                    usersRelationStatus(user_ids: [${e}])\n                }`,endpoint:{endpoint:"user",ver:"v1"},req:t.req,res:t.res});return JSON.parse(n)||{}}catch(e){c.Z.promiseHandler(a)(e)}};static getPersonEvents=async(e=null,t={})=>{try{const n=await m.Z.request({query:`query {\n                    getEvents(month:${e}) {\n                    todayBirthdays {\n                      ${p}\n                    }\n                    byMonthBirthdays\n                    }\n                  }`,endpoint:{endpoint:"main",ver:"v1"},req:t.req,res:t.res});return u.normalizeEvents(n||{})}catch(e){c.Z.promiseHandler(a)(e)}};static async getLastPersonComments({personId:e,count:t=5,fromMessageId:n,...s}){let r;try{return r=await l.Z.getMessagesAsPersonComments(e,t,n,s),r.count=r?.items?.length,r.items=u.groupPersonCommentsByPost(r?.items||[]),r}catch(e){c.Z.promiseHandler(a)(e)}}static getPersonSites=async(e,t=20,n=0,s={})=>{try{const a=await m.Z.request({query:`query \n                {\n                  userSitesList(userId: ${e}, count: ${t}, offset: ${n} ) {\n                    id\n                    display_name\n                    url\n                    photo\n                    members_count\n                    is_staff\n                    is_member\n                    is_subscribed\n                  }\n                }`,endpoint:{endpoint:"main",ver:"v1"},req:s.req,res:s.res});return u.normalizeSiteList(a||[])}catch(e){c.Z.promiseHandler(a)(e)}};static getPersonSettings=async(e,t={})=>{try{const n=await m.Z.request({query:`query\n                {\n                  getUserSettings(id: ${e})\n                }`,endpoint:{endpoint:"user",ver:"v1"},req:t.req,res:t.res});return JSON.parse(n)}catch(e){c.Z.promiseHandler(a)(e)}};static async setPersonSettings(e,t,n={}){try{"object"==typeof t&&(t=JSON.stringify(t)),t=JSON.stringify(t);const a=await m.Z.request({query:`mutation {\n                    setUserSettings(id: ${e} settings: ${t})\n                }`,endpoint:{endpoint:"user",ver:"v1"},req:n.req,res:n.res});return JSON.parse(a)}catch(e){c.Z.promiseHandler(a)(e)}}static confirmEmail=async(e,t={})=>{try{return await m.Z.request({query:`mutation {\n                  confirmEmail(email: "${e}")\n                }`,endpoint:{endpoint:"user",ver:"v1"},req:t.req,res:t.res})}catch(e){c.Z.promiseHandler(a)(e)}};static async getHoliday(e={}){try{return await m.Z.request({query:"query {\n                    getHoliday {\n                        title\n                        image\n                    }\n                }",endpoint:{endpoint:"main",ver:"v1"},req:e.req,res:e.res})}catch(e){c.Z.promiseHandler(a)(e)}}static async restorePassword(e,t={}){try{return await m.Z.request({query:`mutation {\n                    restorePassword(email:"${e}") {\n                        status\n                        errors {\n                            key\n                            message\n                        }\n                    }\n                }`,endpoint:{endpoint:"user",ver:"v1"},req:t.req,res:t.res})}catch(e){c.Z.promiseHandler(a)(e)}}static async getUserByActionKey(e,t={}){try{const n=await m.Z.request({query:`query {\n                    getUserByActionKey(key:"${e}")\n                }`,endpoint:{endpoint:"user",ver:"v1"},req:t.req,res:t.res});return JSON.parse(n)}catch(e){c.Z.promiseHandler(a)(e)}}static async setUserPasswordByActionKey(e,t,n={}){try{const a=await m.Z.request({query:`mutation {\n                    setUserPasswordByActionKey(password:"${e}", key:"${t}")\n                }`,endpoint:{endpoint:"user",ver:"v1"},req:n.req,res:n.res});return JSON.parse(a)}catch(e){c.Z.promiseHandler(a)(e)}}static normalizeSettings(e){if(!e)return{};const t=r()(e);let n=i()(t,"personal.birthday",null);return null!==n&&(n=n.split("-"),t.personal.userBirthdayYear=n[0],t.personal.userBirthdayMonth=n[1],t.personal.userBirthday=n[2]),t.contacts.emails.default=i()(t,"contacts.emails.default",null),t.contacts.emails.pending=i()(t,"contacts.emails.pending",[]),t.contacts.emails.confirmed=i()(t,"contacts.emails.confirmed",[]),t.contacts.urlsAsString=i()(t,"contacts.urls",null),null!==t.contacts.urlsAsString&&(t.contacts.urlsAsString=t.contacts.urlsAsString.join("\n")),t.privacy.inviter_person_url=i()(t,"privacy.inviter_person.url",null),t.peopleblacklist=i()(t,"ignore.people",[]),t.siteblacklist=i()(t,"ignore.sites",null),t.peopleblacklist=t.peopleblacklist.reduce(((e,t)=>(e[`key${t.id}`]=t,e)),{}),t.siteblacklist=t.siteblacklist.reduce(((e,t)=>(e[`key${t.id}`]=t,e)),{}),t.confirm={phone:i()(t,"contacts.phoneMobile",null),phoneConfirmCode:"",confirmSmsSent:!1},t}static groupPersonCommentsByPost=e=>{if(!Array.isArray(e))return null;const t={};return e.map((e=>{const n=i()(e,"blog_post.id");n&&(t[n]?t[n].push(e):t[n]=[e])})),t};static normalizePersonDates=e=>{if(!e)return e;const t={...e};if(e.bdate){let[e,n,a]=t.bdate.split(".");e=1===e.length?`0${e}`:e,n=1===n.length?`0${n}`:n,t.bdate=`${e}.${n}.${a}`}return t};static normalizeEvents=e=>{const t=e?.byMonthBirthdays?JSON.parse(e?.byMonthBirthdays):[],n={byMonthBirthdays:{},todayBirthdays:e?.todayBirthdays&&e?.todayBirthdays.length?[{personList:e?.todayBirthdays}]:[]};return t.map((e=>{e.person_list&&e.person_list.length&&(n.byMonthBirthdays[e.month]?n.byMonthBirthdays[e.month].push({day:e.day,personList:e.person_list}):n.byMonthBirthdays[e.month]=[{day:e.day,personList:e.person_list}])})),n};static determineRelation=e=>{const t={friendStatus:[],blacklistedTo:!0,blacklistedFrom:!0,isBlacklisted:!0,isFriend:!1,isSubscribed:!1,canView:!1,canBeFriend:!1,canSubscribe:!1,canAbuse:!1,canBlacklist:!1};if(!e)return t;const{canAbuseUser:n,isIgnoreUser:a,isIgnoredByUser:s,canViewProfile:r=!0}=e;let{friendshipStatus:o}=e;o=o||[];let i="none";-1!==o.indexOf("friendship")?i="friendship":-1!==o.indexOf("join_wait")?i="my_request":-1!==o.indexOf("join_request")&&(i="user_request");const l=a,c=s,m=l||c,d="friendship"===i,p=-1!==o.indexOf("friend")||-1!==o.indexOf("fellow")||-1!==o.indexOf("confederate")||-1!==o.indexOf("opponent");let u="none";r&&!m||!r&&!m&&d?u="full":r||m||(u="partially");const g=n&&!l,h=!m,_=!m,E=!l;return{...t,friendStatus:i,blacklistedTo:l,blacklistedFrom:c,isBlacklisted:m,isFriend:d,isSubscribed:p,canView:u,canBeFriend:h,canSubscribe:_,canAbuse:g,canBlacklist:E}};static getUrl=(e,t=null,n=null)=>{let a=`/people/${e}`;return n&&(a=n+a,a=t?`${t}://`+a:"//"+a),a};static normalizeSiteList=e=>e.map((e=>({...e,isStaff:e.is_staff,isMember:e.isMember,isSubscribed:e.is_subscribed})))}const g=u},20190:(e,t,n)=>{"use strict";var a="/index.js";n.d(t,{default:()=>T,hm:()=>h,q3:()=>g,qh:()=>y});n(93811),n(5645),n(17312),n(71022),n(21943),n(17708),n(82491),n(74754),n(73101);var s=n(30381),r=n.n(s),o=n(30498),i=n(47029),l=n(93669),c=n(12684),m=n(99871),d=n(40680),p=n(78861),u=n(4169);
/**
 * Mirtesen.
 *
 * API interface for Person Post.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const g="\nattachments {\n  ... on AttachmentPhoto{\n    photo {\n      id\n      photo_original\n      width\n      height\n    }\n  }\n  ... on AttachmentLink {\n    link {\n      url\n      title\n      caption\n      embed\n      photo {\n        id\n        photo_original\n        width\n        height\n      }\n    }\n  }\n  ... on AttachmentVideo {\n    video {\n      id\n      pandaVideoId\n      title\n      player_html\n      player_data\n      caption\n      url\n    }\n  }\n  ...on AttachmentForeignPoll {\n    type\n    poll {\n        title\n        color_scheme\n        votes_counter\n        fileUri\n    }\n  }\n\n  ...on AttachmentTag {\n    tag {\n        id\n        name\n    }\n  }\n}",h=`\n  channel {\n    ${u.rS}\n  }\n`,_=`\nid\npost_type\nurl\ndate\nowner_id\ntags\ntext\nforeignPollId\nmsg_type_did\n${g}\nfrom {\n    id\n    display_name\n    url\n    photo_original\n    isAuthenticAccount\n}`,E=`\nshared_post {\n    ... on UserPost {\n        ${_}\n        previewText\n        extraData\n    }\n    ... on BlogPost {\n        ${_}\n        ${d.r_}\n        title\n        preview_text\n    }\n}`,f=`\n  id\n  from_id\n  post_type\n  from {\n    id,\n    display_name\n    url\n    photo_original\n    isAuthenticAccount\n    sex\n  }\n  owner_id\n  text\n  comments_count\n  marks_count\n  likes {\n    count\n    user_likes\n    can_like\n    marks_pluses\n    marks_minuses\n    user_like_attr\n    like_attr_ids {\n        id\n        count\n    }\n  }\n  fame_actions_positive_count\n  fame_actions_negative_count\n  fame_actions {\n    user_id\n    user_name\n    user_avatar\n    message\n    is_positive\n    title\n    type\n  }\n  reposts\n  url\n  tags\n  date\n  canEdit\n  foreignPollId\n  extraData\n  msg_type_did\n  ${g}\n`,b=`\n  title\n  is_draft\n  is_queued\n  ${d.r_}\n  preview_text\n  ${f}\n`,y=`\n  ${f}\n  previewText\n  can_comment\n  visible\n  owner_display_name\n  top_status\n  ${E}\n`;class v{static feeds={feed:{title:"Инста",filter:"USER_POSTS_FRIENDS_INSTA",switcher:!0,auth:!0,tooltip:"Фото и видео ваших друзей",onlyClientSideRendering:!1},main:{title:"Для вас",filter:"",switcher:!0,auth:!1,tooltip:"Лучшие рекомендованные посты",onlyClientSideRendering:!0},"user-posts":{title:"Новости пользователей МирТесен",filter:"",switcher:!1,auth:!0,onlyClientSideRendering:!1}};static validationParams={title:{minLength:5,maxLength:70},preview:{minLength:150,maxLength:300}};static errorMessage={title:{tooShort:"Дополните заголовок",tooLong:"Сократите заголовок"},preview:{tooShort:"Дополните анонс",tooLong:"Сократите анонс"},topic:"Выберите значение",emptyPost:"Напишите сообщение или прикрепите фото, видео или опрос",emptyAttach:"Прикрепите фото, видео или опрос",saveError:"Произошла ошибка. Попробуйте еще раз или свяжитесь со службой поддержки.",privateAccount:'Выводить посты в ТОП могут только пользователи с открытым профилем МирТесен.<br/>Измените <a href="https://mirtesen.ru/settings/privacy">настройки</a> приватности.',privateAccountShort:'Откройте в <a href="https://mirtesen.ru/settings/privacy">настройках</a> доступ для всех.',url:"Ссылка должна начинаться с https://"};static getFeedParams(e,t){const n={...this.feeds[e]};switch(e){case"main":t?(n.loader=this.getNewsFeedPosts,n.onlyClientSideRendering=!0,n.auth=!0):n.loader=this.getSmi2Posts;break;case"main2":n.loader=this.getNewsFeedPosts;break;case"feed":n.loader=this.getPersonFeed;break;case"user-posts":n.loader=this.getAllUserPosts;break;default:n.loader=null}return n}static async getSwitcherParams(){try{const e=await o.Z.request({query:"query {\n                    appConfig {\n                        mainTabTitle\n                        momentsTabTitle\n                        defaultTab\n                    }\n                }",endpoint:{endpoint:"main",ver:"v1"}});if(e){const{mainTabTitle:t,momentsTabTitle:n,defaultTab:a}=e;return{mainTabTitle:t,momentsTabTitle:n,defaultTab:"MOMENTS"===a?"feed":a.toLowerCase()}}return{mainTabTitle:"Лента",momentsTabTitle:"Моменты",defaultTab:"feed"}}catch(e){return c.Z.promiseHandler(a)(e),{mainTabTitle:"Лента",momentsTabTitle:"Моменты",defaultTab:"feed"}}}static async savePost(e,t={}){let{text:n,body:s,extraData:r}=e;const{title:l,videoId:m,pandaVideoId:d,vislvl:p,photoIds:u,pollId:g,placeId:h,link:_,videoEmbed:E,target:f,author:b,geotagId:y}=e,v="channel"===f.type;r=r||{},l&&(r.ed_title=l);let T="";n&&(n=JSON.stringify(n),T=`text: ${n}`);let S="";s&&(s=JSON.stringify(s),S=`body: ${s}`);let P="";u&&(P=`photoIds: ${u}`);let w="";g&&(w=`foreignPollId: ${g}`);let I="";m?I=`videoId: ${m}`:d&&(I=`pandaVideoId: ${d}`);let C=null,N="";E&&(C=E),_&&_.title&&_.url&&!_.hide&&(C=C||{},C.link=_),C&&(C=JSON.stringify(JSON.stringify(C)),N=`embeddedStr: ${C}`);let O="";h&&(O=`placeId: ${h}`);let M="";v&&(M=`channelId: ${f.id}`);let k="";Number.isInteger(y)&&(k=`geotagId: ${y}`);let A="";r&&("object"==typeof r&&(r=JSON.stringify(r)),r=JSON.stringify(r),A=`extraData: ${r}`);let x="",L="",D="";e.postId?(x="editUserPost",D=`postId: ${e.postId}`):(x="createUserPost",L=`toUserId: ${v?b.id:f.id}`);try{return await o.Z.request({query:`mutation\n                {\n                  ${x}(\n                    ${D}\n                    ${T}\n                    ${S}\n                    ${P}\n                    ${w}\n                    ${I}\n                    ${N}\n                    ${O}\n                    ${L}\n                    visible: ${p}\n                    ${A}\n                    ${M}\n                    ${k}\n                  )\n                }`,endpoint:{endpoint:"main",ver:"v1"},req:t.req,res:t.res})}catch(e){if(i.Z.isClientNetworkError(e))throw e;c.Z.promiseHandler(a)(e)}}static getUserPostById=async(e,t={})=>{const{req:n,res:a}=t,s=await o.Z.request(`query getUserPostById($id: Float!) {\n                getUserPostById(id: $id) {\n                    ${y}\n                    ${h}\n                }\n            }`,{id:e},{endpoint:"main",ver:"v3"},n,a);return s?p.ZP.normalizePost(s):s};static getUserPostsByIds=async(e,t={})=>{try{const n="["+e.join(",")+"]",a=await o.Z.request({query:`query {\n                    getUserPostsByIds(ids:${n}${t.extended?", extended: true":""}) {\n                      items {                        \n                        ${y}\n                        ${h}\n                      }\n                      nextOffset\n                    }\n                }`,endpoint:{endpoint:"main",ver:"v1"},req:t.req,res:t.res});return{items:p.ZP.normalizePostList(a?.items||[]),nextOffset:a?.nextOffset}}catch(e){if(i.Z.isClientNetworkError(e))throw e;c.Z.promiseHandler(a)(e)}};static getAllUserPosts=async(e={})=>{try{const t=await o.Z.request({query:`query\n                {\n                  getAllUserPosts(\n                    limit: ${e.limit||20},\n                    offset: ${e.offset||null},\n                  ) {\n                    items {\n                      previewText\n                      mentionedPersons {\n                        id\n                        display_name\n                      }\n                      place {\n                        display_name\n                        url\n                      }\n                      ${y}\n                    }\n                    nextOffset\n                  }\n                }`,endpoint:{endpoint:"main",ver:"v1"},req:e.req,res:e.res});return{items:p.ZP.normalizePostList(t?.items||[]),nextOffset:t?.nextOffset}}catch(e){if(i.Z.isClientNetworkError(e))throw e;c.Z.promiseHandler(a)(e)}};static getPersonFeed=async(e={})=>{const t=e.filter||"USER_POSTS_LAST_ALL";if("USER_POSTS_LAST_ALL"===t&&(e.ver=3),e.offset<0)return{items:[],nextOffset:0};try{const n=await o.Z.request({query:`query\n                {\n                  getUserPosts(\n                    userId: ${e.userId},\n                    limit: ${e.limit||20},\n                    offset: ${e.offset||null},\n                    filter: ${t},\n                    leadUserPostId: ${e.currentUserPostId||null},\n                  ) {\n                    items {\n                      previewText\n                      mentionedPersons {\n                        id\n                        display_name\n                      }\n                      place {\n                        display_name\n                        url\n                      }\n                      ${y}\n                    }\n                    nextOffset\n                  }\n                }`,endpoint:{endpoint:"main",ver:`v${e.ver||1}`},req:e.req,res:e.res});if(n){return{items:p.ZP.normalizePostList(n?.items||[]),nextOffset:n?.nextOffset}}return{items:[],nextOffset:0}}catch(e){if(i.Z.isClientNetworkError(e))throw e;c.Z.promiseHandler(a)(e)}};static async getVideoFeed(e){if(e.offset<0)return{items:[],nextOffset:0};const t=`query {\n          getUserPosts(\n            userId: 0,\n            limit: ${e.limit||20},\n            offset: ${e.offset||null},\n            filter: USER_POSTS_VIDEO,\n            leadUserPostId: ${e.postId||null}\n          ) {\n            items {\n                ${f}\n                ${h}\n                previewText\n            }\n            nextOffset\n          }\n        }`;try{const n=await o.Z.request(t,void 0,{ver:"v3"},e.req,e.res);if(n){return{items:p.ZP.normalizePostList(n.items),nextOffset:n.nextOffset}}return{items:[],nextOffset:0}}catch(e){c.Z.promiseHandler(a)(e)}}static getNewsFeedPosts=async({limit:e=6,offset:t=0,feedId:n="",params:s={}})=>{try{const a=await o.Z.request({query:`query {\n                    getNewsfeedPosts(id:"${n}", limit:${e}, offset:${t}) {\n                      items {\n                          ... on UserPost {\n                              ${f}\n                              ${E}\n                              previewText\n                              body\n                              owner_id\n                              owner_display_name\n                          }\n                          ... on BlogPost {\n                              ${f}\n                              ${d.r_}\n                              seo_url\n                              topic\n                              title\n                              preview_text\n                              editorStatus\n                          }\n                      }\n                      nonFriendPostIds\n                  }}`,endpoint:{endpoint:"main",ver:"v1"},req:s.req,res:s.res});return{items:p.ZP.normalizePostList(a?.items||[]),nonFriendPostIds:a?.nonFriendPostIds||[]}}catch(e){if(i.Z.isClientNetworkError(e))throw e;c.Z.promiseHandler(a)(e)}};static uniquePostsTitle=[];static getNewsFeedPosts2=async({limit:e=3,offset:t=0,feedId:n="",params:s={},disabledIds:r=[]})=>{try{if("undefined"==typeof window)return{items:[]};let[{items:a},{items:o,nonFriendPostIds:i}]=await Promise.all([this.getSmi2Posts({limit:1,disabledIds:r}),this.getNewsFeedPosts({limit:e,offset:t,feedId:n,params:s})]);this.uniquePostsTitle.push(...o.map((({title:e})=>e)).filter((e=>e)));let l=0;for(;this.uniquePostsTitle.includes(a[0]?.title);){if(l++,l>4){a=[];break}a=(await this.getSmi2Posts({limit:1}))?.items}return{items:[...o,...a],nonFriendPostIds:i}}catch(e){c.Z.promiseHandler(a)(e)}};static getSmi2Posts=async({limit:e,disabledIds:t=[]})=>{try{if("undefined"==typeof window)return{items:[]};const n=window.JsAPI.Dao;let a=await new Promise(((a,s)=>{n.getArticles({block_id:96540,count:e,ctx:n.Context.ARTICLES,has_recommend:!0,filter_ids:t,fields:Object.values(n.ArticleField).reduce(((e,t)=>e|t))},(e=>a(e)),(e=>s(e)))}));if(!Array.isArray(a)||0===a.length)throw new Error("smi2Posts array is empty or it is not an array!");return a=a.map((e=>({...e,id:e.mt_post_id,isUserPost:/\/people\/\d+\/blog\/\d+/.test(e.original_url),smi2_id:e.id}))),{items:await this._mapSmi2PostsToMtPosts(a)}}catch(e){return c.Z.promiseHandler(a)(e),{items:[]}}};static _normalizeSmi2Post=e=>{const{announce:t,title:n,date:a,publisher_name:s,publisher_logo_url:o,publisher_domain:i,image:l,original_url:c,smi2_id:d}=e,p=l?.replace?.("100x100","580x580"),u={width:580,height:580,photo_original:p,url:p,main:!0},g=l?[{...u,photo:u}]:[],h=m.Z.fixProtocol(c),_={display_name:s,photo_original:o,id:null,url:m.Z.fixProtocol(i)},E=a/1e3;return{id:null,smi2_id:d,canonical_url:h,url:h,reposts:0,seo_url:h,post_type:/\/people\/\d+\/blog\/\d+/.test(c)?"user_post":"post",likes:{like_attr_ids:[]},attachments:g,images:g,videos:[],title:n,preview_text:t,comments_count:0,marks_count:0,date:E,created:E,editorStatus:"EDITOR_STATUS_NONE",extraData:null,formattedDates:{iso:r().unix(E).toISOString(),ver1:r().unix(E).format("D MMMM, H:mm"),ver2:r().unix(E).format("DD.MM.YYYY в H:mm"),pubTime:r()(E).format("D MMMM, H:mm")},from:_,group:_,tags:null,shared_post:null,mentionedPersons:null,text:"",from_id:null}};static _mapSmi2PostsToMtPosts=async e=>{if(!Array.isArray(e))return[];const t=e.filter((({id:e,isUserPost:t})=>!t&&e)).map((({id:e})=>e)),n=e.filter((({id:e,isUserPost:t})=>t&&e)).map((({id:e})=>e)),a=[];t.length>0?a.push(l.Z.getById(t)):a.push([]),n.length>0?a.push(v.getUserPostsByIds(n,{extended:!0})):a.push([]);let[s,r]=await Promise.all(a);return s=s||[],r=r?.items||[],e.map((e=>({disabled_id:e.smi2_id,...e.id&&(s.find((({id:t})=>Number(t)===Number(e.id)))||r.find((({id:t})=>Number(t)===Number(e.id))))||this._normalizeSmi2Post(e)})))};static getPublications=async(e,t,n=null,s={})=>{try{const a=await o.Z.request({query:`query\n                {\n                  getUserBlogPostsList(\n                    userId: ${e},\n                    count: ${t||20},\n                    offset: ${n},\n                  ) {\n                    items {\n                      ${b}\n                    }\n                  }\n                }`,endpoint:{endpoint:"blogs",ver:"v1"},req:s.req,res:s.res});return p.ZP.normalizePostList(a?.items||[])}catch(e){if(i.Z.isClientNetworkError(e))throw e;c.Z.promiseHandler(a)(e)}}}const T=v},54462:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var a=n(97779),s=n(53894),r=n(27361),o=n.n(r);
/**
 * Mirtesen.
 *
 * Registry.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
let i=null,l=null;const c=class{static setConfig(e){l={...e,mainDomain:e.mainDomain||"mirtesen.ru",platform:e.platform||"mirtesen",comet:{...e.comet,url:o()(e,"comet.url","//socket2.mirtesen.ru/cmt"),namespace:o()(e,"comet.namespace","")}}}static getConfig(){return l}static getStore(){return i}static initStore(e={},t={}){const n=(0,a.md)(s.Z);return i=(0,a.MT)((0,a.UY)(e),t,n),i}}},47955:(e,t,n)=>{"use strict";var a="/index.js";n.d(t,{Z:()=>f});n(15802),n(69357),n(63627),n(72893),n(50936),n(54990),n(18096),n(12688),n(44978),n(32282),n(51253),n(66984),n(41649),n(26296),n(5645),n(53169),n(71022),n(21943),n(93811),n(17312),n(98216),n(96751),n(88781),n(58368),n(24194),n(61968),n(64908),n(39256),n(48802),n(99695),n(42249),n(31870),n(95154),n(24064),n(87419),n(64627);var s=n(88916),r=n(12684),o=n(99871),i=n(28610),l=n(10581),c=n(40680),m=n(48687),d=n(41750),p=n(30498),u=n(4169),g=n(78861);
/**
 * Mirtesen.
 *
 * SearchEngine.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const h={searchPeople:`query search (\n        $query: String!,\n        $offset: Float,\n        $count: Float,\n        $scope: String,\n        $userId: Float\n        $groupId: Float\n    ) {\n        search (\n            query: $query,\n            offset: $offset,\n            count: $count,\n            scope: $scope,\n            userId: $userId\n            groupId: $groupId\n        ) {\n            ${i.i}\n        }\n    }`,searchSites:"query searchGroups (\n        $query: String!,\n        $subscription: Boolean\n        $count: Float\n        $offset: Float\n    ) {\n        searchGroups (\n            query: $query,\n            subscription: $subscription\n            count: $count\n            offset: $offset\n        ) {\n            id\n            display_name\n            photo_original\n            url\n            members_count\n            showSubscribersAmount\n            is_member\n            is_subscribed\n            is_staff\n            is_owner\n        }\n    }",searchRatedGroups:"query searchRatedGroups (\n        $query: String!,\n        $period: period_for_search_rated_groups\n    ) {\n        searchRatedGroups (\n            query: $query,\n            period: $period\n        ) {\n            items {\n                id,\n                label, \n                url,\n                views,\n                unique_visitors\n                logo_url\n                members_count\n                showSubscribersAmount\n                isStaff\n                isMember\n                isSubscribed\n              }\n        }\n    }",searchPosts:`query searchPosts (\n        $query: String!,\n        $type: postType,\n        $ownerId: Float,\n        $offset: Float,\n        $count: Float,\n        $period: period_for_search_posts\n        $channelId: Float\n    ) {\n        searchPosts(\n            query: $query,\n            type: $type,\n            ownerId: $ownerId,\n            offset: $offset,\n            count: $count,\n            period: $period\n            channelId: $channelId\n        ) {\n            items {\n                ... on UserPost {\n                    post_type\n                    ${c.lP}\n                    ${c.fO}\n                    previewText\n                    body\n                    owner_id\n                    owner_display_name\n                    channel {\n                        id\n                        person_id\n                        name\n                        title\n                        avatar\n                        trusted\n                        avatar_info\n                    }\n                }\n                ... on BlogPost {\n                    post_type\n                    ${c.lP}\n                    ${c.r_}\n                    seo_url\n                    topic\n                    title\n                    preview_text\n                    editorStatus\n                }\n            }\n        }\n\n    }`,searchTags:"query searchTags (\n        $search: String!,\n        $limit: Int\n        $offset: Int\n        $tagType: SearchTagType\n    ) {\n        searchTags (\n            search: $search,\n            limit: $limit,\n            offset: $offset\n            tagType: $tagType\n        ) {\n            id\n            tag_name\n            type_id\n            subscribers_num\n        }\n    }\n    ",searchChannels:`query searchChannels (\n        $query: String!,\n        $limit: Int\n        $offset: Int\n    ) {\n        searchChannels (\n            query: $query,\n            limit: $limit,\n            offset: $offset\n        ) {\n            ${u.rS}\n            subscribers_num\n        }\n    }`},_={ALL_PEOPLE:{category:"people",fixedParams:{},requiredParams:[]},FRIENDS:{category:"people",fixedParams:{scope:"friends"},requiredParams:["userId"]},GROUP_MEMBER:{category:"people",fixedParams:{},requiredParams:["siteId"]},ALL_SITES:{category:"sites",fixedParams:{},requiredParams:[]},SUBSCRIPTIONS:{category:"sites",fixedParams:{subscription:!0},requiredParams:[]},ALL_POSTS:{category:"posts",fixedParams:{},requiredParams:[]},ALL_USER_POSTS:{category:"posts",fixedParams:{type:"USER_POST"},requiredParams:[]},ALL_BLOG_POSTS:{category:"posts",fixedParams:{type:"BLOG_POST"},requiredParams:[]},ALL_CHANNEL_POSTS:{category:"posts",fixedParams:{channelId:-1},requiredParams:[]},USER_POSTS_BY_AUTHOR:{category:"posts",fixedParams:{type:"USER_POST"},requiredParams:["ownerId"]},BLOG_POSTS_BY_BLOG:{category:"posts",fixedParams:{type:"BLOG_POST"},requiredParams:["ownerId"]},RATED_GROUPS:{category:"ratedGroups",fixedParams:{},requiredParams:[]},TAGS:{category:"tags",fixedParams:{},requiredParams:[]},CHANNELS:{category:"channels",fixedParams:{},requiredParams:[]}};class E{static searchCache=new Map;static _maxCache=20;static _maxHistorySize=100;static search=(e,t="ALL_PEOPLE",n={})=>{const s={offset:0,count:20,scope:null,userId:null,siteId:null,subscription:null,type:null,ownerId:null,period:null};try{if(this._canExecSearch(e,t,n)){const a=this._initSearch(t);return a(e,this._getHash(e,t,n),n={...s,...n,..._[t].fixedParams})}throw new Error("Search can't be performed. Invalid search query or params")}catch(e){r.Z.promiseHandler(a)(e)}};static _initSearch=e=>{const t=this._getSearchByCategory(_[e].category);return this._currySearch(t)};static _canExecSearch=(e,t,n)=>{const a=!!e||"ALL_PEOPLE"===t,s=_?.[t]?.requiredParams.every((e=>n.hasOwnProperty(e)));return s&&a};static _getHash=(e,t,n)=>{const a={..._[t].fixedParams,offset:n.offset};return _[t].requiredParams.forEach((e=>{a[e]=n[e]})),(0,s.F)(t+JSON.stringify(a)+e)};static _getSearchByCategory=e=>{switch(e){case"people":return this._searchPeople;case"sites":return this._searchSites;case"posts":return this._searchPosts;case"ratedGroups":return this._searchRatedGroups;case"tags":return this._searchTags;case"channels":return this._searchChannels;default:return()=>{}}};static _currySearch=e=>(t,n,s)=>{const{offset:o,count:i}=s,l=o+i;let c=!1;return Promise.resolve(this._getСachedResult(n)).then((n=>n&&n.length>=l?n.slice(o,l):(c=!0,e(t,s)))).then((e=>(c&&!d.Z.isSSR()&&this._cacheResult(n,e),e))).catch(r.Z.promiseHandler(a))};static _searchPeople=async(e,t={})=>{try{return await p.Z.request({query:h.searchPeople,variables:{query:e,offset:t.offset,count:t.count,scope:t.scope,userId:t.userId,groupId:t.siteId},endpoint:{endpoint:"user",ver:"v2"},res:t.res,req:t.req})||[]}catch(e){r.Z.promiseHandler(a)(e)}};static _searchSites=async(e,t={})=>{try{return await p.Z.request({query:h.searchSites,variables:{query:e,subscription:t.subscription,count:t.count,offset:t.offset},endpoint:{endpoint:"blogs",ver:"v1"},res:t.res,req:t.req})||[]}catch(e){r.Z.promiseHandler(a)(e)}};static _searchRatedGroups=async(e,t={})=>{try{const n=await p.Z.request({query:h.searchRatedGroups,variables:{query:e,period:t.period},endpoint:{endpoint:"blogs",ver:"v1"},res:t.res,req:t.req});return l.Z._normalizeRatedGroups(n||{})}catch(e){r.Z.promiseHandler(a)(e)}};static _searchPosts=async(e,t={})=>{try{const n=await p.Z.request({query:h.searchPosts,variables:{query:e,type:t.type,ownerId:t.ownerId,count:t.count,offset:t.offset,channelId:t.channelId},endpoint:{endpoint:"main",ver:"v1"},res:t.res,req:t.req});return"full"===t.normalizerType?g.ZP.normalizePostList(n?.items):this._normalizeSearchResults(n?.items||[])}catch(e){r.Z.promiseHandler(a)(e)}};static _searchTags=async(e,t={})=>{try{const n=await p.Z.request({query:h.searchTags,variables:{search:e,limit:t.count,offset:t.offset,tagType:t.tagType||"ALL"},endpoint:{endpoint:"main",ver:"v3"},res:t.res,req:t.req});return m.Z.normalizeTags(n||[])}catch(e){r.Z.promiseHandler(a)(e)}};static _searchChannels=async(e,t={})=>{try{const n=await p.Z.request({query:h.searchChannels,variables:{query:e,limit:t.count,offset:t.offset},endpoint:{endpoint:"main",ver:"v3"},res:t.res,req:t.req});return u.ZP._normalizeChannels(n||[])}catch(e){r.Z.promiseHandler(a)(e)}};static _normalizeSearchResults(e){return e.map((e=>{let t,n;if(t||(t="post"===e.post_type?o.Z.truncateString(e.preview_text,300):e.previewText),"post"===e.post_type)n=e.title;else{n=JSON.parse(e.extraData||"{}").ed_title}return{id:e.id,url:e.seo_url||e.url,title:n,preview_text:t,photo_original:e?.attachments?.[0]?.photo?.photo_original,group:"post"===e.post_type?e.group:e.from,formattedDates:d.Z.setformattedDates(e.date),channel:e.channel}}))}static _getСachedResult=e=>this.searchCache.get(e);static _cacheResult=(e,t=[])=>{if(this.searchCache.size>=this._maxCache){const e=Array.from(this.searchCache)[this.searchCache.size-1];this.searchCache.delete(e[0])}const n=this._getСachedResult(e)||[];this.searchCache.set(e,[...n,...t])};static saveToHistory(e,t){if(!window?.localStorage)return;let n=this.getHistory(e);n=n.filter((e=>e!==t.toLowerCase())),n.push(t.toLowerCase()),n=[...new Set(n)],n.length>this._maxHistorySize&&n.shift(),window.localStorage.setItem(e,JSON.stringify(n))}static getHistory(e){const t=window?.localStorage?.getItem(e);return t?JSON.parse(t):[]}static deleteFromHistory(e,t){if(!window?.localStorage)return;let n=this.getHistory(e);return n=n.filter((e=>e!==t)),window.localStorage.setItem(e,JSON.stringify(n)),n}}const f=E},10581:(e,t,n)=>{"use strict";var a="/index.js";n.d(t,{Z:()=>h});n(71022),n(21943);var s=n(27361),r=n.n(s),o=n(30498),i=n(12684),l=n(93669),c=n(99871),m=n(54462),d=n(64962);
/**
 * Mirtesen.
 *
 * API interface for Site.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const p="metrics {\n        googleCheckingCode\n        googleAnalyticsAccountId\n        yandexMetricaAccountId\n        yandexWebmasterCheckingMetatag\n        statMediaId\n    }\n    site {\n        id\n        display_name\n        slogan\n        url\n        photo\n        tags\n        members_count\n        showSubscribersAmount\n        is_member\n        is_subscribed\n        is_admin\n        is_owner\n        is_staff\n        isBlocked\n        date_wages_start\n        can_view_members\n        canComment\n        canVote\n        can_join\n        canAddPostWithoutApprove\n        canAddPost\n        canViewBlogPostCreator\n        canViewContent\n        smi2SiteId\n        smi2RightBlock\n        smi2BottomBlock\n        smi2BottomBlock2\n        smi2BottomBlock3\n        smi2BottomBlock4\n        smi2BlogPostBlock\n        hideBanners\n        hideBottomPad\n        ramblerTop100CounterId\n    }\n    siteBuilder\n    groupBlogPostsModule {\n        allowVoteVislvl\n        allowContentVislvl\n        allowCommentVislvl\n        allowViewCreatorVislvl\n        premoderation\n    }",u={getBloggers:"query {\n        getBloggers\n    }",getDayPosts:"query {\n        getDayPosts {\n            items {\n               ###fields###\n            }\n        }\n    }",getRobots:"query getRobots(\n        $siteId: Float!\n    ) {\n        getRobots(id: $siteId)\n    }",getSiteByUrl:"query getSiteByUrl(\n        $url: String!\n    ) {\n        getSiteByUrl(url: $url) {\n            "+p+"\n        }\n    }",getSiteByUrlAnonymous:"query getSiteByUrlAnonymous(\n        $url: String!\n    ) {\n        getSiteByUrlAnonymous(url: $url) {\n            "+p+"\n        }\n    }",getMembershipStatus:`query getSiteById($id: Float!) {\n        getSiteById(id: $id) {\n            ${"site {\n        is_member\n        is_subscribed\n        is_admin\n        is_owner\n        is_staff\n        isBlocked\n    }"}\n        }\n    }`,getSiteSettings:"query getSiteSettings(\n        $siteId: Float!\n    ) {\n        getSiteSettings(site_id: $siteId)\n    }",mySitesList:"query mySitesList(\n        $count: Float,\n        $offset: Float,\n        $filter: filter\n    ) {\n        mySitesList(count: $count, offset: $offset, filter: $filter, counters: true) {\n            items {\n                id\n                name\n                display_name\n                url\n                unread_count\n                photo\n            }\n            total\n        }\n    }",ratedGroups:"query ratedGroups(\n        $page: Int,\n        $limit: Int\n    ) {\n        ratedGroups(\n            page: $page,\n            limit: $limit,\n            period: PERIOD_MONTH,\n            order_by: ORDER_BY_UNIQUE_VISITORS,\n            isMainpage: true\n        ) {\n            items {\n                id,\n                label,\n                url,\n                logo_url,\n                members_count\n                showSubscribersAmount\n                tags,\n                isStaff\n                isMember\n                isSubscribed\n                isModerator\n                isAdmin,\n                isSuperadmin\n            },\n            total\n        }\n    }",setRobots:"mutation setRobots(\n        $siteId: Float!,\n        $text: String!\n    ) {\n        setRobots(\n            id: $siteId,\n            robotstxt: $text\n        )\n    }",setSiteSettings:"mutation setSiteSettings(\n        $siteId: Float!,\n        $settings: String!\n    ) {\n        setSiteSettings(\n            site_id: $siteId,\n            settings: $settings\n        )\n    }",createSite:"mutation createGroup (\n        $prefix: String!,\n        $name: String!,\n        $tags: String!,\n        $description: String!,\n        $photoId: Float,\n        $slogan: String\n    ) { \n        createGroup (\n            prefix: $prefix,\n            name: $name, \n            tags: $tags,\n            description: $description,\n            photoId: $photoId,\n            slogan: $slogan\n        ) {\n            url\n            id\n            errors {\n                key\n                message\n                text\n            }\n        }\n    }"};class g{static defaultRobotsTxt=["User-agent: Mediapartners-Google","Disallow:","","User-agent: Google","User-agent: Yandex","Disallow: /objects/","Crawl-delay: 0.2","","User-agent: *","Disallow: /objects/","Crawl-delay: 1",""].join("\n");static allowLevels={none:-2,god:-1,self:0,moderator:0,friend:1,member:1,friendOfFriend:2,friendOfMember:2,confirmed:3,registered:4,any:9};static getByUrl(e,t=!1,n={}){const s=t?"getSiteByUrlAnonymous":"getSiteByUrl";return o.Z.request(u[s],{url:e},{endpoint:"blogs"},n.req,n.res).then((e=>e||Promise.reject("Get Site Response is empty"))).catch((e=>(i.Z.promiseHandler(a)(e),null)))}static getById(e,t={}){const n=`query {\n            getSiteById(id: ${e}) {\n                ${p}\n            }\n        }`;return o.Z.request(n,void 0,{endpoint:"blogs"},t.req,t.res).then((e=>e||Promise.reject("Get Site Response is empty"))).catch((e=>(i.Z.promiseHandler(a)(e),null)))}static getMembershipStatus(e,t={}){return o.Z.request(u.getMembershipStatus,{id:e},{endpoint:"blogs"},t.req,t.res).then((e=>e?.site?e.site:Promise.reject("Get Site Response is empty"))).catch((e=>(i.Z.promiseHandler(a)(e),null)))}getList=async(e=0,t=0,n="FILTER_MEMBER",s={})=>{try{return await o.Z.request({query:u.mySitesList,variables:{count:t,offset:e,filter:n},endpoint:{endpoint:"main",ver:"v2"},res:s.res,req:s.req})||[]}catch(e){i.Z.promiseHandler(a)(e)}};static async setSiteSettings(e,t,n={}){try{"object"==typeof t&&(t=JSON.stringify(t));const a=await o.Z.request({query:u.setSiteSettings,variables:{siteId:e,settings:t},endpoint:{endpoint:"blogs",ver:"v1"},res:n.res,req:n.req});if(a)return JSON.parse(a)}catch(e){i.Z.promiseHandler(a)(e)}return null}static async getSiteSettings(e,t={}){try{const n=await o.Z.request({query:u.getSiteSettings,variables:{siteId:e},endpoint:{endpoint:"blogs",ver:"v1"},res:t.res,req:t.req});return JSON.parse(n||{})}catch(e){i.Z.promiseHandler(a)(e)}}static async setRobotsTxt(e,t,n={}){try{const a=await o.Z.request({query:u.setRobots,variables:{siteId:e,text:t},endpoint:{endpoint:"blogs",ver:"v1"},res:n.res,req:n.req});if(a)return JSON.parse(a)}catch(e){i.Z.promiseHandler(a)(e)}}static async getRobotsTxt(e,t={}){try{const n=await o.Z.request({query:u.getRobots,variables:{siteId:e},endpoint:{endpoint:"blogs",ver:"v1"},res:t.res,req:t.req});if(n)return JSON.parse(n)}catch(e){i.Z.promiseHandler(a)(e)}}static getDefaultRobotsTxt(e){return[g.defaultRobotsTxt,`host: https://${e}`,""].join("\n")}static getTitle(e){return r()(e,"siteBuilder.mainHeader.props.title")||r()(e,"site.display_name")||""}static getBloggers=async(e={})=>{try{const t=await o.Z.request({query:u.getBloggers,endpoint:{endpoint:"blogs",ver:"v1"},res:e.res,req:e.req});if(t)return JSON.parse(t)}catch(e){i.Z.promiseHandler(a)(e)}};static getDayPosts=async e=>{const t=l.Z._getRequestFields(e),n=u.getDayPosts.replace("###fields###",t);try{const t=await o.Z.request({query:n,endpoint:{endpoint:"main",ver:"v1"},res:e.res,req:e.req});return t?.items||[]}catch(e){i.Z.promiseHandler(a)(e)}};static createSite=async({prefix:e,name:t,tags:n,description:s,photoId:r,slogan:l},c={})=>{try{return await o.Z.request({query:u.createSite,variables:{prefix:e,name:t,tags:n,description:s,slogan:l,photoId:r},endpoint:{endpoint:"blogs",ver:"v1"},res:c.res,req:c.req})}catch(e){i.Z.promiseHandler(a)(e)}};static getRatedGroups=async(e={})=>{try{const{page:t,limit:n,period:a,orderBy:s}=e,r=await o.Z.request({query:`query \n                {\n                  ratedGroups(\n                    page:${t},\n                    limit: ${n},\n                    period: ${a},\n                    order_by: ${s}\n                  ) {\n                    items {\n                      id,\n                      label\n                      url\n                      views\n                      unique_visitors\n                      logo_url\n                      members_count\n                      showSubscribersAmount\n                      isStaff\n                      isMember\n                      isSubscribed\n                      isModerator\n                      isAdmin\n                      isSuperadmin\n                      isOwner\n                    },\n                    total\n                  }\n                }`,endpoint:{endpoint:"blogs",ver:"v1"},res:e.res,req:e.req});return g._normalizeRatedGroups(r||{})}catch(e){i.Z.promiseHandler(a)(e)}};static _normalizeRatedGroups=e=>(e.items||[]).map((e=>({...e,display_name:e.label,photo_original:e.logo_url,is_staff:e.isStaff,is_member:e.isMember,is_subscribed:e.isSubscribed,is_moderator:e.isModerator,is_superadmin:e.isSuperadmin,is_owner:e.isOwner})));static isSiteMatch=(e,t=null)=>{const n=m.Z.getConfig(),a=r()(n,e,[]);if(t)return a.includes(t.toLowerCase());const s=m.Z.getStore();if(s){const{app:e}=s.getState(),t=r()(e,"req.host");return!!t&&a.includes(t.toLowerCase())}};static isMtDomain=()=>"undefined"!=typeof window&&null!==window.host.match(/mirtesen\.(ru|mt)$/);static isDomesticDomain=()=>"undefined"!=typeof window&&void 0!==window.mtBasedStore;static isForeignDomain=()=>"undefined"!=typeof window&&void 0===window.mtBasedStore;static addUtmToUrl(e=""){if("string"!=typeof e)return e;const t=m.Z.getConfig();return e.indexOf(t.channelDomain)>-1||e.indexOf("utm_referrer=mirtesen.ru")>-1?e:e.indexOf("?")>-1?`${e}&utm_referrer=mirtesen.ru`:`${e}?utm_referrer=mirtesen.ru`}static addMirtesenKeyToUrl(e,t,n=!1){const a=m.Z.getConfig();if("string"!=typeof e||!t)return e;const s=c.Z.parseUrl(e);return!n&&s.hostname.match(new RegExp("("+a.mainDomain+"|mirtesen.ru)$","i"))?e:e.indexOf("?")>-1?`${e}&mirtesenKey=${t}`:`${e}?mirtesenKey=${t}`}static replaceLocationWithMirtesenKey=(e,t={})=>{if("undefined"==typeof window)return;const n=t?.target||e?.currentTarget?.getAttribute("target")||"_self";let a=t?.href||e?.currentTarget?.getAttribute("href");const s=c.Z.parseUrl(a);return s?.hostname&&window.location.hostname.toLowerCase()!==s?.hostname.toLowerCase()&&(a=g.addMirtesenKeyToUrl(a,d.ZP.getMirtesenKey(),!0)),setTimeout((()=>{window.open(a,n)})),!1}}const h=g},99871:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});n(71022),n(21943),n(74754),n(5645),n(73101);var a=n(19248),s=n(88916),r=n(30381),o=n.n(r),i=n(47037),l=n.n(i),c=n(81763),m=n.n(c),d=n(84564),p=n.n(d),u=n(41750);
/**
 * Mirtesen.
 *
 * String helper.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class g{static stripTags(e=""){return e.replace(/(<([^>]+)>)/gim,"")}static disinfection(e){return l()(e)?e=(e=(e=(e=(e=(e=e.replace(/<a[^>]+?href[^>]+?javascript[^>]+?>/gis,"")).replace(/<[a-z]{1,12}[^>]*?(\son[a-z]+\s*?=[^>\/\s]*)/gis,"")).replace(/<script.*?>.*?<\/script>/gis,"")).replace(/<\/?script.*?>/gi,"")).replace(/<!--.*?-->/gis,"")).replace(/<!--.*?$/gis,""):e}static convertCookiesToString(e){let t="";for(const n in e)e.hasOwnProperty(n)&&(t+=a.serialize(n,e[n])+";");return t}static truncate(e,t=80,n=" ",a="…"){if(e.length<=t)return e;let s=e.substr(0,t-a.length);const r=s.lastIndexOf(n);return-1!==r&&(s=s.substr(0,r),0===s.length&&(s=e.substr(0,t))),a&&(s+=a),s}static truncateString(e="",t=20){return e?e.length<=t?e:e.substr(0,t-3)+"...":""}static truncateString2(e,t=80,n=" ",a="…"){const s=e.split(n);let r="";for(let e=0;e<s.length;e++){const a=this.trimAny(s[e],[n]);if(!(a.length<1)&&(r=r+a+n,r.length>t))break}" "===n&&(r=r.trim());const o=e.replace(n).length,i=r.replace(n).length;return o>i&&i>0&&(r+=a),r}static getStrSizeByLength=(e,t)=>{const n=e.split(" ").map((e=>e.length)),a=Math.max(...n),s=t.find((t=>a<=t.wordLimit&&e.length<=t.max));return{fontSize:s.fontSize,lineHeight:s.lineHeight}};static makeAcronym(e,t=2){const n="string"==typeof e&&e.match(/(^|\s)[\wа-я]/gi);if(!n)return"";return n.map((e=>e.trim())).join("").substr(0,t).toUpperCase()}static bdateToAge(e,t="years"){return o()().diff(o()(e,["DD.MM.YYYY","YYYY.MM.DD"]),t)}static formatBdate(e){let t=["год","года","лет"],n=g.bdateToAge(e);n<=0&&(t=["месяц","месяца","месяцев"],n=g.bdateToAge(e,"months"));return`${n} ${g.num2string(n,t)}`}static num2string(e,t){if(!m()(e))return"";const n=(e=Math.abs(e)%100)%10;return e>10&&e<20?t[2]:n>1&&n<5?t[1]:1===n?t[0]:t[2]}static escapeRegex(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}static isNormalInteger(e){e=String(e);const t=Math.floor(Number(e));return t!==1/0&&String(t)===e}static isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}static isEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}static cropImage(e,t=620,n=null,a="r"){if(!e)return e;const r=this.parseUrl(e);let o=r.pathname;if(-1===r.host.search(/mtdata\.ru$/i))return e;o=o.replace(/^\/?[rc][\d\-]+x[\d\-]+\//i,""),o=o.replace(/^\/+/,""),o=o.replace(/\/big\.(jpeg|png|jpg|gif|bmp|webp)$/i,"/original.$1");const i=parseInt((0,s.F)(o)[0],16);let l=parseInt(i/3,10);return l=l>5?5:l,l=l<1?"":l,e=`//r${l}.mtdata.ru/${a}${t=t||"-"}x${n=n||"-"}/${o}`}static possibleSourceExt="jpg|jpeg|png|gif|bmp|webp";static possibleTargetExt="webp|jpeg|j2k";static possibleSizes="av48|av80|av116|bp|wnd|qbp";static cropImage2(e,t={}){const{browser:n=null,size:a="bp"}=t;if(!e)return e;const r=this.parseUrl(e);let o=r.pathname;if(-1===r.host.search(/mtdata\.ru$/i)||!o.match(new RegExp(`original.(${g.possibleSourceExt})$`,"i")))return g.typeImage(e,n);let i=o.match(new RegExp(`.(${g.possibleSourceExt})$`,"i"));if(!i)return g.typeImage(e,n);i=i[1].toLowerCase(),o=o.replace(/^\/?[rc][\d\-]+x[\d\-]+\//i,""),o=o.replace(/^\/+/,""),o=o.replace(new RegExp(`/[^/]+?.(${g.possibleSourceExt})$`,"i"),"");const l=o;o=o.replace(/^[a-z](\d+)\//i,"r$1/");const c=parseInt((0,s.F)(o)[0],16);let m=parseInt(c/3,10);m=m>5?5:m,m=m<1?"":m;const d=u.Z.getStaticHost(`https://r${m}.mt.ru`);return"gif"===i?`${d}/${l}/original.gif`:g.typeImage(`${d}/${o}/${i}/${a}.jpeg`,n)}static typeImage(e,t){let n=this.parseUrl(e).pathname.match(new RegExp(`.(${g.possibleSourceExt})$`,"i"));if(!n)return e;n=n[1].toLowerCase();let a="jpeg";return["chrome","firefox","edge","opera","yandexbrowser","opera-mini","edge-chromium","chromium-webview","Googlebot","ios-webview","safari","ios"].includes(t)&&(a="webp"),n===a?e:g.canCropImage(e)?e.replace(new RegExp(`/(${g.possibleSizes}).(${g.possibleTargetExt})`,"i"),"/$1."+a):e}static canCropImage=e=>{const t=this.parseUrl(e);return t.host.search(/\.mt\.ru$/i)>-1&&t.pathname.match(new RegExp(`(${g.possibleSourceExt})/(${g.possibleSizes}).(${g.possibleTargetExt})$`,"i"))};static normalizeString(e=""){return e.trim().replace(/\s+/g," ")}static normalizeString2(e=""){return e.trim().replace(/(\s+)|(\n+)/g," ")}static toSlug(e=""){return e=(e=(e=(e=(e=(e=e.replace("/_/g","-")).replace(/([A-Z])/g,"-$1")).replace(/[^a-zA-Z0-9=\s—–-]+/g,"")).replace(/[=\s—–-]+/g,"-")).replace(/(^-|-$)/,"")).trim().toLowerCase()}static isPastYear(e=""){return!(o()(e).format("YYYY")===o()().format("YYYY"))}static isToday=e=>o()(e).format("DD.MM.YY")===o()().format("DD.MM.YY");static isYesterday=e=>o()(e).format("DD.MM.YY")===o()().subtract(1,"days").format("DD.MM.YY");static generateRandomtext(e=1){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let a=0;a<e;a++)t+=n.charAt(Math.floor(62*Math.random()));return t}static formatViewsCounter(e,t){let n,a;return(e=Number(e))>=1e6?(n=parseInt(e/1e5,10)/10,a="ru"===t?" млн.":"M"):e>=1e5?(n=parseInt(e/1e5*100,10),a="ru"===t?" тыс.":"K"):e>=1e3?(n=parseInt(e/1e3*10,10)/10,a="ru"===t?" тыс.":"K"):(n=e,a=""),n+a}static toBase64(e){return window.btoa(unescape(encodeURIComponent(e)))}static toUtf8(e){return decodeURIComponent(escape(window.atob(e)))}static extractUrl=e=>e.match(/https?:\/\/(www\\.)?[-a-z0-9@%._+~#=]{1,256}\.[a-z0-9]{1,6}\/[\-a-z0-9()@:%_\\+.~#?&\/=]*[a-z0-9\/#?&\-_]+/i)||[];static checkUrl=e=>{const t=new RegExp("^https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)$","i");return(e.match(t)||[]).length>0};static splitByTag=e=>e.split(/(<[^>]+>)/gi);static hasTag=e=>/<[^>]+>/i.test(e);static splitByDelimiter=(e,t,n)=>{const a=g.splitByTag(e);let s=0;const r=t,o="#####1111##1111#####";let i=r,l="",c=!1;for(const e of a){if(g.hasTag(e)||c){l+=e;continue}if(s+=e.length,s<r){l+=e,i-=e.length;continue}const t=new RegExp("^([\\s\\S]{"+i+",}?["+n+"]{1})(.*)","i"),a=e.replace(t,"$1"+o+"$2");a!==e&&(c=!0),l+=a}return l.split(o)};static fixProtocol=(e,t="https")=>{if(!e)return e;const n=e.match(/^(https?:)?\/\//)?.[0];return n?e.replace(n,t+"://"):t+"://"+e};static fixDevHost=e=>e?.replace(/\.mt$/,".ru");static parseUrl=e=>new(p())(this.fixProtocol(e));static hashString=(e="")=>{let t,n,a=0;if(0===e.length)return a;for(t=0;t<e.length;t++)n=e.charCodeAt(t),a=(a<<5)-a+n,a|=0;return a};static trimAny(e,t){let n=0,a=e.length;for(;n<a&&t.indexOf(e[n])>=0;)++n;for(;a>n&&t.indexOf(e[a-1])>=0;)--a;return n>0||a<e.length?e.substring(n,a):e}static numWithSpaces=e=>e?("string"!=typeof e&&(e=e.toString()),e.replace(/(\d)(?=(\d{3})+([^\d]|$))/g,"$1 ")):e;static isOnlyLettersInStr=e=>/^[A-zА-я]+$/.test(e)}const h=g},89835:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var a=n(12684),s=n(54462),r=n(99871);
/**
 * Mirtesen.
 *
 * Tarantool counter.
 *
 * @author       Alexey duybo.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class o{static host=r.Z.fixDevHost(s.Z.getStore()?.getState()?.app?.req?.host)||"mirtesen.ru";static getInfo(e,t){return fetch(`https://${o.host}/sc/i/${e}:${t}/`).then((e=>e.json())).catch(a.Z.promiseHandler("Abstract Counter/getInfo"))}static incrementField({entity:e,entityId:t,entityField:n,fieldCount:s=1,effect:r=!1}){return fetch(`https://${o.host}/sc/clinc/${e}:${t}/${r?"effect":"action"}:${n}/${s}`).then((e=>e.json())).catch(a.Z.promiseHandler("Abstract Counter/getInfo"))}}const i=o},81827:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});n(71022),n(21943),n(93811),n(5645),n(17312);var a=n(54462),s=n(99871);
/**
 * Mirtesen.
 *
 * URL parser.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class r{static isBaseDomainMatched(e){const t=a.Z.getConfig();return new RegExp("("+t.baseDomains.map((e=>s.Z.escapeRegex(e))).join("|")+")").test(e)}static getDomain(e){let t=e.split(".");if(t.length>4&&(t=[...t.slice(0,3),t.slice(3).join(".")]),t=t.filter((e=>"www"!==e)),t.length>2){const e=t.length,n=4===e?t[3].split("."):t[2].split(".");if(2===n.length)t.shift(),4===e&&t.shift();else if(1===n.length){const a=t.shift();if(2===n[0].length&&3===e&&t[0].length<=4)t.unshift(a);else{const e=["aero","arpa","asia","biz","cat","com","coop","edu","gov","info","jobs","mil","mobi","museum","name","net","org","post","pro","tel","travel","xxx"];t.length>2&&-1!==e.indexOf(n[0])&&t.shift()}}else for(let e=n.length;e>1;e--)t.shift()}else if(2===t.length){const e=t.shift();-1===t.join(".").indexOf(".")&&-1===["localhost","test","invalid"].indexOf(t[0])&&t.unshift(e)}return t.join(".")}static getParameterByName(e,t=null){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}static getCleanUrl=e=>e.replace(/#.*$/,"").replace(/\?.*$/,"");static addParameterToUrl=(e,t,n)=>-1!==e.indexOf("?")?`${e}&${t}=${n}`:`${e}?${t}=${n}`;static addPageParamToUrl=(e,t)=>{let n=e;return n=n.replace(/page=\d+/i,"").replace("?&","?").replace(/(&|\?)+$/,""),t>1&&(n=r.addParameterToUrl(n,"page",t)),n};static extractHostname=e=>{let t;return t=e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0],t=t.split(":")[0],t=t.split("?")[0],t}}const o=r},41750:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});n(71022),n(21943),n(26296),n(5645),n(53169),n(74754),n(73101),n(42181),n(36423);var a=n(27361),s=n.n(a),r=n(68929),o=n.n(r),i=n(99871),l=n(54462),c=n(33130),m=n(93649),d=n(30381),p=n.n(d);
/**
 * Mirtesen.
 *
 * Utils.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class u{static allowLevels={none:-2,god:-1,self:0,moderator:0,friend:1,member:1,friendOfFriend:2,friendOfMember:2,confirmed:3,registered:4,any:9};static isIframe(){try{return"undefined"!=typeof window&&window.location!==window.parent.location}catch(e){return!0}}static parseHeadersCookies(e){let t=this.parseRawCookies(e.get("set-cookie"));return t=t.map((e=>{const t={...e};return delete t.name,delete t.value,{name:e.name,value:e.value,options:t}})),t}static parseRawCookies(e){const t=[];return e?((e=(e=e.replace(/(sun|mon|tue|wed|thu|fri|sat), /gim,"$1!!!---!!!")).split(/, /gim)).forEach((e=>{if(!e)return;const n={};e.split(";").forEach(((e,t)=>{const a=e.split("="),s=o()(a[0].trim()),r=(a[1]||"").replace("!!!---!!!",", ").trim()||!0;0===t?(n.name=s,n.value=r):n[s]=r})),t.push(n)})),t):[]}static getCookie(e,t=null){if(t||"undefined"==typeof document||(t=document.cookie),!t)return null;const n=t.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return n?decodeURIComponent(n[1]):null}static setCookie(e,t,n){let a=(n=n||{}).expires;if("number"==typeof a&&a){const e=new Date;e.setTime(e.getTime()+1e3*a),a=n.expires=e}a&&a.toUTCString&&(n.expires=a.toUTCString()),n.path=n.path||"/";let s=e+"="+(t=encodeURIComponent(t));for(const e in n)if(n.hasOwnProperty(e)){s+="; "+e;const t=n[e];!0!==t&&(s+="="+t)}document.cookie=s}static timeout=e=>new Promise((t=>setTimeout(t,e)));static getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}static toBoolean(e){if("string"!=typeof e)return!!e;switch(e.toLowerCase().trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}static lazyLoad(e,t,n=null){return c.Z.lazyLoad(e,t,n)}static compose=(...e)=>t=>e.reduceRight(((e,t)=>t(e)),t);static stripTags(e){return e.replace(/<[^>]*>?/gm,"")}static loadModule(e,t){return c.Z.loadModule(e,t)}static loadScript(e,t){return c.Z.loadScript(e,t)}static validatePhoneNumber(e){return/^[+]?[(]?[0-9]{3}[)]?[-\s.]?[0-9]{3}[-\s.]?[0-9]{4,6}$/i.test(e)}static compare(e,t){if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(const n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n]){if("object"!=typeof e[n])return!1;if(!u.compare(e[n],t[n]))return!1}}for(const n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}static preparePersonPostPreview=(e,t)=>{const{mentionedPersons:n,previewText:a,body:r,attachments:o}=t;let i="";i=e?r||t.text:r?m.Z.stripTags(t.body).substr(0,300).trim():a,i=m.Z.plain2html(i,n);const l=s()(o,"0.link.url");return!i||l===t.text&&!t.shared_post?null:i};static getAttachments=e=>{let t=[];return t=e.shared_post&&e.shared_post.attachments?e.shared_post.attachments:e.attachments?e.attachments:null,t};static getPostAttachments=e=>e.attachments||[];static getRepostAttachments=e=>e.shared_post?.attachments||[];static getRepostSource=e=>{if(!e.shared_post)return null;switch(e.shared_post.post_type){case"user_post_rich":return e.shared_post.channel;case"user_post":return e.shared_post.from;case"post":return e.shared_post.group;default:return e.from}};static prepareRepostPreview=(e,t)=>{const n=e&&t.text?i.Z.truncateString(t.text,300):t.previewText;return n.length>=300?`<span>${n}...</span>`:`<span>${n}</span>`};static getObjectByParams=(e={},t=[],n=null)=>t.find((t=>Object.keys(e).every((n=>t[n]===e[n]))))||n;static getStaticHost=(e=null)=>{const t=l.Z.getConfig();return e=e||t.staticHost};static getLocalDate=(e,t)=>{if(!e)return"";const n=p()(e,"x",!0).isValid()?p().unix(e).format():p()(e).format();return p().utc(n).local().format(t)};static format99Plus=(e,t=99)=>e>t?`${t}+`:e;static scrollTo(e){if("undefined"==typeof window)return;if(this.isIframe())return void window.parent.postMessage({scroll:!0,offset:e},"*");const t=window.pageYOffset,n=e;let a=null;requestAnimationFrame((function e(s){null===a&&(a=s);const r=s-a,o=n<0?Math.max(t-r/.1,t+n):Math.min(t+r/.1,t+n);window.scrollTo(0,o),o!==t+n&&requestAnimationFrame(e)}))}
/*!
   * Find the differences between two objects and push to a new object
   * (c) 2019 Chris Ferdinandi & Jascha Brinkmann, MIT License, https://gomakethings.com & https://twitter.com/jaschaio
   * @param  {Object} obj1 The original object
   * @param  {Object} obj2 The object to compare against it
   * @return {Object}      An object of differences between the two
   */static diff(e,t){if(!t||"[object Object]"!==Object.prototype.toString.call(t))return e;const n={};let a;const s=(e,t,a)=>{const s=Object.prototype.toString.call(e),r=Object.prototype.toString.call(t);if("[object Undefined]"!==r)if(s===r)if("[object Object]"!==s)"[object Array]"!==s?"[object Function]"===s?e.toString()!==t.toString()&&(n[a]=t):e!==t&&(n[a]=t):((e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0})(e,t)||(n[a]=t);else{const s=this.diff(e,t);Object.keys(s).length>0&&(n[a]=s)}else n[a]=t;else n[a]=null};for(a in e)e.hasOwnProperty(a)&&s(e[a],t[a],a);for(a in t)t.hasOwnProperty(a)&&(e[a]||e[a]===t[a]||(n[a]=t[a]));return n}static isSSR=()=>!("undefined"!=typeof window&&window.document?.createElement);static setformattedDates=e=>({iso:p().unix(e).toISOString(),ver1:p().unix(e).format("D MMMM, H:mm"),ver2:p().unix(e).format("DD.MM.YYYY в H:mm"),ver3:p().unix(e).format("D MMM, H:mm")});static removeDuplicates=e=>{const t=[],n={};for(const t in e){const a=e[t];let s=((a?.title||"")+(a?.previewText||"")).substring(0,256);0===s.length&&(s=u.generateUuid()),n[s]||(n[s]=e[t])}for(const e in n)t.push(n[e]);return t};static loadWithFilter=async(e,t,n,a)=>{try{e=e||[];const{func:s,params:r}=n||{},{func:o,params:i}=a||{};let l=0,c=!0;for(;;){if(l>=10){c=!1;break}r.offset=t;const n=await s(r)||[];if(!n.length){c=!1;break}t++;const a=e.length;if(e=[...e,...n],o&&(e=o(e,i)),e.length!==a)break;l++}return{items:e,offset:t,hasMore:c}}catch(e){console.log(e)}};static generateUuid=()=>{let e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}}const g=u},21093:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var a=n(67294),s=n(45697),r=n.n(s),o=n(94184),i=n.n(o),l=n(2079),c=n(60982),m=n(43754);
/**
 * Mirtesen.
 *
 * Universal Dropdown Menu Component.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class d extends a.PureComponent{constructor(e){super(e),this.dropdownWrap=a.createRef(),this.dropdownList=a.createRef(),this.visibilityTimer=null,this.scrollTimer=null,this.resizeTimer=null,this.tabletWidth=768,this.mobileWidth=650,this.timeout=300,this.state={isActive:!1,isMobileMode:!1,isTabletMode:!1}}componentDidMount(){window.addEventListener("click",this.handleOutsideClick),window.addEventListener("keydown",this.handleEscapeKeydown),window.addEventListener("scroll",this.throttleScroll),window.addEventListener("resize",this.throttleResize),window.addEventListener("message",this.handleMessageEvent),this.throttleResize()}componentWillUnmount(){window.removeEventListener("click",this.handleOutsideClick),window.removeEventListener("scroll",this.throttleScroll),window.removeEventListener("resize",this.throttleResize),window.removeEventListener("message",this.handleMessageEvent),this.visibilityTimer&&clearTimeout(this.visibilityTimer),this.scrollTimer&&clearTimeout(this.scrollTimer),this.resizeTimer&&clearTimeout(this.resizeTimer)}handleMouseEnter=()=>{const{openByHover:e}=this.props,{isTabletWidth:t}=this.state;!t&&e&&this.handleOpenDropdown()};handleMouseLeave=()=>{const{openByHover:e}=this.props,{isTabletWidth:t}=this.state;!t&&e&&this.handleCloseDropdown(this.timeout)};handleSwitcherClick=()=>{const{openByHover:e}=this.props,{isTabletMode:t}=this.state,{isActive:n}=this.state;n?this.handleCloseDropdown():!t&&e||this.handleOpenDropdown()};handleOutsideClick=e=>{this.checkOutsideClick(e.target)&&this.handleCloseDropdown()};handleOpenDropdown=()=>{this.visibilityTimer&&clearTimeout(this.visibilityTimer),this.setState({isActive:!0})};handleCloseDropdown=e=>{const{onClose:t}=this.props;if(this.visibilityTimer&&clearTimeout(this.visibilityTimer),e)return this.visibilityTimer=setTimeout((()=>this.setState({isActive:!1})),e),void("function"==typeof t&&t());this.setState({isActive:!1}),"function"==typeof t&&t()};handleMessageEvent=e=>{const{id:t}=this.props,{isActive:n}=this.state,{type:a,id:s}=e.data||{};n&&s===t&&"mt-close-popup-menu"===a&&this.handleCloseDropdown()};handleEscapeKeydown=e=>{this.state.isActive&&!e.isComposing&&27===e.keyCode&&this.handleCloseDropdown()};handleScroll=()=>{const{closeAfterScroll:e}=this.props;this.state.isActive&&e&&this.handleCloseDropdown()};handleResize=()=>{const{isMobileMode:e,isTabletMode:t,isActive:n}=this.state,{closeAfterResize:a}=this.props,s=document.documentElement.clientWidth;s<this.mobileWidth&&!e&&this.setState({isMobileMode:!0}),s>=this.mobileWidth&&e&&this.setState({isMobileMode:!1}),s<=this.tabletWidth&&!t&&this.setState({isTabletMode:!0}),s>this.tabletWidth&&t&&this.setState({isTabletMode:!1}),n&&a&&this.handleCloseDropdown()};getToogleButtonProps=()=>{const{buttonProps:e,customButtonClasses:t}=this.props,{extraClasses:n,onClick:a,...s}=e;return{...s,type:"button",onClick:e=>{"function"==typeof a&&a(e),this.handleSwitcherClick()},className:i()("mt-dropdown-menu__btn",t,n)}};checkOutsideClick=e=>{const{openByHover:t,closeAfterClick:n}=this.props,{isTabletWidth:a,isActive:s}=this.state;if(!s||!a&&t)return!1;const r=this.dropdownWrap?.current&&this.dropdownWrap.current.contains(e),o=this.dropdownList?.current&&this.dropdownList.current.contains(e);return!r&&(!o||n)};throttleScroll=()=>{this.scrollTimer||(this.scrollTimer=setTimeout((()=>{this.scrollTimer=null,this.handleScroll()}),70))};throttleResize=()=>{this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout((()=>{this.handleResize()}),70)};render(){const{customDropdownClasses:e,customListClasses:t,customTooltipClasses:n,customTooltipWrapperClasses:s,buttonValue:r,hasMobileMode:o,children:d,placement:p,offset:u,onShow:g,openByHover:h,id:_,mobileBreakPoint:E}=this.props,{isActive:f,isMobileMode:b,isTabletMode:y}=this.state,v={"mt-dropdown-menu__list":!0,"mt-dropdown-menu__list_mobile":o&&b},T=h&&!y?this.timeout:0,{icon:S,label:P,...w}=this.getToogleButtonProps(),I=S||(r||P?"":"more");return a.createElement("div",{id:_,className:i()("mt-dropdown-menu",e,{active:f}),ref:this.dropdownWrap,onMouseLeave:this.handleMouseLeave,onMouseEnter:this.handleMouseEnter},a.createElement(l.Z,w,I&&a.createElement(c.Z,{iconName:I}),P||r),f&&a.createElement(m.Z,{target:this.dropdownWrap.current,offset:u,placement:p,enableMobile:!(!o||!b),onClose:this.handleCloseDropdown,className:n,wrapperClassName:s,onShow:g,delay:T,mobileBreakPoint:E},a.createElement("div",{ref:this.dropdownList,className:i()(v,t)},d)))}}d.defaultProps={id:"mt-dropdown-menu",openByHover:!1,closeAfterClick:!0,closeAfterResize:!0,closeAfterScroll:!0,customDropdownClasses:"",customListClasses:"",customButtonClasses:"",customTooltipClasses:"",buttonValue:"",buttonProps:{},hasMobileMode:!0,offset:[0,10],onClose:()=>{},onShow:()=>{}},d.propTypes={id:r().string,customDropdownClasses:r().string,customListClasses:r().string,customButtonClasses:r().string,buttonValue:r().oneOfType([r().string,r().object]),buttonProps:r().object,hasMobileMode:r().bool,openByHover:r().bool,children:r().any,placement:r().string,customTooltipClasses:r().string,customTooltipWrapperClasses:r().string,offset:r().arrayOf(r().number),closeAfterClick:r().bool,closeAfterResize:r().bool,closeAfterScroll:r().bool,onClose:r().func,onShow:r().func,mobileBreakPoint:r().number};const p=d},13691:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var a=n(67294),s=n(94184),r=n.n(s),o=n(45697),i=n.n(o),l=n(59481);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},c.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Core popup message.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class m extends a.PureComponent{static defaultProps={className:""};render(){const{children:e,className:t}=this.props,n=r()({"modal-popup":!0},t.split(","));return a.createElement(l.Z,c({},this.props,{className:n,enableModal:!0,show:!0}),e)}}m.propTypes={children:i().any,className:i().string};const d={children:i().oneOfType([i().element,i().string]),extraClasses:i().string};m.Header=({children:e,extraClasses:t})=>a.createElement("div",{className:r()("modal-header",t)},e),m.Header.propTypes=d,m.Title=({children:e,extraClasses:t})=>a.createElement("h5",{className:r()("modal-title",t)},e),m.Title.propTypes=d,m.Body=({children:e,extraClasses:t})=>a.createElement("div",{className:r()("modal-body",t)},e),m.Body.propTypes=d,m.Footer=({children:e,extraClasses:t})=>a.createElement("div",{className:r()("modal-footer",t)},e),m.Footer.propTypes=d;const p=m},59481:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});n(74754),n(5645),n(73101),n(71022),n(21943);var a=n(67294),s=n(94184),r=n.n(s),o=n(45697),i=n.n(o),l=n(73935),c=n(23493),m=n.n(c),d=n(60982);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},p.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Core popup message.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class u extends a.PureComponent{static defaultProps={enableModal:!0,enableMobile:!0,enableClose:!0,show:!1,position:null,link:null,className:"",wrapperClassName:"",buttons:[],inTimeout:500,outTimeout:0,mobileBreakpoint:650,onShow:null,onBeforeClose:null,onClose:null,onSubmit:null,onCancel:null,onToggle:null,onEnter:null,onLeave:null,onClick:null};constructor(e){super(e),this.state={showDOM:!1,showActive:!1,showHidden:!1,mobileMode:!1},this.modal=a.createRef(),this.mobileBreakpoint=e.mobileBreakpoint,this.elem=null,this.mouseDownEl=null,"function"==typeof this.onSubmit&&(this.onSubmit=this.onSubmit.bind(this)),"function"==typeof this.onCancel&&(this.onCancel=this.onCancel.bind(this)),"function"==typeof this.onClick&&(this.onClick=this.onClick.bind(this)),"function"==typeof this.onBeforeClose&&(this.onBeforeClose=this.onBeforeClose.bind(this)),"function"==typeof this.checkMobileMode&&(this.checkMobileMode=this.checkMobileMode.bind(this))}componentDidMount(){const{wrapperClassName:e}=this.props;this.elem=document.createElement("div"),e&&this.elem.classList.add(e),document.body.appendChild(this.elem),this.checkMobileMode(),window.addEventListener("resize",m()(this.checkMobileMode,70)),window.addEventListener("keydown",this.handleKeyPress),this.update(this.props.show)}componentDidUpdate(e){e.show!==this.props.show&&this.update(this.props.show)}componentWillUnmount(){const{enableModal:e}=this.props;document.body.removeChild(this.elem),window.removeEventListener("resize",m()(this.checkMobileMode,70)),window.removeEventListener("keydown",this.handleKeyPress),e&&this.turnOnScroll()}handleKeyPress=e=>{"Escape"===e.key&&this.update(!1)};checkMobileMode(){const e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;this.setState({mobileMode:e<this.mobileBreakpoint})}update(e){e!==this.state.showDOM&&(e?this.show():this.close())}show(){const{onShow:e,onToggle:t,enableModal:n}=this.props;setTimeout((()=>{if(n){const e=window.innerWidth-(document.documentElement.clientWidth||document.body.clientWidth);if(document.body.style.paddingRight=e+"px",document.body.style.overflow="hidden",document.body.style.overscrollBehaviorY="none",document.body.style.touchAction="none",this.state.mobileMode){const e=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${e}px`,document.body.style.width="100%"}}this.setState({showDOM:!0,showActive:!1,showHidden:!1},(()=>{this.setState({showActive:!0}),"function"==typeof e&&e(),"function"==typeof t&&t()}))}),0)}async close(){const{onBeforeClose:e,onClose:t,onToggle:n,outTimeout:a}=this.props;("function"!=typeof e||await e())&&(a>0?this.setState({showActive:!1,showHidden:!0},(()=>{setTimeout((()=>{this.setState({showDOM:!1,showHidden:!1}),"function"==typeof t&&t(),"function"==typeof n&&n()}),a)})):this.setState({showActive:!1,showHidden:!1,showDOM:!1},(()=>{"function"==typeof t&&t(),"function"==typeof n&&n()})))}onSubmit(){const{onSubmit:e,buttons:t=[]}=this.props,n=t.find((e=>"submit"===e.type)),{callback:a,autoClose:s=!1}=n||{};s&&this.update(!1),"function"==typeof a&&a(),"function"==typeof e&&e()}onCancel(){const{onCancel:e,buttons:t=[]}=this.props,n=t.find((e=>"cancel"===e.type)),{callback:a,autoClose:s=!0}=n||{};s&&this.update(!1),"function"==typeof a&&a(),"function"==typeof e&&e()}onClick(e){const{onClick:t}=this.props;"function"==typeof t&&t(e)}turnOnScroll=()=>{if(document.body.style.overflowY="auto",document.body.style.paddingRight="auto",document.body.style.overscrollBehaviorY="auto",document.body.style.touchAction="auto",this.state.mobileMode){const e=document.body.style.top;document.body.style.position="",document.body.style.top="",document.body.style.width="",window.scrollTo(0,-1*parseInt(e||"0",10))}};render(){const{className:e="",children:t,enableModal:n,enableMobile:s,enableClose:o,buttons:i,position:c,mobileTop:m}=this.props,{showDOM:u,showActive:g,showHidden:h,mobileMode:_}=this.state;if(!u||!this.elem)return null;let E=null;!c||s&&_||n||(E={top:c.top+"px",left:c.left+"px",transform:`translate(${c.translateX}%, ${c.translateY}%)`});const f=r()({popup:!0,popup_active:g,popup_hidden:h},e.split(","));let b=a.createElement("div",{ref:this.modal,className:f,style:E,onClick:e=>this.onClick(e)},o&&a.createElement("i",{className:"popup-close",onClick:()=>{this.update(!1)}},a.createElement(d.Z,{iconName:"close"})),a.createElement("div",{className:"popup-content"},t),Array.isArray(i)&&i.length>0&&a.createElement("div",{className:"popup-footer"},i.map(((e,t)=>{const{type:n,callback:s,className:o,autoClose:i,title:l,...c}=e,m={"popup-btn__submit":"submit"===n,"popup-btn__cancel":"cancel"===n};return a.createElement("button",p({key:t,className:r()(m,o),onClick:()=>{i&&this.update(!1),"function"!=typeof s||s()}},c),l)}))));return s&&_?b=a.createElement("div",{className:"popup-fade popup-fade_mobile-"+(m?"top":"bottom"),onTouchStart:e=>{this.mouseDownEl=e.target},onTouchEnd:e=>{e.stopPropagation(),e.target===this.mouseDownEl&&((" "+e.target.className+" ").replace(/[\n\t]/g," ").indexOf(" popup-fade ")>-1&&(this.mouseDownEl=null,this.update(!1)),this.mouseDownEl=e.target)}},b):n&&!_&&(b=a.createElement("div",{className:"popup-fade popup-fade_modal",onMouseDown:e=>{this.mouseDownEl=e.target},onMouseUp:e=>{e.target===this.mouseDownEl&&0===e.button&&(" "+e.target.className+" ").replace(/[\n\t]/g," ").indexOf(" popup-fade ")>-1&&(this.mouseDownEl=null,this.update(!1))}},b)),l.createPortal(b,this.elem)}}u.propTypes={enableModal:i().bool,enableMobile:i().bool,enableClose:i().bool,show:i().bool,className:i().string,wrapperClassName:i().string,children:i().any,onBeforeClose:i().func,onClose:i().func,onShow:i().func,onToggle:i().func,onSubmit:i().func,onCancel:i().func,onClick:i().func,buttons:i().arrayOf(i().object),position:i().object,outTimeout:i().number,mobileTop:i().bool,mobileBreakpoint:i().number};const g=u},43754:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var a=n(67294),s=n(20745),r=n(45697),o=n.n(r),i=n(59481),l=n(94184),c=n.n(l),m=n(88928),d=n(54462);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},p.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Comments widget.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class u extends a.PureComponent{constructor(e){super(e),this.state={show:!1,position:{top:0,left:0,translateX:0,translateY:0}},this.popupTimer=null,this.setPopupPosition=this.setPopupPosition.bind(this)}componentDidMount(){const{delay:e}=this.props;this.setPopupPosition(),this.popupTimer&&clearTimeout(this.popupTimer),this.popupTimer=setTimeout((()=>this.setState({show:!0})),e)}componentWillUnmount(){clearTimeout(this.popupTimer)}setPopupPosition=()=>{const{offset:e,placement:t,children:n}=this.props;let{target:r}=this.props;const[o]=e;if("undefined"==typeof document)return;const i=t.split("-");let l=i[0];const c=i[1];if("string"==typeof r&&(r=document.getElementById(r)),!r)return;const p=r.getBoundingClientRect();if("auto"===l){const t=document.createElement("div");t.classList.add("tooltip-popup"),document.body.appendChild(t);const i=s.s(t),p=(u=m.zt,g=()=>{"string"==typeof r&&(r=document.getElementById(r));const t=document.querySelector(".tooltip-popup");if(!r||!t)return;const n=r.getBoundingClientRect(),a=t.getBoundingClientRect();l=this.getAutoPlacement(a,n,o);try{document.body.removeChild(t)}catch(e){console.log(e)}this._setPopupPosition(n,c,l,e)},e=>{const{children:t,...n}=e;return(0,a.useEffect)((()=>{"function"==typeof g&&g()}),[]),a.createElement(u,n,t)});i.render(a.createElement(a.StrictMode,null,a.createElement(p,{store:d.Z.getStore()},n)))}else this._setPopupPosition(p,c,l,e);var u,g};getAutoPlacement=(e,t,n)=>{const a=document.documentElement.clientHeight||window.innerHeight,s=t.bottom+e.height+n,r=t.top-e.height-n;return a-s>=0||r<0?"bottom":"top"};_setPopupPosition=(e,t,n,a)=>{const[s,r]=a,o=Math.abs(document.body?.getBoundingClientRect()?.top)||window.scrollY,i={top:0,left:0,translateX:0,translateY:0};return"top"===n&&(i.top=e.top+o-r,i.translateY=-100),"bottom"===n&&(i.top=e.bottom+window.scrollY+r),"center"===n&&(i.top=e.top+e.height/2+window.scrollY-r,i.translateY=-50),"left"===t&&(i.left=e.left+window.scrollX-s),"right"===t&&(i.left=e.right+window.scrollX-s,i.translateX=-100),"center"===t&&(i.left=e.left+e.width/2+window.scrollX-s,i.translateX=-50),document.documentElement.clientWidth<=650&&(i.left=document.body.clientWidth/2,i.translateX=-50),this.setState({position:i})};render(){const{children:e,className:t,enableMobile:n,wrapperClassName:s,onClose:r}=this.props,{position:o,show:l}=this.state,m=c()({"tooltip-popup":!0},t.split(","));return a.createElement(i.Z,p({},this.props,{position:o,className:m,wrapperClassName:s,enableMobile:n,enableModal:!1,enableClose:!1,show:l,onClose:r,outTimeout:1}),e)}}u.defaultProps={offset:[0,0],placement:"auto-left",className:"",enableMobile:!0,delay:500,onClose:()=>{}},u.propTypes={children:o().any,target:o().oneOfType([o().object,o().string]),offset:o().arrayOf(o().number),placement:o().string,className:o().string,wrapperClassName:o().string,enableMobile:o().bool,delay:o().number,onClose:o().func};const g=u},40739:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var a=n(67294),s=n(45697),r=n.n(s),o=n(24635),i=n(81773),l=n(94184),c=n.n(l);
/**
 * Mirtesen.
 *
 * User logo. (If there is no logo, the background with initials will be shown)
 *
 * @author       Kukharev Yuri.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class m extends a.PureComponent{getAbbrByFirstAndLastName=(e="",t="")=>null!==e&&""!==e||null!==t&&""!==t?t?e?this.getFirstCharAndToUppercase(e).concat(this.getFirstCharAndToUppercase(t)):this.getFirstCharAndToUppercase(t):this.getFirstCharAndToUppercase(e):"";getFirstCharAndToUppercase(e=""){return"string"!=typeof e||""===e?"":e[0].toUpperCase()}getFirstAndLastName=e=>{let t="",n="";if(Array.isArray(e)&&(t=e[0],n=e.length>1?e[e.length-1]:""),"string"==typeof e){const a=e.split(" ");t=a[0],n=a.length>1?a[a.length-1]:""}return{firstName:t,lastName:n}};ignoredImgLinks(e,t){for(const n of t)if(!e||e.indexOf(n)>-1)return null;return e}render(){const{className:e=""}=this.props,{logoImg:t,logoUrl:n,linkTarget:s,logoClassName:r="",title:l,size:m,userName:d}=this.props.logoInfo,{firstName:p,lastName:u}=d?this.getFirstAndLastName(d):"",g=this.ignoredImgLinks(t,["//static.mtml.ru//images/blank_male_med.gif","//static.mtml.ru//images/blank_female_med.gif","//static.mtml.ru/images/blank_male.gif","//static.mtml.ru/images/blank_femail.gif"]),h=c()({userlogo:!0},r.split(","),e.split(",")),_=n?"a":"span",E=n?"a":"span",f=g?{backgroundImage:`url(${g})`}:{background:i.Z.getHSLGradientByName(p)};return g?a.createElement(o.Z,{tag:E,className:h,href:n,style:f,alt:l,target:s,size:m||"av48",src:g}):a.createElement(_,{className:h,href:n,style:f,title:l,target:s},!g&&this.getAbbrByFirstAndLastName(p,u))}}m.defaultProps={className:"",logoInfo:{userName:"",logoImg:"",logoUrl:"",linkTarget:"",logoClassName:"",title:"",size:"av48"}},m.propTypes={logoInfo:r().shape({userName:r().oneOfType([r().string,r().object,r().array]),logoImg:r().string,logoUrl:r().string,linkTarget:r().string,logoClassName:r().string,title:r().string,size:r().string}),className:r().string};const d=m},12629:(e,t,n)=>{"use strict";n.d(t,{O:()=>r});var a=n(67294),s=n(41750);const r=(e,t,n=(s.Z.isSSR()?void 0:window))=>{const r=(0,a.useRef)();(0,a.useEffect)((()=>{r.current=t}),[t]),(0,a.useEffect)((()=>{if(!(n&&n.addEventListener))return;const t=e=>r.current(e);return n.addEventListener(e,t),()=>{n.removeEventListener(e,t)}}),[e,n])}},55655:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var a=n(67294),s=n(45697),r=n.n(s),o=n(23729),i=n(47029);
/**
 * Mirtesen.
 *
 * Error Boundary Component.
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class l extends a.Component{constructor(e){super(e),this.state={error:null}}static getDerivedStateFromError(e){return{error:e}}render(){const e=this.state.error;if(e)throw e.bubble||"undefined"==typeof window||i.Z.isClientNetworkError(e)||(o.Z.logClientError({message:e.toString(),place:this.props.place,type:"error"}),e.bubble=!0),e;return this.props.children}}l.propTypes={place:r().string,children:r().any};const c=l;var m=n(54462);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * ErrorBoundary HOC.
 *
 * @author       Alexey Duybo.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const p=(e,t)=>(0,a.memo)((0,a.forwardRef)(((n,s)=>"production"===m.Z.getConfig().mode?a.createElement(c,{place:t},a.createElement(e,d({},n,{ref:s}))):a.createElement(e,d({},n,{ref:s})))))},28595:(e,t,n)=>{"use strict";var a={};n.r(a),n.d(a,{getPhoneLimitsByApi:()=>ye,loginByEmail:()=>Oe,loginByMirtesen:()=>xe,loginByPhone:()=>Ne,openAuthForm:()=>_e,registerByEmail:()=>ke,registerByPhone:()=>Me,resetAuthForm:()=>ve,resetTimer:()=>Ie,restorePassword:()=>Ae,setAuthFormTab:()=>Ee,setErrors:()=>be,setParams:()=>fe,startTimer:()=>Se,stopTimer:()=>Pe,stopTimers:()=>we,toggleAuthForm:()=>he});var s={};n.r(s),n.d(s,{groupsSetOrder:()=>PI,groupsSetPage:()=>wI,groupsSetPeriod:()=>SI,searchRatedGroups:()=>TI});n(98898),n(66337);var r=n(67294),o=n(20745),i=n(88928),l=n(30381),c=n.n(l),m=n(5964),d=n.n(m),p=(n(80008),n(21793),n(23493)),u=n.n(p),g=n(91033),h=(n(88449),n(2490),n(59849),n(94184)),_=n.n(h),E=n(45697),f=n.n(E),b=n(64962),y=n(99871);n(71022),n(21943),n(26296),n(5645),n(53169);
/**
 * Mirtesen.
 *
 * Stat table generation Component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class v extends r.PureComponent{render(){const{data:e,basics:t,totals:n}=this.props;return e.length?r.createElement("table",{className:"custom__table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",{className:"text-left"},"Период"),t.map(((e,t)=>r.createElement("th",{className:"text-left",key:t},e.label))),e[0].hasOwnProperty("amount")&&r.createElement("th",{className:"text-left"},"Заработок"))),r.createElement("tbody",null,r.createElement("tr",{key:e.length},r.createElement("td",{className:"custom__table__total"},"Итог"),t.map(((e,t)=>r.createElement("th",{className:"custom__table__total text-left",key:t},n[e.name]))),e[0].hasOwnProperty("amount")&&r.createElement("td",{className:"custom__table__total text-left"},n.amount)),e.map(((n,a)=>r.createElement("tr",{key:a},r.createElement("td",null,n.label),t.map(((e,t)=>r.createElement("th",{className:"text-left",key:t},n[e.name]))),e[0].hasOwnProperty("amount")&&r.createElement("td",{className:"text-left"},n.amount)))))):null}}v.propTypes={data:f().any,basics:f().any,totals:f().any};const T=v;
/**
 * Mirtesen.
 *
 * Stat Chart rendering Component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class S extends r.PureComponent{constructor(e){super(e),this.chartCanvas=(0,r.createRef)()}componentDidMount(){const{chartCanvas:e}=this;n.e(590).then(n.bind(n,98597)).then((t=>{new(0,t.default)(e.current,{type:"line",data:this.generateChartData(),options:this.chartOptions})}))}generateChartData=()=>{const{chartData:e,chartOptions:t}=this.props,n={datasets:[]};return n.labels=e.map((e=>e.label)),t.forEach(((t,a)=>{n.datasets.push({...this.lineOptions[a],label:t.label,data:e.map((e=>e[t.name]))})})),n};chartOptions={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},stacked:!1,plugins:{title:{display:!1},legend:{display:!1}}};lineOptions=[{cubicInterpolationMode:"monotone",borderColor:"rgba(220,220,220,1)",backgroundColor:"rgba(220,220,220,0.5)",borderWidth:1,fill:!0},{borderColor:"rgba(187,187,187,1)",backgroundColor:"rgba(187,187,187,0.5)",cubicInterpolationMode:"monotone"},{borderColor:"rgba(150,150,150,1)",backgroundColor:"rgba(150,150,150,0.8)",cubicInterpolationMode:"monotone"}];render(){return r.createElement("div",{className:"stat__chart",style:{height:"275px"}},r.createElement("canvas",{role:"img",ref:this.chartCanvas}))}}S.propTypes={chartData:f().any,chartOptions:f().any};const P=S;var w=n(33130);function I(){return I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},I.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * React Lazy implementation.
 *
 * @author       Alexey Duybo.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const C="undefined"!=typeof window,N=(e,t,n="default")=>{class a extends r.PureComponent{static propTypes={forwaredRef:f().any,onLoad:f().func};constructor(e){super(e),this.state={Component:null}}componentDidMount(){C&&w.Z.loadModule(e,t)().then((e=>{this.setState({Component:e[n||"default"]},this.handleLoad)}))}handleLoad=()=>{const{onLoad:e}=this.props;e&&e()};render(){if(!C)return null;const{Component:e}=this.state;if(!e)return null;const{forwaredRef:t,onLoad:n,...a}=this.props;return r.createElement(e,I({},a,{ref:t}))}}return(0,r.forwardRef)(((e,t)=>r.createElement(a,I({},e,{forwaredRef:t}))))};var O=n(13691),M=(n(98216),n(96751),n(88781),n(58368),n(24194),n(61968),n(64908),n(39256),n(48802),n(99695),n(42249),n(31870),n(95154),n(24064),n(87419),n(64627),n(16110)),k=n.n(M),A=n(47029),x=n(27361),L=n.n(x),D=n(12684),R=n(30498),Z="/index.js";const B=
/**
 * Mirtesen.
 *
 * Groups helper.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class{static periods=[["PERIOD_TODAY","Сегодня"],["PERIOD_YESTERDAY","Вчера"],["PERIOD_WEEK","Неделя"],["PERIOD_MONTH","Месяц"],["PERIOD_QUARTER","Квартал"],["PERIOD_YEAR","Год"],["PERIOD_CUSTOM","Период"]];static transformPeriods=["PERIOD_WEEK","PERIOD_MONTH","PERIOD_QUARTER","PERIOD_YEAR"];static timeframes=[["TIMEFRAME_HOURS","По часам"],["TIMEFRAME_DAYS","По дням"],["TIMEFRAME_WEEKS","По неделям"]];static statTypes={general:[{name:"groupViews",label:"Просмотры"},{name:"groupUniqueVisitors",label:"Посетители"}],mt:[{name:"groupMtAudienceViews",label:"Просмотры"},{name:"groupMtAudienceUniqueVisitors",label:"Посетители"}],self:[{name:"groupSelfAudienceViews",label:"Просмотры"},{name:"groupSelfAudienceUniqueVisitors",label:"Посетители"}],views:[{name:"groupViews",label:"Общая аудитория"},{name:"groupMtAudienceViews",label:"Миртесен аудитория"},{name:"groupSelfAudienceViews",label:"Собственная аудитория"}],uniqueViews:[{name:"groupUniqueVisitors",label:"Общая аудитория"},{name:"groupMtAudienceUniqueVisitors",label:"Миртесен аудитория"},{name:"groupSelfAudienceUniqueVisitors",label:"Собственная аудитория"}]};static getData=async(e={})=>{const t=e.objectId||0,n=e.period||"";try{const a=await R.Z.request({query:`query {\n                    objectStat(objectId: ${t},\n                          ${"PERIOD_CUSTOM"===n?"":`period: ${n}`},\n                          timeframe: ${e.timeframe},\n                          start_date: "${"PERIOD_CUSTOM"===n?e.periodFrom:""}",\n                          end_date: "${"PERIOD_CUSTOM"===n?e.periodTo:""}"\n                        ) {\n                      stat {\n                        label\n                        groupViews\n                        groupUniqueVisitors\n                        groupMtAudienceViews\n                        groupMtAudienceUniqueVisitors\n                        groupSelfAudienceViews\n                        groupSelfAudienceUniqueVisitors\n                      }\n                    }\n                  }`,endpoint:{endpoint:"main",ver:"v1"},req:e.req,res:e.res});return a?.stat}catch(e){if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(Z)(e)}};static getWages=async(e,t={})=>{const n=t.timeframe||"TIMEFRAME_DAYS",a=t.periodFrom||"2018-09-01",s=t.periodTo||"2018-09-11";try{const r=await R.Z.request({query:`query {\n                    groupWages(\n                          siteId: ${e},\n                          timeframe: ${n},\n                          startDate: "${a}",\n                          endDate: "${s}"\n                        ) {\n                        list {\n                          label\n                          amount\n                        }\n                        total\n                    }\n                  }`,endpoint:{endpoint:"blogs",ver:"v1"},req:t.req,res:t.res});return r?.list}catch(e){if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(Z)(e)}};static getSiteFinInfo=async(e,t={})=>{try{return await R.Z.request({query:`query {\n                    getSiteFinInfo(siteId: ${e}) {\n                        isMMBound\n                        canBindMM\n                        siteOwnerUrl\n                        siteOwnerName\n                        promoBalance\n                        wagesPromoBonuses\n                        wagesTotalBalance\n                        mmUserId\n                        billingUrl\n                    }\n                  }`,endpoint:{endpoint:"blogs",ver:"v1"},req:t.req,res:t.res})}catch(e){if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(Z)(e)}};static getViews=(e,t=!1,n="",a=!1)=>{const s=`https://trk.olnl.net/json?pairs=${e}${a?"&nc=1":""}${t?`&views=${e}&url=${n}`:""}`;return k()(s,{timeout:1e4}).then((e=>e.json())).then((e=>{const t={};if(!e||!L()(e,"pairs"))throw new Error(`View stats response error. Server: ${s}`);return e.pairs.map((([e,n,a,s,r])=>{t[e]={...t[e],[n]:{views:a,coverage:s,reads:r}}})),t})).catch((e=>{console.warn(e)}))}};var $=n(33813),U=n(23279),H=n.n(U);
/**
 * Mirtesen.
 *
 * Stat actions.
 *
 * @author       Sergey Khripunov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const F=e=>(t,n)=>{const{stat:a,app:s}=n(),{date_wages_start:r}=s.site;B.transformPeriods.includes(e.period)&&(e=j(e)),t({type:"STAT_LOADING"}),"TIMEFRAME_HOURS"!==a.current.timeframe&&r?Promise.all([B.getData(e),B.getWages(s.site.id,e)]).then((([e=[],n=[]])=>{let a=[];if(n.length)for(const e of n)a.push(e.label);if(e.length)for(const t of e)a.push(t.label);a=[...new Set(a)].sort();const s=[],r=[];for(const t of a){let a={label:t,amount:"-",groupMtAudienceUniqueVisitors:0,groupMtAudienceViews:0,groupSelfAudienceUniqueVisitors:0,groupSelfAudienceViews:0,groupUniqueVisitors:0,groupViews:0},o={label:t,amount:"-"};for(const n of e)n.label===t&&(a={...a,...n});for(const e of n)e.label===t&&(o={...o,...e},a.amount=e.amount);s.push(a),r.push(o)}return t({type:"STAT_UPDATE",rows:s,wages:r})})).catch((()=>t({type:"STAT_UPDATE",rows:[],wages:[]}))):Promise.resolve(B.getData(e)).then((e=>t({type:"STAT_UPDATE",rows:e,wages:[]}))).catch((()=>t({type:"STAT_UPDATE",rows:[],wages:[]})))},j=e=>{let t="";const n=c()().add(1,"days").format("YYYY-MM-DD");switch(e.period){case"PERIOD_WEEK":t=c()().add(-7,"days").format("YYYY-MM-DD");break;case"PERIOD_MONTH":t=c()().add(-31,"days").format("YYYY-MM-DD");break;case"PERIOD_QUARTER":t=c()().add(-90,"days").format("YYYY-MM-DD");break;case"PERIOD_YEAR":t=c()().add(-366,"days").format("YYYY-MM-DD")}return{...e,period:"PERIOD_CUSTOM",periodFrom:t,periodTo:n}};var G=n(21093);
/**
 * Mirtesen.
 *
 * Stat Container.
 *
 * @author       Sergey Khripunov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const q=N((()=>Promise.all([n.e(186).then(n.t.bind(n,273,23)),n.e(202).then(n.bind(n,52488))]).then((([e])=>e))),"reactDatepicker");class V extends r.PureComponent{constructor(e){super(e);const{periodFrom:t,periodTo:n}=e.stat.current;this.state={startDate:c()(t),endDate:c()(n),bindPopupOpen:!1,popupText:""}}componentDidMount(){const{onChangePeriod:e,initState:t,app:n}=this.props;t(n.site.id),e(B.periods[0][0])}handleChangeDate=(e,t)=>{const n=c()(e),{onChangePeriod:a,stat:s}=this.props,{state:r}=this;r[t]=n,this.setState(r);const{startDate:o,endDate:i}=r;if(o.isBefore(i)){const e=o.tz(c().tz.guess()).format("YYYY-MM-DD"),t=i.tz(c().tz.guess()).format("YYYY-MM-DD");a(s.current.period,e,t)}};handleCloseBindPopup=()=>{this.setState({bindPopupOpen:!1})};handleShowBindPopup=()=>{const{stat:e}=this.props;this.setState({bindPopupOpen:!0,popupText:`Привязать счет к сайту может только <a href="${e.siteOwnerUrl}">${e.siteOwnerName}</a>`})};handleCloseBindPopup=()=>{this.setState({bindPopupOpen:!1})};periodsButtons=()=>{const{stat:e,onChangePeriod:t}=this.props;return r.createElement("div",{className:"stat__button-group btn-group"},B.periods.map((n=>r.createElement("button",{className:_()({btn:!0,"btn-secondary":e.current.period!==n[0],"btn-primary":e.current.period===n[0]}),key:n[0],onClick:()=>t(n[0])},n[1]))))};salaryPeriodButtons=()=>{const{stat:e,onChangePeriod:t}=this.props,n=["PERIOD_TODAY","PERIOD_YESTERDAY","PERIOD_CUSTOM"];return r.createElement("div",{className:"stat__button-group btn-group"},B.periods.map((a=>n.includes(a[0])?null:r.createElement("button",{className:_()({btn:!0,"btn-secondary":e.current.period!==a[0],"btn-primary":e.current.period===a[0]}),key:a[0],onClick:()=>t(a[0])},a[1]))))};timeFramesButtons=()=>{const{stat:e,onChangeTimeframe:t}=this.props,n=new RegExp(e.current.timeframeEnabledMask);return r.createElement("div",{className:"stat__button-group btn-group"},B.timeframes.map((a=>r.createElement("button",{className:_()({btn:!0,"btn-secondary":e.current.timeframe!==a[0],"btn-primary":e.current.timeframe===a[0]}),key:a[0],onClick:()=>t(a[0]),disabled:!n.test(a[0])},a[1]))))};salaryChart=()=>{const{stat:e,app:t}=this.props;return t.site.date_wages_start?"TIMEFRAME_HOURS"===e.current.timeframe?"По часам нет данных, выберите другой период.":"Данные для показа отсутствуют.":r.createElement("div",{className:"text-center"},r.createElement("p",null,"Вы можете зарабатывать на вашем сайте вместе с Миртесен!"),r.createElement("p",null,"Узнать подробности можно обратившись по почте ",r.createElement("a",{href:"mailto:support@mirtesen.ru"},"support@mirtesen.ru")))};tabs={general:{text:"Общая аудитория"},mt:{text:"Миртесен аудитория"},self:{text:"Собственная аудитория"},views:{text:"Просмотры"},uniqueViews:{text:"Посетители"}};render=()=>{const{stat:e,onChangePeriod:t,onChangeStat:n}=this.props,{bindPopupOpen:a,popupText:s}=this.state,o=B.statTypes[e.activeStat];if(void 0===e.rows)return null;const i=[];return Object.entries(this.tabs).forEach((([e,t])=>{i.push(r.createElement("div",{key:e,onClick:()=>n(e)},t.text))})),r.createElement("div",{className:"stat"},a&&r.createElement(O.Z,{onClose:this.handleCloseBindPopup},r.createElement(O.Z.Body,null,r.createElement("div",{dangerouslySetInnerHTML:{__html:s}}))),r.createElement("div",{className:"stat__head"},r.createElement("h1",{className:"stat__title"},"Статистика"),r.createElement("div",{className:"stat__head__money"},e.isMMBound&&r.createElement(r.Fragment,null,"Аккаунт: ",r.createElement("a",{href:"https://moneymove.mirtesen.ru/"},e.mmUserId)),!e.isMMBound&&e.canBindMM&&r.createElement("a",{className:"btn btn-primary",href:e.billingUrl},"Привязать аккаунт"),!e.isMMBound&&!e.canBindMM&&r.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleShowBindPopup},"Привязать аккаунт"),e.promoBalance&&r.createElement("span",{className:"stat__head__money"},"Бонус: ",r.createElement("strong",null,e.promoBalance)," руб."))),r.createElement("div",{className:"stat__periods"},this.periodsButtons(t),this.timeFramesButtons()),"PERIOD_CUSTOM"===e.current.period&&r.createElement("div",{className:"stat__pickers"},r.createElement("span",{className:"stat__pickers__picker"},"От: ",r.createElement(q,{timeFormat:"HH:mm",timeIntervals:60,dateFormat:"dd.MM.yyyy",timeCaption:"Время",onChange:e=>this.handleChangeDate(e,"startDate"),selected:this.state.startDate.toDate()})),r.createElement("span",{className:"stat__pickers__picker"},"До: ",r.createElement(q,{timeFormat:"HH:mm",timeIntervals:60,dateFormat:"dd.MM.yyyy",timeCaption:"Время",onChange:e=>this.handleChangeDate(e,"endDate"),selected:this.state.endDate.toDate()}))),r.createElement("div",{className:"stat__chart-title"},r.createElement(G.Z,{customDropdownClasses:"stat__audience-dropdown",customButtonClasses:"btn btn-outline-secondary stat__audience-switcher",customListClasses:"stat__audience-list",placement:"auto-right",buttonValue:r.createElement(r.Fragment,null,this.tabs[e.activeStat].text,r.createElement("svg",{className:"svg-icon"},r.createElement("use",{href:"/images/icons.svg#angle-down"})))},i)),r.createElement("div",{className:"stat__chart-wrapper"},!!e.rows.length&&r.createElement(P,{chartData:e.rows,chartOptions:o}),!e.rows.length&&r.createElement("div",{className:"stat__interactive-popup"},e.loading?r.createElement("img",{src:"/images/loader.svg",alt:"Загружается..."}):r.createElement("span",null,"Данные для показа отсутствуют."))),r.createElement("h2",{className:"stat__chart-title"},"Заработок"),r.createElement("div",{className:"stat__chart-wrapper"},!!e.wages.length&&r.createElement(P,{chartData:e.wages,chartOptions:[{name:"amount",label:"Заработок"}]}),!e.wages.length&&r.createElement("div",{className:"stat__interactive-popup"},e.loading?r.createElement("img",{src:"/images/loader.svg",alt:"Загружается..."}):r.createElement(r.Fragment,null,this.salaryChart(),this.props.app.site.date_wages_start&&this.salaryPeriodButtons(t)))),r.createElement("div",null,r.createElement(T,{data:e.rows,basics:o,totals:e.total})))}}V.propTypes={stat:f().oneOfType([f().func,f().object]),onChangePeriod:f().func,onChangeTimeframe:f().func,app:f().object,initState:f().func,onChangeStat:f().func};const z=(0,i.$j)((e=>({stat:e.stat,site:e.app.site,app:e.app})),(e=>({onChangePeriod:(t,n,a)=>{e(((e,t="",n="")=>(a,s)=>{a({type:"STAT_CHANGE_PERIOD",period:e,periodFrom:t,periodTo:n});const r=s().stat;return a(F({objectId:r.objectId,period:r.current.period,periodFrom:r.current.periodFrom,periodTo:r.current.periodTo,timeframe:r.current.timeframe}))})(t,n,a))},onChangeTimeframe:t=>{e((e=>(t,n)=>{t({type:"STAT_CHANGE_TIMEFRAME",timeframe:e});const a=n().stat;return t(F({objectId:a.objectId,period:a.current.period,periodFrom:a.current.periodFrom,periodTo:a.current.periodTo,timeframe:a.current.timeframe}))})(t))},initState:t=>{e((e=>({type:"STAT_INIT_STATE",objectId:e}))(t))},onChangeStat:t=>{e((e=>({type:"STAT_SET_ACTIVE_STATE",activeStat:e}))(t))}})))(V);var W=n(86418),Y=n(91755),K=n(41750);
/**
 * Mirtesen.
 *
 * Auth Actions.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2017, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
let J=()=>{},X=()=>{};const Q=e=>(t,n)=>{const a=n().auth.user;(a?.id||null)!==(e?.user?.id||null)&&(X(),t({type:"AUTH_SET",auth:e}),J())},ee=e=>t=>{"function"==typeof e.onBeforeChange&&(X=e.onBeforeChange),"function"==typeof e.onChange&&(J=e.onChange),t(te())},te=(e={})=>async(t,n)=>{if("undefined"==typeof window)return;const{repeatTimeout:a,forceUpdate:s}=e,r=n().auth;if(void 0===r.user||s){const e=await ne(a);t(Q(e))}else t(Q(r))},ne=async(e,t=5)=>{let n=null,a=0;for(;!n?.user?.id&&a<t;){a++;try{n=await Y.Z.getAuthInfo()||null}catch(e){D.Z.promiseHandler("/index.js")(e)}await K.Z.timeout(e)}return n};var ae=n(55655);
/**
 * Mirtesen.
 *
 * Logout modal Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const se=(e="")=>({type:"LOGOUT_MODAL_OPEN",redirectUrl:e});var re=n(54462);
/**
 * Mirtesen.
 *
 * Logout modal.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const oe=(0,r.memo)((({logoutModal:e,onCloseModal:t})=>e.showModal&&r.createElement(O.Z,{onClose:t,className:"logout-modal"},r.createElement(O.Z.Body,null,r.createElement("h3",null,"Выход"),r.createElement("p",null,"Уже уходите? Так быстро..."),r.createElement("button",{className:"popup-btn__submit logout-modal__btn",onClick:async()=>{try{await b.ZP.logout();const t=re.Z.getConfig().mainDomain;window.location.href=window.location.protocol+"//"+(e.redirectUrl?e.redirectUrl:t)}catch(e){D.Z.promiseHandler("/index.js")(e)}}},"Выйти")))));oe.propTypes={logoutModal:f().object,onCloseModal:f().func};const ie=(0,i.$j)((e=>({logoutModal:e.logoutModal})),(e=>({onCloseModal:()=>{e({type:"LOGOUT_MODAL_CLOSE"})}})))(oe);var le=n(97779),ce=n(50361),me=n.n(ce);function de(){return de=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},de.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Widget.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */let pe=null;const ue=()=>(null===pe&&(pe=r.createContext("0")),pe);const ge=class{static getContext(){return ue()}static connect(e){const t=ue();return class extends r.Component{render(){return r.createElement(t.Consumer,null,(t=>r.createElement(e,de({},this.props,{widgetId:t}))))}}}static init(e){re.Z.getStore().dispatch({type:"WIDGET_INIT",widgetId:e})}static remove(e){re.Z.getStore().dispatch({type:"WIDGET_REMOVE",widgetId:e})}static reducer=(e,t,n)=>{switch(t&&t.type){case"WIDGET_INIT":{const a={...e};return a.instances[t.widgetId]={...me()(n)},a}case"WIDGET_REMOVE":{const n={...e};return delete n.instances[t.widgetId],n}default:return e}};static instanceReducer(e,t,n){const a={...e};if(a.instances[t]){const e={...a.instances[t]};n(e),a.instances[t]=e}return a}static instanceReducerAll(e,t){const n={...e};return Object.keys(n.instances).forEach((e=>{const a={...n.instances[e]};t(a,e),n.instances[e]=a})),n}};
/**
 * Mirtesen.
 *
 * AuthForm Actions.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const he=(e="0")=>({type:"AUTH_FORM_TOGGLE",widgetId:e}),_e=(e,t="0")=>({type:"AUTH_FORM_OPEN",activeTab:e,widgetId:t}),Ee=(e,t="0")=>({type:"AUTH_FORM_SET_TAB",activeTab:e,widgetId:t}),fe=(e,t,n="0")=>({type:"AUTH_FORM_SET_PARAMS",tab:e,params:t,widgetId:n}),be=(e,t,n="0")=>({type:"AUTH_FORM_SET_ERRORS",tab:e,errors:t,widgetId:n}),ye=e=>async(t,n)=>{const a=await Y.Z.getPhoneLimits(e);t({type:"AUTH_FORM_SET_PHONE_LIMITS",widgetId:n().authForm.widgetId,limits:a})},ve=()=>({type:"AUTH_FORM_RESET"}),Te={},Se=e=>(t,n)=>(Te[e]=setInterval((()=>{const a=n().authForm,s=a.widgetId,{timers:r}=a.instances[s].callAndSmsLimits,o=r[e];o<=0?clearInterval(Te[e]):t(Ce(e,o-1))}),1e3),{}),Pe=e=>(clearInterval(Te[e]),{}),we=()=>{for(const e in Te)Te.hasOwnProperty(e)&&Pe(e);return{}},Ie=(e,t)=>n=>(clearInterval(Te[e]),n(Ce(e,t))),Ce=(e,t)=>(n,a)=>{const s=a().authForm.widgetId;return n({type:"AUTH_FORM_SET_TIMER",timerKey:e,value:t,widgetId:s})},Ne=e=>Le((()=>Y.Z.loginByPhone(e)),"login"),Oe=e=>Le((()=>Y.Z.loginByEmail(e)),"loginByEmail"),Me=e=>Le((()=>Y.Z.registerByPhone(e)),"registration"),ke=e=>Le((()=>Y.Z.registerByEmail(e)),"registrationByEmail"),Ae=e=>Le((()=>Y.Z.restorePasswordByEmail(e)),"password"),xe=e=>Le((()=>Y.Z.loginByKey(e)),"login"),Le=(e,t)=>async n=>{n({type:"AUTH_FORM_BUSY"});let a=null;try{if(a=await e(),a.timerSms?(n(Ie("sms",60)),n(Se("sms"))):a.timerCall&&(n(Ie("call",60)),n(Se("call"))),!a.ok)throw new Error("Auth is not ok");n(ve()),n(te({forceUpdate:!0}))}catch(e){D.Z.promiseHandler("/index.js")(e),n({...a,type:"AUTH_FORM_RESULT",tab:t})}};
/**
 * Mirtesen.
 *
 * AuthFormWrapperEmbed Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class De extends r.Component{static propTypes={isOpen:f().bool,isBusy:f().bool,toggle:f().func,children:f().any};render(){const{isOpen:e,isBusy:t,children:n}=this.props;return e?r.createElement("div",{className:_()({"auth-form":!0,busy:t})},n,r.createElement("div",{className:"busy-layer"})):null}}const Re=De;
/**
 * Mirtesen.
 *
 * AuthFormWrapperModal Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Ze extends r.Component{static propTypes={isOpen:f().bool,isBusy:f().bool,toggle:f().func,wrapClassName:f().string,children:f().any};render(){const{isOpen:e,isBusy:t,toggle:n,children:a}=this.props;return e&&r.createElement(O.Z,{onClose:n,className:_()({"auth-form":!0,busy:t})},r.createElement(O.Z.Body,null,a))}}const Be=Ze;
/**
 * Mirtesen.
 *
 * AuthFormInputCode Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class $e extends r.PureComponent{static propTypes={id:f().string,name:f().string,value:f().string,mode:f().string,autoComplete:f().string,maxLength:f().number,error:f().string,onChange:f().func,onReset:f().func,onFocus:f().func,onBlur:f().func};static defaultProps={onChange:()=>{},onReset:()=>{},onFocus:()=>{},onBlur:()=>{}};constructor(e){super(e),this.input=r.createRef()}componentDidMount(){const e=this.input&&this.input.current;e&&e.focus()}render(){const{id:e,name:t,value:n,autoComplete:a,maxLength:s,error:o,onChange:i,onFocus:l,onBlur:c,onReset:m}=this.props,d=[];for(let e=0;e<s;e++)d.push(r.createElement("div",{key:e,className:"auth-form-input-code-frame"}));return r.createElement("div",{className:_()({"auth-form-input-code":!0,"is-invalid":!!o,"is-empty":!n})},r.createElement("input",{type:"text",name:t,value:n,id:e,ref:this.input,onChange:i,onFocus:l,onBlur:c,autoComplete:a,maxLength:s,className:"auth-form-input-code-control",required:!0}),r.createElement("div",{className:"auth-form-input-code-error"},o),r.createElement("div",{className:"auth-form-input-code-frames"},d),r.createElement("div",{className:"auth-form-input-code-common"},r.createElement("div",{className:"auth-form-input-code-bg-left"}),r.createElement("div",{className:"auth-form-input-code-bg-right"}),r.createElement("div",{className:"auth-form-input-close",onClick:m})))}}const Ue=$e;var He=n(87426),Fe=n(63876);const je=r.createContext();class Ge extends r.Component{static propTypes={id:f().string,titleKey:f().string,code:f().string,mode:f().string,phone:f().string,mainDomain:f().string,onSubmit:f().func};constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this),this.handleChangePhone=this.handleChangePhone.bind(this),this.handleResendCode=this.handleResendCode.bind(this)}componentDidUpdate(e){if(this.props.code&&this.props.code!==e.code&&this.props.code.length>=4){const e=document.activeElement;e&&e.blur(),this.handleSubmit()}}handleSubmit(e){const{setErrors:t}=this.context;e&&e.preventDefault();const{phone:n,code:a,mode:s}=this.props;if(a.length<4)return void t({code:"Введите код"});this.props.onSubmit({phone:n,code:a,mode:s,step:"code"})}handleChangePhone(){const{setParams:e}=this.context;e({step:"phone",phone:""})}handleResendCode(){const{setParams:e}=this.context;e({step:"phone"})}static contextType=je;render(){const{setParams:e,getErrors:t,callAndSmsLimits:n}=this.context,a=t(),{smsAllowed:s,callAllowed:o}=n?.apiLimits||{},{sms:i=0,call:l=0}=this.context?.callAndSmsLimits?.timers||{},{phone:c,code:m,mode:d,titleKey:p,id:u,mainDomain:g}=this.props;return r.createElement("div",{className:"auth-form__form"},r.createElement("div",{className:"auth-form__form__title"},p),r.createElement("form",{onSubmit:this.handleSubmit,noValidate:!0},r.createElement("div",{className:"auth-form-group-no-margin auth-form__form__body"},"CALL"===d?r.createElement(r.Fragment,null,r.createElement("div",null,"Сейчас поступит бесплатный звонок на номер"," ",r.createElement("span",null,Fe.Z.formatInternational(c))," ",r.createElement("span",{className:"auth-form__form__body__action",onClick:this.handleChangePhone},"(изменить)"),", ","введите последние 4 цифры номера")):r.createElement(r.Fragment,null,"SMS-сообщение отправлено на номер"," ",r.createElement("span",null,Fe.Z.formatInternational(c))," ",r.createElement("span",{className:"auth-form__form__body__action",onClick:this.handleChangePhone},"Изменить"))),r.createElement("div",{className:"auth-form-group auth-form__form__input-code"},r.createElement(Ue,{id:u+"Code",name:"code",value:m,mode:d,error:a.code,autoComplete:"off",maxLength:4,onChange:t=>{e({code:t.target.value.replace(/[^\d]/g,"")})},onReset:()=>{e({code:""})}})),s&&r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{label:i>0?"Получить новый код можно через 0:"+(i>9?"":"0")+i:"CALL"===d?"Получить код через SMS":"Получить новый код",color:"empty",disabled:i>0,onClick:e=>{e.preventDefault(),this.handleResendCode("SMS")}})),o&&r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{label:l>0?"Запросить звонок ещё раз через 0:"+(l>9?"":"0")+l:"Запросить бесплатный звонок",color:"empty",disabled:l>0,onClick:e=>{e.preventDefault(),this.handleResendCode("CALL")}})),r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{appearance:"link",label:"Служба поддержки",href:`https://${g}/feedback/report`,target:"_blank"}))))}}const qe=Ge;
/**
 * Mirtesen.
 *
 * AuthFormInput Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Ve extends r.PureComponent{static propTypes={id:f().string,name:f().string,type:f().string,value:f().string,onChange:f().oneOfType([f().func,f().bool]),onReset:f().oneOfType([f().func,f().bool]),onFocus:f().oneOfType([f().func,f().bool]),onBlur:f().oneOfType([f().func,f().bool]),autoComplete:f().string,maxLength:f().number,error:f().string,label:f().string,inputComponent:f().elementType.isRequired};static defaultProps={inputComponent:"input",onChange:null,onReset:null,onFocus:null,onBlur:null};constructor(e){super(e),this.handleChange=this.handleChange.bind(this),this.handleReset=this.handleReset.bind(this),this.handleFocus=this.handleFocus.bind(this),this.handleBlur=this.handleBlur.bind(this)}handleChange(e){const{name:t,onChange:n}=this.props,a=e.target.parentNode.firstChild.value,{setParams:s}=this.context;if(n)return n(e);{const e={};return e[t]=a,s(e),!0}}handleReset(e){const{name:t,onReset:n}=this.props,{setParams:a}=this.context;if(n)return n(e);{const e={};return e[t]="",a(e),!0}}handleFocus(e){const{onFocus:t}=this.props;return!t||t(e)}handleBlur(e){const{onBlur:t}=this.props;return!t||t(e)}static contextType=je;render(){const{id:e,name:t,type:n,value:a,autoComplete:s,maxLength:o,error:i,label:l}=this.props,c=this.props.inputComponent;return r.createElement("div",{className:_()("auth-form-input",{"is-invalid":!!i,"is-empty":!a})},r.createElement(c,{type:n,name:t,value:a,id:e,onChange:this.handleChange,onFocus:this.handleFocus,onBlur:this.handleBlur,autoComplete:s,maxLength:o,className:"auth-form-input-control",required:!0}),r.createElement("label",{className:"auth-form-input-label auth-form-input-label-default",htmlFor:e},l),r.createElement("div",{className:"auth-form-input-label auth-form-input-label-error"},i),r.createElement("div",{className:"auth-form-input-close",onClick:this.handleReset}))}}const ze=Ve;
/**
 * Mirtesen.
 *
 * AuthFormScreenPhone Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class We extends r.Component{static propTypes={id:f().string,titleKey:f().string,bodyKey:f().string,mode:f().string,phone:f().string,sendCode:f().func,autoComplete:f().string,children:f().any,tab:f().number};constructor(e){super(e),this.state={isBusy:!1,isReady:!1}}componentDidMount(){this.setState({isReady:!0})}handleSubmit=async(e,t)=>{const{phone:n,tab:a,sendCode:s}=this.props,{setErrors:r}=this.context,{isBusy:o}=this.state;if(e&&e.preventDefault(),o)return;if(this.setState({isBusy:!0}),!Fe.Z.validInternational(n))return r({phone:"Неверный формат"}),void this.setState({isBusy:!1});if("registration"===a){if((await Y.Z.checkPhoneLimits(n)).registered)return r({phone:"Телефон уже зарегистрирован"}),void this.setState({isBusy:!1})}await s({phone:n,mode:t,step:"phone"}),this.setState({isBusy:!1})};getPhoneLimitsMsg=()=>{const{smsAllowed:e,callAllowed:t,smsTimeLimitExceededMsg:n,callTimeLimitExceededMsg:a}=this.context?.callAndSmsLimits?.apiLimits||{};let s="";return e||t?e?t||(s=a||"К сожалению, для вашего номера доступно только смс"):s=n||"К сожалению, для вашего номера доступен только звонок":s="Невозможно авторизоваться по этому номеру телефона. Попробуйте позже",r.createElement("div",{className:"auth-form-group"},s)};static contextType=je;render(){const{phone:e,titleKey:t,bodyKey:n,id:a,children:s,autoComplete:o}=this.props,{isBusy:i,isReady:l}=this.state,{setParams:c,getErrors:m,getPhoneLimitsByApi:d,callAndSmsLimits:p}=this.context,{smsAllowed:u,callAllowed:g}=p?.apiLimits||{},{sms:h=0,call:_=0}=this.context?.callAndSmsLimits?.timers||{},E=m(),f=u||h>0,b=g||_>0;return r.createElement("div",{className:"auth-form__form"},r.createElement("div",{className:"auth-form__form__title"},t),r.createElement("form",{onSubmit:e=>this.handleSubmit(e,"SMS"),noValidate:!0},n&&r.createElement("div",{className:"auth-form-group auth-form__form__body"},n),r.createElement("div",{className:"auth-form-group auth-form__form__input"},r.createElement(ze,{id:a+"Phone",name:"phone",value:Fe.Z.formatInternational(e)||"+",onChange:e=>{const t=e.target.value;void 0!==t&&(c({phone:Fe.Z.extractInternational(t)}),d(t))},onFocus:e=>{""===e.target.value&&(c({phone:"+"}),setTimeout((()=>{e.target.setSelectionRange(1,1)}),50))},onBlur:e=>{"+"===e.target.value&&c({phone:""})},error:E.phone,label:"Номер телефона",autoComplete:o})),(!f||!b)&&this.getPhoneLimitsMsg(),f&&r.createElement("div",{className:"auth-form-group "+(h>0?"auth-form__form__submit-secondary":"auth-form__form__submit")},r.createElement(He.Z,{label:h<=0?"Получить код":`Получить новый код можно через 0:${h>9?"":"0"}${h}`,disabled:h>0||i||!l})),b&&r.createElement("div",{className:"auth-form-group "+(_>0?"auth-form__form__submit-secondary":"auth-form__form__submit")},r.createElement(He.Z,{label:_<=0?"Запросить бесплатный звонок":`Запросить звонок ещё раз через 0:${_>9?"":"0"}${_}`,color:f?"secondary":"primary",disabled:_>0||i||!l,onClick:e=>this.handleSubmit(e,"CALL")})),s))}}const Ye=We;
/**
 * Mirtesen.
 *
 * AuthFormSocial Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Ke extends r.Component{static propTypes={backurl:f().string,mainDomain:f().string,currentDomain:f().string,translate:f().func};render(){const{backurl:e,mainDomain:t,currentDomain:n}=this.props,a=encodeURIComponent(e);return r.createElement("div",{className:"auth-form-social"},r.createElement("p",null,"Войти с помощью соцсетей",":"),r.createElement("div",null,n&&n!==t&&"undefined"!=typeof window&&r.createElement("a",{href:"https://"+t+"/exauth/Mirtesen?backurl="+a+"&init=1&mirtesenKey=1",onClick:e=>{e.preventDefault(),window.open("https://"+t+"/exauth/Mirtesen?backurl=https://"+t+"/mirtesenru/close","_blank","width=350,height=400")},title:"МирТесен",className:"auth-form-social-btn auth-form-social-btn-mt",target:"_top"}),r.createElement("a",{href:"https://"+t+"/exauth/Mailru?backurl="+a+"&init=1&mirtesenKey=1",title:"Mail.ru",className:"auth-form-social-btn auth-form-social-btn-mr",target:"_top"}),r.createElement("a",{href:"https://"+t+"/exauth/Odnoklassniki?backurl="+a+"&init=1&mirtesenKey=1",title:"Одноклассники",className:"auth-form-social-btn auth-form-social-btn-ok",target:"_top"}),r.createElement("a",{href:"https://"+t+"/exauth/Vkontakte?backurl="+a+"&init=1&mirtesenKey=1",title:"Вконтакте",className:"auth-form-social-btn auth-form-social-btn-vk",target:"_top"})))}}const Je=Ke;
/**
 * Mirtesen.
 *
 * AuthFormLogin Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Xe extends r.Component{static propTypes={onSubmit:f().func,phone:f().string,code:f().string,mode:f().string,step:f().string,setAuthFormTab:f().func,mainDomain:f().string,backurl:f().string,currentDomain:f().string};render(){const{phone:e,code:t,mode:n,step:a,onSubmit:s,setAuthFormTab:o,mainDomain:i,backurl:l,currentDomain:c}=this.props;return"code"===a?r.createElement(qe,{id:"authFormLogin",titleKey:"Вход",code:t,mode:n,phone:e,onSubmit:s,mainDomain:i}):r.createElement(Ye,{id:"authFormLogin",titleKey:"Вход",mode:n,phone:e,sendCode:s,autoComplete:"tel",tab:"login"},r.createElement("div",{className:"auth-form-group auth-form__form__social"},r.createElement(Je,{backurl:l,mainDomain:i,currentDomain:c})),r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{label:"Вход по почте",onClick:()=>o("loginByEmail"),color:"empty"})),r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{label:"Регистрация",onClick:()=>o("registration"),color:"empty"})))}}const Qe=Xe;
/**
 * Mirtesen.
 *
 * AuthFormLoginByEmail Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class et extends r.Component{static propTypes={onSubmit:f().func,email:f().string,password:f().string,remember:f().string,errorMap:f().object,mainDomain:f().string,backurl:f().string,currentDomain:f().string,setAuthFormTab:f().func};constructor(e){super(e),this.state={isBusy:!1},this.handleSubmit=this.handleSubmit.bind(this)}handleSubmit(e){e.preventDefault();const{email:t,password:n,remember:a}=this.props;this.setState({isBusy:!0}),this.props.onSubmit({from:"headbutton",email:t,password:n,remember:a}),this.setState({isBusy:!1})}render(){const{email:e,password:t,errorMap:n,mainDomain:a,backurl:s,currentDomain:o,setAuthFormTab:i}=this.props;return r.createElement("div",{className:"auth-form__form"},r.createElement("div",{className:"auth-form__form__title"},"Вход"),r.createElement("form",{onSubmit:this.handleSubmit,noValidate:!0},r.createElement("div",{className:"auth-form-group auth-form__form__input"},r.createElement(ze,{id:"authFormLoginByEmailEmail",name:"email",type:"text",value:e,error:n.email,label:"Электронная почта",autoComplete:"username"})),r.createElement("div",{className:"auth-form-group auth-form__form__input"},r.createElement(ze,{id:"authFormLoginByEmailPassword",name:"password",type:"password",value:t,error:n.password,label:"Пароль",autoComplete:"current-password"})),r.createElement("div",{className:"auth-form-group auth-form__form__submit"},r.createElement("button",{className:"btn btn-primary"},"Войти")),r.createElement("div",{className:"auth-form-group auth-form__form__social"},r.createElement(Je,{backurl:s,mainDomain:a,currentDomain:o})),r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{label:"Забыли пароль?",color:"empty",onClick:()=>i("password")})),r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{label:"Вход по телефону",color:"empty",onClick:()=>i("login")})),r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{label:"Регистрация",color:"empty",onClick:()=>i("registration")}))))}}const tt=et;
/**
 * Mirtesen.
 *
 * AuthFormRegistration Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class nt extends r.Component{static propTypes={onSubmit:f().func,name:f().string,lastname:f().string,email:f().string,code:f().string,mode:f().string,phone:f().string,step:f().string,setAuthFormTab:f().func,mainDomain:f().string,backurl:f().string,currentDomain:f().string};constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this)}handleSubmit(e){e.preventDefault();const{name:t,lastname:n,email:a,phone:s,code:r,mode:o,step:i}=this.props;this.props.onSubmit({name:t,lastname:n,email:a,phone:s,code:r,mode:o,step:i})}static contextType=je;render(){const{name:e,lastname:t,email:n,phone:a,code:s,mode:o,step:i,onSubmit:l,mainDomain:c,setAuthFormTab:m,backurl:d,currentDomain:p}=this.props,{getErrors:u}=this.context,g=u();return"personal"===i?r.createElement("div",{className:"auth-form__form"},r.createElement("div",{className:"auth-form__form__title"},"Регистрация"),r.createElement("form",{onSubmit:this.handleSubmit,noValidate:!0},r.createElement("div",{className:"auth-form-group auth-form__form__body"},"Укажите имя, фамилию и почту, чтобы иметь возможность комментировать и оценивать публикации"),r.createElement("div",{className:"auth-form-group auth-form__form__input"},r.createElement(ze,{id:"authFormRegName",name:"name",type:"text",value:e,error:g.name,label:"Имя"})),r.createElement("div",{className:"auth-form-group auth-form__form__input"},r.createElement(ze,{id:"authFormRegLastName",name:"lastname",type:"text",value:t,error:g.lastname,label:"Фамилия"})),r.createElement("div",{className:"auth-form-group auth-form__form__input"},r.createElement(ze,{id:"authFormRegEmail",name:"email",type:"text",value:n,error:g.email,label:"Электронная почта"})),r.createElement("div",{className:"auth-form-group auth-form__form__submit"},r.createElement("button",{className:"btn btn-primary"},"Зарегистрироваться")))):"code"===i?r.createElement(qe,{id:"authFormReg",titleKey:"Регистрация",code:s,mode:o,phone:a,onSubmit:l,mainDomain:c}):r.createElement(Ye,{id:"authFormReg",titleKey:"Регистрация",mode:o,phone:a,sendCode:l,autoComplete:"off",tab:"registration"},r.createElement("div",{className:"auth-form-group auth-form__form__info"},"Регистрируясь, вы принимаете"," ",r.createElement("a",{target:"_blank",href:"//"+c+"/agreement"},"соглашение")," ","и даёте согласие на обработку своих"," ",r.createElement("a",{target:"_blank",href:"//"+c+"/privacy"},"персональных данных")),r.createElement("div",{className:"auth-form-group auth-form__form__social"},r.createElement(Je,{backurl:d,mainDomain:c,currentDomain:p})),r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{label:"Регистрация по почте",color:"empty",onClick:()=>m("registrationByEmail")})),r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{label:"Вход",color:"empty",onClick:()=>m("login")})))}}const at=nt;n(35014),n(31331);var st=n(98066),rt=n.n(st),ot=n(45088);
/**
 * Mirtesen.
 *
 * Tooltip component.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 *
 *    <Tooltip
 *    target='topics-menu-title'
 *    // not work here - target={ReactDOM.findDOMNode(this.topicMenuTitle.current)}
 *    placement='right-start'
 *    title='Новое в Миртесен!'
 *    content='Заходите и читайте интересные Тематические топики'
 *    behavior='popup'
 *    colorScheme='blue'
 *    allowedDomains={['mtest.ru', '4vkusa.ua']}
 *    // className = 'my-super-class'
 *    />
 *
 *    <Tooltip
 *    target='topics-menu-list'
 *    placement='right-start'
 *    title='Новое в Миртесен!'
 *    content='Заходите и читайте интересные Тематические топики'
 *    behavior='tooltip'
 *    colorScheme='black'
 *    />
 */
class it extends r.PureComponent{static defaultProps={target:null,placement:"top-start",title:null,content:null,behavior:"tooltip",className:null,id:null,maxShowCount:-1,allowedDomains:null,offset:null,colorScheme:null,popupColorScheme:"blue",tooltipColorScheme:"black",moreBtn:null,hideArrow:!1,onShow:null,onClose:null,onOk:null,onCancel:null};constructor(e){super(e),this.instance=null,this.options={}}componentDidMount(){const{id:e,target:t,title:n,content:a,placement:s,className:r,offset:o,behavior:i,moreBtn:l,hideArrow:c,interactive:m,onShow:d,onClose:p,onOk:u,onCancel:g}=this.props;let{colorScheme:h}=this.props;if(!t||!this.checkDomain())return;h=this._getColorScheme(h,i);let _=null;n&&a?_=`\n                 <div class='tooltip-inner__title'>${n}</div>\n                 <div class='tooltip-inner__content'>${a}</div>\n             `:n?_=`<div class='tooltip-inner__title'>${n}</div>`:a&&(_=`<div class='tooltip-inner__content'>${a}</div>`);const E={allowHTML:!0,content:_,placement:s,offset:o||[0,0],trigger:"mouseenter focus",interactive:m,animation:!1,onShow(){"function"==typeof d&&d()},render(t){const n=document.createElement("div"),a=document.createElement("div");if(n.classList.add(...it._getPopperClasses({behavior:i,colorScheme:h,className:r})),a.classList.add("tooltip-inner"),"popup"===i){const t=document.createElement("i");t.classList.add("tooltip-close","svg-tooltip-close"),t.setAttribute("id","tooltip-close"+(e?"-"+e:"")),n.appendChild(t)}if(!c){const e=document.createElement("div");e.classList.add("tooltip-arrow"),e.setAttribute("data-popper-arrow",""),n.appendChild(e)}if(n.appendChild(a),l){const t=document.createElement(l.url?"a":"span");t.href=l.url||void 0,t.setAttribute("id","tooltip-more"+(e?"-"+e:"")),t.classList.add("tooltip__btn"),t.textContent=l.text,n.appendChild(t)}return a.innerHTML=t.props.content,{popper:n,onUpdate:function(e,t){e.content!==t.content&&(a.innerHTML=t.textContent)}}}};"popup"===i&&(E.trigger="manual",E.showOnCreate=!0,E.interactive=!0,E.appendTo=()=>document.body),this.options=E,this.instance=it.initTooltip(t,this.options),"popup"===i&&e&&rt()((()=>{document.getElementById("tooltip-close-"+e).addEventListener("click",(e=>{e.preventDefault(),this.dropTooltipInstance(),"function"==typeof p&&p(),"function"==typeof g&&g()})),l&&document.getElementById("tooltip-more-"+e).addEventListener("click",(e=>{e.preventDefault(),l.url&&window.open(l.url,"_self"),this.dropTooltipInstance(),"function"==typeof u&&u(),"function"==typeof p&&p()}))}),2e3)}componentDidUpdate(){const{target:e}=this.props,t="string"==typeof e?document.getElementById(e):e;e&&t?this.instance||(this.instance=it.initTooltip(e,this.options)):this.dropTooltipInstance()}componentWillUnmount(){this.dropTooltipInstance()}static _getPopperClasses=({behavior:e,colorScheme:t,className:n})=>{const a=["tooltip",`tooltip_${e}`,`tooltip_${t}`];return n&&a.push(n),a};_getColorScheme=(e,t)=>e||{tooltip:"black",popup:"blue"}[t];dropTooltipInstance(){this.instance&&(this.instance.hide(),this.instance.unmount(),this.instance.clearDelayTimeouts(),this.instance.destroy(),this.instance=null)}static initTooltip(e,t){if(!e)return null;const n="string"==typeof e?document.getElementById(e):e;return n?(0,ot.ZP)(n,t):null}checkDomain(){let{allowedDomains:e}=this.props;const t=window.location.hostname;return!e||("string"==typeof e&&(e=[e]),e.some((e=>new RegExp(e+"$").test(t))))}render(){return null}}it.propTypes={target:f().string,title:f().string,content:f().string,placement:f().string,behavior:f().string,colorScheme:f().string,className:f().string,id:f().oneOfType([f().number,f().string]),allowedDomains:f().oneOfType([f().string,f().array]),offset:f().arrayOf(f().number),interactive:f().bool,moreBtn:f().object,hideArrow:f().bool,onShow:f().func,onClose:f().func,onOk:f().func,onCancel:f().func};const lt=it;
/**
 * Mirtesen.
 *
 * AuthFormRegistrationByEmail Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ct extends r.Component{static propTypes={onSubmit:f().func,errorMap:f().object,email:f().string,name:f().string,phone:f().string,code:f().string,mode:f().string,step:f().string,mainDomain:f().string,backurl:f().string,currentDomain:f().string,setAuthFormTab:f().func,toggleAuthForm:f().func};constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this)}handleSubmit(e){e.preventDefault(),this.setState({isBusy:!0});const{name:t,email:n,phone:a,code:s,mode:r,step:o}=this.props,i={from:"headbutton",name:t,email:n,phone:a,code:s,mode:r,step:o};this.props.onSubmit(i),this.setState({isBusy:!1})}static contextType=je;render(){const{name:e,email:t,step:n,phone:a,code:s,mode:o,mainDomain:i,backurl:l,currentDomain:c,setAuthFormTab:m,toggleAuthForm:d,onSubmit:p}=this.props,{setParams:u,getErrors:g}=this.context,h=g();return"code"===n?r.createElement(qe,{id:"authFormRegByEmail",titleKey:"Защитите свой аккаунт",code:s,mode:o,phone:a,onSubmit:p,mainDomain:i}):"phone"===n?r.createElement(Ye,{id:"authFormRegByEmail",titleKey:"Защитите свой аккаунт",bodyKey:"Укажите свой номер телефона, чтобы защитить свой аккаунт. В дальнейшем вы можете его использовать в качестве логина для авторизации.",mode:o,phone:a,sendCode:p,autoComplete:"off",tab:"registrationByEmail"},r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{color:"empty",label:"Не сейчас",onClick:d}))):"email"===n?r.createElement("div",{className:"auth-form__form"},r.createElement("div",{className:"auth-form__form__title"},"Проверьте почту"),r.createElement("div",{className:"auth-form-group auth-form__form__email"}),r.createElement("div",{className:"auth-form-group auth-form__form__body"},"На указанный адрес"," ",r.createElement("a",{href:"mailto:"+t},t)," ","было отправлено письмо, содержащее пароль и ссылку для подверждения регистрации"),r.createElement("div",{className:"auth-form-group auth-form__form__submit"},r.createElement("button",{type:"button",className:"btn btn-primary",onClick:()=>u({step:"phone"})},"Далее"))):r.createElement("div",{className:"auth-form__form"},r.createElement("div",{className:"auth-form__form__title"},"Регистрация"),r.createElement("form",{onSubmit:this.handleSubmit,noValidate:!0},r.createElement("div",{className:"auth-form-group auth-form__form__input"},r.createElement(ze,{id:"authFormRegByEmailName",name:"name",type:"text",value:e,error:h.name,label:"Имя"}),r.createElement(lt,{target:"authFormRegByEmailName",id:"authFormRegByEmailName",content:"Только имя без пробелов",behavior:"tooltip",placement:"top-start",offset:[0,10]})),r.createElement("div",{className:"auth-form-group auth-form__form__input"},r.createElement(ze,{id:"authFormRegByEmailEmail",name:"email",type:"text",value:t,error:h.email,label:"Электронная почта",autoComplete:"off"})),r.createElement("div",{className:"auth-form-group auth-form__form__submit"},r.createElement("button",{className:"btn btn-primary"},"Зарегистрироваться")),r.createElement("div",{className:"auth-form-group auth-form__form__info"},"Регистрируясь, вы принимаете"," ",r.createElement("a",{target:"_blank",href:"//"+i+"/agreement"},"соглашение")," ","и даёте согласие на обработку своих"," ",r.createElement("a",{target:"_blank",href:"//"+i+"/privacy"},"персональных данных")),r.createElement("div",{className:"auth-form-group auth-form__form__social"},r.createElement(Je,{backurl:l,mainDomain:i,currentDomain:c})),r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{color:"empty",label:"Регистрация по телефону",onClick:()=>m("registration")})),r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{color:"empty",label:"Вход",onClick:()=>m("login")}))))}}const mt=ct;
/**
 * Mirtesen.
 *
 * Password From Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class dt extends r.Component{static propTypes={onSubmit:f().func,errorMap:f().object,email:f().string,step:f().string,mainDomain:f().string};constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this)}handleSubmit(e){e.preventDefault();const{email:t,step:n}=this.props,a={email:t,step:n};this.props.onSubmit(a)}render(){const{errorMap:e,email:t,step:n,mainDomain:a}=this.props;return"email"===n?r.createElement("div",{className:"auth-form__form"},r.createElement("div",{className:"auth-form__form__title"},"Проверьте почту"),r.createElement("div",{className:"auth-form-group auth-form__form__email"}),r.createElement("div",{className:"auth-form-group auth-form__form__body"},"На указанный адрес"," ",r.createElement("a",{href:"mailto:"+t},t)," ","было отправлено письмо с данными для восстановления")):r.createElement("div",{className:"auth-form__form"},r.createElement("div",{className:"auth-form__form__title"},"Восстановление пароля"),r.createElement("form",{onSubmit:this.handleSubmit,noValidate:!0},r.createElement("div",{className:"auth-form-group auth-form__form__body"},"Введите электронную почту, указанную при регистрации"),r.createElement("div",{className:"auth-form-group auth-form__form__input"},r.createElement(ze,{id:"authFormPasswordEmail",name:"email",type:"text",value:t,error:e.email,label:"Электронная почта"})),r.createElement("div",{className:"auth-form-group auth-form__form__submit"},r.createElement("button",{className:"btn btn-primary"},"Восстановить")),r.createElement("div",{className:"auth-form-group auth-form__form__submit-secondary"},r.createElement(He.Z,{appearance:"link",label:"Служба поддержки",href:`https://${a}/feedback/report`,target:"_blank"}))))}}const pt=dt;function ut(){return ut=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ut.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * AuthFormContent Component.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class gt extends r.Component{static propTypes={activeTab:f().string,setAuthFormTab:f().func,paramsLogin:f().object,paramsLoginByEmail:f().object,paramsRegistration:f().object,paramsRegistrationByEmail:f().object,paramsPassword:f().object,onSubmitFormLogin:f().func,onSubmitFormLoginByEmail:f().func,onSubmitFormRegistration:f().func,onSubmitFormRegistrationByEmail:f().func,onSubmitFormPassword:f().func,backurl:f().string,mainDomain:f().string,currentDomain:f().string,toggleAuthForm:f().func};render(){const{backurl:e,paramsLogin:t,paramsLoginByEmail:n,paramsRegistration:a,paramsRegistrationByEmail:s,paramsPassword:o,onSubmitFormLogin:i,onSubmitFormLoginByEmail:l,onSubmitFormRegistration:c,onSubmitFormRegistrationByEmail:m,onSubmitFormPassword:d,mainDomain:p,currentDomain:u,activeTab:g,setAuthFormTab:h,toggleAuthForm:_}=this.props;return r.createElement(r.Fragment,null,"login"===g&&r.createElement(Qe,ut({},t,{onSubmit:i,mainDomain:p,setAuthFormTab:h,backurl:e,currentDomain:u})),"loginByEmail"===g&&r.createElement(tt,ut({},n,{onSubmit:l,mainDomain:p,currentDomain:u,setAuthFormTab:h,backurl:e})),"registration"===g&&r.createElement(at,ut({},a,{onSubmit:c,mainDomain:p,setAuthFormTab:h,backurl:e,currentDomain:u})),"registrationByEmail"===g&&r.createElement(mt,ut({},s,{onSubmit:m,mainDomain:p,currentDomain:u,setAuthFormTab:h,toggleAuthForm:_,backurl:e})),"password"===g&&r.createElement(pt,ut({},o,{onSubmit:d,mainDomain:p})))}}const ht=gt;
/**
 * Mirtesen.
 *
 * AuthForm Container.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class _t extends r.Component{static propTypes={widgetId:f().string,params:f().object,isModal:f().bool,wrapClassName:f().string,authFormActions:f().object,getPhoneLimitsByApi:f().func,toggleAuthForm:f().func,setAuthFormTab:f().func,setParams:f().func,setErrors:f().func,isBusy:f().bool,isOpen:f().bool,activeTab:f().string,paramsLogin:f().object,paramsLoginByEmail:f().object,paramsRegistration:f().object,paramsRegistrationByEmail:f().object,paramsPassword:f().object,callAndSmsLimits:f().object,stopTimers:f().func,startTimer:f().func,stopTimer:f().func,resetTimer:f().func};static defaultProps={isModal:!0};constructor(e){super(e),this.handleMessage=this.handleMessage.bind(this)}componentDidMount(){"undefined"!=typeof window&&window.addEventListener("message",this.handleMessage)}componentWillUnmount(){const{stopTimers:e}=this.props;"undefined"!=typeof window&&window.removeEventListener("message",this.handleMessage),e()}handleMessage(e){const{mainDomain:t}=re.Z.getConfig();if(e.origin!=="https://"+t||!e.data)return;const{action:n,key:a}=e.data;if("reload"===n)if(a){const{loginByMirtesen:e}=this.props.authFormActions;e(a)}else window.self===window.top?window.location.reload():document.referrer&&(window.top.location=document.referrer)}render(){const{mainDomain:e}=re.Z.getConfig(),{isBusy:t,isOpen:n,isModal:a,activeTab:s,paramsLogin:o,paramsLoginByEmail:i,paramsRegistration:l,paramsRegistrationByEmail:c,paramsPassword:m,wrapClassName:d,toggleAuthForm:p,setAuthFormTab:u,callAndSmsLimits:g,params:h,setParams:_,setErrors:E,getPhoneLimitsByApi:f,startTimer:b,stopTimer:y,resetTimer:v}=this.props,T=this.props.authFormActions.loginByPhone,S=this.props.authFormActions.loginByEmail,P=this.props.authFormActions.registerByPhone,w=this.props.authFormActions.registerByEmail,I=this.props.authFormActions.restorePassword;let C="",N="";if("undefined"!=typeof window)if(window.self===window.top){const e=window.location;e&&(C="https://"+e.hostname+e.pathname+e.search,N=e.hostname)}else if(document.referrer){C=document.referrer;const e=document.createElement("a");e.href=document.referrer,N=e.hostname}const O=a?Be:Re;return r.createElement(je.Provider,{value:{test:"ok",setParams:e=>{_(s,e)},setErrors:e=>{E(s,e)},getErrors:()=>h[s]?.errorMap||{},getPhoneLimitsByApi:e=>{f(e)},startTimer:e=>{b(e)},stopTimer:e=>{y(e)},resetTimer:(e,t)=>{v(e,t)},callAndSmsLimits:{...g}}},r.createElement(O,{isOpen:n,isBusy:t,toggle:p,wrapClassName:d},r.createElement(ht,{activeTab:s,setAuthFormTab:u,onSubmitFormLogin:T,onSubmitFormLoginByEmail:S,onSubmitFormRegistration:P,onSubmitFormRegistrationByEmail:w,onSubmitFormPassword:I,paramsLogin:o,paramsLoginByEmail:i,paramsRegistration:l,paramsRegistrationByEmail:c,paramsPassword:m,backurl:C,mainDomain:e,currentDomain:N,toggleAuthForm:p})))}}const Et=ge.connect((0,i.$j)(((e,t)=>{const n=L()(e,["authForm","isBusy"]),a=L()(e,["authForm","instances",t.widgetId,"isOpen"]),s=L()(e,["authForm","instances",t.widgetId,"activeTab"]),r=L()(e,["authForm","instances",t.widgetId,"params"]),o=L()(e,["authForm","instances",t.widgetId,"callAndSmsLimits"]);return{isBusy:n,isOpen:a,activeTab:s,paramsLogin:r.login,paramsLoginByEmail:r.loginByEmail,paramsRegistration:r.registration,paramsRegistrationByEmail:r.registrationByEmail,paramsPassword:r.password,callAndSmsLimits:o,params:r}}),((e,t)=>({authFormActions:(0,le.DE)(a,e),toggleAuthForm:()=>{e(he(t.widgetId))},setAuthFormTab:n=>{e(Ee(n,t.widgetId))},setParams:(n,a)=>{e(fe(n,a,t.widgetId))},setErrors:(n,a)=>{e(be(n,a,t.widgetId))},getPhoneLimitsByApi:t=>{e(ye(t))},startTimer:t=>{e(Se(t))},stopTimer:t=>{e(Pe(t))},stopTimers:()=>{e(we())},resetTimer:(t,n)=>{e(Ie(t,n))}})))(_t));n(15581),n(34514);var ft=n(27955),bt=n.n(ft),yt=n(56082),vt=n(20190),Tt=n(28610),St=n(81277);n(64211),n(41874);
/**
 * Mirtesen.
 *
 * Person Post Editor Reducer.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Pt={mode:"add",inProcess:!1,showModal:!1,active:!0,isChanged:!1,activeTab:"message",itemCount:1,images:[],video:null,valid:null,poll:null,geo:{status:"auto",tagId:void 0},foundPolls:[],hasMoreFoundPolls:!0,foundPollsOffset:0,message:"",url:"",preview:"",topic:"",vislvl:9,postId:0,holiday:{loaded:!1,title:null,image:null},isBirthday:!1,isValidationOn:!1,error:{title:"",preview:"",topic:"",popupMessage:""},previewData:null,canAttach:{photo:!1,video:!1},repost:null,author:null,target:null,personVislvl:null,myChannels:[]},wt={},It=(e=wt,t)=>{const n=t.identifier;if(!n)return e;let a=e[n]||{...Pt};switch(a={...a},t.type){case"MT_POST_EDITOR_SHOW_MODAL":a={...a,...t.object},a.active=!0,a.showModal=!0;break;case"MT_POST_EDITOR_TOGGLE_MODAL":a.showModal=!a.showModal,a.activeTab="message",a.error.popupMessage="";break;case"MT_POST_EDITOR_SET_TAB":a.activeTab=t.tab,a.itemCount=t.itemCount;break;case"MT_POST_EDITOR_ADD_IMAGES":a.images=a.images.concat(t.images),a.itemCount=a.images.length;break;case"MT_POST_EDITOR_ATTACH_IMAGES":a.images=t.images,a.itemCount=a.images.length,a.canAttach.photo=!1;break;case"MT_POST_EDITOR_UPLOAD_IMAGE_TO_STORAGE":a.images[t.index]={...a.images[t.index],status:t.status,image:t.image},a.canAttach.photo=!0;break;case"MT_POST_EDITOR_DELETE_IMAGE":a.images.splice(t.id,1),a.itemCount=a.images.length,a.images.length<1&&(a.itemCount=1),a.canAttach.photo=a.images.some((e=>1===e.status));break;case"MT_POST_EDITOR_ADD_VIDEO_BY_UPLOAD":a.video={videoFile:t.videoFile,isUploading:!0,uploadProgress:0,preview:null},a.canAttach.video=!0;break;case"MT_POST_EDITOR_SET_VIDEO_UPLOAD_PROGRESS":a.video.uploadProgress=t.videoUploadProgress;break;case"MT_POST_EDITOR_SET_VIDEO_UPLOAD_FINISHED":a.video.isUploading=!1,a.video.videoInfo={id:t.video.id,pandaVideoId:t.video.pandaVideoId};break;case"MT_POST_EDITOR_SET_VIDEO_PREVIEW":a.video.preview||(a.video.preview=t.videoPreview);break;case"MT_POST_EDITOR_DELETE_VIDEO":a.video=null,a.canAttach.video=!1;break;case"MT_POST_EDITOR_ADD_POLL":a.poll=t.pollId;break;case"MT_POST_EDITOR_DELETE_POLL":a.poll=null,a.activeTab="message";break;case"MT_POST_EDITOR_SET_SEARCH_POLLS_RESULTS":a.hasMoreFoundPolls=t.hasMoreFoundPolls,a.foundPolls=t.foundPolls,a.foundPollsOffset=t.foundPollsOffset;break;case"MT_POST_EDITOR_ADD_TEXT":a.text=t.text;break;case"MT_POST_EDITOR_DELETE_TEXT":a.text=null,a.activeTab="message";break;case"MT_POST_EDITOR_ADD_PREVIEW_DATA":a.previewData={...a.previewData,...t.previewData,hidden:!1};break;case"MT_POST_EDITOR_DELETE_PREVIEW_DATA":a.previewData=null;break;case"MT_POST_EDITOR_TOGGLE_PROCESS":a.inProcess=!a.inProcess;break;case"MT_POST_EDITOR_GET_HOLIDAY":a.holiday={...t.holiday,loaded:!0},a.isBirthday=t.isBirthday;break;case"MT_POST_EDITOR_RESET":a={...Pt,holiday:e[n].holiday};break;case"MT_POST_EDITOR_SET_VALUE":a[t.name]=t.value;break;case"MT_POST_EDITOR_ERROR_PROCESSING":a.error={...a.error,...t.error};break;case"MT_POST_EDITOR_TOGGLE_VALIDATION":a.isValidationOn=t.isValidationOn;break;case"MT_POST_EDITOR_SET_TARGET":a.target={...t.target};break;case"MT_POST_EDITOR_SET_GEO":a.geo={...t.geo}}return e[n]=a,{...e}};var Ct=n(89835),Nt=n(40680),Ot="/index.js";const Mt=
/**
 * Mirtesen.
 *
 * Polls.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class{static getList=async({type:e,count:t=10,offset:n=0},a={})=>{try{const s=await R.Z.request({query:`query {\n                    pollPosts(\n                        type: "${e}",\n                        count: ${t},\n                        offset: ${n}\n                    ) {\n                        items {\n                            ...on UserPost {\n                                post_type\n                                id\n                                foreignPollId\n                                url\n                                likes {\n                                    count\n                                    user_likes\n                                    can_like\n                                    marks_pluses\n                                    marks_minuses\n                                }\n                                attachments {\n                                    ...on AttachmentForeignPoll {\n                                        type\n                                        poll {\n                                            title\n                                            color_scheme\n                                            votes_counter\n                                            fileUri\n                                        }\n                                    }\n                                }\n                                from {\n                                    display_name\n                                    url\n                                    id\n                                }\n                            }\n                            ...on BlogPost {\n                                post_type\n                                id\n                                foreignPollId\n                                url\n                                likes {\n                                    count\n                                    user_likes\n                                    can_like\n                                    marks_pluses\n                                    marks_minuses\n                                }\n                                attachments {\n                                    ...on AttachmentForeignPoll {\n                                        type\n                                        poll {\n                                            title\n                                            color_scheme\n                                            votes_counter\n                                            fileUri\n                                        }\n                                    }\n                                }\n                                from {\n                                    display_name\n                                    url\n                                    id\n                                }\n                                ${Nt.r_}\n                            }\n                        }\n                    }\n                }`,endpoint:{endpoint:"blogs",ver:"v1"},res:a.res,req:a.req});return s?.items||[]}catch(e){D.Z.promiseHandler(Ot)(e)}};static removeDuplicates=(e,t)=>{const n=[],a={};for(const n in e)a[e[n][t]]=e[n];for(const e in a)n.push(a[e]);return n};static togglePollVisibility=async(e,t)=>{try{return await R.Z.request({query:`\n                mutation {\n                    hidePollPost(postId: ${e}, ${"hide"===t?"":"hide: false"})\n                }`,endpoint:{endpoint:"blogs",ver:"v1"}})}catch(e){D.Z.promiseHandler(Ot)(e)}};static getPolls=async(e={},t={})=>{try{const{query:n=null,authorId:a=null,limit:s=10,offset:r=0}=e,o=await R.Z.request({query:`query {\n                    searchPolls(q:${n?`"${n}"`:null}, userId:${a}, limit:${s}, offset:${r}) {\n                        id\n                        title\n                        userID\n                    }\n                }`,endpoint:{host:"polls.mirtesen.ru",path:"graphql",endpoint:"",ver:"v1"},res:t.res,req:t.req}),i=o&&o.length===s;return{polls:o,hasMorePolls:i,newOffset:r+s}}catch(e){D.Z.promiseHandler(Ot)(e)}}};var kt=n(74535),At=n(4169),xt=n(51605),Lt="/index.js";
/**
 * Mirtesen.
 *
 * Person Post Editor Actions.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Dt=w.Z.loadModule((()=>n.e(353).then(n.bind(n,88186))),"mt-polls"),Rt=(e,t,n={})=>async(a,s)=>{const r=s().mtPostEditor[e]||Pt,{activeTab:o="message",repost:i=null,author:l,personVislvl:c=9}=n;let{target:m}=n,d=[];if("channel"===m.type&&(d=await At.ZP.getUserChannels(l.id),!m.id&&!t)){const e=d?.[0];e&&(m={...m,id:e.id,channelName:e.name,channelTitle:e.title,geo:{status:"auto",tagId:e.geotag_id}})}if(!c||"channel"===m.type&&!m?.id)return;let p={},u={};if(null==t)u="add"===r.mode?{...u,activeTab:o,postId:0,repost:i,author:l,personVislvl:c,myChannels:d,target:m,geo:{type:"auto",tagId:m?.geo?.tagId}}:{...Pt,author:l,personVislvl:c,myChannels:d,target:m,geo:{type:"auto",tagId:m?.geo?.tagId}};else{const e=await vt.default.getUserPostById(t);p=e.mentionedPersons||{};const n=L()(e,"attachments",[])||[],a=[];let s=null,i=null,d=r.previewData||{},g=m.geo||{tagId:null,status:"auto"};const h=e.visible;n.forEach((e=>{const t=Object.keys(e)[0],n=e[t];"photo"===t?a.push({image:{id:n.id,photo_original:n.photo_original},status:2}):"video"===t?n.id||n.pandaVideoId?s={status:2,type:"file",videoInfo:{id:n.id,pandaVideoId:n.pandaVideoId,status:"active",htmlPlayer:n.player_html}}:n.player_html&&(s={status:2,type:"url",videoInfo:{status:"active",embed:n.player_html,...n}}):"link"===t?d=((e={})=>({host:e.caption,embed:e.embed,images:e.photo?.photo_original?[e.photo?.photo_original]:[],title:e.title,url:e.url}))(n):"tag"===t&&(g={status:"manual",tagId:n.id})})),e.foreignPollId&&(i=e.foreignPollId);const _=e.text||"";u={...Pt,activeTab:o,message:_,images:a,video:s,poll:i,postId:t,mentionedPersons:p,vislvl:h,title:e.title,preview:e.preview,previewData:d,url:e.topPostLink,topic:e.topic,repost:e.shared_post,geo:g,author:l,target:m,personVislvl:c,mode:"edit"}}a({identifier:e,type:"MT_POST_EDITOR_SHOW_MODAL",object:u})},Zt=(e,t="message")=>(n,a)=>{const s=a(),r=L()(s,`mtPostEditor.${e}.images`,[]).length;let o=0;"photo"===t&&(o=r),n({identifier:e,type:"MT_POST_EDITOR_SET_TAB",tab:t,itemCount:o})},Bt=(e,t,n=!1)=>async(a,s)=>{if(t.length<1)return;const r=(s().mtPostEditor[e].images||[]).length||0,o=[];for(let e=0;e<t.length;e++)o.push({fileInput:t[e],status:0});a({identifier:e,type:"MT_POST_EDITOR_ADD_IMAGES",images:o});for(let t=0;t<o.length;t++){const s=o[t],i=window.URL.createObjectURL(s.fileInput);a($t(e,r+t,i,1,n))}},$t=(e,t,n,a=1,s)=>(r,o)=>St.Z.uploadImageToStorage(n).then((n=>{n&&(r({identifier:e,type:"MT_POST_EDITOR_UPLOAD_IMAGE_TO_STORAGE",index:t,image:n,status:a}),s&&r(Ut(e,o()?.mtPostEditor?.[e].images)),r(zt(e,{popupMessage:""})))})).catch(D.Z.promiseHandler(Lt)),Ut=(e,t)=>n=>{const a=[];t.forEach((e=>{1===e.status&&a.push({...e,status:2}),2===e.status&&a.push(e)})),n({identifier:e,type:"MT_POST_EDITOR_ATTACH_IMAGES",images:a})},Ht=(e,t)=>n=>{if(t.length<1)return;const a=t[0];/video\/.*/i.test(a.type)?(n({identifier:e,type:"MT_POST_EDITOR_ADD_VIDEO_BY_UPLOAD",videoFile:a}),xt.Z.uploadVideoToStorage(a,(t=>{n({identifier:e,type:"MT_POST_EDITOR_SET_VIDEO_UPLOAD_PROGRESS",videoUploadProgress:t})})).then((t=>{n({identifier:e,type:"MT_POST_EDITOR_SET_VIDEO_UPLOAD_FINISHED",video:t})}))):n(zt(e,{popupMessage:"Неверный формат видео!"}))},Ft=(e,t)=>({identifier:e,type:"MT_POST_EDITOR_ADD_POLL",pollId:t}),jt=e=>async(t,n)=>{let a=n();try{if(a.mtPoll.pollFormData.title&&a.mtPoll.pollFormData.valid){const[{createPoll:s}]=await Promise.all([Dt()]);await t(s(a.mtPoll.pollFormData)),a=n();const r=a.mtPoll?.poll?.id;if(!r)return void kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Ошибка при сохранении опроса"});t({identifier:e,type:"MT_POST_EDITOR_ADD_POLL",pollId:r}),t(zt(e,{popupMessage:""}))}}catch(e){D.Z.promiseHandler(Lt)(e)}},Gt=(e,t=null,n=0)=>async(a,s)=>{const r=s()?.mtPostEditor?.[e]||{},{foundPolls:o=[]}=r,{polls:i,hasMorePolls:l,newOffset:c}=await(async(e,t=0,n=30)=>{try{const a=b.ZP.getCurrentUserId();return await Mt.getPolls({query:e,authorId:a,offset:t,limit:n})}catch(e){D.Z.promiseHandler(Lt)(e)}})(t,n);a({type:"MT_POST_EDITOR_SET_SEARCH_POLLS_RESULTS",identifier:e,foundPolls:n?[...o,...i]:i,foundPollsOffset:c,hasMoreFoundPolls:l})},qt=(e,t)=>async(n,a)=>{const s=L()(a(),`mtPostEditor.${e}`),{previewData:r={}}=s,o=(e=>{const t=e.replace(/&nbsp;/gi," "),n=y.Z.extractUrl(bt()(t));return n.length<1?"":n[0]})(t);if(!o||o===r?.url)return;const i=await(async e=>{const t=`query {\n        extractContent(url:"${e}") {\n          embed\n          title\n          url\n          host\n          images\n        }\n      }`,n={project:"main",body:JSON.stringify({query:t})};try{const e=await(0,yt.Z)(n),t=L()(e,"data.extractContent");if(!t)throw new Error("Couldn't get site info");return t}catch(e){D.Z.promiseHandler(Lt)(e)}})(o);return i&&i.title&&i.url?n({identifier:e,type:"MT_POST_EDITOR_ADD_PREVIEW_DATA",previewData:i}):void 0},Vt=(e,t)=>async n=>{const a=await Tt.Z.getHoliday(),s=(e=>{let t=L()(e,"birthday");return!(!t||"wall"!==e.type)&&(t=t.slice(0,5),c()(new Date).format("DD.MM")===t)})(t);n({identifier:e,holiday:a,isBirthday:s,type:"MT_POST_EDITOR_GET_HOLIDAY"})},zt=(e,t)=>({identifier:e,type:"MT_POST_EDITOR_ERROR_PROCESSING",error:t}),Wt=(e,t)=>({type:"MT_POST_EDITOR_SET_GEO",identifier:e,geo:t});var Yt=n(73935);
/**
 * Mirtesen.
 *
 * File uploader.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Kt extends r.PureComponent{constructor(){super(),this.fileInput=r.createRef(),this.handleChange=this.handleChange.bind(this),this.handleFocus=this.handleFocus.bind(this),this.handleBlur=this.handleBlur.bind(this)}handleChange(){const{onChange:e}=this.props;e(this.fileInput,Yt.findDOMNode(this.fileInput.current).files),this.fileInput.current.value=""}handleFocus(){const{onFocus:e}=this.props;e(this.fileInput)}handleBlur(){const{onBlur:e}=this.props;e(this.fileInput)}render(){const{name:e,id:t,multiple:n,accept:a,className:s,classNameWrapper:o}=this.props;return r.createElement("div",{className:"file-uploader"+(o?` ${o}`:"")},r.createElement("input",{ref:this.fileInput,type:"file",name:e,id:t,className:"file-uploader__input",multiple:n,accept:a,onChange:this.handleChange,onFocus:this.handleFocus,onBlur:this.handleBlur}),r.createElement("label",{htmlFor:t,className:"file-uploader__label svg-file-loader"+(s?` ${s}`:""),onClick:this.handleFocus},this.props.children||"Выберите файл..."))}}Kt.defaultProps={name:"file-uploader",id:"file-uploader",multiple:!0,accept:"*/*",className:null,classNameWrapper:null,onFocus:e=>{},onBlur:e=>{},onChange:(e,t)=>{}},Kt.propTypes={name:f().string,id:f().string,multiple:f().bool,accept:f().string,className:f().string,classNameWrapper:f().string,onFocus:f().func,onBlur:f().func,onChange:f().func,children:f().any};const Jt=Kt;
/**
 * Mirtesen.
 *
 * Person Post Editor Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Xt extends r.PureComponent{render(){const{addImages:e,deleteImage:t,identifier:n}=this.props,a=this.props.mtPostEditor[n]||Pt,{activeTab:s,images:o}=a,i=[];for(let e=0;e<o.length;e++){const a=o[e],s={backgroundImage:a.status>=1&&a.image.photo_original?"url("+a.image.photo_original+")":"none"};i.push(r.createElement("div",{key:e,className:"mt-post-editor__photo-settings__thumb",style:s},0===a.status&&r.createElement("div",{className:"mt-post-editor__photo-settings__loading"},r.createElement("svg",{style:{width:32,height:32},className:"svg-icon"},r.createElement("use",{href:"/images/icons.svg#spinner"}))),r.createElement("button",{type:"button",className:"mt-post-editor__remove-attach mt-post-editor__remove-attach_photo svg-remove-attach",onClick:()=>{t(n,e)}})))}return r.createElement("div",{className:_()({"mt-post-editor__photo-settings":!0,"mt-post-editor__photo-settings_active":"photo"===s})},r.createElement("div",{className:"mt-post-editor__photo-settings__gallery"},i,r.createElement(Jt,{id:"mt-post-editor-photo-settings-uploader-"+n,name:"person_post_editor_photo_settings_uploader_"+n,classNameWrapper:_()({"mt-post-editor__photo-settings__thumb":!0}),className:_()({"mt-post-editor__photo-settings__add":!0}),onChange:(t,a)=>{e(n,t,a)},multiple:!0,accept:"image/*"},r.createElement("svg",{className:"svg-icon",style:{width:24,height:24}},r.createElement("use",{href:"/images/icons.svg#cross"})))))}}Xt.propTypes={mtPostEditor:f().object,addImages:f().func,deleteImage:f().func,identifier:f().string};const Qt=(0,i.$j)((e=>({mtPostEditor:e.mtPostEditor})),(e=>({addImages:(t,n,a)=>{e(Bt(t,a))},deleteImage:(t,n)=>{e(((e,t)=>({type:"MT_POST_EDITOR_DELETE_IMAGE",identifier:e,id:t}))(t,n))}})))(Xt);var en=n(8560);const tn=({mainText:e,extraText:t,iconUrl:n,showBtn:a,...s})=>{const{getRootProps:o,getInputProps:i,isDragActive:l,isDragAccept:c,isFocused:m}=(0,en.uI)({...s});return r.createElement("div",o({className:_()("dropzone-file-uploader",{"dropzone-file-uploader-focused":m,"dropzone-file-uploader-active":l,"dropzone-file-uploader-accept":c})}),r.createElement("input",i()),l?r.createElement("p",{className:"main-text"},"Можете отпускать..."):r.createElement("div",{className:"descr"},n&&r.createElement("img",{src:n,alt:"add your file"}),e&&r.createElement("p",{className:"main-text"},e),t&&r.createElement("p",{className:"extra-text"},t),a&&r.createElement("span",{className:"btn btn-primary"},"Выбрать файл")))};tn.propTypes={onDrop:f().func,accept:f().oneOfType([f().string,f().object]),multiple:f().bool,maxSize:f().number,mainText:f().string,extraText:f().oneOfType([f().string,f().node]),iconUrl:f().string,showBtn:f().bool};const nn=tn;var an=n(85212);const sn={XS:20,S:32,M:44,L:52,XL:68},rn={XS:14,S:22,M:30,L:38,XL:46},on=({percentage:e,size:t="M",visible:n=!0})=>{const a=sn[t]||sn.M,s=rn[t]||rn.M,o=(a-s)/2;return r.createElement("div",{style:{backgroundColor:"rgba(0, 0, 0, 0.2)",backdropFilter:"blur(18px)",borderRadius:"50%",display:"inline-block",width:a,height:a,padding:o,opacity:n?1:0,transition:"all .1s ease-out"}},r.createElement(an.$,{percent:e,colorCircle:"rgba(255, 255, 255, .1)",colorSlice:"#FFFFFF",round:!0,number:!1,size:s,animationSmooth:"500ms ease-out"}))};on.propTypes={percentage:f().number,size:f().oneOf(["XS","S","M","L","XL"]),visible:f().bool};const ln=on,cn=r.memo((({videoFile:e,controls:t=!0,setVideoPreview:n,identifier:a})=>r.createElement("video",{width:"100%",controls:t,style:{borderRadius:"12px"},src:URL.createObjectURL(e),onCanPlayThrough:({currentTarget:e})=>{n&&setTimeout((()=>{const t=50/Math.min(e.videoWidth,e.videoHeight),s=e.videoWidth*t,r=e.videoHeight*t,o=document.createElement("canvas"),i=o.getContext("2d");o.width=50,o.height=50,i.drawImage(e,(50-s)/2,(50-r)/2,s,r);const l=o.toDataURL("image/jpeg",.5);n(a,l)}),1e3)}})));cn.propTypes={videoFile:f().object,controls:f().bool,setVideoPreview:f().func,identifier:f().string};const mn=cn;
/**
 * Mirtesen.
 *
 * Person Post Editor Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class dn extends r.PureComponent{render(){const{addVideoByUpload:e,deleteVideo:t,identifier:n,setVideoPreview:a}=this.props,s=this.props.mtPostEditor[n]||Pt,{activeTab:o,video:i}=s,l=i?.videoFile,c=i?.videoInfo?.htmlPlayer,m=Math.floor(i?.uploadProgress?.loaded/i?.uploadProgress?.total*100)||0;return r.createElement("div",{className:_()("mt-post-editor__video-settings",{"mt-post-editor__video-settings_active":"video"===o}),style:{padding:0}},!i&&r.createElement(nn,{accept:"video/*",onDrop:t=>e(n,null,t),multiple:!1,mainText:"Перетащите видео в эту область или нажмите здесь для выбора файла"}),i&&r.createElement("div",{className:"mt-post-editor__video-settings__preview"},r.createElement("div",{className:"mt-post-editor__video-settings__preview-item"},i?.isUploading&&r.createElement("div",{className:"mt-post-editor__video-settings__preview-loading",onClick:e=>e.preventDefault()},r.createElement(ln,{percentage:m,visible:m<100,size:"XL"})),r.createElement("button",{type:"button",className:"mt-post-editor__remove-attach mt-post-editor__remove-attach_video svg-remove-attach",onClick:()=>{t(n)}}),l&&r.createElement(mn,{videoFile:l,controls:!i?.isUploading,setVideoPreview:a,identifier:n}),c&&r.createElement("div",{dangerouslySetInnerHTML:{__html:i.videoInfo.htmlPlayer}}))))}}dn.propTypes={mtPostEditor:f().object,addVideoByUpload:f().func,deleteVideo:f().func,setVideoPreview:f().func,identifier:f().string};const pn=(0,i.$j)((e=>({mtPostEditor:e.mtPostEditor})),(e=>({addVideoByUpload:(t,n,a)=>{e(Ht(t,a))},deleteVideo:t=>{e((e=>({identifier:e,type:"MT_POST_EDITOR_DELETE_VIDEO"}))(t))},setVideoPreview:(t,n)=>{e({type:"MT_POST_EDITOR_SET_VIDEO_PREVIEW",identifier:t,videoPreview:n})}})))(dn);var un=n(53894);
/**
 * Mirtesen.
 *
 * Implementation of poll view component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const gn=N((()=>console.log("load polls")||n.e(353).then(n.bind(n,88186))),"mt-polls","PollView");class hn extends r.PureComponent{static defaultProps={pollId:null,token:null,postUrl:""};constructor(){super(),this.state={token:null,loaded:!1,store:null}}componentDidMount(){const{token:e}=this.props;w.Z.loadModule((()=>n.e(353).then(n.bind(n,88186))),"mt-polls")().then((({MtPollVoteReducer:e,MtPollLoadReducer:t})=>{this.setState({store:(0,le.MT)((0,le.UY)({MtPollVoteReducer:e,MtPollLoadReducer:t}),(0,le.md)(un.Z))})})),e?this.setState({token:e,loaded:!0}):b.ZP.getJwtAccessToken().then((e=>this.setState({token:e,loaded:!0})))}render(){const{pollId:e,postUrl:t,openAuthForm:n}=this.props,{token:a,loaded:s,store:o}=this.state;return s&&e&&o?r.createElement("div",{onClick:()=>!a&&n("login")},r.createElement(i.zt,{store:o},r.createElement(gn,{pollId:e,token:a,postUrl:t}))):null}}hn.propTypes={token:f().string,pollId:f().number,postUrl:f().string,openAuthForm:f().func};const _n=(0,i.$j)(null,(e=>({openAuthForm:t=>{e(_e(t))}})))(hn),En=N((()=>console.log("load polls")||n.e(353).then(n.bind(n,88186))),"mt-polls","MainForm");class fn extends r.PureComponent{render(){const{identifier:e,addPoll:t,deletePoll:n}=this.props,a=this.props.mtPostEditor[e]||Pt,{activeTab:s,poll:o}=a;return r.createElement("div",{className:_()({"mt-post-editor__poll-settings":!0,"mt-post-editor__poll-settings_active":"poll"===s})},o&&r.createElement("button",{type:"button",className:"mt-post-editor__remove-attach mt-post-editor__remove-attach_poll svg-remove-attach",onClick:()=>{n(e)}}),o&&r.createElement(_n,{pollId:o,postUrl:""}),!o&&r.createElement(r.Fragment,null,r.createElement(En,{onAddPoll:n=>{t(e,n)}})))}}fn.propTypes={mtPostEditor:f().object,identifier:f().string,addPoll:f().func,deletePoll:f().func,createPoll:f().func};const bn=(0,i.$j)((e=>({mtPostEditor:e.mtPostEditor})),(e=>({addPoll:(t,n)=>{e(Ft(t,n))},deletePoll:t=>{e((e=>({identifier:e,type:"MT_POST_EDITOR_DELETE_POLL"}))(t))}})))(fn);n(57640),n(9924);var yn=n(60982);
/**
 * Mirtesen.
 *
 * Person Post Editor Header.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const vn=({activeTab:e,mtPostEditor:t,identifier:n,addImages:a,images:s={},tabs:o,setTab:i,isModal:l,target:c,isMobile:m})=>r.createElement("div",{className:"mt-post-editor__content-controls"},Object.keys(o).map((m=>{const d={"content-control":!0};d["content-control_"+m]=!0,d["content-control_active"]=m===e,d["content-control_attached"]=t[m];const p=o[m]?.icon;if("message"===m)return;if("polls-list"===m)return;if("geoposition"===m&&"channel"!==c?.type)return;let u=r.createElement("button",{type:"button",className:_()(d),onClick:()=>{i(m)}},p&&r.createElement(yn.Z,{iconName:p}));return"photo"===m&&(s?.length>0?d["content-control_attached"]=2===s[0].status:u=r.createElement(Jt,{name:"person_post_editor_photo_uploader_"+n,className:_()(d),onFocus:()=>{i("photo")},onChange:(e,t)=>{a(n,e,t)},multiple:!0,accept:"image/*"})),r.createElement("div",{key:m,id:`editor-${n}-${m}-${l?"modal":""}`},u,r.createElement(lt,{className:"mt-post-editor__tooltip",target:`editor-${n}-${m}-${l?"modal":""}`,placement:"top",content:`Добавить ${o[m].title}`,offset:[0,8]}))})));vn.propTypes={activeTab:f().string,mtPostEditor:f().object,identifier:f().string,images:f().array,tabs:f().object,isModal:f().bool,setTab:f().func,addImages:f().func,addVideoByUpload:f().func,target:f().object};const Tn=(0,r.memo)(vn);
/**
 * Mirtesen.
 *
 * Person Post Editor Controls.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Sn extends r.PureComponent{constructor(e){super(e);const{onSave:t}=this.props;this.tabs={message:{title:"сообщение",name:"message",placeholder:"О чем вы думаете?",button:{handleClick:t,content:r.createElement(r.Fragment,null,r.createElement("svg",{className:"svg"},r.createElement("use",{href:"/images/icons.svg#send"})),"Отправить")}},photo:{title:"фото",name:"photo",placeholder:{singular:"Расскажите об этой фотографии...",plural:"Расскажите об этих фотографиях..."},button:{content:"Прикрепить",className:"mt-post-editor__btn_add",handleClick:this.attachImages}},geoposition:{title:"Местоположение",name:"geoposition",placeholder:"Добавьте местоположение",icon:"geo-stroke"},video:{title:"видео",name:"video",placeholder:"Расскажите об этом видео...",button:{handleClick:()=>this.setTab("message"),content:"Прикрепить"}}},this.props.showPoll&&(this.tabs.poll={title:"опрос",name:"poll",placeholder:"О чем вы думаете?",button:{handleClick:this.handleAddPollClick,content:"Добавить опрос"}})}handleAddPollClick=()=>{const{mtPostEditor:e}=this.props,t=e?.poll;t||this.attachNewPoll(),this.setTab("message")};setTab=e=>{const{setTab:t,identifier:n}=this.props;t(n,e)};attachImages=()=>{const{attachImages:e,identifier:t,mtPostEditor:n}=this.props;e(t,n.images),this.setTab("message")};attachNewPoll=()=>{const{createNewPoll:e,identifier:t}=this.props;e(t)};isAddButtonActive=()=>{const{activeTab:e,mtPostEditor:{canAttach:t,poll:n},pollData:a,video:s}=this.props;switch(e){case"message":return!s?.isUploading;case"poll":return!!n||a.title&&a.valid;default:return t[e]}};render(){const{activeTab:e,mtPostEditor:t,identifier:n,addImages:a,addVideoByUpload:s,images:o,isModal:i=!1,personVislvl:l,setTab:c,target:m}=this.props,d=this.tabs[e]?.button,p=Number(l)!==K.Z.allowLevels.any&&"message"===e;return r.createElement("div",{className:_()("mt-post-editor__controls",{"mt-post-editor__polls-control":"poll"===e})},(!i||"message"===e)&&r.createElement(r.Fragment,null,r.createElement(Tn,{activeTab:e,mtPostEditor:t,identifier:n,addImages:a,addVideoByUpload:s,images:o,isModal:i,target:m,tabs:this.tabs,setTab:this.setTab})),i&&r.createElement(r.Fragment,null,"poll"===e&&r.createElement(r.Fragment,null,r.createElement("button",{className:"btn btn-secondary",onClick:()=>c(n,"polls-list")},"Выбрать опрос...")),d&&r.createElement("button",{className:"btn btn-primary",onClick:d.handleClick,disabled:!this.isAddButtonActive()},d.content),p&&r.createElement("div",{className:"tooltip tooltip_black mt-post-editor__btn-tooltip",dangerouslySetInnerHTML:{__html:vt.default.errorMessage.privateAccountShort}})))}}Sn.defaultProps={isModal:!1,addImages:()=>{},addVideoByUpload:()=>{},onSave:()=>{},createNewPoll:()=>{},attachImages:()=>{}},Sn.propTypes={showPoll:f().bool,isModal:f().bool,isOwner:f().bool,activeTab:f().string,mtPostEditor:f().object,identifier:f().string,personVislvl:f().string,images:f().array,video:f().object,pollData:f().object,addImages:f().func,addVideoByUpload:f().func,setTab:f().func,onSave:f().func,createNewPoll:f().func,attachImages:f().func,target:f().object};const Pn=(0,i.$j)(null,(e=>({createNewPoll:t=>{e(jt(t))}})))(Sn),wn=({onClickOutside:e,identifier:t,errorText:n})=>{const a=(0,r.useRef)(),s=(0,r.useCallback)((t=>{t.target!==a.current&&e()}),[t,e]);return(0,r.useEffect)((()=>(document.addEventListener("click",s),()=>{document.removeEventListener("click",s)})),[]),r.createElement("span",{className:"mt-post-editor__error-message",ref:a,dangerouslySetInnerHTML:{__html:n}})};wn.propTypes={errorText:f().string,identifier:f().string,onClickOutside:f().func};const In=wn,Cn=(e,t)=>e?t?"Поделиться в МТ":"Поделиться публикацией в МирТесен":"Публикация",Nn=({activeTab:e,identifier:t,setTab:n,isRepost:a,isMobile:s})=>{const o={message:Cn(a,s),photo:"Добавление фото",video:"Добавление видео",poll:"Добавление опроса","polls-list":"Выбор опроса",geoposition:"Добавление местоположения"};return r.createElement("div",{className:"mt-post-editor__header"},"message"!==e&&r.createElement("button",{className:"button button_back mt-post-editor__back",type:"button",onClick:()=>n(t)}),r.createElement("div",{className:"mt-post-editor__header-title"},r.createElement("h3",null,o[e])))};Nn.propTypes={activeTab:f().string,identifier:f().string,isRepost:f().bool,isMobile:f().bool,setTab:f().func};const On=(0,r.memo)(Nn);n(31672),n(59461);var Mn=n(40739),kn=n(24635);
/**
 * Mirtesen.
 *
 * Person Post Editor Preview.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class An extends r.PureComponent{render(){const{identifier:e,deletePreview:t}=this.props,n=this.props.mtPostEditor[e]||Pt,{previewData:a}=n,s=!!(L()(a,"images",[])||[]).length;return a&&!a.hidden&&a.title&&a.url&&(s||a.embed)?r.createElement("div",{className:"link-preview mt-post-editor__link-preview"},a.embed&&r.createElement("div",{className:"link-preview__embed",dangerouslySetInnerHTML:{__html:a.embed}}),s&&!a.embed&&r.createElement("a",{className:"link-preview__image",href:a.url,target:"_blank",rel:"nofollow"},r.createElement(kn.Z,{size:"bp",src:a.images[0]})),r.createElement("div",{className:"link-preview__wrap"},r.createElement("i",{onClick:()=>{t(e)},style:{width:20,height:20},className:"svg-icon link-preview__close"},r.createElement(yn.Z,{iconName:"times-circle"})),r.createElement("i",{className:"link-preview__host"},a.host),r.createElement("a",{className:"link-preview__title",href:a.url,target:"_blank",rel:"nofollow"},a.title))):null}}An.propTypes={mtPostEditor:f().object,deletePreview:f().func,identifier:f().string};const xn=(0,i.$j)((e=>({mtPostEditor:e.mtPostEditor})),(e=>({deletePreview:t=>{e((e=>({identifier:e,type:"MT_POST_EDITOR_DELETE_PREVIEW_DATA"}))(t))}})))(An),Ln=({label:e="",value:t,items:n,onClick:a,identifier:s,type:o,error:i,checkError:l})=>r.createElement("div",{className:"mt-post-editor__dropdown"},i&&r.createElement("span",{className:"mt-post-editor__dropdown-error"},i),e&&r.createElement("span",null,e),r.createElement(G.Z,{customButtonClasses:"mt-post-editor__dropdown-value",customDropdownClasses:"mt-post-editor__dropdown-menu",customListClasses:"mt-post-editor__dropdown-items",placement:"auto-right",buttonValue:t},Array.isArray(n)?n.map((e=>r.createElement("div",{key:e.key,className:"mt-post-editor__dropdown-item",onClick:()=>{l&&l(s,e.key),a(s,o,e.key)}},r.createElement("span",null,r.createElement("img",{src:`//static.mtml.ru/images/topics/${e.key.toLowerCase()}.svg`,alt:e.key})),e.text))):Object.keys(n).map((e=>r.createElement("div",{key:e,className:"mt-post-editor__dropdown-item",onClick:()=>{l&&l(s,e),a(s,o,e)}},n[e])))));Ln.propTypes={label:f().string,value:f().string,items:f().oneOfType([f().object,f().array]),onClick:f().func,identifier:f().string,type:f().string,error:f().string,checkError:f().func};const Dn=(0,r.memo)(Ln),Rn=({attachments:e,setTab:t,identifier:n})=>r.createElement("div",{className:"mt-post-editor__attachments"},r.createElement("h4",{className:"mt-post-editor__attachments-title"},"Прикреплено к публикации"),r.createElement("ul",{className:"mt-post-editor__attachments-list"},e.map((e=>r.createElement("li",{key:e.type,className:"mt-post-editor__attachments-item"},`${e.count||""} ${e.name}`,"photo"===e.type&&r.createElement("div",{className:"mt-post-editor__image-previews"},e.items.map((({image:e})=>e.photo_original?r.createElement("div",{key:e.id,className:"mt-post-editor__image-preview",style:{backgroundImage:"url("+e.photo_original+")"}}):null))),"video"===e.type&&r.createElement("div",{className:"mt-post-editor__video-previews"},r.createElement("div",{className:"mt-post-editor__image-preview",style:{cursor:"pointer",backgroundImage:"url("+e.item?.preview+")"},onClick:()=>t(n,"video")},e.item?.isUploading&&r.createElement("div",{style:{width:"100%",height:"100%",display:"flex",placeContent:"center",flexWrap:"wrap",backgroundColor:"rgba(0, 0, 0, 0.4)",borderRadius:"12px"}},r.createElement(ln,{percentage:Math.floor(e.item?.uploadProgress?.loaded/e.item?.uploadProgress?.total*100)||0,size:"XS"})))))))));Rn.propTypes={attachments:f().arrayOf(f().object),setTab:f().func,identifier:f().string};const Zn=(0,r.memo)(Rn);
/**
 * Mirtesen.
 *
 * Repost Preview.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Bn extends r.PureComponent{render(){const{identifier:e}=this.props,t=this.props.mtPostEditor[e]||Pt,{repost:n}=t;if(!n)return null;const a=L()(n,"images",[]),s=L()(n,"videos",[]),o=L()(n,"from.display_name",""),i=n?.attachments?.filter((e=>Boolean(e.link))),l=i?.[0]?.link,c=n.title||l?.title||s?.[0]?.title;let m;if(a.length>0)m=a[0]?.url;else if(l)m=l?.photo?.photo_original;else if(s.length>0){const e=s[0]?.player_data;m=y.Z.fixProtocol(e?.Image)}return r.createElement("div",{className:"repost-preview mt-post-editor__repost"},m&&r.createElement("div",{className:"repost-preview__img"},r.createElement(kn.Z,{alt:n.title||"",src:m,tag:"div"})),r.createElement("div",{className:"repost-preview__info"},r.createElement("p",{className:"repost-preview__author"},o),c&&r.createElement("h3",{className:"repost-preview__title"},c),!c&&r.createElement("p",null,y.Z.truncateString(n.text,300))))}}Bn.propTypes={mtPostEditor:f().object,identifier:f().string};const $n=(0,i.$j)((e=>({mtPostEditor:e.mtPostEditor})))(Bn);var Un=n(32470);
/**
 * Mirtesen.
 *
 * Person Post Editor Message Container.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Hn=N((()=>Promise.resolve().then(n.bind(n,35830))),"lexicalEditor","LexicalEditor");class Fn extends r.PureComponent{constructor(e){super(e);const{author:t,target:n,identifier:a}=this.props,s=this.props.mtPostEditor[a]||Pt,{repost:o}=s;this.mtTextEditor=r.createRef(),this.placeholder=this.getPlaceholder(!!o,t,n)}handleChangeText=e=>{const{onChange:t,onProcessLink:n,identifier:a}=this.props;n(a,e),t(a,"message",e)};handleImagePaste=e=>{const{identifier:t,addImages:n}=this.props,a=Array.from(e.clipboardData?.items).find((e=>e.type.indexOf("image")>-1))?.getAsFile();if(void 0!==a){const e=new DataTransfer;e.items.add(a),n(t,e.files,!0)}};getAttachmentList=(e,t,n)=>{const a=[],s=e.filter((e=>2===e.status));return s.length&&a.push({name:"фото",count:s.length,type:"photo",items:s}),t&&a.push({name:"Видео",type:"video",item:t}),n&&a.push({name:"Опрос",type:"poll"}),a};getPlaceholder=(e,t,n)=>e?"Что думаете по этому поводу?":t.id.toString()===n.id.toString()?`Что у вас нового, ${t.name.split(" ")[0]}?`:`Напишите что-нибудь на стене, ${t.name.split(" ")[0]}`;getTopicValue=(e,t)=>(t.find((t=>t.key===e))||{}).text||"Выберите тему";getCurrentChannel=(e,t)=>e.find((e=>e.id===t)).title;checkTitle=(e,t)=>{const{title:n}=vt.default.validationParams,{onErrorProcessing:a}=this.props;t.trim().length<n.minLength?a(e,{title:vt.default.errorMessage.title.tooShort}):t.trim().length>n.maxLength?a(e,{title:vt.default.errorMessage.title.tooLong}):a(e,{title:""})};checkPreview=(e,t)=>{const{preview:n}=vt.default.validationParams,{onErrorProcessing:a}=this.props;t.trim().length<n.minLength?a(e,{preview:vt.default.errorMessage.preview.tooShort}):t.trim().length>n.maxLength?a(e,{preview:vt.default.errorMessage.preview.tooLong}):a(e,{preview:""})};checkTopic=(e,t)=>{const{onErrorProcessing:n}=this.props;t&&n(e,{topic:""})};checkMessage=(e,t)=>{const{onErrorProcessing:n}=this.props;t&&n(e,{popupMessage:""})};checkUrl=(e,t)=>{const{onErrorProcessing:n}=this.props;y.Z.checkUrl(t)&&n(e,{url:""})};vislvls={[K.Z.allowLevels.any]:"Всем",[K.Z.allowLevels.friend]:"Друзьям",[K.Z.allowLevels.self]:"Только мне"};render(){const{identifier:e,author:t,onChange:n,isOwner:a,setTab:s,onSetTarget:o,removeGeo:i}=this.props,l=this.props.mtPostEditor[e]||Pt,{message:c,activeTab:m,vislvl:d,images:p,video:u,poll:g,repost:h,myChannels:_,target:E,geo:f}=l;if("message"!==m)return null;const b=this.getAttachmentList(p,u,g);return r.createElement(r.Fragment,null,"channel"===E.type&&r.createElement("div",{className:"mt-post-editor__channel"},_.length>1?r.createElement(G.Z,{customButtonClasses:"mt-post-editor__channel-value",customDropdownClasses:"mt-post-editor__dropdown-menu",customListClasses:"mt-post-editor__dropdown-items",placement:"auto-right",buttonValue:r.createElement(r.Fragment,null,r.createElement("span",null,this.getCurrentChannel(_,E.id)),r.createElement(yn.Z,{iconName:"angle-down"}))},_.map((t=>r.createElement("span",{className:"mt-post-editor__dropdown-item",key:t.id,onClick:()=>{t.geo={status:"auto",tagId:t?.geotag_id},o(e,t,"channel")}},t.title)))):r.createElement("div",{className:"mt-post-editor__channel"},E.channelTitle)),r.createElement("div",{className:"mt-post-editor__editor-area"},r.createElement(Mn.Z,{logoInfo:{userName:t.name,logoImg:t.image,logoClassName:"userlogo_xxm mt-post-editor__userlogo"}}),r.createElement("div",{className:"mt-post-editor__message"},r.createElement("div",{className:"mt-post-editor__group"},r.createElement(Hn,{placeholder:this.placeholder,text:c,onChange:this.handleChangeText,onPaste:this.handleImagePaste})),r.createElement(Un.Z,{extraClasses:"mt-post-editor__tag-preview",identifier:e,tagId:f?.tagId,onRemove:()=>{i(e)}}),b.length>0&&r.createElement("div",{className:"mt-post-editor__group"},r.createElement(Zn,{attachments:b,setTab:s,identifier:e})),r.createElement(xn,{identifier:e}),r.createElement($n,{identifier:e}),(a||h)&&r.createElement("div",{className:"mt-post-editor__group mt-post-editor__group_dropdown"},r.createElement(Dn,{value:`Доступно: ${L()(this.vislvls,d,this.vislvls[K.Z.allowLevels.any])}`,items:this.vislvls,onClick:n,identifier:e,type:"vislvl"})))))}}Fn.propTypes={identifier:f().string,author:f().object,target:f().object,mtPostEditor:f().object,topicList:f().array,onChange:f().func,onProcessLink:f().func,onErrorProcessing:f().func,isOwner:f().bool,addImages:f().func,setTab:f().func,onSetTarget:f().func};const jn=(0,i.$j)((e=>({mtPostEditor:e.mtPostEditor})),(e=>({onChange:(t,n,a)=>{e(((e,t,n)=>({identifier:e,type:"MT_POST_EDITOR_SET_VALUE",name:t,value:n}))(t,n,a))},onProcessLink:(t,n)=>{e(qt(t,n))},onErrorProcessing:(t,n,a)=>{e(zt(t,n,a))},addImages:(t,n,a)=>{e(Bt(t,n,a))},onSetTarget:(t,n,a)=>{e(((e,t,n)=>(a,s)=>{const r=L()(s(),`mtPostEditor.${e}`),{geo:o={}}=r||{},i=t?.geo||{};return"channel"!==n||o.status&&"auto"!==o.status&&("manual"!==o.status||"manual"!==i.status)||a(Wt(e,{status:i.status,tagId:i.tagId})),a({type:"MT_POST_EDITOR_SET_TARGET",identifier:e,target:{id:t.id,channelName:t.name,channelTitle:t.title,type:n}})})(t,n,a))},removeGeo:t=>{e(Wt(t,{status:"manual",tagId:0}))}})))(Fn);class Gn extends r.PureComponent{static propTypes={children:f().oneOfType([f().any]),tagName:f().string,margin:f().string,threshold:f().oneOfType([f().number,f().arrayOf(f().number)]),onIntersection:f().func,extraClasses:f().string};static defaultProps={margin:"0px",threshold:1,tagName:"div"};constructor(e){super(e),this.wrapperRef=(0,r.createRef)(),this.observer=null}componentDidMount(){const e=this.wrapperRef.current,{onIntersection:t}=this.props;if(null===e||"function"!=typeof t)return;const{margin:n,threshold:a}=this.props;(this.observer=new IntersectionObserver(this.handleIntersection,{rootMargin:n,threshold:a})).observe(e)}componentWillUnmount(){const e=this.observer;null!==e&&e.disconnect()}handleIntersection=e=>{this.props.onIntersection(e.map((({isIntersecting:e})=>e)))};render(){const{children:e,tagName:t,extraClasses:n}=this.props;return r.createElement(t,{ref:this.wrapperRef,className:n},e)}}const qn=Gn;
/**
 * Mirtesen.
 *
 * InfiniteScroll implementation for React.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Vn extends r.PureComponent{static propTypes={pageStart:f().number,hasMore:f().bool,loadMore:f().func,wrapper:f().any,threshold:f().number,loader:f().oneOfType([f().bool,f().object,f().string]),children:f().oneOfType([f().object,f().array])};static defaultProps={pageStart:0,hasMore:!1,loadMore:()=>{},wrapper:null,threshold:250,loader:r.createElement("div",null,"Loading...")};constructor(){super(),this.state={pageLoaded:0,isLoading:!1},this.wrapper=null}componentDidMount(){this.wrapper=this.props.wrapper||window,this.throttleIntersection()}componentDidUpdate(e,t){this.wrapper=this.props.wrapper||window,!0===t.isLoading&&this.setState({isLoading:!1})}handleIntersection=()=>{const{hasMore:e,loadMore:t}=this.props,{isLoading:n,pageLoaded:a}=this.state;e?n||this.setState((e=>({isLoading:!0,pageLoaded:e.pageLoaded+1})),t(a)):this.setState({isLoading:!1})};throttleIntersection=()=>{this.eventTimeout||(this.eventTimeout=setTimeout((()=>{this.eventTimeout=null,this.handleIntersection()}),50))};render(){const{hasMore:e,loader:t,threshold:n}=this.props,{isLoading:a}=this.state;return r.createElement("div",{className:"clearfix inft-scroll",ref:e=>{this.element=e}},this.props.children,!a&&r.createElement(qn,{margin:n+"px",threshold:.01,onIntersection:([e])=>{e&&this.throttleIntersection()}}),r.createElement("div",{className:"inft-scroll__loader"},e&&a&&t))}}const zn=Vn,Wn=()=>r.createElement("div",{className:"inft-scroll-loader"},r.createElement("img",{src:"//static.mtml.ru/images/loader.svg",alt:"Загружается..."})),Yn=(0,r.memo)(Wn),Kn=r.forwardRef((({defaultValue:e,handleSearch:t,searchUrl:n="",placeholder:a="Поиск"},s)=>{const o=(0,r.useRef)(null),[i,l]=(0,r.useState)(e);return r.createElement("div",{className:"mt-search-input"},r.createElement("input",{type:"text",placeholder:a,name:"search",autoComplete:"off",className:"mt-search-input__input",onChange:e=>{const{value:a}=e.target;l(a),o.current&&clearTimeout(o.current),o.current=setTimeout((()=>{let e=n;a.length>2&&(e+="?q="+encodeURIComponent(a)),window.history.pushState(null,"",e),t(a)}),500)},value:i,ref:s,spellCheck:"false"}),r.createElement("i",{className:"mt-search-input__icon"},r.createElement(yn.Z,{iconName:"search"})),i&&r.createElement("button",{className:"mt-search-input__close",type:"button",onClick:()=>{l(""),t(""),window.history.pushState(null,"",n)}},r.createElement("svg",{className:"svg-icon"},r.createElement("use",{href:"/images/icons.svg#close"}))))}));Kn.propTypes={defaultValue:f().string,searchUrl:f().string,handleSearch:f().func,placeholder:f().string};const Jn=(0,r.memo)(Kn),Xn=(0,r.memo)((({hasMore:e,searchPolls:t,loadMorePolls:n,attachPoll:a,foundPolls:s})=>{const o=(0,r.useRef)(null),[i,l]=(0,r.useState)(""),[c,m]=(0,r.useState)(!1);return(0,r.useEffect)((()=>(t(null),m(!0),()=>{m(!1)})),[]),r.createElement("div",{className:"found-polls"},r.createElement("div",{className:"found-polls__search"},r.createElement(Jn,{placeholder:"Начните вводить заголовок...",handleSearch:e=>{l(e),t(e)}})),r.createElement("div",{className:"found-polls__list",ref:o},c&&r.createElement(zn,{pageStart:0,wrapper:o.current,loadMore:()=>n(i),hasMore:e,loader:r.createElement(Yn,null)},s?.length>0?s.map((({id:e,title:t})=>r.createElement("div",{className:"found-polls__list-item",key:e,onClick:()=>{a(e)}},t))):r.createElement("div",{className:"found-polls__msg"},"Mы ничего не нашли..."))))})),Qn=Xn,ea=(0,r.memo)((({identifier:e,mtPostEditor:t,searchPolls:n,addPoll:a,foundPolls:s,setTab:o})=>r.createElement(Qn,{foundPolls:s,hasMore:t?.hasMoreFoundPolls,loadMorePolls:a=>{n(e,a,t.foundPollsOffset)},searchPolls:t=>{n(e,t)},attachPoll:t=>{a(e,t),o(e,"poll")}})));ea.propTypes={identifier:f().string,mtPostEditor:f().object,addPoll:f().func,searchPolls:f().func,foundPolls:f().array,setTab:f().func};const ta=(0,i.$j)(((e,{identifier:t})=>({mtPostEditor:e.mtPostEditor?.[t],foundPolls:e.mtPostEditor?.[t]?.foundPolls})),(e=>({addPoll:(t,n)=>{e(Ft(t,n))},createNewPoll:t=>{e(jt(t))},searchPolls:(t,n,a)=>{e(Gt(t,n,a))},setTab:(t,n)=>{e(Zt(t,n))}})))(ea);const na=
/**
 * Mirtesen.
 *
 * YM Loader.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class{static _addScript(e,t,n,a,s,r,o){e[s]=e[s]||function(){(e[s].a=e[s].a||[]).push(arguments)},e[s].l=1*new Date;for(let e=0;e<document.scripts.length;e++)if(document.scripts[e].src===a)return;r=t.createElement(n),o=t.getElementsByTagName(n)[0],r.async=1,r.src=a,o.parentNode.insertBefore(r,o)}static init(e,t){"undefined"!=typeof window&&(window.mtYandexMetrics=window.mtYandexMetrics||[],e.forEach((e=>{window.mtYandexMetrics.push(e),this._addScript(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym"),window.ym(e,"init",t)})))}static ym(...e){if("undefined"!=typeof window)try{window.mtYandexMetrics.forEach((t=>{window?.ym(t,...e)}))}catch(e){D.Z.promiseHandler("/index.js")(e)}}};var aa=n(43834),sa=n(76859);const ra=(0,r.createContext)({currentTab:"",prevTab:"",setTab:()=>{},searchQuery:"",setSearchQuery:()=>{},searchResults:null,setSearchResults:()=>{},searchInProgress:!1,setSearchInProgress:()=>{},selectedPosition:null,setSelectedPosition:()=>{}});var oa=n(43754),ia=n(2079);
/**
 * Mirtesen.
 *
 * API interface for Tooltip views.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class la{static tooltipPlaces={APP_FULLSCREEN_PROMO:{id:1e3,display:"interval",displayInterval:{auth:86400,guest:28800}},LEFT_MENU_USER_POSTS:{id:1002,display:"interval",displayInterval:{auth:"once",guest:604800}},LEFT_MENU_MESSENGER:{id:1003,display:"interval",displayInterval:{auth:"once",guest:604800}},MT_POST_EDITOR:{id:1004,display:"interval",displayInterval:{auth:"once",guest:2592e3}},STICKY_BUTTON_2:{id:1005,display:"interval",displayInterval:{auth:86400,guest:10}},LEFT_MENU_POLLS_LIST:{id:1006,display:"interval",displayInterval:{auth:"once",guest:604800}},LEFT_MENU_BLOGGERS_LIST:{id:1007,display:"interval",displayInterval:{auth:"once",guest:604800}},LEFT_MENU_CHATS_LIST:{id:1008,display:"interval",displayInterval:{auth:"once",guest:604800}},LEFT_MENU_BUTTON_CREATE_POST_5:{id:1010,display:"interval",displayInterval:{auth:0,guest:0}},TIME_LINE_NOTIFICATION:{id:1011,display:"interval",displayInterval:{auth:86400,guest:0}},LEFT_MENU_PROMO_TOPIC:{id:1012,display:"interval",displayInterval:{auth:86400,guest:7200}},CHANNEL_FEEDBACK:{id:1013,display:"interval",displayInterval:{auth:604800,guest:604800}},MT_GEO_LOCATION_PLACE:{id:1014,display:"interval",displayInterval:{auth:1209600,guest:1209600}},MT_ADD_CUSTOM_TAG_INFO:{id:1015,display:"interval",displayInterval:{auth:"once",guest:"once"}},MT_CUSTOM_TAG_TOOLTIP:{id:1016,display:"interval",displayInterval:{auth:"once",guest:"once"}}};static cookie="_mt_tooltips2";static setView=async e=>{if("undefined"==typeof window)return!1;const t=la.tooltipPlaces[e]?.id||e;return b.ZP.isLogged()?await la._setAuthView(t):await la._setGuestView(t)};static _setAuthView=async e=>{try{return await R.Z.request({query:`mutation {\n                    setTooltipView(tooltipId: ${e})\n                }`,endpoint:{endpoint:"user",ver:"v1"}})}catch(e){D.Z.promiseHandler("/index.js")(e)}};static _setGuestView=async e=>{if("undefined"==typeof window)return!1;let t=K.Z.getCookie(la.cookie)||JSON.stringify({});t=JSON.parse(t),t[e]=(new Date).toISOString();let n=window.location.hostname.split(".");n=`.${n[n.length-2]}.${n[n.length-1]}`,K.Z.setCookie(la.cookie,JSON.stringify(t),{expires:94608e3,domain:n})};static getView=e=>{if("undefined"==typeof window)return!1;const t=L()(la.tooltipPlaces,`${e}.id`)||e;return!!t&&(b.ZP.isLogged()?la._getAuthView(t):la._getGuestView(t))};static _getAuthView=e=>{const t=L()(re.Z.getStore().getState(),"auth.viewedTooltips",[]);let n=null;return t.map((t=>{Number(e)===Number(t.id)&&(n=t.viewed)})),n};static _getGuestView=e=>{if("undefined"==typeof window)return!1;let t=K.Z.getCookie(la.cookie)||JSON.stringify({});return t=JSON.parse(t),L()(t,e)||null};static canView=(e,t={})=>{if("undefined"==typeof window)return!1;if(navigator.userAgent.toLowerCase().indexOf("miui")>-1&&"APP_FULLSCREEN_PROMO"===e)return!1;const n=la.getView(e);if(!1===n)return!1;if(!n)return!0;const a=la.tooltipPlaces[e]||t,s=new Date(n);if("interval"===a.display){const e=b.ZP.isLogged()?a.displayInterval.auth:a.displayInterval.guest;return"once"!==e&&(!!Number.isInteger(e)&&s.getTime()+1e3*e<Date.now())}}}const ca=la,ma=({selectTab:e})=>{const{setTab:t,prevTab:n}=(0,r.useContext)(ra),[a,s]=(0,r.useState)(!1),o=(0,r.useRef)(null);return(0,r.useEffect)((()=>{"add-custom-tag"===n&&ca.canView("MT_CUSTOM_TAG_TOOLTIP")&&s(!0)}),[]),r.createElement("div",{className:"custom-tags-link",ref:o},r.createElement(yn.Z,{iconName:"tag2"}),r.createElement(He.Z,{id:"my-custom-tags-btn",appearance:"link",label:"Мои ярлыки",color:"primary",title:"Мои ярлыки",onClick:()=>{t(e)}}),a&&r.createElement(oa.Z,{target:o.current,placement:"top-left",offset:[0,6],enableMobile:!1,className:"tooltip custom-tag-tooltip",delay:500},r.createElement("p",null,"Созданные вами ярлыки находятся здесь и видны только вам. Используйте их, чтобы отмечать себя в значимых для вас местах, если вы не хотите использовать автоматическое определение местоположения или оно работает некорректно"),r.createElement(ia.Z,{type:"button",onClick:()=>{s(!1),ca.setView("MT_CUSTOM_TAG_TOOLTIP")},className:"control"},"Понятно")))},da=(0,r.memo)(ma),pa=()=>r.createElement(ia.Z,{type:"button",className:"close-button",onClick:()=>{kt.Z.sendMessage({type:"MT_APP_SHOW_GEO_USER_POPUP",show:!1}),kt.Z.sendMessage({type:"MT_APP_SHOW_GEO_POST_POPUP",show:!1})}},r.createElement(yn.Z,{iconName:"close"})),ua=(0,r.memo)(pa),ga=()=>{const{prevTab:e,setTab:t}=(0,r.useContext)(ra);return r.createElement(ia.Z,{type:"button",className:"prev-button",onClick:()=>{t(e)}},r.createElement(yn.Z,{iconName:"back-3"}))},ha=(0,r.memo)(ga),_a=({title:e,enablePrev:t,enableClose:n})=>(t=!1!==t,n=!1!==n,r.createElement("div",{className:"geo-header"},t&&r.createElement(ha,null),r.createElement("h3",null,e||"Мое местоположение"),n&&r.createElement(ua,null))),Ea=(0,r.memo)(_a),fa=({isActive:e,onChange:t})=>r.createElement("label",{className:"switch"},r.createElement("input",{type:"checkbox",checked:e,onChange:t}),r.createElement("span",{className:"slider"})),ba=(0,r.memo)(fa);var ya=n(2823),va=n(91517),Ta=n(41609),Sa=n.n(Ta),Pa=n(48687),wa="/index.js";
/**
 * Mirtesen.
 *
 * Geo.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Ia{static getGeoTagByIp=async(e,t={})=>{const{req:n,res:a}=t;try{const t=await R.Z.request(`query{\n                    getLocationByIp(ip: "${e}") {\n                        id\n                        name\n                    }\n                }`,null,{endpoint:"main",ver:"v1"},n,a);return t?.id?{id:t.id,text:t.name,typeId:Pa.Z.tagType.geotag}:null}catch(e){D.Z.promiseHandler(wa)(e)}};static getGeoById=(e,t)=>{const n={project:"place",body:JSON.stringify({query:`query {\n                    getGeoById(\n                         id: ${e},\n                     ) {\n                        id\n                        type\n                        country\n                        region\n                        city\n                        street\n                        house\n                        siblings{\n                          id\n                          type\n                          country\n                          region\n                          city\n                          street\n                          house\n                        }\n                    }\n                 }`})};return(0,yt.Z)({...t,...n}).then((e=>Ia._normalizeGeo(L()(e,"data.getGeoById",null)))).catch(D.Z.promiseHandler(wa))};static _normalizeGeo=e=>{if(!e)return null;const t=(e.siblings||[]).map((e=>({label:e.house||e.street||e.city||e.region||e.country,url:"/world/"+e.id})));return{...e,siblings:t}};static saveCurrentGeoPosition=async({lon:e,lat:t,tagId:n,osmSid:a})=>{try{if(e=Number.isFinite(e)?parseFloat(e.toFixed(5)):null,t=Number.isFinite(t)?parseFloat(t.toFixed(5)):null,!(n||a||e&&t))return;const{osmType:s,osmId:r}=va.Z.parseOsmSid(a);return await R.Z.request({query:"mutation setUserCurrentPosition(\n                    $tagId: Float\n                    $lon: Float\n                    $lat: Float\n                    $osmId: Float\n                    $osmType: String\n                ) {\n                    setUserCurrentPosition(\n                        tag_id: $tagId\n                        lon: $lon\n                        lat: $lat\n                        osm_id: $osmId\n                        osm_type: $osmType\n                    )\n                }",variables:{tagId:n,lon:e,lat:t,osmId:Number(r),osmType:s},endpoint:{endpoint:"main",ver:"v3"}})}catch(e){D.Z.promiseHandler(wa)(e)}};static reduceGeoPositionTitle=(e="")=>e.replace(/^(район)\s/i,"")}const Ca=Ia,Na="_mt_geoposition_source",Oa="_mt_geoposition_current",Ma=()=>window.navigator.geolocation.getCurrentPosition((e=>{const{latitude:t,longitude:n}=e.coords;kt.Z.sendMessage({type:"MT_APP_SET_NAVIGATOR_GEOLOCATION",geolocation:{result:!0,lon:n,lat:t}})}),(e=>{"development"===re.Z.getConfig().mode?kt.Z.sendMessage({type:"MT_APP_SET_NAVIGATOR_GEOLOCATION",geolocation:{result:!0,lon:44.74983979505275,lat:41.72333694388248}}):kt.Z.sendMessage({type:"MT_APP_SET_NAVIGATOR_GEOLOCATION",geolocation:{result:!1,errorCode:e.code}})}),{enableHighAccuracy:!0,maximumAge:1e4,timeout:3600}),ka=e=>t=>{t({type:"GEO_POSITION_SET_INPROCESS",status:e})},Aa=e=>t=>{t({type:"GEO_POSITION_SET_CURRENT_SOURCE",source:e})},xa=e=>t=>{ya.Z.set(Na,e,{expires:31536e3}),t({type:"GEO_POSITION_SET_PREFERRED_SOURCE",source:e})},La=e=>async t=>{t(ka(!0));const n=await va.Z.getOsmInfo(e);if(!n)return t(Aa("ip"));const{displayName:a,displayAddress:s}=va.Z.normalizeOsmInfo(n);if(!a)return console.log("OSM error"),console.log("Raw OSM info:"),console.log(n),console.log("Parsed OSM info:"),console.log(va.Z.normalizeOsmInfo(n)),void kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Не удалось определить данные гео-позиции. Выберите другую точку."});t({type:"GEO_POSITION_SET_OSM_TAG",info:{osmSid:e,title:a,description:s,lon:n?.centroid?.coordinates?.[0]||null,lat:n?.centroid?.coordinates?.[1]||null}}),t(xa("osmTag")),t(Ra({title:a})),t(ka(!1))},Da=e=>async t=>{t(ka(!0));const n=await Pa.Z.getGeotagById(e);t({type:"GEO_POSITION_SET_CUSTOM_TAG",info:n}),t(xa("customTag")),t(Ra({title:n?.text})),t(ka(!1))},Ra=e=>t=>{t({type:"GEO_POSITION_SET_META",meta:e})},Za=e=>t=>{t({type:"GEO_POSITION_SET_POST_CURRENT_SOURCE",source:e})},Ba=e=>async t=>{t(ka(!0));t({type:"GEO_POSITION_SET_POST_CUSTOM_TAG",info:await Pa.Z.getGeotagById(e)}),t(Za("customTag")),t(ka(!1))},$a=e=>async t=>{t(ka(!0));const n=await va.Z.getOsmInfo(e);if(!n)return console.log("OSM error"),console.log("Raw OSM info:"),console.log(n),console.log("Parsed OSM info:"),console.log(va.Z.normalizeOsmInfo(n)),void kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Не удалось определить данные гео-позиции. Выберите другую точку."});const{displayName:a,displayAddress:s}=va.Z.normalizeOsmInfo(n);a?(t({type:"GEO_POSITION_SET_POST_OSM_TAG",info:{osmSid:e,title:a,description:s,lon:n?.centroid?.coordinates?.[0]||null,lat:n?.centroid?.coordinates?.[1]||null}}),t(Za("osmTag")),t(ka(!1))):kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Не удалось определить данные гео-позиции. Выберите другую точку."})},Ua=e=>(t,n)=>{const a=n().geoPosition,s=Ha(e,a),r=s||Fa();(0,sa.TT)(r,{duration:0})},Ha=(e,t)=>{let n,a,s,r,o="bounds";if("user"===e)switch(r=t.currentSource,r){case"ip":n=t.ip.osmSid;break;case"navigatorGeolocation":n=t.navigatorGeolocation.osmSid;break;case"osmTag":n=t.osmTag.osmSid;break;case"customTag":a=t.customTag.lat,s=t.customTag.lon,o="point"}else if("post"===e)switch(r=t.post.currentSource,r){case"osmTag":n=t.post.osmTag.osmSid;break;case"customTag":a=t.post.customTag.lat,s=t.post.customTag.lon,o="point"}return(n||s&&a)&&o?{type:o,osmSid:n,lon:s,lat:a}:null},Fa=()=>({type:"point",lon:37.62132,lat:55.75861}),ja=()=>{const e=(0,aa.C)((e=>e.geoPosition?.currentSource)),t=(0,aa.T)(),n="navigatorGeolocation"===e;return r.createElement("div",{className:"autodetect-position"},r.createElement(yn.Z,{iconName:n?"send-3":"send-2",extraClasses:_()(n&&"active")}),r.createElement("div",{className:"text"},r.createElement("p",null,"Определять автоматически"),r.createElement("p",{className:"extra-text"},"Следите за событиями рядом с вами")),r.createElement(ba,{isActive:n,onChange:e=>{e.target.checked?Ma():(t(xa("ip")),t(Aa("ip")))}}))},Ga=(0,r.memo)(ja);var qa=n(3707);
/**
 * Mirtesen.
 *
 * Geo map list.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Va=({osmSid:e})=>{const[t,n]=(0,r.useState)(!1),[a,s]=(0,r.useState)(!1),{setTab:o}=(0,r.useContext)(ra),i=(0,aa.T)();(0,r.useEffect)((()=>{(async()=>{if(s(!1),!e)return;const{osmId:t}=va.Z.parseOsmSid(e),a=await Pa.Z.getTagByOsmId(Number(t));if(a?.id){const e=await Pa.Z.getTagSubscriptionStatus(a.id);n(!!e)}else n(!1);s(!0)})()}),[e]);return r.createElement("div",{className:_()({"osm-tag-actions":!0,ready:a})},r.createElement(He.Z,{onClick:async()=>{const{osmId:a,osmType:s}=va.Z.parseOsmSid(e),r=await Pa.Z.getTagByOsmId(Number(a));let o=r?.id;if(t){if(!o)return;await qa.Z.deleteManualInterest("tag",o),n(!1),kt.Z.sendMessage({type:"MT_APP_UPDATE_SUBSCRIBERS",subscriptionType:"tag",id:o,value:!1}),kt.Z.sendMessage({type:"MT_APP_RELOAD_POST_FEED"})}else{if(!o){const t=await va.Z.getOsmInfo(e),{displayName:n,displayAddress:r}=va.Z.normalizeOsmInfo(t),l=t?.centroid,c=l?.coordinates[0],m=l?.coordinates[1];o=await Pa.Z.addCustomTagAndSubscribe({name:n,description:r,lon:c,lat:m,osmId:Number(a),osmType:s}),o&&i(Da(o))}if(!o)return void kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Не удалось подписаться на тег"});await qa.Z.setInterest("TAG",o,!0),n(!0),kt.Z.sendMessage({type:"MT_APP_UPDATE_SUBSCRIBERS",subscriptionType:"tag",id:o,value:!0}),kt.Z.sendMessage({type:"MT_APP_RELOAD_POST_FEED"}),na.ym("reachGoal","geo_subscribe")}},icon:t?"check":void 0,label:t?"Вы подписаны":"Подписаться",color:t?"secondary":"primary",className:"subscribe"}),r.createElement(He.Z,{onClick:()=>{ca.canView("MT_ADD_CUSTOM_TAG_INFO")?o("custom-tag-tips"):o("add-custom-tag")},color:"secondary",label:"Создать ярлык"}))},za=(0,r.memo)(Va);var Wa=n(74855);
/**
 * Mirtesen.
 *
 * Clipboard component.
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Ya extends r.PureComponent{handleSuccess=()=>{kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Скопировано в буфер обмена",className:"clipboard__tooltip"})};render(){const{text:e,children:t,classes:n}=this.props;return r.createElement("div",{className:"clipboard"},r.createElement(Wa.CopyToClipboard,{text:e,onCopy:this.handleSuccess},r.createElement("button",{className:n},t)))}}Ya.propTypes={text:f().string,children:f().string,classes:f().string};const Ka=Ya,Ja=({className:e="",url:t,text:n="Cкопировать ссылку"})=>r.createElement(Ka,{text:y.Z.fixProtocol(t),classes:e},n);Ja.propTypes={className:f().string,url:f().string,text:f().string};const Xa=(0,r.memo)(Ja);var Qa="/index.js";
/**
 * Mirtesen.
 *
 * Channel Actions Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const es=e=>async(t,n)=>{const a=n().channelSubscribeAction[e];if(!a?.isInitialized){t({type:"CHANNEL_SUBSCRIBE_ACTION_SET_INIT_STATUS",id:e,isInitialized:!0});try{const n=await At.ZP.getChannelById(e);t({type:"CHANNEL_SUBSCRIBE_ACTION_INIT",id:e,data:n})}catch(e){D.Z.promiseHandler(Qa)(e)}}},ts=(e,t)=>async n=>{try{await At.ZP.setSubscriptionStatus(e,t)?(n({type:"CHANNEL_SUBSCRIBE_ACTION_SET_SUBSCTIPTION_STATUS",id:e,status:t}),kt.Z.sendMessage({type:"MT_APP_UPDATE_SUBSCRIBERS",value:t,id:e,subscriptionType:"channel"})):kt.Z.sendSystemMessage("exception")}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler(Qa)(e)}},ns=({channelId:e,className:t})=>{const n=(0,aa.T)(),a=(0,aa.C)((e=>e.channelSubscribeAction)),s=a[e]?.channel,{is_subscribed:o}=s||{};return(0,r.useEffect)((()=>{!e||s||o||n(es(e))}),[]),e&&s?r.createElement(ia.Z,{className:t,onClick:t=>{t.stopPropagation(),b.ZP.isLogged()?n(ts(e,!o)):n(_e("login"))}},o?"Отписаться":"Подписаться"):null},as=(0,r.memo)(ns);const ss=({className:e=""})=>{const[t,n]=(0,r.useState)(!1),a=(0,r.useCallback)((async()=>{try{n(!0)}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler("/index.js")(e)}}),[]);return t?null:r.createElement(ia.Z,{onClick:a,className:_()("highlight",e)},"Пожаловаться")},rs=(0,r.memo)(ss),os=({channelId:e,className:t})=>b.ZP.isLogged?r.createElement(ia.Z,{className:t,onClick:()=>{kt.Z.sendMessage({type:"MT_APP_OPEN_CHANNEL_EDITOR",channelId:e})}},"Редактировать"):null,is=(0,r.memo)(os);var ls=n(82537),cs="/index.js";const ms=
/**
 * Mirtesen.
 *
 * API interface for Action user moeration.
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class{abuseBlogPost=async e=>{try{return await R.Z.request({query:"mutation abuseBlogPost($postId: Float!) {\n                    abuseBlogPost(blog_post_id: $postId)\n                }",variables:{postId:e},endpoint:{endpoint:"blogs",ver:"v1"}})}catch(e){D.Z.promiseHandler(cs)(e)}};banUser=async(e,t,n=!1)=>{try{return await R.Z.request({query:"mutation banUser($userId: Float!, $sectionId: Float!, $blockContent: Boolean) {\n                    banUser(user_id: $userId, section_id: $sectionId, block_content: $blockContent)\n                }",variables:{userId:e,sectionId:-t,blockContent:n},endpoint:{endpoint:"user",ver:"v1"}})}catch(e){D.Z.promiseHandler(cs)(e)}};unbanUser=async(e,t)=>{try{return await R.Z.request({query:"mutation unbanUser($userId: Float!, $sectionId: Float!) {\n                    unbanUser(user_id: $userId, section_id: $sectionId)\n                }",variables:{userId:e,sectionId:-t},endpoint:{endpoint:"user",ver:"v1"}})}catch(e){D.Z.promiseHandler(cs)(e)}};ignoreAuthor=async(e,t,n=!0)=>{try{const a=n?"t":"f",s=await R.Z.request({query:`mutation {\n                    setUserSettings(\n                        id: ${e}\n                        settings: "{\\"ignore\\":{\\"people\\":[{\\"${t}\\":\\"${a}\\"}]}}"\n                    )\n                }`,endpoint:{endpoint:"user",ver:"v1"}});return JSON.parse(s)?.result}catch(e){D.Z.promiseHandler(cs)(e)}};ignoreBlog=async(e,t,n=!0)=>{try{const a=n?"t":"f",s=await R.Z.request({query:`mutation {\n                    setUserSettings(id: ${e}, settings: "{\\"ignore\\":{\\"sites\\":[{\\"${t}\\":\\"${a}\\"}]}}")\n                }`,endpoint:{endpoint:"user",ver:"v1"}});return JSON.parse(s)?.result}catch(e){D.Z.promiseHandler(cs)(e)}};hideBlogPost=async e=>{try{return await R.Z.request({query:"mutation hideBlogPost($postId: Float!) {\n                    hideBlogPost(blog_post_id: $postId)\n                }",variables:{postId:e},endpoint:{endpoint:"blogs",ver:"v1"}})}catch(e){D.Z.promiseHandler(cs)(e)}};hideTopic=async e=>{try{return await R.Z.request({query:"mutation hideTopic($topic: String!) {\n                    hideTopic(topic: $topic)\n                }",variables:{topic:e},endpoint:{endpoint:"main",ver:"v3"}})}catch(e){D.Z.promiseHandler(cs)(e)}}};const ds=({post:e,className:t=""})=>{const[n,a]=(0,r.useState)(!1),s=(0,r.useCallback)((async()=>{try{const t=new ms;void 0!==await t.hideBlogPost(e.id)?(kt.Z.sendSystemMessage("ignorePost"),kt.Z.sendHidePostMessage(e.id),a(!0)):kt.Z.sendSystemMessage("exception")}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler("/index.js")(e)}}),[e]);return n?null:r.createElement(ia.Z,{onClick:s,className:_()(t)},"Скрыть из Ленты")},ps=(0,r.memo)(ds);const us=({post:e,className:t=""})=>{const[n,a]=(0,r.useState)(!1),s=(0,r.useCallback)((async()=>{try{const t=new ms;void 0!==await t.abuseBlogPost(e.id)?(kt.Z.sendSystemMessage("abuse"),kt.Z.sendHidePostMessage(e.id),a(!0)):kt.Z.sendSystemMessage("exception")}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler("/index.js")(e)}}),[e]);return!e||n?null:r.createElement(ia.Z,{onClick:s,className:_()("highlight",t)},"Пожаловаться")},gs=(0,r.memo)(us);function hs(){return hs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},hs.apply(this,arguments)}const _s=({post:e,className:t,editorType:n})=>{const a=(0,aa.C)((e=>e?.auth?.user||{})),s=(0,aa.C)((e=>e?.personSettings?.vislvl)),o=(0,aa.C)((e=>e?.app?.person||{})),i=re.Z.getConfig();let l;switch(n){case"blog":l={href:e.group?.url+`/blog/${e.id}/edit`,onClick:t=>{t.preventDefault(),e.group&&(window.location.href=e.group.url+`/blog/${e.id}/edit`)}};break;case"user":l={onClick:()=>{kt.Z.sendMessage({type:"MT_APP_SHOW_MT_POST_EDITOR",identifier:"default",postId:e.id,params:{author:{id:a.id,name:a.display_name,image:a.photo_original||""},target:{type:"user",id:o.id||a.id,birthday:o.bdate||a.bdate},personVislvl:s}})}};break;case"channel":l={onClick:()=>{"user_post_rich"===e.post_type?window.location.href=`${i.mainProto}://${i.channelDomain}/editor?post=${e.id}`:kt.Z.sendMessage({type:"MT_APP_SHOW_MT_POST_EDITOR",identifier:"default",postId:e.id,params:{author:{id:a.id,name:a.display_name,image:a.photo_original||""},target:{type:"channel",id:e?.channel?.id,channelName:e?.channel?.name,channelTitle:e?.channel?.title},personVislvl:s}})}};break;default:l=null}return l?r.createElement(ia.Z,hs({className:t},l),"Редактировать"):null},Es=(0,r.memo)(_s);var fs=n(93669),bs="/index.js";
/**
 * Mirtesen.
 *
 * Action delete post popup Actions
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const ys=(e,t="")=>n=>{n({type:"TOGGLE_ACTION_DELETE_POST_POPUP",id:e,popupType:t})},vs=({post:e,className:t=""})=>{const n=(0,aa.T)(),a=(0,r.useCallback)((()=>{n(ys(e.id,"delete"))}),[e]);return e?r.createElement(ia.Z,{onClick:a,className:_()("highlight",t)},"Удалить"):null},Ts=(0,r.memo)(vs);const Ss=(e,t)=>async(n,a)=>{const s=a(),r=s.post2Top?.posts?.[e];if(e&&void 0===r){if(void 0!==t)return n({type:"POST_2_TOP_INIT",postId:e,topStatus:t});try{const t=await At.ZP.getTopStatus(e);return n({type:"POST_2_TOP_INIT",postId:e,topStatus:t?.top_status||null})}catch(e){D.Z.promiseHandler("/index.js")(e)}}},Ps=(e,t)=>async n=>!!await At.ZP.setPost2TopStatus(e,t)&&n({type:"POST_2_TOP_SET_TOP_STATUS",postId:e,topStatus:t}),ws={approved:{title:"В ТОП",status:"APPROVED",emoji:"moder-top"},skipped:{title:"Пропустить",status:"SKIPPED",emoji:"moder-zero"},discarded:{title:"Утопить",status:"DISCARDED",emoji:"moder-down"}},Is={WAIT:{title:"Заявка в топ",text:"Публикация на проверке модераторами"},APPROVED:{title:"Топ публикация",text:"Публикация размещена в Топ"},DISCARDED:{title:"Заявка в топ",text:"Публикация отклонена"}},Cs=({post:e,className:t=""})=>{const n=(0,aa.C)((e=>e.post2Top)),a=n.posts?.[e.id],s=(0,aa.T)();if((0,r.useEffect)((()=>{s(Ss(e.id,e.top_status))}),[]),void 0===a)return null;let o=null;if(null!==a&&Is[a]){const e=Is[a];o=r.createElement("div",{className:_()(t,"top-status")},r.createElement("span",{className:"title"},e.title),r.createElement("span",{className:"text"},e.text))}return null===a&&(o=r.createElement(ia.Z,{className:t,type:"button",onClick:async()=>{s(Ps(e.id,"WAIT"))}},"Предложить в топ")),o},Ns=(0,r.memo)(Cs);const Os=({post:e,className:t})=>{const[n,a]=(0,r.useState)(!1),s=(0,r.useCallback)((async()=>{try{const t=new ms;void 0!==await t.hideTopic(e.topic)?(kt.Z.sendSystemMessage("ignoreTopic"),kt.Z.sendHidePostMessage(e.id),a(!0)):kt.Z.sendSystemMessage("exception")}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler("/index.js")(e)}}),[e]);return n?null:r.createElement(ia.Z,{onClick:s,className:_()(t)},"Скрыть тематику")},Ms=(0,r.memo)(Os);const ks=({post:e,className:t})=>{const[n,a]=(0,r.useState)(!1),s=(0,aa.C)((e=>e?.auth?.user||{})),o=(0,r.useCallback)((async()=>{try{const t=e?.group?.id;if(!t)return;const n=new ms;void 0!==await n.ignoreBlog(s?.id,t,!0)?(kt.Z.sendSystemMessage("ignoreBlog"),kt.Z.sendHidePostMessage(e.id),a(!0)):kt.Z.sendSystemMessage("exception")}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler("/index.js")(e)}}),[e,s]);return n?null:r.createElement(ia.Z,{onClick:o,className:_()(t)},"Скрыть посты блога")},As=(0,r.memo)(ks);const xs=({post:e,className:t})=>{const[n,a]=(0,r.useState)(!1),s=(0,aa.C)((e=>e?.auth?.user||{})),o=(0,r.useCallback)((async()=>{try{const{from:{id:t},id:n}=e,r=new ms;void 0!==await r.ignoreAuthor(s?.id,t,!0)?(kt.Z.sendSystemMessage("ignoreAuthor"),kt.Z.sendHidePostMessage(n),a(!0)):kt.Z.sendSystemMessage("exception")}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler("/index.js")(e)}}),[e,s]);return n?null:r.createElement(ia.Z,{onClick:o,className:_()(t)},"Скрыть посты автора")},Ls=(0,r.memo)(xs);var Ds=n(3674),Rs=n.n(Ds),Zs="/index.js";
/**
 * Mirtesen.
 *
 * API interface for Email Notifications.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Bs{static async getList(e,t){const n={endpoint:"blogs"},a={siteId:e,offset:(t={offset:0,count:15,...t}).offset,count:t.count};try{return await R.Z.request("query groupNotificationStatistics ($siteId: Float!, $count: Int!, $offset: Int) {\n                groupNotificationStatistics (siteId: $siteId, offset: $offset, count: $count) {\n                lastUpdated\n                items {\n                  id\n                  ctr\n                  createdAt\n                  startedAt\n                  records\n                  processed\n                  blocked\n                  opened\n                  visited\n                  rate\n                  from {\n                    id\n                    display_name\n                    url\n                    photo_original\n                  }\n                  post {\n                    title\n                    url\n                    comments_count\n                    date\n                    likes {\n                      count\n                      user_likes\n                    }\n                    from {\n                      id\n                      display_name\n                      url\n                      photo_original\n                    }\n                  }\n                }\n              }\n            }",a,n)||{}}catch(e){D.Z.promiseHandler(Zs)(e)}}static async getByPostId(e){const t={endpoint:"blogs"},n={postId:e};try{const e=await R.Z.request("query blogPostNotificationStatistics ($postId: Float!) {\n          blogPostNotificationStatistics(blog_post_id: $postId) {\n            created\n            started\n            processed_count\n            total_count\n            processed_percent\n            read_percent\n            click_percent\n            click_from_sent_percent\n            finished\n            person_name\n            person_id\n            read_count\n            click_count\n            blocked_count\n            blocked_percent\n          }\n        }",n,t);if(e){const t=Bs._normalizeDate(e.started),n=Bs._normalizeDate(e.created);return{...e,started:t,created:n}}return{}}catch(e){D.Z.promiseHandler(Zs)(e)}}static async sendNotify(e){const t={endpoint:"blogs"},n={postId:e};try{const e=await R.Z.request("mutation notifyAboutBlogPost ($postId: Float!) {\n            notifyAboutBlogPost(blog_post_id: $postId)\n        }",n,t);return JSON.parse(e)||{}}catch(e){D.Z.promiseHandler(Zs)(e)}}static _normalizeDate=e=>c()(e).isValid()?c()(e).toISOString():""}const $s=Bs;
/**
 * Mirtesen.
 *
 * Action blog post notify Actions
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Us=e=>t=>{t({type:"ACTION_BLOG_POST_NOTIFY_POPUP_TOGGLE",id:e})},Hs=({post:e,className:t})=>{const n=(0,aa.T)(),a=(0,aa.C)((e=>e.actionBlogPostNotify.id));return r.createElement(r.Fragment,null,e.notificationsCanBeSent&&Number(e.notificationsLimit)>0&&r.createElement(ia.Z,{className:t,onClick:()=>{n(Us(a||e.id))}},"Уведомить о теме"),0===e.notificationsLimit&&!(e.notificationsSent||e.notificationsWillBeSent)&&r.createElement(ia.Z,{disabled:!0,className:t},"Лимит рассылок на сегодня исчерпан"))},Fs=(0,r.memo)(Hs);
/**
 * Mirtesen.
 *
 * Email Notification Actions.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const js=({post:e,className:t})=>{const n=(0,aa.T)(),a=(0,aa.C)((e=>e.app.page));return"blogPost"!==a&&"blogPostDispute"!==a||!e.notificationsSent&&!e.notificationsWillBeSent?null:r.createElement(ia.Z,{className:t,onClick:()=>{var t;n((t=e.id,e=>{$s.getByPostId(t).then((t=>{"undefined"!==t&&t&&(e({type:"EMAIL_NOTIFICATION_GET_DATA",data:t}),e({type:"EMAIL_NOTIFICATION_TOGGLE_BLOCK",show:!0}))})).catch(D.Z.promiseHandler("/index.js"))}))}},"Статистика уведомлений")},Gs=(0,r.memo)(js);const qs=({post:e,className:t})=>{const[n,a]=(0,r.useState)(!1),s=(0,aa.C)((e=>e?.app?.site?.id||null)),o=(0,aa.C)((e=>e?.blogMember?.tabs?.blocked?.userList||[])),i=(0,aa.C)((e=>e?.auth?.user||{}));(0,r.useEffect)((()=>{const t=o.findIndex((t=>e?.from?.id===t.id))>-1;a(t)}),[o]);const l=(0,r.useCallback)((async()=>{try{const t=new ms,r=n?t.unbanUser:t.banUser;void 0!==await r(e.from?.id,s)?(kt.Z.sendMessage({type:"MT_APP_CHANGE_MEMBER_COUNT",value:n}),kt.Z.sendSystemMessage(n?"unbanBlogMember":"banBlogMember"),a((e=>!e))):kt.Z.sendSystemMessage("exception")}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler("/index.js")(e)}}),[e]);return e?.from?.id&&e.from.id!==i.id&&s?r.createElement(ia.Z,{className:t,onClick:l},n?"Удалить автора из черного списка сайта":"Заблокировать на этом сайте"):null},Vs=(0,r.memo)(qs),zs=({post:e,className:t})=>{const n=(0,aa.T)();return"STATUS_PENDING"!==e?.status?null:r.createElement(ia.Z,{className:t,onClick:()=>{n(ys(e.id,"approve"))}},"Одобрить пост")},Ws=(0,r.memo)(zs);n(17708),n(82491),n(93811),n(17312);var Ys="/index.js";
/**
 * Mirtesen.
 *
 * API interface for Topic.
 *
 * @author       Artem Kamysh.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Ks{static setObjectsTopics=async(e,t)=>{try{return await R.Z.request({query:`mutation {\n                    setObjectsTopics (\n                        object_ids: ${JSON.stringify(e)},\n                        topics: ${JSON.stringify(t)}\n                    )\n                }`,endpoint:{endpoint:"main",ver:"v1"}})}catch(e){D.Z.promiseHandler(Ys)(e)}};static filterTopics=(e=[])=>{const t=e.filter((e=>"coronavirus"===e.key||"crysis"===e.key)).reverse();let n=e.filter((e=>"coronavirus"!==e.key&&"crysis"!==e.key));return n=[...t,...n.sort(((e,t)=>e.text.toLowerCase()<t.text.toLowerCase()?-1:e.text.toLowerCase()>t.text.toLowerCase?1:[])),{key:"all",text:"Разное"}],n};static getTopics=async(e=!1,t={})=>{try{return await R.Z.request({query:`query {\n                    getTopics(hidden: ${e}) {\n                        key\n                        text\n                        id\n                        icon\n                    }\n                }`,endpoint:{endpoint:"main",ver:"v1"},req:t.req,res:t.res})}catch(e){D.Z.promiseHandler(Ys)(e)}};static getTopicSettings=async(e,t=10,n=0,a={})=>{const s=fs.Z._getRequestFields({fieldList:"tile"});try{return await R.Z.request({query:`query {\n                  getTopicData(topic: "${e}", postsLimit:${t}, postsOffset:${n}) {\n                  brandingCode\n                  posts {\n                    items {\n                      ${s}   \n                    }\n                  }\n                }  \n              }`,endpoint:{endpoint:"main",ver:"v1"},req:a.req,res:a.res})}catch(e){D.Z.promiseHandler(Ys)(e)}};static getBlogPostsByTopic=async(e={})=>{e={topic:"",offset:0,count:18,filter:"selected",fieldList:"v3Tile",withBusinessPosts:!1,...e};const t=e?.filter?.toUpperCase()||"",n=fs.Z._getRequestFields(e);try{const a=await R.Z.request({query:`query {\n                  getTopicTiles(\n                    topic: "${e.topic}",\n                    offset:${e.offset},\n                    limit:${e.count}, \n                    filter:${t},\n                    withBusinessPosts:${e.withBusinessPosts}\n                  ) {\n                    items {\n                      ${n}\n                    }\n                  }\n                }`,endpoint:{endpoint:"main",ver:"v3"},req:e.req,res:e.res});return Ks._normalizeList(a?.items||[])}catch(e){return D.Z.promiseHandler(Ys)(e),[]}};static matchLinkByTopicName=e=>({fishing:"fishing_topic.jpg"}[e]);static getTopicBackground(e,t,n="https://market.mirtesen.ru/topics/"){const a=(e||[]).filter((e=>e.key===t)).reduce(((e,t)=>t.key),"");return n.concat(this.matchLinkByTopicName(a))}static _normalizeList(e){if(0===e.length)return[];return e.map((e=>{e.images=[],Array.isArray(e.attachments)&&e.attachments.map((t=>{t&&t.photo&&"object"==typeof t.photo&&e.images.push({main:!0,url:t.photo.photo_original,width:t.photo.width,height:t.photo.height})}));const t=e.action_datetime||e.date;return e.formattedDates={iso:c().unix(t).toISOString(),ver1:c().unix(t).format("D MMMM, H:mm"),ver2:c().unix(t).format("DD.MM.YYYY в H:mm"),pubTime:c()(e.publish_time).format("D MMMM, H:mm")},e}))}static async getTopicByKey(e,t=null,n={}){if("all"===(e=e?e.toLowerCase():e))return{title:"Разное",key:"all"};const a=t||await this.getTopics(void 0,n)||[],s={};return a.some((t=>{if(t.key.toLowerCase()===e)return s.title=t.text,s.key=t.key,!0})),s}}const Js=Ks;var Xs="/index.js";
/**
 * Mirtesen.
 *
 * Topic popup actions.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const Qs=e=>({type:"TOPIC_MODERATION_OPEN",currentBlogPostId:e}),er=({post:e,className:t})=>{const n=(0,aa.T)();return b.ZP.isEditor()?r.createElement(ia.Z,{className:t,onClick:()=>{n(Qs(e.id))}},"Изменить топик"):null},tr=({post:e,className:t=""})=>b.ZP.isDeveloper()?r.createElement(ia.Z,{className:t,onClick:()=>{kt.Z.sendMessage({type:"MT_APP_HIDE_POLL",id:e.id})}},"Скрыть опрос"):null;const nr=({tagId:e,className:t})=>{const n=(0,r.useCallback)((async()=>{try{if(!await Pa.Z.deleteCustomTag(e))return void kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Не удалось удалить тег"});kt.Z.sendMessage({type:"MT_APP_DELETE_CUSTOM_TAG",id:e})}catch(e){kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Не удалось удалить тег"}),D.Z.promiseHandler("/index.js")(e)}}),[e]);return e?r.createElement(ia.Z,{className:t,onClick:n},"Удалить"):null},ar={COPY_LINK_ACTION:Xa,CHANNEL_SUBSCRIBE_ACTION:as,COMPLAIN_CHANNEL_ACTION:rs,COMPLAIN_POST_ACTION:gs,EDIT_CHANNEL_ACTION:is,EDIT_POST_ACTION:Es,HIDE_POST_ACTION:ps,DELETE_POST_ACTION:Ts,SEND_TO_TOP_ACTION:Ns,HIDE_TOPIC_ACTION:Ms,HIDE_BLOG_POSTS_ACTION:As,HIDE_AUTHOR_POST_ACTION:Ls,BLOG_POST_NOTIFICATION_ACTION:Fs,GET_NOTIFICATION_STAT_ACTION:Gs,BLACKLIST_ACTION:Vs,APPROVE_BLOG_POST_ACTION:Ws,SET_TOPIC_ACTION:(0,r.memo)(er),HIDE_POLL_ACTION:(0,r.memo)(tr),DELETE_CUSTOM_TAG_ACTION:(0,r.memo)(nr)},sr={"channel-guest":["CHANNEL_SUBSCRIBE_ACTION","COPY_LINK_ACTION"],"channel-owner":["COPY_LINK_ACTION","EDIT_CHANNEL_ACTION"],"channel-post-guest":["COPY_LINK_ACTION","DELIMITER","CHANNEL_SUBSCRIBE_ACTION","DELIMITER","COMPLAIN_POST_ACTION"],"channel-post-owner":["SEND_TO_TOP_ACTION","DELIMITER","COPY_LINK_ACTION","EDIT_POST_ACTION","DELIMITER","DELETE_POST_ACTION"],"mt-feed-post-guest":["COPY_LINK_ACTION","DELIMITER","CHANNEL_SUBSCRIBE_ACTION","DELIMITER","HIDE_POST_ACTION","COMPLAIN_POST_ACTION"],"mirtesen-feed-blog-post-guest":["HIDE_TOPIC_ACTION","HIDE_POST_ACTION","HIDE_BLOG_POSTS_ACTION","HIDE_AUTHOR_POST_ACTION","COMPLAIN_POST_ACTION"],"mirtesen-feed-user-post-guest":["HIDE_POST_ACTION","HIDE_AUTHOR_POST_ACTION","COMPLAIN_POST_ACTION"],"mirtesen-feed-post-owner":["EDIT_POST_ACTION","DELIMITER","DELETE_POST_ACTION"],"profile-post-guest":["COMPLAIN_POST_ACTION"],"profile-post-owner":["EDIT_POST_ACTION","DELIMITER","DELETE_POST_ACTION"],"blog-post-moderator":["APPROVE_BLOG_POST_ACTION","BLOG_POST_NOTIFICATION_ACTION","GET_NOTIFICATION_STAT_ACTION","EDIT_POST_ACTION","BLACKLIST_ACTION","SET_TOPIC_ACTION","DELIMITER","DELETE_POST_ACTION"],"blog-post-author":["SET_TOPIC_ACTION","DELETE_POST_ACTION"],"blog-post-guest":["SET_TOPIC_ACTION","COMPLAIN_POST_ACTION"],"poll-author":["HIDE_POLL_ACTION"],"poll-guest":["HIDE_POLL_ACTION","COMPLAIN_POST_ACTION"],"blog-post-tile-guest":["HIDE_POST_ACTION","HIDE_BLOG_POSTS_ACTION","HIDE_AUTHOR_POST_ACTION","COMPLAIN_POST_ACTION"],"user-post-tile-guest":["HIDE_POST_ACTION","HIDE_AUTHOR_POST_ACTION","COMPLAIN_POST_ACTION"],"blog-post-bottom-post-tile":["COMPLAIN_POST_ACTION"],"video-guest":["COMPLAIN_POST_ACTION"],"custom-tag":["DELETE_CUSTOM_TAG_ACTION"]};function rr(){return rr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},rr.apply(this,arguments)}const or=({type:e,id:t,mobileBreakPoint:n=At.ZP.BREAKPOINTS.XS,color:a,placement:s="auto-right",...o})=>{if(!b.ZP.isLogged()||!e)return null;const i=sr[e];return r.createElement(G.Z,{id:t,customButtonClasses:a,customDropdownClasses:"context-dropdown",customListClasses:"context-dropdown__list",placement:s,mobileBreakPoint:n},i.map(((e,t)=>{if("DELIMITER"===e)return r.createElement("div",{className:"context-dropdown__delimiter",key:`action-${e}-${t}`});const n=ar[e];return n?r.createElement(n,rr({className:"context-dropdown__item"},o,{key:`action-${e}-${t}`})):null})))},ir=(0,r.memo)(or),lr=({title:e,description:t,imgSrc:n,actionsType:a,osmSid:s,customTagId:o})=>r.createElement("div",{className:"current-position"},n&&r.createElement("img",{className:"geo-image-locator",src:n,alt:"Текущее местоположение"}),r.createElement("div",{className:"description"},e&&r.createElement("h5",null,e),t&&r.createElement("div",{className:"extra-text"},t)),"osm"===a&&r.createElement(za,{osmSid:s}),"custom-tag"===a&&o&&r.createElement(ir,{type:"custom-tag",tagId:o,color:"blue",placement:"auto-center"})),cr=(0,r.memo)(lr);function mr(){return mr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},mr.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Search Input.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const dr=r.forwardRef((({handleSearch:e,searchUrl:t="",placeholder:n="Поиск",showQueryInUrl:a=!0,autoFocus:s=!1,searchTimeout:o=500,updatedQuery:i="",handleInputChange:l,minQuery:c=3,...m},d)=>{const p=(0,r.useRef)(),[u,g]=(0,r.useState)("");(0,r.useEffect)((()=>{i!==u&&g(i)}),[i]);return r.createElement("div",{className:"search-input"},r.createElement("input",mr({type:"text",placeholder:n,name:"search",autoComplete:"off",className:"search-input__input",onChange:n=>{const{value:s}=n.target;g(s),"function"==typeof l&&l(s),p.current&&clearTimeout(p.current),p.current=setTimeout((()=>{s.length>=c&&(a&&((e,t)=>{let n=e;t.length>=c&&(n+="?q="+encodeURIComponent(t)),window.history.pushState(null,"",n)})(t,s),e(s))}),o)},value:u,ref:d,spellCheck:"false",autoFocus:s,"aria-label":"Введите запрос"},m)),r.createElement(yn.Z,{iconName:"search-2",extraClasses:"search-input__icon"}),u&&r.createElement("button",{className:"search-input__close",type:"button",onClick:()=>{g(""),e(""),a&&window.history.pushState(null,"",t)}},r.createElement(yn.Z,{iconName:"close"})))})),pr=(0,r.memo)(dr),ur=({selectTab:e,enableBack:t})=>{const{searchQuery:n,setSearchQuery:a,setSearchResults:s,setSearchInProgress:o,setTab:i}=(0,r.useContext)(ra);return r.createElement("div",{className:"geo-search"},r.createElement(pr,{updatedQuery:n||"",handleSearch:async t=>{a(t),i(e),o(!0);let n=await va.Z.searchWithGeocoder(t)||[];t.length<=3&&(n=n.filter((e=>e.name.toLowerCase()===t.toLowerCase()))),s(n),o(!1)},placeholder:"Поиск мест",showQueryInUrl:!1,autoFocus:!1,searchTimeout:1e3,minQuery:2}),t&&r.createElement(He.Z,{appearance:"link",label:"Отмена",color:"primary",title:"Отмена",extraClasses:"geo-search-back",onClick:()=>{i("user-start")}}))},gr=(0,r.memo)(ur),hr=({children:e,extraClasses:t=""})=>{const n=_()({"geo-pane":!0,[t]:!!t});return r.createElement("div",{className:n},e)},_r=(0,r.memo)(hr),Er=()=>{const e=(0,aa.C)((e=>e.geoPosition)),t=e?.currentSource||"ip",n=e?.navigatorGeolocation||{},a=e?.osmTag||{},s=e?.customTag||{},o=(0,aa.T)();return(0,r.useEffect)((()=>{o(Ua("user"))}),[]),r.createElement("div",{className:"tab geo-user-start-tab"},r.createElement(_r,{extraClasses:"geo-pane_top"},r.createElement(Ea,{title:"Местоположение",enablePrev:!1}),r.createElement(gr,{selectTab:"user-search"})),r.createElement(sa.ZP,null),r.createElement(_r,{extraClasses:"geo-pane_bottom"},r.createElement(Ga,null),"ip"===t&&r.createElement("p",{className:"empty-position"},"Укажите место на карте, воспользуйтесь поиском или включите автоматическое определение местоположения"),"navigatorGeolocation"===t&&r.createElement(cr,{osmSid:n.osmSid,title:n.title,description:n.description,imgSrc:"/images/geo-popup/geo-marker3.svg",actionsType:"osm"}),"osmTag"===t&&r.createElement(cr,{osmSid:a.osmSid,title:a.title,description:a.description,imgSrc:"/images/geo-popup/geo-marker2.svg",actionsType:"osm"}),"customTag"===t&&r.createElement(cr,{customTagId:s.id,title:Pa.Z.stripGeoId(s.text),description:s.description,imgSrc:"/images/geo-popup/geo-marker4.svg",actionsType:"custom-tag"})),r.createElement("div",{className:"bottom-bar"},r.createElement(da,{selectTab:"my-custom-tags"})))},fr=(0,r.memo)(Er),br=()=>r.createElement("div",{className:"inft-scroll-loader"},r.createElement("div",{className:"spinner"})),yr=(0,r.memo)(br),vr=({title:e,isLoading:t,children:n})=>r.createElement("div",{className:"geo-results-list"},r.createElement("h3",null,e),t&&r.createElement(yr,null),!t&&r.createElement("ul",{className:"geo-search-results"},n)),Tr=(0,r.memo)(vr);var Sr=n(56088),Pr=n(42501);function wr(){return wr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},wr.apply(this,arguments)}const Ir=({txt:e="",helper:t="",...n})=>{const{isLoading:a,disabled:s}=(0,r.useContext)(Pr.U);return r.createElement("div",{className:"radio"},a?r.createElement("div",{className:"radio-placeholder"}):r.createElement("div",{className:"radio-input"},r.createElement("input",wr({type:"radio",disabled:s},n)),r.createElement("i",null)),r.createElement("div",{className:"radio-text"},r.createElement("p",null,!a&&e),r.createElement(Sr.Z,{txt:t,isLoading:a})))},Cr=({onClick:e,isChecked:t,value:n,displayName:a,description:s,name:o,actions:i})=>r.createElement("li",null,r.createElement("div",{className:"result",onClick:e},r.createElement(Ir,{value:n,name:o,checked:t,readOnly:!0}),r.createElement("div",{className:"description"},r.createElement("h5",null,a),s&&r.createElement("div",{className:"extra-text"},s))),i),Nr=(0,r.memo)(Cr),Or=()=>{const{selectedPosition:e,setSelectedPosition:t,searchResults:n,setTab:a,searchInProgress:s}=(0,r.useContext)(ra),o=(0,aa.T)();return r.createElement("div",{className:"tab geo-search-tab"},r.createElement(gr,{selectTab:"user-search",enableBack:!0}),r.createElement(Tr,{title:"Найденные места",isLoading:s},n&&n.slice(0,20).map(((n,a)=>{const s=va.Z.makeOsmSid(n),{displayName:o,displayAddress:i}=va.Z.normalizeOsmInfo(n);if(o)return r.createElement(Nr,{key:a,name:"geo-search-results",value:s,isChecked:e?.osmSid===s,displayName:o,description:i,onClick:()=>{t({osmSid:s,lat:n.lat,lon:n.lon})}})}))),!s&&n&&r.createElement("div",{className:"bottom-bar"},r.createElement(da,{selectTab:"my-custom-tags"}),r.createElement(He.Z,{disabled:!e,onClick:()=>{o(La(e?.osmSid)),o(xa("osmTag")),o(Aa("osmTag")),a("user-start"),na.ym("reachGoal","geo_set_position")},label:"Я здесь"})))},Mr=(0,r.memo)(Or);var kr=n(12629);
/**
 * Mirtesen.
 *
 * My Private tags tab.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Ar=()=>{const[e,t]=(0,r.useState)(null),[n,a]=(0,r.useState)(null),{setTab:s}=(0,r.useContext)(ra),o=(0,aa.T)();return(0,r.useEffect)((()=>{(async()=>{const e=await Pa.Z.getCustomTags(0,50);t(e||null)})()}),[]),(0,kr.O)("message",(n=>{if("MT_APP_DELETE_CUSTOM_TAG"===n.data.type){const a=e?.filter((e=>e.id!==n.data.id));t(a||null)}})),r.createElement("div",{className:"tab geo-search-tab geo-custom-tags-tab"},r.createElement(gr,{selectTab:"user-search",enableBack:!0}),r.createElement(Tr,{title:"Список ярлыков"},e&&e.map(((e,t)=>{const s=r.createElement(ir,{type:"custom-tag",tagId:e.id});return r.createElement(Nr,{key:t,name:"geo-private-tags",displayName:Pa.Z.stripGeoId(e.text),description:e.description,isChecked:n?.id===e.id,value:e.id,onClick:()=>{a(e)},actions:s})}))),r.createElement("div",{className:"bottom-bar"},r.createElement("div",{className:"add-custom-tag-link"},r.createElement(yn.Z,{iconName:"cross"}),r.createElement(He.Z,{appearance:"link",label:"Добавить ярлык",color:"primary",title:"Добавить ярлык",onClick:()=>{s("add-custom-tag")}})),r.createElement(He.Z,{disabled:!n,onClick:()=>{o(Da(n?.id)),s("user-start"),na.ym("reachGoal","geo_set_position")},label:"Я здесь"})))},xr=(0,r.memo)(Ar);var Lr=n(9774),Dr=n(65966);
/**
 * Mirtesen.
 *
 * Hashtag map.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Rr=()=>{const e=(0,aa.C)((e=>e.geoPosition)),{selectedPosition:t}=(0,r.useContext)(ra),[n,a]=(0,r.useState)(""),[s,o]=(0,r.useState)(!1),[i,l]=(0,r.useState)(null),[c,m]=(0,r.useState)(!1),[d,p]=(0,r.useState)(""),{osmSid:u,lon:g,lat:h}=t||{},{setTab:_}=(0,r.useContext)(ra),E=(0,aa.T)(),f=async()=>{if(!u)return;let e=await va.Z.getOsmInfo(u);e=va.Z.normalizeOsmInfo(e),l(e)};(0,r.useEffect)((()=>{f(),m(!0)}),[]),(0,r.useEffect)((()=>{f()}),[t]),(0,r.useEffect)((()=>{(0,sa.TT)({type:"bounds",osmSid:u},{duration:0})}),[e.osmTag.osmSid]);if(c)return r.createElement("div",{className:"tab geo-add-custom-tag-tab"},r.createElement(_r,{extraClasses:"geo-pane_top"},r.createElement(Ea,{title:"Создание ярлыка"})),r.createElement(sa.ZP,null),r.createElement(_r,{extraClasses:"geo-pane_bottom"},i&&r.createElement(cr,{title:i.displayName,description:i.displayAddress,imgSrc:"/images/geo-popup/geo-marker2.svg",actionsType:"add-custom-tag"}),!i&&r.createElement("div",{className:"current-position"},r.createElement("h5",null,"Выберите точку на карте")),ca.canView("MT_ADD_CUSTOM_TAG_INFO")&&r.createElement("p",{className:"extra-text"},"Перемещайте карту, если требуется уточнить местоположение объекта"),r.createElement(Lr.Z,{label:"Название ярлыка"},r.createElement(Dr.Z,{required:!0,placeholder:"Введите название ярлыка",value:n,onChange:e=>{a(e.target.value)}})),r.createElement(Lr.Z,{label:"Описание"},r.createElement(Dr.Z,{placeholder:"Введите описание ярлыка",value:d,onChange:e=>{p(e.target.value)}}))),r.createElement("div",{className:"bottom-bar"},r.createElement(He.Z,{type:"button",color:"secondary",label:"Отменить",onClick:()=>{_("user-start")}}),r.createElement(He.Z,{type:"button",color:"primary",label:"Сохранить",disabled:!n||s||!g||!h,onClick:async()=>{let e={};if(!g||!h)return void kt.Z.sendSystemMessage("exception");u&&(e=va.Z.parseOsmSid(u||"")),o(!0);const t=await Pa.Z.addCustomTagAndSubscribe({name:n,lon:g,lat:h,description:d,osmId:Number(e.osmId),osmType:e.osmType});t?(E(Da(t)),_("user-start"),kt.Z.sendMessage({type:"MT_APP_ADD_CUSTOM_TAG",id:t})):kt.Z.sendSystemMessage("exception"),na.ym("reachGoal","geo_create_private_tag"),o(!1)}})))},Zr=(0,r.memo)(Rr),Br=()=>{const[e,t]=(0,r.useState)(1),{setTab:n}=(0,r.useContext)(ra);(0,r.useEffect)((()=>{ca.setView("MT_ADD_CUSTOM_TAG_INFO")}),[]);const a=1===e?"/images/geo-popup/private-tag-info.svg":"/images/geo-popup/private-tag-info2.svg";return r.createElement("div",{className:"tab custom-tag-tips-tab"},r.createElement(Ea,{title:"Создание ярлыка"}),r.createElement("img",{src:a}),r.createElement("p",{className:"extra-text2"},1===e?"Создавайте свои собственные ярлыки для значимых для вас мест":"Ваши ярлыки видны только вам, их можно отредактировать или удалить в любой момент"),r.createElement("div",{className:"bottom-bar"},r.createElement(He.Z,{type:"button",color:"primary",label:"Далее",onClick:()=>{1===e?t(2):n("add-custom-tag")}})))},$r=(0,r.memo)(Br),Ur=({initialPosition:e})=>{let{currentTab:t}=(0,r.useContext)(ra);return t=t||"user-start",r.createElement("div",{className:"geo-sidebar"},"user-start"===t&&r.createElement(fr,{initialPosition:e}),"user-search"===t&&r.createElement(Mr,null),"my-custom-tags"===t&&r.createElement(xr,null),"add-custom-tag"===t&&r.createElement(Zr,null),"custom-tag-tips"===t&&r.createElement($r,null))},Hr=(0,r.memo)(Ur),Fr=()=>{const[e,t]=(0,r.useState)(""),[n,a]=(0,r.useState)(""),[s,o]=(0,r.useState)(!1),[i,l]=(0,r.useState)(null),[c,m]=(0,r.useState)(!1),{selectedPosition:d}=(0,r.useContext)(ra),{osmSid:p,lon:u,lat:g}=d||{},{setTab:h}=(0,r.useContext)(ra),_=(0,aa.T)(),E=async()=>{let e=await va.Z.getOsmInfo(p);e=va.Z.normalizeOsmInfo(e),l(e)};(0,r.useEffect)((()=>{E(),m(!0)}),[]),(0,r.useEffect)((()=>{E()}),[d]);const f=!e.trim()||s||!u||!g;return c?r.createElement("div",{className:"tab geo-add-custom-tag-tab"},r.createElement(Ea,{title:"Создание ярлыка"}),i&&r.createElement(cr,{title:i.displayName,description:i.displayAddress,imgSrc:"/images/geo-popup/geo-marker2.svg",actionsType:"add-custom-tag"}),!i&&r.createElement("div",{className:"current-position"},r.createElement("h5",null,"Выберите точку на карте")),ca.canView("MT_ADD_CUSTOM_TAG_INFO")&&r.createElement("p",{className:"extra-text"},"Перемещайте карту, если требуется уточнить местоположение объекта"),r.createElement(Lr.Z,{label:"Название ярлыка",counter:{maxLength:32,currentLength:e.length}},r.createElement(Dr.Z,{name:"tagName",required:!0,placeholder:"Введите название ярлыка",value:e,autoComplete:"off",onChange:e=>{t(e.target.value)},maxLength:32})),r.createElement(Lr.Z,{label:"Описание",counter:{maxLength:96,currentLength:n.length}},r.createElement(Dr.Z,{name:"tagDescription",placeholder:"Введите описание ярлыка",value:n,autoComplete:"off",onChange:e=>{a(e.target.value)},maxLength:96})),r.createElement("div",{className:"bottom-bar"},r.createElement(He.Z,{type:"button",color:"secondary",label:"Отменить",onClick:()=>{h("user-start")}}),r.createElement(He.Z,{type:"submit",color:"primary",label:"Сохранить",disabled:f,onClick:async()=>{if(!u||!g)return kt.Z.sendSystemMessage("exception"),!1;let t={};p&&(t=va.Z.parseOsmSid(p||"")),o(!0);const a=await Pa.Z.addCustomTagAndSubscribe({name:e.trim(),lon:u,lat:g,description:n.trim(),osmId:Number(t.osmId),osmType:t.osmType});a?(_(Da(a)),h("user-start"),kt.Z.sendMessage({type:"MT_APP_ADD_CUSTOM_TAG",id:a})):kt.Z.sendSystemMessage("exception"),na.ym("reachGoal","geo_create_private_tag"),o(!1)}}))):null},jr=(0,r.memo)(Fr),Gr=()=>{const[e,t]=(0,r.useState)(null),[n,a]=(0,r.useState)(null),{setTab:s}=(0,r.useContext)(ra),o=(0,aa.T)();return(0,r.useEffect)((()=>{(async()=>{const e=await Pa.Z.getCustomTags(0,50);t(e||null)})()}),[]),(0,kr.O)("message",(n=>{if("MT_APP_DELETE_CUSTOM_TAG"===n.data.type){const a=e?.filter((e=>e.id!==n.data.id));t(a||null)}})),r.createElement("div",{className:"tab geo-search-tab geo-custom-tags-tab"},r.createElement(Ea,{title:"Мои ярлыки"}),r.createElement(Tr,{title:"Список ярлыков"},e&&e.map(((e,t)=>{const s=r.createElement(ir,{type:"custom-tag",tagId:e.id});return r.createElement(Nr,{key:t,name:"geo-private-tags",displayName:Pa.Z.stripGeoId(e.text),description:e.description,isChecked:n?.id===e.id,value:e.id,onClick:()=>{a(e),(0,sa.TT)({type:"point",lon:e.lon,lat:e.lat})},actions:s})}))),r.createElement("div",{className:"bottom-bar"},r.createElement("div",{className:"add-custom-tag-link"},r.createElement(yn.Z,{iconName:"cross"}),r.createElement(He.Z,{appearance:"link",label:"Добавить ярлык",color:"primary",title:"Добавить ярлык",onClick:()=>{s("add-custom-tag")}})),r.createElement(He.Z,{onClick:()=>{s("user-start")},label:"Отменить",color:"secondary"}),r.createElement(He.Z,{disabled:!n,onClick:()=>{o(Da(n?.id)),s("user-start"),na.ym("reachGoal","geo_set_position")},label:"Я здесь"})))},qr=(0,r.memo)(Gr),Vr=()=>{const{selectedPosition:e,setSelectedPosition:t,searchResults:n,setTab:a,searchInProgress:s}=(0,r.useContext)(ra),o=(0,aa.T)();return r.createElement("div",{className:"tab geo-search-tab"},r.createElement(Ea,{enablePrev:!1}),r.createElement(gr,{selectTab:"user-search"}),r.createElement(Tr,{title:"Найденные места",isLoading:s},n&&n.slice(0,20).map(((n,a)=>{const s=va.Z.makeOsmSid(n);console.log("--geo object--"),console.log(n),console.log("--parsed geo object--"),console.log(va.Z.normalizeOsmInfo(n));const{displayName:o,displayAddress:i}=va.Z.normalizeOsmInfo(n);if(o)return r.createElement(Nr,{key:a,name:"geo-search-results",value:s,isChecked:e?.osmSid===s,displayName:o,description:i,onClick:()=>{(0,sa.VT)("bounds",{osmSid:s},{duration:0}),t({osmSid:s,lat:n.lat,lon:n.lon})}})}))),!s&&n&&r.createElement("div",{className:"bottom-bar"},r.createElement(He.Z,{onClick:()=>{a("user-start")},label:"Отменить",color:"secondary"}),r.createElement(He.Z,{disabled:!e,onClick:()=>{o(La(e?.osmSid)),o(xa("osmTag")),o(Aa("osmTag")),a("user-start"),na.ym("reachGoal","geo_set_position")},label:"Я здесь"})))},zr=(0,r.memo)(Vr),Wr=()=>{const e=(0,aa.C)((e=>e.geoPosition)),t=e?.currentSource||"ip",n=e?.navigatorGeolocation||{},a=e?.osmTag||{},s=e?.customTag||{};return r.createElement("div",{className:"tab geo-user-start-tab"},r.createElement(Ea,{enablePrev:!1}),r.createElement(gr,{selectTab:"user-search"}),r.createElement(Ga,null),"ip"===t&&r.createElement("p",{className:"empty-position"},"Укажите место на карте, воспользуйтесь поиском или включите автоматическое определение местоположения"),"navigatorGeolocation"===t&&r.createElement(cr,{osmSid:n.osmSid,title:n.title,description:n.description,imgSrc:"/images/geo-popup/geo-marker3.svg",actionsType:"osm"}),"osmTag"===t&&r.createElement(cr,{osmSid:a.osmSid,title:a.title,description:a.description,imgSrc:"/images/geo-popup/geo-marker2.svg",actionsType:"osm"}),"customTag"===t&&r.createElement(cr,{customTagId:s.id,title:Pa.Z.stripGeoId(s.text),description:s.description,imgSrc:"/images/geo-popup/geo-marker4.svg",actionsType:"custom-tag"}),r.createElement("div",{className:"bottom-bar"},r.createElement(da,{selectTab:"my-custom-tags"})))},Yr=(0,r.memo)(Wr),Kr=()=>{let{currentTab:e}=(0,r.useContext)(ra);return e=e||"user-start",r.createElement("div",{className:"geo-sidebar"},"user-start"===e&&r.createElement(Yr,null),"user-search"===e&&r.createElement(zr,null),"add-custom-tag"===e&&r.createElement(jr,null),"custom-tag-tips"===e&&r.createElement($r,null),"my-custom-tags"===e&&r.createElement(qr,null))},Jr=(0,r.memo)(Kr),Xr=()=>r.createElement("div",{className:"tab geo-post-start-tab"},r.createElement(gr,{selectTab:"post-search"}),r.createElement("div",{className:"empty-position"},"Укажите место на карте или воспользуйтесь поиском"),r.createElement("div",{className:"bottom-bar"},r.createElement(da,{selectTab:"post-custom-tags"}))),Qr=(0,r.memo)(Xr),eo=()=>{const e=(0,aa.C)((e=>e.geoPosition)),[t,n]=(0,r.useState)(null);(0,r.useEffect)((()=>{const{currentSource:t,osmTag:a,customTag:s}=e?.post;n(!!("osmTag"===t&&a?.osmSid||"customTag"===t&&s?.id))}),[e]);return r.createElement(He.Z,{type:"button",color:"primary",label:"Готово",disabled:!t,onClick:async()=>{const{currentSource:t,osmTag:n,customTag:a}=e?.post;let s=null;if("customTag"===t&&a?.id)s=a?.id;else if("osmTag"===t&&n?.osmSid){const e=n?.osmSid,{osmId:t,osmType:a}=va.Z.parseOsmSid(e),r=await Pa.Z.getTagByOsmId(Number(t));if(s=r?.id,!s){const n=await va.Z.getOsmInfo(e),{displayName:r,displayAddress:o}=va.Z.normalizeOsmInfo(n),i=n?.centroid,l=i?.coordinates[0],c=i?.coordinates[1];s=await Pa.Z.addCustomTagAndSubscribe({name:r,description:o,lon:l,lat:c,osmId:Number(t),osmType:a})}}s?kt.Z.sendMessage({type:"MT_APP_USER_SELECT_GEO_POSITION",tagId:s}):kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Не удалось найти тег"})}})},to=(0,r.memo)(eo),no=()=>{const{setTab:e}=(0,r.useContext)(ra);return r.createElement("div",{className:"bottom-bar"},r.createElement(da,{selectTab:"post-custom-tags"}),r.createElement(He.Z,{type:"button",color:"secondary",label:"Отменить",onClick:()=>{e("post-start")}}),r.createElement(to,null))},ao=(0,r.memo)(no),so=()=>{const{searchResults:e,searchInProgress:t}=(0,r.useContext)(ra),n=(0,aa.T)(),a=(0,aa.C)((e=>e.geoPosition));return r.createElement("div",{className:"tab geo-search-tab"},r.createElement(gr,{selectTab:"post-search"}),r.createElement(Tr,{title:"Найденные места",isLoading:t},e&&e.slice(0,20).map(((e,t)=>{const s=va.Z.makeOsmSid(e),{displayName:o,displayAddress:i}=va.Z.normalizeOsmInfo(e);return r.createElement(Nr,{key:t,name:"geo-search-results",value:s,isChecked:s===a?.post?.osmTag?.osmSid,displayName:o,description:i,onClick:()=>{(0,sa.VT)("bounds",{osmSid:s}),n($a(s)),n(Za("osmTag"))}})}))),r.createElement(ao,null))},ro=(0,r.memo)(so),oo=()=>{const[e,t]=(0,r.useState)(null),n=(0,aa.T)(),a=(0,aa.C)((e=>e.geoPosition));return(0,r.useEffect)((()=>{(async()=>{const e=await Pa.Z.getCustomTags(0,50);t(e||null)})()}),[]),(0,kr.O)("message",(n=>{if("MT_APP_DELETE_CUSTOM_TAG"===n.data.type){const a=e?.filter((e=>e.id!==n.data.id));t(a||null)}})),r.createElement("div",{className:"tab geo-search-tab geo-custom-tags-tab"},r.createElement(gr,{selectTab:"post-search"}),r.createElement(Tr,{title:"Список ярлыков"},e&&e.map(((e,t)=>{const s=r.createElement(ir,{type:"custom-tag",tagId:e.id});return r.createElement(Nr,{key:t,name:"geo-private-tags",displayName:Pa.Z.stripGeoId(e.text),description:e.description,isChecked:a.post.customTag?.id===e.id,value:e.id,onClick:()=>{n(Ba(e.id)),n(Za("customTag"))},actions:s})}))),r.createElement(ao,null))},io=(0,r.memo)(oo),lo=()=>{const{setTab:e,currentTab:t}=(0,r.useContext)(ra);return(0,r.useEffect)((()=>{e("post-start")}),[]),r.createElement("div",{className:"geo-sidebar"},"post-start"===t&&r.createElement(Qr,null),"post-search"===t&&r.createElement(ro,null),"post-custom-tags"===t&&r.createElement(io,null))},co=(0,r.memo)(lo),mo=({title:e,description:t,currentSource:n,osmSid:a,customTagId:s})=>r.createElement("div",{className:"geo-results-list"},r.createElement("h3",null,"Найденные места"),r.createElement("ul",{className:"geo-search-results"},r.createElement(Nr,{isChecked:!0,displayName:e,description:t}))),po=(0,r.memo)(mo),uo=()=>{const e=(0,aa.C)((e=>e.geoPosition.post)),t=e?.currentSource,n=e?.osmTag,a=e?.customTag,s=(0,aa.T)();return(0,r.useEffect)((()=>{s(Ua("post"))}),[]),r.createElement("div",{className:"tab geo-post-start-tab"},r.createElement(_r,{extraClasses:"geo-pane_top"},r.createElement(gr,{selectTab:"post-search"})),r.createElement(sa.ZP,null),r.createElement(_r,{extraClasses:"geo-pane_bottom"},!t&&r.createElement("div",{className:"empty-position"},"Укажите место на карте или воспользуйтесь поиском"),"osmTag"===t&&r.createElement(po,{title:n.title,description:n.description,currentSource:t,osmSid:n.osmSid}),"customTag"===t&&r.createElement(po,{title:Pa.Z.stripGeoId(a.text),description:a.description,currentSource:t,ocustomTagId:a.id})),r.createElement("div",{className:"bottom-bar"},r.createElement(da,{selectTab:"post-custom-tags"}),r.createElement(to,null)))},go=(0,r.memo)(uo),ho=({initialPosition:e})=>{const t=(0,aa.T)(),{searchResults:n,searchInProgress:a,setTab:s}=(0,r.useContext)(ra),[o,i]=(0,r.useState)(null);return r.createElement("div",{className:"tab geo-search-tab"},r.createElement(gr,{selectTab:"post-search"}),r.createElement(Tr,{title:"Найденные места",isLoading:a},n&&n.slice(0,20).map(((e,t)=>{const n=va.Z.makeOsmSid(e),{displayName:a,displayAddress:s}=va.Z.normalizeOsmInfo(e);return r.createElement(Nr,{key:t,name:"geo-search-results",value:n,isChecked:n===o,displayName:a||"",description:s||"",onClick:()=>{i(n)}})}))),r.createElement("div",{className:"bottom-bar"},r.createElement(He.Z,{type:"button",color:"secondary",label:"Отменить",onClick:()=>{s("post-start")}}),r.createElement(He.Z,{disabled:!o,onClick:()=>{t($a(o)),s("post-start")},label:"Выбрать"})))},_o=(0,r.memo)(ho),Eo=()=>{const[e,t]=(0,r.useState)(null),n=(0,aa.T)(),{setTab:a}=(0,r.useContext)(ra),[s,o]=(0,r.useState)(null);return(0,r.useEffect)((()=>{(async()=>{const e=await Pa.Z.getCustomTags(0,50);t(e||null)})()}),[]),(0,kr.O)("message",(n=>{if("MT_APP_DELETE_CUSTOM_TAG"===n.data.type){const a=e?.filter((e=>e.id!==n.data.id));t(a||null)}})),r.createElement("div",{className:"tab geo-search-tab geo-custom-tags-tab"},r.createElement(Tr,{title:"Список ярлыков"},e&&e.map(((e,t)=>{const n=r.createElement(ir,{type:"custom-tag",tagId:e.id});return r.createElement(Nr,{key:t,name:"geo-private-tags",displayName:Pa.Z.stripGeoId(e.text),description:e.description,isChecked:s===e.id,value:e.id,onClick:()=>{o(e.id)},actions:n})}))),r.createElement("div",{className:"bottom-bar"},r.createElement(He.Z,{type:"button",color:"secondary",label:"Отменить",onClick:()=>{a("post-start")}}),r.createElement(He.Z,{disabled:!s,onClick:()=>{n(Ba(s)),a("post-start")},label:"Выбрать"})))},fo=(0,r.memo)(Eo),bo=()=>{let{currentTab:e}=(0,r.useContext)(ra);return e=e||"post-start",r.createElement("div",{className:"geo-sidebar"},"post-start"===e&&r.createElement(go,null),"post-search"===e&&r.createElement(_o,null),"post-custom-tags"===e&&r.createElement(fo,null))},yo=(0,r.memo)(bo),vo=({geoType:e})=>{const t=(0,aa.C)((e=>e.geoPosition)),n=(0,aa.C)((e=>e.app.isMobile)),{currentSource:a}=t,[s,o]=(0,r.useState)(!1),[i,l]=(0,r.useState)(!1),[c,m]=(0,r.useState)([]),[d,p]=(0,r.useState)(""),[u,g]=(0,r.useState)(null),[h,E]=(0,r.useState)(null),f=(0,r.useRef)(""),b=(0,aa.T)();(0,r.useEffect)((()=>{o(!0),b((e=>{e({type:"GEO_POSITION_INIT_POST"})})),"user"===e&&na.ym("reachGoal","geo_show_map")}),[]),(0,r.useEffect)((()=>{t.inProcess||b(Ua(e))}),[t.inProcess]),(0,r.useEffect)((()=>{let e="default";"add-custom-tag"===u?e="add-tag":"user-start"===u&&("navigatorGeolocation"===a?e="geolocation":"customTag"===a&&(e="custom-tag")),kt.Z.sendMessage({type:"MT_APP_CHANGE_GEO_MARKER",marker:e})}),[u,a]),(0,r.useEffect)((()=>{(async()=>{const e=t.osmTag?.osmSid,n=t.navigatorGeolocation;if("osmTag"===a){const t=await va.Z.getOsmInfo(e);E({osmSid:e,lon:t.centroid?.coordinates?.[0],lat:t.centroid?.coordinates?.[1]})}"navigatorGeolocation"===a&&E({osmSid:n.osmSid,lat:n.navigatorLat,lon:n.navigatorLon})})()}),[a]),(0,r.useEffect)((()=>(window.addEventListener("message",v),()=>{window.removeEventListener("message",v)})),[u]),(0,r.useEffect)((()=>{"post-search"!=u&&"user-search"!=u&&(p(""),m(null))}),[u]);const y=e=>{f.current=u,g(e)},v=async t=>{if("MT_APP_GEOMAP_CLICK"===t?.data?.type){const a=t?.data?.lon,s=t?.data?.lat;p(""),m(null),(0,sa.TT)({type:"point",lon:a,lat:s});const r=await va.Z.getReverseInfoWithGeoCoder(s,a);if(!r?.osm_id)return;const o=va.Z.makeOsmSid(r);m([r]),"post"===e?n?(b($a(o)),b(Za("osmTag"))):(b($a(o)),b(Za("osmTag")),n||y("post-search")):"user"===e&&(E({osmSid:o,lat:s,lon:a}),"add-custom-tag"!==u&&y("user-search"))}};if(!s)return null;const T=_()({"geo-map-container":!0,"geo-popup":!0,"geo-popup_mobile":n});return r.createElement(ra.Provider,{value:{currentTab:u,setTab:y,prevTab:f.current,searchQuery:d,setSearchQuery:p,searchResults:c,setSearchResults:m,searchInProgress:i,setSearchInProgress:l,selectedPosition:h,setSelectedPosition:E}},r.createElement("div",{className:T},n&&"user"===e&&r.createElement(Hr,null),n&&"post"===e&&r.createElement(yo,null),!n&&r.createElement(r.Fragment,null,"user"===e&&r.createElement(Jr,null),"post"===e&&r.createElement(co,null),r.createElement(sa.ZP,null))))},To=(0,r.memo)(vo),So=()=>r.createElement(To,{extraClasses:"geo-map-container geo-popup",geoType:"post"}),Po=(0,r.memo)(So);function wo(){return wo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},wo.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Person Post Editor Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class Io extends r.Component{componentDidMount(){window.addEventListener("message",this.handleGetMessage)}componentWillUnmount(){window.removeEventListener("message",this.handleGetMessage)}handleSave=()=>{const{identifier:e,onSave:t,callbacks:n,params:a,mtPostEditor:s}=this.props,{author:r,target:o}=s[e];this.validateForm()&&(na.ym("reachGoal","click_submit_publicator"),t(e,o,n,{params:a,author:r,target:o}))};handleGetMessage=e=>{const{setTab:t,setGeo:n,identifier:a}=this.props;switch(e.data.type){case"MT_APP_SHOW_MT_POST_EDITOR":{const{onShowModal:t}=this.props;t(e.data.identifier,e.data.postId,e.data.params);break}case"MT_APP_USER_SELECT_GEO_POSITION":n(a,{status:"manual",tagId:e.data.tagId}),t(a,"message"),na.ym("reachGoal","geo_location_post")}};isOwner=()=>{const{identifier:e,mtPostEditor:t}=this.props,{author:n,target:a}=t[e];return!(!a||!n)&&("user"===a.type&&Number(n.id)===Number(a.id))};validateForm=()=>{const{onErrorProcessing:e,mtPostEditor:t,onToggleValidation:n,identifier:a}=this.props,{images:s,video:r,poll:o,message:i,repost:l,isValidationOn:c,previewData:m}=t[a]||Pt,d=s.filter((e=>2===e.status)).length<1&&!o&&!r&&!m,{errorMessage:p}=vt.default;c||n(a,!0);let u=!0;const g={};return!d||i||l||(g.popupMessage=p.emptyPost,u=!1),u||e(a,g),u};render(){const{identifier:e,addImages:t,toggleModal:n,params:a,topicList:s,attachImages:o,pollData:i={},setTab:l,isMobile:c,onErrorProcessing:m}=this.props,{showPoll:d}=a,p=this.props.mtPostEditor[e]||Pt,{showModal:u,activeTab:g,images:h,video:E,inProcess:f,repost:b,error:y,author:v,target:T,personVislvl:S}=p;if(!T||!v||!S)return null;const P=this.isOwner(),w=!!b,I={identifier:e,activeTab:g,mtPostEditor:p,addImages:t,setTab:l,showPoll:d,images:h,video:E,isOwner:P,inProcess:f,attachImages:o,pollData:i,personVislvl:S,target:T,onSave:this.handleSave},C=r.createElement("div",{className:_()({"mt-post-editor":!0,[`mt-post-editor_${g}`]:!0})},r.createElement(On,{identifier:e,activeTab:g,setTab:l,isRepost:w,isMobile:c}),r.createElement("div",{className:"mt-post-editor__body"},r.createElement(jn,{identifier:e,author:v,target:T,topicList:s,setTab:l,onSave:this.handleSave,isOwner:P}),r.createElement(Qt,{identifier:e}),r.createElement(bn,{identifier:e}),r.createElement(pn,{identifier:e}),"polls-list"===g&&r.createElement(ta,{identifier:e}),"geoposition"===g&&r.createElement(Po,{identifier:e})),"geoposition"!==g&&r.createElement("div",{className:"mt-post-editor__footer"},f&&r.createElement("div",{className:_()({"mt-post-editor__save-in-process":!0,"mt-post-editor__save-in-process_active":!0})},r.createElement("span",null,r.createElement("img",{src:"//static.mtml.ru/images/loader.svg",alt:"Загружается..."})),r.createElement("p",null,"Идет сохранение. ",r.createElement("br",null)," Пожалуйста, не перезагружайте страницу")),"polls-list"!==g&&r.createElement(Pn,wo({isModal:!0},I))),y.popupMessage&&r.createElement(In,{identifier:e,errorText:y.popupMessage,onClickOutside:()=>m(e,{popupMessage:""})}));return u&&r.createElement(O.Z,{onClose:()=>n(e),className:"mt-post-editor-modal",mobileTop:!0},C)}}Io.propTypes={identifier:f().string,mtPostEditor:f().object,person:f().object,topicList:f().array,pollData:f().object,isMobile:f().bool,attachImages:f().func,onSave:f().func,setTab:f().func,addImages:f().func,toggleModal:f().func,onGetHoliday:f().func,onErrorProcessing:f().func,onShowModal:f().func,onToggleValidation:f().func,app:f().object,params:f().object,callbacks:f().object};const Co=(0,i.$j)((e=>({mtPostEditor:e.mtPostEditor,pollData:e.mtPoll.pollFormData,isMobile:e.app.isMobile})),(e=>({onSave:(t,n,a,s)=>{e(((e,t,n,a)=>async(s,r)=>{const o=r().mtPostEditor[e]||Pt,i=o.message,{author:l}=a,c={text:i,vislvl:o.vislvl||9,toUserId:t.id,link:o.previewData,target:t,author:l};o.repost&&(c.extraData={...c.extraData,ed_repostId:o.repost.id}),o.repost?.smi2_id&&(c.extraData={...c.extraData,ed_sharedPost:JSON.stringify(o.repost)}),o.poll&&(c.pollId=o.poll);let m="add";if(o.postId&&(c.postId=o.postId,m="edit"),o.images.length>0){const e=[];for(let t=0;t<o.images.length;t++){const n=o.images[t];2===n.status&&e.push(n.image.id)}c.photoIds="["+e.join(",")+"]"}void 0!==o.geo?.tagId&&(c.geotagId=o.geo.tagId),o.error.popupMessage&&s(zt(e,{popupMessage:""})),s({identifier:e,type:"MT_POST_EDITOR_TOGGLE_PROCESS"});try{const r=o?.video;if(r){const t=r.videoInfo;if(t)t.id?c.videoId=t.id:c.pandaVideoId=t.pandaVideoId;else{const t=r.videoFile;if(t){const n=t=>{const n=Math.floor(100*t.loaded/t.total);s({type:"MT_POST_EDITOR_SET_VIDEO_UPLOAD_PROGRESS",identifier:e,videoUploadProgress:n})},a=await xt.Z.uploadVideoToStorage(t,n);if(a){const e=a.id;e?c.videoId=e:c.pandaVideoId=a.pandaVideoId}}}}const i=await vt.default.savePost(c);if(o.repost?.smi2_id)try{Ct.Z.incrementField({entity:"smi2Post",entityId:o.repost?.smi2_id,entityField:"reposts"})}catch(e){D.Z.promiseHandler("mtPostEditorActions/smi2 repost")(e)}i?("add"===m&&"function"==typeof n.add&&n.add(i,{...a,repostId:o?.repost?.id||o?.repost?.smi2_id,repostType:o?.repost?.smi2_id?"smi2":"mt"}),"edit"===m&&"function"==typeof n.edit&&n.edit(i,a),o.isBirthday&&Number(l.id)!==Number(t.id)&&window.sessionStorage.setItem(`congratulated_${t.id}`,"1"),s({identifier:e,type:"MT_POST_EDITOR_RESET"})):(s({type:"MT_POST_EDITOR_TOGGLE_PROCESS"}),s(zt(e,{popupMessage:vt.default.errorMessage.saveError})),"function"==typeof n.error&&n.error("Something went wrong!",a))}catch(t){s({identifier:e,type:"MT_POST_EDITOR_TOGGLE_PROCESS"}),s(zt(e,{popupMessage:vt.default.errorMessage.saveError})),"function"==typeof n.error&&n.error("Something went wrong!",a),console.log(t),D.Z.promiseHandler(Lt)(t)}})(t,n,a,s))},setTab:(t,n)=>{e(Zt(t,n))},toggleModal:t=>{e((e=>({identifier:e,type:"MT_POST_EDITOR_TOGGLE_MODAL"}))(t))},addImages:(t,n,a)=>{e(Bt(t,a))},onGetHoliday:t=>{e(Vt(t))},onShowModal:(t,n,a)=>{e(Rt(t,n,a))},onErrorProcessing:(t,n)=>{e(zt(t,n))},attachImages:(t,n)=>{e(Ut(t,n))},onToggleValidation:(t,n)=>{e(((e,t)=>({identifier:e,type:"MT_POST_EDITOR_TOGGLE_VALIDATION",isValidationOn:t}))(t,n))},setGeo:(t,n)=>{e(Wt(t,n))}})),null,{forwardRef:!0})(Io);var No=n(14293),Oo=n.n(No),Mo=n(24061),ko=n(67887);
/**
 * Mirtesen.
 *
 * Channel cover editor
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Ao=N((()=>Promise.all([Promise.resolve().then(n.bind(n,67887)),n.e(978).then(n.bind(n,42724))]).then((([e])=>e))),"reactImageCrop"),xo=({image:e,cropParams:t,aspect:n=1,renderSelectionAddon:a,locked:s,circularCrop:o,keepSelection:i,onComplete:l,defaultCropSize:c=100})=>{const[m,d]=(0,r.useState)(),p=(0,r.useRef)(null),u=(0,r.useRef)(null);return r.createElement("div",{ref:u},r.createElement(Ao,{crop:m,onChange:(e,t)=>{d(t)},onComplete:(e,t)=>{l({width:e.width,height:e.height,topPr:t.y,leftPr:t.x,topPx:e.y,leftPx:e.x,image:p.current,widthPr:t.width})},aspect:n,locked:s,circularCrop:o,keepSelection:i,className:"ReactCrop--no-animate",renderSelectionAddon:a},e&&r.createElement("img",{ref:p,src:e,crossOrigin:"anonymous",onLoad:e=>{const{naturalWidth:a,naturalHeight:s}=e.currentTarget;d((({cropParams:e,defaultCropSize:t,aspect:n,width:a,height:s})=>{let r="width",o=e?.width||t;!e?.width&&n<=1&&a>s&&(r="height",o=t);const i=(0,ko.makeAspectCrop)({unit:"%",[r]:o},n,a,s);return e?{...i,x:e.left,y:e.top}:(0,ko.centerCrop)(i,a,s)})({aspect:n,cropParams:t,defaultCropSize:c,width:a,height:s}))}})))},Lo=(0,r.memo)(xo),Do=300,Ro=300,Zo=e=>!e||Oo()(e.top)||Oo()(e.left)?void 0:{top:e.top,left:e.left,width:e.crop_width},Bo=()=>{const[e,t]=(0,r.useState)(),[n,a]=(0,r.useState)(),[s,o]=(0,r.useState)(!1),i=(0,aa.C)((e=>e.channelAvatarEditor)),{isOpen:l,avatarInfo:c,messageId:m}=i,d=(0,aa.T)();(0,r.useEffect)((()=>{t(c?.photo_original?c?.photo_original:void 0)}),[c,l]),(0,kr.O)("message",(e=>{"MT_APP_CHANNEL_AVATAR_SAVED"===e.data.type&&(t(void 0),o(!1),d((0,Mo.n)(!1)))}));const p=(0,r.useCallback)((e=>{if(!e?.[0])return;const n=URL.createObjectURL(e?.[0]);if(n){const e=document.createElement("img");e.onload=e=>{const{naturalHeight:a,naturalWidth:s}=e.target;s<Do||a<Ro?kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Минимальный размер изображения должен быть "+Do+"х"+Ro+" пикселей"}):t(n)},e.src=n}}),[]),u=(0,r.useCallback)((()=>{kt.Z.sendSystemMessage("rejectedFile")}),[]),g=(0,r.useCallback)((e=>{a(e)}),[]),h=()=>{if(!n)return;o(!0);const t=St.Z.cropImage(n);e&&t?d((0,Mo.$)({messageId:m,originalImage:e,croppedImage:t,top:n.topPr,left:n.leftPr,width:n.widthPr})):kt.Z.sendSystemMessage("exception")};return l?r.createElement(O.Z,{className:"image-editor-modal",onClose:()=>{d((0,Mo.n)(!1)),t(void 0)}},r.createElement(O.Z.Header,null,r.createElement(ia.Z,{type:"button",className:"back",onClick:()=>{t(void 0),d((0,Mo.n)(!1))}},r.createElement(yn.Z,{iconName:"back-3"})),r.createElement(O.Z.Title,null,"Аватар канала"),e&&r.createElement(He.Z,{disabled:s,appearance:"link",color:"primary",label:"Сохранить",onClick:h})),r.createElement(O.Z.Body,null,!e&&r.createElement("div",{className:"dropzone-wrapper"},r.createElement(nn,{onDrop:p,onDropRejected:u,mainText:"Перетащите фото в эту область",extraText:r.createElement(r.Fragment,null,`Минимальный размер — ${Do}x${Ro}px`," ",r.createElement("br",null),"Форматы — png, jpg, gif, webp"),iconUrl:"/images/picture-placeholder-rounded.svg",showBtn:!0,multiple:!1,accept:{"image/jpeg":[],"image/png":[],"image/gif":[],"image/webp":[]}})),e&&r.createElement("div",{className:"avatar-editor"},r.createElement(Lo,{image:e,cropParams:Zo(c),aspect:1,circularCrop:!0,keepSelection:!0,defaultCropSize:85,onComplete:g}))),e&&r.createElement(O.Z.Footer,null,r.createElement(He.Z,{label:"Отмена",color:"empty",onClick:()=>{t(void 0),d((0,Mo.n)(!1))}}),r.createElement(He.Z,{label:"Сохранить",color:"primary",disabled:s,onClick:h}))):null};n(74754),n(73101);
/**
 * Mirtesen.
 *
 * API interface for Reactions.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class $o{static list={default:{title:"Нравится",rate:0,id:null},like:{title:"Нравится",rate:1,id:100},love:{title:"Прекрасно",rate:1,id:1},lol:{title:"Смешно",rate:1,id:2},norm:{title:"Норм",rate:1,id:3},sad:{title:"Печально",rate:-1,id:4},angry:{title:"Ужасно",rate:-1,id:5},dislike:{title:"Не нравится",rate:-1,id:-100}};static keys=Object.keys($o.list)}const Uo=$o;var Ho="/index.js";
/**
 * Mirtesen.
 *
 * API interface for Vote Actions.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class Fo{static reactions=Uo.list;static reactionsKeys=Uo.keys;getList=async(e,t={offset:0,count:10,likeType:null,likeAttr:null})=>{try{return await R.Z.request({query:`query {\n                    likers(\n                        object_id:${e},\n                        offset: ${t.offset},\n                        count: ${t.count},\n                        likeType: ${t.likeType}\n                        likeAttr: ${t.likeAttr}\n                      ) {\n                        id\n                        display_name\n                        url\n                        photo_original\n                        mark\n                        mark_attr\n                      }\n                }`,endpoint:{endpoint:"main",ver:"v1"}})||[]}catch(e){if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(Ho)(e)}};vote=async(e,t,n=null)=>{try{return await R.Z.request({query:`mutation {\n                    setLike(\n                        object_id:${e},\n                        rate: ${t}\n                        attr: ${n}\n                    )\n                }`,endpoint:{endpoint:"main",ver:"v1"}})}catch(e){if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(Ho)(e)}};async voteSmi2(e,t){try{return await Ct.Z.incrementField({entity:"smi2PostReaction",entityId:e,entityField:Object.entries(Fo.reactions).find((([e,{id:n}])=>n===t))?.[0]})}catch(e){D.Z.promiseHandler("get smi2 reactions")(e)}}async getSmi2Reactions(e){try{const t=await Ct.Z.getInfo("smi2PostReaction",e);let n=0;const a=Object.entries(t).filter((([e])=>{const t=e.split(":")?.[1];return"default"!==t&&Fo.reactionsKeys.includes(e.split(":")?.[1])})).map((([e,t])=>(n+=t,{id:Fo.reactions[e.split(":")?.[1]]?.id,count:t}))),s=t?.reactions?.[0]?.split(":")[1];return{reactions:a,currentReaction:Fo.reactionsKeys.find((e=>e===s))?s:null,count:n}}catch(e){return D.Z.promiseHandler("get smi2 reactions")(e),{reactions:[],currentReaction:null,count:0}}}static getNormalizedReactionId=(e=0,t=0)=>e?t&&t>0?t:1===e?100:-100:0}const jo=Fo;
/**
 * Mirtesen.
 *
 * Voters list Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Go=async(e,t,n=0,a=30)=>{const s=new jo,r=(o=jo.reactions[t])?{likeType:1===o.rate?"LIKE_TYPE_LIKE":"LIKE_TYPE_DISLIKE",likeAttr:100===Math.abs(o.id)?0:o.id}:{likeType:null,likeAttr:null};var o;try{return(await s.getList(e,{offset:n,count:a,...r})).map((e=>{const t=jo.getNormalizedReactionId(e.mark,e.mark_attr),n=Object.keys(jo.reactions).find((e=>jo.reactions[e].id===t));return{...e,reactionName:n}}))}catch(e){D.Z.promiseHandler("/index.js")(e)}};var qo=n(53223);
/**
 * Mirtesen.
 *
 * Voters list Action Reducer.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Vo={activeId:null},zo={isOpen:!1,objectId:null,hasMore:!0,offset:0,voters:[],tabs:[],totalCount:0,activeTab:"all"},Wo=(e=Vo,t)=>{const n={...e},a=n[t.objectId]||zo;switch(t.type){case"VOTER_LIST_2_TOGGLE_POPUP":return n[t.objectId]={...a,...t.params},n.activeId=t.params.isOpen?t.objectId:null,n;case"VOTER_LIST_2_SHOW_MORE":return n[t.objectId]={...a,hasMore:t.hasMore,voters:[...a.voters,...t.voters],offset:a.offset+t.voters.length},n;case"VOTER_LIST_2_SET_TAB":return n[t.objectId]={...a,activeTab:t.activeTab,voters:t.voters,offset:t.voters.length,hasMore:t.hasMore},n;default:return e}},Yo=N((()=>Promise.all([n.e(526).then(n.t.bind(n,88667,23)),n.e(743).then(n.bind(n,83651))]).then((([e])=>e))),"reactIdSwiper");class Ko extends r.PureComponent{constructor(e){super(e),this.wrapper=r.createRef()}handleTabClick=(e="all")=>{const{onSetTab:t,voteList:n,objectId:a}=this.props;e!==n.activeTab&&t(a,e)};render(){const{voteList:e,onHidePopup:t,onShowMore:n,objectId:a}=this.props,s=r.createElement(Yn,null),o={slidesPerView:"auto",spaceBetween:4,slidesPerGroup:6,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},renderPrevButton:()=>r.createElement("span",{className:"swiper-button swiper-button-prev"},r.createElement("button",{className:"btn arrow-btn arrow-btn_prev",type:"button"})),renderNextButton:()=>r.createElement("span",{className:"swiper-button swiper-button-next"},r.createElement("button",{className:"scroll-container__btn btn arrow-btn arrow-btn_next",type:"button"})),breakpoints:{650:{slidesPerGroup:4}}},i=[];return e.tabs.forEach((t=>{if(t.count<1)return;const n=r.createElement("button",{type:"button",className:_()({"user-list-tabs__tab":!0,"user-list-tabs__tab_active":e.activeTab===t.name}),key:t.name,onClick:()=>this.handleTabClick(t.name)},r.createElement(qo.Z,{name:t.name,size:"xs",classNames:"user-list-tabs__icon"}),t.count);i.push(n)})),e.isOpen&&r.createElement(O.Z,{onClose:()=>{t(a)},className:"user-list-modal"},r.createElement("div",{className:"user-list"},r.createElement("header",{className:"user-list__header"},e.totalCount>0&&r.createElement("h3",{className:"user-list__count"},`${e.totalCount} ${y.Z.num2string(e.totalCount,["реакция","реакции","реакций"])}`)),r.createElement("div",{className:"user-list-tabs"},r.createElement(Yo,o,r.createElement("button",{type:"button",className:_()({"user-list-tabs__tab":!0,"user-list-tabs__tab_active":"all"===e.activeTab}),onClick:()=>this.handleTabClick("all")},"Все"),i)),r.createElement("div",{className:"user-list__items",ref:this.wrapper},r.createElement(zn,{pageStart:0,loadMore:()=>{e.hasMore&&n(a,e.activeTab,e.offset)},wrapper:this.wrapper.current,hasMore:e.hasMore,loader:s},e.voters.map((e=>r.createElement("a",{className:"user-list__item",key:e.id,href:e.url,target:"_blank"},r.createElement("span",{className:"user-list__item-avatar"},r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo_original,title:e.display_name}}),r.createElement(qo.Z,{name:e.reactionName,classNames:"user-list__item-reaction"})),r.createElement("span",{className:"user-list__item-name"},e.display_name))))))))}}Ko.propTypes={onShowMore:f().func,onHidePopup:f().func,onSetTab:f().func,voteList:f().object,objectId:f().number};const Jo=(0,i.$j)((e=>{const t=e.voteList.activeId;return{voteList:null!==t?e.voteList?.[t]:zo,objectId:t}}),(e=>({onHidePopup:t=>{e((e=>({type:"VOTER_LIST_2_TOGGLE_POPUP",objectId:e,params:{isOpen:!1,voters:[],offset:0,count:0,activeTab:"all",hasMore:!0,objectId:null}}))(t))},onShowMore:(t,n,a,s)=>{e(((e,t="all",n=0,a=30)=>async s=>{const r=await Go(e,t,n,a);s({type:"VOTER_LIST_2_SHOW_MORE",objectId:e,voters:r,hasMore:r.length>=a})})(t,n,a,s))},onSetTab:(t,n)=>{e(((e,t="all")=>async n=>{const a=await Go(e,t);n({type:"VOTER_LIST_2_SET_TAB",objectId:e,activeTab:t,voters:a,hasMore:a.length>=30})})(t,n))}})))(Ko);var Xo=n(10581),Qo="/index.js";
/**
 * Mirtesen.
 *
 * ObjectActions helper.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const ei={registerSingleView:"mutation ($objectId: Float!, $paramsList: [ViewParam]) {\n        registerSingleView(\n            objectId: $objectId\n            params: $paramsList\n        )\n    }",registerInterestingView:"mutation ($objectId: Float!, $paramsList: [ViewParam]) {\n        registerInterestingView(\n            objectId: $objectId\n            params: $paramsList\n        )\n    }",registerBlockView:"mutation ($objectId: Float!) {\n        registerBlockView(\n            objectId: $objectId\n        )\n    }",registerBlockClick:"mutation ($objectId: Float!) {\n        registerBlockClick(\n            objectId: $objectId\n        )\n    }"};const ti=class{static registerSingleView=(e,t,n)=>{const a=t?Object.keys(t).map((e=>({key:e,value:t[e]}))):void 0,s={project:"blog",body:JSON.stringify({variables:{objectId:e,paramsList:a},query:ei.registerSingleView})};return(0,yt.Z)({...n,...s}).then((e=>!!L()(e,"data.registerSingleView"))).catch(D.Z.promiseHandler(Qo))};static registerInterestingView=(e,t,n)=>{const a=t?Object.keys(t).map((e=>({key:e,value:t[e]}))):void 0,s={project:"blog",body:JSON.stringify({variables:{objectId:e,paramsList:a},query:ei.registerInterestingView})};return(0,yt.Z)({...n,...s}).then((e=>!!L()(e,"data.registerSingleView"))).catch(D.Z.promiseHandler(Qo))};static registerBlockView=(e,t={})=>{const n={project:"blog",body:JSON.stringify({variables:{objectId:e},query:ei.registerBlockView})};return(0,yt.Z)({...t,...n}).then((e=>!!L()(e,"data.registerBlockView"))).catch(D.Z.promiseHandler(Qo))};static registerBlockClick=(e,t={})=>{const n={project:"blog",body:JSON.stringify({variables:{objectId:e},query:ei.registerBlockClick})};return(0,yt.Z)({...t,...n}).then((e=>!!L()(e,"data.registerBlockClick"))).catch(D.Z.promiseHandler(Qo))}},ni={infoDomains:["info.mirtesen.ru","info.mirtesen.mt","info.localhost.ru"],platformSiteId:30981529439,platformPostsOnPage:30,topicPostsOnPage:54,metrics:{googleAnalytics:{accountId:"G-YDQEPRSHLN"},googleAnalytics2:{accountId:"G-7LDC5D3DM3"},newYaMetrics:{version:2,id:[54481189],options:{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!1}},channelYaMetrics:97449405,channelStatmedia:53389,mirtesenStatmedia:45130}},ai={items:[],page:0,hasMore:!0},si=(e=ai,t)=>"AGGREGATOR_CHANGE_ITEMS"===t.type?{...e,items:[...e.items,...t.items],page:e.page+1,hasMore:t.items.length>0}:e,ri={site:{},channel:{},person:{},siteBuilder:{},page:"",layout:null,originalUrl:null,hideAdBlocks:!1,isAdBlockerActive:!1,isHeaderOpen:!0,showChannelPostPopup:!1},oi=(e=ri,t)=>{switch(t.type){case"APP_SET":return{...e,...t.app};case"ACTION_JOIN_TO_SITE":{const n={...e};return n.site?("undefined"!==n.site.is_member&&(n.site.is_member=t.isMember),t.success&&!0===t.isMember?n.site.members_count+=1:t.success&&!1===t.isMember&&(n.site.members_count-=1),n):n}case"ACTION_SUBSCRIBE_TO_SITE":{const n={...e};return"undefined"!==n.site.is_member&&(n.site.is_subscribed=t.isSubscribe),n}case"ACTION_CHANGE_MEMBER_COUNT":{const n={...e};return t.addMember?n.site.members_count+=1:n.site.members_count-=1,n}case"APP_SET_LOGO":{const n={...e};return"blog"===t.scope?n.siteBuilder.mainLogo.props.image=t.image:"profile"===t.scope&&(n.person.photo_original=t.image),n}case"APP_SET_BACKGROUND":{const n={...e};return"blog"===t.scope?n.siteBuilder.mainHeader.props.image=t.image:"profile"===t.scope&&(n.person.cover=t.image),n}case"APP_SET_TITLE":{const n={...e};return n.siteBuilder.mainHeader.props.title=t.title,n}case"APP_SET_META":{const n={...e};return n.meta=t.meta,n}case"APP_SET_AD_BLOCKER":return e.isAdBlockerActive=t.status,e;case"APP_SET_HEADER_STATUS":return{...e,isHeaderOpen:t.isHeaderOpen};case"APP_UPDATE_CHANNEL_COVER":{const n={...e};return n.channel=e.channel||{},n.channel.cover=t.coverInfo?.photo_original,n.channel.cover_info=t.coverInfo,n}case"APP_UPDATE_CHANNEL_AVATAR":{const n={...e};return n.channel=e.channel||{},n.channel.avatar=t.avatarInfo?.photo_original,n.channel.avatar_info=t.avatarInfo,n}case"APP_SHOW_CHANNEL_POST_POPUP":{const n={...e};return n.showChannelPostPopup=t.postId,n}default:return e}},ii={},li={rate:null,count:0,voted:0,canVote:!1,voteInProcess:!1,isVoteRateHover:!1,voteList:[],voteListIsLoaded:!1,marksPluses:0,marksMinuses:0},ci=(e=ii,t)=>{let n=null,a={},s={},r=0,o=0;switch(t.type){case"ACTION_VOTE_INIT_STATE":return n=t.objectId,a={...e},s={...li,rate:t.rate,count:t.count,voted:t.voted,canVote:t.canVote,marksPluses:t.marksPluses,marksMinuses:t.marksMinuses},a[n]=s,a;case"ACTION_VOTE_TOGGLE_VOTER_LIST":return n=t.objectId,a={...e},s={...li,...e[n]||{},isVoteRateHover:t.isVoteRateHover},a[n]=s,a;case"ACTION_VOTE_GET_VOTE_LIST":return n=t.objectId,a={...e},s={...li,...e[n]||{},voteList:t.voteList,voteListIsLoaded:t.voteListIsLoaded},a[n]=s,a;case"ACTION_VOTE_VOTE":return n=t.objectId,r=e[n].marksPluses||0,o=e[n].marksMinuses||0,t.voted>0?++r:++o,e[n].voted&&t.voted>0?--o:e[n].voted&&t.voted<0&&--r,a={...e},s={...li,...e[n]||{},voteInProcess:t.voteInProcess,rate:t.rate,marksPluses:r,marksMinuses:o},0===s.voted&&s.count++,s={...s,voted:t.voted},a[n]=s,a;case"ACTION_VOTE_IN_PROCESS":return n=t.objectId,a={...e},s={...li,...e[n]||{},voteInProcess:t.voteInProcess},a[n]=s,a;default:return e}},mi={promoBalance:null,wagesPromoBonuses:null,wagesTotalBalance:null,loading:!1,current:{period:"PERIOD_TODAY",periodFrom:c()().add(-31,"days").format("YYYY-MM-DD"),periodTo:c()().add(1,"days").format("YYYY-MM-DD"),timeframe:"TIMEFRAME_HOURS",timeframeEnabledMask:".*"},objectId:null,rows:[],wages:[],total:{},viewsStat:{},activeStat:"general"},di={TIMEFRAME_HOURS:"HH:mm",TIMEFRAME_DAYS:"DD.MM.YYYY",TIMEFRAME_WEEKS:"DD.MM.YYYY"},pi=(e=mi,t)=>{let n;switch(t.type){case"STAT_SET_ACTIVE_STATE":return n={...e},n.activeStat=t.activeStat,n;case"STAT_INIT_STATE":return n={...e},n.objectId=t.objectId,n;case"STAT_CHANGE_PERIOD":switch(n={...e},n.current.period=t.period,t.periodFrom&&(n.current.periodFrom=t.periodFrom),t.periodTo&&(n.current.periodTo=t.periodTo),n.current.period){case"PERIOD_TODAY":case"PERIOD_YESTERDAY":n.current.timeframe="TIMEFRAME_HOURS",n.current.timeframeEnabledMask="TIMEFRAME_HOURS";break;case"PERIOD_WEEK":n.current.timeframe="TIMEFRAME_DAYS",n.current.timeframeEnabledMask="TIMEFRAME_HOURS|TIMEFRAME_DAYS";break;case"PERIOD_MONTH":case"PERIOD_QUARTER":n.current.timeframe="TIMEFRAME_DAYS",n.current.timeframeEnabledMask="TIMEFRAME_DAYS|TIMEFRAME_WEEKS";break;case"PERIOD_YEAR":n.current.timeframe="TIMEFRAME_WEEKS",n.current.timeframeEnabledMask="TIMEFRAME_DAYS|TIMEFRAME_WEEKS";break;default:n.current.timeframe="TIMEFRAME_DAYS",n.current.timeframeEnabledMask=".*"}return n.rows=[],n;case"STAT_CHANGE_TIMEFRAME":return n={...e},n.current.timeframe=t.timeframe,n.rows=[],n;case"STAT_LOADING":return n={...e},n.loading=!0,n;case"STAT_UPDATE":return n={...e},n.loading=!1,n.total={groupUniqueVisitors:0,amount:0,groupViews:0,groupMtAudienceViews:0,groupMtAudienceUniqueVisitors:0,groupSelfAudienceViews:0,groupSelfAudienceUniqueVisitors:0},n.rows=t.rows.map((e=>{const{timeframe:t}=n.current;return Object.keys(n.total).forEach((t=>{"amount"===t&&"number"!=typeof e[t]||(n.total[t]+=e[t])})),{...e,label:c()(e.label).format(di[t])}})),n.total.amount=n.total.amount.toFixed(2),n.wages=t.wages.map((e=>({...e,label:c()(e.label).format(di.TIMEFRAME_DAYS)}))),n;case"STATS_GET_VIEWS":{const n={...e};if(0!==Object.keys(n.viewsStat).length)for(const e in n.viewsStat)n.viewsStat.hasOwnProperty(e)&&(n.viewsStat[e]={...n.viewsStat[e],...t.viewsStat[e]});else n.viewsStat=t.viewsStat;return n}default:return e}},ui={user:void 0,groupPrivileges:{}},gi=(e=ui,t)=>"AUTH_SET"===(t&&t.type)?{...ui,...e,...t.auth}:e;var hi=n(57557),_i=n.n(hi);
/**
 * Mirtesen.
 *
 * AuthForm Reducer.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Ei={isOpen:!1,activeTab:"login",callAndSmsLimits:{apiLimits:{smsAllowed:!0,callAllowed:!0,smsTimeLimitExceededMsg:"",callTimeLimitExceededMsg:""},timers:{}},params:{login:{phone:"",code:"",mode:"SMS",step:"",errorMap:{}},loginByEmail:{email:"",password:"",remember:"on",step:"",errorMap:{}},registration:{name:"",lastname:"",email:"",phone:"",code:"",mode:"SMS",step:"",errorMap:{}},registrationByEmail:{email:"",name:"",phone:"",code:"",mode:"SMS",step:"",errorMap:{}},password:{email:"",errorMap:{}}}},fi={isBusy:!1,widgetId:"0",instances:{0:me()(Ei)}},bi=(e=fi,t)=>{switch(e=ge.reducer(e,t,Ei),t&&t.type){case"AUTH_FORM_TOGGLE":{const n=ge.instanceReducerAll(e,((e,n)=>{n===t.widgetId&&(e.isOpen=!e.isOpen,e.smsAllowed=Ei.smsAllowed,e.callAllowed=Ei.callAllowed,e.smsTimeLimitExceededMsg=Ei.smsTimeLimitExceededMsg,e.callTimeLimitExceededMsg=Ei.callTimeLimitExceededMsg,e.isOpen&&(e.params=me()(Ei.params)))}));return n.widgetId=t.widgetId,n}case"AUTH_FORM_OPEN":{const n=ge.instanceReducerAll(e,((e,n)=>{if(n===t.widgetId){const n=e.isOpen;e.isOpen=!0,e.activeTab=t.activeTab,n!==e.isOpen&&(e.params=me()(Ei.params))}else e.isOpen=!1}));return n.widgetId=t.widgetId,n}case"AUTH_FORM_SET_PHONE_LIMITS":return ge.instanceReducer(e,t.widgetId,(e=>{const{limits:n}=t;e.smsAllowed=n.smsAllowed,e.callAllowed=n.callAllowed,e.smsTimeLimitExceededMsg=n.smsTimeLimitExceededMsg,e.callTimeLimitExceededMsg=n.callTimeLimitExceededMsg,e.callAndSmsLimits.apiLimits={...n}}));case"AUTH_FORM_SET_TIMER":return ge.instanceReducer(e,t.widgetId,(e=>{const n={...e.callAndSmsLimits};n.timers[t.timerKey]=t.value,e.callAndSmsLimits=n}));case"AUTH_FORM_SET_TAB":return ge.instanceReducer(e,t.widgetId,(e=>{e.activeTab=t.activeTab,e.params=me()(Ei.params)}));case"AUTH_FORM_BUSY":return{...e,isBusy:!0};case"AUTH_FORM_UNBUSY":return{...e,isBusy:!1};case"AUTH_FORM_RESULT":{const n=t.tab,a=ge.instanceReducer(e,e.widgetId,(e=>{const a=t.params||{step:"",errorMap:{}};e.params[n]={...e.params[n],...a}}));return a.isBusy=!1,a}case"AUTH_FORM_SET_PARAMS":{const n=t.tab;return ge.instanceReducer(e,t.widgetId,(e=>{e.params[n]={...e.params[n],...t.params,errorMap:_i()(e.params[n].errorMap,Rs()(t.params))}}))}case"AUTH_FORM_SET_ERRORS":{const n=t.tab;return ge.instanceReducer(e,t.widgetId,(e=>{e.params[n].errorMap={...e.params[n].errorMap,...t.errors}}))}case"AUTH_FORM_RESET":{const t=ge.instanceReducerAll(e,(e=>{e.isOpen=!1,e.params=me()(Ei.params)}));return t.isBusy=!1,t}default:return e}},yi={listSites:{mySubscriptions:{items:[],total:0,hideMoreButton:0},mySites:{items:[],total:0,hideMoreButton:0}},listFriends:{hideMoreButton:0,items:[]},listTopics:[],blogMenu:{menuItems:[],activeItem:null},profileMenu:{menuItems:[],activeItem:null},url:null,initialCount:5,loadCount:10,isDropdownVisible:!1},vi=(e=yi,t)=>{let n;switch(t.type){case"LEFT_MENU_USER_STATUS":return n={...e},n.listFriends.items.map((e=>{e.id===t.userId&&(e.status=t.status)})),n;case"LEFT_MENU_SET_LIST_SITES":{const a="FILTER_MEMBER"===t.filter?"mySubscriptions":"mySites";return n={...e},n.listSites[a]={items:t.items,total:t.total,hideMoreButton:t.requestCount>t.items.length?1:0},n}case"LEFT_MENU_ADD_LIST_SITES":{const n="FILTER_MEMBER"===t.filter?"mySubscriptions":"mySites";return{...e,listSites:{...e.listSites,[n]:{items:[...e.listSites[n].items,...t.items],total:t.total,hideMoreButton:t.requestCount>t.items.length?1:0}}}}case"LEFT_MENU_REFRESH_SITES_LIST":{const n="FILTER_MEMBER"===t.filter?"mySubscriptions":"mySites";return{...e,listSites:{...e.listSites,hideMoreButton:{...e.listSites.hasMoreButton,[n]:t.requestCount>e.listSites[n].length?1:0},[n]:{items:[...t.items],total:t.total}}}}case"LEFT_MENU_SET_LIST_FRIENDS":return{...e,listFriends:{hideMoreButton:t.requestCount>t.items.length?1:0,items:t.items}};case"LEFT_MENU_ADD_LIST_FRIENDS":return{...e,listFriends:{hideMoreButton:t.requestCount>t.items.length?1:0,items:[...e.listFriends.items,...t.items]}};case"LEFT_MENU_INITIAL_STATE":return{...e,url:t.url,isDropdownVisible:t.isDropdownVisible};case"LEFT_MENU_RESET_LISTS":return{...e,listSites:{hideMoreButton:0,items:[]},listFriends:{hideMoreButton:0,items:[]}};case"LEFT_MENU_ADD_LIST_TOPICS":{const{items:n}=t;return{...e,listTopics:n}}case"LEFT_MENU_TOGGLE_TOPIC_MENU":{const{isDropdownVisible:n}=t;return{...e,isDropdownVisible:n}}default:return e}},Ti={},Si={isOpen:!1,objectId:null,hasMore:!0,offset:0,users:[],totalCount:0},Pi=(e=Ti,t)=>{const n={...e},a=n[t.objectId]||Si;switch(t.type){case"COMMENTATOR_LIST_TOGGLE_POPUP":return n[t.objectId]={...a,...t.params},n;case"COMMENTATOR_LIST_SHOW_MORE":return n[t.objectId]={...a,hasMore:t.hasMore,users:[...a.users,...t.users],offset:a.offset+t.users.length},n;default:return e}},wi={},Ii={isOpen:!1,objectId:null,hasMore:!0,offset:0,users:[],totalCount:0},Ci=(e=wi,t)=>{const n={...e},a=n[t.objectId]||Ii;switch(t.type){case"REPOSTER_LIST_TOGGLE_POPUP":return n[t.objectId]={...a,...t.params},n;case"REPOSTER_LIST_SHOW_MORE":return n[t.objectId]={...a,hasMore:t.hasMore,users:[...a.users,...t.users],offset:a.offset+t.users.length},n;default:return e}},Ni={isOpen:!1,isBusy:!1,topic:null,list:null,currentBlogPostId:null,nextEditorStatus:null},Oi=(e=Ni,t)=>{const n={...e};switch(t.type){case"TOPIC_MODERATION_OPEN":return n.topic=null,n.isOpen=!0,n.isBusy=!1,n.currentBlogPostId=t.currentBlogPostId,n;case"TOPIC_MODERATION_CLOSE":return n.topic=null,n.isOpen=!1,n.isBusy=!1,n.currentBlogPostId=null,n;case"TOPIC_MODERATION_CHANGE_TOPIC":return n.topic=t.value,n;case"TOPIC_MODERATION_IS_BUSY":return n.isBusy=t.isBusy,n;case"TOPIC_MODERATION_SET_LIST":return n.list=t.list,n;case"TOPIC_MODERATION_CHANGE_EDITOR_STATUS":return n.nextEditorStatus=t.status,n.currentBlogPostId=t.blogPostId,n;default:return n}},Mi={isOpen:!1,popupType:"",id:null,deletedList:{},approveList:{}},ki=(e=Mi,t)=>{switch(t.type){case"TOGGLE_ACTION_DELETE_POST_POPUP":{const n={...e};return n.isOpen=!n.isOpen,t.popupType&&(n.popupType=t.popupType),n.isOpen?n.id=t.id:n.id=null,n}case"DELETE_BLOG_POST":{const n={...e};return n.deletedList[t.id]=!0,n}case"APPROVE_BLOG_POST":{const n={...e};return n.approveList[t.id]=!0,n}case"RESTORE_BLOG_POST":{const n={...e};return n.deletedList[t.id]=void 0,n}default:return e}},Ai=(e={},t)=>{switch(t.type){case"USER_CARD_GET_USER":return t.type=void 0,{...e,...t};case"USER_CARD_CLEAR_DATA":return{};default:return e}},xi={show:!1,data:{}},Li=(e=xi,t)=>{switch(t.type){case"EMAIL_NOTIFICATION_GET_DATA":return{...e,data:t.data};case"EMAIL_NOTIFICATION_TOGGLE_BLOCK":return{...e,show:t.show};default:return e}},Di={isOpen:!1,id:null,message:""},Ri=(e=Di,t)=>{switch(t.type){case"ACTION_BLOG_POST_NOTIFY_POPUP_TOGGLE":{const n={...e};return n.isOpen=!n.isOpen,n.isOpen?n.id=t.id:n.id=null,n}case"ACTION_BLOG_POST_NOTIFY_SEND":{const t={...e};return t.id=null,t.message=null,t}default:return e}},Zi={showModal:!1,type:"feedback",category:0,title:"",email:"",message:"",activeTab:"form",tickets:[],currentTicket:null,inProcess:!1,errors:{}},Bi=(e=Zi,t)=>{let n={...e};switch(t.type){case"FEEDBACK_SET_VALUE":n[t.name]=t.value;break;case"FEEDBACK_SET_TAB":n={...n,...t.object};break;case"FEEDBACK_TOGGLE_MODAL":n={...n,...t.params,showModal:t.value,type:t.formType,activeTab:"form"};break;case"FEEDBACK_ADD_TICKET":n={...Zi,showModal:t.showModal};break;case"FEEDBACK_TOGGLE_PROCESS":n.inProcess=t.inProcess;break;case"FEEDBACK_ADD_ERRORS":n.errors=t.errors;break;case"FEEDBACK_DELETE_ERROR":n.errors[t.error]=null;break;default:return e}return n},$i=(e={},t)=>{const n={...e},a=t.userId;if(!a)return e;switch(delete t.userId,t.type){case"USER_FRIENDSHIP_INIT":return delete t.type,n[a]={...t},n;case"USER_FRIENDSHIP_SET_STATUS":return n[a].friendshipStatus=t.friendshipStatus,n;case"USER_FRIENDSHIP_IGNORE":return n[a].isIgnoreUser=!0,n;case"USER_FRIENDSHIP_ABUSE":return n[a].canAbuseUser=!1,n;default:return e}},Ui={showModal:!1,redirectUrl:""},Hi=(e=Ui,t)=>{switch(t.type){case"LOGOUT_MODAL_OPEN":return{...e,showModal:!0,redirectUrl:t.redirectUrl};case"LOGOUT_MODAL_CLOSE":return{...e,showModal:!1};default:return e}},Fi={},ji=(e=Fi)=>e,Gi={blogPost:[],sliders:[],currentSlider:{title:"",imageUrl:"",imageWidth:0,imageHeight:0},sliderIndex:0,sliderLoading:!1},qi=(e=Gi,t)=>{switch(t.type){case"BLOG_POST_NOTIFY_SEND":{const t={...e};return t.notificationsCanBeSent&&(t.notificationsCanBeSent=!1,t.notificationsWillBeSent=!0,t.notificationsLimit--),t}case"BLOG_POST_CHANGE":return{...e,blogPost:t.blogPost};case"BLOG_POST_SET_SLIDER_STEP_1":{const n={...e},a=Number(t.sliderIndex),s=e.sliders[a];return n.sliderLoading=!0,n.sliderIndex=a,n.currentSlider.title=s.title,n}case"BLOG_POST_SET_SLIDER_STEP_2":{const t={...e},n=t.sliders[t.sliderIndex];return t.currentSlider.imageUrl=n.imageUrl,t.currentSlider.imageWidth=n.imageWidth,t.currentSlider.imageHeight=n.imageHeight,t}case"BLOG_POST_SET_SLIDER_STEP_3":{const t={...e};return t.sliderLoading=!1,t}default:return e}},Vi={logoSwitcher:!1,titleSwitcher:!1,backgroundSwitcher:!1,logoEditor:!1,titleEditor:!1,backgroundEditor:!1},zi=(e=Vi,t)=>{if("SECONDARY_HEADER_TOGGLE"===t.type){const n={...e};return!0===t.show&&-1!==t.block.indexOf("Switcher")&&(n.logoSwitcher=!1,n.titleSwitcher=!1,n.backgroundSwitcher=!1),!0===t.show&&-1!==t.block.indexOf("Editor")&&(n.logoEditor=!1,n.titleEditor=!1,n.backgroundEditor=!1),n[t.block]=t.show,n}return e};var Wi=n(18446),Yi=n.n(Wi);
/**
 * Mirtesen.
 *
 * Blog Menu Editor Reducer.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Ki={stop_tags:[],tags:[],url:"",title:"",type:"posts",html:"",seoTitle:"",seoKeywords:"",seoDescription:""},Ji={isChanged:!1,menuItems:[],currentIndex:null,menuItem:{},staticWidgetsToRemove:[],context:{add:{title:"Добавление раздела",saveButton:"Добавить"},edit:{title:"Раздел: ",saveButton:"Сохранить",remove:"Удалить раздел"}},errors:{}},Xi=(e=Ji,t)=>{const n={...e};switch(t.type){case"BLOG_MENU_SETTINGS_INIT":return{...e,menuItems:t.menuItems};case"BLOG_MENU_SETTINGS_INIT_EDITOR":return{...e,menuItem:t.menuItem,currentIndex:t.currentIndex};case"BLOG_MENU_SETTINGS_SET_MENU_ITEMS":return Yi()(n.menuItems,t.menuItems)?n:{...e,menuItems:t.menuItems,isChanged:!0};case"BLOG_MENU_SETTINGS_REMOVE_STATIC":return{...e,staticWidgetsToRemove:t.staticWidgetsToRemove};case"BLOG_MENU_SETTINGS_CHANGE_VALUE":return n.menuItem=t.menuItem,t.errors&&(n.errors=t.errors),n;case"BLOG_MENU_SETTINGS_CHANGE_HTML":return n.menuItem.html=t.html,n;case"BLOG_MENU_SETTINGS_TOGGLE_POPUP":return n.popup.isOpen=!n.popup.isOpen,n;case"BLOG_MENU_SETTINGS_SET_POPUP":return n.popup.text=t.message,n.popup.reload=t.reload,n.popup.redirect=t.redirect,n;case"BLOG_MENU_SETTINGS_SET_INPUT_ERRORS":return n.errors=t.errors,n;case"BLOG_MENU_SETTINGS_SAVE_SUCCESS":return n.isChanged=!1,n;default:return e}},Qi={staff:[],popup:{popupType:null,userInfo:null},errors:{},radioBtnValue:null},el=(e=Qi,t)=>{switch(t.type){case"BLOG_MODERATORS_TOGGLE_POPUP":{const n={...e};return n.popup={popupType:t.popupType,userInfo:t.userInfo},t.userInfo&&(n.radioBtnValue=null),n}case"BLOG_MODERATORS_DELETE_MODERATOR":{const n={...e};return n.staff.map(((e,a)=>{e.id===t.userId&&n.staff.splice(a,1)})),n}case"BLOG_MODERATORS_ADD_ERRORS":return{...e,errors:t.errors};case"BLOG_MODERATORS_EDIT_MODERATOR":{const n={...e};return n.staff.map((e=>{e.id===t.userId&&(e.role=t.role)})),n}case"BLOG_MODERATORS_ADD_MODERATOR":return{...e,staff:t.staff};case"BLOG_MODERATORS_CHANGE_RADIO":{const n={...e};return n.radioBtnValue=t.value,n}default:return e}},tl={usedSearch:!1,activeTab:"rating",tabs:{},staff:{},search:{}},nl={userList:[],hasMore:!0,page:0,initialPage:1},al=(e=tl,t)=>{switch(t.type){case"BLOG_MEMBER_CHANGE_TAB":{const n={...e};return n.activeTab!==t.tab&&(n.tabs[n.activeTab]={...nl},n.activeTab=t.tab),n}case"BLOG_MEMBER_GET_PAGE":{const n={...e},a=t.activeTab;return n.tabs[a]={...n.tabs[a],userList:t.userList,page:t.page,hasMore:t.hasMore},n}case"BLOG_MEMBER_DO_SEARCH":{const n={...e};return n.usedSearch=!0,n.tabs[n.activeTab]={...nl},n.search={needle:t.needle,userList:t.userList,page:1,initialPage:1,hasMore:t.hasMore},n}case"BLOG_MEMBER_GET_SEARCH_RESULTS":{const n={...e};return n.search={...n.search,...t},n}case"BLOG_MEMBER_ADD_MODERATOR":{const n={...e};return n.staff[t.userId]=t.role,n}case"BLOG_MEMBER_SHOW_TABS":{const t={...e};return t.usedSearch=!1,t}case"BLOG_MEMBER_UPDATE_LIST":{const n={...e};return t.tabs.map((e=>{n.tabs[e]={userList:[],hasMore:!0,page:0}})),n}case"BLOG_MEMBER_REMOVE_USER_FROM_LIST":{const n={...e};for(const e in n.tabs)if(t.tabs.indexOf(e)>-1&&n.tabs[e].userList.length>0){const a=n?.tabs?.[e]?.userList||[],s=a.findIndex((e=>Number(e.id)===Number(t.userId)));s>-1&&a.splice(s,1)}return n}case"BLOG_MEMBER_ADD_USER_TO_LIST":{const n={...e};for(const e in n.tabs)if(t.tabs.indexOf(e)>-1){(n?.tabs?.[e]?.userList||[]).push({id:t.userId})}return n}default:return e}},sl={id:null,title:"",text:"",inProcess:!1,sign:"",disableComments:!1,tags:[],tagSuggestions:[],errors:[],publishTime:null,referenceUrl:"",nextBtnUrl:"",pushBtnUrl:"",pushBtnText:"",doFollowLinks:0,pulse:0,draft:!1,preloaderVisible:!0,errorMessage:{isVisible:!1,text:"Произошла ошибка. Попробуйте еще раз или свяжитесь со службой поддержки."},showPollEditor:!1,pollTab:"default",sentToModeration:!1,foundPolls:[],foundPollsOffset:0,hasMorePolls:!0,pollId:null},rl=(e=sl,t)=>{const n={...e};switch(t.type){case"BLOG_POST_EDITOR_IN_PROCESS":case"BLOG_POST_EDITOR_COMPLETE":return{...e,inProcess:t.inProcess};case"BLOG_POST_EDITOR_SET_POLL_TAB":return{...e,pollTab:t.tab};case"BLOG_POST_EDITOR_CHANGE_VALUE":{const n={...e};return n[t.name]=t.value,n}case"BLOG_POST_EDITOR_ERROR_PROCESSING":{const n={...e},a=n.errors.indexOf(t.name);return t.adding&&-1===a?n.errors.push(t.name):t.adding||-1===a||n.errors.splice(a,1),n}case"BLOG_POST_EDITOR_CHANGE_TAGS":return{...e,tagSuggestions:[],tags:t.tags};case"BLOG_POST_EDITOR_DO_FOLLOW":return n.doFollowLinks=!n.doFollowLinks,n;case"BLOG_POST_EDITOR_DISABLE_COMMENTS":return n.disableComments=!n.disableComments,n;case"BLOG_POST_EDITOR_CHANGE_DRAFT_VALUE":return n.draft=t.value,n;case"BLOG_POST_EDITOR_CHANGE_SUGGESTIONS_DATA":return t.tags.length>0?n.tagSuggestions=t.tags:n.tagSuggestions[0]={id:+new Date,text:t.text},n;case"BLOG_POST_EDITOR_RESET_SUGGESTIONS_DATA":return n.tagSuggestions=[],n;case"BLOG_POST_EDITOR_PRELOADER_TOGGLE":return n.preloaderVisible=t.state,n;case"BLOG_POST_EDITOR_SHOW_ERROR":return n.errorMessage.isVisible=!0,t.text&&(n.errorMessage.text=t.text),n;case"BLOG_POST_EDITOR_HIDE_ERROR":return n.errorMessage.isVisible=!1,n;case"BLOG_POST_EDITOR_ADD_POLL":return n.pollId=t.pollId,n;case"BLOG_POST_EDITOR_DELETE_POLL":return n.pollId=null,n.showPollEditor=!1,n.pollTab="default",n;case"BLOG_POST_EDITOR_SENT_TO_MODERATION":return n.sentToModeration=!0,n;case"BLOG_POST_EDITOR_TOGGLE_POLL":return n.showPollEditor=t.value,n;case"BLOG_POST_EDITOR_SET_POLLS_SEARCH_RESULTS":return n.hasMorePolls=t.hasMorePolls,n.foundPolls=t.foundPolls,n.foundPollsOffset=t.foundPollsOffset,n;default:return e}},ol={searchValue:"",search:{results:[],page:0,hasMore:!0,isLoading:!1},blogPostList:[],hasMoreItems:!0,page:1,title:"",tag:"",period:"",before:"",after:"",status:"",sort:""},il=(e=ol,t)=>{switch(t.type){case"BLOG_POST_LIST_GET_PAGE":return{...e,blogPostList:t.blogPostList,hasMoreItems:t.hasMoreItems,page:t.page};case"BLOG_POST_LIST_CHANGE_PERIOD":{const n={...e};return n.period=t.period,n.page=0,n.hasMoreItems=!0,n.blogPostList=[],n}case"BLOG_POST_LIST_SET_PERIOD":{const n={...e};return n.after=t.after,n.before=t.before,n.page=0,n.hasMoreItems=!0,n.blogPostList=[],n}case"BLOG_POST_LIST_CHANGE":return{...e,blogPostList:t.blogPostList};case"BLOG_POST_LIST_NOTIFY_SEND":{const n=e.blogPostList.findIndex((e=>e.id===t.id)),a=e.blogPostList[n];return a.notificationsCanBeSent=!1,a.notificationsWillBeSent=!0,a.notificationsLimit=a.notificationsLimit-1,{...e}}case"BLOG_POST_LIST_SET_SEARCH":return{...e,searchValue:t.searchValue,search:{...e.serach,page:0,hasMore:!0,results:[]}};case"BLOG_POST_LIST_TOOGLE_SEARCH_LOADING":return{...e,search:{...e.search,isLoading:t.isLoading}};case"BLOG_POST_LIST_GET_SEARCH_RESULTS":return{...e,search:{...e.search,results:[...e.search.results,...t.results],page:t.page,hasMore:t.hasMore}};default:return e}},ll={posts:[],hasMoreItems:!0,page:0,sort:"latest"},cl=(e=ll,t)=>"PLATFORM_POST_LIST_GET_PAGE"===t.type?{...e,posts:t.posts,hasMoreItems:t.hasMoreItems,page:t.page}:e,ml={newsPost:[]},dl=(e=ml)=>e,pl={posts:[],nextOffset:0,hasMoreItems:!0,currentUserPostId:null,page:0},ul=(e=pl,t)=>"PERSON_POST_LIST_SET_LIST_DATA"===t.type?{...e,...t}:e,gl={topicKey:null,filter:"selected"},hl=(e=gl,t)=>(t.type,e),_l={topicKey:null,filter:"selected"},El=(e=_l,t)=>(t.type,e),fl={image:null,type:"blog",allowZoomOut:!1,position:{x:.5,y:.5},scale:1,rotate:0,borderRadius:0,blogHeight:240,profileHeight:240,border:0,isEmpty:!0},bl=(e=fl,t)=>{switch(t.type){case"BACKGROUND_EDITOR_INIT_STATE":return{...e,...t.object};case"BACKGROUND_EDITOR_DROP_IMAGE":return{...e,image:t.image};case"BACKGROUND_EDITOR_SET_POSITION":return{...e,position:t.position};case"BACKGROUND_EDITOR_SET_SCALE":return{...e,scale:t.scale};case"BACKGROUND_EDITOR_SET_ROTATE":return{...e,rotate:t.rotate};case"BACKGROUND_EDITOR_SET_IMAGE":return{...e,isEmpty:!!t.isEmpty&&t.isEmpty,image:t.image};default:return e}},yl={image:null,allowZoomOut:!1,position:{x:.5,y:.5},scale:1,rotate:0,borderRadius:0,width:100,height:100,border:0,isEmpty:!0,type:"blog"},vl=(e=yl,t)=>{switch(t.type){case"LOGO_EDITOR_INIT_STATE":return{...e,...t.object};case"LOGO_EDITOR_DROP_IMAGE":return{...e,image:t.image};case"LOGO_EDITOR_SET_POSITION":return{...e,position:t.position};case"LOGO_EDITOR_SET_SCALE":return{...e,scale:t.scale};case"LOGO_EDITOR_SET_ROTATE":return{...e,rotate:t.rotate};case"LOGO_EDITOR_SET_IMAGE":return{...e,isEmpty:!!t.isEmpty&&t.isEmpty,image:t.image};default:return e}},Tl=[],Sl=(e=Tl,t)=>(t.type,e),Pl=[],wl=(e=Pl,t)=>{switch(t.type){case"RIGHT_COLUMN_COMMENTS_GET_COMMENTS":return[].concat(t.comments);case"RIGHT_COLUMN_COMMENTS_GET_NEW_COMMENT":return[...t.comment,...e.slice(0,2)];default:return e}},Il={total:0,images:[]},Cl=(e=Il,t)=>"RIGHT_COLUMN_GALLERY_GET_IMAGES"===t.type?{...e,images:t.images}:e,Nl={title:""},Ol=(e=Nl,t)=>{switch(t.type){case"TITLE_EDITOR_INIT_STATE":return{...e,...t.object};case"TITLE_EDITOR_CHANGE_VALUE":{const n={...e};return n[t.name]=t.value,n}default:return e}},Ml={items:[],hasMoreItems:!0,page:0,userStatus:null,showModal:!1,modalCommentId:null},kl=(e=Ml,t)=>{switch(t.type){case"BLOG_COMMENT_PAGE_GET":return{...e,...t};case"BLOG_COMMENT_PAGE_GET_USER_STATUS":return{...e,...t,showModal:!0};case"BLOG_COMMENT_PAGE_HIDE_MODAL":return{...e,showModal:!1};case"BLOG_COMMENT_PAGE_ABUSE_USER":{let n=[...e.items];return n=n.map((e=>e.id===t.commentId?(e.isAbused=!0,e):e)),{...e,items:n}}case"BLOG_COMMENT_PAGE_DELETE_COMMENT":{let n=[...e.items];return n=n.map((e=>e.id===t.commentId?(e.isDeleted=!0,e):e)),{...e,items:n}}case"BLOG_COMMENT_PAGE_BAN_USER":{let n=[...e.items];return n=n.map((e=>e.id===t.commentId?(e.isBanned=!0,e):e)),{...e,items:n}}case"BLOG_COMMENT_PAGE_CLOSE_INTERACTIVE_POPUP":{let n=[...e.items];return n=n.map((e=>e.id===t.commentId?(e[t.popupSort]=!1,e):e)),{...e,items:n}}default:return e}};var Al=n(36968),xl=n.n(Al),Ll=n(15394);
/**
 * Mirtesen.
 *
 * Site Settings Reducer.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Dl=(e={},t)=>{const n=(0,Ll.I8)(e);switch(t.type){case"SITE_SETTINGS_CHANGE_TAB":return n.activeTab=t.tabName,n.errors={},n;case"SITE_SETTINGS_CHANGE_RSS_LIST":return n.data.rssImport.list=(0,Ll.I8)(t.list),n;case"SITE_SETTINGS_CHANGE_TELEGRAM_IMPORT":return n.data.telegramImport=(0,Ll.I8)(t.list),n;case"SITE_SETTINGS_CHANGE_VALUE":return xl()(n,`data.${t.tabName}.${t.name}`,t.value),n.sections[t.tabName].changed=!0,n;case"SITE_SETTINGS_SAVE_SETTINGS":return n.sections[t.tabName].changed=!1,n;case"SITE_SETTINGS_TOGGLE_POPUP":return n.popup.isOpen=!n.popup.isOpen,n;case"SITE_SETTINGS_SUCCESS_POPUP":return n.popup.text="Успешно сохранено",n;case"SITE_SETTINGS_ERROR_POPUP":return n.popup.text=t.message,n;case"SITE_SETTINGS_SET_INPUTS_ERRORS":return n.errors={...n.errors,...t.errors},n;case"SITE_SETTINGS_SET_VALIDATION":return delete n.errors[t.key],n.valid[t.key]=t.title,n;case"SITE_SETTINGS_SET_ERROR":return delete n.valid[t.key],n.errors[t.key]||(n.errors[t.key]={}),n.errors[t.key].title=t.title,n;default:return e}},Rl={sitesDropdown:!1},Zl=(e=Rl,t)=>{switch(t.type){case"SITE_SETTINGS_LEFT_MENU_SHOW_DROPDOWN":return{...e,sitesDropdown:!0};case"SITE_SETTINGS_LEFT_MENU_HIDE_DROPDOWN":return{...e,sitesDropdown:!1};default:return e}},Bl={activeTab:"personal",sections:{personal:{title:"Мои данные",isMenu:!0,changed:!1},contacts:{title:"Контактная информация",isMenu:!0,changed:!1},privacy:{title:"Приватность и уведомления",isMenu:!0,changed:!1},password:{title:"Смена пароля",isMenu:!0,changed:!1},siteblacklist:{title:"Сайты в черном списке",isMenu:!0,changed:!1},peopleblacklist:{title:"Люди в черном списке",isMenu:!0,changed:!1},confirm:{title:"Подтвердите свой номер мобильного телефона",isMenu:!1,changed:!1}},data:{personal:{userName:"",userSurname:"",userPseudonym:"",userStatus:"",userBirthday:"",userBirthdayMonth:"",userBirthdayYear:"",userGender:"",education:"",familyStatus:"",profession:"",favoriteMusic:"",favoriteFilms:"",favoriteBooks:"",favoriteFood:"",favoriteGames:"",favoriteOther:""},contacts:{personEmail:"",addEmail:"",addMessengerICQ:"",addMessengerSkype:"",addMessengerYaOnline:"",addMessengerGooglePlus:"",addMessengerMailAgent:"",addMailSocial:"",addFacebookSocial:"",addVkSocial:"",addOkSocial:"",addMobilePhone:"",addHomePhone:"",addWorkPhone:"",otherInfoInput:"",otherSitesInput:"",socialNetworks:{},emails:{}},privacy:{canViewMyPage:void 0,canSeeMyFriends:void 0,canInviteMeOnSite:void 0,canPostOnMyWall:void 0,aboutTodayThemes:!0,aboutFriendsAndNewMessage:!0,aboutComments:!0,aboutPhotos:!0,aboutSites:!0,wasInvited:"",languageSelection:0},password:{oldPassword:"",nextPassword:"",nextPasswordRepeat:"",showPassword:!1},confirm:{phone:"",phoneConfirmCode:"",resending:!1,confirmSmsSent:!1},tools:{buttonCode:'<a href="https://mirtesen.ru/people/me?post=https://mirtesen.ru" style="text-decoration: none; display: inline-block; position: relative; top: 4px;"><div style="display: table-cell; vertical-align: middle;"><img src="https://static.mtml.ru/images/share_button.png"/></div><b style="color: black; font-family: Arial; font-size: 14px; display: table-cell; padding-left: 3px; vertical-align: middle;">МирТесен</b></a>'},invitefriends:{searchInput:""},siteblacklist:{},peopleblacklist:{}},errors:{},valid:{}},$l=(e=Bl,t)=>{let n;switch(t.type){case"PERSON_SETTINGS_CHANGE_TAB":return n={...e},n.activeTab=t.tabName,n;case"PERSON_SETTINGS_CHANGE_VALUE":return n={...e},xl()(n.data[t.tabName],t.name,t.value),n.sections[t.tabName].changed=!0,n;case"PERSON_SETTINGS_CHANGE_CHECKBOX_VALUE":return n={...e},n;case"PERSON_SETTINGS_SET_EMAILS":return n={...e},n.data.contacts.emails=t.emails,n;case"PERSON_SETTINGS_SAVE_CHANGES":return n={...e},n.sections[t.tabName].changed=!1,n.errors={},n;case"PERSON_SETTINGS_TOGGLE_POPUP":return n={...e},n.popup.isOpen=!n.popup.isOpen,n;case"PERSON_SETTINGS_SET_INPUT_ERRORS":return n={...e},n.errors=t.errors,n;case"PERSON_SETTINGS_SET_INPUT_VALID":return n={...e},n.valid=t.valid,n;default:return e}},Ul={publications:[],page:0,hasMoreItems:!0},Hl=(e=Ul,t)=>"PERSON_PUBLICATIONS_LIST_GET"===t.type?{...e,...t}:e,Fl={},jl=(e=Fl,t)=>(t.type,e),Gl={id:null,groupId:void 0,status:"STATUS_PENDING",dateStart:null,dateEnd:null,fullClicksLimit:null,dayClicksLimit:null,clickPrice:null,utmSource:null,utmMedium:null,utmCampaign:null,targetGeoIds:null,targetIsMale:null,targetAgeMin:null,targetAgeMax:null,targetTime:null,title:null,canChangeStatus:null,inRotation:!1,fullClicks:0,dayClicks:0},ql={popup:{},activeTab:"platform",sections:{platform:{title:"Реклама на Платформе",isMenu:!0,changed:!1,forDevs:!0},settings:{title:"Настройки рекламы",isMenu:!0,changed:!1,forDevs:!0},item:{title:"Редактирование объекта",isMenu:!1,changed:!1,forDevs:!0},itemAdd:{title:"Добавление объекта",isMenu:!1,changed:!1,forDevs:!0},deposit:{title:"Пополнение баланса",isMenu:!1,changed:!1,forDevs:!0},stats:{title:"Статистика рекламы",isMenu:!0,changed:!1,forDevs:!0}},changed:{platform:!1,settings:!1,item:!1,stats:!1},data:{platform:"",settings:{currentBalance:0,spentBalance:0,groupItem:me()(Gl),blogpostItems:[]},item:me()(Gl),itemAdd:{url:null},deposit:{value:""},stats:{periodFrom:c()().subtract(20,"d").format("YYYY-MM-DD"),periodTo:c()().format("YYYY-MM-DD")}},errors:{}},Vl=(e=ql,t)=>{let n;switch(t.type){case"PROMOTION_CHANGE_TAB":return n={...e},n.errors={},n.activeTab=t.tabName,n;case"PROMOTION_INIT_TAB":return n={...e},n.data[t.tabName]={...ql.data[t.tabName],...t.data},n;case"PROMOTION_INIT_STATE":return n={...e},n.data.stats.rows=t.rows,n;case"PROMOTION_SET_PERIOD":return n={...e},n.data.stats.periodFrom=t.periodFrom,n.data.stats.periodTo=t.periodTo,n;case"PROMOTION_CHANGE_VALUE":return n={...e},n.data[t.tabName]={...n.data[t.tabName]},n.data[t.tabName][t.name]=t.value,n.changed[t.tabName]=!0,n;case"PROMOTION_SAVE_SETTINGS":return n={...e},n.changed[t.tabName]=!1,n;case"PROMOTION_TOGGLE_POPUP":return n={...e},n.popup.isOpen=!n.popup.isOpen,n;case"PROMOTION_SUCCESS_POPUP":return n={...e},n.popup.text="Успешно сохранено",n;case"PROMOTION_ERROR_POPUP":return n={...e},n.popup.text=t.message,n;case"PROMOTION_SET_INPUTS_ERRORS":return n={...e},n.errors=t.errors,n;default:return e}},zl={activeTab:"stats",sections:{stats:{title:"Статистика",isMenu:!0,changed:!1,forDevs:!0},settings:{title:"Настройки",isMenu:!0,changed:!1,forDevs:!0}},changed:{stats:!1,settings:!1},data:{stats:{periodFrom:c()().subtract(7,"d").format("YYYY-MM-DD"),periodTo:c()().format("YYYY-MM-DD")},settings:{applyForCommentsEnabled:0,commonEnabled:0,siteEnabled:0,keyWords:[]}},errors:{}},Wl=(e=zl,t)=>{let n;switch(t.type){case"EDIT_COMMENTS_CHANGE_TAB":return n={...e},n.activeTab=t.tabName,n;case"EDIT_COMMENTS_INIT_STATE":return n={...e},n.data.stats.commentsRows=t.commentsRows,n.data.stats.commentatorsRows=t.commentatorsRows,n;case"EDIT_COMMENTS_SET_PERIOD":return n={...e},n.data.stats.periodFrom=t.periodFrom,n.data.stats.periodTo=t.periodTo,n;case"EDIT_COMMENTS_CHANGE_VALUE":return n={...e},n.data[t.tabName][t.name]=t.value,n.changed[t.tabName]=!0,n;case"EDIT_COMMENTS_SAVE_SETTINGS":return n={...e},n.changed[t.tabName]=!1,n;case"EDIT_COMMENTS_TOGGLE_POPUP":return n={...e},n.popup.isOpen=!n.popup.isOpen,n;case"EDIT_COMMENTS_SUCCESS_POPUP":return n={...e},n.popup.text="Успешно сохранено",n;case"EDIT_COMMENTS_ERROR_POPUP":return n={...e},n.popup.text=t.message,n;case"EDIT_COMMENTS_SET_INPUTS_ERRORS":return n={...e},n.errors=t.errors,n;case"ADD_SITE_COMMENTS_STOP_WORD":return n={...e},n.data.settings.keyWords=[...n.data.settings.keyWords,{id:t.stopWord.id,text:t.stopWord.text}],n.changed.settings=!0,n;case"REMOVE_SITE_COMMENTS_STOP_WORD":return n={...e},n.data.settings.keyWords=n.data.settings.keyWords.filter((e=>e.id!==t.id)),n.changed.settings=!0,n;case"SET_SITE_COMMENTS_STOP_WORD_SETTINGS":return n={...e},n.data.settings[t.name]=!!+t.value,n.changed.settings=!1,n;default:return e}},Yl={ratedGroups:[],page:1,hasMore:!0,period:"PERIOD_MONTH",order:"ORDER_BY_UNIQUE_VISITORS",searchValue:""},Kl=(e=Yl,t)=>{switch(t.type){case"GROUPS_SET":return{...e,ratedGroups:t.groups,hasMore:t.hasMore,searchValue:t.searchValue};case"GROUPS_SET_PERIOD":return{...e,period:t.period};case"GROUPS_SET_ORDER":return{...e,order:t.order};case"GROUPS_SET_PAGE":return{...e,page:t.page};default:return e}},Jl={},Xl=(e=Jl,t)=>(t.type,e),Ql={title:"",html:""},ec=(e=Ql,t)=>(t.type,e),tc={search:"",tab:"friends",inProcess:!1,tabData:{friends:{title:"Друзья",url:"/people/[MT_USER_ID]/friends",data:[],page:1,hasMore:!1,count:0,tooltip:"Ваши друзья"},"incoming-requests":{title:"Входящие",url:"/people/[MT_USER_ID]/friends/incoming-requests",data:[],page:1,hasMore:!1,count:0,tooltip:"Люди хотят добавить вас в друзья"},"outgoing-requests":{title:"Исходящие",url:"/people/[MT_USER_ID]/friends/outgoing-requests",data:[],page:1,hasMore:!1,count:0,tooltip:"Ваши предложения дружить"},recommended:{title:"Рекомендуемые",url:"/people/[MT_USER_ID]/friends/recommended",data:[],page:1,hasMore:!1,count:0,tooltip:"Вы можете знать этих людей"}}},nc=(e=tc,t)=>{switch(t.type){case"FRIENDS_LIST_GET":return{...e,tabData:t.tabData};case"FRIENDS_LIST_NEW_SEARCH":return{...e,search:t.search,tab:"friends",tabData:t.tabData};case"FRIENDS_LIST_CHANGE_FRIEND_MENU":return{...e,tab:t.tab};case"FRIENDS_LIST_SET_PYMK_STATUS":{const n={...e},a=n?.tabData?.recommended?.data||[],s=a.findIndex((e=>e.id===t.id));return n.tabData.recommended.data=[...a.slice(0,s),...a.slice(s+1)],n}case"FRIENDS_LIST_TOGGLE_PROCESS":{const n={...e};return n.inProcess=t.value,n}default:return e}},ac={profileInfo:{},friends:[],sites:[],photos:[],videos:[],popup:{isOpen:!1,text:"Успешно сохранено",buttonText:"ОК",reload:!0,redirect:!1}},sc=(e=ac,t)=>{let n;switch(t.type){case"PERSON_PROFILE_TOGGLE_POPUP":return n={...e},n.popup={...n.popup,isOpen:!n.popup.isOpen},n;case"PERSON_PROFILE_SET_POPUP":return n={...e},n.popup={...n.popup,text:t.message,reload:t.reload,redirect:t.redirect},n;default:return e}},rc={items:[],page:1,hasMoreItems:!1},oc=(e=rc,t)=>"PERSON_PRIVATE_MEDIA_LIST_GET"===t.type?{...e,...t}:e,ic={page:1,hasMoreItems:!0},lc=(e=ic,t)=>{switch(t.type){case"PERSON_GET_SITE_LIST":return{...e,...t};case"SITES_SET":return{...e,sites:t.sites};default:return e}},cc={events:[],hasMoreItems:!0,page:1},mc=(e=cc,t)=>"PERSON_EVENTS_GET"===t.type?{...e,...t}:e,dc={page:1,hasMoreItems:!0,comments:{}},pc=(e=dc,t)=>"PERSON_COMMENTS_LIST_GET"===t.type?{...e,...t}:e,uc="FOOTER_CATFISH_SET_POSTS_SCROLLED",gc=()=>(e,t)=>{const n=t();return e({type:uc,postsScrolled:Number(n.footerCatFish.postsScrolled)+1})},hc={postsScrolled:0},_c=(e=hc,t)=>t.type===uc?{...e,postsScrolled:t.postsScrolled}:e,Ec={accountConsolidation:null},fc=(e=Ec,t)=>(t.type,e),bc={},yc=(e=bc,t)=>(t.type,e),vc={},Tc=(e=vc,t)=>(t.type,e),Sc={editKey:null,type:"add",loading:{defaultImage:!1},values:{maxTextLength:0,publicationDelay:0,useFullText:!1,useShortDesctiption:!1,ignoreMediaTags:!1,rssSourceLink:"",autoRefreshImportedThemes:!1,pregTemplateTextSearch:"",pregTemplateTextChange:"",xpathLongText:"",xpathImage:"",showCategory:"",importCategory:"",keepImages:!1,keepLinks:!1,keepIframes:!1,useEmbedCode:!1,useYandexTurbo:!1,addYandexGenreTags:!1,loadingTimout:0,hideSourceLink:!1,defaultImage:""}},Pc=(e=Sc,t)=>{switch(t.type){case"RSS_EDITOR_2_CHANGE_VALUE":return{...e,values:{...e.values,[t.key]:t.value}};case"RSS_EDITOR_2_CHANGE_LOADING":return{...e,loading:{...e.loading,[t.key]:t.value}};case"RSS_EDITOR_2_INIT_VALUES":return{...e,...t.state};default:return e}},wc={},Ic=(e=wc,t)=>(t.type,e),Cc={updatedAt:"",expandOptions:!1,expandList:!1,hasMore:!1,isEmpty:null,page:0,list:[],offset:0},Nc=(e=Cc,t)=>{switch(t.type){case"EMAIL_NOTIFICATIONS_GET_LIST":return{...e,list:t.list,updatedAt:t.updatedAt,page:t.page,isEmpty:t.isEmpty,hasMore:t.hasMore};case"EMAIL_NOTIFICATIONS_TOGGLE_OPTIONS":return{...e,expandOptions:!e.expandOptions};case"EMAIL_NOTIFICATIONS_TOGGLE_LIST":return{...e,expandList:t.expandList,list:t.list};case"EMAIL_NOTIFICATIONS_TOGGLE_ITEM":return{...e,list:t.list};default:return e}},Oc={post:null,isOpen:!1},Mc=(e=Oc,t)=>{switch(t.type){case"TOPIC_PARTNER_POST_MODAL_SET_POST":{const n={...e};return n.post=t.post,n.isOpen=!0,n.displayType="window",n}case"TOPIC_PARTNER_POST_TOGGLE_MODAL":{let n={...e};return t.isOpen?(n.isOpen=t.isOpen,n.displayType="window"):n=Oc,n}default:return e}},kc={polls:[],currentFilter:"new",page:0,hasMore:!0,recordsOnPage:0,hiddenPolls:{}},Ac=(e=kc,t)=>{switch(t.type){case"POLLS_POST_LIST_LOAD_MORE":return{...e,polls:t.polls,page:t.page,hasMore:t.hasMore};case"POLLS_POST_LIST_TOOGLE_POLL_VISIBILITY":if("hide"===t.params||"abuse"===t.params)return{...e,hiddenPolls:{...e.hiddenPolls,[t.pollId]:t.params}};{const n={...e.hiddenPolls};return delete n[t.pollId],{...e,hiddenPolls:n}}default:return e}};let xc=function(e){return e.LINK="link",e.BUTTON="btn",e}({});
/**
 * Mirtesen.
 *
 * Subscribe Action Reducer.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Lc={},Dc={isMember:!1,isSubscribed:!1,initialSubscribeStatus:!1,isOwner:!1,isStaff:!1,isBlocked:!1},Rc=(e=Lc,t)=>{const n={...e},a=n[t.objectId]||Dc;switch(t.type){case"BLOG_SUBSCRIPTION_INIT_STATE":return n[t.objectId]={...Dc,...a,...t.state},n;case"BLOG_SUBSCRIPTION_JOIN_TO_SITE":return n[t.objectId]={...Dc,...a,isMember:t.isMember},n;case"BLOG_SUBSCRIPTION_SUBSCRIBE_TO_SITE":return n[t.objectId]={...Dc,...a,isSubscribed:t.isSubscribed},n;default:return e}},Zc=(e={},t)=>(t.type,e),Bc=(e={},t)=>(t.type,e),$c={items:[],page:0,hasMore:!0},Uc=(e=$c,t)=>"BILLING_LIST_LOAD_MORE"===t.type?{...e,items:[...e.items,...t.billingList],hasMore:t.hasMore,page:t.page}:e,Hc={items:[],nextFrom:"",hasMore:!0},Fc=(e=Hc,t)=>"ACTIVITIES_LIST_LOAD_MORE"===t.type?{...e,items:[...e.items,...t.items],nextFrom:t.nextFrom,hasMore:t.hasMore}:e,jc={domain:"",similarDomains:[],name:"",tagLine:"",description:"",keywords:"",logo:null,inProcess:!1,successMessage:{},errorMessage:{}},Gc=(e=jc,t)=>{const n={...e};switch(t.type){case"CREATE_SITE_SET_VALUE":n[t.name]=t.value;break;case"CREATE_SITE_CHECK_DOMAIN":n.successMessage.domain=t.successMessage,n.errorMessage.domain=t.errorMessage,n.similarDomains=t.similarDomains;break;case"CREATE_SITE_RESET_MESSAGES":n.successMessage[t.name]=null,n.errorMessage[t.name]=null,n.similarDomains=[];break;case"CREATE_SITE_PROCESS_ERRORS":n.errorMessage={...n.errorMessage,...t.errors};break;case"CREATE_SITE_TOGGLE_PROCESS":n.inProcess=t.inProcess;break;default:return e}return n},qc={},Vc=(e=qc,t)=>{const n=t.id||"default";let a={};switch(t.type&&(a={...e}),t.type){case"POST_TILES_HIDE_POST":return a[n]={...a[n],hiddenPosts:[...a[n].hiddenPosts,t.hiddenPost]},a;case"POST_TILES_LOAD_MORE":return a[n]={...a[n],hasMore:t.hasMore,page:t.page},t.posts2&&(a[n].posts2=t.posts2),t.posts&&(a[n].posts=t.posts),a;default:return e}},zc={recommendedFriends:[]},Wc=(e=zc,t)=>{switch(t.type){case"PYMK_GET_RECOMMENDED_FRIENDS":return{...e,recommendedFriends:t.recommendedFriends};case"PYMK_SET_STATUS":{const n=e.recommendedFriends.findIndex((e=>e.id===t.id));return{...e,recommendedFriends:[...e.recommendedFriends.slice(0,n),...e.recommendedFriends.slice(n+1)]}}default:return e}},Yc={userList:[],hasMore:!0,offset:0,showCount:4},Kc=(e=Yc,t)=>{switch(t.type){case"TOP_AUTHORS_GET_LIST":return{...e,userList:[...e.userList,...t.userList],offset:t.offset,hasMore:t.hasMore};case"TOP_AUTHORS_SET_STATUS":{const n=e.userList.findIndex((e=>e.id===t.id));return{...e,userList:[...e.userList.slice(0,n),...e.userList.slice(n+1)]}}default:return e}},Jc={posts:{}},Xc=(e=Jc,t)=>{const n={...e};switch(t.type){case"POST_2_TOP_INIT":case"POST_2_TOP_SET_TOP_STATUS":return n.posts[t.postId]=t.topStatus,n;default:return e}},Qc={isEmailSent:!1,emailError:"",inputValue:{pass1:"",pass2:"",email:""}},em=(e=Qc,t)=>{let n={...e};switch(t.type){case"RECOVERY_PASSWORD_EMAIL_SENT":return n={...n,isEmailSent:!0},n;case"RECOVERY_PASSWORD_SET_EMAIL_ERROR":return n={...n,emailError:t.message},n;case"RECOVERY_PASSWORD_SET_PASSWORD_ERROR":return n={...n,passwordError:t.message},n;case"RECOVERY_PASSWORD_SET_INPUT_VALUE":return n.inputValue={...n.inputValue,[t.name]:t.value},n;case"RECOVERY_PASSWORD_RESET_FORM":return n={...Qc},n;default:return e}},tm={items:[],hasMoreItems:!0,count:6,nextOffset:0,isLoading:!1},nm=(e=tm,t)=>{switch(t.type){case"BLOG_POST_RECOMMENDED_GET_LIST":return{...e,items:t.items,hasMoreItems:t.hasMoreItems,nextOffset:t.nextOffset,isLoading:!1};case"BLOG_POST_RECOMMENDED_LOADING":return{...e,isLoading:!0};default:return e}},am={posts:[],nonFriendPostIds:[],hasMore:!1,nextOffset:0,feedId:null,activeTab:"main",personVislvl:"",hiddenPosts:[]},sm=(e=am,t)=>{switch(t.type){case"MAIN_POST_LIST_GET_LIST":return{...e,...t};case"MAIN_POST_LIST_SET_TAB":return{...e,activeTab:t.activeTab,nextOffset:0,hasMore:!0,nonFriendsPostIds:[],posts:[]};case"MAIN_POST_LIST_HIDE_POST":return{...e,hiddenPosts:[...e.hiddenPosts,t.hiddenPost]};default:return e}};var rm=n(29266);
/**
 * Mirtesen.
 *
 * Mt Search Reducer.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const om={activeTab:"all",searchValue:"",isLoading:!1,tabs:{all:{title:"Все",url:"/search"},people:{title:"Люди",url:"/search/people"},groups:{title:"Каналы",url:"/search/groups"},posts:{title:"Публикации",url:"/search/posts"}},tabData:{people:{data:[],page:1,hasMore:!0},groups:{data:[],page:1,hasMore:!0},posts:{data:[],page:1,hasMore:!0}}},im=(e=om,t)=>{const n={...e};switch(t.type){case"MT_SEARCH_GET_RESULTS":n.tabData=t.tabData,n.searchValue=t.searchValue;break;case"MT_SEARCH_GET_RESULT":{const e=n.tabData[t.activeTab];n.tabData[t.activeTab]={...e,data:[...e.data,...t.data],page:t.page,hasMore:t.hasMore},n.searchValue=t.searchValue;break}case"MT_SEARCH_SET_TAB":{const e={};Object.keys(n.tabData).forEach((t=>{e[t]={...n.tabData[t],data:[],page:0,hasMore:!1}})),n.tabData=e,n.activeTab=t.activeTab;break}case"MT_SEARCH_SET_SEARCH":{const e={};Object.keys(n.tabData).forEach((t=>{e[t]={...n.tabData[t],data:[],page:0,hasMore:!1}})),n.tabData=e,n.searchValue=t.searchValue;break}case"MT_SEARCH_TOGGLE_LOADING":n.isLoading=!n.isLoading;break;default:return n}return n},lm={},cm={rate:0,currentReaction:null,canVote:!0},mm={reactionsList:[],marksCount:0},dm={initialized:!1,actions:cm,info:mm,inProcess:!1},pm=(e=lm,t)=>{const n={...e},a=n[t.objectId]||dm;switch(t.type){case"VOTE_ACTION_INIT_ACTIONS_STATE":return n[t.objectId]={...dm,...a,initialized:!0,actions:{...dm.actions,...a.actions,...t.state}},n;case"VOTE_ACTION_INIT_INFO_STATE":return n[t.objectId]={...dm,...a,initialized:!0,info:{...dm.info,...a.info,...t.state}},n;case"VOTE_ACTION_TOGGLE_PROCESS":return n[t.objectId]={...dm,...a,inProcess:t.inProcess},n;case"VOTE_ACTION_SET_REACTION":return n[t.objectId]={...dm,...a,actions:{...dm.actions,...a.actions,...t.state}},n;case"VOTE_ACTION_ADD_REACTION":{const{info:e}=a;let s=e.marksCount;const r=e.reactionsList.map((e=>{const n={...e};return t.nextId&&n.id===t.nextId&&(n.count=n.count+1,s+=1),e.id===t.prevId&&(n.count=n.count<1?0:n.count-1,s-=1),n}));return n[t.objectId]={...dm,...a,info:{...dm.info,...a.info,reactionsList:r,marksCount:s}},n}default:return e}},um={csrJwt:null,csrJwtButNoRefresh:null,ssrJwt:null,loaded:!1,postId:null,csrLogin:!1,ssrLogin:!1},gm=(e=um,t)=>{const n={...e};return"TEST_API_INIT_STATE"===t.type?(n.loaded=!0,n.csrJwt=t.fields.csrJwt,n.csrJwtButNoRefresh=t.fields.csrJwtButNoRefresh,n.csrLogin=t.fields.csrLogin,n):n},hm={editKey:null,type:"add",values:{username:null,signature:""}},_m=(e=hm,t)=>{switch(t.type){case"TELEGRAM_EDITOR_CHANGE_VALUE":return{...e,values:{...e.values,[t.key]:t.value}};case"TELEGRAM_EDITOR_INIT_VALUES":return{...e,...t.state};default:return e}},Em={topics:[],tags:[],interests:{},activeTab:"selected",inProcess:!1,search:{isActive:!1,inProcess:!1,results:{topic:[],tag:[]}}},fm=(e=Em,t)=>{const n={...e};switch(t.type){case"USER_INTERESTS_SET_TAB":return n.activeTab=t.tab,n;case"USER_INTERESTS_TOGGLE_PROCESS":return n.inProcess=t.value,n;case"USER_INTERESTS_ADD_INTEREST":{const e={...n.interests[t.interest.type],[t.interest.id]:t.interest.value};return n.interests={...n.interests,[t.interest.type]:e},n}case"USER_INTERESTS_DELETE_INTEREST":return delete n.interests[t.interest.type]?.[t.interest.id],n;case"USER_INTERESTS_TOGGLE_SEARCH":return n.search.isActive=t.isActive,n.search.inProcess=!1,n.search.results={tag:[],topic:[]},n;case"USER_INTERESTS_TOGGLE_SEARCH_PROCESS":return n.search.inProcess=t.value,n;case"USER_INTERESTS_GET_TAG_SEARCH":return n.search.results.tag=t.tag,n;case"USER_INTERESTS_GET_TOPIC_SEARCH":return n.search.results.topic=t.topic,n;case"USER_INTERESTS_RESET_SEARCH":return n.search.inProcess=!1,n.search.results={tag:[],topic:[]},n;case"USER_INTERESTS_ADD_TAG":return-1===n.tags.findIndex((e=>e.id===t.item.id))&&n.tags.push(t.item),n;case"USER_INTERESTS_DELETE_TAG":{const e=n.tags.findIndex((e=>e.id===t.id));return e>-1&&(n.tags=[...n.tags.slice(0,e),...n.tags.slice(e+1)]),n}default:return e}},bm={loadType:null,posts:[],tag:"",tagId:null,ownerId:void 0,hasMore:!0,offset:0,lon:void 0,lat:void 0},ym=(e=bm,t)=>"HASHTAGS_POST_LIST_LOAD_MORE"===t.type?{...e,...t.payload}:e,vm={items:[],initialized:!1,inProcess:!1},Tm={},Sm=(e=Tm,t)=>{const n={...e},a=n[t.objectId]||vm;switch(t.type){case"REASONS_FOR_SHOWING_INIT":return n[t.objectId]={...a,items:t.items,initialized:!0},n;case"REASONS_FOR_SHOWING_TOGGLE_PROCESS":return n[t.objectId]={...a,inProcess:t.value},n;case"REASONS_FOR_SHOWING_DELETE_INTEREST":{const e=a.items.filter((e=>e.attribute_id!==t.interestId));return n[t.objectId]={...a,items:e},n}default:return e}},Pm={searchConfig:void 0,logoConfig:void 0,extraLogoConfig:void 0,sidebarEnabled:!1,sidebarBreakpoint:void 0,sidebarIsOpen:!1},wm=(e=Pm,t)=>{switch(t.type){case"HEADER_SET":return{...Pm,...e,...t.header};case"HEADER_TOGGLE_SIDEBAR":return{...e,sidebarIsOpen:!e.sidebarIsOpen};default:return e}},Im={items:[],startFrom:0,nextFrom:0,hasMoreItems:!0,busy:!1},Cm=(e=Im,t)=>{switch(t.type){case"MESSAGE_NOTIFICATIONS_LIST_LOAD_ITEMS":{const n={...e};return 0===t.startFrom?n.items=t.items:n.items=[...n.items,...t.items],n.nextFrom=t.nextFrom,n.hasMoreItems=t.hasMoreItems,n.busy=!1,n}case"MESSAGE_NOTIFICATIONS_LIST_DEFAULT":return{...e,busy:!0};default:return e}},Nm={items:[],nextFrom:"",hasMoreItems:!0,busy:!1},Om=(e=Nm,t)=>{switch(t.type){case"ACTIVITY_NOTIFICATION_LIST_LOAD_ITEMS":{const n={...e};return""===t.startFrom?n.items=t.items:n.items=[...n.items,...t.items],n.nextFrom=t.nextFrom,n.hasMoreItems=t.hasMoreItems,n.busy=!1,n}case"ACTIVITY_NOTIFICATION_LIST_DEFAULT":return{...e,busy:!0};default:return e}},Mm={value:"",result:{people:[],groups:[],posts:[]},isLoading:!1,hasResults:!1},km=(e=Mm,t)=>{switch(t.type){case"HEADER_SEARCH_SET_RESULT":{const n={...e};return n.result=t.result,n.value=t.value,n.hasResults=Object.keys(t.result).some((e=>t.result[e].length>0)),n}case"HEADER_SEARCH_TOGGLE_LOADING":return{...e,isLoading:!e.isLoading};default:return e}},Am={items:[],nextOffset:0,hasMoreItems:!0,currentUserPostId:null,page:0},xm=(e=Am,t)=>{const n=(0,Ll.I8)(e);return"CHANNEL_MAIN_SET_ITEMS"===t.type?(n.items=[...n?.items,...t.items],n.nextOffset=t.nextOffset,n.hasMoreItems=t.hasMoreItems,n.page=n?.page+1,n):e},Lm={channel:null,post:null},Dm=(e=Lm,t)=>{if("CHANNEL_POST_INIT"===t.type){const n={...e};return n.channel=t.channel,n.post=t.post,n}return e},Rm=(e={},t)=>{if("VIDEO_LIST_LOAD_MORE"===t.type){const n=(0,Ll.I8)(e);return n.items=[...n?.items,...t.items],n.nextOffset=t.nextOffset,n.hasMore=t.hasMore,n}return e},Zm=(e={},t)=>(t.type,e),Bm=(e={},t)=>{const n=(0,Ll.I8)(e);return"VIDEO_RECOMMENDATIONS_LOAD_MORE"===t.type?(n.items=[...n?.items,...t.items],n.nextOffset=t.nextOffset,n.hasMore=t.hasMore,n):e},$m={},Um=(e=$m,t)=>(t.type,e),Hm={},Fm={isInitialized:!1},jm=(e=Hm,t)=>{const n={...e},a=n[t.id]||Fm,s=a.channel||{};switch(t.type){case"CHANNEL_SUBSCRIBE_ACTION_SET_INIT_STATUS":return n[t.id]={...a,isInitialized:t.isInitialized},n;case"CHANNEL_SUBSCRIBE_ACTION_INIT":return n[t.id]={...a,channel:{...s,...t.data}},n;case"CHANNEL_SUBSCRIBE_ACTION_SET_SUBSCTIPTION_STATUS":return n[t.id]={...a,channel:{...s,is_subscribed:t.status}},n;default:return e}};var Gm=n(92327);n(41045);const qm={id:null,title:"",text:"",geo:{status:"auto",tagId:null},channel:null,canSelectChannel:!1,canSubmit:!1},Vm=(e=qm,t)=>{const n={...e};switch(t.type){case"CHANNEL_RICH_POST_EDITOR_SET_CHANNEL":return n.channel=t.channel,n;case"CHANNEL_RICH_POST_EDITOR_SET_TITLE":return n.title=t.title,n;case"CHANNEL_RICH_POST_EDITOR_SET_TEXT":return n.text=t.text,n;case"CHANNEL_RICH_POST_EDITOR_ENABLE_SUBMIT":return n.canSubmit=t.canSubmit,n;case"CHANNEL_RICH_POST_EDITOR_SET_GEO":return n.geo=t.geo,n;default:return e}},zm={isOpen:!1,mode:"add",imageSaved:!1},Wm=(e=zm,t)=>{const n={...e};switch(t.type){case"CHANNEL_COVER_EDITOR_TOGGLE_MODAL":return n.isOpen=t.value,n.mode=t.mode,n.imageSaved=!1,n;case"CHANNEL_COVER_EDITOR_COMPLETE_SAVING":return n.imageSaved=!0,n;default:return e}},Ym={isOpen:!1,messageId:void 0,avatarInfo:void 0},Km=(e=Ym,t)=>{const n={...e};switch(t.type){case"CHANNEL_AVATAR_EDITOR_INIT":return n.messageId=t.messageId,n.avatarInfo=t.avatarInfo,n.isOpen=!0,n;case"CHANNEL_AVATAR_EDITOR_RESET":return console.log(2),n.isOpen=!1,n.avatarInfo=void 0,n.messageId=void 0,n;default:return e}},Jm={channels:[],subscriptions:{items:[],nextOffset:0,hasMore:!0,subscriptionsNum:0}},Xm=(e=Jm,t)=>{const n=(0,Ll.I8)(e);switch(t.type){case"MY_CHANNELS_LOAD_SUBSCRIPTIONS":return n.subscriptions={...n.subscriptions,items:[...n.subscriptions.items,...t.items],hasMore:t.hasMore,nextOffset:t.nextOffset},n;case"MY_CHANNELS_DELETE_SUBSCRIPTION":return n.subscriptions.items=n.subscriptions.items.filter((e=>e.id!==t.channelId)),n.subscriptions.subscriptionsNum=n.subscriptions.subscriptionsNum-1,n;default:return e}},Qm={query:"",activeTab:"posts",isLoading:!1,posts:{results:[],page:0,hasMore:!0},geo:{results:[],page:0,hasMore:!0},channels:{results:[],page:0,hasMore:!0}},ed=(e=Qm,t)=>{const n=(0,Ll.I8)(e);switch(t.type){case"MT_SEARCH_RESULTS_SET_TAB":return n.activeTab=t.activeTab,n;case"MT_SEARCH_RESULTS_LOAD_MORE":return n[t.activeTab]={results:[...n[t.activeTab].results,...t.results],hasMore:t.hasMore,page:t.page},n;default:return e}},td={"very-top-header":{searchActive:!1},"post-popup-very-top-header":{searchActive:!1}},nd=(e=td,t)=>{if("VERY_TOP_HEADER_SET_SEARCH_ACTIVE"===t.type){const n={...e};return e[t.uniqKey].searchActive=t.searchActive,n}return e},ad={isOpen:!1,searchResults:[],geoTags:[],tags:[],customTags:[],searchInProccess:!1,headerTags:[],isReady:!1},sd=(e=ad,t)=>{const n={...e};switch(t.type){case"CHANNEL_TAG_SETTINGS_TOGGLE_MODAL":return n.isOpen=t.value,n;case"CHANNEL_TAG_SETTINGS_TOGGLE_SEARCH_PROCESS":return n.searchInProccess=t.value,n;case"CHANNEL_TAG_SETTINGS_SET_SEARCH_RESULTS":return n.searchResults=t.searchResults,n;case"CHANNEL_TAG_SETTINGS_DELETE_TAG":return n.tags=n.tags.filter((e=>e.id!==t.id)),n.geoTags=n.geoTags.filter((e=>e.id!==t.id)),n.customTags=n.customTags.filter((e=>e.id!==t.id)),n;case"CHANNEL_TAG_SETTINGS_GET_TAGS":return n.tags=t.tags,n.geoTags=t.geoTags,n.customTags=t.customTags,n;case"CHANNEL_TAG_SETTINGS_ADD_TAG":return n[t.updatedTags]?.push(t.addedTag),n;case"CHANNEL_HEADER_TAGS_INIT":return n.headerTags=t.headerTags,n.isInit=!0,n;case"CHANNEL_HEADER_TAGS_REMOVE_HEADER_TAG":case"CHANNEL_HEADER_TAGS_ADD_HEADER_TAG":return n.headerTags=t.headerTags,n;default:return e}},rd={type:null,items:[],offset:0,limit:3,hasMoreItems:!0,page:0,params:{}},od=(e=rd,t)=>{if("POST_FEED_SET_ITEMS"===t.type){const n={...e};return n.items=t.items,n.offset=t.nextOffset,n.hasMoreItems=t.hasMoreItems,n.page=n?.page+1,n.params={...n.params,...t.nextParams||{}},n}return e},id={preferredSource:void 0,currentSource:void 0,title:void 0,inProcess:!0,isInit:!1,osmTag:{osmSid:void 0,title:void 0,description:void 0,lon:void 0,lat:void 0},customTag:{id:void 0,text:void 0,description:void 0,lon:void 0,lat:void 0,osmSid:void 0},ip:{ip:void 0,geoTagTitle:void 0,geoTagId:void 0,osmSid:void 0,lon:void 0,lat:void 0},navigatorGeolocation:{status:!1,accessDenied:!1,navigatorLon:void 0,navigatorLat:void 0,osmSid:void 0,title:void 0,description:void 0,lon:void 0,lat:void 0},post:{currentSource:void 0,osmTag:{osmSid:void 0,title:void 0,description:void 0,lon:void 0,lat:void 0},customTag:{id:void 0,text:void 0,description:void 0,lon:void 0,lat:void 0,osmSid:void 0}}},ld=(e=id,t)=>{switch(t.type){case"GEO_POSITION_INIT":return{...e,...t.initialState,isInit:!0};case"GEO_POSITION_SET_INPROCESS":return{...e,inProcess:t.status};case"GEO_POSITION_SET_CURRENT_SOURCE":return{...e,currentSource:t.source};case"GEO_POSITION_SET_PREFERRED_SOURCE":return{...e,preferredSource:t.source};case"GEO_POSITION_SET_META":return{...e,...t.meta};case"GEO_POSITION_SET_NAVIGATOR_GEOLOCATION":return e.navigatorGeolocation={...t.navigatorGeolocation},e.currentSource=t.currentSource,{...e};case"GEO_POSITION_SET_OSM_TAG":return e.currentSource="osmTag",e.osmTag={...e.osmTag,...t.info},{...e};case"GEO_POSITION_SET_CUSTOM_TAG":return e.currentSource="customTag",e.customTag={...e.customTag,...t.info},{...e};case"GEO_POSITION_SET_BY_IP":return e.currentSource="ip",e.ip={...e.ip,...t.info},{...e};case"GEO_POSITION_INIT_POST":return e.post={...id.post},{...e};case"GEO_POSITION_SET_POST_CURRENT_SOURCE":return e.post={...e.post,currentSource:t.source},{...e};case"GEO_POSITION_SET_POST_CUSTOM_TAG":return e.post.customTag={...e.post.customTag,...t.info},{...e};case"GEO_POSITION_SET_POST_OSM_TAG":return e.post.osmTag={...e.post.osmTag,...t.info},{...e};default:return e}};function cd(e){return void 0===e.locals.initialState?{}:e.locals.initialState}
/**
 * Mirtesen.
 *
 * Auth implementation.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
function md(e){return{app:e.app,auth:e.auth}}class dd{static isLogged(){return b.ZP.isLogged()}static isDeveloper(){return b.ZP.isDeveloper()}static isEditor(){return b.ZP.isEditor()}static getCurrentUser(){return b.ZP.getCurrentUser()}static getCurrentUserId(){return b.ZP.getCurrentUserId()}static canAddPost(){const{app:e,auth:t}=md(re.Z.getStore().getState());return!(!t.user||!e.site.canAddPost)}static canStaff(){return b.ZP.canStaff()}static canAdminBlog(){return b.ZP.canAdminBlog()}static canEditProfile(){const{app:e}=md(re.Z.getStore().getState());return dd.getCurrentUserId()===L()(e,"person.id")}static canModerate(){return b.ZP.canModerate()}static reload(){"undefined"!=typeof window&&window.location.reload()}static applyLoginMiddleware(e,t,n){return b.ZP.isEnabled(e)?b.ZP.applyLoginMiddleware(e,t,n):n()}static getAuth(e,t){const n=b.ZP.isAnonymous(e),a=L()(cd(t),"app.site.id");return Promise.resolve(b.ZP.getAuthInfo(n,a,e,t)).then((async n=>{const a=cd(t);return n?.user&&(n.mirtesenKey=await b.ZP.fetchMirtesenKey(e,t)),t.locals.initialState={...a,auth:{...a.auth,...n}},n})).catch(D.Z.promiseHandler("/index.js"))}}const pd=dd;
/**
 * Mirtesen.
 *
 * Loader.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ud{static shareEvent=(e,t,n,a=1,s=null)=>{const r=[];if(s)r.push(`statmedia${s}`);else for(const e in Object.create(window))e.match(/^statmedia/)&&r.push(e);r.map((s=>{const r=window[s]?.event;"function"==typeof r&&r(e,{post_id:t,post_type:n,v:a})}))};static setCounters=(e,t)=>{if("undefined"==typeof window)return!1;ud.clearCounters(),window.__statmedia_mt_params=t;const n=ud.getStatMediaCounter(e,t);document.body.appendChild(n)};static clearCounters=()=>{if("undefined"==typeof window)return!1;document.getElementById("statmedia-wrap")&&document.getElementById("statmedia-wrap").remove(),window.__statmedia_mt_params=null,window.__statmedia=null};static getStatMediaCounter=(e,t={})=>{if(!e||"undefined"==typeof window)return!1;e=Number(e);const n=document.createElement("script");return n.async=!0,n.id="statmedia-wrap",n.innerHTML=`\n        \x3c!-- StatMedia2 --\x3e\n            (function (w, d, c) {\n                (w[c] = w[c] || []).push(function () {\n                    try {\n                        w.statmedia${e} = new StatMedia({ 'id': ${e}, 'params': ${JSON.stringify(t)} });\n                    } catch (e) {\n                        console.log(e);\n                    }\n                });\n                var p = d.createElement('script');\n                p.id = 'statmedia-script';\n                p.async = true;\n                p.src = 'https://stat.media/sm.js';\n                if (document.getElementById('statmedia-script')) {\n                    document.getElementById('statmedia-script').remove();\n                }\n                d.getElementsByTagName('head')[0].appendChild(p);\n            })(window, document, '__statmedia_callbacks');\n        \x3c!--/ StatMedia2 --\x3e`,n};static prepareParams=e=>{const{scope:t,user:n,channelPostId:a,channelId:s,siteId:r,blogPost:o}=e,i={new_version:!0,src:"v2"};return"channel"===t?(s&&(i.site=s),n?.id&&(i.user_id=n.id),a&&(i.pub_id=a)):(r&&(i.site=r),n?.id&&(i.user_id=n.id,n.bdate&&(i.user_age=y.Z.bdateToAge(n.bdate)),n.sex&&(i.user_sex=n.sex)),o?.id&&(i.owner_id=o?.from.id,i.pub_authors=[i.owner_id],o?.tags&&(i.pub_tags=o?.tags),i.pub_date=o?.formattedDates?.pubTime,i.pub_id=o?.id,i.pub_category=o?.topic)),i}}const gd=ud;
/**
 * Mirtesen.
 *
 * Loader.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class hd{static setCounters=e=>{if("undefined"==typeof window||Sa()(e))return!1;window.mtLiveInternetCounters=[],e.forEach((e=>{window.mtLiveInternetCounters.push(e);const t="licnt"+e,n=document.createElement("img");n.id=t,n.src="https://counter.yadro.ru/hit;"+e+"?t44.6;r"+escape(document.referrer)+("undefined"==typeof screen?"":";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+";h"+escape(document.title.substring(0,150))+";"+Math.random(),n.width="1",n.heigth="1",n.style="position:absolute; left:-9999px;";const a=document.getElementById(t);a?a.replaceWith(n):document.body.appendChild(n)}))};static reloadCounters=()=>{if("undefined"==typeof window)return!1;hd.setCounters(window.mtLiveInternetCounters)}}const _d=hd;const Ed=class{static init(e,t){if(!e.length||"undefined"==typeof window)return;const n="https://www.googletagmanager.com/gtag/js?id="+e[0];w.Z.loadScript(n),this.gtag("js",new Date),e.forEach((e=>{this.gtag("config",e,{send_page_view:!1})})),this.gtag("event","page_view",{page_title:`Page - ${t}`,page_location:t})}static gtag(...e){"undefined"!=typeof window&&(void 0===window.gtag&&(window.dataLayer=window.dataLayer||[],window.gtag=function(...e){window.dataLayer.push(e)}),window.gtag(...e))}};var fd="/index.js";
/**
 * Mirtesen.
 *
 * App Actions.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2017, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const bd=(e,t={})=>{if("undefined"==typeof window)return;const n=t?.target||e?.currentTarget?.getAttribute("target")||"_self";let a=t?.href||e?.currentTarget?.getAttribute("href");return a=Xo.Z.addMirtesenKeyToUrl(a,b.ZP.getMirtesenKey()),setTimeout((()=>{window.open(a,n)})),!1},yd=async e=>(console.log(`--on post appear: ${e} --`),await ti.registerBlockView(e)),vd=async e=>(console.log(`--on post click: ${e} --`),await ti.registerBlockClick(e)),Td=async(e,t)=>(console.log(`--on post view: ${e} --`),await ti.registerSingleView(e,t)),Sd=async(e,t)=>(console.log(`--on post interesting view: ${e} --`),await ti.registerInterestingView(e,t)),Pd=e=>({type:"APP_UPDATE_CHANNEL_COVER",coverInfo:e}),wd=e=>async t=>{try{if(!e.id)throw new Error("channel not found!");await At.ZP.editChannel(e)?(t({type:"APP_UPDATE_CHANNEL_AVATAR",avatarInfo:e.avatarInfo}),kt.Z.sendMessage({type:"MT_APP_CHANNEL_AVATAR_SAVED"})):kt.Z.sendSystemMessage("exception")}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler(fd)(e)}},Id=e=>({type:"APP_SHOW_CHANNEL_POST_POPUP",postId:e}),Cd={listTopics:[{key:"cooking",text:"Кулинария",theme:!0},{key:"family",text:"Дети и семья",theme:!0},{key:"show",text:"Шоу-бизнес",theme:!0},{key:"politics",text:"Политика",theme:!0},{key:"health",text:"Здоровье",theme:!0},{key:"IT",text:"IT",theme:!0},{key:"auto",text:"Авто-мото",theme:!0},{key:"finance",text:"Бизнес и финансы",theme:!0},{key:"animals",text:"В мире животных",theme:!0},{key:"military",text:"Военное дело",theme:!0},{key:"home",text:"Дом/Дача",theme:!0},{key:"entertainment",text:"Игры",theme:!0},{key:"history",text:"История",theme:!0},{key:"cinema",text:"Кино",theme:!0},{key:"beauty",text:"Красота",theme:!0},{key:"culture",text:"Культура",theme:!0},{key:"realty",text:"Недвижимость",theme:!0},{key:"society",text:"Общество",theme:!0},{key:"fishing",text:"Охота и рыбалка",theme:!0},{key:"technology",text:"Прогресс",theme:!0},{key:"career",text:"Работа",theme:!0},{key:"humor",text:"Развлечения",theme:!0},{key:"ad",text:"Реклама",theme:!0},{key:"religion",text:"Религия",theme:!0},{key:"sport",text:"Спорт",theme:!0},{key:"tourism",text:"Туризм",theme:!0},{key:"photo",text:"Фото",theme:!0},{key:"all",text:"Разное",theme:!1}]};
/**
 * Mirtesen.
 *
 * Layout EmptyLayout.
 *
 * @author       Alexey Savchik.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Nd extends r.Component{render(){const{app:e,page:t}=this.props,n=t;return r.createElement(n,{app:e})}}Nd.propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};const Od=(0,ae.Z)(Nd,"emptyLayout");function Md(){const[e,t]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const e=()=>{const e=window.visualViewport?window.visualViewport.width:Math.max(document.documentElement.clientWidth,window.innerWidth||0);t(e)},n=u()(e,80);return e(),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}}),[]),e}
/**
 * Mirtesen.
 *
 * HeaderToggleSidebar Component.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const kd=({isOpen:e,toggle:t,sidebarBreakpoint:n})=>Md()>n?null:r.createElement("div",{className:_()({"header__toggle-sidebar":!0,on:e}),onClick:e=>{e.preventDefault(),t()}},r.createElement("span",null)),Ad=(0,r.memo)(kd),xd=({extraClasses:e="",title:t,url:n})=>r.createElement("a",{className:_()("header-logo__image",e),href:n,title:null===t?"":t}),Ld=(0,r.memo)(xd),Dd=({config:e,extraLogoConfig:t,mainDomain:n,badge:a})=>{let s=null,o="//"+n+"/",i="";const l=o;let c="0";return a&&(c=a>999?"999+":a.toString()),e&&(e.hasOwnProperty("title")&&(s=e.title),e.hasOwnProperty("url")&&(o=e.url),e.hasOwnProperty("extraClasses")&&(i=e.extraClasses)),r.createElement("div",{className:"header-logo",id:"header-logo-tooltip"},r.createElement("div",{className:"header-logo__item"},r.createElement(Ld,{title:s,url:o,extraClasses:i})),t&&r.createElement("div",{className:"header-logo__item"},r.createElement(Ld,{title:t.title,url:t.url,extraClasses:_()("header-logo__image_extra",t.extraClasses)})),a>0&&r.createElement("a",{href:l,title:"Новые публикации в вашей ленте",className:"header-logo__notifications"},c))},Rd=(0,r.memo)(Dd),Zd=({openAuthForm:e})=>r.createElement("div",{className:"header-login"},r.createElement("ul",null,r.createElement("li",null,r.createElement(He.Z,{type:"button",label:"Регистрация",color:"primary",onClick:()=>{na.ym("reachGoal","registration_topline_click"),e("registration")}})),r.createElement("li",null,r.createElement(He.Z,{type:"button",color:"secondary",label:"Вход",onClick:()=>e("login")})))),Bd=(0,r.memo)(Zd),$d=({user:e,userBalance:t,mainDomain:n,onLogoutClick:a})=>r.createElement("div",{className:"header-tab header-tab-profile"},r.createElement(G.Z,{customButtonClasses:"header-profile__btn",customDropdownClasses:"header-profile",customListClasses:"header-profile__dropdown",customTooltipClasses:"header-profile__tooltip",placement:"bottom-left",id:"header-profile-tooltip",buttonValue:r.createElement(r.Fragment,null,r.createElement("span",{className:"link-photo"},r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo_original}})),r.createElement("i",{className:"angle-down"})),offset:[0,1],delay:0},(({user:e,mainDomain:t,userBalance:n,onLogoutClick:a})=>[{key:"me",href:e.url,title:"Моя страница",hasDivider:!0},{key:"post",href:e.url+"?addPost=true",title:"Создать пост"},{key:"polls",href:"//"+t+"/polls",title:"Опросы"},{key:"sites",href:"//"+t+"/rating/my-sites",title:"Мои сайты"},{key:"subscriptions",href:"//"+t+"/rating/my-subscriptions",title:"Мои подписки"},{key:"create",href:"//"+t+"/create",title:"Создать сайт"},{key:"friends",href:"//"+t+"/people/"+e.id+"/friends",title:"Мои друзья"},{key:"app-page",href:"//info.mirtesen.ru/apps",title:"Мессенджер МТ"},{key:"glagol",href:"//glagol.press",title:"Глагол",hasDivider:!0,rel:"nofollow",target:"_blank"},{key:"merge",href:"//"+t+"/account-consolidation/",title:"Объединение аккаунтов",hasDivider:!0},{key:"balance",href:"//"+t+"/billing/history",title:`Мой баланс: ${n||""} кр.`},{key:"settings",href:"//"+t+"/settings/personal",title:"Настройки"},{key:"exit",href:"#logout",title:"Выход",handleClick:e=>{e.preventDefault(),a()}}])({user:e,mainDomain:n,userBalance:t,onLogoutClick:a}).map((e=>r.createElement("a",{key:e.key,className:_()("header-profile__item",`header-profile__item_${e.key}`,e.hasDivider&&"header-profile__item_divider"),href:e.href,rel:e.rel,onClick:e.handleClick,target:e.target||"_self"},e.title))))),Ud=(0,r.memo)($d);class Hd{constructor(e,t){this._namespace=t,this._rooms={},this._roomsQueue={},this._roomsQueueHandle=void 0,this._listeners={},this._getSocket=new Promise((t=>{b.ZP.getJwtAccessToken().then((n=>{const a={};null!==n&&(a.token=n),this._sock=(0,$.ZP)(e,{transports:["websocket"],auth:a}),this._sock.on("connect",(()=>{const e=Object.keys(this._rooms);this._roomsJoin(e)})),this._sock.on("message",(e=>{const{type:n,room:a,data:s}=e;if("cmt"===n&&void 0!==this._rooms[a])for(let e=0;e<this._rooms[a].length;e++){(0,this._rooms[a][e])(s)}"start"===n&&t(this._sock)}));for(const e in this._listeners)if(this._listeners.hasOwnProperty(e)){const t=this._listeners[e];for(let n=0;n<t.length;n++)this._sock.on(e,t[n])}this._listeners={}}))}))}_getRoomKey(e){let t=e;return this._namespace&&(t=this._namespace+"_"+t),t}_roomsJoin(e){if(void 0!==this._sock&&this._sock.connected&&0!==e.length){this._sock.emit("message",{type:"join",rooms:e});for(let t=0;t<e.length;t++)delete this._roomsQueue[e[t]]}}_roomsLeave(e){if(void 0!==this._sock&&this._sock.connected&&0!==e.length){this._sock.emit("message",{type:"leave",rooms:e});for(let t=0;t<e.length;t++)delete this._roomsQueue[e[t]]}}_roomsQueueProcess(){const e=[],t=[],n=this._roomsQueue;for(const a in n)if(n.hasOwnProperty(a)){n[a]?e.push(a):t.push(a)}this._roomsJoin(e),this._roomsLeave(t)}_roomsQueuePush(e,t){this._roomsQueue[e]=t,void 0!==this._roomsQueueHandle&&(clearTimeout(this._roomsQueueHandle),this._roomsQueueHandle=void 0),this._roomsQueueHandle=setTimeout((()=>{this._roomsQueueProcess()}),500)}_roomsPush(e,t){void 0===this._rooms[e]&&(this._rooms[e]=[]),-1===this._rooms[e].indexOf(t)&&(this._rooms[e].push(t),this._roomsQueuePush(e,!0))}_roomsRemove(e,t){if(void 0!==this._rooms[e]){if(void 0!==t){const n=this._rooms[e].indexOf(t);-1!==n&&this._rooms[e].splice(n,1)}void 0!==t&&0!==this._rooms[e].length||(delete this._rooms[e],this._roomsQueuePush(e,!1))}}isConnected(){return void 0!==this._sock&&this._sock.connected}subscribe(e,t){return this._roomsPush(this._getRoomKey(e),t),this}unsubscribe(e,t){return this._roomsRemove(this._getRoomKey(e),t),this}emit(e,t,n){this._getSocket.then((a=>a.emit(e,t,n)))}on(e,t){void 0!==this._sock?this._sock.on(e,t):(void 0===this._listeners[e]&&(this._listeners[e]=[]),-1===this._listeners[e].indexOf(t)&&this._listeners[e].push(t))}off(e,t){if(void 0!==this._sock)this._sock.off(e,t);else if(void 0!==this._listeners[e]){if(void 0!==t){const n=this._listeners[e].indexOf(t);-1!==n&&this._listeners[e].splice(n,1)}void 0!==t&&0!==this._listeners[e].length||delete this._listeners[e]}}}class Fd{static init(){const{url:e,namespace:t}=(()=>{const e=re.Z.getConfig();if(!e||!e.comet)throw new Error("Comet: not configured");return e.comet})(),n=e+"-"+t;return window.mtCometClients=window.mtCometClients||{},window.mtCometClients[n]||(window.mtCometClients[n]=new Hd(e,t)),window.mtCometClients[n]}static isConnected(){return Fd.init().isConnected()}static subscribe(e,t){return Fd.init().subscribe(e,t)}static unsubscribe(e,t){return Fd.init().unsubscribe(e,t)}static emit(e,t,n){return Fd.init().emit(e,t,n)}static on(e,t){return Fd.init().on(e,t)}static off(e,t){return Fd.init().off(e,t)}}const jd=Fd;var Gd="/index.js";const qd=class{static getPostCommentPreview(e,t=1){const n=`query {\n            discussedResourceCommentsAsMessages(ids: ${this.getChatQuery([{chatType:"mt",chatId:e}])}, count: ${t}) {\n                messages {\n                    id\n                    text\n                    from_id\n                    attachments {\n                        type\n                        url\n                    }\n                }   \n                users {\n                    id\n                    display_name\n                    photo_small\n                }\n            }\n        }`,a={project:"comments",body:JSON.stringify({query:n})};return(0,yt.Z)({...a}).then((e=>e?.data?.discussedResourceCommentsAsMessages)).catch((e=>{D.Z.promiseHandler(Gd)(e)}))}static fetchMessageCount(e){const t=`query {\n            discussedResourceCommentsAsMessages(ids: ${this.getChatQuery(e)}) {\n                externals {\n                    id\n                    totalCount\n                }\n            }\n        }`,n={project:"comments",body:JSON.stringify({query:t})};return(0,yt.Z)({...n}).then((e=>e?.data?.discussedResourceCommentsAsMessages?.externals)).catch((e=>{D.Z.promiseHandler(Gd)(e)}))}static getChatQuery(e){return`[${e.map((({chatId:e,chatType:t})=>`"${t}:${e}"`))}]`}static getHeaderMessages=()=>new Promise((e=>{jd.emit("message",{type:"getHeaderMessages"},(t=>e(t)))}));static getUnread=e=>{const t=()=>jd.emit("message",{type:"getHeaderUnread"},e),n=t=>{"unread"===t.type&&e(t.data)};return jd.isConnected()&&t(),jd.on("connect",t),jd.on("message",n),()=>{jd.off("connect",t),jd.off("message",n)}}},Vd=()=>e=>{qd.getHeaderMessages().then((t=>e({type:"MESSAGE_NOTIFICATIONS_LIST_LOAD_ITEMS",items:t,startFrom:0,nextFrom:0,hasMoreItems:!1}))).catch((e=>{console.log(e)})),e({type:"MESSAGE_NOTIFICATIONS_LIST_DEFAULT"})};const zd=e=>{const t=(0,r.useRef)(e),n=(0,r.useRef)();return(0,r.useEffect)((()=>{t.current=e}),[e]),(0,r.useEffect)((()=>()=>clearTimeout(n.current)),[]),e=>{n.current&&clearTimeout(n.current),n.current=setTimeout((()=>{t.current(),n.current=void 0}),e)}},Wd=({id:e,value:t})=>{const[n,a]=(0,r.useState)(!1),s=(0,r.useRef)(void 0),o=zd((()=>{a(!1)}));return(0,r.useEffect)((()=>{void 0===s.current&&(s.current=t),s.current!==t&&(a(!0),o(3e3),s.current=t)}),[t]),r.createElement("span",{className:_()("badge","badge-secondary",n&&"header-badge-flash"),id:e},r.createElement("div",{className:"btn-header-tab__icon"},t&&r.createElement("span",{className:"btn-header-tab__text"},t?K.Z.format99Plus(t):"")))},Yd=(0,r.memo)(Wd),Kd=({item:e,dateFormat:t})=>{const n=(0,r.useRef)(null),[a,s]=(0,r.useState)(!1);let o="";switch(e.event){case"new_fame_action":o=e.fame_action;break;case"new_like":o=e.action;break;default:o=e.event}return r.createElement(r.Fragment,null,r.createElement("a",{className:"activity-item notification",href:e.parent_url,target:"blank",onClick:()=>s(!0)},r.createElement("div",{className:"activity-item__avatar",onClick:e=>{e.stopPropagation(),n.current.click()}},r.createElement(Mn.Z,{logoInfo:{userName:e.from.display_name,logoImg:e.from.photo_original,size:"bp"}}),e.event&&r.createElement("i",{style:{backgroundImage:`url(https://mirtesen.ru/images/emoji/${o}.svg)`},className:"emoji",title:e.action})),r.createElement("div",{className:"activity-item__desc"},r.createElement("div",{className:"activity-item__message"},r.createElement("i",{className:"activity-item__author",onClick:e=>{e.stopPropagation(),n.current.click()}},e.from.display_name),` ${e.text||""}`,e.parent_title?r.createElement("i",null,` «${e.parent_title}»`):"",` ${e.suffix||""}`),r.createElement("div",{className:"activity-item__info"},r.createElement("i",{className:"activity-item__time"},K.Z.getLocalDate(e.date,t)),e.is_new&&!a&&r.createElement("i",{className:"activity-item__status"})))),r.createElement("a",{href:e.from.url,target:"_blank",ref:n}))};Kd.propTypes={item:f().object,dateFormat:f().string};const Jd=(0,r.memo)(Kd),Xd=({item:e,mainDomain:t})=>{const n=`//${t}/messages/${"group"===e.type?"?group=":""}${e.id}`;return r.createElement("div",{className:"tab-item"},r.createElement(Mn.Z,{logoInfo:{userName:e.name?e.name:e.id,logoImg:e.avatar,logoUrl:"#",logoClassName:"tab-item__avatar"}}),r.createElement("a",{href:n,className:"tab-item__info",onClick:e=>{e.preventDefault(),Xo.Z.replaceLocationWithMirtesenKey(e)}},r.createElement("div",{className:"tab-item__name"},e.name?e.name:e.id),r.createElement("div",{className:"tab-item__text",dangerouslySetInnerHTML:{__html:y.Z.truncateString(e.text,50)}})))},Qd=(0,r.memo)(Xd),ep=({items:e,type:t,mainDomain:n})=>r.createElement("div",{className:"header-tab__list"},e.map((e=>"messages"===t?r.createElement(Qd,{key:e.id,item:e,mainDomain:n}):r.createElement(Jd,{key:e.id,item:e,dateFormat:y.Z.isToday((1e3*e.date).toString())?"HH:mm":"D MMMM, HH:mm"})))),tp=(0,r.memo)(ep),np=({items:e,badge:t,busy:n,linkText:a,reload:s,toggle:o,id:i,url:l,type:c,mainDomain:m})=>r.createElement(G.Z,{customButtonClasses:"btn btn-header-tab",customDropdownClasses:`header-tab header-tab-${c}`,customListClasses:"header-tab__dropdown",customTooltipClasses:"header-tab__tooltip",placement:"bottom-left",buttonValue:r.createElement(Yd,{value:t,id:i}),offset:[0,0],onShow:()=>{s(),o()},onClose:o},r.createElement(r.Fragment,null,r.createElement("div",{className:"header-tab__header"},r.createElement("a",{className:"header-tab__link",href:l},a)),r.createElement("div",{className:"header-tab__body"},r.createElement(tp,{items:e,busy:n,type:c,mainDomain:m})))),ap=(0,r.memo)(np),sp=(0,r.memo)((({badge:e})=>{const[t,n]=(0,r.useState)(!1),a=(0,aa.T)(),s=(0,aa.C)((e=>e.messageNotifications?.items||[])),o=(0,aa.C)((e=>e.messageNotifications?.busy)),{mainDomain:i}=re.Z.getConfig();return r.createElement(r.Fragment,null,r.createElement(ap,{badge:e,reload:()=>{a(Vd())},items:s,busy:o,toggle:()=>n((e=>!e)),url:"//"+i+"/messages",linkText:"Чаты",id:"header-messages-tooltip",type:"messages",mainDomain:i}),!t&&r.createElement(lt,{placement:"bottom",target:"header-messages-tooltip",id:"header-messages",content:"Мессенджер МирТесен"}))})),rp=sp;var op="/index.js";
/**
 * Mirtesen.
 *
 * API interface for Notifications.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const ip=class{static getNotifications=async(e=5,t="",n={})=>{try{return await R.Z.request({query:`query {\n                    notifications(\n                        count: ${e}\n                        start_from: "${t}"\n                        domain: ${n.domain?'"'+n.domain+'"':null}\n                    ) {\n                        items {\n                            id\n                            event\n                            fame_action\n                            action\n                            is_new\n                            from_id\n                            date\n                            text\n                            parent_id\n                            parent_title\n                            parent_url\n                            event\n                            fame_action\n                            action\n                            is_new\n                            from {\n                                display_name\n                                photo_original\n                                url\n                            }\n                            feedback_id\n                            feedback_text\n                            suffix\n                        }\n                        next_from\n                    }\n                }`,endpoint:{endpoint:"main",ver:"v1"},req:n.req,res:n.res})||{}}catch(e){D.Z.promiseHandler(op)(e)}};static markNotificationAsRead=async(e,t,n={})=>{try{const a=await R.Z.request({query:`mutation {\n                    markNotificationAsRead(activityIds: ${e} boundObjId: ${t})\n                }`,endpoint:{endpoint:"main",ver:"v1"},req:n.req,res:n.res});if(a)return a;throw new Error("Failed mark notifications as read")}catch(e){if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(op)(e)}};static resetUnreadPostCount=async(e={})=>{try{const t=await R.Z.request({query:"mutation {\n                    resetBlogPostNotificationsCounter\n                }",endpoint:{endpoint:"main",ver:"v1"},req:e.req,res:e.res});if(t)return t;throw new Error("Failed reset blog post notifications")}catch(e){if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(op)(e)}};static resetUnreadActivityCount=async(e={})=>{try{return await R.Z.request({query:"mutation {\n                  resetNotificationsCounter\n                }",endpoint:{endpoint:"main",ver:"v1"},req:e.req,res:e.res})}catch(e){D.Z.promiseHandler(op)(e)}};static getUnreadNotificationCount=async(e={})=>{try{const{req:t,res:n}=e,a="query {\n              getAuthInfo {\n                blogPostNotifications\n                newNotifies\n              }\n            }";return R.Z.request(a,null,{endpoint:"user"},t,n)}catch(e){D.Z.promiseHandler(op)(e)}}},lp=(e,t="",n=null)=>a=>(""===t&&(a({type:"HEADER_SET_UNREAD_ACTIVITY_COUNT",value:0}),kt.Z.sendMessage({type:"MT_APP_RESET_ACTIVITIES_COUNTER"})),ip.getNotifications(e,t,{domain:n}).then((e=>a({type:"ACTIVITY_NOTIFICATION_LIST_LOAD_ITEMS",items:e.items,startFrom:t,nextFrom:e.next_from,hasMoreItems:!(!e.next_from||!e.items.length)}))).catch((e=>{console.log(e)})),a({type:"ACTIVITY_NOTIFICATION_LIST_DEFAULT"})),cp=({badge:e})=>{const[t,n]=(0,r.useState)(!1),a=(0,aa.C)((e=>e.activityNotifications?.items||[])),s=(0,aa.C)((e=>e.activityNotifications?.busy)),o=(0,aa.T)(),{mainDomain:i}=re.Z.getConfig();return r.createElement(r.Fragment,null,r.createElement(ap,{badge:e,reload:()=>{o(lp(50))},items:a,busy:s,linkText:"Уведомления",toggle:()=>n((e=>!e)),id:"header-activities-tooltip",url:"//"+i+"/activities/feedback",type:"activities",mainDomain:i}),!t&&r.createElement(lt,{placement:"bottom",target:"header-activities-tooltip",content:"Уведомления",offset:[0,0]}))},mp=(0,r.memo)(cp),dp=({action:e,onFocus:t,onChange:n,isOpen:a})=>{const s=(0,r.useRef)(null),[o,i]=(0,r.useState)(""),l=zd((()=>{n(o)}));return(0,r.useEffect)((()=>{a?s?.current?.focus():s?.current?.blur()}),[a]),r.createElement("form",{method:"GET",action:e},r.createElement("input",{ref:s,type:"text",placeholder:"Поиск",spellCheck:"false",name:"q",autoComplete:"off",onChange:e=>{i(e.target.value),l(400)},onFocus:()=>{a||"function"!=typeof t||t()}}))},pp=(0,r.memo)(dp),up=({url:e,userName:t,logoImg:n,title:a})=>r.createElement("a",{className:"header-search-results__item",href:e},r.createElement(Mn.Z,{logoInfo:{userName:t,logoImg:n}}),r.createElement("h4",null,a)),gp=(0,r.memo)(up),hp=({results:e,link:t,category:n})=>r.createElement("div",{className:"header-search-results"},r.createElement("div",{className:"header-search-results__title"},r.createElement("span",null,{headerSearchPeopleTitle:"Люди",headerSearchGroupsTitle:"Сайты",headerSearchPostsTitle:"Публикации"}[`headerSearch${n[0]?.toUpperCase()+n.slice(1)}Title`]),t&&r.createElement("a",{className:"header-search-results__info",href:t},"показать все")),r.createElement(r.Fragment,null,r.createElement("ul",{className:"header-search-results__list"},e.map((e=>{const t="posts"===n?{url:Xo.Z.addMirtesenKeyToUrl(e.url,b.ZP.getMirtesenKey()),userName:e.group.display_name||e.group.name,logoImg:e.group.photo_original,title:y.Z.truncateString(y.Z.stripTags(e.title||e.preview_text),25)}:{url:Xo.Z.addMirtesenKeyToUrl(e.url,b.ZP.getMirtesenKey()),userName:e.display_name,logoImg:e.photo_original,title:e.display_name};return r.createElement("li",{key:e.id.toString()},r.createElement(gp,t))}))))),_p=(0,r.memo)(hp),Ep=(e,t)=>{(0,r.useEffect)((()=>{const n=e?.current;if(!n)return;const a=e=>{const a=e.path||e.composedPath&&e.composedPath();if(n&&!a.includes(n))return t(e)};return window.addEventListener("click",a),()=>{window.removeEventListener("click",a)}}),[e,t])};var fp=n(47955),bp="/index.js";
/**
 * Mirtesen.
 *
 * API interface for PostLists.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class yp{static getPopularBlogPosts=async({type:e,limit:t=20,offset:n=0,topics:a=null,params:s={}})=>{try{const r=fs.Z._getRequestFields(s),o=await R.Z.request({query:`query\n                {\n                  getPopularBlogPosts(\n                    type:${e},\n                    topics:${a},\n                    limit:${t}, \n                    offset:${n}\n                  ) {\n                    items {\n                      ${r}\n                    }\n                  }\n                }`,endpoint:{endpoint:"main",ver:"v1"},res:s.res,req:s.req});return Js._normalizeList(o?.items||[])}catch(e){if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(bp)(e)}};static getBloggerPosts=async({limit:e=20,offset:t=0,params:n={}})=>{try{const a=fs.Z._getRequestFields(n),s=await R.Z.request({query:`query\n                {\n                  getBloggersPosts(\n                    limit:${e}, \n                    offset:${t}\n                  ) {\n                    items {\n                      ${a}\n                    }\n                  }\n                }`,endpoint:{endpoint:"blogs",ver:"v1"},res:n.res,req:n.req});return Js._normalizeList(s?.items||[])}catch(e){if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(bp)(e)}};static getCompositionPosts=async(e,t={})=>{try{const n=fs.Z._getRequestFields(t),a=await R.Z.request({query:`query {\n                    getCompositionPosts(id:${e}){\n                        composition {\n                            id\n                            title\n                            desc\n                        }\n                        posts {\n                            items {\n                                ${n}\n                            }\n                        }\n                    }\n                }`,endpoint:{endpoint:"blogs",ver:"v1"},res:t.res,req:t.req});return a?yp._normalizeCompositionPosts(a):null}catch(e){if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(bp)(e)}};static getPublicChats=async({limit:e=20,offset:t=0,params:n={}})=>{try{const a=await R.Z.request({query:`query {\n                    getPublicRooms (offset: ${t} limit: ${e} ) {\n                      rooms {\n                        id\n                        name\n                        date\n                        author\n                        avatar\n                        inviteUrl\n                        message\n                        usersCount\n                      }\n                      dicts {\n                        messages {\n                          id\n                          text\n                          from\n                          date\n                        }\n                        users{\n                          id\n                          name\n                          avatar\n                        }\n                      }\n                    }\n                  }`,endpoint:{host:"socket2.mirtesen.ru",path:"api",endpoint:""},res:n.res,req:n.req});return yp._normalizeChats(a||{})}catch(e){if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(bp)(e)}};static _normalizeChats=e=>{const t={...e},{rooms:n=[],dicts:a={}}=t,{messages:s=[],users:r=[]}=a,o={},i={};return s.forEach((e=>{o[e.id]=e})),r.forEach((e=>{i[e.id]=e})),n.map((e=>{const t=o[e?.message]||null,n=i[t?.from]||null;return{...e,lastMessage:t,lastMessageAuthor:n,post_type:"chat"}}))};static _normalizeCompositionPosts=e=>{const t=Js._normalizeList(e?.posts?.items||[]);return{...e,posts:{items:t}}}}const vp=yp;
/**
 * Mirtesen.
 *
 * Header Search Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Tp={people:{count:2,offset:0},groups:{count:2,offset:0},posts:{count:2,offset:0},ratedGroups:{page:1,limit:2,period:"PERIOD_MONTH",orderBy:"ORDER_BY_UNIQUE_VISITORS"},popularPosts:{type:"LIKED",limit:2,offset:0,params:{fieldList:"tile"}}},Sp=e=>async t=>{t(Pp);try{const n=[];e?(n.push(fp.Z.search(e,"ALL_PEOPLE",Tp.people)),n.push(fp.Z.search(e,"ALL_SITES",Tp.groups)),n.push(fp.Z.search(e,"ALL_POSTS",Tp.posts))):(n.push(Promise.resolve([])),n.push(Xo.Z.getRatedGroups(Tp.ratedGroups)),n.push(vp.getPopularBlogPosts(Tp.popularPosts)));const[a,s,r]=await Promise.all(n);return t(Pp),t({type:"HEADER_SEARCH_SET_RESULT",result:{people:a||[],groups:Array.isArray(s)?s:s?.items||[],posts:r||[]},value:e})}catch(e){t(Pp),D.Z.promiseHandler("/index.js")(e)}},Pp={type:"HEADER_SEARCH_TOGGLE_LOADING"},wp=({isOpen:e,close:t,config:n,open:a})=>{const s=(0,aa.C)((e=>e.headerSearch)),{result:o,value:i,isLoading:l,hasResults:c}=s,m=(0,aa.T)(),d=(0,r.useRef)(null),p=(0,r.useRef)(null),g=(0,r.useRef)(0),h=(0,r.useRef)(600),{mainDomain:E}=re.Z.getConfig(),f={people:"//"+E+"/search/people",groups:"//"+E+"/search/groups",posts:"//"+E+"/search/posts"},b={"header-search":!0,"header-search_active":e},y={"header-search__list":!0,"header-search__list_active":e},v=u()((()=>{g.current!==window.innerWidth&&t(),h.current=window.innerWidth<=840?0:600,g.current=window.innerWidth}),80),T=()=>{a(),m(Sp(i.trim()))};return Ep(p,t),(0,kr.O)("scroll",t),(0,kr.O)("resize",v),r.createElement("div",{className:_()(b),ref:p},r.createElement("i",{className:"btn header-search__close",onClick:t}),r.createElement("div",{className:"header-search__btn",ref:d},r.createElement("i",{className:"btn header-search__icon",onClick:T}),r.createElement(pp,{action:"//"+E+"/search",isOpen:e,onChange:e=>{m(Sp(e.trim()))},onFocus:T})),e&&r.createElement(oa.Z,{target:d.current,offset:[0,4],placement:"bottom-right",enableMobile:!1,className:"header-search__popup",delay:h.current},r.createElement("div",{className:_()(y)},!l&&Object.entries(n?.categories||f).map((([e,t])=>o[e]?.length?r.createElement(_p,{key:e,results:o[e],link:`${t}${i?"?q="+encodeURIComponent(i):""}`,category:e}):null)),l&&r.createElement(Yn,null),!c&&!l&&r.createElement("p",{className:"header-search__empty"},"Ничего не найдено"))))},Ip=(0,r.memo)(wp);function Cp(){const[e,t]=(0,r.useState)(0);return(0,r.useEffect)((()=>{(async()=>{const e=await ip.getUnreadNotificationCount();t(e?.newNotifies||0)})()}),[]),(0,kr.O)("message",(async e=>{const{type:n}=e.data;"MT_APP_RESET_ACTIVITIES_COUNTER"===n&&(await ip.resetUnreadActivityCount(),t(0))})),{activitiesCounter:e,changeActivitiesCount:e=>{t(e)}}}function Np(){const[e,t]=(0,r.useState)(0);return(0,r.useEffect)((()=>{qd.getUnread((e=>t(e?.total||0)))}),[]),{messagesCounter:e,changeMessagesCount:e=>{t(e)}}}var Op=n(94337);function Mp(e,t,n){const a=(0,r.useRef)(null),s=(0,r.useRef)(n);(0,r.useEffect)((()=>{const n=t;return e&&a.current!==n&&(a.current&&jd.unsubscribe(a.current,s.current),n&&(jd.subscribe(n,s.current),a.current=n)),()=>{e&&a.current&&jd.unsubscribe(a.current,s.current)}}),[t,e])}
/**
 * Mirtesen.
 *
 * Header content Container.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const kp=()=>{const e=(0,Op.E)(),[t,n]=(0,r.useState)(!1),{activitiesCounter:a,changeActivitiesCount:s}=Cp(),{blogPostCounter:o,changeBlogPostCount:i}=function(){const[e,t]=(0,r.useState)(0);return(0,r.useEffect)((()=>{(async()=>{const e=await ip.getUnreadNotificationCount();t(e?.blogPostNotifications||0)})()}),[]),{blogPostCounter:e,changeBlogPostCount:e=>{t(e)}}}(),{messagesCounter:l,changeMessagesCount:c}=Np(),{mainDomain:m}=re.Z.getConfig(),d=(0,aa.T)(),p=(0,aa.C)((e=>e.auth||{})),u=(0,aa.C)((e=>e.header||{})),{user:g}=p,h=g?.userBalance,{sidebarEnabled:E,sidebarIsOpen:f,sidebarBreakpoint:y,searchConfig:v,logoConfig:T,extraLogoConfig:S}=u,P=void 0!==g,w=b.ZP.isLogged();return Mp(e,g?.id?"navigation_update_"+g.id:null,(e=>{if("object"==typeof e&&"number"==typeof e.count)switch(e.event){case"bpn":i(e.count);break;case"message":c(e.count);break;case"comment":s(e.count)}})),e?r.createElement("div",{className:"header-container"},r.createElement("div",{className:"header"},r.createElement("div",{className:_()({header__navigation:!0,anon:!w})},E&&r.createElement(Ad,{isOpen:f,toggle:()=>{d((e=>e({type:"HEADER_TOGGLE_SIDEBAR"})))},sidebarBreakpoint:y}),r.createElement(Rd,{config:T,extraLogoConfig:S,badge:o,mainDomain:m}),r.createElement(lt,{placement:"bottom",target:"header-logo-tooltip",content:"Лента новостей"}),P&&w&&r.createElement(Ud,{user:g,userBalance:h,onLogoutClick:()=>{d(se())},mainDomain:m}),P&&w&&r.createElement(rp,{badge:l}),P&&w&&r.createElement(mp,{badge:a}),r.createElement("div",{className:"header-search-w"},P&&r.createElement(Ip,{user:g,config:v,isOpen:t,open:()=>{n(!0)},close:()=>{n(!1)}})),P&&!w&&r.createElement(Bd,{openAuthForm:(e,t)=>{d(_e(e,t))}})))):r.createElement("div",{className:"header-container"},r.createElement("div",{className:"header"},r.createElement("div",{className:"header__navigation"})))},Ap=(0,r.memo)(kp);var xp=n(84564),Lp=n.n(xp),Dp=n(35009),Rp=n.n(Dp);
/**
 * Mirtesen.
 *
 * Default Config for App Constructor.
 * Needs for sites that don't have the config in the DB.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Zp={rev:"1.01",head:{meta:['<meta http-equiv="X-UA-Compatible" content="IE=edge"/>','<meta name="yandex_direct" content="1"/>','<meta name="yandex-verification" content=""/>']},layout:{props:{},style:{},elements:{}},header:{props:{},style:{},elements:{}},footer:{props:{},style:{},elements:{}},veryLeftColumn:{props:{},style:{},elements:{}},veryRightColumn:{props:{},style:{},elements:{}},mainLogo:{props:{image:null},style:{}},mainHeader:{props:{title:null,slogan:null},style:{}},mainMenu:{items:[{url:"/",title:"Главная",active:!0}]},mainContent:{props:{},style:{},elements:{}},mainDomain:"mirtesen.ru",yaMetricsGlobal:{ver:2,params:{id:54481189,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!1},userParams:{interests:"cooking"}},smi2:{blockId:82631,siteId:null}};var Bp="/index.js";
/**
 * Mirtesen.
 *
 * API interface for SiteBuilder.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class $p{static getConfig=e=>$p.getServerConfig(e).then((e=>({...$p.getDefaultConfig(),...e})));static getDefaultConfig=()=>Zp;static getServerConfig=e=>(0,yt.Z)({project:"blog",body:JSON.stringify({query:`query\n                {\n                  siteConfig(id: ${e})\n                }`})}).then((e=>JSON.parse(e.data.siteConfig))).catch(D.Z.promiseHandler(Bp));static setStaticPage(e,t){const{pageId:n,seoDescription:a,seoKeywords:s,seoTitle:r}=t,o=JSON.stringify(t.pageUrl),i=JSON.stringify(t.pageTitle),l=JSON.stringify(t.pageHtml),c=JSON.stringify({seoDescription:a,seoKeywords:s,seoTitle:r}).replace(/"/gi,'\\"');return(0,yt.Z)({project:"blog",body:JSON.stringify({query:`mutation\n                    {\n                        setStaticPage(\n                            siteId: ${e},\n                            ${n?`pageId: ${n}`:""},\n                            pageUrl: ${o},\n                            pageTitle: ${i},\n                            pageHtml: ${l},\n                            seoData: "${c}"\n                        )\n                    }`})}).catch(D.Z.promiseHandler(Bp))}static getStaticPage(e,t,n={}){return(0,yt.Z)({project:"blog",body:JSON.stringify({query:`query\n                    {\n                        getStaticPage(siteId: ${e}, pageId: "${t}")\n                    }`}),...n}).then((e=>JSON.parse(e.data.getStaticPage))).catch(D.Z.promiseHandler(Bp))}static deleteStaticPage(e){return(0,yt.Z)({project:"blog",body:JSON.stringify({query:`mutation\n                    {\n                        deleteStaticPage(pageId: ${e})\n                    }`})}).catch(D.Z.promiseHandler(Bp))}}const Up=$p;
/**
 * Mirtesen.
 *
 * API interface for Site.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Hp extends Xo.Z{static getMtHost(e){return"mirtesen.ru"!==Rp().mainDomain&&(e=e.replace(new RegExp(`.${Rp().mainDomain}$`,"i"),".mirtesen.ru")),e}static getSite(e,t,n){const a=Up.getDefaultConfig();let s=null;return s=y.Z.isNumeric(e)?Hp.getById(e,{req:t,res:n}):Hp.getByUrl(e,b.ZP.isAnonymous(t),{req:t,res:n}),Promise.resolve(s).then((e=>{if(!e)throw new Error("Couldn't determine the site");e.site&&(e.site.mainDomain=e.site.url,e.site.url=t.originalProtocol+"://"+this.getMtHost(t.get("host"))+t.originalUrl),e.siteBuilder&&"object"==typeof JSON.parse(e.siteBuilder)?e.siteBuilder={...a,...JSON.parse(e.siteBuilder)}:e.siteBuilder={...a},e.originalUrl=t.originalUrl;const s=L()(e,"siteBuilder.mainMenu.items",[]);"object"!=typeof s||Array.isArray(s)||(e.siteBuilder.mainMenu.items=Object.values(s));const r=cd(n);e.hideAdBlocks=e.hideAdBlocks||r.app.hideAdBlocks||e?.site?.hideBanners;const o=(0,Ll.RH)(yi,r.leftMenu||{});o.blogMenu=Hp._getBlogMenu(e,t),n.locals.initialState={...r,app:{...r.app,...e},leftMenu:o}})).catch(D.Z.promiseHandler("/index.js"))}static _getBlogMenu=(e,t)=>{const n={...yi.blogMenu};let a=e.siteBuilder.mainMenu||{};if(0===Object.keys(a).length)return null;a=a.items||[];const s=[];for(let e=0;e<a.length;e++)a[e].selected&&(n.activeItem=e),a[e].secondary=!1,a[e].width=0,s.push(a[e]);if(!n.activeItem){const e=new(Lp())(t.url),a=decodeURIComponent(e.pathname.toLowerCase()),r=t.hostname.toLowerCase();for(let e=0;e<s.length;e++){const t=s[e],o=t.type||null,i=t.url||null;if(!i||!o)continue;const l=new(Lp())(i.toLowerCase()),c=decodeURIComponent(l.pathname.toLowerCase()),m=l.host.toLowerCase();if(a===c&&("url"!==o||"url"===o&&(!m||r===m))){t.selected=!0,n.activeItem=e;break}}}return n.menuItems=s,n}}const Fp=Hp,jp=({scope:e,mobileApp:t,deviceType:n,setHeader:a,setHeaderStatus:s,page:o})=>{const[i,l]=(0,r.useState)(!1),[c,m]=(0,r.useState)(""),[d,p]=(0,r.useState)(0),g=(0,r.useRef)(),h=(0,r.useRef)(null);(0,r.useEffect)((()=>{const{leftSidebarBreakpoints:t,headerSearch:n,glagolDomain:s}=Rp();let r;r="videoOne"===o?1e4:t[e]?t[e]:t.default,a({searchConfig:n,settingsEnabled:!1,sidebarEnabled:"messenger"!==o,sidebarBreakpoint:r,..."platform"===e&&{logoConfig:{title:"Перейти на главную страницу",extraClasses:"info"},extraLogoConfig:{url:"//info.mirtesen.ru",title:"Перейти на главную страницу О компании - Миртесен",extraClasses:"info"}},...Fp.isSiteMatch("glagolDomains")&&{logoConfig:{title:"Перейти на главную страницу",extraClasses:"glagol"},extraLogoConfig:{url:"//"+s,title:"Перейти на главную страницу - ГлагоL",extraClasses:"glagol"}}})}),[]),(0,r.useEffect)((()=>(g.current=0,window.addEventListener("scroll",E),()=>window.removeEventListener("scroll",E))),[]),(0,r.useEffect)((()=>(f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f))),[]),(0,r.useEffect)((()=>{let e;e="phone"!==n||(!i||"top"===c),s(e)}),[n,s,i,c]);const E=u()((()=>{const e=window.pageYOffset,t=g.current>e?"top":"down";if(Math.abs(g.current-e)<60)return;const n=h.current.getBoundingClientRect().bottom+60,a={type:"MT_APP_STICKY_HEADER"};a.data="down"===t&&e>n?{sticky:0}:{sticky:70},window.postMessage(a,"*"),"top"===t&&e<=0&&l(!1),"down"===t&&e>n&&l(!0),m(t),g.current=e}),80),f=u()((()=>{p(h?.current?.offsetWidth)}),80);if(t)return!1;const b="phone"===n;return r.createElement("header",{id:"header",ref:h},r.createElement("div",{className:_()({"header-wrapper":!0,"scrolled-top":b&&i&&"top"===c,"scrolled-down":b&&i&&"down"===c}),style:{width:d?`${d}px`:"auto"}},r.createElement(Ap,null)))};jp.propTypes={scope:f().string,deviceType:f().string,mobileApp:f().bool,setHeader:f().func,setHeaderStatus:f().func,page:f().string};const Gp=(0,i.$j)((e=>({scope:e?.app?.scope||"blog",mobileApp:e?.app?.req?.mobileApp||!1,deviceType:e?.app?.req?.deviceType,page:e?.app?.page})),(e=>({setHeader:t=>{e((e=>t=>{t({type:"HEADER_SET",header:e})})(t))},setHeaderStatus:t=>{e({type:"APP_SET_HEADER_STATUS",isHeaderOpen:t})}})))((0,r.memo)((0,ae.Z)(jp,"header")));var qp=n(64593),Vp=n(47311),zp=n(93649);const Wp=class{static defaultTitle="МирТесен";static commonTitle=" - Медиаплатформа МирТесен";static getMeta(e,t){let n,a=this.commonTitle;switch(e){case"index":n={title:this.getIndexTitle(t.tab),description:this.getIndexDescription(t.tab)};break;case"topic":n={title:this.getTopicTitle(t.mainPost,t.topic),description:this.getTopicDescription(t.topicKey,t.mainPost),canonical:this.getTopicCanonical(Rp(),t.topicKey)};break;case"profile":n={title:this.getProfileTitle(t.mainPost,t.person,t.tab),description:this.getProfileDescription(t.mainPost,t.person,t.tab),link:t.mainPost?.url,image:t.mainPost?.images?.[0]?.url};break;case"channel":a=' - Социальная сеть "МТ.RU"';const{channel:e,mainPost:s}=t,r=e?.avatar_info?.photo_original;let o=null;r&&(o=[{rel:"icon",href:r.replace(/^https:\/\/mtdata.ru/,"https://r.mtdata.ru/c16x16"),sizes:"16x16"}]),n={title:this.getChannelTitle(s,e),description:this.getChannelDescription(s,e),link:t.mainPost?.url,image:s?.images?.[0]?.url||e?.avatar_info.photo_original||e?.cover_info?.photo_original,keywords:s?this.getKeywordsFromTags(s?.tags):this.getKeywordsFromTags(e.tags),siteName:e?.title?e.title+" - MT.RU":"MT.RU",favicon:o};break;case"channel-index":a="",n={title:'Социальная сеть "МТ.RU"',description:"Хотите узнать, что происходит в вашем городе, вашем районе или вашем доме? Социальная сеть MT.RU поможет вам найти нужный контент и друзей по интересам.",siteName:"MT.RU"};break;case"channels":a="",n={title:'Мои каналы и мои подписки социальной сети "МТ.RU"',description:"Найдите интересующий вас канал в нашем большом разнообразии контeнта. Или создайте свой канал и поделитесь своими мыслями и знаниями с окружающими людьми рядом с вами.",siteName:"MT.RU"};break;case"channel-hashtags":a="",n={title:`${t.tag} - MT.RU`,description:`Посты по тегу ${Pa.Z.stripGeoId(t.tag)} в социальной сети "МТ.RU"`,siteName:"MT.RU"};break;case"rich-editor":a="",n={title:'Создание статьи в социальной сети "MT.RU"',description:"Уникальный специализированный редактор постов, позволяет создать максимально кастомизированный формат статьи. Хотите добавляйте фотографии, видео и форматируйте статью под ваш персональный стиль. Который знаком вашим читателям.",siteName:"MT.RU"};break;case"dispute":n={title:this.getDisputeTitle(t.blogPost),description:this.getPostDescription(t.blogPost),link:t.seoUrl,image:t.blogPost.images?.[0]?.url||"",canonical:t.seoUrl};break;case"blog":n={title:this.getBlogPostTitle(t.blogPost,t.display_name),description:this.getPostDescription(t.blogPost),link:t.blogPost.canonical_url||t.blogPost.url,image:t.blogPost.images?.[0]?.url||"",canonical:t.blogPost.canonical_url};break;case"chats":n={title:"Публичные чаты",description:"Политика, сад, рецепты, знакомства, семья... \n                    Чаты, доступные для всех пользователей МирТесен. \n                    Жмите на то, что вам понравилось, присоединяйтесь, \n                    будьте активны, знакомьтесь и общайтесь с единомышленниками.\n                    Создать свой чат по любой теме — нажимайте кнопку ниже:"};break;case"bloggers":n={title:"Блогеры",description:"Читайте и комментируйте самые интересные авторские посты, \n                    репортажи и интервью по всем общественно-значимым темам"};break;case"polls":n={title:"Опросы",description:"Голосуйте в созданных опросах МирТесен \n                    и придумывайте свои варианты вопросов и ответов на этой странице"};break;case"popular":n={title:this.getPopularTitle(t.isMostCommented),description:this.getPopularDescription(t.isMostCommented)};break;case"pad":n={title:`${t.mainPost?.title} - ${t.topic.title}`,description:`${t.mainPost?.preview_text} - Тематические каналы и сообщества,\n                    личные сообщения и чаты, лента рекомендаций и стены друзей, официальный мессенджер,\n                    собственные сайты и подписчики, эксклюзив от редакции ГлагоL`};break;case"site":n={title:this.getSiteTitle(t.page,t.siteTitle,t.section),description:this.getSiteDescription(t.page,t.siteTitle,t.section)};break;case"friends":n={title:this.getFriendsTitle(t.tab,t.person),description:this.getFriendsDescription(t.tab,t.person)};break;case"hashtags":n={title:`${t.tag}`,description:`Посты по тегу ${Pa.Z.stripGeoId(t.tag)} в медиаплатформе МирТесен.`,siteName:"МирТесен"};break;default:n={title:this.defaultTitle}}return n.title=n.title+a,n}static getTopicTitle(e,t){return e?.title?`${e.title}\n             - ${this.getFormattedDate(e.date)}\n             - ${t?.title}`:t?.title?t.title:"Наиболее популярные новости"}static getTopicDescription(e,t){const n={coronavirus:"Последние новости и статьи по теме симптомов коронавируса, распространения коронавируса в России и мире, возможности заразиться коронавирусом человеку или животном и по статистике заражения и смерти от коронавируса.",crysis:"Кризис в экономике России и мира в 2020 году по версии медиа ГлагоL — курс доллара, стоимость нефти, падение цен на нефть и ценные бумаги, курс нефти онлайн, прогнозы состояния финансов."}[e];return n||`${t?.preview_text} - ${this.getFormattedDate(t?.date)} - Тематические каналы и сообщества,\n            личные сообщения и чаты, лента рекомендаций и стены друзей, официальный мессенджер,\n            собственные сайты и подписчики, эксклюзив от редакции ГлагоL`}static getTopicCanonical(e,t){return`${e.mainProto}://`+e.mainDomain+`/topic/${t}`}static getProfileTitle(e,t,n){if(!t)return"Профиль";let a=`${t.display_name} - ${t.id}`;const s=`Профиль - ${a}`;return e?(a=`${this.getFormattedDate(e.date)} - ${t.display_name} - ${t.id}`,this.getMainPostTitle(e,a)??s):{blogposts:`Публикации - ${a}`,comments:`Комментарии - ${a}`,profile:`Профиль - ${a}`,sites:`Сайты - ${a}`,photos:`Фото - ${a}`,"private-photos":`Фото пользователя ${a}`,videos:`Видео - ${a}`,places:`Места пользователя ${a}`,events:`События пользователя ${a}`}[n]??s}static getProfileDescription(e,t,n){if(!t)return"Профиль пользователя - в медиаплатформе МирТесен. Подписывайтесь, читайте, комментируйте, ставьте лайки";const a=` пользователя ${t.display_name} - ${t.id}\n             - в медиаплатформе МирТесен. Подписывайтесь, читайте, комментируйте, ставьте лайки`,s="Профиль"+a,r={blogposts:`Список публикаций ${a}`,comments:`Комментарии ${a}`,profile:`Профиль пользователя ${a}`,sites:`Список сайтов ${a}`,photos:`Фотографии ${a}`,videos:`Видеозаписи ${a}`}[n];return e?e.previewText?this.getPostDescription(e):`${this.getPostType(e)}\n         - ${t.display_name}\n         - ${t.id}\n         - ${this.getFormattedDate(e.date)}\n         - Медиаплатформа МирТесен. Подписывайтесь, читайте, комментируйте, ставьте лайки`:r??s}static getChannelTitle(e,t){if(!t)return"Канал";const n=t.title;return e?this.getMainPostTitle(e,n)??n:n}static getChannelDescription(e,t){if(!t)return"Канал в социальной сети MT.RU. Подписывайтесь, читайте, комментируйте, ставьте лайки";let n="";return e?.previewText?n=e.previewText+" Подписывайтесь, читайте, комментируйте, ставьте лайки":(n=t.description||"Канал "+t.title,n+="в социальной сети MT.RU. Подписывайтесь, читайте, комментируйте, ставьте лайки"),zp.Z.plain2text(n).replace(/[#@]/g,"")}static getKeywordsFromTags=(e=[])=>e.map((e=>Pa.Z.stripGeoId(e))).join(", ");static getDisputeTitle(e){if(!e)return this.defaultTitle;return K.Z.stripTags(`${e.title} - Обсуждение статьи \n        - ${e.title?"":this.getFormattedDate(e.date)} \n        - ${e.id}`)}static getFormattedDate(e){return c().unix(e).format("D MMMM")}static getPostDescription(e){return K.Z.stripTags(`${e.preview_text||e.preview||e.previewText||e.title} - ${this.getFormattedDate(e.date)} - ${e.id} ${this.commonTitle}`)}static getPostType(e){return e.foreignPollId?"Опрос":e.images?.length&&e.videos?.length?"Фото и видео":e.images?.length?"Фото":e.videos?.length?"Видео":"МирТесен"}static getMainPostTitle(e,t){let n="";return e.title?n=e.title+" - "+t:e.previewText?(n=e.previewText.split(" ").slice(0,5).join(" "),n=n+" - "+t):e.from_id&&e.date&&(n=this.getPostType(e)+". "+t),n=zp.Z.plain2text(n).replace(/[#@]/g,""),n}static getBlogPostTitle(e,t){const n=!e.isTitleHidden&&e.title;return K.Z.stripTags((n?e.title+" - ":"")+`${t}`+(n?"":" - "+this.getFormattedDate(e.date)))}static getIndexTitle(e){return{main:"Лента - Новости",main2:"Лента - Новости",top:"Лента - Новости - Посты пользователей для вывода в ТОП",new:"Лента - Новости - Выбранные нейросетью Neuron посты","user-posts":"Глас народа - Самые свежие посты пользователей",feed:"Друзья - Фото - Лента"}[e]}static getIndexDescription(e){const t="Лента - Новости - MirTesen.ru - Главная страница рекомендательной социальной сети. \n            Следите за самой интересной и актуальной информацией, найдите собеседников по любой важной для вас теме. \n            Создайте свой сайт и соберите на нем множество читателей. \n            Участвуйте в социальной сети и будьте всегда в курсе событий.";return{main:t,main2:t,top:"Лента - Новости - Mirtesen.ru - Страница с постами пользователей для вывода в ТОП.\n            Рекомендательная социальная сеть. Следите за самой интересной и актуальной информацией, \n            найдите собеседников по любой важной для вас теме.",new:"Лента - Новости - Mirtesen.ru - Страница с выбранными нейросетью Neuron постами.\n            Рекомендательная социальная сеть.\n            Следите за самой интересной и актуальной информацией, найдите собеседников по любой важной для вас теме.","user-posts":"Пользователи МирТесен пишут посты в реальном времени - читать. \n            Поздравления с днем рождения, комментарии и лайки, личные сообщения и чаты, \n            актуальные репосты и собственные идеи и мысли",feed:"Лента - Новости - Mirtesen.ru - Страница со свежими постами друзей. \n            Рекомендательная социальная сеть МирТесен. Следите за самой интересной и актуальной информацией, \n            найдите собеседников по любой важной для вас теме."}[e]}static getPopularTitle(e){return e?"Самые обсуждаемые новости":"Наиболее популярные новости"}static getPopularDescription(e){return e?"Лента наиболее обсуждаемых новостей в медиаплатформе МирТесен. \n                Диспуты, споры, дискуссии, прения. Подписывайтесь, читайте, комментируйте, ставьте лайки.":"Лента наиболее популярных новостей в медиаплатформе МирТесен. \n                Подписывайтесь, читайте, комментируйте, ставьте лайки."}static getSiteTitle(e,t,n){return{sections:`${n} - ${t}`,mainPage:`${t} - Главная страница`,blogs:`${t} - Список материалов`,blogCommentPage:`${t} - Комментарии`,interesting:`${t} - Лучшее`,commented:`${t} - Обсуждаемое`,people:`${t} - Список участников`}[e]}static getSiteDescription(e,t,n){const a=`"${t}" в медиаплатформе МирТесен. Подписывайтесь, читайте, комментируйте, ставьте лайки.`;return{sections:`Раздел "${n}" тематического канала ${a}`,mainPage:`Главная страница тематического канала ${a}`,blogs:`Свежие материалы тематического канала "${t}"" в медиаплатформе МирТесен. \n            Подписывайтесь, читайте, комментируйте, ставьте лайки`,blogCommentPage:`Комментарии и обсуждения материалов тематического канала ${a}`,interesting:`Самые популярные материалы тематического канала "${t}" в медиаплатформе МирТесен. \n            Интересное, лучшее, избранное и увлекательное`,commented:`Самые обсуждаемые материалы тематического канала ${t} в медиаплатформе МирТесен. \n            Диспуты, комментарии, споры, дискуссии, прения`,people:`Список участников тематического канала ${a}`}[e]}static getFriendsTitle(e,t){if(!t)return"Друзья пользователя";const n=`${t.display_name} - медиаплатформа МирТесен - ${t.id}`;return{friends:`Друзья - ${t.display_name} - ${t.id}`,"incoming-requests":`Запросы друзей ${n}`,"outgoing-requests":`Предложения дружбы ${n}`,recommended:`Рекомендуемые друзья ${n}`}[e]}static getFriendsDescription(e,t){if(!t)return"Друзья пользователя. Подписывайтесь, читайте, комментируйте, ставьте лайки.";const n=` пользователя ${t.display_name}\n        Подписывайтесь, читайте, комментируйте, ставьте лайки. - `+t.id;return{friends:`Список друзей пользователя ${t.display_name} - ${t.id} - в медиаплатформе МирТесен.\n            Подписывайтесь, читайте, комментируйте, ставьте лайки`,"incoming-requests":`Запросы друзей ${n}`,"outgoing-requests":`Предложения дружбы ${n}`,recommended:`Рекомендуемые друзья ${n}`}[e]}};function Yp(){return Yp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Yp.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Main Content Component.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2017, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class Kp extends r.PureComponent{_isVisible(e){return!e.options||!1!==e.options.show}_fixGetParams=e=>{if(!e)return"";const t=e.replace(/^\?/,"").replace(/utm_.+?=[^&]+&?/gi,"").replace(/mirtesenKey=[^&]+&?/g,"").replace(/mirtesenAuth=[^&]+&?/g,"").replace(/r(1|2)=[^&]+?&/g,"").replace(/rss_mirtesen=[^&]+&?/g,"").replace(/from=[^&]+?&/g,"").replace(/&$/,"");return t&&"?"+t};_getMainMeta(e){e={...e};const{app:t}=this.props,n=t.scope||null,a=re.Z.getConfig(),s=K.Z.getStaticHost(),r=t.site||null,o=t.siteBuilder||null,i=L()(o,"mainHeader.props.title",null),l=L()(o,"mainHeader.props.slogan",null);let c=L()(o,"mainHeader.props.image",null);"object"==typeof c&&(c=c?.src);const m=L()(r,"display_name",null),d=L()(r,"slogan",null);e.title=e.title||i||m||"Рекомендательная социальная сеть - медиаплатформа МирТесен","platform"===n&&(e.title=e.title.replace(/ - медиаплатформа МирТесен$/,"")+" - медиаплатформа МирТесен"),e.description=e.description||l||d||"Тематические каналы и сообщества, личные сообщения и чаты, лента рекомендаций и стены друзей, официальный мессенджер, собственные сайты и подписчики, эксклюзив от редакции ГлагоL";const p=e.metaPage;if(e.keywords=e.keywords||"одноклассники, однокурсники, соседи, сослуживцы, мир тесен, земляки, старые друзья, география, блоги домов, события вокруг, социальная сеть, карта, дом, работа, web 2.0",p&&m){const{title:t,description:n}=Wp.getMeta("site",{page:p,section:e.sectionTitle,siteTitle:m});e.title=t,e.description=n}let u=L()(t,"req.originalUrl");const g=L()(t,"req.host");u&&(u=new(Lp())(u),e.link=e.link||`${a.mainProto}://${g}${u.pathname}${u.query}${u.hash}`,e.index=e.index||`${a.mainProto}://${g}`),e.image=e.image||("blog"===n&&c?c:null)||`${s}/images/mirtesen.jpg`,e.siteName||(e.siteName=r?.display_name?r?.display_name+" - МирТесен":"МирТесен");const h=K.Z.format99Plus(this.props.unreadNotifications);return 0!==h&&(e.title=`(${h}) ${e.title}`),e}_getFavicon(e){e={...e};const{app:t}=this.props,n=t.scope||null,a=K.Z.getStaticHost();return e.favicon="blog"===n?[{rel:"icon",href:"/favicon.ico"},{rel:"shortcut icon",href:"/favicon.ico"}]:e.favicon||[{rel:"icon",href:`${a}/images/favicon/mt.png`,sizes:"64x64",type:"image/png"},{rel:"icon",href:`${a}/images/favicon/mt.svg`,sizes:"any",type:"image/svg+xml"}],e}_getExtraMeta(e){const{app:t}=this.props,n=[],a=t.scope||null;(e={...e}).otherMeta=e.otherMeta||[];const{title:s,siteName:r,twitterId:o,twitterSite:i,image:l,index:c,canonical:m}=e;let{description:d,link:p}=e;if(!s||!p)return[];if(p=y.Z.fixProtocol(p),p=new(Lp())(p),p=p.origin+p.pathname+this._fixGetParams(p.query),l){const e=y.Z.fixProtocol(y.Z.cropImage2(l));n.push({tag:"meta",params:{property:"og:image",content:e}},{tag:"meta",params:{property:"og:image:width",content:1200}},{tag:"meta",params:{property:"og:image:height",content:628}},{tag:"meta",params:{property:"og:image:alt",content:s}},{tag:"meta",params:{property:"twitter:image",content:e}},{tag:"meta",params:{property:"vk:image",content:e}},{tag:"link",params:{rel:"image_src",href:e}})}return d&&(d=y.Z.normalizeString(d),n.push({tag:"meta",params:{property:"og:description",content:d}},{tag:"meta",params:{property:"twitter:description",content:d}})),r&&n.push({tag:"meta",params:{property:"og:site_name",content:r}},{tag:"meta",params:{property:"og:site",content:r}}),i&&o&&n.push({tag:"meta",params:{property:"twitter:site",content:i}},{tag:"meta",params:{property:"twitter:site:id",content:o}}),n.push({tag:"meta",params:{property:"og:type",content:"article"}},{tag:"meta",params:{property:"og:url",content:p}},{tag:"meta",params:{property:"og:title",content:s}},{tag:"meta",params:{property:"twitter:card",content:"summary_large_image"}},{tag:"meta",params:{property:"twitter:title",content:s}},{tag:"link",params:{rel:"canonical",href:m||p}}),"blog"===a&&n.push({tag:"link",params:{rel:"index",href:c}},{tag:"link",params:{rel:"alternate",type:"application/atom+xml",title:r,href:`${c}/blog/atom`}},{tag:"link",params:{rel:"alternate",type:"application/atom+xml",title:r,href:`${c}/blog/rss`}}),e.otherMeta=[...e.otherMeta,...n],e}render(){const{app:e}=this.props,t=e.scope||null,n=e.siteBuilder||null;let a=L()(e,"meta",{});a=this._getMainMeta(a),a=this._getFavicon(a),a=this._getExtraMeta(a);const s=[];if("blog"===t){L()(n,"head.meta",[]).forEach(((e,t)=>{if(!e.includes('rel="icon"')&&!e.includes('rel="shortcut icon"')&&!e.includes('charset="utf-8"')){const n={replace(e){const n=(0,Vp.e_)(e.attribs);return r.createElement("meta",Yp({key:t},n))}};s.push((0,Vp.ZP)(e,n))}}))}const{title:o="",description:i,keywords:l,favicon:c,otherMeta:m}=a;return r.createElement(qp.q,null,o&&r.createElement("title",null,o),i&&r.createElement("meta",{name:"description",content:y.Z.normalizeString(i)}),l&&r.createElement("meta",{name:"keywords",content:y.Z.normalizeString(l)}),Array.isArray(m)&&m.filter((e=>this._isVisible(e))).map(((e,t)=>r.createElement(e.tag,Yp({},e.params,{key:t})))),Array.isArray(c)&&c.map(((e,t)=>r.createElement("link",{key:t,rel:e.rel,href:e.href,type:e.type||"image/x-icon",sizes:e.sizes||"16x16"}))),s,";")}}Kp.propTypes={app:f().object,unreadNotifications:f().number};const Jp=(0,i.$j)((e=>({unreadNotifications:e.header?.unreadCount?.activities||0})))((0,ae.Z)(Kp,"head"));var Xp=n(81773),Qp="/index.js";const eu=
/**
 * Mirtesen.
 *
 * API interface for BlogPost.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class{static roles={god:"Хозяин",superAdmin:"Супер администратор",admin:"Администратор",moderator:"Модератор"};static tabs={members:"Все",rating:"С высоким рейтингом",latest:"Новые",online:"Сейчас в сети",moderators:"Модераторы",blocked:"Чёрный список"};static hiddenTabs=["blocked"];static getStaff=async(e,t={})=>{try{return await R.Z.request({query:`query \n                {\n                  getGroupStaff(group_id: ${e}) {\n                    superAdmin {\n                      id\n                      display_name\n                      url\n                    }\n                    god {\n                      id\n                      display_name\n                      url\n                    }\n                    admin {\n                      id\n                      display_name\n                      url\n                    }\n                    moderator {\n                      id\n                      display_name\n                      url\n                    }\n                  }\n                }`,endpoint:{endpoint:"blogs",ver:"v1"},req:t.req,res:t.res})||{}}catch(e){D.Z.promiseHandler(Qp)(e)}};static setStaff=async(e,t,n,a={})=>{let s=null;s=y.Z.isNormalInteger(t)?`user_id: ${t}`:`user_email: "${t}"`;try{const t=await R.Z.request({query:`mutation \n                {\n                  editGroupManager(\n                    group_id: ${e}\n                    ${s}\n                    role: ${n}\n                  )\n                }`,endpoint:{endpoint:"blogs",ver:"v1"},req:a.req,res:a.res});return JSON.parse(t)}catch(e){D.Z.promiseHandler(Qp)(e)}};static getMembers=async(e,t={})=>{t={offset:0,count:20,filter:null,...t};try{const n=await R.Z.request({query:`query \n                {\n                  getGroupMembers(\n                    group_id: ${e}\n                    filter: "${t.filter}", \n                    offset: ${t.offset}, \n                    count: ${t.count}\n                  ) {\n                    items {\n                      id\n                      display_name\n                      url\n                      photo_original\n                      bdate\n                      joined_date\n                    }\n                  }\n                }`,endpoint:{endpoint:"blogs",ver:"v1"},req:t.req,res:t.res});return n?.items||[]}catch(e){D.Z.promiseHandler(Qp)(e)}};static addToFriends=async(e,t)=>{try{return await R.Z.request({query:`mutation {\n                    addFriend(user_id: ${e}, type: ${t})\n                  }`,endpoint:{endpoint:"user",ver:"v1"}})}catch(e){D.Z.promiseHandler(Qp)(e)}};static deleteFriend=async(e,t)=>{try{return await R.Z.request({query:`mutation {\n                    deleteFriend(user_id: ${e}, type: ${t})\n                  }`,endpoint:{endpoint:"user",ver:"v1"}})}catch(e){D.Z.promiseHandler(Qp)(e)}};static abuseUser=async e=>{try{return await R.Z.request({query:`mutation {\n                    abuseUser(user_id: ${e})\n                  }`,endpoint:{endpoint:"user",ver:"v1"}})}catch(e){D.Z.promiseHandler(Qp)(e)}};static ignoreUser=async e=>{try{return await R.Z.request({query:`mutation {\n                    ignoreUser(user_id: ${e})\n                  }`,endpoint:{endpoint:"user",ver:"v1"}})}catch(e){D.Z.promiseHandler(Qp)(e)}};static followUser=async(e,t)=>{try{return await R.Z.request({query:`mutation {\n                    followUser(user_id: ${e}, follow: ${t})\n                  }`,endpoint:{endpoint:"user",ver:"v1"}})}catch(e){D.Z.promiseHandler(Qp)(e)}}};var tu="/index.js";
/**
 * Mirtesen.
 *
 * User card popup actions.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const nu=e=>t=>{Promise.all([Tt.Z.getUsersRelationStatus([e])]).then((([n])=>{n=n[e]||{},t({type:"USER_FRIENDSHIP_INIT",userId:e,friendshipStatus:n.friendshipStatus,isFollowingFor:n.isFollowingFor,isIgnoreUser:n.isIgnoreUser,isIgnoredByUser:n.isIgnoredByUser,canAbuseUser:n.canAbuseUser})})).catch(D.Z.promiseHandler(tu))},au=e=>(t,n)=>{Promise.all([eu.addToFriends(e,"friend")]).then((a=>{if("undefined"!==a[0]){const a=n().userFriendship[e].friendshipStatus||[];a.push("friend"),t({type:"USER_FRIENDSHIP_SET_STATUS",userId:e,friendshipStatus:a})}})).catch(D.Z.promiseHandler(tu))},su=e=>(t,n)=>{Promise.all([eu.deleteFriend(e,"friend"),eu.deleteFriend(e,"opponent"),eu.deleteFriend(e,"fellow"),eu.deleteFriend(e,"confederate")]).then((a=>{if("undefined"!==a[0]&&"undefined"!==a[1]&&"undefined"!==a[2]&&"undefined"!==a[3]){let a=n().userFriendship[e].friendshipStatus||[];a=a.filter((e=>-1===["friend","opponent","fellow","confederate"].indexOf(e))),t({type:"USER_FRIENDSHIP_SET_STATUS",userId:e,friendshipStatus:a})}})).catch(D.Z.promiseHandler(tu))};
/**
 * Mirtesen.
 *
 * User card popup.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ru extends r.PureComponent{constructor(e){super(e),this.state={isMobile:!1,sendMessagePopup:!1}}componentDidMount(){const{userId:e,userFriendship:t,init:n}=this.props;t[e]||n(e),this._resizeHandler(),window.addEventListener("resize",u()(this._resizeHandler,70))}componentWillUnmount(){window.removeEventListener("resize",u()(this._resizeHandler,70))}_resizeHandler=()=>{this.setState({isMobile:document.body.dataset.viewportWidth<960})};render(){const{userId:e,userFriendship:t,requestFriendship:n,cancelFriendship:a,cancelMyRequest:s,approveUserRequest:o,rejectUserRequest:i,className:l,subscribe:c,unsubscribe:m,abuseUser:d,ignoreUser:p,blogMember:u,siteId:g,addModerator:h,setBanStatus:E,enableBlogModeration:f=!0}=this.props;let{compact:y}=this.props;const{isMobile:v,sendMessagePopup:T}=this.state;let{staff:S}=u;S=S||{},y=y||v;const P=b.ZP.getCurrentUser();if(!t[e]||!b.ZP.isLogged()||Number(P.id)===Number(e))return null;const w=Tt.Z.determineRelation(t[e]),{friendStatus:I,isSubscribed:C,canBeFriend:N,canSubscribe:M,canAbuse:k,canBlacklist:A,isBlacklisted:x}=w,L={"user-friend-actions":!0};return l&&(L[l]=!0),r.createElement(r.Fragment,null,T&&r.createElement(O.Z,{className:"moderation-popup",onClose:()=>{this.setState({sendMessagePopup:!1})}},r.createElement(O.Z.Body,null,"Согласно требованиям безопасности хранения персональных данных личные сообщения пользователям друг другу могут быть написаны только после подтверждения номера мобильного телефона"),r.createElement(O.Z.Footer,null,r.createElement(He.Z,{label:"Подтвердить",color:"primary",onClick:()=>{window.location.href="/settings/contacts"}}),r.createElement(He.Z,{label:"Отменить",color:"secondary",onClick:()=>{this.setState({sendMessagePopup:!1})}}))),r.createElement("div",{className:_()(L)},N&&r.createElement(r.Fragment,null,"none"===I&&r.createElement("button",{onClick:()=>n(e),className:"btn btn-primary"},r.createElement("svg",{className:"svg"},r.createElement("use",{href:"/images/icons.svg#cross"})),"Дружить"),"user_request"===I&&r.createElement("button",{onClick:()=>o(e),className:"btn btn-primary"},r.createElement("svg",{className:"svg"},r.createElement("use",{href:"/images/icons.svg#cross"})),"Подтвердить"),"my_request"===I&&r.createElement("button",{onClick:()=>s(e),className:"btn btn-secondary"},r.createElement("svg",{className:"svg"},r.createElement("use",{href:"/images/icons.svg#check"})),"Отменить"),"friendship"===I&&r.createElement("button",{onClick:()=>a(e),className:"btn btn-secondary"},r.createElement("svg",{className:"svg"},r.createElement("use",{href:"/images/icons.svg#check"})),"Не дружить")),!x&&r.createElement("div",{className:_()({btn:!0,"btn-primary":"friendship"===I||"my_request"===I,"btn-secondary":"friendship"!==I&&"my_request"!==I,compact:y}),onClick:()=>{P.isPhoneVerified?window.location.href="https://mirtesen.ru/messages/"+e:this.setState({sendMessagePopup:!0})}},r.createElement("svg",{className:"svg"},r.createElement("use",{href:"/images/icons.svg#send"})),!y&&r.createElement(r.Fragment,null,"Сообщение")),r.createElement(G.Z,{customButtonClasses:"btn btn-secondary compact",customDropdownClasses:"moderation-tooltip",customListClasses:"moderation-tooltip__list",placement:"auto-right",buttonValue:"...",openByHover:!0},r.createElement("ul",null,N&&"user_request"===I&&r.createElement("li",{onClick:()=>i(e)},"Удалить запрос дружбы"),M&&!C&&r.createElement("li",{onClick:()=>c(e)},"Подписаться"),M&&C&&r.createElement("li",{onClick:()=>m(e)},"Отписаться"),A&&r.createElement("li",{onClick:()=>p(e)},"Внести в личный черный список"),k&&r.createElement("li",{onClick:()=>d(e)},"Пожаловаться"),f&&g&&b.ZP.canAdminBlog()&&r.createElement(r.Fragment,null,!S[e]&&r.createElement("li",{onClick:()=>h(e,g),className:"grey"},"Назначить модератором"),(!S[e]||"god"!==S[e]&&"superAdmin"!==S[e])&&r.createElement("li",{onClick:()=>E(e,g,"blocked"!==u.activeTab),className:"grey"},"blocked"!==u.activeTab?"Заблокировать на этом сайте":"Удалить из черного списка сайта"))))))}}ru.propTypes={init:f().func,requestFriendship:f().func,cancelFriendship:f().func,cancelMyRequest:f().func,approveUserRequest:f().func,rejectUserRequest:f().func,subscribe:f().func,unsubscribe:f().func,abuseUser:f().func,ignoreUser:f().func,blogMember:f().object,compact:f().bool,userId:f().oneOfType([f().string,f().number]),siteId:f().number,userFriendship:f().object,className:f().string,addModerator:f().func,setBanStatus:f().func,enableBlogModeration:f().bool};const ou=(0,i.$j)((e=>({userFriendship:e.userFriendship,siteId:L()(e,"app.site.id"),blogMember:e.blogMember})),(e=>({init:t=>{e(nu(t))},requestFriendship:t=>{e((e=>(t,n)=>{Promise.all([eu.addToFriends(e,"join_request"),eu.addToFriends(e,"friend")]).then((a=>{if("undefined"!==a[0]&&"undefined"!==a[1]){const a=n().userFriendship[e].friendshipStatus||[];a.push("join_wait","friend"),t({type:"USER_FRIENDSHIP_SET_STATUS",userId:e,friendshipStatus:a})}})).catch(D.Z.promiseHandler(tu))})(t))},cancelFriendship:t=>{e((e=>(t,n)=>{Promise.all([eu.deleteFriend(e,"friendship")]).then((a=>{if("undefined"!==a[0]){let a=n().userFriendship[e].friendshipStatus||[];a=a.filter((e=>-1===["friendship","join_wait","join_request"].indexOf(e))),t({type:"USER_FRIENDSHIP_SET_STATUS",userId:e,friendshipStatus:a})}})).catch(D.Z.promiseHandler(tu))})(t))},cancelMyRequest:t=>{e((e=>(t,n)=>{Promise.all([eu.deleteFriend(e,"join_request")]).then((a=>{if("undefined"!==a[0]){let a=n().userFriendship[e].friendshipStatus||[];a=a.filter((e=>-1===["friendship","join_wait","join_request"].indexOf(e))),t({type:"USER_FRIENDSHIP_SET_STATUS",userId:e,friendshipStatus:a})}})).catch(D.Z.promiseHandler(tu))})(t))},approveUserRequest:t=>{e((e=>(t,n)=>{Promise.all([eu.addToFriends(e,"join_accept")]).then((a=>{if("undefined"!==a[0]){let a=n().userFriendship[e].friendshipStatus||[];a.push("friendship"),a=a.filter((e=>-1===["join_wait","join_request"].indexOf(e))),t({type:"USER_FRIENDSHIP_SET_STATUS",userId:e,friendshipStatus:a})}})).catch(D.Z.promiseHandler(tu))})(t))},rejectUserRequest:t=>{e((e=>(t,n)=>{Promise.all([eu.deleteFriend(e,"join_reject")]).then((a=>{if("undefined"!==a[0]){let a=n().userFriendship[e].friendshipStatus||[];a=a.filter((e=>-1===["friendship","join_wait","join_request"].indexOf(e))),t({type:"USER_FRIENDSHIP_SET_STATUS",userId:e,friendshipStatus:a})}})).catch(D.Z.promiseHandler(tu))})(t))},subscribe:t=>{e(au(t))},unsubscribe:t=>{e(su(t))},abuseUser:t=>{e((e=>t=>{eu.abuseUser(e).then((e=>{"undefined"!==e&&(t({type:"USER_FRIENDSHIP_ABUSE"}),kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Ваше сообщение успешно отправлено в службу поддержки."}))})).catch((()=>{kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Что-то пошоло не так. Попробуйте еще раз или обратитесь в службу поддержки."}),D.Z.promiseHandler(tu)}))})(t))},ignoreUser:t=>{e((e=>t=>{eu.ignoreUser(e).then((n=>{"undefined"!==n&&(t({type:"USER_FRIENDSHIP_IGNORE",userId:e}),kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:'Пользователь добавлен в список игнорируемых. Весь список пользователей вы можете посмотреть на <a href="/settings/peopleblacklist" target="_blank">странице</a>'}))})).catch((()=>{kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Что-то пошоло не так. Попробуйте еще раз или обратитесь в службу поддержки.",autoClose:12}),D.Z.promiseHandler(tu)}))})(t))},addModerator:(t,n)=>{e(((e,t)=>n=>{eu.setStaff(t,e,"moderator").then((t=>{"undefined"!==t&&n({type:"BLOG_MEMBER_ADD_MODERATOR",userId:e,role:"moderator"})})).catch(D.Z.promiseHandler(tu))})(t,n))},setBanStatus:(t,n,a)=>{e(a?((e,t)=>n=>{(new ms).banUser(e,t).then((t=>{void 0!==t?(n({type:"BLOG_MEMBER_ADD_USER_TO_LIST",userId:e,tabs:["blocked"]}),n({type:"BLOG_MEMBER_REMOVE_USER_FROM_LIST",userId:e,tabs:["members","rating","latest","online","moderators"]}),kt.Z.sendMessage({type:"MT_APP_CHANGE_MEMBER_COUNT",value:!1}),kt.Z.sendSystemMessage("banBlogMember")):kt.Z.sendSystemMessage("exception")})).catch((e=>{kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler(tu)(e)}))})(t,n):((e,t)=>n=>{(new ms).unbanUser(e,t).then((t=>{t?(n({type:"BLOG_MEMBER_REMOVE_USER_FROM_LIST",userId:e,tabs:["blocked"]}),kt.Z.sendMessage({type:"MT_APP_CHANGE_MEMBER_COUNT",value:!0}),kt.Z.sendSystemMessage("unbanBlogMember")):kt.Z.sendSystemMessage("exception")})).catch((e=>{kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler(tu)(e)}))})(t,n))}})))(ru),iu=(e,t)=>n=>{n({type:"SECONDARY_HEADER_TOGGLE",block:e,show:t})};var lu=n(27011),cu=n.n(lu),mu=n(30463),du=n(6230),pu=n.n(du);
/**
 * Mirtesen.
 *
 * Logo Editor Container.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class uu extends r.Component{componentDidMount(){const{initState:e,type:t,image:n}=this.props;e({image:n,type:t,isEmpty:!n})}setEditorRef=e=>{e&&(this.editor=e)};render(){const{logoEditor:e,onToggleEditor:t,onScale:n,onRotateLeft:a,onSaveImage:s,onDropImage:o,onChangePosition:i,onNewImage:l,onRemove:c}=this.props;return"undefined"!=typeof window&&"undefined"!=typeof navigator&&r.createElement("div",{className:"logo-editor"},r.createElement("svg",{onClick:()=>t(!1),style:{width:23,height:23},className:"svg-icon logo-editor__close"},r.createElement("use",{href:"/images/icons.svg#times-circle-solid"})),r.createElement(mu.ZP,{onDrop:e=>o(e),noClick:!0,multiple:!1,style:{width:e.width,height:e.height}},(()=>r.createElement("div",{className:"logo-editor__canvas"},r.createElement(cu(),{ref:this.setEditorRef,scale:parseFloat(e.scale),width:e.width,height:e.height,position:e.position,onPositionChange:e=>i(e),rotate:parseFloat(e.rotate),borderRadius:parseFloat(e.borderRadius),image:e.image,border:parseFloat(e.border),crossOrigin:"anonymous"})))),r.createElement("div",{className:"logo-editor__tune"},r.createElement("input",{type:"file",name:"newImage",onChange:e=>l(e)}),r.createElement("div",{className:"logo-editor__scale-rotate"},r.createElement("input",{name:"scale",type:"range",onChange:e=>n(e),min:"1",max:"2",step:"0.01",defaultValue:"1",className:"logo-editor__scale"}),r.createElement("svg",{onClick:e=>a(e),style:{width:23,height:23},className:"svg-icon logo-editor__rotate"},r.createElement("use",{href:"/images/icons.svg#undo"})),r.createElement("svg",{onClick:()=>c(),style:{width:23,height:23},className:"svg-icon logo-editor__remove"},r.createElement("use",{href:"/images/icons.svg#times-circle-solid"}))),r.createElement("div",{className:"logo-editor__submit"},r.createElement(He.Z,{onClick:()=>s(this.editor),label:"Сохранить"}))))}}uu.propTypes={logoEditor:f().object,image:f().string,type:f().string,onToggleEditor:f().func,initState:f().func,onScale:f().func,onRotateLeft:f().func,onChangePosition:f().func,onSaveImage:f().func,onDropImage:f().func,onNewImage:f().func,onRemove:f().func};const gu=(0,i.$j)((e=>({logoEditor:e.logoEditor})),(e=>({onToggleEditor:t=>{e(iu("logoEditor",t))},initState:t=>{e((e=>t=>{t({type:"LOGO_EDITOR_INIT_STATE",object:e})})(t))},onScale:t=>{e((e=>{const t=parseFloat(e.target.value);return e=>{e({type:"LOGO_EDITOR_SET_SCALE",scale:t})}})(t))},onRotateLeft:t=>{e((e=>(e.preventDefault(),(e,t)=>{e({type:"LOGO_EDITOR_SET_ROTATE",rotate:t().logoEditor.rotate-90})}))(t))},onRemove:()=>{e((e=>{e({type:"LOGO_EDITOR_SET_IMAGE",image:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",isEmpty:!0})}))},onSaveImage:t=>{e((e=>(t,n)=>{const a=n(),s=a.logoEditor.type;let r=null;const o=a.logoEditor.isEmpty,i=e.getImage().toDataURL();fetch(i).then((e=>e.blob())).then((e=>{if(o)return null;const t=new(pu());t.append("query","mutation {uploadPhoto {id, photo_original}}"),t.append("photo",e);const n={project:"comments",body:t};return(0,yt.Z)(n)})).then((e=>{if(o)return null;if(!e)throw new Error("image bad response");if(r=e?.data?.uploadPhoto?.photo_original,!r)throw kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Не удалось загрузить изображение. Попробуйте еще раз или свяжитесь со службой поддержки."}),new Error("image bad response")})).then((()=>{if("blog"===s){const e=a.app.site.id;return Promise.resolve(Fp.setSiteSettings(e,{about:{logoImg:r}}))}if("profile"===s){const e=a.app.person.id;return Promise.resolve(Tt.Z.setPersonSettings(e,{personal:{logo:r}}))}})).then((()=>{t({type:"SECONDARY_HEADER_TOGGLE",block:"logoEditor",show:!1}),t({type:"APP_SET_LOGO",scope:s,image:r})})).catch(D.Z.promiseHandler("/index.js"))})(t))},onDropImage:t=>{e((e=>t=>{t({type:"LOGO_EDITOR_DROP_IMAGE",image:e[0],isEmpty:!1})})(t))},onChangePosition:t=>{e((e=>t=>{t({type:"LOGO_EDITOR_SET_POSITION",position:e})})(t))},onNewImage:t=>{e((e=>t=>{t({type:"LOGO_EDITOR_SET_IMAGE",image:e.target.files[0],isEmpty:!1})})(t))}})))(uu);var hu="/index.js";
/**
 * Mirtesen.
 *
 * Site Settings Actions.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const _u=e=>({type:"SITE_SETTINGS_CHANGE_TAB",tabName:e}),Eu=e=>({type:"SITE_SETTINGS_SET_INPUTS_ERRORS",errors:e}),fu=(e,t,n)=>({type:"SITE_SETTINGS_CHANGE_VALUE",tabName:e,name:t,value:n}),bu=e=>(t,n)=>{const a=n(),s=a.app.site.id,{data:r}=a.siteSettings,o={};(e=e||"about")&&(o[e]=r[e]),"about"===e&&(o[e].name=o[e].name.trim()),t({type:"SITE_SETTINGS_SAVE_SETTINGS",tabName:e}),Promise.all([Fp.setSiteSettings(s,o)]).then((([e])=>{t(yu(e))})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(hu)(e)}))},yu=e=>t=>{if(e.errors)kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e?.message||"При сохранении произошла ошибка"}),t(Eu(e.errors));else{if(e.error)return e.title?void kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e.title||"При сохранении произошла ошибка"}):void kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e?.errorMap||"При сохранении произошла ошибка"});kt.Z.sendSystemMessage("save")}};var vu="/index.js";
/**
 * Mirtesen.
 *
 * Title Editor Actions.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
/**
 * Mirtesen.
 *
 * Title Editor Container.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Tu extends r.Component{componentDidMount(){const{handleInitState:e,app:t,isBlog:n,primaryTitle:a}=this.props,s=n?Fp.getTitle(t):a;this.titleInput.focus(),e({title:s})}render(){const{titleEditor:e,handleSave:t,handleSaveUserName:n,handleOnChange:a,handleKeyDown:s,isBlog:o}=this.props,i=o?t:n;return"undefined"!=typeof window&&"undefined"!=typeof navigator&&r.createElement("div",{className:"blog-title-editor"},r.createElement("input",{type:"text",name:"title",value:e.title,onBlur:i,onKeyDown:e=>s(e.keyCode,i),onChange:e=>{a(e.target.name,e.target.value)},ref:e=>{this.titleInput=e}}))}}Tu.defaultProps={isBlog:!0},Tu.propTypes={app:f().object,titleEditor:f().object,handleInitState:f().func,handleSave:f().func,handleSaveUserName:f().func,handleOnChange:f().func,handleKeyDown:f().func,primaryTitle:f().string,isBlog:f().bool};const Su=(0,i.$j)((e=>({app:e.app,titleEditor:e.titleEditor})),(e=>({handleInitState:t=>{e((e=>t=>{t({type:"TITLE_EDITOR_INIT_STATE",object:e})})(t))},handleOnChange:(t,n)=>{e(((e,t)=>n=>{n({type:"TITLE_EDITOR_CHANGE_VALUE",name:e,value:t})})(t,n))},handleSave:()=>{e(((e,t)=>{const n=t(),a=n.app.site.id,s=n.titleEditor.title,r={about:{name:s}};return Promise.resolve(Fp.setSiteSettings(a,r)).then((()=>{e({type:"SECONDARY_HEADER_TOGGLE",block:"titleEditor",show:!1}),e({type:"APP_SET_TITLE",title:s}),"siteSettings"===n.app.page&&e(fu("about","name",s))})).catch(D.Z.promiseHandler(vu))}))},handleSaveUserName:()=>{e((async(e,t)=>{const n=t(),a=n.app.person.id,[s,r]=n.titleEditor.title.split(" ");if(!y.Z.isOnlyLettersInStr(s)||!y.Z.isOnlyLettersInStr(r))return kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Имя пользователя должно состоять только из букв"}),!1;const o={personal:{name:s,lastname:r||null}};try{const t=await Tt.Z.setPersonSettings(a,o);e({type:"SECONDARY_HEADER_TOGGLE",block:"titleEditor",show:!1}),t.result&&location.reload()}catch(e){kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(vu)}}))},handleKeyDown:(t,n)=>{e(((e,t)=>n=>{27===e&&n({type:"SECONDARY_HEADER_TOGGLE",block:"titleEditor",show:!1}),13===e&&t()})(t,n))}})))(Tu);
/**
 * Mirtesen.
 *
 * Header Background Editor Container.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Pu extends r.Component{constructor(e){super(e),this.state={editorWidth:0},this.editorContainer=r.createRef()}componentDidMount(){const{handleInitState:e,image:t,type:n}=this.props;e({image:t,type:n,isEmpty:!t}),window.addEventListener("resize",this.throttleResize),this.handleResize()}componentWillUnmount(){window.removeEventListener("resize",this.throttleResize)}handleResize=()=>{this.setState({editorWidth:this.editorContainer.current.offsetWidth})};setEditorRef=e=>{e&&(this.editor=e)};throttleResize=u()((()=>this.handleResize()),80);render(){const{headerBackgroundEditor:e,handleToggleEditor:t,handleScale:n,handleRotateLeft:a,handleSaveImage:s,handleDropImage:o,handleChangePosition:i,handleNewImage:l,handleRemove:c,type:m}=this.props,{editorWidth:d}=this.state;return"undefined"!=typeof window&&"undefined"!=typeof navigator&&r.createElement("div",{className:"header-background-editor",ref:this.editorContainer},r.createElement(mu.ZP,{onDrop:e=>o(e),noClick:!0,multiple:!1,style:{width:d,height:"profile"===m?e.profileHeight:e.blogHeight}},(()=>r.createElement("div",{className:_()({"header-background-editor__canvas":!0,"header-background-editor__canvas_profile":"profile"===m})},r.createElement(cu(),{ref:this.setEditorRef,scale:parseFloat(e.scale),width:d,height:"profile"===m?e.profileHeight:e.blogHeight,position:e.position,onPositionChange:e=>i(e),rotate:parseFloat(e.rotate),borderRadius:parseFloat(e.borderRadius),image:e.image,border:parseFloat(e.border),crossOrigin:"anonymous"})))),r.createElement("div",{className:"header-background-editor__tune"},r.createElement("input",{type:"file",name:"newImage",onChange:e=>l(e)}),r.createElement("div",{className:"header-background-editor__scale-rotate"},r.createElement("input",{name:"scale",type:"range",onChange:e=>n(e),min:"1",max:"2",step:"0.01",defaultValue:"1",className:"header-background-editor__scale"}),r.createElement("svg",{onClick:e=>a(e),style:{width:23,height:23},className:"svg-icon header-background-editor__rotate"},r.createElement("use",{href:"/images/icons.svg#undo"})),r.createElement("svg",{onClick:()=>c(),style:{width:23,height:23},className:"svg-icon header-background-editor__remove"},r.createElement("use",{href:"/images/icons.svg#times-circle-solid"}))),r.createElement("div",{className:"header-background-editor__submit"},r.createElement(He.Z,{type:"button",onClick:()=>s(this.editor),label:"Сохранить"}),r.createElement(He.Z,{type:"button",extraClasses:"btn-outline-secondary",onClick:()=>t(!1),label:"Отменить"}))))}}Pu.propTypes={headerBackgroundEditor:f().object,image:f().string,type:f().string,handleToggleEditor:f().func,handleInitState:f().func,handleScale:f().func,handleRotateLeft:f().func,handleChangePosition:f().func,handleSaveImage:f().func,handleDropImage:f().func,handleNewImage:f().func,handleRemove:f().func};const wu=(0,i.$j)((e=>({headerBackgroundEditor:e.headerBackgroundEditor})),(e=>({handleToggleEditor:t=>{e(iu("backgroundEditor",t))},handleInitState:t=>{e((e=>t=>{t({type:"BACKGROUND_EDITOR_INIT_STATE",object:e})})(t))},handleScale:t=>{e((e=>{const t=parseFloat(e.target.value);return e=>{e({type:"BACKGROUND_EDITOR_SET_SCALE",scale:t})}})(t))},handleRotateLeft:t=>{e((e=>(e.preventDefault(),(e,t)=>{e({type:"BACKGROUND_EDITOR_SET_ROTATE",rotate:t().headerBackgroundEditor.rotate-90})}))(t))},handleRemove:()=>{e((e=>{e({type:"BACKGROUND_EDITOR_SET_IMAGE",image:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",isEmpty:!0})}))},handleSaveImage:t=>{e((e=>(t,n)=>{const a=n();let s=null;const r=a.headerBackgroundEditor.isEmpty,o=a.headerBackgroundEditor.type,i=e.getImage().toDataURL();fetch(i).then((e=>e.blob())).then((e=>{if(r)return null;const t=new(pu());t.append("query","mutation {uploadPhoto {id, photo_original}}"),t.append("photo",e);const n={project:"comments",body:t};return(0,yt.Z)(n)})).then((e=>{if(r)return null;if(!e)throw new Error("image bad response");s=e.data.uploadPhoto.photo_original})).then((()=>{if("blog"===o){const e=a.app.site.id;return Promise.resolve(Fp.setSiteSettings(e,{about:{background:s}}))}if("profile"===o){const e=a.app.person.id;return Promise.resolve(Tt.Z.setPersonSettings(e,{personal:{background:s}}))}})).then((()=>{t({type:"SECONDARY_HEADER_TOGGLE",block:"backgroundEditor",show:!1}),t({type:"APP_SET_BACKGROUND",scope:o,image:s})})).catch(D.Z.promiseHandler("/index.js"))})(t))},handleDropImage:t=>{e((e=>t=>{t({type:"BACKGROUND_EDITOR_DROP_IMAGE",image:e[0],isEmpty:!1})})(t))},handleChangePosition:t=>{e((e=>t=>{t({type:"BACKGROUND_EDITOR_SET_POSITION",position:e})})(t))},handleNewImage:t=>{e((e=>t=>{t({type:"BACKGROUND_EDITOR_SET_IMAGE",image:e.target.files[0],isEmpty:!1})})(t))}})))(Pu);var Iu="/index.js";
/**
 * Mirtesen.
 *
 * API interface for Subscription.
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const Cu=class{joinToSite=async(e,t)=>{try{return await R.Z.request({query:`mutation {\n                    joinToSite(siteId: ${e}, join: ${t}, layout: LAYOUT_WEB)\n                  }`,endpoint:{endpoint:"blogs",ver:"v1"}})}catch(e){D.Z.promiseHandler(Iu)(e)}};subscribeToSite=async(e,t)=>{try{return await R.Z.request({query:`mutation {\n                    subscribeToSite(siteId: ${e}, subscribe: ${t})\n                  }`,endpoint:{endpoint:"blogs",ver:"v1"}})}catch(e){D.Z.promiseHandler(Iu)(e)}}};const Nu=
/**
 * Mirtesen.
 *
 * API interface for Friend.
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class{getList=async(e=0,t=0,n={})=>{try{return await R.Z.request({query:`query {\n                    myFriendsList(count: ${t}, offset: ${e}, counters: true)  {\n                        id\n                        display_name\n                        url\n                        photo_original\n                        unread_count\n                    }\n                }`,endpoint:{endpoint:"main",ver:"v1"},req:n.req,res:n.res})||[]}catch(e){D.Z.promiseHandler("/index.js")(e)}}};var Ou="/index.js";
/**
 * Mirtesen.
 *
 * LeftMenu Actions.
 *
 * @author       Sergey Khripunov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const Mu=(e="FILTER_MEMBER")=>(t,n)=>{const a=n().leftMenu.initialCount;(new Xo.Z).getList(0,a,"FILTER_MEMBER").then((n=>{void 0!==n&&t({type:"LEFT_MENU_REFRESH_SITES_LIST",items:n.items,total:n.total,requestCount:a,filter:e})})).catch(D.Z.promiseHandler(Ou))};var ku="/index.js";
/**
 * Mirtesen.
 *
 * Subscribe btn Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const Au=(e,t,n=(()=>{}))=>a=>{(new Cu).joinToSite(e,t).then((n=>{"undefined"!==n&&(a({type:"BLOG_SUBSCRIPTION_JOIN_TO_SITE",isMember:t,objectId:e}),a({type:"ACTION_JOIN_TO_SITE",isMember:t,success:n}),a(Mu("FILTER_MEMBER")))})).then(n).catch(D.Z.promiseHandler(ku))},xu=(e,t)=>n=>{(new Cu).subscribeToSite(e,t).then((a=>{"undefined"!==a&&(n({type:"BLOG_SUBSCRIPTION_SUBSCRIBE_TO_SITE",isSubscribed:t,objectId:e}),n({type:"ACTION_SUBSCRIBE_TO_SITE",isSubscribe:t,success:a}))})).catch(D.Z.promiseHandler(ku))},Lu=({siteId:e,isMember:t,isSubscribed:n,isOwner:a,isBlocked:s,onClickHandler:o,onJoinToSite:i,onSubscribeToSite:l})=>t||s?a?r.createElement("div",{className:"secondary-header__subscribe__list"},r.createElement("span",{className:"secondary-header__subscribe__list__sub-btn disabled"},"Вы - владелец сайта")):s?r.createElement("div",{className:"secondary-header__subscribe__list"},r.createElement("span",{className:"secondary-header__subscribe__list__sub-btn disabled"},"Вы в черном списке сайта")):r.createElement("div",{className:"secondary-header__subscribe__list"},r.createElement("span",{className:"secondary-header__subscribe__list__sub-btn",onClick:()=>{l(e,!n)}},!n&&r.createElement(yn.Z,{iconName:"check"}),"Не получать рассылку"),r.createElement("span",{className:"secondary-header__subscribe__list__sub-btn",onClick:()=>{i(e,!1,o)}},"Не читать")):null,Du=(0,r.memo)(Lu),Ru=({siteId:e,subscribeObject:t,appearance:n,isMini:a=!1,extraClasses:s,isOwner:o,isLogged:i,isBlocked:l,onOpenAuthForm:c,onClickHandler:m,onJoinToSite:d,onSubscribeToSite:p})=>{const[u,g]=(0,r.useState)(!1),{isMember:h,isSubscribed:E,isStaff:f}=t;return a?l?null:r.createElement(He.Z,{appearance:n,label:h?"Отписаться":"Подписаться",color:h&&"link"!==n?"secondary":"primary",title:h?"Отписаться":"Подписаться",extraClasses:s,onClick:t=>{t.stopPropagation(),i?d(e,!h,m):c()}}):r.createElement(G.Z,{placement:"auto-left",buttonProps:(()=>{let t="Подписаться",a="cross";return h&&(u&&!f?(t="Отписаться",a="close"):(t="Подписаны",a="check")),{appearance:n,label:t,icon:"link"===n?"":a,title:t,extraClasses:_()(n,`${n}-${h&&"link"!==n?"secondary":"primary"}`),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),onClick:t=>{t.stopPropagation(),i?o||l||d(e,!h,m):c()}}})(),openByHover:!0},r.createElement(Du,{siteId:e,isMember:h,isSubscribed:E,isBlocked:l,isOwner:o,onClickHandler:m,onSubscribeToSite:p,onJoinToSite:d}))},Zu=(0,r.memo)(Ru),Bu=({siteId:e,appearance:t=xc.BUTTON,isMini:n=!1,extraClasses:a,wrapClasses:s,onClickHandler:o,onlyForNotSubscribed:i})=>{const l=(0,aa.C)((e=>e.blogSubscription)),c=(0,aa.T)(),m=(0,r.useCallback)(((e,t,n)=>c(Au(e,t,n))),[c]),d=(0,r.useCallback)(((e,t)=>c(xu(e,t))),[c]),p=(0,r.useCallback)((()=>c(_e("login"))),[c]),u=e&&l[e]||Dc,{isOwner:g,initialSubscribeStatus:h,isBlocked:_}=u,E=!i||!h;return r.createElement(qn,{onIntersection:([t])=>{var n;t&&e&&!l[e]&&c((n=e,async e=>{try{const t=await Xo.Z.getMembershipStatus(n);t&&e({type:"BLOG_SUBSCRIPTION_INIT_STATE",objectId:n,state:{isMember:t.is_member,isSubscribed:t.is_subscribed,isStaff:t.is_staff,isOwner:t.is_owner,initialSubscribeStatus:t.is_member||t.is_subscribed,isBlocked:t.isBlocked}})}catch(e){D.Z.promiseHandler(ku)(e)}}))},margin:"200px",extraClasses:s},e&&l[e]&&E?r.createElement(Zu,{siteId:e,subscribeObject:u,isOwner:g,isBlocked:_,appearance:t,isMini:n,extraClasses:a,onClickHandler:o,onJoinToSite:m,onSubscribeToSite:d,isLogged:b.ZP.isLogged(),onOpenAuthForm:p}):null)},$u=(0,r.memo)(Bu),Uu=(0,r.memo)((({isAuthentic:e})=>e&&r.createElement(r.Fragment,null,r.createElement("div",{className:"secondary-header__authentic-account",id:"tooltip-authentic"},r.createElement("div",{className:"secondary-header__authentic-account-ico-bg"},r.createElement("div",{className:"secondary-header__authentic-account-ico-сheck"}))),r.createElement(lt,{target:"tooltip-authentic",id:"tooltip-authentic",placement:"bottom-end",content:"Подлинная учетная запись публичной личности или страницы",offset:[0,8]}))));Uu.propTypes={isAuthentic:f().bool};const Hu=Uu;
/**
 * Mirtesen.
 *
 * Online status component.
 *
 * @author       Vitatly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Fu extends r.PureComponent{constructor(e){super(e),this.state={visitTime:""}}monthNames={1:"января",2:"февраля",3:"марта",4:"апреля",5:"мая",6:"июня",7:"июля",8:"августа",9:"сентября",10:"октября",11:"ноября",12:"декабря"};prepareOnlineStatus=()=>{const{onlineStatus:e}=this.props;return"online"===e?r.createElement("div",{className:"secondary-header__visit-status__online"},"Онлайн"):"offline"===e?"":(this.prepareVisitDate(e),r.createElement("div",{className:"secondary-header__visit-status__date"},this.state.visitTime))};prepareVisitDate=e=>{const t=c()(e).local().format("YYYY-MM-DD H:mm"),[n,a]=t.split(" "),s=c()(c()().local().format("YYYY-MM-DD")).diff(c()(n),"days");if(s)if(1===s)this.setState({visitTime:`Последний визит — вчера в ${a}`});else{const e=n.split("-"),t=+e[1],s=this.monthNames[t],r=+e[2];this.setState({visitTime:`Последний визит — ${r} ${s} в ${a}`})}else this.setState({visitTime:`Последний визит — сегодня в ${a}`})};render(){const{onlineStatus:e}=this.props;return r.createElement("div",{className:"secondary-header__visit-status"},e&&this.prepareOnlineStatus())}}Fu.propTypes={onlineStatus:f().string,sex:f().number};const ju=(0,i.$j)((e=>({onlineStatus:L()(e,"app.person.profileInfo.onlineStatus")})))(Fu);
/**
 * Mirtesen.
 *
 * Secondary header component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Gu extends r.PureComponent{constructor(e){super(e),this.state={sendMessagePopup:!1}}render(){const{secondaryHeader:e,toggleEditor:t,canEdit:n,type:a,mini:s,primaryTitle:o,subscribers:i,headerImage:l,logoImage:c,logoUrl:m,authenticAccount:d,personId:p,onlineStatus:u,layout:g,blogMenuItems:h,showSubscribersAmount:E,site:f}=this.props,b=f.id,y=h.findIndex((({selected:e})=>e)),v=h[y]?.seoTitle,T="PostListLayout"===g&&-1===y?"h1":"h2",S={"secondary-header":!0,"mobile-show":30496446919===b};S[`secondary-header_${a}`]=!0;const P={},w={"secondary-header__top":!0};l&&(P.backgroundImage=`url(${l})`,w["secondary-header__top_has-background"]=!0);const I=!s&&(l||n);return r.createElement(r.Fragment,null,r.createElement("div",{id:"secondary-header",className:_()(S)},r.createElement(r.Fragment,null,I&&r.createElement("div",{className:_()(w),style:P},n&&r.createElement("div",{className:"header-background-editor__switcher"+(!l||e.backgroundSwitcher?" active":""),onClick:()=>t("backgroundEditor",!0)},r.createElement("svg",{className:"svg-icon large",id:"background-switcher-desktop"},r.createElement("use",{href:"/images/icons.svg#edit"})),r.createElement("svg",{className:"svg-icon large",id:"background-switcher-mobile"},r.createElement("use",{href:"/images/icons.svg#cross"})),r.createElement("span",null,"Загрузить обои профиля")),e.backgroundEditor&&r.createElement(wu,{image:l,type:a})),r.createElement("div",{className:_()("secondary-header__middle",{"secondary-header__middle_user-profile":"PeopleTwoColumnLayout"===g,"secondary-header__middle_with-top":I})},r.createElement("div",{id:"secondary-header-logo",className:_()({"secondary-header__logo-outer":!0,"secondary-header__online":"online"===u}),onClick:()=>{n&&t("logoEditor",!0)}},n&&r.createElement("div",{className:"secondary-header__logo-editor-button"},r.createElement("svg",{className:"svg-icon"},r.createElement("use",{href:"/images/icons.svg#cross"}))),r.createElement("div",{className:"secondary-header__logo-wrap"},r.createElement(Mn.Z,{logoInfo:{userName:o,logoImg:c,logoUrl:n?void 0:Fp.addUtmToUrl(m),logoClassName:"userlogo_xl",size:"av80"}}))),e.logoEditor&&r.createElement(oa.Z,{target:"secondary-header-logo",show:!0,onClose:()=>t("logoEditor",!1)},r.createElement(gu,{image:c,type:a})),r.createElement("div",{className:"secondary-header__title-wrap",onMouseOver:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),t("titleSwitcher",!0)},onMouseOut:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),t("titleSwitcher",!1)}},r.createElement("div",{className:"secondary-header__title-subscribers"},o&&!e.titleEditor&&r.createElement(T,{className:"secondary-header__title"},r.createElement("a",{className:"secondary-header__title-link",href:Fp.addUtmToUrl(m),style:{color:"profile"===a?Xp.Z.getHslColorByName(o):"#000"},rel:"nofollow"},o),r.createElement(Hu,{isAuthentic:Fp.isSiteMatch("verifiedBlogs")||d})),e.titleEditor&&r.createElement(Su,{primaryTitle:o,isBlog:"blog"===a}),"blog"===a&&!1!==E&&r.createElement("i",{className:"secondary-header__subscribers"},i),"profile"===a&&r.createElement(ju,null)),n&&!e.titleEditor&&r.createElement("svg",{className:"svg-icon large blog-title-editor__switcher"+(e.titleSwitcher?" active":""),onClick:()=>t("titleEditor",!0)},r.createElement("use",{href:"/images/icons.svg#edit"}))),"blog"===a&&r.createElement($u,{siteId:b}),"profile"===a&&!n&&pd.isLogged()&&r.createElement(ou,{userId:p}))),v&&r.createElement("h2",{className:"secondary-header__section-name"},v)))}}Gu.defaultProps={type:"blog",canEdit:!1,mini:!1,primaryTitle:null,primaryUrl:null,secondaryTitle:null,subscribers:null,headerImage:null,logoImage:null,logoUrl:null},Gu.propTypes={secondaryHeader:f().object,toggleEditor:f().func,canEdit:f().bool,type:f().string,mini:f().bool,primaryTitle:f().string,subscribers:f().string,headerImage:f().string,logoImage:f().string,logoUrl:f().string,authenticAccount:f().bool,personId:f().oneOfType([f().string,f().number]),lastName:f().string,onlineStatus:f().string,layout:f().string,blogMenuItems:f().array,showSubscribersAmount:f().bool,site:f().object};const qu=(0,i.$j)((e=>({secondaryHeader:e.secondaryHeader,personId:e.app.userId,onlineStatus:L()(e,"app.person.profileInfo.onlineStatus"),layout:e.app.layout,blogMenuItems:e.leftMenu.blogMenu.menuItems,site:L()(e,"app.site",{})})),(e=>({toggleEditor:(t,n)=>{e(iu(t,n))}})))(Gu);function Vu(){return Vu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Vu.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Secondary header decorator component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const zu=n(8778).pluralize;class Wu extends r.PureComponent{constructor(e){super(e)}getValues(){const{app:e,type:t,blogPost:n,channel:a}=this.props;let s=null,r=null,o=null,i=null,l=null,c=null,m=null,d=!1,p=!1,u=!1;const g=e.site?.showSubscribersAmount;if("blog"===t){const t={...L()(e,"siteBuilder.mainLogo.props")},a={...L()(e,"siteBuilder.mainHeader.props",{})};r=L()(t,"imageUrl")||L()(e,"site.mainDomain")||"/",o=L()(t,"image")||L()(e,"site.photo")||null,i=a.image||null,null!==i&&"object"==typeof i&&(i=i.src||null),l=Fp.getTitle(e),c="/",s=L()(e,"site.members_count"),s=this.normalizeSpace(s).concat(" ",zu(s,"подписчик","подписчика","подписчиков")),d=pd.canAdminBlog(),p=["blogPost","blogPostDispute"].includes(L()(e,"page")),p&&(m=n.title)}else"profile"===t?(r=L()(e,"person.url")||"/",o=L()(e,"person.photo_original"),l=L()(e,"person.display_name"),c=L()(e,"person.url")||"/",s=L()(e,"person.count_friends"),i=L()(e,"person.cover"),u=L()(e,"person.isAuthenticAccount"),s=this.normalizeSpace(s||0).concat(" ",zu(s,"друг","друга","друзей")),d=pd.canEditProfile(),p=["userInterests"].includes(L()(e,"page"))):"channel"===t&&(r="/channel/"+L()(a,"info.name"),o=L()(a,"info.avatar"),l=L()(a,"info.title"),c="/channel/"+L()(a,"info.name"),i=L()(a,"info.cover"),u=L()(a,"info.trusted"),d=!1);return{subscribers:s,logoUrl:r,logoImage:o,headerImage:i,primaryTitle:l,primaryUrl:c,secondaryTitle:m,canEdit:d,mini:p,authenticAccount:u,showSubscribersAmount:g}}normalizeSpace(e,t=3){const n=e.toString().split("");for(let e=n.length-t,a=0;e>a;e-=t+1)n.splice(e,0," "),e++;return n.join("")}render(){const e=this.getValues();return r.createElement(qu,Vu({},this.props,this.state,e))}}Wu.defaultProps={type:"blog"},Wu.propTypes={app:f().object,type:f().string,blogPost:f().object};const Yu=(0,i.$j)((e=>({app:e.app,blogPost:e.blogPost,channel:e.channel})),(()=>({})))((0,ae.Z)(Wu,"secondaryHeaderDecorator"));var Ku=n(3689),Ju="/index.js";
/**
 * Mirtesen.
 *
 * Feedback.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Xu="\n    id\n    date\n    title\n    text\n    answered\n",Qu=`\n    issue {\n        ${Xu}\n    }\n    issueNotes {\n        date\n        text\n    }\n`;const eg=class{static getList=e=>{const t={project:"main",body:JSON.stringify({query:`query {\n                    getFeedback {\n                        ${Xu}\n                    }\n                }`})};return(0,yt.Z)({...e,...t}).then((e=>L()(e,"data.getFeedback",[]))).catch((e=>{D.Z.promiseHandler(Ju)(e)}))};static getById=(e,t)=>{const n={project:"main",body:JSON.stringify({query:`query {\n                        getFeedbackById(id: ${e}) {\n                            ${Qu}\n                        }\n                }`})};return(0,yt.Z)({...t,...n}).then((e=>L()(e,"data.getFeedbackById",{}))).catch((e=>{D.Z.promiseHandler(Ju)(e)}))};static addIssue=({email:e,title:t,text:n,categoryId:a},s)=>{const r=[`title: "${t}",`,`text: "${n}",`,`categoryId: ${a}`,e?`email: "${e}"`:null,'captcha: ""'].join("\n"),o={project:"main",body:JSON.stringify({query:`mutation {\n                    addIssue(\n                        ${r}\n                    )\n                }`})};return(0,yt.Z)({...s,...o}).then((e=>L()(e,"data.addIssue",null))).catch((e=>{D.Z.promiseHandler(Ju)(e)}))}};
/**
 * Mirtesen.
 *
 * Feedback actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
*/
const tg=(e,t=null)=>async n=>{const a={activeTab:e};return"currentTicket"===e&&(a.currentTicket=await eg.getById(t)),"tickets"===e&&(a.tickets=await eg.getList()),n({type:"FEEDBACK_SET_TAB",object:a})},ng=(e="feedback",t,n={})=>({type:"FEEDBACK_TOGGLE_MODAL",formType:e,value:t,params:n});
/**
 * Mirtesen.
 *
 * Friend list
 *
 * @author       Kukharev Yuri.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ag extends r.PureComponent{render(){const{className:e,title:t,count:n,total:a,personId:s,showUserCard:o}=this.props;let{items:i}=this.props;if(i=i||[],i.length<1)return null;const l=_()({"friend-list":!0},e.split(","));return i=i.slice(0,n),r.createElement("div",{className:l},t&&r.createElement("h5",null,t),r.createElement("div",{className:"friend-list__items"},i.map(((e,t)=>o?r.createElement(cg,{userId:e.id,key:t,href:e.url},r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo_original,logoClassName:"userlogo_s",title:e.display_name}})):r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo_original,logoUrl:e.url,logoClassName:"userlogo_s",title:e.display_name},key:t}))),s&&a-n>0&&r.createElement("a",{href:`/people/${s}/friends`,className:"friend-list__count"},a-n)))}}ag.defaultProps={className:"",title:null,items:[],count:7,total:0,personId:null,showUserCard:!0},ag.propTypes={className:f().string,title:f().string,items:f().array,count:f().number,total:f().number,personId:f().number,showUserCard:f().bool};const sg=ag;
/**
 * Mirtesen.
 *
 * User card popup.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class rg extends r.PureComponent{constructor(e){super(e),this.delayTimer=null}componentDidMount(){const{getUser:e,userId:t}=this.props;this.delayTimer&&clearTimeout(this.delayTimer),this.delayTimer=setTimeout((()=>{e(t)}),200)}componentWillUnmount(){const{clearData:e}=this.props;this.delayTimer&&clearTimeout(this.delayTimer),e()}render(){const{target:e,userId:t,userCard:n}=this.props,{userName:a,logoImg:s,friends:o,numberOfFriends:i,loaded:l}=n;if(!l)return null;const c=`/people/${t}`,m=b.ZP.getCurrentUserId();return r.createElement(oa.Z,{target:e,className:"user-card-popup"},r.createElement("div",{className:"user-card-popup__info"},r.createElement(Mn.Z,{className:"user-card-popup__avatar",logoInfo:{userName:a,logoImg:s,logoUrl:c,linkTarget:"_blank"}}),r.createElement("a",{className:"user-card-popup__name",style:{color:Xp.Z.getHslColorByName(a)},href:c},a),r.createElement(sg,{title:"Друзья:",items:o,count:4,total:i,personId:t,showUserCard:!1})),m&&m!==t&&r.createElement("div",{className:"user-card-popup__footer"},r.createElement(ou,{userId:t,className:"user-friend-actions_card",enableBlogModeration:!1})))}}rg.propTypes={userId:f().number,target:f().oneOfType([f().string,f().object]),userCard:f().object,clearData:f().func,getUser:f().func};const og=(0,i.$j)((e=>({userCard:e.userCard})),(e=>({getUser:t=>{e((e=>async t=>{Promise.all([Tt.Z.getById(e),Tt.Z.getUsersRelationStatus([e])]).then((([n,a])=>{a=a[e],t({type:"USER_FRIEND_ACTIONS_INIT",userId:e,friendshipStatus:a.friendshipStatus,isFollowingFor:a.isFollowingFor,isIgnoreUser:a.isIgnoreUser,isIgnoredByUser:a.isIgnoredByUser,canAbuseUser:a.canAbuseUser}),t({type:"USER_CARD_GET_USER",loaded:!0,userName:n.display_name,logoImg:n.photo_original,friends:n.profileInfo?.friends?.items||[],numberOfFriends:n.count_friends,canViewProfile:n.canViewProfile})})).catch(D.Z.promiseHandler("/index.js"))})(t))},clearData:()=>{e((e=>e({type:"USER_CARD_CLEAR_DATA"})))}})))(rg);function ig(){return ig=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ig.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * User card switcher
 *
 * @author       Kukharev Yuri.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class lg extends r.PureComponent{constructor(e){super(e),this.target=r.createRef(),this.state={active:!1}}render(){const{children:e,userId:t,href:n,tagName:a,...s}=this.props,{active:o}=this.state,i=a;return t?r.createElement(i,ig({onMouseEnter:()=>{this.setState({active:!0})},onMouseLeave:()=>{this.setState({active:!1})},ref:this.target,href:n},s),e,o&&r.createElement(og,{target:this.target.current,userId:t})):null}}lg.defaultProps={tagName:"a",href:null},lg.propTypes={children:f().any,userId:f().number,tagName:f().string,href:f().string};const cg=lg,mg=n(8778).pluralize;class dg extends r.PureComponent{getSymbolsCountMyFriends=()=>{const{parentWidth:e}=this.props;return e>=200?Math.ceil(e/16):15};render(){const{leftMenu:e,userInfo:t,badge:n,onClickMenuItem:a,baseUrl:s}=this.props,{listFriends:o}=e;return r.createElement("div",{className:"left-menu__item"},r.createElement("a",{className:"left-menu__item_title",href:s+"/people/"+t.id+"/friends"},r.createElement("span",{id:"friend-menu-tooltip"},"Мои друзья")),o.items.map(((e,t)=>r.createElement(cg,{className:"left-menu__item_element user",userId:e.id,href:e.url,key:t,onClick:t=>{"function"==typeof a&&(t.preventDefault(),a(e))}},r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo_original,logoClassName:"userlogo_xs"}}),e.status>0&&r.createElement("span",{className:"left-menu__item_element-online"}),r.createElement("span",{className:"left-menu__item_element-text"},y.Z.truncateString(e.display_name,this.getSymbolsCountMyFriends())),n(e.unread_count)))),t.count_friends>o.items.length&&r.createElement("a",{className:"left-menu__item_button",href:s+"/people/"+t.id+"/friends"},"Ещё"," ",t.count_friends-o.items.length," ",mg(t.count_friends-o.items.length,"друг","друга","друзей"),"..."))}}dg.propTypes={leftMenu:f().object,userInfo:f().object,parentWidth:f().number,badge:f().func,onClickMenuItem:f().func,baseUrl:f().string};const pg=dg,ug=n(8778).pluralize;class gg extends r.PureComponent{getSymbolsCountMySites=()=>{const{parentWidth:e}=this.props;return e>=200?Math.floor(e/13):20};render(){const{leftMenu:e,filter:t,onClickMenuItem:n,baseUrl:a}=this.props,{listSites:s}=e,o="FILTER_MEMBER"===t?"mySubscriptions":"mySites",{items:i,total:l}=s[o];return r.createElement(r.Fragment,null,e&&i.length>0&&r.createElement("div",{className:"left-menu__item"},r.createElement("a",{className:"left-menu__item_title",href:`${a}/rating/my-${"FILTER_MEMBER"===t?"subscriptions":"sites"}`},"FILTER_MEMBER"===t?"Мои подписки":"Мои каналы"),i.map(((e,t)=>r.createElement("a",{className:"left-menu__item_element",href:e.url,key:t,onClick:t=>{"function"==typeof n&&(t.preventDefault(),t.persist(),n(t,e))}},r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo,logoClassName:"userlogo_xs"}}),r.createElement("span",{className:"left-menu__item_element-text"},y.Z.truncateString(e.display_name,this.getSymbolsCountMySites()))))),l>i.length&&r.createElement("a",{className:"left-menu__item_button",href:`${a}/rating/my-${"FILTER_MEMBER"===t?"subscriptions":"sites"}`},"Ещё"," ",l-i.length," ",ug(l-i.length,"сайт","сайта","сайтов"),"...")))}}gg.propTypes={leftMenu:f().object,userInfo:f().object,parentWidth:f().number,filter:f().string,onClickMenuItem:f().func,baseUrl:f().string};const hg=gg;
/**
 * Mirtesen.
 *
 * Topics menu.
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class _g extends r.PureComponent{render(){const{isDropdownVisible:e,onToggleTopicMenu:t,topics:n,topicDomain:a}=this.props,s=e?n:n.slice(0,5),o=s.length>5?r.createElement("button",{className:"left-menu__item_button",onClick:()=>t(e)},"Свернуть",r.createElement(yn.Z,{iconName:"angle-up"})):r.createElement("button",{className:"left-menu__item_button",onClick:()=>t(e)},"Показать все",r.createElement(yn.Z,{iconName:"angle-down"}));return r.createElement("div",{className:"left-menu__item",id:"topics-menu"},r.createElement("div",{className:"left-menu__item_title",id:"topics-menu-title"},"Рубрики"),s.map(((e,t)=>{const n="coronavirus"===e.key||"crysis"===e.key?e.key+"-black":e.key,s=`//${a}/topic/${e.key}?utm_medium=from_left_sidebar`;return r.createElement("a",{className:"left-menu__item_element",href:s,key:t,onClick:t=>{"promokod"===e.key&&(t.preventDefault(),na.ym("reachGoal","click_promokod_left_sidebar"),window.location.href=s)}},r.createElement("span",null,r.createElement("img",{src:`//static.mtml.ru/images/topics/${n.toLowerCase()}.svg`,alt:e.key,loading:"lazy",width:"16",height:"16"})),r.createElement("span",{id:"promokod"===e.key?"promokod-tooltip":null},e.text))})),s.length>0&&o)}}_g.propTypes={topics:f().array,topicDomain:f().string,isDropdownVisible:f().bool,onToggleTopicMenu:f().func};const Eg=_g,fg=({menuItems:e,title:t="",enableIcons:n=!0,id:a="",onToggleFeedbackModal:s})=>r.createElement("div",{className:"left-menu__item",id:a||null},t&&r.createElement("div",{className:"left-menu__item_title left-menu__item_header"},t),e.map(((e,t)=>{const{link:a,text:o,target:i="_self",icon:l="",w:c,h:m}=e,d="Мессенджер МТ"===o,p="Обратная связь"===o,u="Пожаловаться на спам"===o,g=d?["btn","btn-primary","btn-primary_left-menu"]:"left-menu__item_element",h=d?l+"White":l;return r.createElement("a",{key:t,href:a,className:_()(g),target:i,id:d?"app-tooltip":null,onClick:e=>{(p||u)&&(e.preventDefault(),s(p?"feedback":"spam",!0))}},d?r.createElement("svg",{className:"svg"},r.createElement("use",{href:"/images/icons.svg#app-icon"})):n&&l&&r.createElement("span",null,r.createElement("img",{src:`//static.mtml.ru/images/icons_v2/${h}.svg`,alt:o,loading:"lazy",width:c,height:m})),r.createElement("span",{className:"left-menu__item_element-text"},o))})));fg.propTypes={title:f().string,menuItems:f().array,enableIcons:f().bool,id:f().string,onToggleFeedbackModal:f().func};const bg=fg;
/**
 * Mirtesen.
 *
 * Blog menu item.
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class yg extends r.PureComponent{constructor(e){super(e),this.state={expanded:!1}}isActive(e="",t){return t&&t.test(e)?1:0}elementLink(e,t="",n="#",a=0,s=0,o=null,i=null,l=null,c=null){const{badge:m=(()=>{})}=this.props,d={"left-menu__item_element":!0};return o&&(d[o]=!0),"###delimiter###"===t?(d["left-menu__item_delimiter"]=!0,d["left-menu__item_element"]=!1,r.createElement("i",{className:_()(d),key:e})):s?(d.active=!0,r.createElement("span",{className:_()(d),key:e,id:l},y.Z.truncateString(t),m(a))):r.createElement("a",{className:_()(d),href:n,key:e,rel:i,id:l,onClick:c?e=>c(e):null},y.Z.truncateString(t),m(a))}render(){const{title:e,menuLinks:t,pageUrl:n,cssClass:a,initialVisibleCount:s}=this.props,{expanded:o}=this.state;if(!t.length)return null;const i={"left-menu__item":!0};a&&(i[a]=!0);const l=o?t:t.slice(0,s);return r.createElement("div",{className:_()(i)},r.createElement("div",{className:"left-menu__item_title left-menu__item_header"},e),l.map(((e,t)=>{const{label:a,url:s,num:r,re:o,active:i,rel:l,tooltipId:c,onClick:m}=e;return this.elementLink(t,a,s,r,i||this.isActive(n,o),null,l,c,m)})),t.length>s&&r.createElement(r.Fragment,null,o&&r.createElement("button",{className:"left-menu__item_button",onClick:()=>{this.setState({expanded:!1})}},"Свернуть",r.createElement(yn.Z,{iconName:"angle-up"})),!o&&r.createElement("button",{className:"left-menu__item_button",onClick:()=>{this.setState({expanded:!0})}},"Показать все",r.createElement(yn.Z,{iconName:"angle-down"}))))}}yg.defaultProps={initialVisibleCount:11},yg.propTypes={title:f().string,menuLinks:f().array,pageUrl:f().string,badge:f().func,initialVisibleCount:f().number,cssClass:f().string};const vg=yg;function Tg(){return Tg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Tg.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * My wall
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const Sg=(0,r.memo)((({menuItems:e,openAuthForm:t})=>{const n=b.ZP.isLogged(),a=e=>{n||(e.preventDefault(),t())};return r.createElement("div",{className:"left-menu__item"},r.createElement("div",{className:"left-menu__item_title left-menu__item_header"},r.createElement("a",{href:"https://mirtesen.ru/",className:"left-menu__item_title-anchor",onClick:a},"Моя лента"),n&&r.createElement("a",{href:"https://mirtesen.ru/settings/interests",className:"settings-icon"},r.createElement("svg",{className:"svg-icon"},r.createElement("use",{href:"/images/icons.svg#settings"})))),e.map(((e,t)=>{const{link:n,text:s,target:o="_self",icon:i,isBold:l,customClass:c=null,tooltipId:m=null,w:d,h:p}=e,u={"left-menu__item_element":!0,"left-menu__item_element_bold":l,[c]:!!c};return r.createElement("a",Tg({key:t,href:n,className:_()(u),target:o},"Глас народа"===s&&{onClick:a}),i&&r.createElement("span",null,r.createElement("img",{src:`//static.mtml.ru/images/icons_v2/${i}.svg`,alt:s,loading:"lazy",width:d,height:p})),r.createElement("span",{id:m},s))})))}));Sg.propTypes={menuItems:f().array,openAuthForm:f().func};const Pg=(0,i.$j)(null,(e=>({openAuthForm:()=>e(_e("login"))})))(Sg),wg=(0,r.memo)((({personVislvl:e,user:t,openAuthForm:n,scope:a,channelInfo:s})=>{const o="channel"===a,i="LEFT_MENU_BUTTON_CREATE_POST_5",l=(0,r.useCallback)((()=>{na.ym("reachGoal","click_new_post_main"),ca.setView(i),t?kt.Z.sendMessage({type:"MT_APP_SHOW_MT_POST_EDITOR",identifier:"default",postId:null,params:{personVislvl:e,author:{id:t.id,name:t.display_name,image:t.photo_original||""},target:{type:o?"channel":"user",id:o&&s?.id||t.id,birthday:o&&t.bdate,channelName:o&&s?.name}}}):n()}),[e,t,a,s]),[c,m]=(0,r.useState)(!1);let d=c&&void 0!==e;return o&&(Sa()(s)||s?.person_id!==t?.id)&&(d=!1),(0,r.useEffect)((()=>{const e=ca.canView(i);m(e)}),[]),d?r.createElement(He.Z,{label:"Создать пост",onClick:l,extraClasses:"left-menu__create-post-btn",color:"primary"}):null}));wg.propTypes={personVislvl:f().string,user:f().object,openAuthForm:f().func,scope:f().string,channelInfo:f().object};const Ig=(0,i.$j)((e=>({personVislvl:e.personSettings.vislvl,user:e.auth.user,scope:e.app.scope,channelInfo:e.channelMain?.info})),(e=>({openAuthForm:()=>e(_e("login"))})))(wg);function Cg(){return Cg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Cg.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Left Menu Container.
 *
 * @author       Sergey Khripunov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class Ng extends r.Component{constructor(e){super(e),this.state={promoTooltipType:null}}componentDidMount(){const{onGetSiteList:e,onGetFriendList:t,onInitialState:n,leftMenu:a,isTopicMenuOpen:s}=this.props,r=a.initialCount;n(window.location.href,s),b.ZP.isLogged()&&(e(0,r,"FILTER_MY"),e(0,r,"FILTER_MEMBER"),t(0,r))}componentDidUpdate(e){const{onGetSiteList:t,userInfo:n,onResetLists:a,leftMenu:s,isTopicMenuOpen:r,onToggleTopicMenu:o,onGetFriendList:i}=this.props,{initialCount:l,isDropdownVisible:c}=s;!e.auth.user||n&&null!==n.id||!(s.listFriends.items.length>0||s.listSites.items.length>0)?!e.auth.user&&n&&(t(0,l),i(0,l)):a(),e.isTopicMenuOpen!==r&&r!==c&&o(c)}handleClickSiteMenuItem=async(e,t)=>{const{onSiteLinkClick:n}=this.props;await(0,yt.Z)({project:"blogs",body:JSON.stringify({query:`mutation {\n                                  registerLastView(object_id: -${t.id})\n                            }`})}),"function"==typeof n&&n(e,{target:"_self",href:t.url})};handleClickFriendMenuItem=async e=>{await(0,yt.Z)({project:"blogs",body:JSON.stringify({query:`mutation {\n                                  registerLastView(object_id: ${e.id})\n                            }`})}),document.location.href=e.url};badge(e=0){return e?r.createElement("span",{className:"badge"},K.Z.format99Plus(e)):null}profileMenu=[{label:"Стена",url:"/people/[MT_USER_ID]/",tab:"wall"},{label:"Публикации",url:"/people/[MT_USER_ID]/blogposts",tab:"blogposts"},{label:"Фото",url:"/people/[MT_USER_ID]/photos",tab:"photos"},{label:"Видео",url:"/people/[MT_USER_ID]/videos",tab:"videos"},{label:"Комментарии",url:"/people/[MT_USER_ID]/comments",tab:"comments"},{label:"Профиль",url:"/people/[MT_USER_ID]/profile",tab:"profile"},{label:"Настройки",url:"/settings",tab:"settings"},{label:"Друзья",url:"/people/[MT_USER_ID]/friends",tab:"friends",tooltipId:"friend-tooltip",onClick:()=>(na.ym("reachGoal","click_friends_profile"),!0)},{label:"Сайты",url:"/people/[MT_USER_ID]/sites",tab:"sites"},{label:"События",url:"/people/[MT_USER_ID]/events",tab:"event"}];tooltipParams={placement:"right-start",offset:[-8,10],className:"leftMenu__tooltip"};displayProfileMenu(){const{app:e}=this.props,t=e.originalUrl,n=L()(e,"person")||{};if(!n.id)return null;const a=n.id,s=b.ZP.getCurrentUserId();let{tab:o="wall"}=L()(e,"req.params")||{};o&&(o=o.toLowerCase());const i=[];return this.profileMenu.map((e=>{const t={...e};t.selected=!1,t.tab===o&&(t.active=!0),("event"!==t.tab&&"settings"!==t.tab||s===a)&&(t.url=t.url.replace("[MT_USER_ID]",a),i.push(t))})),r.createElement(vg,{menuLinks:i,title:n.display_name,pageUrl:t,badge:this.badge,cssClass:"left-menu__item_white"})}render(){const{leftMenu:e,userInfo:t,app:n,onToggleTopicMenu:a,parentWidth:s,topicDomain:o,commonMenuItems:i=[],onToggleFeedbackModal:l}=this.props,{scope:c="blog",page:m}=n,{isDropdownVisible:d,listTopics:p}=e,u=n.originalUrl;let g=Xo.Z.getTitle(n);g=g?y.Z.truncateString(g,18):"";const h="blogPostDispute"===n.page?"nofollow":null,_=re.Z.getConfig();let E=Ku.ZP.toASCII(L()(n,"site.mainDomain","").replace(/^(https?:)?\/\//i,"").toLowerCase());"mirtesen.ru"!==_.mainDomain&&(E=E.replace(/\.mirtesen\.ru$/,"."+_.mainDomain));const f=_.mainProto+"://"+E,v=[],T=[];e.blogMenu.menuItems.length>0&&(T.push({label:"###delimiter###",url:"#",num:null,re:null}),e.blogMenu.menuItems.map((e=>{let t=e.url;t.match(/^https?:/)||(t=f+e.url),v.push({label:e.title,url:t,num:null,re:null,active:e.selected,rel:h})}))),T.push({label:"Новые",url:f+"/blog/latest",num:0,re:/\/blog\/latest/,rel:h},{label:"Лучшие",url:f+"/blog/interesting",num:0,re:/\/blog\/interesting/,rel:h},{label:"Обсуждаемые",url:f+"/blog/commented",num:0,re:/\/blog\/commented/,rel:h},{label:"Комментарии",url:f+"/comments",num:0,re:/\/comments$/,rel:h}),n.site&&n.site.can_view_members&&T.push({label:"Участники сайта",url:f+"/people",num:0,re:/\/people/,rel:h}),n.site&&b.ZP.canAdminBlog()&&T.push({label:"Черный список",url:f+"/edit/blocked",num:0,re:/\/edit\/blocked/,rel:h});const S=L()(e,"listFriends.items"),P=L()(e,"listSites.mySites.items",[]),w=L()(e,"listSites.mySubscriptions.items",[]);return r.createElement("div",{className:"left-menu"},"blog"!==c&&r.createElement(Ig,null),"mt"===c&&"place"===m&&r.createElement(vg,{menuLinks:e.place.items,title:e.place.title,cssClass:"left-menu__item_white"}),"profile"===c&&this.displayProfileMenu(),("blog"===c||"dispute"===c)&&0!==Object.keys(n.site).length&&r.createElement("div",{className:"left-menu__blog"},r.createElement(vg,{menuLinks:v,title:g,pageUrl:u,badge:this.badge,initialVisibleCount:8,cssClass:"left-menu__blog-item"}),r.createElement(vg,{menuLinks:T,pageUrl:u,badge:this.badge,cssClass:"left-menu__blog-item"})),"blog"===c&&b.ZP.canModerate()&&r.createElement(vg,{menuLinks:[{label:"Настройки",url:"/edit",num:0,re:/\/edit$/},{label:"Запланированные",url:"/blog/queued",num:0,re:/\/blog\/queued/},{label:"Ждут модерации",url:"/blog/moderating",num:0,re:/\/blog\/moderating/},{label:"Безопасность",url:"/edit/moderators",num:0,re:/\/edit\/moderators/},{label:"Черновики",url:"/blog/drafts",num:0,re:/\/blog\/drafts/},{label:"Статистика",url:"/stat",num:0,re:/\/stat$/},{label:"Продвижение",url:"/promotion",num:0,re:/\/promotion$/},{label:"Почтовые уведомления",url:"/edit/notifications",num:0,re:/\/edit\/notifications/},{label:"Комментарии",url:"/edit/comments",num:0,re:/\/edit\/comments/}],title:"Управление сайтом",pageUrl:u,badge:this.badge}),r.createElement(Eg,{isDropdownVisible:d,onToggleTopicMenu:a,topics:p,topicDomain:o}),"groups"===n.page&&r.createElement(vg,{menuLinks:[{label:"Сайты",url:"/rating",num:0,re:/\/rating/}],title:"Рейтинги",pageUrl:u,badge:this.badge}),r.createElement(Pg,{menuItems:[{text:"ЧАТЫ",link:"https://mirtesen.ru/chats",icon:"chats",tooltipId:"chats-tooltip",customClass:"left-menu__item_element_chat",w:16,h:16},{text:"Опросы",link:"https://mirtesen.ru/polls",icon:"vote",tooltipId:"polls-tooltip",customClass:"left-menu__item_element_poll",w:28,h:28},{text:"Блогеры",link:"https://mirtesen.ru/bloggers",icon:"IconBloggersColor",tooltipId:"bloggers-tooltip",w:17,h:17},{text:"Глас народа",link:"https://mirtesen.ru/user-posts",icon:"IconUserContent",tooltipId:"user-posts-tooltip",w:16,h:16},{text:"Популярное",link:"https://mirtesen.ru/popular/liked",icon:"IconPopularColor",tooltipId:"popular-posts-tooltip",w:13,h:16},{text:"Обсуждаемое",link:"https://mirtesen.ru/popular/commented",icon:"IconDiscussColor",tooltipId:"commented-posts-tooltip",w:14,h:14}]}),r.createElement(lt,Cg({},this.tooltipParams,{target:"chats-tooltip",id:"chats-tooltip",content:"Публичные групповые чаты"})),r.createElement(lt,Cg({},this.tooltipParams,{target:"polls-tooltip",id:"polls-tooltip",content:"Мнения в Миртесен"})),r.createElement(lt,Cg({},this.tooltipParams,{target:"bloggers-tooltip",id:"bloggers-tooltip",content:"Читайте и комментируйте лучшие авторские посты МирТесен"})),r.createElement(lt,Cg({},this.tooltipParams,{target:"user-posts-tooltip",id:"user-posts-tooltip",content:"Новости пользователей МирТесен"})),r.createElement(lt,Cg({},this.tooltipParams,{target:"popular-posts-tooltip",id:"popular-posts-tooltip",content:"Лучшее в Миртесен"})),r.createElement(lt,Cg({},this.tooltipParams,{target:"commented-posts-tooltip",id:"commented-posts-tooltip",content:"Самое комментируемое в Миртесен"})),b.ZP.isLogged()&&S&&S.length>0&&r.createElement(r.Fragment,null,r.createElement(pg,{leftMenu:e,onClickMenuItem:e=>{this.handleClickFriendMenuItem(e)},userInfo:t,parentWidth:s,badge:this.badge,baseUrl:_.mainProto+"://"+_.mainDomain})),b.ZP.isLogged()&&P.length>0&&r.createElement(hg,{leftMenu:e,onClickMenuItem:this.handleClickSiteMenuItem,parentWidth:s,filter:"FILTER_MY",baseUrl:_.mainProto+"://"+_.mainDomain}),b.ZP.isLogged()&&w.length>0&&r.createElement(hg,{leftMenu:e,onClickMenuItem:this.handleClickSiteMenuItem,parentWidth:s,filter:"FILTER_MEMBER",badge:this.badge,baseUrl:_.mainProto+"://"+_.mainDomain}),r.createElement(bg,{menuItems:i,enableIncons:"ng-index"!==c,id:"common-menu",onToggleFeedbackModal:l}),r.createElement(lt,{target:"app-tooltip",id:"app-tooltip",content:"Новое крутое приложение МирТесен!",placement:"right",className:"leftMenu__tooltip",offset:[0,10]}))}}Ng.propTypes={parentWidth:f().any,leftMenu:f().object,commonMenuItems:f().array,userInfo:f().object,app:f().object,auth:f().object,topicDomain:f().string,onGetSiteList:f().func,onGetFriendList:f().func,onResetLists:f().func,onInitialState:f().func,onToggleTopicMenu:f().func,onToggleFeedbackModal:f().func,isTopicMenuOpen:f().bool,onSiteLinkClick:f().func};const Og=(0,i.$j)((e=>({leftMenu:e.leftMenu,userInfo:e.auth.user,app:e.app,auth:e.auth})),(e=>({onGetSiteList:(t,n,a)=>{e(((e=0,t=0,n="FILTER_MEMBER")=>a=>{(new Xo.Z).getList(e,t,n).then((s=>{if(void 0!==s){const r={items:s.items,total:s.total,filter:n,requestCount:t};if(0===e)return void a({type:"LEFT_MENU_SET_LIST_SITES",...r});a({type:"LEFT_MENU_ADD_LIST_SITES",...r})}})).catch(D.Z.promiseHandler(Ou))})(t,n,a))},onGetFriendList:(t,n)=>{e(((e=0,t=0)=>n=>{(new Nu).getList(e,t).then((a=>{if(void 0!==a){const s={items:a,requestCount:t};if(0===e)return void n({type:"LEFT_MENU_SET_LIST_FRIENDS",...s});n({type:"LEFT_MENU_ADD_LIST_FRIENDS",...s})}})).catch(D.Z.promiseHandler(Ou))})(t,n))},onInitialState:(t,n)=>{e(((e="",t)=>({type:"LEFT_MENU_INITIAL_STATE",url:e,isDropdownVisible:t}))(t,n))},onResetLists:()=>{e({type:"LEFT_MENU_RESET_LISTS"})},onToggleTopicMenu:t=>{e((e=>t=>{t({type:"LEFT_MENU_TOGGLE_TOPIC_MENU",isDropdownVisible:!e})})(t))},onToggleFeedbackModal:(t,n)=>{e(ng(t,n))}})))(Ng);
/**
 * Mirtesen.
 *
 * Sticky implementation for React.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Mg extends r.PureComponent{constructor(e){super(e),this.state={fixed:0,marginTop:0,windowWidth:"undefined"!=typeof window?window.innerWidth:1900},this.lastScrollTop=0,this.bottomOffset=30}componentDidMount(){window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.getWidth),this.getWidth()}componentWillUnmount(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.getWidth)}handleScroll=()=>{const{sidebarBreakpoint:e,position:t}=this.props,{fixed:n,marginTop:a,windowWidth:s}=this.state;if(s<=e)return void this.setState({fixed:0,marginTop:0});const r=window.pageYOffset||document.documentElement.scrollTop,o=this.wrapper.getBoundingClientRect(),i=r+window.innerHeight,l=o.top+r+o.height;window.innerHeight<o.height+t.top&&r>0?n?1===n?r<this.lastScrollTop&&this.setState({fixed:0,marginTop:r-o.height+window.innerHeight}):-1===n&&r>this.lastScrollTop&&this.setState({fixed:0,marginTop:r}):r<this.lastScrollTop?r<a&&this.setState({fixed:-1,marginTop:0}):i>l+this.bottomOffset&&this.setState({fixed:1}):(!n||r<0)&&this.setState({fixed:-1,marginTop:0}),this.lastScrollTop=r};getWidth=()=>{this.setState({windowWidth:window.innerWidth}),this.handleScroll()};render(){const{children:e,position:t,parentWidth:n}=this.props,{fixed:a,marginTop:s}=this.state,o={left:t.left};n&&(o.width=n),s&&(o.marginTop=s);let i="sticky-wrap";return 1===a?i+="-fixed-bottom":-1===a&&(i+="-fixed-top",o.marginTop=t.top),r.createElement("div",{className:i,style:o,ref:e=>{this.wrapper=e}},r.createElement("div",{className:"sticky__content"},e))}}Mg.propTypes={parentWidth:f().number,position:f().object,sidebarBreakpoint:f().number,children:f().oneOfType([f().object,f().array])};const kg=Mg;
/**
 * Mirtesen.
 *
 * Left menu component.
 *
 * @author       Alexey Savchik.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Ag extends r.PureComponent{constructor(e){super(e),this.state={currentPathname:null}}componentDidMount(){"undefined"!=typeof window&&this.setState({currentPathname:window.location.pathname})}render(){const{currentPathname:e}=this.state;return r.createElement(r.Fragment,null,r.createElement("div",{className:"about-platform__menu"},[{text:"Мессенджер МТ",path:"/apps",className:"about-platform__menu_app"},{text:"О компании",path:"/",className:"about-platform__menu_about"},{text:"О редакции ГлагоL",path:"/glagol",className:"about-platform__menu_glagol"},{text:"Новости",path:"/news",className:"about-platform__menu_news"},{text:"Партнерам",path:"/partners",className:"about-platform__menu_partners"},{text:"Рекламодателям",path:"/promo",className:"about-platform__menu_promo"},{text:"Соглашение",path:"/agreement",className:"about-platform__menu_agreement"},{text:"Рекомендательные технологии",path:"/recommendation_rules",className:"about-platform__menu_rules"},{text:"Создать сайт",path:"//mirtesen.ru/create/",className:"about-platform__menu_site about-platform__menu_separated"},{text:"Вернуться в социальную сеть",path:"//mirtesen.ru",className:""}].map(((t,n)=>{const a={[t.className]:!0,current:e===t.path};return r.createElement("a",{key:n,className:_()(a),href:t.path},t.text)}))))}}const xg=Ag,Lg={type:"SITE_SETTINGS_LEFT_MENU_SHOW_DROPDOWN"},Dg={type:"SITE_SETTINGS_LEFT_MENU_HIDE_DROPDOWN"};
/**
 * Mirtesen.
 *
 * Left Menu Container.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Rg extends r.Component{linkElement(e="",t="#",n="",a=null){const{handleClick:s,siteSettings:o}=this.props;let{activeTab:i}=o;"menuEditor"===i?i="menu":"rssEditor"===i?i="rssImport":"domain"===i&&(i="about");const l={"left-menu__item_element":!0,active:n===i};return a&&(l[a]=!0),n===i?r.createElement("span",{className:_()(l),key:t},y.Z.truncateString(e)):r.createElement("a",{className:_()(l),href:t,key:n,onClick:e=>{e.preventDefault(),window.history.pushState(null,"",t),s(n)}},y.Z.truncateString(e))}render(){const{siteSettings:e}=this.props,t=e.sections,n=this;return r.createElement("div",{className:"left-menu"},r.createElement("div",{className:"left-menu__item"},r.createElement("a",{className:"left-menu__item_element",href:"/"},r.createElement("svg",{className:"svg-icon back-to-main"},r.createElement("use",{href:"/images/icons.svg#arrow-left"})),"Выйти")),r.createElement("div",{className:"left-menu__item"},r.createElement("div",{className:"left-menu__item_title"},"Настройки"),Object.keys(t).map((e=>{const a=t[e];if(!0===a.isMenu&&(!a.forDevs||pd.isDeveloper()))return n.linkElement(a.title,"/edit/"+e,e,a.forDevs?"devs-only":null)}))))}}Rg.propTypes={app:f().object,siteSettingsLeftMenu:f().object,siteSettings:f().object,handleShowSitesDropdown:f().func,handleHideSitesDropdown:f().func,handleClick:f().func};const Zg=(0,i.$j)((e=>({app:e.app,siteSettingsLeftMenu:e.siteSettingsLeftMenu,siteSettings:e.siteSettings})),(e=>({handleClick:t=>{e(_u(t))},handleShowSitesDropdown:()=>{e(Lg)},handleHideSitesDropdown:()=>{e(Dg)}})),null,{forwardRef:!0})(Rg);n(25387),n(72608),n(68216),n(79433);var Bg="/index.js";
/**
 * Mirtesen.
 *
 * Person Settings Actions.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const $g=e=>({type:"PERSON_SETTINGS_CHANGE_TAB",tabName:e}),Ug=e=>({type:"PERSON_SETTINGS_SET_INPUT_ERRORS",errors:e}),Hg=e=>({type:"PERSON_SETTINGS_SET_INPUT_VALID",valid:e}),Fg=(e,t,n)=>({type:"PERSON_SETTINGS_CHANGE_VALUE",tabName:e,name:t,value:n}),jg=e=>(t,n)=>{const a=n(),{app:s}=a,r=s.person.id,o={contacts:{}};let i=[];return i.push(e.default||""),i=i.concat(e.confirmed||[]),i=i.concat(e.pending),o.contacts.emails=i,Promise.all([Tt.Z.setPersonSettings(r,o)]).then((([n])=>{n.error?kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:n.title||"При сохранении произошла ошибка."}):t({type:"PERSON_SETTINGS_SET_EMAILS",emails:e})})).catch((e=>{kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e}),D.Z.promiseHandler(Bg)(e)}))},Gg=e=>t=>{!e||e.errors?(t(Ug(e.errors)),kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e.message||kt.Z.systemMessages.saveError})):kt.Z.sendSystemMessage("save")};
/**
 * Mirtesen.
 *
 * Left Menu Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class qg extends r.Component{linkElement(e="",t="#",n="",a=null){const{handleClick:s,personSettings:o}=this.props,{activeTab:i}=o,l={"left-menu__item_element left-menu__text-item":!0,active:n===i};return a&&(l[a]=!0),n===i?r.createElement("span",{className:_()(l),key:t},e):r.createElement("a",{className:_()(l),href:t,key:n,onClick:e=>{e.preventDefault(),window.history.pushState(null,"",t),s(n)}},e)}render(){const{personSettings:e}=this.props,t=e.sections,n=this,a=pd.getCurrentUserId();return r.createElement("div",{className:"left-menu"},r.createElement("div",{className:"left-menu__item"},r.createElement("a",{className:"left-menu__item_element",href:`/people/${a}`},r.createElement("svg",{className:"svg-icon back-to-main"},r.createElement("use",{href:"/images/icons.svg#arrow-left"})),"Выйти")),r.createElement("div",{className:"left-menu__item"},r.createElement("div",{className:"left-menu__item_title"},"Настройки"),Object.keys(t).map((e=>{const a=t[e];if(!0===a.isMenu&&(!a.forDevs||pd.isDeveloper()))return n.linkElement(a.title,"/settings/"+e,e,a.forDevs?"devs-only":null)}))))}}qg.propTypes={app:f().object,personSettingsLeftMenu:f().object,personSettings:f().object,handleClick:f().func};const Vg=(0,i.$j)((e=>({app:e.app,personSettingsLeftMenu:e.personSettingsLeftMenu,personSettings:e.personSettings})),(e=>({handleClick:t=>{e($g(t))}})),null,{forwardRef:!0})(qg);var zg="/index.js";
/**
 * Mirtesen.
 *
 * API interface for Promotion.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const Wg={getSiteAdPromoList:"query getSiteAdPromoList(\n        $siteId: Float!,\n        $types: [object_type]!\n        $limit: Int!,\n        $offset: Int\n    ) {\n        getSiteAdPromoList(\n            siteId: $siteId\n            types: $types\n            status: [STATUS_ACTIVE, STATUS_PENDING]\n            offset: $offset\n            limit: $limit\n        ) {\n            items {\n                id\n                siteId\n                status\n                dateStart\n                dateEnd\n                fullClicks\n                fullClicksLimit\n                dayClicks\n                dayClicksLimit\n                inRotation\n                clickPrice\n                utmSource\n                utmMedium\n                utmCampaign\n                targetGeoIds\n                targetIsMale\n                targetAgeMin\n                targetAgeMax\n                targetTime\n                title\n                canChangeStatus\n            }\n        }\n    }",getSiteAdSettings:"query getSiteAdSettings(\n        $siteId: Float!\n    ) {\n        getSiteAdSettings(\n            siteId: $siteId\n        )\n    }",getSiteAdStats:"query getSiteAdStats(\n        $siteId: Float!,\n        $periodFrom: String!,\n        $periodTo: String! \n    ) {\n        getSiteAdStats(\n            siteId: $siteId\n            startDate: $periodFrom\n            endDate: $periodTo\n        )\n    }",getSiteModerateState:"query getSiteModerateState(\n        $siteId: Float!\n    ) {\n        getSiteModerateState(\n            siteId: $siteId\n        )\n    }",makeSiteAsBusiness:"mutation makeSiteAsBusiness(\n        $siteId: Float!\n    ) {\n        makeSiteAsBusiness(\n            siteId: $siteId\n        )\n    }",refillSiteAdBalance:"mutation refillSiteAdBalance(\n        $siteId: Float!,\n        $amount: Float!\n    ) {\n        refillSiteAdBalance(\n            siteId: $siteId,\n            amount: $amount\n        )\n    }",setSiteAdPromo:"mutation setSiteAdPromo(\n        $id: Float!,\n        $siteId: Float!,\n        $update: Boolean,\n        $status: status,\n        $dateStart: String,\n        $dateEnd: String,\n        $fullClicksLimit: Float,\n        $dayClicksLimit: Float,\n        $clickPrice: Float,\n        $utmSource: String,\n        $utmMedium: String,\n        $utmCampaign: String,\n        $targetGeoIds: [Float],\n        $targetIsMale: Boolean,\n        $targetAgeMin: Int,\n        $targetAgeMax: Int,\n        $targetTime: String\n    ) {\n        setSiteAdPromo(\n            id: $id,\n            siteId: $siteId,\n            update: $update,\n            status: $status,\n            dateStart: $dateStart,\n            dateEnd: $dateEnd,\n            fullClicksLimit: $fullClicksLimit,\n            dayClicksLimit: $dayClicksLimit,\n            clickPrice: $clickPrice,\n            utmSource: $utmSource,\n            utmMedium: $utmMedium,\n            utmCampaign: $utmCampaign,\n            targetGeoIds: $targetGeoIds,\n            targetIsMale: $targetIsMale,\n            targetAgeMin: $targetAgeMin,\n            targetAgeMax: $targetAgeMax,\n            targetTime: $targetTime\n        ) {\n            status\n            errors {\n                key\n                message\n            }\n        }\n    }",setSiteModerateState:"mutation setSiteModerateState(\n        $siteId: Float!,\n        $moderateState: moderate_state\n    ) {\n        setSiteModerateState(\n            siteId: $siteId,\n            moderateState: $moderateState\n        )\n    }"};const Yg=class{static getPromotionStat(e,t,n={}){const a=JSON.stringify(t.periodFrom||ql.data.stats.periodFrom),s=JSON.stringify(t.periodTo||ql.data.stats.periodTo),r={project:"blog",body:JSON.stringify({query:Wg.getSiteAdStats,variables:{siteId:e,periodFrom:a,periodTo:s}})};return(0,yt.Z)({...n,...r}).then((e=>{const t=L()(e,"data.getSiteAdStats");if(t)return JSON.parse(t).tableData})).catch((e=>(D.Z.promiseHandler(zg)(e),null)))}static setSiteAdPromo(e,t,n,a){const s={};s.id=e||null,s.siteId=t||null,s.update=n||!1;["status","dateStart","dateEnd","fullClicksLimit","dayClicksLimit","clickPrice","utmSource","utmMedium","utmCampaign","targetGeoIds","targetIsMale","targetAgeMin","targetAgeMax","targetTime"].forEach((e=>{s[e]=a[e]}));const r={project:"blog",body:JSON.stringify({query:Wg.setSiteAdPromo,variables:s})};return(0,yt.Z)({...r})}static setSiteModerateState(e,t="MODERATE_STATE_PROCESSING"){const n={project:"blog",body:JSON.stringify({query:Wg.setSiteModerateState,variables:{siteId:e,moderateState:t}})};return(0,yt.Z)({...n}).then((e=>{const t=L()(e,"data.setSiteModerateState");if(t)return JSON.parse(t)})).catch(D.Z.promiseHandler(zg))}static refillSiteAdBalance(e,t){const n={project:"blog",body:JSON.stringify({query:Wg.refillSiteAdBalance,variables:{siteId:e,amount:t}})};return(0,yt.Z)({...n}).then((e=>{const t=L()(e,"data.refillSiteAdBalance");if(t)return JSON.parse(t)})).catch(D.Z.promiseHandler(zg))}static getSiteAdSettings(e,t={}){const n={project:"blog",body:JSON.stringify({query:Wg.getSiteAdSettings,variables:{siteId:e}})};return(0,yt.Z)({...t,...n}).then((e=>{const t=L()(e,"data.getSiteAdSettings");if(t)return JSON.parse(t).settings})).catch(D.Z.promiseHandler(zg))}static getSiteModerateState(e,t={}){const n={project:"blog",body:JSON.stringify({query:Wg.getSiteModerateState,variables:{siteId:e}})};return(0,yt.Z)({...t,...n}).then((e=>{const t=L()(e,"data.getSiteModerateState");if(t)return JSON.parse(t).moderateState})).catch(D.Z.promiseHandler(zg))}static makeSiteAsBusiness(e){const t={project:"blog",body:JSON.stringify({query:Wg.makeSiteAsBusiness,variables:{siteId:e}})};return(0,yt.Z)({...t}).then((e=>{const t=L()(e,"data.makeSiteAsBusiness");if(t)return JSON.parse(t).moderateState})).catch(D.Z.promiseHandler(zg))}static getSiteAdPromoList(e,t={},n={}){const a={siteId:e,types:["OBJECT_TYPE_BLOG_POST"],limit:10,offset:0,...t},s={project:"blog",body:JSON.stringify({query:Wg.getSiteAdPromoList,variables:a})};return(0,yt.Z)({...n,...s}).then((e=>L()(e,"data.getSiteAdPromoList.items",null))).catch(D.Z.promiseHandler(zg))}};var Kg=n(13218),Jg=n.n(Kg),Xg=n(35161),Qg=n.n(Xg),eh=n(78718),th=n.n(eh),nh="/index.js";
/**
 * Mirtesen.
 *
 * Promotion Actions.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const ah={itemAdd:{id:{error_doesnt_match:"Объект не найден",error_uniqueness_violated:"Этот объект уже добавлен"}}},sh=e=>({type:"PROMOTION_CHANGE_TAB",tabName:e}),rh=(e,t)=>({type:"PROMOTION_INIT_TAB",tabName:e,data:t}),oh=e=>({type:"PROMOTION_SET_INPUTS_ERRORS",errors:e}),ih=e=>(t,n)=>{if(e.errors)if(e.message&&kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e.message||"При сохранении произошла ошибка"}),Array.isArray(e.errors)){const a={},{activeTab:s}=n().promotion;e.errors.forEach((e=>{a[e.key]=L()(ah,s+"."+e.key+"."+e.message,e.message)})),t(oh(a))}else t(oh(e.errors));else{if(e.error)return void kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e?.title||e?.errorMap||"При сохранении произошла ошибка"});kt.Z.sendSystemMessage("save")}},lh=e=>Jg()(e)?Qg()(e,((e,t)=>({label:"total"===t?"Итог":c()(t).format("DD.MM.YYYY"),visitors:e.clicksCount,credits:e.moneyCount.toFixed(2)}))).reverse():[];
/**
 * Mirtesen.
 *
 * Left Menu Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ch extends r.Component{linkElement(e="",t="#",n="",a=null){const{handleClick:s,promotion:o}=this.props,{activeTab:i}=o,l={"left-menu__item_element":!0};return a&&(l[a]=!0),n===i?(l.active=!0,r.createElement("span",{className:_()(l),key:t},y.Z.truncateString(e))):r.createElement("a",{className:_()(l),href:t,key:n,onClick:e=>{e.preventDefault(),window.history.pushState(null,"",t),s(n)}},y.Z.truncateString(e))}render(){const{promotion:e}=this.props,{data:t}=e,n=e.sections,a=this;return r.createElement("div",{className:"left-menu"},r.createElement("div",{className:"left-menu__item"},r.createElement("a",{className:"left-menu__item_element",href:"/"},r.createElement("svg",{className:"svg-icon back-to-main"},r.createElement("use",{href:"/images/icons.svg#arrow-left"})),"Выйти")),r.createElement("div",{className:"left-menu__item"},r.createElement("div",{className:"left-menu__item_title"},"Продвижение"),Object.keys(n).filter(((e,n)=>!(n>0)||!("none"===t.platform||"rejected"===t.platform))).map((e=>{const t=n[e];if(!0===t.isMenu)return a.linkElement(t.title,"/promotion/"+e,e)}))))}}ch.propTypes={app:f().object,promotion:f().object,handleClick:f().func};const mh=(0,i.$j)((e=>({app:e.app,promotion:e.promotion})),(e=>({handleClick:t=>{e(sh(t))}})),null,{forwardRef:!0})(ch);var dh=n(35860),ph="/index.js";
/**
 * Mirtesen.
 *
 * Edit comments Actions.
 *
 * @author       Oleg Kravchenko.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const uh=e=>({type:"EDIT_COMMENTS_CHANGE_TAB",tabName:e}),gh=e=>t=>{if(e.errors)kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e?.message||"При сохранении произошла ошибка"}),t({type:"EDIT_COMMENTS_SET_INPUTS_ERRORS",errors:e.errors});else{if(e.error)return void kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e?.title||e?.errorMap||"При сохранении произошла ошибка"});kt.Z.sendSystemMessage("save")}},hh=e=>Jg()(e)&&Jg()(e.comments)?Qg()(e.comments,((e,t)=>({label:"total"===t?"Итог":c()(t).format("DD.MM.YYYY"),active:e.active,inactive:e.inactive}))):[],_h=e=>Jg()(e)&&Jg()(e.commentators)?Qg()(e.commentators,((e,t)=>{let n;return n="total"===t?"Итог":"unique"===t?"Уникальных":c()(t).format("DD.MM.YYYY"),{label:n,commentators:e}})):[];
/**
 * Mirtesen.
 *
 * Edit comments left menu Container.
 *
 * @author       Oleg Kravchenko.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Eh extends r.Component{linkElement(e="",t="#",n="",a=null){const{handleClick:s,editComments:o}=this.props,{activeTab:i}=o,l={"left-menu__item_element":!0};return a&&(l[a]=!0),n===i?(l.active=!0,r.createElement("span",{className:_()(l),key:t},y.Z.truncateString(e))):r.createElement("a",{className:_()(l),href:t,key:n,onClick:e=>{e.preventDefault(),window.history.pushState(null,"",t),s(n)}},y.Z.truncateString(e))}render(){const{editComments:e}=this.props,t=e.sections,n=this;return r.createElement("div",{className:"left-menu"},r.createElement("div",{className:"left-menu__item"},r.createElement("a",{className:"left-menu__item_element",href:"/"},r.createElement("svg",{className:"svg-icon back-to-main"},r.createElement("use",{href:"/images/icons.svg#arrow-left"})),"Выйти")),r.createElement("div",{className:"left-menu__item"},r.createElement("div",{className:"left-menu__item_title"},"Комментарии"),Object.keys(t).map((e=>{const a=t[e];if(!0===a.isMenu)return n.linkElement(a.title,"/edit/comments/"+e,e)}))))}}Eh.propTypes={app:f().object,editComments:f().object,handleClick:f().func};const fh=(0,i.$j)((e=>({app:e.app,editComments:e.editComments})),(e=>({handleClick:t=>{e(uh(t))}})),null,{forwardRef:!0})(Eh),bh=JSON.parse('{"O":[{"text":"Мессенджер МТ","link":"https://k41tv.app.link/sidebarlink","target":"_blank","icon":"IconApp","w":"14","h":"14"},{"text":"О компании","link":"https://info.mirtesen.ru/about","target":"_blank","icon":"IconAbout","w":"9","h":"14"},{"text":"О редакции ГлагоL","link":"https://info.mirtesen.ru/glagol","target":"_blank","icon":"icon-glagol","w":"8","h":"13"},{"text":"Новости","link":"https://info.mirtesen.ru/news","target":"_blank","icon":"IconNews","w":"16","h":"14"},{"text":"Партнерам","link":"https://info.mirtesen.ru/partners","target":"_blank","icon":"IconPartners","w":"16","h":"13"},{"text":"Рекламодателям","link":"https://info.mirtesen.ru/promo","target":"_blank","icon":"IconAdvertizing","w":"17","h":"16"},{"text":"Обратная связь","link":"https://mirtesen.ru/feedback/report","target":"_blank","icon":"IconFeedback","w":"16","h":"13"},{"text":"Пожаловаться на спам","link":"https://mirtesen.ru/feedback/report/spam","target":"_blank","icon":"IconSpam","w":"15","h":"14"},{"text":"Соглашение","link":"https://info.mirtesen.ru/agreement","target":"_blank","icon":"IconAgreement","w":"15","h":"16"},{"text":"Рекомендательные технологии","link":"https://info.mirtesen.ru/recommendation_rules","target":"_blank","icon":"IconAgreement","w":"15","h":"16"}]}');
/**
 * Mirtesen.
 *
 * Base partner block.
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class yh extends r.PureComponent{addScript({src:e,onload:t=null,onerror:n=null,id:a=""}){K.Z.loadScript(e,{onload:t,onerror:n,id:a})}}const vh=yh;
/**
 * Mirtesen.
 *
 * Lentainform component.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Th extends vh{componentDidMount(){const{id:e}=this.props,t=new Date,n="https://jsc.lentainform.com/g/l/glagol.mirtesen.ru."+e+".js?t="+(t?""+t.getUTCFullYear()+t.getUTCMonth()+t.getUTCDate()+t.getUTCHours():"");this.addScript({src:n})}render(){const{id:e}=this.props;return r.createElement("div",{id:`M497387ScriptRootC${e}`},r.createElement("div",{id:`M497387PreloadC${e}`}," Загрузка..."))}}Th.propTypes={id:f().oneOfType([f().string,f().number])};const Sh=Th;const Ph=
/**
 * Mirtesen.
 *
 * Smi 24 partner's block.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class extends vh{componentDidMount(){this.addScript({src:"https://jsn.24smi.net/smi.js",onload:this.init})}init=()=>{(window.smiq=window.smiq||[]).push({})};render(){return r.createElement("div",{className:"smi24__informer","data-smi-templatesrc":"https://jsn.24smi.net/b/5/13084.js"})}};const wh=
/**
 * Mirtesen.
 *
 * Smi 24 partner's block.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class extends vh{componentDidMount(){this.addScript({src:"https://jsn.24smi.net/smi.js",onload:this.init})}init=()=>{(window.smiq=window.smiq||[]).push({})};render(){return r.createElement("div",{style:{paddingTop:"30px"}},r.createElement("div",{className:"smi24__informer","data-smi-templatesrc":"https://jsn.24smi.net/a/6/12899.js"}))}};const Ih=
/**
 * Mirtesen.
 *
 * Smi 24 partner's block.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class extends vh{componentDidMount(){this.addScript({src:"https://mirror.smi.fm/js/100099.js",onerror:()=>{this.addScript({src:"https://megasmi.ml/js/100099.js"})}})}render(){return r.createElement("div",{className:"no24_teaser","data-bid":"100099"})}};const Ch=
/**
 * Mirtesen.
 *
 * Gnezdo partner's block.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class extends vh{componentDidMount(){this.addScript({src:"https://news.gnezdo.ru/loader.js",onload:this.init})}init(){const e=window,t="gnezdoAsyncCallbacks";e[t]=e[t]||[],e[t].push((()=>{e.gnezdo.create({tizerId:20503,containerId:"containerId20503"})}))}render(){return r.createElement("div",{id:"containerId20503"})}};
/**
 * Mirtesen.
 *
 * Politpiar component.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Nh extends vh{componentDidMount(){const{id:e}=this.props,t=`https://news.mirtesen.ru/data/js/${e}.js`;this.addScript({src:t,onload:this.init})}init=()=>{if(Array.isArray(window.jsapi)){const e=window.jsapi.length-1;"function"==typeof window.jsapi[e]&&(window.jsapi[e](),window.jsapi.splice(e,1))}};render(){const{id:e,style:t={}}=this.props;return r.createElement("div",{id:`unit_${e}`,style:t})}}Nh.propTypes={id:f().oneOfType([f().string,f().number]),style:f().object};const Oh=Nh;const Mh=
/**
 * Mirtesen.
 *
 * PulseRightBlock component.
 *
 * @author       Olga Efimova
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class extends vh{componentDidMount(){this.addScript({src:"https://static.pulse.mail.ru/pulse-widget.js"})}render(){return r.createElement("div",{className:"pulse-widget","data-sid":"partners_widget_glagolpress",style:{height:"650px"}})}};
/**
 * Mirtesen.
 *
 * Smi2 block for big articles.
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class kh extends vh{componentDidMount(){const{id:e}=this.props;this.addScript({src:`https://smi2.ru/data/js/${e}.js`,onload:this.init,id:"smi2"})}init=()=>{if(Array.isArray(window.jsapi)){const e=window.jsapi.length-1;"function"==typeof window.jsapi[e]&&(window.jsapi[e](),window.jsapi.splice(e,1))}};render(){const{id:e,styles:t=null}=this.props;return r.createElement("div",{id:`unit_${e}`,style:t})}}kh.propTypes={id:f().oneOfType([f().string,f().number]),styles:f().object};const Ah=kh;
/**
 * Mirtesen.
 *
 * Smi.fm partner's block.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class xh extends vh{componentDidMount(){const{id:e}=this.props;this.addScript({src:`https://mirror.smi.fm/js/${e}.js`,onerror:this.addScript({src:`https://megasmi.ml/js/${e}.js`})})}render(){const{id:e}=this.props;return r.createElement("div",{style:{paddingTop:"30px"}},r.createElement("div",{className:"no24_teaser","data-bid":e}))}}xh.propTypes={id:f().oneOfType([f().string,f().number])};const Lh=xh;const Dh=
/**
 * Mirtesen.
 *
 * Mediametrics partner's block.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class extends vh{componentDidMount(){this.addScript({src:"https://news.mediametrics.ru/cgi-bin/b.fcgi?ac=b&m=js&n=2&p=h&id=DivID"})}render(){return r.createElement("div",{id:"DivID",style:{width:"270px",marginTop:"15px"}})}};class Rh extends vh{componentDidMount(){const{id:e}=this.props;this.addScript({src:"https://news.2xclick.ru/loader.min.js",onload:()=>{window.gnezdoAsyncCallbacks=window.gnezdoAsyncCallbacks||[],window.gnezdoAsyncCallbacks.push((()=>{window.gnezdo.create({tizerId:e,containerId:`containerId${e}`})}))}})}render(){const{id:e}=this.props;return r.createElement("div",{id:`containerId${e}`,style:{margin:"5px 0"}})}}Rh.propTypes={id:f().oneOfType([f().string,f().number])};const Zh=Rh;
/**
 * Mirtesen.
 *
 * Virtonnews block wrapper.
 *
 * @author       Duybo Alexey.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Bh extends r.PureComponent{static propTypes={id:f().number};constructor(e){super(e),this.containerRef=(0,r.createRef)()}componentDidMount(){const e=this.containerRef.current;if(null===e)return;const{id:t}=this.props,n=(()=>{let e,t,n="";const a="abcdefghiklmnopqrstuvwxyz",s=Math.floor(2*Math.random()+4);for(e=0;e<s;e++)t=Math.floor(25*Math.random()),n+=a.substring(t,t+1);return n})();e.id=n;const a=document.createElement("script");a.className=`s${t}`,a.src=`https://js-ru.virtonnews.com/n4p/0/40/ticker_${t}.js`,a.dataset.idn=n,e.appendChild(a)}render(){return r.createElement("div",{ref:this.containerRef,className:`r${this.props.id}`})}}Bh.propTypes={disablePartnerBlocks:f().bool};const $h=Bh;function Uh(){return Uh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Uh.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Partner block wrapper.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class Hh extends r.Component{getPartnerBlockByPosition(e,t){const{specialSource:n,partnerAdConfig:a}=this.props;switch(e){case"smi2RightBlock":{let e=null;return e=n?96043:Number(L()(a,"smi2RightBlock")||95080),r.createElement(Oh,Uh({},t,{id:e}))}case"smi2BottomBlock2":{let e=null;return e=n?96044:Number(L()(a,"smi2BottomBlock2")||95079),r.createElement(Oh,Uh({},t,{id:e}))}case"smi2BottomBlock3":{let e=null;return e=n?96046:Number(L()(a,"smi2BottomBlock3")||95030),r.createElement(Ah,Uh({},t,{id:e}))}case"smi2BottomBlock4":{let e=null;return e=n?96045:Number(L()(a,"smi2BottomBlock4")||95031),r.createElement(Oh,Uh({},t,{id:e}))}default:return null}}getPartnerBlockByType(e,t){switch(e){case"Politpiar":return r.createElement(Oh,t);case"Smi2":return r.createElement(Ah,t);case"Lentainform":return r.createElement(Sh,t);case"Smi24BottomBlock":return r.createElement(Ph,null);case"Smi24BottomBlock2":return r.createElement(Ih,null);case"Smi24RightBlock":return r.createElement(wh,null);case"GnezdoRightBlock":return r.createElement(Ch,null);case"PulseRightBlock":return r.createElement(Mh,null);case"SmiFm":return r.createElement(Lh,t);case"Mediametrics":return r.createElement(Dh,null);case"P2xclick":return r.createElement(Zh,t);case"Virtonnews":return r.createElement($h,t);default:return null}}render(){const{type:e,id:t=0,isAdBlockerActive:n,isAdBlocker:a,hideAdBlocks:s,style:o,ymGoal:i,position:l,isPartnerBlocksDisabled:c,disabled:m}=this.props;if(s||c||m)return null;if(!0===n&&!a)return null;if(!1===n&&a)return null;let d=null;return d=l?this.getPartnerBlockByPosition(l,{style:o}):this.getPartnerBlockByType(e,{id:t,style:o}),r.createElement("div",{className:"partner-block-wrapper",onClick:()=>{i&&na.ym("reachGoal",i)}},d)}}Hh.defaultProps={isAdBlocker:!1,style:{},id:0,ymGoal:"",disabled:!1},Hh.propTypes={type:f().oneOfType([f().string,f().number]),id:f().oneOfType([f().string,f().number]),style:f().object,ymGoal:f().string,isAdBlocker:f().bool,isAdBlockerActive:f().bool,hideAdBlocks:f().bool,specialSource:f().bool,partnerAdConfig:f().object,position:f().string,isPartnerBlocksDisabled:f().bool,disabled:f().bool};const Fh=(0,i.$j)((e=>({isAdBlockerActive:e?.app?.isAdBlockerActive,hideAdBlocks:e?.app?.hideAdBlocks,specialSource:e?.app?.req?.specialSource,partnerAdConfig:e.app?.site,isPartnerBlocksDisabled:e.app?.disablePartnerBlocks})))(Hh);
/**
 * Mirtesen.
 *
 * LeftMenuWrapper implementation for React.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class jh extends r.PureComponent{constructor(e){super(e),this.state={isSlidingPossible:null,veryLeftColumnWidth:0,veryLeftColumnPosition:{left:0,top:0}}}componentDidMount(){window.addEventListener("scroll",this.handleResize),window.addEventListener("resize",this.handleResize),this.isSlidingPossible(),this.updatePosition()}componentDidUpdate(e){const{isSlided:t}=this.props;if(e.isSlided!==t){const{veryLeftColumn:e}=this;if(!e||!Yt.findDOMNode(e))return;Yt.findDOMNode(e).scrollTop=0}}componentWillUnmount(){window.removeEventListener("scroll",this.handleResize),window.removeEventListener("resize",this.handleResize)}handleResize=u()((()=>{this.isSlidingPossible(),this.updatePosition()}),80);updatePosition(){const{veryLeftColumn:e}=this;if(!e||!Yt.findDOMNode(e))return;const t=window.pageYOffset||document.documentElement.scrollTop;this.setState({veryLeftColumnWidth:Yt.findDOMNode(e).offsetWidth,veryLeftColumnPosition:{left:e.getBoundingClientRect().left,top:e.getBoundingClientRect().top+t}})}isSlidingPossible(){const{sliderBreakpoint:e}=this.props,t=window,n=document,a=n.documentElement,s=n.getElementsByTagName("body")[0];(t.innerWidth||a.clientWidth||s.clientWidth)<e?this.setState({isSlidingPossible:!0}):this.setState({isSlidingPossible:!1})}render(){const{isSlided:e,onToggleSidebar:t,scope:n="blog",page:a,id:s=null}=this.props,{isSlidingPossible:o,veryLeftColumnWidth:i,veryLeftColumnPosition:l,sliderBreakpoint:c}=this.state,m=_()({"left-column-sidebar":o,show:e,"slided-only":"videoOne"===a}),d=r.createElement(r.Fragment,null,r.createElement(Og,{parentWidth:i,topicDomain:Rp().mainDomain,isTopicMenuOpen:!1,commonMenuItems:bh.O,onSiteLinkClick:bd}),r.createElement("p",{className:"recommendation-tech"},"На информационном ресурсе применяются ",r.createElement("a",{href:"https://info.mirtesen.ru/recommendation_rules"},"рекомендательные технологии"),' (информационные технологии предоставления информации на основе сбора, систематизации и анализа сведений, относящихся к предпочтениям пользователей сети "Интернет", находящихся на территории Российской Федерации)'),r.createElement("div",{className:"mt-tizer-ad-block"},r.createElement(Fh,{type:"Politpiar",id:99821})));let p=d;if("blog"===n)switch(a){case"promotion":p=r.createElement(mh,null);break;case"editComments":p=r.createElement(fh,null);break;case"siteSettings":p=r.createElement(Zg,null);break;default:p=d}else"personSettings"===a?p=r.createElement(Vg,null):"platform"===n&&(p=r.createElement(xg,null));return r.createElement(r.Fragment,null,e&&o&&r.createElement("div",{className:"left-column-sidebar__presentation",onClick:t}),r.createElement("div",{id:s||"very-left-column",className:m,ref:e=>this.veryLeftColumn=e},!o&&r.createElement(kg,{parentWidth:i,position:l,sidebarBreakpoint:c},p),o&&p))}}jh.defaultProps={sliderBreakpoint:1424},jh.propTypes={id:f().string,onToggleSidebar:f().func,scope:f().string,page:f().string,isSlided:f().bool,sliderBreakpoint:f().number,children:f().oneOfType([f().object,f().array])};const Gh=(0,i.$j)((e=>({scope:e.app?.scope||"blog",page:e.app?.page,isSlided:e.header?.sidebarIsOpen})),(e=>({onToggleSidebar:()=>{e((e=>e({type:"HEADER_TOGGLE_SIDEBAR"})))}})))((0,ae.Z)(jh,"leftMenuWrapper"));
/**
 * Mirtesen.
 *
 * Scroll Top Component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class qh extends r.PureComponent{constructor(e){super(e),this.state={position:"fixed",bottom:50,right:0,cursor:"pointer",transitionDuration:"0.2s",transitionTimingFunction:"linear",transitionDelay:"0s",zIndex:10,display:"none"},this.handleScrollTop=this.handleScrollTop.bind(this),this.scrollTimeout=null,this.throttledScroll=this.throttledScroll.bind(this)}componentDidMount(){window.addEventListener("scroll",this.throttledScroll),window.addEventListener("resize",this.handleResize),this.handleResize()}componentWillUnmount(){window.removeEventListener("scroll",this.throttledScroll),window.removeEventListener("resize",this.handleResize)}handleResize=()=>{const e=document.getElementById("very-right-column");if(e){const t=e.offsetWidth;this.setState({right:t})}};handleScrollTop(){window.scrollTo(0,0)}throttledScroll(){this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout((()=>{this.setState({display:(document.documentElement.scrollTop||document.body.scrollTop)>600?"block":"none"})}),30)}render(){const e=this.state;return r.createElement("div",{style:e},r.createElement("div",{id:"scroll-top",onClick:this.handleScrollTop},r.createElement("div",null,"наверх")))}}const Vh=qh;
/**
 * Mirtesen.
 *
 * Aggregator Iframe.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class zh extends r.PureComponent{static defaultProps={source:"mt"};constructor(e){super(e),this.state={mainContentHeight:0,aggregatorWidth:0,aggregatorHeight:0,suitableSize:!1},this.aggregator=r.createRef(),this.loadTimeout=null,this.resizeTimeout=null,this.showMore=this.showMore.bind(this),this.handleGetMessage=this.handleGetMessage.bind(this),this.timeoutResize=this.timeoutResize.bind(this)}componentDidMount(){const{showMore:e,source:t}=this.props;this.timeoutResize(),e(t,30),window.addEventListener("message",this.handleGetMessage),window.addEventListener("resize",this.timeoutResize)}componentDidUpdate(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&this.timeoutResize()}componentWillUnmount(){window.removeEventListener("message",this.handleGetMessage),window.removeEventListener("resize",this.timeoutResize)}handleGetMessage(e){const{aggregatorHeight:t}=this.state;if(e.data.mainContentHeight){const n=e.data.mainContentHeight;this.setState({mainContentHeight:n,suitableSize:t+300<n})}}getWidgetSize=()=>{const{aggregatorWidth:e}=this.state;let t="";return e<250&&(t=e<220?"xs":"sm"),t};timeoutResize(){const{mainContentHeight:e}=this.state;this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((()=>{if(this.aggregator.current){const t=this.aggregator.current.offsetHeight;this.setState({aggregatorWidth:this.aggregator.current.offsetWidth,aggregatorHeight:t,suitableSize:t+300<e})}}),70)}showMore(){const{showMore:e,hasMore:t,source:n}=this.props,{suitableSize:a}=this.state;this.loadTimeout&&clearTimeout(this.loadTimeout),this.loadTimeout=setTimeout((()=>{t&&a&&e(n,5)}),500)}render(){const{aggregatorWidth:e,suitableSize:t}=this.state,{ymGoal:n,items:a,hasMore:s}=this.props;return r.createElement("div",{className:"aggregator"},r.createElement("div",{className:"aggregator__header-wrapper",style:e>0?{position:"fixed",width:e+"px"}:{}},r.createElement("div",{className:"aggregator__header"},r.createElement("h3",{className:"aggregator__title",style:{fontSize:e<299?"18px":"20px"}},"Картина дня"))),r.createElement("div",{className:"aggregator__items",ref:this.aggregator},a&&r.createElement(zn,{threshold:100,pageStart:0,loadMore:this.showMore,hasMore:s&&t},a.map(((e,t)=>e&&r.createElement("div",{key:`aggregator_item_${e.id}_${t}`,onClick:()=>{n&&na.ym("reachGoal",n)}},r.createElement("a",{href:e.url,className:"aggregator__item",target:"_blank"},r.createElement("span",{className:"aggregator__item_title"},e.title))))))))}}zh.propTypes={source:f().string,ymGoal:f().string,showMore:f().func,items:f().array,hasMore:f().bool};const Wh=(0,i.$j)((e=>({items:e.aggregator.items,hasMore:e.aggregator.hasMore})),(e=>({showMore:(t,n)=>{e(((e="mt",t=30)=>n=>{let a=null;switch(e){case"smi2":a=94646;break;case"crysis":a=95432;break;case"coronavirus":a=95431;break;case"arbitrationBlog":a=95527;break;case"specialSource":a=96048;break;default:a=95156}"undefined"!=typeof JsAPI&&JsAPI.Dao.getNews({block_id:a,count:t,fields:65535},(e=>{n({type:"AGGREGATOR_CHANGE_ITEMS",items:e})}),(e=>{console.warn(e)}))})(t,n))}})))((0,ae.Z)(zh,"aggregatorNonFrame")),Yh=(0,ae.Z)(class extends r.Component{static propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};render(){const{app:e,page:t}=this.props,n=L()(e,"siteBuilder.layout.style",{}),a=t,s=Fp.isSiteMatch("hiddenSubscribers"),o=L()(e,"isArbitrationBlog");let i="mt";["coronavirus","crysis"].includes(e.postTopic)&&(i=e.postTopic),o&&(i="arbitrationBlog"),L()(e,"req.specialSource")&&(i="specialSource");const l=L()(e,"req.isMobile");return r.createElement("div",{id:"layout",className:"blog-post-layout",style:n},r.createElement(Jp,{app:e}),r.createElement("div",{id:"main-container",className:_()({"not-admin":!pd.canAdminBlog(),hideSubscribers:s})},r.createElement(Gp,null),r.createElement("div",{id:"three-column-container"},r.createElement(Gh,null),r.createElement("div",{id:"content-container"},r.createElement(Yu,null),r.createElement(a,{app:e})))),!l&&r.createElement("div",{id:"very-right-column"},r.createElement(Wh,{source:i,ymGoal:o?"click_blok_mt":""})),r.createElement(Vh,null))}},"blogPostListLayout");
/**
 * Mirtesen.
 *
 * Layout Empty.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Kh extends r.Component{render(){const{app:e,page:t}=this.props,n=t;return r.createElement("div",{id:"content-column"},r.createElement(n,{app:e}))}}Kh.propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};const Jh=(0,ae.Z)(Kh,"contentLayout");
/**
 * Mirtesen.
 *
 * Main Content Component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Xh extends r.PureComponent{constructor(){super(),this.timeoutChange=null,this.state={layout:0,veryLeftColumn:0,header:0,contentColumn:0,rightColumn:0}}componentDidMount(){this.timeoutResize(),window.addEventListener("resize",this.timeoutResize)}componentWillUnmount(){window.removeEventListener("resize",this.timeoutResize)}handleResize(){let e;const t=document.getElementById("v-very-left-column"),n=document.getElementById("header"),a=document.getElementById("v-content-column-list"),s=document.getElementById("v-right-column");let r=0,o=0,i=0,l=0;t&&(e=window.getComputedStyle(t,null),r=t.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)),n&&(e=window.getComputedStyle(n,null),o=n.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)),a&&(e=window.getComputedStyle(a,null),i=a.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)),s&&(e=window.getComputedStyle(s,null),l=s.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)),this.setState({header:o,veryLeftColumn:r,contentColumn:i,rightColumn:l})}timeoutResize=()=>{this.timeoutChange&&clearTimeout(this.timeoutChange),this.timeoutChange=setTimeout((()=>{this.handleResize()}),70)};render(){const e=this.state,t=[];for(let e=0;e<24;e++)t.push(r.createElement("div",{className:"video-tile"},e));return r.createElement("div",{id:"v-layout"},r.createElement("header",{id:"header"},r.createElement("div",{className:"dummy-block"},"Header",r.createElement("br",null),e.header,"px")),r.createElement("div",{id:"v-three-column-container"},r.createElement("div",{id:"v-very-left-column"},r.createElement("div",{className:"dummy-block"},"Very Left Column",r.createElement("br",null),e.veryLeftColumn,"px")),r.createElement("div",{id:"v-double-column-container"},r.createElement("div",{id:"v-content-column-list"},r.createElement("div",{className:"dummy-block"},"Content Column",r.createElement("br",null),e.contentColumn,"px"),r.createElement("div",{className:"video-grid"},t)))))}}
/**
 * Mirtesen.
 *
 * Main Content Component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Qh extends r.PureComponent{constructor(){super(),this.timeoutChange=null,this.state={layout:0,veryLeftColumn:0,header:0,contentColumn:0,rightColumn:0}}componentDidMount(){this.timeoutResize(),window.addEventListener("resize",this.timeoutResize)}componentWillUnmount(){window.removeEventListener("resize",this.timeoutResize)}handleResize(){let e;const t=document.getElementById("v-very-left-column"),n=document.getElementById("header"),a=document.getElementById("v-content-column-one"),s=document.getElementById("v-right-column");let r=0,o=0,i=0,l=0;t&&(e=window.getComputedStyle(t,null),r=t.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)),n&&(e=window.getComputedStyle(n,null),o=n.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)),a&&(e=window.getComputedStyle(a,null),i=a.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)),s&&(e=window.getComputedStyle(s,null),l=s.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)),this.setState({header:o,veryLeftColumn:r,contentColumn:i,rightColumn:l})}timeoutResize=()=>{this.timeoutChange&&clearTimeout(this.timeoutChange),this.timeoutChange=setTimeout((()=>{this.handleResize()}),70)};render(){const e=this.state;return r.createElement("div",{id:"v-layout"},r.createElement("header",{id:"header"},r.createElement("div",{className:"dummy-block"},"Header",r.createElement("br",null),e.header,"px")),r.createElement("div",{id:"v-three-column-container"},r.createElement("div",{id:"v-double-column-container"},r.createElement("div",{id:"v-content-column-one"},r.createElement("div",{className:"dummy-block"},"Content Column",r.createElement("br",null),e.contentColumn,"px")),r.createElement("div",{id:"v-right-column"},r.createElement("div",{className:"dummy-block"},"Right Column",r.createElement("br",null),e.rightColumn,"px")))))}}
/**
 * Mirtesen.
 *
 * Main Content Component.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class e_ extends r.PureComponent{constructor(){super(),this.timeoutChange=null,this.state={layout:0,leftColumn:0,header:0,contentColumn:0}}componentDidMount(){this.timeoutResize(),window.addEventListener("resize",this.timeoutResize)}componentWillUnmount(){window.removeEventListener("resize",this.timeoutResize)}handleResize(){let e;const t=document.getElementById("left-column"),n=document.getElementById("header-column"),a=document.getElementById("content-column");let s=0,r=0,o=0;t&&(e=window.getComputedStyle(t,null),s=t.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)),n&&(e=window.getComputedStyle(n,null),r=n.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)),a&&(e=window.getComputedStyle(a,null),o=a.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)),this.setState({header:r,leftColumn:s,contentColumn:o})}timeoutResize=()=>{this.timeoutChange&&clearTimeout(this.timeoutChange),this.timeoutChange=setTimeout((()=>{this.handleResize()}),70)};render(){const e=this.state;return r.createElement("div",{id:"layout"},r.createElement("div",{id:"two-column-container"},r.createElement("div",{id:"left-column"},r.createElement("div",{className:"dummy-block"},"Left Column",r.createElement("br",null),e.leftColumn,"px")),r.createElement("div",{id:"content-container"},r.createElement("div",{id:"header"},r.createElement("div",{id:"header-column"},r.createElement("div",{className:"dummy-block"},"Header Content",r.createElement("br",null),e.header,"px"))),r.createElement("div",{id:"content-column"},r.createElement("div",{className:"dummy-block"},"Main Content",r.createElement("br",null),e.contentColumn,"px")))))}}
/**
 * Mirtesen.
 *
 * Main Content Component.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2017, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const t_=(0,ae.Z)(class extends r.Component{static propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};render(){const{app:e,page:t}=this.props,n=L()(e,"siteBuilder.layout.style",{}),a=t;return r.createElement("div",{id:"layout",className:"one-column-layout",style:n},r.createElement(Jp,{app:e}),r.createElement("div",{id:"main-container"},r.createElement(Gp,null),r.createElement("div",{id:"three-column-container"},r.createElement(Gh,null),r.createElement("div",{id:"content-container"},r.createElement(Yu,null),r.createElement("div",{id:"double-column-container"},r.createElement("div",{id:"content-column"},r.createElement(a,{app:e})))))),r.createElement("div",{id:"very-right-column"},r.createElement(Wh,{source:"mt"})))}},"oneColumnLayout"),n_=()=>pd.canAddPost()&&r.createElement("div",{className:"add-blog-post-button"},r.createElement("a",{className:"btn btn-primary add-blog-post-button__btn",href:"/blog/add"},"Добавить Тему"));
/**
 * Mirtesen.
 *
 * Date and time formmating component.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class a_ extends r.PureComponent{constructor(e){super(e),this.state={localDate:""}}componentDidMount(){const{date:e,format:t}=this.props;e&&this.setState({localDate:K.Z.getLocalDate(e,t)})}render(){return r.createElement(r.Fragment,null,this.state.localDate)}}a_.propTypes={date:f().oneOfType([f().string,f().number]),format:f().string};const s_=a_;
/**
 * Mirtesen.
 *
 * Right column posts Container.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class r_ extends r.PureComponent{constructor(e){super(e),this.state={loaded:!1}}componentDidMount(){this.setState({loaded:!0})}getPublishDate(e){return e.publish_time?r.createElement(s_,{date:e.publish_time,format:"D MMMM, H:mm"}):r.createElement(s_,{date:e.formattedDates.iso,format:"D MMMM, H:mm"})}render(){const{posts:e,scope:t}=this.props,{loaded:n=!1}=this.state;return e.length?r.createElement("div",{className:"right-column-posts"},r.createElement("h3",{className:"right-column-posts__title"},"Популярные статьи"),r.createElement("ul",{className:"right-column-posts_list"},e.map(((e,a)=>r.createElement("li",{className:"right-column-posts_list_item",key:a},r.createElement("a",{href:Fp.addUtmToUrl(`${e.seo_url}&utm_medium=from_block_popular_articles`),className:"right-column-posts_list_item__link",rel:"dispute"===t?"nofollow":null},r.createElement("span",{className:"right-column-posts_list_item__title"},e.title),r.createElement("span",{className:"right-column-posts_list_item__date"},n?this.getPublishDate(e):""))))))):null}}r_.propTypes={posts:f().array,scope:f().string};const o_=(0,i.$j)((e=>({posts:e.rightColumnPosts,scope:e.app.scope})))((0,ae.Z)(r_,"rightColumnPosts"));
/**
 * Mirtesen.
 *
 * Comment likes.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class i_ extends r.PureComponent{render(){const{likes:e,className:t}=this.props;return r.createElement("i",{className:_()({"svg-like":!0,"svg-like_negative":e<0,"comment-likes":!0,[t]:!!t})},Math.abs(e))}}i_.defaultProps={likes:0,className:null},i_.propTypes={likes:f().number,className:f().string};const l_=i_;var c_="/index.js";
/**
 * Mirtesen.
 *
 * Right column comments Actions.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const m_={},d_=()=>(e,t)=>{const n=t(),{id:a}=n.app.site,s=`messages_mt_${a}`;m_[s]||"undefined"==typeof window||(m_[s]=!0,"development"!==Rp().mode&&jd.subscribe(s,(()=>{setTimeout((()=>e((async(e,t)=>{const n=t(),{id:a}=n.app.site;try{const t=await dh.Z.getLastBlogComments({siteId:a,count:1});t.items?.length>0&&e({type:"RIGHT_COLUMN_COMMENTS_GET_NEW_COMMENT",comment:t.items})}catch(e){D.Z.promiseHandler(c_)(e)}}))),500)})))};
/**
 * Mirtesen.
 *
 * Right column comments Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class p_ extends r.PureComponent{componentDidMount(){const{type:e,ssr:t,count:n,initComments:a,id:s,initLongPool:r}=this.props;"blog"===e&&r(),t||a(s,e,n)}getCommentImage(e){const t=L()(e,"images[0].url");return t||null}render(){const{comments:e,type:t}=this.props;return e.filter((e=>e.blog_post)).length?r.createElement("div",{className:`right-column-comments right-column-comments_${t}`},r.createElement("h3",{className:"right-column-comments__title"},"Свежие комментарии"),r.createElement("ul",{className:"right-column-comments-list"},e.filter((e=>e.blog_post)).filter((e=>e.blog_post&&e.user)).map(((e,n)=>{const a=this.getCommentImage(e),s=e.likes?e.likes.count:null,o=e.blog_post;let i;if(i="person"===t?o.seo_url||o.url:fs.Z.getDisputePageUrl(o,Rp().mainProto,Rp().mainDomain),!i||!e.user)return null;i=Fp.addUtmToUrl(i);const l=K.Z.stripTags(y.Z.truncateString(o.title||o.preview_text||""));return r.createElement("li",{className:"right-column-comments-item",key:n},r.createElement(cg,{href:`https://mirtesen.ru/people/${e.user.id}`,className:_()({"right-column-comments-item__author":!0,active:b.ZP.getCurrentUserId()}),userId:e.user.id},r.createElement(Mn.Z,{logoInfo:{userName:e.user.display_name,logoImg:e.user.photo_original,logoClassName:"userlogo_s"}}),r.createElement("div",{className:"right-column-comments-item__author__info"},r.createElement("i",{className:"right-column-comments-item__author__name",style:{color:Xp.Z.getHslColorByName(e.user.display_name)}},e.user.display_name),r.createElement("i",{className:"right-column-comments-item__pubdate"},r.createElement(s_,{date:e.date,format:"D MMMM, H:mm"}))),e?.likes?.count>0&&r.createElement(l_,{className:"right-column-comments-item__likes",likes:s})),r.createElement("div",{className:"right-column-comments-item__post",onClick:()=>{window.location.href=`${i}#${e.id}`}},e.show_raw?r.createElement("span",{className:"right-column-comments-item__post__message",dangerouslySetInnerHTML:{__html:y.Z.truncateString(e.text,120)}}):r.createElement("span",{className:"right-column-comments-item__post__message"},y.Z.truncateString(e.text,120)),a&&r.createElement(kn.Z,{tag:"span",src:a,className:"right-column-comments-item__post__image"}),"string"==typeof l&&l.length>0&&r.createElement("span",{className:"right-column-comments-item__post__title"},l)))})))):null}}p_.propTypes={comments:f().array,count:f().number,type:f().string,ssr:f().bool,id:f().number,initComments:f().func,initLongPool:f().func},p_.defaultProps={count:10,type:"blog",ssr:!0};const u_=(0,i.$j)((e=>({comments:e.rightColumnComments})),(e=>({initComments:(t,n,a)=>{e(((e,t,n)=>a=>{"person"===t?Promise.resolve(dh.Z.getPersonComments(1,e,n,{onUserPosts:!0})).then((e=>{a({type:"RIGHT_COLUMN_COMMENTS_GET_COMMENTS",comments:e.items})})).catch(D.Z.promiseHandler(c_)):Promise.resolve(dh.Z.getLastBlogComments({siteId:e,count:n})).then((e=>{a({type:"RIGHT_COLUMN_COMMENTS_GET_COMMENTS",comments:e.items})})).catch(D.Z.promiseHandler(c_))})(t,n,a))},initLongPool:()=>{e(d_())}})))((0,ae.Z)(p_,"rightColumnComments")),g_=({top:e=30,children:t})=>{const[n,a]=(0,r.useState)(0);return(0,r.useEffect)((()=>{const e=e=>{"MT_APP_STICKY_HEADER"===e?.data?.type&&a(e.data.data.sticky)};return"undefined"!=typeof window&&window.addEventListener("message",e,!1),()=>{window.removeEventListener("message",e)}}),[]),r.createElement("div",{className:"sticky2",style:{top:n+e+"px"}},t)};g_.propTypes={top:f().number,children:f().oneOfType([f().object,f().array])};const h_=(0,r.memo)(g_),__=(0,ae.Z)(class extends r.Component{static propTypes={app:f().object,page:f().oneOfType([f().object,f().func])};render(){const{app:e,page:t}=this.props,n=L()(e,"siteBuilder.layout.style",{}),a=t,s=Fp.isSiteMatch("hiddenSubscribers"),o=_()({"not-admin":!pd.canAdminBlog(),hideSubscribers:s});return r.createElement("div",{id:"layout",className:"two-column-layout",style:n},r.createElement(Jp,{app:e}),r.createElement("div",{id:"main-container",className:o},r.createElement(Gp,null),r.createElement("div",{id:"three-column-container"},r.createElement(Gh,null),r.createElement("div",{id:"content-container"},r.createElement(Yu,null),r.createElement("div",{id:"double-column-container"},r.createElement("div",{id:"right-column"},r.createElement(n_,null),r.createElement(Fh,{type:"Politpiar",id:99809}),r.createElement(o_,null),"blogCommentPage"!==e.page&&"blog"===e.scope&&r.createElement(u_,{id:e.site.id}),r.createElement(h_,null,r.createElement(Fh,{type:"Politpiar",id:99810}))),r.createElement("div",{id:"content-column"},r.createElement(a,{app:e})))))),r.createElement("div",{id:"very-right-column"},r.createElement(Wh,{source:"mt"})),r.createElement(Vh,null))}},"twoColumnsLayout"),E_=(0,ae.Z)(class extends r.Component{static propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};render(){const{app:e,page:t}=this.props,n=L()(e,"siteBuilder.layout.style",{}),a=t,s=Fp.isSiteMatch("hiddenSubscribers"),o=L()(e,"isArbitrationBlog")?"arbitrationBlog":"mt";return r.createElement("div",{id:"layout",className:"post-list-layout bg-gray",style:n},r.createElement(Jp,{app:e}),r.createElement("div",{id:"main-container",className:_()({"not-admin":!pd.canAdminBlog(),hideSubscribers:s})},r.createElement(Gp,null),r.createElement("div",{id:"three-column-container"},r.createElement(Gh,null),r.createElement("div",{id:"content-container"},r.createElement(Yu,null),r.createElement("div",{id:"double-column-container"},r.createElement("div",{id:"right-column"},r.createElement(n_,null),r.createElement(Fh,{type:"Politpiar",id:95129}),r.createElement(o_,null),r.createElement(Fh,{type:"Politpiar",id:99810}),"blogCommentPage"!==e.page&&r.createElement(u_,{id:e.site.id}),r.createElement(h_,null,r.createElement(Fh,{type:"Politpiar",id:99808}))),r.createElement("div",{id:"content-column"},r.createElement(a,{app:e})))))),r.createElement("div",{id:"very-right-column"},r.createElement(Wh,{source:o})),r.createElement(Vh,null))}},"postListLayout");var f_=n(47037),b_=n.n(f_);
/**
 * Mirtesen.
 *
 * User Summary Info.
 *
 * @author       Artem Kamysh.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const y_=n(8778).pluralize;class v_ extends r.PureComponent{render(){const{app:e}=this.props,t=L()(e,"person");if(!t)return!1;const{canViewFriends:n}=t,a=t.profileInfo||{},s=a.friends||{};return!Sa()(a)&&r.createElement("div",{className:"person-summary"},r.createElement("div",{className:"person-summary__header"},r.createElement("h4",{className:"person-summary__title"},"Краткая информация"),pd.canEditProfile()&&r.createElement("a",{className:"settings-icon",href:"https://mirtesen.ru/settings","aria-label":"Настройки профиля"},r.createElement("svg",{className:"svg-icon"},r.createElement("use",{href:"/images/icons.svg#settings"})))),r.createElement("ul",{className:"person-summary__list"},t.bdate&&r.createElement("li",{className:"person-summary__item person-summary__icon person-summary__icon_bubble",title:"День Рождения"},t.bdate,", ",y.Z.formatBdate(t.bdate)),a.education&&r.createElement("li",{className:"person-summary__item person-summary__icon person-summary__icon_flask",title:"Образование"},a.education),a.maritalStatus&&r.createElement("li",{className:"person-summary__item person-summary__icon person-summary__icon_like",title:"Семейное положение"},a.maritalStatus),a.residence&&r.createElement("li",{className:"person-summary__item person-summary__icon person-summary__icon_geopos"},a.residence),a.career&&(b_()(a.career)?[a.career]:a.career).map(((e,t)=>r.createElement("li",{key:t,className:"person-summary__item person-summary__icon person-summary__icon_backpack",title:"Карьера"},e))),n&&(s||t)&&r.createElement(r.Fragment,null,r.createElement("li",{className:"person-summary__item person-summary__icon person-summary__icon_friends"},t.count_friends+" "+y_(t.count_friends,"друг","друга","друзей"),s.shared&&", "+s.shared+" "+y_(s.shared,"общий","общих","общих")),r.createElement("li",null,r.createElement(sg,{items:s.items,className:"person-summary__friends",count:7,total:t.count_friends,personId:t.id})))),(a.phones||a.emails)&&pd.canEditProfile()&&r.createElement(r.Fragment,null,r.createElement("div",{className:"person-summary__header"},r.createElement("h5",{className:"person-summary__subtitle"},"Контакты"),r.createElement("a",{className:"settings-icon",href:"https://mirtesen.ru/settings","aria-label":"Настройки профиля"},r.createElement("svg",{className:"svg-icon"},r.createElement("use",{href:"/images/icons.svg#settings"})))),r.createElement("ul",{className:"person-summary__list"},a.phones&&(b_()(a.phones)?[a.phones]:a.phones).map(((e,t)=>r.createElement("li",{key:t,title:"Телефон",className:"person-summary__item person-summary__icon person-summary__icon_phone"},e))),a.emails&&(b_()(a.emails)?[a.emails]:a.emails).filter((e=>"STATUS_ACTIVE"===e.status)).map(((e,t)=>r.createElement("li",{key:t,title:"E-mail",className:"person-summary__item person-summary__icon person-summary__icon_email"},e.email))))),0!==a.links.length&&r.createElement(r.Fragment,null,r.createElement("h5",{className:"person-summary__subtitle"},"Ссылки"),r.createElement("ul",{className:"person-summary__list person-summary__list_last"},a.links&&(b_()(a.links)?[a.links]:a.links).map(((e,t)=>r.createElement("li",{key:t,className:"person-summary__item person-summary__icon person-summary__icon_link",title:"Ссылки"},r.createElement("a",{href:e,target:"_blank",rel:"nofollow"},e)))))))}}v_.propTypes={app:f().object};const T_=v_;
/**
 * Mirtesen.
 *
 * API interface for Galleries.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class S_{static async getImages(e,t={}){t={offset:0,count:4,...t};const{count:n,offset:a}=t;try{const s=await R.Z.request({query:`query {\n                    getPhotos(ownerId: ${e}, limit: ${n}, offset: ${a}) {\n                      items {\n                        id\n                        title\n                        link\n                        image: src\n                        tags\n                        type\n                      }\n                    }\n                }`,endpoint:{endpoint:"user",ver:"v1"},req:t.req,res:t.res});return{images:s?.items||[]}}catch(e){D.Z.promiseHandler("/index.js")(e)}}}S_.testData={total:50,images:[{link:"#",image:"https://mtdata.ru/u12/photoF7C2/20140110093-0/original.jpeg",title:"Скромный поступок истинно верующего человека :)"},{link:"#",image:"https://mtdata.ru/u12/photoF7C2/20140110093-0/original.jpeg",title:"Скромный поступок истинно верующего человека :)"},{link:"#",image:"https://mtdata.ru/u12/photoF7C2/20140110093-0/original.jpeg",title:"Скромный поступок истинно верующего человека :)"},{link:"#",image:"https://mtdata.ru/u12/photoF7C2/20140110093-0/original.jpeg",title:"Скромный поступок истинно верующего человека :)"}]};const P_=S_;
/**
 * Mirtesen.
 *
 * Right column comments Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const w_=({id:e,images:t})=>t.length?r.createElement("div",{className:"right-column-gallery"},r.createElement("div",{className:"right-column-gallery__header"},r.createElement("span",{className:"right-column-gallery__title"},"Фото"),r.createElement("a",{className:"right-column-gallery__link",href:`/people/${e}/photos`},r.createElement("span",null,"Еще..."))),r.createElement("div",{className:"right-column-gallery__list"},t.map(((e,t)=>r.createElement(kn.Z,{key:t.toString(),href:e.link,src:e.image,alt:e.title,tag:"a",className:"right-column-gallery__image"}))))):null,I_=(0,r.memo)(w_),C_=({id:e})=>{const t=(0,aa.C)((e=>e.rightColumnGallery)),n=(0,aa.T)();return(0,r.useEffect)((()=>{n(((e,t)=>async n=>{try{const a=await P_.getImages(e,{count:t});n({type:"RIGHT_COLUMN_GALLERY_GET_IMAGES",images:a?.images||[]})}catch(e){D.Z.promiseHandler("/index.js")(e)}})(e,9))}),[e]),r.createElement(I_,{id:e,images:t.images})},N_=(0,r.memo)(C_),O_={ad:{1010:{params:{p1:"cblrf",p2:"fwea"},ownerId:211731,minWidth:700,width:620,height:300,containerId:"adfox_159429822802698225"},1011:{params:{p1:"cblsp",p2:"fpaj"},ownerId:211731,maxWidth:699,width:300,height:300,containerId:"adfox_153261773090236151"},1020:{params:{p1:"cblte",p2:"fwea"},ownerId:211731,maxWidth:699,width:300,containerId:"adfox_153261769560342631"},1025:{params:{p1:"cmzcb",p2:"esmz"},minWidth:700,ownerId:211731,containerId:"adfox_16451888303477360"},1030:{params:{p1:"bzoss",p2:"esmz"},width:620,height:250,minWidth:650,ownerId:211731,containerId:"adfox_159429650131779245",devices:["desktop","tablet"]},1031:{params:{p1:"civlu",p2:"grtf"},height:120,maxWidth:649,ownerId:211731,containerId:"adfox_158082916500264555",devices:["phone"]},1090:{params:{p1:"clpwf",p2:"grzi"},ownerId:211731,width:620,height:332,containerId:"adfox_159430028978029262",minWidth:700},1091:{params:{p1:"civlz",p2:"grtf"},ownerId:211731,maxWidth:699,containerId:"adfox_158143586123779111"},1200:{params:{p1:"ckcpq",p2:"esmz"},ownerId:211731,width:620,height:250,containerId:"adfox_158816369696317443",minWidth:700},1201:{params:{p1:"ckclb",p2:"fpaj"},ownerId:211731,maxWidth:699,width:300,height:250,containerId:"adfox_158815834169345967"},2010:{params:{p1:"caalu",p2:"fwea"},ownerId:211731,minWidth:700,width:600,height:250,containerId:"adfox_153261703242952252"},2011:{params:{p1:"bzorn",p2:"fpaj"},ownerId:211731,maxWidth:699,height:250,containerId:"adfox_153261750181386805"},3010:{params:{p1:"citgo",p2:"fpde"},ownerId:211731,width:300,height:300,containerId:"adfox_158030932359224632"},3020:{params:{p1:"bzmax",p2:"fpde"},width:300,height:600,ownerId:211731,containerId:"adfox_162426852395715"},3030:{params:{p1:"bzosr",p2:"fpde"},width:300,height:600,ownerId:211731,containerId:"adfox_153261106089264988"},3040:{params:{p1:"bzzws",p2:"fhgy"},width:320,height:120,maxWidth:599,ownerId:211731,containerId:"adfox_153261737790015262"},3041:{params:{p1:"cning",p2:"grtf"},width:320,height:120,maxWidth:599,ownerId:211731,containerId:"adfox_160759824631961310"},3050:{params:{p1:"cblrg",p2:"gazo"},width:160,height:640,ownerId:211731,containerId:"adfox_153261728039077306"},3060:{params:{p1:"cnimx",p2:"gazo"},width:160,height:600,ownerId:211731,containerId:"adfox_160759801192382154"},5010:{params:{p1:"cfahi",p2:"fpaj"},width:300,height:300,ownerId:211731,containerId:"adfox_156015420426244017"},6010:{params:{p1:"cnimu",p2:"fpaj"},width:300,height:300,ownerId:211731,containerId:"adfox_160759789380913537"},6011:{params:{p1:"cnimy",p2:"grtf"},width:300,height:300,ownerId:211731,containerId:"adfox_160759811371521293"},6020:{params:{p1:"cnimv",p2:"fpaj"},width:300,height:300,ownerId:211731,containerId:"adfox_160759791658131338"},6021:{params:{p1:"cnimz",p2:"grtf"},width:300,height:300,ownerId:211731,containerId:"adfox_160759813599859794"},6030:{params:{p1:"cnimw",p2:"fpaj"},width:300,height:300,ownerId:211731,containerId:"adfox_160759793356277562"},6031:{params:{p1:"cnina",p2:"grtf"},width:300,height:300,ownerId:211731,containerId:"adfox_160759814523661016"},6040:{params:{p1:"cnila",p2:"hatx"},ownerId:211731,containerId:"adfox_16178802810826457",width:300,height:300},6041:{params:{p1:"cnile",p2:"hatx"},width:300,height:300,ownerId:211731,containerId:"adfox_161788037299728964"},6050:{params:{p1:"cotxe",p2:"hatx"},ownerId:211731,containerId:"adfox_161798102082384984",width:300,height:300},6051:{params:{p1:"cotxf",p2:"hatx"},width:300,height:300,ownerId:211731,containerId:"adfox_161798119101195397"},6060:{params:{p1:"cowia",p2:"hatx"},ownerId:211731,containerId:"adfox_161917179634472859",width:300,height:600},6070:{params:{p1:"cowib",p2:"hatx"},ownerId:211731,containerId:"adfox_161917181893012281",width:600,height:300},7060:{params:{p1:"cpdmt",p2:"hatx"},ownerId:211731,containerId:"adfox_162149686771323941",width:300,height:600},7070:{params:{p1:"cpdmu",p2:"hatx"},ownerId:211731,width:600,height:300,containerId:"adfox_162149690270823188"},7061:{params:{p1:"cpdmv",p2:"hatx"},ownerId:211731,width:"300",height:"300",containerId:"adfox_162149692961859809"},10010:{params:{p1:"cjufh",p2:"frfe"},ownerId:211731,minWidth:1,width:1,height:1,containerId:"adfox_158652426386511765"},10020:{params:{p1:"cfsre",p2:"y"},width:300,height:300,ownerId:211731,containerId:"adfox_159776300578812645"},10030:{params:{p1:"cjwgm",p2:"frfe"},ownerId:211731,minWidth:1,width:1,height:1,containerId:"adfox_15869638319907596"},10040:{params:{p1:"cmsrs",p2:"frfe"},ownerId:211731,minWidth:1,width:1,height:1,containerId:"adfox_160277711955552207"},10050:{ownerId:211731,minWidth:1,width:1,height:1,containerId:"adfox_156026294155411287",params:{p1:"cfchx",p2:"frfe"}},10060:{params:{p1:"cvrhe",p2:"fpaj"},ownerId:211731,containerId:"adfox_166246436023824536",width:300,height:300},10070:{params:{p1:"bzmax",p2:"fpde"},ownerId:211731,containerId:"adfox_166498307798992477",width:300,height:600},10080:{params:{p1:"bzosr",p2:"fpde"},ownerId:211731,containerId:"adfox_166505217723293059",width:300,height:600},10090:{params:{p1:"caakx",p2:"fhgy"},ownerId:211731,containerId:"adfox_166498318703427936",width:300,height:120},10091:{params:{p1:"caakx",p2:"fhgy"},ownerId:211731,containerId:"adfox_169746076848436723",width:300,height:120},10092:{params:{p1:"byufb",p2:"fpaj"},ownerId:211731,containerId:"adfox_16974610095032185",width:300,height:300}}};
/**
 * Mirtesen.
 *
 * AdFox implementation for React.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class M_ extends r.PureComponent{static defaultProps={ownerId:0,containerId:"",localId:"",subCounter:null,params:{p1:"",p2:"",puid1:"",puid2:"",puid3:"",puid4:"",puid5:"",puid6:""}};constructor(e){super(e);const{subCounter:t,containerId:n}=this.props;this.subContainerId=n,t&&(this.subContainerId=`${n}_${t}`),this.state={isLoaded:!1},this.reloadAdFox=this.reloadAdFox.bind(this)}componentDidMount(){this.loadAdFox()}loadAdFox(){const{ownerId:e,reload:t}=this.props;let{params:n}=this.props;const a=this.subContainerId;if("undefined"==typeof window)return null;window.adFoxInitScript=window.adFoxInitScript||!1,window.yaContextCb=window.yaContextCb||[],window.adFoxInitScript||(window.adFoxInitScript=!0,w.Z.loadScript("https://yandex.ru/ads/system/context.js")),K.Z.lazyLoad((()=>void 0!==window.Ya&&void 0!==window.Ya.adfoxCode),(()=>{if("undefined"==typeof window||!document.getElementById(a))return null;this.setState({isLoaded:!0},this.props.onLoad),this.headerBidding(),"string"==typeof n&&(n=JSON.parse(n)),window.yaContextCb.push((()=>{window.Ya.adfoxCode.create({ownerId:e,containerId:a,params:n})})),t&&setInterval(this.reloadAdFox,1e3*t)}),(()=>{console.log("Couldn't load AdFox")}))}headerBidding(){const{containerId:e,subCounter:t}=this.props,n=this.subContainerId;if(!(e&&t&&n&&"undefined"!=typeof window&&void 0!==window.Ya&&void 0!==window.Ya.adfoxCode&&void 0!==window.Ya.headerBidding&&void 0!==window.YaHeaderBiddingSettings&&document.getElementById(n)))return;let a=null,s=null;window.YaHeaderBiddingSettings.adUnits.map((t=>{t.code===e&&(a={...t}),t.code===n&&(s={...t})})),!s&&a&&(a={...a},a.code=n,window.Ya.headerBidding.pushAdUnits([a]))}reloadAdFox(){try{if("undefined"==typeof window||void 0===window.Ya||void 0===window.Ya.adfoxCode||!document.getElementById(this.subContainerId))return;window.Ya.adfoxCode.reload(this.subContainerId)}catch(e){D.Z.promiseHandler("/index.js")(e)}}render(){return r.createElement("div",{id:this.subContainerId,ref:this.props.wrapperRef,style:{minHeight:"300px"}})}}M_.propTypes={ownerId:f().number,containerId:f().string,localId:f().oneOfType([f().string,f().number]),params:f().oneOfType([f().string,f().object,f().array]),subCounter:f().number,reload:f().number,onLoad:f().func,wrapperRef:f().object};const k_=M_;
/**
 * Mirtesen.
 *
 * Criterio implementation for React.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class A_ extends r.PureComponent{static defaultProps={ownerId:0,criterioId:"",localId:"",subCounter:null};constructor(e){super(e);const{subCounter:t,criterioId:n}=this.props;this.subContainerId=`crt-${n}`,t&&(this.subContainerId=`crt-${n}_${t}`),this.state={isLoaded:!1}}loadAdFox(){const{criterioId:e}=this.props,t=this.subContainerId;if("undefined"==typeof window)return null;K.Z.lazyLoad((()=>void 0!==window.Criteo.DisplayAcceptableAdIfAdblocked),(()=>{if("undefined"==typeof window||!document.getElementById(t))return null;this.setState({isLoaded:!0}),window.Criteo=window.Criteo||{},window.Criteo.events=window.Criteo.events||[],window.Criteo.events.push((()=>{window.Criteo.DisplayAcceptableAdIfAdblocked({zoneid:e,containerid:t,overrideZoneFloor:!1}),window.addEventListener("message",(n=>{n.data&&n.data==="criteo-adblock-passback-"+e&&(document.getElementById(t).style.display="none")}),!1)}))}),(()=>{console.log("Couldn't load Criterio")}))}render(){const{isLoaded:e}=this.state;return e||"undefined"==typeof window||this.loadAdFox(),r.createElement("div",{id:this.subContainerId})}}A_.propTypes={criterioId:f().string,localId:f().oneOfType([f().string,f().number]),params:f().oneOfType([f().object,f().array]),subCounter:f().number};const x_=A_;function L_(){return L_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},L_.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * AdFox wrapper for easy to use AdFox component with singleton adConfig.js.
 *
 * @author       Artem Kamysh.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class D_ extends r.PureComponent{constructor(e){super(e);const{adId:t,deviceType:n}=this.props;this.adBlockConfig=L()(O_,`ad.${t}`,{}),this.wrapperRef=r.createRef(),this.state={isSuitableWidth:L()(this.adBlockConfig,"devices",[]).includes(n),adHeight:null}}componentDidMount(){const{hideAdBlocks:e}=this.props;if(e)return null;this.handleShow(),window.addEventListener("resize",this.handleShow)}componentWillUnmount(){window.removeEventListener("resize",this.handleShow)}handleLoad=()=>{try{const e=this.wrapperRef.current;if(!this.props.isResize||!e)return;const t=new ResizeObserver((([{borderBoxSize:e}])=>{const n=e[0].blockSize;n>1?(this.setState({adHeight:n}),t.disconnect()):setTimeout((()=>{t.disconnect()}),7e3)}));t.observe(e)}catch(e){D.Z.promiseHandler("/index.js")(e)}};handleShow=()=>{this.timeOut&&clearTimeout(this.timeOut);const{minWidth:e,maxWidth:t}=this.adBlockConfig;this.timeOut=setTimeout((()=>{let n=!0;if(e>=0||t>=0){const a=window,s=document,r=s.documentElement,o=s.getElementsByTagName("body")[0],i=a.innerWidth||r.clientWidth||o.clientWidth;(i<e&&e>=0||i>t&&t>=0)&&(n=!1)}this.setState({isSuitableWidth:n})}),70)};timeOut=null;render(){const{adId:e,className:t,subCounter:n,isAdBlockerActive:a,reload:s,deviceType:o,isDebug:i,hideAdBlocks:l}=this.props,{isSuitableWidth:c,adHeight:m}=this.state,{width:d,height:p,ymGoal:u}=this.adBlockConfig;if(l)return null;const g={...d&&{maxWidth:d+"px"},...p&&"auto"!==p&&{...!(null!==m)&&{height:p+"px"},maxHeight:p+"px"}},h={adfox:!0,hidden:!c,"test-ad-block":i};t&&(h[t]=!0);let E=this.adBlockConfig.containerId;return n&&(E=`${E}_${n}`),r.createElement("div",{id:`wrapper_${E}`,className:_()(h),style:g,onClick:()=>{u&&na.ym("reachGoal",u)}},i&&c&&r.createElement("div",null,r.createElement("p",null,"Ad Block ",e),r.createElement("p",null,"Ad Block Type: ",a?"Criterio":"AdFox"),r.createElement("p",null,"Params: ",JSON.stringify(this.adBlockConfig)),r.createElement("p",null,"Device Type: ",o)),!i&&a&&c&&r.createElement(x_,L_({localId:e,subCounter:n},this.adBlockConfig)),!i&&!a&&c&&r.createElement(k_,L_({wrapperRef:this.wrapperRef,onLoad:this.handleLoad,localId:e,subCounter:n,reload:s},this.adBlockConfig)))}}D_.defaultProps={adId:null,subCounter:null,className:null},D_.propTypes={adId:f().oneOfType([f().number,f().string]),subCounter:f().number,className:f().string,ymGoal:f().string,isAdBlockerActive:f().bool,reload:f().number,deviceType:f().string,isResize:f().bool,hideAdBlocks:f().bool,isDebug:f().bool};const R_=(0,i.$j)((e=>({isAdBlockerActive:L()(e,"app.isAdBlockerActive"),deviceType:L()(e,"app.req.deviceType"),isDebug:e?.app?.disableAdFox,hideAdBlocks:e?.app?.hideAdBlocks})))(D_),Z_=({children:e,split:t})=>{const[n,a]=(0,r.useState)(null);return(0,r.useEffect)((()=>{a(Math.random()<t?0:1)}),[]),r.createElement(r.Fragment,null,e&&e[n])},B_=(0,r.memo)(Z_);
/**
 * Mirtesen.
 *
 * Person sidebar.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class $_ extends r.PureComponent{render(){const{app:e}=this.props;return r.createElement(r.Fragment,null,"profile"===e.scope&&r.createElement(T_,{app:e}),r.createElement("div",{className:"sidebar-wrapper"},r.createElement(B_,{split:.4},r.createElement(R_,{adId:10080}),r.createElement(Fh,{type:"Politpiar",id:95129}))),e?.person?.id&&r.createElement(N_,{id:e?.person?.id}),r.createElement("div",{className:"sticky sidebar-wrapper"},r.createElement(Fh,{type:"Politpiar",id:99810})))}}$_.propTypes={app:f().object};const U_=$_;
/**
 * Mirtesen.
 *
 * Main Content Component.
 *
 * @author       Artem Kamysh.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class H_ extends r.PureComponent{render(){const{app:e,page:t}=this.props,n="channel"===e.scope?"channel":"profile";return r.createElement("div",{id:"layout",className:"profile-two-column-layout bg-gray"},r.createElement(Jp,{app:e}),r.createElement("div",{id:"main-container"},r.createElement(Gp,null),r.createElement("div",{id:"three-column-container"},r.createElement(Gh,null),r.createElement("div",{id:"content-container",className:"content-container"},r.createElement(Yu,{type:n}),r.createElement("div",{id:"double-column-container"},r.createElement("div",{id:"right-column",className:"right-column right-column_person"},r.createElement(U_,{app:e})),r.createElement("div",{id:"content-column",className:"content-column"},r.createElement(t,{app:e})))))),r.createElement("div",{id:"very-right-column"},r.createElement(Wh,{source:"mt"})),r.createElement(Vh,null))}}H_.propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};const F_=(0,ae.Z)(H_,"profile/twoColumnLayout");
/**
 * Mirtesen.
 *
 * Main Content Component.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class j_ extends r.PureComponent{render(){const{app:e,page:t}=this.props;return r.createElement("div",{id:"layout",className:"profile-one-column-layout bg-gray"},r.createElement(Jp,{app:e}),r.createElement("div",{id:"main-container"},r.createElement(Gp,null),r.createElement("div",{id:"three-column-container"},r.createElement(Gh,null),r.createElement("div",{id:"content-container",className:"content-container"},r.createElement("div",{id:"one-column-container"},r.createElement("div",{id:"content-column",className:"content-column"},r.createElement(Yu,{type:"profile"}),r.createElement(t,{app:e})))))),r.createElement("div",{id:"very-right-column"},r.createElement(Wh,{source:"mt"})),r.createElement(Vh,null))}}j_.propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};const G_=(0,ae.Z)(j_,"profile/OneColumnLayout"),q_=(0,ae.Z)(class extends r.Component{static propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};render(){const{app:e,page:t}=this.props,n=t,a=L()(e,"req.isMobile");return r.createElement("div",{id:"layout",className:"two-column-layout"},r.createElement(Jp,{app:e}),r.createElement("div",{id:"main-container"},r.createElement(Gp,null),r.createElement("div",{id:"double-column-container"},r.createElement(Gh,null),r.createElement("div",{id:"content-container"},r.createElement(n,{app:e})))),!a&&r.createElement("div",{id:"very-right-column"},r.createElement(Wh,{source:"mt"})))}},"mainDomainLayout");
/**
 * Mirtesen.
 *
 * About platform layout.
 *
 * @author       Alexey Savchik.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class V_ extends r.PureComponent{render(){const{app:e,page:t}=this.props;return r.createElement(r.Fragment,null,r.createElement(Jp,{app:e}),r.createElement(Gp,null),r.createElement("div",{className:"about-platform__container"},r.createElement(Gh,{sliderBreakpoint:1220}),r.createElement(t,{app:e})))}}V_.propTypes={app:f().object,page:f().oneOfType([f().object,f().func])};const z_=(0,ae.Z)(V_,"aboutPlatformLayout");
/**
 * Mirtesen.
 *
 * Mt sidebar.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class W_ extends r.PureComponent{render(){return r.createElement(r.Fragment,null,r.createElement("div",{className:"sidebar-wrapper"},r.createElement(Fh,{type:"Politpiar",id:99809})),r.createElement("div",{className:"sticky sidebar-wrapper"},r.createElement(Fh,{type:"Politpiar",id:99810})))}}W_.propTypes={app:f().object};const Y_=(0,ae.Z)(W_,"mtSideBar");
/**
 * Mirtesen.
 *
 * Main Content Component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class K_ extends r.PureComponent{render(){const{app:e,page:t}=this.props;return r.createElement("div",{id:"layout",className:_()("mt-two-column-layout","hashtagPostList"===e.page&&"bg-gray")},r.createElement(Jp,{app:e}),r.createElement("div",{id:"main-container"},r.createElement(Gp,null),r.createElement("div",{id:"three-column-container"},r.createElement(Gh,null),r.createElement("div",{id:"content-container",className:"content-container"},r.createElement("div",{id:"double-column-container"},r.createElement("div",{id:"right-column",className:"right-column"},r.createElement(Y_,{app:e})),r.createElement("div",{id:"content-column",className:"content-column"},r.createElement(t,{app:e})))))),r.createElement("div",{id:"very-right-column"},r.createElement(Wh,{source:"mt"})),r.createElement(Vh,null))}}K_.propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};const J_=(0,ae.Z)(K_,"mt/twoColumnLayout");
/**
 * Mirtesen.
 *
 * Layout for error page.
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class X_ extends r.Component{componentDidMount(){na.init([55305619],{clickmap:!0,webvisor:!1,trackLinks:!0,accurateTrackBounce:!0})}render(){const{app:e,page:t}=this.props,n=t;return r.createElement("div",{id:"layout",className:"error-page-layout"},r.createElement(Jp,{app:e}),r.createElement("div",{className:"error-page-container"},!e.layout_wo_header&&r.createElement(Gp,null),r.createElement("div",{className:"error-page-content"},r.createElement(n,{app:e}))))}}X_.propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};const Q_=(0,ae.Z)(X_,"ErrorPageLayout");
/**
 * Mirtesen.
 *
 * Index page layout.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class eE extends r.PureComponent{render(){const{app:e,page:t}=this.props,n=t,a=(L()(e,"topic.brandingCode")||"").trim(),s={"index-three-column-container":!0,"index-three-column-container_branding":!!a},o={"index-layout":!0,"index-layout_branding":!!a},i=L()(e,"req.isMobile");let l="mt";const c=(L()(e,"topic.key")||"").toLowerCase();return["coronavirus","crysis"].includes(c)&&(l=c),r.createElement("div",{id:"layout",className:_()(o)},r.createElement(Jp,{app:e}),r.createElement("div",{id:"main-container"},r.createElement(Gp,null),a?r.createElement("div",{dangerouslySetInnerHTML:{__html:a}}):null,r.createElement("div",{id:"three-column-container",className:_()(s)},r.createElement(Gh,null),r.createElement("div",{id:"index-content-container",className:"content-container"},r.createElement("div",{id:"index-inner-container"},r.createElement("div",{id:"index-content-column",className:"content-column"},r.createElement(n,{app:e})))))),!i&&r.createElement("div",{id:"very-right-column",className:"right-column"},r.createElement(Wh,{source:l})))}}eE.propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};const tE=(0,ae.Z)(eE,"indexLayout");
/**
 * Mirtesen.
 *
 * Messenger API implementation.
 *
 * @author       Alexander Mazurok.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
let nE=!1;const aE=()=>{if(!1===nE&&(nE=!0,void 0===window.mtMessenger)){const e=K.Z.getStaticHost()||"",t=document.createElement("script");t.src=`${e}/messenger/loader.v2.js`,t.async=!0,document.head.appendChild(t)}};const sE=class{static mount=e=>{aE(),window.mtMessenger=window.mtMessenger||[],window.mtMessenger.push(["mount",e])};static mountChatExternal=e=>{aE(),window.mtMessenger=window.mtMessenger||[],window.mtMessenger.push(["mountChatExternal",e])};static unmountChat=e=>{aE(),window.mtMessenger=window.mtMessenger||[],window.mtMessenger.push(["unmountChat",e])}},rE=({app:e})=>{const t=(0,r.useRef)(),[n,a]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{if("undefined"==typeof window)return;const e=t.current;n||sE.mount({container:e,onLoad:()=>a(!0)})}),[n]),Rp().disableChat||L()(e,"req.lightApp")?null:r.createElement("div",{ref:t})};rE.propTypes={app:f().object};const oE=(0,i.$j)((({app:e})=>({app:e})))(rE),iE=(0,ae.Z)(class extends r.Component{static propTypes={app:f().object};render(){const{app:e}=this.props,t=L()(e,"siteBuilder.layout.style",{});return r.createElement("div",{id:"layout",className:"one-column-layout",style:t},r.createElement(Jp,{app:e}),r.createElement("div",{id:"main-container"},r.createElement(Gp,null)),r.createElement(oE,null))}},"messengerLayout"),lE=(0,r.memo)((({app:e,page:t})=>{const n=t;return r.createElement(r.Fragment,null,r.createElement(Jp,{app:e}),r.createElement("div",{id:"v-layout"},r.createElement(Gp,null),r.createElement("div",{id:"v-three-column-container"},r.createElement(Gh,{id:"v-very-left-column",sliderBreakpoint:1075}),r.createElement("div",{id:"v-double-column-container"},r.createElement("div",{id:"v-content-column-list"},r.createElement(n,{app:e}))))),r.createElement(Vh,null))})),cE=(0,ae.Z)(lE,"videoLayout");
/**
 * Mirtesen.
 *
 * Infinite scroll item
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 20202, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class mE extends r.PureComponent{constructor(){super(),this.elemRef=r.createRef(),this.state={isIntersecting:!0,height:null,isDelayedHeight:!1},this.timer=null}componentDidMount(){if("undefined"==typeof IntersectionObserver||K.Z.isIframe())return;const e=new IntersectionObserver(H()((e=>{let t=!1;e.forEach((e=>{e.isIntersecting&&(t=!0)}));if(!this.elemRef.current||this.state.isIntersecting===t)return;const n={isIntersecting:t};Yt.findDOMNode(this.elemRef.current)&&(n.height=Yt.findDOMNode(this.elemRef.current).offsetHeight),!0===t&&(n.isDelayedHeight=!0,this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.timer=null,this.setState({isDelayedHeight:!1})}),2e3)),this.setState(n)}),300),{root:null,rootMargin:"2000px",threshold:.01}),t=Yt.findDOMNode(this.elemRef.current);e.observe(t)}componentWillUnmount(){clearTimeout(this.timer)}render(){const{isIntersecting:e,height:t,isDelayedHeight:n}=this.state,{id:a,className:s,tag:o}=this.props,i=o;return r.createElement(i,{id:a,className:_()({inft:!0,inft_hdn:!e,[s]:!!s&&"true"}),ref:this.elemRef,style:!e||n?{minHeight:t}:null},e?this.props.children:null)}}mE.defaultProps={id:null,className:null,tag:"div"},mE.propTypes={children:f().any,id:f().string,className:f().string,tag:f().string};const dE=mE;var pE="/index.js";
/**
 * Mirtesen.
 *
 * View stats implementation.
 *
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class uE extends r.PureComponent{static defaultProps={id:null,statsData:null,className:null,iconClassName:null,style:null,minReads:0,rootMargin:"500px 0px 500px 0px",counter:"view",debug:!1,appearence:"eye",postType:"bp"};constructor(){super(),this.elemRef=r.createRef(),this.timeOut=null,this.state={statsData:null,firstShow:!0}}componentDidMount(){return"undefined"==typeof window||window.viewStats||(window.viewStats=[]),this.initStats()}componentWillUnmount(){const{id:e,postType:t}=this.props;this.timeOut&&clearTimeout(this.timeOut),window._viewsStatSocket&&window._viewsStatSocket.emit("message",{type:"leave",rooms:[`${t}${e}`]})}async getCounter(){const{id:e,counter:t,postType:n}=this.props,{firstShow:a}=this.state,s=!a||"none"===t||"undefined"!=typeof window&&window.viewStats.includes(e),r=["all","force-all"].includes(t);this.setState({firstShow:!1}),"undefined"!=typeof window&&window.viewStats.push(e);const o=await B.getViews(`[["${n}", "${e}"]]`,r,"",s);e&&!s&&(r&&fetch(`https://a.mt.ru/clinc/${e}/view/1`).catch(D.Z.promiseHandler(pE)),fetch(`https://a.mt.ru/clinc/${e}/lead/1`).catch(D.Z.promiseHandler(pE)));const i=L()(o,`${n}.${e}`);i&&this.setState({statsData:i})}async initStats(){const{counter:e}=this.props;["force-view","force-all"].includes(e)&&this.getCounter(),this.updateStats()}subscribe(e){const{id:t,postType:n}=this.props;if(!t||!window)return;window._mtViewStats||(window._mtViewStats={});let a=window._mtViewStats[t]||0;e?a++:a--,a<0&&(a=0),window._mtViewStats[t]=a,a>0?(window._viewsStatSocket||(window._viewsStatSocket=(0,$.ZP)("//socket2.mirtesen.ru/trk",{transports:["websocket"]})),window._viewsStatSocket&&(window._viewsStatSocket.on("message",H()((e=>{if(!L()(e,"data"))return;const[n,a,s,r,o]=e.data;if(t!==Number(a))return;const i={views:s,coverage:r,reads:o};this.setState({statsData:i})})),300),window._viewsStatSocket.emit("message",{type:"join",rooms:[`${n}${t}`]}))):window._viewsStatSocket&&window._viewsStatSocket.emit("message",{type:"leave",rooms:[`${n}${t}`]})}log(e){return this.props.debug&&console.log(e)}async updateStats(){const{rootMargin:e}=this.props,t={root:null,rootMargin:e,threshold:1};if("undefined"==typeof IntersectionObserver||K.Z.isIframe())return this.getCounter(),void this.subscribe(!0);const n=new IntersectionObserver((e=>{this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{let t=!1;e.forEach((e=>{e.isIntersecting&&(t=!0)})),t&&this.getCounter(),this.subscribe(t)}),300)}),t),a=Yt.findDOMNode(this.elemRef.current);a&&n.observe(a)}render(){const{className:e,style:t,minReads:n,postType:a,appearence:s}=this.props,{statsData:o}=this.state;let i=L()(o,"views",0),l=L()(o,"coverage",0),c=L()(o,"reads",0);return c<n&&(c=n,i<c&&l<c&&(i+=c,l+=c)),r.createElement("div",{ref:this.elemRef,className:_()({"view-stats":!0,[e]:!!e})},"eye"===s&&r.createElement(r.Fragment,null,r.createElement("div",{className:_()({"view-stats__views":!0}),style:t},r.createElement(yn.Z,{iconName:"eye"}),o&&0!==Number(i)&&y.Z.formatViewsCounter(i)),o&&r.createElement("div",{className:"view-stats__tooltip"},r.createElement("p",null,r.createElement("label",null,"Показы"),r.createElement("i",null,i)),r.createElement("p",null,r.createElement("label",null,"Охват"),r.createElement("i",null,l)),"bp"===a&&r.createElement("p",null,r.createElement("label",null,"Прочтение"),r.createElement("i",null,c)))),"string"===s&&r.createElement("div",{className:"view-stats__counter"},o&&0!==Number(i)&&y.Z.formatViewsCounter(i,"ru")+" "+y.Z.num2string(i,["просмотр","просмотра","просмотров"])))}}uE.propTypes={id:f().number,className:f().string,style:f().object,iconClassName:f().string,minReads:f().number,counter:f().string,debug:f().bool,rootMargin:f().string,postType:f().string,appearence:f().string};const gE=uE,hE=({playerData:e})=>{const[t,n]=(0,r.useState)(!0),a=(0,r.useRef)(null),{Image:s,VideoPreview:o,Duration:i}=e||{};return r.createElement("div",{className:"video-preview",style:{backgroundColor:s||o?"transparent":"#ececec"}},o?r.createElement("div",{className:"video-preview__video",onMouseOver:()=>{n(!1),a?.current?.play()},style:{backgroundImage:`url('${y.Z.fixProtocol(s)})')`},onMouseOut:()=>{a?.current?.pause(),a?.current?.setAttribute("currentTime","0"),n(!0)}},r.createElement("video",{ref:a,src:o,style:{width:"100%",height:"100%",objectFit:"cover",display:t?"none":"block"},muted:!0,preload:"metadata",poster:s})):r.createElement(kn.Z,{src:y.Z.fixProtocol(s),tag:"div",className:"video-preview__img"}),i&&r.createElement("i",{className:"duration"},Math.floor(i/60),":",i%60))},_E=(0,r.memo)(hE);var EE=n(78861);
/**
 * Mirtesen.
 *
 * Video Recommndations container.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const fE=()=>{const e=(0,aa.C)((e=>e.videoRecommendations)),t=(0,aa.C)((e=>e.app?.req)),{items:n,hasMore:a}=e,s=(0,aa.T)();return r.createElement("div",{className:"video-recommendations"},r.createElement("h3",{className:"title"},"Для вас"),r.createElement(zn,{loadMore:()=>{s((async(e,t)=>{try{const n=t(),{nextOffset:a,recordsPerPage:s,mainVideoPostId:r}=n.videoRecommendations,o=await vt.default.getVideoFeed({limit:s,offset:a,currentUserPostId:r});e({type:"VIDEO_RECOMMENDATIONS_LOAD_MORE",items:o.items,hasMore:!!o.items.length,nextOffset:o.nextOffset})}catch(e){D.Z.promiseHandler("/index.js")(e)}}))},hasMore:a,threshold:800,loader:null},r.createElement("div",{className:"list"},n.map((e=>{const n=e.videos?.[0],{pandaVideoId:a,player_data:s,title:o}=n||{},{from:i,channel:l,id:c}=e;return r.createElement(dE,{key:a},r.createElement("a",{className:"video-thumb",href:`${t.protocol}://${t.host}/video/${c}`},r.createElement("div",{className:"thumb"},r.createElement(_E,{playerData:s})),r.createElement("div",{className:"info"},r.createElement("h4",{className:"title"},o),r.createElement("div",{className:"source"},y.Z.truncateString(l?.name||i.display_name,30)),r.createElement(gE,{id:c,postType:EE.ZP.getViewCounterType(e),className:"views",appearence:"string"}))))})))))},bE=(0,ae.Z)((0,r.memo)(fE),"VideoRecommendations"),yE=(0,r.memo)((({app:e,page:t})=>{const n=t;return r.createElement(r.Fragment,null,r.createElement(Jp,{app:e}),r.createElement("div",{id:"v-layout"},r.createElement(Gp,null),r.createElement("div",{id:"v-three-column-container"},r.createElement(Gh,{id:"v-very-left-column",sliderBreakpoint:1e4}),r.createElement("div",{id:"v-double-column-container"},r.createElement("div",{id:"v-content-column-one"},r.createElement(n,{app:e})),r.createElement("div",{id:"v-right-column"},r.createElement(bE,null))))),r.createElement(Vh,null))})),vE=(0,ae.Z)(yE,"videoOneLayout"),TE=({item:e,isLabel:t,extraClasses:n="",unreadCounter:a,isActive:s,onClick:o})=>r.createElement(ia.Z,{href:e.url,className:_()("menu-item",s&&"active",!t&&"menu-item_mini",n),onClick:e=>{"function"==typeof o&&(e.preventDefault(),o())}},r.createElement("span",{className:"menu-item__inner"},e.icon&&r.createElement(yn.Z,{iconName:s?e.icon:`${e.icon}-stroke`}),t&&r.createElement("span",{className:"label"},e.label),e.counter&&a?.[e.counter]>0&&r.createElement("i",{className:_()("counter")},K.Z.format99Plus(a[e.counter])))),SE=(0,r.memo)(TE),PE=({isCompact:e})=>{const t=(0,aa.C)((e=>e.app?.channel)),n=(0,aa.C)((e=>e.auth?.user)),a=(0,aa.T)(),s=e?"":r.createElement("span",null,"Создать..."),o="cross-in-circle",i=_()("btn btn-primary",e&&"compact"),l=re.Z.getConfig(),c=(0,r.useCallback)((()=>{a(Rt("default",null,{author:{id:n.id,name:n.display_name,image:n.photo_original||""},target:{type:"channel",id:t?.is_owner?t?.id:void 0,channelName:t?.name,channelTitle:t?.title,geo:{status:"auto",tagId:t?.geotag_id}}}))}),[n,t]),m=(0,r.useCallback)((()=>{kt.Z.sendMessage({type:"MT_APP_OPEN_CHANNEL_EDITOR",channelId:null})}),[]);return b.ZP.isLogged()?r.createElement(G.Z,{id:"add-menu",placement:"top-left",customDropdownClasses:"add-menu",customListClasses:"channel-dropdown",buttonProps:{label:s,icon:o,extraClasses:i},offset:[0,-48]},r.createElement(ia.Z,{className:"channel-dropdown__item",onClick:c},"Пост"),r.createElement(ia.Z,{className:"channel-dropdown__item desktop-only",href:l.mainProto+"://"+l.channelDomain+"/editor"+(t?.is_owner&&t?.id?`?channel=${t?.name}`:"")},"Статью"),r.createElement(ia.Z,{className:"channel-dropdown__item divider",onClick:m},"Канал")):r.createElement("div",{className:"add-menu"},r.createElement(ia.Z,{className:i,onClick:()=>{a(_e("login"))}},r.createElement(yn.Z,{iconName:o}),s))},wE=(0,r.memo)(PE),IE=({mode:e})=>{const t=(0,aa.T)();return r.createElement("div",{className:_()("auth-controls",e)},r.createElement("div",{className:"descr"},r.createElement("h4",null,"События, определяющие день"),r.createElement("p",null,"Присоединяйтесь и будьте в курсе")),r.createElement("div",{className:"controls-wrap"},r.createElement(He.Z,{color:"empty",outline:"primary",label:"Вход",extraClasses:"auth-control",onClick:()=>{t(_e("login"))}}),r.createElement(He.Z,{color:"primary",label:"Регистрация",extraClasses:"auth-control",onClick:()=>{t(_e("registration"))}})))},CE=(0,r.memo)(IE),NE=(0,r.memo)((()=>{const e=(0,aa.C)((e=>e.activityNotifications)),{items:t=[],hasMoreItems:n,nextFrom:a}=e,s=(0,aa.T)();return r.createElement(zn,{loadMore:()=>{s(lp(50,a,"mt.ru"))},hasMore:n,threshold:800,loader:r.createElement(Yn,null)},r.createElement("div",{className:"notification-list"},t.map((e=>r.createElement(Jd,{item:e,key:e.id,dateFormat:"HH:mm"})))))})),OE=(0,ae.Z)(NE,"channelActivities"),ME=(0,r.memo)((()=>{const e=(0,aa.T)(),t=(0,aa.C)((e=>e.messageNotifications?.items||[])),n=(0,aa.C)((e=>e.messageNotifications?.hasMoreItems)),a=re.Z.getConfig();return r.createElement(zn,{loadMore:()=>{e(Vd())},hasMore:n,threshold:800,loader:r.createElement(Yn,null)},r.createElement("div",{className:"notification-list"},t.map((e=>r.createElement(Qd,{key:e.id,item:e,mainDomain:a.mainDomain})))))})),kE=ME,AE={activities:"Уведомления",chats:"Чаты"},xE=({menuConfig:e,page:t})=>{const[n,a]=(0,r.useState)(""),{activitiesCounter:s,changeActivitiesCount:o}=Cp(),{messagesCounter:i,changeMessagesCount:l}=Np(),c=(0,Op.E)(),m=b.ZP.getCurrentUserId();Mp(c,m?"navigation_update_"+m:null,(e=>{if("object"==typeof e&&"number"==typeof e.count)switch(e.event){case"message":l(e.count);break;case"comment":o(e.count)}}));const d={activities:s,messages:i};return r.createElement("div",{className:"channel-bottom-bar"},!b.ZP.isLogged()&&r.createElement(CE,{mode:"compact"}),r.createElement("div",{className:"channel-bottom-bar__menu"},e.map((e=>{if(e.forAuthorized&&!b.ZP.isLogged())return null;if(e.forDev&&!b.ZP.isDeveloper())return null;if(e.forModerator&&!b.ZP.isModerator())return null;let n;return"chats"!==e.id&&"activities"!==e.id||(n=()=>a(e.id)),"add"===e.id?r.createElement(wE,{key:e.id}):r.createElement(SE,{item:e,key:e.id,isActive:t===e.id,onClick:n,unreadCounter:d})}))),n&&r.createElement(O.Z,{onClose:()=>a(""),className:"channel-bottom-bar__submenu"},r.createElement(O.Z.Header,null,AE[n]),r.createElement(O.Z.Body,null,"activities"===n&&r.createElement(OE,null),"chats"===n&&r.createElement(kE,null))))},LE=(0,r.memo)(xE),DE=({isCompact:e})=>{const t=(0,aa.C)((e=>e.auth?.user)),[n,a]=(0,r.useState)([]),s=(0,aa.T)();return(0,r.useEffect)((()=>{t?.id&&(async e=>{const t=await At.ZP.getUserChannels(e);t&&a(t)})(t?.id)}),[t]),r.createElement(G.Z,{id:"sidebar-profile",placement:"top-left",customDropdownClasses:"sidebar-profile",customListClasses:"channel-dropdown",customButtonClasses:_()("sidebar-profile__btn",e&&"compact"),buttonValue:r.createElement(r.Fragment,null,r.createElement(Mn.Z,{logoInfo:{userName:t?.display_name,logoImg:t?.photo_original,title:t?.display_name}}),!e&&r.createElement(r.Fragment,null,r.createElement("span",{className:"user-name"},t?.display_name),r.createElement(yn.Z,{iconName:"more"}))),offset:[0,-40]},n.map(((e,t)=>r.createElement(ia.Z,{key:e.id,href:`/${e.name||e.id}`,className:"channel-dropdown__item"},e.title))),r.createElement(ia.Z,{className:"channel-dropdown__item divider",href:"https://mirtesen.ru/settings/personal",onClick:e=>{e.preventDefault(),Xo.Z.replaceLocationWithMirtesenKey(e)}},"Настройки"),r.createElement(ia.Z,{className:"channel-dropdown__item divider",onClick:()=>{s(se("mt.ru"))}},"Выйти"))},RE=(0,r.memo)(DE);function ZE(){return ZE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ZE.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Info menu
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 202, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const BE=[{id:"about",title:"О компании",url:"",icon:"question"},{id:"news",title:"Новости",url:"news",icon:"info"},{id:"partners",title:"Партнерам",url:"partners",icon:"case"},{id:"advertising",title:"Рекламодателям",url:"promo",icon:"advertising"},{id:"agreement",title:"Соглашение",url:"agreement",icon:"document"},{id:"recommendation",title:"О рекомендательных технологиях",url:"recommendation_rules",icon:"document"},{id:"spam",title:"Пожаловаться на спам",icon:"trash",isDivider:!0},{id:"feedback",title:"Обратная связь",icon:"feedback"}],$E=()=>{const e=(0,aa.T)();return r.createElement("div",{className:"info-menu"},r.createElement("div",{className:"list"},BE.map((t=>{const n="string"==typeof t.url?{href:"https://info.mirtesen.ru/"+t.url}:{type:"button",onClick:()=>{e(ng(t.id,!0))}};return r.createElement(ia.Z,ZE({key:t.id,className:_()("item",t.isDivider&&"divider")},n),r.createElement(yn.Z,{iconName:t.icon}),t.title)}))),r.createElement("p",{className:"text"},'На информационном ресурсе применяются рекомендательные технологии (информационные технологии предоставления информации на основе сбора, систематизации и анализа сведений, относящихся к предпочтениям пользователей сети "Интернет", находящихся на территории Российской Федерации)'))},UE=(0,r.memo)($E),HE={info:"О компании",activities:"Уведомления",chats:"Чаты"},FE=({activeSubmenu:e,onClose:t})=>e?r.createElement("div",{className:"submenu"},r.createElement("div",{className:"submenu__header"},r.createElement("h4",{className:"submenu__title"},HE[e]||""),r.createElement(ia.Z,{className:"close",onClick:t},r.createElement(yn.Z,{iconName:"close"}))),"info"===e&&r.createElement(UE,null),"activities"===e&&r.createElement(OE,null),"chats"===e&&r.createElement(kE,null)):null,jE=(0,r.memo)(FE);const GE=({menuConfig:e,page:t})=>{const[n,a]=(0,r.useState)(!1),s=(0,r.useRef)(null),{activitiesCounter:o,changeActivitiesCount:i}=Cp(),{messagesCounter:l,changeMessagesCount:c}=Np(),m=(0,Op.E)(),d=Md(),p=function(){const[e,t]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const e=document.createElement("div");e.style.overflowY="scroll",e.style.width="50px",e.style.height="50px",document.body.append(e);const n=e.offsetWidth-e.clientWidth;e.remove(),t(n)}),[]),e}(),u=b.ZP.getCurrentUserId(),g=(0,aa.T)(),[h,E]=(0,r.useState)(!1);Ep(s,(()=>{a(!1)})),(0,r.useEffect)((()=>{E(ca.canView("CHANNEL_FEEDBACK"))}),[]);Mp(m,u?"navigation_update_"+u:null,(e=>{if("object"==typeof e&&"number"==typeof e.count)switch(e.event){case"message":c(e.count);break;case"comment":i(e.count)}}));const f={activities:o,messages:l},y=Number(d+p+1)>=At.ZP.BREAKPOINTS.MD&&!n?"mt-logo":"mt-logo-mobile";return r.createElement("div",{className:_()("left-sidebar",n&&"has-submenu"),ref:s},r.createElement("div",{className:"left-sidebar__top"},r.createElement("div",{className:"left-sidebar__logo"},r.createElement("a",{href:"/"},m&&r.createElement(yn.Z,{iconName:y,extraClasses:"mt-logo"===y?"":"icon-mobile"}))),r.createElement("div",{className:"left-sidebar__menu"},e.map((e=>{if(e.forAuthorized&&!b.ZP.isLogged())return null;if(e.forDev&&!b.ZP.isDeveloper())return null;if(e.forModerator&&!b.ZP.isModerator())return null;let s;return"chats"!==e.id&&"activities"!==e.id||(s=()=>{a(e.id)}),r.createElement(SE,{item:e,key:e.id,unreadCounter:f,isLabel:!n,isActive:t===e.id||n===e.id,onClick:s})}))),b.ZP.isLogged()&&r.createElement(wE,{isCompact:!!n})),r.createElement("div",{className:"left-sidebar__bottom"},!b.ZP.isLogged()&&!n&&r.createElement(CE,{mode:"full"}),b.ZP.isLogged()&&r.createElement(RE,{isCompact:!!n}),r.createElement("div",{className:"left-sidebar__apps"},r.createElement(yn.Z,{iconName:"apps"}),r.createElement("span",null,"Скачать приложение для ",r.createElement("a",{href:"https://apps.apple.com/ru/app/%D0%BC%D0%B8%D1%80%D1%82%D0%B5%D1%81%D0%B5%D0%BD/id1229626373"},"iOS"),", для ",r.createElement("a",{href:"https://play.google.com/store/apps/details?id=ru.mirtesen.mobile"},"Android"))),r.createElement(ia.Z,{id:"feedback-switcher",type:"button",className:"left-sidebar__info",onClick:()=>{na.ym("reachGoal","supportmt"),g(ng("feedback",!0,{title:"Новый MT.ru",category:9}))}},r.createElement(yn.Z,{iconName:"feedback"}),r.createElement("span",null,"Оставить обратную связь"),h&&r.createElement("div",{className:"sidebar-tooltip",onClick:e=>{e.stopPropagation()}},r.createElement("i",{className:"close",onClick:e=>{e.stopPropagation(),E(!1),ca.setView("CHANNEL_FEEDBACK"),na.ym("reachGoal","supportclose")}},r.createElement(yn.Z,{iconName:"close"})),r.createElement("h3",null,"Оставьте вашу обратную связь"),r.createElement("p",null,"Помогите нам стать лучше"))),r.createElement(ia.Z,{type:"button",className:"left-sidebar__info",onClick:()=>{a("info")}},r.createElement(yn.Z,{iconName:"info"===n?"info-invert":"info"}),r.createElement("span",null,"О компании..."))),r.createElement(jE,{activeSubmenu:n,onClose:()=>{a(!1)}}))},qE=(0,r.memo)(GE),VE={left:[{id:"indexChannel",icon:"feed",label:"Лента",url:"/",forAuthorized:!1},{id:"sandbox",icon:"feed",label:"Песочница",url:"/sandbox/top",forModerator:!0},{id:"myChannels",icon:"compas",label:"Каналы",url:"/channels",forAuthorized:!0},{id:"activities",icon:"bell",label:"Уведомления",url:"https://mirtesen.ru/activities/feedback",counter:"activities",forAuthorized:!0},{id:"chats",icon:"comment-3",label:"Чаты",url:"https://chat.mirtesen.ru/messenger",counter:"messages",forAuthorized:!0}],bottom:[{id:"indexChannel",icon:"feed",label:"Лента",url:"/",forAuthorized:!1},{id:"chats",icon:"comment-3",label:"Чаты",url:"https://chat.mirtesen.ru/messenger",counter:"messages",forAuthorized:!0},{id:"add",icon:"cross-in-circle",label:"Добавить",forAuthorized:!0},{id:"myChannels",icon:"compas",label:"Каналы",url:"/channels",forAuthorized:!0},{id:"activities",icon:"bell",label:"Уведомления",url:"https://mirtesen.ru/activities/feedback",counter:"activities",forAuthorized:!0}]};var zE=n(81827);const WE=()=>{const[e,t]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const e=re.Z.getConfig();if(void 0!==window?.document){const n=zE.Z.extractHostname(window.document.referrer);e.channelDomain===n&&window.history?.length>1&&t(!0)}}),[]),e&&r.createElement(ia.Z,{type:"button",className:"header-back",onClick:()=>{window?.history&&window.history.back()}},r.createElement(yn.Z,{iconName:"back-3"}))},YE=({searchQuery:e})=>r.createElement("div",{className:"search-error"},r.createElement("img",{alt:"no results",src:"/images/failed-search.svg"}),r.createElement("p",null," ","По запросу ",r.createElement("i",null,e)," ничего не найдено")),KE=(0,r.memo)(YE),JE=e=>{const[t,n]=(0,r.useState)(!1),[a,s]=(0,r.useState)(null);return(0,r.useEffect)((()=>{const t=({key:t,target:a})=>{t===e&&(n(!0),s(a))},a=({key:t})=>{t===e&&(n(!1),s(null))};return window.addEventListener("keydown",t),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",a)}}),[e]),[t,a]};var XE=function(e){return e.ArrowUp="ARROW_UP",e.ArrowDown="ARROW_DOWN",e.SetListLength="SET_LIST_LENGTH",e}(XE||{});const QE=(e,t)=>{switch(t.type){case XE.ArrowUp:return{...e,selectedIndex:e.selectedIndex>0?e.selectedIndex-1:e.selectedIndex};case XE.ArrowDown:return{...e,selectedIndex:e.listLength-1!==e.selectedIndex?Number(e.selectedIndex)+1:0};case XE.SetListLength:return{...e,listLength:t.payload};default:return e}},ef=(e=-1,t=0)=>{const[n]=JE("ArrowUp"),[a]=JE("ArrowDown"),[s,o]=(0,r.useReducer)(QE,{selectedIndex:e,listLength:t});(0,r.useEffect)((()=>{n&&o({type:XE.ArrowUp})}),[n]),(0,r.useEffect)((()=>{a&&o({type:XE.ArrowDown})}),[a]);return{selectedIndex:s.selectedIndex,setListLength:e=>{o({type:XE.SetListLength,payload:e})}}},tf=({keyValue:e,listLength:t,onItemClick:n,onItemActive:a})=>{const[s,o]=(0,r.useState)([]),{selectedIndex:i,setListLength:l}=ef();return(0,r.useEffect)((()=>{let n=fp.Z.getHistory(e);n=n.reverse().slice(0,t),o(n),l(n.length)}),[e]),(0,r.useEffect)((()=>{-1!==i&&a({id:`search-history-${i}`,value:s[i]||""})}),[i]),r.createElement("div",{className:"search-history"},s.length<1&&r.createElement("p",{className:"placeholder"},"Здесь можно найти публикации, каналы, места или ключевые слова"),s.length>=1&&r.createElement("div",{className:"items",role:"listbox"},s.map(((a,s)=>r.createElement("div",{id:`search-history-${s}`,className:_()("item",s===i&&"active"),key:s,role:"option","aria-selected":s===i,tabIndex:0,onClick:()=>{n(a)},"data-text":a},r.createElement("span",{className:"icon"},r.createElement(yn.Z,{iconName:"clock2"})),r.createElement("span",{className:"text"},a),r.createElement(ia.Z,{type:"button",className:"delete-btn",onClick:n=>{n.stopPropagation();const s=fp.Z.deleteFromHistory(e,a);o(s.reverse().slice(0,t))}},r.createElement(yn.Z,{iconName:"close"})))))))},nf=(0,r.memo)(tf),af=({tagId:e,display:t="list"})=>{const n=re.Z.getConfig(),[a,s]=(0,r.useState)([]);return(0,r.useEffect)((()=>{(async()=>{const t=await Pa.Z.getParentTags(e);s(t||[])})()}),[]),a.length<1?null:r.createElement(r.Fragment,null,"list"===t&&r.createElement("ul",{className:"parent-hashtags parent-hashtags_list"},a.map(((e,t)=>r.createElement("li",{className:"parent-hashtags__item",key:t},r.createElement("a",{href:`${n.mainProto}://${n.mainDomain}/hashtags/${encodeURIComponent(e.text)}`},Pa.Z.stripGeoId(e.text)),r.createElement("i",null,"·"))))),"text"===t&&r.createElement("div",{className:"parent-hashtags parent-hashtags_text"},a.map(((e,t)=>r.createElement(r.Fragment,{key:t},Pa.Z.stripGeoId(e.text),t<a.length-1&&r.createElement(r.Fragment,null,", "))))))},sf=(0,r.memo)(af),rf=({results:e,query:t,onItemActive:n})=>{const{channels:a,geo:s,posts:o}=e,i=a.length+s.length+o.length,{selectedIndex:l}=ef(-1,i+1);(0,r.useEffect)((()=>{-1!==l&&n(`search-results-${l}`)}),[l]);let c=1;const m=re.Z.getConfig(),{mainProto:d,channelDomain:p}=m;return r.createElement(r.Fragment,null,r.createElement("a",{className:_()("header",0===l&&"active"),href:`/search?q=${t}`,id:"search-results-0"},r.createElement("h4",{className:"title"},"Перейти к результатам"),r.createElement("span",{className:"icon"},r.createElement(yn.Z,{iconName:"chevron-right"}))),r.createElement("div",null,a?.length>0&&r.createElement("div",{className:"result-list",role:"listbox"},r.createElement("h5",{className:"title",role:"presentation"},"Каналы"),r.createElement("div",{id:"search-popup-channels"},a.map((e=>{const t=c;return c++,r.createElement("a",{id:`search-results-${t}`,href:`${d}://${p}/${e.name}`,className:_()("item",l===t&&"active"),key:e.id,role:"option","aria-selected":l===t},r.createElement(Mn.Z,{logoInfo:{userName:e.title,logoImg:e.avatar_info?.avatar||e.avatar_info?.photo_original,size:"av80"}}),r.createElement("div",{className:"info"},r.createElement("span",{className:"name"},e.title),Number(e.subscribers_num)>0&&r.createElement("span",{className:"counter"},y.Z.formatViewsCounter(e.subscribers_num)+" "+y.Z.num2string(e.subscribers_num,["подписчик","подписчика","подписчиков"]))))})))),s?.length>0&&r.createElement("div",{className:"result-list",role:"listbox"},r.createElement("h5",{className:"title",role:"presentation"},"Места"),r.createElement("div",{id:"search-popup-geo"},s.map((e=>{const t=c;return c++,r.createElement("a",{id:`search-results-${t}`,href:`${d}://${p}/hashtags/${encodeURIComponent(e.text)}`,className:_()("item",l===t&&"active"),key:e.id,role:"option","aria-selected":l===t},r.createElement("span",{className:"geo-icon"},r.createElement(yn.Z,{iconName:"geo"})),r.createElement("div",{className:"info"},r.createElement("span",{className:"name"},Pa.Z.stripGeoId(e.text)),r.createElement(sf,{tagId:e.id,display:"text"})))})))),o?.length>0&&r.createElement("div",{className:"result-list",role:"listbox"},r.createElement("h5",{className:"title",role:"presentation"},"Публикации"),r.createElement("div",{id:"search-popup-posts"},o.map((e=>{const t=c;c++;const n=e.title?y.Z.truncateString2(y.Z.stripTags(e.title),50," "):y.Z.truncateString2(y.Z.stripTags(e.preview_text),50," ");return r.createElement("a",{id:`search-results-${t}`,href:`${d}://${p}/${e?.channel?.name}/${e.id}`,className:_()("item",l===t&&"active"),key:e.id,role:"option","aria-selected":l===t},r.createElement(Mn.Z,{logoInfo:{userName:e?.channel?.title,logoImg:e?.channel?.avatar_info?.avatar||e?.channel?.avatar,size:"av80"}}),r.createElement("div",{className:"info"},r.createElement("span",{className:"preview"},n)))}))))))},of=(0,r.memo)(rf),lf=(e,t)=>({type:"VERY_TOP_HEADER_SET_SEARCH_ACTIVE",uniqKey:e,searchActive:t}),cf="searchHistory",mf=({uniqKey:e})=>{const t=(0,aa.T)(),n=(0,aa.C)((e=>e.app?.page)),a=(0,aa.C)((t=>t.veryTopHeader[e]?.searchActive)),s=(0,aa.C)((e=>e.app?.req?.query?.q)),o="mtSearchResultsPage"===n,[i,l]=(0,r.useState)(!1),[c,m]=(0,r.useState)("history"),[d,p]=(0,r.useState)(!1),[u,g]=(0,r.useState)(null),[h,_]=(0,r.useState)(o?s:""),[E,f]=(0,r.useState)(),[b]=JE("Escape"),[y]=JE("Tab"),[v]=JE("Enter"),T=Md(),S=Number(T)<At.ZP.BREAKPOINTS.XS,P=(0,r.useRef)(null),w=(0,r.useRef)();(0,r.useEffect)((()=>{l(!o)}),[o]),(0,r.useEffect)((()=>{o||!b&&!y||I()}),[b,y]),(0,r.useEffect)((()=>{!1!==T&&(w.current&&w.current!==T&&I(),w.current=T)}),[T]),(0,r.useEffect)((()=>{(()=>{if(a)if(!v||"history"!==c&&E){const e=document.getElementById(E||"");e&&e.click()}else window.location.href=`/search?q=${h}`})()}),[v,i]),(0,kr.O)("scroll",(()=>{o?l(!1):S||I()})),(0,kr.O)("keydown",(e=>{"ArrowUp"!==e.key&&"ArrowDown"!==e.key||e.preventDefault()})),Ep(P,(e=>{const t=document.querySelector(".header-search-dropdown"),n=e.composedPath();t&&!n.includes(t)&&l(!1)}));const I=()=>{t(lf(e,!1))},C=(0,r.useCallback)((e=>{_(e)}),[]),N=(0,r.useCallback)((async e=>{if(e){m("results"),p(!0),fp.Z.saveToHistory(cf,e);const t=[fp.Z.search(e,"TAGS",{tagType:"GEO",offset:0,count:3}),fp.Z.search(e,"CHANNELS",{offset:0,count:3}),fp.Z.search(e,"ALL_CHANNEL_POSTS",{offset:0,count:3})],[n,a,s]=await Promise.all(t);g(n?.length>0||s?.length>0||a?.length>0?{geo:n||[],posts:s||[],channels:a||[]}:null),p(!1)}else m("history")}),[]),O=(0,r.useCallback)((e=>{N(e),_(e)}),[]),M=(0,r.useCallback)((({id:e,value:t})=>{f(e),_(t)}),[]),k=(0,r.useCallback)((e=>{f(e)}),[]);return a?r.createElement("div",{className:"header-search",ref:P},r.createElement("div",{className:"header-search__inner",id:"header-search-"+e},S&&r.createElement(ia.Z,{type:"button",className:"header-search__back",onClick:()=>{o&&!i&&window?.history&&window.history.back(),"function"==typeof I&&I()}},r.createElement(yn.Z,{iconName:"back-3"})),r.createElement(pr,{updatedQuery:h,handleSearch:N,handleInputChange:C,placeholder:"Поиск в МТ",showQueryInUrl:!1,autoFocus:!o,searchTimeout:1e3,"aria-haspopup":i,"aria-activedescendant":E,"aria-autocomplete":"list",onKeyDown:({key:e})=>{"Delete"===e&&(N(""),_(""))},onFocus:()=>{i||l(!0)}}),!o&&!S&&r.createElement(ia.Z,{type:"button",className:"header-search__close",onClick:()=>{"function"==typeof I&&I()}},r.createElement(yn.Z,{iconName:"close"}))),i&&!1!==T&&r.createElement(oa.Z,{target:"header-search-"+e,placement:"bottom-left",className:"header-search-dropdown",offset:S?[0,-1]:[0,16],enableMobile:!1},"history"===c&&r.createElement(nf,{keyValue:cf,onItemClick:O,onItemActive:M,listLength:5}),"results"===c&&r.createElement(r.Fragment,null,d&&r.createElement(yr,null),!d&&!u&&r.createElement(KE,{searchQuery:h}),!d&&u&&r.createElement(of,{query:h,results:u,onItemActive:k})))):null},df=(0,r.memo)(mf),pf=({uniqKey:e})=>{const t=(0,aa.C)((e=>e.app?.page)),n="mtSearchResultsPage"===t,a=(0,aa.C)((e=>e.veryTopHeader?.searchActive)),s=(0,aa.T)();return(0,r.useEffect)((()=>{s(lf(e,n))}),[]),n?null:r.createElement(ia.Z,{type:"button",className:"header-search-switch",onClick:()=>{s(lf(e,!0))},disabled:a},r.createElement(yn.Z,{iconName:"search-2"}))},uf=(0,r.memo)(pf),gf=({uniqKey:e="very-top-header",isHeaderOverlap:t,backButton:n="auto",title:a,channelInfo:s,channelActions:o,tagStripe:i})=>{const l=(0,aa.C)((t=>t.veryTopHeader?.[e]));return r.createElement(r.Fragment,null,r.createElement("header",{className:_()("header",(t||l)&&"header_with-bg")},"auto"===n&&r.createElement(WE,null),n&&"auto"!==n&&n,r.createElement("div",{id:"header-column"},r.createElement("div",{className:_()("header-inner",n&&"header-inner_with-back-button")},r.createElement("div",{className:"header-info"},s,a&&r.createElement("h1",{className:"title"},a),r.createElement("div",{className:"header-controls"},b.ZP.isLogged()&&o,r.createElement(uf,{uniqKey:e})))))),r.createElement(df,{uniqKey:e}),i)},hf=({channelId:e,mode:t="full"})=>{const n=(0,aa.T)(),a=(0,aa.C)((e=>e.channelSubscribeAction)),s=a[e]?.channel,{is_subscribed:o,is_owner:i}=s||{};return r.createElement(qn,{onIntersection:([t])=>{t&&e&&!s&&!o&&n(es(e))},margin:"0px",extraClasses:"channel-subscription"},e&&s&&!i&&r.createElement(He.Z,{appearance:"full"===t?"btn":"link",label:o?"Вы подписаны":"Подписаться",icon:"full"===t&&o?"check":void 0,color:"mini"!==t&&o?"secondary":"primary",title:o?"Вы подписаны":"Подписаться",onClick:t=>{t.stopPropagation(),b.ZP.isLogged()?n(ts(e,!o)):n(_e("login"))}}))},_f=(0,r.memo)(hf),Ef=({channel:e})=>{const t=b.ZP.getCurrentUserId(),n=re.Z.getConfig(),a=`${n.mainProto}://${n.channelDomain}/${e.name}`;return r.createElement("div",{className:"channel-info fade-in"},r.createElement(Mn.Z,{logoInfo:{userName:e?.title,logoImg:e?.avatar||e?.avatar_info?.photo_original,size:"av80",logoUrl:a}}),r.createElement("div",{className:"channel-title-subscribers"},r.createElement("a",{className:"channel-title",href:a},e?.title),t!==e.person_id&&r.createElement(_f,{channelId:e?.id,mode:"mini"}),Number(e.subscribers_num)>0&&r.createElement("div",{className:"channel-subscribers"},y.Z.formatViewsCounter(e.subscribers_num)+" "+y.Z.num2string(e.subscribers_num,["подписчик","подписчика","подписчиков"]))))};var ff="/index.js";
/**
 * Mirtesen.
 *
 * Tags settings actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const bf=e=>({type:"CHANNEL_TAG_SETTINGS_TOGGLE_MODAL",value:e}),yf=()=>async e=>{try{const[t,n=[]]=await Promise.all([Pa.Z.getTagSubscriptions(),Pa.Z.getCustomTags()]);let a=[],s=[];if(t){const e=(e=>{const t=[],n=[];for(const a of e)Number(a.typeId)===Pa.Z.tagType.geotag?t.push(a):n.push(a);return{geoTags:t,tags:n}})(t);a=e.geoTags,s=e.tags}e({type:"CHANNEL_TAG_SETTINGS_GET_TAGS",geoTags:a,tags:s,customTags:n})}catch(e){D.Z.promiseHandler(ff)(e)}},vf=e=>({type:"CHANNEL_TAG_SETTINGS_TOGGLE_SEARCH_PROCESS",value:e}),Tf=e=>({type:"CHANNEL_TAG_SETTINGS_DELETE_TAG",id:e}),Sf=(e,t)=>async(n,a)=>{const s=a().channelVeryTopTags,{searchResults:r}=s;let o,i;t?(o=await Pa.Z.getGeotagById(e),i="customTags"):(o=r.find((t=>t.id===e)),o||(o=await Pa.Z.getTagsById(e)),i=o?.typeId===Pa.Z.tagType.geotag?"geoTags":"tags"),o&&n({type:"CHANNEL_TAG_SETTINGS_ADD_TAG",addedTag:o,updatedTags:i})},Pf=(e,t)=>async(n,a)=>{const s=a().channelVeryTopTags;let{headerTags:r}=s,o=!1;if(r=r.map((t=>(e===t.id&&(o=!0),t))),o)return;const i=t?await Pa.Z.getGeotagById(e):await Pa.Z.getTagsById(e);i&&r.unshift(i),n({type:"CHANNEL_HEADER_TAGS_ADD_HEADER_TAG",headerTags:r})},wf=e=>async(t,n)=>{const a=n().channelVeryTopTags;let{headerTags:s}=a;s=s.filter((t=>e!==t.id)),t({type:"CHANNEL_HEADER_TAGS_REMOVE_HEADER_TAG",headerTags:s})},If=({isSubscribed:e,onClick:t})=>{const[n,a]=(0,r.useState)("check"),s=Md();return(0,r.useEffect)((()=>{a(e?"check":"cross")}),[e]),r.createElement(r.Fragment,null,null===e&&r.createElement("i",{style:{display:"inline-block",width:"1px",height:"1px"}}),null!==e&&r.createElement(He.Z,{isCompact:e||Number(s)<=At.ZP.BREAKPOINTS.XS,label:e?"Отписаться":"Подписаться",rounded:e,color:e?"empty":"secondary",icon:Number(s)<=At.ZP.BREAKPOINTS.XS||e?n:"",onMouseEnter:()=>{e&&a("close")},onMouseLeave:()=>{e&&a("check")},onClick:t}))},Cf=(0,r.memo)(If),Nf=({isSubscribed:e,onClick:t})=>{const n=(0,aa.T)(),[a,s]=(0,r.useState)(!1);return null===e?null:r.createElement(He.Z,{label:e?"Подписаны":"Подписаться",color:e?"secondary":"primary",extraClasses:"hashtag-header__btn",icon:e?"check":"cross",onClick:async()=>{a||(s(!0),pd.isLogged()?t():n(_e("login")),s(!1))},type:"button"})},Of=(0,r.memo)(Nf),Mf=({id:e,ver:t="list"})=>{const[n,a]=(0,r.useState)(null),s=(0,r.useCallback)((async()=>{if(pd.isLogged()){const t=await Pa.Z.getTagSubscriptionStatus(e);a(Boolean(t))}else a(!1)}),[e]),o=(0,r.useCallback)((async()=>{const t=!n;let s;s=t?await qa.Z.setInterest("TAG",e,t):await qa.Z.deleteManualInterest("tag",e),s&&(a(t),kt.Z.sendMessage({type:"MT_APP_UPDATE_SUBSCRIBERS",subscriptionType:"tag",id:e,value:t}),kt.Z.sendMessage({type:"MT_APP_RELOAD_POST_FEED"}))}),[e,n]);return r.createElement(qn,{onIntersection:([e])=>{e&&s()},margin:"200px",extraClasses:"action-subscribe-btn"},"list"===t&&r.createElement(Cf,{isSubscribed:n,onClick:o}),"header"===t&&r.createElement(Of,{isSubscribed:n,onClick:o}))},kf=(0,r.memo)(Mf),Af=({subscribersNum:e,id:t,counterType:n})=>{const[a,s]=(0,r.useState)(0);(0,r.useEffect)((()=>{s(e)}),[]);return(0,kr.O)("message",(e=>{if("MT_APP_UPDATE_SUBSCRIBERS"===e.data.type&&e.data.subscriptionType===n&&e.data.id===t){const t=e.data.value?1:-1;s((e=>e+t))}})),a<1?null:r.createElement("div",{className:"subscribers-counter"},r.createElement("span",null,y.Z.formatViewsCounter(a)),r.createElement("span",null,y.Z.num2string(a,["подписчик","подписчика","подписчиков"])))},xf=(0,r.memo)(Af),Lf=({id:e})=>{const[t,n]=(0,r.useState)(!1),a=(0,r.useCallback)((async()=>{if(t)return;n(!0);await Pa.Z.deleteCustomTag(e)?kt.Z.sendMessage({type:"MT_APP_DELETE_CUSTOM_TAG",id:e}):kt.Z.sendSystemMessage("exception"),n(!1)}),[e]);return r.createElement(He.Z,{label:"",color:"secondary",extraClasses:"hashtag-header__btn",icon:"close",isCompact:!0,rounded:!0,onClick:a,type:"button"})},Df=(0,r.memo)(Lf),Rf=({tag:e})=>{const t=Pa.Z.isGeoTag(e.text),n=Pa.Z.isCustomTag(e.text),a=n?`/geoposition/${e.id}`:`/hashtags/${encodeURIComponent(e.text)}`;return r.createElement("div",{className:"tag-list-item",id:`${t?"geotag":"hashtag"}_${e.id}`},r.createElement("a",{className:"info",href:a,target:n?void 0:"_blank"},r.createElement("h5",{className:"name"},r.createElement(yn.Z,{iconName:t?"geo":"hashtag"}),r.createElement("span",null,Pa.Z.stripGeoId(e.text))),t&&!n&&r.createElement(sf,{tagId:e.id,display:"text"}),!t&&r.createElement(xf,{id:e.id,counterType:"tag",subscribersNum:e.subscribersNum||0})),!n&&r.createElement(kf,{id:e.id}),n&&r.createElement(Df,{id:e.id}))},Zf=(0,r.memo)(Rf),Bf=({tagList:e,title:t})=>r.createElement("div",{className:"tag-list"},t&&r.createElement("h3",{className:"title"},t),r.createElement("div",{className:"items"},e.map((e=>r.createElement(Zf,{tag:e,key:e.id}))))),$f=(0,r.memo)(Bf),Uf=()=>{const e=(0,aa.C)((e=>e.channelVeryTopTags)),{isOpen:t,searchResults:n,geoTags:a=[],tags:s=[],customTags:o=[],searchInProccess:i}=e,[l,c]=(0,r.useState)(""),m=(0,aa.T)();return(0,kr.O)("message",(e=>{"MT_APP_UPDATE_SUBSCRIBERS"===e.data.type&&"tag"===e.data.subscriptionType?e.data.value?m(Sf(e.data.id)):m(Tf(e.data.id)):"MT_APP_DELETE_CUSTOM_TAG"===e.data.type?m(Tf(e.data.id)):"MT_APP_ADD_CUSTOM_TAG"===e.data.type&&m(Sf(e.data.id,!0))})),(0,r.useEffect)((()=>{b.ZP.isLogged()&&m(yf())}),[]),t?r.createElement(O.Z,{className:"tags-settings-popup",onClose:()=>m(bf(!1))},r.createElement(O.Z.Header,null,r.createElement(O.Z.Title,null,"Мои интересы")),r.createElement(O.Z.Body,null,r.createElement("div",{className:"tags-settings"},r.createElement("div",{className:"search"},r.createElement(pr,{updatedQuery:l,handleSearch:e=>{var t;c(e),m((t=e,async(e,n)=>{const a=n().channelVeryTopTags,s=[...a.geoTags,...a.tags];let r=[];try{e(vf(!0)),t&&(r=await fp.Z.search(t,"TAGS"),r=r.sort(((e,t)=>{const n=s.findIndex((t=>t.id===e.id))>-1,a=s.findIndex((e=>e.id===t.id))>-1;return n&&!a?-1:!n&&a?1:e.typeId===Pa.Z.tagType.geotag&&t.typeId!==Pa.Z.tagType.geotag?-1:t.typeId===Pa.Z.tagType.geotag&&e.typeId!==Pa.Z.tagType.geotag?1:0}))),e({type:"CHANNEL_TAG_SETTINGS_SET_SEARCH_RESULTS",searchResults:r}),e(vf(!1))}catch(t){D.Z.promiseHandler(ff)(t),e(vf(!1))}}))},placeholder:"Поиск мест и тегов",showQueryInUrl:!1,searchTimeout:1e3})),l?r.createElement("div",{className:"search-results"},n.length>0&&!i&&r.createElement($f,{tagList:n}),n.length<=0&&!i&&r.createElement(KE,{searchQuery:l})):r.createElement("div",null,a.length>0&&r.createElement($f,{tagList:a,title:"Места"}),s.length>0&&r.createElement($f,{tagList:s,title:"Теги"}),o.length>0&&r.createElement($f,{tagList:o,title:"Мои ярлыки"}))))):null},Hf=(0,r.memo)(Uf);function Ff(){return Ff=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Ff.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Tag label.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const jf=({text:e,icon:t,color:n="black",extraClasses:a="",canDelete:s,onAdd:o,canAdd:i,href:l,onClick:c=(()=>{}),htmlTag:m,onDelete:d=(()=>{}),...p})=>{const u=m||"a";return"a"!==m||l||(l=`/hashtags/${encodeURIComponent(e)}`),r.createElement("div",Ff({},p,{className:_()("tag-label",n,a)}),r.createElement(u,{href:l,className:"item",onClick:c},t&&r.createElement(yn.Z,{iconName:t}),r.createElement("span",null,Pa.Z.stripGeoId(e)),s&&r.createElement("i",{className:"action-delete",onClick:e=>{e.stopPropagation(),d(e)}},r.createElement(yn.Z,{iconName:"close"}))),i&&r.createElement("div",{className:"action-add"},r.createElement("button",{onClick:()=>{"function"==typeof o&&o()}},r.createElement(yn.Z,{iconName:"cross"}))))},Gf=(0,r.memo)(jf),qf=({initialPosition:e})=>{const[t,n]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{window.addEventListener("message",(e=>{"MT_APP_SHOW_GEO_USER_POPUP"===e.data.type&&n(e.data.show)}))})),r.createElement(r.Fragment,null,t&&r.createElement(O.Z,{enableClose:!1,onClose:()=>{n(!1)}},r.createElement(To,{extraClasses:"geo-map-container geo-popup",geoType:"user"})))},Vf=(0,r.memo)(qf),zf=()=>{kt.Z.sendMessage({type:"MT_APP_SHOW_GEO_USER_POPUP",show:!0})},Wf=()=>{const e=(0,aa.C)((e=>e.geoPosition)),t=(0,r.useRef)(null),[n,a]=(0,r.useState)(!1),{currentSource:s,inProcess:o}=e,i=Md(),l=e.title;return(0,r.useEffect)((()=>{b.ZP.isLogged()&&!o&&ca.canView("MT_GEO_LOCATION_PLACE")&&Number(i)>=At.ZP.BREAKPOINTS.XS&&a(!0)}),[o]),r.createElement(r.Fragment,null,l&&!o&&r.createElement("div",{className:"swiper-slide",ref:t},r.createElement(Gf,{htmlTag:"div",text:Pa.Z.stripGeoId(l),icon:"location",extraClasses:"geo-position",color:"customTag"===s?"green":"violet",onClick:zf}),n&&r.createElement(oa.Z,{target:t.current,offset:[0,18],enableMobile:!1,className:"geolocation-tooltip",delay:500},r.createElement("h4",{className:"title"},"Разрешите определение местоположения"),r.createElement("p",{className:"text"},"Это позволит отображать публикации на основе вашего местоположения, что сделает ленту более интересной и релевантной "),r.createElement("div",{className:"geolocation-controls"},r.createElement(ia.Z,{type:"button",onClick:()=>{ca.setView("MT_GEO_LOCATION_PLACE"),a(!1)},className:"control"},"Позже"),r.createElement(ia.Z,{type:"button",onClick:()=>{ca.setView("MT_GEO_LOCATION_PLACE"),a(!1),zf()},className:"control"},"Указать вручную"),r.createElement(ia.Z,{type:"button",onClick:()=>{ca.setView("MT_GEO_LOCATION_PLACE"),Ma(),a(!1)},className:"control accented"},"Разрешить")))),r.createElement(Vf,null))},Yf=(0,r.memo)(Wf),Kf=N((()=>Promise.all([n.e(526).then(n.t.bind(n,88667,23)),n.e(743).then(n.bind(n,83651))]).then((([e])=>e))),"reactIdSwiper"),Jf={shouldSwiperUpdate:!0,slidesPerView:"auto",spaceBetween:0,freeMode:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},renderPrevButton:()=>r.createElement("span",{className:"swiper-button swiper-button-prev"},r.createElement("button",{className:"btn arrow-btn arrow-btn_prev",type:"button"})),renderNextButton:()=>r.createElement("span",{className:"swiper-button swiper-button-next"},r.createElement("button",{className:"btn arrow-btn arrow-btn_next",type:"button"}))},Xf=({withBackground:e})=>{const t=(0,aa.T)(),n=(0,aa.C)((e=>e.channelVeryTopTags)),a=(0,aa.C)((e=>e.geoPosition)),[s,o]=(0,r.useState)(!1);let{headerTags:i}=n;(0,kr.O)("message",(e=>{"MT_APP_UPDATE_SUBSCRIBERS"===e.data.type&&"tag"===e.data.subscriptionType?e.data.value?t(Pf(e.data.id)):t(wf(e.data.id)):"MT_APP_DELETE_CUSTOM_TAG"===e.data.type?t(wf(e.data.id)):"MT_APP_ADD_CUSTOM_TAG"===e.data.type&&t(Pf(e.data.id,!0))})),(0,r.useEffect)((()=>{(async()=>{b.ZP.isLogged()?(t((async e=>{const t=[];t.push(Pa.Z.getTagSubscriptions(),Pa.Z.getCustomTags());const[n=[],a=[]]=await Promise.all(t);n.sort(((e,t)=>1!==e.typeId&&1===t.typeId?1:1===e.typeId&&1!==t.typeId?-1:0)),e({type:"CHANNEL_HEADER_TAGS_INIT",headerTags:[...a,...n]})})),o(!0)):o(!0)})()}),[]),(0,r.useEffect)((()=>{if(!a.isInit||!n.isInit)return;let e=!1;["osmTag","customTag","navigatorGeolocation"].includes(a.currentSource)&&(e=!0),i.map((t=>{Pa.Z.isGeoTag(t.text)&&(e=!0)})),na.ym("reachGoal","articlesList",{withGeo:e})}),[a.isInit,n.isInit]);const l=[];let c=!1;if(a&&(i=i.filter((e=>a.title!==e.text||(c=!0,!1)))),s){let e=0;l.push(r.createElement(Yf,{geoPosition:a,isSubscribed:c,key:e})),e++,i.forEach((t=>{const n=Pa.Z.isCustomTag(t.text)?`/geoposition/${t.id}`:`/hashtags/${encodeURIComponent(t.text)}`;l.push(r.createElement(Gf,{key:e,text:t.text,icon:Pa.Z.isGeoTag(t.text)?"geo":void 0,extraClasses:"swiper-slide",href:n})),e++}))}return b.ZP.isLogged()?r.createElement(r.Fragment,null,r.createElement("div",{className:_()("header-tags",e&&"header-tags_with-bg")},s&&r.createElement(r.Fragment,null,r.createElement("div",{className:"swiper fade-in header-tags__swiper"},r.createElement(Kf,Jf,l)),r.createElement("button",{className:"header-tags__actions",onClick:async()=>{b.ZP.isLogged()?t(bf(!0)):t(_e("login"))}},r.createElement(yn.Z,{iconName:"list"})))),r.createElement(Hf,null)):null},Qf={mtIndex:"Лента",channelMain:"Канал",hashtagPostList:"Лента",myChannels:"Каналы",searchResults:"Поиск",channelTopSandbox:"Запросы на статус ТОП новостей"},eb=({type:e,isHeaderOverlap:t,uniqKey:n="very-top-header"})=>{const a=(0,aa.T)(),s=(0,aa.C)((e=>e.app?.page)),o=(0,aa.C)((e=>e.app?.channel)),i=(0,aa.C)((e=>e.channelPost?.channel)),l=(0,aa.C)((e=>e.channelPost?.post)),c=(0,aa.C)((e=>e.auth?.user)),m=re.Z.getConfig();let d=null;d=e||("channelPost"===s?"channel-post-header":o?.id?"channel-header":"mt-header");let p={uniqKey:n,isHeaderOverlap:t||!1};switch(d){case"post-popup-header":{const e=i;if(!l||!e)return null;p={...p,isHeaderOverlap:!0,backButton:r.createElement(ia.Z,{type:"button",className:"header-back",onClick:()=>{a(lf("very-top-header",!1)),a(lf("post-popup-very-top-header",!1)),a(Id(null))}},r.createElement(yn.Z,{iconName:"back-3"})),channelInfo:r.createElement(Ef,{channel:e}),channelActions:r.createElement(ir,{post:l,channelId:e.id,type:l.from?.id===c?.id?"channel-post-owner":"channel-post-guest",url:l.seo_url||l.url,id:`channel-post-actions-${l.id}`,editorType:"channel"})};break}case"channel-post-header":{const e=i;if(!l||!e)return null;p={...p,isHeaderOverlap:!0,channelInfo:r.createElement(Ef,{channel:e}),channelActions:r.createElement(ir,{post:l,channelId:e.id,editorType:"channel",type:l.from?.id===c?.id?"channel-post-owner":"channel-post-guest",url:l.seo_url||l.url,id:`channel-post-actions-${l.id}`})};break}case"channel-header":{const e=o;if(!e)return null;p={...p,title:t?void 0:"Канал",channelInfo:t?r.createElement(Ef,{channel:e}):null,channelActions:r.createElement(ir,{channelId:e.id,type:e.is_owner?"channel-owner":"channel-guest",url:`${m.mainProto}://${m.channelDomain}/${e.name}`,id:`channel-actions-${e.id}`})};break}case"mt-header":p={...p,title:Qf[s],tagStripe:"mtIndex"===s?r.createElement(Xf,{withBackground:t}):null}}return r.createElement("div",{className:"very-top-header"},r.createElement(gf,p))},tb=(0,r.memo)((({app:e,page:t})=>{const[n,a]=(0,r.useState)(!1),s=(0,r.useRef)(null),o=(0,r.useRef)(null),i=()=>{if(s.current&&o.current){const e=s.current.getBoundingClientRect(),t=o.current.getBoundingClientRect();e.bottom>=t.top?a(!0):a(!1)}};(0,r.useEffect)((()=>{i()}),[]),(0,kr.O)("scroll",u()(i,80));const l=t;return r.createElement(r.Fragment,null,r.createElement(Jp,{app:e}),r.createElement("div",{id:"layout"},r.createElement("div",{id:"two-column-container"},r.createElement("div",{id:"left-column"},r.createElement(qE,{menuConfig:VE.left,page:e.page})),r.createElement("div",{id:"content-container"},r.createElement("div",{id:"header",ref:s},r.createElement(eb,{isHeaderOverlap:n})),r.createElement("div",{id:"content-column",ref:o},r.createElement(l,{app:e})),r.createElement(LE,{menuConfig:VE.bottom,page:e.page})))))})),nb=(0,ae.Z)(tb,"channelLayout"),ab=e=>(t,n)=>{const a=n(),{geo:s}=a.richPostEditor;t({type:"CHANNEL_RICH_POST_EDITOR_SET_CHANNEL",channel:e}),"auto"===s.status&&t(rb({status:"auto",tagId:e.geotag_id}))},sb=()=>(e,t)=>{const n=t(),{title:a,text:s}=n.richPostEditor;return e({type:"CHANNEL_RICH_POST_EDITOR_ENABLE_SUBMIT",canSubmit:a.length>0&&!zp.Z.isHtmlEmpty(s)})},rb=e=>({type:"CHANNEL_RICH_POST_EDITOR_SET_GEO",geo:e}),ob=()=>{const[e,t]=(0,r.useState)([]),{canSelectChannel:n,channel:a}=(0,aa.C)((e=>e.richPostEditor)),s=(0,aa.T)();(0,r.useEffect)((()=>{(async()=>{const e=b.ZP.getCurrentUserId();if(!e)return!1;const n=await At.ZP.getUserChannels(e)||[];t(n),a||s(ab(n[0]))})()}),[]);let o=null;return e.map(((e,t)=>{Number(e.id)!==Number(a.id)||(o=e)})),o?r.createElement(r.Fragment,null,!n&&r.createElement("div",{className:"channel-dropdown-menu__button"},r.createElement("div",{className:"ava-nickname"},r.createElement(Mn.Z,{logoInfo:{userName:o.title,logoImg:o.avatar,title:o.title,logoClassName:"userlogo_xm"}}),r.createElement("span",{className:"nickname"},o.title))),n&&r.createElement(G.Z,{placement:"bottom-left",customDropdownClasses:"channel-dropdown-menu channel-editor__channels",customListClasses:"channel-dropdown-menu__list",customButtonClasses:"channel-dropdown-menu__button",buttonValue:r.createElement(r.Fragment,null,r.createElement("div",{className:"ava-nickname"},r.createElement(Mn.Z,{logoInfo:{userName:o.title,logoImg:o.avatar,title:o.title,logoClassName:"userlogo_xm"}}),r.createElement("span",{className:"nickname"},o.title),r.createElement(yn.Z,{iconName:"angle-down-2"}))),offset:[0,7]},e.map(((e,t)=>r.createElement("div",{className:"ava-nickname",key:t,onClick:()=>{s(ab(e))}},r.createElement(Mn.Z,{logoInfo:{userName:e.title,logoImg:e.avatar,title:e.title,logoClassName:"userlogo_xm"}}),r.createElement("span",{className:"nickname"},e.title)))))):null},ib=(0,r.memo)((({app:e,page:t})=>{const n=t,a=Md(),{canSubmit:s}=(0,aa.C)((e=>e.richPostEditor)),o=(0,aa.T)();return!1===a?null:!1!==a&&a<960?r.createElement("div",{style:{textAlign:"center",fontWeight:700,marginTop:"20vh",fontSize:"1.5rem"}},"Эта страница доступна только на устройствах с шириной экрана более 960px"):r.createElement(r.Fragment,null,r.createElement(Jp,{app:e}),r.createElement("div",{id:"layout",className:"rich-post-editor-layout"},r.createElement("div",{id:"two-column-container"},r.createElement("div",{id:"content-container"},r.createElement("div",{id:"header"},r.createElement("div",{className:"header-side header-side_left"},r.createElement("a",{href:"/",className:"back"},r.createElement(yn.Z,{iconName:"close"}))),r.createElement("div",{id:"header-column"},r.createElement(ob,null)),r.createElement("div",{className:"header-side header-side_right"},r.createElement(He.Z,{className:_()("btn","btn-primary"),onClick:()=>{o((async(e,t)=>{const n=t(),{title:a,text:s,channel:r,id:o,geo:i}=n.richPostEditor,l={postId:o,title:a,text:zp.Z.editor2html(s),target:{type:"channel",id:r.id},author:{id:b.ZP.getCurrentUserId()},geotagId:i.tagId,vislvl:9},c=await vt.default.savePost(l);c||kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Ошибка при сохранении статьи"}),window.location.href=Rp().mainProto+"://"+Rp().channelDomain+"/"+r.name+"/"+c}))},label:"Опубликовать",disabled:!s,color:"primary"}))),r.createElement("div",{id:"content-column"},r.createElement(n,{app:e}))))))})),lb=(0,ae.Z)(ib,"channelLayout");
/**
 * Mirtesen.
 *
 * Mobile app promotion full screen.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class cb extends r.PureComponent{constructor(e){super(e),this.state={show:!1}}componentDidMount(){const e=window.innerWidth-(document.documentElement.clientWidth||document.body.clientWidth);document.documentElement.style.paddingRight=e+"px",setTimeout((()=>{const e=ca.canView("APP_FULLSCREEN_PROMO");e&&(this.setState({show:e}),ca.setView("APP_FULLSCREEN_PROMO"),na.ym("reachGoal","show_full_screen_mt"))}),2e3)}async app(){document.documentElement.style.overflowY="auto",document.documentElement.style.paddingRight="auto",document.documentElement.style.overscrollBehaviorY="none",await ca.setView("APP_FULLSCREEN_PROMO"),window.location.href="https://k41tv.app.link/mt-messenger-5"}async close(){document.documentElement.style.paddingRight="auto",await ca.setView("APP_FULLSCREEN_PROMO"),this.setState({show:!1})}render(){const{show:e}=this.state;return e?r.createElement(r.Fragment,null,r.createElement("div",{className:"app-promotion-fullscreen"},r.createElement("div",{className:"app-promotion-fullscreen__banner"},r.createElement("i",{className:"app-promotion-fullscreen__close",onClick:()=>{this.close()}}),r.createElement("h3",{className:"app-promotion-fullscreen__title"},"МирТесен — читайте,",r.createElement("br",null)," дружите, общайтесь!"),r.createElement("div",{className:"app-promotion-fullscreen__description"},"Ваша социальная сеть — знакомства, друзья, общение и новостная лента")),r.createElement("div",{className:"app-promotion-fullscreen__actions"},r.createElement(He.Z,{href:"https://k41tv.app.link/mt-messenger-5",extraClasses:"app-promotion-fullscreen__actions-download",icon:"logo-sm",onClick:e=>{e.preventDefault(),na.ym("reachGoal","click_full_screen_mt"),this.app()},label:"Перейти в приложение"}),r.createElement(He.Z,{color:"secondary",type:"button",extraClasses:"app-promotion-fullscreen__actions-close",onClick:()=>{this.close()},label:"Продолжить на сайте"}))),r.createElement("div",{style:{opacity:0,position:"absolute",width:"1px",height:"1px"}},r.createElement(R_,{adId:10030}))):null}}const mb=cb;var db=n(59481);
/**
 * Mirtesen.
 *
 * Core popup message.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class pb extends r.PureComponent{static defaultProps={className:"",autoClose:3};constructor(e){super(e),this.state={show:!1}}componentDidMount(){const{autoClose:e}=this.props;this.setState({show:!0}),e&&setTimeout((()=>{this.setState({show:!1})}),1e3*e)}render(){const{children:e,className:t=""}=this.props,{show:n}=this.state,a=_()({"system-popup":!0},t.split(","));return r.createElement(db.Z,{show:n,className:a,enableModal:!1,enableClose:!1,enableMobile:!1},e)}}pb.propTypes={autoClose:f().oneOfType([f().bool,f().number]),classes:f().string,className:f().string,children:f().any};const ub=pb;
/**
 * Mirtesen.
 *
 * Core popup message.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class gb extends r.PureComponent{constructor(e){super(e),this.state={currentMessage:null},this.messagePool=[],this.messageTimer=null,this.poolTimer=null,this.autoClose=7,this.hideCurrentMessage=this.hideCurrentMessage.bind(this),this.handleGetMessage=this.handleGetMessage.bind(this),this.handlePool=this.handlePool.bind(this)}componentDidMount(){window.addEventListener("message",this.handleGetMessage,!1),this.poolTimer=setInterval(this.handlePool,300)}componentWillUnmount(){window.removeEventListener("message",this.handleGetMessage),clearTimeout(this.messageTimer),clearInterval(this.poolTimer)}handlePool(){let{currentMessage:e}=this.state;0===this.messagePool.length||e||(e=this.messagePool.shift(),e.autoClose=e.autoClose||this.autoClose,this.setState({currentMessage:e},(()=>{this.messageTimer=setTimeout(this.hideCurrentMessage,1e3*(e.autoClose+1.2))})))}handleGetMessage(e){const{type:t,text:n,className:a,autoClose:s}=e.data;"MT_APP_SHOW_SYSTEM_POPUP"===t&&this.messagePool.push({text:n,autoClose:s,className:a})}hideCurrentMessage(){this.setState({currentMessage:null})}render(){const{currentMessage:e}=this.state;if(!e)return null;const{className:t="",text:n="",autoClose:a=10}=e;return r.createElement(ub,{className:t,autoClose:a},r.createElement("div",{dangerouslySetInnerHTML:{__html:n}}))}}const hb=gb;function _b(){return _b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},_b.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Core popup message.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class Eb extends r.PureComponent{static defaultProps={className:"",autoClose:3};constructor(e){super(e),this.state={show:!1}}componentDidMount(){const{autoClose:e}=this.props;this.setState({show:!0}),e&&setTimeout((()=>{this.setState({show:!1})}),1e3*e)}render(){const{children:e,className:t=""}=this.props,{show:n}=this.state,a=_()({"notification-popup":!0},t.split(","));return r.createElement(db.Z,_b({},this.props,{show:n,className:a,enableModal:!1,enableClose:!0,outTimeout:2e3}),e)}}Eb.propTypes={autoClose:f().oneOfType([f().bool,f().number]),className:f().string,children:f().any};const fb=Eb;
/**
 * Mirtesen.
 *
 * Core popup message.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class bb extends r.PureComponent{constructor(e){super(e),this.state={currentMessage:null,isMessengerPage:null},this.messagePool=[],this.messageTimer=null,this.poolTimer=null,this.autoClose=60,this.hideCurrentMessage=this.hideCurrentMessage.bind(this),this.handleGetMessage=this.handleGetMessage.bind(this),this.handlePool=this.handlePool.bind(this)}componentDidMount(){const{userId:e}=this.props;if(e&&(jd.subscribe("navigation_update_"+e,this.handleGetMessage),window.addEventListener("message",this.handleGetMessage,!1)),this.poolTimer=setInterval(this.handlePool,2e3),"undefined"!=typeof window){const{pathname:e,host:t}=new URL(document.URL);this.setState({isMessengerPage:"/messenger"===e&&/chat\.mirtesen\.(mt)|(ru)/.test(t)})}}componentDidUpdate(e){const t=this.props.userId,n=e.userId;"undefined"!=typeof window&&n!==t&&(n&&jd.unsubscribe("navigation_update_"+n,this.handleGetMessage),t&&jd.subscribe("navigation_update_"+t,this.handleGetMessage))}componentWillUnmount(){const{userId:e}=this.props;e&&(jd.unsubscribe("navigation_update_"+e,this.handleGetMessage),window.removeEventListener("message",this.handleGetMessage)),clearTimeout(this.messageTimer),clearInterval(this.poolTimer)}handlePool(){const{currentMessage:e}=this.state;0===this.messagePool.length||e||this.setState({currentMessage:this.messagePool.shift()},(()=>{this.messageTimer=setTimeout(this.hideCurrentMessage,1e3*this.autoClose)}))}handleGetMessage(e){let t=null,n=null;if("MT_APP_SHOW_NOTIFICATION_POPUP"===e?.data?.type?(n=e.data.data,n.event=e.data.event):"object"==typeof e&&"number"==typeof e.count&&["new_reply","new_comment_in_commented_post","new_comment","new_fame_action","new_like","new_friend","accept_friend","new_userpost","new_repost","new_poll_vote","new_message","new_channel_post"].includes(e.event)&&(n=e.data,n.event=e.event),pd.isDeveloper()&&"object"==typeof e&&"number"==typeof e.count&&(console.log("--socket.io message--"),console.log(e)),!n)return;const{event:a,person_img:s,person_name:r,obj_link:o,obj_title:i,fame_action:l,action:c,msg:m,feedback_text:d,suffix:p}=n;t={event:a,personImg:s,personName:r,objLink:o,objTitle:i,objExtraMessage:d,objSuffixMessage:p,fameAction:l,action:c,msg:m},this.messagePool.push(t)}hideCurrentMessage(){setTimeout((()=>{clearTimeout(this.messageTimer),this.setState({currentMessage:null})}),7e3)}hasYmGoal=e=>["new_userpost","new_message","new_poll_vote","new_like","new_comment"].indexOf(e)>-1;render(){const{currentMessage:e}=this.state;if(!e)return null;const{personName:t,personImg:n,fameAction:a,msg:s,event:o,objExtraMessage:i,objSuffixMessage:l}=e;let{objLink:c="",action:m=null,objTitle:d}=e;c=c.replace(/utm_medium=[a-z0-9_]+/i,"").replace("?&","?").replace(/(&|\?)+$/,""),-1!==c.indexOf("?")?c+="&utm_medium=push_system":c+="?utm_medium=push_system",!m&&["new_reply","new_userpost","new_repost","new_poll_vote","new_channel_post"].includes(o)&&(m=o),d&&(d=d.replace(/(&#171;|&#187;)/g,'"'),d="&#171;"+y.Z.truncateString(d,32)+"&#187;");const p=_()({"notification-popup_fame":!0,notification:!0,[`notification-popup_${m}`]:m&&"new_like"===o});let u="";const g=!this.state.isMessengerPage||"new_message"!==o;switch(o){case"new_reply":case"new_comment_in_commented_post":case"new_comment":case"new_friend":case"accept_friend":case"new_like":case"new_userpost":case"new_repost":case"new_poll_vote":case"new_message":case"new_channel_post":u=r.createElement(fb,{className:p,autoClose:this.autoClose,onClose:()=>{this.hideCurrentMessage()},onClick:e=>{e.target.className.includes("popup-close")||(this.hasYmGoal(o)&&na.ym("reachGoal","click_push_"+o),g?window.open(c,"_blank"):window.location.href=c,this.hideCurrentMessage())},buttons:[{type:"submit",title:"Посмотреть"}]},r.createElement(Mn.Z,{logoInfo:{userName:t,logoImg:n,logoClassName:"avatar",title:t}}),m&&r.createElement("i",{className:`emoji emoji_${m}`,title:m}),r.createElement("div",{className:"title"},r.createElement("i",null,t)," ",s,d&&r.createElement(r.Fragment,null," ",r.createElement("i",{dangerouslySetInnerHTML:{__html:d}})),(i||l)&&r.createElement(r.Fragment,null,": ",r.createElement("span",{dangerouslySetInnerHTML:{__html:i||l}}))));break;case"new_fame_action":const e=`//mirtesen.ru/static/images/v4/inventory/reactions/${a}.svg`;u=r.createElement(fb,{className:p,autoClose:this.autoClose,onClose:()=>{this.hideCurrentMessage()},onClick:e=>{e.target.className.includes("popup-close")||(g?window.open(c,"_blank"):window.location.href=c,this.hideCurrentMessage())},buttons:[{type:"submit",title:"Посмотреть"}]},r.createElement("img",{className:"logo",src:e,alt:a}),r.createElement("div",{className:"title"},r.createElement("i",null,t)," ",s,d&&r.createElement(r.Fragment,null," ",r.createElement("i",{dangerouslySetInnerHTML:{__html:d}})),(i||l)&&r.createElement(r.Fragment,null,": ",r.createElement("span",{dangerouslySetInnerHTML:{__html:i||l}}))));break;default:u=null}return u}}bb.propTypes={userId:f().number};const yb=bb;var vb=n(39503);
/**
 * Mirtesen.
 *
 * Email Notifications Actions.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Tb=({children:e,extraClasses:t=[]})=>r.createElement("div",{className:_()("progress",...t)},e),Sb=({bar:e,value:t=0,color:n,label:a,extraClasses:s=[]})=>{const o=r.createElement("div",{className:_()("progress__bar",{[`progress__bar_${n}`]:n},...s),style:{width:`${t}%`}},a||`${t}%`);return e?o:r.createElement("div",{className:"progress"},o)},Pb=(0,r.memo)(Sb);
/**
 * Mirtesen.
 *
 * Email Notifications Container.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class wb extends r.Component{componentDidMount(){const{getNotifications:e}=this.props;e()}render(){const{saveCTR:e,changeCTR:t,toggleOptions:n,blogPostNotifications:a,toggleList:s,toggleItem:o,getNotifications:i,siteSettings:l}=this.props,{expandOptions:m,expandList:d,list:p,updatedAt:u,page:g,hasMore:h,isEmpty:_}=a,E=[],f=c()(u,"H:mm:ss").local().format("H:mm:ss");return p.map(((e,t)=>{const n=r.createElement(s_,{date:e.post.date.toString(),format:"DD.MM.YYYY HH:mm"}),a=r.createElement(s_,{date:e.createdAt,format:"DD.MM.YYYY HH:mm"}),s=e.processed-e.blocked,i=r.createElement("div",{className:"form-section form-section_bottom",key:t},r.createElement("div",{className:"form-group"},"#",e.id," ",r.createElement("a",{href:e.post.url},a)," ",r.createElement("strong",null,e.post.title)," ","|"," ","CTR ",e.ctr," %"," ","|"," ","Автор: ",r.createElement("a",{href:e.post.from.url},e.post.from.display_name)," ","|"," ","Комментарии: ",e.post.comments_count," ","|"," ","Рейтинг: ",e.post.likes.count," ","|"," ",!1===_&&r.createElement(He.Z,{type:"button",color:"secondary",extraClasses:"site-settings-notifications_expand-extra",onClick:()=>{o(t)},label:e.expanded?"Свернуть":"Развернуть"})),r.createElement("div",{className:"form-group"},r.createElement(Tb,null,r.createElement(Pb,{bar:!0,color:"yellow",value:90,label:s}),r.createElement(Pb,{bar:!0,color:"blue",value:90*e.opened/s,label:e.opened}),r.createElement(Pb,{bar:!0,color:"green",value:90*e.visited/s,label:e.visited}))),e.expanded&&r.createElement("div",{className:"form-group site-settings-notifications_extra-info"},r.createElement("ul",null,r.createElement("li",null,r.createElement("label",null,"Автор:"),r.createElement("a",{href:e.post.from.url},e.post.from.display_name)),r.createElement("li",null,r.createElement("label",null,"Опубликовано:"),n),r.createElement("li",null,r.createElement("label",null,"Отправитель:"),r.createElement("a",{href:e.from.url},e.from.display_name)),r.createElement("li",null,r.createElement("label",null,"Заявка:"),a),r.createElement("li",null,r.createElement("label",null,"Начало отправки:"),r.createElement(s_,{date:e.startedAt,format:"DD.MM.YYYY HH:mm"}))),r.createElement("ul",null,r.createElement("li",null,r.createElement("label",null,"Обработано:"),e.processed," из ",e.records," ","(",Math.round(e.processed/e.records*100),"%)"),r.createElement("li",null,r.createElement("label",null,"Заблокировано:"),e.blocked," ","(",Math.round(e.blocked/e.processed*100,10),"%)"),r.createElement("li",null,r.createElement("label",null,"Прочитали письмо:"),e.opened," ","(",Math.round(e.opened/s*100,10),"%)"),r.createElement("li",null,r.createElement("label",null,"Перешли на сайт:"),e.visited," ","(",Math.round(e.visited/s*100,10),"%)"),r.createElement("li",null,r.createElement("label",null,"CTR:"),e.ctr))),r.createElement(vb.Z,{className:"align-right",rating:e.rate,starRatedColor:"blue",numberOfStars:5,name:"rating",starDimension:"18px",starSpacing:"4px"}));E.push(i)})),r.createElement("form",{className:"site-settings__form site-settings-notifications"},r.createElement("h1",{className:"form-title"},"Статистика отправки почтовых уведомлений о новой теме"),r.createElement("div",{className:"form-section"},r.createElement("div",{className:"form-group"},r.createElement("small",{className:"form-text text-muted"},"Статистика отправки почтовых уведомлений о новой теме участникам сайта. Письма отправляются только тем пользователям, которые разрешили отправку уведомлений о новой теме на свой email.")),r.createElement("div",{className:"form-group"},"Порог CTR составляет ",l.data.notifications.ctr||0,"%"," ",r.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),n()}},"настройка"),m&&r.createElement(r.Fragment,null,r.createElement("small",{className:"form-text text-muted"},r.createElement("p",null,"CTR (Click-Through Rate) — процентное отношение людей, нажавших на ссылку в письме, ко всем людям, которые прочитали (открыли) письмо с уведомлением о теме."),r.createElement("p",null,"Порог CTR — минимальное значение CTR, которое обеспечивает полную отправку уведомлений о темах. Если после отправки небольшого количества уведомлений значение CTR оказывается ниже порогового, дальнейшая отправка прекращается. Таким образом, когда стоит задача более бережного обращения с аудиторией сайта (доставлять до широкой публики только самое интересное), необходимо выставить более высокий порог CTR. И наоборот, если нужно доставлять абсолютно все уведомления абсолютно всем пользователям, значение порога CTR должно быть нулевым.")),r.createElement("div",{className:"form-group form-group_inline"},r.createElement("label",{className:"site-settings-notifications_ctr-input"},"Порог CTR: (0-99%)"),r.createElement("div",{style:{flex:1}},r.createElement("input",{type:"text",className:"form-control",value:l.data.notifications.ctr||0,onChange:e=>{t(e.target.value)}}),l.errors.ctr?r.createElement("div",{className:"invalid-feedback"},l.errors.ctr):null)),r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:t=>{t.preventDefault(),e()},label:"Сохранить"})))),(u||!1===_)&&r.createElement("div",{className:"form-group form-group_inline-between"},u&&r.createElement("span",null,"Обновлено ",r.createElement("strong",null,f),", данные обновляются каждые пять минут"),!1===_&&r.createElement(He.Z,{type:"button",color:"secondary",onClick:s,label:d?"Свернуть все":"Развернуть все"}))),_&&r.createElement("div",{className:"form-section form-section_bottom"},"На данный момент не было почтовых уведомлений о новой теме"),E,h&&r.createElement("div",{className:"form-section form-section_bottom"},r.createElement(He.Z,{type:"button",onClick:()=>{window.history.pushState(null,"","/edit/notifications/?page="+g),i()},label:"Показать еще"})))}}wb.propTypes={handleTogglePopup:f().func,blogPostNotifications:f().object,siteSettings:f().object,getNotifications:f().func,changeCTR:f().func,saveCTR:f().func,toggleOptions:f().func,toggleItem:f().func,toggleList:f().func};const Ib=(0,i.$j)((e=>({app:e.app,blogPostNotifications:e.blogPostNotifications,siteSettings:e.siteSettings})),(e=>({getNotifications:()=>{e(((e,t)=>{const n=t(),a=n.app.site.id,s=n.blogPostNotifications.page,r=20*(s-1);$s.getList(a,{offset:r,count:20}).then((({lastUpdated:t,items:a})=>{const r=[];a.forEach((e=>{e.expanded=!1,r.push(e)}));const o=[...n.blogPostNotifications.list,...r];e({type:"EMAIL_NOTIFICATIONS_GET_LIST",list:o,updatedAt:t,isEmpty:o.length<1,hasMore:a.length>=20,page:s+1})}))}))},changeCTR:t=>{e(fu("notifications","ctr",t))},saveCTR:()=>{e(bu("notifications"))},toggleOptions:()=>{e((e=>{e({type:"EMAIL_NOTIFICATIONS_TOGGLE_OPTIONS"})}))},toggleItem:t=>{e((e=>(t,n)=>{const a=n().blogPostNotifications.list,s=a[e];s.expanded=!s.expanded,t({type:"EMAIL_NOTIFICATIONS_TOGGLE_ITEM",list:a})})(t))},toggleList:()=>{e(((e,t)=>{const n=t(),a=n.blogPostNotifications.list,s=!n.blogPostNotifications.expandList;a.forEach((e=>{e.expanded=s})),e({type:"EMAIL_NOTIFICATIONS_TOGGLE_LIST",list:a,expandList:s})}))}})))((0,ae.Z)(wb,"blogPostNotifications"));
/**
 * Mirtesen.
 *
 * Blog People Actions.
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Cb=(e,t)=>async(n,a)=>{try{const s=a(),r=s.app.site.id,o=s.blogMember.activeTab,i=s.blogMember.tabs[o],{page:l}=i,c=await eu.getMembers(r,{filter:o,offset:e,count:t});return n({type:"BLOG_MEMBER_GET_PAGE",userList:[...i.userList,...c],activeTab:o,page:l+1,hasMore:c.length>=Rp().recordsPerPage})}catch(e){D.Z.promiseHandler("/index.js")(e)}},Nb=(e,t)=>async(n,a)=>{const s=a(),r=s.app.site.id,o=s.blogMember.search,{page:i,needle:l}=o,c=await fp.Z.search(l,"GROUP_MEMBER",{siteId:r,offset:e,count:t});n({type:"BLOG_MEMBER_GET_SEARCH_RESULTS",userList:[...o.userList,...c],page:i+1,hasMore:c.length>=Rp().recordsPerPage})},Ob={type:"BLOG_MEMBER_SHOW_TABS"},Mb=({tabs:e,activeTab:t,handleChangeTab:n,hiddenTabs:a,isHideTabs:s,defaultValue:o,handleSearch:i})=>{const l=s?" people-list-navbar-nav__hide":"";return r.createElement("div",{className:"people-list-navbar"},r.createElement(Jn,{defaultValue:o,handleSearch:i,searchUrl:"/people"}),r.createElement(G.Z,{customButtonClasses:"people-list-navbar-nav__btn btn btn-empty",customDropdownClasses:`people-list-navbar-nav ${l}`,customListClasses:"people-list-navbar-nav__tabs",placement:"auto-left",buttonValue:e[t],openByHover:!0},Object.keys(e).map((s=>{const o=a.includes(s),i=_()({active:t===s});return o?null:r.createElement("span",{key:s,className:`people-list-navbar-nav__tab ${i}`,onClick:()=>n(s)},t===s&&r.createElement("svg",{style:{width:10,height:10},className:"svg-icon"},r.createElement("use",{href:"/images/icons.svg#check"})),e[s])}))))};Mb.propTypes={tabs:f().object,activeTab:f().string,hiddenTabs:f().array,handleChangeTab:f().func,handleSearch:f().func,showTabs:f().func,isHideTabs:f().any,isUserAdmin:f().any,defaultValue:f().string};const kb=(0,r.memo)(Mb);var Ab=n(8778);
/**
 * Mirtesen.
 *
 * People list component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class xb extends r.PureComponent{render(){const{person:e}=this.props;return r.createElement(dE,{className:"people-list-item"},r.createElement("a",{href:e.url,className:"people-list-item__user",target:"_blank"},r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo_original,logoClassName:"userlogo_l2",size:"av80"}}),r.createElement("span",{className:"people-list-item__user-info"},r.createElement("div",{className:"people-list-item__user-name",style:{color:Xp.Z.getHslColorByName(e.display_name)}},e.display_name),e.bdate&&r.createElement("div",{className:"people-list-item__user-age"},y.Z.bdateToAge(e.bdate).toString().concat(" "),(0,Ab.pluralize)(y.Z.bdateToAge(e.bdate),"год","года","лет")))),r.createElement(ou,{userId:e.id,compact:!0}))}}xb.propTypes={person:f().object};const Lb=xb,Db=({id:e,initialPage:t,threshold:n})=>{const a=(0,r.useRef)(null),s=e=>{window.history.pushState(null,"",zE.Z.addPageParamToUrl(window.location.href,e))},o=u()((()=>{const r=a.current?.getBoundingClientRect();if(!r)return;const o=r.top-window.innerHeight*n;window.pageDetector||(window.pageDetector=t),o<0&&window.pageDetector===e&&(window.pageDetector=e+1,s(e+1)),o>0&&window.pageDetector===e+1&&(window.pageDetector=e,s(e))}),80);(0,r.useEffect)((()=>{e===t&&(window.pageDetector=t,s(e))}),[t,e]);const i=(0,r.useCallback)(o,[e,n,t]);return(0,kr.O)("scroll",i),(0,kr.O)("resize",i),r.createElement("span",{ref:a})};Db.propTypes={id:f().number,initialPage:f().number,threshold:f().number};const Rb=(0,r.memo)(Db);
/**
 * Mirtesen.
 *
 * People list component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Zb extends r.Component{render(){const{peopleList:e,itemsPerPage:t,initialPage:n,enablePagination:a}=this.props;let s=0;return r.createElement("div",{className:"people-list"},e.length>0&&e.map((e=>{s++;const o=s%t==0,i=n-1+Math.floor(s/t);return r.createElement(r.Fragment,{key:e.id},r.createElement(Lb,{person:e}),a&&o&&r.createElement(Rb,{id:i,initialPage:n,threshold:.5}))})))}}Zb.propTypes={peopleList:f().array,itemsPerPage:f().number,initialPage:f().number,enablePagination:f().bool};const Bb=Zb,$b=({children:e})=>r.createElement("div",{className:"mt-list"},e);$b.propTypes={children:f().oneOfType([f().object,f().array])};const Ub=(0,r.memo)($b),Hb=(0,r.memo)((({blogMember:e,handleShowMore:t,handleChangeTab:n,handleSearch:a,memberCount:s,showTabs:o})=>{const{usedSearch:i,activeTab:l,search:c}=e,m=i?c:e.tabs[l],{hasMore:d,userList:p,page:u,initialPage:g}=m,h=!d&&!p.length,_=Rp().recordsPerPage,E=_+(u-1)*_,f=!eu.hiddenTabs.includes(l);return r.createElement("div",{className:"blog-people"},f&&r.createElement(r.Fragment,null,r.createElement("div",{className:"people-list-header"},r.createElement("h1",null,"Участники: ",s)),r.createElement(kb,{handleChangeTab:n,tabs:eu.tabs,activeTab:l,isUserAdmin:pd.canAdminBlog(),handleSearch:a,hiddenTabs:eu.hiddenTabs,isHideTabs:i,showTabs:o,defaultValue:c.needle||""})),!f&&r.createElement("div",{className:"people-list-header"},r.createElement("h1",null,eu.tabs[l])),h&&r.createElement("div",{className:"user-card__no-result"},"К сожалению, ничего не найдено"),r.createElement(zn,{pageStart:0,loadMore:()=>{if(d)return t(E,_)},hasMore:d,loader:r.createElement(Yn,null),threshold:500},r.createElement(Ub,null,r.createElement(Bb,{peopleList:p,itemsPerPage:_,initialPage:g,enablePagination:!0}))))}));Hb.propTypes={blogMember:f().object,handleChangeTab:f().func,handleShowMore:f().func,handleSearch:f().func,showTabs:f().func,memberCount:f().number};const Fb=(0,i.$j)((e=>({memberCount:e?.app?.site?.members_count,blogMember:e.blogMember})),(e=>({handleChangeTab:t=>{e((e=>(t,n)=>{t({type:"BLOG_MEMBER_CHANGE_TAB",tab:e});const a=n().blogMember.tabs[e];0===a.page&&a.hasMore&&t(Cb(0,Rp().recordsPerPage))})(t))},handleShowMore:(t,n)=>{e(((e,t)=>(n,a)=>{const s=a(),{usedSearch:r}=s.blogMember;n(r?Nb(e,t):Cb(e,t))})(t,n))},handleSearch:(t,n,a)=>{e((e=>async(t,n)=>{const a=n(),s=a.app.site.id,r=a.blogMember.search.page;if(!e){const e=a.blogMember.activeTab;return(a.blogMember.tabs?.[e]?.userList||[]).length||t(Cb(0,Rp().recordsPerPage)),t(Ob)}const o=await fp.Z.search(e,"GROUP_MEMBER",{siteId:s});t({type:"BLOG_MEMBER_DO_SEARCH",needle:e,userList:[...o],hasMore:o.length>=Rp().recordsPerPage,page:r+1})})(t))},showTabs:()=>{e(Ob)}})))((0,ae.Z)(Hb,"blogMember")),jb=({popupData:e,onToggleModeratorsPopup:t,onDeleteModerator:n})=>"delete"===e.popupType&&r.createElement(O.Z,{onClose:t,className:"site-moderators__popup"},r.createElement(O.Z.Body,{extraClasses:"site-moderators__popup__title"},"Вы действительно хотите исключить пользователя «",e.userInfo?e.userInfo.name:null,"»?"),r.createElement(O.Z.Footer,null,r.createElement(He.Z,{onClick:()=>{n(e.userInfo.id),t()},label:"Исключить"}),r.createElement(He.Z,{color:"secondary",onClick:t,label:"Отменить"})));jb.propTypes={onToggleModeratorsPopup:f().func,popupData:f().object,onDeleteModerator:f().func},jb.defaultProps={popupData:{}};
/**
 * Mirtesen.
 *
 * Blog moderators popup for add user component.
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Gb extends r.Component{constructor(){super(),this.state={role:"moderator",email:null}}render(){const{popupData:e,onToggleModeratorsPopup:t,onAddModerator:n}=this.props;return"add"===e.popupType&&r.createElement(O.Z,{onClose:t,className:"site-moderators__popup"},r.createElement(O.Z.Header,{extraClasses:"site-moderators__popup__title"},r.createElement(O.Z.Title,null,"Добавление сотрудника")),r.createElement(O.Z.Body,null,r.createElement("div",{className:"form-group"},r.createElement("legend",null,"E-mail:"),r.createElement("input",{className:"form-control",type:"email",name:"email",placeholder:"Введите e-mail нового сотрудника...",onChange:e=>{this.setState({email:e.target.value})}})),r.createElement("div",{className:"form-group"},r.createElement("legend",null,"Статус:"),r.createElement("div",{className:"site-moderators__popup__radio__wrap"},Object.keys(eu.roles).map(((e,t)=>"god"!==e?r.createElement("label",{key:t},r.createElement("input",{type:"radio",name:"role",ref:"role",value:e,defaultChecked:"moderator"===e,onChange:e=>{this.setState({role:e.target.value})}}),` ${eu.roles[e]}`):null))))),r.createElement(O.Z.Footer,null,r.createElement(He.Z,{onClick:()=>{n(this.state.email,this.state.role),t()},label:"Добавить"}),r.createElement(He.Z,{color:"secondary",onClick:t,label:"Отменить"})))}}Gb.propTypes={onToggleModeratorsPopup:f().func,onAddModerator:f().func,popupData:f().object},Gb.defaultProps={popupData:{}};const qb=Gb,Vb=({popupData:e,onToggleModeratorsPopup:t,onEditModerator:n,onChangeRadio:a,radioBtnValue:s})=>{const o=t=>e.userInfo?e.userInfo[t]:null;return"edit"===e.popupType&&r.createElement(O.Z,{onClose:t,className:"site-moderators__popup"},r.createElement(O.Z.Header,null,r.createElement(O.Z.Title,null,"Редактирование статуса сотрудника «",o("name"),"»")),r.createElement(O.Z.Body,null,r.createElement("div",{className:"form-group"},r.createElement("legend",null,"Статус:"),r.createElement("div",{className:"site-moderators__popup__radio__wrap"},Object.keys(eu.roles).map(((e,t)=>"god"!==e?r.createElement("label",{key:t},r.createElement("input",{type:"radio",name:"role",onChange:()=>{a(e)},defaultChecked:o("role")===e}),` ${eu.roles[e]}`):null))))),r.createElement(O.Z.Footer,null,r.createElement(He.Z,{onClick:()=>{n(o("id"),s||o("role")),t()},label:"Сохранить"}),r.createElement(He.Z,{color:"secondary",onClick:t,label:"Отменить"})))};Vb.propTypes={onToggleModeratorsPopup:f().func,onEditModerator:f().func,onChangeRadio:f().func,radioBtnValue:f().string,popupData:f().object},Vb.defaultProps={popupData:{}};var zb="/index.js";
/**
 * Mirtesen.
 *
 * Blog moderators Actions.
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
/**
 * Mirtesen.
 *
 * Blog Post Editor.
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Wb extends r.Component{handleClosePopup=()=>{const{onToggleModeratorsPopup:e}=this.props;e()};render(){const{blogModerators:e,onToggleModeratorsPopup:t,onAddModerator:n,onDeleteModerator:a,onEditModerator:s,onChangeRadio:o}=this.props,{popup:i}=e;return pd.canStaff()&&r.createElement("div",{className:"site-moderators content-block"},r.createElement("div",{className:"site-moderators__header"},r.createElement("h3",{className:"site-moderators__title"},"Сотрудники сайта"),r.createElement(He.Z,{onClick:()=>{t("add")},label:"Добавить"})),r.createElement("div",{className:"site-moderators__item__wrap"},e.staff.map((e=>r.createElement("div",{className:"site-moderators__item",key:e.id},r.createElement("a",{href:`//mirtesen.ru/people/${e.id}`,target:"_blank"},e.name),r.createElement("span",null,eu.roles[e.role]),"god"!==e.role&&r.createElement("div",null,r.createElement(He.Z,{onClick:()=>{t("edit",e)},label:"Редактировать"})," ",r.createElement(He.Z,{color:"secondary",onClick:()=>{t("delete",e)},label:"Удалить"})))))),r.createElement("div",{className:"site-moderators__desc"},r.createElement("p",null,"Вы можете пригласить супер администраторов, администраторов и модераторов для своего сайта.")),"delete"===i.popupType&&r.createElement(jb,{popupData:i,onToggleModeratorsPopup:t,onDeleteModerator:a}),"add"===i.popupType&&r.createElement(qb,{popupData:i,onToggleModeratorsPopup:t,onAddModerator:n}),"edit"===i.popupType&&r.createElement(Vb,{popupData:i,radioBtnValue:e.radioBtnValue,onToggleModeratorsPopup:t,onEditModerator:s,onChangeRadio:o}))}}Wb.propTypes={blogModerators:f().object,onToggleModeratorsPopup:f().func,onDeleteModerator:f().func,onEditModerator:f().func,onAddModerator:f().func,onChangeRadio:f().func};const Yb=(0,i.$j)((e=>({blogModerators:e.blogModerators})),(e=>({onToggleModeratorsPopup:(t,n,a)=>{e(((e=null,t=null)=>({type:"BLOG_MODERATORS_TOGGLE_POPUP",popupType:e,userInfo:t}))(t,n))},onDeleteModerator:t=>{var n,a;e((n=t,(e,t)=>{const s=t().app.site.id;Promise.resolve(eu.setStaff(s,n,null)).then((t=>{if(t?.result)return e({type:"BLOG_MODERATORS_DELETE_MODERATOR",userId:n,role:a});kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:t?.message||"При сохранении произошла ошибка"})})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(zb)(e)}))}))},onAddModerator:(t,n)=>{e(((e,t)=>(n,a)=>{const s=a().app.site.id;Promise.resolve(eu.setStaff(s,e,t)).then((e=>{if(e.result)return Promise.resolve(eu.getStaff(s)).then((e=>{const t=[];return Object.keys(e).forEach((n=>{e[n]&&e[n].forEach((e=>{t.push({name:e.display_name,id:e.id,role:n})}))})),n({type:"BLOG_MODERATORS_ADD_MODERATOR",staff:t})})).catch(D.Z.promiseHandler(zb));kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e?.message||"При сохранении произошла ошибка"})})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(zb)(e)}))})(t,n))},onEditModerator:(t,n)=>{e(((e,t)=>(n,a)=>{const s=a().app.site.id;Promise.resolve(eu.setStaff(s,e,t)).then((a=>{if(a?.result)return n({type:"BLOG_MODERATORS_EDIT_MODERATOR",userId:e,role:t});kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:a?.message||"При сохранении произошла ошибка"})})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(zb)(e)}))})(t,n))},onChangeRadio:t=>{e((e=>({type:"BLOG_MODERATORS_CHANGE_RADIO",value:e}))(t))}})))((0,ae.Z)(Wb,"blogMederators"));
/**
 * Mirtesen.
 *
 * Action blog post notify Container
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Kb extends r.PureComponent{render(){const{actionBlogPostNotify:e,onToggleActionBlogPostNotify:t,onSendBlogPostNotify:n}=this.props;return e.isOpen&&r.createElement(O.Z,{className:"moderation-popup",onClose:t},r.createElement(O.Z.Body,null,"Вы действительно хотите уведомить всех участников?"),r.createElement(O.Z.Footer,null,r.createElement(He.Z,{label:"Уведомить",type:"submit",color:"primary",onClick:()=>{n(e.id),t()}}),r.createElement(He.Z,{label:"Отменить",color:"secondary",type:"button",onClick:()=>{t()}})))}}Kb.propTypes={actionBlogPostNotify:f().object,onToggleActionBlogPostNotify:f().func,onSendBlogPostNotify:f().func};const Jb=(0,i.$j)((e=>({actionBlogPostNotify:e.actionBlogPostNotify})),(e=>({onToggleActionBlogPostNotify:()=>{e(Us())},onSendBlogPostNotify:t=>{e((e=>(t,n)=>{$s.sendNotify(e).then((a=>{if(a&&!0===a.result){const s=n();"blogPost"!==s.app.page&&"blogPostDispute"!==s.app.page||t({type:"BLOG_POST_NOTIFY_SEND",id:a.id}),"blogPostList"===s.app.page&&t({type:"BLOG_POST_LIST_NOTIFY_SEND",id:e}),t({type:"ACTION_BLOG_POST_NOTIFY_SEND",id:a.id})}else{let e=a.message||"Произошла ошибка...";const t=L()(a,"errors");!e&&t&&(e=t[Rs()(t)[0]]),kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e})}})).catch(D.Z.promiseHandler("/index.js"))})(t))}})))(Kb);
/**
 * Mirtesen.
 *
 * Topic Popup.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Xb extends r.PureComponent{componentDidUpdate(e){const{isOpen:t,onGetTopicList:n}=this.props;t&&t!==e.isOpen&&n()}handleSubmit=()=>{const{saveTopic:e}=this.props;e()};render(){const{isOpen:e,isBusy:t,topic:n,list:a,onCloseTopicPopup:s,onChangeTopic:o}=this.props;return"undefined"==typeof window?null:e&&r.createElement(O.Z,{className:"moderation-popup",onClose:s},r.createElement(O.Z.Body,null,r.createElement("form",null,r.createElement("legend",null,"Тематика:"),a&&r.createElement("div",null,r.createElement("select",{name:"select",onChange:e=>{o(e.target.value||null)},defaultValue:n||"",className:"form-control"},r.createElement("option",{value:""},"-- автоматически --"),Object.keys(a).map((e=>r.createElement("option",{value:e,key:e},a[e]))))))),r.createElement(O.Z.Footer,null,r.createElement(He.Z,{label:"Сохранить",color:"primary",onClick:()=>{this.handleSubmit(),s()},disabled:t})))}}Xb.propTypes={isOpen:f().bool,isBusy:f().bool,topic:f().string,list:f().object,onGetTopicList:f().func,onCloseTopicPopup:f().func,onChangeTopic:f().func,saveTopic:f().func};const Qb=(0,i.$j)((e=>({isOpen:e.topicModeration.isOpen,isBusy:e.topicModeration.isBusy,topic:e.topicModeration.topic,list:e.topicModeration.list})),(e=>({onGetTopicList:()=>{e(((e,t)=>{const{list:n}=t().topicModeration;n||Js.getTopics(!0).then((t=>e({type:"TOPIC_MODERATION_SET_LIST",list:t.reduce(((e,t)=>(e[t.key]=t.text,e)),{})}))).catch((e=>{kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler(Xs)(e)}))}))},onCloseTopicPopup:()=>{e({type:"TOPIC_MODERATION_CLOSE"})},onChangeTopic:t=>{e((e=>({type:"TOPIC_MODERATION_CHANGE_TOPIC",value:e}))(t))},saveTopic:()=>{e(((e,t)=>{const{currentBlogPostId:n,topic:a}=t().topicModeration;e({type:"TOPIC_MODERATION_IS_BUSY",isBusy:!0});const s=a?[a]:null;Js.setObjectsTopics([n],s).then((([e])=>{e?kt.Z.sendSystemMessage("save"):kt.Z.sendSystemMessage("exception")})).catch((e=>{kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler(Xs)(e)}))}))}})))(Xb);
/**
 * Mirtesen.
 *
 * Action delete post popup Container
 *
 * @author       Igor Peregudov.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ey extends r.PureComponent{getContentText=()=>{const{actionModifyPostPopup:e}=this.props;return"delete"===e.popupType?"Вы действительно хотите удалить этот пост?":"approve"===e.popupType?"Вы действительно хотите одобрить этот пост?":""};render(){const{onToggleActionModifyPostPopup:e,actionModifyPostPopup:t,onDeleteBlogPost:n,onApproveBlogPost:a}=this.props;return t.isOpen&&r.createElement(O.Z,{className:"moderation-popup",onClose:e},r.createElement(O.Z.Body,null,this.getContentText()),r.createElement(O.Z.Footer,null,"delete"===t.popupType&&r.createElement(He.Z,{label:"Удалить",type:"button",color:"primary",onClick:()=>{n(t.id),e()}}),"approve"===t.popupType&&r.createElement(He.Z,{label:"Одобрить",type:"button",color:"primary",onClick:()=>{a(t.id),e()}}),r.createElement(He.Z,{label:"Отменить",type:"button",color:"secondary",onClick:e})))}}ey.propTypes={onToggleActionModifyPostPopup:f().func,actionModifyPostPopup:f().object,onDeleteBlogPost:f().func,onApproveBlogPost:f().func};const ty=(0,i.$j)((e=>({actionModifyPostPopup:e.actionModifyPostPopup})),(e=>({onToggleActionModifyPostPopup:()=>{e(ys())},onDeleteBlogPost:t=>{e((e=>t=>{(new fs.Z).deleteById(e).then((n=>{"undefined"!==n&&t({type:"DELETE_BLOG_POST",id:e})})).catch(D.Z.promiseHandler(bs))})(t))},onApproveBlogPost:t=>{e((e=>t=>{(new fs.Z).approveById(e).then((n=>{"undefined"!==n&&t({type:"APPROVE_BLOG_POST",id:e})})).catch(D.Z.promiseHandler(bs))})(t))}})))(ey);
/**
 * Mirtesen.
 *
 * Blog Post Pagination Component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ny extends r.PureComponent{render(){const{nextPostUrl:e,prevPostUrl:t}=this.props;return r.createElement("nav",{className:_()({pagination:!0})},r.createElement("ul",{className:"blog-post__pagination"},e&&r.createElement("li",null,r.createElement("a",{href:e},r.createElement("span",{className:"blog-post__pagination__arrow"},"←"),"Предыдущая тема")),t&&e&&r.createElement("li",{className:"blog-post__pagination__symbol"}," | "),t&&r.createElement("li",null,r.createElement("a",{href:t},"Следующая тема",r.createElement("span",{className:"blog-post__pagination__arrow"},"→")))))}}ny.propTypes={prevPostUrl:f().string,nextPostUrl:f().string};const ay=ny,sy=({blogPost:e})=>((0,r.useEffect)((()=>{w.Z.lazyLoad((()=>"function"==typeof window.loadCluster),(()=>{window.PandaVideo.loadCluster({divId:"panda_player",canonicalUrl:e.canonical_url,title:e.title,promo:!1})}),(()=>{console.log("Couldn't load panda player")}))}),[]),r.createElement("div",{id:"panda_player",className:"panda-player"})),ry=()=>((0,r.useEffect)((()=>{const e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://smi2.ru/data/js/101877.js",e.charset="utf-8";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}),[]),r.createElement("div",{id:"unit_101877"},r.createElement("a",{href:"https://smi2.ru/"},"НовостиСМИ2")));class oy extends r.PureComponent{constructor(e){super(e),this.state={pandaVideo:!1};const{blogPost:t}=this.props;this.splitPoint=300,this.splitPoint2=1200,this.inTextAd=null,this.text=this._preformatText(t)}componentDidMount(){const{disableVideo:e,query:t,blogPost:n}=this.props,a=n?.group?.created||null;e||(13878506===Number(t.rtb_forced_news)&&13878506===Number(t.rtb_smi2_rich)?this.setState({pandaVideo:"smi2"}):a&&a<1706738400&&this.setState({pandaVideo:"panda"}))}getClearLength=e=>e?e.replace(/(<[^>]+>)/gi,"").length:0;splitText=(e,t=500)=>{if(this.getClearLength(e)<t)return[e,""];return y.Z.splitByDelimiter(e,t,"\\.\\!\\?")};_preformatText(e){const{browserName:t,disableVideo:n}=this.props;let a=EE.ZP.normalizeText(e,{isCurrentPost:!0,browserName:t,disableVideo:n});[43614924039,43534515745].includes(e.id)&&(a=a.replace(/rel="nofollow"/gi,"")),a=a.replace(/<a [^>]*?lightbox_labuda[^>]*?>.*?<\/a>/gi,""),a=a.replace(/[\r\n]+/g," ");const s={0:!1,1:!1};return a=this.splitText(a,this.splitPoint),a[1]=a[1]||"",a=[a[0],...this.splitText(a[1],this.splitPoint2)],a[2]=a[2]||"",s[0]=!0,s[1]=!0,this.inTextAd=s,a}getAdWrapper=(e=0)=>{const{hideAdBlocks:t}=this.props;return t||e>0?"":"<div id=\"unit_101877\"><a href=\"https://smi2.ru/\" >Новости СМИ2</a></div>\n<script type=\"text/javascript\" charset=\"utf-8\">\n  (function() {\n    var sc = document.createElement('script'); sc.type = 'text/javascript'; sc.async = true;\n    sc.src = '//smi2.ru/data/js/101877.js'; sc.charset = 'utf-8';\n    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(sc, s);\n  }());\n<\/script>"};render(){const{blogPost:e}=this.props,{pandaVideo:t}=this.state;return r.createElement(r.Fragment,null,this.text&&r.createElement("div",{className:"blog-post__text",itemProp:"articleBody",dangerouslySetInnerHTML:{__html:(this.text[0]||"")+(this.inTextAd[0]?this.getAdWrapper(0):"")+(this.text[1]||"")+(this.inTextAd[1]?this.getAdWrapper(1):"")+(this.text[2]||"")}}),"panda"===t&&r.createElement(sy,{blogPost:e}),"smi2"===t&&r.createElement(ry,null),e.foreignPollId&&r.createElement(_n,{pollId:e.foreignPollId,postUrl:e.url}))}}oy.propTypes={blogPost:f().object,siteBuilder:f().object,hideAdBlocks:f().bool,mobileApp:f().bool,browserName:f().string,disableVideo:f().bool,siteId:f().number};const iy=(0,i.$j)((e=>({hideAdBlocks:e.app.hideAdBlocks,mobileApp:e.app.req.mobileApp,browserName:e.app.req.browser.name,disableVideo:e.app.disableVideo,geoId:Number(e.app.req.headers["x-geoip2-geoname-id"]||0),query:e?.app?.req?.query,siteId:e.app.site.id})))(oy),ly=({blogPost:e,app:t})=>{const{group:n={},from:a,post_type:s}=e,o=L()(n,"canViewBlogPostCreator"),{page:i}=t,l="user_post"===s||o&&"indexMainAuthorized"!==i?"person":"blog";let c="person"===l?a:n;c||(c={});const{url:m,photo_original:d,id:p}=c,u=c.display_name||c.name;let g=Fp.addUtmToUrl(m);const h=o?"_blank":"_self";let E="span";const f={className:_()({"blog-post__author-avatar":!0})};return"person"===l?(E=cg,f.userId=p,f.tagName="span"):"blog"===l&&"indexMainAuthorized"===i&&(E="a",f.onClick=Fp.replaceLocationWithMirtesenKey,f.href=g,f.target=h,g=null),r.createElement(E,f,r.createElement(Mn.Z,{logoInfo:{userName:u,logoImg:d||L()(t,"siteBuilder.mainLogo.props.image")||L()(t,"site.photo",null),logoUrl:g,linkTarget:h}}))};ly.propTypes={blogPost:f().oneOfType([f().object,f().array]),app:f().object};const cy=ly;
/**
 * Mirtesen.
 *
 * Verified author sign.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class my extends r.PureComponent{render(){const{color:e}=this.props;return r.createElement("i",{className:_()({"verified-author":!0,"svg-verified-author_dark":"dark"===e,"svg-verified-author_light":"light"===e})},r.createElement("span",{className:"verified-author__tooltip"},"Подлинная учетная запись публичной личности или страницы"))}}my.defaultProps={color:"light"},my.propTypes={color:f().string};const dy=my;
/**
 * Mirtesen.
 *
 * Email Notification Container.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class py extends r.Component{sendTime(){const{blogPost:e}=this.props,{blogPostNotification:t}=this.props,{data:n}=t;return!e.notificationsWillBeSent&&e.notificationsSent&&n.started?r.createElement(s_,{date:n.started,format:"D MMMM YYYY HH:mm"}):"скоро начнется"}render(){if(!b.ZP.canModerate())return null;const{blogPostNotification:e,toggleNotificationStats:t}=this.props,{data:n}=e;return e.show&&r.createElement("div",{className:"blog-post__notifications"},!n||0===Object.keys(n).length&&r.createElement("ul",null,r.createElement("li",null,"Готовим статистику")),n&&0!==Object.keys(n).length&&r.createElement("ul",null,r.createElement("li",null,r.createElement("span",null,"Отправитель:"),r.createElement("a",{target:"_blank",href:`//mirtesen.ru/people/${n.person_id}`},n.person_name)),r.createElement("li",null,r.createElement("span",null,"Заявка:"),r.createElement("strong",null,r.createElement(s_,{date:n.created,format:"D MMMM YYYY HH:mm"}))),r.createElement("li",null,r.createElement("span",null,"Начало отправки:"),this.sendTime()),r.createElement("li",null,r.createElement("span",null,"Обработано:"),`${n.processed_count} (${n.processed_percent}%)`),r.createElement("li",null,r.createElement("span",null,"Заблокировано:"),`${n.blocked_count} (${n.blocked_percent}%)`),r.createElement("li",null,r.createElement("span",null,"Прочитали письмо:"),`${n.read_count} (${n.read_percent}%)`),r.createElement("li",null,r.createElement("span",null,"Перешли на сайт:"),`${n.click_count} (${n.click_percent}%)`),r.createElement("li",null,r.createElement("span",null,"CTR:"),n.click_from_sent_percent,"%")),r.createElement("button",{type:"button",className:"btn btn-secondary",onClick:()=>{t()}},"Закрыть"))}}py.propTypes={app:f().object,blogPostNotification:f().object,blogPost:f().object,toggleNotificationStats:f().func};const uy=(0,i.$j)((e=>({app:e.app,blogPostNotification:e.blogPostNotification})),(e=>({toggleNotificationStats:()=>{var t;e((t=!1,e=>{e({type:"EMAIL_NOTIFICATION_TOGGLE_BLOCK",show:t})}))}})))(py),gy=(0,r.memo)((({listTopics:e=[],topic:t,topicUtm:n})=>{const a=e.find((({key:e})=>e===t));if(!a?.key)return null;const s="coronavirus"===a?.key?.toLowerCase();let o=`//${Rp().mainDomain}/topic/${a?.key}?utm_medium=from_headline_topic_button`;return n&&(o+=`&${n}`),r.createElement("h3",{className:"blog-post__topic-category-wrapper"},r.createElement("a",{className:"blog-post__topic-category",href:o},r.createElement("span",null,s?a.text.toUpperCase():a.text)))}));gy.propTypes={listTopics:f().array,topic:f().string,topicUtm:f().string};const hy=gy;
/**
 * Mirtesen.
 *
 * Blog Post Header component.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class _y extends r.Component{getPublicationDate=e=>{const t=e.formattedDates.iso;return e.is_draft?"Черновик":e.is_queued?r.createElement(r.Fragment,null,"Дата публикации: ",r.createElement(s_,{date:e.publish_time,format:"D MMMM, H:mm"})):t&&y.Z.isPastYear(t)?r.createElement(s_,{date:t,format:"DD.MM.YYYY в H:mm"}):r.createElement(s_,{date:t,format:"D MMMM, H:mm"})};getEditorStatusHtml=e=>{if("EDITOR_STATUS_NONE"!==e){const t="EDITOR_STATUS_AUTHOR"===e?"Авторский материал":"Отборный материал";return r.createElement("div",{className:_()({"blog-post__status":!0,"blog-post__status_author":"EDITOR_STATUS_AUTHOR"===e,"blog-post__status_selected":"EDITOR_STATUS_SELECTED"===e})},r.createElement("div",{className:"blog-post__status-tooltip"},r.createElement("div",null,t),r.createElement("div",null,"Наши редакторы постоянно отбирают для вас лучшие материалы")))}return null};getContextActionsType=()=>{const{blogPost:e,user:t}=this.props;return b.ZP.canModerate()?"blog-post-moderator":e.from?.id===t?.id?"blog-post-author":"blog-post-guest"};render(){const{blogPost:e,app:t,listTopics:n=[],isMainPost:a}=this.props,s=Fp.isSiteMatch("verifiedBlogs"),o=a?"h1":"h2";return r.createElement(r.Fragment,null,t.site&&r.createElement("div",{className:"blog-post__header"},r.createElement("div",{className:"blog-post__author",rel:"author"},r.createElement(cy,{app:t,blogPost:e}),r.createElement("div",null,r.createElement("a",{className:"blog-post__author-name",href:t.site.canViewBlogPostCreator?e.from.url:t.site.mainDomain,target:"_blank",rel:"dispute"===t.scope?"nofollow":null},r.createElement("span",{itemProp:"author"},!t.site.canViewBlogPostCreator&&r.createElement(r.Fragment,null,Fp.getTitle(t),s&&r.createElement(dy,{color:"dark"})),t.site.canViewBlogPostCreator&&r.createElement(r.Fragment,null,e.from.display_name,(e.from.isAuthenticAccount||s)&&r.createElement(dy,{color:"dark"})))),r.createElement("div",{className:"blog-post__info"},r.createElement("div",{className:"blog-post__pubdate"},this.getEditorStatusHtml(e.editorStatus),this.getPublicationDate(e)),r.createElement(hy,{topic:e.topic,listTopics:n})))),r.createElement($u,{extraClasses:"blog-post__header-subscribe",onClickHandler:()=>na.ym("reachGoal","click_read_mob_blogpost"),siteId:t.site.id,isMini:!0,onlyForNotSubscribed:!0}),r.createElement(ir,{post:e,type:this.getContextActionsType(),editorType:"blog"})),!e.isTitleHidden&&r.createElement(o,{className:"blog-post__title",itemProp:"headline"},a?e.title:r.createElement("a",{href:e.seo_url||e.url},e.title)),r.createElement(uy,{blogPost:e}))}}_y.propTypes={logPost:f().oneOfType([f().object,f().array]),app:f().object,listTopics:f().array,isMainPost:f().bool,user:f().object};const Ey=_y,fy=({tags:e=[],className:t})=>{const n={"post-tags":!0};return t&&(n[t]=!0),Array.isArray(e)&&e.length>0&&r.createElement("div",{className:_()(n)},e.map(((e,t)=>{const n=Pa.Z.isCustomTag(e);let a,s="a";const o=e.match(/\[G?(\d+)\]$/i);return n&&!o?.[1]?s="div":(s="a",a=n?`/geoposition/${o[1]}`:`/hashtags/${encodeURIComponent(e)}`),r.createElement(r.Fragment,{key:t},r.createElement(Gf,{text:e,icon:Pa.Z.isGeoTag(e)?"geo":void 0,htmlTag:s,href:a}),r.createElement("meta",{itemProp:"about",content:e}))})))};fy.propTypes={tags:f().array,className:f().string};const by=fy,yy=({postId:e})=>{const t=(0,aa.C)((e=>e.indexMainAuthorized?.hiddenPosts)),n=(0,aa.C)((t=>t.actionModifyPostPopup?.deletedList?.[e])),a=(0,aa.T)();return t.indexOf(e)>-1||n?r.createElement("div",{className:"post-card__fade"},n&&r.createElement(r.Fragment,null,"Пост удален...",r.createElement(He.Z,{onClick:()=>{var t;a((t=e,e=>{(new fs.Z).restoreById(t).then((n=>{"undefined"!==n&&e({type:"RESTORE_BLOG_POST",id:t})})).catch(D.Z.promiseHandler(bs))}))},label:"Восстановить"}))):null},vy=(0,r.memo)(yy);var Ty=n(81763),Sy=n.n(Ty);const Py=(e,t)=>{const[n,a]=(0,r.useState)(!1),s=(0,r.useRef)();(0,r.useEffect)((()=>()=>clearTimeout(s.current)),[]);const o=(e,t)=>{s.current&&clearTimeout(s.current),t?s.current=setTimeout((()=>a(e)),t):a(e)};return{isActive:n,handleMouseEnter:()=>{e||o(!0,Sy()(t)?t:t?.enter)},handleMouseLeave:()=>{e||o(!1,Sy()(t)?t:t?.leave)},toggleActivity:o}},wy=({userId:e,reactionObject:t,reactionInfo:n,isMobile:a,post:s,inProcess:o,onOpenAuthForm:i,onSetReaction:l,onShowVoterList:c})=>{const m=(0,r.useRef)(null),{isActive:d,handleMouseEnter:p,handleMouseLeave:u,toggleActivity:g}=Py(a,{enter:300,leave:500});Ep(m,(()=>{a&&d&&g(!1)}));const h=t.currentReaction,E=h&&(jo.reactions[h]||jo.reactions.default),{marksCount:f,reactionsList:b}=n,v=s.smi2_id||s.id,T=[...b].sort(((e,t)=>t.count-e.count)).slice(0,3),S=(e=1)=>{gd.shareEvent("like",s.id,EE.ZP.getViewCounterType(s),e)},P=t=>{const{canVote:n,currentReaction:r}=t;e?(!o&&n&&((e,t,n)=>{t?l(e,{},n):(S(jo.reactions.love.rate),l(e,{rate:jo.reactions.love.rate,id:jo.reactions.love.id},n))})(s.id,r,{smi2Id:s.smi2_id}),a&&e&&n&&g(!0)):i()},w=e=>{e&&(E?.id===e.id||o||(S(e.rate),l(s.id,{id:e.id,rate:e.rate},{smi2Id:s.smi2_id}),a&&g(!1)))},I={"post-actions__btn":!0,"post-actions__btn_empty":f<1,[`post-actions__btn_${h}`]:!!h};return r.createElement("div",{ref:m,className:"post-actions__control",onMouseEnter:()=>{e&&t.canVote&&p()},onMouseLeave:()=>{e&&t.canVote&&u()}},r.createElement(ia.Z,{type:"button",className:_()(I),onClick:()=>P(t),"data-test":`control-reaction-${v}`},h?r.createElement(qo.Z,{name:h,size:"sm"}):r.createElement(yn.Z,{iconName:"reaction"}),f>0&&r.createElement("span",null,y.Z.formatViewsCounter(f,"eng"))),d&&r.createElement(oa.Z,{target:m.current,offset:[60,8],placement:"top-left",className:"tooltip-popup_noborder",enableMobile:!1},f>0&&r.createElement(ia.Z,{className:"reactions-info",type:"button",onClick:()=>{c(v,{marksCount:f,reactionsList:b}),g(!1)}},r.createElement("div",{className:"reactions-info__icons"},T.map(((e,t)=>e.count?r.createElement("div",{key:e.name,className:"reactions-info__icon",style:{zIndex:T.length-t}},r.createElement(qo.Z,{name:e.name,size:"xs"})):null))),r.createElement("span",{className:"reactions-info__counter"},y.Z.formatViewsCounter(f,"eng")+" "+y.Z.num2string(f,["оценка","оценки","оценок"]))),r.createElement("div",{className:"reactions-list"},Object.entries(Uo.list).map((([e,t])=>t.id&&r.createElement("button",{className:"reactions-list__btn",key:`reaction-${e}`,type:"button","data-reaction-name":e,onClick:()=>{w(t)},disabled:h===e},r.createElement(qo.Z,{title:t.title,name:e,size:"lg"})))))))},Iy=(0,r.memo)(wy);
/**
 * Mirtesen.
 *
 * Post reactions actions
 *
 * @author       Olga Efimova
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const Cy=(e,t,n)=>({type:"VOTE_ACTION_ADD_REACTION",objectId:e,nextId:n,prevId:t}),Ny=({post:e})=>{const t=(0,aa.C)((e=>e.voteAction)),n=(0,aa.C)((e=>e?.app?.req?.isMobile)),a=(0,aa.C)((e=>e.auth?.user?.id)),s=(0,aa.T)(),o=e.id||e.smi2_id,i=o?t?.[o]:void 0,l=i?.actions||cm,c=i?.info||mm,m=(0,r.useCallback)(((e,t,n)=>s(((e,t={},n={})=>async(a,s)=>{const{smi2Id:r}=n,{rate:o,id:i}={rate:0,id:null,...t},l=s(),c=r||e,m=l.voteAction[c]||dm,d=m?.actions?.currentReaction,p=Sy()(i)&&100===Math.abs(i)?null:i;try{a({type:"VOTE_ACTION_TOGGLE_PROCESS",inProcess:!0,objectId:c});const t=new jo;if(void 0!==(r?await t.voteSmi2(c,i):await t.vote(e,o,p))){const e=Object.keys(jo.reactions).find((e=>i&&jo.reactions[e].id===i))||"";return a({type:"VOTE_ACTION_TOGGLE_PROCESS",inProcess:!1,objectId:c}),a(Cy(c,jo.reactions[d]?.id,jo.reactions[e]?.id)),a({type:"VOTE_ACTION_SET_REACTION",objectId:c,state:{rate:o,currentReaction:e||null}})}}catch(e){D.Z.promiseHandler("/index.js")(e),a({type:"VOTE_ACTION_TOGGLE_PROCESS",inProcess:!1,objectId:c})}})(e,t,n))),[s]),d=(0,r.useCallback)((()=>s(_e("login"))),[s]),p=(0,r.useCallback)(((e,t)=>s(((e,{marksCount:t,reactionsList:n})=>a=>{a({type:"VOTER_LIST_2_TOGGLE_POPUP",objectId:e,params:{isOpen:!0,totalCount:t,tabs:n,objectId:e}})})(e,t))),[s]);return(0,r.useEffect)((()=>{var t,n;!i?.initialized&&o&&s((t=o,n=e,async e=>{try{const a=n.smi2_id;let s,r,o=null,i=!1,l=0;if(a){const e=await(new jo).getSmi2Reactions(a);o=e.currentReaction,s=o?1:0,i=!0,r=e.reactions||[],l=e.count}else{s=n?.likes?.user_likes||0;const e=jo.getNormalizedReactionId(s,n?.likes?.user_like_attr);o=Object.keys(jo.reactions).find((t=>jo.reactions[t].id===e)),i=!!n?.likes?.can_like,r=n?.likes?.like_attr_ids||[],l=n.marks_count||0}const c=Object.keys(jo.reactions).map((e=>{const t=jo.reactions[e],n=r.find((({id:e})=>e===t.id));return{name:e,id:t.id,count:n?n.count:0}}));e({type:"VOTE_ACTION_INIT_ACTIONS_STATE",objectId:t||a,state:{rate:s,currentReaction:o||null,canVote:i}}),e({type:"VOTE_ACTION_INIT_INFO_STATE",objectId:t||a,state:{initialized:!0,marksCount:l,reactionsList:c}})}catch(e){D.Z.promiseHandler("init reactions")(e)}}))}),[i,e]),i?.initialized?r.createElement(Iy,{post:e,userId:a,reactionObject:l,reactionInfo:c,isMobile:n,inProcess:i?.inProcess||!1,onOpenAuthForm:d,onSetReaction:m,onShowVoterList:p}):null},Oy=(0,r.memo)(Ny);
/**
 * Mirtesen.
 *
 * DOM helper.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class My{getOffsetByPage=e=>{let t=0,n=0;for(;null!==e;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{x:t,y:n}};getOffsetByParent=e=>({x:e.offsetLeft,y:e.offsetTop});static setDangerousHtml=(e,t)=>{if(null===t)return;const n=document.createRange();n.selectNodeContents(t),n.deleteContents(),t.appendChild(n.createContextualFragment(e))};static scrollTo=(e,t,n,a)=>{if(n<=0)return void(a&&setTimeout(a,0));const s=(t-e.scrollTop)/n*10;setTimeout((()=>{e.scrollTop=e.scrollTop+s,e.scrollTop!==t?My.scrollTo(e,t,n-10,a):a&&setTimeout(a,0)}),10)};static scrollIntoView=(e,t="",n=100,a)=>{if(["ios-webview","safari","ios"].includes(t)){const t=e.getBoundingClientRect(),s=t.top+t.height/2+window.pageYOffset-document.documentElement.clientHeight/2;My.scrollTo(document.documentElement,s,n,a)}else if(e.scrollIntoView({block:"center"}),a)return a()}}const ky=My;function Ay(){return Ay=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Ay.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Comment handler  HOC.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const xy=function(e){return t=>{const{post:n,isCurrentPost:a,showAuthForm:s}=t,o=n.id||n.smi2_id,i=(0,aa.C)((e=>e.auth?.user?.id)),l=(0,aa.T)(),c=fs.Z.formPostCommentsUrl(n),m=(0,aa.C)((e=>e.app.req?.browser));return r.createElement(e,Ay({onCommentClick:e=>{if(e.preventDefault(),!a){if(!i&&s)return l(ee({onBeforeChange:()=>{document.location.href=c}})),void l(_e("login"));if(!window.location.pathname.match(/^\/dispute\//))return void(document.location.href=c)}const t=e.target.closest("#content-column")||window.document,n=t.querySelector(`#comment-reply${o}`)||t.querySelector(`#comment_widget_${o} .m-input`);n&&ky.scrollIntoView(n,m,200,(()=>n.focus()))},postId:o,url:c},t))}},Ly=({url:e,commentCount:t,postId:n,onCommentClick:a})=>{const s=(0,aa.C)((e=>e.app?.groupBlogPostsModule?.allowCommentVislvl));return s===K.Z.allowLevels.none?null:r.createElement("div",{className:"post-actions__control"},r.createElement(ia.Z,{className:_()("post-actions__btn",t<1&&"post-actions__btn_empty"),href:e,onClick:a,"data-test":n?`control-comment-${n}`:void 0},r.createElement(yn.Z,{iconName:"comment-2"}),t>0&&r.createElement("span",null,y.Z.formatViewsCounter(t))))},Dy=xy((0,r.memo)(Ly)),Ry=({classes:e,onSharePost:t})=>r.createElement("button",{type:"button",className:e,onClick:t},"Поделиться в МирТесен");Ry.propTypes={classes:f().string,onSharePost:f().func};const Zy=(0,r.memo)(Ry),By=({classes:e,id:t="",name:n,url:a="",text:s="",title:o="",shareUrl:i})=>r.createElement("button",{type:"button",id:t||null,className:e,onClick:()=>((e,t,n=null,a=null)=>{n=n||document.location.href,t+=encodeURIComponent(y.Z.fixProtocol(n)),"twitter"===e&&a&&(t+="&text="+encodeURIComponent(a)),window.open(t,"","toolbar=0,status=0,width=626,height=436")})(n,i,a,s)},o);By.propTypes={classes:f().string,id:f().string,name:f().string,url:f().string,text:f().string,title:f().string,shareUrl:f().string};const $y=(0,r.memo)(By);function Uy(){return Uy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Uy.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Blog Post share dropdown.
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const Hy=({post:e,text:t,repostCount:n})=>{const a=(0,aa.C)((e=>e.personSettings?.vislvl)),s=(0,aa.C)((e=>e?.app?.person||{})),o=(0,aa.C)((e=>e?.auth?.user)),i=(0,aa.T)();let l,c;s?.bdate?(l=s?.id,c=s?.bdate):(l=o?.id,c=null);const m=(0,r.useRef)((({post:e,handleSharePost:t,text:n="",onOpenAuthForm:a,user:s,target:r,personVislvl:o})=>{const i=EE.ZP.getSharedPost(e),l=i.url||"";return[{name:"share",items:[{key:"repost",element:Zy,params:{classes:"mt-dropdown-menu__item post-sharer__item svg-share_repost",onSharePost:()=>{s?.id&&""!==l?(gd.shareEvent("share",i.id,EE.ZP.getViewCounterType(e)),t({repost:i,author:{id:s.id,name:s.display_name,image:s.photo_original||""},target:r,personVislvl:o})):a()}}},{key:"link",element:Xa,params:{className:"mt-dropdown-menu__item post-sharer__item svg-share_link",url:zE.Z.getCleanUrl(e.seo_url||e.url),text:"Скопировать ссылку на пост"}}]},{name:"social",title:"Поделиться в соцсетях:",items:[{key:"vk",element:$y,params:{classes:"mt-dropdown-menu__item post-sharer__item svg-share_vk",name:"vk",url:l,title:"Вконтакте",shareUrl:"https://vkontakte.ru/share.php?url=",text:n}},{key:"ok",element:$y,params:{classes:"mt-dropdown-menu__item post-sharer__item svg-share_ok",name:"ok",url:l,title:"Одноклассники",shareUrl:"https://connect.ok.ru/offer?url=",text:n}}]}]})({post:e,onOpenAuthForm:()=>i(_e("login")),handleSharePost:e=>{kt.Z.sendMessage({type:"MT_APP_SHOW_MT_POST_EDITOR",identifier:"default",postId:null,params:e})},text:t,user:o,target:{type:"user",id:l,birthday:c},personVislvl:a}));return r.createElement(r.Fragment,null,r.createElement(G.Z,{customDropdownClasses:"post-sharer post-actions__control",customListClasses:"post-sharer__list",buttonProps:{extraClasses:_()("post-actions__btn",n<1&&"post-actions__btn_empty"),icon:"share","data-test":`control-repost-${e.smi2_id||e.id}`},buttonValue:n>0?r.createElement("span",null,y.Z.formatViewsCounter(n,"eng")):"",hasMobileMode:!0,placement:"auto-left"},m.current.map((e=>r.createElement("div",{className:"mt-dropdown-menu__group",key:e.name},e.title&&r.createElement("h3",{className:"mt-dropdown-menu__group-title"},e.title),e.items.map((e=>{const t=e.element;return r.createElement(t,Uy({key:e.key},e.params))})))))))},Fy=(0,r.memo)(Hy),jy=({postId:e,topStatus:t})=>{const n=(0,aa.C)((e=>e.post2Top)),a=(0,aa.C)((e=>e?.app?.req?.isMobile)),s=(0,r.useRef)(null),o=(0,aa.T)(),i=n.posts?.[e],l=ws[(i||"")?.toLowerCase()],c=(0,aa.C)((e=>e?.app?.scope)),[m,d]=(0,r.useState)(!1);(0,r.useEffect)((()=>{o(Ss(e,t)),d(!0)}),[]);const{isActive:p,handleMouseEnter:u,handleMouseLeave:g,toggleActivity:h}=Py(a,{enter:300,leave:500});if(Ep(s,(()=>{a&&p&&h(!1)})),!b.ZP.isModerator()||!m)return null;return b.ZP.isModerator()&&"channel"===c?r.createElement("div",{ref:s,className:"post-actions__control",onMouseEnter:()=>{u()},onMouseLeave:()=>{g()}},r.createElement(ia.Z,{type:"button",className:_()({"post-actions__btn":!0,"post-actions__btn_empty":!0})},!l&&r.createElement(yn.Z,{iconName:"star-maybe"}),l&&r.createElement(qo.Z,{title:l.title,name:l.emoji,size:"sm"})),p&&r.createElement(oa.Z,{target:s.current,offset:[60,8],placement:"top-left",className:"tooltip-popup_noborder",enableMobile:!1},r.createElement("div",{className:"reactions-list"},Object.entries(ws).map((([t,n])=>r.createElement("button",{className:"reactions-list__btn",key:`reaction-${t}`,type:"button","data-reaction-name":t,onClick:()=>{o(Ps(e,n.status))},disabled:n.status===i},r.createElement(qo.Z,{title:n.title,name:n.emoji,size:"lg"}))))))):null},Gy=(0,r.memo)(jy),qy=({post:e,voteDisabled:t,commentsDisabled:n,shareDisabled:a,isCurrentPost:s,viewsDisabled:o,showViews:i})=>{const[l,c]=(0,r.useState)(!1),[m,d]=(0,r.useState)(0),[p,u]=(0,r.useState)(0),[g,h]=(0,r.useState)(!1),E=e.id||e.smi2_id;return(0,r.useEffect)((()=>{(async()=>{if(E&&l)try{const t=await qd.fetchMessageCount([{chatId:E,chatType:"mt"}]);let n;u(t?.[0]?.totalCount||0),n=e.smi2_id?await(Ct.Z.getInfo("smi2Post",e.smi2_id)?.["action:reposts"])||0:e.reposts||0,d(n)}catch(e){D.Z.promiseHandler("get counters info")(e)}})()}),[e,l]),(0,kr.O)("message",(t=>{if(!t?.data?.id)return;const n="smi2"===t.data.postType?e.smi2_id:e.id;if(t.data.id===n)switch(t.data.type){case"MT_APP_CHANGE_COMMENTS_COUNT":u((e=>e+t.data.count));break;case"MT_APP_CHANGE_REPOSTS_COUNT":d((e=>e+t.data.count))}})),r.createElement(qn,{onIntersection:([e])=>{!l&&e&&(c(e),setTimeout((()=>h(!0)),100))}},r.createElement("div",{className:"post-actions"},l&&!t&&r.createElement(Oy,{post:e}),l&&b.ZP.isModerator()&&r.createElement(Gy,{postId:e.id,topStatus:e.top_status}),g&&r.createElement(r.Fragment,null,!n&&r.createElement(Dy,{post:e,isCurrentPost:s,commentCount:p}),!a&&r.createElement(Fy,{post:e,repostCount:m}))),!o&&g&&r.createElement(gE,{id:e.id||e.smi2_id,counter:s?"force-all":"views",postType:EE.ZP.getViewCounterType(e),className:_()("post-views",!i&&"post-views_hidden")}))},Vy=(0,r.memo)(qy);
/**
 * Mirtesen.
 *
 * Blog Post Footer component.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class zy extends r.Component{constructor(e){super(e);const{blogPost:t}=this.props;this.referenceUrl=t.reference_url}handleSubscribe=e=>{const{onJoinToSite:t,onSubscribeToSite:n,onOpenAuthForm:a,app:s}=this.props;e.preventDefault(),pd.isLogged()?(t(s.site.id,!0),n(s.site.id,!0)):a("login")};render(){const{blogPost:e,isMember:t,isBlocked:n}=this.props;return r.createElement(r.Fragment,null,!t&&!n&&r.createElement("div",{className:_()({"blog-post__subscribe":!0})},r.createElement("p",{className:"blog-post__subscribe-text"},"Понравилась статья? Подпишитесь на канал, чтобы быть в курсе самых интересных материалов"),r.createElement("a",{href:"#",className:"btn btn-primary",onClick:e=>this.handleSubscribe(e)},"Подписаться")),r.createElement(by,{className:"blog-post-tags",tags:e.tags}),r.createElement("div",{className:"blog-post__footer"},r.createElement("div",{className:"post-controls"},r.createElement(Vy,{post:e,isCurrentPost:!0,showViews:!0}))),r.createElement(vy,{postId:e.id}))}}zy.propTypes={blogPost:f().oneOfType([f().object,f().array]),app:f().object,isMember:f().bool,isBlocked:f().bool,onJoinToSite:f().func,onSubscribeToSite:f().func,onOpenAuthForm:f().func};const Wy=zy,Yy=({blogPost:e})=>{const t=y.Z.cropImage2(L()(e,"images[0].url")),n=re.Z.getConfig();return r.createElement(r.Fragment,null,r.createElement("meta",{itemScope:!0,itemProp:"mainEntityOfPage",itemType:"https://schema.org/WebPage",itemID:(e.canonical_url||e.url).replace(/^\/\//,"https://"),content:""}),r.createElement("meta",{itemProp:"datePublished",content:e?.formattedDates?.iso}),r.createElement("meta",{itemProp:"dateModified",content:e?.formattedDates?.iso}),r.createElement("span",{itemScope:!0,itemType:"https://schema.org/Organization",itemProp:"publisher"},r.createElement("meta",{itemProp:"name",content:e?.group?.display_name}),r.createElement("span",{itemScope:!0,itemType:"https://schema.org/ImageObject",itemProp:"logo"},r.createElement("meta",{itemProp:"url",content:e?.group?.photo_original||`${n.staticHost}/images/mirtesen.jpg`}))),t&&r.createElement("meta",{itemProp:"image",content:t.replace(/^\/\//,"https://")}))};Yy.propTypes={blogPost:f().oneOfType([f().object,f().array])};const Ky=Yy,Jy=()=>{const[e,t]=(0,r.useState)([]);return(0,r.useEffect)((()=>{Tt.Z.getPersonEvents(null).then((e=>{const n=L()(e,"todayBirthdays[0].personList",[]);if("undefined"!=typeof window){const e=n.filter((e=>"1"!==window.sessionStorage.getItem(`congratulated_${e.id}`)));t(e)}}))}),[]),e.length>0&&r.createElement("div",{className:"birthday-widget"},r.createElement("h3",{className:"birthday-widget__title"},"Сегодня ",e.length>1?"празднуют":"празднует"," День рождения:"),r.createElement("ul",{className:"birthday-widget__list"},e.map((e=>r.createElement("li",{className:"birthday-widget__person",key:e.id},r.createElement(cg,{userId:e.id,tagName:"span"},r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo_original,logoUrl:zE.Z.addParameterToUrl(e.url,"birthday","true"),logoClassName:"userlogo_m",linkTarget:"_blank"}})),r.createElement("div",{className:"birthday-widget__person-info"},r.createElement("a",{href:zE.Z.addParameterToUrl(e.url,"birthday","true"),className:"birthday-widget__person-name",target:"_blank"},r.createElement(cg,{userId:e.id,tagName:"span"},e.display_name)),r.createElement("a",{href:zE.Z.addParameterToUrl(e.url,"birthday","true"),className:"btn btn-primary"},"Поздравить")))))))};Jy.propTypes={todayBirthdays:f().array};const Xy=(0,r.memo)(Jy),Qy={30017839255:{1:102705,2:102703,3:102706,4:102704,5:102707},30016741698:{1:102715,2:102714,3:102717,4:102716,5:102718},30021315535:{1:102720,2:102719,3:102722,4:102721,5:102723},30048760319:{1:102725,2:102724,3:102727,4:102726,5:102728},30050151971:{1:102730,2:102729,3:102732,4:102731,5:102733},30083331114:{1:102735,2:102734,3:102737,4:102736,5:102738},30083619923:{1:102740,2:102739,3:102742,4:102741,5:102743},30022462842:{1:102745,2:102744,3:102747,4:102746,5:102748},30055058200:{1:102750,2:102749,3:102752,4:102751,5:102753},30193447047:{1:102755,2:102754,3:102757,4:102756,5:102758}},ev=({app:e})=>r.createElement("div",{id:"right-column"},"blog"===e.scope&&r.createElement(n_,null),pd.isLogged&&r.createElement(Xy,null),r.createElement(o_,null),Qy[e?.site?.id]&&r.createElement(r.Fragment,null,r.createElement("iframe",{src:"/partner-iframe?id="+Qy[e?.site?.id][3],width:"305",height:"250",style:{overflow:"hidden"},scrolling:"no"}),r.createElement(Fh,{type:"Politpiar",id:Qy[e?.site?.id][4]})),!Qy[e?.site?.id]&&r.createElement(B_,{split:.4},r.createElement(R_,{adId:10080}),r.createElement(Fh,{type:"Politpiar",id:95129})),r.createElement(u_,{id:e.site.id}),Qy[e?.site?.id]&&r.createElement(Fh,{type:"Politpiar",id:Qy[e?.site?.id][5]}),!Qy[e?.site?.id]&&r.createElement(r.Fragment,null,r.createElement(Fh,{type:"Politpiar",id:99810}),r.createElement(h_,null,r.createElement(Fh,{position:"smi2RightBlock"}))));ev.propTypes={app:f().object,todayBirthdays:f().array};const tv=ev;
/**
 * Mirtesen.
 *
 * Blog Post Actions.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const nv=()=>async(e,t)=>{try{const n=t(),{topicKey:a,page:s,filter:r}=n.postTiles.blogPostBottom;let{posts:o}=n.postTiles.blogPostBottom;const i=s+1,l=ni.topicPostsOnPage,c=await Js.getBlogPostsByTopic({topic:a||"",offset:(i-1)*l,count:l,filter:r,withBusinessPosts:!1});o=[...o,...c],o=o.filter((e=>e.images.length>0)),o=K.Z.removeDuplicates(o),e({type:"POST_TILES_LOAD_MORE",id:"blogPostBottom",posts:o,hasMore:c.length>=l,page:i})}catch(e){D.Z.promiseHandler("/index.js")(e)}};var av=n(8664),sv=n(87229),rv="/index.js";
/**
 * Mirtesen.
 *
 * Vote Action Actions.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const ov=(e,t)=>n=>{const a=new jo;n({type:"ACTION_VOTE_IN_PROCESS",voteInProcess:!0,objectId:e}),Promise.all([a.vote(e,t)]).then((a=>(n(((e,t,n={likeType:null})=>a=>{a({type:"ACTION_VOTE_TOGGLE_VOTER_LIST",objectId:e,isVoteRateHover:t});const s=new jo;let{likeType:r}=n;if(r&&(r="up"===r?"LIKE_TYPE_LIKE":"LIKE_TYPE_DISLIKE"),!t)return a({type:"ACTION_VOTE_GET_VOTE_LIST",voteList:[],objectId:e,voteListIsLoaded:!1});Promise.all([s.getList(e,{offset:0,count:7,likeType:r,likeAttr:null})]).then((t=>a({type:"ACTION_VOTE_GET_VOTE_LIST",voteList:t[0],objectId:e,voteListIsLoaded:!0,likeType:r}))).catch((e=>{D.Z.promiseHandler(rv)(e)}))})(e,!0,{likeType:t>0?"up":"down"})),n({type:"ACTION_VOTE_VOTE",voteInProcess:!1,rate:a[0],voted:t,objectId:e})))).catch(D.Z.promiseHandler(rv))};
/**
 * Mirtesen.
 *
 * Card likes
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class iv extends r.PureComponent{componentDidMount(){const{object:e,initState:t}=this.props;t(e.id,e)}handleVote=e=>{const{userId:t,object:n,openAuthForm:a,onVote:s,widgetId:r}=this.props;return t?!!this.canVote(e)&&("0"===r&&gd.shareEvent("like",n.id,EE.ZP.getViewCounterType(n),e),s(n.id,e)):(a("login"),!1)};getVoteObject=()=>{const{actionVote:e,object:t}=this.props;return void 0===e[t.id]?li:e[t.id]};getVoteIcon=(e,t=!1,n=!1)=>{const a="scale(0.83)";return r.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{transform:n?a+"rotate(180deg)":a}},r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:t?"M10.6869 20.0281C11.9583 20.4946 13.3357 21 14.9956 21C20.3569 21 24.4144 8.5 20.3397 8.5H17.1108C16.2171 8.5 16.3492 7.79509 16.5726 6.87659C16.6336 6.62605 16.7013 6.42013 16.7676 6.2186C16.9443 5.6813 17.1108 5.17525 17.1108 3.93829C17.1108 2.23738 16.2402 1.00001 15.1231 1C14.0374 0.999992 13.7787 1.83303 13.474 2.81385C13.4652 2.8422 13.4564 2.87067 13.4475 2.89925C12.7317 5.19699 11.0107 8.02862 9.10075 9.71269C9.02968 9.78148 8.96414 9.84386 8.90339 9.90168C8.24193 10.5313 8.14927 10.6194 7.67616 12.5525C7.15961 14.663 6.99999 15.9459 7 17.25C7.00001 18.5541 7.36911 19.0172 9.10075 19.4937C9.6193 19.6364 10.1434 19.8287 10.6869 20.0281ZM4 10C2.89543 10 2 10.8954 2 12V17C2 18.1046 2.90924 19 4.01381 19C4.861 19 5.57013 18.3387 5.62893 17.4935C5.81549 14.8121 6.01557 13.3602 6.31166 12.1683C6.57881 11.0929 5.83179 10 4.72368 10H4Z":"M14.0841 0.536485C14.3864 0.374713 14.7276 0.299985 15.1011 0.299988C15.7325 0.299993 16.4523 0.421565 16.9845 1.00517C17.4967 1.56679 17.6979 2.40997 17.6979 3.49999C17.6979 4.08125 17.6049 4.70261 17.5008 5.2761C17.4564 5.5204 17.4116 5.74895 17.3688 5.96695C17.3056 6.28933 17.2469 6.58863 17.2009 6.88166C17.1292 7.33825 17.1165 7.6325 17.1439 7.79999H20.7474C21.4315 7.79999 21.9533 8.14508 22.2722 8.67725C22.5656 9.16678 22.68 9.79346 22.6975 10.4339C22.733 11.7282 22.3794 13.3855 21.765 14.9991C21.1482 16.6187 20.243 18.2622 19.1198 19.5143C18.0053 20.7566 16.5942 21.7 14.9739 21.7C13.6881 21.7 12.5704 21.419 11.5759 21.0901C11.1793 20.959 10.794 20.8172 10.4301 20.6833C10.3418 20.6508 10.2548 20.6188 10.1692 20.5875C9.72348 20.4246 9.31067 20.2795 8.90835 20.1685C8.10207 19.946 7.43821 19.6927 6.98305 19.2573C6.49428 19.977 5.67373 20.45 4.74229 20.45H4.49964C2.73243 20.45 1.29999 19.0172 1.29999 17.25V12.25C1.29999 10.4828 2.73243 9.04999 4.49964 9.04999H5.50646C6.49336 9.04999 7.27409 9.54126 7.75286 10.2495C7.99454 9.87975 8.27692 9.53071 8.60702 9.21035L8.6187 9.19901L8.6309 9.18822C10.4302 7.59759 12.0815 4.87993 12.7614 2.69155C12.7726 2.6555 12.7839 2.61866 12.7955 2.58114C12.9331 2.13431 13.1001 1.59214 13.3894 1.1715C13.5585 0.925457 13.7819 0.698182 14.0841 0.536485ZM7.80437 14.6906C7.91875 13.9262 8.04332 13.3091 8.18469 12.7623C8.21002 12.6643 8.23028 12.5656 8.24559 12.4665C8.52943 11.5954 8.95158 10.8311 9.571 10.2258C11.5764 8.44709 13.3521 5.5089 14.0983 3.10693L14.1006 3.09951C14.2708 2.55175 14.3792 2.20294 14.543 1.96469C14.6128 1.86309 14.6784 1.80631 14.7446 1.77086C14.8107 1.73549 14.9174 1.69999 15.101 1.69999C15.5838 1.69999 15.8124 1.79757 15.9501 1.94853C16.1078 2.12149 16.2979 2.5283 16.2979 3.49999C16.2979 3.94958 16.2245 4.46864 16.1233 5.02594C16.087 5.22554 16.0456 5.43772 16.0038 5.6516C15.9356 6.00051 15.8666 6.35393 15.8178 6.6646C15.7405 7.15721 15.6812 7.71539 15.792 8.17329C15.8513 8.41862 15.9726 8.69298 16.2195 8.90295C16.4736 9.11906 16.7816 9.19999 17.0835 9.19999H20.7474C20.8932 9.19999 20.9806 9.24552 21.0714 9.39694C21.1877 9.59101 21.2835 9.94089 21.2981 10.4723C21.3268 11.5218 21.0321 12.9895 20.4566 14.5009C19.8834 16.0063 19.057 17.4877 18.0777 18.5794C17.0895 19.6809 16.0272 20.3 14.9739 20.3C13.8966 20.3 12.9381 20.066 12.0155 19.7609C11.6431 19.6378 11.285 19.5061 10.9231 19.3729C10.8323 19.3395 10.7413 19.3061 10.6498 19.2726C10.2004 19.1084 9.74194 18.9461 9.28071 18.8189C8.42205 18.582 8.07763 18.3876 7.91696 18.211C7.79092 18.0725 7.69931 17.8564 7.6993 17.25C7.69929 16.4067 7.71784 15.5383 7.80437 14.6906ZM6.87675 12.1514C6.97527 11.2278 6.31593 10.45 5.50646 10.45H4.49964C3.50581 10.45 2.69999 11.2558 2.69999 12.25V17.25C2.69999 18.2442 3.50581 19.05 4.49964 19.05H4.74229C5.42084 19.05 5.9942 18.5204 6.05214 17.8272C6.16442 16.4841 6.28164 15.4129 6.41528 14.5136C6.46613 14.0258 6.5385 13.5371 6.64103 13.0577C6.70609 12.7534 6.7838 12.4503 6.87675 12.1514Z",fill:e}))};canVote=e=>{const t=this.getVoteObject();return!!t.canVote&&(!t.voteInProcess&&!(parseInt(t.voted,10)===parseInt(e,10)))};render(){const{isLight:e,object:t,actionVote:n}=this.props,a=Number(L()(n,`${t.id}.marksPluses`,0)),s=Number(L()(n,`${t.id}.marksMinuses`,0)),o=e?"#26292F":"#FFFFFF",i=this.getVoteObject()?.voted;return r.createElement(r.Fragment,null,r.createElement("div",{className:"post-tile__likes",style:{color:o}},r.createElement("div",{className:"post-tile__footer-item",onClick:()=>this.handleVote(1),id:`vote-${t.id}-up`},this.getVoteIcon(o,1===i),0!==a?r.createElement("div",{className:"post-tile__votes-count"},a):null),r.createElement("div",{className:"post-tile__footer-item",onClick:()=>this.handleVote(-1),id:`vote-${t.id}-down`},this.getVoteIcon(o,-1===i,!0),0!==s?r.createElement("div",{className:"post-tile__votes-count"},s):null)))}}iv.defaultProps={isLight:!1,tooltipPosition:"top-start"},iv.propTypes={userId:f().number,object:f().object,openAuthForm:f().func,onVote:f().func,initState:f().func,isLight:f().bool,tooltipPosition:f().string,actionVote:f().object,widgetId:f().string};const lv=ge.connect((0,i.$j)(((e,t)=>({actionVote:e.actionVote,userId:L()(e,"auth.user.id"),widgetId:t.widgetId})),((e,t)=>({initState:(t,n)=>{e(((e,t)=>n=>{n({type:"ACTION_VOTE_INIT_STATE",objectId:e,rate:t.likes.count,count:t.marks_count||null,voted:t.likes.user_likes,canVote:t.likes.can_like,marksPluses:t.likes.marks_pluses,marksMinuses:t.likes.marks_minuses})})(t,n))},openAuthForm:n=>{e(_e(n,t.widgetId))},onVote:(t,n)=>{e(ov(t,n))}})))(iv)),cv=({post:e,isLight:t=!1,textColorStyle:n="",commentUrl:a="",className:s=null,lastMessage:o={},commentCount:i=0,voterCount:l=0,userCount:c=0,enableLikes:m=!0,viewsEnabled:d=!0})=>r.createElement("div",{className:s},m&&r.createElement(lv,{isLight:t,object:e}),0!==Number(i)&&r.createElement("a",{className:"post-tile__footer-item",target:"_blank",href:a,style:{color:n},id:`comments-${e.id}`,onClick:e=>{e.preventDefault(),window.open(a,"_self")}},r.createElement("svg",{width:"20",height:"18",viewBox:"0 0 20 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",fill:n,d:"M9.8035 13.6H13.6842C15.8832 13.6 16.983 12.9634 17.5965 12.1675C18.27 11.2939 18.6 9.92594 18.6 8C18.6 5.44501 17.9456 3.90423 16.8789 2.9623C15.774 1.98672 13.9466 1.4 11.0526 1.4C7.8841 1.4 5.77468 1.99197 4.46685 3.05704C3.22171 4.07107 2.45263 5.72556 2.45263 8.5C2.45263 10.892 2.38943 13.3571 1.95187 15.8185L6.64895 14.1451C7.66156 13.7844 8.72855 13.6 9.8035 13.6ZM20 8C20 2.43431 17.1305 0 11.0526 0C4.46639 0 1.05263 2.42395 1.05263 8.5C1.05263 11.0512 0.97841 13.5857 0.477263 16.0822C0.315918 16.8859 1.0901 17.6117 1.86233 17.3365L7.11878 15.4639C7.98058 15.1569 8.88865 15 9.8035 15H13.6842C18.6528 15 20 12.0593 20 8Z"})),r.createElement("div",{className:"post-tile__votes-count",style:{color:n}},i)),0!==Number(l)&&r.createElement("a",{className:"post-tile__footer-item",target:"_blank",href:a,style:{color:n},id:`comments-${e.id}`,onClick:e=>{e.preventDefault(),window.open(a,"_self")}},r.createElement("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",fill:n,d:"M2.19999 0.999988C2.19999 0.613388 1.88659 0.299988 1.49999 0.299988C1.11339 0.299988 0.799988 0.613388 0.799988 0.999988V17C0.799988 17.3866 1.11339 17.7 1.49999 17.7C1.88659 17.7 2.19999 17.3866 2.19999 17V13.7L12 13.7C12.3866 13.7 12.7 13.3866 12.7 13C12.7 12.6134 12.3866 12.3 12 12.3L2.19999 12.3V9.69999L17 9.69999C17.3866 9.69999 17.7 9.38659 17.7 8.99999C17.7 8.61339 17.3866 8.29999 17 8.29999L2.19999 8.29999V5.7L9 5.7C9.3866 5.7 9.7 5.3866 9.7 5C9.7 4.6134 9.3866 4.3 9 4.3L2.19999 4.3V0.999988Z"})),r.createElement("div",{className:"post-tile__votes-count",style:{color:n}},l)),(o.text||""===o.text)&&r.createElement("div",{className:"post-tile__last-message",style:{color:n}},r.createElement(Mn.Z,{logoInfo:{userName:o.authorName,logoImg:o.authorAvatar,size:"bp",logoClassName:"post-tile__avatar"}}),r.createElement("span",null,o.text?y.Z.truncateString(o.text,25):r.createElement("span",{role:"img","aria-label":"camera"},"📷"))),0!==Number(c)&&r.createElement("div",{className:"post-tile__members",style:{color:n}},r.createElement("svg",{style:{fill:n,color:n},className:"svg-icon"},r.createElement("use",{href:"/images/icons.svg#group-member"})),y.Z.formatViewsCounter(c)),d&&r.createElement(gE,{id:e.id,className:"post-tile__views",style:{color:n,fill:n}}));cv.propTypes={post:f().object.isRequired,textColorStyle:f().string,isLight:f().bool,isPoll:f().bool,commentUrl:f().string,className:f().string,lastMessage:f().object,commentCount:f().number,userCount:f().number,enableLikes:f().bool,viewsEnabled:f().bool,voterCount:f().number};const mv=(0,r.memo)(cv),dv="EDITOR_STATUS_AUTHOR",pv="EDITOR_STATUS_SELECTED",uv="EDITOR_STATUS_NONE",gv=[{fontSize:"38px",lineHeight:"42px",max:10,wordLimit:8},{fontSize:"30px",lineHeight:"34px",max:30,wordLimit:10},{fontSize:"24px",lineHeight:"28px",max:50,wordLimit:16},{fontSize:"20px",lineHeight:"24px",max:1/0,wordLimit:1/0}],hv=({title:e,tileClasses:t,url:n,post:a,showModal:s,background:o,setImage:i,btnText:l,source:c={},enableModeration:m,isLight:d,lastMessage:p,commentCount:u,voterCount:g,userCount:h,commentUrl:E,viewsEnabled:f,enableLikes:b,hideStatus:v,onTogglePollVisibility:T,contextActionsType:S})=>{const P=e?y.Z.getStrSizeByLength(e,gv):{},w=d?"#2c2c2c":"#ffffff",{gradient:I,blurImage:C,imageUrl:N}=o,O=e=>{const{id:t,partner:n,topic:r}=a;if(L()(a,"partner.showInSingleWindow")&&r){const e=y.Z.toSlug((0,sv.Ro)(a.title)),n=`${a.url.split("/blog")[0]}/topic/${r}/${t}/${e}/tab`;window.open(n,"_blank")}else n&&s?s(a):window.open(e,"_blank");return!0},M={"post-tile__label":!0,"post-tile__label_none":a.editorStatus===uv||!a.editorStatus,"post-tile__label_selected":a.editorStatus===pv,"post-tile__label_author":a.editorStatus===dv},k="EDITOR_STATUS_AUTHOR"!==a.editorStatus?"Материал, выбранный редакторами Миртесен":"Эксклюзивный материал — специально для МирТесен";return r.createElement("div",{className:_()("post-tile",t)},C&&r.createElement(kn.Z,{tag:"div",className:"post-tile__img-blur",src:C,crossOrigin:"anonymous"}),N&&r.createElement(kn.Z,{className:"post-tile__img",src:N,alt:e,crossOrigin:"anonymous",setImage:i}),r.createElement("div",{className:"post-tile__gradient",style:{background:I}}),r.createElement("div",{className:"post-tile__info"},r.createElement("div",{className:"post-tile__header"},c.url&&r.createElement("a",{className:"post-tile__source",href:c.url,onClick:e=>e.stopPropagation(),target:"_blank"},r.createElement("i",{className:_()(M)},r.createElement("i",{className:"tooltip2"},k)),r.createElement("span",null,c.name),c.repostIcon&&r.createElement("span",null,r.createElement(yn.Z,{iconName:"repost"}),"поделился постом")),a.isBusiness&&r.createElement("span",{className:"post-tile__source"},r.createElement("i",{className:"post-tile__label post-tile__label_business"}),r.createElement("span",null,"ПРОМО")),m&&c.url&&r.createElement(ir,{type:S,post:a,color:d?"dark":"light"})),e&&r.createElement("a",{className:"post-tile__link",href:n,onClick:e=>{e.preventDefault(),O(n)},target:"_blank"},r.createElement("h3",{className:"post-tile__title",style:{...P,color:w}},y.Z.truncateString(e,110))),l&&r.createElement("a",{className:"post-tile__poll-link",href:n,target:"_blank"},l),r.createElement(mv,{post:a,isLight:d,textColorStyle:w,lastMessage:p,className:"post-tile__footer",commentUrl:E,commentCount:u,voterCount:g,userCount:h,enableLikes:b,viewsEnabled:f})),r.createElement("a",{className:"post-tile__wrapper-link",href:n,onClick:e=>{e.preventDefault(),O(n)},target:"_blank"}),v&&r.createElement("div",{className:"blog-post__deleted"},"hide"===v&&r.createElement(r.Fragment,null,"Опрос скрыт...",r.createElement("button",{className:"btn btn-primary",color:"primary",onClick:()=>{T(a.id,"restore")}},"Восстановить"))))};hv.propTypes={post:f().object,title:f().string,tileClasses:f().object,url:f().string,background:f().object,setImage:f().func,btnText:f().string,source:f().object,isLight:f().bool,lastMessage:f().object,commentCount:f().number,commentUrl:f().string,voterCount:f().number,userCount:f().number,viewsEnabled:f().bool,enableLikes:f().bool,showModal:f().func,enableModeration:f().bool,hideStatus:f().string,onTogglePollVisibility:f().func,contextActionsType:f().string},hv.defaultProps={post:{},isPoll:!1,hideStatus:"",isHiddenPost:!1,enableModeration:!0};const _v=(0,r.memo)(hv),Ev={BLACK:"#384049",GREEN:"linear-gradient(45deg, #45b649 0%, #dce35b 100%)",PINK:"linear-gradient(-135deg, #b5ffff 0%, #fca5f1 100%)",ORANGE:"linear-gradient(-134deg, #fee140 0%, #fa709a 100%)",BLUE:"linear-gradient(-134deg, #00f2fe 0%, #4facfe 100%)",WHITE:"linear-gradient(-135deg, #f2f2f2 0%, #748188 100%)",DEFAULT_HORIZONTAL:"linear-gradient(76.75deg, #5EB1FF 0%, #003F84 100.68%)",DEFAULT_VERTICAL:"linear-gradient(76.75deg, #5EB1FF 0%, #003F84 100.68%), linear-gradient(0deg, #1B1919, #1B1919), linear-gradient(44.52deg, #F87997 0.83%, #FCD857 100%)",EMPTY:"linear-gradient(180deg, rgba(0, 0, 0, 0) 71.67%, rgba(0, 0, 0, 0.53) 100%)"},fv="/images/fire-background.svg",bv=(e,t)=>t?"linear-gradient(90deg, "+e.rgba.replace(/,[\d.]+\)$/,",0.04)")+" 0%,"+e.rgba.replace(/,[\d.]+\)$/,",0.21)")+" 27%,"+e.hex+" 48.85%, "+e.hex+" 100%)":"linear-gradient(180deg, "+e.rgba.replace(/,[\d.]+\)$/,",0.04)")+" 0%,"+e.rgba.replace(/,[\d.]+\)$/,",0.21)")+" 27%,"+e.hex+" 64.33%, "+e.hex+" 100%)",yv=(e,t,n)=>e||"failed"===t?"failed"===t?(e=>e?`no-repeat url(${fv}), ${Ev.DEFAULT_HORIZONTAL}`:Ev.DEFAULT_VERTICAL)(n):bv(e,n):"",vv=(e,t,n,a)=>t||"failed"===e?"failed"===e?((e,t)=>t?`url(${fv}), ${Ev[e]}`:Ev[e])(a,n):bv(t,n):"",Tv=(e,t)=>{if(!e)return"";switch(t){case"text":return e.title||e.text;case"video":return L()(e,"attachments[0]video.title","");case"poll":return L()(e,"attachments[0]poll.title","");default:return""}},Sv=e=>{if(!e)return"";const t=L()(e,"attachments[0]",{});return e.title||e.text?"text":t.video?"video":t.poll?"poll":""},Pv=({post:e,imageUrl:t,isPoll:n,onTogglePollVisibility:a,dispute:s,hideStatus:o,isHiddenPost:i,enableModeration:l,showModal:c,isChat:m})=>{const[d,p]=(0,r.useState)(null),[u,g]=(0,r.useState)(null),[h,_]=(0,r.useState)("init"),[E,f]=(0,r.useState)(!1),b=(0,r.useRef)(null),v=(0,r.useRef)(null),T=(0,aa.C)((e=>e.auth?.user)),S=(0,aa.C)((e=>e.app.page));(0,r.useEffect)((()=>{if(!d){if(!t)return _("failed");if(u)0!==u.naturalHeight?P(u):(u.addEventListener("load",(()=>{P(u)})),u.addEventListener("error",(()=>{_("failed")})));else{const e=new Image;e.crossOrigin="Anonymous",e.addEventListener("load",(()=>{P(e)}),!1),e.addEventListener("error",(()=>{_("failed")})),e.src=y.Z.cropImage2(t)}}}),[t,d,u,h]),(0,r.useEffect)((()=>(v.current&&window.ResizeObserver&&(b.current=new window.ResizeObserver((([{borderBoxSize:e}])=>{const t=e[0].inlineSize;f(!(t<608))})),b.current.observe(v.current)),()=>{b.current&&b.current.disconnect()})),[]);const P=e=>{_("loaded");const t=(new av.Z).getColor(e,{algorithm:"simple"});t&&!t.error&&"#ffffff"!==t.hex&&p(t)},w=((e,t)=>t?"poll":{user_post:"userPost",user_post_rich:"userPost",post:"blogPost",chat:"chatPost"}[e.post_type])(e,n);let I,C=!0,N=!1;const O={post:e,showModal:c,setImage:g,onTogglePollVisibility:a,source:{url:"",name:"",repostIcon:""},lastMessage:{text:null,authorName:"",authorAvatar:""},enableModeration:l,enableLikes:!0,viewsEnabled:!0,hideStatus:o,background:{imageUrl:t,gradient:"",blurImage:""},title:"",url:"",voterCount:0,commentCount:0,userCount:0,btnText:"",commentUrl:"",tileClasses:{},isLight:!1,contextActionsType:""},M=EE.ZP.normalizeAuthor(e);switch(w){case"poll":{const t=L()(e,"attachments[0].poll");O.title=t?.title,O.source.name=M.display_name,O.source.url=M.url,O.voterCount=t.votes_counter,O.btnText="Голосовать",O.url=e.seo_url||e.url,O.background.gradient=vv(h,d,E,t.color_scheme.toUpperCase()),C="black"===t.color_scheme,O.contextActionsType=e.from?.id===T?.id?"poll-author":"poll-guest";break}case"userPost":if(I=Sv(e)||Sv(e.shared_post),O.title=Tv(e,I)||Tv(e.shared_post,I),O.source.repostIcon=Boolean(e.shared_post),O.source.name=M.display_name,O.source.url=M.url,O.url=e.seo_url||e.url,O.commentCount=e.comments_count,N=!O.title,"poll"===I){const t=L()(e,"attachments[0].poll")||L()(e,"shared_post.attachments[0].poll"),n=L()(t,"color_scheme","").toUpperCase();C="black"===n,O.background.gradient=vv(h,d,E,n)}else O.background.gradient=N?Ev.DEFAULT:yv(d,h,E);O.background.blurImage=N?t:"",O.enableModeration=e.from?.id===T?.id,O.contextActionsType="blogPost"!==S?"user-post-tile-guest":"blog-post-bottom-post-tile";break;case"chatPost":O.title=e.name,O.source.name="Чат",O.source.url=e.inviteUrl,O.url=e.inviteUrl,O.lastMessage={text:e.lastMessage?.text,authorAvatar:e.lastMessageAuthor?.avatar,authorName:e.lastMessageAuthor?.name},O.userCount=e.usersCount,O.background.gradient=((e,t,n,a)=>e||"failed"===t?"failed"===t?n?`no-repeat url(${fv}), ${Xp.Z.stringToColor(a)}`:Xp.Z.stringToColor(a):bv(e,n):"")(d,h,E,O.title),O.btnText="Присоединиться",O.enableLikes=!1,O.viewsEnabled=!1;break;default:{const t=fs.Z.getDisputePageUrl(e);O.title=e.title,O.source.name=M.display_name,O.source.url=M.url,O.commentCount=e.comments_count,O.url=s?t:e.seo_url||e.url,O.background.gradient=yv(d,h,E),O.commentUrl=t+"#comments",O.viewsEnabled=e?.group?.showSubscribersAmount,O.enableModeration=e.from?.id!==T?.id,O.contextActionsType="blogPost"!==S?"blog-post-tile-guest":"blog-post-bottom-post-tile"}}return O.tileClasses={"post-tile_fade":i,"post-tile_wide":E,"post-tile_empty":N,"post-tile_image":"loaded"===h},O.isLight=d?!d.isDark:!C,r.createElement("div",{ref:v},r.createElement(_v,O))};Pv.propTypes={post:f().object,imageUrl:f().string,showModal:f().func,hideStatus:f().string,isPoll:f().bool,onTogglePollVisibility:f().func,isHiddenPost:f().bool,enableModeration:f().bool,dispute:f().bool,isChat:f().bool},Pv.defaultProps={post:{},isPoll:!1,hideStatus:"",isHiddenPost:!1,enableModeration:!0};const wv=(0,r.memo)(Pv);function Iv(){return Iv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Iv.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Blogger Posts Slider.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const Cv=N((()=>Promise.all([n.e(526).then(n.t.bind(n,88667,23)),n.e(743).then(n.bind(n,83651))]).then((([e])=>e))),"reactIdSwiper"),Nv=[{fontSize:"30px",lineHeight:"44px",max:10,wordLimit:8},{fontSize:"28px",lineHeight:"32px",max:36,wordLimit:10},{fontSize:"24px",lineHeight:"28px",max:45,wordLimit:16},{fontSize:"20px",lineHeight:"24px",max:1/0,wordLimit:1/0}],Ov=({topicKey:e=null,dummyPost:t=null})=>{const[{posts:n,loaded:a},s]=(0,r.useState)({posts:[],loaded:!1});(0,r.useEffect)((()=>{Promise.resolve(e?Js.getTopicSettings(e,1e3,0):Xo.Z.getBloggers()).then((t=>{let n=[];if(e)n=t?.posts?.items;else{for(const e in t)if({}.hasOwnProperty.call(t,e)){const a=t[e],s={...a.blogPost,group:a.site};n.push(s)}n.sort(((e,t)=>{if(e.date&&t.date)return t.date-e.date}))}s({posts:n||[],loaded:!0})}))}),[]);if(!a)return null;if(a&&!n?.length&&t)return r.createElement(wv,t);const o=[];return n.forEach(((e,t)=>{if(e.title&&e.url&&e?.group?.photo_original&&e?.group?.display_name){const n=y.Z.getStrSizeByLength(e.title,Nv),a=r.createElement("div",{className:"swiper-slide",key:t},r.createElement("div",{className:"blogger-widget__slide"},r.createElement("div",{className:"blogger-widget__slide-head"},e?.group?.photo_original&&r.createElement("a",{target:"_blank",href:e?.group?.url},r.createElement(kn.Z,{src:e?.group?.photo_original,alt:e?.group?.display_name,crossOrigin:"anonymous"})),r.createElement("div",{className:"blogger-widget__slide-author"},r.createElement("div",null,"Блоги"),r.createElement("a",{target:"_blank",href:e?.group?.url},r.createElement("div",{className:"blogger-widget__slide-author-name"},y.Z.truncateString(e?.group?.display_name,25)),r.createElement(dy,{color:"light"})))),e.title&&r.createElement("a",{target:"_blank",href:e.url,className:"blogger-widget__slide-text",style:n},y.Z.truncateString(e.title,100)),e.url&&r.createElement("a",{target:"_blank",href:e.url,className:"blogger-widget__slide-more"},"Читать")));o.push(a)}})),r.createElement("div",{className:"blogger-widget"},r.createElement(Cv,Iv({},{pagination:{},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},loop:!0},{shouldSwiperUpdate:!0}),o))};Ov.propTypes={topicKey:f().string,dummyPost:f().object};const Mv=(0,r.memo)(Ov);
/**
 * Mirtesen.
 *
 * Ya RTB implementation for React.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class kv extends r.PureComponent{constructor(e){super(e);const{subCounter:t,rtbId:n}=this.props;this.containerId=`yandex_rtb_${n}`,t&&(this.containerId=`${this.containerId}_${t}`),this.state={isLoaded:!1}}componentDidMount(){const{disabled:e}=this.props;e||this.loadAd()}loadAd(){const{rtbId:e}=this.props;K.Z.lazyLoad((()=>window?.Ya?.Context?.AdvManager),(()=>{this.setState({isLoaded:!0}),window.Ya.Context.AdvManager.render({blockId:e,renderTo:this.containerId,async:!0}),console.log(`-- YaRTB ${e} rendered to ${this.containerId} --`)}),(()=>{console.log("Couldn't load Yandex RTB")}))}render(){const{className:e,disabled:t}=this.props;return t?null:r.createElement("div",{id:this.containerId,className:e})}}kv.defaultProps={disabled:!1},kv.propTypes={subCounter:f().number,rtbId:f().string,className:f().string,disabled:f().bool};const Av=kv;
/**
 * Mirtesen.
 *
 * Detector of appearance and disappearance of an element in a user window.
 * Works only with top border.
 *
 * @author       Alexey Duybo.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class xv extends r.Component{static propTypes={offsetTopToTrigger:f().number,delayTime:f().number,onAppear:f().func,onDisappear:f().func,appearOnly:f().bool};static defaultProps={offsetTopToTrigger:0,delayTime:400,onAppear:()=>null,onDisappear:()=>null,appearOnly:!0};constructor(e){super(e),this.element=r.createRef(),this.dom=new ky}componentDidMount(){document.addEventListener("scroll",this.throttleAppearHandler),this.appearHandler(),this.disappearHandler()}shouldComponentUpdate(){return!1}componentWillUnmount(){document.removeEventListener("scroll",this.throttleAppearHandler),document.removeEventListener("scroll",this.throttleDisappearHandler)}throttleAppearHandler=u()((()=>this.appearHandler()),this.props.delayTime);throttleDisappearHandler=u()((()=>this.disappearHandler()),this.props.delayTime);appearHandler(){const{onAppear:e,offsetTopToTrigger:t,appearOnly:n}=this.props,a=this.element.current;if(!a)return;this.dom.getOffsetByPage(a).y<window.pageYOffset+document.documentElement.clientHeight+t&&(document.removeEventListener("scroll",this.throttleAppearHandler),n||document.addEventListener("scroll",this.throttleDisappearHandler),e())}disappearHandler(){const{onDisappear:e}=this.props,t=this.element.current;if(!t)return;this.dom.getOffsetByPage(t).y+t.offsetHeight<window.pageYOffset&&(document.removeEventListener("scroll",this.throttleDisappearHandler),e())}render(){return r.createElement("span",{ref:this.element})}}const Lv=xv,Dv=({size:e,className:t="",children:n,style:a,id:s=null,onClick:o,onAppear:i})=>{const l={"topic-block":!0,"topic-block_md":2===e,"topic-block_lg":3===e,[t]:!0};return r.createElement("div",{className:_()(l),style:a,onClick:e=>(async(e,t)=>"function"!=typeof o||await o(e,t))(e,s)},n,r.createElement(Lv,{onAppear:()=>(async e=>"function"!=typeof i||await i(e))(s)}))};Dv.propTypes={size:f().number,children:f().node,className:f().string,style:f().object,id:f().number,onClick:f().func,onAppear:f().func};const Rv=Dv,Zv=({posts:e,hiddenPosts:t,topicKey:n="society",dispute:a,hasMore:s,onLoadMore:o,gridView:i,onShowModal:l,enableModeration:c})=>{let m=0,d=0,p=null;const[u,g]=(0,r.useState)("desktop");(0,r.useEffect)((()=>(window.addEventListener("resize",h),_(),()=>{window.removeEventListener("resize",h)})),[]);const h=()=>{p&&clearTimeout(p),p=setTimeout((()=>{_()}),80)},_=()=>{const e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;let t="desktop";e<616?t="mobile":e<1016&&(t="tablet"),g(t)},E={common:{desktop:[{type:"post",className:"double"},{type:"partnerBlock",className:"main-ad",params:{type:"Politpiar",id:95129}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"post"},{type:"post"},{type:"popularPosts"},{type:"partnerBlock",className:"double",params:{type:"Politpiar",id:99817}},{type:"post"},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"post"},{type:"partnerBlock",className:"double",params:{type:"Politpiar",id:99817}},{type:"post"},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"post"},{type:"partnerBlock",className:"double",params:{type:"Politpiar",id:99817}},{type:"post"},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"post"},{type:"partnerBlock",className:"double",params:{type:"Politpiar",id:99817}},{type:"post"},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"post"}],tablet:[{type:"post",className:"double"},{type:"partnerBlock",className:"main-ad",params:{type:"Politpiar",id:95129}},{type:"post"},{type:"post"},{type:"post"},{type:"partnerBlock",className:"double",params:{type:"Politpiar",id:99817}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"partnerBlock",className:"double",params:{type:"Politpiar",id:99817}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"partnerBlock",className:"double",params:{type:"Politpiar",id:99817}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"partnerBlock",className:"double",params:{type:"Politpiar",id:99817}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}}],mobile:[{type:"post"},{type:"partnerBlock",className:"main-ad",params:{type:"Politpiar",id:95129,style:{display:"flex",justifyContent:"center"}}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:99810,style:{display:"flex",justifyContent:"center"}}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:99810,style:{display:"flex",justifyContent:"center"}}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:99810,style:{display:"flex",justifyContent:"center"}}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:99810,style:{display:"flex",justifyContent:"center"}}},{type:"post"},{type:"partnerBlock",params:{type:"Politpiar",id:98072}},{type:"post"}]},postsOnly:{desktop:[{type:"post",className:"double"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"}],tablet:[{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"}],mobile:[{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"},{type:"post"}]}},f={common:{desktop:[{type:"post"}],tablet:[{type:"post"}],mobile:[{type:"post"}]},postsOnly:{desktop:[{type:"post"}],tablet:[{type:"post"}],mobile:[{type:"post"}]}},b=e=>{let t=L()(e,"images[0].url");if(t||(t=L()(e,"shared_post.images[0].url")),"chat"===e.post_type&&(t=e.avatar),!t){const n=L()(e,"attachments[0].poll.fileUri",null);t=y.Z.cropImage(n,1280)}if(!t){const n=L()(e,"shared_post.attachments[0].poll.fileUri",null);t=y.Z.cropImage(n,1280)}return t},v=e=>{if(!e)return null;const n=b(e),s=t.indexOf(e.id)>-1;return r.createElement(wv,{post:e,imageUrl:n,showModal:l,isHiddenPost:s,enableModeration:c,dispute:a})},T=(e,a)=>{if(!a)return null;d++;let s=null;if(!a)return null;switch(e.type){case"popularPosts":s=r.createElement(Mv,{topicKey:n,dummyPost:{post:a,imageUrl:b(a),showModal:l,isHiddenPost:t.indexOf(a.id)>-1,enableModeration:c}}),m++;break;case"partnerBlock":o=e.params,s=r.createElement(Fh,o);break;case"post":default:s=v(a),m++;break;case"adFox":s=r.createElement(R_,{adId:e.params.id,subCounter:d});break;case"yaRtb":s=r.createElement(Av,{rtbId:e.params.id,subCounter:d});break;case"component":s=e.component}var o;return s};return r.createElement(r.Fragment,null,r.createElement(zn,{loadMore:()=>o(),hasMore:s,threshold:800,loader:null},r.createElement("div",{className:"post-grid"},(e=>{if(!e)return null;let t=void 0!==E[i]?E[i]:E.common;return t=t[u]||t.desktop,t.map((t=>{const n=e[m],a=T(t,n);return a?r.createElement(Rv,{key:d,className:t.className,id:n?.id,onClick:async(e,n)=>("post"!==t.type||await vd(n),!0),onAppear:async e=>("post"!==t.type||await yd(e),!0)},a):null}))})(e),(e=>{if(!e)return null;let t=void 0!==f[i]?f[i]:f.common;return t=t[u]||t.desktop,(e=((e,t)=>{let n=e.length;if(n<t)return e;for(;n%t&&0!==n;)n--;return e.slice(0,n)})(e,t.length-1)).map(((e,n)=>{const a=n%t.length,s=t[a],o=T(s,e);return o?r.createElement(Rv,{key:n,className:s.className,id:e?.id,onClick:async(e,t)=>("post"!==s.type||await vd(t),!0),onAppear:async e=>("post"!==s.type||await yd(e),!0)},o):null}))})(e.slice(m+1)))),r.createElement(ty,null))};Zv.propTypes={posts:f().array,hasMore:f().bool,gridView:f().string,onShowModal:f().func,onLoadMore:f().func,hiddenPosts:f().array,enableModeration:f().bool,topicKey:f().string,dispute:f().bool},Zv.defaultProps={posts:[],hiddenPosts:[],hasMore:!0,gridView:"common",enableModeration:!0,onShowModal:()=>{},onLoadMore:()=>{}};const Bv=(0,r.memo)(Zv);function $v(){return $v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},$v.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Post Tiles Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class Uv extends r.PureComponent{constructor(e){super(e),this.handleGetMessage=this.handleGetMessage.bind(this)}componentDidMount(){window.addEventListener("message",this.handleGetMessage)}componentWillUnmount(){window.removeEventListener("message",this.handleGetMessage)}handleGetMessage(e){const{onHidePost:t}=this.props;"MT_APP_HIDE_POST"===e?.data?.type&&t(e.data.id,this.props.id)}render(){const{id:e,postTiles:t,isMobile:n}=this.props;return r.createElement(Bv,$v({},this.props,t[e]||Vc,{isMobile:n}))}}Uv.defaultProps={id:"default",gridView:"common",enableModeration:!0,topicKey:null,onShowModal:()=>{},onLoadMore:()=>{}},Uv.propTypes={id:f().string,postTiles:f().object,isMobile:f().bool,onHidePost:f().func,topicKey:f().string};const Hv=(0,i.$j)((e=>({isMobile:e.app?.isMobile,postTiles:e.postTiles})),(e=>({onHidePost:(t,n)=>{e(((e,t)=>({type:"POST_TILES_HIDE_POST",hiddenPost:e,id:t}))(t,n))}})))((0,ae.Z)(Uv,"postTiles"));var Fv=n(59671);const jv=({chatId:e,chatType:t,perPageLimit:n,firstPageLimit:a,showListTitle:s,messages:o,showBlacklistNotification:i})=>{const l=(0,r.useRef)(),[c,m]=(0,r.useState)(!1),d=void 0!==o;return(0,r.useEffect)((()=>{if("undefined"==typeof window)return;const r=l.current;c||sE.mountChatExternal({container:r,id:e,type:t,perPageLimit:n,firstPageLimit:a,showListTitle:s,inputId:`comment-reply${e}`,showInputGroup:!i,showBlacklistNotification:i,onLoad:()=>{const e=window.document.getElementById(zE.Z.getParameterByName("id",window.location.href));e&&e.focus(),m(!0)}})}),[c,e,t,n,a,s]),r.createElement(r.Fragment,null,!c&&d&&r.createElement(Fv.rN,{messages:o,embedded:!0}),r.createElement("div",{ref:l,id:`comment_widget_${e}`}))};jv.propTypes={messages:f().array,chatId:f().number,chatType:f().oneOf(["mt","smi2"]),perPageLimit:f().number,firstPageLimit:f().number,showListTitle:f().bool,showBlacklistNotification:f().bool};const Gv=(0,i.$j)((({v2Comments:e},{chatId:t,chatType:n})=>({messages:t?e[`${n}:${t}`]:Object.values(e)[0]})))(jv),qv=({blogPostId:e,disableComments:t=!1,showBlacklistNotification:n=!1,smi2Id:a=null,firstPageLimit:s=3,perPageLimit:o=20,showListTitle:l=!1,showImmediately:c=!1})=>{const[m,d]=(0,r.useState)(!1),p=(0,i.v9)((e=>e?.app?.req?.lightApp)),u=(0,i.v9)((e=>e?.app?.groupBlogPostsModule?.allowCommentVislvl||9));(0,r.useEffect)((()=>{c&&d(!0)}),[c]);let g=null,h=null;e?(g=e,h="mt"):a&&(g=a,h="smi2");return p||u===K.Z.allowLevels.none||t?null:r.createElement(r.Fragment,null,(c||m)&&r.createElement(Gv,{chatId:g,chatType:h,firstPageLimit:s,perPageLimit:o,showListTitle:l,showBlacklistNotification:n}),!c&&r.createElement(Lv,{onAppear:()=>{d(!0)},offsetTopToTrigger:600}))};qv.propTypes={blogPostId:f().number,firstPageLimit:f().number,perPageLimit:f().number,showListTitle:f().bool,disableComments:f().bool,lightApp:f().bool,allowCommentVislvl:f().number,smi2Id:f().number,showImmediately:f().bool,showBlacklistNotification:f().bool};const Vv=(0,ae.Z)((0,r.memo)(qv),"Comments");
/**
 * Mirtesen.
 *
 * Blog Post Container.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class zv extends r.Component{constructor(e){super(e),this.state={userScrolled:!1,isInterestingView:!1,isCatfish:null},this.setInterestingView=this.setInterestingView.bind(this)}componentDidMount(){const{blogPost:e,app:t}=this.props,{userScrolled:n}=this.state;setTimeout((()=>{this.initSpecialLinks()}),300),Td(e.id,t.req.query),setTimeout(this.setInterestingView,15e3);window.location.search.includes("catfish")?this.setState({isCatfish:!0}):this.setState({isCatfish:!1}),document.addEventListener("scroll",u()((()=>{n||this.setState({userScrolled:!0})}),80))}setInterestingView(){const{blogPost:e,app:t}=this.props,{isInterestingView:n}=this.state;n||(Sd(e.id,t.req.query),this.setState({isInterestingView:!0}))}initSpecialLinks=()=>{const e=window.location.search.replace(/^[?&]+|[?&]+$/,"");if(!window.location.search||!document.getElementsByClassName("blog-post__text")||0===document.getElementsByClassName("blog-post__text").length)return;[...document.getElementsByClassName("blog-post__text").item(0).getElementsByClassName("append-get-params")].forEach((t=>{const n=t.getAttribute("href");let a="";a=n.includes("?")?n+"&"+e:n+"?"+e,t.setAttribute("href",a)}))};render(){const{blogPost:e,app:t,siteBuilder:n,onJoinToSite:a,isMember:s,isBlocked:o,onSubscribeToSite:i,onOpenAuthForm:l,onShowMorePosts:c,user:m}=this.props,{userScrolled:d,isCatfish:p}=this.state,u=L()(t,"req.deviceType"),g=t.hideAdBlocks,h=e.id;return r.createElement("div",{className:_()({"blog-post-item":!0,"blog-post-item_tile":!0})},r.createElement("div",{id:"double-column-container"},"phone"!==u&&r.createElement(tv,{app:t}),r.createElement("div",{id:"content-column",className:"content-column"},r.createElement("div",{className:"adfox-top"},!Qy[t?.site?.id]&&"phone"!==u&&r.createElement(r.Fragment,null,r.createElement(Fh,{type:"Politpiar",id:99815}),r.createElement(Fh,{type:"Politpiar",id:99815})),Qy[t?.site?.id]&&"phone"!==u&&r.createElement(r.Fragment,null,r.createElement("iframe",{src:"/partner-iframe?id="+Qy[t?.site?.id][1],width:"305",height:"250",style:{overflow:"hidden"},scrolling:"no"}),r.createElement(Fh,{type:"Politpiar",id:Qy[t?.site?.id][2]}))),r.createElement("article",{className:"blog-post",id:`post_${h}`,key:h,itemScope:!0,itemType:"http://schema.org/NewsArticle"},r.createElement(Ky,{blogPost:e,app:t}),r.createElement(Ey,{blogPost:e,app:t,listTopics:Cd.listTopics,isMainPost:!0,user:m}),r.createElement(iy,{blogPost:e,siteBuilder:n}),e.reference_url&&r.createElement("div",{className:"blog-post__source"},r.createElement("a",{href:e.reference_url,target:"_blank"},"Ссылка на первоисточник")),r.createElement(Wy,{app:t,blogPost:e,isMember:s,isBlocked:o,onJoinToSite:a,onSubscribeToSite:i,onOpenAuthForm:l}),r.createElement(Lv,{onAppear:this.setInterestingView})),r.createElement(ay,{prevPostUrl:e.prevPostUrl,nextPostUrl:e.nextPostUrl}),r.createElement(Vv,{blogPostId:h,smi2Id:e.smi2_id,firstPageLimit:5,disableComments:e.close_comments,showBlacklistNotification:o}),r.createElement("div",{className:"adfox-outer blog-post-item__ad-block"},"phone"!==u?r.createElement(Fh,{type:"Politpiar",id:99816}):r.createElement(B_,{split:.3},r.createElement(R_,{adId:10092}),r.createElement(Fh,{type:"Politpiar",id:99812}))))),r.createElement("div",{className:"blog-post-bottom-partners"},r.createElement(Fh,{position:"smi2BottomBlock2"}),r.createElement(Fh,{position:"smi2BottomBlock4"})),d&&r.createElement("div",{className:"blog-post-bottom",onClick:()=>{na.ym("reachGoal","click_bottom_site_A")}},r.createElement(Hv,{topicKey:e.topicKey,onLoadMore:c,gridView:g?"postsOnly":"common",id:"blogPostBottom"})),r.createElement(Qb,null),r.createElement(ty,null),r.createElement(Jb,null),!0===p&&r.createElement(R_,{adId:10091}),!1===p&&r.createElement(B_,{split:.3},r.createElement(R_,{adId:10091}),r.createElement(Fh,{type:"Politpiar",id:100156})))}}zv.propTypes={onShowMorePosts:f().func,blogPost:f().oneOfType([f().object,f().array]),app:f().object,siteBuilder:f().object,isMember:f().bool,isBlocked:f().bool,onJoinToSite:f().func,onSubscribeToSite:f().func,onOpenAuthForm:f().func,user:f().object};const Wv=(0,i.$j)((e=>({isMember:e.app.site.is_member,isBlocked:e.app?.site?.isBlocked||!1,blogPost:e.blogPost,app:e.app,siteBuilder:e.app.siteBuilder,user:e.auth?.user})),(e=>({onJoinToSite:(t,n)=>{e(Au(t,n))},onSubscribeToSite:(t,n)=>{e(xu(t,n))},onOpenAuthForm:t=>{e(_e(t))},onShowMorePosts:()=>{na.ym("reachGoal","doscroll_site_A"),e(nv())}})))((0,ae.Z)(zv,"blogPost"));
/**
 * Mirtesen.
 *
 * Blog Post Container.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Yv extends r.Component{constructor(e){super(e),this.state={userScrolled:!1,isInterestingView:!1},this.setInterestingView=this.setInterestingView.bind(this)}componentDidMount(){const{blogPost:e,app:t}=this.props,{userScrolled:n}=this.state;Td(e.id,t.req.query),setTimeout(this.setInterestingView,15e3),document.addEventListener("scroll",u()((()=>{n||this.setState({userScrolled:!0})}),80))}setInterestingView(){const{blogPost:e,app:t}=this.props,{isInterestingView:n}=this.state;n||(Sd(e.id,t.req.query),this.setState({isInterestingView:!0}))}render(){const{blogPost:e,app:t,browserName:n,isBlocked:a}=this.props,s=L()(t,"req.deviceType"),o=e.seo_url||e.url,i=t.isMobile;let l=L()(e,"images[0].url");return l&&(l=y.Z.fixProtocol(y.Z.cropImage2(l,{browser:n}))),r.createElement("div",{className:_()({"blog-post-item":!0,"blog-post-item_tile":!0})},r.createElement("div",{id:"double-column-container"},"phone"!==s&&r.createElement(tv,{app:t,disableAd:!0}),r.createElement("div",{id:"content-column",className:"content-column"},i&&r.createElement(Fh,{type:"Politpiar",id:99819}),!i&&r.createElement(Fh,{type:"Politpiar",id:99815}),r.createElement("article",{className:"blog-post",id:`post_${e.id}`,key:e.id,itemScope:!0,itemType:"http://schema.org/NewsArticle"},r.createElement(Ky,{blogPost:e,app:t}),r.createElement(Ey,{blogPost:e,app:t,listTopics:Cd.listTopics,isMainPost:!0}),r.createElement("div",{className:"blog-post__text",itemProp:"articleBody"},l&&r.createElement("img",{className:"POST_IMAGE",alt:e.title,width:"620",height:"364",loading:"lazy",src:l}),r.createElement("p",{className:"blog-post__text",dangerouslySetInnerHTML:{__html:y.Z.truncateString2(y.Z.stripTags(e.text),100,".","")}}),r.createElement("div",{className:"messenger-block__link-to-post"},r.createElement("a",{href:o,className:"btn btn-primary",rel:"nofollow",target:"_blank"},"Вернуться к статье"))),r.createElement("div",{className:"blog-post__footer"},r.createElement("div",{className:"post-controls"},r.createElement(Vy,{post:e,isCurrentPost:!0,showViews:!0}))),r.createElement(vy,{postId:e.id}),r.createElement(Vv,{blogPostId:e.id,smi2Id:e.smi2_id,disableComments:e.close_comments,firstPageLimit:10,showImmediately:!0,showBlacklistNotification:a}),!i&&r.createElement(Fh,{type:"Politpiar",id:99816}),i&&r.createElement(Fh,{type:"Politpiar",id:99812}),r.createElement(Lv,{onAppear:this.setInterestingView})))),r.createElement(Qb,null),r.createElement(ty,null),r.createElement(Jb,null))}}Yv.propTypes={onShowMorePosts:f().func,blogPost:f().oneOfType([f().object,f().array]),app:f().object,isMember:f().bool,isBlocked:f().bool,onJoinToSite:f().func,onSubscribeToSite:f().func,onOpenAuthForm:f().func,browserName:f().string,disableVideo:f().bool};const Kv=(0,i.$j)((e=>({isMember:e.app?.site?.is_member,isBlocked:e.app?.site?.isBlocked,blogPost:e.blogPost,app:e.app,disableVideo:e.app.disableVideo,browserName:e.app.req.browser.name})),(e=>({onJoinToSite:(t,n)=>{e(Au(t,n))},onSubscribeToSite:(t,n)=>{e(xu(t,n))},onOpenAuthForm:t=>{e(_e(t))},onShowMorePosts:()=>{na.ym("reachGoal","doscroll_site_A"),e(nv())}})))((0,ae.Z)(Yv,"blogPostDispute"));function Jv(){return Jv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Jv.apply(this,arguments)}const Xv=N((()=>n.e(829).then(n.t.bind(n,23501,23))),"react-tag-autocomplete","ReactTags"),Qv={root:"react-tags",rootIsActive:"is-active",rootIsDisabled:"is-disabled",rootIsInvalid:"is-invalid",label:"react-tags__label",tagList:"react-tags__list",tagListItem:"react-tags__list-item",tag:"react-tags__tag",tagName:"react-tags__tag-name",comboBox:"react-tags__combobox",input:"react-tags__combobox-input",listBox:"react-tags__listbox",option:"react-tags__listbox-option",optionIsActive:"is-active",highlight:"react-tags__listbox-option-highlight"},eT={allowNew:!1,allowBackspace:!1,activateFirstOption:!1,delimiterKeys:["Enter","Tab"],deleteButtonText:"Кликните по тегу для его удаления",newOptionText:"",noOptionsText:"",collapseOnSelect:!0,placeholderText:"Добавить..."},tT=e=>e.map((e=>"string"==typeof e?{value:e,label:e}:{value:e?.id||e.text,label:e.text})),nT=({label:e="",placeholder:t="",icon:n="",helper:a="",tags:s=[],suggestions:o=[],onChangeInput:i,onDelete:l,onInput:c,onFocus:m,onResetSuggestions:d,params:p={},allowNew:u=!0})=>{const g=(0,r.useRef)(null),[h,_]=(0,r.useState)(""),E=(0,r.useCallback)((e=>{const t=e.label.trim();if(!t||s.findIndex((e=>t.toLowerCase()===e.toLowerCase()))>-1)return;const n=[...s,t];i(n),_(""),"function"==typeof d&&d()}),[i,s]),f=(0,r.useCallback)((e=>{if("function"==typeof l)l(e);else{const t=s.filter(((t,n)=>e!==n));i(t)}}),[l,i,s]),b=(0,r.useCallback)((e=>{_(e),e||"function"!=typeof d||d(),e&&"function"==typeof c&&c(e)}),[c,d]),y={listBox:o.length>0?"react-tags__listbox":"react-tags__listbox-hidden"};return r.createElement(Xv,Jv({ref:g,labelText:e,selected:tT(s),suggestions:tT(o),onDelete:f,onAdd:E,onFocus:()=>{"function"==typeof m&&m(g)},classNames:{...Qv,...y,root:"react-tags"},onInput:b,renderInput:({onKeyDown:e,...s})=>r.createElement(r.Fragment,null,r.createElement(Dr.Z,Jv({type:"text",icon:n,className:"input"},s,{value:h,placeholder:t||"Укажите теги",onKeyDown:t=>{"Enter"===t.key&&u&&(t.preventDefault(),E({label:h})),"function"==typeof e&&e(t)}})),a&&r.createElement("div",{className:"react-tags__helper"},a)),renderOption:({classNames:e,option:t,...n})=>{const a=[e.option,t.active?"is-active":"",t.selected?"is-selected":""];let s=t.label;const o=Pa.Z.isGeoTag(s);return s=Pa.Z.stripGeoId(s),r.createElement("div",Jv({className:a.join(" ")},n),r.createElement("div",null,o&&r.createElement(yn.Z,{iconName:"geo"}),r.createElement("span",null,s)),o&&r.createElement(sf,{tagId:t.value,display:"text"}))},renderTag:({classNames:e,tag:t,onClick:n})=>r.createElement(Gf,{htmlTag:"div",canDelete:!0,onDelete:n,text:t.label,icon:Pa.Z.isGeoTag(t.label)?"geo":void 0,extraClasses:e.tag})},eT,p))},aT=(0,r.memo)(nT),sT=()=>r.createElement("div",{className:"preloader__full-screen"},r.createElement("img",{src:"//static.mtml.ru/images/loader.svg",alt:"Загружается..."}));var rT="/index.js";
/**
 * Mirtesen.
 *
 * Blog Post Editor Actions.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const oT=K.Z.loadModule((()=>n.e(353).then(n.bind(n,88186))),"mt-polls"),iT=(e="")=>t=>{t({type:"BLOG_POST_EDITOR_COMPLETE",inProcess:!1}),t({type:"BLOG_POST_EDITOR_SHOW_ERROR",text:e})},lT=(e,t,n)=>a=>{if(t)return a({type:"BLOG_POST_EDITOR_SENT_TO_MODERATION"}),n();window.location.href="/blog/"+e},cT=(e=null,t=0)=>async(n,a)=>{const s=a()?.blogPostEditor||{},{foundPolls:r=[]}=s,{polls:o,hasMorePolls:i,newOffset:l}=await(async(e,t=0,n=30)=>{try{const a=b.ZP.getCurrentUserId();return await Mt.getPolls({query:e,authorId:a,offset:t,limit:n})}catch(e){D.Z.promiseHandler(rT)(e)}})(e,t);n({type:"BLOG_POST_EDITOR_SET_POLLS_SEARCH_RESULTS",foundPolls:t?[...r,...o]:o,foundPollsOffset:l,hasMorePolls:i})};var mT=n(20659),dT=n.n(mT);
/**
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const pT={onActivate:f().func,onAddUndo:f().func,onBeforeAddUndo:f().func,onBeforeExecCommand:f().func,onBeforeGetContent:f().func,onBeforeRenderUI:f().func,onBeforeSetContent:f().func,onBeforePaste:f().func,onBlur:f().func,onChange:f().func,onClearUndos:f().func,onClick:f().func,onContextMenu:f().func,onCopy:f().func,onCut:f().func,onDblclick:f().func,onDeactivate:f().func,onDirty:f().func,onDrag:f().func,onDragDrop:f().func,onDragEnd:f().func,onDragGesture:f().func,onDragOver:f().func,onDrop:f().func,onExecCommand:f().func,onFocus:f().func,onFocusIn:f().func,onFocusOut:f().func,onGetContent:f().func,onHide:f().func,onInit:f().func,onKeyDown:f().func,onKeyPress:f().func,onKeyUp:f().func,onLoadContent:f().func,onMouseDown:f().func,onMouseEnter:f().func,onMouseLeave:f().func,onMouseMove:f().func,onMouseOut:f().func,onMouseOver:f().func,onMouseUp:f().func,onNodeChange:f().func,onObjectResizeStart:f().func,onObjectResized:f().func,onObjectSelected:f().func,onPaste:f().func,onPostProcess:f().func,onPostRender:f().func,onPreProcess:f().func,onProgressState:f().func,onRedo:f().func,onRemove:f().func,onReset:f().func,onSaveContent:f().func,onSelectionChange:f().func,onSetAttrib:f().func,onSetContent:f().func,onShow:f().func,onSubmit:f().func,onUndo:f().func,onVisualAid:f().func},uT={apiKey:f().string,id:f().string,inline:f().bool,init:f().object,initialValue:f().string,onEditorChange:f().func,value:f().string,tagName:f().string,cloudChannel:f().string,plugins:f().oneOfType([f().string,f().array]),toolbar:f().oneOfType([f().string,f().array]),disabled:f().bool,textareaName:f().string,...pT},gT=e=>"function"==typeof e,hT=e=>e in pT,_T=(e,t,n)=>{(e=>Object.keys(e).filter(hT).filter((t=>gT(e[t]))).map((t=>({handler:e[t],eventName:t.substring(2)}))))(t).forEach((t=>{const a=n[t.eventName];gT(a)&&e.off(t.eventName,a);const s=n=>t.handler(n,e);n[t.eventName]=s,e.on(t.eventName,s)}))};let ET=0;const fT=e=>{const t=(new Date).getTime(),n=Math.floor(1e9*Math.random());return ET++,e+"_"+n+ET+String(t)},bT=e=>void 0===e||""===e?[]:Array.isArray(e)?e:e.split(" "),yT=()=>{const e="undefined"!=typeof window?window:n.g;return e&&e.tinymce?e.tinymce:null};
/**
 * Mirtesen.
 *
 * TinymceEditor integration for react.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const vT={listeners:[],scriptId:fT("tiny-script"),scriptLoaded:!1};class TT extends r.PureComponent{static propTypes=uT;static defaultProps={scriptUrl:"",plugins:"",toolbar:"",init:{},isDeveloper:!1};constructor(e){super(e),this.id=this.props.id||fT("tiny-react"),this.editor=null,this.currentContent=null,this.elementRef=r.createRef(),this.inline=this.props.inline?this.props.inline:this.props.init&&this.props.init.inline,this.boundHandlers={}}componentDidMount(){if(null!==yT())this.initialise();else if(this.elementRef.current&&this.elementRef.current.ownerDocument){const e=this.elementRef.current.ownerDocument;((e,t,n,a)=>{if(e.scriptLoaded)return a();e.listeners.push(a),t.getElementById(e.scriptId)||((e,t,n,a)=>{const s=t.createElement("script");s.referrerPolicy="origin",s.type="application/javascript",s.id=e,s.addEventListener("load",a),s.src=n,t.head&&t.head.appendChild(s)})(e.scriptId,t,n,(()=>{e.listeners.forEach((e=>e())),e.scriptLoaded=!0}))})(vT,e,"https://gamma.mirtesen.ru/jscripts/tinymce/tinymce.min.js?5.2.1",this.initialise)}}componentDidUpdate(e){this.editor&&this.editor.initialized&&(_T(this.editor,this.props,this.boundHandlers),this.currentContent=this.currentContent||this.editor.getContent(),"string"==typeof this.props.value&&this.props.value!==e.value&&this.props.value!==this.currentContent&&this.editor.setContent(this.props.value),"boolean"==typeof this.props.disabled&&this.props.disabled!==e.disabled&&this.editor.setMode(this.props.disabled?"readonly":"design"))}componentWillUnmount(){null!==yT()&&yT().remove(this.editor)}static defaultInit={relative_urls:!1,convert_urls:!1,remove_script_host:!1,language:"ru",paste_retain_style_properties:"",theme:"silver",statusbar:!1,force_p_newlines:!1,plugins:"autoresize link image code lists paste",file_browser_callback_types:"file image media",file_picker_types:"file image media",images_upload_url:null,file_picker_callback:(e,t,n)=>{const a=document.createElement("input");a.setAttribute("type","file"),a.setAttribute("accept","image/*"),a.onchange=function(){const t=this.files[0],n=new FileReader;n.onload=function(){const a="blobid"+(new Date).getTime(),s=tinymce.activeEditor.editorUpload.blobCache,r=n.result.split(",")[1],o=s.create(a,t,r);s.add(o);const i=new(dT());i.append("query","mutation {uploadPhoto {id, photo_original}}"),i.append("photo",o.blob());const l={project:"comments",body:i};(0,yt.Z)(l).then((n=>{if(!n)throw new Error("image bad response");const a=n.data.uploadPhoto.photo_original;e(a.replace(/\\\//g,"/"),{title:t.name})})).catch((e=>{ErrorHandler.promiseHandler("/index.js")(e)}))},n.readAsDataURL(t)},a.click()}};getValidElements=()=>{const{isDeveloper:e}=this.props;return[e?["@[id|class|style|title|dir<ltr?rtl|lang|xml::lang|onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup],"].join(""):["@[style|title],"].join(""),"a[rel|rev|charset|hreflang|tabindex|accesskey|type|","name|href|target|title|class|onfocus|onblur],strong/b,em/i,strike,u,","#p,-ol[type|compact],-ul[type|compact],-li,br,img[longdesc|usemap|","src|border|alt=|title|hspace|vspace|width|height|align],-sub,-sup,","-blockquote,-table[border=0|cellspacing|cellpadding|width|frame|rules|","height|align|summary|bgcolor|background|bordercolor],-tr[rowspan|width|","height|align|valign|bgcolor|background|bordercolor],tbody,thead,tfoot,","#td[colspan|rowspan|width|height|align|valign|bgcolor|background|bordercolor","|scope],#th[colspan|rowspan|width|height|align|valign|scope],caption,-div,","-span,-code,-pre,address,-h1,-h2,-h3,-h4,-h5,-h6,hr[size|noshade],-font[face","|size|color],dd,dl,dt,cite,abbr,acronym,del[datetime|cite],ins[datetime|cite],","object[classid|width|height|codebase|*],param[name|value|_value],embed[type|width","|height|src|*],map[name],area[shape|coords|href|alt|target],bdo,","button,col[align|char|charoff|span|valign|width],colgroup[align|char|charoff|span|","valign|width],dfn,fieldset,form[action|accept|accept-charset|enctype|method],","input[accept|alt|checked|disabled|maxlength|name|readonly|size|src|type|value],","kbd,label[for],legend,noscript,optgroup[label|disabled],option[disabled|label|selected|value],","q[cite],samp,select[disabled|multiple|name|size],small,","textarea[cols|rows|disabled|name|readonly],tt,var,big,","iframe[align|allowtransparency|frameborder|height|hspace|sandbox|scrolling|src|srcdoc|vspace|width|allow]"].join("")};getExtendedValidElements=()=>{const{isDeveloper:e}=this.props;return[e?"script[src|async|defer|type|charset],style":""].join("")};initialise=()=>{let{init:e,plugins:t}=this.props;const{toolbar:n,isDeveloper:a}=this.props;var s,r;e={...TT.defaultInit,...e},e.valid_elements=this.getValidElements(),e.extended_valid_elements=this.getExtendedValidElements(),a&&(e.valid_children="+body[style]"),s=e.plugins||"",r=t,t=bT(s).concat(bT(r));const o={...e,target:this.elementRef.current,readonly:this.props.disabled,inline:this.inline,plugins:t,toolbar:n||e.toolbar,contextmenu:!1,setup:t=>{this.editor=t,t.on("init",(e=>{this.initEditor(e,t)})),"function"==typeof e.setup&&e.setup(t)}};var i;null!==(i=this.elementRef.current)&&"textarea"===i.tagName.toLowerCase()&&(this.elementRef.current.style.visibility="");const l=yT();l.baseURL="https://gamma.mirtesen.ru/jscripts/tinymce",l.init(o)};initEditor(e,t){const n="string"==typeof this.props.value?this.props.value:"string"==typeof this.props.initialValue?this.props.initialValue:"";t.setContent(n),gT(this.props.onEditorChange)&&t.on("change keyup setcontent",(()=>{const e=t.getContent();e!==this.currentContent&&(this.currentContent=e,gT(this.props.onEditorChange)&&this.props.onEditorChange(this.currentContent,t))})),gT(this.props.onInit)&&this.props.onInit(e,t),_T(t,this.props,this.boundHandlers)}renderInline(){const{tagName:e="div"}=this.props;return r.createElement(e,{ref:this.elementRef,id:this.id})}renderIframe(){return r.createElement("textarea",{ref:this.elementRef,style:{visibility:"hidden"},name:this.props.textareaName,id:this.id})}render(){return this.inline?this.renderInline():this.renderIframe()}}const ST=TT,PT=N((()=>console.log("load polls")||n.e(353).then(n.bind(n,88186))),"mt-polls","MainForm"),wT=({addPoll:e,deletePoll:t,setPollTab:n,blogPostEditor:a=sl,searchPolls:s})=>{const{showPollEditor:o,pollTab:i,foundPolls:l,pollId:c,foundPollsOffset:m,hasMorePolls:d}=a;return r.createElement("div",{className:_()({"blog-post-editor__poll-settings":!0,"blog-post-editor__poll-settings_active":o})},r.createElement("svg",{className:"svg-icon large mt-post-editor__text-settings__close",onClick:()=>{t()}},r.createElement("use",{href:"/images/icons.svg#times-circle"})),"default"===i&&!c&&r.createElement(PT,{onAddPoll:t=>{e(t)}}),"default"===i&&c&&r.createElement(r.Fragment,null,r.createElement(_n,{pollId:c,postUrl:""})),"list"===i&&r.createElement(Qn,{foundPolls:l,hasMore:d,loadMorePolls:e=>{s(e,m)},searchPolls:s,attachPoll:t=>{e(t),n("default")}}),r.createElement(He.Z,{label:"Выбрать опрос...",type:"button",color:"secondary",onClick:()=>{n("list")}}))};wT.propTypes={blogPostEditor:f().object,addPoll:f().func,deletePoll:f().func,setPollTab:f().func,searchPolls:f().func};const IT=(0,i.$j)((e=>({blogPostEditor:e.blogPostEditor})),(e=>({addPoll:t=>{e((e=>t=>{t({type:"BLOG_POST_EDITOR_ADD_POLL",pollId:e})})(t))},deletePoll:()=>{e((e=>{e({type:"BLOG_POST_EDITOR_DELETE_POLL"})}))},setPollTab:t=>{e((e=>t=>{t({type:"BLOG_POST_EDITOR_SET_POLL_TAB",tab:e})})(t))},searchPolls:(t,n)=>{e(cT(t,n))}})))((0,r.memo)(wT)),CT=N((()=>Promise.all([n.e(186).then(n.t.bind(n,9198,23)),n.e(202).then(n.bind(n,44308))]).then((([e])=>e))),"reactDatepicker");class NT extends r.Component{constructor(e){super(e);const{blogPostEditor:t}=this.props;this.draftPage=t.draft,this.editPage=!!t.id,this.tz=c().tz.guess(),this.state={startDate:t.publishTime?c()(t.publishTime).tz(this.tz):c()().tz(this.tz),inputDate:t.publishTime?"custom":"now"}}componentDidMount(){const{onPreloaderToggle:e}=this.props;this.initDateСonversion(),e(!1)}handleChangeDate=e=>{const t=c()(e),{onChange:n}=this.props;this.setState({startDate:t}),n("publishTime",`"${t.tz(c().tz.guess()).format("DD.MM.YYYY HH:mm:00")}"`)};handleBlurDateInput=e=>{const{value:t}=e.target,n=c()(t,"DD.MM.YYYY HH:mm:00");n.isValid()&&c()().isBefore(n)&&this.handleChangeDate(n)};handleChangeTag=(e,t)=>{const{onAddTag:n,onDeleteTag:a,blogPostEditor:s}=this.props;e.checked?n(t):s.tags.map(((e,n)=>{e===t&&a(n)}))};handleSubmit=(e,t)=>{const{onChangeDraftValue:n,blogPostEditor:a,onErrorProcessing:s,onSave:r}=this.props;t.preventDefault();const o=a.title?.trim(),i=a.text?.trim();n(e),i&&o?r():(s("emptyTitle",!o),s("emptyText",!i))};handlePublishDateChange=e=>{const{onChange:t}=this.props,n=fs.Z.publishDates,{value:a}=e.target;this.setState({inputDate:a}),"custom"===e.target.value?t("publishTime",`"${this.state.startDate.format("DD.MM.YYYY HH:mm:00")}"`):t("publishTime",n[a].date)};initDateСonversion=()=>{const{onChange:e,blogPostEditor:t}=this.props,{publishTime:n}=t;if(n){e("publishTime",`"${c()(n).tz(this.tz).format("DD.MM.YYYY HH:mm:00")}"`)}};checkError(e){const{blogPostEditor:t}=this.props;return-1!==t.errors.indexOf(e)}render(){const{app:e,blogPostEditor:t}=this.props,n=!e.site.canAddPostWithoutApprove,{onChange:a,onErrorProcessing:s,onToggleDisableComments:o,onToggleDoFollow:i,onGetSuggestionsTags:l,onChangeTags:m,onTogglePoll:d,onResetTagSuggestions:p}=this.props,u=fs.Z.publishDates;return r.createElement("div",{className:"blog-post-editor"},t.preloaderVisible&&r.createElement(sT,null),!t.sentToModeration&&r.createElement(r.Fragment,null,r.createElement("h3",{className:"blog-post-editor__title"},this.editPage&&"Редактировать тему",!this.editPage&&"Добавить тему"),r.createElement("form",null,r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"blog-post-editor__title"},"Заголовок",r.createElement("span",{className:"blog-post-editor__required"},"*")),r.createElement("input",{type:"text",name:"title",id:"blog-post-editor__title",placeholder:"Заголовок...",className:_()("form-control",{"is-invalid":this.checkError("emptyTitle")}),value:t.title,onChange:e=>{""!==e.target.value.trim()&&s("emptyTitle",!1),a(e.target.name,e.target.value)}}),r.createElement("div",{className:"invalid-feedback"},fs.Z.errorsMap.emptyTitle)),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"blog-post-editor__text"},"Текст",r.createElement("span",{className:"blog-post-editor__required"},"*")),r.createElement(ST,{initialValue:t.text,isDeveloper:pd.isDeveloper(),init:{min_height:350,max_height:700,toolbar:"undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent blockquote | paste | removeformat | image code | typograf eyofixator",default_link_target:"_blank"},plugins:"typograf",onChange:e=>{""!==e.target.getContent().trim()&&s("emptyText",!1),a("text",e.target.getContent())}}),this.checkError("emptyText")&&r.createElement("div",{className:"blog-post-editor__invalid-feedback"},fs.Z.errorsMap.emptyText)),r.createElement("div",{className:"form-group blog-post-editor__poll"},r.createElement("div",{className:"blog-post-editor__content-type"},!t.id&&r.createElement("button",{type:"button",className:"content-type content-type_poll svg-poll",onClick:()=>{d(!0)}},"Опрос")),!t.id&&r.createElement(IT,null)),r.createElement("div",{className:"form-group blog-post-editor__keywords"},r.createElement("legend",null,"Ключевые слова"),r.createElement(aT,{helper:"Вы можете указать свои собственные теги. Используйте Tab или Enter чтобы завершить ввод",placeholder:"Введите 2 или более начальных символа...",tags:[...t.tags],suggestions:t.tagSuggestions,onInput:e=>{l(y.Z.disinfection(e))},onChangeInput:m,onResetSuggestions:p}),r.createElement("div",{className:"invalid-feedback"},"error")),r.createElement("div",{className:"form-group blog-post-editor__publish-date"},r.createElement("legend",null,"Опубликовать:"),r.createElement("div",{className:"blog-post-editor__publish-date__wrap"},r.createElement("select",{className:"form-control",type:"select",name:"select",value:this.state.inputDate,onChange:this.handlePublishDateChange},Object.keys(u).map(((e,t)=>r.createElement("option",{value:e,key:t},u[e].ru)))),"custom"===this.state.inputDate&&r.createElement(CT,{selected:this.state.startDate.toDate(),minDate:c()().tz(this.tz).toDate(),onChange:this.handleChangeDate,showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"dd.MM.yyyy HH:mm",timeCaption:"Время",onBlur:this.handleBlurDateInput}))),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"blog-post-editor__source-link"},"Ссылка на источник"),r.createElement("input",{type:"text",name:"referenceUrl",className:"form-control",id:"blog-post-editor__source-link",placeholder:"Ссылка на источник...",value:t.referenceUrl,onChange:e=>{a(e.target.name,e.target.value)}}),r.createElement("div",{className:"invalid-feedback"},"error")),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"form-check-label"},r.createElement("input",{className:"form-check-input",type:"checkbox",name:"disableComments",onChange:o,checked:t.disableComments})," ","Запретить комментарии"),pd.isDeveloper()&&r.createElement("label",{className:"form-check-label"},r.createElement("input",{className:"form-check-input",type:"checkbox",name:"dofollow",onChange:i,checked:t.doFollowLinks})," ","Прямые ссылки")),r.createElement("div",{className:_()("form-group",{"blog-post-editor__save":!0,"blog-post-editor__save_loading":t.inProcess})},t.errorMessage.isVisible&&r.createElement("div",{className:"blog-post-save-error"},t.errorMessage.text),r.createElement("div",{className:_()({"blog-post-save-load":!0,"blog-post-save-load_active":t.inProcess})},r.createElement("span",null,r.createElement("img",{src:"//static.mtml.ru/images/loader.svg",alt:"Загружается..."})),r.createElement("p",null,"Идет сохранение. ",r.createElement("br",null)," Пожалуйста, не перезагружайте страницу")),r.createElement("div",{className:"blog-post-editor__save-controls"},r.createElement(He.Z,{className:"blog-post-editor__submit",onClick:e=>{this.handleSubmit(!1,e)},label:n?"На модерацию":"Опубликовать",disabled:t.inProcess}),!n&&r.createElement(He.Z,{onClick:e=>{this.handleSubmit(!0,e)},label:this.draftPage?"Сохранить":"В черновики",disabled:t.inProcess}))))),t.sentToModeration&&r.createElement("div",{className:"blog-post-editor__moderation-message"},r.createElement("p",null,"Согласно правилам группы, ваш пост направлен на модерацию и появится на сайте в ближайшее время."),r.createElement("a",{href:"/",className:"btn btn-primary"},"OK")))}}NT.propTypes={app:f().object,blogPostEditor:f().object,onSave:f().func,onChange:f().func,onAddTag:f().func,onDeleteTag:f().func,onErrorProcessing:f().func,onToggleDisableComments:f().func,onToggleDoFollow:f().func,onChangeDraftValue:f().func,onGetSuggestionsTags:f().func,onPreloaderToggle:f().func,onChangeTags:f().func,onTogglePoll:f().func};const OT=(0,i.$j)((e=>({app:e.app,blogPostEditor:e.blogPostEditor})),(e=>({onTogglePoll:t=>{e((e=>({type:"BLOG_POST_EDITOR_TOGGLE_POLL",value:e}))(t))},onSave:()=>{e((async(e,t)=>{const n=new fs.Z;let a=t();const s=a.app.site.id,r=!a.app?.site?.canAddPostWithoutApprove,o=a.blogPostEditor,i=c().tz.guess();let l=o.publishTime;l&&(l=l.replace(/"/g,""),o.publishTime=c().tz(l,"DD.MM.YYYY HH:mm:00",i).format("DD.MM.YYYY HH:mm:00 ZZ"));try{let i=o.pollId;if(!o.id&&L()(a,"mtPoll.pollFormData.title")&&L()(a,"mtPoll.pollFormData.valid")){const[n,{createPoll:s}]=await Promise.all([b.ZP.getJwtAccessToken(),oT()]);if(await e(s(a.mtPoll.pollFormData,n)),a=t(),i=a.mtPoll?.poll?.id,!i)return void kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Ошибка при сохранении опроса"})}o.errorMessage.isVisible&&e({type:"BLOG_POST_EDITOR_HIDE_ERROR"}),e({type:"BLOG_POST_EDITOR_IN_PROCESS",inProcess:!0});const l={ed_arb_popup_url:o.pushBtnUrl,ed_arb_popup_text:o.pushBtnText,ed_arb_next_btn_url:o.nextBtnUrl,ed_pulse:o.pulse,ed_skip_nofollow:o.doFollowLinks};o.text="string"==typeof o.text?o.text.substring(0,9e4):o.text;const c={title:o.title,text:o.text,tags:o.tags,disableComments:o.disableComments,referenceUrl:o.referenceUrl,publishTime:o.publishTime,draft:o.draft,extraData:l};if(o.id){const t=await n.edit(o.id,c);t&&!t.errors&&t?.data?.editBlogPost?e(lT(o.id,r)):e(iT())}else{const t=await n.add(s,{...c,pollId:i}),a=t?.data?.addBlogPost?.id;if(t&&!t.errors&&a)e(lT(a,r,(()=>{"undefined"!=typeof window&&window.scrollTo(0,0)})));else{const n=t?.data?.addBlogPost?.errors,a=Array.isArray(n)&&"undefined"!==n[0].text?n[0].text:null;e(iT(a))}}}catch(t){e(iT()),D.Z.promiseHandler(rT)(t)}}))},onChange:(t,n)=>{e(((e,t)=>n=>{n({type:"BLOG_POST_EDITOR_CHANGE_VALUE",name:e,value:t})})(t,n))},onAddTag:t=>{var n;e((n=t,(e,t)=>{const a=t().blogPostEditor.tags;e({type:"BLOG_POST_EDITOR_CHANGE_TAGS",tags:[].concat(a,n)})}))},onDeleteTag:t=>{var n;e((n=t,(e,t)=>{let a=t().blogPostEditor.tags;a=a.filter(((e,t)=>t!==n)),e({type:"BLOG_POST_EDITOR_CHANGE_TAGS",tags:a})}))},onChangeTags:t=>{e((e=>({type:"BLOG_POST_EDITOR_CHANGE_TAGS",tags:e}))(t))},onErrorProcessing:(t,n)=>{e(((e,t)=>n=>{n({type:"BLOG_POST_EDITOR_ERROR_PROCESSING",name:e,adding:t})})(t,n))},onToggleDisableComments:()=>{e((e=>{e({type:"BLOG_POST_EDITOR_DISABLE_COMMENTS"})}))},onToggleDoFollow:()=>{e((e=>{e({type:"BLOG_POST_EDITOR_DO_FOLLOW"})}))},onChangeDraftValue:t=>{e((e=>t=>{t({type:"BLOG_POST_EDITOR_CHANGE_DRAFT_VALUE",value:e})})(t))},onGetSuggestionsTags:t=>{e((e=>async t=>{try{const n=await fp.Z.search(e,"TAGS");"undefined"!==n&&t({type:"BLOG_POST_EDITOR_CHANGE_SUGGESTIONS_DATA",tags:n.map((e=>({id:e.id,text:e.text}))),text:e})}catch(e){D.Z.promiseHandler(rT)(e)}})(t))},onPreloaderToggle:t=>{e((e=>t=>{t({type:"BLOG_POST_EDITOR_PRELOADER_TOGGLE",state:e})})(t))},onResetTagSuggestions:()=>{e({type:"BLOG_POST_EDITOR_RESET_SUGGESTIONS_DATA"})}})))((0,ae.Z)(NT,"blogPostEditor"));
/**
 * Mirtesen.
 *
 * Blog Post List Pagination Component.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class MT extends r.PureComponent{static defaultProps={hasMoreItems:!0,page:1,url:""};constructor(){super(),this.state={isLoaded:!1}}componentDidMount(){this.setState({isLoaded:!0})}render(){const{hasMoreItems:e,page:t,url:n}=this.props;let a=null;t+1>=2&&(a="page="+(t+1));let s=null;t-1>=2&&(s="page="+(t-1));let o=n;o=o.replace(/(?:[^a-z]+)page=\d+/i,""),o=o.replace(/&+$/,""),o=o.replace(/\?+$/,"");let i=o,l=o;return a&&(-1!==i.indexOf("?")?i+="&"+a:i+="?"+a),s&&(-1!==l.indexOf("?")?l+="&"+s:l+="?"+s),r.createElement("nav",{className:_()({pagination:!0,hidden:this.state.isLoaded})},r.createElement("ul",{className:"blog-post__pagination"},t>1&&r.createElement("li",null,r.createElement("a",{href:l},"Назад ")),r.createElement("li",null,"Страница: ",t," "),e&&r.createElement("li",null,r.createElement("a",{href:i},"Вперед"))))}}MT.propTypes={hasMoreItems:f().bool,page:f().number,url:f().string};const kT=MT;var AT="/index.js";
/**
 * Mirtesen.
 *
 * Blog Post List Actions.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const xT=(e,t)=>(n,a)=>{const s=a(),r=s.app.site.id,{tag:o,status:i,period:l,sort:c,before:m,after:d,page:p}=s.blogPostList,u={siteId:r,offset:e,count:t,tag:o,status:i,period:l,sort:c,fieldList:"list"};return"no_val2"===l&&(u.before=m,u.after=d),Promise.all([fs.Z.getBlogPostList(u)]).then((e=>{const t=e[0];return n({type:"BLOG_POST_LIST_GET_PAGE",blogPostList:[...s.blogPostList.blogPostList,...t],hasMoreItems:t.length>=Rp().postsPerPage,page:p+1})})).catch(D.Z.promiseHandler(AT)),n({type:"BLOG_POST_LIST_DEFAULT"})},LT=()=>async(e,t)=>{const n=t(),{searchValue:a,search:{page:s}}=n.blogPostList,r=n.app?.site?.id;if(a){e({type:"BLOG_POST_LIST_TOOGLE_SEARCH_LOADING",isLoading:!0});try{const t=await fp.Z.search(a,"BLOG_POSTS_BY_BLOG",{offset:s*Rp().recordsPerPage,count:Rp().recordsPerPage,ownerId:r});return e({type:"BLOG_POST_LIST_GET_SEARCH_RESULTS",page:s+1,results:t,hasMore:t.length>=Rp().recordsPerPage}),e({type:"BLOG_POST_LIST_TOOGLE_SEARCH_LOADING",isLoading:!1})}catch(t){e({type:"BLOG_POST_LIST_TOOGLE_SEARCH_LOADING",isLoading:!1}),D.Z.promiseHandler(AT)(t)}}},DT=N((()=>Promise.all([n.e(186).then(n.t.bind(n,9198,23)),n.e(202).then(n.bind(n,44308))]).then((([e])=>e))),"reactDatepicker");class RT extends r.PureComponent{handleChangeDate=(e,t)=>{const n=c()(e),{blogPostList:a,onChangePeriod:s}=this.props;a[t]=n.tz(c().tz.guess()).format("YYYY-MM-DD");const{before:r,after:o}=a;this.changePeriodGetParam(`${o}__${r}`),s(o,r)};handleClick=e=>{const{period:t}=this.props.blogPostList;if(`${t}`===e)return null;let n=fs.Z.listOfPeriods[e].short;if("period"===n){const{before:e,after:t}=this.props.blogPostList;n=`${t}__${e}`}this.changePeriodGetParam(n),this.props.handleChangePeriod(e)};getClass=e=>{const{period:t}=this.props.blogPostList;return`${t}`===e?"btn btn-primary":"btn btn-secondary"};changePeriodGetParam(e){e="period="+e;let t=window.location.href;t=t.replace(/\?.*/,""),t=t+"?"+e,window.history.pushState(null,"",t)}render(){const{before:e,after:t,period:n}=this.props.blogPostList;return r.createElement("div",{className:"period__button-group btn-group",role:"group"},Object.keys(fs.Z.listOfPeriods).map((e=>r.createElement("button",{key:e,className:this.getClass(e),onClick:()=>this.handleClick(e)},fs.Z.listOfPeriods[e].title))),"no_val2"===n?r.createElement("div",{className:"stat__pickers"},r.createElement("span",{className:"stat__pickers__picker"},"От: ",r.createElement(DT,{timeFormat:"HH:mm",timeIntervals:60,dateFormat:"dd.MM.yyyy",timeCaption:"Время",onChange:e=>this.handleChangeDate(e,"after"),selected:c()(t).toDate()})),r.createElement("span",{className:"stat__pickers__picker"},"До: ",r.createElement(DT,{timeFormat:"HH:mm",timeIntervals:60,dateFormat:"dd.MM.yyyy",timeCaption:"Время",onChange:e=>this.handleChangeDate(e,"before"),selected:c()(e).toDate()}))):null)}}RT.propTypes={blogPostList:f().object,onChangePeriod:f().func,handleChangePeriod:f().any};const ZT=(0,i.$j)((e=>({blogPostList:e.blogPostList})),(e=>({handleChangePeriod:t=>{e((e=>t=>{t({type:"BLOG_POST_LIST_CHANGE_PERIOD",period:e}),t(xT(0,Rp().postsPerPage))})(t))},onChangePeriod:(t,n)=>{e(((e,t)=>n=>{n({type:"BLOG_POST_LIST_SET_PERIOD",after:e,before:t}),e<t&&n(xT(0,Rp().postsPerPage))})(t,n))}})))(RT),BT=({item:e})=>{const{formattedDates:{iso:t=null}}=e;return r.createElement(dE,{className:"article-list-item"},r.createElement("div",{className:"article-list-item__header"},r.createElement("a",{href:Xo.Z.addMirtesenKeyToUrl(e?.group?.url,b.ZP.getMirtesenKey()),className:"article-list-item__source",target:"_blank"},r.createElement(Mn.Z,{logoInfo:{userName:e?.group?.display_name||e?.group?.name,logoImg:e?.group?.photo_original,logoClassName:"userlogo_l2",size:"av80"}}),r.createElement("div",{className:"article-list-item__source-info"},r.createElement("span",{className:"article-list-item__name"},e?.group?.display_name||e?.group?.name),t&&r.createElement("span",{className:"article-list-item__pubdate"},r.createElement(s_,{date:t,format:"DD.MM.YYYY"}))))),r.createElement("a",{href:Xo.Z.addMirtesenKeyToUrl(e.url,b.ZP.getMirtesenKey()),className:"article-list-item__text",target:"_blank"},e.title&&r.createElement("h4",{dangerouslySetInnerHTML:{__html:e.title}}),r.createElement("p",{dangerouslySetInnerHTML:{__html:e.preview_text}})))};BT.propTypes={item:f().object};const $T=(0,r.memo)(BT),UT={repost:{label:"Репост публикации",iconName:"repost-2"},friendReaction:{label:"Ваш друг отреагировал на этот пост",iconName:"logo-xs"},recommendation:{label:"Рекомендовано на основе ваших интересов",iconName:"logo-xs"}},HT=({type:e})=>r.createElement("div",{className:"post-card__label"},UT[e]?.iconName&&r.createElement(yn.Z,{iconName:UT[e]?.iconName}),r.createElement("span",null,UT[e].label)),FT=(0,r.memo)(HT);n(46325);
/**
 * Mirtesen.
 *
 * User logo. (If there is no logo, the background with initials will be shown)
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const jT=["//static.mtml.ru//images/blank_male_med.gif","//static.mtml.ru//images/blank_female_med.gif","//static.mtml.ru/images/blank_male.gif","//static.mtml.ru/images/blank_femail.gif"],GT=(e="")=>"string"!=typeof e||""===e?"":(e?.[0]||"").toUpperCase(),qT=({logoInfo:e,className:t=""})=>{const{userName:n,logoImgSrc:a="",logoUrl:s="",linkTarget:o="",logoClassName:i="",title:l,size:c}=e,{firstName:m="",lastName:d=""}=(e=>{let t,n;if(Array.isArray(e)&&(t=e[0],n=e.length>1?e[e.length-1]:""),"string"==typeof e){const a=e.split(" ");t=a[0],n=a.length>1?a[a.length-1]:""}return{firstName:t,lastName:n}})(n),p=((e,t)=>{for(const n of t)if(!e||e.indexOf(n)>-1)return null;return e})(a,jT),u=_()({userlogo:!0},i.split(","),t.split(",")),g=s?"a":"span",h=p?{backgroundImage:`url(${p})`}:{background:Xp.Z.getHSLGradientByName(m)};return p?r.createElement(kn.Z,{tag:g,className:u,href:s,style:h,alt:l,target:o,size:c||"av48",src:p}):r.createElement(g,{className:u,href:s,style:h,title:l,target:o},!p&&((e="",t="")=>e||t?t?e?GT(e).concat(GT(t)):GT(t):GT(e):"")(m,d))},VT=(0,r.memo)(qT),zT=({name:e,isVerified:t,showItemProp:n})=>r.createElement("div",{className:"post-author"},r.createElement("span",{itemProp:n?"author":void 0},e),t&&r.createElement(yn.Z,{iconName:"verified"})),WT=(0,r.memo)(zT),YT=6e4,KT=60*YT,JT=24*KT,XT=30*JT,QT=365*JT,eS=({date:e,queuedDate:t,isQueued:n,isDraft:a,className:s="",href:o,target:i,onClick:l})=>{let c;c=null===e?"":a?"черновик":n?K.Z.getLocalDate(t||"","D MMM, H:mm"):(e=>{let t;switch(!0){case e<YT:t=`${Math.floor(e/1e3)} с.`;break;case e<KT:t=`${Math.floor(e/YT)} мин.`;break;case e<JT:t=`${Math.floor(e/KT)} ч.`;break;case e<XT:t=`${Math.floor(e/JT)} д.`;break;case e<QT:t=`${Math.floor(e/XT)} мес.`;break;default:t=`${Math.floor(e/QT)} ${y.Z.num2string(Math.floor(e/QT),["г","г","л"])}.`}return t})(Math.max(Date.now()-1e3*e,0));const m=o?"a":"span";return r.createElement(m,{href:o,className:_()("pubdate",n&&"pubdate_queued",s),target:i,onClick:l},c&&r.createElement(r.Fragment,null,n&&t&&r.createElement(yn.Z,{iconName:"clock"}),c))},tS=(0,r.memo)(eS),nS=({location:e,extraClasses:t})=>r.createElement("div",{className:_()("geotag",t)},r.createElement(yn.Z,{iconName:"geo"}),r.createElement("span",null,e)),aS=(0,r.memo)(nS);var sS="/index.js";
/**
 * Mirtesen.
 *
 * Reasons for showing actions
 *
 * @author       Olga Efimova
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const rS=(e,t)=>({type:"REASONS_FOR_SHOWING_TOGGLE_PROCESS",objectId:e,value:t}),oS=(0,r.memo)((({iconClasses:e,postId:t,siteId:n,isStaff:a,showAuthorType:s,defaultItem:o})=>{const i=(0,aa.C)((e=>e?.app?.req?.isMobile)),l=(0,aa.C)((e=>e.reasonsForShowing[t])),{items:c=[],inProcess:m}=l||{},d=c.slice(0,3),p=(0,r.useRef)(null),u=(0,aa.T)(),{isActive:g,handleMouseEnter:h,handleMouseLeave:_,toggleActivity:E}=Py(i,{enter:0,leave:300});return(0,r.useEffect)((()=>{g&&!l&&u(((e,t,n)=>async a=>{try{let s=await qa.Z.getDetailedReasonForShowing(e)||[];s=s.filter((e=>"author"!==e.attribute_type||n)),!s.length&&t&&s.push(t),a({type:"REASONS_FOR_SHOWING_INIT",objectId:e,items:s})}catch(e){D.Z.promiseHandler(sS)(e)}})(t,o,s))}),[g,l,o,s]),r.createElement("div",{className:"showing-reasons-wrapper",onMouseEnter:h,onMouseLeave:_,ref:p},r.createElement("i",{className:e,onClick:()=>{i&&E(!0)}},r.createElement(yn.Z,{iconName:"info"})),g&&r.createElement(oa.Z,{target:p.current,offset:[-20,10],placement:"bottom-center",className:"showing-reasons-tooltip",enableMobile:!0,onClose:()=>{i&&E(!1)}},r.createElement("div",{className:"showing-reasons"},r.createElement("h5",{className:"showing-reasons__title"},r.createElement(yn.Z,{iconName:"info-invert"}),r.createElement("span",null,"Почему я это вижу?")),r.createElement("p",{className:"showing-reasons__text"},!l||d?.length>0?"На основании ваших действий мы определили ваши интересы:":"Мы учтем ваши пожелания в рекомендациях"),d.length>0&&r.createElement("ul",{className:"showing-reasons__list"},d.map((e=>e?r.createElement("li",{className:"showing-reasons__item",key:e.attribute_id},r.createElement("i",null,(e=>{switch(e.attribute_type){case"tag":default:return"#";case"author":case"site":return r.createElement(VT,{logoInfo:{userName:e.text,logoImgSrc:e.image,logoClassName:"showing-reasons__logo"}});case"topic":return e.icon}})(e)),r.createElement("span",{className:"showing-reasons__item-text ellipsis"},"tag"===e.attribute_type?Pa.Z.stripGeoId(e.text):e.text),("subscribe"!==e.class||!a)&&r.createElement(He.Z,{label:"subscribe"===e.class?"Отписаться":"Неинтересно",extraClasses:"showing-reasons__btn",color:i?"secondary":"empty",onClick:a=>{a.stopPropagation(),u(((e,t,n)=>async a=>{try{let s;if(a(rS(t,!0)),"manual"===e.class)s=await qa.Z.setInterest(e.attribute_type,e.attribute_id,!1);else if("social"===e.class)s=await qa.Z.setInterest(e.attribute_type,e.attribute_id,!1);else if("auto"===e.class){const[t]=await Promise.all([qa.Z.deleteAutoInterest(e.attribute_type,e.attribute_id),qa.Z.setInterest(e.attribute_type,e.attribute_id,!1)]);s=t}else if("subscribe"===e.class&&n){const e=new Cu;s=await e.joinToSite(n,!1)}s?(a({type:"REASONS_FOR_SHOWING_DELETE_INTEREST",objectId:t,interestId:e.attribute_id}),"subscribe"===e.class&&a({type:"ACTION_JOIN_TO_SITE",isMember:!1,success:s}),a(rS(t,!1))):(a(rS(t,!1)),kt.Z.sendMessage("exception"))}catch(e){a(rS(t,!1)),kt.Z.sendMessage("exception"),D.Z.promiseHandler(sS)(e)}})(e,t,n))},disabled:m})):null))),r.createElement("a",{href:"/settings/interests",className:"showing-reasons__link"},"Настроить интересы..."))))})),iS=(0,ae.Z)(oS,"ReasonsForShowing");function lS(){return lS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},lS.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Post card Header
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const cS=({post:e,nonFriendPostIds:t,isCurrentPost:n,geoTagEnabled:a,extraClasses:s,subscribeButtonEnabled:o,postLabelEnabled:i,reasonsForShowingEnabled:l,onPubDateClick:c})=>{const m=(0,Op.E)(),d=i&&((e,t)=>{const{id:n,shared_post:a}=e;return a?"repost":t&&t.indexOf(n)>-1?"friendReaction":null})(e,t),{group:p,place:u,is_draft:g,is_queued:h,publish_time:E,date:f}=e,{id:y,is_staff:v}=p||{},T=EE.ZP.normalizeAuthor(e);if(!T?.id&&!e.smi2_id)return null;const{url:S,photo_original:P,id:w,isAuthenticAccount:I,canViewBlogPostCreator:C}=T||{},N=Fp.addUtmToUrl(e.seo_url||e.url),O=Fp.addUtmToUrl(S),M=T.display_name||T.name,k="_self",A=EE.ZP.showUserCardSwitcher(e),x=A?cg:"a",L=I||Fp.isSiteMatch("verifiedBlogs"),D=e=>{e.preventDefault(),window.open(Fp.addMirtesenKeyToUrl(O,b.ZP.getMirtesenKey()),k)},R={class:"manual",attribute_type:"site",attribute_id:y,text:M,image:P};return r.createElement("div",{className:_()("post-card__header",s)},d&&r.createElement(FT,{type:d}),r.createElement("div",{className:"post-card__header-bottom"},r.createElement(x,lS({className:"post-card__logo",onClick:D,href:O,target:k},((e,t)=>t?{userId:e,tagName:"a"}:{})(w,A)),r.createElement(VT,{logoInfo:{userName:M,logoImgSrc:P}})),r.createElement("div",{className:"post-card__info-wrap"},r.createElement("div",{className:"post-card__post-info"},r.createElement(x,lS({className:"post-card__author",href:O,target:k,onClick:D},((e,t)=>t?{userId:e}:{})(w,A)),r.createElement(WT,{name:M,isVerified:L,showItemProp:n})),r.createElement(tS,{date:m?f:null,isQueued:h,isDraft:g,queuedDate:E,className:"post-card__pubdate",href:N,target:"_self",onClick:c}),o&&r.createElement(r.Fragment,null,"post"===e.post_type&&r.createElement($u,{siteId:y,isMini:!0,extraClasses:"post-card__subscribe",appearance:xc.LINK,onlyForNotSubscribed:!0}),e.channel?.id&&r.createElement(_f,{channelId:e.channel?.id,mode:"mini"}))),a&&u&&r.createElement(aS,{location:u.display_name,extraClasses:"post-card__geo"})),l&&EE.ZP.showReasonsForShowing(e)&&r.createElement(iS,{iconClasses:"post-card__info-icon",postId:e.smi2_id||e.id,siteId:y,isStaff:v,showAuthorType:C,defaultItem:R})))},mS=(0,r.memo)(cS),dS=({text:e="",title:t,flexableTextSize:n,isReadMore:a,smallTitleSize:s,smallTextSize:o,extraClasses:i,url:l,onClick:c})=>(e=(e=y.Z.disinfection(e).trim())&&a?e+'...<a class="post-preview__more" data-link="more" href="'+l+'">Далее</a>':e)||t?r.createElement("div",{className:_()("post-preview",i),onClick:e=>{e.target.getAttribute("href")&&"more"!==e.target?.dataset?.link||"function"==typeof c&&c(e)}},t&&r.createElement("h3",{className:_()("post-preview__title",s&&"post-preview__title_sm")},t),e&&r.createElement("div",{className:_()({"post-preview__description":!0,"post-preview__description_lg":n&&e.length<=200,"post-preview__description_sm":o}),dangerouslySetInnerHTML:{__html:e}})):null,pS=(0,r.memo)(dS),uS=({url:e,extraClasses:t,postUrl:n})=>{const a=n?"a":"div";return r.createElement(a,{className:_()("post-img",t),href:n},r.createElement(kn.Z,{className:"post-img__img",src:e,size:"wnd"}),r.createElement("div",{className:"post-img__bg",style:{backgroundImage:`url(${e})`}}))},gS=({embed:e,playerData:t,src:n="https://player.mt.ru/loadCluster.js"})=>{if(!e&&!t)return null;const a=t?"panda_div_"+t?.id+"_h"+y.Z.hashString(JSON.stringify(t)):"";return(0,r.useEffect)((()=>{t&&function(e,s,r){(e[r]=e[r]||[]).push((()=>{e.PandaVideo.loadParsedJSON({parsedJSON:{Video:t,Vasts:[]},divId:a})}));const o=s.createElement("script");o.type="text/javascript",o.async=!0,o.src=n,document.body.appendChild(o)}(window,document,"__panda_callbacks")}),[t]),t?r.createElement("div",{className:"video-wrap",dangerouslySetInnerHTML:{__html:'<div id="'+a+'"></div>'}}):r.createElement("div",{className:"video-wrap",dangerouslySetInnerHTML:{__html:e||""}})},hS=(0,r.memo)(gS),_S=({embed:e,extraClasses:t,playerData:n})=>r.createElement("div",{className:_()("post-video",t)},r.createElement(hS,{embed:e,playerData:n}));function ES(){return ES=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ES.apply(this,arguments)}const fS=N((()=>Promise.all([n.e(526).then(n.t.bind(n,88667,23)),n.e(743).then(n.bind(n,83651))]).then((([e])=>e))),"reactIdSwiper"),bS=({attachments:e,extraClasses:t,getEmbed:n})=>{const[a,s]=(0,r.useState)(1),[o,i]=(0,r.useState)(!1),l=()=>{const e=c?.current?.swiper?.activeIndex,t=c?.current?.swiper?.pagination;if(!e&&0!==e&&!t)return;const n=p[e];n&&(0,ls.fr)(n)?t.destroy():t.init()},c=(0,r.useRef)(null),m={containerClass:_()("swiper-gallery","swiper-container",t),navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0,dynamicBullets:!0},on:{paginationRender:l,slideChange:()=>{const e=c?.current?.swiper?.activeIndex;(e||0===e)&&(l(),s(e+1))}},renderPrevButton:()=>r.createElement(He.Z,{extraClasses:"swiper-button-prev",icon:"angle-right",isCompact:!0,onClick:e=>e.stopPropagation()}),renderNextButton:()=>r.createElement(He.Z,{extraClasses:"swiper-button-next",icon:"angle-right",isCompact:!0,onClick:e=>e.stopPropagation()})},d=(0,r.useCallback)((e=>{e&&(c.current=e,i(!0))}),[]),p=e.filter((e=>(0,ls.M2)(e)||(0,ls.fr)(e)));return r.createElement(r.Fragment,null,r.createElement(fS,ES({},m,{ref:d}),p.map(((e,t)=>(0,ls.M2)(e)?r.createElement(uS,{url:e.photo.photo_original,extraClasses:"swiper-slide",key:t}):(0,ls.fr)(e)?r.createElement(_S,{embed:n(e.video.player_html),extraClasses:"swiper-slide",playerData:e.video.player_data?JSON.parse(e.video.player_data):null,key:t}):void 0))),o&&c.current&&(0,Yt.createPortal)(r.createElement("div",{className:"swiper-container__fraction-pagination"},`${a} / ${p.length}`),c.current))},yS=(e,t)=>{if("user_post"!==t)return e;const n=/https?:\/\/(www\.)?player\.(panda\.video|mt\.ru)\/video\/[\-a-z0-9()@:%_\\+.~#?&\/=]*[a-z0-9\/#?&\-_]+/i;let a=e.match(n)?.[0];return a?(a=zE.Z.addParameterToUrl(a,"autoplay","0"),a=zE.Z.addParameterToUrl(a,"mute","0"),e.replace(n,a)):e},vS=({attachments:e,postType:t,extraClasses:n,postUrl:a})=>{if(!e?.length)return null;let s;if(1===e.length){const o=e[0];s=(0,ls.fr)(o)?r.createElement(_S,{embed:yS(o.video.player_html,t),extraClasses:n,playerData:o.video.player_data?JSON.parse(o.video.player_data):null}):r.createElement(uS,{url:o.photo.photo_original,extraClasses:n,postUrl:"user_post_rich"===t?a:void 0})}else s=r.createElement(bS,{attachments:e,extraClasses:n,getEmbed:e=>yS(e,t)});return s},TS=({onClick:e,extraClasses:t,disabled:n})=>r.createElement(He.Z,{color:"primary",onClick:e,extraClasses:_()("play-btn",t),isCompact:!0,icon:"play",disabled:n}),SS=(0,r.memo)(TS),PS=({src:e,showVideoBtn:t,size:n="lg",...a})=>e||t?r.createElement("div",{className:_()("post-thumb",[`post-thumb_${n}`])},r.createElement(kn.Z,{src:e,tag:"div",className:"post-thumb__img"},a.showThumbCounter&&r.createElement("div",{className:"post-thumb__counter"},a.photoCounter>0&&r.createElement("span",null,`${a.photoCounter} фото`),a.videoCounter>0&&r.createElement("span",null,`${a.videoCounter} видео`)),t&&r.createElement(SS,{extraClasses:"post-thumb__btn",disabled:!0}))):null,wS=({post:e,source:t,title:n,text:a,previewImage:s,photoCounter:o,videoCounter:i,attachments:l=[],isFull:c,url:m})=>{const d=!c&&o+i>0,p=o<=0&&1===i,u=o+i>1,g=Fp.addUtmToUrl(m),h=e=>{e.preventDefault(),window.open(Fp.addMirtesenKeyToUrl(g,b.ZP.getMirtesenKey()),"_blank")};return r.createElement("div",{className:"post-embed"},r.createElement("div",{className:"post-embed__description"},c&&r.createElement(vS,{attachments:l,extraClasses:"post-embed__media",postType:e?.post_type}),e&&r.createElement(mS,{post:e,extraClasses:"post-embed__header",subscribeButtonEnabled:!0,onPubDateClick:h}),t&&r.createElement("span",{className:"post-embed__source"},t),(n||a)&&r.createElement(pS,{title:bt()(n),text:a,onClick:h,smallTitleSize:!0,smallTextSize:!0})),d&&r.createElement(PS,{src:s,showThumbCounter:u,photoCounter:o,videoCounter:i,showVideoBtn:p}))},IS=(0,r.memo)(wS);function CS(){return CS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},CS.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Post card content
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const NS=(e,t)=>{const{previewText:n,text:a,body:s,post_type:r}=e;if("post"===r)return!0;const o=K.Z.stripTags(s||a||"").length>Number(n?.length);return!(t||!n&&!s||!o)},OS=({post:e,isCurrentPost:t,onLinkClick:n})=>{const a=(0,aa.C)((e=>e.app.req.browser.name)),{attachments:s=[],shared_post:o}=e,i=EE.ZP.normalizeText(e,{browserName:a,isCurrentPost:t}),l=EE.ZP.isLinkAttachments(e),c=s?.filter((e=>(0,ls.fr)(e)||(0,ls.M2)(e)))||[];let m;(o||l)&&(m=o?EE.ZP.normalizeRepost(o):EE.ZP.normalizeLink(l.link));const d=t?void 0:Fp.addUtmToUrl(e.seo_url||e.url),p=t?void 0:"_blank";return r.createElement("div",{className:"post-card__content"},EE.ZP.showPostMedia(e,{isCurrentPost:t})&&r.createElement(vS,{attachments:c,postType:e.post_type,extraClasses:"post-card__media",postUrl:d}),r.createElement("div",{className:"post-card__description"},r.createElement(pS,{title:e.isTitleHidden?null:e.title,text:i,isReadMore:NS(e,t),flexableTextSize:EE.ZP.isFontSizeFlexible(e),url:d,extraClasses:{"post-preview_noclick":t},target:p,onClick:n}),e.foreignPollId&&r.createElement(_n,{pollId:e.foreignPollId,postUrl:d}),m&&r.createElement(IS,CS({},m,{isFull:c?.length<1}))))},MS=(0,r.memo)(OS),kS=({post:e,url:t,onCommentClick:n})=>{const[a,s]=(0,r.useState)(null),[o,i]=(0,r.useState)(null);if(!e)return null;if((0,r.useEffect)((()=>{(async()=>{const{messages:t,users:n=[]}=await qd.getPostCommentPreview(e.id),a=t?.[0],r=n.find((e=>e.id===a?.from_id));s(a||null),i(r||null)})()}),[]),!o||!a)return null;let l=y.Z.stripTags(a.text);return l=y.Z.truncateString2(l,190),r.createElement("a",{href:t,onClick:n,className:"post-card__comment-preview"},r.createElement(VT,{className:"post-card__logo_sm",logoInfo:{userName:o.display_name,logoImgSrc:o.photo_small}}),r.createElement("div",{className:"post-card__comment-preview-text"},r.createElement("b",null,o.display_name,": "),r.createElement("span",{dangerouslySetInnerHTML:{__html:l}}),"image"===a?.attachments?.[0]?.type&&r.createElement(PS,{src:a?.attachments?.[0]?.url,size:"xs"})))},AS=xy((0,r.memo)(kS));function xS(){return xS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},xS.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Post card footer
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const LS=({post:e,isCurrentPost:t})=>{const n=(0,aa.C)((e=>e.app.page)),a=(0,aa.C)((e=>e.app.scope)),s=(0,aa.C)((e=>e.auth?.user));let o="";const i={post:e};return"channel"===a?(o=((e,t)=>"channelMain"===t||"hashtagPostList"===t?e.channel?.is_owner?"channel-post-owner":"channel-post-guest":e.channel?.is_owner?"channel-post-owner":"mt-feed-post-guest")(e,n),i.channelId=e.channel?.id,i.editorType="channel",i.url=e.seo_url||e.url):"indexMainAuthorized"===n?(o=((e,t)=>e.from?.id===t?"mirtesen-feed-post-owner":"post"===e.post_type?"mirtesen-feed-blog-post-guest":"mirtesen-feed-user-post-guest")(e,s?.id),i.editorType="post"===e.post_type?"blog":"user"):"hashtagPostList"===n?(o="post"===e.post_type?e.from?.id===s?.id?"blog-post-author":"blog-post-guest":e.from?.id===s?.id?"profile-post-owner":"profile-post-guest",i.editorType="post"===e.post_type?"blog":"user"):"profile"===a?(o=e.from?.id===s?.id?"profile-post-owner":"profile-post-guest",i.editorType="user"):"blog"===a&&(o=((e,t,n)=>b.ZP.canModerate()?"blog-post-moderator":e.from?.id===n?"blog-post-author":"blog-post-guest")(e,0,s?.id),i.editorType="blog"),r.createElement("div",{className:"post-card__footer"},r.createElement("div",{className:"post-controls"},r.createElement(Vy,{post:e,isCurrentPost:t,showViews:"post"!==e?.post_type}),o&&r.createElement(ir,xS({type:o},i))))},DS=(0,r.memo)(LS),RS=({postId:e,topStatus:t,place:n})=>{const a=(0,aa.C)((e=>e.post2Top)),s=a.posts?.[e]?.toLowerCase(),o=(0,aa.T)();return(0,r.useEffect)((()=>{t&&o(Ss(e,t))}),[]),"approved"!==s?null:r.createElement("div",{className:"post-in-top"},r.createElement(yn.Z,{iconName:"star-grey"}),"post-card"===n?"Топ":"Топ публикация")},ZS=(0,r.memo)(RS),BS=({metaUrl:e,metaDate:t,metaTitle:n,metaImage:a})=>r.createElement(r.Fragment,null,r.createElement("meta",{itemScope:!0,itemProp:"mainEntityOfPage",itemType:"https://schema.org/WebPage",itemID:y.Z.fixProtocol(e),content:""}),r.createElement("meta",{itemProp:"datePublished",content:t}),r.createElement("meta",{itemProp:"dateModified",content:t}),n&&r.createElement("meta",{itemProp:"headline",content:n}),a&&r.createElement("meta",{itemProp:"image",content:y.Z.fixProtocol(a)})),$S=(0,r.memo)(BS),US=({post:e,pageTitle:t,nonFriendPostIds:n,postLabelEnabled:a=!1,reasonsForShowingEnabled:s=!1,subscribeButtonEnabled:o=!1,isCurrentPost:i,onLinkClick:l,onPostAppear:c,showCommentWidget:m,linkTarget:d="_blank"})=>{const p=!!e.smi2_id,u=e.id||e.smi2_id,g=Fp.addUtmToUrl(e.seo_url||e.url),h=(0,aa.T)(),[_,E]=(0,r.useState)(!1);(0,r.useEffect)((()=>{i&&!p&&(Td(u),setTimeout((()=>{_||(Sd(u),E(!0))}),15e3))}),[]);const f=(e,t)=>{if("function"==typeof l)l(e,t);else{const n=t?.target||e?.currentTarget?.getAttribute("target")||"_self",a=t?.href||e?.currentTarget?.getAttribute("href");setTimeout((()=>{window.open(a,n)}))}},b=(e,t,n)=>{e.persist(),e.preventDefault();return"_blank"===(t?.target||e?.currentTarget?.getAttribute("target")||"_self")?(vd(n),f(e,t)):vd(n).then((()=>{f(e,t)})),!1};let v;const T=EE.ZP.getPostType(e)||EE.Pg;[EE.Ek,EE.Rt].includes(T)?v=e=>{e.preventDefault(),h(Id(u))}:i||(v=e=>{b(e,{href:g,target:d},u)});const S={post:e,nonFriendPostIds:n,isCurrentPost:i,geoTagEnabled:!0,subscribeButtonEnabled:o,postLabelEnabled:a,reasonsForShowingEnabled:s,onPubDateClick:e=>{b(e,{href:g,target:"_self"},u)}};return u?r.createElement("article",{className:"post-card",itemScope:i,itemType:i?"http://schema.org/NewsArticle":void 0},i&&r.createElement($S,{metaUrl:e.canonical_url||e.url,metaDate:e?.formattedDates?.iso||"",metaTitle:t,metaImage:y.Z.cropImage2(e.images?.[0]?.url)}),r.createElement(ZS,{postId:e?.id,topStatus:e?.top_status,place:"post-card"}),r.createElement(mS,S),r.createElement(MS,{post:e,onLinkClick:v,isCurrentPost:i}),i&&r.createElement(by,{className:"post-card-tags",tags:e.tags||[]}),!m&&r.createElement(AS,{post:e,isCurrentPost:i}),r.createElement(DS,{post:e,isCurrentPost:i}),r.createElement(Lv,{onAppear:()=>(async e=>{if(i&&!_)await Sd(e),E(!0);else if(await yd(e),"function"==typeof c)return c(e);return!0})(u)}),r.createElement(vy,{postId:u}),m&&r.createElement(Vv,{blogPostId:e.id,showListTitle:!1})):null},HS=(0,r.memo)(US);
/**
 * Mirtesen.
 *
 * Blog Post List Container.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class FS extends r.PureComponent{getPublicationDate=e=>{const t=e.formattedDates.iso;return e.is_draft?"Черновик":e.is_queued?r.createElement(r.Fragment,null," Дата публикации:",r.createElement(s_,{date:e.publish_time,format:"D MMMM, H:mm"})):t&&y.Z.isPastYear(t)?r.createElement(s_,{date:t,format:"DD.MM.YYYY в H:mm"}):r.createElement(s_,{date:t,format:"D MMMM, H:mm"})};getEditorStatusHtml=e=>{if("EDITOR_STATUS_NONE"!==e){const t="EDITOR_STATUS_AUTHOR"===e?"Авторский материал":"Отборный материал";return r.createElement("div",{className:_()({"blog-post__status":!0,"blog-post__status_author":"EDITOR_STATUS_AUTHOR"===e,"blog-post__status_selected":"EDITOR_STATUS_SELECTED"===e})},r.createElement("div",{className:"blog-post__status-tooltip"},r.createElement("div",null,t),r.createElement("div",null,"Наши редакторы постоянно отбирают для вас лучшие материалы")))}return null};render(){const{blogPostList:e,hasMoreItems:t,onShowMore:n,page:a,app:s,actionModifyPostPopup:o,increaseScrolledPosts:i,searchValue:l,search:c,onChangeSearch:m,showMoreSearchResults:d}=this.props,p=L()(s,"isArbitrationBlog");let u=0;const g=parseInt(s?.req?.query?.page||"1",10),h=L()(s,"req.deviceType");return r.createElement("div",{className:"blog-post-list"},r.createElement(Jn,{handleSearch:m,defaultValue:l,searchUrl:zE.Z.getCleanUrl(`${s.req.protocol}://${s.req.host}${s.req.originalUrl}`)}),l?r.createElement(zn,{pageStart:0,loadMore:d,hasMore:c.hasMore,loader:r.createElement(Yn,null),threshold:500},r.createElement(Ub,null,c.results&&c.results.map(((e,t)=>r.createElement($T,{key:t,item:e}))),!c.results?.length&&!c.isLoading&&r.createElement("p",{className:"mt-list__empty"},"Ничего не найдено"))):r.createElement(r.Fragment,null,s.listWithPepriod&&r.createElement(ZT,null),r.createElement(zn,{pageStart:0,loadMore:()=>{if(t)return n(Rp().postsPerPage+(a-1)*Rp().postsPerPage,Rp().postsPerPage)},hasMore:t,loader:r.createElement(Yn,null),threshold:400},e.blogPostList.length<1&&!t&&r.createElement("article",{className:"blog-post blog-post__no-posts",key:0},"Здесь пока ничего нет"),e.blogPostList.length>0&&e.blogPostList.map((e=>{if(o.approveList[e.id])return null;u++;const t=u%Rp().postsPerPage==0,n=g-1+Math.floor(u/Rp().postsPerPage);return r.createElement(r.Fragment,{key:u},(u+1)%3==0&&!p&&r.createElement("div",{className:"adfox-outer blog-post-list__ad-block"},"phone"!==h?r.createElement(Fh,{type:"Politpiar",id:99818}):r.createElement(Fh,{type:"Politpiar",id:99813})),r.createElement(dE,{key:e.id,tag:"article",className:"blog-post"},r.createElement(HS,{post:e,onPostAppear:i})),t&&r.createElement(Rb,{id:n,initialPage:g,threshold:.5}))})))),r.createElement(kT,{hasMoreItems:t,page:a,url:s.originalUrl}),r.createElement(Qb,null),r.createElement(ty,null),r.createElement(Jb,null))}}FS.propTypes={blogPostList:f().object,hasMoreItems:f().bool,onShowMore:f().func,page:f().number,title:f().string,siteBuilder:f().object,app:f().object,user:f().object,actionModifyPostPopup:f().object,onRestoreBlogPost:f().func,increaseScrolledPosts:f().func,searchValue:f().string,search:f().object,onChangeSearch:f().func,showMoreSearchResults:f().func};const jS=(0,i.$j)((e=>({title:e.blogPostList.title,blogPostList:e.blogPostList,hasMoreItems:e.blogPostList.hasMoreItems,searchValue:e.blogPostList.searchValue,search:e.blogPostList.search,actionModifyPostPopup:e.actionModifyPostPopup,page:e.blogPostList.page,app:e.app})),(e=>({onShowMore:(t,n)=>{e(xT(t,n))},increaseScrolledPosts:()=>e(gc()),onChangeSearch:t=>{e((e=>t=>(t({type:"BLOG_POST_LIST_SET_SEARCH",searchValue:e}),t(LT())))(t))},showMoreSearchResults:()=>{e(LT())}})))((0,ae.Z)(FS,"blogPostLst"));var GS=n(82099);
/**
 * Mirtesen.
 *
 * Inputs generator.
 *
 * @author       Artyom Konstantinov.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class qS extends r.Component{getInputByType=()=>{const{type:e,onChangeHandle:t,input:n,valid:a,defaultValue:s,invalid:o,error:i}=this.props,{type:l,rows:c,name:m,initVal:d,inline:p,placeholder:u,classNameInput:g="",list:h,select:E,group:f}=n;let{value:b}=this.props;const y=e||l,v=_()({[g]:!0}),T=!!a,S=!!i||!!o;if("text"===y||"number"===y||"password"===y)return r.createElement("input",{name:m,type:y,value:void 0===b&&void 0!==s?void 0:b||"",defaultValue:void 0!==s?b||"":void 0,onChange:t,placeholder:u,className:_()("form-control",{[g]:!0,"is-valid":T,"is-invalid":S})});if("textarea"===y)return r.createElement("textarea",{ref:this.props.innerRef,name:m,type:"textarea",rows:c,style:{resize:"none"},value:void 0!==b?b||"":void 0,defaultValue:void 0!==s?b||"":void 0,onChange:t,placeholder:u,className:_()("form-control",{[g]:!0,"is-valid":T,"is-invalid":S})});if("radio"===y)return r.createElement("input",{type:"radio",name:m,value:d,defaultChecked:b===d,onChange:t,className:_()("form-check-input",{[g]:!0,"site-settings__input_inline":p})});if("checkbox"===y)return"0"===b&&(b=!1),r.createElement("input",{type:"checkbox",name:m,checked:!!b,onChange:t,className:_()("form-check-input",{[g]:!0,"site-settings__input_inline":p})});if("select"===y){let e;b||(b=""),E&&E.range&&(E.range.default&&!b&&(b=E.range.default),e=this.selectRangeList(E.range.start,E.range.stop));const n=e||h||[];return r.createElement("select",{type:y,name:m,value:b,onChange:t,className:_()("form-control",v,{"is-valid":T,"is-invalid":S})},n.map(((e,t)=>r.createElement("option",{key:t},e.text))))}return"radiogroup"===y?(b=b??"",r.createElement(r.Fragment,null,r.createElement("div",{className:"site-settings__radiogroup"},f.map(((e,n)=>r.createElement("label",{className:"site-settings__radiogroup-el",key:n},r.createElement("div",{className:"site-settings__radiogroup-title"},e.text),r.createElement("input",{type:"radio",name:m,value:e.initVal,defaultChecked:b===e.initVal,onChange:t,className:_()("form-check-input",{[g]:!0,"site-settings__input_inline":p})}))))))):"file"===y?r.createElement("input",{name:m,type:y,onChange:t,className:_()("form-control-file",{[g]:!0,"is-valid":T,"is-invalid":S})}):void 0};selectRangeList=(e,t)=>{const n=[];for(let a=e;a<=t;a++)n.push({id:a,text:a});return n};render(){const{type:e,error:t,valid:n,input:a,v2:s=!1,v2ShowOptional:o=!1}=this.props,{type:i,isRequired:l,labelMuted:c,label:m,wrap:d,labelAfter:p,inline:u,forDevs:g,isDev:h,extraElem:E}=a,f=e||i,b=r.createElement(r.Fragment,null,t&&r.createElement("div",{className:"invalid-feedback"},"string"==typeof t?t:t.title||""),n&&r.createElement("div",{className:"valid-feedback"},n));if(s&&["text","textarea"].includes(f)){const{value:e,onChangeHandle:n}=this.props,{defaultValue:s,placeholder:i,name:c}=a,d="string"==typeof t?t:t?.title||"";let u;if(u=o?!!l&&void 0:!!l||void 0,"text"===f||"textarea"===f){const t={label:m,helper:d||p,isError:!!d,isRequired:u},a={value:e||s||"",onChange:n,name:c,placeholder:i};return r.createElement(r.Fragment,null,r.createElement(Lr.Z,t,"text"===f?r.createElement(Dr.Z,a):r.createElement(GS.Z,a)),E)}}return g&&!h?null:"text"===f||"textarea"===f||"number"===f||"password"===f||"select"===f||"file"===f?r.createElement("div",{className:_()("form-group",{[a.className||""]:!0,"yellow-form":g,"site-settings__form-group_inline":u,"site-settings__form-group_wrap":d})},(m||c)&&r.createElement("label",{className:_()({[a.className||""]:!0,"yellow-form":g,"site-settings__label_inline":u})},l&&r.createElement("span",{className:"form-required"},"*"),m,c&&r.createElement("p",{className:"form-text text-muted"},c)),r.createElement("div",{className:_()(u&&"site-settings__input_inline")},this.getInputByType(),b),p&&r.createElement("label",null,p),E):"radio"===f||"checkbox"===f?r.createElement("div",{className:_()("form-group",{[a.className||""]:!0,"yellow-form":g,"site-settings__label_inline":u})},r.createElement("label",{className:"form-check-label"},this.getInputByType(),m),b):"radiogroup"===f?r.createElement("div",{className:_()("form-group",{[a.className||""]:!0,"yellow-form":g,"site-settings__label_inline":u})},r.createElement("label",{className:"form-check-label site-settings__radiogroup-outer"},l&&r.createElement("span",{className:"form-required"},"*"),m),this.getInputByType(),b):void 0===f?r.createElement("div",{className:_()("form-group",{[a.className||""]:!0,"yellow-form":g,"site-settings__label_inline":u})},r.createElement("label",{className:"form-check-label site-settings__radiogroup-outer"},l&&r.createElement("span",{className:"form-required"},"*"),m)):null}}qS.propTypes={input:f().object,value:f().any,defaultValue:f().any,onChangeHandle:f().any,error:f().any,valid:f().any,invalid:f().any,type:f().string,innerRef:f().func,v2:f().bool,v2ShowOptional:f().bool};const VS=qS;
/**
 * Mirtesen.
 *
 * Smi2 tab component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class zS extends r.Component{form={group1:[{type:"textarea",rows:10,name:"htmlHeaderText",label:"HTML код после <body>"},{type:"checkbox",name:"htmlHeaderEnabled",label:"активировать блок после <body>"}],group2:[{type:"textarea",rows:10,name:"htmlFooterText",label:"HTML код перед </body>"},{type:"checkbox",name:"htmlFooterEnabled",label:"активировать блок перед </body>"}]};render(){const{onChangeInput:e,onSaveSettings:t,data:n,active:a,errors:s}=this.props,o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!a};return r.createElement("div",{className:_()(o)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"HTML вставки"),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},this.form.group1.map(((t,a)=>r.createElement(VS,{error:s[t.name],key:a,input:t,value:n[t.name],onChangeHandle:n=>{e(n,t.name)}})))),r.createElement("div",{className:"form-group"},this.form.group2.map(((t,a)=>r.createElement(VS,{error:s[t.name],key:a,input:t,value:n[t.name],onChangeHandle:n=>{e(n,t.name)}}))))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:t,label:"Сохранить"})))))}}zS.propTypes={data:f().object,onChangeInput:f().func,onSaveSettings:f().func,active:f().bool,errors:f().any};const WS=zS;
/**
 * Mirtesen.
 *
 * BlogAbout container.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class YS extends r.Component{constructor(e){super(e),this.favicon=r.createRef()}handleAddTag=e=>{const{siteSettings:t}=this.props,n=t.data.about;n.keyWords.push(e.name),this.handleChangeInput(n.keyWords,"keyWords")};handleDeleteTag=e=>{const{siteSettings:t}=this.props,n=t.data.about;n.keyWords=n.keyWords.filter(((t,n)=>n!==e)),this.handleChangeInput(n.keyWords,"keyWords")};handleChangeInput=(e,t)=>{const{onChangeInput:n}=this.props,{activeTab:a}=this.props.siteSettings;let s=null;const r=e.target;s=r?"checkbox"===r.type?r.checked:r.value:e,n(a,t,s)};form={group1:[{type:"text",name:"name",label:"Название",isRequired:!0},{type:"text",name:"logoUrl",label:"Адрес перехода по клику на логотип",forDevs:!0},{type:"textarea",rows:3,name:"description",label:"Описание",labelMuted:"Также используется для повышения рейтинга в поисковых системах"}],group2:[{type:"radio",name:"language",label:"Русский",initVal:"ru",forDevs:!0},{type:"radio",name:"language",label:"Английский",initVal:"en",forDevs:!0}]};render(){const{onSaveSettings:e,onChangeTab:t,siteSettings:n,isDev:a,onSetFavicon:s,onRemoveFavicon:o}=this.props,{errors:i}=n,l=n.data.about;return r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Общие настройки сайта"),r.createElement("div",{className:"form-section"},r.createElement("div",{className:"form-group form-group_inline-between"},r.createElement("label",null,"Адрес сайта"),r.createElement("a",{href:"/edit/domain/",className:"btn btn-outline-secondary align-right",onClick:e=>{e.preventDefault(),window.history.pushState(null,"","/edit/domain/"),t("domain")}},"Настроить"))),r.createElement("div",{className:"form-section form-section_none"},this.form.group1.map(((e,t)=>r.createElement(VS,{key:t,input:{...e,isDev:a},error:i[e.name],value:l[e.name],onChangeHandle:t=>{this.handleChangeInput(t,e.name)}}))),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Ключевые слова"),r.createElement(aT,{helper:"Используются для повышения рейтинга в поисковых системах. Используйте Tab или Enter чтобы завершить ввод.",placeholder:"Новый тег...",tags:l.keyWords||[],onChangeInput:e=>{this.handleChangeInput(e,"keyWords")}})),a&&r.createElement("div",{className:"form-group yellow-form"},r.createElement("label",null,"Язык интерфейса"),this.form.group2.map(((e,t)=>r.createElement(VS,{error:i[e.name],key:t,input:{...e,isDev:a},value:l[e.name],onChangeHandle:t=>{this.handleChangeInput(t,e.name)}})))),r.createElement("div",{className:"position-relative form-group"},r.createElement("label",null,"Установить favicon для сайта."),r.createElement("div",{className:"form-group_inline-between position-relative form-group"},r.createElement("input",{name:"favicon",type:"file",ref:this.favicon,className:"form-control-file",onChange:s}),l.favicon&&r.createElement("div",{className:"site-favicon",style:{backgroundImage:`url('${l.favicon}')`}},r.createElement("div",{className:"remove-favicon-btn fas fa-times-circle",onClick:()=>{o(),this.favicon.current.value=""}})))),a&&r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-check yellow-form"},r.createElement("label",null,r.createElement("input",{className:"form-check-input",type:"checkbox",name:"useDirectUrl",checked:l.useDirectUrl,onChange:e=>{this.handleChangeInput(e,"useDirectUrl")}}),"Прямая ссылка на источник")),r.createElement("div",{className:"form-check yellow-form"},r.createElement("label",null,r.createElement("input",{className:"form-check-input",type:"checkbox",name:"linksToCanonical",checked:l.linksToCanonical,onChange:e=>{this.handleChangeInput(e,"linksToCanonical")}}),"Не ставить nofollow в ссылки на сайт партнера")))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:t=>{t.preventDefault(),e()},label:"Сохранить"}))))}}YS.propTypes={siteSettings:f().object,onSetFavicon:f().func,onChangeInput:f().func,onChangeTab:f().func,onSaveSettings:f().func,onRemoveFavicon:f().func,isDev:f().bool};const KS=(0,i.$j)((e=>({siteSettings:e.siteSettings})),(e=>({onSaveSettings:()=>{e(bu("about"))},onChangeTab:t=>{e(_u(t))},onChangeInput:(t,n,a)=>{e(fu(t,n,a))},onSetFavicon:t=>{e((e=>t=>{const n=new FileReader;n.readAsDataURL(e.target.files[0]),n.onload=()=>{fetch(n.result).then((e=>e.blob())).then((e=>{const t=new window.FormData;t.append("query","mutation {uploadPhoto {id, photo_original}}"),t.append("photo",e);const n={project:"comments",body:t};return(0,yt.Z)(n)})).then((e=>{if(!e)throw new Error("image bad response");return e.data.uploadPhoto.photo_original})).then((e=>{e&&t(fu("about","favicon",e))})).catch(D.Z.promiseHandler("/index.js"))}})(t))},onRemoveFavicon:()=>{e(((e,t)=>{const n=t().app.site.id;e(fu("about","favicon","")),e({type:"SITE_SETTINGS_SAVE_SETTINGS",tabName:"about"}),Promise.all([Fp.setSiteSettings(n,{about:{favicon:""}})]).then((([t])=>{t.result||e(yu(t))})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(hu)(e)}))}))}})))(YS);
/**
 * Mirtesen.
 *
 * About tab component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class JS extends r.Component{render(){const{active:e}=this.props,t={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!e};return r.createElement("div",{className:_()(t)},r.createElement(KS,{isDev:this.props.isDev}))}}JS.propTypes={isDev:f().bool,active:f().bool};const XS=JS;
/**
 * Mirtesen.
 *
 * Permissions tab component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class QS extends r.Component{constructor(e){super(e),this._makeRadio=this._makeRadio.bind(this)}radioInputs={join_is_open:[{title:"любой желающий",value:1},{title:"только получивший приглашение",value:0}],vislvl_invitation:[{title:"только участники",value:K.Z.allowLevels.member},{title:"только владелец",value:K.Z.allowLevels.god}],allowContentVislvl:[{title:"никто (новые темы запрещены)",value:K.Z.allowLevels.none},{title:"только владелец",value:K.Z.allowLevels.god},{title:"только администраторы",value:K.Z.allowLevels.moderator},{title:"все участники",value:K.Z.allowLevels.member}],allowVoteVislvl:[{title:"никто (новые оценки запрещены)",value:K.Z.allowLevels.none},{title:"только владелец",value:K.Z.allowLevels.god},{title:"члены группы",value:K.Z.allowLevels.member},{title:"все зарегистрировавшиеся",value:K.Z.allowLevels.registered}],allowViewCreatorVislvl:[{title:"только владелец",value:K.Z.allowLevels.god},{title:"только администраторы",value:K.Z.allowLevels.moderator},{title:"все участники",value:K.Z.allowLevels.member},{title:"все",value:K.Z.allowLevels.any}],allowCommentVislvl:[{title:"никто (комментарии запрещены и скрыты)",value:K.Z.allowLevels.none},{title:"только владелец",value:K.Z.allowLevels.god},{title:"все участники",value:K.Z.allowLevels.member},{title:"все",value:K.Z.allowLevels.registered}]};_makeRadio(e,t,n){const a=[],{onChangeInput:s}=this.props;return t="number"==typeof t?t.toString():t,this.radioInputs[e].map((o=>{let i=o.value;i="number"==typeof i?i.toString():i,a.push(r.createElement(VS,{error:n[e],key:i,input:{type:"radio",initVal:i,label:o.title,name:e},value:t,onChangeHandle:t=>{s(t,e)}}))})),a}render(){const{onSaveSettings:e,onChangeInput:t,data:n,active:a,errors:s}=this.props,o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!a};return r.createElement("div",{className:_()(o)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Доступность"),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Присоединиться может"),this._makeRadio("join_is_open",n.join_is_open,s))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Приглашать могут"),this._makeRadio("vislvl_invitation",n.vislvl_invitation,s))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Добавлять темы в блог могут"),this._makeRadio("allowContentVislvl",n.allowContentVislvl,s)),r.createElement("div",{className:"form-check"},r.createElement("label",null,r.createElement("input",{className:"form-check-input",type:"checkbox",name:"language",checked:n.premoderation,onChange:e=>{t(e,"premoderation")}}),"новые темы должны быть одобрены модератором перед публикацией"))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Комментировать могут"),this._makeRadio("allowCommentVislvl",n.allowCommentVislvl,s))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Голосовать могут"),this._makeRadio("allowVoteVislvl",n.allowVoteVislvl,s))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Видеть авторов материалов могут"),this._makeRadio("allowViewCreatorVislvl",n.allowViewCreatorVislvl,s))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:e,label:"Сохранить"})))))}}QS.propTypes={data:f().object,onChangeInput:f().func,onSaveSettings:f().func,active:f().bool,errors:f().any};const eP=QS;
/**
 * Mirtesen.
 *
 * Analytics tab component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class tP extends r.Component{form={group1:[{type:"text",name:"googleAnalyticsAccountId",label:"Идентификатор аккаунта Google Analytics",labelMuted:r.createElement(r.Fragment,null,"Добавление счётчика Google Analytics на сайт. Идентификатор вида «G-XXXXXXXXXX», можно найти в настройках аккаунта. Создать аккаунт можно"," ",r.createElement("a",{href:"http://www.google.com/analytics/ru-RU/",target:"_blank"},"на сайте Google Analytics"),".")},{type:"text",name:"googleCheckingCode",label:"Проверочный код Google",labelMuted:r.createElement(r.Fragment,null,"Указание проверочного кода для"," ",r.createElement("a",{href:"https://www.google.com/webmasters/tools/home",target:"_blank"},"Google Webmaster tools"),". Введите только код - значение content в мета теге.")}],group2:[{type:"text",name:"yandexMetricaAccountId",label:"Идентификатор аккаунта Яндекс.Метрика",labelMuted:r.createElement(r.Fragment,null,"Добавление счетчика Яндекс.Метрика. Предварительно Вам необходимо"," ",r.createElement("a",{href:"http://passport.yandex.ru/passport?mode=register&retpath=http%3A%2F%2Fmetrika.yandex.ru",target:"_blank"},"зарегистрироваться"),". Идентификатор аккаунта можно найти в коде счетчика, введите только цифры (см. пример)",r.createElement("br",null),r.createElement("br",null),r.createElement("a",{href:"http://mtdata.ru/u17/photoCF0B/20525251076-0/huge.jpeg",target:"_blank"},r.createElement("img",{src:"http://mtdata.ru/u17/photoC29E/20094416660-0/big.jpeg",border:"1"})))},{type:"text",name:"yandexWebmasterCheckingMetatag",label:"Яндекс.Вебмастер",labelMuted:"Укажите значение проверочного метатега для Яндекс.Вебмастер"}]};render(){const{onSaveSettings:e,onChangeInput:t,data:n,active:a,errors:s}=this.props,o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!a};return r.createElement("div",{className:_()(o)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Аналитика",r.createElement("p",{className:"form-text text-muted"},"В этом разделе Вы можете включить различные системы сбора статистики посещаемости Вашего сайта, а также инструменты для оценки сайта с точки зрения поисковых систем Google и Яндекс.")),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Инструменты Google")),this.form.group1.map(((e,a)=>r.createElement(VS,{error:s[e.name],key:a,input:e,value:n[e.name],onChangeHandle:n=>{t(n,e.name)}})))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Инструменты Яндекс")),this.form.group2.map(((e,a)=>r.createElement(VS,{error:s[e.name],key:a,input:e,value:n[e.name],onChangeHandle:n=>{t(n,e.name)}})))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Liveinternet"),r.createElement("p",{className:"form-text text-muted"},"Для размещения сайта в системе"," ",r.createElement("a",{href:"http://www.liveinternet.ru/",target:"_blank"},"Liveinternet.ru")," просто зарегистрируйте его на странице"," ",r.createElement("a",{href:"http://www.liveinternet.ru/add",target:"_blank"}," добавления сайта"),"."," ","Невидимый счетчик будет установлен на Ваш сайт автоматически. Никакого кода больше размещать не надо."))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:e,label:"Сохранить"})))))}}tP.propTypes={data:f().object,onChangeInput:f().func,onSaveSettings:f().func,active:f().bool,errors:f().any};const nP=tP;
/**
 * Mirtesen.
 *
 * Vk tab component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class aP extends r.Component{form={group1:[{type:"text",name:"appId",label:"ID приложения"},{type:"text",name:"secretKey",label:"Секретный ключ"}]};render(){const{onChangeInput:e,onSaveSettings:t,data:n,active:a,errors:s}=this.props,o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!a};return r.createElement("div",{className:_()(o)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Настройки ВКонтакте"),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},"Требуется выполнить следующие действия:",r.createElement("br",null),"1. ",r.createElement("a",{href:"http://vkontakte.ru/apps.php?act=add&site=1",target:"_blank"},"создать приложение ВКонтакте"),r.createElement("br",null),"2. перейти в настройки, где указать адрес сайта и базовый домен",r.createElement("br",null),"3. скопировать ID приложения и ввести его в поле ввода ниже"),this.form.group1.map(((t,a)=>r.createElement(VS,{error:s[t.name],key:a,input:t,value:n[t.name],onChangeHandle:n=>{e(n,t.name)}})))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:t,label:"Сохранить"})))))}}aP.propTypes={data:f().object,onChangeInput:f().func,onSaveSettings:f().func,active:f().bool,errors:f().any};const sP=aP;
/**
 * Mirtesen.
 *
 * RssFeed tab component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class rP extends r.Component{form={group1:[{type:"checkbox",name:"linkToSource",label:"Cсылка на источник"}],group2:[{type:"radio",name:"load",initVal:"keywords",label:"Ключевые слова"},{type:"radio",name:"load",initVal:"topics",label:"Tематики"},{type:"radio",name:"load",initVal:"keywords_and_topics",label:"Ключевые слова и тематики"}],group3:[{type:"checkbox",name:"reloadPostsFromRss",label:"Перезагрузить посты из RSS"}]};render(){const{onChangeInput:e,onSaveSettings:t,data:n,active:a,errors:s}=this.props,o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!a};return r.createElement("div",{className:_()(o)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"RSS-фид"),r.createElement("div",{className:"form-section form-section_top"},r.createElement(VS,{error:s[this.form.group1[0].name],input:this.form.group1[0],value:n[this.form.group1[0].name],onChangeHandle:t=>{e(t,this.form.group1[0].name)}})),r.createElement("div",{className:"form-group"},this.form.group2.map(((t,a)=>r.createElement(VS,{error:s[t.name],key:a,input:t,value:n[t.name],onChangeHandle:n=>{e(n,t.name)}})))),r.createElement("div",{className:"form-section form-section_top"},r.createElement(VS,{error:s[this.form.group3[0].name],input:this.form.group3[0],value:n[this.form.group3[0].name],onChangeHandle:t=>{e(t,this.form.group3[0].name)}})),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:t,label:"Сохранить"})))))}}rP.propTypes={data:f().object,onChangeInput:f().func,onSaveSettings:f().func,active:f().bool,errors:f().any};const oP=rP;var iP="/index.js";
/**
 * Mirtesen.
 *
 * Robots.txt configuration.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class lP extends r.PureComponent{constructor(){super(),this.state={robotsText:"",changed:!1}}componentDidMount(){const{app:e}=this.props,t=e.site.id;Promise.resolve(Fp.getRobotsTxt(t)).then((e=>{let t=e.robotstxt;if(null===e.robotstxt){const e=new(Lp())(window.location.href);t=Fp.getDefaultRobotsTxt(e.hostname)}this.setState({robotsText:t})})).catch(D.Z.promiseHandler(iP)),window.addEventListener("beforeunload",this.handleBeforeUnload)}componentWillUnmount(){window.removeEventListener("beforeunload",this.handleBeforeUnload)}handleBeforeUnload=e=>{const{changed:t}=this.state;return!t||(e.returnValue="Changed","Changed")};handleChangeInput=e=>{this.setState({robotsText:e.target.value,changed:!0})};handleSaveSettings=e=>{e.preventDefault();const{app:t}=this.props,{robotsText:n}=this.state,a=t.site.id;let s="";Promise.resolve(Fp.setRobotsTxt(a,n)).then((e=>{s=!0===e.result?"Успешно сохранено":e.message||"При сохранении произошла ошибка.",kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:s})})).catch((e=>{kt.Z.sendMessage("saveError"),D.Z.promiseHandler(iP)(e)})).finally((()=>{this.setState({changed:!1})}))};render(){const{robotsText:e}=this.state,{active:t}=this.props,n={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!t};return r.createElement("div",{className:_()(n)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Настройки Robots.txt"),r.createElement("div",{className:"form-section form-section_top"},r.createElement(VS,{error:"",input:{type:"textarea",rows:10,name:"robotsText",label:"Файл Robots.txt"},value:e,onChangeHandle:this.handleChangeInput})),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:this.handleSaveSettings,label:"Сохранить"})))))}}lP.propTypes={app:f().object,active:f().bool};const cP=lP;
/**
 * Mirtesen.
 *
 * Smi2 tab component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class mP extends r.Component{form={group1:[{type:"text",name:"smi2RightBlock",label:"Блок справа",default:"95080"},{type:"text",name:"smi2BottomBlock2",label:"Блок под статьей 1",default:"95079"},{type:"text",name:"smi2BottomBlock3",label:"Блок под статьей 2",default:"95030"},{type:"text",name:"smi2BottomBlock4",label:"Блок под статьей 3",default:"95031"}]};render(){const{onChangeInput:e,onSaveSettings:t,data:n,active:a,errors:s}=this.props,o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!a};return r.createElement("div",{className:_()(o)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Обмен МирТесен"),r.createElement("div",{className:"form-section form-section_top"},this.form.group1.map(((t,a)=>r.createElement(VS,{error:s[t.name],key:a,input:t,value:n[t.name]||t.default,onChangeHandle:n=>{e(n,t.name)}})))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:t,label:"Сохранить"})))))}}mP.propTypes={data:f().object,onChangeInput:f().func,onSaveSettings:f().func,active:f().bool,errors:f().any};const dP=mP;
/**
 * Mirtesen.
 *
 * About tab component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class pP extends r.Component{render(){const{active:e}=this.props,t={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!e};return r.createElement("div",{className:_()(t)},r.createElement(Ib,null))}}pP.propTypes={data:f().object,onChangeInput:f().func,onChangeTab:f().func,onSaveSettings:f().func,active:f().bool};const uP=pP;
/**
 * Mirtesen.
 *
 * Ad configuration.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class gP extends r.Component{render(){const{onChangeInput:e,onSaveSettings:t,data:n,active:a}=this.props,s={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!a};return r.createElement("div",{className:_()(s)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Настройки рекламы"),r.createElement("div",{className:"form-section form-section_top"},r.createElement(VS,{key:"inpageVideoAtEnd",input:{type:"checkbox",name:"inpageVideoAtEnd",label:"Показывать рекламу в конце страницы"},value:n.inpageVideoAtEnd,onChangeHandle:t=>{e(t,"inpageVideoAtEnd")}})),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:t,label:"Сохранить"})))))}}gP.propTypes={data:f().object,onChangeInput:f().func,onSaveSettings:f().func,active:f().bool,errors:f().any};const hP=gP;var _P="/index.js";
/**
 * Mirtesen.
 *
 * API interface for Domains.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const EP=class{static checkSiteDomain=(e=null,t)=>(t=JSON.stringify(t),(0,yt.Z)({project:"blog",body:JSON.stringify({query:`query {\n                  checkSiteDomain(siteId: ${e}, prefix: ${t})\n                }`})}).then((e=>{const t=e?.data?.checkSiteDomain||{};if(t.errors&&!t.errors.prefix)throw new Error("Bad response");return JSON.parse(t)})).catch(D.Z.promiseHandler(_P)));static addGroupDomain=(e,t)=>{const n=JSON.stringify(t.prefix),a=t.ignoreDomainNs;return(0,yt.Z)({project:"blog",body:JSON.stringify({query:`mutation {\n                  addGroupDomain(\n                    siteId: ${e},\n                    prefix: ${n},\n                    ${a?`ignoreDomainNs: ${a}`:""}\n                  )\n                }`})}).then((e=>{if(e.data)return JSON.parse(e.data.addGroupDomain)})).catch(D.Z.promiseHandler(_P))};static setGroupMainDomain=(e,t)=>(t=JSON.stringify(t),(0,yt.Z)({project:"blog",body:JSON.stringify({query:`mutation {\n                  setGroupMainDomain(siteId: ${e}, prefix: ${t})\n                }`})}).then((e=>{if(e.data)return JSON.parse(e.data.setGroupMainDomain)})).catch(D.Z.promiseHandler(_P)));static deleteGroupDomain=(e,t)=>(t=JSON.stringify(t),(0,yt.Z)({project:"blog",body:JSON.stringify({query:`mutation {\n                  deleteGroupDomain(siteId: ${e}, prefix: ${t})\n                }`})}).then((e=>{if(e.data)return JSON.parse(e.data.deleteGroupDomain)})).catch(D.Z.promiseHandler(_P)));static getGroupDomains=(e,t={})=>(0,yt.Z)({project:"blog",body:JSON.stringify({query:`query {\n                  getGroupDomains(siteId: ${e})\n                }`}),...t}).then((e=>{if(e.data)return JSON.parse(e.data.getGroupDomains).domains})).catch(D.Z.promiseHandler(_P))};
/**
 * Mirtesen.
 *
 * BlogDomain container.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class fP extends r.Component{handleChangeInput=(e,t)=>{const{handleChangeInput:n}=this.props,{activeTab:a}=this.props.siteSettings;let s=null;if(e.target){s="checkbox"===e.target.type?e.target.checked:e.target.value}else s=e;n(a,t,s)};form={group1:[{className:"form-group_inline",type:"text",name:"mtDomain",labelAfter:".mirtesen.ru"}],group2:[{type:"text",name:"ownDomain",label:"Ваш собственный адрес",labelMuted:r.createElement(r.Fragment,null,"Также Вы можете самостоятельно купить адрес в Интернете.")}]};render(){const{siteSettings:e,handleAddDomain:t,handleCheckDomain:n,handleDeleteDomain:a,handleSetDomain:s,blogDomain:o}=this.props,{errors:i,valid:l}=e,c=e.data.domain,m=this.handleChangeInput;return r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Адреса сайта"),r.createElement("div",{className:"form-section"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Адреса на «МирТесен»",r.createElement("p",{className:"form-text text-muted",color:"muted"},"Вы можете добавить несколько адресов, и по каждому из них пользователи смогут зайти на ваш сайт.")),r.createElement(VS,{error:i[this.form.group1[0].name],valid:l[this.form.group1[0].name],input:this.form.group1[0],value:c[this.form.group1[0].name],onChangeHandle:e=>{m(e,this.form.group1[0].name)}}),r.createElement("div",{className:"form-group"},r.createElement(He.Z,{type:"button",onClick:()=>n(c[this.form.group1[0].name]),label:"Проверить"}),r.createElement(He.Z,{type:"button",onClick:()=>t(c[this.form.group1[0].name],this.form.group1[0].name),label:"Добавить"})),!Sa()(o.thirdLevel)&&r.createElement("ul",{className:"list-group"},o.thirdLevel.map(((e,t)=>r.createElement("li",{key:t,className:"list-group-item"},e.domain,r.createElement("div",{className:"form-group form-group_inline-between"},"main"===e.status?r.createElement("label",null,"Основной"):r.createElement(He.Z,{type:"button",color:"secondary",onClick:()=>s(e.domain),label:"Сделать основным"}),r.createElement(He.Z,{type:"button",color:"secondary",onClick:()=>a(e.domain),label:"Удалить"})))))))),r.createElement("div",{className:"form-section form-section_bottom"},r.createElement(VS,{error:i[this.form.group2[0].name],input:this.form.group2[0],value:c[this.form.group2[0].name],onChangeHandle:e=>{m(e,this.form.group2[0].name)}}),r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:e=>{e.preventDefault(),t(c[this.form.group2[0].name],this.form.group2[0].name,!0)},label:"Сохранить"}),o.technical&&"main"===o.technical.status?r.createElement("label",{className:"align-right"},"Основной"):r.createElement(He.Z,{type:"button",extraClasses:"align-right",color:"secondary",onClick:()=>s(c[this.form.group2[0].name]),label:"Сделать основным"})),!Sa()(o.secondLevel)&&r.createElement("ul",{className:"list-group"},o.secondLevel.map(((e,t)=>r.createElement("li",{key:t,className:"list-group-item"},e.domain,r.createElement("div",{className:"form-group form-group_inline-between align-right"},"main"===e.status&&r.createElement("label",null,"Основной"),"pending"===e.status&&r.createElement("label",null,"На рассмотрении"),!e.status&&r.createElement(He.Z,{type:"button",color:"secondary",onClick:()=>s(e.domain),label:"Сделать основным"}),r.createElement(He.Z,{type:"button",color:"secondary",onClick:()=>a(e.domain),label:"Удалить"}))))))),r.createElement("div",{className:"form-section form-section_bottom"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Технический адрес",r.createElement("p",{className:"form-text text-muted"},"Если другие адреса будут недоступны, по этому адресу вы всегда сможете получить доступ к вашему сайту.")),r.createElement("div",{className:"form-group form-group_inline-between"},o.technical.domain,o.technical&&"main"===o.technical.status?r.createElement("label",{className:"align-right"},"Основной"):r.createElement(He.Z,{type:"button",extraClasses:"align-right",color:"secondary",onClick:()=>s(o.technical.domain),label:"Сделать основным"})))))}}fP.propTypes={onChangeInput:f().func,handleCheckDomain:f().func,handleAddDomain:f().func,handleSetDomain:f().func,handleDeleteDomain:f().func,handleChangeInput:f().func,siteSettings:f().object,blogDomain:f().object};const bP=(0,i.$j)((e=>({siteSettings:e.siteSettings,blogDomain:e.blogDomain})),(e=>({handleCheckDomain:t=>{e((e=>(t,n)=>{const a=n().app.site.id;Promise.resolve(EP.checkSiteDomain(a,e)).then((e=>{if(e.result)t({type:"SITE_SETTINGS_SET_VALIDATION",key:"mtDomain",title:"Домен свободен"});else{const n=Qg()(e.alternatives,"prefix").join(", "),a=L()(e,"errors.prefix","");t({type:"SITE_SETTINGS_SET_ERROR",key:"mtDomain",title:`${a?a+".":""} ${n?"Альтернативные варианты: "+n:""}`})}}))})(t))},handleAddDomain:(t,n,a)=>{e(((e,t,n=!1)=>(a,s)=>{const r=s().app.site.id;Promise.resolve(EP.addGroupDomain(r,{prefix:e,ignoreDomainNs:n})).then((e=>{if(e.result)window.location.reload();else{const n=Qg()(e.alternatives,"prefix").join(", "),s=L()(e,"errors.prefix","");a({type:"SITE_SETTINGS_SET_ERROR",key:t,title:`${s?s+".":""} ${n?"Альтернативные варианты: "+n:""}`})}}))})(t,n,a))},handleDeleteDomain:t=>{e((e=>(t,n)=>{const a=n().app.site.id;Promise.resolve(EP.deleteGroupDomain(a,e)).then((e=>{e.result&&window.location.reload()}))})(t))},handleSetDomain:t=>{e((e=>(t,n)=>{const a=n().app.site.id;Promise.resolve(EP.setGroupMainDomain(a,e)).then((e=>{e.result&&window.location.reload()}))})(t))},handleChangeInput:(t,n,a)=>{e(fu(t,n,a))}})))(fP);
/**
 * Mirtesen.
 *
 * Domain component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class yP extends r.Component{render(){const{active:e}=this.props,t={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!e};return r.createElement("div",{className:_()(t)},r.createElement(bP,null))}}yP.propTypes={active:f().bool};const vP=yP;
/**
 * Mirtesen.
 *
 * Analytics tab component.
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class TP extends r.Component{componentDidUpdate(){this.caretOffset>0&&(this.setCaretPos(this.textarea,this.caretOffset,this.caretOffset),this.caretOffset=0)}handleKeyClick=(e,t)=>{e.preventDefault();const{handleAddKey:n,data:a}=this.props,s=this.textarea;let r=a.text;if(t===this.initialText&&confirm("Вы уверены, что хотите заменить Ваш текст текстом по умолчанию?")&&(r=t),t!==this.initialText){const e=this.getCaretPos(s);r=s.value.slice(0,e)+t+s.value.slice(e),this.caretOffset=e+t.length}s.focus(),n(r)};getCaretPos=e=>{let t=0;if(document.selection){const n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"===e.selectionStart.toString())&&(t=e.selectionStart);return t};setCaretPos=(e,t)=>{if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){const n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}};initialText="Привет, [user_name]!\nДобро пожаловать на сайт [group_name]! Надеюсь, Вам он понравится. Если будут какие-то вопросы -- пишите :-)";caretOffset=0;form={group1:[{type:"radio",name:"enabled",initVal:"true",label:"Включить"},{type:"radio",name:"enabled",initVal:"false",label:"Выключить"}],group2:[{type:"textarea",rows:5,name:"text",label:"Текст сообщения:",labelMuted:r.createElement(r.Fragment,null,r.createElement("p",null,"Вводить только ключи и письменный текст."),r.createElement("p",null,"Ключи (текст в квадратных скобках) позволяют автоматически вставлять в текст фамилию и имя пользователя присоединившегося к сайту."))}]};keys=[{label:"Текст по умолчанию",value:this.initialText},{label:"Имя пользователя",value:"[user_name]"},{label:"Фамилия пользователя",value:"[user_lastname]"},{label:"Адрес сайта",value:"[group_url]"}];render(){const{onSaveSettings:e,onChangeInput:t,data:n,active:a,errors:s}=this.props,o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!a};return r.createElement("div",{className:_()(o)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Личное сообщение от вашего имени",r.createElement("p",{className:"form-text text-muted"},"Это сообщение автоматически отправляется пользователю сразу после того, как он присоединился к сайту.")),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Автоответчик:")),this.form.group1.map(((e,a)=>r.createElement(VS,{error:s[e.name],key:a,input:e,value:n[e.name].toString(),onChangeHandle:n=>{t(n,e.name)}})))),n.enabled&&r.createElement("div",{className:"form-section form-section_top form-section_autoresponder"},this.form.group2[0]&&r.createElement(VS,{innerRef:e=>this.textarea=e,error:s[this.form.group2[0].name],input:this.form.group2[0],value:n[this.form.group2[0].name],onChangeHandle:e=>{t(e,this.form.group2[0].name)}}),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Вставить в текст ключ"),this.keys.map(((e,t)=>r.createElement("button",{key:t,onClick:t=>this.handleKeyClick(t,e.value),className:"site-settings__key-btn",type:"button"},e.label))))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:e,label:"Сохранить"})))))}}TP.propTypes={data:f().object,onChangeInput:f().func,onSaveSettings:f().func,active:f().bool,errors:f().any,handleAddKey:f().func};const SP=(0,i.$j)((e=>({siteSettings:e.siteSettings})),(e=>({handleAddKey:t=>{e((e=>t=>{t(fu("autoresponder","text",e))})(t))}})))(TP),PP=({active:e,type:t,children:n,description:a,onCancel:s,onSave:o,onDelete:i})=>{const l={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!e};return r.createElement("div",{className:_()(l)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"add"===t?"Добавление":"Редактирование:",a&&r.createElement("p",{className:"form-text text-muted",dangerouslySetInnerHTML:{__html:a}})),r.createElement("div",{className:"form-section form-section_top"},n),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{extraClasses:"site-settings__submit",color:"primary",onClick:o,label:"add"===t?"Добавить":"Сохранить"}),r.createElement(He.Z,{type:"button",extraClasses:"site-settings__submit",color:"secondary",onClick:s,label:"Отменить"}),"edit"===t&&r.createElement(He.Z,{type:"button",extraClasses:"right",color:"secondary",onClick:i,label:"Удалить"})))))},wP=(0,r.memo)(PP),IP={group1:[{type:"text",name:"username",label:"Имя канала (@my_channel)",isRequired:!0},{type:"text",name:"signature",label:"Подпись (произвольный текст, добавляемый к тексту импортируемых постов)",isRequired:!1}]},CP=({active:e,errors:t,isDev:n})=>{const a=(0,aa.C)((e=>e.telegramEditor)),s=(0,aa.T)(),{type:o,values:i,editKey:l}=a;return r.createElement(wP,{type:o,active:e,onCancel:()=>s(_u("telegramImport")),onSave:e=>{e.preventDefault(),s(((e,t)=>(n,a)=>{e.username=e.username.replace(/^@/,"");const s=a().siteSettings?.data?.telegramImport||[],r=((e,t,n)=>{const a={};return e.username||(a.username="Поле не может быть пустым"),n.some(((n,a)=>e.username===n.username&&a!==t))&&(a.id="Канал с таким именем уже есть в списке импортов"),a})(e,t,s);if(!Sa()(r))return n(Eu(r));const o=[...s];"number"==typeof t?o[t]=e:o.push(e),n({type:"SITE_SETTINGS_CHANGE_TELEGRAM_IMPORT",list:o}),n(bu("telegramImport"))})(i,l))},onDelete:()=>{return s((e=l,(t,n)=>{t({type:"SITE_SETTINGS_CHANGE_TELEGRAM_IMPORT",list:(n().siteSettings.data.telegramImport||[]).filter(((t,n)=>n!==e))}),t(bu("telegramImport"))}));var e}},r.createElement(r.Fragment,null,Object.keys(IP).map((e=>r.createElement("div",{key:e,className:"form-group"},IP[e].map(((e,a)=>r.createElement(VS,{error:t[e.name],key:a,input:{...e,isDev:n},value:i[e.name],onChangeHandle:({target:t})=>{let n="";t&&(n="checkbox"===t.type?t.checked:t.value,s(((e,t)=>n=>{n({type:"TELEGRAM_EDITOR_CHANGE_VALUE",key:t,value:e}),n(Eu({[t]:""}))})(n,e.name)))}}))))))))},NP=(0,r.memo)(CP),OP=({onSaveSettings:e,active:t})=>{const n=(0,aa.C)((e=>e.siteSettings)),a=(0,aa.T)(),{telegramImport:s}=n.data,o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!t},i=e=>{a((e=>{let t;if(e){const{key:n,item:a}=e;t={type:"edit",values:{...a},editKey:n}}else t={...hm};return{type:"TELEGRAM_EDITOR_INIT_VALUES",state:t}})(e)),a(_u("telegramEditor"))};return r.createElement("div",{className:_()(o)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Список Telgram-каналов",r.createElement("p",{className:"form-text text-muted",dangerouslySetInnerHTML:{__html:'Для того, чтобы посты корректно импортировались из telegram в МТ, необходимо выдать права администратора боту <a href="https://t.me/mt_sync_bot" target=" _blank">@mt_sync_bot</a> в вашем telegram - канале.'}})),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Здесь вы можете создавать, настраивать, а также менять порядок существующих Telegram-каналов"),r.createElement("div",null,r.createElement(He.Z,{label:"Добавить Telegram-канал",color:"primary",type:"button",extraClasses:"site-settings__add-import",onClick:()=>{i()}})))),s?.length>0&&r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Список Telegram-каналов"),r.createElement("ul",{className:"list-group"},s.map(((e,t)=>r.createElement("li",{key:`t-${t}`,className:"rss-list-item list-group-item"},r.createElement("span",{className:"rss-list-item__title"},e.username),1===e.status&&r.createElement("i",{className:"rss-list-item-status active"},"Активный"),5===e.status&&r.createElement("i",{className:"rss-list-item-status error"},"Ошибка. Проверьте канал и права доступа для @mt_sync_bot"),r.createElement(He.Z,{label:"Настройка",color:"secondary",extraClasses:"rss-list-item-edit",type:"button",onClick:()=>{i({key:t,item:e})}}))))))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{label:"Сохранить",color:"primary",type:"submit",onClick:()=>e()})))))},MP=(0,r.memo)(OP);
/**
 * Mirtesen.
 *
 * RssEditor Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const kP=(e,t)=>({type:"RSS_EDITOR_2_CHANGE_VALUE",key:t,value:e}),AP=(e,t)=>({type:"RSS_EDITOR_2_CHANGE_LOADING",value:e,key:t}),xP={group1:[{type:"text",name:"sourceLinkText",label:"Текст ссылки на источник",forDevs:!0},{type:"text",name:"pregTemplateLinkSearch",label:"Preg-шаблон поиска в ссылке RSS",forDevs:!0},{type:"text",name:"pregTemplateLinkChange",label:"Preg-шаблон замены в ссылке RSS",forDevs:!0}]},LP=({onChangeInput:e,onSaveSettings:t,active:n,isDev:a,errors:s})=>{const o=(0,aa.C)((e=>e.siteSettings)),i=(0,aa.T)(),{rssImport:l}=o.data,c={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!n},m=e=>{i((e=>{let t;if(e){const{key:n,item:a}=e;t={type:"edit",values:{...a},editKey:n}}else t={...Sc};return{type:"RSS_EDITOR_2_INIT_VALUES",state:t}})(e)),i(_u("rssEditor"))};return r.createElement("div",{className:_()(c)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Список RSS"),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Здесь вы можете создавать, настраивать, а также менять порядок существующих RSS"),r.createElement("div",null,r.createElement(He.Z,{label:"Добавить RSS-фид",color:"primary",type:"button",extraClasses:"site-settings__add-import",onClick:()=>{m()}})))),l?.list?.length>0&&r.createElement("div",{className:"form-section form-section_top"},l?.list?.length>0&&r.createElement("div",{className:"form-group"},r.createElement("label",null,"Список RSS"),r.createElement("ul",{className:"list-group"},l.list.map(((e,t)=>r.createElement("li",{key:`r-${t}`,className:"rss-list-item list-group-item"},r.createElement("span",{className:"rss-list-item__title"},e.rssSourceLink&&y.Z.truncateString(e.rssSourceLink,45)),r.createElement(He.Z,{label:"Настройка",color:"secondary",extraClasses:"rss-list-item-edit",type:"button",onClick:()=>{m({key:t,item:e})}}))))))),a&&r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},xP.group1.map(((t,n)=>r.createElement(VS,{error:s[t.name],key:n,input:{...t,isDev:a},value:l[t.name],onChangeHandle:n=>{e(n,t.name)}}))))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{label:"Сохранить",color:"primary",type:"submit",onClick:()=>t()})))))},DP=(0,r.memo)(LP),RP={group1:[{type:"text",name:"rssSourceLink",label:"Ссылка на rss"}],group2:[{type:"checkbox",name:"useFullText",label:"Использовать полный текст записи при его наличии"},{type:"checkbox",name:"useShortDesctiption",label:"Использовать краткое описание как лид-абзац"},{type:"checkbox",name:"ignoreMediaTags",label:"Игнорировать media теги"},{type:"checkbox",name:"autoRefreshImportedThemes",label:"Автоматически обновлять импортированные темы",forDevs:!0}],group3:[{type:"text",name:"maxTextLength",label:"Обрезать текст (количество символов)"},{type:"text",name:"publicationDelay",label:"Задержка публикации (в секундах)"},{type:"text",name:"pregTemplateTextSearch",label:"Preg-шаблон поиска в тексте RSS",forDevs:!0},{type:"text",name:"pregTemplateTextChange",label:"Preg-шаблон замены в тексте RSS",forDevs:!0},{type:"text",name:"xpathLongText",label:"XPath-выражение для полного текста",forDevs:!0}],group4:[{type:"checkbox",name:"keepImages",label:"Не вырезать картинки",forDevs:!0},{type:"checkbox",name:"keepLinks",label:"Не вырезать ссылки",forDevs:!0},{type:"checkbox",name:"keepIframes",label:"Не вырезать iframe-ы",forDevs:!0},{type:"checkbox",name:"useEmbedCode",label:"Использовать тег embed_code",forDevs:!0},{type:"checkbox",name:"useYandexTurbo",label:"Использовать Турбо-страницы",forDevs:!0},{type:"checkbox",name:"addYandexGenreTags",label:"Добавлять yandex:genre в ключевые слова",forDevs:!0}],group5:[{type:"text",name:"xpathImage",label:"XPath-выражение для картинки",forDevs:!0},{type:"text",name:"showCategory",label:"Выставить категорию",forDevs:!0},{type:"text",name:"importCategory",label:"Импортировать категорию",forDevs:!0},{type:"text",name:"loadingTimout",label:"Таймаут загрузки (сек)",forDevs:!0}]},ZP=({active:e,errors:t,isDev:n})=>{const a=(0,aa.C)((e=>e.rssEditor)),s=(0,aa.T)(),{type:o,values:i,loading:l,editKey:c}=a;return r.createElement(wP,{type:o,active:e,onCancel:()=>s(_u("rssImport")),onSave:e=>{e.preventDefault(),s(((e,t)=>(n,a)=>{const s=a(),{list:r}=s.siteSettings.data.rssImport;"number"==typeof t?r[t]=e:(r.push(e),n({type:"SITE_SETTINGS_CHANGE_RSS_LIST",list:r})),n(bu("rssImport"))})(i,c))},onDelete:()=>{return s((e=c,(t,n)=>{const a=n();let{list:s}=a.siteSettings.data.rssImport;s=s.filter(((t,n)=>n!==e)),t({type:"SITE_SETTINGS_CHANGE_RSS_LIST",list:s}),t(bu("rssImport"))}));var e}},r.createElement(r.Fragment,null,Object.keys(RP).map((e=>r.createElement("div",{key:e,className:"form-group"},RP[e].map(((e,a)=>r.createElement(VS,{error:t[e.name],key:a,input:{...e,isDev:n},value:i[e.name],onChangeHandle:({target:t})=>{console.dir(t);let n="";t&&(n="checkbox"===t.type?t.checked:t.value,s(kP(n,e.name)))}})))))),r.createElement("div",{className:"position-relative form-group"},r.createElement("label",null,"Картинка по умолчанию"),(i.defaultImage||l.defaultImage)&&r.createElement("div",{className:"site-settings__image"},r.createElement("div",{className:"site-settings__image__thumb",style:{backgroundImage:i.defaultImage?"url("+i.defaultImage+")":"none"}},l.defaultImage&&r.createElement("div",{className:"site-settings__image__loading"},r.createElement("svg",{style:{width:32,height:32}},r.createElement("use",{href:"/images/icons.svg#spinner"})),"Загрузка..."),r.createElement("svg",{className:"svg-icon large site-settings__image__remove",onClick:()=>{s(kP("","defaultImage"))}},r.createElement("use",{href:"/images/icons.svg#times-circle"})))),r.createElement("div",{className:"form-group_inline-between position-relative form-group"},r.createElement("input",{name:"defaultImage",type:"file",className:"form-control-file",onChange:e=>{return s((t=e.target.files,e=>{const n="defaultImage";e(AP(!0,n));const a=window.URL.createObjectURL(t?.[0]);fetch(a).then((e=>e.blob())).then((e=>{const t=new window.FormData;t.append("query","mutation {uploadPhoto {id, photo_original}}"),t.append("photo",e);const n={project:"main",body:t};return(0,yt.Z)(n)})).then((e=>{if(!e)throw new Error("image bad response");return e?.data?.uploadPhoto?.photo_original})).then((t=>{t&&e(kP(t,n)),e(AP(!1,n))})).catch((t=>{D.Z.promiseHandler("/index.js")(t),e(kP("",n)),e(AP(!1,n))}))}));var t}})))))},BP=(0,r.memo)(ZP);var $P=n(40564),UP=n.n($P),HP=(n(88921),n(96248),n(13599),n(11477),n(64362),n(15389),n(90401),n(45164),n(91238),n(54837),n(87485),n(56767),n(76651),n(61437),n(35285),n(39865),n(45220)),FP=n.n(HP),jP="/index.js";
/**
 * Mirtesen.
 *
 * Site Sections Actions.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const GP=()=>async(e,t)=>{try{const n=t(),{app:a,blogMenuSettings:s}=n,{menuItems:r,staticWidgetsToRemove:o}=s,{siteBuilder:i}=a,l=L()(a,"site.id");let c;i.mainMenu.items=r,o&&o.map((async e=>{c=await Promise.resolve(Up.deleteStaticPage(e))})),c=await Promise.resolve(Xo.Z.setSiteSettings(l,i)),e(zP(c))}catch(e){kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(jP)(e)}},qP=e=>(t,n)=>{const a=n(),{blogMenuSettings:s}=a,{staticWidgetsToRemove:r}=s;let{menuItems:o}=s;const i=o[e];o=o.filter(((t,n)=>e!==n)),t({type:"BLOG_MENU_SETTINGS_SET_MENU_ITEMS",menuItems:o}),i.main_widget_id&&(r.push(i.main_widget_id),t({type:"BLOG_MENU_SETTINGS_REMOVE_STATIC",staticWidgetsToRemove:[...new Set(r)]}))},VP=e=>({type:"BLOG_MENU_SETTINGS_SET_INPUT_ERRORS",errors:e}),zP=e=>t=>{!e||e.errors?(t(VP(e.errors)),kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e.message||"При сохранении произошла ошибка"})):(t({type:"BLOG_MENU_SETTINGS_SAVE_SUCCESS"}),setTimeout((()=>window.location.reload()),500))};
/**
 * Mirtesen.
 *
 * Site Sections Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class WP extends r.Component{componentDidMount(){const{handleInit:e}=this.props;e(),window.addEventListener("beforeunload",this.handleBeforeUnload)}componentWillUnmount(){window.removeEventListener("beforeunload",this.handleBeforeUnload)}handleBeforeUnload=e=>{const{blogMenuSettings:{isChanged:t}}=this.props;return!t||(e.returnValue="Changed","Changed")};render(){const{active:e,blogMenuSettings:t,handleSaveMenu:n,handleSortByDrag:a,handleSortByClick:s,handleEditMenuItem:o,handleDeleteMenuItem:i}=this.props,{menuItems:l,isChanged:c}=t,m={"site-settings__wrapper2":!0,"site-settings__wrapper_hidden":!e};return r.createElement("div",{className:_()(m)},r.createElement("div",{className:"site-settings-blog-menu"},r.createElement("h1",{className:"form-title"},"Меню сайта"),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Здесь вы можете создавать, настраивать, а также менять порядок разделов сайта"),r.createElement("div",null,r.createElement(He.Z,{onClick:()=>{o(),window.scrollTo(0,0)},label:"Добавить раздел"})))),r.createElement("div",{className:""},r.createElement(UP(),{onSort:e=>{a(e)},dynamic:!0,className:"sortable-container"},l.map(((e,t)=>"-1"===e.main_widget_id?null:r.createElement($P.SortableContainer,{key:t,sortData:e,className:"sortable-container__item"},r.createElement("div",null,r.createElement("div",{className:"sortable-container__item-left"},e.title),r.createElement("div",{className:"sortable-container__item-right"},r.createElement(He.Z,{extraClasses:"sortable-container__item-delete",onClick:()=>{i(t)},label:"Удалить"}),r.createElement(He.Z,{color:"secondary",onClick:()=>{o(t),window.scrollTo(0,0)},label:"Настройка"}),r.createElement("div",{className:"sortable-container__item-arrows"},r.createElement("div",{className:"sortable-container__arrow-up",onClick:()=>{s(t,"toUp")}},r.createElement(yn.Z,{iconName:"triangular-arrow-up"})),r.createElement("div",{className:"sortable-container__arrow-down",onClick:()=>{s(t,"toDown")}},r.createElement(yn.Z,{iconName:"triangular-arrow-down"}))))))))),c&&r.createElement("div",{className:"sortable-container__save-actions"},r.createElement(He.Z,{onClick:n,label:"Сохранить"}),r.createElement(He.Z,{color:"secondary",onClick:()=>window.location.reload(),label:"Отменить"}))))}}WP.propTypes={active:f().bool,handleSaveMenu:f().func,handleSortByDrag:f().func,handleSortByClick:f().func,blogMenuSettings:f().object,handleDeleteMenuItem:f().func,handleInit:f().func,handleEditMenuItem:f().func};const YP=(0,i.$j)((e=>({blogMenuSettings:e.blogMenuSettings})),(e=>({handleInit:()=>{e(((e,t)=>{const n=t(),{app:a}=n;return e({type:"BLOG_MENU_SETTINGS_INIT",menuItems:L()(a,"siteBuilder.mainMenu.items")})}))},handleEditMenuItem:(t=null)=>{e((e=>async(t,n)=>{const a=n(),{app:s,blogMenuSettings:{menuItems:r},blogDomain:o}=a,i=s.site.id;let l={...Ki};if(FP()(e)||(l={...l,...r[e]}),l.main_widget_id){const e=await Promise.resolve(Up.getStaticPage(i,l.main_widget_id));l={...l,...e}}if(l.url){let e=l.url;if("url"===l.type){const t=new(Lp())(e);e=t.href,(o.thirdLevel||[]).map((n=>{n.domain.toLowerCase()===t.hostname&&(e=t.pathname+t.query+t.hash)}))}else{if(e.match(/^http[s]?/)){const t=new(Lp())(e);e=t.pathname}e=e.replace(/^\//,""),e=e.replace(/^_\//,"")}l.url=e}let c,m=L()(l,"tags",[]),d=L()(l,"stop_tags",[]);m=Array.isArray(m)?m:m.split(","),d=Array.isArray(d)?d:d.split(","),m=m.filter((e=>e&&0!==e.length)),d=d.filter((e=>e&&0!==e.length)),l.tags=m,l.stop_tags=d;try{c=JSON.parse(l.seo_data)}catch(e){c={}}c=c||{},l={...l,...c},await t({type:"BLOG_MENU_SETTINGS_INIT_EDITOR",menuItem:l,currentIndex:e}),t(_u("menuEditor"))})(t))},handleSaveMenu:()=>{e(GP())},handleSortByDrag:t=>{e((e=>({type:"BLOG_MENU_SETTINGS_SET_MENU_ITEMS",menuItems:e}))(t))},handleSortByClick:(t,n)=>{e(((e,t)=>(n,a)=>{const s=a(),{blogMenuSettings:{menuItems:r}}=s,o=r.length;let i;i="toUp"===t?0===e?o-1:e-1:e+1===o?0:e+1;const l=r[e];return r[e]={...r[i]},r[i]={...l},n({type:"BLOG_MENU_SETTINGS_SET_MENU_ITEMS",menuItems:r})})(t,n))},handleDeleteMenuItem:t=>{e(qP(t))}})))(WP);
/**
 * Mirtesen.
 *
 * Site Sections Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class KP extends r.Component{render(){const{onChangeTags:e,onSaveMenuItem:t,onChangeTab:n,onDeleteMenuItem:a,onChangeText:s,blogMenuSettings:o,active:i,onChangeInput:l}=this.props,{menuItem:c,currentIndex:m,errors:d}=o;let p=null;const u={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!i},g=o.context[FP()(m)?"add":"edit"],h={group1:[{type:"text",name:"title",label:"Заголовок",isRequired:!0}],group2:[{type:"radio",name:"type",label:"Cписок постов",initVal:"posts"},{type:"radio",name:"type",label:"Текстовый раздел",initVal:"page"},{type:"radio",name:"type",label:"Ссылка на страницу",initVal:"url"}],group3:[{type:"text",name:"url",label:"Адрес страницы",isRequired:!0,labelMuted:r.createElement(r.Fragment,null,"Ссылка на внешнюю страницу. Например: https://www.youtube.com/")}],group4:[{type:"textarea",rows:3,name:"seoDescription",label:"Описание раздела"}],group5:[{type:"textarea",rows:3,name:"seoKeywords",label:"Ключевые слова раздела"}],group6:[{type:"textarea",rows:3,name:"seoTitle",label:"Название раздела"}]};return"posts"===c.type?(h.group3[0].labelMuted=r.createElement(r.Fragment,null,"Идентификатор внутренней страницы вашего сайта. Например: st-petersburg, cookies, sport, moon..."),p=r.createElement("div",{className:"form-group"},r.createElement("label",null,"Фильтр по категориям"),r.createElement("p",{className:"form-text text-muted"},"Список категорий через запятую, в разрезе которых будет отображаться содержимое блока. Пустой список - фильтр выключен."),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Контент, только содержащий ключевые слова:"),r.createElement(aT,{helper:"Используйте Tab или Enter чтобы завершить ввод",placeholder:"Новый тег...",tags:c.tags||[],onChangeInput:t=>e(t,"tags")})),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Всё, кроме контента, содержащего ключевые слова:"),r.createElement(aT,{helper:"Используйте Tab или Enter чтобы завершить ввод",placeholder:"Новый тег...",tags:c.stop_tags||[],onChangeInput:t=>e(t,"stop_tags")})))):"page"===c.type&&(h.group3[0].labelMuted=r.createElement(r.Fragment,null,"Идентификатор внутренней страницы вашего сайта. Например: st-petersburg, cookies, sport, moon..."),p=r.createElement("div",{className:"form-group"},r.createElement("label",null,"Содержание страницы:"),r.createElement(ST,{initialValue:c.html,init:{min_height:350,max_height:700,toolbar:"undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent blockquote | paste | removeformat | image code"},onChange:s}))),r.createElement("div",{className:_()(u)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"number"==typeof c.itemId?`${g.title} ${c.title}`:g.title),r.createElement("div",{className:"form-section form-section_top"},r.createElement(VS,{error:d[h.group1[0].name],input:h.group1[0],value:c[h.group1[0].name],onChangeHandle:l}),r.createElement("div",{className:"form-group"},r.createElement("label",null,"Тип раздела"),h.group2.map(((e,t)=>r.createElement(VS,{error:d[e.name],key:t,input:e,value:c[e.name],onChangeHandle:l})))),r.createElement(VS,{error:d[h.group3[0].name],input:h.group3[0],value:c[h.group3[0].name],onChangeHandle:l}),p),pd.isDeveloper()&&"url"!==c.type&&r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group yellow-form"},r.createElement("label",null,"Настройки SEO"),r.createElement(VS,{error:d[h.group6[0].name],input:h.group6[0],value:c[h.group6[0].name],onChangeHandle:l}),r.createElement(VS,{error:d[h.group4[0].name],input:h.group4[0],value:c[h.group4[0].name],onChangeHandle:l}),r.createElement(VS,{error:d[h.group5[0].name],input:h.group5[0],value:c[h.group5[0].name],onChangeHandle:l}))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:e=>{e.preventDefault(),t()},label:g.saveButton}),r.createElement(He.Z,{color:"secondary",onClick:()=>{n("menu"),window.scrollTo(0,0)},label:"Отменить"}),m?r.createElement(He.Z,{extraClasses:"site-settings__back-btn right",onClick:()=>a(m),label:"Удалить раздел"}):null))))}}KP.propTypes={active:f().bool,blogMenuSettings:f().object,onChangeTags:f().func,onChangeInput:f().func,onSaveMenuItem:f().func,onDeleteMenuItem:f().func,onChangeTab:f().func,errors:f().any,onChangeText:f().func,handleTogglePopup:f().func};const JP=(0,i.$j)((e=>({blogMenuSettings:e.blogMenuSettings})),(e=>({onChangeTab:t=>{e(_u(t))},onChangeInput:t=>{var n;e((n=t,(e,t)=>{const{menuItem:a,errors:s}=t().blogMenuSettings,{name:r,value:o}=n.target;s[r]=void 0,a[r]=o,e({type:"BLOG_MENU_SETTINGS_CHANGE_VALUE",errors:s,menuItem:a})}))},onChangeTags:(t,n)=>{e(((e,t)=>(n,a)=>{const{menuItem:s}=a().blogMenuSettings;return n({type:"BLOG_MENU_SETTINGS_CHANGE_VALUE",menuItem:{...s,[t]:e}})})(t,n))},onSaveMenuItem:()=>{e((async(e,t)=>{try{const n=t(),{blogDomain:a,app:s,blogMenuSettings:r}=n,{menuItems:o,menuItem:i,currentIndex:l}=r;let{}=r;const{siteBuilder:c}=s,m=L()(s,"site.id"),d={...i},p=[...o];if(!d.title)return void e(VP({title:"Заголовок не может быть пустым"}));if(!d.url)return void e(VP({url:"Адрес страницы не может быть пустым"}));const u=new(Lp())(d.url);if(!u)return void e(VP({url:"Проверьте формат адреса страницы"}));if("url"!==d.type&&d.url.match(/^http[s]?|^[\/]{2}/))return void e(VP({url:"Не используйте ссылки href://youtube.com/... в качестве идентификатора страницы"}));if("url"===d.type){let e=u.href;(a.thirdLevel||[]).map((t=>{t.domain.toLowerCase()===u.hostname&&(e=u.pathname+u.query+u.hash)})),d.url=e}else d.url="/_/"+d.url.replace(/^\//,"");const g=d.tags.map((e=>e.trim())).filter((e=>e&&e.length>0)).join(","),h=d.stop_tags.map((e=>e.trim())).filter((e=>e&&e.length>0)).join(",");let _;if(d.tags=g,d.stop_tags=h,FP()(l)?p.push(d):p[l]=d,c.mainMenu.items=p,"page"===d.type){const e={pageId:d.main_widget_id||null,pageTitle:d.title,pageUrl:d.url,pageHtml:y.Z.toBase64(d.html),seoDescription:d.seoDescription,seoKeywords:d.seoKeywords,seoTitle:d.seoTitle};_=await Up.setStaticPage(m,e)}else _=await Promise.resolve(Xo.Z.setSiteSettings(m,c));e(zP(_))}catch(e){kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(jP)(e)}}))},onDeleteMenuItem:t=>{e(qP(t)),e(GP())},onChangeText:t=>{e((e=>({html:e.target.getContent(),type:"BLOG_MENU_SETTINGS_CHANGE_HTML"}))(t))}})))(KP);
/**
 * Mirtesen.
 *
 * Site Settings Container.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class XP extends r.Component{componentDidMount(){window.addEventListener("beforeunload",this.handleBeforeUnload)}componentWillUnmount(){window.removeEventListener("beforeunload",this.handleBeforeUnload)}handleChangeInput=(e,t)=>{const{handleChangeInput:n}=this.props,{activeTab:a}=this.props.siteSettings;let s=null;const r=e.target;s=r?"checkbox"===r.type?r.checked:"true"===r.value||"false"===r.value?JSON.parse(r.value):r.value:e,n(a,t,s)};handleChangeTab=e=>{const{handleChangeTab:t}=this.props;t(e)};handleSaveSettings=e=>{e.preventDefault();const{handleSaveSettings:t}=this.props,{activeTab:n}=this.props.siteSettings;t(n)};handleBeforeUnload=e=>{const{sections:t}=this.props.siteSettings;let n=!1;return Object.keys(t).map((e=>{t[e].changed&&(n=!0)})),!n||((e||window.event).returnValue=null,null)};containers={about:XS,permissions:eP,analytics:nP,menu:YP,autoresponder:SP,menuEditor:JP,vk:sP,rssFeed:oP,rssEditor:BP,telegramEditor:NP,rssImport:DP,telegramImport:MP,smi2:dP,html:WS,domain:vP,notifications:uP,adSettings:hP,robots:cP};render(){const{data:e,sections:t,activeTab:n,errors:a,valid:s}=this.props.siteSettings,{app:o}=this.props,i=this.containers;return r.createElement("div",{className:"site-settings"},Object.keys(t).map((l=>{const c=t[l],m=i[l];return!m||c.forDevs&&!pd.isDeveloper()?null:r.createElement(m,{key:l,active:l===n,data:e[l],valid:s,errors:a,onChangeInput:this.handleChangeInput,onChangeTab:this.handleChangeTab,onSaveSettings:this.handleSaveSettings,isDev:pd.isDeveloper(),app:o})})))}}XP.propTypes={handleChangeInput:f().func,handleChangeTab:f().func,handleSaveSettings:f().func,app:f().object,siteSettings:f().object};const QP=(0,i.$j)((e=>({siteSettings:e.siteSettings,app:e.app})),(e=>({handleChangeInput:(t,n,a)=>{e(fu(t,n,a))},handleChangeTab:t=>{e(_u(t))},handleSaveSettings:t=>{e(bu(t))}})))((0,ae.Z)(XP,"siteSetting"));
/**
 * Mirtesen.
 *
 * Static Page Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ew extends r.Component{render(){const{html:e,title:t}=this.props.staticPage;return r.createElement("div",{className:"static-page"},r.createElement("h1",{className:"static-page__title"},t),r.createElement("div",{className:"static-page__content",dangerouslySetInnerHTML:{__html:e}}))}}ew.propTypes={staticPage:f().object,app:f().object};const tw=(0,i.$j)((e=>({staticPage:e.staticPage,app:e.app})),(()=>({})))((0,ae.Z)(ew,"staticPage"));var nw="/index.js";
/**
 * Mirtesen.
 *
 * Comments list actions.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const aw={},sw=e=>e[e.length-1]?.id,rw={type:"BLOG_COMMENT_PAGE_HIDE_MODAL"},ow=()=>(e,t)=>{const n=t(),{id:a}=n.app.site,s=`comments_${a}`;aw[s]||"undefined"==typeof window||(aw[s]=!0,"development"!==Rp().mode&&jd.subscribe(s,(()=>{e(((e,t)=>{const n=t(),{id:a}=n.app.site;Promise.resolve(dh.Z.getLastBlogComments({id:a,count:1})).then((t=>{e({type:"BLOG_COMMENT_PAGE_NEW_COMMENT",comments:t.items})})).catch(D.Z.promiseHandler(nw))}))})))};
/**
 * Mirtesen.
 *
 * Comments list container.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class iw extends r.Component{componentDidMount(){const{handleInitializeLongPool:e}=this.props;e()}getCommentImage(e){return L()(e,"images[0].url")}render(){const{blogCommentPage:e,onShowMoreComments:t}=this.props,{items:n,hasMoreItems:a,page:s}=e,o=r.createElement("div",{className:"blog-post-list__loader"},r.createElement("img",{src:"//static.mtml.ru/images/loader.svg",alt:"Загружается..."}));return r.createElement(zn,{pageStart:0,loadMore:()=>{if(a)return t(25+25*(s-1),25)},hasMore:a,loader:o,threshold:400},r.createElement("div",{className:"comment-list"},n.length<1&&!a&&r.createElement("article",{className:"blog-post blog-post__no-posts",key:0},"Здесь пока ничего нет"),n.map(((e,t)=>{const n=this.getCommentImage(e);return r.createElement(dE,{key:t,className:"comment"},r.createElement("div",{className:"comment_header"},r.createElement("div",{className:"comment_header__info"},r.createElement(cg,{className:"comment_header__user",userId:e.user?.id,tagName:"span"},r.createElement(Mn.Z,{logoInfo:{userName:e.user?.display_name,logoImg:e.user?.photo_original,logoUrl:`//mirtesen.ru/people/${e.user?.id}`,linkTarget:"_blank",logoClassName:"userlogo_s"}}),r.createElement("span",{className:"comment_header__user__name"},r.createElement("a",{href:`//mirtesen.ru/people/${e.user?.id}`,target:"_blank"},e.user?.display_name))),r.createElement("a",{href:`/comments/${e.id}/page`,className:"comment_header__date"},r.createElement(s_,{date:e.date,format:"D MMMM, H:mm"})))),r.createElement("div",{onClick:()=>{window.location.href=e.blog_post?.seo_url},className:"comment_content"},e.show_raw?r.createElement("span",{className:"comment_content__text",dangerouslySetInnerHTML:{__html:e.text}}):r.createElement("span",{className:"comment_content__text"},e.text),n&&r.createElement(kn.Z,{src:n,className:"comment_content__image"}),r.createElement("span",{className:"comment_content__post-title"},e.blog_post?.title)))}))))}}iw.propTypes={blogCommentPage:f().object,onShowMoreComments:f().func,handleHidePopover:f().func,onAbuseUser:f().func,onDeleteComment:f().func,onBanUser:f().func,handleCloseInteractivePopup:f().func,onRestoreComment:f().func,handleInitializeLongPool:f().func};const lw=(0,i.$j)((e=>({blogCommentPage:e.blogCommentPage,auth:e.auth})),(e=>({onShowMoreComments:(t,n)=>{e((e=>(t,n)=>{const a=n(),s=a.app.site.id,r=a.blogCommentPage.page,o=a.blogCommentPage.items;Promise.resolve(dh.Z.getLastBlogComments({siteId:s,count:e,fromMessageId:sw(o)})).then((e=>t({type:"BLOG_COMMENT_PAGE_GET",items:[...a.blogCommentPage.items,...e.items],page:r+1,hasMoreItems:e.items.length>=25}))).catch(D.Z.promiseHandler(nw))})(t))},handleHidePopover:()=>{e(rw)},onAbuseUser:t=>{e(((e,t=0)=>n=>{eu.abuseUser(e).then((e=>{e&&"undefined"!==e&&n({type:"BLOG_COMMENT_PAGE_ABUSE_USER",commentId:t})})).catch(D.Z.promiseHandler(nw))})(t))},onDeleteComment:(t,n)=>{e(((e,t)=>(n,a)=>{const{app:s}=a(),r=-1*s.site.id;dh.Z.deleteComment(1,r,t,e).then((t=>{t&&"undefined"!==t&&n({type:"BLOG_COMMENT_PAGE_DELETE_COMMENT",commentId:e})})).catch(D.Z.promiseHandler(nw))})(t,n))},onBanUser:(t,n,a)=>{e(((e,t,n)=>(a,s)=>{const{app:r}=s(),o=r.site.id;(new ms).banUser(e,o,n).then((e=>{e&&"undefined"!==e&&a({type:"BLOG_COMMENT_PAGE_BAN_USER",commentId:t})})).catch(D.Z.promiseHandler(nw))})(t,n,a))},handleCloseInteractivePopup:(t,n)=>{e(((e,t)=>({type:"BLOG_COMMENT_PAGE_CLOSE_INTERACTIVE_POPUP",popupSort:e,commentId:t}))(t,n))},onRestoreComment:t=>{e((e=>t=>{dh.Z.restoreComment(e).then((n=>{n&&"undefined"!==n&&t({type:"BLOG_COMMENT_PAGE_CLOSE_INTERACTIVE_POPUP",popupSort:"isDeleted",commentId:e})})).catch(D.Z.promiseHandler(nw))})(t))},handleInitializeLongPool:()=>{e(ow())}})))((0,ae.Z)(iw,"cpmmentsList"));
/**
 * Mirtesen.
 *
 * Ad tab component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class cw extends r.Component{handleToggleStatus=e=>{const{onSaveSettings:t}=this.props,n="STATUS_ACTIVE"===e.status?"STATUS_PENDING":"STATUS_ACTIVE";t({id:e.id,update:!0,status:n},"item")};render(){const{active:e,currentBalance:t,spentBalance:n,groupItem:a,blogpostItems:s,onItemForm:o,onItemAddForm:i,onDepositForm:l}=this.props,c={"promotion-settings__wrapper":!0,"promotion-settings__wrapper_hidden":!e},m={"promotion-settings__balance__header__title":!0,"promotion-settings-status":!0,"promotion-settings-status__active":"STATUS_ACTIVE"===a.status,"promotion-settings-status__inactive":"STATUS_ACTIVE"!==a.status};return r.createElement("div",{className:_()(c)},r.createElement("div",{className:"promotion-settings__section"},r.createElement("h1",{className:"promotion-settings__section__title"},"Общие настройки сайта"),r.createElement("div",{className:"promotion-settings__group2"},r.createElement("div",{className:"promotion-settings__group2__col-6"},r.createElement("div",{className:"promotion-settings__balance__header"},r.createElement("div",{className:"promotion-settings__balance__header__title"},"Баланс"),r.createElement("div",{className:"promotion-settings__balance__header__form"},r.createElement(He.Z,{color:"secondary",type:"button",onClick:()=>l(),label:"Пополнить"}))),r.createElement("div",{className:"promotion-settings__balance__value"},t.toFixed(2)," кр."),r.createElement("div",{className:"promotion-settings__balance__info"},r.createElement("div",{className:"promotion-settings__balance__info__title"},"Потрачено:"),r.createElement("div",{className:"promotion-settings__balance__info__content"},r.createElement("span",null,"Всего:")," ",n.toFixed(2)," кр."))),r.createElement("div",{className:"promotion-settings__group2__col-6"},r.createElement("div",{className:"promotion-settings__balance__header"},r.createElement("div",{className:_()(m)},"STATUS_ACTIVE"===a.status?"Активен":"Неактивен"),r.createElement("div",{className:"promotion-settings__balance__header__form"},r.createElement(He.Z,{color:"secondary",type:"button",onClick:()=>{o(a)},label:"Настроить"}))),r.createElement("div",{className:"promotion-settings-info"},r.createElement("table",null,r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",null,"Общий лимит"),r.createElement("td",null,a.fullClicksLimit)),r.createElement("tr",null,r.createElement("td",null,"Суточный лимит"),r.createElement("td",null,a.dayClicksLimit)),r.createElement("tr",null,r.createElement("td",null,"Стоимость перехода"),r.createElement("td",null,a.clickPrice)))))))),r.createElement("div",{className:"promotion-settings__section"},r.createElement("h1",{className:"promotion-settings__section__title"},"Объекты продвижения"),r.createElement("div",{className:"promotion-settings-actionsbar"},r.createElement("div",{className:"promotion-settings-actionsbar__status"}),r.createElement("div",{className:"promotion-settings-actionsbar__add"},r.createElement(He.Z,{type:"button",onClick:()=>i(),label:"Добавить объект"}))),s.length>0&&r.createElement("table",{className:"promotion-settings__table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"Объект"),r.createElement("th",null,"Статус"),r.createElement("th",null,"Клики"),r.createElement("th",null,"Ротация"))),r.createElement("tbody",null,s.map(((e,t)=>r.createElement("tr",{key:t},r.createElement("td",null,e.title),r.createElement("td",null,r.createElement("div",{className:"STATUS_ACTIVE"===e.status?"promotion-settings-status promotion-settings-status__active":"promotion-settings-status promotion-settings-status__inactive"})),r.createElement("td",null,e.fullClicks),r.createElement("td",null,r.createElement("div",{className:"promotion-settings-tooltip-placeholder"},e.inRotation?"Да":"Нет"),r.createElement("div",{className:"promotion-settings-tooltip"},r.createElement("button",{type:"button",className:"promotion-settings-tooltip__button"},r.createElement("span",null),r.createElement("span",null),r.createElement("span",null)),r.createElement("div",{className:"promotion-settings-tooltip__list"},r.createElement("div",{className:"promotion-settings-tooltip__list__wrap"},r.createElement("span",{onClick:()=>{o(e)}},"Настроить"),e.canChangeStatus&&r.createElement("span",{onClick:()=>{this.handleToggleStatus(e)}},"STATUS_ACTIVE"===e.status?"Остановить ротацию":"Запустить ротацию"))))))))))))}}cw.propTypes={currentBalance:f().number,spentBalance:f().number,groupItem:f().object,blogpostItems:f().array,user:f().object,onItemForm:f().func,onItemAddForm:f().func,onDepositForm:f().func,onSaveSettings:f().func,active:f().bool,errors:f().any};const mw=(0,i.$j)((e=>({currentBalance:e.promotion.data.settings.currentBalance,spentBalance:e.promotion.data.settings.spentBalance,groupItem:e.promotion.data.settings.groupItem,blogpostItems:e.promotion.data.settings.blogpostItems,user:e.auth.user})),null)(cw);function dw(){return dw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},dw.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * FormInput.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class pw extends r.Component{static propTypes={id:f().string,name:f().string,type:f().string,value:f().oneOfType([f().string,f().number]),onChange:f().func,onClick:f().func,error:f().string,label:f().string,min:f().number,max:f().number,multiple:f().bool,children:f().node};render(){const{id:e,name:t,type:n,value:a,onChange:s,onClick:o,error:i,label:l,min:c,max:m,multiple:d,children:p}=this.props,u=null==a?void 0:a+"",g={"promotion-settings-input":!0,"is-invalid":!!i,"is-empty":!u,"is-no-label":!l},h={className:"form-control",type:n,name:t,value:u,id:e,onChange:s,onClick:o,multiple:d,required:"text"===n};return r.createElement("div",{className:_()("form-group",g),onClick:o},p?r.createElement("select",h,p):r.createElement("input",dw({min:c,max:m},h)),r.createElement("label",{className:"promotion-settings-input-label promotion-settings-input-label-default",htmlFor:e},l),r.createElement("div",{className:"promotion-settings-input-label promotion-settings-input-label-error"},i))}}const uw=pw,gw=N((()=>Promise.all([n.e(186).then(n.t.bind(n,9198,23)),n.e(202).then(n.bind(n,44308))]).then((([e])=>e))),"reactDatepicker");class hw extends r.Component{handleChangeTimeTargeting=(e,t,n)=>{const{data:a,onChangeInput:s}=this.props;let r=(a.targetTime||this.targetTimeDefault).split("");const o=r.length,i=n?"1":"0";if(null===e&&null===t)for(let e=0;e<o;e++)r[e]=i;else if(null===t)for(let t=0;t<7;t++)r[24*t+e]=i;else if(null===e)for(let e=0;e<24;e++)r[24*t+e]=i;else r[24*t+e]=i;r=r.join(""),r===this.targetTimeDefault&&(r=null),s(r,"targetTime")};handleChangeDate=(e,t)=>{const n=c()(e),{onChangeInput:a}=this.props;a(n?n.tz(c().tz.guess()).format("YYYY-MM-DD"):null,t)};handleChangeGeo=e=>{const{onChangeInput:t}=this.props,n=e.target.options,a=[];for(let e=0,t=n.length;e<t;e++)n[e].selected&&a.push(parseInt(n[e].value,10));t(a,"targetGeoIds")};handleToggleStatus=()=>{const{data:e,onSaveSettings:t}=this.props,n="STATUS_ACTIVE"===e.status?"STATUS_PENDING":"STATUS_ACTIVE";t({id:e.id,update:!0,status:n})};handleSaveSettings=()=>{const{data:e,onSaveSettings:t}=this.props;t({...e,update:!0})};targetTime={days:["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"],time:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"]};targetTimeDefault="0".repeat(168);clickPriceDev=[.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,2,2.5,3,5];clickPrice=[.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5];targetGeoIds={60095249758:"Россия",60318322607:"Украина",60138331168:"Москва",60933422037:"Москва и Московская область",60740971752:"Санкт-Петербург",60964044601:"Новосибирск",60254672793:"Владивосток",60863991638:"Воронеж",60187117450:"Екатеринбург",60268058388:"Иркутск",60559502376:"Йошкар-Ола",60204165110:"Калининград",60087064487:"Краснодар",60417845940:"Красноярск",60602640584:"Красноярский край",60640918789:"Саратов",60878151208:"Сочи",60310137336:"Тольятти",60851717696:"Томск",60748627393:"Уфа",60426661222:"Хабаровск",60302481695:"Челябинск",60334215912:"Ярославль",60520040329:"Крым",60734905001:"Севастополь"};targetIsMale=[[null,"Не важно"],[!0,"Мужской"],[!1,"Женский"]];render(){const{active:e,data:t,user:n,errors:a,onChangeInput:s,onChangeTab:o}=this.props,{time:i,days:l}=this.targetTime,m={"promotion-settings__wrapper":!0,"promotion-settings__wrapper_hidden":!e},d={"promotion-settings-statusbar":!0,active:"STATUS_ACTIVE"===t.status,inactive:"STATUS_ACTIVE"!==t.status},p={"promotion-settings-statusbar__status":!0,"promotion-settings-status":!0,"promotion-settings-status__active":"STATUS_ACTIVE"===t.status,"promotion-settings-status__inactive":"STATUS_ACTIVE"!==t.status},u=n&&n.isDeveloper?this.clickPriceDev:this.clickPrice,g=t.targetTime||this.targetTimeDefault;return r.createElement("div",{className:_()(m)},r.createElement("form",null,r.createElement("div",{className:"promotion-settings__section"},r.createElement("h1",{className:"promotion-settings__section__title"},t.title),r.createElement("div",{className:_()(d)},r.createElement("div",{className:_()(p)},"STATUS_ACTIVE"===t.status?"Активен":"Неактивен"),t.canChangeStatus&&r.createElement("div",{className:"promotion-settings-statusbar__submit"},r.createElement(He.Z,{type:"button",onClick:this.handleToggleStatus,label:"STATUS_ACTIVE"===t.status?"Остановить ротацию":"Запустить ротацию"})))),r.createElement("div",{className:"promotion-settings__section"},r.createElement("h1",{className:"promotion-settings__section__title"},"Общие настройки"),r.createElement("h2",{className:"promotion-settings__section__subtitle"},"Дата проведения"),r.createElement("div",{className:"promotion-settings__group"},r.createElement("div",{className:"promotion-settings__group__input-6"},r.createElement(gw,{dateFormat:"dd.MM.yyyy",onChange:e=>this.handleChangeDate(e,"dateStart"),selected:t.dateStart&&c()(t.dateStart,"YYYY-MM-DD").toDate()||void 0,customInput:r.createElement(uw,{id:"dateStart",name:"dateStart",type:"text",label:"Дата старта"})})),r.createElement("div",{className:"promotion-settings__group__input-6"},r.createElement(gw,{dateFormat:"dd.MM.yyyy",onChange:e=>this.handleChangeDate(e,"dateEnd"),selected:t.dateEnd&&c()(t.dateEnd,"YYYY-MM-DD").toDate()||void 0,customInput:r.createElement(uw,{id:"dateEnd",name:"dateEnd",type:"text",label:"Дата окончания"})}))),r.createElement("h2",{className:"promotion-settings__section__subtitle"},"Лимиты"),r.createElement("div",{className:"promotion-settings__group"},r.createElement("div",{className:"promotion-settings__group__input-6"},r.createElement(uw,{id:"fullClicksLimit",name:"fullClicksLimit",type:"text",value:t.fullClicksLimit,error:a.fullClicksLimit,onChange:e=>{s(e,"fullClicksLimit","int")},label:"Общий лимит"})),r.createElement("div",{className:"promotion-settings__group__input-6"},r.createElement(uw,{id:"dayClicksLimit",name:"dayClicksLimit",type:"text",value:t.dayClicksLimit,error:a.dayClicksLimit,onChange:e=>{s(e,"dayClicksLimit","int")},label:"Cуточный лимит"}))),r.createElement("h2",{className:"promotion-settings__section__subtitle"},"Стоимость"),r.createElement("div",{className:"promotion-settings__group"},r.createElement("div",{className:"promotion-settings__group__input-6"},r.createElement(uw,{id:"clickPrice",name:"clickPrice",type:"select",error:a.clickPrice,onChange:e=>{s(e,"clickPrice","float")},label:"Цена за переход"},u.map((e=>r.createElement("option",{key:e,value:e,selected:t.clickPrice===e&&"selected"},e.toFixed(2)))),-1===u.indexOf(t.clickPrice)&&r.createElement("option",{value:t.clickPrice,selected:"selected"},t.clickPrice))))),r.createElement("div",{className:"promotion-settings__section"},r.createElement("h1",{className:"promotion-settings__section__title"},"UTM-метки"),r.createElement("h2",{className:"promotion-settings__section__subtitle"},"Настройка utm-меток"),r.createElement("div",{className:"promotion-settings__group3"},r.createElement("div",{className:"promotion-settings__group3__input-4"},r.createElement(uw,{id:"utmSource",name:"utmSource",type:"text",value:t.utmSource,error:a.utmSource,onChange:e=>{s(e,"utmSource")},label:"utm_source"})),r.createElement("div",{className:"promotion-settings__group3__input-4"},r.createElement(uw,{id:"utmMedium",name:"utmMedium",type:"text",value:t.utmMedium,error:a.utmMedium,onChange:e=>{s(e,"utmMedium")},label:"utm_medium"})),r.createElement("div",{className:"promotion-settings__group3__input-4"},r.createElement(uw,{id:"utmCampaign",name:"utmCampaign",type:"text",value:t.utmCampaign,error:a.utmCampaign,onChange:e=>{s(e,"utmCampaign")},label:"utm_campaign"})))),r.createElement("div",{className:"promotion-settings__section"},r.createElement("h1",{className:"promotion-settings__section__title"},"Настройки таргетинга"),r.createElement("h2",{className:"promotion-settings__section__subtitle"},"Геотаргетинг"),r.createElement("div",{className:"promotion-settings__group"},r.createElement("div",{className:"promotion-settings__group__input"},r.createElement(uw,{id:"targetGeoIds",name:"targetGeoIds",type:"select",error:a.targetIsMale,onChange:this.handleChangeGeo,multiple:!0},Object.keys(this.targetGeoIds).map((e=>r.createElement("option",{key:e,value:e,selected:!!t.targetGeoIds&&-1!==t.targetGeoIds.indexOf(parseInt(e,10))&&"selected"},this.targetGeoIds[e])))))),r.createElement("h2",{className:"promotion-settings__section__subtitle"},"Демография"),r.createElement("div",{className:"promotion-settings__group3"},r.createElement("div",{className:"promotion-settings__group3__input-4"},r.createElement(uw,{id:"targetIsMale",name:"targetIsMale",type:"select",error:a.targetIsMale,onChange:e=>{s(e,"targetIsMale","boolean")},label:"Пол"},this.targetIsMale.map(((e,n)=>r.createElement("option",{key:n,value:null===e[0]?"":e[0],selected:t.targetIsMale===e[0]&&"selected"},e[1]))))),r.createElement("div",{className:"promotion-settings__group3__input-4"},r.createElement(uw,{id:"targetAgeMin",name:"targetAgeMin",type:"text",value:t.targetAgeMin,error:a.targetAgeMin,onChange:e=>{s(e,"targetAgeMin","int")},label:"Возраст от"})),r.createElement("div",{className:"promotion-settings__group3__input-4"},r.createElement(uw,{id:"targetAgeMax",name:"targetAgeMax",type:"text",value:t.targetAgeMax,error:a.targetAgeMax,onChange:e=>{s(e,"targetAgeMax","int")},label:"Возраст до"}))),r.createElement("h2",{className:"promotion-settings__section__subtitle"},"Календарь"),r.createElement("table",{className:"promotion-settings__timetable"},r.createElement("tbody",null,l.map(((e,t)=>r.createElement("tr",{key:`row-${t}`},r.createElement("td",null,e),r.createElement("td",{className:"promotion-settings__timetable__all-hours"},r.createElement("label",null,r.createElement("input",{type:"checkbox",checked:Array(i.length).fill(0).every(((e,n)=>"1"===g[24*t+n])),onChange:e=>this.handleChangeTimeTargeting(null,t,e.target.checked)}),r.createElement("span",null))),i.map(((e,n)=>r.createElement("td",{className:"promotion-settings__timetable__cell",key:`${t}-${n}`},r.createElement("label",null,r.createElement("input",{type:"checkbox",checked:"1"===g[24*t+n],onChange:e=>this.handleChangeTimeTargeting(n,t,e.target.checked)}),r.createElement("span",null)))))))),r.createElement("tr",null,r.createElement("td",null),r.createElement("td",null),i.map(((e,t)=>r.createElement("td",{className:"promotion-settings__timetable__all-days",key:"all-"+t},r.createElement("label",null,r.createElement("input",{type:"checkbox",checked:Array(l.length).fill(0).every(((e,n)=>"1"===g[24*n+t])),onChange:e=>this.handleChangeTimeTargeting(t,null,e.target.checked)}),r.createElement("span",null)))))),r.createElement("tr",null,r.createElement("td",null),r.createElement("td",null),i.map(((e,t)=>r.createElement("td",{key:`all-${t}`},e))))))),r.createElement("div",{className:"promotion-settings__submit"},r.createElement(He.Z,{onClick:this.handleSaveSettings,label:"Сохранить"}),r.createElement(He.Z,{color:"secondary",type:"button",onClick:()=>o("settings"),label:"Отмена"}))))}}hw.propTypes={data:f().object,user:f().object,onChangeInput:f().func,onSaveSettings:f().func,onChangeTab:f().func,active:f().bool,errors:f().any};const _w=(0,i.$j)((e=>({data:e.promotion.data.item,user:e.auth.user})),null)(hw);
/**
 * Mirtesen.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Ew extends r.Component{handleSaveSettings=()=>{const{data:e,onSaveSettings:t,onSetFieldsErrors:n}=this.props;let a=null;if(e.url){const t=e.url.match(/^(https?:)?\/\/[^\/]+\/blog\/(\d{11,18})(\/.*|$)/i);t&&(a=parseInt(t[2],10))}a?t({id:a,update:!1,status:"STATUS_PENDING"},"item"):n({id:"Неправильный адрес"})};render(){const{active:e,data:t,errors:n,onChangeInput:a,onChangeTab:s}=this.props,o={"promotion-settings__wrapper":!0,"promotion-settings__wrapper_hidden":!e};return r.createElement("div",{className:_()(o)},r.createElement("form",null,r.createElement("div",{className:"promotion-settings__section"},r.createElement("h1",{className:"promotion-settings__section__title"},"Добавление нового объекта"),r.createElement("div",{className:"promotion-settings__group"},r.createElement("div",{className:"promotion-settings__group__input"},r.createElement(uw,{id:"url",name:"url",type:"text",value:t.url||"",error:n.id,onChange:e=>{a(e,"url")},label:"URL-адрес"})))),r.createElement("div",{className:"promotion-settings__submit"},r.createElement(He.Z,{type:"button",onClick:this.handleSaveSettings,label:"Далее"}),r.createElement(He.Z,{color:"secondary",type:"button",onClick:()=>s("settings"),label:"Отмена"}))))}}Ew.propTypes={data:f().object,onChangeInput:f().func,onSaveSettings:f().func,onSetFieldsErrors:f().func,onChangeTab:f().func,active:f().bool,errors:f().any};const fw=(0,i.$j)((e=>({data:e.promotion.data.itemAdd})),null)(Ew);
/**
 * Mirtesen.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class bw extends r.Component{handleSaveSettings=()=>{const{value:e,handleAddBalance:t}=this.props;t(e)};render(){const{active:e,value:t,onChangeInput:n,onChangeTab:a}=this.props,s={"promotion-settings__wrapper":!0,"promotion-settings__wrapper_hidden":!e};return r.createElement("div",{className:_()(s)},r.createElement("form",null,r.createElement("div",{className:"promotion-settings__section"},r.createElement("h1",{className:"promotion-settings__section__title"},"Пополнение баланса"),r.createElement("div",{className:"promotion-settings__group"},r.createElement("div",{className:"promotion-settings__group__input"},r.createElement(uw,{id:"deposit",name:"deposit",type:"text",value:t||"",onChange:e=>{n(e,"value")},label:"Сумма"})))),r.createElement("div",{className:"promotion-settings__submit"},r.createElement(He.Z,{type:"button",onClick:this.handleSaveSettings,label:"Далее"}),r.createElement(He.Z,{color:"secondary",type:"button",onClick:()=>a("settings"),label:"Отмена"}))))}}bw.propTypes={value:f().string,onChangeInput:f().func,handleAddBalance:f().func,onChangeTab:f().func,active:f().bool};const yw=(0,i.$j)((e=>({value:e.promotion.data.deposit.value})),(e=>({handleAddBalance:t=>{e((e=>(t,n)=>{const a=n().app.site.id;Promise.all([Yg.refillSiteAdBalance(a,e)]).then((([e])=>{e.result?window.location.reload():t(ih(e))})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(nh)(e)}))})(t))}})))(bw);
/**
 * Mirtesen.
 *
 * Table component.
 *
 * @author       Arman Zohrabyan.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
function vw({structure:e}){return r.createElement("table",{className:"standard-table table table-striped"},r.createElement("thead",null,r.createElement("tr",null,e.thead.map(((e,t)=>r.createElement("th",{className:"text-"+(0===t?"left":"right"),key:t},e))))),r.createElement("tbody",null,e.tbody.map(((e,t)=>r.createElement("tr",{key:t},Object.values(e).map(((e,t)=>r.createElement("th",{className:`text-${0===t?"left":"right"} standard-table__total`,key:t},e))))))))}vw.propTypes={structure:f().object};const Tw=vw,Sw=N((()=>Promise.all([n.e(186).then(n.t.bind(n,9198,23)),n.e(202).then(n.bind(n,44308))]).then((([e])=>e))),"reactDatepicker");class Pw extends r.Component{handleChangeDate=(e,t)=>{const n=c()(e),{promotion:a,onChangePeriod:s}=this.props,r=a.data.stats;r[t]=n.tz(c().tz.guess()).format("YYYY-MM-DD"),s(r.periodFrom,r.periodTo)};render(){const{active:e,promotion:t}=this.props,n=t.data.stats,a={"promotion-settings__wrapper":!0,"promotion-settings__wrapper_hidden":!e},s=[...n.rows];return s.pop(),r.createElement("div",{className:_()(a)},r.createElement("h1",{className:"promotion-settings__section__title"},"Статистика"),r.createElement("div",{className:"stat__pickers"},r.createElement("span",{className:"stat__pickers__picker"},"От: ",r.createElement(Sw,{timeFormat:"HH:mm",timeIntervals:60,dateFormat:"dd.MM.yyyy",timeCaption:"Время",onChange:e=>this.handleChangeDate(e,"periodFrom"),selected:c()(n.periodFrom).toDate()})),r.createElement("span",{className:"stat__pickers__picker"},"До: ",r.createElement(Sw,{timeFormat:"HH:mm",timeIntervals:60,dateFormat:"dd.MM.yyyy",timeCaption:"Время",onChange:e=>this.handleChangeDate(e,"periodTo"),selected:c()(n.periodTo).toDate()}))),!Sa()(n.rows)&&r.createElement(r.Fragment,null,r.createElement("div",{className:"stat__chart-wrapper"},r.createElement(P,{chartData:s,chartOptions:[{name:"visitors",label:"Переходов"},{name:"credits",label:"Кредитов"}]})),r.createElement(Tw,{structure:{thead:["Дата","Переходов","Кредитов"],tbody:n.rows}})))}}Pw.propTypes={promotion:f().object,active:f().bool,onChangePeriod:f().func,errors:f().any};const ww=(0,i.$j)((e=>({promotion:e.promotion})),(e=>({onChangePeriod:(t,n)=>{e(((e,t)=>(n,a)=>{if(n({type:"PROMOTION_SET_PERIOD",periodFrom:e,periodTo:t}),e<t){const s=a().app.site.id;Promise.all([Yg.getPromotionStat(s,{periodFrom:e,periodTo:t})]).then((([e])=>{n({type:"PROMOTION_INIT_STATE",rows:lh(e)})})).catch(D.Z.promiseHandler(nh))}})(t,n))}})))(Pw);
/**
 * Mirtesen.
 *
 * Platform tab component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Iw extends r.Component{leftContent={BUSINESS:r.createElement(r.Fragment,null,r.createElement("p",null,'Ваш сайт имеет статус "Бизнес" и автоматически имеет статус "доверенный".'),r.createElement("div",null,"Теперь анонсы самых интересных статей будут проявляться на главной странице МирТесен.")),REJECTED:r.createElement(r.Fragment,null,r.createElement("p",null,"Ежедневно несколько сотен тысяч пользователей посещают сайты, созданные на Платформе МирТесен. Самую большую аудиторию собирают сайты с качественными актуальными статьями на заданную тему. Владельцы лучших сайтов внимательно следят за удобством своего проекта, регулярно добавляют новую информацию и ведут диалог со своей аудиторией."),r.createElement("div",null,'Правильным сайтам, созданным на МирТесен, мы предлагаем бесплатную услугу продвижения своих проектов. Для этого достаточно пройти модерацию и получить статус "Доверенный". Сразу после этого мы начнем анонсировать самые интересные статьи вашего ресурса на всех страницах системы МирТесен, и вы сможете получать тысячи новых читателей ежедневно.')),NONE:r.createElement(r.Fragment,null,r.createElement("p",null,"Ежедневно несколько сотен тысяч пользователей посещают сайты, созданные на Платформе МирТесен. Самую большую аудиторию собирают сайты с качественными актуальными статьями на заданную тему. Владельцы лучших сайтов внимательно следят за удобством своего проекта, регулярно добавляют новую информацию и ведут диалог со своей аудиторией."),r.createElement("div",null,'Правильным сайтам, созданным на МирТесен, мы предлагаем бесплатную услугу продвижения своих проектов. Для этого достаточно пройти модерацию и получить статус "Доверенный". Сразу после этого мы начнем анонсировать самые интересные статьи вашего ресурса на всех страницах системы МирТесен, и вы сможете получать тысячи новых читателей ежедневно.')),PROCESSING:r.createElement(r.Fragment,null,r.createElement("p",null,"По вашему сайту сейчас накапливается статистика. Обычно этот процесс занимает не более месяца. Но, главное, чтобы на сайте уже была активная аудитория, а также несколько десятков качественных материалов. Только тогда мы сможем изменить статус вашего сайта."),r.createElement("div",null,"Если у вас остались вопросы или модерация, на ваш взгляд, слишком затянулась — задайте вопрос на эту тему через ",r.createElement("a",{href:"http://mirtesen.ru/feedback/report"},"форму обратной связи")," или в нашем публичном сообществе ",r.createElement("a",{href:"http://platforma.mirtesen.ru/_/claim"},'"Платформа МирТесен"'),".")),SUCCESS:r.createElement(r.Fragment,null,r.createElement("p",null,'Ваш сайт получил статус "доверенный". Поздравляем!',r.createElement("br",null),"Теперь анонсы самых интересных статей будут появляться на главной странице МирТесен."),r.createElement("p",null,"Получите дополнительную аудиторию, используя рекомендательную рекламную сеть МирТесен! Это более эффективный инструмент, чем простые приглашения на сайт, и вы можете попробовать его бесплатно."),r.createElement(He.Z,{onClick:()=>{this.props.handleMakeAsBusiness()},label:"Получить 500 тестовых кредитов"}))};rightContent={BUSINESS:null,REJECTED:r.createElement("div",null,r.createElement("p",null,"Обычно запрос на модерацию сайта обрабатывается в течение месяца."),r.createElement(He.Z,{onClick:()=>{this.props.handleSetState()},label:"Отправить запрос"})),NONE:r.createElement("div",null,r.createElement("p",null,"Обычно запрос на модерацию сайта обрабатывается в течение месяца."),r.createElement(He.Z,{onClick:()=>{this.props.handleSetState()},label:"Отправить запрос"})),PROCESSING:r.createElement("div",null,r.createElement("strong",null,"Сайт на модерации...")),SUCCESS:null};render(){const{active:e,promotion:t}=this.props,n=t.data.platform,a={"promotion-settings__wrapper":!0,"promotion-settings__wrapper_hidden":!e,"promotion-platform":!0};return r.createElement("div",{className:_()(a)},r.createElement("div",{className:"promotion-settings__section"},r.createElement("h1",{className:"promotion-settings__section__title"},"Отображение на главной странице МирТесен"),r.createElement("div",{className:"form-section promotion-platform__description"},this.leftContent[n.toUpperCase()]),this.rightContent[n.toUpperCase()]&&r.createElement("div",{className:"form-section form-section_bottom promotion-platform__status"},this.rightContent[n.toUpperCase()])))}}Iw.propTypes={promotion:f().object,handleSetState:f().func,handleMakeAsBusiness:f().func,active:f().bool,errors:f().any};const Cw=(0,i.$j)((e=>({promotion:e.promotion})),(e=>({handleSetState:()=>{e(((e,t)=>{const n=t().app.site.id;Promise.all([Yg.setSiteModerateState(n)]).then((([t])=>{t.result?window.location.reload():e(ih(t))})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(nh)(e)}))}))},handleMakeAsBusiness:()=>{e(((e,t)=>{const n=t().app.site.id;Promise.all([Yg.makeSiteAsBusiness(n)]).then((([t])=>{t.result?window.location.reload():e(ih(t))})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(nh)(e)}))}))}})))(Iw);
/**
 * Mirtesen.
 *
 * Promotion Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Nw extends r.Component{handleChangeInput=(e,t,n)=>{const{handleChangeInput:a}=this.props,{activeTab:s}=this.props.promotion;let r=null;if(e&&e.target){const t=e.target;r="checkbox"===t.type?e.target.checked:e.target.value,n||"number"!==t.type||(n="int")}else r=e;"float"===n?(r=parseFloat(r),isNaN(r)&&(r=null)):"int"===n?(r=parseInt(r,10),isNaN(r)&&(r=null)):"boolean"===n&&(r=r?"0"!==r&&"false"!==r:null),a(s,t,r)};containers={settings:mw,item:_w,itemAdd:fw,deposit:yw,stats:ww,platform:Cw};render(){const{promotion:e,handleSaveSettings:t,handleSetFieldsErrors:n,handleItemForm:a,handleItemAddForm:s,handleDepositForm:o,handleChangeTab:i}=this.props,l=this.containers,{data:c,errors:m,sections:d,activeTab:p}=e;return r.createElement("div",{className:"promotion-settings"},Object.keys(d).map((e=>{const d=l[e];return d?r.createElement(d,{key:e,active:e===p,data:c[e],errors:m,onChangeInput:this.handleChangeInput,onSaveSettings:t,onSetFieldsErrors:n,onItemForm:a,onItemAddForm:s,onDepositForm:o,onChangeTab:i}):null})))}}Nw.propTypes={app:f().object,promotion:f().object,handleChangeInput:f().func,handleItemForm:f().func,handleItemAddForm:f().func,handleDepositForm:f().func,handleChangeTab:f().func,handleSaveSettings:f().func,handleSetFieldsErrors:f().func,handleTogglePopup:f().func};const Ow=(0,i.$j)((e=>({app:e.app,promotion:e.promotion})),(e=>({handleChangeInput:(t,n,a)=>{e(((e,t,n)=>({type:"PROMOTION_CHANGE_VALUE",tabName:e,name:t,value:n}))(t,n,a))},handleItemForm:t=>{e(rh("item",t)),e(sh("item"))},handleItemAddForm:()=>{e(rh("itemAdd",{url:null})),e(sh("itemAdd"))},handleDepositForm:()=>{e(rh("deposit",{value:""})),e(sh("deposit"))},handleChangeTab:t=>{e(sh(t))},handleSaveSettings:(t,n)=>{e(((e,t)=>(n,a)=>{const s=a(),r=s.app.site.id;t||(t=s.promotion.activeTab);const o={...e};if("item"!==t);else{const e=o.id,t=!!o.update||!1;Yg.setSiteAdPromo(e,r,t,th()(o,["status","dateStart","dateEnd","fullClicksLimit","dayClicksLimit","clickPrice","utmSource","utmMedium","utmCampaign","targetGeoIds","targetIsMale","targetAgeMin","targetAgeMax","targetTime"])).then((e=>{const t=L()(e,"data.setSiteAdPromo",{});t.status?window.location.reload():n(ih(t))})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(nh)(e)}))}})(t,n))},handleSetFieldsErrors:t=>{e(oh(t))}})))((0,ae.Z)(Nw,"promotion")),Mw=N((()=>Promise.all([n.e(186).then(n.t.bind(n,9198,23)),n.e(202).then(n.bind(n,44308))]).then((([e])=>e))),"reactDatepicker");class kw extends r.Component{handleChangeDate=(e,t)=>{const n=c()(e),{editComments:a,onChangePeriod:s}=this.props,r=a.data.stats;r[t]=n.tz(c().tz.guess()).format("YYYY-MM-DD"),s(r.periodFrom,r.periodTo)};render(){const{active:e,editComments:t}=this.props,n=t.data.stats,a={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!e},s=[...n.commentsRows];s.pop();const o=[...n.commentatorsRows];return o.splice(-2,2),r.createElement("div",{className:_()(a)},r.createElement("h1",{className:"form-title"},"Статистика"),r.createElement("div",{className:"stat__pickers"},r.createElement("span",{className:"stat__pickers__picker"},"От: ",r.createElement(Mw,{timeFormat:"HH:mm",timeIntervals:60,dateFormat:"dd.MM.yyyy",timeCaption:"Время",onChange:e=>this.handleChangeDate(e,"periodFrom"),selected:c()(n.periodFrom).toDate()})),r.createElement("span",{className:"stat__pickers__picker"},"До: ",r.createElement(Mw,{timeFormat:"HH:mm",timeIntervals:60,dateFormat:"dd.MM.yyyy",timeCaption:"Время",onChange:e=>this.handleChangeDate(e,"periodTo"),selected:c()(n.periodTo).toDate()}))),!Sa()(n.commentsRows)&&r.createElement(r.Fragment,null,r.createElement("p",null),r.createElement("center",null,"Комментарии"),r.createElement("div",{className:"stat__chart-wrapper col"},r.createElement(P,{chartData:s,chartOptions:[{name:"active",label:"Активных"},{name:"inactive",label:"Неактивных"}]})),r.createElement(Tw,{structure:{thead:["Дата","Активных","Неактивных"],tbody:n.commentsRows}})),!Sa()(n.commentatorsRows)&&r.createElement(r.Fragment,null,r.createElement("p",null),r.createElement("center",null,"Комментаторы"),r.createElement("div",{className:"stat__chart-wrapper col"},r.createElement(P,{chartData:o,chartOptions:[{name:"commentators",label:"Комментаторов"}]})),r.createElement(Tw,{structure:{thead:["Дата","Комментаторов"],tbody:n.commentatorsRows}})))}}kw.propTypes={editComments:f().object,active:f().bool,onChangePeriod:f().func,errors:f().any};const Aw=(0,i.$j)((e=>({editComments:e.editComments})),(e=>({onChangePeriod:(t,n)=>{e(((e,t)=>(n,a)=>{if(n({type:"EDIT_COMMENTS_SET_PERIOD",periodFrom:e,periodTo:t}),e<t){const s=a().app.site.id;Promise.all([dh.Z.getSiteCommentsStats(s,{periodFrom:e,periodTo:t})]).then((([e])=>{n({type:"EDIT_COMMENTS_INIT_STATE",commentsRows:hh(e),commentatorsRows:_h(e)})})).catch(D.Z.promiseHandler(ph))}})(t,n))}})))(kw);
/**
 * Mirtesen.
 *
 * Comments settings tab component.
 *
 * @author       Oleg Kravchenko.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class xw extends r.Component{constructor(e){super(e),this._makeRadio=this._makeRadio.bind(this)}handleAddTag=(e=[])=>{const t=e[e.length-1];for(let e=0;e<t.length;e++)if(!/[a-zа-я0-9_]+/.test(t[e]))return!1;this.props.handleAddSiteCommentsStopWord(t)};handleDeleteTag=e=>{const{editComments:t}=this.props,n=t.data.settings;this.props.removeSiteCommentsStopWord(n.keyWords[e].id)};radioInputs={applyForCommentsEnabled:[{title:"да",value:1},{title:"нет",value:0}],commonEnabled:[{title:"да",value:1},{title:"нет",value:0}],siteEnabled:[{title:"да",value:1},{title:"нет",value:0}]};_makeRadio(e,t,n){const a=[],{onChangeInput:s}=this.props;return t="number"==typeof(t="boolean"==typeof t?+t:t)?t.toString():t,this.radioInputs[e].map((o=>{let i=o.value;i="number"==typeof i?i.toString():i,a.push(r.createElement(VS,{error:n[e],key:i,input:{type:"radio",initVal:i,label:o.title,name:e},value:t,onChangeHandle:t=>{s(t,e)}}))})),a}render(){const{data:e,active:t,errors:n,editComments:a}=this.props,s=a.activeTab,o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!t};return r.createElement("div",{className:_()(o)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Управление"),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Скрывать комментарии с неуместными словами"),this._makeRadio("applyForCommentsEnabled",e.applyForCommentsEnabled,n))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Использовать список слов Миртесен"),this._makeRadio("commonEnabled",e.commonEnabled,n))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Использовать собственный список слов"),this._makeRadio("siteEnabled",e.siteEnabled,n)),"settings"===s&&!!+e.siteEnabled&&r.createElement("div",{className:"form-group"},r.createElement("label",null,"Неуместные слова"),r.createElement(aT,{placeholder:"Новое слово...",helper:"Слова должны начинаться с маленькой буквы или цифры и содержать только символы a-z, а-я, 0-9 или нижнего подчеркивания. ",tags:e.keyWords||[],onDelete:this.handleDeleteTag,onChangeInput:this.handleAddTag})))))}}xw.propTypes={onChangeInput:f().func,handleAddSiteCommentsStopWord:f().func,removeSiteCommentsStopWord:f().func,data:f().object,editComments:f().object,active:f().bool,errors:f().any};const Lw=(0,i.$j)((e=>({editComments:e.editComments})),(e=>({handleAddSiteCommentsStopWord:t=>{e((e=>(t,n)=>{const a=n().app.site.id;Promise.all([dh.Z.addSiteCommentsStopWord(a,e)]).then((([e])=>{if(e)return t({type:"ADD_SITE_COMMENTS_STOP_WORD",stopWord:e});kt.Z.sendSystemMessage("saveError")})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(ph)(e)}))})(t))},removeSiteCommentsStopWord:t=>{e((e=>(t,n)=>{const a=n().app.site.id;Promise.all([dh.Z.removeSiteCommentsStopWord(a,e)]).then((n=>{if(n)return t({type:"REMOVE_SITE_COMMENTS_STOP_WORD",id:e});kt.Z.sendSystemMessage("saveError")})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(ph)(e)}))})(t))}})))(xw);
/**
 * Mirtesen.
 *
 * Edit comments Container.
 *
 * @author       Oleg Kravchenko.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Dw extends r.Component{handleChangeInput=(e,t)=>{const{handleChangeInput:n}=this.props,{activeTab:a}=this.props.editComments;let s=null;if(e.target){s="checkbox"===e.target.type?e.target.checked:e.target.value}else s=e;n(a,t,s)};handleChangeTab=e=>{const{handleChangeTab:t}=this.props;t(e)};handleSaveSettings=()=>{const{handleSaveSettings:e}=this.props,{activeTab:t}=this.props.editComments;e(t)};containers={stats:Aw,settings:Lw};render(){const{editComments:e}=this.props,t=this.containers,{data:n,errors:a,sections:s,activeTab:o}=e;return r.createElement("div",{className:"site-settings"},Object.keys(s).map((e=>{const s=t[e];return s?r.createElement(s,{key:e,active:e===o,data:n[e],errors:a,onChangeInput:this.handleChangeInput,onSaveSettings:this.handleSaveSettings}):null})))}}Dw.propTypes={app:f().object,editComments:f().object,handleChangeInput:f().func,handleChangeTab:f().func,handleSaveSettings:f().func};const Rw=(0,i.$j)((e=>({app:e.app,editComments:e.editComments})),(e=>({handleChangeInput:(t,n,a)=>{e(((e,t,n)=>(a,s)=>{const r=s(),o=r.app.site.id;if("settings"===e){const e=r.editComments.data.settings;e[t]=n,Promise.all([dh.Z.setSiteCommentsStopWordsSettings(o,!!+e.commonEnabled,!!+e.siteEnabled,!!+e.applyForCommentsEnabled)]).then((([e])=>{if(console.log(e),e)return kt.Z.sendSystemMessage("save"),a({type:"SET_SITE_COMMENTS_STOP_WORD_SETTINGS",name:t,value:n});kt.Z.sendSystemMessage("saveError")})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(ph)(e)}))}a({type:"EDIT_COMMENTS_CHANGE_VALUE",tabName:e,name:t,value:n})})(t,n,a))},handleChangeTab:t=>{e(uh(t))},handleSaveSettings:t=>{e((e=>(t,n)=>{const a=n(),s=a.app.site.id,{activeTab:r,data:o}=a.editComments,i={...o[r]};e&&o[e],t({type:"EDIT_COMMENTS_SAVE_SETTINGS",tabName:e}),"settings"===r&&Promise.all([dh.Z.setCommentsSettings(s,JSON.stringify(i))]).then((([e])=>{e.result?window.location.reload():t(gh(e))})).catch((e=>{kt.Z.sendSystemMessage("saveError"),D.Z.promiseHandler(ph)(e)}))})(t))}})))((0,ae.Z)(Dw,"editComments"));
/**
 * Mirtesen.
 *
 * OlnlPadClicksFromEmail Component.
 *
 * @author       Alexy Geno.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Zw extends r.PureComponent{render(){const{l:e="",bpid:t=!1,t:n=0}=this.props.app.req.query,a=!(!t||-1===["bnq_bl","bnq_bn"].indexOf(e)||!n)&&`https://json-inf.olnl.net/cnt?c=ev&vt=bpnr_click&vi=${t}&t=${n}`;return a&&r.createElement("img",{src:a,width:"0",height:"0",alt:""})}}Zw.propTypes={app:f().object};const Bw=Zw,$w=(0,r.memo)((({app:e,pad:t,onShowMorePosts:n})=>{const{topicTitle:a,topicKey:s}=t;return r.createElement(r.Fragment,null,a&&r.createElement("h1",{className:"topic-post-list-title"},a),r.createElement(Bw,{app:e}),r.createElement(Hv,{topicKey:s,onLoadMore:n,id:"pad"}))}));$w.propTypes={posts:f().oneOfType([f().object,f().array]),onShowMorePosts:f().func,app:f().object,pad:f().object};const Uw=(0,i.$j)((e=>({pad:e.pad,app:e.app})),(e=>({onShowMorePosts:()=>{e((async(e,t)=>{try{const n=t(),{page:a,recordsOnPage:s}=n.postTiles.pad;let{posts:r}=n.postTiles.pad;const{topicKey:o}=n.pad,i=a+1,l=await Js.getBlogPostsByTopic({topic:o,offset:(i-1)*s,count:s,filter:"unselected",withBusinessPosts:!0});if(r=[...r,...l],r=r.filter((e=>e.images.length>0)),r=K.Z.removeDuplicates(r),i>0){const e="page="+i;let t=window.location.href;const n=/page=\d+/i;t=t.replace(n,"").replace("?&","?").replace(/(&|\?)+$/,""),t=-1!==t.indexOf("?")?t+"&"+e:t+"?"+e,window.history.pushState(null,"",t)}e({type:"POST_TILES_LOAD_MORE",id:"pad",posts:r,hasMore:l.length>0,page:i})}catch(e){D.Z.promiseHandler("/index.js")(e)}}))}})))((0,ae.Z)($w,"pad"));var Hw="/index.js";
/**
 * Mirtesen.
 *
 * Create Site Page actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const Fw=e=>({type:"CREATE_SITE_TOGGLE_PROCESS",inProcess:e}),jw=(e,t)=>({type:"CREATE_SITE_SET_VALUE",name:e,value:t}),Gw=e=>t=>t({type:"CREATE_SITE_PROCESS_ERRORS",errors:e});
/**
 * Mirtesen.
 *
 * Create site page.
 *
 * @author       Duybo Alexey.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class qw extends r.Component{constructor(e){super(e),this.checkTimer=null,this.state={fields:[{name:"domain",label:"Адрес сайта",labelAfter:"Этот адрес можно изменить или добавить дополнительный.\n                        Собственный домен также устанавливается в настройках.",type:"text",isRequired:!0},{name:"name",label:"Название",labelAfter:null,type:"text",isRequired:!0},{name:"tagLine",label:"Слоган",labelAfter:null,type:"text",isRequired:!1},{name:"description",label:"Описание",labelAfter:null,type:"textarea",isRequired:!0},{name:"keywords",label:"Ключевые слова",labelAfter:"Слова, по которым Ваш сайт будут находить в поисковиках\n                        (максимум 168 символов)",type:"textarea",isRequired:!0,maxLength:168},{name:"logo",label:"Логотип",labelAfter:"Логотип можно добавить позже",type:"file",isRequired:!1}]}}componentWillUnmount(){clearTimeout(this.checkTimer)}handleInput=(e,t)=>{const{onCheckSiteDomain:n,onChangeValue:a,onAddImage:s,onProcessErrors:r}=this.props,{value:o,files:i}=t;r({[e]:""}),"domain"===e&&(this.checkTimer&&(clearTimeout(this.checkTimer),this.checkTimer=null),this.checkTimer=setTimeout((()=>{n(o),this.checkTimer=null}),1e3)),"logo"!==e?a(e,o):s(e,i[0])};handleSubmit=e=>{e.preventDefault();const{onCreateSite:t}=this.props;this.validateForm()&&t()};validateForm=()=>{const{onProcessErrors:e,siteData:t}=this.props,n={};for(const e of this.state.fields)e.maxLength&&t[e.name].trim().length>e.maxLength&&(n[e.name]=kt.Z.systemMessages.tooLong||""),e.isRequired&&!t[e.name].trim()&&(n[e.name]=kt.Z.systemMessages.requiredField||"");return Sa()(n)||e(n),Sa()(n)};render(){const{fields:e}=this.state,{siteData:t}=this.props,{similarDomains:n,errorMessage:a,successMessage:s,inProcess:o}=t;return r.createElement("div",{id:"index-main-inner-container"},r.createElement("div",{id:"double-column-container"},r.createElement("div",{id:"right-column"},r.createElement(h_,null,r.createElement(Fh,{type:"Politpiar",id:99808}),r.createElement(Fh,{position:"smi2RightBlock"}))),r.createElement("div",{id:"content-column"},r.createElement("div",{className:"create-site-page"},r.createElement("h1",null,"Создание сайта (канала) в МирТесен"),r.createElement("form",{className:"create-site-page__form",onSubmit:this.handleSubmit},r.createElement("div",{className:"create-site-page__fields-list"},e.map((e=>{let o=null;return"domain"===e.name&&n?.length>0&&(o=r.createElement("div",{className:"create-site-page__similar-names"},r.createElement("div",{className:"create-site-page__similar-names-title"},"Похожие адреса:"),r.createElement("ul",{className:"create-site-page__similar-names-list"},n.map(((t,n)=>r.createElement("li",{key:n,className:"create-site-page__similar-names-item",onClick:()=>{this.handleInput(e.name,{value:t.prefix})}},t.prefix,r.createElement("span",null,".",t.domain))))))),r.createElement(VS,{onChangeHandle:t=>{this.handleInput(e.name,t.target)},type:e.type,error:a[e.name],valid:s[e.name],key:e.name,input:{extraElem:o,...e},value:t[e.name],extraElem:!0,v2:!0,v2ShowOptional:!0})}))),r.createElement("input",{type:"text",className:"hdn",name:"hdn"}),r.createElement("input",{type:"submit",value:"Создать сайт",className:"btn btn-primary",disabled:o}),r.createElement("input",{type:"text",className:"hdn",name:"hdn"}))))))}}qw.propTypes={siteData:f().object,onCheckSiteDomain:f().func,onChangeValue:f().func,onAddImage:f().func,onCreateSite:f().func,onProcessErrors:f().func};const Vw=(0,i.$j)((e=>({siteData:e.createSitePage})),(e=>({onCheckSiteDomain:t=>{e((e=>async t=>{if(e.length<=0)return t({type:"CREATE_SITE_RESET_MESSAGES",name:"domain"});const n=await EP.checkSiteDomain(null,e);if(n.result)return t({type:"CREATE_SITE_CHECK_DOMAIN",errorMessage:"",successMessage:kt.Z.systemMessages.freeDomain,similarDomains:[]});const a=n?.errors?.prefix;t({type:"CREATE_SITE_CHECK_DOMAIN",successMessage:"",errorMessage:a||kt.Z.systemMessages.incorrectField,similarDomains:n.alternatives||[]})})(t))},onChangeValue:(t,n)=>{e(jw(t,n))},onAddImage:(t,n)=>{e(((e,t)=>n=>{if(!t)return;const a=window.URL.createObjectURL(t);return St.Z.uploadImageToStorage(a).then((t=>{if(!t)return n(Gw({[e]:kt.Z.systemMessages.imageError}));n(jw(e,t))})).catch(D.Z.promiseHandler(Hw))})(t,n))},onCreateSite:()=>{e((async(e,t)=>{const n=t(),{domain:a,name:s,tagLine:r,description:o,keywords:i,logo:l}=n.createSitePage,c={prefix:a,name:s,tags:i,description:o,photoId:l?.id||null,slogan:r};try{e(Fw(!0));const t=await Xo.Z.createSite(c);if(t?.id&&t?.url)window.location.href=t.url;else{const e=t.errors[0]?.text||kt.Z.systemMessages.exception;kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e})}e(Fw(!1))}catch(t){kt.Z.sendSystemMessage("exception"),e(Fw(!1)),D.Z.promiseHandler(Hw)(t)}}))},onProcessErrors:t=>{e(Gw(t))}})))((0,ae.Z)(qw,"createSitePage")),zw=()=>r.createElement("div",null,"тестовая страница для отображения новых комментариев",r.createElement("br",null),r.createElement(Gv,null));var Ww="/index.js";
/**
 * Mirtesen.
 *
 * Firebase.
 *
 * @author       Alexandr Mazurok.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */let Yw,Kw,Jw,Xw=!1;const Qw=(e,t,n)=>{const{expires:a,global:s}={expires:"Tue, 19 Jan 2038 03:14:07 GMT",global:!0,...n};let r=e+"="+t+";";s&&(r+=" domain="+Kw+";"),a&&(r+=" expires="+a+";"),r+=" path=/; secure",window.document.cookie=r},eI=(e,t)=>{const n=window.document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return n?decodeURIComponent(n[1]):t},tI=()=>{let e=eI("mtPushUuid");return e||(e=(()=>{let e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))})(),Qw("mtPushUuid",e)),e},nI=()=>{let e=eI("mtPushUuidCreated");return e||(e=(new Date).toISOString(),Qw("mtPushUuidCreated",e)),e},aI=()=>{let e=eI("plugin_info[id]");return e||(e="1"),e},sI=e=>{const t=new Date(Date.now()+864e5);Qw("mtPushTokenSent",e?aI():"0",{expires:t.toUTCString()})},rI=e=>{if(eI("mtPushTokenSent")===aI())return;const t=new Date,n=t.getTimezoneOffset()/-60;(0,yt.Z)({project:"main",body:JSON.stringify({query:`mutation {\n                subscribeToPushNotifications(\n                    deviceId: "${tI()}"\n                    deviceToken: "${e}"\n                    deviceType: "web"\n                    version: "0.1.2"\n                    timezone: ${n}\n                    created: "${nI()}"\n                    updated: "${t.toISOString()}"\n                    sourceUrl: ${JSON.stringify(window.location.href)}\n                )\n            }`}),jwt:!0}).then((e=>{if(!e.data||!e.data.subscribeToPushNotifications)throw new Error("unable to send token to server");sI(!0)})).catch(D.Z.promiseHandler(`${Ww} - sendTokenToServer`))},oI=()=>{const e=eI("mtPushGranted");return Notification.requestPermission().then((t=>{const n="granted"===t?"1":"0";if(e!==n&&("1"!==n?(0,yt.Z)({project:"main",body:JSON.stringify({query:`mutation {\n                unsubscribeToPushNotifications(\n                    deviceId: "${tI()}"\n                    deviceType: "web"\n                )\n            }`}),jwt:!0}).then((e=>{if(!e.data||!e.data.unsubscribeToPushNotifications)throw new Error("unable to unsubscribe")})).then((()=>{const e=new Date(Date.now()+6048e5);Qw("mtPushHost",window.location.hostname,{expires:e.toUTCString()}),Qw("mtPushGranted",n,{global:!1})})).catch(D.Z.promiseHandler(`${Ww} requestPermission`)):(Qw("mtPushHost",window.location.hostname),Qw("mtPushGranted",n,{global:!1}))),"1"!==n)throw new Error("unable to get permission to notify")}))},iI=()=>{window.firebase.initializeApp(Yw),Jw=window.firebase.messaging(),Jw.onTokenRefresh((()=>{sI(!1),Jw.getToken().then((e=>{rI(e)})).catch(D.Z.promiseHandler(`${Ww} - handleTokenRefresh`))})),Jw.onMessage((e=>{try{if(!e.data||!e.data.mtNotification||!e.data.mtId)return;const t=JSON.parse(e.data.mtNotification),n=e.data.mtId;t.tag=t.click_action+":"+t.title,(0,yt.Z)({project:"main",body:JSON.stringify({query:`mutation {\n                    receivePush(\n                        id: "${n}"\n                        deviceType: "web"\n                    )\n                }`}),jwt:!0});const a=new Notification(t.title,t);a.onclick=()=>{(0,yt.Z)({project:"main",body:JSON.stringify({query:`mutation {\n                        clickPush(\n                            id: "${n}"\n                            deviceType: "web"\n                        )\n                    }`}),jwt:!0}),window.open(t.click_action),a.close()}}catch(e){console.log(e)}})),oI().then((()=>Jw.getToken())).then((e=>{if(!e)throw new Error("no Instance ID token available");rI(e)})).catch((()=>{sI(!1)}))};const lI=class{static initializeMessaging=(e,t)=>{if(!Xw){Xw=!0,Kw=t,Yw=e;try{if(K.Z.isIframe())return;if(!new RegExp("^(.*\\.)?"+Kw.replace(".","\\.")+"$").test(window.location.hostname))return;const e=eI("mtPushHost");if(e&&e!==window.location.hostname)return}catch(e){return void D.Z.promiseHandler(`${Ww} - initializeMessaging 1`)(e)}w.Z.loadScript("//www.gstatic.com/firebasejs/6.4.0/firebase-app.js",(e=>{e?console.log("Error loading firebase-app",e):w.Z.loadScript("//www.gstatic.com/firebasejs/6.4.0/firebase-messaging.js",(e=>{if(e)console.log("Error loading firebase-messaging",e);else{try{if(void 0===window.firebase||!window.firebase.messaging.isSupported())return}catch(e){return void D.Z.promiseHandler(`${Ww} - initializeMessaging 2`)(e)}iI()}}))}))}}};
/**
 * Mirtesen.
 *
 * Push messages.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class cI extends r.PureComponent{componentDidMount(){lI.initializeMessaging({apiKey:"AIzaSyB2DtPljRIaX5lfCLlD81fiyQn2MG7QPNo",authDomain:"v2mobile.firebaseapp.com",databaseURL:"https://v2mobile.firebaseio.com",projectId:"v2mobile",storageBucket:"v2mobile.appspot.com",messagingSenderId:"1036267401806",appId:"1:1036267401806:web:be2e9bfa3107df66"},"mirtesen.ru")}render(){return null}}const mI=cI;var dI="/index.js";
/**
 * Mirtesen.
 *
 * Recovery password actions.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const pI=(e,t)=>({type:"RECOVERY_PASSWORD_SET_INPUT_VALUE",name:e,value:t}),uI=(0,r.memo)((({recoveryPassword:e,restorePassword:t,setInputValue:n})=>{const[a,s]=(0,r.useState)(!1),{isEmailSent:o,inputValue:{email:i}}=e,l=a||e.emailError,c=e=>{const t=y.Z.isEmail(e)?"":"Введите корректный email адрес";return s(t),!0};return r.createElement("div",{className:"container"},r.createElement("div",{className:"recovery-pass__wrap"},!o&&r.createElement("div",{className:"recovery-pass__form"},r.createElement("div",{className:"recovery-pass__form__title"},"Восстановление пароля"),r.createElement("form",null,r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"recoverPasswordEmail"},"Email:"),r.createElement("input",{id:"recoverPasswordEmail",className:_()({"form-control":!0,"is-invalid":!!l}),type:"email",name:"login",onChange:e=>{n("email",e.target.value)},value:i,onKeyDown:e=>{13===e.keyCode&&(e.preventDefault(),c(i.trim()),t(i.trim()))}}),r.createElement("div",{className:"invalid-feedback"},l)),r.createElement(He.Z,{type:"submit",onClick:e=>{e.preventDefault(),c(i.trim()),t(i.trim())},label:"Восстановить"}))),o&&r.createElement("div",{className:"recovery-pass__email-sent-block"},r.createElement("h1",null,"Мы отправили письмо со ссылкой для восстановления пароля на email: ",i),r.createElement("a",{href:"//mirtesen.ru"},"Перейти на главную"))))}));uI.propTypes={recoveryPassword:f().object,restorePassword:f().func,setInputValue:f().func};const gI=(0,i.$j)((e=>({recoveryPassword:e.recoveryPassword})),(e=>({restorePassword:t=>{e((e=>async t=>{try{const{status:n,errors:a}=await Tt.Z.restorePassword(e);if(n)t({type:"RECOVERY_PASSWORD_EMAIL_SENT"});else{let e="Ошибка при восстановлении пароля.";a&&a.forEach((t=>{"email"===t.key&&"error_doesnt_match"===t.message&&(e="E-mail не зарегистрирован.")})),t({type:"RECOVERY_PASSWORD_SET_EMAIL_ERROR",message:e})}}catch(e){D.Z.promiseHandler(dI)(e)}})(t))},setInputValue:(t,n)=>{e(pI(t,n))}})))((0,ae.Z)(uI,"recoveryPasswordStep1")),hI=(0,r.memo)((({recoveryPassword:e,savePassword:t,setInputValue:n})=>{const[a,s]=(0,r.useState)(!1),[o,i]=(0,r.useState)(!1),[l,c]=(0,r.useState)(!1),[m,d]=(0,r.useState)({pass1:!1,pass2:!1}),{key:p,errorMessage:u,passwordError:g,inputValue:h}=e,E=e=>{let t=!1,n=!1,a=!1;if(e.length<6)return!1;const s=e.match(/^[A-z@#-_$^&+=§!?]+/);return L()(s,"0")===L()(s,"input")&&(e.split("").map((e=>{-1!==e.search(/[A-Z]/)&&(t=!0),-1!==e.search(/[a-z]/)&&(n=!0),-1!==e.search(/[0-9]/)&&(a=!0)})),t&&n&&a)};return r.createElement("div",{className:"container"},r.createElement("div",{className:"recovery-pass__wrap"},u&&r.createElement("div",{className:"recovery-pass__email-sent-block"},r.createElement("h1",null,u),r.createElement("a",{href:"//mirtesen.ru"},"Перейти на главную")),!u&&r.createElement("div",{className:"recovery-pass__form recovery-pass__change-password"},r.createElement("div",{className:"recovery-pass__form__title"},"Сохранение пароля"),r.createElement("form",null,r.createElement("div",null,r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"pass1"},"Новый пароль (не менее 6 символов):"),r.createElement("input",{className:_()({"form-control":!0,"is-invalid":m.pass1}),id:"pass1",type:""+(l?"text":"password"),name:"pass1",onChange:e=>{n("pass1",e.target.value)},value:h.pass1})),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"pass2"},"Еще раз новый пароль:"),r.createElement("input",{className:_()({"form-control":!0,"is-invalid":m.pass2}),id:"pass2",type:""+(l?"text":"password"),name:"pass2",onChange:e=>{n("pass2",e.target.value)},value:h.pass2})),r.createElement("div",{className:" form-group recovery-pass__show-password"},r.createElement("input",{className:"form-check-input",id:"showPass",type:"checkbox",name:"showPass",checked:l,onChange:()=>(c((e=>!e)),!0)}),r.createElement("label",{htmlFor:"showPass"},"показать пароль"))),r.createElement("div",{className:"recovery-pass__error-block error-block"},a&&r.createElement("div",{className:"error-block__compare-error"},"Пароли не совпадают"),g&&!a&&r.createElement("div",{dangerouslySetInnerHTML:{__html:g}}),o&&r.createElement(r.Fragment,null,r.createElement("div",null,"Пароль должен быть длиной от 6 символов и состоять из букв латинского алфавита и цифр"),r.createElement("div",null,"Допускаются символы @ # - _ $ ^ & + = § ! ?"),r.createElement("div",null,"Пароль должен содержать минимум одну цифру и по одной букве верхнего и нижнего регистра"))),r.createElement(He.Z,{type:"submit",onClick:e=>{e.preventDefault();const n=(e=>{const{pass1:t,pass2:n}=e,a=t!==n;return s(a),d({pass1:a,pass2:a}),a})(h),a=(e=>{const t=!(E(e.pass1)&&E(e.pass2));return i(t),t})(h);n||a||t(h.pass1,p)},label:"Сохранить"})))))}));hI.propTypes={recoveryPassword:f().object,savePassword:f().func,setInputValue:f().func};const _I=(0,i.$j)((e=>({recoveryPassword:e.recoveryPassword})),(e=>({savePassword:(t,n)=>{e(((e,t)=>async n=>{try{const a=await Tt.Z.setUserPasswordByActionKey(e,t);a.result?(kt.Z.sendSystemMessage("successPasswordChange"),n({type:"RECOVERY_PASSWORD_RESET_FORM"})):n({type:"RECOVERY_PASSWORD_SET_PASSWORD_ERROR",message:a.message})}catch(e){D.Z.promiseHandler(dI)(e)}})(t,n))},setInputValue:(t,n)=>{e(pI(t,n))}})))((0,ae.Z)(hI,"RecoveryPasswordStep2"));let EI=0;const fI=({authTab:e,hasUser:t,initAuth:n,openAuthForm:a})=>{const[s,o]=(0,r.useState)(null);if((0,r.useEffect)((()=>{if(n({onBeforeChange:()=>{b.ZP.postWindowTokenMessage(),window.close()}}),t)return b.ZP.postWindowTokenMessage(),void window.close();const s="authPage"+EI++;ge.init(s),a(e,s),o(s)}),[]),null===s)return null;const i=ge.getContext();return r.createElement(i.Provider,{value:s},r.createElement(Et,{isModal:!1}))};fI.propTypes={hasUser:f().bool,authTab:f().string,initAuth:f().func,openAuthForm:f().func};const bI=(0,i.$j)((e=>({hasUser:!!L()(e,"auth.user.id"),authTab:L()(e,"app.req.params.authTab"),openAuthForm:f().func})),(e=>({initAuth:t=>e(ee(t)),openAuthForm:(t,n)=>e(_e(t,n))})))(fI);var yI="/index.js";
/**
 * Mirtesen.
 *
 * Groups Actions.
 *
 * @author       Oleg Kravchenko.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const vI=(e=!1,t=null,n=null,a=null)=>(s,r)=>{const o=r(),i=Rp().groups.limit;t||(t=o.groups.page),n||(n=o.groups.period),a||(a=o.groups.order),Xo.Z.getRatedGroups({page:t,limit:i,period:n,orderBy:a}).then((n=>{let a=[];const r=n?.length>=i;a=e&&Array.isArray(n)?[...o.groups.ratedGroups,...n]:n,s({type:"GROUPS_SET",groups:a,hasMore:r,searchValue:""}),s({type:"GROUPS_SET_PAGE",page:t})})).catch((e=>{D.Z.promiseHandler(yI)(e)}))},TI=(e,t=null)=>(n,a)=>{const s=a();if(t||(t=s.groups.period),!e)return n(SI(t));Promise.resolve(fp.Z.search(e,"RATED_GROUPS",{period:t})).then((t=>{n({type:"GROUPS_SET",groups:t,hasMore:!1,searchValue:e})})).catch((e=>{D.Z.promiseHandler(yI)(e)}))},SI=e=>t=>{t({type:"GROUPS_SET_PERIOD",period:e}),t({type:"GROUPS_SET_PAGE",page:1}),t(vI())},PI=e=>t=>{t({type:"GROUPS_SET_ORDER",order:e}),t({type:"GROUPS_SET_PAGE",page:1}),t(vI())},wI=e=>(t,n)=>{const a=n();a.groups.ratedGroups.length<e*Rp().groups.limit||!a.groups.ratedGroups[(e-1)*Rp().groups.limit]?t(vI(!0,e)):t({type:"GROUPS_SET_PAGE",page:e})},II=({currentItem:e,items:t,onChange:n})=>{const a=t.find((t=>e===t.value))?.title;return r.createElement(G.Z,{customButtonClasses:"groups-select__current",customDropdownClasses:"groups-select",customListClasses:"groups-select__dropdown",placement:"auto-left",buttonValue:a,offset:[0,-10]},t.map(((t,a)=>{if(t.value!==e)return r.createElement("button",{type:"button",key:a,onClick:()=>{t.uri&&window.history.pushState(null,"",t.uri),n(t.value)}},t.title)})))};II.propTypes={currentItem:f().string,items:f().array,onChange:f().func};const CI=(0,r.memo)(II),NI=({group:e={},showMembers:t=!1,showVisitors:n=!1,showViews:a=!1})=>{const s=(e,t)=>e||0===e?r.createElement("span",null,y.Z.numWithSpaces(e)+" "+y.Z.num2string(e,t)):null;return r.createElement(dE,{className:"group-list-item"},r.createElement("a",{href:Xo.Z.addMirtesenKeyToUrl(e.url,b.ZP.getMirtesenKey()),className:"group-list-item__link",target:"_blank"},r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo_original,size:"av80"}}),r.createElement("div",{className:"group-list-item__info"},r.createElement("span",{className:"group-list-item__name"},e.display_name),e.showSubscribersAmount&&r.createElement("div",{className:"group-list-item__stat"},t&&e.members_count>0&&s(e.members_count,["подписчик","подписчика","подписчиков"]),n&&e.unique_visitors>0&&s(e.unique_visitors,["посетитель","посетителя","посетителей"]),a&&e.views>0&&s(e.views,["просмотр","просмотра","просмотров"])))),r.createElement($u,{siteId:e.id}))};NI.propTypes={group:f().object,showMembers:f().bool,showVisitors:f().bool,showViews:f().bool};const OI=(0,r.memo)(NI);function MI(){return MI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},MI.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Groups Container.
 *
 * @author       Oleg Kravchenko.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class kI extends r.PureComponent{constructor(e){super(e),this.searchRef=r.createRef(),this.periodsConfig=[{title:"За день",value:"PERIOD_YESTERDAY"},{title:"За неделю",value:"PERIOD_WEEK"},{title:"За месяц",value:"PERIOD_MONTH"},{title:"За квартал",value:"PERIOD_QUARTER"}],this.ordersConfig=[{title:"Популярные каналы",value:"ORDER_BY_UNIQUE_VISITORS",uri:"/rating"},{title:"Рекомендуемые каналы",value:"ORDER_BY_RECOMMEND",uri:"/rating/recommended"},{title:"Мои каналы",value:"ORDER_BY_MY",uri:"/rating/my-sites"},{title:"Мои подписки",value:"ORDER_BY_MEMBER",uri:"/rating/my-subscriptions"}]}handlePeriodChange=e=>{if(e!==this.props.currentPeriod)return this.clearInput(),this.props.actions.groupsSetPeriod(e)};handleOrderChange=e=>{if(e!==this.props.order)return this.searchRef.current.value="",this.props.actions.groupsSetOrder(e)};getCurrentOrder=()=>this.ordersConfig.find((e=>e.value===this.props.order));clearInput=()=>{this.searchRef.current.value="",window.history.pushState(null,"",this.getCurrentOrder()?.uri||"")};render(){const{page:e,currentPeriod:t,groups:n,order:a,hasMore:s,searchValue:o}=this.props,{groupsSetPage:i,searchRatedGroups:l}=this.props.actions;return r.createElement("div",{className:"rated-groups"},r.createElement("div",{className:"rated-groups__header"},r.createElement(Jn,{placeholder:"Начните вводить название сайта",handleSearch:l,searchUrl:this.getCurrentOrder()?.uri,defaultValue:o,ref:this.searchRef}),r.createElement("div",{className:"rated-groups__controls"},pd.isLogged()&&r.createElement(CI,MI({items:this.ordersConfig,onChange:this.handleOrderChange},"ORDER_BY_VIEWS"===a?{currentItem:"ORDER_BY_UNIQUE_VISITORS"}:{currentItem:a})),!pd.isLogged()&&r.createElement("div",{className:"groups-select_disable"},"Популярные сайты"),r.createElement(CI,{currentItem:t,items:this.periodsConfig,onChange:this.handlePeriodChange}))),r.createElement(zn,{pageStart:0,loadMore:()=>{i(e+1)},hasMore:s,loader:r.createElement(Yn,null),threshold:500},r.createElement(Ub,null,n.map((e=>r.createElement(OI,{group:e,key:e.id,showVisitors:!0,showViews:!0}))),0===n.length&&r.createElement("p",{className:"mt-list__empty"},"Сайтов не найдено"))))}}kI.propTypes={actions:f().object,groups:f().arrayOf(f().object),page:f().number,hasMore:f().bool,currentPeriod:f().string,order:f().string,searchValue:f().string};const AI=(0,i.$j)((e=>({groups:e.groups.ratedGroups,page:e.groups.page,hasMore:e.groups.hasMore,currentPeriod:e.groups.period,order:e.groups.order,preloaderVisible:e.groups.preloaderVisible,searchValue:e.groups.searchValue})),(e=>({actions:(0,le.DE)(s,e)})))((0,ae.Z)(kI,"groups"));
/**
 * Mirtesen.
 *
 * Billing Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class xI extends r.PureComponent{render(){const{billing:e}=this.props,t='Ваш аккаунт привязан к  <a href="https://moneymove.mirtesen.ru/">Moneymove.ru</a>. Что-бы отвязать нажмите <a target="_blank" href="'+e.bindingUrl+'">сюда</a>',n='Для того чтобы зарабатывать деньги вместе с нами Вы должны авторизироваться на <a href="https://moneymove.mirtesen.ru/">Moneymove.ru</a> и <a target="_blank" href="'+e.bindingUrl+'">привязать</a> аккаунт';return r.createElement("div",{className:"billing-message"},e.isBound&&r.createElement("div",{dangerouslySetInnerHTML:{__html:t}}),!e.isBound&&r.createElement("div",{dangerouslySetInnerHTML:{__html:n}}))}}xI.propTypes={billing:f().object};const LI=(0,i.$j)((e=>({billing:e.billing})),(()=>({})))((0,ae.Z)(xI,"billing")),DI=(0,r.memo)((({birthday:e,isOwner:t,holiday:n})=>{const a={"holiday-block":!0,"holiday-block_birthday":e,"holiday-block_owner":t};return(e||n.title)&&r.createElement("div",{className:_()(a)},r.createElement("div",{className:"holiday-block__title-wrapper"},r.createElement("div",{className:"holiday-block__title",dangerouslySetInnerHTML:{__html:e?"Поздравьте друга с Днём рождения!":n.title}})))}));DI.propTypes={holiday:f().object,birthday:f().bool,isOwner:f().bool};const RI=DI;
/**
 * Mirtesen.
 *
 * Person Post Editor Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ZI extends r.Component{state={canShowHolidayInformer:null,tooltipInformerId:null};componentDidMount(){const{onGetHoliday:e,identifier:t,target:n}=this.props;L()(this.props,"params.showHoliday")&&e(t,n)}componentDidUpdate(){const{holiday:e={},isBirthday:t}=this.props.mtPostEditor[this.props.identifier]||Pt;if(null===this.state.canShowHolidayInformer&&(e.loaded&&null!==e.title||t)){const t=e.title&&y.Z.hashString(e.title)||Number((new Date).getDate()+""+(new Date).getMonth());this.setState({tooltipInformerId:t,canShowHolidayInformer:ca.canView(t,{id:1004,display:"interval",displayInterval:{auth:86400,guest:86400}})})}}handleShowModal=(e,t={})=>{const{author:n,target:a,personVislvl:s,onShowModal:r}=this.props;this.setState({canShowHolidayInformer:!1}),this.state.tooltipInformerId&&ca.setView(this.state.tooltipInformerId),r(e,null,{author:n,target:a,personVislvl:s,...t})};getPlaceholder=()=>{const{author:e,target:t,isMobile:n}=this.props,a=e.id.toString()===t.id.toString();return n?a?"Что у вас нового?":"Напишите на стене":a?`Что у вас нового, ${e.name.split(" ")[0]}?`:`Напишите что-нибудь на стене, ${e.name.split(" ")[0]}`};isOwner=()=>{const{author:e,target:t}=this.props;return"user"===t.type&&Number(e.id)===Number(t.id)};showBirthday=e=>{const{target:t}=this.props;let n=!1;return"undefined"!=typeof window&&(n="1"===window.sessionStorage.getItem(`congratulated_${t.id}`)),e&&!n};render(){const{addImages:e,addVideoByUpload:t,params:n,author:a,pollData:s={},personVislvl:o,identifier:i}=this.props,{showHoliday:l,showPoll:c}=n,m=this.props.mtPostEditor[i]||Pt,{activeTab:d,images:p,video:u,holiday:g={},inProcess:h,isBirthday:E,target:f}=m,b=this.isOwner(),y=this.getPlaceholder(),v={identifier:i,mtPostEditor:m,activeTab:d,addImages:e,addVideoByUpload:t,showPoll:c,images:p,video:u,isOwner:b,inProcess:h,pollData:s,personVislvl:o,target:f,setTab:(e,t)=>{this.handleShowModal(e,{activeTab:t})}},T=this.showBirthday(E);return r.createElement("div",{className:_()({"mt-post-editor":!0,"mt-post-editor_switcher":!0,"birthday-background":T,"mt-post-editor_holiday":T||g.title})},r.createElement("div",{className:"mt-post-editor__body"},l&&g.loaded&&!1!==this.state.canShowHolidayInformer&&r.createElement(RI,{identifier:i,holiday:g,birthday:T,isOwner:b}),r.createElement("div",{className:"mt-post-editor__editor-area"},r.createElement(Mn.Z,{logoInfo:{userName:a.name,logoImg:a.image,logoClassName:"userlogo_xxm"}}),r.createElement("div",{className:"mt-post-editor__message"},r.createElement("button",{type:"button",className:"mt-post-editor__modal-btn",onClick:()=>this.handleShowModal(i)},y))),r.createElement(Pn,v)))}}ZI.propTypes={identifier:f().string,mtPostEditor:f().object,target:f().object,author:f().object,pollData:f().object,personVislvl:f().string,addImages:f().func,addVideoByUpload:f().func,onGetHoliday:f().func,onShowModal:f().func,params:f().object,isMobile:f().bool};const BI=(0,i.$j)((e=>({mtPostEditor:e.mtPostEditor,pollData:e?.mtPoll?.pollFormData,isMobile:e?.app?.isMobile})),(e=>({addImages:(t,n,a)=>{e(Bt(t,a))},addVideoByUpload:(t,n,a)=>{e(Ht(t,a))},onGetHoliday:(t,n)=>{e(Vt(t,n))},onShowModal:(t,n,a)=>{e(Rt(t,n,a))}})))(ZI),$I=({tabs:e,onSetTab:t,activeTab:n,isLogged:a})=>{const s=(0,i.v9)((e=>e.app.isHeaderOpen));return r.createElement("div",{className:_()("person-feed-switcher",{"person-feed-switcher_header-open":s}),id:"feed-switcher"},r.createElement("div",{className:"person-feed-switcher__inner"},(()=>{const s=[];return e.forEach((([e,o])=>{s.push(r.createElement(r.Fragment,{key:`feed-switcher-${e}`},r.createElement("button",{type:"button",id:`feed-switcher-${e}`,className:_()({"person-feed-switcher__btn":!0,"person-feed-switcher__btn_active":n===e}),onClick:()=>{("friends"!==e||a)&&t(e)}},o)))})),s})()))};$I.propTypes={tabs:f().array,activeTab:f().string,isLogged:f().bool,onSetTab:f().func};const UI=(0,r.memo)($I);var HI="/index.js";
/**
 * Mirtesen.
 *
 * API interface for People You May Know widget.
 *
 * @author       Alexey Savchik.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */class FI{static status={delete:3,add:1};static getPymk=async(e=4,t=0,n={})=>{try{return await R.Z.request({query:`query {\n                    getPymk (limit: ${e}, offset: ${t}) {\n                        id\n                        display_name\n                        photo_original\n                        mutualFriends {\n                            id,\n                            display_name,\n                            photo_original\n                        } \n                    }\n                }`,endpoint:{endpoint:"user",ver:"v1"},res:n.res,req:n.req})||[]}catch(e){D.Z.promiseHandler(HI)(e)}};static setPymkStatus=async(e,t)=>{try{return await R.Z.request({query:`mutation {\n                    setPymkStatus(id: ${e}, status: ${FI.status[t]})\n                  }`,endpoint:{endpoint:"user",ver:"v1"}})}catch(e){D.Z.promiseHandler(HI)(e)}};static getTopAuthors=async(e=4,t=0)=>{try{return await R.Z.request({query:`query {\n                    getTopWriters(limit: ${e}, offset: ${t}) {\n                        id\n                        display_name\n                        photo_original\n                    }\n                }`,endpoint:{endpoint:"user",ver:"v1"}})||[]}catch(e){D.Z.promiseHandler(HI)(e)}};static setTopAuthorStatus=async(e,t)=>{try{return await R.Z.request({query:`mutation{\n                    setTopWriterStatus(id:${e}, status:${FI.status[t]}) \n                   }`,endpoint:{endpoint:"user",ver:"v1"}})}catch(e){D.Z.promiseHandler(HI)(e)}};static getFriendshipRequests=async(e={})=>{try{return await R.Z.request({query:`query {\n                    getFriendshipRequests {\n                      type\n                      items{\n                        ${Tt.i}\n                      }\n                    }\n                }`,endpoint:{endpoint:"user",ver:"v1"},res:e.res,req:e.req})}catch(e){D.Z.promiseHandler(HI)(e)}}}const jI=FI,GI=n(8778).pluralize,qI=()=>{const e=b.ZP.getCurrentUser(),t=re.Z.getConfig(),[n,a]=(0,r.useState)(null);(0,r.useEffect)((()=>{s()}),[]);const s=async()=>{let e=[];if((await jI.getFriendshipRequests()||[]).map((t=>{"INCOME"===t.type.toUpperCase()&&(e=t.items||[])})),e.length<1)return void a(null);const t=e.shift(),n=await Tt.Z.getById(t.id);a(n)},o=L()(n,"profileInfo");return b.ZP.isLogged()&&L()(n,"id")?r.createElement("div",{className:"card widget-incoming-friend-request"},r.createElement("div",{className:"widget-incoming-friend-request__header"},"С вами хотят дружить"),r.createElement("div",{className:"widget-incoming-friend-request__content"},r.createElement(cg,{userId:n.id,tagName:"span"},r.createElement(Mn.Z,{logoInfo:{userName:n.display_name,logoImg:n.photo_original,logoClassName:"userlogo_l2",logoUrl:Tt.Z.getUrl(n.id,t.mainProto,t.mainDomain)}})),r.createElement("div",null,r.createElement(cg,{userId:n.id,tagName:"span"},r.createElement("a",{className:"widget-incoming-friend-request__nickname",href:Tt.Z.getUrl(n.id,t.mainProto,t.mainDomain)},n.display_name)),o?.mutualFriendsNum>0&&r.createElement("div",{className:"widget-incoming-friend-request__friends-count"},o.mutualFriendsNum," общих"," ",GI(o.mutualFriendsNum,"друг","друга","друзей")))),r.createElement("div",{className:"widget-incoming-friend-request__actions"},r.createElement(He.Z,{type:"button",onClick:()=>{(async e=>{na.ym("reachGoal","click_add_friend_block_main"),"undefined"!==await eu.addToFriends(e,"join_accept")&&(kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Новый друг успешно добавлен"}),s())})(n.id)},label:"Дружить"}),r.createElement(He.Z,{color:"secondary",type:"button",onClick:()=>{(async e=>{na.ym("reachGoal","click_close_friend_block_main"),"undefined"!==await eu.deleteFriend(e,"join_reject")&&(kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Предложение дружбы отклонено"}),s())})(n.id)},label:"Игнорировать"})),r.createElement("div",{className:"widget-incoming-friend-request__footer"},r.createElement("a",{href:Tt.Z.getUrl(e.id,t.mainProto,t.mainDomain)+"/friends/incoming-requests"},"Посмотреть все запросы"))):null},VI=(0,r.memo)(qI);var zI="/index.js";
/**
 * Mirtesen.
 *
 * Pymk Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const WI=(0,r.memo)((({title:e="",userList:t=[],onAdd:n,onDelete:a,addButtonText:s})=>r.createElement("div",{className:"recommended-users"},r.createElement("h3",{className:"recommended-users__title"},e),r.createElement("ul",{className:"recommended-users__list"},t.map((e=>{const{mutualFriends:t=[]}=e,o=t.slice(0,7);return r.createElement("li",{className:"recommended-users__item",key:e.id},r.createElement(cg,{userId:e.id,tagName:"span"},r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo_original,logoClassName:"userlogo_m",logoUrl:`https://mirtesen.ru/people/${e.id}`}})),r.createElement("div",{className:"recommended-users__item-desc"},r.createElement("div",{className:"recommended-users__user-info"},r.createElement(cg,{userId:e.id,tagName:"span"},r.createElement("a",{href:`https://mirtesen.ru/people/${e.id}`,className:"recommended-users__name"},e.display_name)),t.length>0&&r.createElement("a",{className:"recommended-users__counter",href:`https://mirtesen.ru/people/${e.id}/friends`},t.length+" "+y.Z.num2string(t.length,["общий","общих","общих"])+" "+y.Z.num2string(t.length,["друг","друга","друзей"]))),r.createElement("div",{className:"recommended-users__friends"},o.map(((e,t)=>r.createElement(cg,{userId:e.id,tagName:"span",className:"recommended-users__friends-item",style:{zIndex:o.length-t},key:e.id},r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo_original,logoClassName:"userlogo_s",logoUrl:`https://mirtesen.ru/people/${e.id}`}}))))),r.createElement("div",{className:"recommended-users__controls"},r.createElement(He.Z,{label:s,type:"button",onClick:()=>n(e.id)}),r.createElement(He.Z,{color:"secondary",icon:"close",type:"button",onClick:()=>a(e.id),isCompact:!0}))))}))))));WI.propTypes={title:f().string,userList:f().array,onAdd:f().func,onDelete:f().func,addButtonText:f().string};const YI=WI,KI=(0,r.memo)((({recommendedFriends:e,getPymk:t,setPymkStatus:n})=>((0,r.useEffect)((()=>{t(2)}),[t]),e.length?r.createElement(YI,{title:"Вы можете их знать",userList:e,onAdd:e=>{na.ym("reachGoal","click_friend_pymk"),n(e,"add")},onDelete:e=>{na.ym("reachGoal","click_cancel_pymk"),n(e,"delete")},addButtonText:"Дружить"}):null)));KI.propTypes={recommendedFriends:f().array,getPymk:f().func,setPymkStatus:f().func};const JI=(0,i.$j)((e=>({recommendedFriends:e?.pymk?.recommendedFriends})),(e=>({getPymk:t=>{e((e=>async t=>{try{return t({type:"PYMK_GET_RECOMMENDED_FRIENDS",recommendedFriends:await jI.getPymk(e)})}catch(e){D.Z.promiseHandler(zI)(e)}})(t))},setPymkStatus:(t,n)=>{e(((e,t)=>async n=>{try{await jI.setPymkStatus(e,t)?(n({type:"PYMK_SET_STATUS",id:e}),"add"===t&&kt.Z.sendSystemMessage("addFriend")):kt.Z.sendSystemMessage("exception")}catch(e){D.Z.promiseHandler(zI)(e)}})(t,n))}})))((0,ae.Z)(KI,"PymkWidget"));var XI="/index.js";
/**
 * Mirtesen.
 *
 * Top Aithors Widget Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const QI=(0,r.memo)((({topAuthors:e,getTopAuthors:t,setTopAuthorStatus:n,showCount:a})=>{if((0,r.useEffect)((()=>{e.length<a&&t()}),[t,a,e]),!e.length)return null;const s=e.slice(0,a);return r.createElement(YI,{title:"Самые активные в МирТесен",userList:s,onAdd:e=>n(e,"add"),addButtonText:"Подписаться",onDelete:e=>n(e,"delete"),showCount:a})}));QI.propTypes={topAuthors:f().arrayOf(f().object),getTopAuthors:f().func,setTopAuthorStatus:f().func,showCount:f().number};const eC=(0,i.$j)((e=>({topAuthors:e?.topAuthors?.userList,showCount:e?.topAuthors?.showCount})),(e=>({getTopAuthors:()=>{e((async(e,t)=>{try{const n=t().topAuthors,{offset:a,hasMore:s}=n;if(!s)return;const r=await jI.getTopAuthors(10,a);return e({type:"TOP_AUTHORS_GET_LIST",userList:r,offset:a+r.length,hasMore:r.length>=10})}catch(e){D.Z.promiseHandler(XI)(e)}}))},setTopAuthorStatus:(t,n)=>{e(((e,t)=>async n=>{try{await jI.setTopAuthorStatus(e,t)?(n({type:"TOP_AUTHORS_SET_STATUS",id:e}),"add"===t&&kt.Z.sendSystemMessage("subscribed")):kt.Z.sendSystemMessage("exception")}catch(e){D.Z.promiseHandler(XI)(e)}})(t,n))}})))((0,ae.Z)(QI,"TopAuthorsWidget")),tC=({type:e,onClick:t,extraClasses:n,disabled:a=!1})=>r.createElement(He.Z,{color:"secondary",onClick:t,extraClasses:_()(`swiper-button-${e} arrow-btn_${e}`,n,{"swiper-button-prev_disabled":a}),isCompact:!0});function nC(){return nC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},nC.apply(this,arguments)}const aC=N((()=>Promise.all([n.e(526).then(n.t.bind(n,88667,23)),n.e(743).then(n.bind(n,83651))]).then((([e])=>e))),"reactIdSwiper"),sC=({children:e,title:t})=>{const[n,a]=(0,r.useState)(!0),[s,o]=(0,r.useState)(!1),i=(0,r.useRef)(null),l={slidesPerView:"auto",spaceBetween:10,on:{fromEdge:()=>{a(!1),o(!1)},reachBeginning:()=>a(!0),reachEnd:()=>o(!0),observerUpdate:()=>{i.current&&i.current.swiper&&i.current.swiper.slideTo(0),a(!0),o(!1)}}};return e?r.createElement("div",{className:"recommendation-swiper"},r.createElement("h3",{className:"recommendation-swiper__title"},t),r.createElement(aC,nC({},l,{ref:i,observer:!0}),e),r.createElement(tC,{type:"prev",onClick:()=>{i.current&&i.current.swiper&&i.current.swiper.slidePrev()},disabled:n}),r.createElement(tC,{type:"next",onClick:()=>{i.current&&i.current.swiper&&i.current.swiper.slideNext()},disabled:s})):null};sC.propTypes={children:f().element,title:f().string};const rC=(0,r.memo)(sC);const oC=(0,r.memo)((({id:e,label:t,logoUrl:n})=>{const[a,s]=(0,r.useState)("");return(0,r.useEffect)((()=>{Xo.Z.getSiteSettings(e).then((e=>s(e?.about?.description))).catch((e=>D.Z.promiseHandler("/index.js")(e)))}),[e]),r.createElement("div",{className:"recommended-site"},r.createElement(Mn.Z,{logoInfo:{logoClassName:"recommended-site__logo",userName:t,logoImg:n}}),r.createElement("h3",{className:"recommended-site__title"},t),r.createElement("p",{className:"recommended-site__text"},a),r.createElement($u,{wrapClasses:"recommended-site__subscribe-wrap",onClickHandler:()=>na.ym("reachGoal","click_recom_chan_lenta"),siteId:e,isMini:!0}))}));oC.propTypes={id:f().number,label:f().string,logoUrl:f().string};const iC=oC;const lC=()=>{const[e,t]=(0,r.useState)(null);return(0,r.useEffect)((()=>{(async()=>{try{const e=await Xo.Z.getRatedGroups({page:1,limit:20,period:"PERIOD_MONTH",orderBy:"ORDER_BY_RECOMMEND"});t(e)}catch(e){D.Z.promiseHandler("/index.js")(e)}})()}),[]),e?r.createElement(r.Fragment,null,e.map((e=>{const{id:t,label:n,logo_url:a}=e;return r.createElement("div",{className:"swiper-slide",key:t},r.createElement(iC,{id:t,label:n,logoUrl:a}))}))):null},cC=({posts:e,nonFriendPostIds:t,app:n,user:a,actionModifyPostPopup:s,hasMore:o,handleLoadMore:i,activeTab:l,widgetPosition:c,widgets:m,isLogged:d,openAuthForm:p,personVislvl:u,onShowMtPostEditor:g})=>{const{count_friends:h}=a||{};let _=0;n.site=n.site||{};const E=L()(n,"req.isMobile"),f=e=>{const t=a?.id&&("main"===l||"feed"===l);if(!m?.length||!t)return null;for(const t of m){const[n,a]=t;if(n===e)return a}return null};return 0!==e.length||o?r.createElement(zn,{pageStart:0,loadMore:i,hasMore:o,loader:r.createElement(Yn,null),threshold:800},e.length>0&&e.map(((e,n)=>{if(s?.approveList?.[e.id])return null;_++;const a=_>0&&_%3==0;return r.createElement(dE,{key:`${e.id||e.smi2_id}_${n}`},f(_),r.createElement(HS,{post:e,nonFriendPostIds:t,onLinkClick:bd,postLabelEnabled:!e.smi2_id,reasonsForShowingEnabled:!0,subscribeButtonEnabled:"post"===e.post_type&&!e.smi2_id}),a&&r.createElement("div",{className:"adfox-outer blog-post-list__ad-block"},E&&r.createElement(Fh,{type:"Politpiar",id:99813}),!E&&r.createElement(Fh,{type:"Politpiar",id:99815})))})),"feed"===l&&!h&&f(c.TOP_BLOGGERS)):(()=>{const{count_friends:e,id:t}=a||{};let n="Здесь пока ничего нет";return"feed"!==l||e||(n=r.createElement(r.Fragment,null,r.createElement("h3",null,"К сожалению, у вас ещё нет друзей в МирТесен... Что делать?"),r.createElement("ol",null,r.createElement("li",null,"Загляните в",r.createElement("a",{href:`${Rp().mainProto}://${Rp().mainDomain}/people/${t}/friends/incoming-requests`},"раздел со входящими заявками на дружбу"),"."),r.createElement("li",null,"Вернитесь на ",r.createElement("a",{href:`${Rp().mainProto}://${Rp().mainDomain}/main`},"главную страницу МирТесен")," с лентой рекомендованных материалов."),r.createElement("li",null,"Подпишитесь на самых активных участников МирТесен 👇")))),r.createElement("article",{className:"blog-post blog-post__no-posts"},n)})()};cC.propTypes={posts:f().array,nonFriendPostIds:f().array,app:f().object,user:f().object,activeTab:f().string,actionModifyPostPopup:f().object,hasMore:f().bool,handleLoadMore:f().func,onShowMtPostEditor:f().func,isLogged:f().bool,openAuthForm:f().func,personVislvl:f().string,widgets:f().array,widgetPosition:f().object};const mC=(0,r.memo)(cC),dC=()=>{const[e,t]=(0,r.useState)(!0);return e?r.createElement("div",{className:"mt-promo"},r.createElement("div",{className:"content"},r.createElement("div",{className:"text"},r.createElement("h3",null,"Новый MT.ру"),r.createElement("p",null,"Ничего лишнего, только контент")),r.createElement(ia.Z,{className:"btn",href:"https://mt.ru",onClick:e=>{e.preventDefault(),na.ym("reachGoal","newmt"),bd(e)}},"Посмотреть")),r.createElement(ia.Z,{className:"close",type:"button",onClick:()=>{na.ym("reachGoal","newmtclose"),t(!1)}},r.createElement(yn.Z,{iconName:"close"}))):null},pC=(0,r.memo)(dC);
/**
 * Mirtesen.
 *
 * Index main authorized container.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class uC extends r.Component{constructor(e){super(e),this.feed=r.createRef(),this.FEED_OFFSET=16,this.widgetPosition={PYMK:3,TOP_BLOGGERS:5,RECOMMENDED_SITES:9}}componentDidMount(){const{app:e,openAuthForm:t}=this.props,n=L()(e,"req.query.auth",null);!pd.isLogged()&&n&&t(n),this.widgets=[[this.widgetPosition.PYMK,r.createElement("div",{className:"blog-post-list__widget-wrap"},r.createElement(JI,null),r.createElement(Mv,null))],[this.widgetPosition.TOP_BLOGGERS,r.createElement(eC,null)],[this.widgetPosition.RECOMMENDED_SITES,r.createElement(rC,{title:"МирТесен рекомендует"},r.createElement(lC,null))]],window.addEventListener("message",this.handleGetMessage)}componentWillUnmount(){window.removeEventListener("message",this.handleGetMessage)}handleGetMessage=e=>{const{onHidePost:t}=this.props;"MT_APP_HIDE_POST"===e?.data?.type&&t(e.data.id)};handleLoadMore=()=>{const{hasMore:e}=this.props.indexMainAuthorized,{onShowMore:t}=this.props;e&&t()};handleChangeTab=e=>{const{onSetTab:t,onShowMore:n,openAuthForm:a}=this.props;if(!pd.isLogged()&&vt.default.feeds[e].auth)return a("login");window.scrollTo(0,this.feed.current.offsetTop-this.FEED_OFFSET),window.history.pushState(null,"",`/${e}`),t(e),n()};render(){const{indexMainAuthorized:e,app:t,user:n,actionModifyPostPopup:a,onShowMtPostEditor:s,openAuthForm:o,personVislvl:i}=this.props,l=L()(t,"req.deviceType"),{posts:c,hasMore:m,nonFriendPostIds:d,switcherTabs:p,activeTab:u}=e,g={personVislvl:i,activeTab:u,posts:c,nonFriendPostIds:d,app:t,user:n,actionModifyPostPopup:a,hasMore:m,onShowMtPostEditor:s,handleLoadMore:this.handleLoadMore,isLogged:pd.isLogged(),openAuthForm:o,widgets:this.widgets,widgetPosition:this.widgetPosition};return r.createElement("div",{id:"index-main-inner-container"},r.createElement("div",{id:"double-column-container"},"phone"!==l&&r.createElement("div",{id:"right-column"},pd.isLogged()&&r.createElement(r.Fragment,null,r.createElement(Xy,null),r.createElement(VI,null)),r.createElement(h_,null,r.createElement(B_,{split:.4},r.createElement(R_,{adId:10080}),r.createElement(Fh,{type:"Politpiar",id:95129})),r.createElement(Fh,{position:"smi2RightBlock"}))),r.createElement("div",{id:"content-column"},r.createElement("div",{className:"blog-post-list blog-post-list_index-main"},r.createElement(pC,null),pd.isLogged()&&r.createElement(BI,{identifier:"default",author:{id:n.id,name:n.display_name,image:n.photo_original||""},target:{type:"user",id:n.id,birthday:n.bdate},params:{showHoliday:!0,showPoll:!0},topicList:Cd.listTopics.filter((e=>e.theme)),personVislvl:i}),r.createElement("div",{className:"person-feed",ref:this.feed},"user-posts"!==u&&r.createElement(UI,{tabs:p,activeTab:u,onSetTab:this.handleChangeTab,isLogged:pd.isLogged()}),r.createElement(mC,g)),r.createElement(Qb,null),r.createElement(ty,null),r.createElement(Jb,null)))))}}uC.propTypes={indexMainAuthorized:f().object,onShowMorePosts:f().func,page:f().number,title:f().string,app:f().object,user:f().object,actionModifyPostPopup:f().object,personVislvl:f().string,onRestoreBlogPost:f().func,onShowMore:f().func,onSetTab:f().func,onShowMtPostEditor:f().func,openAuthForm:f().func,onHidePost:f().func};const gC=(0,i.$j)((e=>({app:e.app,title:e.indexMainAuthorized.title,indexMainAuthorized:e.indexMainAuthorized,actionModifyPostPopup:e.actionModifyPostPopup,page:e.indexMainAuthorized.page,user:e.auth.user,personVislvl:e.personSettings.vislvl})),(e=>({onShowMore:(t,n,a)=>{e((async(e,t)=>{const n=t(),a=L()(n,"auth.user.id"),{posts:s,nonFriendPostIds:r,feedId:o,nextOffset:i,activeTab:l}=n.indexMainAuthorized,c=vt.default.getFeedParams(l,!!a),m="main"===l?3:Rp().postsPerPage,d={offset:i,limit:m,filter:c.filter,feedId:o,userId:a,disabledIds:s.filter((({disabled_id:e})=>e)).map((({disabled_id:e})=>e))};"feed"===l&&(d.ver=3);const p=await c.loader(d),u=L()(p,"items",[]),g=L()(p,"nonFriendPostIds",[]);return e({type:"MAIN_POST_LIST_GET_LIST",nextOffset:i+m,hasMore:u.length>0,posts:[...s,...u],nonFriensPostIds:[...r,...g]})}))},onSetTab:t=>{e((e=>({type:"MAIN_POST_LIST_SET_TAB",activeTab:e}))(t))},onShowMtPostEditor:t=>{e(Rt("default",null,t))},openAuthForm:t=>e(_e(t)),onHidePost:t=>{e((e=>({type:"MAIN_POST_LIST_HIDE_POST",hiddenPost:e}))(t))}})))((0,ae.Z)(uC,"indexMainAuthorized"));var hC=n(99612);
/**
 * Mirtesen.
 *
 * Function defining user os.
 *
 * @author       Alexey Duybo.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
function _C(e){if(!e){if("undefined"==typeof window||!window?.navigator)return null;e=window.navigator.userAgent}return/iphone|ipad|ipod/gi.test(e)||"undefined"!=typeof window&&/Macintosh/gi.test(e)&&window.navigator?.maxTouchPoints>1?"ios":/android/gi.test(e)?"android":/linux/gi.test(e)?"linux":/win/gi.test(e)?"windows":/mac/gi.test(e)?"mac":null}
/**
 * Mirtesen.
 *
 * Popular Post List Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const EC=(0,r.memo)((({popularPostsList:e,onShowMorePosts:t})=>{const{listType:n}=e;return r.createElement(r.Fragment,null,r.createElement("h1",{className:"topic-post-list-title"},"commented"===n.toLowerCase()?"Самые обсуждаемые новости МирТесен":"Наиболее популярные новости"),r.createElement(Hv,{onLoadMore:t,dispute:"commented"===n.toLowerCase()}))}));EC.propTypes={popularPostsList:f().object,onShowMorePosts:f().func};const fC=(0,i.$j)((e=>({popularPostsList:e.popularPostsList})),(e=>({onShowMorePosts:()=>{e((async(e,t)=>{try{const n=t(),{listType:a}=n.popularPostsList,{page:s,recordsOnPage:r}=n.postTiles.default;let{posts:o}=n.postTiles.default;const i=s+1,l=await vp.getPopularBlogPosts({type:a,limit:r,offset:(i-1)*r,params:{fieldList:"tile"}});if(o=[...o,...l],o=o.filter((e=>e.images.length>0)),i>0){const e="page="+i;let t=window.location.href;const n=/page=\d+/i;t=t.replace(n,"").replace("?&","?").replace(/(&|\?)+$/,""),t=-1!==t.indexOf("?")?t+"&"+e:t+"?"+e,window.history.pushState(null,"",t)}e({type:"POST_TILES_LOAD_MORE",posts:o,hasMore:l.length>=r,page:i})}catch(e){D.Z.promiseHandler("/index.js")(e)}}))}})))((0,ae.Z)(EC,"popularPostsList"));
/**
 * Mirtesen.
 *
 * Bloggers Post List Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const bC=(0,r.memo)((({onShowMorePosts:e})=>r.createElement(r.Fragment,null,r.createElement("h1",{className:"topic-post-list-title"},"Блогеры МирТесен",r.createElement("span",null,"Читайте эксклюзивные материалы лучших авторов")),r.createElement("a",{href:"mailto:partners@corp.mirtesen.ru?subject=Хочу стать Блогером в МТ",className:"btn btn-primary",style:{marginBottom:"20px"}},"Стать блогером"),r.createElement(Hv,{onLoadMore:e}))));bC.propTypes={onShowMorePosts:f().func};const yC=(0,i.$j)((e=>({bloggersPostsList:e.bloggersPostsList})),(e=>({onShowMorePosts:()=>{e((async(e,t)=>{try{const n=t(),{page:a,recordsOnPage:s}=n.postTiles.default;let{posts:r}=n.postTiles.default;const o=a+1,i=await vp.getBloggerPosts({offset:(o-1)*s,limit:s,params:{fieldList:"tile"}});if(r=[...r,...i],r=r.filter((e=>e.images.length>0)),o>0){const e="page="+o;let t=window.location.href;const n=/page=\d+/i;t=t.replace(n,"").replace("?&","?").replace(/(&|\?)+$/,""),t=-1!==t.indexOf("?")?t+"&"+e:t+"?"+e,window.history.pushState(null,"",t)}e({type:"POST_TILES_LOAD_MORE",posts:r,hasMore:i.length>=s,page:o})}catch(e){D.Z.promiseHandler("/index.js")(e)}}))}})))((0,ae.Z)(bC,"bloggersPostsList"));const vC=
/**
 * Mirtesen.
 *
 * API interface for Billing.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class{static getBillingHistory(e=0,t={}){const n={project:"main",body:JSON.stringify({query:`query \n                    {\n                        getBillingHistory(page: ${e}) {\n                            date\n                            description\n                            article\n                            groupName\n                            groupUrl\n                            income\n                            outcome\n                            remark\n                        }\n                    }`})};return(0,yt.Z)({...t,...n}).then((e=>e?.data?.getBillingHistory||{})).catch(D.Z.promiseHandler("/index.js"))}},TC=(0,r.memo)((({user:e,billingList:t,onLoadMore:n})=>r.createElement("div",{className:"billing-list"},r.createElement("div",{className:"billing-list__header"},r.createElement("h1",{className:"billing-list__title"},"История операций"),r.createElement("div",{className:"billing-list__info"},e.display_name,", на Вашем счёте",r.createElement("br",null),r.createElement("b",null,e.userBalance.toFixed(2))," кред.",r.createElement("a",{href:"/payment",className:"billing-list__btn btn btn-primary"},"Пополнить счет"))),r.createElement("div",{className:"billing-list__items"},t.items.length>0&&r.createElement(zn,{pageStart:0,loadMore:()=>n(t.page),hasMore:t.hasMore,threshold:800,loader:r.createElement(Yn,null)},r.createElement("div",{className:"table"},r.createElement("div",{className:"th"},r.createElement("div",null,"Дата"),r.createElement("div",null,"Операция"),r.createElement("div",null,"Приход"),r.createElement("div",null,"Расход")),t.items.map(((e,t)=>r.createElement("div",{key:t,className:"tr"},r.createElement("div",null,r.createElement(s_,{date:e.date,format:"DD.MM.YYYY, H:mm"})),r.createElement("div",null,e.description,r.createElement("br",null),e.article&&r.createElement(r.Fragment,null,r.createElement("i",null,"за ",e.article),r.createElement("br",null)),e.groupName&&r.createElement(r.Fragment,null,"Сайт: ",r.createElement("a",{href:e.groupUrl},e.groupName)),e.remark),r.createElement("div",null,e.income||"0"),r.createElement("div",null,e.outcome||"0")))))),0===t.items.length&&r.createElement("p",{className:"mt-list__empty"},"Операций не найдено")))));TC.propTypes={billingList:f().object,user:f().object,onLoadMore:f().func};const SC=(0,i.$j)((e=>({billingList:e.billingList,user:e?.auth?.user||{}})),(e=>({onLoadMore:t=>{var n;e((n=t,async e=>{const t=await vC.getBillingHistory(n+1);if(t)return e({type:"BILLING_LIST_LOAD_MORE",page:n+1,billingList:t,hasMore:!!t.length})}))}})))((0,ae.Z)(TC,"BillingList"));
/**
 * Mirtesen.
 *
 * Activities list container.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class PC extends r.PureComponent{constructor(e){super(e),this.state={isMounted:!1},this.linkRef=r.createRef()}componentDidMount(){this.setState({isMounted:!0})}formatPublicationTime=e=>{if(!e)return"";const t=1e3*e;return y.Z.isToday(t)?"Ceгодня":y.Z.isYesterday(t)?"Вчера":K.Z.getLocalDate(e,"D MMMM")};render(){if(!this.state.isMounted)return null;const{deviceType:e,activitiesList:{items:t,hasMore:n},onLoadMore:a}=this.props,s=t.reduce(((e,t)=>{const n=this.formatPublicationTime(t.date),a=e[n]||[];return a.push(t),e[n]=a,e}),{});return r.createElement("div",{id:"index-main-inner-container"},r.createElement("div",{id:"double-column-container"},"phone"!==e&&r.createElement("div",{id:"right-column"},r.createElement(h_,null,r.createElement(Fh,{type:"Politpiar",id:99808}),r.createElement(Fh,{position:"smi2RightBlock"}))),r.createElement("div",{id:"content-column"},r.createElement("div",{className:"activity-list"},r.createElement("h1",{className:"activity-list__title"},"Уведомления"),r.createElement(zn,{pageStart:1,loadMore:a,hasMore:n,threshold:800,loader:r.createElement(Yn,null)},r.createElement("div",{className:"activity-list__items"},Object.keys(s).map(((e,t)=>r.createElement("div",{className:"activity-list__group",key:t},r.createElement("p",{className:"activity-list__group-title"},e),r.createElement("div",{className:"activity-list__items"},s[e].map((e=>r.createElement(Jd,{item:e,key:e.id,dateFormat:"HH:mm"})))))))))))))}}PC.propTypes={deviceType:f().string,user:f().object,activitiesList:f().object,onLoadMore:f().func};const wC=(0,i.$j)((e=>({activitiesList:e.activitiesList,user:e?.auth?.user||{},deviceType:e?.req?.deviceType})),(e=>({onLoadMore:()=>{e((async(e,t)=>{const n=t(),{nextFrom:a}=n.activitiesList;try{const t=await ip.getNotifications(Rp().recordsPerPage,a);t&&e({type:"ACTIVITIES_LIST_LOAD_MORE",items:t.items,nextFrom:t.next_from,hasMore:!!t.items.length})}catch(e){D.Z.promiseHandler("/index.js")(e)}}))}})))((0,ae.Z)(PC,"activitiesList")),IC=({feedback:e,onChangeValue:t,feedbackConfig:n,onSubmit:a,onDeleteError:s})=>{const{type:o,inProcess:i,errors:l}=e;return r.createElement("form",{action:"",className:"feedback__form",method:"post",onSubmit:a},r.createElement("div",{className:"feedback__content"},n[o].fields.map((n=>{const{name:a,label:o,type:i,required:c,group:m=[],className:d}=n,p=l[a];return r.createElement("div",{className:"feedback__group",key:`field-${a}`},"radiogroup"===i&&r.createElement(r.Fragment,null,r.createElement(VS,{error:{title:p},input:{type:i,label:o,name:a,group:m,isRequired:c,classNameInput:d},value:e[a],onChangeHandle:e=>{p&&s(a),t(a,parseInt(e.target.value,10))}})),("text"===i||"textarea"===i)&&r.createElement(VS,{error:p,input:{type:i,label:o,name:a,isRequired:c,rows:5},value:e[a],onChangeHandle:e=>{p&&s(a),t(a,e.target.value)}}))}))),r.createElement("div",{className:"feedback__footer"},r.createElement("p",{className:"feedback__note"},r.createElement("span",{className:"form_substr form-required"},"*")," обязательные поля"),r.createElement("button",{className:"btn btn-primary",type:"submit",disabled:i},r.createElement("svg",{className:"svg"},r.createElement("use",{href:"/images/icons.svg#send"})),"Отправить")))};IC.propTypes={feedback:f().object,onChangeValue:f().func,feedbackConfig:f().object,onSubmit:f().func,onDeleteError:f().func};const CC=(0,r.memo)(IC),NC=({tabs:e,onSetTab:t,activeTab:n})=>r.createElement("div",{className:"feedback__tabs"},e.map(((e,a)=>r.createElement("a",{key:a,href:n===e.name?null:e.url,className:_()({feedback__tab:!0,feedback__tab_active:n===e.name}),onClick:n=>{n.preventDefault(),t(e)}},e.title))));NC.propTypes={tabs:f().array,activeTab:f().string,onSetTab:f().func};const OC=(0,r.memo)(NC),MC=({tickets:e,onSetTab:t})=>Array.isArray(e)&&e?.length?r.createElement("div",{className:"feedback__tickets"},e.map((e=>r.createElement("a",{className:"feedback-ticket",key:e.id,href:`/feedback/${e.id}`,onClick:n=>{n.preventDefault(),t({name:"currentTicket",url:`/feedback/${e.id}`},e.id)}},r.createElement("span",{className:"feedback-ticket__status"},!e.answered&&r.createElement("i",null)),r.createElement("span",{className:"feedback-ticket__title"},e.title),r.createElement("span",{className:"feedback-ticket__date"},r.createElement(s_,{date:e.date,format:"D MMMM, H:mm"})))))):r.createElement("p",{className:"feedback__empty"},"Пока нет сообщений");MC.propTypes={tickets:f().array,onSetTab:f().func};const kC=(0,r.memo)(MC),AC=({currentTicket:e,user:t})=>{if(!e)return null;const{issue:n={},issueNotes:a=[]}=e;return r.createElement("div",{className:"feedback-item"},r.createElement("div",{className:"feedback-item__row"},r.createElement("div",{className:"feedback-item__header"},r.createElement(Mn.Z,{logoInfo:{userName:t.display_name,logoImg:t.photo_original,logoClassName:"userlogo_xs",title:t.display_name,logoUrl:t.url}}),r.createElement("a",{className:"feedback-item__author",href:t.url},t.display_name),r.createElement("span",{className:"feedback-item__date"},r.createElement(s_,{date:n.date,format:"D MMMM, H:mm"}))),r.createElement("div",{className:"feedback-item__content"},r.createElement("h4",null,n.title),r.createElement("p",null,n.text))),a&&a.map(((e,t)=>r.createElement("div",{className:"feedback-item__row",key:`note_${t}`},r.createElement("div",{className:"feedback-item__header"},r.createElement(Mn.Z,{logoInfo:{userName:"Мир Тесен",logoImg:"https://static.mtml.ru/images/logos/mirtesen-mobile.svg",logoClassName:"userlogo_xs",title:"Мир Тесен"}}),r.createElement("span",{className:"feedback-item__author"},"Мир Тесен"),r.createElement("span",{className:"feedback-item__date"},r.createElement(s_,{date:e.date,format:"D MMMM, H:mm"}))),r.createElement("div",{className:"feedback-item__content"},r.createElement("p",null,e.text))))))};AC.propTypes={currentTicket:f().object,user:f().object};const xC=(0,r.memo)(AC);
/**
 * Mirtesen.
 *
 * Feedback Container.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class LC extends r.PureComponent{constructor(e){super(e),this.wrapper=r.createRef(),this.tabs=[{name:"form",title:"Новое обращение",url:"/feedback/report"},b.ZP.isLogged()&&{name:"tickets",title:"Ответы",url:"/feedback"}],this.feedbackConfig={feedback:{title:"Обратная связь",fields:[!b.ZP.isLogged()&&{name:"email",label:"Ваш email для обратной связи",type:"text",required:!0,className:"feedback__input"},{name:"title",label:"Тема",type:"text",required:!0,className:"feedback__input"},{name:"category",label:"Категория",type:"radiogroup",group:[{text:"Ошибка",initVal:0},{text:"Предложение",initVal:2},{text:"Прочее",initVal:3},{text:"Про новый дизайн",initVal:9},{text:"Спам",initVal:10}],required:!0,className:"feedback__radiogroup"},{name:"message",label:"Сообщение разработчикам",type:"textarea",required:!0,className:"feedback__textarea"}]},spam:{title:"Пожаловаться на спам",fields:[!b.ZP.isLogged()&&{name:"email",label:"Ваш email для обратной связи",type:"text",required:!0,className:"feedback__input"},{name:"message",label:"Сообщение разработчикам",type:"textarea",required:!0,className:"feedback__textarea"}]}}}handleSetTab=(e,t)=>{const{isModalMode:n,onSetTab:a,feedback:{activeTab:s}}=this.props;e.name!==s&&(n||window.history.pushState(null,"",`${e.url}`),a(e.name,t))};handleSubmit=e=>{e.preventDefault();const{feedback:t,onSubmitForm:n,onAddErrors:a,isModalMode:s}=this.props,r={};return this.feedbackConfig[t.type].fields.forEach((e=>{let n=t[e.name];"string"==typeof n&&(n=n.trim()),e.required&&!n&&"number"!=typeof n&&(r[e.nsme]="Это обязательное поле"),"email"!==e.name||y.Z.isEmail(n)||(r[e.name]="Неверный формат почты")})),Sa()(r)?n(s):a(r)};render(){const{feedback:e,isModalMode:t,onChangeValue:n,onToggleModal:a,user:s,onDeleteError:o}=this.props,{type:i,activeTab:l,showModal:c,tickets:m,currentTicket:d}=e,p=r.createElement("div",{className:"feedback"},r.createElement("header",{className:"feedback__header"},"currentTicket"===l&&r.createElement("button",{type:"button",className:"feedback__back",onClick:e=>{e.preventDefault(),this.handleSetTab({name:"tickets",url:"/feedback"})}},r.createElement("svg",{className:"svg"},r.createElement("use",{href:"/images/icons.svg#back"}))),r.createElement("h1",null,this.feedbackConfig[i].title)),r.createElement(OC,{tabs:this.tabs,onSetTab:this.handleSetTab,activeTab:l}),"tickets"===l&&r.createElement(kC,{tickets:m,onSetTab:this.handleSetTab}),"currentTicket"===l&&r.createElement(xC,{currentTicket:d,user:s}),"form"===l&&r.createElement(CC,{feedback:e,onChangeValue:n,onSubmit:this.handleSubmit,feedbackConfig:this.feedbackConfig,onDeleteError:o}));return t?c?r.createElement(O.Z,{onClose:()=>a(i,!1),className:"feedback-modal",mobileTop:!0},p):null:p}}LC.propTypes={feedback:f().object,isModalMode:f().bool,user:f().object,onChangeValue:f().func,onSetTab:f().func,onToggleModal:f().func,onSubmitForm:f().func,onAddErrors:f().func,onDeleteError:f().func};const DC=(0,i.$j)((e=>({feedback:e.feedback,user:e?.auth?.user})),(e=>({onChangeValue:(t,n)=>{e(((e,t)=>({type:"FEEDBACK_SET_VALUE",name:e,value:t}))(t,n))},onSetTab:(t,n)=>{e(tg(t,n))},onToggleModal:(t,n)=>{e(ng(t,n))},onSubmitForm:t=>{e((e=>async(t,n)=>{const a=n(),{message:s,title:r,category:o,email:i,type:l}=a.feedback,c={title:"spam"===l?"Спам":r,text:s,email:b.ZP.isLogged()?b.ZP.getCurrentUser().email:i,categoryId:"spam"===l?10:Number(o)};t({type:"FEEDBACK_TOGGLE_PROCESS",inProcess:!0});try{await eg.addIssue(c)?(t({type:"FEEDBACK_ADD_TICKET",showModal:e}),b.ZP.isLogged()?t(tg("tickets")):(t(ng(l,!1)),kt.Z.sendSystemMessage("successSendFeedback"))):kt.Z.sendSystemMessage("exception"),t({type:"FEEDBACK_TOGGLE_PROCESS",inProcess:!1})}catch(e){t({type:"FEEDBACK_TOGGLE_PROCESS",inProcess:!1}),kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler("/index.js")(e)}})(t))},onAddErrors:t=>{e((e=>({type:"FEEDBACK_ADD_ERRORS",errors:e}))(t))},onDeleteError:t=>{e((e=>({type:"FEEDBACK_DELETE_ERROR",error:e}))(t))}})))((0,ae.Z)(LC,"Feedback")),RC=({isModalMode:e=!1})=>e?r.createElement(DC,{isModalMode:!0}):r.createElement("div",{id:"index-main-inner-container"},r.createElement("div",{id:"double-column-container"},r.createElement("div",{id:"right-column"},r.createElement(h_,null,r.createElement(Fh,{type:"Politpiar",id:99808}),r.createElement(Fh,{position:"smi2RightBlock"}))),r.createElement("div",{id:"content-column"},r.createElement(DC,null))));RC.propTypes={isModalMode:f().bool};const ZC=(0,r.memo)(RC);
/**
 * Mirtesen.
 *
 * Public Chats List Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const BC=(0,r.memo)((({onShowMorePosts:e})=>r.createElement(r.Fragment,null,r.createElement("div",{className:"topic-post-list__header-wrapper"},r.createElement("h1",{className:"topic-post-list-title"},"Публичные чаты МирТесен"),r.createElement("p",null,"Чаты, доступные для всех пользователей МирТесен. Жмите на то, что вам понравилось, присоединяйтесь к чатам, будьте активны, знакомьтесь и общайтесь с единомышленниками. Если вы хотите создать свой чат по любой теме, нажимайте кнопку ниже:"),r.createElement("a",{className:"btn btn-primary",href:"https://chat.mirtesen.ru/messenger/newGroup"},"Создать свой чат")),r.createElement(Hv,{onLoadMore:e,enableModeration:!1}))));BC.propTypes={onShowMorePosts:f().func};const $C=(0,i.$j)(null,(e=>({onShowMorePosts:()=>{e((async(e,t)=>{try{const n=t(),{page:a,recordsOnPage:s}=n.postTiles.default;let{posts:r}=n.postTiles.default;const o=a+1,i=await vp.getPublicChats({offset:(o-1)*s,limit:s,params:{headers:{"content-type":"application/json"}}});if(r=[...r,...i],o>0){const e="page="+o;let t=window.location.href;const n=/page=\d+/i;t=t.replace(n,"").replace("?&","?").replace(/(&|\?)+$/,""),t=-1!==t.indexOf("?")?t+"&"+e:t+"?"+e,window.history.pushState(null,"",t)}e({type:"POST_TILES_LOAD_MORE",posts:r,hasMore:i.length>=s,page:o})}catch(e){D.Z.promiseHandler("/index.js")(e)}}))}})))((0,ae.Z)(BC,"PublicChatsList")),UC=({activeTab:e,menuConfig:t,searchValue:n,handleChangeTab:a})=>{const s=Object.keys(t).map((s=>{const o=t[s],i=e===s?"span":"a",l=n?o.url+"/?q="+encodeURIComponent(n):o.url;return r.createElement("li",{className:"mt-search-menu__item",key:s},r.createElement(i,{href:e!==s?l:null,onClick:e=>{e.preventDefault(),a(s),window.history.pushState(null,"",l)}},o.title))}));return r.createElement("ul",{className:"mt-search-menu"},s)};UC.propTypes={menuConfig:f().object,activeTab:f().string,searchValue:f().string,handleChangeTab:f().func};const HC=(0,r.memo)(UC),FC=({mtSearch:e,onChangeSearch:t,onChangeTab:n})=>{const{activeTab:a,tabs:s,searchValue:o}=e;return r.createElement("div",{className:"mt-search-header"},r.createElement("h1",null,"Результаты поиска"),r.createElement(Jn,{defaultValue:o,handleSearch:t,searchUrl:s[a].url}),r.createElement(HC,{activeTab:a,searchValue:o,menuConfig:s,handleChangeTab:n}))};FC.propTypes={mtSearch:f().object,onChangeSearch:f().func,onChangeTab:f().func};const jC=(0,r.memo)(FC);
/**
 * Mirtesen.
 *
 * Mirtesen search page actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const GC=()=>async(e,t)=>{e({type:"MT_SEARCH_TOGGLE_LOADING"});const n=t().mtSearch,{searchValue:a,activeTab:s,tabData:r}=n,o=r?.[s]?.page,i="all"===s,l={count:Rp().recordsPerPage,offset:i?0:o*Rp().recordsPerPage},c={page:i?1:o+1,limit:Rp().recordsPerPage,period:Rp().groups.defaultPeriod,orderBy:Rp().groups.defaultOrder},m={type:"LIKED",limit:Rp().recordsPerPage,offset:0,params:{fieldList:"tile"}},d=[];switch(s){case"people":d.push(fp.Z.search(a,"ALL_PEOPLE",l)),d.push(Promise.resolve([])),d.push(Promise.resolve([]));break;case"groups":d.push(Promise.resolve([])),a?d.push(fp.Z.search(a,"ALL_SITES",l)):d.push(Xo.Z.getRatedGroups(c)),d.push(Promise.resolve([]));break;case"posts":d.push(Promise.resolve([])),d.push(Promise.resolve([])),a?d.push(fp.Z.search(a,"ALL_POSTS",l)):d.push(vp.getPopularBlogPosts(m));break;default:d.push(fp.Z.search(a,"ALL_PEOPLE",l)),a?(d.push(fp.Z.search(a,"ALL_SITES",l)),d.push(fp.Z.search(a,"ALL_POSTS",l))):(d.push(Xo.Z.getRatedGroups(c)),d.push(vp.getPopularBlogPosts(m)))}try{const[t,n,i]=await Promise.all(d),l={people:t,groups:Array.isArray(n)?n:n?.items||[],posts:i},c={};return Object.keys(r).forEach((e=>{c[e]={...r[e],data:[...r[e].data,...l[e]],page:e===s?o+1:0,hasMore:e===s&&l[e].length>=Rp().recordsPerPage}})),e({type:"MT_SEARCH_TOGGLE_LOADING"}),e({type:"MT_SEARCH_GET_RESULTS",tabData:c,searchValue:a})}catch(t){e({type:"MT_SEARCH_TOGGLE_LOADING"}),D.Z.promiseHandler("/index.js")(t)}},qC=(0,r.memo)((({mtSearch:e,onSearch:t,onChangeTab:n,onChangeSearch:a})=>{const{tabData:s,activeTab:o,tabs:i,isLoading:l,searchValue:c}=e;return r.createElement("div",{className:"mt-search"},r.createElement(jC,{mtSearch:e,onChangeSearch:a,onChangeTab:n}),r.createElement("div",{className:"mt-search__results"},Object.keys(s).map((e=>{const n=s[e],a=i[e];if(!n?.data?.length)return null;const l="posts"===e?10:2,m="all"===o?n.data.slice(0,l):n.data;return r.createElement(zn,{key:e,pageStart:0,loadMore:()=>{t()},hasMore:n.hasMore,loader:r.createElement(Yn,null),threshold:500},r.createElement(Ub,null,r.createElement("header",{className:"mt-search__group-header"},r.createElement("h4",{className:"mt-search__group-title"},a.title)),r.createElement("div",{className:"mt-search__group-list"},m.map((t=>{let n;switch(e){case"people":n=r.createElement(Lb,{person:t,key:t.id});break;case"groups":n=r.createElement(OI,{group:t,key:t.id,showMembers:!0});break;case"posts":n=r.createElement($T,{item:t,key:t.id});break;default:n=null}return n}))),"all"===o&&r.createElement("div",{className:"mt-search__group-footer"},r.createElement("a",{href:a.url+"/?q="+encodeURIComponent(c),className:"btn btn-secondary mt-search__group-link"},"Показать все"))))})),"all"!==o&&0===s[o]?.data?.length&&!l&&r.createElement(Ub,null,r.createElement("p",{className:"mt-list__empty"},"По Вашему запросу ничего не найдено")),(0===s[o]?.data?.length&&l||"all"===o&&l)&&r.createElement(Yn,null)))}));qC.propTypes={mtSearch:f().object,onSearch:f().func,onChangeTab:f().func,onChangeSearch:f().func};const VC=(0,i.$j)((e=>({mtSearch:e.mtSearch})),(e=>({onSearch:()=>{e(GC())},onChangeTab:t=>{e((e=>t=>(t({type:"MT_SEARCH_SET_TAB",activeTab:e}),t(GC())))(t))},onChangeSearch:t=>{e((e=>t=>(t({type:"MT_SEARCH_SET_SEARCH",searchValue:e}),t(GC())))(t))}})))(qC),zC=()=>{const e=(0,aa.T)(),t=(0,aa.C)((e=>e.testApi)),[n,a]=(0,r.useState)(null),{loaded:s,csrJwt:o,csrJwtButNoRefresh:i,ssrJwt:l,csrLogin:c,ssrLogin:m,postId:d}=t;return(0,r.useEffect)((()=>{a(!0),e((async(e,t)=>{const n=t(),{postId:a}=n.testApi,s=await b.ZP.getJwtAccessToken();return ya.Z.delete(b.W$),ya.Z.delete(b.Xk),e({type:"TEST_API_INIT_STATE",fields:{csrJwt:s,csrJwtButNoRefresh:await b.ZP.getJwtAccessToken(),csrLogin:(await R.Z.request("query getUserPostById($id: Float!) {\n                    getUserPostById(id: $id) {\n                        id\n                        canEdit\n                    }\n                }",{id:a},{endpoint:"main",ver:"v3"})).canEdit}})}))}),[e]),r.createElement(r.Fragment,null,r.createElement("div",null,"Mounted: ",n?"mounted":null),r.createElement("div",null,"Loaded: ",s?"loaded":null),r.createElement("div",null,"SSR jwt: ",l),r.createElement("div",null,"CSR jwt: ",o),r.createElement("div",null,"CSR jwt but no refresh: ",i),r.createElement("div",null,"Post Id: ",d),r.createElement("div",null,"SSR Can Edit: ",m?"true":"false"),r.createElement("div",null,"CSR Can Edit: ",c?"true":"false"))},WC=(0,r.memo)(zC),YC=({title:e,counter:t})=>r.createElement("div",{className:"hashtag-header__info"},r.createElement("h1",{className:"hashtag-header__title"},`#${Pa.Z.stripGeoId(e)}`),t>0&&r.createElement("p",{className:"hashtag-header__counter"},t+" "+y.Z.num2string(t,["пользователь","пользователя","пользователей"])+" "+y.Z.num2string(t,["подписан","подписаны","подписаны"])+" на тег")),KC=(0,r.memo)(YC),JC=({tag:e,tagId:t,canSubscribe:n})=>{const[a,s]=(0,r.useState)(0);return(0,r.useEffect)((()=>{(async()=>{const e=await Promise.all([Pa.Z.getTagSubscribersNumber(t)]);s(e[0])})()}),[]),r.createElement("div",{className:"hashtag-header"},r.createElement("div",{className:"hashtag-header__main"},r.createElement("div",null,r.createElement(sf,{tagId:t}),r.createElement(KC,{title:e,counter:a})),n&&r.createElement(kf,{id:t,ver:"header"})))},XC=(0,r.memo)(JC);var QC="/index.js";class eN extends EE.ZP{static feeds={feed:{title:"Инста",filterName:"USER_POSTS_FRIENDS_INSTA",switcher:!0,forAuthorized:!0,tooltipText:"Фото и видео ваших друзей",onlyClientSideRendering:!1},main:{title:"Для вас",filterName:"",switcher:!0,forAuthorized:!1,tooltipText:"Лучшие рекомендованные посты",onlyClientSideRendering:!0},"user-posts":{title:"Новости пользователей МирТесен",filterName:"",switcher:!1,forAuthorized:!0,onlyClientSideRendering:!1}};static getFeedParams(e,t){const n=eN.feeds[e];switch(e){case"main":t?(n.loader=vt.default.getNewsFeedPosts2,n.onlyClientSideRendering=!0,n.forAuthorized=!0):n.loader=vt.default.getSmi2Posts;break;case"feed":n.loader=vt.default.getPersonFeed;break;case"user-posts":n.loader=vt.default.getAllUserPosts;break;default:n.loader=null}return n}static async getSwitcherParams(){try{const e=await(0,yt.Z)({project:"main",body:JSON.stringify({query:"query {\n                    appConfig {\n                        mainTabTitle\n                        momentsTabTitle\n                        defaultTab\n                    }\n                }"})});if(!e)return;const{mainTabTitle:t,momentsTabTitle:n,defaultTab:a}=e.data.appConfig;return{mainTabTitle:t,momentsTabTitle:n,defaultTab:"MOMENTS"===a?"feed":a.toLowerCase()}}catch(e){D.Z.promiseHandler(QC)(e)}}static getBlogAndUserPosts({limit:e=6,offset:t=0,feedId:n="",params:a={}}){const s={project:"main",body:JSON.stringify({query:`query {\n                              getNewsfeedPosts(id:"${n}", limit:${e}, offset:${t}) {\n                                items {\n                                    ... on UserPost {\n                                        ${Nt.lP}\n                                        ${Nt.fO}\n                                        post_type\n                                        previewText\n                                        body\n                                        owner_id\n                                        owner_display_name\n                                    }\n                                    ... on BlogPost {\n                                        ${Nt.lP}\n                                        ${Nt.r_}\n                                        topic\n                                        title\n                                        preview_text\n                                        post_type\n                                        editorStatus\n                                    }\n                                }\n                                nonFriendPostIds\n                            }}`})};return(0,yt.Z)({...a,...s}).then((e=>({items:this.normalizePostList(e?.data?.getNewsfeedPosts?.items||[]),nonFriendPostIds:e?.data?.getNewsfeedPosts?.nonFriendPostIds||[]}))).catch((e=>{if(A.Z.isClientNetworkError(e))throw e;D.Z.promiseHandler(QC)(e)}))}static async getPostsByTag({tag:e,limit:t=10,offset:n=0}){try{const a=await R.Z.request({query:`query {\n                    getPostsByTag (tag:"${e}", limit:${t}, offset: ${n*t}) {\n                        items {\n                            ... on UserPost {\n                                ${Nt.lP}\n                                ${Nt.fO}\n                                post_type\n                                previewText\n                                body\n                                owner_id\n                                owner_display_name\n                            }\n                            ... on BlogPost {\n                                ${Nt.H_}\n                                ${Nt.r_}\n                                canonical_url\n                                topic\n                                title\n                                preview_text\n                                post_type\n                            }\n                        }\n                    }\n                }`,endpoint:{endpoint:"main",ver:"v3"}});let s=a?.items||[];return s=EE.ZP.normalizePostList(s),s}catch(e){D.Z.promiseHandler(QC)(e)}return[]}static async getChannelPostsByTag({tag:e,limit:t=10,offset:n=0,req:a,res:s}){try{const r=await R.Z.request({query:`query {\n                    getChannelPostsByTag (tag:"${e}", limit:${t}, offset: ${n*t}) {\n                        items {\n                            ... on UserPost {\n                                ${Nt.lP}\n                                ${Nt.fO}\n                                channel {\n                                  ${At.rS}\n                                }\n                                post_type\n                                previewText\n                                body\n                                owner_id\n                                owner_display_name\n                                msg_type_did\n                            }\n                        }\n                    }\n                }`,endpoint:{endpoint:"main",ver:"v3"},req:a,res:s});let o=r?.items||[];return o=EE.ZP.normalizePostList(o),o}catch(e){D.Z.promiseHandler(QC)(e)}return[]}static async getChannelPostsByGeoposition({tagId:e,lon:t,lat:n,limit:a=10,offset:s=0,radius:r=3e3,req:o,res:i}){try{const l=await R.Z.request({query:`query searchNearestPosts ($tagId: Float, $lon: Float, $lat: Float, $offset: Int, $limit: Int, $radius: Int) {\n                    searchNearestPosts (\n                        geotag_id: $tagId,\n                        limit: $limit,\n                        offset: $offset\n                        lon: $lon\n                        lat: $lat\n                        radius: $radius\n                    ) {\n                        items {\n                            ... on UserPost {\n                                ${Nt.lP}\n                                ${Nt.fO}\n                                channel {\n                                  ${At.rS}\n                                }\n                                post_type\n                                previewText\n                                body\n                                owner_id\n                                owner_display_name\n                                msg_type_did\n                            }\n                        }\n                    }\n                }`,variables:{tagId:e,lon:t,lat:n,offset:s*a,limit:a,radius:r},endpoint:{endpoint:"main",ver:"v3"},req:o,res:i});return EE.ZP.normalizePostList(l?.items||[])}catch(e){D.Z.promiseHandler(QC)(e)}return[]}}const tN=eN;
/**
 * Mirtesen.
 *
 * Hashtag post list actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const nN=(0,r.memo)((()=>{const e=(0,aa.C)((e=>e.hashtagPostList)),t=(0,aa.C)((e=>e?.auth?.user?.id)),[n,a]=(0,r.useState)(null),s=(0,aa.T)(),{tag:o,tagId:i,posts:l,hasMore:c,ownerId:m,lon:d,lat:p}=e;(0,r.useEffect)((()=>{(async()=>{if(d&&p)return void a({lon:d,lat:p,type:"point"});const e=await Pa.Z.getTagLocation(Number(i));if(e){const{osm_id:t,osm_type:n,lon:s,lat:r}=e||{};a({osmSid:n+t,lon:s,lat:r,type:"bounds"})}})()}),[]);const u=Pa.Z.isCustomTag(o),g=!i||Sy()(m)&&m!==t;return r.createElement("div",{className:"hashtag-list"},n&&r.createElement("div",{className:_()("geo-map-container","hashtag-list-map")},r.createElement(sa.ZP,{initialPosition:n})),!g&&r.createElement(XC,{tag:o,tagId:i,canSubscribe:!u}),r.createElement("div",{className:"hashtag-list__posts"},r.createElement(zn,{pageStart:0,loadMore:()=>{c&&s((async(e,t)=>{try{const n=t(),{offset:a,tag:s,posts:r,loadType:o,lon:i,lat:l,tagId:c}=n.hashtagPostList,m={tag:s,offset:a,limit:10};let d;switch(o){case"channel":d=tN.getChannelPostsByTag;break;case"geoposition":d=tN.getChannelPostsByGeoposition,m.lon=i,m.lat=l,m.tagId=c;break;case"mirtesen":d=tN.getPostsByTag;break;default:d=null}if(!d)return;const{items:p,offset:u,hasMore:g}=await K.Z.loadWithFilter(r,a,{func:d,params:m},{func:e=>K.Z.removeDuplicates(e)});e({type:"HASHTAGS_POST_LIST_LOAD_MORE",payload:{posts:p,offset:u,hasMore:g}})}catch(e){D.Z.promiseHandler("/index.js")(e)}}))},hasMore:c,loader:r.createElement(Yn,null),threshold:400},l.length<1&&!c&&r.createElement("article",{className:"blog-post blog-post__no-posts",key:0},"Здесь пока ничего нет"),l.length>0&&l.map((e=>r.createElement(dE,{key:e.id,tag:"article"},r.createElement(HS,{post:e,onLinkClick:bd,subscribeButtonEnabled:!0})))))),r.createElement(Qb,null),r.createElement(ty,null),r.createElement(Jb,null))})),aN=(0,ae.Z)(nN,"hashtagPostList"),sN=()=>r.createElement("section",{className:"about-platform-contacts"},r.createElement("h2",{className:"about-platform__title"},"Контакты"),r.createElement("div",{className:"about-platform-contacts__container"},r.createElement("div",{className:"about-platform-contacts__map"},r.createElement("iframe",{src:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2244.9741082257747!2d37.644065216402964!3d55.75895198055501!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x46b54a8ac40233d7%3A0xa1a6afabe750c23a!2z0YPQuy4g0J_QvtC60YDQvtCy0LrQsCwgMTgvMTgsINCc0L7RgdC60LLQsCwgMTAxMDAw!5e0!3m2!1sru!2sru!4v1556552802484!5m2!1sru!2sru",allowFullScreen:!0})),r.createElement("div",{className:"about-platform-contacts__desc"},r.createElement("div",{className:"about-platform-contacts__row"},r.createElement("p",null,"Россия, Москва,",r.createElement("br",null)," ул. Покровка, 18/18, с.1"),r.createElement("p",null,"ИНН 7708777125"),r.createElement("p",null,"Технологический стек Linux, PHP, Javascript, Postgresql, Redis, Nginx")),r.createElement("div",{className:"about-platform-contacts__row"},r.createElement("p",null,r.createElement("span",{className:"about-platform-contacts__tel"},"+7 (495) 626-43-91")),r.createElement("p",{className:"about-platform-contacts__text"},"Заполните бриф, и мы вам перезвоним"),r.createElement("a",{href:"https://docs.google.com/forms/d/e/1FAIpQLSe5HXE1zx4SKll5qKq9KNWikpdEjercfCqwtwzVWeX1Wd4Mkg/viewform",className:"about-platform__btn",target:"_blank"},"Заполнить бриф")),r.createElement("div",{className:"about-platform-contacts__row"},r.createElement("p",{className:"about-platform-contacts__subtitle"},"По вопросам партнёрства и спецпроектов"),r.createElement("a",{href:"mailto:adv@corp.mirtesen.ru"},"partners@corp.mirtesen.ru"),r.createElement("p",{className:"about-platform-contacts__subtitle"},"По вопросам рекламы"),r.createElement("a",{href:"mailto:adv@corp.mirtesen.ru"},"adv@corp.mirtesen.ru"),r.createElement("p",{className:"about-platform-contacts__subtitle"},"Помощь и форма обратной связи"),r.createElement("a",{href:"//mirtesen.ru/feedback/report",target:"_blank"},"mirtesen.ru/feedback/report"))))),rN=()=>r.createElement("section",{className:"about-platform__stats"},r.createElement("h2",{className:"about-platform__title"},"Миртесен в цифрах"),r.createElement("table",null,r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",null,"Просмотры"),r.createElement("td",null,"262 000 000 / мес")),r.createElement("tr",null,r.createElement("td",null,"Посетители"),r.createElement("td",null,"30 000 000 / мес")),r.createElement("tr",null,r.createElement("td",null,"Возраст аудитории"),r.createElement("td",null,"30-45 лет")),r.createElement("tr",null,r.createElement("td",null,"Пол"),r.createElement("td",{className:"about-platform__stats-gender"},r.createElement("span",null,"Женщины: 55%")," ",r.createElement("span",null,"Мужчины: 45%"))),r.createElement("tr",null,r.createElement("td",null,"Преобладающие интересы"),r.createElement("td",null,r.createElement("span",null,"Дом"),r.createElement("span",null,"Семья"),r.createElement("span",null,"Финансы"),r.createElement("span",null,"Путешествия"),r.createElement("span",null,"Развлечения"))),r.createElement("tr",null,r.createElement("td",null,"Доход"),r.createElement("td",null,"B+")))));
/**
 * Mirtesen.
 *
 * Side block component.
 *
 * @author       Alexey Savchik.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class oN extends r.PureComponent{constructor(e){super(e);const{isMenu:t=!1}=this.props;this.state={isSticked:!1,offsetTop:0,isMenu:t},this.resizeTimeout=null,this.files={presentation:{label:"Презентация",format:"PPTX",size:"2.6Mb",link:"Mirtesen_Mediakit_2019.pptx"},logo:{label:"Логотип ",format:"ZIP",size:"375Kb",link:"MirtesenLogo.zip"},price:{label:"Прайс-лист",format:"XLS",size:"75Kb",link:"Mirtesen_price_2021.xls"},mediaKit:{label:"Медиа-кит МТ",format:"PPTX",size:"3.9Mb",link:"Mirtesen_Mediakit_2021.pdf"},mediaKitGlagol:{label:'Медиа-кит "ГлагоL"',format:"PDF",size:"3.1Mb",link:"Mirtesen_Glagol_Mediakit_2021.pdf"},smiRegistration:{label:"Выписка из реестра СМИ",format:"PDF",size:"65Kb",link:"Glagol_smi_reg.pdf"},partnership1:{label:"Партнерство 1.0",format:"PPTX",size:"1.8Mb",link:"Mirtesen_Partnership_1.0_2019.pptx"},partnership2:{label:"Партнерство 2.0",format:"PPTX",size:"5.6Mb",link:"Mirtesen_Partnership_2.0_2019.pptx"},video:{label:"Видеосеть МТ",format:"PDF",size:"5.9Mb",link:"Panda_P.pdf"},video2:{label:"Видеосеть МТ Продакшн",format:"PDF",size:"4.7Mb",link:"Panda_PR.pdf"},doc1:{label:"Хранение и компиляция исходного текста МТ",format:"PDF",size:"40 Kb",link:"documentation_1.pdf"},doc2:{label:"Инструкция по установке экземпляра ПО",format:"PDF",size:"21 Kb",link:"documentation_2.pdf"},doc3:{label:"Функциональные характеристики экземпляра ПО",format:"PDF",size:"42 Kb",link:"documentation_3.pdf"},doc4:{label:"Описание процессов...",format:"PDF",size:"33 Kb",link:"documentation_4.pdf"},doc5:{label:"Информация для эксплуатации экземпляра ПО",format:"PDF",size:"223 Kb",link:"documentation_5.pdf"},doc6:{label:"Описание технической архитектуры ПО",format:"PDF",size:"48 Kb",link:"documentation_6.pdf"},doc7:{label:"Лицензионные условия платформы",format:"PDF",size:"865 Kb",link:"documentation_7.pdf"},appGooglePlay:{label:"Для Android",buttonLabel:"Установить",link:"https://play.google.com/store/apps/details?id=ru.mirtesen.mobile&hl=ru",target:"_blank",format:"Google Play"},appWindow:{label:"Для Windows",format:"Установ. файл .exe",size:"44.0Mb",link:"http://app.mtml.ru/desktop/stable/0.7.6/MirTesen%20Setup%200.7.6.exe",buttonLabel:"Установить"},appLinux:{label:"Для Linux",format:"Уст. файл .appimage",size:"53.1Mb",link:"http://app.mtml.ru/desktop/stable/0.7.6/MirTesen-0.7.6.AppImage",buttonLabel:"Установить"},appStore:{label:"Для iOS",link:"https://apps.apple.com/ru/app/%D0%BC%D0%B8%D1%80%D1%82%D0%B5%D1%81%D0%B5%D0%BD-%D0%B4%D1%80%D1%83%D0%B7%D1%8C%D1%8F-%D1%80%D1%8F%D0%B4%D0%BE%D0%BC/id1229626373",buttonLabel:"Установить",target:"_blank",format:"Apple Store"}},this.contactInfo={advertisement:{text:"Написать в рекламный отдел",link:"mailto:adv@corp.mirtesen.ru",linkText:"adv@corp.mirtesen.ru"},partnership:{text:"Написать в партнерский отдел",link:"mailto:partners@corp.mirtesen.ru",linkText:"partners@corp.mirtesen.ru"},help:{text:"Помощь и форма обратной связи",link:"//mirtesen.ru/feedback/report",linkText:"mirtesen.ru/feedback/report"},support:{text:"Обратиться в техподдержку",link:"mailto:support@mirtesen.ru",linkText:"support@mirtesen.ru"},appSupport:{text:"Помощь и форма обратной связи",link:"mirtesen.ru/feedback/report",linkText:"mirtesen.ru/feedback/report"}}}componentDidMount(){this.setOffsetTop(),window.addEventListener("resize",this.updateResize)}componentWillUnmount(){window.removeEventListener("resize",this.updateResize)}handleScroll=()=>{const{offsetTop:e,isSticked:t}=this.state,n=document.documentElement.scrollTop||document.body.scrollTop;n>e&&!t&&this.setState({isSticked:!0}),n<e&&t&&this.setState({isSticked:!1})};setOffsetTop=()=>{if(Yt.findDOMNode(this.sideBlock)){const e=Yt.findDOMNode(this.sideBlock).getBoundingClientRect().top,t=this.state.isMenu?e+window.pageYOffset-90:e+window.pageYOffset-25;this.setState({offsetTop:t})}};updateResize=()=>{this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((()=>{this.handleScroll()}),80)};render(){const{save:e=[],contacts:t=[],isMobile:n}=this.props,a={sticked:this.state.isSticked,"offset-lg":this.state.isMenu};return r.createElement("div",{className:n?null:_()(a),ref:e=>this.sideBlock=e},e.length>0&&r.createElement("div",{className:"about-platform__side-block"},e.map(((e,t)=>{const{label:n,size:a,format:s,link:o,buttonLabel:i,target:l}=this.files[e];return r.createElement("div",{className:"about-platform__save",key:t},r.createElement("div",{className:"about-platform__save_name"},r.createElement("p",null,n),(s||a)&&r.createElement("p",null,s&&r.createElement("span",null,s),a&&r.createElement("span",null,a))),r.createElement("a",{href:/^http/.test(o)?o:`/b2b/${o}`,className:"about-platform__btn",download:!0,target:l||null},i||"Скачать"))}))),t>0&&r.createElement("div",{className:"about-platform__side-block"},t.map(((e,t)=>{const{text:n,link:a,linkText:s}=this.contactInfo[e];return r.createElement("div",{className:"about-platform__contact-info",key:t},r.createElement("p",null,n),r.createElement("a",{href:a},s))}))))}}oN.propTypes={save:f().array,contacts:f().array,isMenu:f().bool,isMobile:f().bool};const iN=oN;
/**
 * Mirtesen.
 *
 * Secondary header component.
 *
 * @author       Alexey Savchik.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class lN extends r.PureComponent{constructor(e){super(e),this.state={isMenuSticked:!1,isHeaderSticked:!1,currentNavButtonIndex:0},this.topMenuRef=r.createRef(),this.sectionsRef=null,this.headerRef=null,this.secondaryHeaderRef=r.createRef(),this.headerHeight=null,this.secondaryHeaderHeight=null}componentDidMount(){const{sections:e}=this.props;e&&e.length&&(window.addEventListener("scroll",this.throttleScroll),window.addEventListener("resize",this.debounceResize),this.setRefs(),this.setHeight(),this.handleScroll(),this.handleResize())}componentWillUnmount(){window.removeEventListener("scroll",this.throttleScroll),window.removeEventListener("resize",this.debounceResize)}handleScroll=()=>{const{headerHeight:e,secondaryHeaderHeight:t}=this,{isHeaderSticked:n}=this.state,a=document.documentElement.scrollTop||document.body.scrollTop,s=document.documentElement.clientHeight||document.body.clientHeight,r=document.documentElement.scrollHeight||document.documentElement.scrollHeight,o=this.sectionsRef.map((e=>this.getPosition(e)));if(a>(n?t:e+t)?this.setState({isMenuSticked:!0}):this.setState({isMenuSticked:!1}),a+s+40>r)return void this.setState({currentNavButtonIndex:o.length-1});const i=o.reduce(((e,t,n)=>a>t-250?n:e),0);this.setState({currentNavButtonIndex:i})};handleResize=()=>{this.headerRef&&this.setState({isHeaderSticked:"sticky"===getComputedStyle(this.headerRef).position})};handleScrollToElement=e=>{const{sectionsRef:t}=this;if(!t||!t.length)return;const n=this.state.isHeaderSticked?150:80;window.scrollTo(0,this.getPosition(t[e])-n)};setRefs(){this.sectionsRef=this.props.sections.map(((e,t)=>document.getElementById(`aboutPlatformSection-${t}`))),this.headerRef=document.getElementById("header")}setHeight(){this.headerHeight=this.headerRef?.clientHeight||0,this.secondaryHeaderHeight=this.secondaryHeaderRef.current.clientHeight}getPosition(e){const{top:t}=e.getBoundingClientRect();return t+(document.documentElement.scrollTop||document.body.scrollTop)}debounceResize=H()(this.handleResize,400);throttleScroll=u()(this.handleScroll,80);render(){const{page:e,sections:t}=this.props,{isMenuSticked:n,currentNavButtonIndex:a}=this.state,s={"about-platform__scroll-tabs-wrap":!0,"about-platform__scroll-tabs_sticked":n};let o="",i="",l="default";switch(e){case"newsListPlatform":case"newsItemPlatform":o="Новости",i="about-platform__page-header_news";break;case"partnersPlatform":o="Партнёрам",i="about-platform__page-header_partners";break;case"promoPlatform":o="Рекламодателям",i="about-platform__page-header_promo";break;case"agreementPlatform":o="Пользовательское соглашение",i="about-platform__page-header_agreement";break;case"recommendationRules":o="Рекомендательные технологии",i="about-platform__page-header_rules";break;case"glagolPlatform":o="Что такое ГлагоL?",i="about-platform__page-header_glagol";break;case"appPlatform":o="Читайте. Дружите.\nОбщайтесь!",i="about-platform__page-header_app",l="app";break;default:o="Что такое Миртесен?",i="about-platform__page-header_about"}const c={"about-platform__page-header":!0,[i]:!0,"about-platform__page-header_sticked":n};return r.createElement(r.Fragment,null,"app"===l&&r.createElement("div",{className:_()(c),ref:this.secondaryHeaderRef},r.createElement("div",{className:"about-platform__page-header_app-content"},r.createElement("div",null,o),r.createElement("p",null,"Используйте новое приложение МирТесен\nс каналами, чатами и сообщениями!"),r.createElement("div",null,r.createElement("a",{className:"about-platform__page-header_app-button",href:"https://play.google.com/store/apps/details?id=ru.mirtesen.mobile",target:"_blank"}),r.createElement("a",{className:"about-platform__page-header_app-button",href:"https://apps.apple.com/ru/app/%D0%BC%D0%B8%D1%80%D1%82%D0%B5%D1%81%D0%B5%D0%BD/id1229626373",target:"_blank"})),r.createElement("span",{className:"about-platform__page-header_app-slider"}))),"default"===l&&r.createElement("div",{className:_()(c),ref:this.secondaryHeaderRef},r.createElement("div",null,o)),r.createElement("div",{className:_()(s)},r.createElement("div",{id:"aboutPlatformScrollTabs",className:"about-platform__scroll-tabs"},t&&t.map(((e,t)=>r.createElement("button",{key:t,className:_()({current:t===a}),onClick:()=>{this.handleScrollToElement(t)}},e))))))}}lN.defaultProps={href:null,target:null},lN.propTypes={page:f().string,sections:f().array,href:f().oneOfType([f().string,f().object]),target:f().oneOfType([f().object,f().string])};const cN=lN;function mN(){return mN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},mN.apply(this,arguments)}
/**
 * Mirtesen.
 *
 * Slider component.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const dN=N((()=>Promise.all([n.e(526).then(n.t.bind(n,88667,23)),n.e(743).then(n.bind(n,83651))]).then((([e])=>e))),"reactIdSwiper");class pN extends r.PureComponent{constructor(e){super(e),this.state={visibleThumbs:0,currentIndex:0,step:64,position:0,galleryRef:null,borderEl:{right:0,left:0}}}componentDidMount(){const{initialSlide:e}=this.props.history;window.addEventListener("resize",this.handleResize);const t=this.getVisibleThumbs(),n=this.getInitialPosition(t,e),a=this.getBorderEl(n,t);this.setState({currentIndex:e,position:n,visibleThumbs:t,borderEl:a})}componentWillUnmount(){window.removeEventListener("resize",this.handleResize)}handleResize=()=>{const{currentIndex:e}=this.state,t=this.getVisibleThumbs();if(t!==this.state.visibleThumbs){const n=this.getInitialPosition(t,e),a=this.getBorderEl(n,t);this.setState({visibleThumbs:t,position:n,borderEl:a})}};handleArrowClick=e=>{const{galleryRef:t}=this.state,n=t?.swiper;n&&("prev"===e&&n.slidePrev(),"next"===e&&n.slideNext())};handleThumbClick=e=>{const t=this.state?.galleryRef?.swiper;t&&t.slideTo(e)};handleSlideChange=()=>{const{galleryRef:e,currentIndex:t,visibleThumbs:n}=this.state,a=e?.swiper.activeIndex;if(!e?.swiper||t===a)return;const s=this.getNewPosition(a),r=this.getBorderEl(s,n);this.setState({currentIndex:a,position:s,borderEl:r})};getInitialPosition=(e,t)=>{const{step:n}=this.state,{thumbs:a}=this.props.history,s=-(a.length-e)*n;let r=-(t-(e-1))*n;return r>0&&(r=0),r<s&&(r=s),r};getNewPosition=e=>{const{step:t,position:n,currentIndex:a,borderEl:s}=this.state,{thumbs:r}=this.props.history;return a<e&&a===s.right&&e<r.length?n-t:a>e&&a===s.left&&e>=0?n+t:n};getVisibleThumbs=()=>{const e=this.thumbsContainer.offsetWidth;return Math.floor(e/this.state.step)};getBorderEl=(e,t)=>{const{step:n}=this.state;return{left:-e/n,right:-e/n+t-1}};setGalleryRef=e=>{e&&this.setState({galleryRef:e})};render(){const{position:e,currentIndex:t}=this.state,{history:{initialSlide:n,slides:a,thumbs:s}}=this.props,o={spaceBetween:10,touchEventsTarget:"wrapper",slidesPerView:1,initialSlide:n,on:{slideChange:this.handleSlideChange}},i={transform:`translateX(${e}px)`},l=t<=0,c=t>=s.length-1;return r.createElement("div",{className:"about-platform__history"},r.createElement("div",{className:"about-platform__history-thumbs"},r.createElement("button",{className:"about-platform__arrow about-platform__arrow_prev",onClick:()=>this.handleArrowClick("prev"),disabled:l},"prev"),r.createElement("div",{className:"about-platform__history-thumbs-wrap",ref:e=>this.thumbsContainer=e},r.createElement("div",{className:"about-platform__history-thumbs-content",style:i},s.map(((e,n)=>{const a=t===n?"about-platform__history-thumb about-platform__history-thumb_active":"about-platform__history-thumb";return r.createElement("button",{type:"button",className:a,key:n,onClick:()=>this.handleThumbClick(n)},e)})))),r.createElement("button",{className:"about-platform__arrow about-platform__arrow_next",onClick:()=>this.handleArrowClick("next"),disabled:c},"next")),r.createElement(dN,mN({},o,{ref:this.setGalleryRef}),a.map(((e,t)=>r.createElement("div",{key:t},e)))))}}pN.propTypes={history:f().object};const uN=pN,gN=({team:e})=>r.createElement("div",{className:"about-platform__team"},e.map(((e,t)=>r.createElement("div",{className:"about-platform__team-item",key:t},r.createElement("div",{className:"about-platform__team-item-img"},r.createElement("img",{src:e.imageUrl,alt:`${e.name} ${e.lastName}`})),r.createElement("div",{className:"about-platform__team-item-info"},r.createElement("div",null,e.name,r.createElement("br",null),e.lastName),r.createElement("div",null,e.position))))));gN.propTypes={team:f().array};const hN=gN;
/**
 * Mirtesen.
 *
 * About platform page.
 *
 * @author       Alexey Savchik.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class _N extends r.Component{render(){const{app:e}=this.props,t=["Краткое описание","Статистика","История компании","Команда","Контакты"],n=e.req&&e.req.deviceType&&("phone"===e.req.deviceType||"tablet"===e.req.deviceType),a=["doc1","doc2","doc3","doc4","doc5","doc6","doc7"],s=n?["mediaKit",...a]:["logo","mediaKit","price","video","video2",...a],o=n?[]:["advertisement","support"];return r.createElement("div",{className:"about-platform__content-wrapper"},r.createElement(cN,{page:e.page,sections:t}),r.createElement("div",{className:"about-platform__content"},r.createElement("div",null,r.createElement("section",{id:"aboutPlatformSection-0"},r.createElement("h2",{className:"about-platform__title"},"Краткое описание"),r.createElement("p",null,"Миртесен — это медиаплатформа с тематическим контентом от медиа, коммерческих брендов, организаций и пользователей, объединенных в соцсеть."),r.createElement("p",null,"Основной продукт для конечного пользователя — новостная лента, материалы в которой подбираются индивидуально."),r.createElement("p",null,"Форма присутствия для юрлиц в МирТесен — представительство. Это сайт, контент которого импортируется из официальной площадки автоматически и нативно распространяется внутри МирТесен. Каждая единица контента представительства показывается пользователям в зависимости от их интересов."),r.createElement("p",null,"Медиаплатформа Миртесен оснащена всеми рекламными механиками, а также включает в себя видеосеть, автоматическую рекламную сеть, ежесуточная рассылка по 16 млн адресатов и возможность размещения спецпроектов с высокой вовлеченностью аудитории.")),n&&r.createElement("section",null,r.createElement(iN,{save:s,contacts:o,isMobile:!0})),r.createElement("div",{id:"aboutPlatformSection-1"},r.createElement(rN,null)),r.createElement("section",{className:"about-platform__history-wrapper",id:"aboutPlatformSection-2"},r.createElement("h2",{className:"about-platform__title"},"История компании"),r.createElement(uN,{history:{thumbs:["2006","2007","2008","2012","2013","2014","2015","2016","2017","2018","2019"],slides:["Появление соцсети 'МирТесен' как ресурса для связи с одноклассниками","Переформатирование 'МирТесен' в геолокационный сервис для поиска друзей","Приобретение 'МирТесен' инвестиционным холдингом 'Финам'","Смена команды, слияние со СМИ2, переход в управление холдинга 'Е-Генератор'","Слияние с медицинской соцсетью 'Полон сил' и информационным ресурсом 'Финам.инфо'","Превращение из геолокационного сервиса в социальную медиаплатформу 'МирТесен'","Интеграция в 'МирТесен' собственной рекомендательной системы контента Neuron","Посещаемость 'МирТесен' составила 12 млн пользователей и 140 млн показов в месяц","Старт динамической монетизации, перезапуск блогов и создание новостной видеосети","Начало программы 'Партнерство 2.0' по слиянию с тематическими ресурсами Рунета","Посещаемость 'МирТесен' составила 30 млн пользователей и 260 млн показов в месяц"],initialSlide:10}})),r.createElement("section",{id:"aboutPlatformSection-3"},r.createElement("h2",{className:"about-platform__team-title"},"Команда"),r.createElement(hN,{team:[{name:"Мария",lastName:"Рубцова",position:"Генеральный директор",imageUrl:"/images/aboutPlatform/team/Maria.png"},{name:"Михаил",lastName:"Беляев",position:"Руководитель партнерского отдела",imageUrl:"/images/aboutPlatform/team/Mihail.png"},{name:"Ольга",lastName:"Борисова",position:"Менеджер по рекламе",imageUrl:"/images/aboutPlatform/team/Olga.png"},{name:"Наран",lastName:"Джальджиреев",position:"Руководитель отдела электронной коммерции",imageUrl:"/images/aboutPlatform/team/Naran.png"}]})),r.createElement("div",{id:"aboutPlatformSection-4"},r.createElement(sN,null))),r.createElement(iN,{save:s,contacts:o,isMenu:!!t})))}}_N.propTypes={app:f().object};const EN=(0,ae.Z)(_N,"aboutPlatform");
/**
 * Mirtesen.
 *
 * Platform Post List Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class fN extends r.PureComponent{getPublicationDate=e=>{const t=e.formattedDates.iso;return e.is_draft?"Черновик":e.is_queued?r.createElement(r.Fragment,null," Дата публикации: ",r.createElement(s_,{date:e.publish_time,format:"D MMMM, H:mm"})):t&&y.Z.isPastYear(t)?r.createElement(s_,{date:t,format:"DD.MM.YYYY в H:mm"}):r.createElement(s_,{date:t,format:"D MMMM, H:mm"})};render(){const{postList:e=[],hasMoreItems:t,onShowMore:n,page:a,originalUrl:s}=this.props,o=r.createElement("div",{className:"blog-post-list__loader"},r.createElement("img",{src:"//static.mtml.ru/images/loader.svg",alt:"Загружается..."}));return r.createElement("div",{className:"platform-post-list"},r.createElement(zn,{pageStart:0,loadMore:()=>{if(t){if(a>0){const e="page="+(a+1);let t=window.location.href;const n=/page=\d+/i;t=t.replace(n,"").replace("?&","?").replace(/(&|\?)+$/,""),t=-1!==t.indexOf("?")?t+"&"+e:t+"?"+e,window.history.pushState(null,"",t)}return n(ni.platformPostsOnPage+a*ni.platformPostsOnPage,ni.platformPostsOnPage)}},hasMore:t,loader:o,threshold:400},e.length<1&&!t&&r.createElement("article",{className:"platform-post-list__no-posts",key:0},"Здесь пока ничего нет"),e.length>0&&e.map((e=>{const t=e.seo_url.replace("//platforma.mirtesen.ru/blog","/news");return r.createElement(dE,{tag:"article",className:"platform-post",key:e.id},r.createElement("div",{className:"platform-post__header"},r.createElement("a",{className:"platform-post__author",rel:"author",href:"//info.mirtesen.ru",target:"_blank"},r.createElement("div",{className:"platform-post__author-avatar"}),r.createElement("div",null,r.createElement("div",{className:"platform-post__author-name"},"Миртесен",r.createElement("i",{className:"platform-post__author-real"})),r.createElement("div",{className:"platform-post__pubdate"},this.getPublicationDate(e))))),r.createElement("div",{className:"platform-post__content"},r.createElement("h3",{className:"platform-post__title"},r.createElement("a",{href:t},e.title)),r.createElement("div",{className:"platform-post__description"},r.createElement("span",{dangerouslySetInnerHTML:{__html:e.preview_text}})),r.createElement("a",{href:t,className:"platform-post__read-more"},"Читать далее")))}))),r.createElement(kT,{hasMoreItems:t,page:a,url:s}))}}fN.propTypes={postList:f().array,hasMoreItems:f().bool,onShowMore:f().func,page:f().number,originalUrl:f().string};const bN=(0,i.$j)((e=>({postList:e.platformPostList.posts,hasMoreItems:e.platformPostList.hasMoreItems,page:e.platformPostList.page,originalUrl:e.app.originalUrl})),(e=>({onShowMore:(t,n)=>{e(((e,t)=>(n,a)=>{const s=a(),{page:r}=s.platformPostList,o={siteId:ni.platformSiteId,offset:e,count:t,tag:"новость,новости,статья,статьи",sort:"latest"};return Promise.all([fs.Z.getBlogPostList(o)]).then((e=>{const t=e[0];return n({type:"PLATFORM_POST_LIST_GET_PAGE",posts:[...s.platformPostList.posts,...t],page:r+1,hasMoreItems:t.length>=ni.platformPostsOnPage,fieldList:"tile"})})).catch(D.Z.promiseHandler("/index.js")),n({type:"BLOG_POST_LIST_DEFAULT"})})(t,n))}})))(fN);
/**
 * Mirtesen.
 *
 * About platform page.
 *
 * @author       Alexey Savchik.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class yN extends r.Component{constructor(e){super(e)}render(){const{app:e}=this.props,t=["Все новости"];return r.createElement("div",{className:"about-platform__content-wrapper"},r.createElement(cN,{page:e.page,sections:t}),r.createElement("div",{className:"about-platform__content"},r.createElement("div",null,r.createElement("section",{id:"aboutPlatformSection-0"},r.createElement(bN,null))),r.createElement(iN,{save:["presentation"],contacts:["advertisement","partnership","help","support"],isMenu:!!t})))}}yN.propTypes={app:f().object};const vN=(0,ae.Z)(yN,"newsListPlatform"),TN=[{name:"vk",shareUrl:"https://vkontakte.ru/share.php?url=",tooltip:"Поделиться Вконтакте"},{name:"ok",shareUrl:"https://connect.ok.ru/offer?url=",tooltip:"Поделиться в Одноклассниках"}],SN=({url:e=null,text:t=null,id:n=null})=>(n=n||y.Z.generateRandomtext(7),r.createElement("div",{className:"blog-post__share"},r.createElement("div",{className:"blog-post__share__wrap",id:`blog-post-share-${n}`},TN.map((({name:a,shareUrl:s,tooltip:o})=>r.createElement(r.Fragment,{key:a},r.createElement($y,{name:a,url:e,shareUrl:s,text:t,id:`blog-post-share-${a}-${n}`,classes:`btn btn-action blog-post__share-btn blog-post__share-btn_${a}`}),r.createElement(lt,{target:`blog-post-share-${a}-${n}`,id:`blog-post-share-${n}`,placement:"top",content:o,offset:[0,8]})))))));SN.propTypes={url:f().oneOfType([f().string,f().object]),text:f().string,id:f().number};const PN=SN;
/**
 * Mirtesen.
 *
 * Platform News Post Container.
 *
 * @author       Alexey Savchik.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class wN extends r.PureComponent{getPublicationDate=e=>{const t=e.formattedDates.iso;return e.is_draft?"Черновик":e.is_queued?r.createElement(r.Fragment,null," Дата публикации: ",r.createElement(s_,{date:e.publish_time,format:"D MMMM, H:mm"})):t&&y.Z.isPastYear(t)?r.createElement(s_,{date:t,format:"DD.MM.YYYY в H:mm"}):r.createElement(s_,{date:t,format:"D MMMM, H:mm"})};render(){const{blogPost:e}=this.props;return r.createElement("div",{className:"platform-post-item blog-post-item"},r.createElement("article",{className:"platform-post"},r.createElement("h1",{className:"blog-post__title"},e.title),r.createElement("div",{className:"platform-post__header"},r.createElement("a",{className:"platform-post__author",rel:"author",href:"//info.mirtesen.ru",target:"_blank"},r.createElement("div",{className:"platform-post__author-avatar"}),r.createElement("div",null,r.createElement("div",{className:"platform-post__author-name"},"Миртесен",r.createElement("i",{className:"platform-post__author-real"})),r.createElement("div",{className:"platform-post__pubdate"},this.getPublicationDate(e))))),r.createElement("div",{className:"blog-post__text",dangerouslySetInnerHTML:{__html:e.text}}),r.createElement("div",{className:"platform-post__footer"},r.createElement(PN,{id:e.id}),r.createElement("div",{className:"platform-post__stats"},e?.group?.showSubscribersAmount&&r.createElement(gE,{id:e.id,className:"post-item__views",counter:"force-all"})))))}}wN.propTypes={blogPost:f().object};const IN=(0,i.$j)((e=>({blogPost:e.platformPost.newsPost})),null)(wN);
/**
 * Mirtesen.
 *
 * About platform page.
 *
 * @author       Alexey Savchik.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class CN extends r.Component{constructor(e){super(e)}render(){const{app:e}=this.props;return r.createElement("div",{className:"about-platform__content-wrapper"},r.createElement(cN,{page:e.page}),r.createElement("div",{className:"about-platform__content"},r.createElement("div",null,r.createElement(IN,null)),r.createElement(iN,{save:["presentation"],contacts:["advertisement","partnership","help","support"]})))}}CN.propTypes={app:f().object};const NN=(0,ae.Z)(CN,"newsPlatform");
/**
 * Mirtesen.
 *
 * Partners platform page.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ON extends r.PureComponent{render(){const{app:e}=this.props,t=["Издателям","Статистика","Преимущества","Как начать работу","Контакты"],n=e.req&&e.req.deviceType&&("phone"===e.req.deviceType||"tablet"===e.req.deviceType),a=n?["mediaKit"]:["partnership1","partnership2"],s=n?[]:["partnership","support"];return r.createElement("div",{className:"about-platform__content-wrapper partners-platform"},r.createElement(cN,{page:e.page,sections:t}),r.createElement("div",{className:"about-platform__content"},r.createElement("div",null,r.createElement("section",{className:"partners-platform__info",id:"aboutPlatformSection-0"},r.createElement("h2",{className:"about-platform__title"},"Миртесен для издателей"),r.createElement("p",null,"Объединенный партнерский отдел Миртесен и СМИ2 предоставляет сетевым изданиям качественные инструменты и доступ к огромной аудитории социальной медиаплатформы и новостной сети."),r.createElement("p",null,"Создавайте канал своего СМИ в Миртесен с полнотекстовыми материалами и получайте не просто читателей, а активную аудиторию, которая комментирует, лайкает и делится материалами в соцсетях."),r.createElement("p",null,"СМИ2 в свою очередь анализирует вашу аудиторию и подбирает для нее самые релевантные материалы из партнерской сети. Ищете как увеличить трафик? Используйте СМИ2 для роста своей аудитории.")),n&&r.createElement("section",null,r.createElement(iN,{save:a,contacts:s,isMobile:!0})),r.createElement("div",{id:"aboutPlatformSection-1"},r.createElement(rN,null)),r.createElement("section",{className:"partners-platform__adv",id:"aboutPlatformSection-2"},r.createElement("h2",{className:"about-platform__title"},"Наши преимущества"),r.createElement("ul",{className:"partners-platform__adv_list"},r.createElement("li",{className:"partners-platform__adv_flag"},"В отличие от других социальных сетей на МирТесен создается полноценный сайт, который может размещаться на уникальном доменном имени, с логотипом и фирменным стилем СМИ или издателя."),r.createElement("li",{className:"partners-platform__adv_rss"},"Контент автоматически публикуется через RSS"),r.createElement("li",{className:"partners-platform__adv_promo"},"Возможности для прямой рекламы на канале, создания промоблоков и отдельных страниц для спецпроектов;"),r.createElement("li",{className:"partners-platform__adv_magic"},"Удобный инструмент для работы с аудиторией: возможности для проведения конкурсов, опросов и других активностей"),r.createElement("li",{className:"partners-platform__adv_counters"},"За счет читателей представительства на МирТесен СМИ получают дополнительный охват аудитории, поскольку мы даем возможность объединить счетчики"))),r.createElement("section",{className:"partners-platform__steps",id:"aboutPlatformSection-3"},r.createElement("h2",{className:"about-platform__title"},"Как начать с нами работать"),r.createElement("ol",{className:"partners-platform__steps_list"},r.createElement("li",null,"Присылаете свою RSS (полнотекст)"),r.createElement("li",null,"Логотип 100х100 и Шапку 1000х240"),r.createElement("li",null,"Создаете субдомен"),r.createElement("li",null,"Присылаете id своих счетчиков"),r.createElement("li",null,"Ставите наш виджет к себе на сайт"),r.createElement("li",null,"Зарабатываете процент с нашей монетизации."))),r.createElement("div",{id:"aboutPlatformSection-4"},r.createElement(sN,null))),r.createElement(iN,{save:a,contacts:s,isMenu:!!t})))}}ON.propTypes={app:f().object};const MN=(0,ae.Z)(ON,"PartnersPlatform");
/**
 * Mirtesen.
 *
 * Toggle menu component.
 *
 * @author       Olga Efimova, Alexey Duybo.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class kN extends r.Component{static propTypes={items:f().arrayOf(f().object)};static defaultProps={items:[]};constructor(e){super(e),this.state={items:this.props.items.map((e=>({...e,isOpen:!1})))}}shouldComponentUpdate(e,t){return t.items!==this.state.items}handlerToggleInventory(e){this.setState((({items:t})=>({items:t.map(((t,n)=>e===n?{...t,isOpen:!t.isOpen}:t))})))}render(){const{items:e}=this.state;return e.length>0&&r.createElement("ul",{className:"about-platform__inventory"},e.map((({name:e,title:t,text:n,isOpen:a},s)=>r.createElement("li",{key:s,className:_()({"is-open":a})},r.createElement("button",{className:`about-platform__inventory_${e}`,onClick:()=>this.handlerToggleInventory(s)},t),a&&r.createElement("p",{dangerouslySetInnerHTML:{__html:n}})))))}}const AN=kN;
/**
 * Mirtesen.
 *
 * Partners platform page.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class xN extends r.PureComponent{render(){const{app:e}=this.props,t=["Главное","Статистика","Схема работы","Рекламный инвентарь","Контакты"],n=e.req&&e.req.deviceType&&("phone"===e.req.deviceType||"tablet"===e.req.deviceType),a=n?["mediaKit"]:["price","mediaKit","video","video2"],s=n?[]:["advertisement","support"];return r.createElement("div",{className:"about-platform__content-wrapper promo-platform"},r.createElement(cN,{page:e.page,sections:t}),r.createElement("div",{className:"about-platform__content"},r.createElement("div",null,r.createElement("section",{className:"promo-platform__info",id:"aboutPlatformSection-0"},r.createElement("h2",{className:"about-platform__title"},"Главное"),r.createElement("p",null,"МирТесен — это платформа для публикации контента, внутри которой интегрирована соцсеть для пользователей. Входит в ТОП-10 российских сайтов в категории «соцсети» по версии Яндекс. Радар.")),n&&r.createElement("section",null,r.createElement(iN,{save:a,contacts:s,isMobile:!0})),r.createElement("div",{id:"aboutPlatformSection-1"},r.createElement(rN,null)),r.createElement("section",{className:"promo-platform__scheme",id:"aboutPlatformSection-2"},r.createElement("h2",{className:"about-platform__title"},"Пошаговая схема работы Миртесен"),r.createElement("ol",null,r.createElement("li",null,"Медиа, бренды, организации и пользователи размещают контент на своих страницах"),r.createElement("li",null,"Контент попадает в ленты пользователей в зависимости от их интересов"),r.createElement("li",null,"Зарегистрированные пользователи видят рекомендованный контент в своих лентах"),r.createElement("li",null,"Незарегистрированные пользователи попадают внутрь статей через поисковики"))),r.createElement("section",{id:"aboutPlatformSection-3"},r.createElement("h2",{className:"about-platform__title"},"Наш рекламный инвентарь"),r.createElement(AN,{items:[{name:"banner",title:"Баннеры",text:"Форматы: 300х600, 240х400, 320х100, 300х250, 900х250, 500х300,160х600."},{name:"push",title:"Пуши",text:"Рекламные уведомления в мобильных и десктопных браузерах для любой операционной системы."},{name:"mailing",title:"Email-рассылки",text:"В сутки мы отправляем 16 млн индивидуально подобранных под каждого пользователя полезных и развлекательных писем."},{name:"native",title:"Нативная реклама",text:"Промо, которое попадает в ленты пользователей в обход стандартных рекламных размещений. Выглядят, как обычные посты."},{name:"tgb",title:"ТГБ",text:"Нативные текстово-графические блоки под статьями внутри МирТесен с заголовками, лидами и фотографиями. Размещаются с помощью встроенного рекламного движка Адверт.МирТесен по аукционной модели внутри медиаплатформы, а также на сайтах-партнерах МирТесен."},{name:"rent",title:"Контент-рент",text:'Текстовые промо-блоки со ссылками внутри готовых статей по различным тематикам, которые подходят под суть рекламного размещения. Например, врезаем рекламный блок "Капли для носа" в материал "Народные средства лечения простуды". Пользователь, который читает этот материал, получает прямую ссылку на продукт, связанный с его потребностями в данный момент.'},{name:"story",title:"Саксесс-стори",text:"Посты пользователей МирТесен об успешном использовании продукта и услуги с возможностью их широкого анонсирования и продвижения внутри платформы."},{name:"comments",title:"Отзывы и комментарии",text:"Целевая работа с обсуждениями пользователей внутри комьюнити и в статьях, интервьюирование лояльных пользователей продукта или услуги."},{name:"video",title:"Видео",text:"CPM от 250 руб., a) pre-roll, b) in-page."},{name:"special",title:"Спецпроекты",text:"Индивидуально разработанные рекламные интеграции в продукт под запрос клиента: от лидогенерирующих квизов до охватных трэвел-историй под PR."}]})),r.createElement("div",{id:"aboutPlatformSection-4"},r.createElement(sN,null))),r.createElement(iN,{save:a,contacts:s,isMenu:!!t})))}}xN.propTypes={app:f().object,inventory:f().array};const LN=(0,ae.Z)(xN,"PromoPlatform");
/**
 * Mirtesen.
 *
 * Partners platform page.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class DN extends r.PureComponent{render(){const{app:e}=this.props;return r.createElement("div",{className:"about-platform__content-wrapper agreement-platform"},r.createElement(cN,{page:e.page}),r.createElement("div",{className:"about-platform__content"},r.createElement("div",null,r.createElement("section",{className:"agreement-platform__content"},r.createElement("h2",{className:"about-platform__title"},"Соглашение об использовании материалов и сервисов интернет-сайта (пользовательское соглашение)"),r.createElement("ol",null,r.createElement("li",null,"Термины",r.createElement("p",null,"Пользователь – посетитель Сайта, прошедший процедуру регистрации на Сайте в установленном порядке."),r.createElement("p",null,"Сайт – расположенный по адресу ",r.createElement("a",{href:"/"},"mirtesen.ru")," сервис."),r.createElement("p",null,"Контент – сведения (сообщения, данные, материалы) независимо от формы их представления, музыкальные произведения, литературные произведения, программы для ЭВМ, мобильных телефонов, аудиовизуальные произведения, фонограммы, изображения, тексты, товарные знаки, логотипы, гипертекстовые ссылки, их фрагменты, информация, иные объекты добровольно и безвозмездно размещаемые Пользователем на Сайте."),r.createElement("p",null,"Личные данные – информация, содержание и объем которой позволяет идентифицировать Пользователя в целях доступа к сервисам Сайта, в том числе контактная информация, добровольно и безвозмездно свободно, своей волей и в своем интересе размещаемая Пользователем на Сайте."),r.createElement("p",null,"Администрация Сайта (Общество с ограниченной ответственностью «МТ», ОГРН 1127747206949) – группа сотрудников компании, самостоятельно и по своему усмотрению устанавливающая порядок использования Сайта, управляющая его работой, контролирующая выполнение Пользователями настоящего Соглашения, в том числе порядок размещения информации на Сайте.")),r.createElement("li",null,"Общие положения. Предмет соглашения.",r.createElement("ol",null,r.createElement("li",null,"Настоящее Соглашение с пользователем (далее «Соглашение») является публичной офертой и определяет условия использования материалов и сервисов, размещенных на Сайте."),r.createElement("li",null,"Сайт является рекомендательной социальной сетью."),r.createElement("li",null," Использование материалов и сервисов Сайта регулируется нормами действующего законодательства Российской Федерации."),r.createElement("li",null,"Регистрацией на Сайте Пользователь подтверждает свое полное конкретное, информированное и сознательное согласие с условиями настоящего Соглашения."),r.createElement("li",null,"В случае несогласия с какими-либо условиями Соглашения Пользователь обязуется незамедлительно прекратить пользование Сайтом."),r.createElement("li",null," Администрация Сайта оставляет за собой право в любое время изменить условия настоящего Соглашения. При этом Пользователь принимает на себя обязательство своевременно знакомится с изменениями условий Соглашения."),r.createElement("li",null,"Регистрацией на Сайте Пользователь подтверждает, что обладает необходимой правоспособностью и полномочиями для принятия настоящего Соглашения, способен исполнять условия Соглашения и нести ответственность за нарушение Соглашения, в том числе по правоотношениям, возникшим вследствие пользования Сайтом."),r.createElement("li",null,"Пользователь несет персональную ответственность за Контент и все последствия, связанные с его публикацией."),r.createElement("li",null,"Размещая Контент, Пользователь гарантирует что, обладает всеми правами и полномочиями, необходимыми для передачи прав в соответствии с п.5.5. настоящего Соглашения."),r.createElement("li",null,"Размещая Контент, Пользователь предоставляет право любому другому Пользователю Сайта на доступ к Контенту."),r.createElement("li",null,r.createElement("p",null,"Пользователь может использовать материалы Сайта и предоставляемые на Сайте сервисы следующими способами:"),r.createElement("ul",null,r.createElement("li",null,"— получать рекомендации по интересующим материалам;"),r.createElement("li",null,"— делиться ссылками, фотографиями и видео в своей ленте с друзьями;"),r.createElement("li",null,"— осуществлять подписку на сайты и других Пользователей;"),r.createElement("li",null,"— писать отзывы и участвовать в дискуссиях на Сайте;"),r.createElement("li",null,"— создать свой собственный сайт и получать доход;"))))),r.createElement("li",null,"Права и обязанности Пользователя",r.createElement("ol",null,r.createElement("li",null,"Пользователь обязуется не оставлять комментарии и записи, которые могут рассматриваться как нарушающие российское законодательство или нормы международного права, в том числе в сфере интеллектуальной собственности, авторских и/или смежных прав, общепринятые нормы морали и нравственности, а также любых действий, которые приводят или могут привести к нарушению нормальной работы Сайта и сервисов Сайта."),r.createElement("li",null," Пользователь обязуется не размещать Контент провокационного, грубого, оскорбительного и агрессивного характера, противоречащий моральным и этическим нормам, нарушающий действующее российское или международное законодательство, нарушающий права, в том числе интеллектуальные, третьих лиц."),r.createElement("li",null,"Пользователь вправе размещать на Сайте Контент в соответствии с условиями настоящего Соглашения."),r.createElement("li",null,"При регистрации Пользователь обязуется указать достоверные Личные данные."),r.createElement("li",null,"На весь Контент, публикуемый на Сайте в записях или комментариях, распространяется действие авторского права. Все заимствованные материалы должны иметь указание имени автора, если оно указано на сайте-источнике, а при невозможности его установления — значок копирайта (с). Гиперссылки на заимствованные материалы, размещенные ранее в Интернете, приветствуются, а в том случае, если автор заявит об их необходимости, — требуются обязательно. Пользователь обязуется не приписывать себе авторство чужих текстов или изображений."),r.createElement("li",null,"Пользователь несёт ответственность за нарушение данного Соглашения в соответствии с законодательством Российской Федерации."),r.createElement("li",null,"В случае нанесения ущерба третьим лицам, другим Пользователям или Сайту Пользователь обязуется возместить причиненный ущерб в полном объёме и в размере в соответствии с действующим законодательством Российской Федерации."),r.createElement("li",null,"Пользователь несет ответственность и все расходы (включая возмещение убытков, вреда, штрафов, судебных и иных расходов и издержек) в случае предъявления третьими лицами каких-либо претензий, включая, но не ограничиваясь претензиями связанными с защитой интеллектуальных прав третьих лиц, и за какие-либо обязательства, возникшие у Сайта в связи с требованиями третьих сторон, связанные или возникшие вследствие нарушения Пользователем условий настоящего Соглашения. Пользователь обязуется принять все необходимые и возможные меры, направленные на исключение Сайта из числа ответчиков."),r.createElement("li",null,"Пользуясь сервисами и материалами Сайта, Пользователь подтверждает, что принимает условия настоящего Соглашения, а также Политики конфиденциальности Сайта, являющейся неотъемлемой частью настоящего Соглашения и размещенной на странице по адресу:",r.createElement("a",{href:"http://mirtesen.ru/privacy"},"mirtesen.ru/privacy")))),r.createElement("li",null,"Права и обязанности Администрации Сайта",r.createElement("ol",null,r.createElement("li",null,"Администрация Сайта не несет ответственности за посещение и использование Пользователем внешних ресурсов, ссылки на которые могут содержаться на Сайте."),r.createElement("li",null," Администрация Сайта обязуется не разглашать контактную информацию Пользователя третьим лицам, кроме случаев, предусмотренных действующим законодательством и настоящим Соглашением."),r.createElement("li",null," Пользователь согласен с тем, что Администрация Сайта не несет какой-либо ответственности и не имеет каких-либо обязательств в связи с рекламой, которая может быть размещена на Сайте."),r.createElement("li",null,"Администрация Сайта не занимается рассмотрением и разрешением споров и конфликтных ситуаций, возникающих между Пользователями Сайта, однако оставляет за собой право заблокировать страницу Пользователя в случае получения от других Пользователей мотивированных жалоб на некорректное поведение данного Пользователя на Сайте."),r.createElement("li",null,"Администрация Сайта не несёт ответственности за самостоятельное раскрытие Пользователем своей контактной информации другим Пользователям. При этом Пользователь получает оповещение от Сайта о раскрытии этой информации."),r.createElement("li",null,"Администрация Сайта вправе, но не обязана осуществлять модерацию текста, фотографий, комментариев и иных материалов, размещаемых Пользователями на Сайте."),r.createElement("li",null,"Администрация Сайта вправе удалить любой текст, фотографию, комментарий Пользователя без уведомления и объяснения причин."),r.createElement("li",null,r.createElement("p",null,"Администрация Сайта не контролирует соблюдение авторских прав на интеллектуальную собственность и не несет ответственности за нарушение их Пользователями Сайта."),r.createElement("p",null,"Правообладатель в случае обнаружения на Сайте, размещенную без его разрешения или иного законного основания информацию, которая содержит объекты авторских и (или) смежных прав, или информацию, необходимую для их получения с использованием Сайта вправе направить Администрации Сайта в письменной или электронной форме заявление о нарушении авторских и (или) смежных прав (далее - заявление). Заявление может быть направлено лицом, уполномоченным правообладателем в соответствии с законодательством Российской Федерации."),r.createElement("p",null,"Заявление должно содержать:"),r.createElement("ul",null,r.createElement("li",null,r.createElement("p",null,"1) сведения о правообладателе или лице, уполномоченном правообладателем (если заявление направляется таким лицом) (далее - заявитель):"),r.createElement("ul",null,r.createElement("li",null,"а) для физического лица - фамилию, имя, отчество, паспортные данные (серия и номер, кем выдан, дата выдачи), контактную информацию (номера телефона и (или) факса, адрес электронной почты);"),r.createElement("li",null,"б) для юридического лица - наименование, место нахождения и адрес, контактную информацию (номера телефона и (или) факса, адрес электронной почты);"))),r.createElement("li",null,"информацию об объекте авторских и (или) смежных прав, размещенном на Сайте без разрешения правообладателя или иного законного основания;"),r.createElement("li",null,"указание на доменное имя и (или) сетевой адрес Сайта, на котором без разрешения правообладателя или иного законного основания размещена информация, содержащая объект авторских и (или) смежных прав, или информация, необходимая для его получения с использованием Сайта;"),r.createElement("li",null,"указание на наличие у правообладателя прав на объект авторских и (или) смежных прав, размещенный на Сайте без разрешения правообладателя или иного законного основания;"),r.createElement("li",null," указание на отсутствие разрешения правообладателя на размещение на Сайте информации, содержащей объект авторских и (или) смежных прав, или информации, необходимой для его получения с использованием cайта;"),r.createElement("li",null," согласие заявителя на обработку его персональных данных (для заявителя - физического лица).")),r.createElement("p",null,"В случае, если заявление подается уполномоченным лицом, к заявлению прикладывается копия документа (в письменной или электронной форме), подтверждающего его полномочия."),r.createElement("p",null,"В случае обнаружения неполноты сведений, неточностей или ошибок в заявлении Администрация Сайта вправе направить заявителю в течение двадцати четырех часов с момента получения заявления уведомление об уточнении представленных сведений. Указанное уведомление может быть направлено заявителю однократно."),r.createElement("p",null,"В течение 24-х часов с момента получения вышеуказанного уведомления, заявитель принимает меры, направленные на восполнение недостающих сведений, устранение неточностей и ошибок, и направляет в адрес Администрации Сайта уточненные сведения."),r.createElement("p",null,"В течение 24-х часов с момента получения заявления или уточненных заявителем сведений Администрация Сайта удаляет неправомерно размещенную информацию, или отказывает в удалении информации, указанной заявителем при условии наличия доказательств, подтверждающих правомерность размещения на Сайте информации, содержащей объект авторских и (или) смежных прав, или информации, необходимой для его получения с использованием Сайта, а также направления заявителю соответствующего уведомления с приложением указанных доказательств."),r.createElement("p",null,"Права на направление заявления о нарушении авторских и (или) смежных прав в равной степени распространяются на правообладателя и на лицензиата, получившего исключительную лицензию на объект авторских и (или) смежных прав.")),r.createElement("li",null,"Администрация Сайта не дает никаких гарантий, выраженных явно или подразумеваемых, что материалы, публикуемые на Сайте, полезны и интересны."),r.createElement("li",null,"Администрация Сайта использует информацию о действиях Пользователя в целях улучшения работы Сайта."),r.createElement("li",null,"Администрация Сайта оставляет за собой право приостановить либо прекратить доступ к Сайту при достаточных основаниях предполагать, что Личные данные указаны не полно либо не верно."),r.createElement("li",null,"В случае нарушения Пользователем условий данного Соглашения Администрация Сайта вправе заблокировать страницу Пользователя."),r.createElement("li",null,"Администрация Сайта оставляет за собой право вводить любые ограничения в отношении пользования Сайта."),r.createElement("li",null,"Администрация Сайта либо компания-владелец оставляет за собой право закрыть, приостановить, изменить Сайт либо его часть без предварительного уведомления Пользователя."))),r.createElement("li",null,"Условия предоставления информации о рекламе в Единый реестр интернет-рекламы",r.createElement("ol",null,r.createElement("li",null,"В целях исполнения требований, предусмотренных статьёй 18.1 Федерального закона от 13.03.2006 № 38-ФЗ «О рекламе», а именно в целях предоставления информации о Контенте, являющемся рекламой, размещаемой Пользователем в качестве рекламодателя, рекламораспространителя, оператора рекламной системы либо посредника (далее – «Рекламный Контент») в федеральный орган исполнительной власти, осуществляющий функции по контролю и надзору в сфере средств массовой информации, массовых коммуникаций, информационных технологий и связи (далее — «Уполномоченный орган»), Пользователь обязуется выполнять следующие действия:",r.createElement("p",null,"a) Пользователь самостоятельно получает идентификатор Рекламного Контента (токен) посредством взаимодействия с оператором рекламных данных (далее – «ОРД») в порядке и на условиях, определенных Уполномоченным органом в соответствии с требованиями действующего законодательства."),r.createElement("p",null,"b) Пользователь самостоятельно включает в Рекламный Контент пометку «реклама», а также указание на рекламодателя такой рекламы и (или) сайт, страницу сайта в информационно-телекоммуникационной сети «Интернет», содержащие информацию о рекламодателе такой рекламы."),r.createElement("p",null,"c) Пользователь обязуется обеспечить передачу в Уполномоченный орган в неизменном виде информации о Пользователе/Рекламодателе и размещаемом им Рекламном Контенте в составе, определённом распоряжением Правительства РФ от 30.05.2022 № 1362-р. При этом Пользователь гарантирует соблюдение прав третьих лиц при передаче в Уполномоченный орган информации о Рекламном Контенте.")),r.createElement("li",null,"Пользователь гарантирует полноту, достоверность, актуальность и своевременность предоставления им в Уполномоченный орган информации о Пользователе, распространяемом Рекламном Контенте, рекламодателях, рекламораспространителях, ОРД и иных лицах, участвующих в размещении рекламы."),r.createElement("li",null,"В случае если нарушение Пользователем своих гарантий, предусмотренных условиями п.5.1.,5.2.,5.7., явилось основанием для предъявления к Администрации Сайта и компании-владельцу штрафных санкций со стороны государственных органов либо претензий со стороны третьих лиц, Пользователь обязуется незамедлительно по требованию Администрации Сайта предоставить ему всю запрашиваемую информацию, касающуюся предъявленных санкций либо претензий, содействовать Администрации Сайта в урегулировании предъявленных санкций либо претензий, а также возместить все убытки (включая расходы по уплате штрафов), причинённые Администрации Сайта и компании-владельцу вследствие предъявления ему санкций либо претензий в результате нарушения Пользователем своих гарантий."),r.createElement("li",null,"Администрация сайта предоставляет Пользователю возможность указывать информацию о Пользователе и размещаемом им Рекламном Контенте в составе, определённом распоряжением Правительства РФ от 30.05.2022 № 1362-р."),r.createElement("li",null,"Администрация сайта и компания-владелец не берёт на себя никаких обязательств, а также не предоставляет Пользователю никаких инструментов для передачи информации в Уполномоченный орган."),r.createElement("li",null,"Администрация сайта и компания-владелец не несёт ответственность за взаимодействия Пользователя с ОРД, передачу информации, указанной в настоящем Разделе, и за действия или бездействие ОРД."),r.createElement("li",null,"В случае получения от Администрации сайта запроса на предоставление тех или иных сведений, связанного с передачей информации о Рекламном Контенте в Уполномоченный орган, Пользователь обязуется незамедлительно, но в любом случае не позднее срока, указанного в запросе Администрации сайта, предоставить соответствующие сведения в адрес Администрации сайта."),r.createElement("li",null,"Размещая Контент на Сайте Пользователь соглашается с условиями настоящего Раздела."))),r.createElement("li",null,"Прочее",r.createElement("ol",null,r.createElement("li",null,"Все возможные споры, вытекающие из настоящего Соглашения или связанные с ним, подлежат разрешению в соответствии с действующим законодательством Российской Федерации."),r.createElement("li",null,"Признание судом какого-либо положения Соглашения недействительным или не подлежащим принудительному исполнению не влечет недействительности иных положений Соглашения."),r.createElement("li",null,r.createElement("p",null,"Администрация Сайта и компания-владелец не несут ответственности за Контент, размещенный на Сайте. Так же, Сайт и компания-владелец не несут никакой ответственности:"),r.createElement("ul",null,r.createElement("li",null,"— За неточность и не полноту Контента;"),r.createElement("li",null,"— За ущерб, вред и убытки любого характера, причиненные вследствие пользования Сайтом либо нарушения его работы;"),r.createElement("li",null,"— За разглашение Личных данных произошедших вследствие нарушения работы Сайта."))),r.createElement("li",null,"Администрация Сайта вправе в любое время в одностороннем порядке изменять условия настоящего Соглашения. Такие изменения вступают в силу по истечении 3 (трех) дней с момента размещения новой версии Соглашения на сайте. При несогласии Пользователя с внесенными изменениями он обязан отказаться от доступа к Сайту, прекратить использование материалов и сервисов Сайта."),r.createElement("li",null,"Пользователь добровольно добавляет Контент на Сайт, при этом Пользователь сохраняет интеллектуальные и любые иные права, которые принадлежат ему в отношении Контента."),r.createElement("li",null,"Размещая Контент, Пользователь подтверждает, что этим безвозмездно предоставляет Сайту право на показ, воспроизведение, изменение, хранение, открытую демонстрацию, адаптирование, публикацию, распространение, архивирование, перевод и любое иное использование Контента или любой его части без ограничения срока и территории действия."),r.createElement("li",null,"Пользователь признает за компанией-владельцем все права на Сайт как единый объект, включая все его составляющие."),r.createElement("li",null,r.createElement("p",null,"Принимая настоящее Соглашение, Пользователь выражает свое согласие с тем, что:"),r.createElement("ul",null,r.createElement("li",null,"— При размещении Контента Пользователь не становится соавтором Сайта и отказывается от каких либо претензий на такое авторство в будущем;"),r.createElement("li",null,"— В случае передачи компании-владельцу каких-либо прав на Контент в соответствии с п.6.5. настоящего Соглашения Пользователь лишается права на отзыв произведения, как оно определено ст. 1269 ГК РФ."),r.createElement("li",null,"— В случае размещения Контента, специально созданного Пользователем для размещения на Сайте, исключительное право на такой Контент сохраняется за Пользователем."))),r.createElement("li",null,"Доступ к материалам Сайта, в том числе к Контенту предоставляется Пользователю исключительно для личного использования и ознакомления. Без предварительного письменного согласия владельцев соответствующих прав Пользователь не имеет права использовать, воспроизводить, распространять любым способом, копировать, публично показывать, передавать в эфир для всеобщего сведения, переводить, переделывать, или использовать любым иным способами в каких-либо иных целях материалы Сайта."),r.createElement("li",null,"Администрация Сайта не несет никакой ответственности за целостность и сохранность Контента, размещенного на Сайте."),r.createElement("li",null," Условия п.п.6.5-6.8. настоящего Соглашения остаются в силе после прекращения действия настоящего Соглашения."),r.createElement("li",null,"В случае, если Администрация Сайта в какой-либо момент не требует от Пользователя выполнения каких-либо условий настоящего Соглашения, это не отменяет права Администрации Сайта или компании-владельца требовать такого выполнения позднее, равно как и принимать меры, направленные на выполнение Пользователем условий настоящего Соглашения."),r.createElement("li",null,"После прекращения действия Соглашения, Администрация Сайта продолжает владеть всеми переданными правами на Контент, без каких-либо обязательств оплаты Пользователю за его использование."),r.createElement("li",null,"Никакие положения настоящего Соглашения не ограничивают права Администрации Сайта или Пользователя заключать аналогичные соглашения с любым другим лицом.")))))),r.createElement(iN,{contacts:["advertisement","partnership","help"]})))}}DN.propTypes={app:f().object};const RN=(0,ae.Z)(DN,"AgreementPlatform");
/**
 * Mirtesen.
 *
 * Glagol platform page.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ZN extends r.Component{render(){const{app:e}=this.props,t=["Краткое описание","Команда проекта","Контакты"],n=e.isMobile,a=n?["mediaKitGlagol"]:["logo","mediaKit","mediaKitGlagol","price","video","video2","smiRegistration"],s=n?[]:["advertisement","support"];return r.createElement("div",{className:"about-platform__content-wrapper"},r.createElement(cN,{page:e.page,sections:t}),r.createElement("div",{className:"about-platform__content"},r.createElement("div",null,r.createElement("section",{id:"aboutPlatformSection-0"},r.createElement("h2",{className:"about-platform__title"},"Краткое описание"),r.createElement("p",null,r.createElement("a",{href:`//${Rp().glagolDomain}`,target:"_blank"},"«ГлагоL»")," — это новое медиа на базе платформы МирТесен. Основная миссия: информировать, просвещать и развлекать аудиторию."),r.createElement("p",null,"Основной продукт для конечного пользователя — качественные новости на все самые острые темы, интересные и полезные материалы на самые важные темы. "),r.createElement("p",null,"Мы считаем, что краткость — сестра таланта, — поэтому короткие новости будут основой нашего медиа. Большие тексты тоже не будут длинными непонятными полотнищами, которые никто не дочитывает. Также надеемся на плодотворное сотрудничество с разными брендами в плане спецпроектов.")),r.createElement("section",{id:"aboutPlatformSection-1"},n&&r.createElement("section",null,r.createElement(iN,{save:a,contacts:s,isMobile:!0})),r.createElement("h2",{className:"about-platform__team-title"},"Команда проекта"),r.createElement(hN,{team:[{name:"Даниил",lastName:"Данченко",position:"Главный редактор",imageUrl:"/images/aboutPlatform/glagol-team/danchenko.jpg"},{name:"Василий",lastName:"Шевченко",position:"Выпускающий редактор",imageUrl:"/images/aboutPlatform/glagol-team/shevchenko.jpg"}]})),r.createElement("div",{id:"aboutPlatformSection-2"},r.createElement(sN,null))),r.createElement(iN,{save:a,contacts:s,isMenu:!!t})))}}ZN.propTypes={app:f().object};const BN=(0,ae.Z)(ZN,"GlagolPlatform"),$N=({items:e})=>r.createElement("div",{className:"about-platform__cards-wrapper"},e&&e.length>0&&e.map((({itemClass:e,text:t},n)=>r.createElement("div",{key:n,className:e},t))));$N.propTypes={items:f().arrayOf(f().object)};const UN=(0,r.memo)($N),{infoDomain:HN,mainProto:FN}=Rp();class jN extends r.PureComponent{static propTypes={app:f().object};constructor(e){super(e),this.state={userSystem:null},this.sections=["Преимущества","Вопросы и ответы"],this.faq=[{name:"idea",title:"Могу ли я сразу начать пользоваться приложением, если я зарегистрирован в МирТесен?",text:"Да, вначале указываете номер вашего мобильного телефона,\n                потом почтовый адрес, к которому привязан аккаунт Миртесен.\n                На почту вам придет код, который вы введете на экране\n                регистрации приложения и можете пользоваться МирТесен через приложение."},{name:"social",title:"Как мне внутри приложения подписаться на интересующие меня каналы МирТесен?",text:"Воспользуйтесь поиском по каналам внутри приложения МирТесен или\n            кнопками Подписаться на плитках в ленте Рекомендованное."},{name:"devices",title:"Для каких операционных систем выпущено приложение МирТесен?",text:"Приложение МирТесен может работать на следующих \n                операционных системах: MacOS, iOS, Android, Windows, Linux.\n                Но пока возможно скачать только десктопные версии приложения МирТесен для MacOS, Linux и Windows."},{name:"speed",title:"Требуется ли прокси-сервер для работы приложения МирТесен?",text:"Нет, никаких обходных путей для приложения не требуется,\n                все работает быстро и прозрачно."},{name:"share",title:"Что делать, если я раньше не был пользователем МирТесен?",text:"Скачиваете приложение МирТесен для любого вашего устройства,\n                устанавливаете, стартуете и следуете инструкциям."},{name:"stats",title:"Данные версии приложения являются финальными и больше не будут развиваться?",text:"Нет, у нас запланированы новые возможности и обновления,\n                которые будут постоянно улучшать как дизайн, так и функционал приложения МирТесен."},{name:"remove",title:"Как удалить аккаунт?",text:`Чтобы удалить аккаунт проследуйте следующей <a href='${FN}://${HN}/remove-account-from-mobile-app'>инструкции</a>`}],this.cards=[{text:"Личная переписка с друзьями внутри соцсети",itemClass:"fiends"},{text:"Подписка и чтение тематических каналов МирТесен",itemClass:"subscribe"},{text:"Удобное представление контента и сообщений в виде мессенджера",itemClass:"post"},{text:"Своя стена и стены друзей для отправки постов",itemClass:"posting"},{text:"Удобный просмотр ленты новостей из всех доступных источников",itemClass:"source"},{text:"Автоматическое обновление приложения",itemClass:"update"},{text:"Встроенный браузер для быстрого просмотра контента",itemClass:"browser"},{text:"Алгоритмически рекомендованные материалы лично под Вас",itemClass:"gems"}],this.contacts=["appSupport"],this.files=["appGooglePlay","appStore"],this.systems={mobile:["ios","android"],desktop:["linux","mac","windows"],ios:{title:"Скачать для Iphone",link:"https://apps.apple.com/ru/app/%D0%BC%D0%B8%D1%80%D1%82%D0%B5%D1%81%D0%B5%D0%BD/id1229626373",target:"_blank"},android:{title:"Скачать для Android",link:"https://play.google.com/store/apps/details?id=ru.mirtesen.mobile",target:"_blank"},linux:{title:"Скачать для Linux",link:"http://app.mtml.ru/desktop/stable/0.7.6/MirTesen-0.7.6.AppImage",target:null},mac:{title:"Скачать для Mac",link:"https://apps.apple.com/us/app/%D0%BC%D0%B8%D1%80%D1%82%D0%B5%D1%81%D0%B5%D0%BD/id1490859426?l=ru&ls=1&mt=12",target:"_blank"},windows:{title:"Скачать для Windows",link:"http://app.mtml.ru/desktop/stable/0.7.6/MirTesen%20Setup%200.7.6.exe",target:null}}}componentDidMount(){this.setState({userSystem:_C()})}render(){const{app:e}=this.props,{sections:t,cards:n,faq:a,files:s,contacts:o}=this,i=e.isMobile;return r.createElement("div",{className:"about-platform__content-wrapper app-platform"},r.createElement(cN,{page:e.page,sections:t}),r.createElement("div",{className:"about-platform__content"},r.createElement("div",null,r.createElement("section",null,r.createElement("h2",{className:"about-platform__title"},"МирТесен. Мессенджер"),r.createElement("p",null,"Новое приложение социальной медиаплатформы МирТесен с тематическими каналами, личными сообщениями, умной лентой и стенами друзей — в разных вкладках мессенджера."),r.createElement("p",null,"Основные источники контента — пользователи, крупнейшие СМИ России, популярные бренды, организации, спортивные клубы и собственная редакция медиа «ГлагоL», где профессиональные журналисты пишут эксклюзивные материалы для пользователей МирТесен и всего Рунета.")),i&&r.createElement(iN,{isMenu:!0,save:s,contacts:o}),r.createElement("section",{id:"aboutPlatformSection-0"},r.createElement("h2",{className:"about-platform__title"},"Новые возможности приложения"),r.createElement(UN,{items:n})),r.createElement("section",{id:"aboutPlatformSection-1"},r.createElement("h2",{className:"about-platform__title"},"Вопросы и ответы"),r.createElement(AN,{items:a}))),r.createElement(iN,{isMenu:!0,save:s,contacts:o})))}}const GN=(0,ae.Z)(jN,"appPlatform"),qN=(0,r.memo)((({app:e})=>r.createElement("div",{className:"about-platform__content-wrapper"},r.createElement(cN,{page:e.page}),r.createElement("div",{className:"about-platform__content recommendation-rules"},r.createElement("div",null,r.createElement("section",null,r.createElement("h2",{className:"about-platform__title"},"Правила применения рекомендательных технологий социальной рекомендательной сети МИРТЕСЕН"),r.createElement("h3",null,"Термины и определения"),r.createElement("div",{className:"rules"},r.createElement("div",{className:"row"},r.createElement("div",{className:"title"},'"Сайт"'),r.createElement("div",{className:"text"},'Совокупность программ для электронных вычислительных машин и иной информации, содержащейся в информационной системе, доступ к которой обеспечивается посредством информационно-телекоммуникационной сети "Интернет" (далее - сеть "Интернет") по доменным именам и (или) по сетевым адресам, позволяющим идентифицировать сайты в сети "Интернет", расположенный по адресу ',r.createElement("a",{href:"https://mirtesen.ru"},"mirtesen.ru"))),r.createElement("div",{className:"row"},r.createElement("div",{className:"title"},'"Доменное имя"'),r.createElement("div",{className:"text"},'Обозначение символами, предназначенное для адресации сайтов в сети "Интернет" в целях обеспечения доступа к информации, размещенной в сети "Интернет";')),r.createElement("div",{className:"row"},r.createElement("div",{className:"title"},'"Рекомендательные технологии"'),r.createElement("div",{className:"text"},'процессы и методы сбора, систематизации, анализа сведений, на Сайте, относящиеся к предпочтениям пользователей сети "Интернет", предоставления информации на основе этих сведений, а также способы осуществления таких процессов и методов.')),r.createElement("div",{className:"row"},r.createElement("div",{className:"title"},'"Пользователь сети "Интернет" в целях применения настоящих Правил'),r.createElement("div",{className:"text"},"обезличенный посетитель Сайта, находящийся на территории Российской Федерации.")),r.createElement("div",{className:"row"},r.createElement("div",{className:"note"},"Если из контекста не вытекает иное, любой термин, не определенный в настоящих Правилах, имеет то значение, которое установлено для него законодательством Российской Федерации и обычаем."))),r.createElement("h3",null,"Содержание рекомендательных технологий: "),r.createElement("div",{className:"rules"},r.createElement("div",{className:"row"},r.createElement("div",{className:"title"},'Описание процессов и методов сбора, систематизации, анализа сведений, относящихся к предпочтениям пользователей сети "Интернет", предоставления информации на основе этих сведений, а также способов осуществления таких процессов и методов.'),r.createElement("div",{className:"text"},r.createElement("p",null,"На проекте Миртесен используется контент предоставляемый партнерскими СМИ, а также зарегистрированными пользователями социальной рекомендательной сети."),r.createElement("p",null,"Для рекомендации контента используются следующие атрибуты:"),r.createElement("ul",null,r.createElement("li",null,"Подписки"),r.createElement("li",null,"Категории"),r.createElement("li",null,"Теги"),r.createElement("li",null,"Гео-теги")),r.createElement("p",null,"Используются два типа сбора предпочтений пользователя:"),r.createElement("ul",null,r.createElement("li",null,"Ручная установка пользователем"),r.createElement("li",null,"Геопозиционирование"),r.createElement("li",null,"Автоматический сбор предпочтений")),r.createElement("h4",null,"Ручная установка пользователем"),r.createElement("p",null,"Пользователь может непосредственно влиять на механизм рекомендации, указав свои предпочтения и исключения в настройках."),r.createElement("p",null,"Механизм рекомендации расставляет веса статьям в выдаче. Статьям, которые обладают атрибутами, указанными пользователем в его предпочтениях, повышается вес. Статьи, которые обладают атрибутами, указанными пользователем в его исключениях, понижаются в выдаче."),r.createElement("h4",null,"Геопозиционирование"),r.createElement("p",null,"(в разработке)"),r.createElement("p",null,"При посещении проекта зарегистрированным пользователем, проект получает данные о местоположении пользователя, на основе этих данных пользователю предлагается выбрать географический регион, новости которого его интересуют. Если у пользователя такие регионы указаны, то материалам относящимся к данному региону повышается вес."),r.createElement("h4",null,"Автоматический сбор предпочтений"),r.createElement("p",null,"На основании действий пользователя собираются автоматические предпочтения пользователей - атрибуты из материалов, с которыми взаимодействует пользователь, собираются в вектора интересов. При формировании рекомендованной ленты материалов вектора интересов пользователя влияют на вес материала в персональной выдаче."))),r.createElement("div",{className:"row"},r.createElement("div",{className:"title"},'Виды сведений, относящихся к предпочтениям пользователей сети "Интернет", которые используются для предоставления информации с применением рекомендательных технологий, источники получения таких сведений'),r.createElement("div",{className:"text"},r.createElement("p",null,'К сведениям, относящимся к предпочтениям пользователей сети "Интернет" относится:'),r.createElement("ul",null,r.createElement("li",null,"Подписки"),r.createElement("li",null,"Категории"),r.createElement("li",null,"Теги"),r.createElement("li",null,"Гео-теги")),r.createElement("p",null,"Используются три типа сбора предпочтений пользователя:"),r.createElement("ul",null,r.createElement("li",null,"Ручная установка пользователем"),r.createElement("li",null,"Геопозиционирование"),r.createElement("li",null,"Автоматический сбор предпочтений"))))))))))),VN=(0,ae.Z)(qN,"RecommendationRules");
/**
 * Mirtesen.
 *
 * Person settings tab.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class zN extends r.PureComponent{constructor(e){super(e),this.addEmailInput=r.createRef(),this.socialNetworks=this.props.socialNetworks,this.state={socialNetworks:{mailru:!!this.socialNetworks.Mailru,fb:!!this.socialNetworks.Facebook,vk:!!this.socialNetworks.Vkontakte,ok:!!this.socialNetworks.Odnoklassnik},isPhoneConfirmed:this.props.isPhoneConfirmed,isBusy:!1,isReady:!1},this.form={messengers:[{type:"text",name:"whatsapp",label:"WhatsApp:",inline:!0},{type:"text",name:"telegram",label:"Telegram:",inline:!0},{type:"text",name:"skype",label:"Skype:",inline:!0},{type:"text",name:"viber",label:"Viber:",inline:!0},{type:"text",name:"tamtam",label:"Tamtam:",inline:!0},{type:"text",name:"yamb",label:"Yamb:",inline:!0}],anotherSocial:[{images:"mailru",name:"addMailSocial",link:"https://mirtesen.ru/exauth/Mailru?init=1&backurl=https%3A%2F%2Fmirtesen.ru%2Fsettings%2Fcontacts%3Falert_msg%3Dsoc_network_enabled",active:this.state.socialNetworks.mailru},{images:"vk",name:"addVkSocial",link:"https://mirtesen.ru/exauth/Vkontakte?init=1&backurl=https%3A%2F%2Fmirtesen.ru%2Fsettings%2Fcontacts%3Falert_msg%3Dsoc_network_enabled",active:this.state.socialNetworks.vk},{images:"ok",name:"addOkSocial",link:"https://mirtesen.ru/exauth/Odnoklassniki?init=1&backurl=https%3A%2F%2Fmirtesen.ru%2Fsettings%2Fcontacts%3Falert_msg%3Dsoc_network_enabled",active:this.state.socialNetworks.ok}],phones:[{type:"text",name:"phoneMobile",label:"Мобильный:",placeholder:"Номер в международном формате (Например +7_)",inline:!0,wrap:!0,classNameInput:this.state.isPhoneConfirmed?"person-settings__phone-confirmed":""},{type:"text",name:"phoneWork",label:"Рабочий:",inline:!0},{type:"text",name:"phoneHome",label:"Домашний:",inline:!0}]}}componentDidMount(){const e=document.getElementsByName("phoneMobile")[0],t=document.getElementById("person-settings__phone-confirm-btn");e&&e.addEventListener("input",(n=>{if(n.target.value.substr(-1).match(/[^0-9()+\-\s]/g))return!1;e.classList.remove("person-settings__phone-confirmed"),t.style.display="inline-block"})),this.form.phones[0].classNameInput="",-1!==window.location.href.indexOf("alert_msg")&&history.pushState("","","/settings/contacts"),this.setState({isReady:!0})}componentDidUpdate(){const{confirmedPhone:e,confirmSmsSent:t}=this.props,n=document.getElementsByName("phoneMobile")[0],a=n.value.trim(),s=document.getElementById("person-settings__phone-confirm-btn");e!==a||t||(s.style.display="none",n.classList.add("person-settings__phone-confirmed")),a||(s.style.display="none",n.classList.remove("person-settings__phone-confirmed"))}handleConfirmPhone=()=>{const{onSavePhoneWithConfirm:e}=this.props,{phoneMobile:t}=this.props.data;this.setState({isBusy:!0}),e(t),this.setState({isBusy:!1})};render(){const{onChangeInput:e,onSaveSettings:t,onAddEmail:n,onConfirmEmail:a,onDeleteEmail:s,onSetPrimaryEmail:o,onDetachSocialNetwork:i,onSetFieldValidValue:l,userId:c,active:m,data:d={},errors:p={},valid:u={}}=this.props,g={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!m};return r.createElement("div",{className:_()(g)},r.createElement("h1",{className:"form-title"},"Контактная информация"),r.createElement("div",{className:"form-group site-settings__subtitle"},"Ваша контактная информация будет доступна только друзьям Номер вашего мобильного телефона не виден никому, включая друзей"),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("h1",{className:"form-title"},"Ваши телефоны:"),this.form.phones.map(((t,n)=>r.createElement(r.Fragment,null,r.createElement(VS,{extraElem:t.extraElem,error:p[t.name],invalid:!1===u[t.name],key:n,input:t,value:d[t.name],onChangeHandle:n=>{if(n.target.value.substr(-1).match(/[^0-9()+\-\s]/g))return!1;e(n,t.name),"phoneMobile"===t.name&&l({phoneMobile:!0})}}),"phoneMobile"===t.name&&r.createElement("div",{className:"form-group",id:"person-settings__phone-confirm-btn",key:"confirm-main-phone-buttom"},r.createElement(He.Z,{onClick:this.handleConfirmPhone,label:"Подтвердить"})))))),r.createElement("div",{className:"form-group"},r.createElement("h1",{className:"form-title"},"Настройка почты:"),r.createElement("div",{className:"site-settings__form-group_inline position-relative form-group"},r.createElement("label",{className:"site-settings__label_inline"},"Основной email:"),r.createElement("span",{className:"site-settings__input_inline"},d.emails.default)),Array.isArray(d.emails.confirmed)&&d.emails.confirmed.length>0&&r.createElement("div",{className:"site-settings__form-group_inline position-relative form-group"},r.createElement("label",{className:"site-settings__label_inline"},"Подтвержденные адреса:"),r.createElement("div",{className:"site-settings__input_inline site-settings-email-list"},d.emails.confirmed.map(((e,t)=>r.createElement("div",{className:"site-settings-email-list__item",key:t},r.createElement("div",{className:"site-settings-email-list__email"},e),r.createElement("div",{className:"site-settings-email-list__actions"},r.createElement("a",{href:"#primary",onClick:t=>{t.preventDefault(),o(e)}},"Сделать основным")," | ",r.createElement("a",{href:"#delete",onClick:t=>{t.preventDefault(),s(e)}},"Удалить"))))))),Array.isArray(d.emails.pending)&&d.emails.pending.length>0&&r.createElement("div",{className:"site-settings__form-group_inline position-relative form-group"},r.createElement("label",{className:"site-settings__label_inline"},"Ожидают подтверждения:"),r.createElement("div",{className:"site-settings__input_inline site-settings-email-list"},d.emails.pending.map(((e,t)=>r.createElement("div",{className:"site-settings-email-list",key:t},r.createElement("div",{className:"site-settings-email-list__email"},e),r.createElement("div",{className:"site-settings-email-list__actions"},r.createElement("a",{href:"#confirm",onClick:t=>{t.preventDefault(),a(e)}},"Подтвердить")," | ",r.createElement("a",{href:"#delete",onClick:t=>{t.preventDefault(),s(e)}},"Удалить"))))))),r.createElement("div",{className:"site-settings__form-group_inline position-relative form-group"},r.createElement("label",{className:"site-settings__label_inline"},"Добавить email:"),r.createElement("div",{className:"site-settings__input_inline site-settings-email-list"},r.createElement("input",{type:"email",name:"add_email",className:"form-control",ref:this.addEmailInput}),r.createElement("div",{className:"site-settings-email-list__actions"},r.createElement(He.Z,{type:"button",label:"Добавить",onClick:()=>{const e=this.addEmailInput.current.value;n(e),y.Z.isEmail(e)&&(this.addEmailInput.current.value="")}})))))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("h1",{className:"form-title"},"Я в мессенджерах:"),this.form.messengers.map(((t,n)=>r.createElement(VS,{error:p[t.name],key:n,input:t,value:d[t.name],onChangeHandle:n=>{e(n,t.name)}}))))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("h1",{className:"form-title"},"Я в других социальных сетях:"),r.createElement("div",{className:"form-group"},this.form.anotherSocial.map(((e,t)=>r.createElement("div",{className:"site-settings__social",key:t},r.createElement("a",{className:"site-settings__social-outer",href:e.link,onClick:t=>{t.preventDefault(),e.active?i(c,e.name):window.location.href=e.link}},r.createElement("span",{className:_()("site-settings__social-img",`site-settings__social-img-pack-${e.images}`)}),r.createElement("span",{className:"site-settings__social-active"},!0===e.active?"Отключить":"Подключить"))))))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:t,label:"Сохранить"}))))}}zN.propTypes={isDev:f().bool,active:f().bool,onChangeInput:f().func,onSaveSettings:f().func,onAddEmail:f().func,onDeleteEmail:f().func,onSetPrimaryEmail:f().func,onConfirmEmail:f().func,onSetFieldValidValue:f().func,onSavePhoneWithConfirm:f().func,data:f().object,errors:f().object,valid:f().object,socialNetworks:f().oneOfType([f().object,f().array]),onDetachSocialNetwork:f().func,userId:f().number,confirmedPhone:f().string,isPhoneConfirmed:f().bool,phoneMobile:f().string,confirmSmsSent:f().bool};const WN=(0,i.$j)((e=>({userId:e.app.person.id,socialNetworks:e.personSettings.data.contacts.socialNetworks,isPhoneConfirmed:e.personSettings.data.contacts.isPhoneConfirmed,confirmedPhone:e.personSettings.data.confirm.phone,confirmSmsSent:e.personSettings.data.confirm.confirmSmsSent,phoneMobile:e.personSettings.data.contacts.phoneMobile})),(e=>({onDetachSocialNetwork:(t,n)=>{e(((e,t)=>async n=>{const a=await Tt.Z.getPersonSettings(e);if(a.result){const s=a.settings.contacts;"addMailSocial"===t&&delete s.socialNetworks.Mailru,"addFacebookSocial"===t&&delete s.socialNetworks.Facebook,"addVkSocial"===t&&delete s.socialNetworks.Vkontakte,"addOkSocial"===t&&delete s.socialNetworks.Odnoklassniki,Promise.all([Tt.Z.setPersonSettings(e,{contacts:s})]).then((([e])=>{n(Gg(e))})).catch((e=>{kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e}),D.Z.promiseHandler(Bg)(e)}))}})(t,n))},onSetFieldValidValue:t=>{e(Hg(t))},onSavePhoneWithConfirm:t=>{e((e=>async t=>{if(!Fe.Z.validInternational(e))return t(Hg({phoneMobile:!1})),kt.Z.sendSystemMessage("incorrectPhoneNumber"),!1;t(Fg("confirm","confirmSmsSent",!1)),Promise.resolve(Y.Z.savePhoneWithConfirm(e)).then((n=>{if("code"===n.params.step)t(Fg("confirm","confirmSmsSent",!0)),t(Fg("confirm","phone",e)),t($g("confirm")),t(Hg({phoneMobile:!0}));else{t(Hg({phoneMobile:!1}));let e="Ошибка сервера, попробуйте позже";n.params.errorMap&&n.params.errorMap.phone&&(e=n.params.errorMap.phone,t(Ug({phone:e}))),kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e})}})).catch((e=>{kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e}),console.log(e)}))})(t))}})))(zN);
/**
 * Mirtesen.
 *
 * Person settings tab.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class YN extends r.Component{state={inputs:[{type:"password",name:"oldPassword",label:"Старый пароль"},{type:"password",name:"nextPassword",label:"Новый пароль (не менее 6 символов)"},{type:"password",name:"nextPasswordRepeat",label:"Повторите новый пароль"},{type:"checkbox",name:"showPassword",label:"показать пароль"}]};render(){const{onChangeInput:e,onSaveSettings:t,active:n,personSettings:a,data:s={},errors:o={}}=this.props,{inputs:i}=this.state,l=L()(a,"activeTab"),c={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!n};return r.createElement("div",{className:_()(c)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Смена пароля"),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},i.map(((t,n)=>r.createElement(VS,{error:o[t.name],key:n,input:t,type:"password"===t.type&&L()(a,`data.${l}.showPassword`)?"text":t.type,value:s[t.name],onChangeHandle:n=>e(n,t.name)}))))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{onClick:e=>{e.preventDefault(),t()},label:"Сохранить"})))))}}YN.propTypes={isDev:f().bool,data:f().object,onChangeInput:f().func,onSaveSettings:f().func,active:f().bool,errors:f().any,showPassword:f().bool,personSettings:f().object};const KN=YN;
/**
 * Mirtesen.
 *
 * Person settings tab.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class JN extends r.PureComponent{handleAddTag=(e,t)=>{const{data:n,onChangeInput:a}=this.props,s=this.tagsToArray(n,t);s.push(e.name),a(s.join(","),t)};handleDeleteTag=(e,t)=>{const{data:n,onChangeInput:a}=this.props;let s=this.tagsToArray(n,t);s=s.filter(((t,n)=>n!==e)),a(s.join(","),t)};tagsToArray=(e,t)=>(L()(e,t)||"").split(",").filter((e=>e&&""!==e));form={fullName:[{type:"text",name:"name",label:"Имя:",inline:!0,isRequired:!0},{type:"text",name:"lastname",label:"Фамилия:",inline:!0},{type:"text",name:"nickname",label:"Псевдоним:",inline:!0}],status:[{type:"text",name:"description",label:"Статус:",inline:!0}],birthday:[{label:"День рождения:",classNameOuter:"site-settings_tree-column-grid"},{type:"text",name:"userBirthday",label:"День:",inline:!0,placeholder:"XX"},{type:"text",name:"userBirthdayMonth",label:"Месяц:",inline:!0,placeholder:"XX"},{type:"text",name:"userBirthdayYear",label:"Год:",inline:!0,placeholder:"XXXX"}],gender:[{type:"radiogroup",name:"isMale",label:"Пол:",group:[{id:0,text:"Мужской",initVal:"t"},{id:1,text:"Женский",initVal:"f"}]}],educationAndFamilyStatus:[{type:"select",name:"education",label:"Образование:",list:[{text:"Выберите ваше образование"},{text:"Студент"},{text:"Среднее"},{text:"Специальное"},{text:"Неоконченное высшее"},{text:"Высшее"},{text:"Кандидат наук"},{text:"Доктор наук"}]},{type:"select",name:"maritalStatus",label:"Семейное положение:",list:[{text:"--Выберите ваше семейное положение--"},{text:"Ничего серьёзного"},{text:"Есть пара"},{text:"Помолвлены"},{text:"В браке"},{text:"Всё сложно"},{text:"В активном поиске"}]},{type:"text",name:"career",label:"Профессия:"}],otherInfo:[{type:"textarea",name:"music",label:"Любимая музыка"},{type:"textarea",name:"movies",label:"Любимые фильмы"},{type:"textarea",name:"books",label:"Любимые книги"},{type:"textarea",name:"foods",label:"Любимая еда"},{type:"textarea",name:"games",label:"Любимые игры"},{type:"textarea",name:"tags",labelMuted:"Перечислите свои интересы через запятую,\n                            например: «автомобили, кино, музыка, самолеты».",label:"Интересы:"}]};render(){const{data:e={},errors:t={},active:n,onChangeInput:a,onSaveSettings:s}=this.props,o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!n};return r.createElement("div",{className:_()(o)},r.createElement("h1",{className:"form-title"},"Мои данные"),Object.keys(this.form).map(((n,s)=>"otherInfo"!==n&&r.createElement("div",{className:"form-section form-section_top",key:s},r.createElement("div",{className:_()("form-group",this.form[n][0].classNameOuter)},this.form[n].map(((n,s)=>r.createElement(VS,{error:t[n.name],key:s,input:n,value:e[n.name],onChangeHandle:e=>{a(e,n.name)}}))))))),this.form.otherInfo.map(((t,n)=>r.createElement("div",{className:"form-group",key:n},r.createElement("label",null,t.label),r.createElement(aT,{helper:"Используйте Tab или Enter чтобы завершить ввод",placeholder:"Добавить...",tags:this.tagsToArray(e,t.name)||[],onChangeInput:e=>{a(e.join(","),t.name)}})))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{label:"Сохранить",onClick:s}))))}}JN.propTypes={isDev:f().bool,active:f().bool,onChangeInput:f().func,onSaveSettings:f().func,data:f().object,errors:f().object};const XN=JN,QN=({isOpen:e,onClosePopup:t,onConfirm:n})=>e&&r.createElement(O.Z,{onClose:t,className:"site-settings__delete-user-popup"},r.createElement(O.Z.Body,null,"ВНИМАНИЕ: вы удаляете свой аккаунт, восстановление будет невозможно. Уверены?"),r.createElement(O.Z.Footer,null,r.createElement(He.Z,{onClick:()=>{n()},label:"Да"}),r.createElement(He.Z,{color:"secondary",onClick:t,label:"Нет"}))),eO=(0,r.memo)(QN);
/**
 * Mirtesen.
 *
 * Person settings tab.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class tO extends r.Component{constructor(e){super(e),this.state={showPopup:!1}}radiobutton={vislvl:[{title:"все",value:9},{title:"все зарегистрированные пользователи",value:4},{title:"только друзья",value:1},{title:"никто (удаление анкеты)",value:-2}],vislvl_friends:[{title:"только я",value:0},{title:"только друзья",value:1},{title:"все зарегистрированные пользователи",value:4},{title:"все",value:9}],vislvl_user_post:[{title:"только я",value:0},{title:"только друзья",value:1},{title:"все зарегистрированные пользователи",value:4}]};radiobuttonTitle={vislvl:"Мою страницу видят:",vislvl_friends:"Список друзей видят:",vislvl_user_post:"На мою стену могу постить:"};checkbox=[{type:"checkbox",name:"allow_daily",label:"о темах дня"},{type:"checkbox",name:"meta_allow_friends_and_messages",label:"о друзьях и о новых личных сообщениях"},{type:"checkbox",name:"meta_allow_comments",label:"о комментариях"},{type:"checkbox",name:"meta_allow_photos_and_places",label:"о фотографиях и местах"},{type:"checkbox",name:"meta_allow_groups",label:"о сайтах"}];input=[{type:"text",name:"inviter_person_url",label:"Меня пригласил:"}];makeRadio(e,t,n,{currentObject:a=this.radiobutton,type:s="radio"}={}){const o=[],{onChangeInput:i}=this.props;return t="number"==typeof t?t.toString():t,a[e].map((a=>{let l=a.value;l="number"==typeof l?l.toString():l,o.push(r.createElement(VS,{error:n[e],key:l,input:{type:s,initVal:l,label:a.title,name:e},value:t,onChangeHandle:t=>{i(t,e)}}))})),o}render(){const{onChangeInput:e,onSaveSettings:t,active:n,data:a={},errors:s={}}=this.props,o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!n};return r.createElement("div",{className:_()(o)},r.createElement("form",{className:"site-settings__form"},r.createElement("h1",{className:"form-title"},"Приватность и уведомления"),r.createElement("div",{className:"form-section form-section_top"},Object.keys(this.radiobuttonTitle).map(((e,t)=>r.createElement("div",{className:"form-group",key:t},r.createElement("label",null,this.radiobuttonTitle[e]),this.makeRadio(String(e),a[e],s))))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement("label",null,"Я хочу получать письма:"),this.checkbox.map(((t,n)=>r.createElement(VS,{error:s[t.name],key:n,input:t,type:t.type,value:a[t.name],onChangeHandle:n=>e(n,t.name)}))))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},this.input.map(((t,n)=>r.createElement(VS,{error:s[t.name],key:n,input:t,type:t.type,value:a[t.name],onChangeHandle:n=>e(n,t.name)}))))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{label:"Сохранить",onClick:e=>{e.preventDefault(),"-2"!==a.vislvl.toString()?t():this.setState({showPopup:!0})}})))),r.createElement(eO,{isOpen:this.state.showPopup,onConfirm:t,onClosePopup:()=>{this.setState({showPopup:!1})}}))}}tO.propTypes={isDev:f().bool,data:f().object,onChangeInput:f().func,onSaveSettings:f().func,active:f().bool,errors:f().any,showPassword:f().bool,personSettings:f().object};const nO=tO;
/**
 * Mirtesen.
 *
 * Person settings tab.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class aO extends r.PureComponent{form={buttonCode:[{type:"textarea",name:"buttonCode",label:"Исходный код кнопки МирТесен:",labelMuted:"В параметре post укажите текст или ссылку",classNameInput:"site-settings__input_big-height"}]};render(){const{active:e,data:t={},errors:n={},onChangeInput:a}=this.props,s={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!e};return r.createElement("div",{className:_()(s)},r.createElement("h1",{className:"form-title"},"Персональная информация"),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},this.form.buttonCode.map(((e,s)=>r.createElement(VS,{error:n[e.name],key:s,input:e,value:t[e.name],onChangeHandle:t=>{a(t,e.name)}}))))))}}aO.propTypes={isDev:f().bool,active:f().bool,onChangeInput:f().func,data:f().object,errors:f().object};const sO=aO;
/**
 * Mirtesen.
 *
 * Person settings tab.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class rO extends r.PureComponent{form={socials:[{name:"MirTesen",image:"https://static.mtml.ru/images/v4/bg-social-buttons-alt.png?v=068d525d6c7d6ce850b55e0e27a3f1b4"},{name:"MailRu",image:"https://static.mtml.ru/images/v4/bg-social-buttons-alt.png?v=068d525d6c7d6ce850b55e0e27a3f1b4"},{name:"Twitter",image:"https://static.mtml.ru/images/v4/bg-social-buttons-alt.png?v=068d525d6c7d6ce850b55e0e27a3f1b4"}],searchInput:[{type:"text",name:"searchInput",placeholder:"Поиск"}],userList:[{userphoto:"https://r.mtdata.ru/c50x50/u33/photoDADA/20143455938-0/original.jpeg",username:"Oleg Yasdffasdfasdfasdfasd"},{userphoto:"https://r.mtdata.ru/c50x50/u33/photoDADA/20143455938-0/original.jpeg",username:"Oleg Yasdffasdfasdfasdfasd"},{userphoto:"https://r.mtdata.ru/c50x50/u33/photoDADA/20143455938-0/original.jpeg",username:"Oleg Yasdffasdfasdfasdfasd"},{userphoto:"https://r.mtdata.ru/c50x50/u33/photoDADA/20143455938-0/original.jpeg",username:"Oleg Yasdffasdfasdfasdfasd"},{userphoto:"https://r.mtdata.ru/c50x50/u33/photoDADA/20143455938-0/original.jpeg",username:"Oleg Yasdffasdfasdfasdfasd"},{userphoto:"https://r.mtdata.ru/c50x50/u33/photoDADA/20143455938-0/original.jpeg",username:"Oleg Yasdffasdfasdfasdfasd"}]};render(){const{onChangeInput:e,active:t,data:n={},errors:a={}}=this.props,s={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!t};return r.createElement("div",{className:_()(s)},r.createElement("h1",{className:"form-title"},"Начни общение прямо сейчас!"),r.createElement("div",{className:"form-group site-settings__subtitle position-relative form-group"},"Используйте свой аккаунт в Мой Мир или Twitter, чтобы найти друзей:"),r.createElement("div",{className:"site-settings__social-outer_grid"},this.form.socials.map(((e,t)=>r.createElement("div",{className:"site-settings__social-button",key:t},r.createElement("div",{className:`site-settings__social-img site-settings__social-img_${e.name}`},r.createElement("img",{className:`site-settings__social-img-inner site-settings__social-img-inner_${e.name}`,src:e.image,alt:e.name})),r.createElement("div",{className:"site-settings__social-name"},e.name))))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},this.form.searchInput.map(((t,s)=>r.createElement(VS,{error:a[t.name],key:s,input:t,type:t.type,value:n[t.name],onChangeHandle:n=>e(n,t.name)}))))),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},this.form.userList.map(((e,t)=>r.createElement("div",{className:"site-settings__add-user",key:t},r.createElement("div",{className:"site-settings__add-user-photo"},r.createElement("img",{className:"site-settings__add-user-photo-img",src:e.userphoto,alt:e.username})),r.createElement("div",{className:"site-settings__add-user-name"},e.username),r.createElement("div",{className:"site-settings__add-user-button-group"})))))))}}rO.propTypes={isDev:f().bool,active:f().bool,onChangeInput:f().func,data:f().object,errors:f().object};const oO=rO;
/**
 * Mirtesen.
 *
 * Person settings tab.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class iO extends r.PureComponent{dataAdapter(e){return{id:e.id,type:"checkbox",name:`key${e.id}.value`,label:e.display_name,value:e.value||"",classNameInput:"site-settings__big-checkbox"}}dataAdapterIterator(e,t){return Object.values(e).map(t)}render(){const{data:e={},active:t,onChangeInput:n,onSaveSettings:a}=this.props,s=this.dataAdapterIterator(e,this.dataAdapter),o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!t};return r.createElement("div",{className:_()(o)},r.createElement("h1",{className:"form-title"},"Сайты в черном списке"),r.createElement("div",{className:"form-group site-settings__subtitle position-relative form-group"},"Cайты, находящиеся в «чёрном списке», не показываются в Вашей ленте. Добавить сайт в «чёрный список» можно в ленте."),0!==s.length?s.map(((e,t)=>r.createElement("div",{className:"form-section form-section_top",key:t},r.createElement("div",{className:"form-group"},r.createElement(VS,{input:e,value:e.value,onChangeHandle:t=>{n(t,e.name)}}))))):r.createElement("div",{className:"site-settings__empty-list"},"Список пуст"),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{label:"Исключить",onClick:a}))))}}iO.propTypes={isDev:f().bool,active:f().bool,onChangeInput:f().func,onSaveSettings:f().func,data:f().oneOfType([f().array,f().object])};const lO=iO;
/**
 * Mirtesen.
 *
 * Person settings tab.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class cO extends r.PureComponent{dataAdapter(e){return{id:e.id,type:"checkbox",name:`key${e.id}.value`,label:e.display_name,value:e.value||"",classNameInput:"site-settings__big-checkbox"}}dataAdapterIterator(e,t){return Object.values(e).map(t)}render(){const{data:e={},active:t,onChangeInput:n,onSaveSettings:a}=this.props,s=this.dataAdapterIterator(e,this.dataAdapter),o={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!t};return r.createElement("div",{className:_()(o)},r.createElement("h1",{className:"form-title"},"Люди в черном списке"),r.createElement("div",{className:"form-group site-settings__subtitle position-relative form-group"},"Пользователи, находящиеся в «чёрном списке», не могут предлагать Вам дружбу, отправлять личные сообщения, комментировать на Вашей стене, приглашать Вас на сайты. Добавить пользователя в «чёрный список» можно с его личной страницы."),0!==s.length?s.map(((e,t)=>r.createElement("div",{className:"form-section form-section_top",key:t},r.createElement("div",{className:"form-group"},r.createElement(VS,{input:e,value:e.value,onChangeHandle:t=>{n(t,e.name)}}))))):r.createElement("div",{className:"site-settings__empty-list"},"Список пуст"),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{label:"Исключить",onClick:a}))))}}cO.propTypes={isDev:f().bool,active:f().bool,onChangeInput:f().func,onSaveSettings:f().func,data:f().object};const mO=cO;
/**
 * Mirtesen.
 *
 * Edit comments Container.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class dO extends r.Component{confirmPhone={type:"text",name:"phone",label:"Номер мобильного телефона:",placeholder:"Номер в международном формате (Например +7_)",inline:!0};confirmCode={type:"text",name:"phoneConfirmCode",label:"Код подтверждения:",inline:!0};render(){const{onChangeInput:e,onConfirmPhone:t,onSetFieldValidValue:n,active:a,data:s={},errors:o={},valid:i={}}=this.props,l={"site-settings__wrapper":!0,"site-settings__wrapper_hidden":!a,"site-settings__phone-confirmation":!0};return r.createElement("div",{className:_()(l)},r.createElement("h1",{className:"form-title"},"Подтвердите свой номер мобильного телефона."),r.createElement("p",null,'Вам отправлено SMS с кодом подтверждения, после получения введите в поле "Код подтверждения".'),r.createElement("div",{className:"form-group site-settings__subtitle"},'Если потребуется, номер телефона можно будет изменить в настройках профиля в разделе "Контактная информация".',r.createElement("br",null),"Номер мобильного телефона необходимо указывать в международном формате (Например +7_)."),r.createElement("div",{className:"form-section form-section_top"},r.createElement("div",{className:"form-group"},r.createElement(VS,{error:o[this.confirmPhone.name],invalid:!1===i[this.confirmPhone.name],input:this.confirmPhone,value:s[this.confirmPhone.name],onChangeHandle:t=>{if(t.target.value.substr(-1).match(/[^0-9()+\-\s]/g))return!1;e(t,this.confirmPhone.name),n({phoneMobile:!0})}}),r.createElement(VS,{error:o[this.confirmCode.name],invalid:!1===i[this.confirmCode.name],input:this.confirmCode,value:s[this.confirmCode.name],onChangeHandle:t=>{if(t.target.value.substr(-1).match(/[^0-9]/g))return!1;e(t,this.confirmCode.name),n({phoneConfirmCode:!0})}}))),r.createElement("div",{className:"form-section form-section_top form-section_submit"},r.createElement("div",{className:"form-group"},r.createElement(He.Z,{label:"Подтвердить",onClick:()=>{t(s.phone,s.phoneConfirmCode.trim())}}),s.resending&&r.createElement("span",{className:"phone-confirmation-code-resending"},"SMS c кодом отправлено"))))}}dO.propTypes={active:f().bool,onChangeInput:f().func,onConfirmPhone:f().func,onSetFieldValidValue:f().func,data:f().object,errors:f().object,valid:f().object};const pO=(0,i.$j)(null,(e=>({onConfirmPhone:(t,n)=>{e(((e,t)=>async n=>t?Fe.Z.validInternational(e)?Promise.resolve(Y.Z.confirmPhone(e,t)).then((e=>{const{status:t,errors:a}=e;let s=!1;t?(n(Hg({phoneConfirmCode:!0})),kt.Z.sendSystemMessage("confirmedPhoneNumber"),n($g("contacts")),n(Fg("contacts","isPhoneConfirmed",!0))):a?a.forEach((e=>{const{key:t,message:n}=e;s="phone"===t&&"error_required_missed"===n?"Введите номер телефона":"phone"===t&&"error_invalid_format"===n?"Неверный формат":"phone"===t&&"error_doesnt_match"===n?"Пользователь не найден":"phone"===t&&"error_disallowed"===n?"Пользователь заблокирован или удален":"code"===t&&"error_required_missed"===n?"Введите код":"code"===t&&"error_doesnt_match"===n?"Неверный код":"code"===t&&"error_exceed_limit"===n?"Превышено число неудачных попыток":"code"===t&&"error_person_phone_confirmed_other"===n?"Телефон уже подтвердил другой пользователь":n})):s="Ошибка сервера, попробуйте позже",s&&(n(Hg({phoneConfirmCode:!1})),kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:s}))})).catch((e=>{kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e}),D.Z.promiseHandler(Bg)(e)})):(n(Hg({phone:!1})),kt.Z.sendSystemMessage("incorrectPhoneNumber"),!1):(n(Hg({phoneConfirmCode:!1})),kt.Z.sendSystemMessage("confirmCode"),!1))(t,n))},onSetFieldValidValue:t=>{e(Hg(t))}})))(dO);
/**
 * Mirtesen.
 *
 * Person Settings Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class uO extends r.Component{handleChangeInput=(e,t,n=null)=>{const{handleChangeInput:a}=this.props,{activeTab:s}=this.props.personSettings;let r=null;const o=e.target;r=o?"checkbox"===o.type?o.checked?"on":"":(o.type,o.value):e,a(n||s,t,r)};handleSaveSettings=()=>{const{app:e,handleSaveSettings:t}=this.props,{activeTab:n,data:a}=this.props.personSettings;t(e.person.id,n,a)};containers={contacts:WN,password:KN,personal:XN,privacy:nO,tools:sO,invitefriends:oO,siteblacklist:lO,peopleblacklist:mO,confirm:pO};render(){const{personSettings:e,handleAddEmail:t,handleConfirmEmail:n,handleDeleteEmail:a,handleSetPrimaryEmail:s}=this.props,o=this.containers;return r.createElement("div",{className:"person-settings"},Object.keys(e.sections).map((i=>{const l=e.sections[i],c=o[i];return!c||l.forDevs&&!pd.isDeveloper()?null:r.createElement(c,{key:i,active:i===e.activeTab,data:e.data[i],errors:e.errors,valid:e.valid,onChangeInput:this.handleChangeInput,onSaveSettings:this.handleSaveSettings,onAddEmail:t,onDeleteEmail:a,onSetPrimaryEmail:s,onConfirmEmail:n,personSettings:e})})))}}uO.propTypes={personSettings:f().object,handleChangeInput:f().func,handleSaveSettings:f().func,handleConfirmEmail:f().func,handleSetPrimaryEmail:f().func,handleAddEmail:f().func,handleDeleteEmail:f().func,app:f().object};const gO=(0,i.$j)((e=>({app:e.app,personSettings:e.personSettings})),(e=>({handleChangeInput:(t,n,a)=>{e(Fg(t,n,a))},handleSaveSettings:(t,n,a)=>{e(((e,t,n)=>async a=>{let s={};if(t?s[t]={...n[t]}:s.about={...n.about},a({type:"PERSON_SETTINGS_SAVE_CHANGES",tabName:t}),"password"===t){if(s.privacy=s.privacy||{},n.password.nextPassword!==n.password.nextPasswordRepeat)return kt.Z.sendSystemMessage("passwordChageError"),void a(Ug({nextPassword:"Несоответстие между паролями",nextPasswordRepeat:"Новые пароли должны быть одинаковыми"}));s.privacy.password=[n.password.oldPassword,n.password.nextPassword]}else if("peopleblacklist"===t){const e={ignore:{people:{},sites:{}}};e.ignore.people=Object.values(s.peopleblacklist).reduce(((e,t)=>[...e,"on"===t.value?{[t.id]:"f"}:{[t.id]:"t"}]),[]),s=e}else if("siteblacklist"===t){const e={ignore:{people:{},sites:{}}};e.ignore.sites=Object.values(s.siteblacklist).reduce(((e,t)=>[...e,"on"===t.value?{[t.id]:"f"}:{[t.id]:"t"}]),[]),s=e}else if("privacy"===t)s.privacy.inviter_person=s.privacy.inviter_person_url;else if("personal"===t){const{userBirthdayYear:e,userBirthdayMonth:t,userBirthday:n}=s.personal,r=1===`${n}`.length?`0${n}`:n,o=1===`${t}`.length?`0${t}`:t;if(s.personal.birthday=r&&o&&e?`${e}-${o}-${r}`:"",s.personal.lastname=s.personal.lastname.trim(),s.personal.name=s.personal.name.trim(),s.personal.name&&!y.Z.isOnlyLettersInStr(s.personal.name))return a(Ug({name:"Имя пользователя должно состоять только из букв"})),!1;if(s.personal.lastname&&!y.Z.isOnlyLettersInStr(s.personal.lastname))return a(Ug({lastname:"Фамилия пользователя должна состоять только из букв"})),!1}else"contacts"===t&&(delete s.contacts.phoneMobile,delete s.contacts.emails);Promise.all([Tt.Z.setPersonSettings(e,s)]).then((async([e])=>{e&&e.result&&"privacy"===t&&"-2"===s.privacy.vislvl.toString()&&(await b.ZP.logout(),window.location.href=`${Rp().mainProto}://${Rp().mainDomain}`),a(Gg(e))})).catch((e=>{kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e}),D.Z.promiseHandler(Bg)(e)}))})(t,n,a))},handleConfirmEmail:t=>{e((e=>()=>Promise.all([Tt.Z.confirmEmail(e)]).then((([e])=>{e.error?kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e.title||kt.Z.systemMessages.saveError}):kt.Z.sendSystemMessage("sendLetter")})).catch((e=>{kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:e}),D.Z.promiseHandler(Bg)(e)})))(t))},handleSetPrimaryEmail:t=>{e((e=>(t,n)=>{const a={...n().personSettings.data.contacts.emails},s=a.default;a.confirmed.push(s),a.default=e,a.pending=a.pending.filter((t=>t!==e)),a.confirmed=a.confirmed.filter((t=>t!==e)),t(jg(a))})(t))},handleAddEmail:t=>{e((e=>(t,n)=>{if(e=e.toLowerCase(),!y.Z.isEmail(e))return kt.Z.sendSystemMessage("incorrectEmail");const a=n(),s={...a?.personSettings?.data?.contacts?.emails||{}},{default:r="",confirmed:o=[],pending:i=[]}=s;if(r.toLowerCase()===e||!o.every((t=>t.toLowerCase()!==e))||!i.every((t=>t.toLowerCase()!==e)))return kt.Z.sendSystemMessage("reservedEmail");i.push(e),s.pending=i.filter(((e,t,n)=>n.indexOf(e)===t)),t(jg(s))})(t))},handleDeleteEmail:t=>{e((e=>(t,n)=>{const a=n(),s={...a?.personSettings?.data?.contacts?.emails||{}},{pending:r=[],confirmed:o=[]}=s;s.pending=r.filter((t=>t!==e)),s.confirmed=o.filter((t=>t!==e)),t(jg(s))})(t))}})))((0,ae.Z)(uO,"personSetting"));
/**
 * Mirtesen.
 *
 * Person Post List Container.
 *
 * @author       Artem Kamysh.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class hO extends r.PureComponent{componentDidMount=()=>{const{app:e,user:t,person:n,personVislvl:a,showPostEditor:s}=this.props;t?.id&&(e.req?.query?.birthday||e.req?.query?.addPost)&&s("default",null,{author:{id:t.id,name:t.display_name,image:t.photo_original||""},target:{type:"user",id:n.id,birthday:n.bdate},personVislvl:a})};_getPostFilter=e=>{switch(e){case"personPhotos":return"USER_POSTS_PHOTO";case"personVideos":return"USER_POSTS_VIDEO";default:return"USER_POSTS_LAST_ALL"}};isCurrentPost(e){const{personPostList:t}=this.props,{currentUserPostId:n}=t;return n===e}render(){const{personPostList:e,page:t,hasMoreItems:n,app:a,user:s,actionModifyPostPopup:o,onShowMorePosts:i,person:l,increaseScrolledPosts:c,personVislvl:m}=this.props,d=parseInt(a?.req?.query?.page||"1",10);let p=0;a.site=a.site||{};const{meta:u}=a,{posts:g=[],currentUserPostId:h}=e,_=a?.req?.deviceType;return r.createElement(r.Fragment,null,r.createElement(zn,{pageStart:0,loadMore:()=>{if(n)return i(a.person.id,{filter:this._getPostFilter(a.page),limit:Rp().postsPerPage,offset:e.nextOffset,currentUserPostId:h||null})},hasMore:n,loader:r.createElement(Yn,null),threshold:400},r.createElement("div",{className:"blog-post-list blog-post-list_person"},pd.isLogged()&&l.canPostToWall&&r.createElement(BI,{identifier:"default",author:{id:s.id,name:s.display_name,image:s.photo_original||""},target:{type:"user",id:l.id,birthday:l.bdate},params:{showHoliday:!0,showPoll:!0},topicList:Cd.listTopics.filter((e=>e.theme)),personVislvl:m}),g?.length<1&&!n&&r.createElement("article",{className:"blog-post blog-post__no-posts",key:0},"Здесь пока ничего нет"),g.length>0&&g.map((e=>{if(o.approveList[e.id])return null;p++;const t=p%Rp().postsPerPage==0,n=d-1+Math.floor(p/Rp().postsPerPage),a=this.isCurrentPost(e.id);return r.createElement(dE,{key:p},(p+1)%3==0&&r.createElement("div",{className:"adfox-outer blog-post-list__ad-block"},"phone"!==_?r.createElement(Fh,{type:"Politpiar",id:99818}):r.createElement(Fh,{type:"Politpiar",id:99813})),r.createElement(HS,{post:e,isCurrentPost:a,showCommentWidget:a,onPostAppear:c,pageTitle:u.title,postLabelEnabled:!0}),t&&r.createElement(Rb,{id:n,initialPage:d,threshold:.5}))})))),r.createElement(kT,{hasMoreItems:n,page:t,url:a.originalUrl}),r.createElement(ty,null),r.createElement(Jb,null))}}hO.propTypes={personPostList:f().object,person:f().object,hasMoreItems:f().bool,onShowMorePosts:f().func,page:f().number,title:f().string,siteBuilder:f().object,app:f().object,user:f().object,personVislvl:f().string,actionModifyPostPopup:f().object,increaseScrolledPosts:f().func,showPostEditor:f().func};const _O=(0,i.$j)((e=>({title:e.personPostList.title,personPostList:e.personPostList,hasMoreItems:e.personPostList.hasMoreItems,actionModifyPostPopup:e.actionModifyPostPopup,page:e.personPostList.page,app:e.app,user:e.auth.user,person:e.app.person,personVislvl:e.personSettings.vislvl})),(e=>({onShowMorePosts:(t,n)=>{e(((e,t,n=!1)=>(a,s)=>{const r=s(),o=r.personPostList.posts;let{page:i}=r.personPostList;vt.default.getPersonFeed({userId:e,...t}).then((e=>{if(e){const{items:t=[]}=e;a({type:"PERSON_POST_LIST_SET_LIST_DATA",hasMoreItems:t?.length>=(Rp().postsPerPage||20),page:++i,nextOffset:e.nextOffset,posts:n?[...o,...t]:t})}})).catch(D.Z.promiseHandler("/index.js"))})(t,n,!0))},increaseScrolledPosts:()=>e(gc()),showPostEditor:(t,n,a)=>{e(Rt(t,n,a))}})))(hO);
/**
 * Mirtesen.
 *
 * Person Wall Container.
 *
 * @author       Andrei Klevko.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class EO extends r.Component{render(){return r.createElement("div",{className:"person-wall"},r.createElement(_O,null))}}const fO=(0,ae.Z)((0,ae.Z)((0,ae.Z)(EO,"personWall")));
/**
 * Mirtesen.
 *
 * Person Blogposts List Container.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class bO extends r.PureComponent{render(){const{publications:e,app:t,onShowMore:n,hasMoreItems:a,page:s,increaseScrolledPosts:o}=this.props,i=Rp().postsPerPage,l=i+(s-1)*i;t.site=t.site||{};const c=parseInt(t?.req?.query?.page||"1",10);let m=0;return r.createElement(zn,{pageStart:0,loadMore:()=>{if(a)return n(i,l)},hasMore:a,loader:r.createElement(Yn,null),threshold:400},r.createElement("div",{className:"blog-post-list blog-post-list_person"},e.length<1&&!a&&r.createElement("article",{className:"blog-post blog-post__no-posts",key:0},"Здесь пока ничего нет"),e.length>0&&e.map((e=>{m++;const t=m%Rp().postsPerPage==0,n=c-1+Math.floor(m/Rp().postsPerPage);return r.createElement(r.Fragment,{key:e.id},r.createElement(dE,{tag:"article",className:"blog-post blog-post__publication"},r.createElement(HS,{post:e,onPostAppear:o})),t&&r.createElement(Rb,{id:n,initialPage:c,threshold:.5}))})),r.createElement(kT,{hasMoreItems:a,page:s,url:t.originalUrl}),r.createElement(Jb,null)))}}bO.propTypes={app:f().object,onShowMore:f().func,count:f().number,page:f().number,hasMoreItems:f().bool,className:f().string,publications:f().array,children:f().object,increaseScrolledPosts:f().func};const yO=(0,i.$j)((e=>({app:e.app,publications:e.personPublications.publications,hasMoreItems:e.personPublications.hasMoreItems,page:e.personPublications.page})),(e=>({onShowMore:(t,n)=>{e(((e,t)=>(n,a)=>{const s=a(),r=s.app.userId;let{page:o}=s.personPublications;Promise.resolve(vt.default.getPublications(r,e,t)).then((t=>{t&&(t.forEach((e=>{e.image=e.img})),n({type:"PERSON_PUBLICATIONS_LIST_GET",publications:[...s.personPublications.publications,...t],page:++o,hasMoreItems:t.length>=e}))})).catch(D.Z.promiseHandler("/index.js"))})(t,n))},increaseScrolledPosts:()=>e(gc())})))((0,ae.Z)(bO,"PersonPublications"));var vO="/index.js";
/**
 * Mirtesen.
 *
 * Person friends actions.
 *
 * @author       Artem Kamysh.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */const TO=()=>async(e,t)=>{const n=t(),{search:a,tab:s,tabData:r}=n.personFriends,o=n?.app?.person?.id,i=50*r[s].page;try{e(SO(!0));const t=await PO(o,s,{search:a,offset:i,limit:50}),l=await Tt.Z.getUsersRelationStatus(t.map((e=>e.id)));return e({type:"PERSON_RELATIONSHIPS_SET_LIST",userFriendship:{...n.userFriendship,...l}}),r[s]={...r[s],data:[...r[s].data,...t],hasMore:t.length>0,page:r[s].page+1},e(SO(!1)),e({type:"FRIENDS_LIST_GET",tabData:r})}catch(t){e(SO(!1)),D.Z.promiseHandler(vO)(t)}},SO=e=>({type:"FRIENDS_LIST_TOGGLE_PROCESS",value:e}),PO=async(e,t,n={})=>{const{search:a,offset:s,limit:r,res:o}={search:null,res:void 0,offset:0,limit:20,...n};let i=null,l=null;switch(t){case"incoming-requests":l=await jI.getFriendshipRequests(n),l=l||[],l.map((e=>{"INCOME"===e.type.toUpperCase()&&(i=e.items)}));break;case"outgoing-requests":l=await jI.getFriendshipRequests(n),l=l||[],l.map((e=>{"OUTCOME"===e.type.toUpperCase()&&(i=e.items)}));break;case"recommended":i=await jI.getPymk(r,s,n);break;default:i=a?await fp.Z.search(a,"FRIENDS",{offset:s,count:r,scope:"friends",userId:e,res:o}):await Tt.Z.getPersonFriends(e,r,s,n)}return i||[]},wO=(0,r.memo)((({personFriends:e,onShowMoreFriends:t,pageOwnerId:n,authUserId:a,handleSearch:s,changeFriendMenu:o,setPymkStatus:i})=>{const{search:l,tab:c,tabData:m,inProcess:d}=e,p=e=>{window.history.pushState(null,"",m[e].url.replace("[MT_USER_ID]",n)),document.title=m[e].meta.title,document.description=m[e].meta.description,o(e)},u=m[c].data,g=m[c].hasMore;return r.createElement("div",null,r.createElement("div",{className:"people-list-header"},(t=>{const s=e.tabData,o=[];return Object.keys(s).forEach((e=>{const i=s[e];e===t?o.push(r.createElement("li",{className:"people-list-header__menu-title",key:t},r.createElement("h1",{id:`people-list-header-menu-item-${e}`},s[t].title),i.count>0&&r.createElement("i",null,"(",K.Z.format99Plus(i.count),")"),i.tooltip&&r.createElement(lt,{target:`people-list-header-menu-item-${e}`,content:i.tooltip,placement:"top",offset:[0,8]}))):e!==t&&n===a&&o.push(r.createElement("li",{className:"people-list-header__menu-item",key:e},r.createElement("a",{href:i.url.replace("[MT_USER_ID]",n),id:`people-list-header-menu-item-${e}`,onClick:t=>{t.preventDefault(),p(e)}},r.createElement("span",{className:"ellipsis"},i.title),i.count>0&&r.createElement("i",null,"(",K.Z.format99Plus(i.count),")")),i.tooltip&&r.createElement(lt,{target:`people-list-header-menu-item-${e}`,content:i.tooltip,placement:"top",offset:[0,8]})))})),r.createElement("ul",{className:"mt-horizontal-menu"},o)})(c)),"friends"===c&&r.createElement("div",{className:"people-list-navbar"},r.createElement(Jn,{defaultValue:l,handleSearch:s,searchUrl:`/people/${n}/friends`}),r.createElement("div",{className:"people-list-navbar_empty"})),r.createElement(zn,{pageStart:0,loadMore:()=>{if(g&&!d)return t()},hasMore:g,loader:r.createElement(Yn,null),threshold:500},u.length<1&&!g&&r.createElement("div",{className:"infinite-scroll-empty"},"Здесь пока ничего нет"),"recommended"===c&&r.createElement(YI,{userList:u,onAdd:e=>{i(e,"add")},onDelete:e=>{i(e,"delete")},addButtonText:"Дружить"}),"recommended"!==c&&r.createElement(Ub,null,r.createElement(Bb,{peopleList:u}))))}));wO.propTypes={pageOwnerId:f().number,authUserId:f().number,personFriends:f().object,onShowMoreFriends:f().func,handleSearch:f().func,changeFriendMenu:f().func,setPymkStatus:f().func};const IO=(0,i.$j)((e=>({personFriends:e.personFriends||[],pageOwnerId:e.app?.person?.id,authUserId:e.auth?.user?.id||null})),(e=>({onShowMoreFriends:()=>{e(TO())},handleSearch:t=>{e((e=>(t,n)=>{const a=n(),{tabData:s}=a.personFriends;return s.friends={...s.friends,data:[],hasMore:!0,page:0},t({type:"FRIENDS_LIST_NEW_SEARCH",search:e,tabData:s}),t(TO())})(t))},changeFriendMenu:t=>{e((e=>t=>{t({type:"FRIENDS_LIST_CHANGE_FRIEND_MENU",tab:e})})(t))},setPymkStatus:(t,n)=>{e(((e,t)=>async n=>{try{await jI.setPymkStatus(e,t)?(n({type:"FRIENDS_LIST_SET_PYMK_STATUS",id:e}),"add"===t&&kt.Z.sendSystemMessage("addFriend")):kt.Z.sendSystemMessage("exception")}catch(e){D.Z.promiseHandler(vO)(e)}})(t,n))}})))((0,ae.Z)(wO,"personFriends"));
/**
 * Mirtesen.
 *
 * Person Comment List Component
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class CO extends r.PureComponent{getHeader=e=>{const t=this.getHeaderData(e),n="foreign_obj"===e.post_type||"ext_resource_obj"===e.post_type;return r.createElement("div",{className:"person-comments__post__header"},r.createElement("div",{className:_()({"blog-post__repost__wrapper":!0,"blog-post__foreign_site":n})},r.createElement("div",{className:"blog-post__repost__content"},r.createElement("div",{className:"blog-post__author"},r.createElement("div",{className:"blog-post__author-avatar-wrapper"},r.createElement(Mn.Z,{logoInfo:{userName:t.fromName,logoImg:t.photo_original,logoClassName:"userlogo_xxm",logoUrl:y.Z.fixProtocol(t.fromUrl||""),linkTarget:"_blank"}}),n&&r.createElement("a",{href:y.Z.fixProtocol(t.fromUrl),className:"blog-post__author-avatar",target:"_blank"},r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18.01 24.01"},r.createElement("title",null,"Asset 2"),r.createElement("g",{id:"Layer_2","data-name":"Layer 2"},r.createElement("g",{id:"Layer_1-2","data-name":"Layer 1"},r.createElement("path",{className:"cls-1",d:"M5.91,23A8.47,8.47,0,0,1,0,14.88,8.21,8.21,0,0,1,3.51,8.36,13,13,0,0,0,8.47,0a13,13,0,0,1,3.64,12.28,5.23,5.23,0,0,0,3.51-5.42s3.25,4.45,2.18,9.72A13.75,13.75,0,0,1,13.91,24a13.5,13.5,0,0,1-7.19-9.42A8.14,8.14,0,0,0,5.91,23Z"})))))),r.createElement("div",{className:"blog-post__author-name-with-time"},r.createElement("a",{href:`//${t.fromUrl}`,target:"_blank",className:"blog-post__author-name"},t.fromName,t.isAuthenticAccount&&r.createElement(dy,{color:"dark"})),r.createElement("div",{className:"blog-post__author-time"},r.createElement("a",{className:"blog-post__pubdate",href:`//${t.postUrl}`},this.getFormattedDate(t))))),r.createElement("div",{className:"blog-post__description"+(t.preview?"":" blog-post__description_disabled")},r.createElement("a",{href:`//${t.postUrl}`,target:"_blank",dangerouslySetInnerHTML:{__html:y.Z.disinfection(t.preview)||"Предпросмотр недоступен"}})))))};getHeaderData=e=>{let t=null;switch(e.post_type){case"blog_post":return{...e.blog_post.group,postUrl:(e?.blog_post?.seo_url||"").replace("//",""),fromUrl:(e?.blog_post?.group?.url||"").replace("//",""),fromName:e?.blog_post?.group?.display_name,formattedDates:e?.blog_post?.formattedDates,preview:e?.blog_post?.title||e?.blog_post?.preview_text};case"user_post":return{...e?.blog_post?.from||{},postUrl:(e?.blog_post?.url||"").replace("//",""),fromUrl:(e?.blog_post?.from?.url||"").replace("//",""),fromName:e?.blog_post?.from?.display_name||"",formattedDates:e?.blog_post?.formattedDates||{},preview:e?.blog_post?.title||e?.blog_post?.preview_text};case"foreign_obj":case"ext_resource_obj":return t=this.getForeignSite(e.blog_post.url),{...e.blog_post||{},postUrl:(e?.blog_post?.url||"").replace("//",""),fromUrl:t?.url,fromName:t?.title,className:t?.className,preview:(e?.blog_post?.url||"").replace("//","")};default:return{}}};getForeignSite=e=>{const t={title:"",url:"",className:""};return(/video\.mirtesen\.ru/.test(e)||/videos\/user\/video/.test(e))&&(t.title="Миртесен.Видео",t.url="video.mirtesen.ru",t.className="person-comments__video-mt"),t};getFormattedDate=e=>{const t=e.formattedDates.iso;return t&&y.Z.isPastYear(t)?r.createElement(s_,{date:t,format:"DD.MM.YYYY в H:mm"}):r.createElement(s_,{date:t,format:"D MMMM, H:mm"})};render(){const{commentsInfo:e,comments:t}=this.props;return r.createElement("div",{key:e.id,className:"person-comments__post"},this.getHeader(e),r.createElement("div",{className:"person-comments__post__content"},r.createElement(Mn.Z,{logoInfo:{userName:e.user?.display_name,logoImg:e.user?.photo_original,logoClassName:"userlogo_xm",logoUrl:y.Z.fixProtocol(e.user?.url),linkTarget:"_blank"}}),r.createElement("div",{className:"person-comments__content person-comment"},t.map((e=>r.createElement("div",{key:e.id,className:"person-comment"},r.createElement("div",{className:"person-comment__pubdate"},r.createElement("a",{className:"person-comment__comment-date",href:`//mirtesen.ru/action/comments/${e.id}`,target:"_blank"},this.getFormattedDate(e)),e.reply_to_user&&r.createElement("div",{className:"person-comment__reply-to-user"},r.createElement("svg",{className:"svg"},r.createElement("use",{href:"/images/icons.svg#angle-right"})),r.createElement("a",{target:"_blank",href:e.reply_to_user.url},e.reply_to_user.display_name))),r.createElement("div",{className:"person-comment__content-wrap"},r.createElement("div",{className:"person-comment__content"},r.createElement("a",{target:"_blank",href:`//mirtesen.ru/action/comments/${e.id}`},r.createElement("span",{dangerouslySetInnerHTML:{__html:zp.Z.plain2html(e.text)}})),e.attachments&&r.createElement("a",{className:"person-comment__attachments",target:"_blank",href:`//mirtesen.ru/action/comments/${e.id}`},r.createElement("img",{alt:"Прикрепленное изображение",src:e.attachments[0].photo.photo_original}))),e.likes&&r.createElement(l_,{likes:e.likes.count}))))))))}}CO.propTypes={commentsInfo:f().object,comments:f().array};const NO=CO;
/**
 * Mirtesen.
 *
 * Person comments.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class OO extends r.PureComponent{appendComments=(e,t)=>{let n=0;const a=[],s={};for(const o in e)if({}.hasOwnProperty.call(e,o)){if(!e[o][0].blog_post.url&&!e[o][0].blog_post.seo_url)continue;if(void 0!==e[o]){e[o].filter((e=>e.images&&e.images.length)).forEach((e=>{s[e.id]=e.images.map((e=>({src:e.url})))})),n++;const i=n%Rp().recordsPerPage==0,l=t-1+Math.floor(n/Rp().recordsPerPage),c=i?r.createElement(r.Fragment,{key:o},r.createElement(NO,{commentsInfo:e[o][0],comments:e[o]}),r.createElement(Rb,{id:l,initialPage:t,threshold:.5})):r.createElement(NO,{key:o,commentsInfo:e[o][0],comments:e[o]});a.push(c)}}return a};render(){const{personComments:e,onShowMore:t,app:n}=this.props,{comments:a,page:s,hasMoreItems:o}=e,i=Rp().recordsPerPage,l=i+(s-1)*i,c=parseInt(n?.req?.query?.page||"1",10),m=this.appendComments(a.items,c);return r.createElement(r.Fragment,null,r.createElement(zn,{pageStart:0,loadMore:()=>{if(o)return t(l,i)},hasMore:o,loader:r.createElement(Yn,null),threshold:500},!m.length&&!o&&r.createElement("article",{className:"blog-post blog-post__no-posts",key:0},"Здесь пока ничего нет"),r.createElement("div",{className:"person-comments"},r.createElement("div",{className:"person-comments__outer"},m))))}}OO.propTypes={personComments:f().object,page:f().number,onShowMore:f().func,app:f().object};const MO=(0,i.$j)((e=>({personComments:e.personComments,app:e.app})),(e=>({onShowMore:(t,n)=>e(((e,t)=>(n,a)=>{const s=a(),r=s.app.userId,{page:o,comments:i,lastId:l}=s.personComments;Promise.resolve(Tt.Z.getLastPersonComments({personId:r,count:t,offset:e,fromMessageId:l}).then((e=>{const a={...i.items};for(const t in e.items)a[t]?a[t].push(e.items[t]):a[t]=e.items[t];return n({type:"PERSON_COMMENTS_LIST_GET",comments:{count:e.count,total:e.total,items:a},page:o+1,hasMoreItems:e.count>=t,lastId:e.lastId})})).catch(D.Z.promiseHandler("/index.js")))})(t,n))})))((0,ae.Z)(OO,"personComments"));
/**
 * Mirtesen.
 *
 * Person places component.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class kO extends r.PureComponent{getEventsByMonth=()=>{const{events:e}=this.props.personEvents,t=[];return this.getSortedMonths().forEach((n=>{const a="today"===n,s=a?e.todayBirthdays:e.byMonthBirthdays[n];s&&s.length&&t.push(r.createElement("div",{className:"person-events__month",key:n},r.createElement("div",{className:"person-events__month-title"},r.createElement("span",null,a&&e.todayBirthdays.length?"сегодня":this.monthNameByMonthNum(parseInt(n,10)))),r.createElement("div",{className:"person-events__persons"},s.map((e=>this.getEventPersons(e.personList))))))})),t};getEventPersons=e=>{const t=[];if(Array.isArray(e))return e.map((e=>{const n=e.bdate.slice(0,-5).replace("-",".");t.push(r.createElement("div",{className:"person-events__person-wrap",key:e.id},r.createElement("div",{className:"person-events__user-photo-wrap"},r.createElement(Mn.Z,{logoInfo:{userName:e.display_name,logoImg:e.photo_original,logoUrl:e.url,logoClassName:"userlogo_m person-events__user-photo"}})),r.createElement("span",{className:"person-events__user-info"},e.display_name," (",n,")")))})),t};getSortedMonths=()=>{const e=["today"];let t=!1;const n=(new Date).getMonth()+1;for(let a=n;a<=12&&(a!==n||!t);a++)e.push(this.toTwoDigitMonth(a)),12===a&&(a=0,t=!0);return e};monthNameByMonthNum=e=>{const t={1:"январь",2:"февраль",3:"март",4:"апрель",5:"май",6:"июнь",7:"июль",8:"август",9:"сентябрь",10:"октябрь",11:"ноябрь",12:"декабрь"};return e===(new Date).getMonth()+1?`${t[e]} - позже в этом месяце`:t[e]};toTwoDigitMonth=e=>e<10?"0".concat(e):e.toString(10);render(){const{personEvents:e,onShowMore:t}=this.props,{hasMoreItems:n,nextMonth:a}=e,s=r.createElement("div",{className:"blog-post-list__loader"},r.createElement("img",{className:"blog-post-list__loader-img",src:"//static.mtml.ru/images/loader.svg",alt:"Загружается..."}));return r.createElement(r.Fragment,null,r.createElement(zn,{pageStart:0,loadMore:()=>{t(a)},hasMore:n,loader:s,threshold:500},r.createElement("div",{className:"person-events"},r.createElement("div",{className:"person-events__title"},"Дни рождения ваших друзей"),r.createElement("div",{className:"person-events__wrap"},this.getEventsByMonth()))))}}kO.propTypes={personEvents:f().object,page:f().number,onShowMore:f().func,hasMoreItems:f().bool};const AO=(0,i.$j)((e=>({personEvents:e.personEvents})),(e=>({onShowMore:t=>e(((e,t=!0)=>(n,a)=>{const s=a().personEvents.events;Tt.Z.getPersonEvents(e).then((a=>{const r={todayBirthdays:a.todayBirthdays,byMonthBirthdays:{...s.byMonthBirthdays,...a.byMonthBirthdays}};void 0!==a&&n({type:"PERSON_EVENTS_GET",events:t?r:a,nextMonth:e<12?++e:1})})).catch(D.Z.promiseHandler("/index.js"))})(t))})))((0,ae.Z)(kO,"personEvents"));
/**
 * Mirtesen.
 *
 * Private Media Container.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class xO extends r.PureComponent{componentDidMount(){const{initialData:e,initState:t}=this.props;e&&t(e)}render(){const{personPrivateMedia:e}=this.props,t=e.items||[];return r.createElement("div",{className:"person-private-media"},r.createElement("div",{className:"person-private-media__outer"},t.map(((e,t)=>r.createElement("div",{className:"person-private-media__item media-item",key:t},r.createElement("a",{className:"media-item__photo",href:e.link,target:"_blank"},r.createElement("img",{src:e.src}),r.createElement("span",{className:"media-item__item-info"})))))))}}xO.propTypes={initialData:f().object,initState:f().func,personPrivateMedia:f().object};const LO=(0,i.$j)((e=>({personPrivateMedia:e.personPrivateMedia})),(e=>({initState:(t,n)=>{e(((e,t="photo")=>n=>n({type:"PERSON_PRIVATE_MEDIA_LIST_GET",...e,itemsType:t}))(t,n))}})))((0,ae.Z)(xO,"PersonPrivateMedia"));
/**
 * Mirtesen.
 *
 * Person Profile Container.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class DO extends r.PureComponent{prepareLink=e=>/^(http[s]?:\/\/(www\.)?|ftp:\/\/(www\.)?|www\.){1}([0-9A-Za-z-\.@:%_\+~#=]+)+((\.[a-zA-Z]{2,3})+)(\/(.)*)?(\?(.)*)?/g.test(e)?r.createElement("a",{href:e,target:"_blank"},e):e;render(){const{app:e,personProfile:t}=this.props,n=e.person,a=n.profileInfo||{},s=t.friends,o=t.sites,i=L()(t,"photos.items",[]),l=L()(t,"photos.hasMoreItems"),c=L()(t,"videos.items",[]),m=L()(t,"videos.hasMoreItems");return r.createElement(r.Fragment,null,r.createElement("div",{className:"person-profile"},r.createElement("div",{className:"person-profile__outer"},r.createElement("div",{className:"person-profile__person-info"},pd.canEditProfile()&&r.createElement("a",{href:"/settings",className:"person-profile__person-settings"},r.createElement(yn.Z,{iconName:"settings"})),n.description&&r.createElement("div",{className:"person-profile__person-about"},r.createElement("span",{className:"person-info__title"},"О пользователе ",e.person.first_name),r.createElement("span",null,this.prepareLink(n.description))),r.createElement("div",{className:"person-info__common-info person-info"},r.createElement("div",{className:"person-info__title"},r.createElement("span",null,"Общие сведения")),r.createElement("div",{className:"person-info__content"},n.bdate&&r.createElement("div",null,r.createElement("span",{className:"person-info__subtitle"},"Дата Рождения"),r.createElement("span",{className:"person-info__item-content"},n.bdate,", ",y.Z.formatBdate(n.bdate))),n.sex&&r.createElement("div",null,r.createElement("span",{className:"person-info__subtitle"},"Пол"),r.createElement("span",{className:"person-info__item-content"},2===n.sex?"Мужской":"Женский")),a.education&&r.createElement("div",null,r.createElement("span",{className:"person-info__subtitle"},"Образование"),r.createElement("span",{className:"person-info__item-content"},a.education)),a.maritalStatus&&r.createElement("div",null,r.createElement("span",{className:"person-info__subtitle"},"Семейное положение"),r.createElement("span",{className:"person-info__item-content"},a.maritalStatus)),a.residence&&r.createElement("div",null,r.createElement("span",{className:"person-info__subtitle"},"Местоположение"),r.createElement("span",{className:"person-info__item-content"},a.residence)),a.career&&r.createElement("div",null,r.createElement("span",{className:"person-info__subtitle"},"Карьера"),(b_()(a.career)?[a.career]:a.career).map(((e,t)=>r.createElement("span",{key:t,className:"person-info__item-content",title:"Карьера"},e)))))),(a.phones||a.emails)&&pd.canEditProfile()&&r.createElement("div",{className:"person-info__contact-info person-info"},r.createElement("div",{className:"person-info__title"},"Контактная информация"),r.createElement("div",{className:"person-info__content"},a.phones&&r.createElement("div",null,r.createElement("span",{className:"person-info__subtitle"},"Телефоны"),r.createElement("div",{className:"person-info__content__right-column"},(b_()(a.phones)?[a.phones]:a.phones).map(((e,t)=>r.createElement("span",{key:t},e))))),a.emails&&r.createElement("div",null,r.createElement("span",{className:"person-info__subtitle"},"Email"),r.createElement("div",{className:"person-info__content__right-column"},(b_()(a.emails)?[a.emails]:a.emails).filter((e=>"STATUS_ACTIVE"===e.status)).map(((e,t)=>r.createElement("span",{key:t},e.email))))))),!!a.links.length&&r.createElement("div",{className:"person-info__contact-info person-info"},r.createElement("div",{className:"person-info__title"},"ВЕБ-САЙТЫ И СОЦИАЛЬНЫЕ СЕТИ"),r.createElement("div",{className:"person-info__content"},r.createElement("div",null,r.createElement("span",{className:"person-info__subtitle"},"Веб-сайты"),r.createElement("div",{className:"person-info__content__right-column"},(b_()(a.links)?[a.links]:a.links).map(((e,t)=>r.createElement("a",{href:e,key:t},e))))))))),Array.isArray(s.items)&&s.items.length>0&&r.createElement("div",{className:"person-profile__outer"},r.createElement("div",{className:"person-profile__person-friends person-friends"},r.createElement("a",{className:"person-info__title",target:"_blank",href:`/people/${e.userId}/friends`},"Друзья(",e.person.count_friends,")"),r.createElement(Ub,null,r.createElement(Bb,{peopleList:s.items}),s.hasMoreItems&&r.createElement("a",{className:"person-profile__see-all",href:`/people/${e.userId}/friends/`},"Посмотреть все")))),!!o.items&&!!o.items.length&&r.createElement("div",{className:"person-profile__outer"},r.createElement("div",{className:"person-profile__person-sites"},r.createElement("a",{className:"person-info__title",target:"_blank",href:`/people/${e.userId}/sites`},"Сайты(",e.person.count_sites,")"),r.createElement(Ub,null,o.items.map((e=>r.createElement(OI,{key:e.id,group:e}))),o.hasMoreItems&&r.createElement("a",{className:"person-profile__see-all",href:`/people/${e.userId}/sites/`},"Посмотреть все")))),!!i.length&&r.createElement("div",{className:"person-profile__outer"},r.createElement("div",{className:"person-profile__person-photos person-photos"},r.createElement("a",{href:`/people/${e.userId}/photos/`,target:"_blank",className:"person-info__title"},r.createElement("span",null,"Фото")),r.createElement(LO,{initialData:{items:i,hasMorePhotos:!1}})),l&&r.createElement("a",{className:"person-profile__see-all",href:`/people/${e.userId}/photos/`},"Посмотреть все")),!!c.length&&r.createElement("div",{className:"person-profile__outer"},r.createElement("div",{className:"person-profile__person-videos"},r.createElement("a",{href:`/people/${e.userId}/videos/`,className:"person-info__title",target:"_blank"},r.createElement("span",null,"Видео")),r.createElement("div",{className:"person-videos"},r.createElement("div",{className:"person-videos__outer"},c.map(((e,t)=>r.createElement("div",{className:"person-videos__video",key:t},r.createElement("span",{dangerouslySetInnerHTML:{__html:e.attachments.filter((e=>e.video))[0].video.player_html}}))))))),m&&r.createElement("a",{className:"person-profile__see-all",href:`/people/${e.userId}/videos/`},"Посмотреть все"))))}}DO.propTypes={personProfile:f().object,app:f().object};const RO=(0,i.$j)((e=>({app:e.app,personProfile:e.personProfile})),(e=>({})))((0,ae.Z)(DO,"personProfile"));
/**
 * Mirtesen.
 *
 * InfiniteScrollShowMore implementation for React.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class ZO extends r.PureComponent{render(){const{pageOffset:e,maxPageOffset:t,url:n,page:a,hasMoreItems:s}=this.props;let o="";if(o="undefined"!=typeof window?window.location.href:n,e>=t){const e="page="+(a+1),t=/page=\d+/i;o=o.replace(t,"").replace("?&","?").replace(/(&|\?)+$/,""),-1!==o.indexOf("?")?o+="&"+e:o+="?"+e}return r.createElement(r.Fragment,null,e>=t&&s&&r.createElement("div",{className:"infinite-show-more"},r.createElement("a",{className:"btn",href:o},"Показать еще")))}}ZO.propTypes={hasMoreItems:f().bool,page:f().number,pageOffset:f().number,maxPageOffset:f().number,url:f().string};const BO=ZO;
/**
 * Mirtesen.
 *
 * Inputs generator.
 *
 * @author       Artem Kamysh.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class $O extends r.PureComponent{render(){const{personSites:e,onShowMoreSites:t,app:n}=this.props,{sites:a,page:s,hasMoreItems:o,pageOffset:i,currentUrl:l}=e,c=parseInt(n?.req?.query?.page||"1",10),m=Rp().recordsPerPage,d=m+(s-1)*m;let p=0;return r.createElement(r.Fragment,null,r.createElement(zn,{pageStart:0,loadMore:()=>{o&&t(m,d)},hasMore:o&&i<20,loader:r.createElement(Yn,null),threshold:500},r.createElement("div",{className:"person-friends"},r.createElement("h2",{className:"person-friends__title"},"Подписки на сайты"),r.createElement(Ub,null,a&&a.map((e=>{p++;const t=p%m==0,n=c-1+Math.floor(p/m);return r.createElement(r.Fragment,{key:e.id},r.createElement(OI,{group:e}),t&&r.createElement(Rb,{id:n,initialPage:c,threshold:.5}))}))))),r.createElement(BO,{hasMoreItems:o,pageOffset:i,maxPageOffset:20,url:l,page:s}))}}$O.propTypes={personSites:f().object,page:f().number,onShowMoreSites:f().func,app:f().object};const UO=(0,i.$j)((e=>({personSites:e.personSites,app:e.app})),(e=>({onShowMoreSites:(t,n)=>e(((e,t)=>(n,a)=>{const s=a(),r=s.app.userId;let{page:o,pageOffset:i}=s.personSites;Promise.resolve(Tt.Z.getPersonSites(r,e,t)).then((t=>n({type:"PERSON_GET_SITE_LIST",sites:[...s.personSites.sites,...t],page:++o,pageOffset:++i,hasMoreItems:t.length>=e}))).catch(D.Z.promiseHandler("/index.js"))})(t,n))})))((0,ae.Z)($O,"PersonSites")),HO=(0,r.memo)((({consolidationCode:e})=>r.createElement("div",{className:"account-consolidation"},r.createElement("h2",{className:"account-consolidation__title"},"Объединение аккаунтов"),r.createElement("p",null,"Если вы заходили ранее на сайт МирТесен через стороннюю соцсеть, а в ",r.createElement("a",{href:"https://info.mirtesen.ru/apps",target:"_blank"},"приложении МирТесен")," зарегистрировали новый аккаунт, то для объединения ваших профилей выполните следующие шаги:"),r.createElement("ol",null,r.createElement("li",null,"Нажмите, чтобы скопировать, или запомните код, который здесь крупно выведен:",r.createElement(Ka,{classes:"account-consolidation__code",text:e.toString()},e.toString())),r.createElement("li",null,"Зайдите в приложение МирТесен ",">"," Настройки ",">"," Объединение аккаунтов."),r.createElement("li",null,"Введите данный 4-значный код в поле, указанное в ",r.createElement("a",{href:"https://info.mirtesen.ru/apps",target:"_blank"},"приложении МирТесен"),".")))));HO.propTypes={consolidationCode:f().number};const FO=(0,i.$j)((({accountConsolidation:e})=>({consolidationCode:e})))((0,ae.Z)(HO,"accountConsolidation"));
/**
 * Mirtesen.
 *
 * Unsubscribe.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class jO extends r.Component{render(){const{pageOwnerId:e,friendshipStatus:t,onUnsubscribeUser:n}=this.props,a=["friend","fellow","confederate","opponent"],s=t.filter((e=>a.indexOf(e)>-1));return r.createElement("div",{className:"unsubscribe"},s.length>0&&r.createElement(r.Fragment,null,r.createElement("p",null,"Нажмите на кнопку, чтобы больше не получать уведомления на почту."),r.createElement("button",{type:"button",className:"unsubscribe__btn",onClick:()=>n(e)},"Отписаться")),s.length<1&&r.createElement("p",{className:"usubscribe__message"},"Вы успешно отписаны."))}}jO.propTypes={pageOwnerId:f().number,friendshipStatus:f().array,onUnsubscribeUser:f().func};const GO=(0,i.$j)((({app:e,userFriendship:t})=>{const n=L()(e,"person.id",null);return{pageOwnerId:n,friendshipStatus:L()(t,`${n}.friendshipStatus`,[])}}),(e=>({onUnsubscribeUser:t=>{e(su(t))}})))((0,ae.Z)(jO,"unsubscribyByEmail"));var qO="/index.js";
/**
 * Mirtesen.
 *
 * User interests actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2022, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
*/const VO=e=>({type:"USER_INTERESTS_TOGGLE_PROCESS",value:e}),zO=(e,t,n)=>async a=>{a(VO(!0));try{const s=await qa.Z.setInterest(t,e.id,n);a(VO(!1)),s?a({type:"USER_INTERESTS_ADD_INTEREST",interest:{id:e.id,type:t,value:n}}):kt.Z.sendSystemMessage("exception")}catch(e){a(VO(!1)),D.Z.promiseHandler(qO)(e)}},WO=e=>({type:"USER_INTERESTS_TOGGLE_SEARCH",isActive:e}),YO=e=>({type:"USER_INTERESTS_TOGGLE_SEARCH_PROCESS",value:e}),KO=({label:e="",icon:t,emoji:n,isCompact:a,disabled:s,selected:o,onClick:i})=>{const l={"interest-btn":!0,"interest-btn_selected":!0===o,"interest-btn_ignored":!1===o};return r.createElement(He.Z,{type:"button",label:Pa.Z.stripGeoId(e),color:"empty",extraClasses:_()(l),emoji:t?void 0:n,icon:t,isCompact:a,disabled:s,onClick:i,rounded:!0})},JO=(0,r.memo)(KO),XO=e=>{switch(e){case!0:return"check";case!1:return"close";default:return}},QO=({title:e,activeTab:t,list:n,interests:a,showFilter:s,type:o,onInterestButtonClick:i})=>{const[l,c]=(0,r.useState)(!1),m=l?n.filter((e=>void 0!==a[e.id])):n;return r.createElement("section",{className:"interests-list"},r.createElement("header",{className:"interests-list__header"},r.createElement("h2",{className:"interests-list__title"},e),s&&!Sa()(a)&&r.createElement(He.Z,{appearance:"link",color:"primary",label:l?"Показать все":"Показать выбранные",extraClasses:"interests-list__filter",onClick:()=>c((e=>!e))})),r.createElement("ul",{className:"interests-list__items"},m.map((e=>{const n=((e,t)=>"selected"===e&&!1===t||"ignored"===e&&!0===t)(t,a?.[e.id]);return r.createElement("li",{className:"interests-list__item",key:e.id},r.createElement(JO,{label:e.text,disabled:n,selected:a?.[e.id],emoji:e.icon,icon:"tag"===o?void 0:XO(a?.[e.id]),onClick:()=>{n||i(e,o,t,a?.[e.id])}}))}))))},eM=(0,r.memo)(QO),tM=({handleSearch:e,searchUrl:t="",placeholder:n="Поиск",extraClasses:a="",onHideSearch:s,onShowSearch:o,showQueryInUrl:i})=>{const[l,c]=(0,r.useState)(!1);return r.createElement("div",{className:_()("serach-input-switcher",a)},!l&&r.createElement("button",{className:"search-input-switcher__on",onClick:()=>{c(!0),"function"==typeof o&&o()}},r.createElement(yn.Z,{iconName:"search-2"})),l&&r.createElement("div",{className:"search-input-switcher__inner"},r.createElement(pr,{handleSearch:e,searchUrl:t,placeholder:n,showQueryInUrl:i,autoFocus:!0}),r.createElement(He.Z,{appearance:"link",color:"secondary",onClick:()=>{c(!1),"function"==typeof s&&s()},label:"Отмена",extraClasses:"search-input-switcher__off"})))},nM=(0,r.memo)(tM),aM=({type:e,name:t,items:n,interests:a,onInterestButtonClick:s})=>r.createElement("div",{className:"interests-search"},r.createElement("h3",{className:"interests-search__title"},t),r.createElement("ul",{className:"interests-search__list"},n.map((t=>{const n=!0===a?.[e]?.[t.id]?a?.[e]?.[t.id]:void 0,o=!1===a?.[e]?.[t.id]?a?.[e]?.[t.id]:void 0;return r.createElement("li",{className:"interests-search__item",key:t.id},r.createElement("i",null,t.icon),r.createElement("span",null,Pa.Z.stripGeoId(t.text)),r.createElement("div",{className:"interests-search__controls"},r.createElement(JO,{onClick:()=>{s(t,e,"ignored",o)},icon:"close",isCompact:!0,selected:o}),r.createElement(JO,{onClick:()=>{s(t,e,"selected",n)},icon:"check",isCompact:!0,selected:n})))})))),sM=(0,r.memo)(aM),rM=({results:e,interests:t,inProcess:n,onInterestButtonClick:a})=>{const{tag:s=[],topic:o=[]}=e,i=s.length>0||o.length>0;return r.createElement(r.Fragment,null,!i&&!n&&r.createElement("p",{className:"user-interests__description"},"Здесь будут отображаться результаты поиска"),o.length>0&&r.createElement(sM,{type:"topic",name:"Категории",items:o,interests:t,onInterestButtonClick:a}),s.length>0&&r.createElement(sM,{type:"tag",name:"Теги",items:s,interests:t,onInterestButtonClick:a}),n&&r.createElement(Yn,null))},oM=(0,r.memo)(rM),iM=[{name:"selected",title:"Предпочтения"},{name:"ignored",title:"Исключения"}],lM=()=>{const e=(0,aa.C)((e=>e.userInterests)),t=(0,aa.T)(),{activeTab:n,interests:a,topics:s,tags:o,inProcess:i,search:l}=e,c=(e,n,a,s)=>{if(!i)return void 0!==s?t(((e,t)=>async n=>{n(VO(!0));try{const a=await qa.Z.deleteManualInterest(t,e.id);n(VO(!1)),a?n({type:"USER_INTERESTS_DELETE_INTEREST",interest:{id:e.id,type:t}}):kt.Z.sendSystemMessage("exception")}catch(e){n(VO(!1)),D.Z.promiseHandler(qO)(e)}})(e,n)):"selected"===a?t(zO(e,n,!0)):"ignored"===a?t(zO(e,n,!1)):void 0},m=(d={...a.topic,...a.tag},Object.keys(d).reduce(((e,t)=>(!0===d[t]?e.selected++:e.ignored++,e)),{selected:0,ignored:0}));var d;return r.createElement("div",{className:"user-interests"},r.createElement("div",{className:"user-interests__header"},r.createElement("h1",{className:"user-interests__title"},"Мои интересы"),r.createElement(nM,{handleSearch:e=>{var n;t((n=e,async(e,t)=>{const{topics:a}=t().userInterests;if(!n)return e({type:"USER_INTERESTS_RESET_SEARCH"});e(YO(!0));const s=a.reduce(((e,t)=>{const a=t.text.toLowerCase()?.indexOf(n.toLowerCase());return 0===a?e.bestMatch.push(t):a>0&&e.restMatch.push(t),e}),{bestMatch:[],restMatch:[]});e({type:"USER_INTERESTS_GET_TOPIC_SEARCH",topic:[...s.bestMatch,...s.restMatch]});let r=[];try{r=await fp.Z.search(n,"TAGS"),e({type:"USER_INTERESTS_GET_TAG_SEARCH",tag:r}),e(YO(!1))}catch(t){e(YO(!1)),D.Z.promiseHandler(qO)(t)}}))},showQueryInUrl:!1,extraClasses:"user-interests__search-input",onShowSearch:()=>{t(WO(!0))},onHideSearch:()=>{t(WO(!1))}})),!l.isActive&&r.createElement(r.Fragment,null,r.createElement("ul",{className:"user-interests__tabs"},iM.map((e=>r.createElement("li",{className:_()("user-interests__tab",n===e.name&&"user-interests__tab_active"),key:e.name,onClick:()=>t((e=>({type:"USER_INTERESTS_SET_TAB",tab:e}))(e.name))},`${e.title}${m[e.name]>0?": "+m[e.name]:""}`)))),r.createElement("p",{className:"user-interests__description"},(e=>"selected"===e?"Темы, выбранные в разделе предпочтения будут иметь приоритетное отображение в вашей ленте":"Темы, выбранные в разделе исключения не будут отображаться в вашей ленте")(n)),s.length>0&&r.createElement(eM,{title:"Категории",activeTab:n,list:s,interests:a.topic||{},type:"topic",onInterestButtonClick:c,showFilter:!0}),o.length>0&&r.createElement(eM,{title:"Теги",activeTab:n,list:o,interests:a.tag||{},type:"tag",onInterestButtonClick:c})),l.isActive&&r.createElement(oM,{results:l.results,interests:a,onInterestButtonClick:(e,n,a,s)=>{if(c(e,n,a,s),void 0!==s||"tag"!==n)if(void 0===s||"tag"!==n);else t({type:"USER_INTERESTS_DELETE_TAG",id:e.id});else t((e=>({type:"USER_INTERESTS_ADD_TAG",item:e}))(e))},inProcess:l.inProcess}))},cM=(0,r.memo)(lM);
/**
 * Mirtesen.
 *
 * Channel Cover Editor Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const mM=(e,t="add")=>({type:"CHANNEL_COVER_EDITOR_TOGGLE_MODAL",value:e,mode:t}),dM=620,pM=289,uM=(e,t,n)=>"edit"!==e||Oo()(t)||Oo()(n)?void 0:{top:t,left:n},gM=()=>{const[e,t]=(0,r.useState)(),[n,a]=(0,r.useState)(),[s,o]=(0,r.useState)(!1),i=(0,aa.C)((e=>e.channelCoverEditor)),l=(0,aa.C)((e=>e?.app?.channel?.cover_info)),{isOpen:c,mode:m,imageSaved:d}=i,p=(0,aa.T)();(0,r.useEffect)((()=>{t(l?.photo_original&&"add"!==m?l.photo_original:void 0)}),[l,m]),(0,r.useEffect)((()=>{d&&(t(void 0),o(!1),p(mM(!1)))}),[d]);const u=(0,r.useCallback)((e=>{if(!e?.[0])return;const n=URL.createObjectURL(e?.[0]);if(n){const e=document.createElement("img");e.onload=e=>{const{naturalHeight:a,naturalWidth:s}=e.target;s<dM||a<pM?kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Минимальный размер изображения должен быть "+dM+"х"+pM+" пикселей"}):t(n)},e.src=n}}),[]),g=(0,r.useCallback)((()=>{kt.Z.sendSystemMessage("rejectedFile")}),[]),h=(0,r.useCallback)((e=>{a(e)}),[]),_=()=>{if(!n)return;o(!0);const t=(e=>{const t=.3548*e.width,n=e.topPx+e.height-t;return{...e,height:t,topPx:n}})(n),a=St.Z.cropImage(n),s=St.Z.cropImage(t);e&&a&&s?p((({originalImage:e,mobileImage:t,desktopImage:n,top:a,left:s})=>async(r,o)=>{try{const i=o(),l=i.app?.channel;if(!l)throw new Error("channel not found!");const[c,m,d]=await St.Z.uploadImages([e,t,n]);if(!c||!m||!d)return kt.Z.sendSystemMessage("exception"),r({type:"CHANNEL_COVER_EDITOR_COMPLETE_SAVING"});const p={photo_original:c?.photo_original,cover_desktop:d?.photo_original,cover_mobile:m?.photo_original,top:a,left:s},u={...l,coverId:c.id,coverInfo:p};return await At.ZP.editChannel(u)?r(Pd(p)):kt.Z.sendSystemMessage("exception"),r({type:"CHANNEL_COVER_EDITOR_COMPLETE_SAVING"})}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler("/index.js")(e)}})({originalImage:e,mobileImage:a,desktopImage:s,top:n.topPr,left:n.leftPr})):kt.Z.sendSystemMessage("exception")};return c?r.createElement(O.Z,{className:"image-editor-modal",onClose:()=>{p(mM(!1)),t(void 0)}},r.createElement(O.Z.Header,null,r.createElement(ia.Z,{type:"button",className:"back",onClick:()=>{t(void 0),p(mM(!1))}},r.createElement(yn.Z,{iconName:"back-3"})),r.createElement(O.Z.Title,null,"Обложка канала"),e&&r.createElement(He.Z,{disabled:s,appearance:"link",color:"primary",label:"Сохранить",onClick:_})),r.createElement(O.Z.Body,null,!e&&r.createElement("div",{className:"dropzone-wrapper"},r.createElement(nn,{onDrop:u,onDropRejected:g,mainText:"Перетащите фото в эту область",extraText:r.createElement(r.Fragment,null,"Рекомендуемый размер — 1920х896px"," ",r.createElement("br",null),`Минимальный размер — ${dM}x${pM}px`," ",r.createElement("br",null),"Форматы — png, jpg, gif, webp"),iconUrl:"/images/picture-placeholder.svg",showBtn:!0,multiple:!1,accept:{"image/jpeg":[],"image/png":[],"image/gif":[],"image/webp":[]}})),e&&r.createElement("div",{className:"cover-editor"},r.createElement(Lo,{image:e,cropParams:uM(m,l?.top,l?.left),aspect:15/7,locked:!0,keepSelection:!0,onComplete:h,renderSelectionAddon:()=>r.createElement("div",{className:"selection-inner"},r.createElement("span",{className:"selection-helper top"},"Эта область видна на мобильных устройствах"),r.createElement("div",{className:"selection-desktop"},r.createElement("span",{className:"selection-helper top"},"Эта область видна на компьютерах"),r.createElement("span",{className:"selection-helper bottom"},r.createElement(yn.Z,{iconName:"arrow-up-down"}),"Перемещайте для выбора наилучшей области")))}))),e&&r.createElement(O.Z.Footer,null,r.createElement(He.Z,{label:"Отмена",color:"empty",onClick:()=>{t(void 0),p(mM(!1))}}),r.createElement(He.Z,{label:"Сохранить",color:"primary",disabled:s,onClick:_}))):null},hM=(e,t)=>{if(!e||!t)return;let n=e<At.ZP.BREAKPOINTS.XS?t.cover_mobile:t.cover_desktop;return n||(n=t.photo_original),n},_M=({coverInfo:e,isOwner:t})=>{const[n,a]=(0,r.useState)(!1),s=Md(),o=(0,aa.T)();let i;return i=e?.photo_original?r.createElement(G.Z,{customListClasses:"channel-dropdown",placement:"auto-right",buttonProps:{label:Number(s)<At.ZP.BREAKPOINTS.XS?"":"Изменить обложку",icon:"pencil",extraClasses:_()("btn",Number(s)<At.ZP.BREAKPOINTS.XS&&"compact")},onClose:()=>{a(!1)},onShow:()=>{a(!0)}},r.createElement(ia.Z,{className:"channel-dropdown__item",onClick:()=>{o(mM(!0,"edit"))}},"Изменить обложку"),r.createElement(ia.Z,{className:"channel-dropdown__item",onClick:()=>{o(mM(!0,"add"))}},"Загрузить новую обложку"),r.createElement(ia.Z,{className:"channel-dropdown__item divider highlight",onClick:()=>{o((async(e,t)=>{try{const n=t(),a=n.app?.channel;if(!a)throw new Error("channel not found!");const s={...a,coverId:null,coverInfo:{}};await At.ZP.editChannel(s)?e(Pd({})):kt.Z.sendSystemMessage("exception")}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler(fd)(e)}}))}},"Удалить")):r.createElement(He.Z,{type:"button",color:"custom",icon:"add-photo",label:"Добавить обложку",onClick:()=>{o(mM(!0,"add"))}}),r.createElement(r.Fragment,null,r.createElement(kn.Z,{className:_()("channel-cover",!e&&"empty",n&&"active"),src:hM(s,e)||"",size:"qbp",tag:"div"},t&&r.createElement("div",{className:"channel-cover__controls"},i)),r.createElement(gM,null))},EM=(0,r.memo)(_M);var fM=n(41999);
/**
 * Mirtesen.
 *
 * Channel header
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const bM=({channelInfo:e})=>{if(!e)return null;const{cover_info:t,avatar_info:n,subscribers_num:a=0,posts_num:s=0,description:o,title:i,id:l,person_id:c,name:m}=e,d=At.ZP.isChannelOwner(b.ZP.getCurrentUserId(),c),p=re.Z.getConfig();return r.createElement("header",{className:"channel-header"},r.createElement("section",{className:"top"},r.createElement(EM,{coverInfo:t,isOwner:d})),r.createElement("section",{className:"bottom"},r.createElement(fM.Z,{avatarInfo:n,channelTitle:i,isOwner:d,messageId:"CHANNEL_HEADER"}),r.createElement("div",{className:"controls"},!d&&r.createElement(_f,{channelId:l,mode:"full"}),b.ZP.isLogged()&&r.createElement(ir,{id:`channel-actions-${l}`,channelId:l,type:d?"channel-owner":"channel-guest",mobileBreakPoint:At.ZP.BREAKPOINTS.XS,url:`${p.mainProto}://${p.channelDomain}/${m}`})),r.createElement("div",{className:"info"},r.createElement("h1",{className:"title"},r.createElement("a",{href:`${p.mainProto}://${p.channelDomain}/${m}`},i)),(a>0||s>0)&&r.createElement("div",{className:"counters"},s>0&&r.createElement("div",{className:"counter"},r.createElement("span",null,y.Z.formatViewsCounter(s)),r.createElement("span",null,y.Z.num2string(s,["публикация","публикации","публикаций"]))),r.createElement(xf,{subscribersNum:a,counterType:"channel",id:l})),o&&r.createElement("p",{className:"descr"},o))))},yM=()=>{const e=(0,aa.C)((e=>e.channelMain)),t=(0,aa.C)((e=>e?.app?.channel)),n=(0,aa.C)((e=>e.actionModifyPostPopup)),a=(0,aa.C)((e=>e.app?.meta)),s=(0,aa.T)(),{hasMoreItems:o,items:i,nextOffset:l,currentUserPostId:c}=e;let m=0;return r.createElement(r.Fragment,null,r.createElement(bM,{channelInfo:t}),r.createElement("div",{className:"blog-post-list"},r.createElement(zn,{pageStart:0,loadMore:()=>{var e;o&&s((e={id:t.id,leadUserPostId:c,offset:l,limit:Rp().postsPerPage},async t=>{try{const n=await At.ZP.getPostsByChannel(e);n&&t({type:"CHANNEL_MAIN_SET_ITEMS",items:n?.items||[],hasMoreItems:n?.items.length>0,nextOffset:n?.nextOffset})}catch(e){D.Z.promiseHandler("/index.js")(e)}}))},hasMore:o,loader:r.createElement(Yn,null),threshold:400},i.length<1&&!o&&r.createElement("article",{className:"post-card no-posts",key:0},"Здесь пока ничего нет"),i.length>0&&i.map((e=>{if(n?.approveList?.[e.id])return null;m++;const t=c===e.id;return r.createElement(dE,{key:m},r.createElement(HS,{post:e,isCurrentPost:t,showCommentWidget:t,onPostAppear:()=>s(gc()),pageTitle:a.title,postLabelEnabled:!0,linkTarget:"_self",subscribeButtonEnabled:!0}))})),r.createElement(ty,null),r.createElement(Jb,null))))},vM=(0,ae.Z)((0,r.memo)(yM),"channelMain");function TM(){return TM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},TM.apply(this,arguments)}const SM=({mode:e})=>{const t=(0,aa.C)((e=>e.app.req.browser.name)),{post:n}=(0,aa.C)((e=>e.channelPost)),a=EE.ZP.getPostType(n),{attachments:s=[],shared_post:o}=n,i=EE.ZP.normalizeText(n,{browserName:t,isCurrentPost:!0}),l=EE.ZP.isLinkAttachments(n),c=Fp.addUtmToUrl(n.seo_url||n.url),m=s?.filter((e=>(0,ls.fr)(e)||(0,ls.M2)(e)))||[];let d;(o||l)&&(d=o?EE.ZP.normalizeRepost(o):EE.ZP.normalizeLink(l.link));const p=(0,r.useRef)(null),[g,h]=(0,r.useState)(!1),[E,f]=(0,r.useState)(!1),v=(0,r.useCallback)(u()((()=>{if(p.current){const e=p.current.getBoundingClientRect().top+window.scrollY,t=window.scrollY+document.documentElement.clientHeight;h(!(t>=e))}}),80),[]),T=(0,r.useRef)();return(0,r.useEffect)((()=>{v(),f(!0)}),[]),(0,r.useEffect)((()=>{let t=null;"popup"===e&&(t=document.querySelector(".channel-post-popup .popup-content")),T.current=t||window}),[e]),(0,kr.O)("scroll",v,T.current),n?r.createElement("div",{className:_()("channel-main-post",!b.ZP.isLogged()&&"with-auth-form")},r.createElement($S,{metaUrl:n?.url||"",metaDate:n?.formattedDates?.iso||"",metaTitle:n?.title||n?.previewText,metaImage:y.Z.cropImage2(n?.images?.[0]?.url||"")}),r.createElement("h1",{className:"title"},n?.title),r.createElement("div",{className:"pubdate-views"},r.createElement(ZS,{postId:n?.id,topStatus:n?.top_status,place:"post-page"}),r.createElement(tS,{date:n?.date,href:c,target:"_self"}),r.createElement(gE,{id:n?.id,postType:"up",className:"views",appearence:"string",counter:"none"})),r.createElement("div",{className:"text",itemProp:"articleBody",dangerouslySetInnerHTML:{__html:i}}),a===EE.Ek&&r.createElement(vS,{attachments:m,postType:n?.post_type,extraClasses:"media"}),n?.foreignPollId&&r.createElement(_n,{pollId:n.foreignPollId}),d&&r.createElement(IS,TM({},d,{isFull:m?.length<1})),r.createElement(by,{tags:n?.tags||[]}),r.createElement("div",{className:_()("actions-container",g&&"sticky")},E&&r.createElement(Vy,{post:n,isCurrentPost:!0})),r.createElement("div",{ref:p}),r.createElement(Vv,{blogPostId:n?.id,showListTitle:!1,showImmediately:!0}),r.createElement(ty,null),r.createElement(Jb,null),r.createElement(vy,{postId:n.id})):null},PM=(0,ae.Z)((0,r.memo)(SM),"channelPost"),wM=()=>{const[e,t]=(0,r.useState)(!1);return(0,kr.O)("message",(e=>{"MT_APP_SHOW_GEO_POST_POPUP"===e.data.type&&t(e.data.show)})),r.createElement(r.Fragment,null,e&&r.createElement(O.Z,{onClose:()=>{t(!1)}},r.createElement(O.Z.Header,null,r.createElement(O.Z.Title,null,"Выберите местоположение")),r.createElement(To,{extraClasses:"geo-map-container geo-popup",geoType:"post"})))},IM=(0,r.memo)(wM),CM=N((()=>n.e(435).then(n.bind(n,17172))),"lexicalEditorRich","LexicalEditorRich"),NM=()=>{const e=(0,aa.T)(),t=(0,aa.C)((e=>e.richPostEditor)),{title:n,text:a,geo:s}=t,[o,i]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{i(!0),e(sb())}),[]),(0,kr.O)("message",(t=>{"MT_APP_USER_SELECT_GEO_POSITION"===t.data.type&&(e(rb({status:"manual",tagId:t.data.tagId})),kt.Z.sendMessage({type:"MT_APP_SHOW_GEO_POST_POPUP",show:!1}),na.ym("reachGoal","geo_location_post"))})),r.createElement(r.Fragment,null,o&&r.createElement("div",{className:"rich-post-editor"},r.createElement("input",{type:"text",className:"rich-post-editor__title",onChange:t=>{e((e=>t=>t({type:"CHANNEL_RICH_POST_EDITOR_SET_TITLE",title:e}))(t.target.value)),e(sb())},placeholder:"Заголовок",name:"title",defaultValue:n}),r.createElement(CM,{placeholder:"Расскажите что-нибудь интересное",text:"<p>"+a+"</p>",onChange:t=>{e((e=>t=>t({type:"CHANNEL_RICH_POST_EDITOR_SET_TEXT",text:e}))(t)),e(sb())},extraClasses:"mt-editor-rich"}),r.createElement(Un.Z,{tagId:s?.tagId,onRemove:()=>{e(rb({status:"manual",tagId:0}))}}),!s.tagId&&r.createElement(Lr.Z,null,r.createElement(He.Z,{extraClasses:"geo-switch",icon:"cross",appearance:"link",label:"Указать местоположение",color:"primary",title:"Указать местоположение",onClick:()=>{kt.Z.sendMessage({type:"MT_APP_SHOW_GEO_POST_POPUP",show:!0})}})),r.createElement(IM,null)))},OM=(0,ae.Z)((0,r.memo)(NM),"channel"),MM=({items:e,title:t,loadMore:n,hasMore:a})=>{const s=Md(),o=Number(s)<=At.ZP.BREAKPOINTS.XS?25:100,i=re.Z.getConfig();return r.createElement("section",{className:"channel-list"},t&&r.createElement("h2",{className:"list-title"},t),r.createElement(zn,{loadMore:n,hasMore:a,loader:r.createElement(yr,null),threshold:800},r.createElement("ul",{className:"items"},e.map((e=>{const{lastPost:t}=e,n=`${i.mainProto}://${i.channelDomain}/${e.name}`;return r.createElement("li",{className:_()("channel-item",t&&"with-last-post"),key:e.id},r.createElement(Mn.Z,{logoInfo:{userName:e.title,logoImg:e.avatar_info?.avatar||e.avatar_info?.photo_original,size:"av116",logoUrl:n}}),r.createElement("div",{className:"info"},r.createElement("div",{className:"top"},r.createElement("h3",{className:"title"},r.createElement("a",{href:n},e.title)),r.createElement(ir,{channelId:e.id,type:e.is_owner?"channel-owner":"channel-guest",url:n,id:`channel-actions-${e.id}`})),t&&r.createElement("a",{href:n,className:"last-post"},t.images.length>0&&r.createElement("div",{className:"image"},r.createElement(kn.Z,{size:"av48",src:t.images[0]?.url})),r.createElement("p",{className:"preview"},y.Z.truncateString2(t.previewText,o)))))})))))},kM=(0,r.memo)(MM);
/**
 * Mirtesen.
 *
 *  My Channels actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const AM=()=>{const e=(0,aa.C)((e=>e.myChannels)),t=(0,aa.T)(),{channels:n,subscriptions:a}=e,s=(0,r.useCallback)((e=>{"MT_APP_UPDATE_SUBSCRIBERS"!==e.data.type||"channel"!==e.data.subscriptionType||e.data.value||t({type:"MY_CHANNELS_DELETE_SUBSCRIPTION",channelId:e.data.id})}),[]);return(0,kr.O)("message",s),r.createElement("div",null,n.length>0&&r.createElement(kM,{title:`Мои каналы: ${n.length}`,items:n}),a.items.length>0&&r.createElement(kM,{title:`Мои подписки: ${a.subscriptionsNum}`,items:a.items,loadMore:()=>{t((async(e,t)=>{const n=t().myChannels,{subscriptions:a}=n;try{const t=await At.ZP.getUserSubscriptions(Rp().recordsPerPage,a.nextOffset)||[];e({type:"MY_CHANNELS_LOAD_SUBSCRIPTIONS",items:t,hasMore:t.length>=Rp().recordsPerPage,nextOffset:a.nextOffset+t?.length})}catch(e){D.Z.promiseHandler("/index.js")(e)}}))},hasMore:a.hasMore}))},xM=(0,r.memo)(AM);n(87690);var LM=n(30782),DM=n(34883);
/**
 * Mirtesen.
 *
 * Add Channel Form
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const RM=(0,r.memo)((()=>{const e=(0,aa.T)(),t=(0,aa.C)((e=>e.channelEditor)),{channelId:n,isReady:a,isMobile:s}=t,{imports:o}=t.telegramList,i=b.ZP.getCurrentUserId();return(0,r.useEffect)((()=>{(async()=>{e((0,DM.dF)(!1));const t=await At.ZP.getChannelTelegramImports(i,n||0);e({type:"CHANNEL_EDITOR_SHOW_TELEGRAM_LIST",telegramList:t}),e((0,DM.dF)(!0))})()}),[n]),r.createElement(r.Fragment,null,r.createElement(O.Z.Header,null,r.createElement(r.Fragment,null,s&&r.createElement(ia.Z,{onClick:()=>{e((0,DM.IE)("menu"))},className:"tab-back-button"},r.createElement(yn.Z,{iconName:"back-3"})),r.createElement(O.Z.Title,null,"Импорт Telegram"))),r.createElement("div",{className:_()({fade:!0,"is-ready":a})},r.createElement(O.Z.Body,null,r.createElement("div",{className:"telegram-list-tab"},r.createElement("h3",{className:"tab-title telegram-list-tab__title"},"Источники"),r.createElement("ul",{className:"tab-menu"},r.createElement("li",{onClick:()=>e((0,DM.dL)())},r.createElement("div",{className:"telegram-list-tab__add"},"Добавить Telegram-канал"),r.createElement(ia.Z,{className:"tab-next-button"},r.createElement(yn.Z,{iconName:"chevron-right"}))),o&&o.map(((t,a)=>{let s="",o="";Sa()(t.tags)||(s=t.tags.map((e=>"#"+Pa.Z.stripGeoId(e))),o=s.length>5?" и еще "+(t.tags.length-5):"",s=s.slice(0,5).join(", "));const l=t.username;return r.createElement("li",{key:a,onClick:()=>{e((0,DM.nQ)(`${i}-${n}-${l}`))}},r.createElement("div",null,t.username,!Sa()(t.tags)&&r.createElement("i",{className:"helper"},s,o)),r.createElement(ia.Z,{className:"tab-next-button"},r.createElement(yn.Z,{iconName:"chevron-right"})))}))),r.createElement("i",{className:"helper helper_bottom"},"Чтобы посты корректно импортировались из Telegram в МТ, необходимо запустить бот ",r.createElement("a",{href:"https://t.me/mt_sync_bot"},"@mt_sync_bot")," нажав /start и добавить его в телеграм-канал в качестве администратора. После этого на данной странице нажмите «Добавить канал» и продолжите настройку")))))})),ZM=(0,ae.Z)(RM,"ChannelEditor");
/**
 * Mirtesen.
 *
 * Add Channel Form
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2023, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const BM=(0,r.memo)((()=>{const[e,t]=(0,r.useState)(!1),n=(0,aa.C)((e=>e.channelEditor)),{inProcess:a,channelId:s,isReady:o,isDirty:i,isMobile:l}=n,{name:c,tags:m,tagSuggestions:d,errors:p,importKey:u}=n.telegramEdit,g=(0,aa.T)(),h=b.ZP.getCurrentUserId();(0,r.useEffect)((()=>{c&&!p.name&&!a&&i?t(!1):t(!0)}),[p,c,a]),(0,r.useEffect)((()=>{(async()=>{if(g((0,DM.ns)(!1)),u){g((0,DM.dF)(!1));const e=await At.ZP.getChannelTelegramImports(h,s)||[];let t=null;e.map((e=>{u===`${h}-${s}-${e.username}`&&(t=e)})),t&&g((0,DM.gg)({name:t.username,tags:t.tags,errors:{}},"telegramEdit")),g((0,DM.dF)(!0))}else g((0,DM.gg)({...Gm.E3.telegramEdit},"telegramEdit"))})()}),[]);const E=async(e="")=>{if(e.length<4)return"Введите название от 4 символов";if(!e.match(/^@/))return"Имя канала должно начинаться с символа @";try{let t=!1;if((await At.ZP.getChannelTelegramImports(h,s||0)).map((n=>{e.toLowerCase()===n.username.toLowerCase()&&(t=!0)})),t)return"Вы уже добавили импорт для этого канала"}catch(e){D.Z.promiseHandler("/index.js")(e)}};return r.createElement(r.Fragment,null,r.createElement(O.Z.Header,null,r.createElement(r.Fragment,null,r.createElement(ia.Z,{onClick:()=>g((0,DM.IE)("telegramList")),className:"tab-back-button"},r.createElement(yn.Z,{iconName:"back-3"})),r.createElement(O.Z.Title,null,u?"Редактирование Telegram-канала":"Добавление  Telegram-канала"),l&&r.createElement("div",{className:"mobile-actions"},i&&r.createElement(ia.Z,{onClick:()=>{g((0,DM.wX)(!1)),g((0,DM.IE)("telegramEdit"))}},"Отмена"),r.createElement(ia.Z,{onClick:()=>{g((0,DM.k4)())},disabled:e},"Готово")))),r.createElement("div",{className:_()({fade:!0,"is-ready":o})},r.createElement(O.Z.Body,null,r.createElement("div",{className:"telegram-edit-tab"},u&&r.createElement("div",{className:"form-controller form-controller_with-label"},r.createElement("label",{className:"label"},"Имя канала"),r.createElement("div",{className:"text-box"},c)),!u&&r.createElement(Lr.Z,{label:"Имя канала",helper:p.name||"Укажите имя импортируемого канала в формате @my_channel, как это указано в настройках вашего телеграм-канала",isError:!!p.name},r.createElement(Dr.Z,{type:"text",value:c,name:"name",placeholder:"Введите имя канала",autoComplete:"off",onChange:e=>{g((0,DM.wX)(!0)),g((0,DM.sO)("name",e.target.value)),g((0,DM.NG)("name",e.target.value,E))}})),r.createElement(Lr.Z,{label:"Теги"},r.createElement(aT,{icon:"tag",helper:r.createElement(r.Fragment,null,r.createElement("p",null,"Используйте Tab или Enter чтобы завершить ввод"),r.createElement("p",null,"Эти теги будут автоматически прикрепляться к публикации при кросспостинге с данного телеграм-канала")),tags:m||[],suggestions:d.slice(0,15)||[],onInput:async e=>{g((0,DM.iP)(e,"tagSuggestions"))},onFocus:e=>{e.current.input.value.length<3&&g((0,DM.gg)({tagSuggestions:[]}))},onResetSuggestions:()=>{g((0,DM.gg)({tagSuggestions:[]}))},onChangeInput:e=>{g((0,DM.wX)(!0)),g((0,DM.sO)("tags",e))}})),u&&r.createElement("div",{className:"delete-telegram-import"},r.createElement(ia.Z,{onClick:()=>{window.confirm("Вы точно хотите удалить импорт из Телеграм?")&&g((0,DM.Lk)())},className:"delete-telegram-import__go"},"Удалить телеграм-канал"),r.createElement("i",{className:"helper"},"Удаление данного телеграм-канала из настроек кросспостинга не повлияет на ранее импортированные публикации")))),!l&&r.createElement(O.Z.Footer,null,r.createElement(r.Fragment,null,i&&r.createElement(He.Z,{color:"secondary",label:"Отмена",onClick:()=>{g((0,DM.wX)(!1)),g((0,DM.IE)("telegramEdit"))}}),r.createElement(He.Z,{color:"primary",label:u?"Сохранить":"Добавить канал",onClick:()=>{g((0,DM.k4)())},disabled:e})))))})),$M=(0,ae.Z)(BM,"ChannelEditor"),UM=(0,r.memo)((()=>{const e=(0,aa.C)((e=>e.channelEditor)),{inProcess:t,channelId:n,isReady:a,isDirty:s,isMobile:o}=e,i=(0,aa.T)(),{tags:l,tagSuggestions:c,geoTags:m,geoTagSuggestions:d}=e.content;return(0,r.useEffect)((()=>{(async()=>{i((0,DM.ns)(!1)),i((0,DM.dF)(!1));const e=await At.ZP.getChannelById(n,{reqType:"full"}),t=e?.tags||[];i((0,DM.gg)({tags:t.filter((e=>!Pa.Z.isGeoTag(e))),geoTags:t.filter((e=>Pa.Z.isGeoTag(e)))})),i((0,DM.dF)(!0))})()}),[]),r.createElement(r.Fragment,null,r.createElement(O.Z.Header,null,r.createElement(r.Fragment,null,r.createElement(ia.Z,{onClick:()=>i((0,DM.IE)("menu")),className:"tab-back-button"},r.createElement(yn.Z,{iconName:"back-3"})),r.createElement(O.Z.Title,null,"Контент"),o&&r.createElement("div",{className:"mobile-actions"},s&&r.createElement(ia.Z,{onClick:()=>{i((0,DM.wX)(!1)),i((0,DM.IE)("content"))}},"Отмена"),r.createElement(ia.Z,{onClick:()=>{i((0,DM.Q5)())},disabled:!s&&!t},"Готово")))),r.createElement("div",{className:_()({fade:!0,"is-ready":a})},r.createElement(O.Z.Body,null,r.createElement("div",{className:"channel-content-tab"},r.createElement("i",{className:"helper form-section"},"Указанные теги и гео-теги будут прикрепляться ко всем постам канала"),r.createElement("div",{className:"form-section"},r.createElement(Lr.Z,{label:"Теги"},r.createElement(aT,{icon:"tag",helper:"Используйте Tab или Enter чтобы завершить ввод",tags:l||[],suggestions:c.slice(0,15)||[],params:{placeholderText:"Добавить..."},onInput:async e=>{i((0,DM.iP)(e,"tagSuggestions","tag"))},onFocus:e=>{e.current.input.value.length<3&&i((0,DM.gg)({tagSuggestions:[]},"content"))},onResetSuggestions:()=>{i((0,DM.gg)({tagSuggestions:[]},"content"))},onChangeInput:e=>{i((0,DM.wX)(!0)),i((0,DM.gg)({tags:e}))}}))),r.createElement("div",{className:"form-section"},r.createElement(Lr.Z,{label:"Гео-теги"},r.createElement(aT,{icon:"geo-stroke",placeholder:"Укажите гео-теги",tags:m||[],suggestions:d.slice(0,15)||[],allowNew:!1,onInput:async e=>{i((0,DM.iP)(e,"geoTagSuggestions","geo"))},onFocus:e=>{e.current.input.value.length<3&&i((0,DM.gg)({geoTagSuggestions:[]},"content"))},onResetSuggestions:()=>{i((0,DM.gg)({geoTagSuggestions:[]},"content"))},onChangeInput:e=>{i((0,DM.wX)(!0)),i((0,DM.gg)({geoTags:e}))}}))))),!o&&r.createElement(O.Z.Footer,null,r.createElement(r.Fragment,null,s&&r.createElement(He.Z,{color:"secondary",label:"Отмена",onClick:()=>{i((0,DM.wX)(!1)),i((0,DM.IE)("content"))}}),r.createElement(He.Z,{color:"primary",label:"Сохранить",onClick:()=>{i((0,DM.Q5)())},disabled:!s&&!t})))))})),HM=(0,ae.Z)(UM,"ChannelEditor"),FM=e=>e.length>0&&e.length<6?"Слишком короткий идентификатор":e.length>0&&!y.Z.isNumeric(e)?"Должно быть целое число":void 0,jM=e=>{if(e.length>0&&e.length<6)return"Слишком короткий идентификатор"},GM=(0,r.memo)((({isDirty:e,disableSaving:t})=>{const n=(0,aa.T)();return r.createElement(r.Fragment,null,e&&r.createElement(He.Z,{color:"secondary",label:"Отмена",onClick:()=>{n((0,DM.wX)(!1)),n((0,DM.IE)("metrics"))}}),r.createElement(He.Z,{color:"primary",label:"Сохранить",onClick:()=>{n((0,DM.Yh)())},disabled:t}))})),qM=(0,r.memo)((()=>{const e=(0,aa.T)(),[t,n]=(0,r.useState)(!1),a=(0,aa.C)((e=>e.channelEditor)),{inProcess:s,isReady:o,isDirty:i,isMobile:l,channelId:c}=a,{yandexMetrics:m,liveInternet:d,errors:p}=a.metrics;return(0,r.useEffect)((()=>{(async()=>{if(e((0,DM.ns)(!1)),c){e((0,DM.dF)(!1));const t=await At.ZP.getChannelSettings(c);e((0,DM.gg)({yandexMetrics:t?.analytics?.yandexMetricaAccountId,liveInternet:t?.analytics?.liruAccountId})),e((0,DM.dF)(!0))}})()}),[]),(0,r.useEffect)((()=>{!s&&i&&Sa()(p)?n(!1):n(!0)}),[s,i,p]),r.createElement(r.Fragment,null,r.createElement(O.Z.Header,null,r.createElement(r.Fragment,null,r.createElement(ia.Z,{onClick:()=>{e((0,DM.$J)(!1))},className:"tab-back-button"},r.createElement(yn.Z,{iconName:"back-3"})),r.createElement(O.Z.Title,null,"Метрики"),l&&r.createElement("div",{className:"mobile-actions"},r.createElement(GM,{isDirty:i,disableSaving:t})))),r.createElement("div",{className:_()({fade:!0,"is-ready":o})},r.createElement(O.Z.Body,null,r.createElement(r.Fragment,null,r.createElement("div",{className:"form-section"},r.createElement(Lr.Z,{label:"Яндекс.Метрика",helper:p.yandexMetrics||"Добавление счетчика Яндекс.Метрика. Предварительно Вам необходимо зарегистрироваться. Идентификатор аккаунта можно найти в коде счетчика, введите только цифры",isError:!!p.yandexMetrics},r.createElement(Dr.Z,{type:"text",value:m,name:"yandexMetrics",placeholder:"Введите идентификатор ЯндексМетрики",autoComplete:"off",onChange:t=>{e((0,DM.wX)(!0)),e((0,DM.sO)("yandexMetrics",t.target.value)),e((0,DM.NG)("yandexMetrics",t.target.value,FM))}}))),r.createElement("div",{className:"form-section"},r.createElement(Lr.Z,{label:"Liveinternet",helper:p.liveInternet||"Добавление счетчика Liveinternet. Предварительно Вам необходимо зарегистрироваться. Идентификатор аккаунта можно найти в коде счетчика",isError:!!p.liveInternet},r.createElement(Dr.Z,{type:"text",value:d,name:"liveInternet",placeholder:"Введите идентификатор LiveInternet",autoComplete:"off",onChange:t=>{e((0,DM.wX)(!0)),e((0,DM.sO)("liveInternet",t.target.value)),e((0,DM.NG)("liveInternet",t.target.value,jM))}}))))),!l&&r.createElement(O.Z.Footer,null,r.createElement(GM,{isDirty:i,disableSaving:t}))))})),VM=(0,ae.Z)(qM,"ChannelEditor"),zM=(0,r.memo)((()=>{const e=(0,aa.T)(),t=(0,aa.C)((e=>e.channelEditor)),{channelId:n}=t,{title:a,avatar:s}=t.header;return(0,r.useEffect)((()=>{(async()=>{if(n){const t=await At.ZP.getChannelById(n,{reqType:"full"});e((0,DM.Ec)(t?.title,t?.avatar_info?.avatar||t?.avatar_info?.photo_original))}else e((0,DM.Ec)(void 0,void 0))})()}),[]),n?r.createElement("div",{className:"channel-info fade is-ready"},r.createElement(Mn.Z,{logoInfo:{userName:a,logoImg:s,size:"av116"},className:"channel-info__avatar"}),r.createElement("div",{className:"channel-info__description"},r.createElement("i",null,"Канал"),r.createElement("h3",null,a))):null})),WM=(0,ae.Z)(zM,"ChannelEditor"),YM=(0,r.memo)((()=>{const e=(0,aa.T)();return r.createElement(r.Fragment,null,r.createElement(O.Z.Header,null,r.createElement(r.Fragment,null,r.createElement(ia.Z,{onClick:()=>{e((0,DM.$J)(!1))},className:"tab-back-button"},r.createElement(yn.Z,{iconName:"back-3"})),r.createElement(O.Z.Title,null,"Настройки канала"))),r.createElement(O.Z.Body,null,r.createElement("div",{className:"channel-menu-tab"},r.createElement(WM,null),r.createElement("ul",{className:"tab-menu"},Object.entries(QM).map((([t,n])=>n.skipInMenu?null:r.createElement("li",{key:t,onClick:()=>e((0,DM.IE)(t))},n.title,r.createElement(ia.Z,{className:"tab-next-button"},r.createElement(yn.Z,{iconName:"chevron-right"})))))))))})),KM=(0,ae.Z)(YM,"ChannelEditor"),JM=(0,r.memo)((()=>{const e=(0,aa.T)(),t=(0,aa.C)((e=>e.channelEditor)),{prevTab:n}=t;return r.createElement(r.Fragment,null,r.createElement(O.Z.Header,null,r.createElement(r.Fragment,null,r.createElement(ia.Z,{onClick:()=>{e((0,DM.IE)(n))},className:"tab-back-button"},r.createElement(yn.Z,{iconName:"back-3"})),r.createElement(O.Z.Title,null,"Выберите местоположение"))),r.createElement(To,{extraClasses:"geo-map-container geo-popup",geoType:"post"}))})),XM=(0,ae.Z)(JM,"ChannelEditor"),QM={menu:{title:"Настройки канала",tab:KM,skipInMenu:!0},info:{title:"О канале",tab:LM.Z,skipInMenu:!1},telegramList:{title:"Импорт Телеграм",tab:ZM,skipInMenu:!1},telegramEdit:{title:"Добавление телеграм-канала",tab:$M,skipInMenu:!0,back:"telegramList"},content:{title:"Контент",tab:HM,skipInMenu:!1},metrics:{title:"Метрики",tab:VM,skipInMenu:!1},geoPosition:{title:"Местоположение",tab:XM,skipInMenu:!0}},ek=(0,r.memo)((()=>{const e=(0,aa.C)((e=>e.channelEditor)),{key:t,tab:n}=e,a=QM[n]?.tab,s=(0,aa.T)();return(0,r.useEffect)((()=>{(async()=>{s((0,DM.IE)("info"))})()}),[]),r.createElement(a,{key:t})})),tk=(0,ae.Z)(ek,"ChannelEditor"),nk=(0,r.memo)((()=>{const e=(0,aa.C)((e=>e.channelEditor)),{tab:t,key:n,isMobile:a,channelId:s}=e,o=(0,aa.T)(),i=QM[t]?.tab;return(0,r.useEffect)((()=>{(async()=>{if(o((0,DM.ns)(!1)),o((0,DM.dF)(!1)),s){const e=await At.ZP.getChannelById(s,{reqType:"full"});o((0,DM.Ec)(e?.title,e?.avatar_info?.avatar||e?.avatar_info?.photo_original))}else o((0,DM.gg)({...Gm.E3.info}));o((0,DM.IE)("info")),o((0,DM.dF)(!0))})()}),[]),r.createElement(r.Fragment,null,!a&&"geoPosition"!==t&&r.createElement("div",{className:"sidebar channel-editor__sidebar"},r.createElement("div",{className:"sidebar-header"},r.createElement(WM,null)),r.createElement("ul",{className:"sidebar-menu"},Object.entries(QM).map((([e,n])=>n.skipInMenu?null:r.createElement("li",{key:e},r.createElement(ia.Z,{className:_()({selected:e===t}),onClick:()=>o((0,DM.IE)(e))},n.title)))))),r.createElement("div",{className:"channel-editor__tabs"},r.createElement(i,{key:n})))})),ak=(0,ae.Z)(nk,"ChannelEditor"),sk=(0,r.memo)((()=>{const e=(0,aa.T)(),t=(0,aa.C)((e=>e.channelEditor)),{channelId:n,isOpen:a,isDirty:s,isMobile:o,tab:i}=t,l=Md(),[c,m]=(0,r.useState)(!1),d="geoPosition"===i;(0,r.useEffect)((()=>{if(a){const t=Number(l)<At.ZP.BREAKPOINTS.XS;e((0,DM.gg)({isMobile:t},"root")),e(n&&t?(0,DM.IE)("menu"):(0,DM.IE)("info")),m(!0)}else s&&!window.confirm("У вас есть несохраненные данные, которые будут потеряны. Вы уверены, что хотите завершить редактирование?")?(e((0,DM.$J)(!0)),m(!0)):(e((0,DM.wX)(!1)),m(!1))}),[a]);return(0,kr.O)("message",(t=>{switch(t.data.type){case"MT_APP_OPEN_CHANNEL_EDITOR":e((0,DM.a3)(t.data.channelId));break;case"MT_APP_USER_SELECT_GEO_POSITION":if(!c)return;e((0,DM.Zl)(t.data.tagId)),e((0,DM.IE)("info")),e((0,DM.wX)(!0)),na.ym("reachGoal","geo_location_channel")}})),c?r.createElement(O.Z,{className:_()({"channel-editor":!0,"channel-editor_add":!d&&!n,"channel-editor_edit":!d&&!!n,"channel-editor_geo":d,"channel-editor_mobile":o}),onBeforeClose:()=>(e((0,DM.$J)(!1)),!1)},!n&&r.createElement(tk,null),n&&r.createElement(ak,null)):null})),rk=(0,ae.Z)(sk,"ChannelEditor"),ok=({channelId:e})=>{const t=(0,aa.T)(),n=(0,aa.C)((e=>e.channelSubscribeAction)),a=n[e]?.channel,{is_subscribed:s}=a||{},[o,i]=(0,r.useState)("check"),l=Md();(0,r.useEffect)((()=>{i(s?"check":"cross")}),[s]);const c=(0,r.useCallback)((()=>{!e||a||s||t(es(e))}),[e]),m=(0,r.useCallback)((n=>{n.stopPropagation(),t(ts(e,!s))}),[e,s]);return r.createElement(qn,{onIntersection:([e])=>{e&&c()},margin:"0px",extraClasses:"action-subscribe-btn"},null===s&&r.createElement("i",{style:{display:"inline-block",width:"1px",height:"1px"}}),null!==s&&r.createElement(He.Z,{isCompact:s||Number(l)<=At.ZP.BREAKPOINTS.XS,label:s?"Отписаться":"Подписаться",rounded:s,color:s?"empty":"secondary",icon:Number(l)<=At.ZP.BREAKPOINTS.XS||s?o:"",onMouseEnter:()=>{s&&i("close")},onMouseLeave:()=>{s&&i("check")},onClick:m}))},ik=(0,r.memo)(ok);
/**
 * Mirtesen.
 *
 * Search results actions
 *
 * @author       Efimova Olga.
 * @copyright    Copyright (c) 2024, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const lk=[{id:"posts",title:"Публикации"},{id:"channels",title:"Каналы"},{id:"geo",title:"Места"}],ck=()=>{const e=(0,aa.C)((e=>e.mtSearchResults)),{query:t,posts:n,geo:a,channels:s,activeTab:o}=e,i=(0,aa.T)(),l=re.Z.getConfig(),c=e[o],{channelDomain:m,mainProto:d}=l;return r.createElement("div",{className:"search-results"},r.createElement("header",{className:"results-header"},r.createElement("h1",{className:"title"},t),r.createElement("div",{className:"tabs",role:"tablist"},lk.map((t=>e[t.id]?.results?.length<1?null:r.createElement(ia.Z,{type:"button",key:t.id,className:_()("btn","tab",t.id===o&&"active"),role:"tab","aria-selected":t.id===o,onClick:()=>{i((e=>({type:"MT_SEARCH_RESULTS_SET_TAB",activeTab:e}))(t.id))}},t.title))))),"search-error"===o&&r.createElement(KE,{searchQuery:t}),"search-empty"===o&&r.createElement("p",{className:"placeholder"},"Здесь можно найти публикации, каналы, места или ключевые слова"),["posts","channels","geo"].includes(o)&&r.createElement(zn,{hasMore:c.hasMore,pageStart:0,loadMore:()=>{i(((e,t)=>async(n,a)=>{const s=a().mtSearchResults[e],{page:r}=s,o=re.Z.getConfig(),i="posts"===e?o.postsPerPage:o.recordsPerPage;try{let a;a="channels"===e?await fp.Z.search(t,"CHANNELS",{offset:r*i,count:i}):"geo"===e?await fp.Z.search(t,"TAGS",{tagType:"GEO",offset:r*i,count:i}):await fp.Z.search(t,"ALL_CHANNEL_POSTS",{offset:r*i,count:i,normalizerType:"full"}),Array.isArray(a)&&n({type:"MT_SEARCH_RESULTS_LOAD_MORE",activeTab:e,results:a,page:r+1,hasMore:a.length>0})}catch(e){D.Z.promiseHandler("/index.js")(e)}})(o,t))},loader:r.createElement(yr,null)},"posts"===o&&n.results.map((e=>r.createElement(dE,{key:e.id},r.createElement(HS,{post:e,postLabelEnabled:!0,linkTarget:"_self"})))),"channels"===o&&r.createElement("ul",{className:"search-results-list",id:"search-results-channel"},s.results.map((e=>{const t=`${d}://${m}/${e.name}`;return r.createElement("li",{className:"item",key:e.id},r.createElement(ia.Z,{href:t,className:"item-link"},r.createElement(Mn.Z,{logoInfo:{userName:e.title,logoImg:e.avatar_info?.avatar||e.avatar,size:"av80"}}),r.createElement("div",{className:"info"},r.createElement("h2",{className:"title"},e.title),r.createElement(xf,{subscribersNum:e.subscribers_num||0,id:e.id,counterType:"channel"}))),b.ZP.isLogged()&&r.createElement(ik,{channelId:e.id}))}))),"geo"===o&&r.createElement("ul",{className:"search-results-list",id:"search-results-geo"},a.results.map((e=>{const t=`${d}://${m}/hashtags/${encodeURIComponent(e.text)}`;return r.createElement("li",{className:"item",key:e.id},r.createElement(ia.Z,{href:t,className:"item-link"},r.createElement("span",{className:"geo-icon"},r.createElement(yn.Z,{iconName:"geo"})),r.createElement("div",{className:"info"},r.createElement("h2",{className:"title"},Pa.Z.stripGeoId(e.text)),r.createElement(sf,{tagId:e.id,display:"text"}))),b.ZP.isLogged()&&r.createElement(kf,{id:e.id}))})))))},mk=(0,r.memo)(ck);const dk=class{static async getPostFeedLoader(e,t={}){try{const{limit:n=3,req:a,res:s}=t;let{offset:r=0}=t;if("channel_index_loader"===e){let{filter:e}=t,o=await At.ZP.getChannelFeed(n,r,{filter:e,res:s,req:a});return"TOP"===e&&o?.items?.length<1&&(e="OTHER",r=0,o=await At.ZP.getChannelFeed(n,r,{filter:e,res:s,req:a})),{items:o.items,nextOffset:o.nextOffset,nextParams:{filter:e}}}if("channel_sandbox_loader"===e){const e=await At.ZP.getSandboxPosts(n,r,{res:s,req:a});return{items:e.items,nextOffset:e.nextOffset}}return{posts:[],nextOffset:0}}catch(e){return D.Z.promiseHandler("/index.js")(e),{posts:[],nextOffset:0}}}};const pk=(e,t,n,a)=>async(s,r)=>{try{const o=r().postFeed,i=await dk.getPostFeedLoader(e,{...a,offset:t,limit:n}),{items:l=[]}=i;s({type:"POST_FEED_SET_ITEMS",items:0===t?l:[...o.items,...l],hasMoreItems:i?.items?.length>0,nextOffset:i?.nextOffset,nextParams:i?.nextParams||{}})}catch(e){D.Z.promiseHandler("/index.js")(e)}},uk=()=>{const e=(0,aa.C)((e=>e.postFeed)),t=(0,aa.C)((e=>e.app?.meta)),n=(0,aa.T)(),{items:a,type:s,limit:o,offset:i,hasMoreItems:l,params:c}=e,{currentUserPostId:m}=e.params;(0,kr.O)("message",(e=>{"MT_APP_RELOAD_POST_FEED"===e.data.type&&n(pk(s,0,o,c))}));let d=0;return r.createElement("div",{className:"blog-post-list"},r.createElement(zn,{pageStart:0,loadMore:()=>{l&&n(pk(s,i,o,c))},hasMore:l,loader:r.createElement(Yn,null),threshold:400},a.length<1&&!l&&r.createElement("article",{className:"post-card no-posts",key:0},"Здесь пока ничего нет"),a.length>0&&a.map((e=>{d++;const a=m===e.id;return r.createElement(dE,{key:d},r.createElement(HS,{post:e,isCurrentPost:a,showCommentWidget:a,onPostAppear:()=>n(gc()),pageTitle:t?.title,postLabelEnabled:!0,linkTarget:"_self",subscribeButtonEnabled:!0}))})),r.createElement(ty,null),r.createElement(Jb,null)))},gk=(0,ae.Z)((0,r.memo)(uk),"postFeed"),hk=()=>r.createElement(gk,null),_k=(0,ae.Z)((0,r.memo)(hk),"channelTopSandbox"),Ek=()=>r.createElement(gk,null),fk=(0,ae.Z)((0,r.memo)(Ek),"mtIndex");
/**
 * Mirtesen.
 *
 * Bloggers Post List Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const bk=()=>{const e=(0,aa.C)((e=>e.videoList.items)),t=(0,aa.C)((e=>e.app?.req)),n=(0,aa.C)((e=>e.videoList.hasMore)),a=(0,aa.T)();return r.createElement(zn,{loadMore:()=>{a((async(e,t)=>{try{const n=t(),{nextOffset:a,recordsPerPage:s}=n.videoList,r=await vt.default.getVideoFeed({limit:s,offset:a});e({type:"VIDEO_LIST_LOAD_MORE",items:r.items,hasMore:!!r.items.length,nextOffset:r.nextOffset})}catch(e){D.Z.promiseHandler("/index.js")(e)}}))},hasMore:n,threshold:800,loader:null},r.createElement("div",{className:"video-grid"},e.map((e=>{const n=e.videos?.[0],{pandaVideoId:a,player_data:s,title:o}=n||{},{channel:i,from:l,id:c}=e;return r.createElement(dE,{key:a},r.createElement("a",{className:"video-tile",href:`${t.protocol}://${t.host}/video/${c}`},r.createElement("div",{className:"thumb"},r.createElement(_E,{playerData:s})),r.createElement("div",{className:"info"},r.createElement("div",{className:"info-left"},r.createElement(Mn.Z,{logoInfo:{userName:i?.name||l.display_name,logoImg:i?.avatar||l.photo_original,logoClassName:"ava"}})),r.createElement("div",{className:"info-right"},r.createElement("h5",{className:"title"},y.Z.truncateString(o,40)),r.createElement("div",{className:"source"},i?.name||l.display_name),r.createElement(gE,{id:c,postType:EE.ZP.getViewCounterType(e),className:"views",appearence:"string"})))))}))))},yk=(0,ae.Z)((0,r.memo)(bk),"VideoList"),vk=({userId:e})=>{const t=(0,aa.C)((e=>e.userFriendship)),n=(0,aa.T)();if(!e)return null;const a=Tt.Z.determineRelation(t[e]),{isSubscribed:s,canSubscribe:o,isBlacklisted:i}=a;return r.createElement(qn,{onIntersection:([a])=>{a&&!t[e]&&n(nu(e))},margin:"200px"},o&&!i?r.createElement(He.Z,{appearance:"link",label:s?"Отписаться":"Подписаться",color:"primary",title:s?"Отписаться":"Подписаться",onClick:t=>{t.stopPropagation(),b.ZP.isLogged()?n(s?su(e):au(e)):n(_e("login"))}}):null)},Tk=(0,r.memo)(vk),Sk=()=>{const e=(0,aa.C)((e=>e?.videoOne?.video)),t=(0,aa.C)((e=>e?.auth?.user)),[n,a]=(0,r.useState)(!1),{from:s,date:o,url:i,channel:l}=e,c=e.videos[0],m=K.Z.preparePersonPostPreview(n,c);return r.createElement("div",{className:"video-one"},r.createElement("div",{className:"video-player"},r.createElement(hS,{playerData:c?.player_data,embed:c?.player_html})),r.createElement("div",{className:"video-info"},r.createElement("h1",{className:"title"},c?.title),r.createElement("div",{className:"video-header"},r.createElement(Mn.Z,{logoInfo:{logoUrl:l?.url||s.url,userName:l?.name||s.display_name,logoImg:l?.avatar||s.photo_original,logoClassName:"ava"}}),r.createElement("a",{className:"source",href:s.url},r.createElement(WT,{name:l?.name||s.display_name,isVerified:l?.trusted||s.isAuthenticAccount})),r.createElement(tS,{date:o,href:i,target:"_self"}),l?r.createElement(_f,{channelId:l.id,mode:"mini"}):r.createElement(Tk,{userId:s.id})),r.createElement("div",{className:"controls"},r.createElement(Vy,{post:e,showViews:!0,isCurrentPost:!0}),e?.from?.id!==t?.id&&r.createElement(ir,{type:"video-guest",post:e})),m&&r.createElement("div",{className:"desc"},r.createElement("div",{dangerouslySetInnerHTML:{__html:m}}),e.previewText?.length!==e.text?.length&&r.createElement(He.Z,{type:"button",appearance:"link",label:"Eщe",extraClasses:"more",color:"empty",onClick:()=>{a(!n)}}))),r.createElement("div",{className:"video-comments"},r.createElement(Vv,{blogPostId:e.id,showListTitle:!0})))},Pk=(0,ae.Z)((0,r.memo)(Sk),"VideoPage");
/**
 * Mirtesen.
 *
 * Topic Post List Actions.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
const wk=({recommendations:e})=>e.length?r.createElement("div",null,r.createElement("strong",null,"Читайте также:"),r.createElement("ul",{className:"blog-post-recommendations"},e.map((e=>r.createElement("li",{key:e.id},r.createElement("strong",null,r.createElement("a",{target:"_blank",rel:"noopener",href:e.url},e.title))))))):"";wk.propTypes={recommendations:f().array};const Ik=wk;
/**
 * Mirtesen.
 *
 * Topic Partner Post Container.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Ck extends r.Component{constructor(e){super(e);const{topicPartnerPost:t}=this.props;this.modal=r.createRef();const{post:n={},displayType:a}=t;let s=n.text||"";const o=y.Z.escapeRegex(n?.images?.[0]?.url||"").replace(/\//g,"\\/"),i=new RegExp('(<div>\\n?)?<img[\\W\\w]*src=\\"'+o+"[^>]*\\/\\>(<\\/div>)?"),l=/(<a[^>]*>.*?<\/a>)/;s=s.replace(i,""),s=s.replace(/[\r\n]+/g," ");const c=s.split(l);if(s=[],c.forEach((e=>{e.match(l)?s.push(e):s.push(e.replace(/(<img [^>]*?>)/g,'<span class="img-wrapper">$1</span>'))})),s=s.join(""),s+='<div data-pblid="1" id="vplayer_iframe_wrap"></div>',this.text=s,"undefined"!=typeof window){const{id:e,topic:t}=n,s=`/topic/${t}/${e}/${y.Z.toSlug((0,sv.Ro)(n.title))}/${a}`;window.history.pushState(null,"",s+document.location.search)}}componentDidMount=()=>{const{topicPartnerPost:e,onSetMeta:t}=this.props,{post:n,displayType:a}=e;t(this.getPartnerPostMeta(n)),setTimeout((()=>{this.initSpecialLinks()}),300),"undefined"!=typeof window&&"window"===a&&document.getElementsByTagName("html")[0].classList.add("overflow")};componentWillUnmount=()=>{const{app:e,topicPartnerPost:t,onSetMeta:n}=this.props,{post:a}=t,s=`/topic/${a.topic}/`,r=`${e.topic.title} - МирТеcен`;n({title:r,otherMeta:[{title:r}]}),window.history.pushState(null,"",s),document.getElementsByTagName("html")[0].classList.remove("overflow")};getPartnerPostMeta=e=>({title:K.Z.stripTags(e.title),description:K.Z.stripTags(e.preview_text),link:e.url,image:L()(e,"images[0].url")});getLogo=()=>{const{site:e}=this.props.topicPartnerPost.post,t={...L()(e,"siteBuilder.mainLogo.props")};return L()(t,"image")||L()(e,"photo")||null};clickHandler=()=>{const{app:e}=this.props;"/topic/IT/43126556204/glago-l-postigaet-dzen/tab"===e.originalUrl&&na.ym("reachGoal","knopka_zen")};initSpecialLinks=()=>{const e=window.location.search.replace(/^[?&]+|[?&]+$/,"");if(!window.location.search||!document.getElementsByClassName("blog-post__text")||0===document.getElementsByClassName("blog-post__text").length)return;[...document.getElementsByClassName("blog-post__text").item(0).getElementsByClassName("append-get-params")].forEach((t=>{const n=t.getAttribute("href");let a="";a=n.includes("?")?n+"&"+e:n+"?"+e,t.setAttribute("href",a)}))};render(){const{topicPartnerPost:e,toggleModal:t}=this.props,{post:n={},isOpen:a,displayType:s}=e,{partner:o}=n,i="post"===n.post_type?this.getLogo():n?.from?.photo_original,l="post"===n.post_type?n?.group?.display_name:n?.from?.display_name,c="post"===n.post_type?n?.group?.url:n?.from?.url,m=o?.buttonCTA?JSON.parse(o.buttonCTA):{},d="window"===s,p="tab"===s,u=n.recommendations?JSON.parse(n.recommendations):[],g=L()(n,"images[0].url");return r.createElement(r.Fragment,null,a&&o&&r.createElement("div",{className:_()({"blog-post-item":!0,"topic-partner-post__window":"window"===s,"topic-partner-post__tab":"tab"===s}),onClick:()=>{p||t(!1)},ref:this.modal},r.createElement("div",{className:"topic-partner-post__inner",onClick:e=>{e.stopPropagation()}},d&&r.createElement("svg",{className:"topic-partner-post__close",onClick:()=>{t(!1)},width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.createElement("circle",{cx:"12",cy:"12",r:"12",fill:"#FFF"}),r.createElement("path",{d:"M16.851 7.23431C16.5385 6.9219 16.032 6.92189 15.7196 7.23431L12.0426 10.9113L8.36569 7.23431C8.05327 6.92189 7.54673 6.9219 7.23431 7.23431C6.9219 7.54673 6.92189 8.05327 7.23431 8.36569L10.9113 12.0426L7.23431 15.7196C6.9219 16.032 6.9219 16.5385 7.23431 16.851C7.54673 17.1634 8.05327 17.1634 8.36569 16.851L12.0426 13.174L15.7196 16.851C16.032 17.1634 16.5385 17.1634 16.851 16.851C17.1634 16.5385 17.1634 16.032 16.851 15.7196L13.174 12.0426L16.851 8.36569C17.1634 8.05327 17.1634 7.54673 16.851 7.23431Z",fill:"#3C4147"})),r.createElement("div",{className:"topic-partner-post__header"},o.showGroupTitle&&r.createElement("span",{href:c,className:"topic-partner-post__author-logo author-logo"},r.createElement("span",null,r.createElement("a",{href:c},r.createElement("img",{className:"author-logo__photo",src:i,alt:l})),r.createElement("div",{className:"author-logo__inner"},r.createElement("a",{className:"author-logo__title",href:c},l),o.showAuthor&&r.createElement("a",{className:"topic-partner-post__author-name",href:n?.from?.url,target:"_blank"},n?.from?.display_name)))),o.showPromoLabel&&r.createElement("a",{className:"topic-partner-post__partner-label",href:"https://info.mirtesen.ru/promo",target:"_blank"},"Партнерский материал")),r.createElement("div",{className:"blog-post__text"},r.createElement("div",{className:"topic-partner-post__title"},r.createElement("div",{className:"topic-partner-post__title__inner"},n.title)),g&&r.createElement("div",{className:"topic-partner-post__big-img"},r.createElement("span",{className:"img-wrapper"},r.createElement("img",{src:g,className:"topic-partner-post__big-img__inner"}))),r.createElement("div",{className:"topic-partner-post__text-wrapper"},r.createElement("div",{dangerouslySetInnerHTML:{__html:this.text}}),r.createElement("div",null,r.createElement(Ik,{recommendations:u})))),m.url&&r.createElement("div",{className:"topic-partner-post__action-button"},r.createElement("a",{href:m.url,className:"topic-partner-post__action-button-text",target:"_blank",onClick:this.clickHandler},m.text)),r.createElement("div",{className:"topic-partner-post__footer"},r.createElement("div",{className:"post-controls"},r.createElement(Vy,{post:n,voteDisabled:!o.likesEnabled||!o.countersEnable,commentsDisabled:!o.commentsEnabled,shareDisabled:!o.shareEnabled,isCurrentPost:"tab"===s})),o.commentsEnabled&&r.createElement("div",{className:"topic-partner-post__comments"},r.createElement(Vv,{smi2Id:n.smi2_id,disableComments:!o.commentsEnabled,blogPostId:n.id,showImmediately:!0}))))))}}Ck.propTypes={app:f().object,siteBuilder:f().object,topicPartnerPost:f().object,toggleModal:f().func,onSetMeta:f().func};const Nk=(0,i.$j)((e=>({app:e.app,siteBuilder:e.app.siteBuilder,topicPartnerPost:e.topicPartnerPost})),(e=>({toggleModal:t=>{e(((e=!0)=>t=>{t({type:"TOPIC_PARTNER_POST_TOGGLE_MODAL",isOpen:e})})(t))},onSetMeta:t=>{e((e=>({type:"APP_SET_META",meta:e}))(t))}})))((0,ae.Z)(Ck,"TopicPartnerPost")),Ok=()=>r.createElement("div",{className:"covid-map"},r.createElement("a",{href:"https://yandex.ru/maps?utm_medium=mapframe&utm_source=maps"},"Яндекс.Карты"),r.createElement("a",{href:"https://yandex.ru/maps/covid19?ll=41.775590%2C54.89402&scroll=false&utm_medium=mapframe&utm_source=maps&z=3"},"Карта распространения коронавируса в России и мире"),r.createElement("iframe",{src:"https://yandex.ru/maps/covid19?embed=covid-map",allowFullScreen:!0}));
/**
 * Mirtesen.
 *
 * Topic Post List Container.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Mk extends r.PureComponent{render(){const{topicPostList:e,isModalPostOpen:t,onShowMorePosts:n,onShowModal:a}=this.props,{topicTitle:s,topicKey:o}=e;return r.createElement(r.Fragment,null,s&&r.createElement("h1",{className:"topic-post-list-title"},s,"coronavirus"===o.toLowerCase()&&r.createElement("span",null,"Новости и карта распространения")),"coronavirus"===o.toLowerCase()&&r.createElement(Ok,null),r.createElement(Hv,{topicKey:o,onLoadMore:n,onShowModal:a,id:"topicPostList",gridView:"common"}),t&&r.createElement(Nk,null),r.createElement(B_,{split:.3},r.createElement(R_,{adId:10091}),r.createElement(Fh,{type:"Politpiar",id:100156})))}}Mk.propTypes={onShowMorePosts:f().func,onShowModal:f().func,isModalPostOpen:f().bool,topicPostList:f().object};const kk=(0,i.$j)((e=>({topicPostList:e.topicPostList,isModalPostOpen:e.topicPartnerPost.isOpen})),(e=>({onShowMorePosts:()=>{e((async(e,t)=>{try{const n=t(),{page:a,recordsOnPage:s}=n.postTiles.topicPostList;let{posts:r}=n.postTiles.topicPostList;const{topicKey:o,filter:i}=n.topicPostList,l=a+1,c=await Js.getBlogPostsByTopic({topic:o,offset:(l-1)*s,count:s,filter:i,withBusinessPosts:!1});if(r=[...r,...c],r=r.filter((e=>e.images.length>0)),r=K.Z.removeDuplicates(r),l>0){const e="page="+l;let t=window.location.href;const n=/page=\d+/i;t=t.replace(n,"").replace("?&","?").replace(/(&|\?)+$/,""),t=-1!==t.indexOf("?")?t+"&"+e:t+"?"+e,window.history.pushState(null,"",t)}e({type:"POST_TILES_LOAD_MORE",id:"topicPostList",posts:r,hasMore:c.length>=s,page:l})}catch(e){D.Z.promiseHandler("/index.js")(e)}}))},onShowModal:t=>{e((e=>async t=>{const n=await Fp.getByUrl(/^http/.test(e.url)?e.url:`http:${e.url}`);t({type:"TOPIC_PARTNER_POST_MODAL_SET_POST",post:{...e,site:{...n.site,siteBuilder:n.siteBuilder}}})})(t))}})))((0,ae.Z)(Mk,"TopicPostList"));
/**
 * Mirtesen.
 *
 * Topic partner post layout.
 *
 * @author       Vitaly Vatutin.
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Ak extends r.PureComponent{render(){const{app:e,page:t}=this.props,n=t;return r.createElement("div",{id:"topic-partner-post-layout",className:_()({"topic-partner-post-layout":!0})},r.createElement(Jp,{app:e}),r.createElement(n,{app:e}))}}Ak.propTypes={app:f().object,page:f().oneOfType([f().func,f().object])};const xk=(0,ae.Z)(Ak,"platform/topicPartnerPostLayout"),Lk=({firstButton:e,secondButton:t,currentFilter:n})=>r.createElement("div",{className:"post-list-filter-switcher"},r.createElement("div",{className:"post-list-filter-switcher__content"},r.createElement("div",{className:_()({"post-list-filter-switcher__switcher":!0,"post-list-filter-switcher__switcher_switched":n===t.filter})}),r.createElement("button",{className:_()({"post-list-filter-switcher__button":!0,"post-list-filter-switcher__button_active":n===e.filter}),onClick:e.cb},e.text),r.createElement("button",{className:_()({"post-list-filter-switcher__button":!0,"post-list-filter-switcher__button_active":n===t.filter}),onClick:t.cb},t.text)));Lk.propTypes={firstButton:f().object,secondButton:f().object,currentFilter:f().string};const Dk=Lk;var Rk="/index.js";
/**
 * Mirtesen.
 *
 *  Polls Post List Actions.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
/**
 * Mirtesen.
 *
 * Polls Post List container.
 *
 * @author       Olga Efimova.
 * @copyright    Copyright (c) 2020, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Zk extends r.PureComponent{componentDidMount(){window.addEventListener("message",this.handleGetMessage)}componentWillUnmount(){window.removeEventListener("message",this.handleGetMessage)}handleGetMessage=e=>{const{onTogglePollVisibility:t}=this.props;"MT_APP_HIDE_POLL"===e?.data?.type&&t(e.data.id,"hide"),"MT_APP_HIDE_POST"===e?.data?.type&&t(e.data.id,"abuse")};infinitePollList=r.createRef();render(){const{polls:e=[],hasMore:t,onShowMorePolls:n,onShowMtPostEditor:a,personVislvl:s,currentFilter:o,hiddenPolls:i,onTogglePollVisibility:l,isMobile:c,user:m,openAuthForm:d}=this.props;let p=[],u=0;for(let t=0;u<e.length;t++){if(t>8){p=[...p,...e.slice(5).map((e=>r.createElement(Rv,{key:e.id},r.createElement(wv,{isPoll:!0,imageUrl:y.Z.cropImage(e.attachments?.[0]?.poll?.fileUri||null,1280),post:e,hideStatus:i[e.id]||"",onTogglePollVisibility:l}))))];break}const n=Math.floor(t/3)%3,a=t%3;let s=null;switch(!0){case 0===n&&2===a:s=6010;break;case 1===n&&1===a:s=6020;break;case 2===n&&0===a:s=6030}if(s){p.push(r.createElement(Fh,{key:"politpiar-99810",type:"Politpiar",id:99810,style:{width:300,height:300}}));continue}const o=e[u];p.push(r.createElement(Rv,{key:o.id},r.createElement(wv,{isPoll:!0,imageUrl:y.Z.cropImage(o.attachments?.[0]?.poll?.fileUri||null,1280),post:o,hideStatus:i[o.id]||"",onTogglePollVisibility:l}))),++u}return r.createElement(r.Fragment,null,r.createElement("div",{className:"topic-post-list__header-wrapper"},r.createElement("h1",{className:"topic-post-list-title"},"Опросы в МирТесен"),c?r.createElement("p",null,"Голосуйте в созданных опросах и придумывайте свои варианты вопросов и ответов на этой странице."):r.createElement(r.Fragment,null,r.createElement("p",null,"Чтобы быть объективным, иногда нужно понимать, как относятся к тому или иному вопросу другие люди, например, читатели статьи или простого поста на своей страничке в соцсети. Для этого используются опросы — выяснения мнения сообщества по разным темам."),r.createElement("p",null,'Как вы знаете, в МирТесен тоже есть возможность создания простой "голосовалки".'," ",r.createElement("a",{href:"https://i.gyazo.com/ce22236c9afb909801647db6ab44a5f4.gif",target:"_blank"},'Для этого достаточно нажать кнопку "Опрос" при создании публикации.')," Выбираете оформление, цвет, подгружаете, если нужно, фото и опрос готов. На этой странице собраны популярные и самые свежие опросы, созданные в МирТесен. Узнайте мнение друзей и подписчиков! Создайте свой опрос!")),r.createElement("div",{className:"btn btn-primary topic-post-list__create-poll-btn",onClick:()=>{m?.id||d(),a({author:{id:m.id,name:m.display_name,image:m.photo_original||""},target:{type:"user",id:m.id,birthday:m.bdate},personVislvl:s,activeTab:"poll"})}},"Создать опрос")),r.createElement(Dk,{currentFilter:o,firstButton:{text:"Популярное",filter:"popular",cb:()=>{window.location.href=Rp().mainProto+"://"+Rp().mainDomain+"/polls/popular"}},secondButton:{text:"Новое",filter:"new",cb:()=>{window.location.href=Rp().mainProto+"://"+Rp().mainDomain+"/polls/new"}}}),r.createElement("div",{className:"topic-post-list",ref:this.infinitePollList},r.createElement(zn,{loadMore:()=>n(),hasMore:t,threshold:800},p)))}}Zk.propTypes={polls:f().array,polls2:f().array,hasMore:f().bool,hiddenPolls:f().object,currentFilter:f().string,onShowMorePolls:f().func,onTogglePollVisibility:f().func,openAuthForm:f().func,user:f().object,personVislvl:f().string,isMobile:f().bool,onShowMtPostEditor:f().func};const Bk=(0,i.$j)((e=>({polls:e.pollList.polls,hasMore:e.pollList.hasMore,hiddenPolls:e.pollList.hiddenPolls,currentFilter:e.pollList.currentFilter,user:e.auth.user,personVislvl:e?.personSettings?.vislvl,isMobile:e.app.isMobile})),(e=>({onShowMorePolls:()=>{e((async(e,t)=>{try{const n=t(),{recordsOnPage:a,page:s,currentFilter:r,polls:o}=n.pollList,i=await Mt.getList({type:r,count:a,offset:s*a})||[],l=Mt.removeDuplicates([...o,...i],"id");e({type:"POLLS_POST_LIST_LOAD_MORE",page:s+1,hasMore:!!i.length,polls:[...l]})}catch(e){D.Z.promiseHandler(Rk)(e)}}))},onTogglePollVisibility:(t,n)=>{e(((e,t="hide")=>n=>{if("abuse"===t)return n({type:"POLLS_POST_LIST_TOOGLE_POLL_VISIBILITY",params:t,pollId:e});Mt.togglePollVisibility(e,t).then((a=>{a&&n({type:"POLLS_POST_LIST_TOOGLE_POLL_VISIBILITY",params:t,pollId:e})})).catch(D.Z.promiseHandler(Rk))})(t,n))},openAuthForm:()=>{e(_e("login"))},onShowMtPostEditor:t=>{e(Rt("default",null,t))}})))((0,ae.Z)(Zk,"pollList"));
/**
 * Mirtesen.
 *
 * Error 404
 *
 * @author       Efimova Olga
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class $k extends r.PureComponent{constructor(e){super(e),this.state={popularPosts:[]}}async componentDidMount(){const e=(await vp.getPopularBlogPosts({type:"COMMENTED",limit:5,offset:Math.floor(Math.random()*Math.floor(20)),params:{fieldList:"tile"}})).filter((e=>e.images.length>0));this.setState({popularPosts:e})}render(){const{popularPosts:e=[]}=this.state;return r.createElement("div",{className:"topic-post-list"},e.length>1&&r.createElement(r.Fragment,null,r.createElement(Rv,{size:1},r.createElement(wv,{post:e[0],imageUrl:y.Z.cropImage2(e[0]?.images[0]?.url),enableModeration:!1})),r.createElement("div",{className:"error-ad-blocks__item"},r.createElement(Fh,{type:"Politpiar",id:99810,style:{width:300,height:300}})),r.createElement(Rv,{size:1},r.createElement(wv,{post:e[1],imageUrl:y.Z.cropImage2(e[1]?.images[0]?.url),enableModeration:!1}))))}}const Uk=$k;
/**
 * Mirtesen.
 *
 * Error 404
 *
 * @author       Efimova Olga
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Hk extends r.PureComponent{render(){const{app:{errorMessage:e,errorSubMessage:t="Уточните адрес или почитайте интересные материалы нашей соцсети:"}}=this.props;return r.createElement("div",{className:"error-page"},r.createElement("h1",{className:"error-page__title"},e),r.createElement("p",{className:"error-page__subtitle"},t),r.createElement(Uk,null))}}Hk.propTypes={app:f().object};const Fk=(0,ae.Z)(Hk,"error4xx");
/**
 * Mirtesen.
 *
 * Error 500
 *
 * @author       Efimova Olga
 * @copyright    Copyright (c) 2019, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class jk extends r.PureComponent{render(){const{app:{errorMessage:e}}=this.props;return r.createElement("div",{className:"error-page"},r.createElement("h1",{className:"error-page__title"},e),r.createElement("p",{className:"error-page__subtitle"},"Если вы видите это сообщение, значит, команда МирТесен работает над улучшением сайта и скоро всё будет хорошо."),r.createElement("p",{className:"error-page__subtitle"},"А пока предлагаем посмотреть подборку интересных постов:"),r.createElement(Uk,null))}}jk.propTypes={app:f().object};const Gk=(0,ae.Z)(jk,"error5xx");class qk extends r.PureComponent{static propTypes={userName:f().string,logoImg:f().oneOf([f().string,f().object]),logoUrl:f().string,errorMessage:f().string,errorSubMessage:f().string,isPhoneVerified:f().bool,personId:f().number,userFriendship:f().object,addToFriend:f().func,isLogged:f().bool,onUnsubscribeFromUser:f().func,onSubscribeToUser:f().func};render(){const{userName:e,logoImg:t,logoUrl:n,errorMessage:a,errorSubMessage:s,isLogged:o,personId:i}=this.props;return r.createElement("div",{className:"error-page__person-restriction person-restriction"},n&&r.createElement(Mn.Z,{logoInfo:{userName:e,logoImg:t,logoUrl:Fp.addUtmToUrl(n),logoClassName:"person-restriction__user-logo",size:"av80"}}),!n&&r.createElement("img",{src:`${K.Z.getStaticHost()}/images/empty-user.png`,alt:"User not found",className:"person-restriction__user-logo"}),e&&r.createElement("h3",{className:"error-page__person-restriction person-restriction__user-name"},e),o&&r.createElement("div",{className:"person-restriction__actions"},r.createElement(ou,{userId:i})),a&&r.createElement("h1",{className:"person-restriction__error-title"},a),r.createElement("div",{className:"person-restriction__message"},s),r.createElement(Uk,null))}}const Vk=(0,i.$j)((e=>{const{photo_original:t,display_name:n,url:a=null,id:s}=e.app?.person||{};return{logoImg:t,userName:n,logoUrl:a,personId:s,errorMessage:e.app.errorMessage,errorSubMessage:e.app.errorSubMessage,isLogged:!!e.auth.user}}),null)((0,ae.Z)(qk,"personRestrictions")),zk=({app:e})=>{const{query:t={}}=e.req,n=t.id||"",a=e.statId,s=[];Object.keys(t).forEach((e=>{["utm_content","utm_medium","utm_source","utm_campaign"].indexOf(e)>-1&&s.push(`${e}=${t[e]}`)}));const o=`https://f.mt.ru/r/${a}?id=${n}&${s.join("&")}`;return(0,r.useEffect)((()=>{na.ym("reachGoal","view_fullscreen_mob_banner_cont")}),[]),r.createElement("div",{className:"app-promotion-landing"},r.createElement("div",{className:"app-promotion-landing__banner"},r.createElement("i",{className:"app-promotion-landing__logo"}),r.createElement("h3",{className:"app-promotion-landing__title"},"Читать статью в удобном приложении"),r.createElement("a",{href:o,className:"btn app-promotion-landing__actions-btn",onClick:e=>{e.preventDefault(),na.ym("reachGoal","click_CTA_fullscreen_mob_banner_cont"),window.location.href=o}},"Читать в приложении")),r.createElement("a",{href:`https://mirtesen.ru/url?e=pad_click&pad_page=0&blog_post_id=${n}`,className:"app-promotion-landing__actions-close",onClick:e=>{e.preventDefault(),na.ym("reachGoal","click_grey_text_fullscreen_mob_banner_cont"),window.location.href=`https://mirtesen.ru/url?e=pad_click&pad_page=0&blog_post_id=${n}`}},"Читать в браузере"))};zk.propTypes={app:f().object};const Wk=(0,r.memo)(zk);
/**
 * Mirtesen.
 *
 * Cat Fish implementation for React.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Yk extends r.PureComponent{static defaultProps={postsScrolled:0};constructor(){super(),this.state={show:!1,closedAtPost:0}}componentDidMount(){this.init()}componentDidUpdate(){const{show:e,closedAtPost:t}=this.state;if(e)return;const{postsScrolled:n}=this.props;n>=t+3&&this.init()}canShow(){return!1}init(){this.canShow()&&setTimeout((()=>{let e=!0;const t={minWidth:-1,maxWidth:-1},{minWidth:n,maxWidth:a}=t;if(n>=0||a>=0){const t=window,s=document,r=s.documentElement,o=s.getElementsByTagName("body")[0],i=t.innerWidth||r.clientWidth||o.clientWidth;(i<n&&n>=0||i>a&&a>=0)&&(e=!1)}this.setState({show:e})}),200)}render(){const{postsScrolled:e}=this.props;return this.canShow()?r.createElement("div",{className:_()({"footer-ad-block":!0,show:this.state.show})},r.createElement(R_,{adId:10090}),r.createElement("div",{className:"footer-ad-block__close",onClick:()=>{this.setState({show:!1,closedAtPost:e})}})):null}}Yk.propTypes={postsScrolled:f().number,mobileApp:f().bool,page:f().string,scope:f().string,isMobile:f().bool};const Kk=(0,i.$j)((e=>({postsScrolled:e.footerCatFish.postsScrolled,mobileApp:e.app?.req?.mobileApp||!1,page:e.app?.page||null,scope:e.app?.scope||null,isMobile:"phone"===e.app?.req?.deviceType})))(Yk);
/**
 * Mirtesen.
 *
 * Olnl Stat Component.
 *
 * @author       Yuri Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Jk extends r.PureComponent{componentDidMount(){const{siteId:e}=this.props;k()("https://trk.olnl.net/json?views="+encodeURIComponent(`[["mtg", "${e}"]]`)).catch((e=>{console.warn(e)}))}render(){return r.createElement(r.Fragment,null)}}Jk.propTypes={siteId:f().oneOfType([f().string,f().number])};const Xk=Jk;
/**
 * Mirtesen.
 *
 * Counter Components.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2021, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class Qk extends r.PureComponent{componentDidMount(){const{scope:e,channelId:t,channelPostId:n,siteId:a,disableStatMedia:s,blogPost:r,channelAnalytics:o}=this.props,{channelStatmedia:i,mirtesenStatmedia:l}=ni.metrics;if(!s){let s,c;const m=b.ZP.getCurrentUser();"channel"===e?(s=i,c=gd.prepareParams({scope:e,user:m,channelId:t,channelPostId:n})):(s=l,c=gd.prepareParams({scope:e,user:m,siteId:a,blogPost:r})),gd.setCounters(s,c);const d=["NovostnoyAgregatorSMI2"];Sa()(o?.liveInternet)||d.push(o?.liveInternet),_d.setCounters(d)}this.initYandexMetrika(),this.initGoogleAnalitics()}initGoogleAnalitics=()=>{const{scope:e,siteUrl:t,siteMetrics:n,disableGoogleAnalytics:a}=this.props;if(a)return;const{googleAnalytics:s,googleAnalytics2:r}=ni.metrics;let o=[];"channel"===e?o.push(r.accountId):o.push(s.accountId),"blog"===e&&n.googleAnalyticsAccountId&&o.push(n.googleAnalyticsAccountId),o=o.filter((e=>e)),Ed.init(o,t)};initYandexMetrika=()=>{const{scope:e,channelAnalytics:t,disableYandexMetrics:n,siteMetrics:a,topicPartnerPost:s}=this.props;if(n)return;const r=(0,Ll.I8)(ni.metrics),{newYaMetrics:o,channelYaMetrics:i}=r,l={id:[],version:"2",options:{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!1}},c=this.getUserParams();o.options={...o.options,...c},o.options.userParams={...c},o.userParams={...c},"channel"===e&&(Sa()(t?.yandexMetrics)||o.id.push(Number(t?.yandexMetrics)),o.id.push(Number(i))),a.yandexMetricaAccountId&&l.id.push(Number(a.yandexMetricaAccountId));const m=s?.post?.partner?.yandexMetricaCounterId;m&&l.id.push(Number(m)),Sa()(o?.id)||na.init(o.id,o.options),Sa()(l?.id)||na.init(l.id,o.options)};getUserParams=()=>{const e=b.ZP.getCurrentUser(),t={};if(e){if(t.visitorType="registered",2===parseInt(e.sex,10)&&(t.gender="male"),1===parseInt(e.sex,10)&&(t.gender="female"),e.bdate){const n=y.Z.bdateToAge(e.bdate);n<10?t.ageGroup="<10":n>=10&&n<15?t.ageGroup="10-15":n>=15&&n<20?t.ageGroup="15-20":n>=20&&n<25?t.ageGroup="20-25":n>=25&&n<30?t.ageGroup="25-30":n>=30&&n<35?t.ageGroup="30-35":n>=35&&n<40?t.ageGroup="35-40":n>=40&&n<45?t.ageGroup="40-45":n>=45&&n<50?t.ageGroup="45-50":n>=50&&n<55?t.ageGroup="50-55":n>=55&&n<60?t.ageGroup="55-60":n>=60&&n<65?t.ageGroup="65-65":n>=65&&n<70?t.ageGroup="65-70":n>=70&&(t.ageGroup=">70")}}else t.visitorType="guest";return t};render(){const{siteId:e}=this.props;return e&&r.createElement(Xk,{siteId:e})}}Qk.propTypes={siteId:f().number,siteMetrics:f().object,blogPost:f().object,siteUrl:f().string,scope:f().string,mobileApp:f().bool,topicPartnerPost:f().object};const eA=(0,i.$j)((e=>({siteId:e?.app?.site?.id||null,channelId:e?.app?.channel?.id,channelAnalytics:e?.app?.channel?.analytics,channelPostId:e?.channelMain?.currentUserPostId,siteMetrics:e?.app?.metrics||{},blogPost:e?.blogPost||null,siteUrl:e?.app?.originalUrl||null,scope:e?.app?.scope||"blog",mobileApp:e?.app?.req?.mobileApp||!1,topicPartnerPost:e?.topicPartnerPost||{},disableStatMedia:e?.app.disableStatMedia,disableGoogleAnalytics:e?.app?.disableGoogleAnalytics,disableYandexMetrics:e?.app.disableYandexAnalytics})))((0,ae.Z)(Qk,"counter"));var tA=n(35830);const nA=()=>r.createElement(r.Fragment,null,r.createElement(tA.LexicalEditor,{text:"test"})),aA=(0,r.memo)(nA),sA=()=>r.createElement("div",null,"test"),rA=(0,r.memo)((()=>{const e=(0,aa.C)((e=>e.app.isMobile)),t=["appSupport"],n=["appGooglePlay","appStore"];return r.createElement("div",{className:"about-platform__content-wrapper"},r.createElement("div",{className:"about-platform__content"},r.createElement("div",null,r.createElement("section",null,r.createElement("h2",{className:"about-platform__title"},"Чтобы удалить аккаунт"),r.createElement("ol",null,r.createElement("li",null,"Откройте приложение МирТесен на устройстве и войдите в свой аккаунт, если вы не авторизованы"),r.createElement("li",null,"Нажмите на аватар профиля в левом верхнем углу экрана"),r.createElement("li",null,"В появившемся меню, прокрутите вниз и нажмите ",r.createElement("b",null,"Удалить аккаунт")),r.createElement("li",null,"В появившемся диалоговом окне также нажмите ",r.createElement("b",null,"Удалить аккаунт"),", чтобы подтвердить удаление"))),e&&r.createElement(iN,{isMenu:!0,save:n,contacts:t})),r.createElement(iN,{isMenu:!0,save:n,contacts:t})))})),oA=(0,ae.Z)(rA,"RemoveAccount"),iA=({postId:e})=>{const t=(0,aa.T)(),[n,a]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{(async()=>{const n=await vt.default.getUserPostById(e);if(!n)return null;const s=await At.ZP.getChannelById(n.channel.id,{reqType:"full"});s&&(t(((e,t)=>({type:"CHANNEL_POST_INIT",channel:e,post:t}))(s,n)),t((({title:e,url:t,referer:n})=>async(a,s)=>{if("undefined"==typeof window)return;const r=s(),o=r?.app?.site?.id||null,i=r?.app?.channel?.id,l=r?.channelMain?.currentUserPostId,c=r?.blogPost||null,m=r?.app?.scope||"blog",d=r?.app.disableStatMedia,p=r?.app.disableYandexAnalytics,u=r?.app.disableGoogleAnalytics,g=r?.app.disableLiveInternet,{channelStatmedia:h,mirtesenStatmedia:_}=ni.metrics;if(!d){let e,t;const n=pd.getCurrentUser();"channel"===m?(e=h,t=gd.prepareParams({scope:m,user:n,channelId:i,channelPostId:l})):(e=_,t=gd.prepareParams({scope:m,user:n,siteId:o,blogPost:c})),gd.setCounters(e,t)}p||na.ym("hit",t,{title:e,referer:n}),g||_d.reloadCounters(),u||Ed.gtag("event","page_view",{page_title:e,page_location:t})})({title:Wp.getMainPostTitle(n,s.title),url:n?.url,referer:document.referrer})),a(!0))})()}),[]),n?r.createElement(O.Z,{wrapperClassName:"channel-post-popup",enableClose:!1,onClose:()=>{t(Id(null))}},r.createElement(eb,{type:"post-popup-header",uniqKey:"post-popup-very-top-header"}),r.createElement(PM,{mode:"popup"})):null},lA=(0,ae.Z)((0,r.memo)(iA),"channelPostPopup"),cA=e=>{ya.Z.set(Oa,JSON.stringify(e),{expires:31536e3})},mA=()=>{const{req:{ip:e}}=(0,aa.C)((e=>e.app)),t=(0,aa.C)((e=>e.geoPosition)),n=(0,aa.T)();return(0,kr.O)("message",(e=>{var a;"MT_APP_SET_NAVIGATOR_GEOLOCATION"===e.data.type&&n((a=e.data.geolocation,async(e,t)=>{let n,s,r,o,i;try{e(ka(!0));const l=t();let c,m,d,p;if(o=l.geoPosition.preferredSource,i=l.geoPosition.currentSource,a.result?(s="navigatorGeolocation",r="navigatorGeolocation",c=!0,m=!1,d=a.lon,p=a.lat):(1==a.errorCode?(c=!1,m=!0):(c=!1,m=!1),kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:"Не удалось определить точное местоположение. Проверьте настройки браузера"}),console.log("Geolocation Error: "+a.errorCode)),n={status:c,accessDenied:m,navigatorLon:d,navigatorLat:p},!d||!p)throw new Error("Empty navigator lon lat");let u=await va.Z.getReverseInfoWithGeoCoder(p,d);if(!u||u.error)throw new Error("Empty base osm info");const{road:g,quarter:h,suburb:_,county:E,city:f,addrState:b,country:y}=u?.address||{},v=[];v.push(g),v.push(h),v.push(_),v.push(E),v.push(f),v.push(b),v.push(y);const T=v.filter((e=>!Sa()(e))).join(", ").trim();if(!T)throw new Error("Empty osm title");if(u=(await va.Z.searchWithGeocoder(T))[0],!u)throw new Error("Empty extended osm info");const{displayName:S,displayAddress:P}=va.Z.normalizeOsmInfo(u);e({type:"GEO_POSITION_SET_NAVIGATOR_GEOLOCATION",currentSource:s,navigatorGeolocation:{...n,osmSid:va.Z.makeOsmSid(u),title:S,description:P,lon:Number(u.lon),lat:Number(u.lat)}}),e(Ra({title:S})),e(xa(r)),e(ka(!1))}catch(t){s=i&&"navigatorGeolocation"!==i?i:"ip",r=o&&"navigatorGeolocation"!==o?o:"ip",e({type:"GEO_POSITION_SET_NAVIGATOR_GEOLOCATION",currentSource:s,navigatorGeolocation:n}),e(xa(r)),e(ka(!1))}})),"MT_APP_DELETE_CUSTOM_TAG"===e.data.type&&(e.data.id===t.customTag?.id?(n(xa("ip")),n(Aa("ip"))):kt.Z.sendMessage({type:"MT_APP_RELOAD_POST_FEED"}))})),(0,r.useEffect)((()=>{(async()=>{const e=ya.Z.get(Na);let t,a=ya.Z.get(Oa);a=JSON.parse(a||"{}"),"navigatorGeolocation"===e?(Ma(),t=void 0):t="customTag"===e&&!a?.tagId||"osmTag"===e&&!a?.osmSid?"ip":e||"ip","ip"==t?n(Aa(t)):"osmTag"==t?n(La(a?.osmSid)):"customTag"==t&&n(Da(a?.tagId))})()}),[]),(0,r.useEffect)((()=>{"ip"===t?.currentSource&&n((e=>async t=>{let n,a,s,r;t(ka(!0)),r="development"===re.Z.getConfig().mode?{id:"80652620144",text:"г. Челябинск [1338182]"}:await Ca.getGeoTagByIp(e);const o=r?.id,i=r?.text;if(r?.id){let e=await Pa.Z.getTagLocation(Number(r?.id));e=e||{},n=e.lon,a=e.lat,s=va.Z.makeOsmSid(e||{})}t({type:"GEO_POSITION_SET_BY_IP",info:{geoTagTitle:i,geoTagId:o,osmSid:s,lon:n,lat:a}}),t(xa("ip")),t(Ra({title:r?.text||"Планета Земля"})),t(ka(!1))})(e))}),[t?.currentSource]),(0,r.useEffect)((()=>{(async e=>{let t=ya.Z.get(Oa);t=JSON.parse(t||"{}");const n=Number(t?.lon),a=Number(t?.lat);let s=!1;switch(e.currentSource){case"navigatorGeolocation":{const t=e.navigatorGeolocation,r=Number(t.lon),o=Number(t.lat);n===r&&a===o||(cA({lon:Number(t.lon),lat:Number(t.lat)}),await Ca.saveCurrentGeoPosition({osmSid:t.osmSid,lon:Number(t.lon),lat:Number(t.lat)}),s=!0);break}case"ip":{const n=e?.ip?.geoTagId;t?.tagId!==n&&(cA({tagId:n}),await Ca.saveCurrentGeoPosition({tagId:n,osmSid:e?.ip?.osmSid,lon:e?.ip?.lon,lat:e?.ip?.lat}),s=!0);break}case"osmTag":{const{osmSid:n}=e?.osmTag,a=await va.Z.getOsmInfo(n);t?.osmSid!==n&&(cA({osmSid:n}),await Ca.saveCurrentGeoPosition({osmSid:n,lon:a.centroid?.coordinates?.[0],lat:a.centroid?.coordinates?.[1]}),s=!0);break}case"customTag":{const{id:n}=e?.customTag,a=await Pa.Z.getGeotagById(n);t?.tagId!==n&&(cA({tagId:n}),await Ca.saveCurrentGeoPosition({tagId:n,osmSid:a?.osmSid,lon:a?.lon,lat:a?.lat}),s=!0);break}}s&&kt.Z.sendMessage({type:"MT_APP_RELOAD_POST_FEED"})})(t)}),[t?.currentSource,t?.osmTag?.osmSid,t?.navigatorGeolocation?.osmSid,t?.navigatorGeolocation?.navigatorLon,t?.navigatorGeolocation?.navigatorLat,t?.ip?.ip,t?.customTag?.id]),"undefined"!=typeof window&&pd.isDeveloper()&&(console.log("--geoPosition--"),console.log({...t})),null},dA=(0,ae.Z)((0,r.memo)(mA),"geoPosition");
/**
 * Mirtesen.
 *
 * App Container.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2017, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
class pA extends r.Component{constructor(e){super(e);if(!this.props.app.noAuth){const e={onBeforeChange:()=>{"undefined"!=typeof window&&window.location.reload()}};this.props.initAuth(e)}this.state={repostIds:[]}}componentDidMount(){const{checkAdBlocker:e}=this.props,t=document.createElement("div");t.innerHTML="&nbsp;",t.className="adsbox",document.body.appendChild(t),window.setTimeout((()=>{0===t.offsetHeight?e(!0):e(!1),t.remove()}),1e3),window.addEventListener("message",this.handleGetMessage)}componentWillUnmount(){window.removeEventListener("message",this.handleGetMessage)}handleGetMessage=e=>{const{onChangeMemberCount:t,onSetChannelAvatar:n,onDeleteChannelAvatar:a}=this.props;switch(e.data.type){case"MT_APP_CHANGE_MEMBER_COUNT":t(e.data.value);break;case"MT_APP_CHANNEL_HEADER_SET_AVATAR":n(e.data.params);break;case"MT_APP_CHANNEL_HEADER_DELETE_AVATAR":a();break;default:return}};layouts={OneColumnLayout:t_,TwoColumnLayout:__,BlogPostLayout:Yh,EmptyLayout:Od,ContentLayout:Jh,VideoListMock:Xh,VideoOneMock:Qh,CnannelLayoutMock:e_,MainDomainLayout:q_,PostListLayout:E_,PeopleTwoColumnLayout:F_,PeopleOneColumnLayout:G_,MtTwoColumnLayout:J_,AboutPlatformLayout:z_,TopicPartnerPostLayout:xk,ErrorPageLayout:Q_,IndexLayout:tE,MessengerLayout:iE,VideoListLayout:cE,VideoOneLayout:vE,ChannelLayout:nb,RichPostEditorLayout:lb};pages={appPlatform:GN,blogPostList:jS,blogPost:Wv,blogPostDispute:Kv,staticPage:tw,blogPostEditor:OT,blogMember:Fb,siteSettings:QP,personSettings:gO,promotion:Ow,editComments:Rw,blogModerators:Yb,stat:z,groups:AI,billing:LI,blogCommentPage:lw,blogPostNotifications:Ib,personWall:fO,personPosts:yO,personComments:MO,personFriends:IO,personSites:UO,personPhotos:fO,personProfile:RO,personPrivateMedia:LO,personEvents:AO,personVideos:fO,aboutPlatform:EN,newsListPlatform:vN,newsItemPlatform:NN,partnersPlatform:MN,promoPlatform:LN,agreementPlatform:RN,glagolPlatform:BN,recommendationRules:VN,removeAccount:oA,testPageForComments:zw,topicPostList:kk,topicPartnerPost:Nk,error4xx:Fk,error5xx:Gk,personRestriction:Vk,indexMainAuthorized:gC,accountConsolidation:FO,pollList:Bk,unsubscribeByEmail:GO,popularPostsList:fC,bloggersPostsList:yC,appPromotionLanding:Wk,createSitePage:Vw,feedback:ZC,billingList:SC,activitiesList:wC,pad:Uw,publicChatsList:$C,mtSearchPage:VC,recoveryPasswordStep1:gI,recoveryPasswordStep2:_I,authPage:bI,testApi:WC,testDraftJs:aA,testChannel:sA,userInterests:cM,hashtagPostList:aN,channelMain:vM,channelPost:PM,richPostEditor:OM,myChannels:xM,videoList:yk,videoOne:Pk,mtSearchResultsPage:mk,channelTopSandbox:_k,mtIndex:fk};render(){const{app:e,mobileApp:t,isMobile:n,userId:a}=this.props,{repostIds:s}=this.state,o=e.layout||"OneColumnLayout",i=e.page||"",l={app:!0};l[y.Z.toSlug(i)+"-page"]=!0;const c=this.layouts[o],m=this.pages[i],d=_C(L()(e,"req.headers.user-agent"));return r.createElement("div",{className:_()(l)},r.createElement(W.O.Provider,{value:{browser:e?.req?.browser?.name||null}},r.createElement(c,{app:e,page:m}),r.createElement(eA,null),r.createElement(Et,null),r.createElement(hb,null),!t&&!n&&r.createElement(yb,{userId:a}),!t&&["ios","android"].includes(d)&&"appPromotionLanding"!==i&&"channel"!==e.scope&&r.createElement(mb,null),r.createElement(hC.ZP,{handleHeight:!0,onResize:()=>{if(document.getElementById("three-column-container")){const e={};e.mainContentHeight=document.getElementById("three-column-container").offsetHeight,window.parent.postMessage(e,"*")}},refreshRate:70}),b.ZP.isLogged()&&r.createElement(Co,{identifier:"default",callbacks:{add:(e,t)=>{const{repostId:n,repostType:a,author:r={},target:o={}}=t;if(n){const t=`Материал размещен на вашей странице и доступен по этой <a href="/people/${r?.id}/blog/${e}">ссылке</a>`;return s.includes(n)||kt.Z.sendMessage({type:"MT_APP_CHANGE_REPOSTS_COUNT",id:n,count:1,postType:a}),kt.Z.sendMessage({type:"MT_APP_SHOW_SYSTEM_POPUP",text:t,className:"mt-post-editor__repost-tooltip"}),void this.setState({v:s.push(n)})}const i="channel"===o.type?`/${o.channelName||o.id}/${e}`:`/people/${o.id}/blog/${e}`;window.location.href=i},edit:(e,t)=>{const{target:n={}}=t,a="channel"===n.type?`/${n.channelName||n.id}/${e}`:`/people/${n.id}/blog/${e}`;window.location.href=a}},params:{showHoliday:!0,showPoll:!0},topicList:Cd.listTopics.filter((e=>e.theme))}),"channel"===e.scope&&b.ZP.isLogged()&&r.createElement(r.Fragment,null,r.createElement(Bo,null),r.createElement(rk,null)),e.showChannelPostPopup&&r.createElement(lA,{postId:e.showChannelPostPopup}),r.createElement(Jo,null),r.createElement(ZC,{isModalMode:!0}),r.createElement(ie,null),b.ZP.isLogged()&&r.createElement(dA,null),r.createElement(mI,null),r.createElement(Kk,null)))}}pA.propTypes={app:f().object,initAuth:f().func,checkAdBlocker:f().func,mobileApp:f().bool,isMobile:f().bool,host:f().string,userId:f().number,onChangeMemberCount:f().func,on:f().func,onSetChannelAvatar:f().func,onDeleteChannelAvatar:f().func};const uA=(0,i.$j)((e=>({app:e.app,userId:L()(e,"auth.user.id"),mobileApp:L()(e,"app.req.mobileApp"),isMobile:L()(e,"app.isMobile"),host:L()(e,"app.req.host")})),(e=>({initAuth:t=>{e(ee(t))},checkAdBlocker:t=>{e((e=>({type:"APP_SET_AD_BLOCKER",status:e}))(t))},onChangeMemberCount:t=>{e({type:"ACTION_CHANGE_MEMBER_COUNT",addMember:t})},onSetChannelAvatar:t=>{e(wd(t))},onDeleteChannelAvatar:()=>{e((async(e,t)=>{try{const n=t(),a=n.app?.channel;if(!a)throw new Error("channel not found!");const s={...a,avatarId:null,avatarInfo:{}};await At.ZP.editChannel(s)?e(wd(s)):kt.Z.sendSystemMessage("exception")}catch(e){kt.Z.sendSystemMessage("exception"),D.Z.promiseHandler(fd)(e)}}))},showChannelPostPopup:t=>{e(Id(t))}})))((0,ae.Z)(pA,"APP"));
/**
 * Mirtesen.
 *
 * Client part of the project.
 * Import js client scripts here if you need.
 *
 * @author       Yurii Kukharev.
 * @copyright    Copyright (c) 2018, Mirtesen LLC.
 * @license      Property of Mirtesen LLC. All rights reserved.
 */
window.JsAPI?.Config?.setDomain?.("news.mirtesen.ru"),window.ResizeObserver=window.ResizeObserver||g.Z,Rp().api.host=void 0,re.Z.setConfig(Rp()),c().locale("ru"),c().tz.setDefault("Europe/Moscow"),window.addEventListener("load",d());const gA=()=>{const e=window.visualViewport?.height||0,t=document.documentElement.clientHeight,n=window.innerHeight||0;return Math.max(e,t,n)},hA=()=>{const e=window.visualViewport?.width||0,t=document.documentElement.clientWidth,n=window.innerWidth||0;return Math.max(e,t,n)},_A=gA(),EA=hA();window.history.scrollRestoration="manual",document.body.style.setProperty("--viewport-height",`${_A}px`),document.body.dataset.viewportHeight=_A,document.body.style.setProperty("--viewport-width",`${EA}px`),document.body.dataset.viewportWidth=EA;const fA=()=>{const e=gA(),t=hA();getComputedStyle(document.body).getPropertyValue("--viewport-height")!==`${e}px`&&(document.body.style.setProperty("--viewport-height",`${e}px`),document.body.dataset.viewportHeight=e),getComputedStyle(document.body).getPropertyValue("--viewport-width")!==`${t}px`&&(document.body.style.setProperty("--viewport-width",`${t}px`),document.body.dataset.viewportWidth=t)};window.addEventListener("resize",u()(fA,300)),window.addEventListener("focus",u()(fA,300));const bA={blogDomain:Ic,promotion:Vl,editComments:Wl,actionVote:ci,header:wm,messageNotifications:Cm,activityNotifications:Om,headerSearch:km,rssEditor:Pc,telegramEditor:_m,auth:gi,authForm:bi,blogModerators:el,logoEditor:vl,headerBackgroundEditor:bl,titleEditor:Ol,secondaryHeader:zi,blogMenuSettings:Xi,siteSettings:Dl,siteSettingsLeftMenu:Zl,promotionLeftMenu:yc,editCommentsLeftMenu:Tc,blogPostList:il,blogPostEditor:rl,actionModifyPostPopup:ki,rightColumnPosts:Sl,rightColumnComments:wl,rightColumnGallery:Cl,blogPost:qi,blogMember:al,aggregator:si,leftMenu:vi,actionBlogPostNotify:Ri,blogCommentPage:kl,groups:Kl,billing:Xl,stat:pi,app:oi,staticPage:ec,blogPostNotifications:Nc,blogPostNotification:Li,mtPostEditor:It,mtPoll:rm.Yy,personSettings:$l,personSettingsLeftMenu:jl,personPostList:ul,personFriends:nc,personPublications:Hl,personEvents:mc,personProfile:sc,personPrivateMedia:oc,personSites:lc,personComments:pc,accountConsolidation:fc,pad:El,platformPostList:cl,platformPost:dl,topicPostList:hl,topicPartnerPost:Mc,topicModeration:Oi,recoveryPassword:em,footerCatFish:_c,indexMainAuthorized:sm,pollList:Ac,blogPostRecommended:nm,voteAction:pm,voteList:Wo,blogSubscription:Rc,popularPostsList:Zc,bloggersPostsList:Bc,commentatorList:Pi,reposterList:Ci,userCard:Ai,feedback:Bi,userFriendship:$i,billingList:Uc,activitiesList:Fc,createSitePage:Gc,postTiles:Vc,v2Comments:ji,logoutModal:Hi,pymk:Wc,topAuthors:Kc,mtSearch:im,userInterests:fm,testApi:gm,hashtagPostList:ym,reasonsForShowing:Sm,channelMain:xm,channelPost:Dm,richPostEditor:Vm,videoList:Rm,videoOne:Zm,videoRecommendations:Bm,testDraftJs:Um,channelEditor:Gm.ZP,channelCoverEditor:Wm,channelAvatarEditor:Km,myChannels:Xm,channelVeryTopTags:sd,mtSearchResults:ed,veryTopHeader:nd,postFeed:od,channelSubscribeAction:jm,post2Top:Xc,geoPosition:ld},yA=window.__PRELOADED_STATE__,vA=re.Z.initStore(bA,yA);window.mtBasedStore=vA,window.blogStore=vA;try{o.a(document.getElementById("root"),r.createElement(i.zt,{store:vA},r.createElement(uA,null)))}catch(e){console.log(e)}},56865:(e,t,n)=>{var a={"./en-gb":22243,"./en-gb.js":22243,"./ru":21793,"./ru.js":21793};function s(e){var t=r(e);return n(t)}function r(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}s.keys=function(){return Object.keys(a)},s.resolve=r,e.exports=s,s.id=56865},67795:(e,t,n)=>{var a={"./en-gb":95011,"./en-gb.js":95011,"./ru":61874,"./ru.js":61874};function s(e){var t=r(e);return n(t)}function r(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}s.keys=function(){return Object.keys(a)},s.resolve=r,e.exports=s,s.id=67795},86035:()=>{},52361:()=>{},94616:()=>{}},e=>{e.O(0,[513],(()=>{return t=28595,e(e.s=t);var t}));e.O()}]);
</script>

</body>
</html>
