"use strict";(self.webpackChunkdjango_content_services=self.webpackChunkdjango_content_services||[]).push([[43],{2949:function(t,e,a){a.r(e);var i=a(7903);e.default=i.hb},7903:function(t,e,a){a.d(e,{hb:function(){return u}});var i=a(4942),s=a(4921),r=a(6379),o=a(5484),n=a(4261);class c{static getInstance(){return this._instance||(this._instance=new this)}constructor(){(0,i.Z)(this,"savedArticlesData",void 0),this.savedArticlesData={SavedArticles:{},object_id:"",object_modified_on:""}}add(t,e,a,i){const s={...this.savedArticlesData.SavedArticles,[t]:i};this.savedArticlesData={SavedArticles:s,object_id:e,object_modified_on:a}}delete(t,e){const a={...this.savedArticlesData.SavedArticles};delete a[t],this.savedArticlesData={SavedArticles:a,object_id:this.savedArticlesData.object_id,object_modified_on:e}}update(t){this.savedArticlesData=t}objectId(){return this.savedArticlesData.object_id}modifiedDate(){return this.savedArticlesData.object_modified_on}savedArticles(){return this.savedArticlesData.SavedArticles}savedArticlesNumber(){return Object.keys(this.savedArticles()).length}}(0,i.Z)(c,"_instance",void 0);const d=(t,e)=>{const a=new CustomEvent("custom-event",{detail:{control_fields:{mparticle:{keys:{action_type:"action_type",article_id:"article_id",context:"context"}}},event_name:"on_page_action_click",action_type:e,article_id:t,context:"saved_for_later"}});document.dispatchEvent(a)};var l=a(7717);class u extends r.V{constructor(t){super(),this.bookmarks=t,(0,i.Z)(this,"customObjectApiService",void 0),(0,i.Z)(this,"lrtKey",void 0),(0,i.Z)(this,"enableTooltip",void 0),(0,i.Z)(this,"bookmarkWrpper",void 0),(0,i.Z)(this,"bookmarkButton",void 0),this.customObjectApiService=new n.l,this.lrtKey=void 0,this.handleCtaEvent(),(0,o.C)("pnIdReady",(()=>{this.lrtKey=this.lrToken(),this.lrtKey&&this.initSaveArticleButton()}))}lrToken(){const t=localStorage.getItem(s.Fe.LRTOKENKEY);return t&&""!=t?t:void 0}handleCtaEvent(){this.bookmarks.querySelectorAll(".bookmark-link").forEach((t=>{t.addEventListener("click",(()=>{sessionStorage.setItem("redirect_url",window.location.href),(t=>{const e={control_fields:{mparticle:{keys:{anchor_text:"anchor_text",click_source_type:"click_source_type",layout_section:"layout_section",target_url:"target_url"},mp_event_type:"Navigation"}},anchor_text:t.innerText,click_source_type:"link",event_name:"click",layout_section:"bookmark-tool-tip",target_url:t.href},a=new CustomEvent("custom-event",{detail:e});document.dispatchEvent(a)})(t)}))}))}updateArticleCardClickAnalyticConfig(t,e,a){var i;const s=null==e?void 0:e.closest(a);if(!s)return void(0,l.kg)("info","Element not found. Skipping evt-val update.");const r=null===(i=s.dataset)||void 0===i?void 0:i.evtVal;if(r)try{const e=JSON.parse(r);return e.bookmarked=String(t),e.control_fields.mparticle.keys.bookmarked="bookmarked",s.dataset.evtVal=JSON.stringify(e),s.dataset.evtValChanged="true",s}catch(t){return void(0,l.kg)("error","Failed to parse or update event data:",t)}else(0,l.kg)("info","Data event value is missing from the element. Skipping update.")}async initSaveArticleButton(){await this.getCustomObjects();const t=this.bookmarks.querySelectorAll(".bookmark-button"),e=c.getInstance().savedArticles();this.enableTooltip=!1,t.forEach((t=>{t&&t.classList.contains("popover__trigger")&&t.classList.add("popover__event");const a=t.closest(".popover").querySelector(".bookmark__popover__content"),i=t.querySelector(".save-article-button");a&&(a.innerHTML='\n<p>You can save articles to your account! Find saved stories in your <a class="bookmark-link" href="/saved-articles/" data-evt-skip-click="true">account</a>.</p>\n');const r=i.getAttribute("data-article-id");if(r){c.getInstance().savedArticlesNumber()<1&&(this.enableTooltip=!0);e[r]?(this.setBookmarkState(i,!0),this.updateArticleCardClickAnalyticConfig(!0,i,".article-card")):(this.setBookmarkState(i,!1),this.updateArticleCardClickAnalyticConfig(!1,i,".article-card")),t.onclick=()=>{if(!this.lrtKey)return;t.disabled=!0,this.bookmarkButton=t,this.bookmarkWrpper=t.closest(".bookmark-wrapper");const e=c.getInstance().objectId();"saved"!==i.getAttribute("data-article-state")?(this.enableFocusMaxLimitDrawer(),c.getInstance().savedArticlesNumber()>=this.getMaxLimit()?(window.dispatchEvent(new CustomEvent(s.Io.OPEN,{detail:"slidingDrawersaveArticleDrawer"})),this.bookmarkButton.disabled=!1,d(r,"saved_limit_reached")):this.saveArticle(i,r,e),this.updateArticleCardClickAnalyticConfig(!0,i,".article-card")):(this.removeSavedArticle(i,r,e),this.updateArticleCardClickAnalyticConfig(!1,i,".article-card"))}}}))}async getCustomObjects(){this.lrtKey?await this.customObjectApiService.getCustomObjects(this.lrtKey).then((t=>{const e=t.data;Object.keys(e).includes("SavedArticles")&&c.getInstance().update(e)})).catch((t=>{(0,l.kg)("error",t)})):(0,l.kg)("error","LRT key is not found")}saveArticle(t,e,a){this.customObjectApiService.saveArticle(this.lrtKey,e,a).then((a=>{var i;(a.data&&c.getInstance().add(a.data.article_id,a.data.object_id,a.data.object_modified_on,a.data.saved_on),this.enableTooltip)&&(null===(i=t.closest(".popover"))||void 0===i||i.dispatchEvent(new CustomEvent(s.$5.OPEN)),this.enableTooltip=!1,this.handleCtaEvent());this.setBookmarkState(t,!0),this.bookmarkButton.disabled=!1,d(e,"saved")})).catch((t=>{(0,l.kg)("error",t),this.handleErrorMessage(),d(e,"failed")}))}removeSavedArticle(t,e,a){const i=c.getInstance().modifiedDate();this.customObjectApiService.removeSavedArticle(this.lrtKey,e,a,i).then((a=>{a.data&&c.getInstance().delete(a.data.article_id,a.data.object_modified_on),c.getInstance().savedArticlesNumber()<1&&(this.enableTooltip=!0),this.setBookmarkState(t,!1),this.bookmarkButton.disabled=!1,d(e,"unsaved")})).catch((t=>{(0,l.kg)("error",t),this.handleErrorMessage(),d(e,"failed")}))}handleErrorMessage(){const t=this.bookmarkWrpper.parentElement,e=this.bookmarkWrpper.closest(".article-card"),a=document.createElement("div");a.classList.add("message-box--error","flex-align-center","flex-justify-between"),a.innerHTML='\nOops! Something isn\'t working. Try again later.\n<button\n    aria-label="remove error message"\n    onclick="location.reload()"\n    type="button">\n    \n<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M13.89 8.7L12 10.59L10.11 8.7C9.72 8.31 9.09 8.31 8.7 8.7C8.31 9.09 8.31 9.72 8.7 10.11L10.59 12L8.7 13.89C8.31 14.28 8.31 14.91 8.7 15.3C9.09 15.69 9.72 15.69 10.11 15.3L12 13.41L13.89 15.3C14.28 15.69 14.91 15.69 15.3 15.3C15.69 14.91 15.69 14.28 15.3 13.89L13.41 12L15.3 10.11C15.69 9.72 15.69 9.09 15.3 8.7C14.91 8.32 14.27 8.32 13.89 8.7ZM12 2C6.47 2 2 6.47 2 12C2 17.53 6.47 22 12 22C17.53 22 22 17.53 22 12C22 6.47 17.53 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z" fill="#950000"/>\n</svg>\n\n</button>\n',e?null==e||e.appendChild(a):null==t||t.appendChild(a),this.bookmarkWrpper.classList.add("hidden")}setBookmarkState(t,e){e?(t.classList.add("save-article-button--active"),t.classList.remove("save-article-button--default"),t.setAttribute("data-article-state","saved"),t.setAttribute("title","Remove from saved articles")):(t.classList.remove("save-article-button--active"),t.classList.add("save-article-button--default"),t.setAttribute("data-article-state","unsaved"),t.setAttribute("title","Save article"))}enableFocusMaxLimitDrawer(){const t=this.getElement(".save-article__drawer");if(!t)return;[...t.querySelectorAll("a[href], button, input")].map((t=>t.setAttribute(s.PA.TAB_INDEX,"0"))),t.focus(),t.setAttribute("aria-hidden","true")}getMaxLimit(){const t=this.getUserType(),e=this.getElement(".save-article__drawer-message"),a=(null==e?void 0:e.getAttribute("data-sub-max-limit"))||"100",i=(null==e?void 0:e.getAttribute("data-reg-max-limit"))||"20";return"register"===t?parseInt(i):parseInt(a)}getUserType(){const t=JSON.parse(localStorage.getItem(s.Fe.XID)||"{}").data;return t&&t.adLight?"subscriber":"register"}}},4261:function(t,e,a){a.d(e,{l:function(){return i}});class i{async getCustomObjects(t){const e=new Headers;e.append("X-API-U-Token",t);const a={method:"GET",headers:e},i=await fetch("/api-root/subscription/identity/custom-objects/default/",a),s=await i.json();if(i.ok)return s;if(404===i.status)return{data:{SavedArticles:{},object_id:void 0,object_modified_on:void 0}};throw s}async saveArticle(t,e,a){const i=new Headers;i.append("X-API-U-Token",t),i.append("Content-Type","application/json");const s={method:"POST",headers:i,body:JSON.stringify({article_id:e,object_id:a})},r=await fetch("/api-root/subscription/identity/custom-objects/default/saved-articles/",s),o=await r.json();if(200===r.status||201===r.status)return o;throw o}async removeSavedArticle(t,e,a,i){const s=new Headers;s.append("X-API-U-Token",t),s.append("Content-Type","application/json");const r={method:"DELETE",headers:s,body:JSON.stringify({object_id:a,object_modified_on:i})},o=await fetch(`/api-root/subscription/identity/custom-objects/default/saved-articles/${e}/`,r),n=await o.json();if(o.ok)return n;throw n}}},5484:function(t,e,a){a.d(e,{C:function(){return i}});const i=(t,e)=>{const a=`femCe${t.charAt(0).toUpperCase()+t.slice(1)}Triggered`;if(Object.prototype.hasOwnProperty.call(window,a)&&!0===window[a]){e(new CustomEvent(t,{detail:{triggeredByFlag:!0}}))}else document.addEventListener(t,e)}}}]);
//# sourceMappingURL=78e8c61ccfd4c489596343.js.map