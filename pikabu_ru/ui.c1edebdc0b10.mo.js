"use strict";(self.webpackChunkpikabu=self.webpackChunkpikabu||[]).push([[522],{79961:(t,e,i)=>{i.d(e,{Z:()=>n});var s=i(36005);function n(t){var e="",i=s.escape;Array.prototype.join;e+='<div class="requirements-hint requirements-hint_names">\n    <div class="requirements-hint__title">\n        Свободные логины:\n    </div>\n    <div class="requirements-hint__names">\n        ';for(let s=0;s<t.names.length;s++)e+='\n            <p class="name" data-name="'+i(t.names[s])+'">'+i(t.names[s])+"</p>\n        ";return e+="\n    </div>\n</div>"}},88690:(t,e,i)=>{function s(t){var e,i="";return i+='<div class="auth__tlg-link">\n\t<a href="tg://resolve?domain=pikabu_access_code_bot&start='+(null==(e=t)?"":e)+'" target="_blank">Получить код в Telegram</a>\n\t<span class="hint auth__tlg-hint" aria-label="Для получения кода, на данном устройстве должно быть установлено приложение &laquo;Телеграм&raquo;"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__info icon--ui__info_notifications"><use xlink:href="#icon--ui__info"></use></svg></span>\n</div>\n'}i.d(e,{Z:()=>s})},65563:(t,e,i)=>{function s(t){var e,i="";Array.prototype.join;i+='<div class="emotions__popup">\n    ';for(let s in t.emotions)i+='\n        <div class="emotions__popup-item\n             '+(null==(e=t.userEmotions.includes(Number(s))?"emotions__popup-item_active":"")?"":e)+'"\n             data-type="'+(null==(e=s)?"":e)+'"\n             data-count="'+(null==(e=t.counters[s]||0)?"":e)+'">\n            <div class="emotions__popup-title">'+(null==(e=t.emotions[s].hint)?"":e)+'</div>\n            <div class="emotions__popup-icon "><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--emotions__'+(null==(e=t.emotions[s].class)?"":e)+'"><use xlink:href="#icon--emotions__'+(null==(e=t.emotions[s].class)?"":e)+'"></use></svg></div>\n            <div class="emotions__popup-counter">\n                <span>'+(null==(e=t.counters[s]||0)?"":e)+"</span>\n            </div>\n        </div>\n    ";return i+="\n</div>"}i.d(e,{Z:()=>s})},41779:(t,e,i)=>{function s(t){return'<form class="quick-ignore">\n\t<h3 class="quick-ignore__caption">Период скрытия</h3>\n\t<p class="quick-ignore__option"><label>\n\t\t<input type="radio" name="period" value="WEEK" checked>Неделя\n\t</label></p>\n\t<p class="quick-ignore__option"><label>\n\t\t<input type="radio" name="period" value="MONTH">Месяц\n\t</label></p>\n\t<p class="quick-ignore__option"><label>\n\t\t<input type="radio" name="period" value="THREE_MONTHS">Три месяца\n\t</label></p>\n\t<p class="quick-ignore__option"><label>\n\t\t<input type="radio" name="period" value="FOREVER">Навсегда\n\t</label></p>\n\t<p class="quick-ignore__hint">Больше настроек в разделе <a href="/ignore-list">Игнор-лист</a></p>\n\t<button type="submit" class="pkb-normal-btn pkb-normal-btn_wide">Применить</button>\n</form>\n','<form class="quick-ignore">\n\t<h3 class="quick-ignore__caption">Период скрытия</h3>\n\t<p class="quick-ignore__option"><label>\n\t\t<input type="radio" name="period" value="WEEK" checked>Неделя\n\t</label></p>\n\t<p class="quick-ignore__option"><label>\n\t\t<input type="radio" name="period" value="MONTH">Месяц\n\t</label></p>\n\t<p class="quick-ignore__option"><label>\n\t\t<input type="radio" name="period" value="THREE_MONTHS">Три месяца\n\t</label></p>\n\t<p class="quick-ignore__option"><label>\n\t\t<input type="radio" name="period" value="FOREVER">Навсегда\n\t</label></p>\n\t<p class="quick-ignore__hint">Больше настроек в разделе <a href="/ignore-list">Игнор-лист</a></p>\n\t<button type="submit" class="pkb-normal-btn pkb-normal-btn_wide">Применить</button>\n</form>\n'}i.d(e,{Z:()=>s})},7099:(t,e,i)=>{function s(t){var e,i="";Array.prototype.join;return i+='<div class="story-skeleton"'+(null==(e=t.hidden?" hidden":"")?"":e)+'>\n    <div class="story-skeleton__content">\n        ',t.isMobile||(i+='\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-1"></div>\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-2"></div>\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-3"></div>\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-4"></div>\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-5"></div>\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-6"></div>\n        '),i+="\n        ",t.isMobile&&(i+='\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-1"></div>\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-2"></div>\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-3"></div>\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-4"></div>\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-5"></div>\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-6"></div>\n            <div class="story-skeleton__dummy story-skeleton__dummy-text-7"></div>\n        '),i+="\n    </div>\n</div>"}i.d(e,{Z:()=>s})},88810:(t,e,i)=>{function s(t){return'<div class="story-skeleton">\n  <div class="story-skeleton__header">\n    <div class="story-skeleton__user">\n      <div class="story-skeleton__dummy story-skeleton__dummy-avatar"></div>\n      <div class="story-skeleton__dummy story-skeleton__dummy-name"></div>\n      <div class="story-skeleton__dummy story-skeleton__dummy-avatar story-skeleton__dummy-avatar_community"></div>\n      <div class="story-skeleton__dummy story-skeleton__dummy-name story-skeleton__dummy-name_community"></div>\n    </div>\n  </div>\n  <div class="story-skeleton__content">\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-1"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-2"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-3"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-4"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-5"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-6"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-7"></div>\n  </div>\n</div>','<div class="story-skeleton">\n  <div class="story-skeleton__header">\n    <div class="story-skeleton__user">\n      <div class="story-skeleton__dummy story-skeleton__dummy-avatar"></div>\n      <div class="story-skeleton__dummy story-skeleton__dummy-name"></div>\n      <div class="story-skeleton__dummy story-skeleton__dummy-avatar story-skeleton__dummy-avatar_community"></div>\n      <div class="story-skeleton__dummy story-skeleton__dummy-name story-skeleton__dummy-name_community"></div>\n    </div>\n  </div>\n  <div class="story-skeleton__content">\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-1"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-2"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-3"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-4"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-5"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-6"></div>\n    <div class="story-skeleton__dummy story-skeleton__dummy-text-7"></div>\n  </div>\n</div>'}i.d(e,{Z:()=>s})},51691:(t,e,i)=>{i.d(e,{U:()=>c});i(66992),i(33948),i(41817);const s="accordion__item",n="accordion__item-header-icon",r="accordion__item_expanded";var o=i(75130);function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function l(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach((function(e){u(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function u(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const h={closeOthersOnChange:!1,toggleOnIconOnly:!1,scrollIntoViewOnShow:!1};class c{constructor(t,e=h){if(u(this,"expandedItems",new Map),u(this,"hideSection",((t,e)=>{const i=this.getContentHeight(t);e.classList.remove(r),i&&(t.style.height="0")})),u(this,"showSection",((t,e)=>{const i=this.getContentHeight(t);e.classList.add(r),i&&(t.style.height=i),this.options.scrollIntoViewOnShow&&setTimeout((()=>e.scrollIntoView({block:"start",behavior:"smooth"})),100)})),u(this,"getContentHeight",(t=>{const e=t.firstElementChild;if(!(e instanceof HTMLElement))return null;const i=window.getComputedStyle(e),s=i.getPropertyValue("margin-top"),n=i.getPropertyValue("margin-bottom");try{return e.clientHeight+parseInt(s,10)+parseInt(n,10)+"px"}catch(r){return null}})),!t)throw new Error("No container element found");this.el=t,this.options=e===h?e:l(l({},h),e);const i=Array.from(this.el.querySelectorAll("."+s));this.setListeners(i)}setListeners(t){for(const e of t){const t=e.firstElementChild,i=e.lastElementChild;if(e instanceof HTMLElement&&t instanceof HTMLElement&&i instanceof HTMLElement){if(e.classList.contains(r)){this.expandedItems.set(e,i);const t=this.getContentHeight(i);t&&(i.style.height=t)}t.addEventListener("click",this.onClickToggle({item:e,content:i}))}}}onClickToggle({item:t,content:e}){const{closeOthersOnChange:i,toggleOnIconOnly:s,stateId:a}=this.options;return({target:l})=>{const u=l instanceof HTMLElement&&l.classList.contains(n);if(s&&!u)return;const h=t.classList.contains(r);i&&(this.expandedItems.forEach(this.hideSection.bind(this)),this.expandedItems.clear()),h?i||this.hideSection(e,t):(this.showSection(e,t),i&&this.expandedItems.set(t,e)),a&&(new o.U).set(a,h)}}getExpandedItems(){return this.expandedItems}}},10850:(t,e,i)=>{i.d(e,{Z:()=>g});i(88674);var s=i(43241);function n(t){var e,i="";Array.prototype.join;return i+='<div class="adult-popup">\n    <div class="adult-popup__close popup__close"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close"><use xlink:href="#icon--ui__close"></use></svg></div>\n    <h3 class="adult-popup__title">Вы уверены?</h3>\n    <p class="adult-popup__text">Некоторые виды контента могут быть небезопасны для просмотра.\n        '+(null==(e=t.isShowInput?"Пожалуйста, укажите свой возраст, чтобы продолжить.":"")?"":e)+'</p>\n    <form class="adult-popup__form">\n        ',t.isShowInput&&(i+='\n        <label class="adult-popup__label">Дата рождения</label>\n        <div class="input input_box adult-popup__input">\n            <div class="input__box">\n                <input type="text" name="birthdate" class="input__input" value="'+(null==(e=t.birthday)?"":e)+'">\n            </div>\n        </div>\n        '),i+='\n        <div class="adult-popup__buttons">\n            <button class="button button_success adult-popup__ok">Продолжить</button>\n            ',i+='\n                <button class="button adult-popup__cancel">Отмена</button>\n            ',i+="\n        </div>\n    </form>\n</div>"}var r=i(42107),o=i(30381),a=i.n(o),l=i(71503),u=i(35856),h=i(88358),c=i(12953),d=i(31474),p=i(12950),m=i(82800),_=i(81780);class g extends s.u{static async showAdultPopup(t){const e=c.default.initParams.birthday?a()(c.default.initParams.birthday).format("DD.MM.YYYY"):"",i=!(e&&this.isAdultAge(e));this.popup=new h.LD({content:n({confirm:Boolean(e),isShowInput:i,birthday:e}),direction:m.Lh.BOTTOM,isModalMenu:!0});const s=this.popup.$els.content;return this.initInputPopup(s.find(".adult-popup__input")[0]),new Promise((n=>{var o,a;const l={result:!1,input:this.input,notSave:!1};c.default.listenTo(this.popup,_.e.UNMOUNTED,(()=>{var t;r.cp.getInstance().sendEvent("nsfw_activation_cancel_button_tapped",{value_new:this.getFormatDate(null===(t=this.input)||void 0===t?void 0:t.value),value_old:c.default.initParams.birthday||""}),n(l)})),s.on("click",".adult-popup__ok",(async s=>{var o,a;s.preventDefault(),i||(this.popup.hide(),r.cp.getInstance().sendEvent("nsfw_activation_approve_button_tapped",{value_new:this.getFormatDate(e),value_old:this.getFormatDate(e)||""}),l.result=!0,l.notSave=!0,n(l));const u=null===(o=this.input.input)||void 0===o?void 0:o.mask.masked.rawInputValue;if(!u||Boolean(!(null!==(a=this.input.input)&&void 0!==a&&a.mask.typedValue)))return;t&&await this.saveUserBirthdate(u);const p=this.getFormatDate(u);c.default.initParams.birthday=p;const m=this.isAdultAge(u);if(this.popup.hide(),r.cp.getInstance().sendEvent("nsfw_activation_approve_button_tapped",{value_new:p,value_old:e?this.getFormatDate(e):""}),m)l.result=!0,n(l);else{await h.nk.confirmModal({wrapperExtraClass:"adult-popup__wrapper popup_modal-menu",content:'<div class="adult-popup__confirm">\n    <div class="adult-popup__close popup__close"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close"><use xlink:href="#icon--ui__close"></use></svg></div>\n    <h3 class="adult-popup__title">Вы уверены?</h3>\n    <p class="adult-popup__text">Спасибо за честный ответ. Небезопасный контент может быть вреден для лиц, не достигших 18 лет</p>\n</div>',buttons:[["modal.continue",d.j.SUCCESS,!0]]})&&r.cp.getInstance().sendEvent("nsfw_activation_ok_button_tapped",{type:"nsfw_activation"}),n(l)}})),s.on("click",".adult-popup__cancel",(t=>{t.preventDefault(),this.popup.hide(),n(l)})),this.popup.show(),r.cp.getInstance().sendEvent("form_show",{type:"nsfw_activation",value_old:null!==(o=this.input)&&void 0!==o&&o.value?this.getFormatDate(null===(a=this.input)||void 0===a?void 0:a.value):c.default.initParams.birthday?c.default.initParams.birthday:""})}))}static initInputPopup(t){this.input=new u.o({el:t,minDate:l.Ll})}static isAdultAge(t){const e=a()().diff(a()(t,"DD-MM-YYYY"),"milliseconds");return a().duration(e).years()>17}static getFormatDate(t){return a()(t,"DD.MM.YYYY").format("YYYY-MM-DD")}static async saveUserBirthdate(t){await p.cf.postOrFail("/ajax/users_actions.php",{action:"change_settings",birthdate:this.getFormatDate(t)})}}},22725:(t,e,i)=>{i.d(e,{p:()=>n,v:()=>s});const s="pkb_insam",n="pkb_amws"},15909:(t,e,i)=>{i.d(e,{B:()=>d});var s=i(75021),n=i(76468),r=i(12953);const o={render:t=>{const{isDesktop:e}=t.props,i=s.vu.create("a",{href:"/oauth.php?type=vk",className:"tool auth__provider social-icon_color","data-type":"vk","data-role":"vk"},s.vu.create("span",{className:"auth__provider-logo"},s.vu.create(n.t,{block:"social__vkid"})),"Войти через VK ID"),o=s.vu.create("a",{href:"/oauth.php?type=ya",className:"tool auth__provider social-icon_color","data-type":"ya","data-role":"ya"},s.vu.create("span",{className:"auth__provider-logo"},s.vu.create(n.t,{block:"social__ya"})),"Войти с Яндекс ID");return s.vu.create("div",{className:"tabs__tab auth","data-id":"signup"},e?s.vu.create("div",{className:"auth__field"},s.vu.create("span",{className:"auth__error"})):"",s.vu.create("div",{className:"auth__content"},s.vu.create("div",{className:"auth__title"},"Зарегистрируйтесь, чтобы получить весь опыт Пикабу"),s.vu.create("form",{method:"POST",action:"javascript:void 0;",autoComplete:"off",noValidate:!0},s.vu.create("div",{className:"auth__field auth__field-input"},s.vu.create("div",{className:"input input_small"},s.vu.create("input",{className:"input__input",type:"email",autoComplete:"on",name:"email",placeholder:"E-mail"}))),s.vu.create("div",{className:"auth__field auth__field-input"},s.vu.create("div",{className:"input input_small"},s.vu.create("input",{className:"input__input",type:"text",autoComplete:"on",name:"username",required:!0,minLength:"4",maxLength:"16",placeholder:"Никнейм на Пикабу *"}))),s.vu.create("div",{className:"auth__field auth__field-input"},s.vu.create("div",{className:"input input_box input_small","data-role":"auth"},s.vu.create("span",{className:"input__box"},s.vu.create("input",{className:"input__input",type:r.core.ua.mac?"text":"password","data-role":"password",name:"password",autoComplete:"new-password",required:!0,minLength:"4",maxLength:"160",placeholder:"Пароль *"})))),s.vu.create("div",{className:"auth__field_terms"},"Нажимая кнопку «Создать аккаунт», я соглашаюсь с ",s.vu.create("a",{href:"/information/rules",target:"_blank"},"Правилами Пикабу")," и даю согласие на",s.vu.create("a",{href:"/information/consent",target:"_blank"}," обработку персональных данных"),"."),s.vu.create("div",{className:"auth__buttons"},s.vu.create("div",{className:"auth__field"},s.vu.create("button",{type:"submit",className:"button_success button_width_100"},"Создать аккаунт")),s.vu.create("div",{className:"auth__field"},s.vu.create("span",{className:"auth__action pkb-normal-btn pkb-normal-btn_small pkb-normal-btn_border","data-role":"route","data-to":"signin"},"Авторизация"))))),s.vu.create("div",null,s.vu.create("div",{className:"section-hr"},s.vu.create("div",{className:"section-hr__title section-hr__title_small"},s.vu.create("span",null,"или"))),s.vu.create("div",{className:"auth__footer"},[o,i])))},notUpdate:!0},a={render:t=>{const{isDesktop:e}=t.props,i=s.vu.create("a",{href:"/oauth.php?type=vk",className:"tool auth__provider social-icon_color","data-type":"vk","data-role":"vk"},s.vu.create("span",{className:"auth__provider-logo"},s.vu.create(n.t,{block:"social__vkid"})),"Войти через VK ID"),o=s.vu.create("a",{className:"tool auth__provider social-icon_color","data-type":"google","data-role":"google",onClick:t=>{t.preventDefault()}},s.vu.create("span",{className:"auth__provider-logo"},s.vu.create(n.t,{block:"social__google"})),"Войти через Google"),a=s.vu.create("a",{href:"/oauth.php?type=ya",className:"tool auth__provider social-icon_color","data-type":"ya","data-role":"ya"},s.vu.create("span",{className:"auth__provider-logo"},s.vu.create(n.t,{block:"social__ya"})),"Войти с Яндекс ID");return s.vu.create("div",{className:"tabs__tab auth","data-id":"signin"},e?s.vu.create("div",{className:"auth__field no-margin"},s.vu.create("span",{className:"auth__error"})):"",s.vu.create("div",{className:"auth__field no-margin"},s.vu.create("span",{className:"auth__message"})),s.vu.create("div",{className:"auth__content"},s.vu.create("div",{className:"auth__title"},"Авторизуйтесь, чтобы получить весь опыт Пикабу"),s.vu.create("form",{method:"post",action:"javascript:void 0;",noValidate:!0,id:"signin-form"},s.vu.create("input",{type:"hidden",name:"mode",value:"login"}),s.vu.create("div",{className:"auth__field auth__field-input"},s.vu.create("div",{className:"input input_small"},s.vu.create("input",{className:"input__input",type:"text",name:"username",autoCapitalize:"none",autoCorrect:"off",autoComplete:"username",required:!0,minLength:"3",maxLength:"40",placeholder:"Логин",tabIndex:"0"}))),s.vu.create("div",{className:"auth__field auth__field-input"},s.vu.create("div",{className:"input input_small"},s.vu.create("input",{className:"input__input",type:r.core.ua.mac?"text":"password",name:"password",autoComplete:"password",required:!0,minLength:"3",maxLength:"160",placeholder:"Пароль",tabIndex:"0"}))),s.vu.create("div",{className:"auth__field"},s.vu.create("span",{className:"auth__forget","data-role":"route","data-to":"forget"},"Забыли пароль?")),s.vu.create("div",{className:"auth__buttons"},s.vu.create("div",{className:"auth__field"},s.vu.create("button",{type:"submit",className:"button_success button_width_100"},"Войти")),s.vu.create("div",{className:"auth__field"},s.vu.create("span",{className:"auth__action pkb-normal-btn pkb-normal-btn_small pkb-normal-btn_border","data-role":"route","data-to":"signup"},"Регистрация"))))),s.vu.create("div",null,s.vu.create("div",{className:"section-hr"},s.vu.create("div",{className:"section-hr__title section-hr__title_small"},s.vu.create("span",null,"или"))),s.vu.create("div",{className:"auth__footer"},[a,i,o])))},notUpdate:!0},l={render:t=>{const{isDesktop:e}=t.props;return s.vu.create("div",{className:"tabs__tab auth","data-id":"forget"},e?s.vu.create("div",{className:"auth__field"},s.vu.create("span",{className:"auth__error"})):"",s.vu.create("div",{className:"auth__title"},"Восстановление пароля"),s.vu.create("div",{className:"auth__content"},s.vu.create("form",{method:"POST",action:"javascript:void 0;",noValidate:!0},s.vu.create("input",{type:"hidden",name:"action",value:"request"}),s.vu.create("div",{className:"auth__field auth__field-input"},s.vu.create("div",{className:"input input_small"},s.vu.create("input",{name:"contact",className:"input__input",required:!0,type:"text",placeholder:"E-mail или телефон"}))),s.vu.create("div",{className:"auth__buttons"},s.vu.create("div",{className:"auth__field"},s.vu.create("button",{type:"submit",className:"button_success button_width_100 auth__submit"},"Восстановить")),s.vu.create("div",{className:"auth__field"},s.vu.create("span",{className:"auth__action pkb-normal-btn pkb-normal-btn_small pkb-normal-btn_border","data-role":"route","data-to":"signin"},"Войти"))))))},notUpdate:!0};var u=i(64313);const h={render:t=>{const{isDesktop:e}=t.props,{providerName:i}=t.props;return s.vu.create("div",{className:"tabs__tab auth","data-id":"change-password"},e?s.vu.create("div",{className:"auth__field"},s.vu.create("span",{className:"auth__error"})):"",s.vu.create("div",{className:"auth__content"},s.vu.create("div",{className:"auth__title"},"Восстановление пароля"),s.vu.create("form",{method:"POST",action:"javascript: void(0);",noValidate:!0},s.vu.create("div",{className:"auth__field auth__field-input"},s.vu.create("div",{className:"input input_small","data-type":"code"},s.vu.create("input",{className:"input__input",type:"text",autoComplete:"off",name:"confirm",required:!0,minLength:"4",maxLength:"4",placeholder:"Код из смс"}))),s.vu.create("div",{className:"auth__field auth__field-input"},s.vu.create("div",{className:"input input_small","data-type":"password"},s.vu.create("input",{className:"input__input",type:r.core.ua.mac?"text":"password","data-role":"password",name:"password",autoComplete:"new-password",required:!0,minLength:"6",maxLength:"160",placeholder:"Новый пароль"}))),s.vu.create("div",{className:"auth__field auth__field-input"},s.vu.create("div",{className:"input input_small","data-type":"password-repeat"},s.vu.create("input",{className:"input__input",type:r.core.ua.mac?"text":"password","data-role":"password",name:"password2",autoComplete:"new-password",required:!0,minLength:"6",maxLength:"160",placeholder:"Пароль еще раз"}))),s.vu.create("div",{className:"auth__field auth__field_submit"},s.vu.create("button",{type:"submit",className:"button_success button_width_100"},"Подтвердить")),s.vu.create("div",{className:"auth__field"},s.vu.create("div",{className:"auth__tlg-link-b"},s.vu.create("a",{href:"tg://resolve?domain=pikabu_access_code_bot&start=",target:"_blank",className:"auth__tlg-link"},"Получить код в Telegram"),s.vu.create("span",{className:"hint auth__tlg-hint","aria-label":"Для получения кода, на данном устройстве должно быть установлено приложение «Телеграм»"},s.vu.create(u.t,{block:"ui__info",modifiers:"table-row"})))))))},notUpdate:!0},c={render:t=>{const{providerName:e}=t.props;return s.vu.create("div",{className:"tabs__tab auth","data-id":"oauth"},s.vu.create("div",{className:"auth__content"},s.vu.create("div",{className:"auth__title"},"Зарегистрируйтесь, чтобы получить весь опыт Пикабу"),s.vu.create("div",{className:"auth__oauth-login"},"Осталось только придумать ник"),s.vu.create("form",{method:"POST",action:"javascript:void 0;",autoComplete:"off",noValidate:!0,"data-type":e},s.vu.create("input",{type:"hidden",name:"mode",value:"oauth"}),s.vu.create("div",{className:"auth__field"},s.vu.create("div",{className:"input input_small"},s.vu.create("input",{className:"input__input",type:"text",autoComplete:"on",name:"username",required:!0,minLength:"4",maxLength:"16",placeholder:"Логин (псевдоним)",value:""}))),s.vu.create("div",{className:"auth__field"},s.vu.create("span",{className:"auth__error"})),s.vu.create("div",{className:"auth__field_terms"},'Нажимая кнопку "Создать аккаунт", я соглашаюсь с ',s.vu.create("a",{href:"/information/rules",target:"_blank"},"Правилами Пикабу"),"и даю согласие на ",s.vu.create("a",{href:"/information/consent",target:"_blank"},"обработку персональных данных"),"."),s.vu.create("div",{className:"auth__buttons"},s.vu.create("div",{className:"auth__field"},s.vu.create("button",{type:"submit",className:"button_success button_width_100"},"Создать аккаунт")),s.vu.create("div",{className:"auth__field"},s.vu.create("span",{className:"auth__action pkb-normal-btn pkb-normal-btn_small pkb-normal-btn_border","data-role":"route","data-to":"signin"},"Авторизация"))),s.vu.create("div",{className:"auth__field "},s.vu.create("span",{className:"auth__action","data-role":"cancel"},"Отменить привязку")))))},notUpdate:!0};function d(t){const{providerName:e,isDesktop:i}=t;return s.vu.create("div",{className:"auth_modal-extended"},s.vu.create(o,null),s.vu.create(a,{isDesktop:i}),s.vu.create(l,{isDesktop:i}),s.vu.create(h,{isDesktop:i}),s.vu.create(c,{providerName:e}),i?s.vu.create("div",{className:"auth__picture"},s.vu.create("img",{src:"https://cs14.pikabu.ru/post_img/2022/06/07/7/1654602999175336042.png"})):"")}},12551:(t,e,i)=>{i.d(e,{T:()=>k});i(88674),i(74916),i(41817);var s=i(63907),n=i(12953),r=i(96637),o=i(1262),a=i(31474),l=i(95411),u=i(88358),h=i(9980),c=i(55474),d=i(90312),p=i(32061);var m=i(88690),_=i(79961),g=i(38654),v=i(12950),f=i(34524);function y(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class b{constructor(){y(this,"scriptURL",""),y(this,"auth1tapURL",""),y(this,"analyticsType",""),y(this,"analyticsComponentName",""),y(this,"analyticsViewTime",0),y(this,"headerObserver",null),this.els={header:document.querySelector(".header"),headerMain:document.querySelector(".header__main")},this.headerObserver=new MutationObserver(this.adjustPosition.bind(this))}init(){const t=document.createElement("script");t.src=this.scriptURL,document.body.append(t),t.onload=()=>this.onLoadScript()}adjustPosition(){if(this.els.container&&this.els.header)if(this.els.header.classList.contains("header_collapsed"))this.els.container.classList.add("one-tap-container_fixed"),this.els.container.style.removeProperty("transform");else{var t;this.els.container.classList.remove("one-tap-container_fixed");const e=Math.max(0,(null===(t=this.els.headerMain)||void 0===t?void 0:t.offsetTop)||0);this.els.container.style.transform="translateY("+e+"px)"}}async requestAuth(t){try{const{response:e,data:i}=await v.cf.post(this.auth1tapURL,t);if(e&&Boolean(e.result)){const t="signup"===i.type?"account_created":"authorization";d.c.getInstance().sendEvent(t,{component_name:this.analyticsComponentName,type:this.analyticsType}),window.location.reload()}else n.core.ui.toasts.showError((null==e?void 0:e.message)||"comments.errors.400")}catch(e){n.core.ui.toasts.showError(e)}}onDisplayPrompt(){const t=parseInt(f.x.get(f.q))||Date.now();var e;(this.analyticsViewTime=Date.now()-t,d.c.getInstance().sendEvent("banner_showed",{view_time:this.analyticsViewTime,type:this.analyticsComponentName}),this.els.header)&&(null===(e=this.headerObserver)||void 0===e||e.observe(this.els.header,{attributes:!0,attributeFilter:["class"]}),this.adjustPosition())}onHidePrompt(){var t;d.c.getInstance().sendEvent("banner_closed",{"view_time!empty":this.analyticsViewTime,type:this.analyticsComponentName}),null===(t=this.headerObserver)||void 0===t||t.disconnect()}onLoadScript(){console.error("onLoadScript not implemented")}}function w(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class E extends b{constructor(){super(),w(this,"scriptURL","https://yastatic.net/s3/passport-sdk/autofill/v1/sdk-suggest-with-polyfills-latest.js"),w(this,"auth1tapURL","/ajax/auth/ya1tap"),w(this,"analyticsType","yandex"),w(this,"analyticsComponentName","yandex_one_tap"),this.init()}async onLoadScript(){if(YaAuthSuggest)try{const{handler:t}=await YaAuthSuggest.init({client_id:"a4415df303b64d058b6d6cb9b532debf",response_type:"token",redirect_uri:`https://${window.location.hostname}/external/yaauth.php`},`https://${window.location.hostname}/`);this.onDisplayPrompt();const e=await t();await this.requestAuth({token:e.access_token})}catch(t){"denied"===t?this.onHidePrompt():n.core.ui.toasts.showError((null==t?void 0:t.message)||"comments.errors.400")}}}var A=i(58330);function S(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function P(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?S(Object(i),!0).forEach((function(e){C(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function C(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const T=i(19755);class k extends s.u1{constructor(t){super(t.$el||t),this.componentName=t.componentName,this.sessionId=t.sessionId,this._username=void 0,this.show(),this._prevSending={}}render(){if(this.isRendered)return this;this.$els={form:this.$("form"),error:this.$el.closest(".popup__content").find(".auth__error_top"),message:this.$(".auth__message")},this.$els.error.length||(this.$els.error=this.$(".auth__error"));const t=A.S.getInstance().get("UIForm");return this._form=new t(this.$els.form),setTimeout((()=>{new E}),5e3),this}focus(t=!1){return this._username&&(t&&this._username.highlightFocus(),this._username.focus()),this}setErrorMessage(t){let e=Boolean(t);this.$els.error.length?this.$els.error.toggle(e).html(t||""):e&&(n.core.emit("error-auth-toast"),n.core.ui.toasts.showError(t))}setMessage(t){let e=Boolean(t);this.$els.message.length?this.$els.message.toggle(e).html(t||""):e&&n.core.ui.toasts.add({content:t})}storePassCredentials(t,e,i){if(Boolean(navigator.credentials)&&Boolean(window.PasswordCredential)){const s=new window.PasswordCredential({id:t,name:t,password:e,iconURL:i||void 0});navigator.credentials.store(s)}}async _inputConfirmation(t){const e=await g.K.getInstance().getScore("registration_code_request");d.c.getInstance().sendEvent("registration_code_request",{type:"phone",login:this._username.value,email:this._email.value,rec_score:e});let i=3;return new Promise((e=>{const h=new u.LD({destroyAfterHide:!0,indent:!0,minWidth:475,header:n.core.i18n("auth.up.confirm.header"),content:'<form method="POST" action="javascript: void(0);" novalidate>\n\t<div class="input input_section">\n\t\t<div class="input__box">\n\t\t\t<input class="input__input" type="text" autocomplete="off" name="confirm" required minlength="4" maxlength="4" placeholder="Код из SMS">\n\t\t</div>\n\t</div>\n</form>',autoClosePressEscape:!1,autoCloseOutsideClick:!1}),d=h.content.find("form"),p=A.S.getInstance().get("UIInput"),_=A.S.getInstance().get("Sanitizers"),g=new p({$el:h.content.find(".input"),validationEvent:c.km.MANUAL,validationHint:{direction:u.Lh.LEFT,alignment:u.SE.CENTER},sanitizerRules:[_.trim(),_.whitelist("0-9")],addSuccessState:!0});h.on(s.eM.UNMOUNTED,(()=>{e(!1)}));const v=new(A.S.getInstance().get("UIButton"))({title:n.core.i18n("auth.up.confirm.button"),theme:a.j.SUCCESS}),f=async()=>{if(v.progress)return;if(v.progress||!(await g.checkValidity()))return;v.progress=!0;let s=Date.now(),a=await o.User.registerSubmitBySmsCode(t||"",g.value);await r.Utils.delay(1e3-(Date.now()-s)),a.response.result?e(!0):--i?(g.value="",g.setCustomValidity(a.response.message)):(this.setErrorMessage(n.core.i18n("auth.up.errors.confirm-limit",60)),this.isLockForm=!0,e(!1),h.hide()),v.progress=!1};d.on("submit",(t=>{t.preventDefault(),f()})),this.listenTo(v,"click",f),h.addCustomIntoFooter(v.show().$el),h.addCloseButtonIntoFooter(),h.addCustomIntoFooter(T((0,m.Z)(t))),n.core.ui.hotkeys.once("enter",(()=>{f()}),{closest:h.$el,context:h,type:l.FM.KEYDOWN}),h.show(),setTimeout((()=>{g.focus()}),100)}))}get captcha(){if(!this.marks.has("captcha")){let t=T(".footer__captcha");t.length||(t=T(".sidebar-block__captcha").show()),this.marks.set("captcha",h.k.instance.setOptions({siteKey:n.core.config("grecaptchaKey"),wrapper:t}))}return this.marks.get("captcha")}async _checkUserAvailable(t){if(!t)return!1;return!!(await o.User.isUserAvailable(t).then((e=>e.message?(e.availableUserNames&&e.availableUserNames.length>0?this._availableNames=e.availableUserNames:this._availableNames=[],!1):(this._availableNames&&!this._availableNames.includes(t)&&(this._availableNames=[]),!0))))}async _checkEmailAvailable(t){return!t||o.User.isEmailAvailable(t)}_showAvailableUserNames(){if(document.querySelector(".requirements-hint_names"))return;this.$els.availableNames&&this.$els.availableNames.remove();const t=this._username.$el;let e=T((0,_.Z)({names:this._availableNames}));t.after(e),this.$els.availableNames=e,this.$els.availableNames.on("click",(t=>{if(!t.target.dataset.name)return;d.c.getInstance().sendEvent("click",{type:"reg_nick_advice"});const e=t.target.dataset.name;this.$els.form.find('[name="username"]').val(e),this._username.setCustomValidity()}))}_sendAnalytics(t,{input:e}){var i,s;if(t===this._prevSending.message&&Date.now()-this._prevSending.time<200)return this._prevSending.message=t,void(this._prevSending.time=Date.now());this._prevSending.message=t,this._prevSending.time=Date.now();const n=t.match(/^.+\.(.+?)(?:\(.*)?$/i),r=e.attr("name"),o=n&&n[1]?n[1]:t;let a;(e.closest('[data-id="signup"]').length>0||e.closest('[data-id="oauth"]').length>0)&&(a=3),(e.closest('[data-id="forget"]').length>0||e.closest('[data-role="new_password"]').length>0)&&(a=4);const l=p.T[r][o]||"unknown_error";d.c.getInstance().sendEvent("error_occurred",P(P({},this.analyticsParams),{},{type_i8:a,type:l,"login!empty":null===(i=this._username)||void 0===i?void 0:i.value,"email!empty":null===(s=this._email)||void 0===s?void 0:s.value}))}}},65645:(t,e,i)=>{i.d(e,{Z:()=>v});i(74916),i(15306),i(88674),i(41817);var s=i(12953),n=i(1262),r=i(12551),o=(i(88358),i(55474)),a=i(72346),l=i(44292),u=i(95374),h=i(96637),c=i(36005),d=i(90312),p=i(58330);function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function _(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach((function(e){g(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function g(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class v extends r.T{constructor(t){super(t.$el||t),this.componentName=t.componentName}render(){var t;if(this.isRendered)return this;super.render();const e={validationEvent:o.km.MANUAL,sanitizerRules:[a.o.trim()],addSuccessState:!0},i={onValidityErrorMessage:(t,{input:e})=>{this._sendAnalytics(t,{input:e})}};this._passwordComplexity=void 0;const n=p.S.getInstance().get("UIInput");this._contact=new n((0,c.defaults)({$el:this.$('input[name="contact"]').parent()},_(_({},e),i)));const r=p.S.getInstance().get("UIButton");this._submit=new r(this.$('button[type="submit"]')),this._contact.validationRules.set("auth.up.errors.format",(t=>{const e=this._preparePhone(t);return l.E0.test(e)||u.c.email(!0)(t)}));const h=p.S.getInstance().get("UIForm");return this._form=new h(this.$els.form),this._form.add(this._contact),this.listenTo(this._form,"submit",this._onSubmit),this.listenToOnce(this._contact,"input",this._onInputContact),null===(t=this.el.querySelector('[data-to="signin"]'))||void 0===t||t.addEventListener("click",(()=>{d.c.getInstance().sendEvent("click",_({button:"have_account"},this.analyticsParams))})),s.core.initParams.withoutCaptcha||this.captcha.render(),this}_preparePhone(t){let e=String(t).replace(/[\s()-]/g,"");return l.E0.test(e)?h.Utils.preparePhone(e):t}_inputConfirmation(t){s.core.emit("need-show-change-form",t)}async _onSubmit(t,e){if(t&&(0,c.isFunction)(t.preventDefault)&&t.preventDefault(),this.setErrorMessage(),!(await e.checkValidity()))return;if(!s.core.initParams.withoutCaptcha&&!(await this.captcha.getToken("restore")))return;this._submit.progress=!0,this._submit.disabled=!0;const i=e.serialize();if(i.contact=this._preparePhone(i.contact),d.c.getInstance().sendEvent("click",_({button:"password_recovery"},this.analyticsParams)),s.core.initParams.withoutCaptcha||(i["g-recaptcha-response"]=this.captcha.lastToken,i["g-recaptcha-response"])){try{const t=await n.User.restorePassword(i);if("phone"===t.type&&t.session_id){if("feed_popup"===this.componentName)return this._submit.progress=!1,this._submit.disabled=!1,void s.core.emit("need-show-change-form",t.session_id);await this._inputConfirmation(t.session_id)&&(s.core.emit("success-auth-toast"),s.core.ui.toasts.add({content:s.core.i18n("auth.forget.changed")}))}else s.core.emit("error-auth-toast"),s.core.ui.toasts.add({content:s.core.i18n("auth.forget.success-email")});this._submit.progress=!1,this._submit.disabled=!1}catch(r){this.setErrorMessage(r.message||s.core.i18n("auth.forget.failure")),d.c.getInstance().sendEvent("error_occurred",{type_i8:4,type:"no_user"}),this._submit.progress=!1,this._submit.disabled=!1}this.captcha.reset()}else this.setErrorMessage(s.core.i18n("auth.up.errors.captcha"))}_onInputContact(){d.c.getInstance().sendEvent("create_email",this.analyticsParams)}get analyticsParams(){var t;return _({type:"oauth"===(null===(t=this.el.closest(".tabs"))||void 0===t?void 0:t.dataset.mode)?"match_account":"password_recovery"},s.core.ui.activeAuth.analyticsParams)}}},32022:(t,e,i)=>{i.d(e,{h:()=>st});i(88674),i(85844),i(66992),i(33948),i(60285),i(41637),i(41817);var s=i(12953),n=i(63907),r=i(88227),o=(i(74916),i(15306),i(12551)),a=i(1262),l=i(88358),u=i(55474),h=i(72346),c=i(96637),d=i(90312),p=i(38654),m=(i(47442),i(36005)),_=i(58330);function g(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function v(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?g(Object(i),!0).forEach((function(e){f(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function f(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const y=i(19755);class b extends o.T{constructor(t){super(t.$el||t),this.componentName=t.componentName}render(){var t,e;if(this.isRendered)return this;super.render();let i={validationEvent:u.km.MANUAL,validationHint:{direction:l.Lh.LEFT,alignment:l.SE.CENTER},sanitizerRules:[h.o.trim()]};const n=_.S.getInstance().get("UIInput");this._username=new n((0,m.defaults)({$el:this.$('input[name="username"]').parent()},i)),this._username.sanitizerRules.add((t=>t.replace(/\s/g,""))),this._username.sanitizerRules.add((t=>0===t.indexOf("+")?t.replace(/[^+0-9]+/g,""):t)),this._password=new n((0,m.defaults)({$el:this.$('input[name="password"]').parent()},i)),Boolean(navigator.credentials)&&this.$el.on("click.auto-signin",(()=>{this.$el.off(".auto-signin"),setTimeout(this.autoSignIn.bind(this),160)}));const r=_.S.getInstance().get("UIButton");this._submit=new r({$el:this.$('button[type="submit"]'),animationName:"signin"});const o=d.c.getInstance();return this.listenToOnce(this._username,"input",(()=>o.sendEvent("create_login",this.analyticsParams))),this.listenToOnce(this._password,"input",(()=>o.sendEvent("create_password",this.analyticsParams))),this._form.add(this._username),this._form.add(this._password),this.captcha.render(),p.K.getInstance().render(),this._usernameHint=new l.gR({target:this._username.$el,content:y(document.createElement("div")).addClass("popup__hint").append(s.core.i18n("auth.username-info")),direction:l.Lh.LEFT,destroyAfterHide:!1}),this.listenTo(this._username,"focus",(()=>{this._usernameHint.show()})),this.listenTo(this._username,"blur",(()=>{this._usernameHint.hide()})),this.listenTo(this._form,"submit",this._onSubmit),null===(t=this.el.querySelector(".auth__forget"))||void 0===t||t.addEventListener("click",(()=>{o.sendEvent("click",v({button:"forgot_password"},this.analyticsParams))})),null===(e=this.el.querySelector('[data-to="signup"], [data-to="oauth"]'))||void 0===e||e.addEventListener("click",(()=>{o.sendEvent("click",v({button:"registration"},this.analyticsParams))})),this}async autoSignIn(){if(!Boolean(navigator.credentials))return!1;let t;try{t=await navigator.credentials.get({password:!0,mediation:"optional"})}catch(e){return!1}if(t&&(this._username.blur(),this._password.blur(),await c.Utils.delay(100),"password"===t.type))if(this._username.value=t.id,this._password.value=t.password,await this._signIn(this._form))return!0;return!1}async _onSubmit(t,e){t&&(0,m.isFunction)(t.preventDefault)&&t.preventDefault(),d.c.getInstance().sendEvent("click",v({button:"authorization"},this.analyticsParams)),this._signIn(e)}async _signIn(t){if(this._username.value&&this._username.isFocused&&!this._password.value.length)return this._password.highlightFocus(),!1;if(this._submit.animation)return!1;if(this.marks.has("last-submit")&&Date.now()-this.marks.get("last-submit")<1500)return!1;let e=Date.now();this.marks.set("last-submit",e);const i=!s.core.initParams.withoutCaptcha;if(this.setErrorMessage(),this.setMessage(),i&&(!(await t.checkValidity())||!(await this.captcha.getToken("authorization"))))return!1;let n=this._form.serialize();if(i&&(n["g-recaptcha-response"]=this.captcha.lastToken,!n["g-recaptcha-response"]))return this.setErrorMessage(s.core.i18n("auth.up.errors.captcha")),!1;this._submit.animation=!0;const{response:r,data:o}=await a.User.authorize(n);if(await c.Utils.delay(1e3-(Date.now()-e)),r.result){if(o.session_id){const t=_.S.getInstance().get("PopupMaster");await t.confirmSMS({attempts:3,id:o.session_id,header:"Введите код из SMS сообщения",callback:async(t,e)=>{let i=await a.User.authorizeSpecAccount(n,o.session_id,t);if(i&&!i.response.result)throw e.value="",new Error(i.response.message);return i},wrapperExtraClass:"feed_popup"===this.componentName?"popup__send-code":""}).then((async t=>{t&&t.response.result&&this.storePassCredentials(n.username,n.password,o.avatar),d.c.getInstance().sendEvent("authorization",v(v({},this.analyticsParams),{},{type:"password"})),await c.Utils.delay(500),this.emit("auth-success")}))}else this.storePassCredentials(n.username,n.password,o.avatar),d.c.getInstance().sendEvent("authorization",v(v({},this.analyticsParams),{},{type:"password"})),await c.Utils.delay(500),this.emit("auth-success");return!0}return this.setErrorMessage(r.message),this.captcha.reset(),this._submit.animation=!1,!1}get analyticsParams(){var t;return v({type:"oauth"===(null===(t=this.el.closest(".tabs"))||void 0===t?void 0:t.dataset.mode)?"match_account":"authorization"},s.core.ui.activeAuth.analyticsParams)}}var w=i(95374),E=i(44292);var A=i(36005);var S=i(10553);function P(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function C(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?P(Object(i),!0).forEach((function(e){T(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):P(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function T(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const k=i(19755);function D(t){return class extends t{constructor(t){super(C(C({},t),{},{validationRules:C(C({},t.validationRules),t.requirements),addClearButton:!1})),T(this,"_showRequirementsErrors",!1),this._initialValidationHint=this._options.validationHint,k.isEmptyObject(t.requirements)||this._renderHint()}render(){return super.render(),this._renderToggleMaskButton(),this}get _isFulfilled(){return Object.values(this._options.requirements).every((t=>t(this.value)))}_renderHint(){this._hint=document.createElement("div"),this.el.parentElement.insertBefore(this._hint,this.el.nextSibling),this._updateHint(),this.listenTo(this,"focus",(()=>{this._showRequirementsErrors=!1,this.validationHint=!1,this._updateHint()})),this.listenTo(this,"input",(()=>{this._updateHint()})),this.listenTo(this,"blur",(()=>{this._showRequirementsErrors=!0,this.validationHint=!!this._isFulfilled&&this._initialValidationHint,this._updateHint()}))}_renderToggleMaskButton(){this.$els.toggleMaskButton=k(`\n\t\t\t\t<span class="input__toggle-mask">\n\t\t\t\t\t${(0,S.t)("auth__eye")}\n\t\t\t\t</span>\n\t\t\t`).appendTo(this.$el).click((t=>{t.stopPropagation();const e="password"===this.$els.input.attr("type");this.$els.input.attr("type",e?"text":"password"),this.$els.toggleMaskButton.html((0,S.t)(e?"auth__eye-crossed":"auth__eye")),this.focused&&this.focus()}))}_updateHint(){const t=this._checkRequirements();var e,i,s;this._hint.innerHTML=(e={requirements:t,showErrors:this._showRequirementsErrors},i="",s=A.escape,Array.prototype.join,i+='<div class="requirements-hint">\n    <h4 class="requirements-hint__title">Требования к паролю:</h4>\n    <div class="requirements-hint__rules">\n        ',e.requirements.forEach((t=>{i+='\n            <div class="requirements-hint__rule">\n                <div class="requirements-hint__rule__icon">\n                    ',t.fulfilled?i+='\n                        <svg class="icon icon--auth__success" xmlns="http://www.w3.org/2000/svg" width="20" height="20">\n                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon--auth__success"></use>\n                        </svg>\n                    ':e.showErrors&&(i+='\n                        <svg class="icon icon--auth__error" xmlns="http://www.w3.org/2000/svg" width="20" height="20">\n                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon--auth__error"></use>\n                        </svg>\n                    '),i+='\n                </div>\n                <span class="requirements-hint__rule__text">'+s(t.message)+"</span>\n            </div>\n        "})),i+="\n    </div>\n</div>\n")}_checkRequirements(){return Object.entries(this._options.requirements).map((([t,e])=>({message:s.core.i18n(t),fulfilled:e(this.value)})))}}}var I=i(27929);function $(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function O(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?$(Object(i),!0).forEach((function(e){x(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):$(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function x(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class B extends o.T{constructor(t){super(t.$el||t),this.componentName=t.componentName}render(){var t;if(this.isRendered)return this;super.render();const e={validationEvent:u.km.BLUR,sanitizerRules:[h.o.trim()],addSuccessState:!0,onValidityErrorMessage:(t,{input:e})=>{this._sendAnalytics(t,{input:e})}};this.$els.complexity=this.$(".input__complexity");const i=_.S.getInstance().get("UIInput");this._username=new i((0,m.defaults)({$el:this.$('input[name="username"]').parent()},e)),this._username.validationRules={"auth.up.errors.username-short":w.c.isLength(3),"auth.up.errors.username-long":[w.c.isLength(0,16)],"auth.up.errors.username-whitelist":w.c.patternMatch(/^([A-Za-z0-9.]*)$/),"auth.up.errors.username-last-dot":w.c.patternMatch(/[^.]$/),"auth.up.errors.username-first-dot":w.c.patternMatch(/^[^.]/),"auth.up.errors.username-many-dot":t=>(t.match(/\./g)||[]).length<2,"auth.up.errors.username-busy":async t=>{const e=await this._checkUserAvailable(t);return!e&&this._availableNames&&Array.isArray(this._availableNames)&&this._availableNames.length>0?(this._showAvailableUserNames(),!1):(this._availableNames&&0===this._availableNames.length&&this.$els.availableNames&&this.$els.availableNames.remove(),e)}},this._username.preventInvalidInput({"auth.up.errors.username-whitelist":E.p1}),this._email=new i((0,m.defaults)({$el:this.$('input[name="email"]').parent()},e)),this._email.validationRules={"auth.up.errors.email-busy":async t=>this._checkEmailAvailable(t)},this.listenTo(this._email,"blur",this._fillUsernameWithEmail.bind(this));const n=D(i);this._password=new n(O(O({},e),{},{$el:this.$('input[data-role="password"]').parent().parent(),requirements:{"^validation-rules.at-least-x-characters('6')":w.c.isLength(6),"^validation-rules.at-least-x-letters('1')":w.c.patternMatch(/[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\u{10000}-\u{1000B}\u{1000D}-\u{10026}\u{10028}-\u{1003A}\u{1003C}\u{1003D}\u{1003F}-\u{1004D}\u{10050}-\u{1005D}\u{10080}-\u{100FA}\u{10280}-\u{1029C}\u{102A0}-\u{102D0}\u{10300}-\u{1031F}\u{1032D}-\u{10340}\u{10342}-\u{10349}\u{10350}-\u{10375}\u{10380}-\u{1039D}\u{103A0}-\u{103C3}\u{103C8}-\u{103CF}\u{10400}-\u{1049D}\u{104B0}-\u{104D3}\u{104D8}-\u{104FB}\u{10500}-\u{10527}\u{10530}-\u{10563}\u{10570}-\u{1057A}\u{1057C}-\u{1058A}\u{1058C}-\u{10592}\u{10594}\u{10595}\u{10597}-\u{105A1}\u{105A3}-\u{105B1}\u{105B3}-\u{105B9}\u{105BB}\u{105BC}\u{10600}-\u{10736}\u{10740}-\u{10755}\u{10760}-\u{10767}\u{10780}-\u{10785}\u{10787}-\u{107B0}\u{107B2}-\u{107BA}\u{10800}-\u{10805}\u{10808}\u{1080A}-\u{10835}\u{10837}\u{10838}\u{1083C}\u{1083F}-\u{10855}\u{10860}-\u{10876}\u{10880}-\u{1089E}\u{108E0}-\u{108F2}\u{108F4}\u{108F5}\u{10900}-\u{10915}\u{10920}-\u{10939}\u{10980}-\u{109B7}\u{109BE}\u{109BF}\u{10A00}\u{10A10}-\u{10A13}\u{10A15}-\u{10A17}\u{10A19}-\u{10A35}\u{10A60}-\u{10A7C}\u{10A80}-\u{10A9C}\u{10AC0}-\u{10AC7}\u{10AC9}-\u{10AE4}\u{10B00}-\u{10B35}\u{10B40}-\u{10B55}\u{10B60}-\u{10B72}\u{10B80}-\u{10B91}\u{10C00}-\u{10C48}\u{10C80}-\u{10CB2}\u{10CC0}-\u{10CF2}\u{10D00}-\u{10D23}\u{10E80}-\u{10EA9}\u{10EB0}\u{10EB1}\u{10F00}-\u{10F1C}\u{10F27}\u{10F30}-\u{10F45}\u{10F70}-\u{10F81}\u{10FB0}-\u{10FC4}\u{10FE0}-\u{10FF6}\u{11003}-\u{11037}\u{11071}\u{11072}\u{11075}\u{11083}-\u{110AF}\u{110D0}-\u{110E8}\u{11103}-\u{11126}\u{11144}\u{11147}\u{11150}-\u{11172}\u{11176}\u{11183}-\u{111B2}\u{111C1}-\u{111C4}\u{111DA}\u{111DC}\u{11200}-\u{11211}\u{11213}-\u{1122B}\u{1123F}\u{11240}\u{11280}-\u{11286}\u{11288}\u{1128A}-\u{1128D}\u{1128F}-\u{1129D}\u{1129F}-\u{112A8}\u{112B0}-\u{112DE}\u{11305}-\u{1130C}\u{1130F}\u{11310}\u{11313}-\u{11328}\u{1132A}-\u{11330}\u{11332}\u{11333}\u{11335}-\u{11339}\u{1133D}\u{11350}\u{1135D}-\u{11361}\u{11400}-\u{11434}\u{11447}-\u{1144A}\u{1145F}-\u{11461}\u{11480}-\u{114AF}\u{114C4}\u{114C5}\u{114C7}\u{11580}-\u{115AE}\u{115D8}-\u{115DB}\u{11600}-\u{1162F}\u{11644}\u{11680}-\u{116AA}\u{116B8}\u{11700}-\u{1171A}\u{11740}-\u{11746}\u{11800}-\u{1182B}\u{118A0}-\u{118DF}\u{118FF}-\u{11906}\u{11909}\u{1190C}-\u{11913}\u{11915}\u{11916}\u{11918}-\u{1192F}\u{1193F}\u{11941}\u{119A0}-\u{119A7}\u{119AA}-\u{119D0}\u{119E1}\u{119E3}\u{11A00}\u{11A0B}-\u{11A32}\u{11A3A}\u{11A50}\u{11A5C}-\u{11A89}\u{11A9D}\u{11AB0}-\u{11AF8}\u{11C00}-\u{11C08}\u{11C0A}-\u{11C2E}\u{11C40}\u{11C72}-\u{11C8F}\u{11D00}-\u{11D06}\u{11D08}\u{11D09}\u{11D0B}-\u{11D30}\u{11D46}\u{11D60}-\u{11D65}\u{11D67}\u{11D68}\u{11D6A}-\u{11D89}\u{11D98}\u{11EE0}-\u{11EF2}\u{11F02}\u{11F04}-\u{11F10}\u{11F12}-\u{11F33}\u{11FB0}\u{12000}-\u{12399}\u{12480}-\u{12543}\u{12F90}-\u{12FF0}\u{13000}-\u{1342F}\u{13441}-\u{13446}\u{14400}-\u{14646}\u{16800}-\u{16A38}\u{16A40}-\u{16A5E}\u{16A70}-\u{16ABE}\u{16AD0}-\u{16AED}\u{16B00}-\u{16B2F}\u{16B40}-\u{16B43}\u{16B63}-\u{16B77}\u{16B7D}-\u{16B8F}\u{16E40}-\u{16E7F}\u{16F00}-\u{16F4A}\u{16F50}\u{16F93}-\u{16F9F}\u{16FE0}\u{16FE1}\u{16FE3}\u{17000}-\u{187F7}\u{18800}-\u{18CD5}\u{18D00}-\u{18D08}\u{1AFF0}-\u{1AFF3}\u{1AFF5}-\u{1AFFB}\u{1AFFD}\u{1AFFE}\u{1B000}-\u{1B122}\u{1B132}\u{1B150}-\u{1B152}\u{1B155}\u{1B164}-\u{1B167}\u{1B170}-\u{1B2FB}\u{1BC00}-\u{1BC6A}\u{1BC70}-\u{1BC7C}\u{1BC80}-\u{1BC88}\u{1BC90}-\u{1BC99}\u{1D400}-\u{1D454}\u{1D456}-\u{1D49C}\u{1D49E}\u{1D49F}\u{1D4A2}\u{1D4A5}\u{1D4A6}\u{1D4A9}-\u{1D4AC}\u{1D4AE}-\u{1D4B9}\u{1D4BB}\u{1D4BD}-\u{1D4C3}\u{1D4C5}-\u{1D505}\u{1D507}-\u{1D50A}\u{1D50D}-\u{1D514}\u{1D516}-\u{1D51C}\u{1D51E}-\u{1D539}\u{1D53B}-\u{1D53E}\u{1D540}-\u{1D544}\u{1D546}\u{1D54A}-\u{1D550}\u{1D552}-\u{1D6A5}\u{1D6A8}-\u{1D6C0}\u{1D6C2}-\u{1D6DA}\u{1D6DC}-\u{1D6FA}\u{1D6FC}-\u{1D714}\u{1D716}-\u{1D734}\u{1D736}-\u{1D74E}\u{1D750}-\u{1D76E}\u{1D770}-\u{1D788}\u{1D78A}-\u{1D7A8}\u{1D7AA}-\u{1D7C2}\u{1D7C4}-\u{1D7CB}\u{1DF00}-\u{1DF1E}\u{1DF25}-\u{1DF2A}\u{1E030}-\u{1E06D}\u{1E100}-\u{1E12C}\u{1E137}-\u{1E13D}\u{1E14E}\u{1E290}-\u{1E2AD}\u{1E2C0}-\u{1E2EB}\u{1E4D0}-\u{1E4EB}\u{1E7E0}-\u{1E7E6}\u{1E7E8}-\u{1E7EB}\u{1E7ED}\u{1E7EE}\u{1E7F0}-\u{1E7FE}\u{1E800}-\u{1E8C4}\u{1E900}-\u{1E943}\u{1E94B}\u{1EE00}-\u{1EE03}\u{1EE05}-\u{1EE1F}\u{1EE21}\u{1EE22}\u{1EE24}\u{1EE27}\u{1EE29}-\u{1EE32}\u{1EE34}-\u{1EE37}\u{1EE39}\u{1EE3B}\u{1EE42}\u{1EE47}\u{1EE49}\u{1EE4B}\u{1EE4D}-\u{1EE4F}\u{1EE51}\u{1EE52}\u{1EE54}\u{1EE57}\u{1EE59}\u{1EE5B}\u{1EE5D}\u{1EE5F}\u{1EE61}\u{1EE62}\u{1EE64}\u{1EE67}-\u{1EE6A}\u{1EE6C}-\u{1EE72}\u{1EE74}-\u{1EE77}\u{1EE79}-\u{1EE7C}\u{1EE7E}\u{1EE80}-\u{1EE89}\u{1EE8B}-\u{1EE9B}\u{1EEA1}-\u{1EEA3}\u{1EEA5}-\u{1EEA9}\u{1EEAB}-\u{1EEBB}\u{20000}-\u{2A6DF}\u{2A700}-\u{2B739}\u{2B740}-\u{2B81D}\u{2B820}-\u{2CEA1}\u{2CEB0}-\u{2EBE0}\u{2F800}-\u{2FA1D}\u{30000}-\u{3134A}\u{31350}-\u{323AF}]/u),"^validation-rules.at-least-x-digits('1')":w.c.patternMatch(/\d/)},validationRules:{"validation-rules.required":w.c.required()}})),this._subscribe=this._form.getUIElement("subscribe");const r=_.S.getInstance().get("UIButton");this._submit=new r({$el:this.$('button[type="submit"]'),animationName:"signup"});const o=d.c.getInstance();return this.listenToOnce(this._username,"input",(()=>o.sendEvent("create_login",this.analyticsParams))),this.listenToOnce(this._email,"input",(()=>o.sendEvent("create_email",this.analyticsParams))),this.listenToOnce(this._password,"input",(()=>o.sendEvent("create_password",this.analyticsParams))),this._subscribe&&this.listenTo(this._subscribe,"change",(()=>o.sendEvent("mark_get_mailing",O(O({},this.analyticsParams),{},{type_i8:this._subscribe.checked?null:"1",component_name:"registration_form"})))),this._form.add(this._email),this._form.add(this._username),this._form.add(this._password),this._subscribe&&this._form.add(this._subscribe),this.listenTo(this._form,"submit",this._onSubmit),null===(t=this.el.querySelector('[data-to="signin"]'))||void 0===t||t.addEventListener("click",(()=>{o.sendEvent("click",O({button:"have_account"},this.analyticsParams))})),["click","auxclick"].forEach((t=>{var e,i;null===(e=this.el.querySelector(".auth__link-rules"))||void 0===e||e.addEventListener(t,(t=>{0!==t.button&&1!==t.button||o.sendEvent("click",O({button:"rules"},this.analyticsParams))})),null===(i=this.el.querySelector(".auth__link-consent"))||void 0===i||i.addEventListener(t,(t=>{0!==t.button&&1!==t.button||o.sendEvent("click",O({button:"agreement"},this.analyticsParams))}))})),s.core.initParams.withoutCaptcha||(this.captcha.render(),this._grecaptchaV3=p.K.getInstance(),this._grecaptchaV3.render()),this}focus(t=!1){const e=this._email;return e&&(t&&e.highlightFocus(),e.focus()),this}get isLockForm(){return this._options.isLockForm}_fillUsernameWithEmail(){if(!this._username.isEmpty)return;const t=(e=this._email.value,(null!==(i=null===(s=/^[^@]*/.exec(e))||void 0===s?void 0:s[0])&&void 0!==i?i:"").replace(E.p1,".").replace(/\.+/g,".").replace(/^\./,"").replace(/\.$/,""));var e,i,s;t&&(this._username.value=t,this._username.checkValidity())}async _onSubmit(t,e){if(t&&(0,m.isFunction)(t.preventDefault)&&t.preventDefault(),d.c.getInstance().sendEvent("click",O({button:"signup"},this.analyticsParams)),this.isLockForm||this._submit.animation)return;if(this.marks.has("last-submit")&&Date.now()-this.marks.get("last-submit")<1500)return;let i=Date.now();if(this.marks.set("last-submit",i),this.setErrorMessage(),!(await e.checkValidity()))return;let s=this._form.serialize();if(!(await this._fillCaptchaTokens(s)))return;this._submit.animation=!0;const{response:n,data:r}=await a.User.registerSubmit(s);if(await c.Utils.delay(1e3-(Date.now()-i)),n.result){var o;const t=void 0===(null==r?void 0:r.score)?-1:r.score;return d.c.getInstance().sendEvent("account_created",O(O({login:this._username.value,email:this._email.value,rec_score:t},this.analyticsParams),{},{type:"password",get_mailing:null!==(o=this._subscribe)&&void 0!==o&&o.checked?"1":"0"})),d.c.getInstance().google.event("submit","register"),d.c.getInstance().yandex.goal("create_account",{type:"phone"}),void(await this._finishSignup(s,t))}switch(r&&r.param||""){case"username":this._username.setCustomValidity(n.message);break;case"password":this._password.setCustomValidity(n.message);break;case"email":this._email.setCustomValidity(n.message);break;default:n.message&&this.setErrorMessage(n.message)}this.captcha.reset(),this._submit.animation=!1}set isLockForm(t){if(this._options.isLockForm!==(t=Boolean(t)))if(this._options.isLockForm=t,this.cancelInterval("lock-form"),t){let t=60;this._submit.disabled=!0,this.interval("lock-form",1e3,(()=>{--t?this.setErrorMessage(s.core.i18n("auth.up.errors.confirm-limit",t)):this.isLockForm=!1}))}else this.setErrorMessage(!1),this._submit.disabled=!1}async _finishSignup(t,e){var i;this.storePassCredentials(t.username,t.password),null!==(i=this._subscribe)&&void 0!==i&&i.checked&&await(0,I.L)(this._email.value),c.Utils.delay(1e3).then((()=>{this.emit("auth-success")}))}async _fillCaptchaTokens(t){return!!s.core.initParams.withoutCaptcha||!!(await this.captcha.getToken("registration"))&&(t["g-recaptcha-response"]=this.captcha.lastToken,t["g-recaptcha-response"]?(this._grecaptchaV3.lastTokenV3||await this._grecaptchaV3.getTokenV3(),t["g-recaptcha-response-v3"]=this._grecaptchaV3.lastTokenV3,!0):(this.setErrorMessage(s.core.i18n("auth.up.errors.captcha")),!1))}get analyticsParams(){return O({type:"registration"},s.core.ui.activeAuth.analyticsParams)}}var L=i(65645),M=i(62956),F=i(91904),R=i(78049);function N(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function j(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?N(Object(i),!0).forEach((function(e){U(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):N(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function U(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class H extends o.T{render(){var t;if(this.isRendered)return this;super.render();let e={validationEvent:u.km.BLUR,validationHint:{direction:l.Lh.LEFT,alignment:l.SE.CENTER},sanitizerRules:[h.o.trim()],addSuccessState:!0,onValidityErrorMessage:(t,{input:e})=>{this._sendAnalytics(t,{input:e})}};const i=_.S.getInstance().get("UIInput");this._username=new i((0,m.defaults)({$el:this.$('input[name="username"]').parent()},e)),this._username.validationRules={"auth.up.errors.username-short":w.c.isLength(3),"auth.up.errors.username-long":[w.c.isLength(0,16)],"auth.up.errors.username-whitelist":w.c.patternMatch(/^([A-Za-z0-9.]*)$/),"auth.up.errors.username-last-dot":w.c.patternMatch(/[^.]$/),"auth.up.errors.username-first-dot":w.c.patternMatch(/^[^.]/),"auth.up.errors.username-many-dot":t=>(t.match(/\./g)||[]).length<2,"auth.up.errors.username-busy":async t=>{const e=await this._checkUserAvailable(t);return!e&&this._availableNames&&Array.isArray(this._availableNames)&&this._availableNames.length>0?(this._showAvailableUserNames(),!1):(this._availableNames&&0===this._availableNames.length&&this.$els.availableNames&&this.$els.availableNames.remove(),e)}},this._username.preventInvalidInput({"auth.up.errors.username-whitelist":/[^a-z0-9.]/gi});const s=_.S.getInstance().get("UIButton");this._submit=new s({$el:this.$('button[type="submit"]'),animationName:"signup"}),this._type=this.$(".auth__oauth-nick").data("type");const n=_.S.getInstance().get("UIForm");this._form=new n(this.$els.form),this._form.add(this._username);const r=d.c.getInstance();return null===(t=this.el.querySelector('[data-to="signin"]'))||void 0===t||t.addEventListener("click",(()=>{r.sendEvent("click",j({button:"have_account"},this.analyticsParams))})),["click","auxclick"].forEach((t=>{var e,i;null===(e=this.el.querySelector(".auth__link-rules"))||void 0===e||e.addEventListener(t,(t=>{0!==t.button&&1!==t.button||r.sendEvent("click",j({button:"rules"},this.analyticsParams))})),null===(i=this.el.querySelector(".auth__link-consent"))||void 0===i||i.addEventListener(t,(t=>{0!==t.button&&1!==t.button||r.sendEvent("click",j({button:"agreement"},this.analyticsParams))}))})),this.captcha.render(),p.K.getInstance().render(),this.listenTo(this._form,"submit",this._onSubmit),this}async _onSubmit(t,e){d.c.getInstance().sendEvent("click",j({button:"signup"},this.analyticsParams)),t&&(0,m.isFunction)(t.preventDefault)&&t.preventDefault(),d.c.getInstance().google.event("submit","register");const i=await p.K.getInstance().getScore("create_account");if(d.c.getInstance().sendEvent("account_created",j(j({},this.analyticsParams),{},{type:(0,M.Lq)(this._type),login:this._username.value,rec_score:i})),d.c.getInstance().yandex.goal("create_account",{type:this._type}),this._submit.animation)return;if(this.marks.has("last-submit")&&Date.now()-this.marks.get("last-submit")<1500)return;let n=Date.now();if(this.marks.set("last-submit",n),this.setErrorMessage(),!(await e.checkValidity()))return;if(!s.core.initParams.withoutCaptcha&&!(await this.captcha.getToken("registration")))return;const r=e.serialize();this._submit.animation=!0;let o=!1;try{const t=this.captcha.lastToken;if(!s.core.initParams.withoutCaptcha&&!t)return void this.setErrorMessage(s.core.i18n("auth.up.errors.captcha"));o=await a.User.registerOAuth(this._username.value,t),o&&(d.c.getInstance().sendEvent("approve_account",j(j({},this.analyticsParams),{},{type:(0,M.Lq)(this._type),email:r.email,login:r.username,phone:r.phone})),d.c.getInstance().yandex.goal("approve_phone",{type:"phone"}),c.CookieStorage.set(a.USER_SIGNUP_COOKIE_KEY,1,{expires:365}),F.V.isUserInExperiment(F.t.SUBSCRIBE_ON_REG)&&c.LocalStorage.set(R.g,!0),c.Utils.delay(1e3).then((()=>{this.emit("auth-success")})))}catch(l){if("username"===l.param)this._username.setCustomValidity(l.message);else this.setErrorMessage(l.message)}this._submit.animation=!1}get analyticsParams(){return j({type:"match_account"},s.core.ui.activeAuth.analyticsParams)}}var V=i(28650);function W(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function q(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?W(Object(i),!0).forEach((function(e){z(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):W(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function z(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Y extends o.T{constructor(t){super({$el:t.$el||t,componentName:t.componentName,sessionId:t.sessionId})}render(){if(this.isRendered)return this;super.render();const t=q(q({},this._inputConfig),{},{validationEvent:u.km.BLUR,validationHint:{direction:l.Lh.LEFT,alignment:l.SE.CENTER}});this._attempts=4;const e=this.el.querySelector(".auth__tlg-link");e&&(e.href=E.iE+this.sessionId,e.addEventListener("click",(()=>d.c.getInstance().sendEvent("click",q({button:"tg"},this.analyticsParams)))));const i=this.el.querySelector(".auth__tlg-hint");i&&(i.dataset.analyticsEvent="tip_show",i.dataset.analyticsParams=JSON.stringify(q({mode:"manual"},this.analyticsParams)));const s=new V.X({sessionId:this.sessionId}).render();e.parentElement.insertAdjacentElement("beforeend",s.el),this.$els=(0,m.extend)(this.$els,{code:this.$('.input[data-type="code"]'),password:this.$('.input[data-type="password"]'),passwordRepeat:this.$('.input[data-type="password2"]'),submit:this.$('button[type="submit"]')}),this._isUsingCode=Boolean(this.$els.code.length);const n=_.S.getInstance().get("UIInput"),r=D(n),o=_.S.getInstance().get("UIButton");return this._isUsingCode&&(this._code=new n((0,m.defaults)({$el:this.$els.code},t)),this._code.sanitizerRules.add(h.o.whitelist("0-9")),this._form.add(this._code)),this._password=new r(q(q({},t),{},{$el:this.$els.password,requirements:{"^validation-rules.at-least-x-characters('6')":w.c.isLength(6),"^validation-rules.at-least-x-letters('1')":w.c.patternMatch(/[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\u{10000}-\u{1000B}\u{1000D}-\u{10026}\u{10028}-\u{1003A}\u{1003C}\u{1003D}\u{1003F}-\u{1004D}\u{10050}-\u{1005D}\u{10080}-\u{100FA}\u{10280}-\u{1029C}\u{102A0}-\u{102D0}\u{10300}-\u{1031F}\u{1032D}-\u{10340}\u{10342}-\u{10349}\u{10350}-\u{10375}\u{10380}-\u{1039D}\u{103A0}-\u{103C3}\u{103C8}-\u{103CF}\u{10400}-\u{1049D}\u{104B0}-\u{104D3}\u{104D8}-\u{104FB}\u{10500}-\u{10527}\u{10530}-\u{10563}\u{10570}-\u{1057A}\u{1057C}-\u{1058A}\u{1058C}-\u{10592}\u{10594}\u{10595}\u{10597}-\u{105A1}\u{105A3}-\u{105B1}\u{105B3}-\u{105B9}\u{105BB}\u{105BC}\u{10600}-\u{10736}\u{10740}-\u{10755}\u{10760}-\u{10767}\u{10780}-\u{10785}\u{10787}-\u{107B0}\u{107B2}-\u{107BA}\u{10800}-\u{10805}\u{10808}\u{1080A}-\u{10835}\u{10837}\u{10838}\u{1083C}\u{1083F}-\u{10855}\u{10860}-\u{10876}\u{10880}-\u{1089E}\u{108E0}-\u{108F2}\u{108F4}\u{108F5}\u{10900}-\u{10915}\u{10920}-\u{10939}\u{10980}-\u{109B7}\u{109BE}\u{109BF}\u{10A00}\u{10A10}-\u{10A13}\u{10A15}-\u{10A17}\u{10A19}-\u{10A35}\u{10A60}-\u{10A7C}\u{10A80}-\u{10A9C}\u{10AC0}-\u{10AC7}\u{10AC9}-\u{10AE4}\u{10B00}-\u{10B35}\u{10B40}-\u{10B55}\u{10B60}-\u{10B72}\u{10B80}-\u{10B91}\u{10C00}-\u{10C48}\u{10C80}-\u{10CB2}\u{10CC0}-\u{10CF2}\u{10D00}-\u{10D23}\u{10E80}-\u{10EA9}\u{10EB0}\u{10EB1}\u{10F00}-\u{10F1C}\u{10F27}\u{10F30}-\u{10F45}\u{10F70}-\u{10F81}\u{10FB0}-\u{10FC4}\u{10FE0}-\u{10FF6}\u{11003}-\u{11037}\u{11071}\u{11072}\u{11075}\u{11083}-\u{110AF}\u{110D0}-\u{110E8}\u{11103}-\u{11126}\u{11144}\u{11147}\u{11150}-\u{11172}\u{11176}\u{11183}-\u{111B2}\u{111C1}-\u{111C4}\u{111DA}\u{111DC}\u{11200}-\u{11211}\u{11213}-\u{1122B}\u{1123F}\u{11240}\u{11280}-\u{11286}\u{11288}\u{1128A}-\u{1128D}\u{1128F}-\u{1129D}\u{1129F}-\u{112A8}\u{112B0}-\u{112DE}\u{11305}-\u{1130C}\u{1130F}\u{11310}\u{11313}-\u{11328}\u{1132A}-\u{11330}\u{11332}\u{11333}\u{11335}-\u{11339}\u{1133D}\u{11350}\u{1135D}-\u{11361}\u{11400}-\u{11434}\u{11447}-\u{1144A}\u{1145F}-\u{11461}\u{11480}-\u{114AF}\u{114C4}\u{114C5}\u{114C7}\u{11580}-\u{115AE}\u{115D8}-\u{115DB}\u{11600}-\u{1162F}\u{11644}\u{11680}-\u{116AA}\u{116B8}\u{11700}-\u{1171A}\u{11740}-\u{11746}\u{11800}-\u{1182B}\u{118A0}-\u{118DF}\u{118FF}-\u{11906}\u{11909}\u{1190C}-\u{11913}\u{11915}\u{11916}\u{11918}-\u{1192F}\u{1193F}\u{11941}\u{119A0}-\u{119A7}\u{119AA}-\u{119D0}\u{119E1}\u{119E3}\u{11A00}\u{11A0B}-\u{11A32}\u{11A3A}\u{11A50}\u{11A5C}-\u{11A89}\u{11A9D}\u{11AB0}-\u{11AF8}\u{11C00}-\u{11C08}\u{11C0A}-\u{11C2E}\u{11C40}\u{11C72}-\u{11C8F}\u{11D00}-\u{11D06}\u{11D08}\u{11D09}\u{11D0B}-\u{11D30}\u{11D46}\u{11D60}-\u{11D65}\u{11D67}\u{11D68}\u{11D6A}-\u{11D89}\u{11D98}\u{11EE0}-\u{11EF2}\u{11F02}\u{11F04}-\u{11F10}\u{11F12}-\u{11F33}\u{11FB0}\u{12000}-\u{12399}\u{12480}-\u{12543}\u{12F90}-\u{12FF0}\u{13000}-\u{1342F}\u{13441}-\u{13446}\u{14400}-\u{14646}\u{16800}-\u{16A38}\u{16A40}-\u{16A5E}\u{16A70}-\u{16ABE}\u{16AD0}-\u{16AED}\u{16B00}-\u{16B2F}\u{16B40}-\u{16B43}\u{16B63}-\u{16B77}\u{16B7D}-\u{16B8F}\u{16E40}-\u{16E7F}\u{16F00}-\u{16F4A}\u{16F50}\u{16F93}-\u{16F9F}\u{16FE0}\u{16FE1}\u{16FE3}\u{17000}-\u{187F7}\u{18800}-\u{18CD5}\u{18D00}-\u{18D08}\u{1AFF0}-\u{1AFF3}\u{1AFF5}-\u{1AFFB}\u{1AFFD}\u{1AFFE}\u{1B000}-\u{1B122}\u{1B132}\u{1B150}-\u{1B152}\u{1B155}\u{1B164}-\u{1B167}\u{1B170}-\u{1B2FB}\u{1BC00}-\u{1BC6A}\u{1BC70}-\u{1BC7C}\u{1BC80}-\u{1BC88}\u{1BC90}-\u{1BC99}\u{1D400}-\u{1D454}\u{1D456}-\u{1D49C}\u{1D49E}\u{1D49F}\u{1D4A2}\u{1D4A5}\u{1D4A6}\u{1D4A9}-\u{1D4AC}\u{1D4AE}-\u{1D4B9}\u{1D4BB}\u{1D4BD}-\u{1D4C3}\u{1D4C5}-\u{1D505}\u{1D507}-\u{1D50A}\u{1D50D}-\u{1D514}\u{1D516}-\u{1D51C}\u{1D51E}-\u{1D539}\u{1D53B}-\u{1D53E}\u{1D540}-\u{1D544}\u{1D546}\u{1D54A}-\u{1D550}\u{1D552}-\u{1D6A5}\u{1D6A8}-\u{1D6C0}\u{1D6C2}-\u{1D6DA}\u{1D6DC}-\u{1D6FA}\u{1D6FC}-\u{1D714}\u{1D716}-\u{1D734}\u{1D736}-\u{1D74E}\u{1D750}-\u{1D76E}\u{1D770}-\u{1D788}\u{1D78A}-\u{1D7A8}\u{1D7AA}-\u{1D7C2}\u{1D7C4}-\u{1D7CB}\u{1DF00}-\u{1DF1E}\u{1DF25}-\u{1DF2A}\u{1E030}-\u{1E06D}\u{1E100}-\u{1E12C}\u{1E137}-\u{1E13D}\u{1E14E}\u{1E290}-\u{1E2AD}\u{1E2C0}-\u{1E2EB}\u{1E4D0}-\u{1E4EB}\u{1E7E0}-\u{1E7E6}\u{1E7E8}-\u{1E7EB}\u{1E7ED}\u{1E7EE}\u{1E7F0}-\u{1E7FE}\u{1E800}-\u{1E8C4}\u{1E900}-\u{1E943}\u{1E94B}\u{1EE00}-\u{1EE03}\u{1EE05}-\u{1EE1F}\u{1EE21}\u{1EE22}\u{1EE24}\u{1EE27}\u{1EE29}-\u{1EE32}\u{1EE34}-\u{1EE37}\u{1EE39}\u{1EE3B}\u{1EE42}\u{1EE47}\u{1EE49}\u{1EE4B}\u{1EE4D}-\u{1EE4F}\u{1EE51}\u{1EE52}\u{1EE54}\u{1EE57}\u{1EE59}\u{1EE5B}\u{1EE5D}\u{1EE5F}\u{1EE61}\u{1EE62}\u{1EE64}\u{1EE67}-\u{1EE6A}\u{1EE6C}-\u{1EE72}\u{1EE74}-\u{1EE77}\u{1EE79}-\u{1EE7C}\u{1EE7E}\u{1EE80}-\u{1EE89}\u{1EE8B}-\u{1EE9B}\u{1EEA1}-\u{1EEA3}\u{1EEA5}-\u{1EEA9}\u{1EEAB}-\u{1EEBB}\u{20000}-\u{2A6DF}\u{2A700}-\u{2B739}\u{2B740}-\u{2B81D}\u{2B820}-\u{2CEA1}\u{2CEB0}-\u{2EBE0}\u{2F800}-\u{2FA1D}\u{30000}-\u{3134A}\u{31350}-\u{323AF}]/u),"^validation-rules.at-least-x-digits('1')":w.c.patternMatch(/\d/)},validationRules:{"validation-rules.required":w.c.required()}})),this._form.add(this._password),this._passwordRepeat=new r(q(q({},t),{},{$el:this.$els.passwordRepeat,requirements:{},validationRules:{"auth.up.errors.password-mismatch":t=>this._password.value.trim()===t.trim()}})),this._form.add(this._passwordRepeat),this._submit=new o({$el:this.$els.submit,animationName:"signin"}),this.listenTo(this._password,"blur",(()=>{document.activeElement!==this._passwordRepeat.els.input&&Boolean(this._passwordRepeat.value)&&this._passwordRepeat.checkValidity()})),this.listenTo(this._password,"input",(0,m.debounce)((()=>{Boolean(this._passwordRepeat.value)&&this._passwordRepeat.checkValidity({showValidationHint:!1})}),200)),this._isUsingCode&&this.listenToOnce(this._code,"input",(()=>{d.c.getInstance().sendEvent("create_code",this.analyticsParams)})),this.listenToOnce(this._password,"input",this._onPasswordInput),this.listenToOnce(this._passwordRepeat,"input",this._onPasswordRepeatInput),this.listenTo(this._form,"submit",this._onSubmit),this}async _onSubmit(t){if(d.c.getInstance().sendEvent("click",q({button:"submit"},this.analyticsParams)),t&&(0,m.isFunction)(t.preventDefault)&&t.preventDefault(),this._submit.progress||!(await this._form.checkValidity()))return;this._submit.progress=!0,this._submit.disabled=!0;const e=Date.now();if(!this._isUsingCode){d.c.getInstance().sendEvent("click",{type:"account_recovery_password_update",login:this._login});let t=this.$el.data("params");t=(0,m.isEmpty)(t)?{}:t,t.action="set_password",t.p=this._password.value;try{await a.User.restorePassword(t),this.setMessage(s.core.i18n("auth.forget.changed")),this._submit.progress=!1,setTimeout((()=>{window.location.href="/"}),2e3)}catch(n){this.setErrorMessage(n.message||s.core.i18n("auth.forget.failure")),this._submit.progress=!1,this._submit.disabled=!1}return}const i=await a.User.restorePasswordConfirm(this.sessionId||"",this._code.value,this._password.value);return await c.Utils.delay(1e3-(Date.now()-e)),i.response.result?s.core.emit("need-show-signin-form",s.core.i18n("auth.forget.changed")):--this._attempts?(this.setErrorMessage(i.response.message),i.data&&"code"===i.data.type?this._code.value="":i.data&&"password"===i.data.type&&(this._password.value="",this._passwordRepeat.value="")):(this.setErrorMessage(s.core.i18n("auth.up.errors.confirm-limit")),this.isLockForm=!0,this._attempts=4),this._submit.progress=!1,this._submit.disabled=!1,!1}_onPasswordInput(){this._login=this.$el.find('[data-role="user-name"]').text(),d.c.getInstance().sendEvent("create_password",q(q({},this.analyticsParams),{},{repeated:0}))}_onPasswordRepeatInput(){this._login||(this._login=this.$el.find('[data-role="user-name"]').text()),d.c.getInstance().sendEvent("create_password",q(q({},this.analyticsParams),{},{repeated:1}))}get analyticsParams(){return q({type:"password_recovery"},s.core.ui.activeAuth.analyticsParams)}}var G=i(61279),K=i(43241),X=i(55529);class Z extends K.u{showGoogleWarningPopup(t){this.popup||(this.popup=new l._({target:t,content:this.getTemplate(t.offsetWidth),zIndex:(0,X.e)(),direction:l.Lh.TOP,destroyAfterHide:!0}),this.popup.show(),this.popup.content[0].querySelector(".google-warning-popup__close").addEventListener("click",(()=>{this.popup.hide()})))}getTemplate(t){return`\n\t\t\t<div class="google-warning-popup" style="width: ${t}px">\n\t\t\t\t<div class="google-warning-popup__icon"><svg width="28" height="28" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="28" height="28" rx="14" fill="#FFF0C0"/><path d="M5.3 14.717c.017-1.146.109-2.29.276-3.424.04-.27-.07-.518-.11-.775-.281-1.81.631-3.485 2.314-4.236 1.21-.54 2.478-.686 3.786-.586.572.044 1.133.16 1.699.246.058.009.114.025.173.009 1.053-.297 2.072-.136 3.077.218 1.44.509 2.578 1.39 3.352 2.721.166.284.27.594.378.902.054.154.137.296.245.418 1.026 1.18 1.738 2.52 2.067 4.057.188.877.236 1.757-.125 2.6-.546 1.275-1.502 2.071-2.88 2.328a1.09 1.09 0 0 0-.54.257c-.591.515-1.169 1.044-1.778 1.537-1.26 1.02-2.716 1.404-4.315 1.337-1.123-.048-2.176-.372-3.198-.827-.902-.402-1.752-.886-2.454-1.593-.808-.813-1.475-1.72-1.767-2.853-.168-.655-.17-1.332-.197-2.003-.005-.111-.003-.222-.003-.333Zm13.272 2.86c.158-.01.316-.018.473-.029 1.184-.076 2.093-1.188 1.94-2.361a7.08 7.08 0 0 0-1.063-2.899c-.168-.265-.168-.264-.409-.078-.7.538-1.495.608-2.331.472-.858-.14-1.64-.481-2.396-.896-.986-.541-1.845-1.229-2.47-2.18-.415-.632-.643-1.306-.485-2.073.025-.12-.042-.123-.124-.125-.363-.008-.725-.027-1.089-.024-.785.008-1.545.143-2.25.51-.833.437-1.274 1.117-1.242 2.079.022.653.275 1.223.616 1.763.702 1.114 1.661 1.965 2.745 2.689 1.754 1.17 3.659 2.02 5.66 2.668.789.258 1.587.469 2.425.483Zm-1.7 1.495c-.359-.098-.708-.186-1.053-.29-1.8-.543-3.497-1.322-5.139-2.227-1.236-.683-2.36-1.52-3.33-2.56-.096-.104-.191-.21-.312-.34 0 .663-.003 1.286 0 1.91.003.403.006.81.14 1.193.297.843.83 1.523 1.489 2.107.805.716 1.77 1.136 2.783 1.457.823.261 1.661.381 2.523.262.983-.137 1.826-.577 2.577-1.212.111-.09.229-.177.324-.3h-.002ZM14.51 7.492a1.663 1.663 0 0 0-.815.185c-.22.118-.268.242-.182.477.141.385.359.737.64 1.036.772.829 1.744 1.332 2.8 1.69.372.125.757.196 1.155.14.444-.065.64-.368.498-.79a2.044 2.044 0 0 0-.14-.34c-.857-1.563-2.238-2.26-3.956-2.398Z" fill="#FFC71A"/></svg>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="google-warning-popup__content">\n\t\t\t\t\t<h6>\n\t\t\t\t\t\tПрекращаем поддерживать Google&nbsp;ID\n\t\t\t\t\t</h6>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tСкоро на&nbsp;Пикабу станет нельзя зайти через Google&nbsp;ID&nbsp;—\n\t\t\t\t\t\tэто&nbsp;требование закона. Зайдя в&nbsp;профиль,\n\t\t\t\t\t\tпоменяйте способ авторизации\n\t\t\t\t\t\t<a href="http://pikabu.ru/go/data_refresh" target="_blank">по&nbsp;инструкции</a>,\n\t\t\t\t\t\tчтобы сохранить доступ к&nbsp;аккаунту\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="google-warning-popup__close">\n\t\t\t\t\t${s.core.icon("ui__ic_close","google-warning-popup__close")}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`}get popup(){return this._popup}set popup(t){this._popup=t}}var Q=i(39037);function J(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function tt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?J(Object(i),!0).forEach((function(e){et(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):J(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function et(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const it=i(19755);class st extends n.u1{constructor(t,e,i={}){super(t),et(this,"_analyticsParams",{}),et(this,"_onAuthSuccess",(t=>{this.emit("authSuccess",t),"auth"!==s.core.initParams.pageName&&this._authRedirect()})),et(this,"_authRedirect",(()=>{this.redirectUrl?s.core.location.href=this.redirectUrl:s.core.location.reload()})),this.componentName=e,this._analyticsParams=i}render(){if("feed_popup"===this.componentName?this._openTime=(new Date).getTime():this._openTime=void 0,this.isRendered)return this;this.$els={signup:this.$('.tabs__tab[data-id="signup"]'),signin:this.$('.tabs__tab[data-id="signin"]'),forget:this.$('.tabs__tab[data-id="forget"]'),changePassword:this.$('.tabs__tab[data-id="change-password"]'),oauth:this.$('.tabs__tab[data-id="oauth"]')},this.$els.oauth.length?(this._oauth=new H(this.$els.oauth),this.listenTo(this._oauth,"auth-success",this._onAuthSuccess)):this.$els.signin.length&&(this._signin=new b(this.$els.signin),this.listenTo(this._signin,"auth-success",(()=>this._onAuthSuccess("signin")))),this._tabs=new r.F(this.$el),this.listenTo(this._tabs,"change",this._onChangeTab),this.listenTo(s.core,"need-show-change-form",(t=>{this.sessionId=t,this.changeTab("change-password")})),this.listenTo(s.core,"need-show-signin-form",(t=>{this.changeTab("signin"),this._signin.setMessage(t)})),this.$el.on("click",'[data-role="route"]',this._onClickRoute.bind(this)),this.$('[data-role="cancel"]').on("click",a.User.logout),s.core.ui.$els.document.on("click",".to-signin",(async t=>{t.preventDefault(),this._sendAnalyticsEvent("click",{type:"auth_reg_form_authorize"}),await this._signin.autoSignIn()&&Boolean(navigator.credentials)||this.scrollToAuth()})),s.core.ui.$els.document.on("click",".to-signup",(t=>{t.preventDefault(),"welcome"===t.target.dataset.type&&this._sendAnalyticsEvent("reg_notification_click",{type:"welcome"}),this.scrollToAuth(!0),this._sendAnalyticsEvent("click",{type:"auth_reg_form_register"})})),this.$el.on("click",'[data-to="signup"]',(async t=>{t.preventDefault()}));const t=new Z;return this.$el.on("click",".auth__provider",(async e=>{e.preventDefault();const i=e.currentTarget,n=(0,M.Lq)(i.dataset.role);var r,o;(this._sendAnalyticsEvent("click",tt(tt({},this.analyticsParams),{},{button:n,type:n})),"sidebar"===this.analyticsParams.component_name)&&G._.set(null!==(r=null===(o=this.currentForm)||void 0===o?void 0:o.analyticsParams)&&void 0!==r?r:this.analyticsParams,null);if("google"===n&&!t.popup)return void t.showGoogleWarningPopup(i);await c.Utils.delay(500);const a=i.getAttribute("href")+(s.core.history.location.hash?"&hash="+encodeURIComponent(s.core.history.location.hash):"");(0,Q.Z)()?window.open(a):window.location.href=a})),this._redirectUrl&&this._updateOauthRedirectUrl(),super.render(),this}scrollToAuth(t=!1){return s.core.isUserAuthorized||(this._tabs.currentTab=t?"signup":"signin",queueMicrotask((()=>{s.core.ui.scrollTo(s.core.ui.sidebar.$el.offset().top,!0)})),this.timeout("focus",300,(()=>{t?this._signup.focus(!0):this._signin.focus(!0)}))),this}_onChangeTab(t){switch(t){case"signup":this.$els.signup.length&&!this._signup&&(this._signup=new B({$el:this.$els.signup,componentName:this.componentName}),this.listenTo(this._signup,"auth-success",(()=>this._onAuthSuccess("signup")))),!this.componentName&&this._signup.focus();break;case"forget":this.$els.forget.length&&!this._forget&&(this._forget=new L.Z({$el:this.$els.forget,componentName:this.componentName})),!this.componentName&&this._forget.focus();break;case"oauth":this.$els.oauth.length&&!this._oauth&&(this._oauth=new H(this.$els.oauth),this.listenTo(this._oauth,"auth-success",this._onAuthSuccess)),!this.componentName&&this._oauth.focus();break;case"signin":this.$els.signin.length&&!this._signin&&(this._signin=new b({$el:this.$els.signin,componentName:this.componentName}),this.listenTo(this._signin,"auth-success",(()=>this._onAuthSuccess("signin")))),!this.componentName&&this._signin.focus();break;case"change-password":this.$els.changePassword.length&&!this._changePassword&&(this._changePassword=new Y({$el:this.$els.changePassword,componentName:this.componentName,sessionId:this.sessionId})),!this.componentName&&this._changePassword.focus()}return this.$el.attr("data-step",t),s.core.emit("auth-tab-changed",t),this}_onClickRoute(t){t.preventDefault();let e=it(t.target).closest("[data-to]");return this.$els.error&&(this.$els.error.get(0).hidden=!0),this._tabs.currentTab=e.data("to"),this}changeTab(t){this._tabs.currentTab=t}_sendAnalyticsEvent(t,e){var i,s;d.c.getInstance().sendEvent(t,tt(tt({},null!==(i=null===(s=this.currentForm)||void 0===s?void 0:s.analyticsParams)&&void 0!==i?i:this.analyticsParams),e))}_updateOauthRedirectUrl(){this.el.querySelectorAll('[class*="social-icon"]').forEach((t=>{const e=new URL(t.href);this._redirectUrl?e.searchParams.set("ref",this._redirectUrl):e.searchParams.delete("ref"),t.href=e.toString()}))}get currentForm(){var t;switch(null===(t=this._tabs)||void 0===t?void 0:t.currentTab){case"signup":return this._signup;case"forget":return this._forget;case"oauth":return this._oauth;case"signin":return this._signin;case"change-password":return this._changePassword}}get analyticsParams(){return tt({component_name:"feed_popup"===this.componentName?"popup":"sidebar","view_time!empty":this._openTime?Math.round((new Date).getTime()-this._openTime):null},this._analyticsParams)}set analyticsParams(t){this._analyticsParams=t}get redirectUrl(){return this._redirectUrl}set redirectUrl(t){this._redirectUrl!==t&&(t&&(t=new URL(t,document.baseURI).toString()),this._redirectUrl=t,this._updateOauthRedirectUrl())}}},72283:(t,e,i)=>{i.d(e,{o:()=>_});i(88674);var s=i(53056),n=i(1262),r=i(2889),o=i(63907),a=i(44361),l=i(15112),u=i(53201),h=i(91904),c=i(78049),d=i(12953),p=i(45990);const m="pkb_afterauth";class _{static addAction(t){s.m.set(m,t)}static clearAction(){s.m.remove(m)}static async runActions(){await this.runSubscribeAction(),h.V.isUserInExperiment(h.t.SUBSCRIBE_ON_REG)&&await this.openSubscribeAfterReg()}static async runSubscribeAction(){var t;const e=s.m.get(m);if(this.clearAction(),!(e&&e instanceof Object))return;const i=e.data,h=(t,e,i)=>{try{(0,l.S)().subscribe[t][e]=i}catch(s){}};if("subscribe_author"===e.action&&null!=i&&i.id){const t=Number(i.id);try{await new n.User(t).subscribe(i.value,i.analyticsParams,i.source)}catch(d){var c;if(null===(c=d.message)||void 0===c||!c.startsWith("Вы уже подписаны"))throw d}this.postRunAction=()=>{h("user",String(t),i.value);const e=o.u1.getUIElement(document.querySelector(".video-feed"));e&&e.videos.forEach((e=>{e.user_id===t&&(e.user_is_subscribed=i.value)}))}}else if("subscribe_community"===e.action&&null!=i&&i.id){const t=Number(i.id);await new r.S1(t).subscribe(i.value,i.analyticsParams,i.source),this.postRunAction=()=>{h("community",String(t),i.value)}}else if("subscribe_tag"===e.action&&null!=i&&i.tag){const t=i.tag;await a.zG.subscribe(t,i.value,i.analyticsParams),this.postRunAction=()=>{h("tag",t,i.value)}}else if("subscribe_comstory"===e.action&&null!=i&&i.id){const t=Number(i.id);await(0,u.t)(Number(t),i.value),this.postRunAction=()=>{h("comstory",String(t),i.value)}}else"subscribe_comment"===e.action&&null!=i&&i.id&&await p.L.getInstance().subsribeToCommentById(Number(i.id));null===(t=this.postRunAction)||void 0===t||t.call(this)}static async openSubscribeAfterReg(){if(!0===s.m.get(c.g)||d.core.initParams.oauthAutoRegister){const{createApp:t}=await i(18978);await t().mount(document.createDocumentFragment()),s.m.remove(c.g)}}}},61279:(t,e,i)=>{i.d(e,{_:()=>l});i(41817);var s=i(34524);function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){o(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function o(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const a="pkb_afa";class l{static set(t,e=Date.now()){s.x.set(a,{params:t,openTime:e})}static get(){const t=s.x.get(a);if(t)return r(r({},t.params),{},{view_time:t.openTime?Math.round(Date.now()-t.openTime):void 0})}static clear(){s.x.remove(a)}}},44292:(t,e,i)=>{i.d(e,{E0:()=>n,iE:()=>r,p1:()=>s});const s=/[^\d.a-z]/gi,n=/^\+?([87](?!95[4-7]|998|907|94[^09]|336)([348]\d|9[0-6789]|7[0247])\d{8}|[1246]\d{9,13}|68\d{7}|5[1-46-9]\d{8,12}|55[1-9]\d{9}|55[12]19\d{8}|500[56]\d{4}|5016\d{6}|5068\d{7}|502[45]\d{7}|5037\d{7}|50[4567]\d{8}|50855\d{4}|509[34]\d{7}|376\d{6}|855\d{8}|856\d{10}|85[0-4789]\d{8,10}|8[68]\d{10,11}|8[14]\d{10}|82\d{9,10}|852\d{8}|90\d{10}|96(0[79]|17[01]|13)\d{6}|96[23]\d{9}|964\d{10}|96(5[69]|89)\d{7}|96(65|77)\d{8}|92[023]\d{9}|91[1879]\d{9}|9[34]7\d{8}|959\d{7}|989\d{9}|97\d{8,12}|99[^4568]\d{7,11}|994\d{9}|9955\d{8}|996[257]\d{8}|9989\d{8}|380[3-79]\d{8}|381\d{9}|385\d{8,9}|375[234]\d{8}|372\d{7,8}|37[0-4]\d{8}|37[6-9]\d{7,11}|30[69]\d{9}|34[67]\d{8}|3[12359]\d{8,12}|36\d{9}|38[1679]\d{8}|382\d{8,9}|46719\d{10}|968\d{8})$/,r="tg://resolve?domain=pikabu_access_code_bot&start="},32061:(t,e,i)=>{i.d(e,{T:()=>s});const s={username:{"too-short":"nickname_short","too-long":"nickname_long",required:"nickname_empty","username-busy":"nickname_occupied","username-first-dot":"nickname_wrong_symbol","username-last-dot":"nickname_wrong_symbol","username-whitelist":"nickname_wrong_symbol","username-short":"nickname_short","username-long":"nickname_long","Логин занят":"nickname_occupied","Использование слова moderator в никнейме запрещено":"nickname_occupied"},phone:{required:"phone_empty",phone:"phone_wrong"," Отвяжите его или обратитесь в поддержку":"phone_occupied"},email:{email:"email_wrong",required:"email_empty","Email используется":"email_occupied"},password:{"too-short":"password_short","password-week":"password_weak",required:"password_empty","password-short":"password_short","password-wrong":"password_wrong"},username_socials:{"too-short":"nickname_short","too-long":"nickname_long",required:"nickname_empty","username-busy":"nickname_occupied","username-first-dot":"nickname_wrong_symbol","username-last-dot":"nickname_wrong_symbol","username-whitelist":"nickname_wrong_symbol","username-short":"nickname_short","username-long":"nickname_long"},phone_socials:{required:"phone_empty"},contact:{format:"email_or_phone_wrong",required:"email_or_phone_empty"},login:{required:"login_empty","too-short":"login_short"},restore_passwd1:{"password-week":"password_weak","password-mismatch":"password_differ",required:"password_empty","too-short":"password_short"},restore_passwd2:{"password-mismatch":"password_differ",required:"password_empty"},"password-repeat":{"too-short":"password_short",required:"password_empty","password-mismatch":"password_differ"}}},31474:(t,e,i)=>{i.d(e,{j:()=>s});const s=new(i(65448).xs)({DEFAULT:"",SUCCESS:"success",DANGER:"danger",WARNING:"warning",DARK:"dark"})},41574:(t,e,i)=>{i.d(e,{E:()=>_,g:()=>f});i(74916),i(15306),i(85827);var s=i(12953),n=i(63907),r=i(44497),o=i(88358),a=i(96637);const l="pkb_Cvd";var u=i(36005);var h=i(90312),c=i(36005);const d=i(19755),p=i(30381);let m=new Date;class _ extends n.u1{constructor(t){super(),this._requestAnimation=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/24)},this._minDateProps={year:2010,month:8,day:0,momentDate:p("2010-09-01")},this._maxDateProps={year:m.getFullYear(),month:m.getMonth(),day:m.getDate(),momentDate:p()},this._isMobileView=!1,this._useTouchEvent="ontouchstart"in document.documentElement,this._useTouchEvent||(this._useTouchEvent=s.core.deviceType===r.me.MOBILE||s.core.deviceType===r.me.TABLET),this._canvases=null,this._contexts=null,this._monthCache=null,this._dayCellSize=28,this._monthCacheKeys=null,this._renderCallback=this._renderCalendar.bind(this),this._interruptCallback=this._interrupt.bind(this),this._interruptTimer=null,this._displayMonth=null,this._timelineProps=null,this._timeLine=106.9,this._lastTimeLine=0,this._showButtonsPanel=!0,this._datesRangeMode=!1,this._width=450,this._calendarProps=null,this._needRedraw=!1,this._needMonthRedraw=!1,this._needTimelineRedraw=!1,this._ownEventHandlers=null,this._dayUnderPoiner=null,this._selectedRange=null,this._textWidthCache=null,this._skipRollerDrag=!1,this._gcTimer=0,this._initDates=null,this._errMsgBox=null,this._presetButtons=[],this._dateChangedCounter=0,this._initialDirection="right",this._scale=s.core.ui.devicePixelRatio,(0,c.isObject)(t)&&this.setOptions(t)}set showButtonsPanel(t){this._showButtonsPanel=!0===t}get showButtonsPanel(){return this._showButtonsPanel}set datesRangeMode(t){this._datesRangeMode=!0===t}get datesRangeMode(){return this._datesRangeMode}set width(t){(t=Number(t))==t&&(this._width=Math.max(200,Math.min(1400,t)))}get width(){return this._width}set limitStart(t){let e=p(t);e.isValid()&&(this._minDateProps={year:Number(e.format("YYYY")),month:Number(e.format("MM"))-1,day:Number(e.format("DD")),momentDate:e})}set limitEnd(t){let e=p(t);e.isValid()&&(this._maxDateProps={year:Number(e.format("YYYY")),month:Number(e.format("MM"))-1,day:Number(e.format("DD")),momentDate:e})}set initialDirection(t){"left"!==t&&"right"!==t||(this._initialDirection=t)}setDate(t,e){let i=this._parseDate(t),s=e?this._parseDate(e):i;if(this._calendarProps)null===s&&(s=i),this._selectedRange={from:i,to:s,forceNewRange:!1},this._initDates={from:i,to:s},this.$els.date1.val(_._getFormattedDate(i)),this.$els.date2.val(_._getFormattedDate(s)),this._needRedraw=!0,this._needMonthRedraw=!0;else{if(null===i)return this._initDates=null,this;null===s&&(s=i),this._initDates={from:i,to:s}}return this}get selectedDatesCaption(){return this._getSelectionParams().caption}get selectedDates(){return this._getSelectionParams()}get isFullRangeSelected(){return this._getSelectionParams().caption===s.core.i18n("calendar.captions.all-time")}addPresetButton(t,e,i){return this._presetButtons.push({caption:t,callback:e,pressed:!0===i}),this}getMinDate(){var t,e;let i=1970+~~((null===(t=this._timelineProps)||void 0===t?void 0:t.minTimeLine)/12),s=(null===(e=this._timelineProps)||void 0===e?void 0:e.minTimeLine)-12*(i-1970);return new Date(i,s,1,0,0,0,0)}setRangeByType(t,e=!0){let i,s,n=Date.now();if(this.$el||this._create(),h.c.getInstance().sendEvent("filter",{filter_type:"random"===t?"random_date":"date"}),e){switch(t){default:case"all_time":let t=1970+~~(this._timelineProps.minTimeLine/12),e=this._timelineProps.minTimeLine-12*(t-1970);i=new Date(t,e,1,0,0,0,0),s=new Date,this.$els.date1.val(_._getFormattedDate(i.getTime())).trigger("change","all_time"),this.$els.date2.val(_._getFormattedDate(n)).trigger("change","all_time");break;case"month":this.$els.date2.val(_._getFormattedDate(n)).change(),s=p().subtract(1,"months").toDate(),n=s.getTime(),this.$els.date1.val(_._getFormattedDate(n)).change();break;case"week":this.$els.date2.val(_._getFormattedDate(n)).change(),n-=6048e5,s=new Date(n),this.$els.date1.val(_._getFormattedDate(n)).change();break;case"today":s=new Date,i=_._getFormattedDate(n),this.$els.date2.val(i).change(),this.$els.date1.val(i).change();break;case"random":let r=_._generateRandomDay(this._minDateProps.momentDate.toDate());s=r,i=_._getFormattedDate(r.getTime()),this.$els.date1.val(i).trigger("change"),this.$els.date2.val(i).trigger("change")}this._easingTimeline(12*(s.getFullYear()-1970)+s.getMonth())}else{s=new Date;let e,r=this._filterDateInput(!1,!0,_._getFormattedDate(n));switch(t){default:case"all_time":let t=1970+~~(this._timelineProps.minTimeLine/12),s=this._timelineProps.minTimeLine-12*(t-1970),o=new Date(t,s,1,0,0,0,0);this._selectDateOneMode(o.getTime(),"from"),this._selectDateOneMode(r,"to");break;case"month":this._selectDateOneMode(r,"to");const a=p().subtract(1,"months").valueOf();e=_._getFormattedDate(a),r=this._filterDateInput(!1,!0,e),this._selectDateOneMode(r,"from");break;case"week":this._selectDateOneMode(r,"to"),e=_._getFormattedDate(n-6048e5),r=this._filterDateInput(!1,!0,e),this._selectDateOneMode(r,"from");break;case"today":i=_._getFormattedDate(Date.now()),this.$els.date1.length&&this.$els.date1.val(i).trigger("change");break;case"random":let l=_._generateRandomDay(this._minDateProps.momentDate.toDate());i=_._getFormattedDate(l.getTime()),this.$els.date1.length&&this.$els.date1.val(i).trigger("change")}}}static _formatDate(t,e){let i="0"+String(t.getDate()),n="0"+String(t.getMonth()+1),r=String(t.getFullYear());return"dd M yyyy"===e?i.substr(-2)+" "+s.core.i18n("calendar.months."+t.getMonth())+" "+r:"yyyy-mm-dd"===e?r+"-"+n.substr(-2)+"-"+i.substr(-2):"dd-mm-yyyy"===e?i.substr(-2)+"-"+n.substr(-2)+"-"+r:""}render(){return this.$el||this._create(),super.render(),this}_create(){var t,e,i,n;this._prepareData(),this.$el=d((t={isMobile:this._isMobileView,width:this._width,isDatesRangeMode:this._datesRangeMode,showButtonsPanel:this._showButtonsPanel,presetButtons:this._presetButtons,dateFrom:this._datesRangeMode&&this._selectedRange.from?_._getFormattedDate(this._selectedRange.from):"",dateTo:this._datesRangeMode&&this._selectedRange.to?_._getFormattedDate(this._selectedRange.to):""},i="",n=u.escape,Array.prototype.join,i+='<div class="calendar '+(null==(e=t.isMobile?"calendar_mobile":"")?"":e)+'" style="width: '+(null==(e=t.width)?"":e)+'px">\n\t<div class="calendar-head">\n\t\t',t.isDatesRangeMode?(i+="\n\t\t\t",t.showButtonsPanel&&(i+='\n\t\t\t\t<div class="calendar-head__buttons">\n\t\t\t\t',t.presetButtons.length>0?(i+="\n\t\t\t\t\t",t.presetButtons.forEach((function(t,s){i+='\n\t\t\t\t\t\t<a data-type="preset"\n\t\t\t\t\t\t    data-idx="'+(null==(e=s)?"":e)+'"\n\t\t\t\t\t\t    class="calendar-head__button '+(null==(e=t.pressed?" calendar-head__button_selected":"")?"":e)+'">\n\t\t\t\t\t\t\t'+n(t.caption)+"\n\t\t\t\t\t\t</a>\n\t\t\t\t\t"})),i+="\n\t\t\t\t"):i+='\n\t\t\t\t\t<a class="calendar-head__button" data-type="all_time">всё время</a>\n\t\t\t\t\t<a class="calendar-head__button" data-type="month">месяц</a>\n\t\t\t\t\t<a class="calendar-head__button" data-type="week">неделю</a>\n\t\t\t\t',i+="\n\t\t\t\t</div>\n\t\t\t"),i+='\n\t\t\t<div class="calendar-head__form">\n\t\t\t\t<div class="input input_box input_inline">\n\t\t\t\t\t<input class="input__input" type="text" value="" maxlength="10"\n\t\t\t\t\t       value="'+n(t.dateFrom)+'"\n\t\t\t\t\t       data-type="from" placeholder="ДД/ММ/ГГГГ">\n\t\t\t\t</div>\n\t\t\t\t<span class="calendar-head__separator">&mdash;</span>\n\t\t\t\t<div class="input input_box input_inline">\n\t\t\t\t\t<input class="input__input" type="text" value="" maxlength="10"\n\t\t\t\t\t       value="'+n(t.dateTo)+'"\n\t\t\t\t\t       data-type="to" placeholder="ДД/ММ/ГГГГ">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'):(i+="\n\t\t\t",t.showButtonsPanel&&t.presetButtons.length>0&&(i+='\n\t\t\t\t<div class="calendar-head__buttons">\n\t\t\t\t\t',t.presetButtons.forEach((function(t,s){i+='\n\t\t\t\t\t<a data-type="preset"\n\t\t\t\t\t    data-idx="'+(null==(e=s)?"":e)+'"\n\t\t\t\t\t    class="calendar-head__button'+(null==(e=t.pressed?" calendar-head__button_selected":"")?"":e)+'">\n\t\t\t\t\t\t'+n(t.caption)+"\n\t\t\t\t\t</a>\n\t\t\t\t\t"})),i+="\n\t\t\t\t</div>\n\t\t\t"),i+='\n\t\t\t<div class="calendar-head__form">\n\t\t\t\t<div data-type="left" class="calendar-head__arrow calendar-head__arrow_left">\n\t\t\t\t\t<svg width="10" height="20">\n\t\t\t\t\t\t<path d="M8 2 L2 10 L8 18" fill="transparent" />\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\t<div class="input input_box input_inline">\n\t\t\t\t\t<input class="input__input" type="text" value="" maxlength="10"\n\t\t\t\t\t       value="'+n(t.dateFrom)+'"\n\t\t\t\t\t       data-type="from" placeholder="ДД/ММ/ГГГГ">\n\t\t\t\t</div>\n\t\t\t\t<div data-type="right" class="calendar-head__arrow calendar-head__arrow_right">\n\t\t\t\t\t<svg width="10" height="20">\n\t\t\t\t\t\t<path d="M2 2 L8 10 L2 18" fill="transparent" />\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'),i+='\n\t</div>\n\t<div class="calendar-body">\n\t\t<canvas width="'+(null==(e=t.width)?"":e)+'" height="310"></canvas>\n\t</div>\n</div>\n')),this.$els={head:this.$(".calendar-head"),body:this.$(".calendar-body"),mainCanvas:this.$(".calendar-body canvas"),date1:this.$('input[data-type="from"]'),date2:this.$('input[data-type="to"]'),buttonAll:this.$('a[data-type="all_time"]'),buttonMonth:this.$('a[data-type="month"]'),buttonWeek:this.$('a[data-type="week"]')},this._createCanvas("body",this._width,310,this.$els.mainCanvas),this._setHeadEventListeners(),this._setBodyEventListeners(),this._datesRangeMode&&""===this.$els.date1.val()&&this.$el.find('a[data-type="all_time"]').addClass("calendar__button-selected"),this._interrupt(),this._renderCalendar(),this.listenTo(s.core,"need-calendar-redraw",(()=>{this._needRedraw=!0,this._needMonthRedraw=!0,this._needTimelineRedraw=!0,this._renderCalendar()}))}_setHeadEventListeners(){let t=this.$els.head;t.find("a").on("click",(e=>{let i=d(e.target),s=i.data("type");switch(t.find("a").removeClass("calendar-head__button_selected"),s){case"all_time":case"month":case"week":case"today":this.setRangeByType(s);break;case"preset":this._presetButtons[Number(i.data("idx"))].callback();break;default:return}i.addClass("calendar-head__button_selected")})),this._datesRangeMode||t.find("div[data-type]").on("click",(t=>{let e,i=d(t.target).closest("div[data-type]"),s=this.$els.date1,n=s.val();if(""===n){let t=new Date;e=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0).getTime(),s.val(_._getFormattedDate(e))}if(e=this._filterDateInput(s[0],!0),null!==e){switch(i.attr("data-type")){case"left":s.val(_._getFormattedDate(e-864e5));break;case"right":s.val(_._getFormattedDate(e+864e5));break;default:return}null===this._filterDateInput(s[0],!0)?s.val(n):s.change()}else s.val(n).change()})),t.find("input").on("keydown",(t=>{13===t.which&&d(t.target).blur()})).on("keypress",(t=>{t.which>=46&&t.which<58||8===t.which||0===t.which||t.preventDefault()})).on("blur change",((t,e=!1)=>{this._errMsgBox&&this._errMsgBox.isShown&&this._errMsgBox.hide();let i=this._filterDateInput(t.target);if(null!==i){let s="all_time"!==e;this._selectDate(i,d(t.target).data("type"),s),this._dateChangedCounter++}})).on("paste",(t=>{(0,c.defer)(this._filterDateInput.bind(this),t.target)}))}_filterDateInput(t,e,i=""){let n,r="";if(t&&(void 0===e&&(e=!1),""===(i=t.value.replace(/[^0-9\/]/gi,""))))return t.value="",0;if(/^[0-9]{1,2}\/[0-9]{1,2}\/[0-9]{2,4}$/.test(i)){n=i.match(/^([0-9]{1,2})\/([0-9]{1,2})\/([0-9]{2,4})$/);let e=parseInt(n[1]);if(e==e&&e>0&&e<=31){let i=Number(n[2]);if(i==i&&i>0&&i<=12){let o=Number(n[3]);if(o==o&&o<50&&(o+=2e3),o==o&&o>1970&&o<=3e3){let n=new Date(o,i-1,e,0,0,0,0);if(n.getDate()===e){let e=12*(o-1970)+(i-1);if(e>=this._timelineProps.minTimeLine&&e<=this._timelineProps.maxTimeLine){if(!(e===this._timelineProps.maxTimeLine&&n.getDate()>(new Date).getDate())){let e=n.getTime();return t&&(t.value=_._getFormattedDate(e)),e}r=s.core.i18n("calendar.errors.overflow")}else r=s.core.i18n("calendar.errors.overflow")}else r=s.core.i18n("calendar.errors.invalid-date")}else r=s.core.i18n("calendar.errors.invalid-year")}else r=s.core.i18n("calendar.errors.invalid-month")}else r=s.core.i18n("calendar.errors.invalid-day")}else r=s.core.i18n("calendar.errors.invalid-format");if(""!==r&&!e){if(this._errMsgBox&&this._errMsgBox.isShown)return null;this._errMsgBox=new o._({direction:o.Lh.TOP,alignment:o.SE.START,theme:o.xb.DANGER,delayClose:200,indent:!0,target:d(t)}),this._errMsgBox.content="<span>"+r+"</span>",this._errMsgBox.show()}return null}_selectDate(t,e,i=!0){let s,n,r=_._getFormattedDate(t),o=this._selectedRange;void 0!==e?"from"===e?this._datesRangeMode?(0===t?(o.from=null,o.to=null):o.from=t,o.to||(o.to=t),this.$els.date2.val(_._getFormattedDate(o.to))):(o.from=o.to=t,r?this.$els.date1.val(r):this.$els.date1.val(_._getFormattedDate(new Date))):"to"===e&&(o.to=0===t?o.from:t,t>0&&!o.from&&(o.from=t),this.$els.date1.val(_._getFormattedDate(o.from))):this._datesRangeMode?null===o.from||o.forceNewRange?(o.forceNewRange=!1,o.from=t,o.to=t,this.$els.date1.val(r),this.$els.date2.length>0&&this.$els.date2.val(r)):o.from===o.to?(s=o.from,o.from=Math.min(s,t),o.to=Math.max(s,t),this.$els.date1.val(_._getFormattedDate(o.from)),this.$els.date2.length>0&&this.$els.date2.val(_._getFormattedDate(o.to))):(o.from=t,o.to=t,this.$els.date1.val(r),this.$els.date2.length>0&&this.$els.date2.val(r)):(o.from=o.to=t,this.$els.date1.val(r),h.c.getInstance().sendEvent("filter",{filter_type:"date"})),this._datesRangeMode&&null!==o.from&&o.from>o.to&&(s=o.from,o.from=Math.min(s,t),o.to=Math.max(s,t),this.$els.date1.val(_._getFormattedDate(o.from)),this.$els.date2.length>0&&this.$els.date2.val(_._getFormattedDate(o.to))),void 0===e||0===t||!i&&"to"!==e||(n=new Date,n.setTime(t),this._easingTimeline(12*(n.getFullYear()-1970)+n.getMonth())),this._needRedraw=!0,this._needMonthRedraw=!0,this._datesRangeMode&&this._dateChangedCounter>1&&this.$el.find(".calendar-head__button_selected").removeClass("calendar-head__button_selected"),this.emit("select",this._getSelectionParams())}_selectDateOneMode(t,e){let i,s=this._selectedRange;"from"===e?s.from=t:"to"===e&&(s.to=t,this.$els.date1.val(_._getFormattedDate(s.to))),"to"===e&&(i=new Date,i.setTime(t),this._easingTimeline(12*(i.getFullYear()-1970)+i.getMonth())),this._needRedraw=!0,this._needMonthRedraw=!0,this._datesRangeMode&&this._dateChangedCounter>1&&this.$el.find(".calendar-head__button_selected").removeClass("calendar-head__button_selected"),this.emit("select",this._getSelectionParams())}_setBodyEventListeners(){let t=this.$els.body[0],e=!1,i=!1,s=0,n=0,r=0,o=0,a=0,l=this._timelineProps,u=[];this._addEvent(t,this._useTouchEvent?"touchstart":"mousedown",(u=>{var h,c,d,p;s=this._timeLine,o=n=null!==(h=null!==(c=u.realX)&&void 0!==c?c:u.clientX)&&void 0!==h?h:u.pageX,a=null!==(d=null!==(p=u.realY)&&void 0!==p?p:u.clientY)&&void 0!==d?d:u.pageY,e=!0,r=l.moveDeltaX=l.moveSpeed=0,l.easingTo=0,l.easingFrom=0,l.easingCurrent=0;let m=t.getBoundingClientRect(),_=o-m.left,g=a-m.top;if(i=!1,g>=l.y&&g<l.y+l.viewHeight){let t=l.rollerViewX+l.x;_>=t&&_<=t+l.rollerWidth&&(i=!0,this._skipRollerDrag=!1)}})),this._useTouchEvent||(this._addEvent(t,this._useTouchEvent?"touchmove":"mousemove",(i=>{let s="default";if(!e){var n,r,u,h;o=null!==(n=null!==(r=i.realX)&&void 0!==r?r:i.clientX)&&void 0!==n?n:i.pageX,a=null!==(u=null!==(h=i.realY)&&void 0!==h?h:i.clientY)&&void 0!==u?u:i.pageY;let e=t.getBoundingClientRect(),c=o-e.left,d=a-e.top,p=this._getDateForPointer(c,d);if(p!==this._dayUnderPoiner&&(this._dayUnderPoiner=p,this._needRedraw=!0,p&&(s="pointer")),!p&&d>=l.y&&d<l.y+l.viewHeight){let t=l.rollerViewX+l.x;c>=t&&c<=t+l.rollerWidth&&(s="pointer")}}t.style.cursor!==s&&(t.style.cursor=s)})),this._addEvent(t,"mouseout",(()=>{this._dayUnderPoiner=null,this._needRedraw=!0}))),this._addEvent(t,this._useTouchEvent?"touchend":"click",(e=>{var i,s,n,l,u,h;if(r>4)return;let c=t.getBoundingClientRect(),d=this._getDateForPointer((null!==(i=null!==(s=null!==(n=e.realX)&&void 0!==n?n:e.clientX)&&void 0!==s?s:o)&&void 0!==i?i:e.pageX)-c.left,(null!==(l=null!==(u=null!==(h=e.realY)&&void 0!==h?h:e.clientY)&&void 0!==u?u:a)&&void 0!==l?l:e.pageY)-c.top);d&&this._selectDate(d.date)})),this._addEvent(document,this._useTouchEvent?"touchmove":"mousemove",(t=>{if(e){var h,c,d,p;const m=null!==(h=null!==(c=t.realX)&&void 0!==c?c:t.clientX)&&void 0!==h?h:t.pageX,_=null!==(d=null!==(p=t.realY)&&void 0!==p?p:t.clientY)&&void 0!==d?d:t.pageY;let g=m-n,v=m-o;if(o=m,a=_,i){if(this._skipRollerDrag)return e=!1,void(i=!1);this._updateTimeline(s+g/l.scaleMonthStep,!0)}else l.moveDeltaX=-g/(8*this._dayCellSize),r+=Math.abs(v),this._updateTimeline(s+l.moveDeltaX,!0),u.push({time:Date.now(),dx:v});t.preventDefault(),t.stopPropagation()}}),!0),this._addEvent(document,this._useTouchEvent?"touchend":"mouseup",(t=>{l.moveSpeed=_._getInertialScrollingSpeed(u),u=[],e&&(e=!1,i=!1)}),!0)}_renderCalendar(){let t=this._requestAnimation;if(this._needRedraw){let t=this._displayMonth,e=this._contexts.body,i=this._canvases.body;e.fillStyle=s.core.ui.css.colors.bg,e.rect(0,0,i.width,i.height),e.fill();for(let s=0,n=t.length;s<n;s++)this._drawMonth(t[s].month,e,t[s].x,0);this._drawTimeline(e),this._needRedraw=!1,this._needMonthRedraw=!1}t(this._renderCallback)}_drawTimeline(t){let e=this._timelineProps,i=e.viewWidth,n=e.viewHeight;if(!this._canvases.timeline||this._needTimelineRedraw){let t=this._createCanvas("timeline",e.fullWidth,n),i=e.from,r=e.yearStep,o=10,a=2,l=e.rollerWidth-4,u=e.rollerWidth/2;t.fillStyle=s.core.ui.css.colors.caption,t.font="12px "+s.core.ui.css.fontFamily;for(let s=0;s<e.years;s++)this._drawTextInCell(String(i+s),s*r,0,t,r,20);t=this._createCanvas("timeline_line",e.fullWidth,6),t.fillStyle=s.core.ui.css.colors.border,t.beginPath(),t.moveTo(o+a,a),t.quadraticCurveTo(o,a/2,o+a,0),t.lineTo(e.viewWidth-a-o,0),t.quadraticCurveTo(e.viewWidth-o,a/2,e.viewWidth-a-o,a),t.lineTo(o+a,a),t.closePath(),t.fill(),t=this._createCanvas("timeline_roll",e.rollerWidth,e.rollerWidth+10),t.fillStyle=s.core.ui.css.colors.green,t.beginPath(),t.arc(u,u,l/2,0,2*Math.PI),t.closePath(),t.fill(),this._needTimelineRedraw=!1}t.drawImage(this._canvases.timeline_line,e.x*this._scale,(e.y+15)*this._scale),t.drawImage(this._canvases.timeline,Math.max(0,e.timeLineViewScollX),0,Math.min(i,e.fullWidth)*this._scale,n,e.x*this._scale,(e.y+30)*this._scale,i*this._scale,n),t.drawImage(this._canvases.timeline_roll,(e.x+e.rollerViewX)*this._scale,e.y*this._scale)}_drawMonth(t,e,i,n){let r,o,a,l="month_"+t,u=this._dayCellSize,h=this._calendarProps,c=h.calWidth,d=h.calHeight,p=h.headSize,_=null,g=null,v=null,f=h.oneDayMs;if(!this._monthCache[l]||this._needMonthRedraw){let e,i,n=this._contexts[l]||this._createCanvas(l,c,d),h=1970+~~(t/12),p=t-12*(h-1970),y=new Date(h,p,1,0,0,0,0),b=0,w=1.5*u,E=null,A=null,S=this._timelineProps.minTimeLine,P=this._timelineProps.maxTimeLine,C=this._timelineProps.maxTime,T=this._timelineProps.minTime,k=y.getDay();for(n.clearRect(0,0,c,d),n.font="13px "+s.core.ui.css.fontFamily,i=y.getTime()-(0===k?7:k)*f,m=new Date(i),this._drawWeekDays(n,0,w),w+=u,v=[],r=0;r<6;r++)for(o={startDate:null,endDate:null,startCell:0,endCell:0},v.push(o),e=0;e<7;e++)++b,a=m.setDate(m.getDate()+1),y.setTime(a),y.getMonth()===p&&t>=S&&t<=P&&a<=C&&a>=T&&a<=Date.now()?(n.fillStyle=s.core.ui.css.colors.text,null!==this._selectedRange.from&&a>=this._selectedRange.from&&a<=this._selectedRange.to&&(n.fillStyle=s.core.ui.css.colors.bg),null===E&&(E=b,_=a),A=b,g=a,null===o.startDate&&(o.startDate=a,o.startCell=e),o.endDate=a,o.endCell=e):n.fillStyle=s.core.ui.css.colors.caption,this._drawTextInCell(String(y.getDate()),e*u,w+r*u,n);n.font="16px "+s.core.ui.css.fontFamily,n.fillStyle=s.core.ui.css.colors.green,this._drawTextInCell(s.core.i18n("calendar.months."+p)+" "+String(h),0,0,n,7*u,2*u),this._monthCache[l]={startDate:_,endDate:g,startCell:E-1,endCell:A-1,weeks:v},this._monthCacheKeys.push(l)}else{let t=this._monthCache[l];_=t.startDate,g=t.endDate,v=t.weeks}if(null!==this._selectedRange.from){let t,a,l,h,c=this._selectedRange.from,d=this._selectedRange.to;if(c<=g&&d>=_)for(t=_<c?c:_,a=g>d?d:g,e.fillStyle=s.core.ui.css.colors.green,r=0;r<6;r++)if(o=v[r],null!==o.startDate&&t<=o.endDate&&a>=o.startDate){if(l=~~((t-o.startDate)/f),l<0)l=o.startCell;else{if(l>6)continue;l+=o.startCell}if(h=~~((o.endDate-a)/f),h<=0)h=o.endCell;else{if(h>o.endCell)continue;h=o.endCell-h}this._drawDayHighlight(e,i+~~(l*u),n+~~(p+r*u),h-l+1),e.fill()}}this._dayUnderPoiner&&this._dayUnderPoiner.name===l&&(null!==this._selectedRange.from&&this._dayUnderPoiner.date>=this._selectedRange.from&&this._dayUnderPoiner.date<=this._selectedRange.to?(e.fillStyle=s.core.ui.css.colors.green,e.strokeStyle=s.core.ui.css.colors.green):(e.fillStyle=s.core.ui.css.colors.bg,e.strokeStyle=s.core.ui.css.colors.green),this._drawDayHighlight(e,i+this._dayUnderPoiner.cell_x*u,n+~~(p+this._dayUnderPoiner.cell_y*u),1),e.fill(),e.stroke()),e.drawImage(this._canvases[l],i*this._scale,n*this._scale)}_drawWeekDays(t,e,i){if(!this._canvases.weekdays){let t,e=this._dayCellSize,i=this._createCanvas("weekdays",7*e,e);for(i.scale(1/this._scale,1/this._scale),i.fillStyle=s.core.ui.css.colors.caption,i.font="12px "+s.core.ui.css.fontFamily,t=0;t<7;t++)this._drawTextInCell(s.core.i18n("calendar.weekdays."+t),t*e,0,i,e,e)}t.drawImage(this._canvases.weekdays,e,i)}_drawTextInCell(t,e,i,s,n,r){void 0===n?r=n=this._calendarProps.cellSize2:(n/=2,r/=2);let o=n,a=r,l=this._textWidthCache[t+"_"+s.font];void 0===l&&(this._textWidthCache[t+"_"+s.font]=l=s.measureText(t).width/2),s.fillText(t,~~(e+(o-l)),~~(i+a))}_drawDayHighlight(t,e,i,s){if(e*=this._scale,i*=this._scale,1===s){let s=this._dayCellSize/2*this._scale;t.beginPath(),t.arc(e+s,i+s,s,0,2*Math.PI),t.closePath()}else{let n=this._dayCellSize*this._scale,r=n/2,o=s*n;i++,n-=2,t.beginPath(),t.moveTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.lineTo(e+o-r,i),t.quadraticCurveTo(e+o,i,e+o,i+r),t.lineTo(e+o,i+n-r),t.quadraticCurveTo(e+o,i+n,e+o-r,i+n),t.lineTo(e+r,i+n),t.quadraticCurveTo(e,i+n,e,i+n-r),t.lineTo(e,i+r),t.closePath()}}_createCanvas(t,e,i,n){let r=n?n[0]:document.createElement("canvas");r.width=e*this._scale,r.height=i*this._scale,r.style.height=i+"px",r.style.width=e+"px",this._canvases[t]=r;let o=r.getContext("2d");return o.font="14px "+s.core.ui.css.fontFamily,o.textBaseline="middle",o.lineWidth=2,"body"!==t&&o.scale(this._scale,this._scale),this._contexts[t]=o,o}_addEvent(t,e,i,s){if(!t.addEventListener)return;let n=t=>{this._useTouchEvent?void 0!==t.touches&&(t.touches.length>0&&(t.realX=t.touches[0].clientX,t.realY=t.touches[0].clientY),i(t)):i(t)};t.addEventListener(e,n,{passive:!1,capture:!0===s}),this._ownEventHandlers.push({obj:t,event:e,handler:n,capture:!0===s})}_prepareData(){let t,e,i=this._dayCellSize,s=new Date,n=this._minDateProps.year,r=this._maxDateProps.year,o=this._width;this._canvases={},this._contexts={},this._monthCache={},this._monthCacheKeys=[],this._displayMonth=[],this._ownEventHandlers=[],this._textWidthCache={},this._gcTimer=40,this._selectedRange={from:null,to:null,forceNewRange:!1},e=this._calendarProps={},e.calWidth=7*i,e.calHeight=9*i,e.headSize=2.5*i,e.cellSize2=i/2,e.oneDayMs=864e5,this._initDates&&(s=new Date(this._initDates.from),this._selectedRange.from=this._initDates.from,this._selectedRange.to=this._initDates.to,this._selectedRange.forceNewRange=!0),this._timeLine=12*(s.getFullYear()-1970)+s.getMonth(),e=this._timelineProps={},e.from=n,e.to=r,e.years=r-n+1,e.yearStep=~~(2.3*i),e.fullWidth=e.yearStep*e.years,e.viewHeight=55,e.viewHeight2=e.viewHeight/2,e.viewWidth=Math.min(e.fullWidth,~~(.8*o/e.yearStep)*e.yearStep),e.x=~~((o-e.viewWidth)/2),e.y=this._calendarProps.calHeight-5,e.minTimeLine=12*(n-1970)+this._minDateProps.month,e.maxTimeLine=12*(r-1970)+(new Date).getMonth(),e.minTime=new Date(n,this._minDateProps.month,this._minDateProps.day,0,0,0,0),e.maxTime=new Date,e.viewTimeLineFrom=0,e.viewTimeLineTo=Number.MAX_VALUE,e.timeLineScrollYears=0,e.timeLineScrollYearsCurr=0,e.timeLineScrollYearsForm=0,e.timeLineScrollYearsCounter=0,e.timeLineViewScollX=0,e.timeLineViewYears=~~(e.viewWidth/e.yearStep),e.rollerWidth=30,e.rollerViewX=0,e.scaleWidth=e.fullWidth-e.rollerWidth,e.scaleMonthStep=e.scaleWidth/(this._maxDateProps.momentDate.diff(this._minDateProps.momentDate,"months")||12*e.years-1),e.easingTo=0,e.easingCurrent=0,e.easingFrom=0,e.moveSpeed=0,e.moveDeltaX=0,this._updateTimeline(this._timeLine,!0,!0),t=this._timeLine,this._timeLine=this._timeLine+("right"===this._initialDirection?-2:2),this._easingTimeline(t)}_easingTimeline(t){let e=this._timelineProps;t!==this._timeLine&&(e.easingTo=t,e.easingFrom=this._timeLine,e.easingCurrent=0,e.moveSpeed=0)}_getSelectionParams(){let t,e,i=this._selectedRange,n=this._calendarProps,r=!1;if(i||(i=this._initDates),e={caption:"",startDate:"",start:null,endDate:"",end:null},n&&null!==i.from){t=new Date;let e=1970+~~(this._timelineProps.minTimeLine/12),s=this._timelineProps.minTimeLine-12*(e-1970),n=new Date(e,s,1,0,0,0,0).getTime(),o=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0).getTime();r=i.from===n&&i.to===o}return!i||null===i.from||r?(e.caption=s.core.i18n("calendar.captions.all-time"),e.startDate="",e.endDate=""):i.from===i.to?0===i.from&&0===i.to?e.start=e.end=new Date:(t=new Date,t.setTime(i.from),e.caption=this._prependZeroForDay(t)+" "+s.core.i18n("calendar.months2."+t.getMonth())+" "+t.getFullYear(),e.start=e.end=t,e.startDate=e.endDate=_._getFormattedDate(i.from,!0)):(t=new Date,t.setTime(i.from),e.caption=this._prependZeroForDay(t)+" "+s.core.i18n("calendar.months2."+t.getMonth())+" "+t.getFullYear(),e.startDate=_._getFormattedDate(i.from,!0),e.start=new Date(t.getTime()),t.setTime(i.to),e.caption+=" - "+this._prependZeroForDay(t)+" "+s.core.i18n("calendar.months2."+t.getMonth())+" "+t.getFullYear(),e.endDate=_._getFormattedDate(i.to,!0),e.end=t),e}_prependZeroForDay(t){return String(t.getDate()).padStart(2,"0")}_updateTimeline(t,e,i){let s=this._timelineProps;if(void 0!==t?(t=e?Math.max(Math.min(t,s.viewTimeLineTo),s.viewTimeLineFrom):Math.max(Math.min(t,s.maxTimeLine),s.minTimeLine),this._timeLine=t):t=this._timeLine,i){let e=!0;for(;e;)e=!1,s.viewTimeLineFrom=Math.max(s.minTimeLine+12*s.timeLineScrollYearsCurr,s.minTimeLine),s.viewTimeLineTo=Math.min(s.viewTimeLineFrom+12*s.timeLineViewYears,s.maxTimeLine),t<s.viewTimeLineFrom+2&&s.timeLineScrollYears>=1?(s.timeLineScrollYears=Math.max(s.timeLineScrollYears-2,0),e=!0):t>s.viewTimeLineTo-2&&s.timeLineScrollYears<=s.years-s.timeLineViewYears-1&&(s.timeLineScrollYears=Math.min(s.timeLineScrollYears+2,s.years-s.timeLineViewYears),e=!0),s.timeLineScrollYearsCurr=s.timeLineScrollYears}else 0===s.timeLineScrollYearsCounter&&(t<s.viewTimeLineFrom+2&&s.timeLineScrollYears>=1?(s.timeLineScrollYears=Math.max(s.timeLineScrollYears-2,0),s.timeLineScrollYearsForm=s.timeLineScrollYearsCurr,s.timeLineScrollYearsCounter=20,this._skipRollerDrag=!0):t>s.viewTimeLineTo-2&&s.timeLineScrollYears<=s.years-s.timeLineViewYears-1&&(s.timeLineScrollYears=Math.min(s.timeLineScrollYears+2,s.years-s.timeLineViewYears),s.timeLineScrollYearsForm=s.timeLineScrollYearsCurr,s.timeLineScrollYearsCounter=20,this._skipRollerDrag=!0));s.timeLineViewScollX=~~(s.timeLineScrollYearsCurr*s.yearStep)*this._scale,s.viewTimeLineFrom=Math.max(s.minTimeLine+12*s.timeLineScrollYearsCurr,s.minTimeLine),s.viewTimeLineTo=Math.min(s.viewTimeLineFrom+12*s.timeLineViewYears,s.maxTimeLine),s.rollerViewX=~~((t-s.minTimeLine)*s.scaleMonthStep)-s.timeLineViewScollX/this._scale}_interrupt(){let t=this._timelineProps;if(cancelAnimationFrame(this._interruptTimer),0!==t.moveDeltaX){let e=t.moveDeltaX;e>0?(e-=.3,e<0&&(e=0)):e<0&&(e+=.3,e>0&&(e=0)),t.moveDeltaX=e}if(t.easingTo>0&&t.easingTo!==this._timeLine)this._timeLine=_._easing("cubic",++t.easingCurrent,t.easingFrom,t.easingTo,20);else if(0!==t.moveSpeed){let e=t.moveSpeed;e>0?(e-=.1*e,e<.05&&(e=0)):e<0&&(e+=.1*-e,e>-.05&&(e=0)),this._timeLine+=e,t.moveSpeed=e}if(this._lastTimeLine!==this._timeLine){this._updateTimeline(this._timeLine);let t,e=this._dayCellSize,i=this._timeLine,s=~~i,n=e/2,r=8*e,o=r/2,a=this._width/2,l=4+~~(this._width/r),u=-(i-s)*r,h=new Array(l),c=s-~~(l/2);for(t=0;t<l;t++)h[t]={name:"month_"+(c+t),month:c+t,x:a-l*o+t*r+n+u};this._displayMonth=h,this._needRedraw=!0,this._lastTimeLine=this._timeLine}t.timeLineScrollYears!==t.timeLineScrollYearsCurr&&(t.timeLineScrollYearsCounter>0?t.timeLineScrollYearsCurr=_._easing("cubic",20- --t.timeLineScrollYearsCounter,t.timeLineScrollYearsForm,t.timeLineScrollYears,20):t.timeLineScrollYearsCurr=t.timeLineScrollYears,this._updateTimeline(),this._needRedraw=!0),0==--this._gcTimer&&(this._removeUnusedMonths(),this._gcTimer=40),this._interruptTimer=requestAnimationFrame(this._interruptCallback)}_removeUnusedMonths(){let t,e,i=this._monthCacheKeys,s=this._displayMonth;if(!(this._monthCacheKeys.length<=this._displayMonth.length))for(let n=0,r=i.length;n<r;n++){t=!1,e=i[n];for(let i=0,n=s.length;i<n;i++)if(e===s[i].name){t=!0;break}t||(delete this._monthCache[e],delete this._canvases[e],delete this._contexts[e],i.splice(n,1),n--,r--)}}_getDateForPointer(t,e){let i,s,n,r,o,a,l=this._displayMonth,u=this._dayCellSize,h=this._monthCache,c=this._calendarProps,d=c.calWidth,p=c.calHeight,m=c.headSize,_=c.oneDayMs;for(let g=0,v=l.length;g<v;g++)if(i="month_"+l[g].month,s=l[g].x,t>=s&&t<=s+d&&e<=0+p&&e>=0+m&&h[i]&&(n=~~((t-s)/u),r=~~((e-0-m)/u),o=7*r+n,a=h[i],o>=a.startCell&&o<=a.endCell))return{name:i,cell_x:n,cell_y:r,cell_no:o,date:a.startDate+_*(o-a.startCell)};return null}static _easing(t,e,i,s,n){let r=.5*Math.PI,o=2*Math.PI,a=i>s,l=i;switch(a?(l=s,s=i-s,i=l):s-=i,t){default:case"linear":l=s*e/n+i;break;case"cubic":l=a?s*(e/=n)*e*e+i:s*((e=e/n-1)*e*e+1)+i;break;case"exponential":l=0===e?i:s*Math.pow(2,10*(e/n-1))+i-.001*s,e===n&&(l=s+i);break;case"sine":l=a?-s*Math.cos(e/n*r)+s+i:s*Math.sin(e/n*r)+i;break;case"bounce":l=(e/=n)<1/2.75?s*(7.5625*e*e)+i:e<2/2.75?s*(7.5625*(e-=1.5/2.75)*e+.75)+i:e<2.5/2.75?s*(7.5625*(e-=2.25/2.75)*e+.9375)+i:s*(7.5625*(e-=2.625/2.75)*e+.984375)+i;break;case"elastic":if(0===e)l=i;else if(1==(e/=n))l=i+s;else{let t=.3*n,r=t/4;l=s*Math.pow(2,-10*e)*Math.sin((e*n-r)*o/t)+s+i}}return a&&(l=i+(s+i-l)),l}_parseDate(t){let e,i,s=new Date,n=new Date(this._maxDateProps.year,this._maxDateProps.month,this._maxDateProps.day,0,0,0,0).getTime(),r=new Date(this._minDateProps.year,this._minDateProps.month-1,1,0,0,0,0).getTime();if(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(t)){i=t.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/);let o=Math.min(s.getFullYear(),Math.max(parseInt(i[1]),this._minDateProps.year)),a=Math.min(12,Math.max(1,parseInt(i[2]))),l=Math.max(1,Math.min(31,parseInt(i[3])));if(e=new Date(o,a-1,l,0,0,0,0),e)return Math.min(n,Math.max(r,e.getTime()))}return null}static _getFormattedDate(t,e){let i,s,n,r=new Date;if(0===t||null===t)return"";for(r.setTime(t),i=String(r.getDate());i.length<2;)i="0"+i;for(s=String(r.getMonth()+1);s.length<2;)s="0"+s;for(n=String(r.getFullYear());n.length<4;)n="0"+n;return!0!==e?i+"/"+s+"/"+n:n+"-"+s+"-"+i}static _generateRandomDay(t){var e;let i,s=Date.now(),n=Math.max(new Date(2011,0,15).getTime(),null!==(e=null==t?void 0:t.getTime())&&void 0!==e?e:0),r=s-n-864e5,o=0,u=new Date,h=a.LocalStorage.get(l)||{};for(;++o<1e3&&(u.setTime(n+Math.round(Math.random()*r)),i=_._formatDate(u,"dd-mm-yyyy"),h[i]););return h[i]=!0,a.LocalStorage.set(l,h),u}static _getInertialScrollingSpeed(t){const e=Date.now()-70,i=t.findIndex((({time:t})=>t>=e)),s=(t=-1===i?[]:t.slice(i)).reduce(((t,{dx:e})=>t+e),0);if(Math.abs(s)>50){return-1*s/500}return 0}}var g=i(30381),v=i.n(g);function f(t,e,i){if(!t||!e)return;const s=Date.now(),n=new Date(s),r=new Date(s-6048e5),o=v()().subtract(1,"months").toDate(),a=v()(t);return v()(e).isSame(n,"day")?a.isSame(n,"day")?"today":a.isSame(r,"day")?"week":a.isSame(o,"day")?"month":a.isSame(i,"day")?"all_time":void 0:void 0}},28650:(t,e,i)=>{i.d(e,{X:()=>l});i(88674);var s=i(43241),n=i(12953),r=i(96637);var o=i(87864),a=i(12950);class l extends s.u{static getTemplate(){return'<div class="resend-sms">\n    <a href="#" class="resend-sms__btn">Отправить код еще раз</a>\n    <div class="resend-sms__countdown"></div>\n</div>\n'}render(){return this.isRendered||(this.el||(this.el=(0,o.m)(l.getTemplate())),this.countdown=this.el.querySelector(".resend-sms__countdown"),this.resendBtn=this.el.querySelector(".resend-sms__btn"),this.resendBtn.addEventListener("click",(t=>{t.preventDefault(),this.resendSms()})),this.startResendCountdown()),this}startResendCountdown(){var t;null===(t=this.el)||void 0===t||t.classList.add("resend-sms_wait");let e=60;const i=()=>`через ${e} ${r.Utils.pluralNounRU(e,["секунду","секунды","секунд"])}`,s=`<span class="resend-sms__time">\n\t\t\t<span class="resend-sms__time-text">${i()}</span>\n\t\t\t<span class="resend-sms__max-width-time-text"><span class="resend-sms__max-width-time">через 00 сенунды</span></span>\n\t\t</span>`;this.countdown.innerHTML=`Отправить повторный код&nbsp;${s}`;const n=this.countdown.querySelector(".resend-sms__time-text");this.interval("resend-countdown",1e3,(()=>{e--,n.innerHTML=i(),e<=0&&(this.cancelInterval("resend-countdown"),this.setReady())}))}setReady(){var t;null===(t=this.el)||void 0===t||t.classList.remove("resend-sms_wait")}async resendSms(){const{response:t}=await a.cf.post("/ajax.php",{route:"sms/resend",session_id:this.sessionId});t.result?this.startResendCountdown():n.core.ui.toasts.showError(t.message||"Извините, произошла ошибка")}get sessionId(){return this._options.sessionId}set sessionId(t){this._options.sessionId=t}}},42670:(t,e,i)=>{i.d(e,{H:()=>O});i(88674),i(41817);var s=i(12953),n=i(12950);class r{static async getAllowedCommunities(){let{data:t}=await n.cf.postOrFail("/ajax/story-actions/get-allowed-communities");return t}static async toggleStoryInProfile(t,e){let{response:i}=await n.cf.post("/ajax/stories_actions.php",{action:e?"hide_story":"unhide_story",story_id:t});if(!i.result)throw s.core.ui.toasts.showError(i.message),new Error(i.message);s.core.ui.toasts.add("settings-hide-story",{content:e?s.core.i18n("page-settings.toggle-story.hide"):s.core.i18n("page-settings.toggle-story.unhide")})}static async getCountStoriesHide(){let{response:t,data:e}=await n.cf.post("/ajax/stories_actions.php",{action:"get_hiding_limit"});if(!t.result)throw s.core.ui.toasts.showError(t.message),new Error(t.message);return e.count}static async moveToFeed(t){let{response:e}=await n.cf.post("/ajax/story-actions/transfer-story",{to:"common-feed",story_id:t});if(!e.result)throw s.core.ui.toasts.showError(e.message),new Error(e.message)}static async moveToCommunity(t,e){let{response:i}=await n.cf.post("/ajax/story-actions/transfer-story",{to:"community",story_id:t,id:e});if(!i.result)throw s.core.ui.toasts.showError(i.message),new Error(i.message)}static async updatePinnedStory(t,e){let{response:i}=await n.cf.post("/ajax.php",{route:e?"story/pin":"story/unpin",story_id:t});if(!i.result)throw s.core.ui.toasts.showError(i.message),new Error(i.message)}}var o=i(47442),a=i(36005);var l=i(9003),u=i(90312),h=i(31474),c=i(88358),d=i(29883),p=i(63907),m=i(36005);function _(t){var e="",i=m.escape;Array.prototype.join;return e+='<div class="context-menu-story-series">\n\t',t.avatar?e+='\n\t\t<img class="context-menu-community__avatar" src="'+i(t.avatar)+'" loading="lazy" alt="'+i(t.name)+'">\n\t':e+='\n\t\t<span class="story-series-thumb story-series-thumb_20 context-menu-community__avatar"></span>\n\t',e+='\n\t<span class="context-menu-community__group-name context-menu-story-series__name">'+i(t.name)+"</span>\n</div>"}function g(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class v{constructor(){g(this,"isLoading",!1),g(this,"series",[])}static getInstance(){return v.instance||(v.instance=new v)}async getItems(t){if(this.isLoading)return s.core.ui.toasts.add({content:s.core.i18n("page-settings.main.move.wait-series"),closeAfter:1500}),[];if(this.series.length)return this.getSubmenuItems(t);this.isLoading=!0;try{return this.series=await d.nm.getStorySeries(),this.getSubmenuItems(t)}catch(e){e instanceof Error&&s.core.ui.toasts.showError(e.message)}finally{this.isLoading=!1}return[]}getSubmenuItems(t){return this.series.filter((e=>e.id!==t&&e.storiesCount<s.core.initParams.limitStoriesInSeries)).map((t=>({id:t.id,meta:{series:t},template:_({name:t.title,avatar:t.previewCoverImageUrl})})))}}i(81780),i(91904);var f=i(33324);var y=i(58330),b=i(32677);function w(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function E(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?w(Object(i),!0).forEach((function(e){A(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):w(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function A(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class S extends c.LD{constructor(t){t.wrapperExtraClass="popup_duplicate-report";super(E(E({},t),{},{content:'<div class="duplicate-report-form">\n    <form>\n        <div class="duplicate-report-form__header">\n            Я видел это раньше\n            <div class="duplicate-report-form__close-button">\n                <div class="duplicate-report-form__close-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close"><use xlink:href="#icon--ui__close"></use></svg></div>\n            </div>\n        </div>\n        \n        <p class="duplicate-report-form__message">Добавьте ссылку на Пикабу (предпочтительно) или на внешний ресурс</p>\n        <div class="duplicate-report-form__url">\n            <input class="input__input" placeholder="Ссылка" autocomplete="off" maxlength="255" />\n        </div>\n\n        <div class="form_footer duplicate-report-form__footer">\n            <button type="submit" class="button button_success duplicate-report-form__submit">Подтвердить</button>\n        </div>\n\n        <div class="duplicate-report-form__result">Спасибо за обратную связь! 👍</div>\n    </form>\n</div>\n',isModalMenu:!1}));const e=this.$els.content.get(0).firstElementChild;this.els={container:e,form:e.querySelector("form"),input:e.querySelector(".input__input"),submitButton:e.querySelector(".duplicate-report-form__submit"),closeButton:e.querySelector(".duplicate-report-form__close-icon")},this.init()}init(){const t=y.S.getInstance().get("UIInput"),e=y.S.getInstance().get("UIButton");new t({el:this.els.input,addClearButton:!1}),this.submitButton=new e(this.els.submitButton),this.els.form.addEventListener("submit",(t=>{t.preventDefault(),this.onSubmit()})),this.els.closeButton.addEventListener("click",(()=>{this.hide()}))}async onSubmit(){this.submitButton.disabled=!0,this.submitButton.progress=!0;try{await this.sendRequest()}catch(t){}this.els.container.classList.add("duplicate-report-form_success")}async sendRequest(){const t=this.els.input.value,e=E({link:t},this._options.analyticsData);u.c.getInstance().sendEvent("seen_before_button_tapped",e),await n.cf.post("/ajax.php",{route:"duplicates/report",story_id:this._options.storyId,screen_id:b.L[s.default.ui.screen],source_url:t}),u.c.getInstance().sendEvent("seen_before_approved",e)}}const P={edit:"Редактировать",to_feed:"Перенести пост в общую ленту",to_community:"Перенести пост",report:"Пожаловаться",profile_hide:"Убрать пост из профиля",profile_unhide:"Вернуть пост в профиль",duplicate_report:"Я видел это раньше",move_to_series:"Перенести в серию",remove_from_series:"Удалить из серии",save:"Сохранить",unsave:"Удалить из сохраненного",unsave_cat:"Удалить из списка",save_cat:"Добавить в список",pin:"Закрепить пост",unpin:"Открепить пост",sub_to_comstories:"Подписаться на цепочку постов-ответов",unsub_from_comstories:"Отписаться от цепочки постов-ответов",ignore_comstories:"Игнорировать цепочку постов-ответов"};var C=i(65035),T=i(36830),k=i(53201);function D(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function I(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?D(Object(i),!0).forEach((function(e){$(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):D(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function $(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class O extends p.u1{constructor(t){super(t),this._items=this._options.items,this.onMovedToCommunity=this._options.onMovedToCommunity,this.show()}render(){if(this.isRendered)return this;this._initDotsMenu()}async _initDotsMenu(){if(this._dotsMenu||!this._options.el)return;const t=this._items.map((t=>({id:t,title:P[t]})));this._dotsMenu=new l.K({el:this._options.el,items:t}),this.listenTo(this._dotsMenu,"onItemClick",this._clickOnContextMenuItem.bind(this)),this.listenTo(this._dotsMenu,"onShow",(()=>{u.c.getInstance().sendEvent("click",I({button:"meatballs"},this.analyticsData))})),this._options.storyBlock.find(".story__title-link").on("click",(t=>{t.target.classList.contains("story__hide-icon")&&t.preventDefault()})),"saved-stories"===s.core.initParams.pageName&&this.listenTo(this._dotsMenu,"onShow",(()=>this._updateUnsaveCatItemText()))}async _loadMoveToCommunities(){if(!this.allowedCommunitiesIsLoading){this.allowedCommunitiesIsLoading=!0;try{this.allowedCommunities=await r.getAllowedCommunities()}finally{this.allowedCommunitiesIsLoading=!1}return this.allowedCommunities.map((t=>{return{id:t.id,meta:{communityId:t.id},template:(e={communityId:t.id,name:t.name,avatar:t.avatar},i="",s=a.escape,i+='<img class="context-menu-community__avatar" src="'+s(e.avatar)+'" alt="'+s(e.name)+'">\n<span class="context-menu-community__group-name">'+s(e.name)+"</span>")};var e,i,s}))}this._showToast("wait",1500)}async _createAttentionPopup(t){const e=t?await r.getCountStoriesHide():0,i=new c.LD({content:`<div class="story__hide-modal">\n\t\t\t\t\t\t${s.core.i18n("context-menu.confirm-popup."+(t?"hide":"unhide"),e)}\n\t\t\t\t\t </div>`});i.addButtonIntoFooter(s.core.i18n("context-menu.confirm-popup."+(t?"hide-ok":"unhide-ok")),(async()=>{if(s.core.initParams.isDeleted)return s.core.ui.authRequired(),void this._dotsMenu.closeAllMenus();await this._togglePostInProfile(this.story.id,t),i.hide(),"profile"===s.core.initParams.pageName&&t&&this._options.storyBlock.hide(500),"story"===s.core.initParams.pageName&&this._options.storyBlock.find(".story__hide-icon").toggleClass("story__hide-icon_hide",!t),1===e&&(s.core.initParams.isHidePostsFromProfile=!0)}),t?h.j.DANGER:h.j.SUCCESS),i.addCloseButtonIntoFooter(s.core.i18n("context-menu.confirm-popup.hide-cancel")),i.show(),this._dotsMenu.closeAllMenus()}async _clickOnContextMenuItem(t,e){var i,n;if(null!=t&&null!==(i=t.meta)&&void 0!==i&&i.communityId)return this._communityId=t.meta.communityId,void this._moveToCommunity();if(null!=t&&null!==(n=t.meta)&&void 0!==n&&n.series)this._moveToSeries(t.meta.series);else switch(t.id){case"edit":s.core.location.href=s.core.location.origin+"/edit/"+this.story.id;break;case"profile_hide":if(s.core.initParams.isDeleted)return s.core.ui.authRequired(),void this._dotsMenu.closeAllMenus();await this._createAttentionPopup(!0);break;case"profile_unhide":if(s.core.initParams.isDeleted)return s.core.ui.authRequired(),void this._dotsMenu.closeAllMenus();await this._createAttentionPopup(!1);break;case"to_feed":this._moveToFeed();break;case"to_community":this._showSubmenu(t,(()=>this._loadMoveToCommunities()),"Сообщества не найдены");break;case"move_to_series":this._showSubmenu(t,(()=>v.getInstance().getItems(this._options.seriesId)),"Серии постов не найдены");break;case"remove_from_series":this._removeFromSeries();break;case"report":if(!s.core.isUserAuthorized)return s.core.ui.authRequired(),void this._dotsMenu.closeAllMenus();this._dotsMenu.closeAllMenus(),this._createAndShowComplainModalPopup();break;case"save":0;break;case"unsave_cat":case"save_cat":const i=s.core.storage["saved-stories-current-category"],n=this._isStorySavedToCurrentCat;this.story.isSaved=!n,this.story.savedCat=n?null:i,C.YD.addOrRemoveStory(!n,this.story.id,i,"",this.story.analyticsData),this._dotsMenu.closeAllMenus();break;case"duplicate_report":this._dotsMenu.closeAllMenus(),this.showDuplicateReportModal();break;case"pin":this._updatePinnedStory(this.story.id,!0);break;case"unpin":this._updatePinnedStory(this.story.id,!1);break;case"sub_to_comstories":case"unsub_from_comstories":const r="sub_to_comstories"===t.id;(0,k.t)(this.story.id,r),this._dotsMenu.closeAllMenus();const o=this._dotsMenu.items,a=o.find((e=>e.id===t.id));a.id=r?"unsub_from_comstories":"sub_to_comstories",a.title=P[r?"unsub_from_comstories":"sub_to_comstories"],this._dotsMenu.updateItems(o);break;case"ignore_comstories":this._dotsMenu.closeAllMenus(),e.remove(),s.core.ui.toasts.add("ignore-comstory",{content:s.core.i18n("ignore.messages.comstory")}),await(0,k.x)(this.story.id,!0),this._dotsMenu.items.find((t=>"unsub_from_comstories"===t.id))&&await(0,k.t)(this.story.id,!1)}}async _showSubmenu(t,e,i){if(t.submenu)return;const s=await e();null!=s&&s.length?(this._dotsMenu.addSubmenu(t,s),t.submenu.instance.show()):this._showToast(i,1500)}_updateUnsaveCatItemText(){const t=this._dotsMenu.menu.el.querySelector('[data-id="unsave_cat"]');t&&(t.innerText=P[this._isStorySavedToCurrentCat?"unsave_cat":"save_cat"])}_createAndShowComplainModalPopup(){this._complainModalPopup=new f.n({destroyAfterHide:!0,targetId:this.story.id,authorId:this.story.authorId,targetType:"post",name:"UIComplainModalPopup"}),this._complainModalPopup.show()}showDuplicateReportModal(){if(s.core.initParams.isDeleted)return s.core.ui.authRequired(),void this._dotsMenu.closeAllMenus();u.c.getInstance().sendEvent("seen_before_menu_item_tapped",this.analyticsData);new S({destroyAfterHide:!0,storyId:this.story.id,analyticsData:this.analyticsData}).show()}async _togglePostInProfile(t,e){await r.toggleStoryInProfile(t,e);const i=e?"post_profile_hide":"post_profile_unhide";u.c.getInstance().sendEvent(i,{type:i})}async _moveToFeed(){if(s.core.initParams.isDeleted)return s.core.ui.authRequired(),void this._dotsMenu.closeAllMenus();const t=this._showToast("move-to-feed");try{await r.moveToFeed(this.story.id)}finally{null==t||t.destroy()}(0,T.g)("Пост успешно перенесен в ленту"),window.location.reload()}_showToast(t,e,i=o.K.WARNING){return s.core.ui.toasts.add({content:s.core.i18n("page-settings.main.move."+t),closeAfter:e,theme:i})}async _moveToSeries(t){this._dotsMenu.closeAllMenus();try{if(!(await d.nm.addStory({seriesId:t.id,storyId:this.story.id})))return;u.c.getInstance().sendEvent("post_series_add_post",{type:"post_header",post_series_id:t.id,post_id:this.story.id,size:t.storiesCount+1}),window.location.reload()}catch(e){e instanceof Error&&s.core.ui.toasts.showError(e.message)}}async _removeFromSeries(){this._dotsMenu.closeAllMenus();try{if(!(await d.nm.removeStory({seriesId:this._options.seriesId,storyId:this.story.id})))return;u.c.getInstance().sendEvent("post_series_delete_post",{type:"post_header",post_series_id:this._options.seriesId,post_id:this.story.id,size:this._options.seriesStoriesCount-1}),window.location.reload()}catch(t){t instanceof Error&&s.core.ui.toasts.showError(t.message)}}async _moveToCommunity(){this.communityIsMoving=!0,this._dotsMenu.closeAllMenus();const t=this._showToast("move-to-community");try{await r.moveToCommunity(this.story.id,this._communityId);const t=Number(this._communityId),e=this.allowedCommunities.find((({id:e})=>e===t));this._showToast("move-to-community-success",4e3,o.K.DEFAULT);const i=this._items.filter((t=>"to_community"!==t));i.length?this._dotsMenu.updateItems(i):this.destroy(),this.onMovedToCommunity&&this.onMovedToCommunity(e)}finally{this.communityIsMoving=!1,null==t||t.destroy()}}toggle(){this.communityIsMoving||this._popup.toggle()}get analyticsData(){return I({component_name:this.story.isStoryPage?"post":"feed"},this.story.analyticsData)}get story(){return this._options.story}get _isStorySavedToCurrentCat(){const t=s.core.storage["saved-stories-current-category"];return this.story.isSaved&&(this.story.savedCat===t||void 0===this.story.savedCat)}async _updatePinnedStory(t,e){if(s.core.initParams.isDeleted)return s.core.ui.authRequired(),void this._dotsMenu.closeAllMenus();this._dotsMenu.closeAllMenus(),await r.updatePinnedStory(t,e),u.c.getInstance().sendEvent(e?"pin_post_button_tapped":"unpin_post_button_tapped",{type:"pin_post"}),window.location.reload()}}},25432:(t,e,i)=>{i(66992),i(33948),i(88674);var s=i(43241),n=i(58330);const r="https://skidki.pikabu.ru",o=r+"/api/deals-for-banner",a=r+"/api/deals-for-nsfw-banner",l=[{url:"https://promokod.pikabu.ru/shops/megamarket?utm_source=pikabu&utm_medium=post-banner",image:"https://cs13.pikabu.ru/post_img/2023/11/24/8/170083253315216404.png",title:"Лучшие промокоды в Мегамаркет"},{url:"https://promokod.pikabu.ru/shops/aliexpress?utm_source=pikabu&utm_medium=post-banner",image:"https://cs13.pikabu.ru/post_img/2023/06/19/7/168717481017555168.png",title:"Лучшие промокоды на Алиэкспресс"},{url:"https://promokod.pikabu.ru/shops/hoff?utm_source=pikabu&utm_medium=post-banner",image:"https://cs13.pikabu.ru/post_img/2023/06/30/7/1688125081169949593.png",title:"Лучшие промокоды в Hoff"},{url:"https://promokod.pikabu.ru/shops/lenta?utm_source=pikabu&utm_medium=post-banner",image:"https://cs14.pikabu.ru/post_img/2023/06/19/8/1687176378134716806.png",title:"Лучшие промокоды в Ленте Онлайн"},{url:"https://promokod.pikabu.ru/shops/mvideo?utm_source=pikabu&utm_medium=post-banner",image:"https://cs14.pikabu.ru/post_img/2023/06/19/8/1687176283165388617.png",title:"Лучшие промокоды в М.Видео"},{url:"https://promokod.pikabu.ru/shops/mts?utm_source=pikabu&utm_medium=post-banner",image:"https://cs13.pikabu.ru/post_img/2023/06/19/8/1687176294180185151.png",title:"Лучшие промокоды в МТС"},{url:"https://promokod.pikabu.ru/shops/sbermarket?utm_source=pikabu&utm_medium=post-banner",image:"https://cs13.pikabu.ru/post_img/2023/06/19/8/1687176247110779978.png",title:"Лучшие промокоды в Сбермаркете"}];var u=i(42404),h=i.n(u);class c extends s.u{constructor(t,e={}){var i;super({el:t}),this.isNSFW=null!==(i=e.isNSFW)&&void 0!==i&&i,this.show()}render(){return this.isRendered||!this.el||this.loadCarousel(),this}async loadCarousel(){var t;if(!this.el)return;let e=await this.getDeals();if(this.isNSFW||(e=this.addStaticBlocks(e)),null===(t=e)||void 0===t||!t.length)return;var i,s,r;this.el.innerHTML=(i={deals:e,isNSFW:this.isNSFW,showArrows:!0},r="",Array.prototype.join,r+='<section class="carousel deals-carousel '+(null==(s=i.isNSFW?"deals-carousel_nsfw":"")?"":s)+'">\n\t<h2 class="carousel__title">\n\t\t',i.isNSFW?r+="\n\t\t\tДля тебя и твоей половинки\n\t\t":r+='\n\t\t\tЛучшие\n\t\t\t<a target="_blank" href="https://skidki.pikabu.ru/?utm_source=pikabu&utm_medium=post-banner&utm_content=header">Скидки</a>\n\t\t\tи\n\t\t\t<a target="_blank" href="https://promokod.pikabu.ru/?utm_source=pikabu&utm_medium=post-banner&utm_content=header">Промокоды</a>\n\t\t\tот Пикабу\n\t\t',r+='\n\t</h2>\n\t<div class="carousel__main">\n\t\t',i.showArrows&&(r+='\n\t\t\t<button\n\t\t\t\ttype="button"\n\t\t\t\tclass="carousel__scroll button carousel__scroll_left carousel__scroll_hidden"\n\t\t\t>\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__arrow-left"><use xlink:href="#icon--ui__arrow-left"></use></svg>\n\t\t\t</button>\n\t\t'),r+='\n\t\t<div class="carousel__content">\n\t\t\t<div class="carousel__helper">\n\t\t\t\t',i.deals.forEach((t=>{r+='\n\t\t\t\t\t<article class="carousel__item">\n\t\t\t\t\t\t<a href="'+(null==(s=t.url)?"":s)+'" target="_blank" class="deals-carousel__link">\n\t\t\t\t\t\t\t',t.isAdultContent&&!i.isNSFW&&(r+='\n\t\t\t\t\t\t\t\t<div class="deals-carousel__adult-overlay">\n\t\t\t\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__lock-nsfw"><use xlink:href="#icon--ui__lock-nsfw"></use></svg>\n\t\t\t\t\t\t\t\t\t<div>18+</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t'),r+='\n\n\t\t\t\t\t\t\t<img class="deals-carousel__logo" src="'+(null==(s=t.image)?"":s)+'" alt="'+(null==(s=t.title)?"":s)+'" />\n\t\t\t\t\t\t</a>\n\n\t\t\t\t\t\t<a class="deals-carousel__title" href="'+(null==(s=t.url)?"":s)+'" target="_blank">'+(null==(s=t.title)?"":s)+'</a>\n\n\t\t\t\t\t\t<div class="deals-carousel__price-container">\n\t\t\t\t\t\t\t',t.storeLogo?r+='\n\t\t\t\t\t\t\t\t<div class="deals-carousel__store-logo">\n\t\t\t\t\t\t\t\t\t<img src="'+(null==(s=t.storeLogo)?"":s)+'" alt="'+(null==(s=t.storeName)?"":s)+'" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t':t.storeName&&(r+='\n\t\t\t\t\t\t\t\t<div class="deals-carousel__store-name">\n\t\t\t\t\t\t\t\t\t'+(null==(s=t.storeName)?"":s)+"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t"),r+="\n\n\t\t\t\t\t\t\t",t.benefit&&(r+='\n\t\t\t\t\t\t\t\t<div class="deals-carousel__price-benefit">\n\t\t\t\t\t\t\t\t\t-'+(null==(s=t.benefit)?"":s)+"%\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t"),r+='\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<a href="'+(null==(s=t.url)?"":s)+'" target="_blank" class="button button_success deals-carousel__go-button">\n\t\t\t\t\t\t\t<span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__new-tab_16"><use xlink:href="#icon--ui__new-tab_16"></use></svg></span>\n\t\t\t\t\t\t\tПодробнее\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</article>\n\t\t\t\t'})),r+="\n\t\t\t</div>\n\t\t</div>\n\t\t",i.showArrows&&(r+='\n\t\t\t<button\n\t\t\t\ttype="button"\n\t\t\t\tclass="carousel__scroll button carousel__scroll_right"\n\t\t\t>\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__arrow-right"><use xlink:href="#icon--ui__arrow-right"></use></svg>\n\t\t\t</button>\n\t\t'),r+="\n\t</div>\n</section>\n");new(n.S.getInstance().get("UICarousel"))({el:this.el})}addStaticBlocks(t){const[e,...i]=l,s=[e,...h()(i,1).map((({url:t,title:e,image:i})=>({url:t,image:i,title:e})))],n=[...t];return s.forEach(((t,e)=>{n.splice(2*e,0,t)})),n}async getDeals(){const t=this.isNSFW?a:o,e=await fetch(t);return(await e.json()).map((t=>{var e,i,s,n;return{title:t.name,image:null===(e=t.attachments)||void 0===e||null===(i=e[0])||void 0===i?void 0:i.small,isAdultContent:t.isAdultContent,benefit:t.benefit,storeLogo:null===(s=t.store)||void 0===s?void 0:s.logo,storeName:null===(n=t.store)||void 0===n?void 0:n.name,url:this.isNSFW?t.dealUrl:`${r}${t.url}?utm_source=pikabu&utm_medium=post-banner`}}))}}const d=(t,e)=>{const i="string"==typeof t?document.getElementById(t):t;return i?(i.classList.add("deals-widget-container"),new c(i,e)):null};window.pkbDealsWidget=d,Array.isArray(window.pkbDealsWidgets)&&window.pkbDealsWidgets.forEach((t=>{const e=Array.isArray(t)?t:[t];d(...e)})),window.pkbDealsWidgets={push(t){const e=Array.isArray(t)?t:[t];d(...e)}}},9003:(t,e,i)=>{i.d(e,{K:()=>c});i(41817);var s=i(43241),n=i(81780),r=i(88358),o=i(36005);function a(t){var e,s="",n=o.escape;Array.prototype.join;i(12953).core;return s+='\n\n<div class="popup-menu'+n(t.isSubMenu?"":" popup-menu_dots-menu")+'">\n\t',t.isSubMenu?(s+='\n\t\t<div data-id="'+n(item.id)+'" class="popup-menu__item'+n(item.iconColored?" popup-menu__item_colored":"")+'">\n\t\t\t',item.template?s+="\n\t\t\t\t"+(null==(e=item.template)?"":e)+"\n\t\t\t":(s+="\n\t\t\t\t",item.icon&&(s+='\n\t\t\t\t\t<span class="popup-menu__item-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--'+n(item.icon)+'"><use xlink:href="#icon--'+n(item.icon)+'"></use></svg></span>\n\t\t\t\t'),s+="\n\t\t\t\t<span>"+n(item.title)+"</span>\n\t\t\t"),s+="\n\t\t</div>\n\t"):(s+="\n\t\t",t.items.forEach((function(t){s+='\n\t\t\t<div data-id="'+n(t.id)+'" class="popup-menu__item'+n(t.iconColored?" popup-menu__item_colored":"")+'">\n\t\t\t\t',t.template?s+="\n\t\t\t\t\t"+(null==(e=t.template)?"":e)+"\n\t\t\t\t":(s+="\n\t\t\t\t\t",t.icon&&(s+='\n\t\t\t\t\t\t<span class="popup-menu__item-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--'+n(t.icon)+'"><use xlink:href="#icon--'+n(t.icon)+'"></use></svg></span>\n\t\t\t\t\t'),s+="\n\t\t\t\t\t<span>"+n(t.title)+"</span>\n\t\t\t\t\t",t.isNew&&(s+='\n                    \t<span class="pkb-badge">NEW</span>\n                    '),s+="\n\t\t\t\t"),s+="\n\t\t\t</div>\n\t\t"})),s+="\n\t"),s+="\n</div>"}function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function u(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){h(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function h(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class c extends s.u{constructor(t){super(t),h(this,"menuStack",[]),h(this,"handleMenuItemClick",((t,e)=>{var i;const s=t.currentTarget.dataset.id,n=e.find((t=>String(t.id)===s));n&&(null!==(i=n.submenu)&&void 0!==i&&i.instance&&n.submenu.instance.show(),this.emit("onItemClick",n,t.currentTarget))})),this.show()}render(){return!this.isRendered&&this.el&&this._options.items.length?(this.el.addEventListener("click",(()=>{this.menu.show(),this.emit("onShow")})),super.render(),this):this}closeAllMenus(){this.menuStack.forEach((t=>t.hide()))}updateItems(t){this._options.items=t,this.menu.content=a({items:this._options.items})}addSubmenu(t,e){if(!e.length)return;const i=this.menu.content.find(`[data-id="${t.id}"]`),s=u(u({},this.submenuPopupOptions),{},{target:i,content:a({items:e,isSubmenu:!0})});t.submenu=u(u({},t.submenu),{},{items:e}),t.submenu.instance=new r._(s),this.initMenuListeners(t.submenu.instance,e,i)}addCustomSubMenu(t,e){const i=this.menu.content.find(`[data-id="${t.id}"`);t.submenu=u(u({},t.submenu),{},{instance:e,items:[]}),this.initMenuListeners(t.submenu.instance,[],i,!0)}get submenuPopupOptions(){return{direction:r.Lh.LEFT,alignment:r.SE.START,autoCloseOutsideClick:!0,destroyAfterHide:!1,popupNonOverflow:!0,isModalMenu:!0,indent:!1,useLayerForClickAway:!0,showDarkOverlay:!1,showArrow:!1,autoCorrectPosition:!0,bottomPosition:"",leftPosition:""}}initMenuListeners(t,e,i,s=!1){this.listenTo(t,n.e.UNMOUNTED,(()=>{var t;this.menuStack.splice(this.menuStack.length-1,1),null===(t=i||this.$el)||void 0===t||t.removeClass(i?"popup-menu__item_active":"dots-menu_active")}));const r=()=>{var e;this.menuStack.push(t),null===(e=i||this.$el)||void 0===e||e.addClass(i?"popup-menu__item_active":"dots-menu_active")};t.isMounted?r():this.listenTo(t,n.e.MOUNTED,r),s||(t.content.on("click",".popup-menu__item",(t=>{this.handleMenuItemClick(t,e)})),t.content.on("click",".button",(()=>{this.closeAllMenus()})))}get menu(){if(this._menu)return this._menu;const t={direction:r.Lh.BOTTOM,isModalMenu:!0,alignment:r.SE.END,autoCloseOutsideClick:!0,destroyAfterHide:!1,popupNonOverflow:!0,indent:!1,target:this.$el,useLayerForClickAway:!0,showDarkOverlay:!1,showArrow:!0,autoCorrectPosition:!1,bottomPosition:"",leftPosition:"",content:a({items:this._options.items}),wrapperExtraClass:"",isSwipeable:!1};return this._menu=new r._(t),this._options.items.forEach((t=>{t.submenu&&this.addSubmenu(t,t.submenu.items)})),this.initMenuListeners(this._menu,this._options.items),this._menu}get items(){return this._options.items}}},61950:(t,e,i)=>{let s,n;i.d(e,{$:()=>n,n:()=>s}),function(t){t.SELECT="dropdownSelect",t.SET="dropdownSet",t.SEARCH_START="dropdownStart",t.SEARCH_END="dropdownEnd",t.CURRENT="dropdownCurrent"}(s||(s={})),function(t){t[t.PREDEFINED=0]="PREDEFINED",t[t.REQUEST=1]="REQUEST"}(n||(n={}))},16106:(t,e,i)=>{i.d(e,{U:()=>s.U,nT:()=>n.n});i(21255);var s=i(63588),n=i(61950)},56064:(t,e,i)=>{i.d(e,{X:()=>n});i(66992),i(33948);var s=i(90477);class n extends s.Lo{constructor(t){super(t||{}),this.el=void 0,this.els={},this.on("current",this._updateCurrent),this.on(s.u$.REMOVE,this._onRemove)}render(){if(this.el)return this.el;let t;return t=this.el=document.createElement("div"),t.classList.add("dropdown-item"),t.setAttribute("data-id",this.id),this.el}_onRemove(){this.data.current=!1,this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)}_updateCurrent(t,e){this.el&&this.el.parentNode&&this.el.classList.toggle("dropdown-item_current",e)}destroy(...t){this.isDestroyed||this.marks.has("isPredefined")||(this._onRemove(),super.destroy(...t))}}n.prototype.defaults={label:"",info:"",current:!1}},63588:(t,e,i)=>{i.d(e,{Sh:()=>m,U:()=>n,VV:()=>l});var s=i(56064);class n extends s.X{render(){if(this.el)return this.el;let t,e;return super.render(),t=this.els.label=document.createElement("div"),t.classList.add("dropdown-item__label"),t.textContent="Моё"===this.data.name?"[моё]":this.data.name,this.el.appendChild(t),this.data.count&&(e=this.els.count=document.createElement("div"),e.classList.add("dropdown-item__info"),e.textContent=this.data.count,this.el.appendChild(e)),this.el}}n.prototype.fieldId="name",n.prototype.defaults={count:0,current:!1};var r=i(72044);class o extends s.X{render(){if(this.el)return this.el;let t=this.el=r.Zv.fragment((e=this.data,s="",Array.prototype.join,s+='<div class="community">\n\t<div class="community-avatar"><img src="'+(null==(i=e.avatar)?"":i)+'" alt=""></div>\n\t<div class="community__wrapper">\n\t\t<div class="community__title">\n\t\t\t',e.is_nsfw&&(s+='\n\t\t\t\t<span class="text-muted">[18+]</span>\n\t\t\t'),s+="\n\t\t\t<a>"+(null==(i=e.name)?"":i)+'</a>\n\t\t</div>\n\t\t<div class="community__information caption">\n\t\t\t<span>'+(null==(i=e.stories)?"":i)+"</span> • <span>"+(null==(i=e.subs)?"":i)+"</span>\n\t\t</div>\n\t</div>\n</div>\n")).firstChild;var e,i,s;return t.classList.add("dropdown-item"),t.setAttribute("data-id",this.id),this.el}}o.prototype.fieldId="id",o.prototype.defaults={avatar:"",name:"",current:!1,subs:"",stories:"",link:"",tags:void 0,is_nsfw:!1};i(74916);var a=i(36005);class l extends s.X{render(){return this.el||(super.render(),this.el.innerHTML=function(t){var e="",s=a.escape;Array.prototype.join;const{GROUP_AVATAR_CODE:n}=i(1262),r=t.avatar80||t.avatar;return e+='\n<div class="dropdown-item__icon avatar avatar_small avatar_square '+s("string"!=typeof r?"avatar_default":"")+'">\n    ',"string"==typeof r&&(e+="\n        ",e+=r===n?'\n            <div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__group-avatar"><use xlink:href="#icon--ui__group-avatar"></use></svg></div>\n        ':'\n            <img src="'+s(r)+'" />\n        ',e+="\n    "),e+='\n</div>\n<div class="user__nick dropdown-item__label">\n    '+s(t.name)+"\n    ",t.has_paid_options&&(e+='\n        <div class="user__label"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__approved-plus-o_16"><use xlink:href="#icon--ui__approved-plus-o_16"></use></svg></div>\n    '),e+="\n    ",t.has_paid_options||!t.is_approved&&!t.approval||(e+='\n        <div class="user__label"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__approved"><use xlink:href="#icon--ui__approved"></use></svg></div>\n    '),e+="\n    ",t.role&&(e+='\n    <span class="caption dropdown-item__user-role">\n        '+s(t.role)+"\n    </span>\n    "),e+"\n</div>\n\n"}(this.data)),this.el}search(t){return t.test(this.data.name)}}l.prototype.defaults={name:"",avatar:"",avatar80:"",is_approved:!1,approval:"",current:!1};class u extends l{render(){if(this.el)return this.el;super.render();let t=document.createElement("div");return t.classList.add("dropdown-item__info"),t.textContent=this.data.is_developer?"разработчик":"модератор",this.el.appendChild(t),this.el}search(t){return t.test(this.data.name)}}u.prototype.fieldId="id",u.prototype.defaults={avatar:"",avatar80:"",name:"",is_developer:!1,current:!1};class h extends s.X{render(){return this.el||(this.el=document.createElement("hr")),this.el}}h.prototype.isSeparator=!0,h.prototype.defaults={current:!1};class c extends s.X{render(){return this.el||(this.el=document.createElement("h4"),this.el.textContent=this.data.title||"Header"),this.el}}c.prototype.isSeparator=!0,c.prototype.defaults={current:!1,title:void 0};class d extends s.X{render(){if(this.el)return this.el;let t,e,i;return super.render(),t=document.createElement("div"),t.classList.add("dropdown-item__icon","community-avatar","community-avatar_small"),"string"==typeof this.data.avatar?(i=document.createElement("img"),i.setAttribute("src",this.data.avatar),t.appendChild(i)):t.classList.add("community-avatar__default"),this.el.appendChild(t),e=document.createElement("div"),e.classList.add("community__title","dropdown-item__label"),e.textContent=this.data.name,this.el.appendChild(e),this.el}search(t){return t.test(this.data.name)}}d.prototype.fieldId="id",d.prototype.defaults={avatar:"",name:"",current:!1};class p extends s.X{render(){if(this.el)return this.el;super.render();let t=document.createElement("i");return t.classList.add("caption"),t.innerHTML="Показать все результаты",this.el.appendChild(t),this.el}}p.prototype.defaults={current:!1};i(89655),i(93975);class m extends s.X{render(){return this.el||(super.render(),this.el.innerHTML=`\n\t\t\t<div class="dropdown-item__label dropdown-item__label_trim">\n\t\t\t\t${this.data.title}\n\t\t\t</div>\n\t\t`),this.el}}m.prototype.defaults={title:"",id:0,current:!1}},89655:(t,e,i)=>{i.d(e,{v:()=>n});var s=i(56064);class n extends s.X{render(){if(this.el)return this.el;let t,e;return super.render(),t=this.els.label=document.createElement("div"),t.classList.add("dropdown-item__label"),t.textContent=this.data.name,this.el.appendChild(t),this.el.setAttribute("data-type","profession"),this.data.users_count&&(e=this.els.count=document.createElement("div"),e.classList.add("dropdown-item__info"),e.textContent=this.data.users_count,this.el.appendChild(e)),this.el}}n.prototype.fieldId="name",n.prototype.defaults={name:"",users_count:0,current:!1}},93975:(t,e,i)=>{i.d(e,{S:()=>r});i(74916);var s=i(12953),n=i(56064);class r extends n.X{render(){return this.el||(super.render(),this.el.innerHTML=this._getTemplate()),this.el}_getTemplate(){const t=this.data.isAddBtn?' data-skip-highlight="true"':"",e=this.data.isAddBtn?`<span class="dropdown-item__icon">${s.core.icon("ui__add_20")}</span>`:"";let i="";return this.data.isAddBtn||(i=this.data.previewCoverImageUrl?`\n\t\t\t\t\t<img\n\t\t\t\t\t\tclass="dropdown-item__icon"\n\t\t\t\t\t\tsrc="${this.data.previewCoverImageUrl||this.data.coverImageUrl}"\n\t\t\t\t\t\talt="${this.data.title}"\n\t\t\t\t\t\tloading="lazy"\n\t\t\t\t\t>\n\t\t\t\t`:'<span class="story-series-thumb story-series-thumb_20 dropdown-item__icon"></span>'),`\n\t\t\t<div class="dropdown-item__label dropdown-item__label_trim dropdown-item__label_flex"${t}>\n\t\t\t\t${i||e} <span>${this.data.title}</span>\n\t\t\t</div>\n\t\t`}search(t){return t.test(this.data.title)}}r.prototype.defaults={title:"",previewCoverImageUrl:"",current:!1,isAddBtn:!1}},21255:(t,e,i)=>{i.d(e,{v:()=>l});i(88674);var s=i(12953),n=i(63907),r=i(61950),o=i(60320),a=i(36005);i(19755);class l extends n.u1{constructor(t={}){super(t),this.show()}render(){if(this.isRendered)return this;const{UITextArea:t,UIDropDownProfessions:e}=this.useRegistry();this._textarea=new t(this.$el),this._dropdown=new e({closeAfterSelect:this.closeAfterSelect});{const t=this._textarea.value;this._textarea.suggestion=this._dropdown,this.listenTo(this._dropdown,r.n.SET,(e=>{e.size||(this._textarea.value&&this._textarea.value.length>this._dropdown.minQueryLength&&this._dropdown.show(),""===this._textarea.value&&t&&(this._dropdown.hide(),this._onChangeProfession(this._textarea.value)))})),this._dropdown.$els.empty&&this._dropdown.$els.empty.button.length&&this._dropdown.$els.empty.button.on("click",(()=>{this._onChangeProfession(this._textarea.value)}))}return this.listenTo(this._dropdown,r.n.SELECT,((t,e)=>!!t&&(t.data.is_blacklisted?(this._dropdown.showBlacklist(),!1):(this._textarea.value=t.data.name,void this._onChangeProfession(t.data.name))))),this.listenTo(this._textarea,"focus",(0,a.debounce)((t=>{try{t.target.setSelectionRange(t.target.value.length,t.target.value.length)}catch(e){}})),100),super.render(),this}_initMobileDropdown(){this._textarea.$els.clearButton=this.$(".profile-profession__clear"),this._textarea.$els.clearButton.on("click",(t=>{t.preventDefault(),t.stopPropagation(),this._textarea.clear(),this._textarea.$els.clearButton.removeClass("input__clear_visible"),this._onChangeProfession("")})),this.listenTo(this._textarea,"focus",(t=>{this._textarea.$els.input.filter("textarea").removeClass("profile-block__textarea_invisible"),this._dropdown.show(),this._dropdown.$els.empty&&this._dropdown.$els.empty.button.length&&this._dropdown.$els.empty.button.on("click",(()=>{this._textarea.value=this._dropdown._input.value,this._textarea.$els.input.filter(".profile-block__text").text(this._textarea.value),this._onChangeProfession(this._textarea.value)}))}))}async _onChangeProfession(t){o.F.save(t)?(s.core.ui.toasts.add("settings-profession-saved",{content:s.core.i18n("page-settings.main.save.good"),closeAfter:3e3}),this._dropdown.hide()):s.core.ui.toasts.showError(s.core.i18n("page-settings.main.save.bad"))}get closeAfterSelect(){return this._options.closeAfterSelect}}},66447:(t,e,i)=>{i.d(e,{Z:()=>d});i(66992),i(33948),i(41817);var s=i(16253),n=i(81780);const r="_uiElement",o="_uiElement";var a=i(89803),l=i(92927),u=i(58330),h=i(36005);const c=i(19755);class d extends s.vp{constructor(t){super(),this.$els={},this._options={$el:void 0,$parent:void 0,isShown:!1,isRendered:!1,isMounted:!1,destroyAfterRemove:!0},a.Z.isHTMLElement(t)&&(t=c(t)),t instanceof c&&(t={$el:t.eq(0)}),t&&this.setOptions(t)}static getPropertyDescriptor(t,e){return t&&(Object.getOwnPropertyDescriptor(t,e)||d.getPropertyDescriptor(Object.getPrototypeOf(t),e))}setOptions(t){return(0,h.isObject)(t)?((0,h.forEach)(t,((t,e)=>{let i=d.getPropertyDescriptor(this,e);i&&Boolean(i.set)?this[e]=t:this._options[e]=t})),this):this}render(){return this._options.isRendered=!0,this.emit(n.e.RENDERED,this),this}toggle(t,...e){return(0,h.isBoolean)(t)||(t=!this.isShown),this.isShown===t||(t?this.show.apply(this,e):this.hide.apply(this,e)),this}show(){return this.render(),this.mount(),this._options.isShown=!0,this}hide(){return this.unmount(),this._options.isShown=!1,this}mount(){return this.isMounted||(this.$el&&this.$parent&&this.$el.parent()!==this.$parent&&this.$el.appendTo(this.$parent),this.emit(n.e.MOUNTED,this),this._options.isMounted=!0),this}unmount(){return this.isMounted?(this.$el&&this.$el.detach(),this.emit(n.e.UNMOUNTED,this),this._options.isMounted=!1,this):this}destroy(){if(!this.isDestroyed){this.__destroyed=!0,this.unmount(),this.emit(n.e.DESTROYED,this),this.$el&&(this.destroyAfterRemove&&(this.destroyAfterRemove=!1),this.$el.off(),delete this._options.el[r],this.$el.removeData(o),this.$el.empty().remove()),this.$els&&(this.$els=void 0),this._options.marks&&this._options.marks.clear();for(let t in this._options)this._options.hasOwnProperty(t)&&delete this._options[t];this.cancelTimeout(),this.cancelInterval(),this.stopListening(),this.off()}}useRegistry(){const t=u.S.getInstance();return Object.assign({},t.get(),t.getLocal(this))}$(t){return this.$el.find(t)}appendTo(t){return this.$el?(this._options.isMounted=!0,this.$parent=t,this.$el.appendTo(t)):(this.$parent=t,this.render()),this}timeout(t,e,i,s=!0,...n){s&&this.cancelTimeout(t);let r=this._timeoutList;r||(this._timeoutList=r=new Map);let o=()=>{i.apply(this,n),r.delete(t)};return r.set(t,{callback:o,handler:setTimeout(o,e)}),this}runTimeoutImmediately(...t){return this._timeoutList&&this._timeoutList.size&&t.length?(t.forEach((t=>{if(!this._timeoutList.has(t))return;let{handler:e,callback:i}=this._timeoutList.get(t);i(),clearTimeout(e),this._timeoutList.delete(t)})),this):this}cancelTimeout(...t){if(!this._timeoutList||!this._timeoutList.size)return this;if(t.length)t.forEach((t=>{this._timeoutList.has(t)&&(clearTimeout(this._timeoutList.get(t).handler),this._timeoutList.delete(t))}));else{for(let{handler:t}of this._timeoutList.values())clearTimeout(t);this._timeoutList.clear()}return this}interval(t,e,i,s=!0){return s&&this.cancelInterval(t),this._intervalList||(this._intervalList=new Map),this._intervalList.set(t,setInterval(i.bind(this),e)),this}cancelInterval(...t){return this._intervalList&&this._intervalList.size?(t.length?t.forEach((t=>{this._intervalList.has(t)&&(clearInterval(this._intervalList.get(t)),this._intervalList.delete(t))})):(this._intervalList.forEach((t=>clearInterval(t))),this._intervalList.clear()),this):this}animationFrame(t,e,i=!0){return i&&this.cancelAnimationFrame(t),this._animationFrames||(this._animationFrames=new Map),this._animationFrames.set(t,l.$.request(e.bind(this))),this}cancelAnimationFrame(...t){return this._animationFrames&&this._animationFrames.size?(t.length?t.forEach((t=>{this._animationFrames.has(t)&&(l.$.cancel(this._animationFrames.get(t)),this._animationFrames.delete(t))})):(this._animationFrames.values().forEach((t=>l.$.cancel(t))),this._animationFrames.clear()),this):this}closest(t,e){return t.closest(e,this.$el)}onRemoveEvent(t){let e=this._options.destroyAfterRemoveEls;if(e||(e=this._options.destroyAfterRemoveEls=new Set),a.Z.isJQuery(t)&&(t=t.get(0)),!a.Z.isHTMLElement(t))throw new Error("destroy after expected jQuery | HTMLElement");return e.has(t)||(e.add(t),c(t).on("removed",this._destroyBound)),this}offRemoveEvent(t){let e=this._options.destroyAfterRemoveEls;return e&&e.size?(0,h.isUndefined)(t)?(e.forEach((t=>{c(t).off("removed",this._destroyBound)})),e.clear(),delete this._options.destroyAfterRemoveEls,this):(a.Z.isJQuery(t)&&(t=t.get(0)),e.has(t)?(e.delete(t),c(t).off("removed",this._destroyBound),this):this):this}get isDestroyed(){return this.__destroyed}get $el(){return this._options.$el}set $el(t){let e=this.$el,i=(0,h.isUndefined)(t)||(0,h.isNull)(t);if(!i&&!a.Z.isElement(t))throw new Error("$el attribute can [HTMLElement|jQuery] "+typeof t);if(e&&(delete this._options.el[r],this.$el.removeData(o),this.offRemoveEvent(this.el)),i)return e&&e.remove(),this._options.el=void 0,this._options.$el=void 0,this._options.isMounted=!1,void(this._options.isRendered=!1);t=c(t).eq(0),this._options.el=t[0],t.parent().length&&(this._options.isMounted=!0,this.$parent=t.parent()),this.destroyAfterRemove&&this.onRemoveEvent(t),Object.defineProperty(this._options.el,r,{value:!0,configurable:!0,writable:!1,enumerable:!1}),this._options.$el=c(t).eq(0),this.$el.data(o,this)}get el(){return this._options.el}set el(t){if(!a.Z.isHTMLElement(t))throw new Error("$el attribute can [HTMLElement] "+typeof t);return this.$el=c(t),this._options.el=t}get name(){return this._options.name}set name(t){return this._options.name=String(name)}get $parent(){return this._options.$parent}set $parent(t){if(!a.Z.isElement(t))throw new Error("$el attribute can [HTMLElement|jQuery]"+typeof t);this._options.$parent=c(t).eq(0)}get isMounted(){return this._options.isMounted}get isShown(){return this._options.isShown}set isShown(t){let e=Boolean(t);this.isShown!==e&&(t?this.show():this.hide())}get isRendered(){return this._options.isRendered}get _destroyBound(){return this._options.destroyBound?this._options.destroyBound:this._options.destroyBound=()=>{this.emit(n.e.REMOVED,this),this.destroy()}}get destroyAfterRemove(){return this._options.destroyAfterRemove}set destroyAfterRemove(t){this._options.destroyAfterRemove!==(t=Boolean(t))&&(this._options.destroyAfterRemove=t,this.$el&&(t?this.onRemoveEvent(this.el):this.offRemoveEvent(this.el)))}get marks(){return this._options.marks||(this._options.marks=new Map),this._options.marks}static closestUIElement(t,e=6){let i=0;for(e=Math.max(1,e),t instanceof c&&(t=t.get(0));t&&t!==document.documentElement||i>e;){if(!t)return!1;if(!(0,h.isUndefined)(t[r]))return d.getUIElement(t);t=t.parentElement,i++}return!1}static getUIElement(t){if(a.Z.isHTMLElement(t)){if(!t[r])return;t=c(t)}if(t instanceof c&&t.length)return t.data(o)}get eid(){return this._options.eid||(this._options.eid=(0,h.uniqueId)("e")),this._options.eid}}var p,m,_;p=d,_=!0,(m=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(m="isUIElement"))in p?Object.defineProperty(p,m,{value:_,enumerable:!0,configurable:!0,writable:!0}):p[m]=_},81780:(t,e,i)=>{let s;i.d(e,{e:()=>s}),function(t){t.UNMOUNTED="uiUnmounted",t.MOUNTED="uiMounted",t.DESTROYED="uiDestroyed",t.REMOVED="uiRemoved",t.RENDERED="uiRendered",t.HIDDEN="uiHidden"}(s||(s={}))},63907:(t,e,i)=>{i.d(e,{eM:()=>n.e,u1:()=>s.Z});var s=i(66447),n=i(81780)},71556:(t,e,i)=>{i.d(e,{f:()=>f});i(2707),i(66992),i(33948),i(88674),i(74916),i(15306),i(41817);var s=i(12953),n=i(12950),r=i(63907),o=i(88358),a=i(65563),l=i(65278),u=i(10553),h=i(90312),c=i(63748),d=i(36005),p=(i(91904),i(29845));function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function _(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach((function(e){g(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function g(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const v=i(19755);class f extends r.u1{constructor(t){super(t),this._maxEmotionsOnButton=2,this._maxCountEmotionForShowing=2,this._storyId=this.$el.data("storyId"),this._userEmotions=this.$el.data("user-emotions")||[],Array.isArray(this._userEmotions)||(this._userEmotions=[]),this._counters={},this._sendRequestDebounce=(0,d.debounce)(this._sendRequest,200),this.$els={items:this.$("."+l.G.items)},this._emotions=s.default.initParams.emotionsTypesConfig,this._addButtonEmotions()}get popup(){if(this._popup)return this._popup;return this._popup=new o._({direction:o.Lh.TOP,alignment:o.SE.CENTER,autoCloseOutsideClick:!0,popupNonOverflow:!0,indent:!1,target:this.$el,content:(0,a.Z)({emotions:this._emotions,userEmotions:this._userEmotions,counters:this._counters,updateCounterText:this._updateCounterText})}),this.listenTo(this._popup,r.eM.UNMOUNTED,(()=>{this.$el.removeClass(l.G.opened)})),this.listenTo(this._popup,r.eM.MOUNTED,(()=>{this.$el.removeClass(l.G.opened)})),this._popup.content.on("click",`.${l.G.popup.item}`,this._onClickEmotion.bind(this)),this._popup}updateEmotionsCounters(t){(t||(0,c.K)(t))&&(this._counters=t,this._sortEmotionsByCounter(),this._addButtonEmotions(),this.popup.content=(0,a.Z)({emotions:this._emotions,counters:this._counters,userEmotions:this._userEmotions,updateCounterText:this._updateCounterText}))}_sortEmotionsByCounter(){this._userEmotions.sort(((t,e)=>this._counters[e]-this._counters[t]))}_addButtonEmotions(){if(0===Object.values(this._counters).length)return;this.$els.items.empty();const t=[...Object.keys(this._emotions)].sort(((t,e)=>this._counters[e]-this._counters[t]));for(let e=0;e<this._maxEmotionsOnButton&&!(t.length<=e);e++){const i=t[e],s=e>0?t[e-1]:null;if(this._counters[i]<this._maxCountEmotionForShowing||null!==s&&this._counters[i]<this._counters[s]/2)break;this._addEmotionTempleToButton(`${i}`)}}_addEmotionTempleToButton(t){this.$els.items.append(`<span data-type="${t}" class="${l.G.item}">\n\t\t\t\t${(0,u.t)("emotions__"+this._emotions[t].class)}\n\t\t\t</span>`)}_onClickEmotion(t){const e=v(t.currentTarget);var i;if(!s.default.isUserAuthorized)return this.popup.hide(),s.default.ui.authRequired({analyticsParams:{reason:"reaction",author_id:this.story.authorId,post_id:this.story.id,"community_id!empty":null===(i=this.story.el.dataset)||void 0===i?void 0:i.communityId,screen_index:this.story.screenIndex,"rating!empty":this.story.rating}}),void h.c.getInstance().sendEvent("click",{type:"emotion_add",user_rate:e.data("type")});p.N.instance.clearStoryCache(this._storyId),this._changeEmotions(e),this._sendRequestDebounce(e.data("type"),Number(!e.hasClass(l.G.popup.itemActive))),e.toggleClass(l.G.popup.itemActive)}async _sendRequest(t,e){await n.cf.postOrFail("/ajax/save_emotion.php",{story_id:this._storyId,type:t,state:e});const i=this.story.analyticsData;h.c.getInstance().sendEvent(e?"reaction_add_post":"reaction_remove_post",_(_(_(_({post_id:this.story.id,author_id:i.author_id,user_rate:t,rating:this.story.rating,screen_index:i.screen_index,post_donation:this.story.donationAnalyticsParam},this.story.subsCode&&{type_i8:this.story.subsCode}),this.story.isFromRecommendations&&{component_name:"post_recs"}),this.story.el.dataset.extFeed&&{component_name:"extension",screen:this.story.el.dataset.extFeed}),s.default.ui.actionBarShown&&{action_bar:"1"}))}_changeEmotions(t){const e=t.data("type"),i=t.data("count"),s=t.hasClass(l.G.popup.itemActive),n=t.find("."+l.G.popup.counter);let r=Number(i)+(s?-1:1);r=r<0?0:r,t.data("count",r),n.text(this._updateCounterText(r)),this._counters[e]=r,this._userEmotions.includes(Number(e))||this._userEmotions.push(Number(e)),this._sortEmotionsByCounter(),this._addButtonEmotions()}_updateCounterText(t){return t>1e3?(t>1e5?Math.floor(t/1e3):(t/1e3).toFixed(1).replace(".0",""))+"k":t}get story(){return this._options.story}}},65278:(t,e,i)=>{i.d(e,{G:()=>s});const s={el:"emotions",opened:"emotions_opened",items:"emotions__items",item:"emotions__item",popup:{item:"emotions__popup-item",itemActive:"emotions__popup-item_active",counter:"emotions__popup-counter span"}}},41381:(t,e,i)=>{i.d(e,{D:()=>a});i(66992),i(33948),i(41817);var s=i(43241),n=i(36005);var r=i(92514);function o(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class a extends s.u{constructor(...t){super(...t),o(this,"targetValueEl",null),o(this,"restValueEl",null),o(this,"progessEl",null)}show(){return this.isShown||!this.el||(this.targetValueEl=this.el.querySelector(".fundraising-progressbar__target"),this.restValueEl=this.el.querySelector(".fundraising-progressbar__rest"),this.progessEl=this.el.querySelector(".fundraising-progressbar__progress")),this}create(){if(this.isShown||!this.el)return this;const{value:t,max:e}=this._options;var i,s,o,a;return this.el.innerHTML=(i={progress:(0,r.cw)(t,e),formattedValue:(0,r.uf)(t),formattedMax:(0,r.uf)(e),formattedRest:this.getRestFormattedValue(e,t),completed:this._options.completed},o="",a=n.escape,Array.prototype.join,o+='<div class="fundraising-progressbar">\n\t<figure>\n\t\t<div\n\t\t\tclass="fundraising-progressbar__progress"\n\t\t\tdata-label="'+a(i.progress)+'"\n\t\t>\n\t\t\t<div style="width: '+(null==(s=i.progress)?"":s)+'"></div>\n\t\t</div>\n\t\t<figcaption>\n\t\t\t',i.completed?o+='\n\t\t\t\t<footer class="fundraising-progressbar__footer fundraising-progressbar__footer_completed">\n\t\t\t\t\tСобрано\n\t\t\t\t\t<strong class="fundraising-progressbar__target">\n\t\t\t\t\t\t'+(null==(s=i.formattedValue)?"":s)+' <span class="pkb-ruble-sign">₽</span>\n\t\t\t\t\t</strong>\n\t\t\t\t\tиз\n\t\t\t\t\t<strong class="fundraising-progressbar__target">\n\t\t\t\t\t\t'+(null==(s=i.formattedMax)?"":s)+' <span class="pkb-ruble-sign">₽</span>\n\t\t\t\t\t</strong>\n\t\t\t\t</footer>\n\t\t\t':o+='\n\t\t\t<div class="fundraising-progressbar__values">\n\t\t\t\t<span>'+(null==(s=i.formattedValue)?"":s)+' <span class="pkb-ruble-sign">₽</span></span>\n\t\t\t\t<span>\n\t\t\t\t\t<span class="fundraising-progressbar__rest">\n\t\t\t\t\t\t'+(null==(s=i.formattedRest)?"":s)+'\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="pkb-ruble-sign">₽</span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<footer class="fundraising-progressbar__footer">\n\t\t\t\t<span>из\n\t\t\t\t\t<strong class="fundraising-progressbar__target">\n\t\t\t\t\t\t'+(null==(s=i.formattedMax)?"":s)+"\n\t\t\t\t\t\t</strong>\n\t\t\t\t\tсобрано\n\t\t\t\t</span>\n\t\t\t\t<span>осталось собрать</span>\n\t\t\t</footer>\n\t\t\t",o+="\n\t\t</figcaption>\n\t</figure>\n</div>\n"),this.show(),this}update(t,e){var i,s,n;this.targetValueEl&&(this.targetValueEl.innerText=(0,r.uf)(t)),this.restValueEl&&(this.restValueEl.innerText=this.getRestFormattedValue(t,e));const o=(0,r.cw)(e,t);null===(i=this.progessEl)||void 0===i||i.setAttribute("data-label",o),null===(s=this.progessEl)||void 0===s||null===(n=s.firstElementChild)||void 0===n||n.setAttribute("style","width: "+o)}getRestFormattedValue(t,e){return(0,r.uf)(Math.max(t-e,0))}}},29281:(t,e,i)=>{i.d(e,{x6:()=>c,BV:()=>o,hA:()=>g});i(88674),i(66992),i(33948);var s=i(63907),n=i(36005);const r=i(19755);class o extends s.u1{constructor(t){super(),this.setOptions((0,n.defaults)(t||{},{aspectRatio:1}))}render(){return this.isRendered||(this.init(),super.render()),this}async init(){const{default:t}=await i.e(341).then(i.t.bind(i,33129,23));this.$el=r(document.createElement("div")).addClass("image-cropper"),this.file&&this.$el.append(this.file),this._cropper=new t(this.file.get(0),{dragMode:"move",viewMode:1,aspectRatio:this.aspectRatio,autoCropArea:1,restore:!1,guides:!1,center:!1,highlight:!1,cropBoxMovable:!1,cropBoxResizable:!1,toggleDragModeOnDblclick:!1})}getData(){return this._cropper.getData()}get file(){return this._options.file}set file(t){return t===this._options.file?this.file:(t="string"==typeof t?r(document.createElement("img")).attr("src",t):t=r(t),this._options.file=t)}get outputSize(){return this._options.outputSize}set outputSize(t){let e=this._options.outputSize;(0,n.isArray)(t)||2!==t.length||e===t||(this._options.outputSize=t,this.aspectRatio=t[0]/t[1])}get aspectRatio(){return this._options.aspectRatio}set aspectRatio(t){return this._options.aspectRatio=parseFloat(t)}}var a=i(12953),l=i(31474),u=i(88358),h=i(98858);const c=new(i(65448).xs)({PROFILE_AVATAR:1,PROFILE_BACKGROUND:2,COMMUNITY_AVATAR:3,COMMUNITY_BACKGROUND:4,SERIES_COVER:5});var d=i(12950);i(96637);var p=i(58330),m=i(8117);const _=i(19755);class g extends u.LD{constructor(t){super(t),this._isMobileView=!1,this._errorPopup=void 0}render(){if(this.isRendered)return this;super.render();const t=p.S.getInstance().get("UIButton");var e,i;return this._uploadButton=new t({title:"Загрузить",theme:l.j.SUCCESS}),_(document.createElement("input")).attr("type","file").attr("accept","image/*").on("click",(t=>t.stopPropagation())).on("change",(t=>{let e=h.nO.getImageFiles(t);e.length&&(this.file=e[0])})),this.listenTo(this._uploadButton,"click",this._onClickUpload),this.addCustomIntoFooter(this._uploadButton.show().$el),this._uploadButton.$el.html("Загрузить"),this.addCloseButtonIntoFooter(),this.content=(e={type:this.type.toString().toLowerCase()},""+'<div class="image-cropper" data-type="'+(null==(i=e.type)?"":i)+'" data-loading="true">\n\t<div class="image-cropper__loading"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__progress-circle icon--ui__progress-circle_image-cropper"><use xlink:href="#icon--ui__progress-circle"></use></svg></div>\n\t<div class="image-cropper__content"></div>\n\t<div class="image-cropper__error" style="display: none">Сообщение о ошибке</div>\n</div>'),this.$els.cropper={el:this.$(".image-cropper"),content:this.$(".image-cropper__content"),error:this.$(".image-cropper__error")},this._initCropper(),this}async _initCropper(){var t,e;this.isLocked=!0,this.isLoading=!0;let s=await(0,m.t)(this.file,null===(t=this.outputSize)||void 0===t?void 0:t[0],null===(e=this.outputSize)||void 0===e?void 0:e[1]);this._cropper&&(this._cropper.destroy(),this.$els.cropper.content.empty()),this.$els.cropper.content.append(s);let n=this.outputSize?this.outputSize[0]/this.outputSize[1]:1;this.isLoading=!1,this._cropper=await new Promise((async t=>{const{default:e}=await i.e(341).then(i.t.bind(i,33129,23));new e(s,{dragMode:"move",viewMode:1,aspectRatio:n,autoCropArea:1,responsive:!1,restore:!1,guides:!1,center:!1,highlight:!1,cropBoxMovable:!1,cropBoxResizable:!1,toggleDragModeOnDblclick:!1,ready(){t(this.cropper)}})})),this.isLocked=!1;let{width:r}=this._cropper.getContainerData();this.$els.cropper.el.css({maxWidth:r})}_hideError(){this.$els.cropper.error.hide(),this._errorPopup&&this._errorPopup.hide()}_showError(t){let e=void 0===t||"error"===t?a.core.i18n("errors.upload"):t;this._isMobileView?this._showErrorPopup(e):this._showErrorSection(e)}_showErrorPopup(t){let e=this._errorPopup||(new u.LD).addCloseButtonIntoFooter();e.indent=!0,e.header=a.core.i18n("errors.common"),e.content=t,e.show()}_showErrorSection(t){this.$els.cropper.error.toggleClass("caption",t.length>200).html(t).show()}_getCroppedImage(){let t;if(this.outputSize){let[e,i]=this.outputSize;t={minHeight:i,minWidth:e}}return new Promise((e=>this._cropper.getCroppedCanvas(t).toBlob((t=>e(t)))))}async _onClickUpload(){if(this._uploadButton.progress)return;let t;switch(this._uploadButton.progress=!0,this._hideError(),this.type){case c.PROFILE_AVATAR:t="user_avatar";break;case c.PROFILE_BACKGROUND:t="user_background";break;case c.COMMUNITY_BACKGROUND:t="community_header_bg";break;case c.COMMUNITY_AVATAR:t="community_avatar";break;case c.SERIES_COVER:t="series_cover"}let e=await this._getCroppedImage(),{response:i,data:s}=await d.ff.upload((0,n.extend)({type:t,save:1},this.data||{}),e,{useFileAPI:!1});i.result?(this.emit("upload",s),this.hide()):this._showError(i.message),this._uploadButton.progress=!1}destroy(){this.isDestroyed||(this._uploadButton.destroy(),delete this._uploadButton,super.destroy())}set isLocked(t){this._options.isLocked!==(t=Boolean(t))&&(this._options.isLocked=t,this._uploadButton.disabled=t)}set isLoading(t){this._options.isLocked!==(t=Boolean(t))&&(t&&this.$els.cropper.el.attr("data-loading","true"),this.$els.cropper.el.removeAttr("data-loading"))}get file(){return this._options.file}set file(t){this._options.file!==t&&(this._options.file=t,this.isRendered&&this._initCropper())}get outputSize(){return this._options.outputSize}set outputSize(t){let e=this._options.outputSize;(0,n.isArray)(t)&&2===t.length&&e!==t&&(this._options.outputSize=t)}get type(){return this._options.type||c.AVATAR}set type(t){let e=this._options.type;(t=c[t])&&t!==e&&(this._options.type=t)}get data(){return this._options.data}set data(t){this._options.data!==t&&(this._options.data=t)}}},29069:(t,e,i)=>{i.d(e,{i:()=>v});i(88674),i(66992),i(33948),i(3462),i(33824);var s=i(12953),n=i(63907),r=(i(44497),i(88358));var o=i(66677);const a=new(i(65448).xs)({NONE:0,ZOOM:1,SWIPE_X:2,SWIPE_Y:3});i(74916);var l=i(90312),u=i(52764);const h=i(19755);class c{constructor(t){this._viewer=t,this._timeStartDownload=0,this._timeWhenImageViewed=0,this._beforeImageViewTime=0,this._isImageShown=!1,this._imageViewTimer=void 0,this._$story=void 0,this._$comment=void 0,this._postId=void 0,this._commentId=void 0,this._authorId=void 0,this._comments=0,this._imageWidth=0,this._imageHeight=0,this._screenIndex=0,this._subscode=0,this._level=void 0,this._recScore=1,this._addListeners()}imageViewStarted(){this._isImageShown=!0,this._timeWhenImageViewed=Date.now(),this._beforeImageViewTime=(this._timeWhenImageViewed-this._timeStartDownload)/1e3,this._postId||this._commentId||this._getStaticAnalyticsParams(),this._setLevel(),this.sendImageViewEvent()}sendImageViewEvent(t=!1){const e=(Date.now()-this._timeWhenImageViewed)/1e3;Number.isNaN(e)||(!t&&this._isImageShown&&(this._imageViewTimer=setTimeout((()=>this.sendImageViewEvent()),2e3)),l.c.getInstance().sendEvent("image_view",{create_at:this._timeWhenImageViewed,"post_id!empty":this._postId,"comment_id!empty":this._commentId,"comment_author_id!empty":this._commentAuthorId,"comments!empty":this._comments,author_id:this._authorId,"screen_index!empty":this._screenIndex,"type_i8!empty":this._subscode,"level!empty":this._level,rec_score:this._recScore,view_time:e,length:this._beforeImageViewTime,list_f32:[this._imageWidth,this._imageHeight],type:"image",post_donation:this._hasDonateButton,"component_name!empty":this._componentName,"screen!empty":this._extFeedScreen}))}viewEnded(){clearTimeout(this._imageViewTimer),this._isImageShown=!1,this.sendImageViewEvent(!0),this._timeWhenImageViewed=0}_addListeners(){window.onblur=()=>this.viewEnded(),window.onfocus=()=>{if(!this._viewer.$el)return clearTimeout(this._imageViewTimer),void(this._isImageShown=!1);clearTimeout(this._imageViewTimer),this._imageViewTimer=void 0,this._isImageShown=!0,this._timeWhenImageViewed=Date.now(),this.sendImageViewEvent()}}_getStaticAnalyticsParams(){var t,e,i,s,n;if(this._$story=this._viewer._targetImage.closest(".story[data-story-id]"),this._postId=null===(t=this._$story)||void 0===t?void 0:t.data("story-id"),this._$comment=this._viewer._targetImage.closest(".comment[data-id]"),this._commentId=null===(e=this._$comment)||void 0===e?void 0:e.data("id"),this._commentAuthorId=null===(i=this._$comment)||void 0===i?void 0:i.data("author-id"),this._hasDonateButton=(0,u.v)(this._$story.get(0)),this._componentName=null===(s=this._$story)||void 0===s?void 0:s.data("component-name"),this._extFeedScreen=null===(n=this._$story)||void 0===n?void 0:n.data("ext-feed"),this._subscode=this._$story.data("subs-code"),this._postId){this._comments=this._$story.data("comments"),this._authorId=Number(this._$story.data("author-id"));const t=h(".stories-feed__container").find(".story");t.length>0&&(this._screenIndex=h.inArray(this._$story[0],t)+1)}this._commentId&&(this._postId=this._$comment.data("meta").match(/sid=(\d+)/)[1],this._authorId=Number(this._$comment.data("meta").match(/said=(\d+)/)[1]))}setImageParams(t,e){this._imageWidth=t,this._imageHeight=e}setRecScore(t){t>this._recScore&&(this._recScore=t)}_setLevel(){var t;const e=(null!==(t=this._$story)&&void 0!==t&&t.length?this._$story:this._$comment).find("img");e.length>1&&(this._level=h.inArray(this._viewer._targetImage[0],e)+1)}setTimeDownloadBegin(){this._timeStartDownload=Date.now()}destroy(){window.onblur=null,window.onfocus=null}}var d=i(36005),p=i(77754),m=i(91719);const _=i(19755),g=500;class v extends n.u1{constructor(t={}){var e;super(),this._prevScaleText="",this._useTouchEvent=!1,this._showImageBackground=!0===t.showImageBackground,this._showScrollArrows=!0===t.showScrollArrows,this._showLargeImageLoader=!0===t.showLargeImageLoader,this._useSwipeForClose=!1,this._useHistoryState=!0===t.useHistoryState,this._closeByClick=!0===t.closeByClick,this._clickEventName="click",this._closeMsgShowPercent=0,this._skipImageStartupAnim=!0===t.skipImageStartupAnim,this._animProps={curr:0,dur:20,method:"cubic",timer:0},this._makeAnimationStepBound=this._makeAnimationStep.bind(this),this._transform={x:0,y:0,scale:1},this._transformSaved={x:0,y:0,scale:1},this._transformApplied={x:0,y:0,scale:1},this._startupAnim={duration:t.startupAnimationDuration||500},this._initScale=1,this._minScale=.1,this._maxScale=3,this._shown=!1,this._loaded=!1,this._bigImage=null,this._imageURL="",this._imageLargeURL="",this._padding=20,this._topIndent=0,this._mouseScrollEvent="",this._helpBalloon=null,this._targetImage=null,this._nextPicAnimateDirection="",this._naturalScale=!1,this._currentGesture=a.NONE,this._images=null!==(e=t.images)&&void 0!==e?e:null,this._init(),this._analytics=new c(this),this._analytics.setTimeDownloadBegin()}_init(){this._useTouchEvent=o.Ni,this._naturalScale=!1,this._clickEventName="click"}_create(){var t,e,i;if(this.$el=_((t={showScrollArrows:this._showScrollArrows,showImageBackground:this._showImageBackground,showScrollHint:!1,useSwipeForClose:this._useSwipeForClose,isMac:navigator.platform.indexOf("Mac")>-1,showLargeImageLoader:this._showLargeImageLoader,showZoomButtons:!1,showHelpButton:this._options.showHelpButton,totalImages:this.$all.length,currentIndex:this.currentIndex},i="",Array.prototype.join,i+='<div class="image-viewer">\n\t<img src="" alt="" />\n\t',t.showImageBackground&&(i+='\n\t\t<div class="image-viewer__background"></div>\n\t'),i+="\n\t",t.showScrollArrows&&(i+='\n\t\t<div class="image-viewer__arrow image-viewer__arrow_up">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__arrow-up icon--ui__arrow-up_size-large"><use xlink:href="#icon--ui__arrow-up"></use></svg>\n\t\t</div>\n\t\t<div class="image-viewer__arrow image-viewer__arrow_down">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__arrow-down icon--ui__arrow-down_size-large"><use xlink:href="#icon--ui__arrow-down"></use></svg>\n\t\t</div>\n\t\t',t.showScrollHint&&(i+='\n\t\t\t<div class="image-viewer__hotkeys-info">\n\t\t\t\t<i class="fa fa-long-arrow-up"></i><br><span>'+(null==(e=t.isMac?"cmd":"ctrl")?"":e)+' + scroll</span>\n\t\t\t\t<br><i class="fa fa-long-arrow-down"></i>\n\t\t\t</div>\n\t\t\t<div class="image-viewer__hotkeys-info image-viewer__hotkeys-info_shifted">\n\t\t\t\t<i class="fa fa-long-arrow-up"></i><br><span>'+(null==(e=t.isMac?"cmd":"ctrl")?"":e)+' + scroll</span>\n\t\t\t\t<br><i class="fa fa-long-arrow-down"></i>\n\t\t\t</div>\n\t\t'),i+="\n\t"),i+='\n\t<button class="image-viewer__button image-viewer__button_close">\n\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close icon--ui__close_size-large"><use xlink:href="#icon--ui__close"></use></svg>\n\t</button>\n\t',t.showHelpButton&&(i+='\n\t\t<button class="image-viewer__button image-viewer__button_help">?</button>\n\t'),i+="\n\t",t.showZoomButtons&&(i+='\n\t\t<button class="image-viewer__button image-viewer__button_zoom-in">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__plus icon--ui__plus_size-large"><use xlink:href="#icon--ui__plus"></use></svg>\n\t\t</button>\n\t\t<button class="image-viewer__button image-viewer__button_zoom-out">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__minus icon--ui__minus_size-large"><use xlink:href="#icon--ui__minus"></use></svg>\n\t\t</button>\n\t'),i+='\n\t<button class="image-viewer__button image-viewer__button_link">\n\t\t<i class="fa fa-external-link"></i>\n\t</button>\n\t',t.showLargeImageLoader&&(i+='\n\t\t<div class="image-viewer-loader">\n\t\t\t<span class="image-viewer-loader__stage"><svg><path d="M0 0"/></svg></span>\n\t\t\t\t\x3c!--<span class="image-viewer-loader__caption">\n\t\t\t\t\tкачественная<br>картинка\n\t\t\t\t</span>--\x3e\n\t\t</div>\n\t'),i+="\n\t",t.useSwipeForClose&&(i+='\n\t\t<div class="image-viewer__close-msg">закрыть</div>\n\t'),i+="\n\t",t.totalImages>1&&(i+='\n\t\t<div class="image-viewer__current-position">'+(null==(e=t.currentIndex+1)?"":e)+"/"+(null==(e=t.totalImages)?"":e)+"</div>\n\t"),i+="\n\t",t.totalImages>1&&(i+='\n\t\t<div class="image-viewer__nav-arrow image-viewer__nav-arrow_prev"'+(null==(e=0===t.currentIndex?" hidden":"")?"":e)+'>\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__arrow-left"><use xlink:href="#icon--ui__arrow-left"></use></svg>\n\t\t</div>\n\t\t<div class="image-viewer__nav-arrow image-viewer__nav-arrow_next"'+(null==(e=t.currentIndex===t.totalImages-1?" hidden":"")?"":e)+'>\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__arrow-right"><use xlink:href="#icon--ui__arrow-right"></use></svg>\n\t\t</div>\n\t'),i+="\n</div>\n")),this.$els={linkButton:this.$(".image-viewer__button_link"),closeButton:this.$(".image-viewer__button_close"),zoomInButton:this.$(".image-viewer__button_zoom-in"),zoomOutButton:this.$(".image-viewer__button_zoom-out"),helpButton:this.$(".image-viewer__button_help"),img:this.$(" > img"),imgBg:this.$(".image-viewer__background"),arrowUpButton:this.$(".image-viewer__arrow_up"),arrowDownButton:this.$(".image-viewer__arrow_down"),hotKeyInfo:this.$(".image-viewer__hotkeys-info"),closeMsg:this.$(".image-viewer__close-msg"),loader:this.$(".image-viewer-loader"),loaderDisk:this.$(".image-viewer-loader svg path"),currentPosition:this.$(".image-viewer__current-position"),navArrowPrev:this.$(".image-viewer__nav-arrow_prev"),navArrowNext:this.$(".image-viewer__nav-arrow_next")},this.$els.linkButton.on(this._clickEventName,(()=>window.open((0,m.Q)(this._targetImage[0])))),this.$els.closeButton.on(this._clickEventName,this.hide.bind(this)),this.$els.arrowUpButton.on(this._clickEventName,this._scrollUp.bind(this)),this.$els.arrowDownButton.on(this._clickEventName,this._scrollDown.bind(this)),this.$els.helpButton.on(this._clickEventName,this._showHelp.bind(this)),this.$els.zoomInButton.on(this._clickEventName,(()=>{this._zoom(1)})),this.$els.zoomOutButton.on(this._clickEventName,(()=>{this._zoom(-1)})),this.$els.navArrowPrev.on(this._clickEventName,(()=>this._openNextImage(-1))),this.$els.navArrowNext.on(this._clickEventName,(()=>this._openNextImage(1))),this._closeByClick){let t=!1;this.$el.on("mousedown click",(e=>{"mousedown"===e.type?t=!0:t&&"click"===e.type&&e.target===this.$el[0]&&this.hide()}))}_(window).on("resize.imageView",(0,d.debounce)(this._correctPosition.bind(this),500)),this.$el.on("touchmove",(t=>{t.stopPropagation(),t.preventDefault()}));{let t=this.$el[0],e=this._zoomByWheel.bind(this);t.addEventListener("MozMousePixelScroll",e,!1),t.addEventListener("mousewheel",e,!1)}this.$els.img[0].addEventListener("load",(()=>{setTimeout((()=>{this._listenImageEvents()}),100)}))}setTarget(t){return this._targetImage=_(t),this._bigImage=null,this._imageURL="",this._imageLargeURL="",this}show(){return this._targetImage?(this._padding=this._showImageBackground?40:20,this._topIndent=0,this._useHistoryState&&(s.default.history.pushState({id:"image-viewer"},document.title),this.listenTo(s.default.history,"popstate",(()=>{this.hide()}))),_(document).on("keyup.imageView",(t=>{switch(t.key||t.keyCode){case"Esc":case"Escape":case 27:this.hide();break;case"0":case 48:this._naturalScale=!!this._isStartupProps()&&!this._naturalScale,this._naturalScale?this._setImageNaturalProps():this._setImageStartupProps(),this._animateImgProps("cubic",10);break;case"ArrowRight":case"Right":case 39:this._openNextImage(1);break;case"ArrowLeft":case"Left":case 37:this._openNextImage(-1)}})),_(document).on("keydown.imageView",(t=>{switch(t.key||t.keyCode){case"ArrowUp":case"Up":case 38:t.preventDefault(),this._scrollUp(5);break;case"PageUp":case 33:t.preventDefault(),this._scrollUp(1);break;case"ArrowDown":case"Down":case 40:t.preventDefault(),this._scrollDown(5);break;case"PageDown":case 34:t.preventDefault(),this._scrollDown(1);break;case"Tab":case 9:this._togglePanels()}})),setTimeout((()=>{this.$el||this._create(),this._loadImage(),this._preparePage(),this.$el.css("opacity",0).animate({opacity:1},this._startupAnim.duration,(()=>{this._shown=!0,this._loaded&&this._prepareImage()})),_("body").append(this.$el)})),this):this}async _loadImage(){if(!this._targetImage)return;let t=this._targetImage,e=this.$els.img[0];this._loaded=!1,e.style.visibility="",this.$els.img.off("load").on("load",(t=>{this._loaded=!0,this._analytics.setImageParams(t.target.width,t.target.height),this._shown&&this._prepareImage()}));let i=this._imageURL=t.attr("src")||t.data("src");const s=t.data("large-image");s!==i&&(this._imageLargeURL=s);const n=t.data("scramblerOffset");n&&!i.startsWith("data:")&&(i=await p.N.descrambleUrl(i,n)),this.$els.img.removeAttr("crossorigin").attr("src",i)}_openNextImage(t){if(!this._targetImage||!this._loaded)return;const e=this.$all;if(e&&e.length<=1)return;const i=this.currentIndex,s=e[i+t];s?(this._analytics.viewEnded(),this._nextPicAnimateDirection=t>0?"right-to-left":"left-to-right",this.setTarget(s),this._loadImage(),this.$els.currentPosition.text(`${this.currentIndex+1}/${e.length}`),this.$els.navArrowPrev.attr("hidden",i+t===0),this.$els.navArrowNext.attr("hidden",i+t===e.length-1)):this._loadImage()}_showHelp(){if(this._helpBalloon)return void this._helpBalloon.hide();let t=this._helpBalloon=new r._(this.$els.helpButton);t.content=_('<div class="image-viewer-help">\n\t<div><i class="fa fa-arrow-right"></i> следущее изображение</div>\n\t<div><i class="fa fa-arrow-left"></i> предыдущее изображение</div>\n\t<div><i>esc</i> закрыть просмотр</div>\n\t<div><i>tab</i> скрыть/показать кнопки</div>\n\t<div><i>ctrl</i> + <span>scroll</span> прокрутка вверх/вниз</div>\n\t<div><i class="fa fa-arrow-up"></i> слабая прокрутка вверх</div>\n\t<div><i class="fa fa-arrow-down"></i> слабая прокрутка вниз</div>\n\t<div><i>pgup</i> сильная прокрутка вверх</div>\n\t<div><i>pgdn</i> сильная прокрутка вниз</div>\n\t<div><i>0</i> оптимальный масштаб</div>\n</div>'),t.direction=r.Lh.LEFT,t.indent=!0;let e=s.default.ui.overlays.balloon.zIndex;s.default.ui.overlays.balloon.zIndex=9001,t.on("hide",(()=>{this._helpBalloon=null,s.default.ui.overlays.balloon.zIndex=e})),t.show()}_togglePanels(){this.$el.toggleClass("image-viewer_force-hide");let t=this.$el.hasClass("image-viewer_force-hide");this.$els.arrowUpButton.toggleClass("image-viewer__arrow_force-hide",t),this.$els.arrowDownButton.toggleClass("image-viewer__arrow_force-hide",t),this.$els.hotKeyInfo.toggleClass("image-viewer__hotkeys-info_force-hide",t),this.$els.zoomInButton.toggleClass("image-viewer__button_force-hide",t),this.$els.zoomOutButton.toggleClass("image-viewer__button_force-hide",t),this.$els.linkButton.toggleClass("image-viewer__button_force-hide",t),this.$els.closeButton.toggleClass("image-viewer__button_force-hide",t),this.$els.helpButton.toggleClass("image-viewer__button_force-hide",t),t&&this._helpBalloon&&this._helpBalloon.hide()}_setupViwer(){}_preparePage(){s.default.ui.isPageScrollable=!1}_restorePage(){s.default.ui.isPageScrollable=!0}hide(t,e=!1){var i,n,r,o;return null===(i=this._analytics)||void 0===i||i.viewEnded(),null===(n=this._analytics)||void 0===n||n.destroy(),null===(r=this._xmlHTTP)||void 0===r||r.abort(),null===(o=this.$els)||void 0===o||o.img.off("load"),this._useHistoryState&&!1!==e?(s.default.history.back(),this):(_(window).off("resize.imageView popstate.imageView"),_(document).off("keyup.imageView keydown.imageView"),this._restorePage(),this.$el?(this._helpBalloon&&(this._helpBalloon.hide(),this._helpBalloon=null),setTimeout((()=>{this.$els.img.remove(),this.$el.addClass("image-viewer_disabled").animate({opacity:0},g,(()=>{this.$el.remove(),this.$el=null}))}),10),this._closeMsgShowPercent>0&&this._setCloseMessagePosition(!0),this):this)}_listenImageEvents(){let t=0,e=0,i=0,s=0,n=0,r=0,l=this._targetImage.closest(".story[data-story-id]");l.length||(l=this._targetImage.closest(".comment"));let u=l.length>0?l.find('img[data-viewable="true"]'):[],h=this.$els.img[0].getBoundingClientRect().height,c=this.$el.height()-2*this._padding-this._topIndent,d=h>0&&c>0&&Math.floor(h)>Math.floor(c),p=new Map,m=0,_=!1,g=this._useSwipeForClose,v=()=>{let t,e,i,s,n=p.size,r=0,o=0,a=0;for(let[l,u]of p){t=u.clientX,e=u.clientY,r+=t,o+=e;for(let[n,r]of p)l!==n&&(i=r.clientX,s=r.clientY,a+=Math.sqrt((t-i)*(t-i)+(e-s)*(e-s)))}return 0===a&&(a=1),{x:r/n,y:o/n,s:a/n}};const f=t=>{if(t.changedTouches)for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];p.set(i.identifier,(0,o.RI)(i))}else p.set(t.pointerId||0,(0,o.RI)(t))},y=f;this.$els.img[0].addEventListener("mousedown",(i=>{if(1!==i.which)return;i.stopPropagation(),i.preventDefault(),t=void 0!==i.clientX?i.clientX:i.pageX,e=void 0!==i.clientY?i.clientY:i.pageY,s=this._transform.x,n=this._transform.y;let r=this.$els.img[0],o=r.offsetWidth*this._transform.scale,a=r.offsetHeight*this._transform.scale,l=this.$el.width()-2*this._padding,u=this.$el.height()-2*this._padding-this._topIndent,h=this._transform.x-o/2,c=this._transform.y-a/2,d=0,p=i=>{i.stopPropagation(),i.preventDefault();let r=(void 0!==i.clientX?i.clientX:i.pageX)-t,p=(void 0!==i.clientY?i.clientY:i.pageY)-e;d=Math.max(d,r<0?-r:r,p<0?-p:p),(h<0||h+o>l)&&(this._transform.x=s+r),(c<40||c+a>u)&&(this._transform.y=n+p),this._applyTransform()},m=t=>{t.stopPropagation(),t.preventDefault(),document.removeEventListener("mousemove",p,!0),document.removeEventListener("mouseup",m,!0),this._correctPosition(!0),d<2&&0===t.button&&this._closeByClick&&this.hide()};document.addEventListener("mousemove",p,!0),document.addEventListener("mouseup",m,!0)})),this.$els.img[0].addEventListener(o.Kg.POINTER_DOWN,(o=>{if("mouse"===o.pointerType)return;"pen"===o.pointerType&&0!==o.buttons&&this.$els.img[0].setPointerCapture(o.pointerId),o.preventDefault(),f(o);let l=v();_=p.size>1,t=l.x,e=l.y,i=l.s,s=this._transform.x,n=this._transform.y,r=this._transform.scale,this._currentGesture=a.NONE}),!1),this.$els.img[0].addEventListener(o.Kg.POINTER_MOVE,(o=>{if("mouse"===o.pointerType)return;if(o.preventDefault(),"pen"===o.pointerType&&0===o.buttons)return;let l,u,h,c,m,f;y(o),l=v(),u=l.x-t,h=l.y-e,c=l.s/i,(Math.abs(u)>10||Math.abs(h)>10)&&(_=!0),m=Math.min(this._maxScale,Math.max(this._minScale,r*c)),this._analytics.setRecScore(m),isFinite(m)&&(f=this._calculateZoomShift(m,r,s,n),m>this._initScale?(this._transform.x=f.x+u,this._transform.y=f.y+h):(Math.abs(u)>Math.abs(h)&&this._transform.y===n&&(this._transform.x=f.x+u,this._currentGesture=a.SWIPE_X),Math.abs(u)<Math.abs(h)&&this._transform.x===s&&(this._transform.y=f.y+h,this._currentGesture=a.SWIPE_Y,!d&&h<0&&this.$el.css("backgroundColor",`rgba(0,0,0,${.7-.0015*Math.abs(h)})`))),p.size>1&&(this._currentGesture=a.ZOOM),this._transform.scale=m,this._applyTransform(),g&&this._setCloseMessagePosition())}),!1);const b=o=>{if("mouse"===o.pointerType)return;if("pen"===o.pointerType&&this.$els.img[0].releasePointerCapture(o.pointerId),o.preventDefault(),(t=>{let e;if(t.changedTouches)for(let i=0;i<t.changedTouches.length;i++){const s=t.changedTouches[i];e=p.get(s.identifier),p.delete(s.identifier)}else e=p.get(t.pointerId||0),p.delete(t.pointerId||0)})(o),p.size>0){const o=v();t=o.x,e=o.y,i=o.s,s=this._transform.x,n=this._transform.y,r=this._transform.scale,_=!0}else{const i=o;if(this._closeMsgShowPercent>.95)return void this.hide();if(this._closeMsgShowPercent>0&&this._setCloseMessagePosition(!0),this._transform.scale<=this._initScale){if(u.length>1&&this._currentGesture===a.SWIPE_X){if(i.clientX-t>70)return void this._openNextImage(-1);if(i.clientX-t<-70)return void this._openNextImage(1)}if(i.clientY-e<=-70&&!d&&this._currentGesture===a.SWIPE_Y)return void this.hide()}if(this._correctPosition(!0),_)_=!1;else{let t=Date.now();t-m<500?(m=0,this._transform.scale>=1.45?this._reduceImage():this._increaseImage()):m=t}this._currentGesture=a.NONE}};o.Kg.POINTER_UP.forEach((t=>{this.$els.img[0].addEventListener(t,b,!1)}))}_reduceImage(){Date.now()-(this.timeIncreaseImage||0)<50||(this.timeReduceImage=Date.now(),this._setImageStartupProps(),this._animateImgProps("cubic",10))}_increaseImage(){Date.now()-(this.timeReduceImage||0)<50||(this.timeIncreaseImage=Date.now(),this._transform.scale=1.5,this._correctPosition(!0))}_scrollUp(t){this._transform.y+=this.$el.height()/("number"==typeof t?t:2),this._correctPosition(!0)}_scrollDelta(t){this._transform.y+=t,this._correctPosition(!0)}_scrollDown(t){this._transform.y-=this.$el.height()/("number"==typeof t?t:2),this._correctPosition(!0)}_loadBigImage(){if(this._bigImage||!this._imageLargeURL)return;if(this.$els.img[0].naturalWidth<400&&!this._imageLargeURL.endsWith("gif")&&!this._imageLargeURL.includes("pikabu15"))return;const t=this._imageLargeURL;if("string"!=typeof t)return;this.$els.loader.addClass("image-viewer-loader_show"),this._bigImage=new Image,this._bigImage.onload=()=>this._onLoadBigImage(),this._bigImage.onerror=()=>this._onErrorBigImage(),this.completedPercentage=0,this.prevLoadedValue=0,this._xmlHTTP=new XMLHttpRequest,this._xmlHTTP.open("GET",t,!0),this._xmlHTTP.responseType="arraybuffer";const e=async(e=!0)=>{e&&(this._bigImage.crossOrigin=!0);const i=this._targetImage.data("scramblerOffset");this._bigImage.src=i?await p.N.descramble(new Uint8Array(this._xmlHTTP.response),i):t};this._xmlHTTP.onload=()=>{s.default.logger.log("upload","success load"),e()},this._xmlHTTP.onprogress=t=>{var e;(t.lengthComputable&&(this.completedPercentage=t.loaded/t.total),this.completedPercentage!==this.prevLoadedValue)&&(this.prevLoadedValue=this.completedPercentage,null===(e=this.$els)||void 0===e||e.loaderDisk.attr("d",v._describeArc(14,14,14,0,360*this.completedPercentage)))},this._xmlHTTP.onerror=()=>{this.$els.loader.removeClass("image-viewer-loader_show"),s.default.logger.log("upload","errror onload"),e(!1)},this._xmlHTTP.onloadstart=()=>{var t;this.completedPercentage=0,null===(t=this.$els)||void 0===t||t.loaderDisk.attr("d",v._describeArc(14,14,14,0,1))},this._xmlHTTP.onloadend=()=>{var t;this.completedPercentage=1,null===(t=this.$els)||void 0===t||t.loaderDisk.attr("d",v._describeArc(14,14,14,0,360))},this._xmlHTTP.send()}async _onLoadBigImage(){var t;let e=0;if(!this._bigImage||null===(t=this.$els)||void 0===t||!t.img[0])return;this.$els.img[0].complete||await new Promise((t=>{this.$els.img[0].addEventListener("load",(()=>{t()}))})),s.default.logger.log("upload","start onLoad",this._bigImage);let i=setInterval((()=>{if(s.default.logger.log("upload",this._bigImage.complete,this._bigImage.naturalWidth),!this._bigImage.complete||0===this._bigImage.naturalWidth)return++e>10&&(clearInterval(i),s.default.logger.log("upload","max try",e),s.default.logger.log("upload","hide loader"),this.$els.loader.removeClass("image-viewer-loader_show")),void s.default.logger.log("upload","try",e);s.default.logger.log("upload","src img loaded in try:",e,this._bigImage),clearInterval(i),this._imageURL=this._imageLargeURL;let t=this.$els.img[0].naturalWidth/this._bigImage.naturalWidth;const n=this.$els.img.clone().prependTo(this.$el).css({boxShadow:"none"});this.$els.img.replaceWith(this._bigImage),this.$els.img=_(this._bigImage),this._prepareImage(!0),this._transform.scale*=t,this._transformSaved.scale*=t,this._transformApplied.scale*=t,this._initScale=this._transformApplied.scale,this._updateImgProps(),this._listenImageEvents(),this.$els.loader.removeClass("image-viewer-loader_show"),new MutationObserver(((t,e)=>{n.remove(),e.disconnect()})).observe(this._bigImage,{attributes:!0})}),0)}_onErrorBigImage(){this.$els.loader.removeClass("image-viewer-loader_show")}_correctPosition(t){let e=this._transform,i=this.$els.img[0],s=i.offsetWidth*e.scale,n=i.offsetHeight*e.scale,r=this.$el.width(),o=this.$el.height();if(s<r?e.x=r/2:e.x-s/2>0?e.x=s/2:e.x+s/2<r&&(e.x=r-s/2),n<o)e.y=this._topIndent+this._padding+(o-2*this._padding-this._topIndent)/2,this.$els.arrowDownButton.removeClass("image-viewer__arrow_show"),this.$els.arrowUpButton.removeClass("image-viewer__arrow_show"),this.$els.hotKeyInfo.removeClass("image-viewer__hotkeys-info_show");else{e.y-n/2>this._padding+this._topIndent?e.y=this._padding+this._topIndent+n/2:e.y+n/2<o-this._padding&&(e.y=o-n/2-this._padding);let t=e.y-n/2<this._padding+this._topIndent,i=e.y+n/2>o-this._padding;this.$els.arrowUpButton.toggleClass("image-viewer__arrow_show",t),this.$els.arrowDownButton.toggleClass("image-viewer__arrow_show",i),this.$els.hotKeyInfo.toggleClass("image-viewer__hotkeys-info_show",i||t)}t&&this._animateImgProps("cubic",5)}_setCloseMessagePosition(t=!1){if(t)return this.$els.closeMsg.css({bottom:"",opacity:""}),void(this._closeMsgShowPercent=0);let e,i=this._transform,s=this.$els.img[0].height*i.scale,n=this.$el.height();if(s<n?e=this._topIndent+this._padding+(n-2*this._padding-this._topIndent)/2:i.y-s/2>this._padding+this._topIndent?e=this._padding+this._topIndent+s/2:i.y+s/2<n-this._padding&&(e=n-s/2-this._padding),i.y<e){let t=Math.min(60,Math.max(0,(e-i.y)/3));this._closeMsgShowPercent=t/60,this.$els.closeMsg.css({bottom:2*t-60+"px",opacity:Math.max(.1,2*(this._closeMsgShowPercent-.5))})}else this._closeMsgShowPercent>0&&(this.$els.closeMsg.css({bottom:"",opacity:""}),this._closeMsgShowPercent=0)}_zoom(t){const e=this._transform,i=Math.min(this._maxScale,Math.max(this._minScale,this._transform.scale+(t>0?.24:-.24))),s=this._calculateZoomShift(i,e.scale,e.x,e.y);this._transform.scale=i,this._transform.x=s.x,this._transform.y=s.y,this._correctPosition(!0)}_zoomByWheel(t){if(t.preventDefault(),t.type!==this._mouseScrollEvent){if(""!==this._mouseScrollEvent)return;this._mouseScrollEvent=t.type}let e=t.wheelDelta||t.deltaY||-t.detail;if(t.shiftKey||t.metaKey)return void this._scrollDelta(e);let i=this._transform,s=Math.min(this._maxScale,Math.max(this._minScale,this._transform.scale+(e>0?.12:-.12))),n=this._calculateZoomShift(s,i.scale,i.x,i.y);this._analytics.setRecScore(s),this._transform.scale=s,this._transform.x=n.x,this._transform.y=n.y,this._correctPosition(),this._applyTransform()}_calculateZoomShift(t,e,i,s){let n=this.$els.img[0].offsetWidth,r=this.$el.width()/2,o=this.$el.height()/2;return{x:r-(r-(i-n*e/2))/e*t+n*t/2,y:o-(o-(s-n*e/2))/e*t+n*t/2}}_prepareImage(t){let e=this.$els.img[0],i=e.style,s=e.naturalWidth,n=e.naturalHeight,r=this.$el.width(),o=this.$el.height();("visible"!==i.visibility||t)&&this.$els&&(i.left=String(-s/2)+"px",i.top=String(-n/2)+"px",this._minScale=Math.min(1/(s/(.3*r)),1/(n/(.6*o))),t||(this._setImageStartupProps(),s>1e3||n>800||this._skipImageStartupAnim?""!==this._nextPicAnimateDirection?("left-to-right"===this._nextPicAnimateDirection?this._transformApplied.x=this._transform.x-300:"right-to-left"===this._nextPicAnimateDirection&&(this._transformApplied.x=this._transform.x+300),this._transformApplied.scale=this._transform.scale,this._animateImgProps("cubic",5)):this._applyTransform():(this._transformApplied.x=this._transform.x,this._transformApplied.y=this._transform.y,this._transformApplied.scale=.1,this._animateImgProps("cubic",5))),i.visibility="visible",t||(this._analytics.imageViewStarted(),this._loadBigImage()))}_setImageStartupProps(){let t=this.$els.img[0],e=this.$el,i=t.offsetWidth,s=t.offsetHeight,n=e.width()-2*this._padding,r=e.height()-2*this._padding-this._topIndent,o=Math.min(2,n/i,r/s);o<.4&&s>.5*r&&i*o<.5*n&&(o=Math.min(800,.8*n)/i),this._transform.scale=Math.max(o,this._minScale),this._transform.x=this._padding+n/2,this._transform.y=this._topIndent+this._padding+r/2,this._initScale=this._transform.scale,this._transform.y-s*o/2<this._padding&&(this._transform.y=s*o/2+this._padding+this._topIndent),s*this._transform.scale<e.height()?(this.$els.arrowDownButton.removeClass("image-viewer__arrow_show"),this.$els.arrowUpButton.removeClass("image-viewer__arrow_show"),this.$els.hotKeyInfo.removeClass("image-viewer__hotkeys-info_show")):(this.$els.arrowUpButton.removeClass("image-viewer__arrow_show"),this.$els.arrowDownButton.addClass("image-viewer__arrow_show"),this.$els.hotKeyInfo.addClass("image-viewer__hotkeys-info_show"))}_isStartupProps(){let t=this.$els.img[0],e=this.$el,i=t.offsetWidth,s=t.offsetHeight,n=e.width()-2*this._padding,r=e.height()-2*this._padding-this._topIndent,o=Math.min(2,n/i,r/s);o<.9&&s>.5*r&&i*o<.5*n&&(o=Math.min(800,.8*n)/i);let a={scale:Math.max(o,this._minScale),x:this._padding+n/2,y:this._topIndent+this._padding+r/2};return a.y-s*o/2<this._padding&&(a.y=s*o/2+this._padding+this._topIndent),(0,d.isEqual)(a,this._transform)}_setImageNaturalProps(){this._transform.scale=1;let t=this._calculateZoomShift(1,this._transform.scale,this._transform.x,this._transform.y);t.scale=1,this._transform=t,this._correctPosition()}_applyTransform(){this._animProps.timer&&clearTimeout(this._animProps.timer),this._transformApplied.x=this._transform.x,this._transformApplied.y=this._transform.y,this._transformApplied.scale=this._transform.scale,this._updateImgProps()}_animateImgProps(t,e){let i=this._animProps;i.timer&&clearTimeout(i.timer),this._transformSaved.x=this._transformApplied.x,this._transformSaved.y=this._transformApplied.y,this._transformSaved.scale=this._transformApplied.scale,this.$el.css("backgroundColor",""),i.curr=0,i.dur=e||20,i.method=t||"cubic",this._makeAnimationStep()}_makeAnimationStep(){let t=this._animProps;if(++t.curr<=t.dur){let e=v._easing(t.method,t.curr,0,1,t.dur),i=this._transformSaved,s=this._transform;this._transformApplied.x=i.x+(s.x-i.x)*e,this._transformApplied.y=i.y+(s.y-i.y)*e,this._transformApplied.scale=i.scale+(s.scale-i.scale)*e,this._updateImgProps(),t.timer=setTimeout(this._makeAnimationStepBound,41)}}_updateImgProps(){let t,e,i=this.$els.img[0].style,s=this._transformApplied;if(t="translate3d("+s.x+"px, "+s.y+"px, 0px) scale3d("+s.scale+", "+s.scale+", 1)",i.transform=t,i.MozTransform=t,i.webkitTransform=t,this.$els.imgBg.length>0){let e=this.$els.img[0],n=e.offsetWidth*s.scale,r=e.offsetHeight*s.scale;t="translate3d("+(s.x-n/2-10)+"px, "+(s.y-r/2-10)+"px, 0px)",i=this.$els.imgBg[0].style,i.width=String(n+20)+"px",i.height=String(r+20)+"px",i.transform=t,i.MozTransform=t,i.webkitTransform=t,this.$els.currentPosition.length>0&&this.$els.currentPosition.css("transform","translate3d(-"+this.$els.currentPosition.innerWidth()/2+"px, "+(r/2+15)+"px, 0px)")}e=Math.round(100*s.scale)+"%",this._prevScaleText!==e&&(this._prevScaleText=e)}static _easing(t,e,i,s,n){let r=2*Math.PI,o=i>s,a=i;switch(o?(a=s,s=i-s,i=a):s-=i,t){default:case"linear":a=s*e/n+i;break;case"cubic":a=o?s*(e/=n)*e*e+i:s*((e=e/n-1)*e*e+1)+i;break;case"exponential":a=0===e?i:s*Math.pow(2,10*(e/n-1))+i-.001*s,e===n&&(a=s+i);break;case"bounce":a=(e/=n)<1/2.75?s*(7.5625*e*e)+i:e<2/2.75?s*(7.5625*(e-=1.5/2.75)*e+.75)+i:e<2.5/2.75?s*(7.5625*(e-=2.25/2.75)*e+.9375)+i:s*(7.5625*(e-=2.625/2.75)*e+.984375)+i;break;case"elastic":if(0===e)a=i;else if(1==(e/=n))a=i+s;else{let t=.3*n,o=t/4;a=s*Math.pow(2,-10*e)*Math.sin((e*n-o)*r/t)+s+i}}return o&&(a=i+(s+i-a)),a}static _polarToCartesian(t,e,i,s){let n=(s-90)*Math.PI/180;return{x:t+i*Math.cos(n),y:e+i*Math.sin(n)}}static _describeArc(t,e,i,s,n){let r=v._polarToCartesian(t,e,i,n),o=v._polarToCartesian(t,e,i,s),a=n-s<=180?"0":"1";return["M",r.x,r.y,"A",i,i,0,a,0,o.x,o.y,"L",t,e,"L",r.x,r.y].join(" ")}get $all(){if(this._images)return _(this._images);let t=this._targetImage.closest(".carousel_images"),e=this._targetImage.closest(".comment");return t.length>0?t.find('img[data-viewable="true"]'):e.length>0?e.find('> .comment__body img[data-viewable="true"]'):[]}get currentIndex(){let t=this.$all,e=this._targetImage[0];for(let i=0,s=t.length;i<s;i++)if(t[i]===e)return i;return 0}}},49222:(t,e,i)=>{i.d(e,{b:()=>l});i(41817);var s=i(43241),n=i(58330),r=i(51540),o=i(56927);function a(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class l extends s.u{constructor(t){var e,i;super(t),a(this,"processedLazyLoadSlide",0);const s=n.S.getInstance().get("UICarousel");this.carousel=new s({el:this.el,scrollBlocks:1});const o=null===(e=this.el)||void 0===e?void 0:e.nextElementSibling;this.els={curSlideLabel:null===(i=this.el)||void 0===i?void 0:i.querySelector(".carousel__cur-slide"),bullets:null!=o&&o.classList.contains("carousel-bullets")?o:void 0},this.carousel.els.content.addEventListener("scroll",(0,r.P)(this.handleScroll.bind(this),100)),this.setBullets(0)}destroy(){this.carousel.destroy()}handleScroll(){const{scrollLeft:t,clientWidth:e}=this.carousel.els.content,i=this.carousel.els.items.length,s=t+e/2,n=Math.floor(s/e)+1;if(this.els.curSlideLabel.innerText=`${n}/${i}`,this.setBullets(n-1),n>this.processedLazyLoadSlide){const t=this.carousel.els.items[n];t&&t.classList.contains("image-lazy")&&o.z.prepareImage(t),this.processedLazyLoadSlide=n}}setBullets(t){var e,i;if(!this.els.bullets)return;const s=this.els.bullets.childElementCount;if(null===(e=this.els.bullets.querySelector(".carousel-bullets__bullet_active"))||void 0===e||e.classList.remove("carousel-bullets__bullet_active"),null===(i=this.els.bullets.children.item(t))||void 0===i||i.classList.add("carousel-bullets__bullet_active"),s<=7)return void this.els.bullets.classList.add("carousel-bullets_fixed");let n=parseInt(this.els.bullets.dataset.start||"0");0===t?n=0:t===s-1?n=s-7:t<n+1?n=t-1:t>n+7-2&&(n=t-7+2),this.els.bullets.dataset.start=String(n);for(let r=0;r<this.els.bullets.children.length;r++){this.els.bullets.children.item(r).classList.toggle("carousel-bullets__bullet_edge",r===n&&0!==r||r===n+7-1&&r!==s-1)}this.els.bullets.scrollTo({top:0,left:14*n,behavior:"smooth"})}}},26882:(t,e,i)=>{i.d(e,{b:()=>s.b});var s=i(49222)},72044:(t,e,i)=>{i.d(e,{SE:()=>n.SE,Lh:()=>n.Lh,xb:()=>n.xb,Zv:()=>s.C,gR:()=>n.gR,LD:()=>n.LD});var s=i(89803),n=(i(11315),i(88358));i(29069),i(71556)},39868:(t,e,i)=>{let s;i.d(e,{m:()=>s}),function(t){t.HOT="isHotFeedClosed",t.BEST="isBestFeedClosed",t.NEW="isUpcomingFeedClosed",t.EXPERTS="isExpertsFeedClosed"}(s||(s={}))},5673:(t,e,i)=>{i.d(e,{h:()=>l});i(41817);var s=i(63907),n=i(39868),r=i(82580),o=i(75130);function a(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class l extends s.u1{constructor(t){super(t),a(this,"_close",(()=>{this._clientProps.set(this._getClientPropKey(),!0),this.destroy()})),this._clientProps=new o.U,this.render()}render(){return this.isRendered||(super.render(),this.$els={closeButton:this.$(".info-banner__close-button").on("click",this._close),actionButton:this.$(".info-banner__action-button").on("click",this._close)}),this}_getClientPropKey(){return{[r.DV.HOT]:n.m.HOT,[r.DV.BEST]:n.m.BEST,[r.DV.NEW]:n.m.NEW,[r.DV.EXPERTS]:n.m.EXPERTS}[this._options.feedType]}}},35856:(t,e,i)=>{i.d(e,{o:()=>l});i(88674);var s=i(43241),n=i(58330),r=i(16819),o=i(55474),a=i(88358);class l extends s.u{constructor(t){super(),this._options=t,this.value="",this.input=void 0,this.render()}render(){return this.isRendered?this:(this.init(),super.render())}async init(){var t,e;const i=n.S.getInstance().get("UIInput"),s=null===(t=this._options.el)||void 0===t?void 0:t.querySelector(".input__input");if(!s)return;const l=new r.v,u=await l.createMask(s,{mask:Date,min:new Date(this._options.minDate),max:new Date,lazy:!1,overwrite:!0});this.input=new i({el:this._options.el,addClearButton:!1,validationEvent:o.km.BLUR,validationHint:{direction:a.Lh.LEFT,alignment:a.SE.CENTER},validationRules:{"validation-rules.format":()=>!u.masked.rawInputValue||Boolean(u.typedValue)}}),this.input.mask=u,this.value=null===(e=this.input)||void 0===e?void 0:e.value,s.classList.toggle("input_empty",!u.masked.rawInputValue),this.listenTo(this.input,"change",(()=>{var t;this.value=null===(t=this.input)||void 0===t?void 0:t.value})),this.listenTo(this.input,"blur",(()=>{var t,e;null===(t=(e=this._options).blurCallback)||void 0===t||t.call(e)})),u.on("accept",(()=>{s.classList.toggle("input_empty",!u.masked.rawInputValue),this._options.acceptCallback&&this._options.acceptCallback()}))}}},63371:(t,e,i)=>{i.d(e,{d:()=>n,k:()=>r});var s=i(65448);let n={FOCUS:"focus",ERROR:"error",SUCCESS:"success"};const r=new s.xs({MANUAL:0,BLUR:1,KEYUP:2});n=new s.xs(n)},55474:(t,e,i)=>{i.d(e,{dD:()=>s.d,km:()=>s.k,u3:()=>c,a:()=>d.a});var s=i(63371),n=(i(88674),i(66992),i(33948),i(24603),i(74916),i(15306),i(12953)),r=i(63907),o=i(11315),a=i(88358),l=i(36005),u=i(19755),h=i.n(u);class c extends r.u1{destroy(){this._destroyValidationHint(),this.stopListening(),this.off(),this.$els.input.off(),super.destroy()}addState(t){return this.$el.addClass(`input_${t.valueOf()}`),this}hasState(t){return this.$el.hasClass(`input_${t.valueOf()}`)}removeState(t){return this.$el.removeClass(`input_${t.valueOf()}`),this}onClick(){this.focus()}onChange(t){return this.toggleClearButton(),this.emit("change",this.value,t),this}onPaste(t){return t&&setTimeout((()=>this.emit("paste",this.value,t)),10),this}onCut(t){return t&&setTimeout((()=>this.emit("cut",this.value,t)),10),this}onFocus(t){return this.emit("focus",t),this.cancelTimeout("onBlur","suggestionHide"),this.validationHint&&this._validationHint&&this._validationHint.hide(),this._hideValidationErrorElement(),this.removeState(s.d.ERROR),this.addState(s.d.FOCUS),this}highlightFocus(){return this.$el.addClass("input_highlight"),this.$els.input.focus(),this.timeout("focus",300,(()=>{this.focus()})),this.timeout("highlight",600,(()=>{this.focus(),this.$el.removeClass("input_highlight")})),this}focus(){return this.isFocused||this.$els.input.focus(),this}blur(){return this.$els.input.blur(),this}async checkValidity(t){const{inputValue:e,inputRules:i,scrollToElement:s=!1,changeValidityState:n=!0,showValidationHint:r=!0,returnErrorType:o=!1}=null!=t?t:{},a=(0,l.isString)(e)?e:this.value,u=(0,l.isString)(e)?e:this.textContent;let h,c,d=!0;const p=i||this.validationRules;for(const[m,_]of p){if(!d)break;let t=_;c=void 0,(0,l.isObject)(t)&&t.analyticsType&&(c=t.analyticsType,t=t.validationFunction),t=(0,l.isArray)(t)?t:[t];for(const e of t)if((0,l.isFunction)(e)){if(!(await e(a,u))){h=m,d=!1;break}}}return!(!(0,l.isString)(e)&&this.value!==a)&&(n&&!d&&s&&await this.scrollIfNotVisible(),this.setCustomValidity(h||!d&&"Ошибка ввода",n,r),o?{isValid:d,analyticsType:c}:d)}async scrollIfNotVisible(){n.default.ui.elementInViewport(this.$el)||await n.default.ui.scrollTo(this.$el.offset().top-20,!0)}toggleClearButton(t){return this.addClearButton?(t=(0,l.isBoolean)(t)?t:(this.$els.input.text()||this.$els.input.val()).length>0,this._createClearButton().toggleClass("input__clear_visible",t),this):this}preventInvalidInput(t){if(!t)return;this.$els.input.on("input",(()=>{for(const[e,i]of Object.entries(t)){if(!(i instanceof RegExp))continue;const t=this.$els.input.val();!i.test(t)?this.setCustomValidity():(this.value=t.replace(i,""),this.setCustomValidity(e))}}))}_createValidationHint(t=!0){if(this._validationHint)return this._validationHint;const e=(0,l.extend)({direction:a.Lh.TOP,alignment:a.SE.START,theme:a.xb.DANGER,target:this.$el,autoCloseOutsideClick:!0,hideByScroll:t});return this.$els&&this.$els.error&&(e.content=this.$els.error),this._validationHint=new a._(e),this._validationHint}_createDisabledHint(){if(this._disabledHint)return this._disabledHint;const t=(0,l.extend)({direction:a.Lh.TOP,alignment:a.SE.START,theme:a.xb.DANGER,destroyAfterHide:!1,target:this.$el});return this.$els&&this.$els.error&&(t.content=this.$els.error),this._disabledHint=new a.gR(t),this.disabledMessage&&this._disabledHint.content.html(this.disabledMessage),this._disabledHint.content.addClass("popup__content_hint"),this._disabledHint}_destroyValidationHint(){return this._validationHint?(this._validationHint.destroy(),this._validationHint=void 0,this):this}_createWrapper(){return(this.$el.is("input")||this.$el.is("textarea")||this.$el.attr("contentEditable"))&&(this.$els.input=this.$el,this.$el=h()(document.createElement("div")).addClass("input input_box").insertBefore(this.$el)),this.els.input=this.$els.input.get(0),this.$els.box.length||(this.$els.box=h()(document.createElement("div")).addClass("input__box").appendTo(this.$el),this.$els.input.appendTo(this.$els.box)),this.$els.input.data("disabled-message")&&(this.disabledMessage=this.$els.input.data("disabled-message")),this.disabled=this.$els.input.prop("disabled"),this.transferValidationRules(this.$els.input),this}_createProgress(){return this.$els.progress||(this.$els.progress=h()(document.createElement("div")).addClass("input__progress").appendTo(this.$els.box),this._progress=new o.j({strokeWidth:20}),this._progress.appendTo(this.$els.progress)),this.$els.progress}sanitize(t){t=String(t);for(const e of this.sanitizerRules)t=e(t);return t}_showValidationErrorElement(){this._isValidationElementShown||(this._isValidationElementRendered?this.els.validationErrorElement.removeAttribute("hidden"):this.el.after(this.els.validationErrorElement),this._isValidationElementRendered=!0,this._isValidationElementShown=!0)}_hideValidationErrorElement(){this._isValidationElementShown&&this._isValidationElementRendered&&(this.els.validationErrorElement.setAttribute("hidden","true"),this._isValidationElementShown=!1)}setCustomValidity(t,e=!0,i=!0){const r=!t;if(this.validationMessage=t,this._options.valid=r,!e||!n.default.ui.elementInViewport(this.$el))return this;if(r)this.removeState(s.d.ERROR),this.addSuccessState&&this.addState(s.d.SUCCESS),this.validationHint&&this._validationHint.isShown&&this._validationHint.hide(),this._hideValidationErrorElement();else{if(this.validationHint&&i){if((0,l.isFunction)(this._options.onValidityErrorMessage))try{this._options.onValidityErrorMessage(t,this.$els)}catch(o){}this.$els.error.text()!==n.default.i18n(t)&&this.$els.error.text(n.default.i18n(t)),this._validationHint.show()}if((0,l.isFunction)(this._options.onValidityErrorMessage))try{this._options.onValidityErrorMessage(t,this.$els)}catch(o){}this.els.validationErrorElement.innerText!==n.default.i18n(t)&&(this.els.validationErrorElement.innerText=n.default.i18n(t)),this._showValidationErrorElement(),this.removeState(s.d.SUCCESS),this.addState(s.d.ERROR)}return this}get isEmpty(){return!this.value.length}get isFocused(){return this.$els.input.is(":focus")}get progress(){return this._options.progress}set progress(t){t=Boolean(t),this._options.progress!==t&&(this._createProgress(),this.$els.progress.toggleClass("input__progress_visible",t),t?this._progress.indeterminate=!0:setTimeout((()=>{this._progress.stop()}),200),this._options.progress=t)}get validationMessage(){return this._options.validationMessage}set validationMessage(t){this._options.validationMessage=String(t)}get valid(){return this._options.valid}get validationEvent(){return this._options.validationEvent||s.k.MANUAL}set validationEvent(t){this._options.validationEvent=s.k[t]||s.k.KEYUP}get disabledMessage(){return this._options.disabledMessage}set disabledMessage(t){this._options.disabledMessage!==t&&(this._options.disabledMessage=t,this._disabledHint&&t&&this._disabledHint.content.html(t))}get validationHint(){return this._options.validationHint}set validationHint(t){(0,l.isObject)(t)||(t=!(!(0,l.isBoolean)(t)||!t)&&{}),t!==this.validationHint?(this._options.validationHint=t,this.isRendered&&(t?this._createValidationHint().setOptions(this._options.validationHint):this._destroyValidationHint())):this._options.validationHint}get sanitizerRules(){return this._options.sanitizerRules||(this._options.sanitizerRules=new Set),this._options.sanitizerRules}set sanitizerRules(t){if((0,l.isArray)(t)&&(t=new Set(t)),t instanceof Set)for(const e of t)this.sanitizerRules.add(e);else t=new Set;this._options.sanitizerRules=t}get validationRules(){return this._options.validationRules?this._options.validationRules:this._options.validationRules=new Map}set validationRules(t){if(!(0,l.isObject)(t)&&(0,l.isArray)(t)||(t=new Map(Object.entries(t))),t instanceof Map){for(const e of t)this.validationRules.set(...e);this.validationRules}else t=new Map,this._options.validationRules=t}get textContent(){return this.$els?this.$els.input.text():""}get value(){let t=this.$els.input.val();for(const e of this.sanitizerRules)t=e(t);return t}set value(t){this.$els&&this.$els.input&&(this.$els.input.val(t),this.onChange(),this.onKeyUp())}get addClearButton(){return this._options.addClearButton}set addClearButton(t){this._options.addClearButton=Boolean(t)}get addSuccessState(){return this._options.addSuccessState}set addSuccessState(t){this._options.addSuccessState=Boolean(t)}get focused(){return this.hasState(s.d.FOCUS)}get disabled(){return this._options.disabled}set disabled(t){this._options.disabled!==(t=Boolean(t))&&(this._options.disabled=t,this.isRendered&&(this.$els.input.prop("disabled",t),this.disabledMessage&&!this._disabledHint&&this._createDisabledHint()))}}var d=i(6508)},6508:(t,e,i)=>{i.d(e,{a:()=>f});i(66992),i(33948),i(88674),i(74916),i(15306),i(24603),i(41817);var s=i(43241),n=i(58330),r=i(44292),o=i(16819),a=i(55474),l=i(88358),u=i(96637),h=i(72346);function c(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const d="000000000000000",p=[{mask:d,overwrite:!0},{mask:"+"+d,overwrite:!0}],m="7",_="+7",g="8",v=[_,g,m];class f extends s.u{constructor(...t){super(...t),c(this,"mask",null)}async init(){if(!this._options.el||this.isShown)return this;const t=n.S.getInstance().get("UIInput");return this.input=new t({el:this._options.el.closest(".input"),validationEvent:a.km.MANUAL,validationHint:{direction:l.Lh.RIGHT,alignment:l.SE.CENTER},validationRules:{"auth.up.errors.phone":t=>{var e;return r.E0.test((null===(e=this.mask)||void 0===e?void 0:e.unmaskedValue)||t)}}}),this.listenTo(this.input,"paste",(t=>{v.some((e=>t.startsWith(e)))&&(this.convertMaskValueToRusWithCountryCode(t),this.mask||this.initRusPhoneMask())})),this.listenTo(this.input,"input",(t=>{!this.mask&&v.some((e=>t===e))&&this.initRusPhoneMask()})),this.listenTo(this.input,"focus",(()=>{var t;const e=null===(t=this.mask)||void 0===t?void 0:t.unmaskedValue;e&&1!==e.toString().length||setTimeout((()=>{var t;null===(t=this.mask)||void 0===t||t.updateCursor(3)}),100)})),this.listenTo(this.input,"clear",(async()=>{var t;null===(t=this.mask)||void 0===t||t.updateValue(),this.destroyMask(),await this.initPhoneMask(),this.maskValue=""})),this.inputMask=new o.v,await this.inputMask.init(),super.show()}async initRusMaskAndFocus(){await this.init(),await this.initRusPhoneMask(),this.setInitialRusMaskValue()}initPhoneMask(){return this.initMask(!1,(()=>{this.mask&&this.doesValueStartWithRusDigit()&&(this.destroyMask(),this.initRusPhoneMask().then((t=>(this.convertMaskValueToRusWithCountryCode((null==t?void 0:t.unmaskedValue)||""),null==t||t.alignCursor(),!0))).catch((t=>console.error(t))))}))}initRusPhoneMask(){return this.initMask(!0,(()=>{if(!this.mask)return;if(this.mask.unmaskedValue&&this.doesValueStartWithRusDigit())return;if(this.mask.unmaskedValue===g)return void this.setInitialRusMaskValue();const t=this.mask.unmaskedValue;this.destroyMask(),this.input.value="",this.initPhoneMask().then((()=>(this.maskValue=t,!0))).catch((t=>console.error(t)))}))}setInitialRusMaskValue(){this.maskValue=m}doesValueStartWithRusDigit(){if(!this.mask)return!1;const t=this.mask.value,e=this.mask.unmaskedValue;return t.startsWith(_)||t.startsWith(m)||!t.startsWith("+")&&e.startsWith(g)}convertMaskValueToRusWithCountryCode(t){this.maskValue=t.replace(new RegExp("^8"),_)}async initMask(t,e){if(!this._options.el)return null;var i;(this.mask=t?await this.inputMask.createMask(this._options.el,{lazy:!1,mask:"+0(000)000-00-00",overwrite:!0}):await this.inputMask.createMask(this._options.el,{lazy:!1,mask:p}),t)&&(null===(i=this.mask)||void 0===i||i.updateCursor(3));return this.mask.on("accept",e),this.mask}destroyMask(){this.mask&&(this.mask.off("accept"),this.mask.destroy(),this.mask=null)}set maskValue(t){this.mask&&(this.mask.value=t)}get value(){var t;const e=u.Utils.preparePhone((null===(t=this.mask)||void 0===t?void 0:t.unmaskedValue)||this.input.value);return h.o.whitelist("0-9\\+")(e)}}},43148:(t,e,i)=>{i.d(e,{J:()=>u});var s=i(12953),n=i(72044),r=i(63907),o=i(11315),a=i(36005);const l=i(19755);class u extends r.u1{constructor(t){n.Zv.isJQuery(t)||(s.core.logger.log("ui-menu","no element passed, component will be rendered as null-object"),t=l(document.createElement("div"))),super(t),this.render()}render(){return this.isRendered||(this.$els={items:this.$(".menu__item"),spinner:l(document.createElement("div")).addClass("menu__spinner").appendTo(this.$el).hide()},this._spinner=new o.j({parent:this.$el}),this._spinner.appendTo(this.$els.spinner)),this}setLoading(t){this.$els.spinner.toggle(Boolean(t)),this.$els.items.toggleClass("menu__item_loading",t)}updateMenuItemById(t){let{id:e,diff:i={}}=t,n=this.$els.items.filter(`[data-id=${e}]`);if(!n.length)return void s.core.logger.warn("menu",`can't find menu item by id "${e}"`);let{disabled:r}=i;(0,a.isUndefined)(r)||n.toggleClass("menu__item_disabled",r)}updateMultipleMenuItemsById(t=[]){t.forEach((t=>this.updateMenuItemById(t)))}}},4081:(t,e,i)=>{i.d(e,{u:()=>_});i(41817);var s=i(53056),n=i(87864);var r=i(58330),o=i(43241),a=i(12953);class l extends o.u{constructor(t){super(t);const{questions:e,showAgeSurvey:i}=t;var s,r,o,l;(this.el=(0,n.m)((s={questions:e,ageSurvey:i,isUserAuthorized:a.core.isUserAuthorized},o="",Array.prototype.join,o+='\n\n<div class="section nps-survey">\n    <div class="nps-survey__survey">\n        <div class="nps-survey__questions">\n            <h3>Расскажите о своём опыте с Пикабу</h3>\n    \n            ',s.questions.forEach(((t,e)=>{o+='\n                <div class="nps-survey__question" data-index="'+(null==(r=e)?"":r)+'">\n                    <div>'+(null==(r=t)?"":r)+'</div>\n    \n                    <div class="nps-survey__score">\n                        ';for(let i=0;i<5;i++)o+='\n                            <div class="nps-survey__star">\n                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__star_24"><use xlink:href="#icon--ui__star_24"></use></svg>\n                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__star_filled_24"><use xlink:href="#icon--ui__star_filled_24"></use></svg>\n                            </div>\n                        ';o+="\n                    </div>\n                </div>\n            "})),o+="\n        </div>\n    \n        ",s.ageSurvey&&(o+='\n            <div class="nps-survey__age">\n                <h4>Укажите ваш возраст</h4>\n    \n                <form class="nps-survey__items">\n                    ',["младше 18","18-24","25-34","35-44","45+"].forEach(((t,e)=>{o+='\n                        <div class="nps-survey__item">    \n                            <input type="radio" name="age" value="'+(null==(r=e)?"":r)+'" />\n                            <div>'+(null==(r=t)?"":r)+"</div>\n                        </div>\n                    "})),o+="\n                </form>\n            </div>\n        "),o+='\n    \n        <button class="pkb-normal-btn" disabled>Отправить</button>\n    \n        <div class="nps-survey__success">\n            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__cookie-thumbs-up"><use xlink:href="#icon--ui__cookie-thumbs-up"></use></svg>\n            <h3>Благодарим за ответ!</h3>\n        </div>\n    </div>\n\n    ',s.isUserAuthorized||(o+='\n        <div class="nps-survey__unauth">\n            <div class="nps-survey__unauth-text">Авторизованным пользователям доступна возможность указать свои интересы, оставлять оценки постам и подписываться на интересных авторов и сообщества</div>\n\n            <div class="nps-survey__unauth-buttons">\n                <a class="social-icon social-icon_square" href="https://pikabu.ru/oauth.php?type=vk" data-type="vk"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--social__vk"><use xlink:href="#icon--social__vk"></use></svg></a>\n                <a class="social-icon social-icon_square" href="https://pikabu.ru/oauth.php?type=google" data-type="google"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--social__google"><use xlink:href="#icon--social__google"></use></svg></a>\n                <button class="nps-survey__login-button">Войти</button>\n            </div>\n        </div>\n    '),o+="\n</div>")),this.els={button:this.el.querySelector("button")},this.answers=e.map((()=>{})),this.initForm(),this.initQuestions(),this.els.button.addEventListener("click",(()=>this.onSubmit())),a.core.isUserAuthorized)||(null===(l=this.el.querySelector(".nps-survey__login-button"))||void 0===l||l.addEventListener("click",(t=>{t.preventDefault(),a.core.ui.authRequired({formType:"signIn"})})))}initForm(){var t;new(r.S.getInstance().get("UIForm"))(null===(t=this.el)||void 0===t?void 0:t.querySelector("form")).on("change",((t,e)=>{const i=Number(e.$els.input.prop("value"))+1;this.emit("answerAge",i,this.ageAnswer),this.ageAnswer=i,this.updateSubmitButtonState()}))}initQuestions(){var t,e;null===(t=this.el)||void 0===t||null===(e=t.querySelector(".nps-survey__questions"))||void 0===e||e.addEventListener("click",(t=>{const e=t.target.closest(".nps-survey__star");if(!e)return;const i=Array.from(e.parentElement.children),s=i.indexOf(e);i.forEach(((t,e)=>{t.classList.toggle("nps-survey__star_filled",e<=s)}));const n=Number(e.closest(".nps-survey__question").dataset.index),r=s+1,o=this.answers[n];this.answers[n]=r,this.emit("answer",n,r,o),this.updateSubmitButtonState()}))}updateSubmitButtonState(){const t=this.answers.every((t=>void 0!==t))&&(!this._options.showAgeSurvey||void 0!==this.ageAnswer);this.els.button.disabled=!t}onSubmit(){var t,e;null===(t=this.el)||void 0===t||null===(e=t.querySelector(".nps-survey__success"))||void 0===e||e.classList.add("show"),this.emit("submit",this.answers,this.ageAnswer)}}var u=i(42107),h=i(91904);function c(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const d=[30,100,1e4],p="pkb_nps_v",m="pkb_nps_s";class _{static getInstance(){return this.instance||(this.instance=new this),this.instance}constructor(){c(this,"prevBlockDistance",0),this.viewsCounter=Number(s.m.get(p)||0);let t=Number(s.m.get(m)||0);if(!t){t=a.core.userFirstVisitDate>=new Date("2023-06-08")?1:3,this.setStage(t)}this.stage=t}registerStoryView(t){if(this.setViewsCounter(this.viewsCounter+1),this.feed){if(!(1===this.stage&&this.viewsCounter>=d[0]||2===this.stage&&this.viewsCounter>=d[1]||3===this.stage&&this.viewsCounter>=d[2]))return;if(this.prevBlockDistance--,this.prevBlockDistance>0)return;const e=this.feed.stories.get(t);if(!e)return;if(e.screenIndex<10)return;this.showSurvey(e),this.prevBlockDistance=70,1===this.stage||2===this.stage?this.setStage(this.stage+1):this.setViewsCounter(0)}}setFeed(t){this.feed=t}showSurvey(t){const e=h.V.getUserExperimentGroup(h.t.CONTENT_NPS);let i;i="B"===e||"D"===e?["Контент соответствует моим интересам","Контент уникальный. Баянов не так много","Посты достаточно свежие","Негатива не так много"]:["Мне нравится контент"];const s=new l({questions:i,showAgeSurvey:"D"===e||"E"===e});t.$el.after(s.el),u.cp.getInstance().sendEvent("content_nps_survey_showed",{screen_index:t.screenIndex}),s.on("answer",((i,s,n)=>{let r;r="C"===e||"E"===e?"main":["interest","unique","fresh","negative"][i],u.cp.getInstance().sendEvent("content_nps_survey_tapped",{type:r,rec_score:s,screen_index:t.screenIndex,value_old:n})})),s.on("answerAge",((e,i)=>{u.cp.getInstance().sendEvent("content_nps_survey_tapped",{type:"age",size:e+1,screen_index:t.screenIndex,value_old:i})})),s.on("submit",((e,i)=>{this.onSubmit(t.screenIndex,e,i)}))}setViewsCounter(t){this.viewsCounter=t,s.m.set(p,t)}setStage(t){this.stage=t,s.m.set(m,t)}onSubmit(t,e,i){const s=h.V.getUserExperimentGroup(h.t.CONTENT_NPS);let n="";e.length>1&&(n=e.map(((t,e)=>e>0&&t<=3?e+1:null)).filter(Boolean).join(","),n&&a.eR.set("nps",n,{expires:7})),u.cp.getInstance().sendEvent("content_nps_survey_confirmed",{rec_score:"C"===s||"E"===s?e[0]:void 0,size:i,screen_index:t})}}},65801:(t,e,i)=>{i.d(e,{S:()=>h});i(85827);var s=i(12953),n=i(63907),r=i(72044),o=i(75021),a=i(64313),l=i(36005);const u=i(19755);class h extends n.u1{constructor(t){super(),r.Zv.isHTMLElement(t)&&(t=u(t)),t instanceof u&&(t={$el:t.eq(0)}),(0,l.defaults)(this._options,{endPage:10,startPage:1,currentPage:1,numButtons:8}),t&&this.setOptions(t),this.classes={navigate:"pagination__to",navigation:{left:"pagination__navigation_right",right:"pagination__navigation_left",disable:"pagination__navigation"},pages:"pagination__pages",page:{item:"pagination__page",current:"pagination__page_current",more:"pagination__page_more",next:"pagination__page_next",disabled:"pagination__page_disabled"}},this._pages=[],this.$el&&this.show()}_getOptionsFromElement(){return this.$el?(this.currentPage=parseInt(this.$(`.${this.classes.page.current}`).text(),10),this.endPage=this._pages.lastId(),this):this}_getPages(){const t=this.endPage-this.startPage+1,e=(Math.min(this.numButtons,t)-1)/2;let i=this.currentPage-Math.floor(e),s=this.currentPage+Math.ceil(e);i<this.startPage?(s+=this.startPage-i,i=this.startPage):s>this.endPage&&(i-=s-this.endPage,s=this.endPage);let n=!1;i>this.startPage&&(i+=2,n=!0);let r=!1;s<this.endPage&&(s-=2,r=!0);const o=[];n&&(o.push(this.startPage),o.push(null));for(let a=i;a<=s;a++)o.push(a);return r&&(o.push(null),o.push(this.endPage)),o}render(){return this.isRendered||(this.$el?(this._getOptionsFromElement(),r.Zv.clearEmptyTextNode(this.el),this.marks.set("vnode",this._renderV())):this._render(),this.$el.on("click",`.${this.classes.page.item}`,this._onClickPage.bind(this)),this.$el.on("click",`.${this.classes.navigate}`,this._onClickNavigate.bind(this)),super.render()),this}_render(t="0",e){this._pages=this._getPages();let i=this,s=this._renderV();if(this.el){let n=o.zM.node(this.marks.get("vnode"),s,t);this.el=n.reduce(o.nq.updateElement(e,i),this.el)}else this.el=o.wK.createElement(s,t||"0",e,i);return this.marks.set("vnode",s),this.el}_renderV(){const t=this.classes.page;return o.vu.create("div",{className:"pagination","data-role":"1"},!1,o.vu.create("div",{className:"pagination__pages"},this._pages.map(((e,i)=>null===e?o.vu.create("span",{key:i,className:`${t.item} ${t.more}`},o.vu.create(a.t,{block:"ui__dots"})):this.currentPage===e?o.vu.create("span",{key:i,className:`${t.item} ${t.current}`},e):o.vu.create("a",{href:"/",key:i,"data-page":e,className:t.item,draggable:!1},e))),this._renderNextPageLink()))}_renderNextPageLink(){const t=this.classes.page;return this.currentPage===this.endPage?o.vu.create("span",{class:`${t.item} ${t.next} ${t.disabled}`},"Далее"):o.vu.create("a",{href:"/","data-page":this.currentPage+1,className:`${t.item} ${t.next}`,draggable:!1},"Далее")}_onClickNavigate(t){t.preventDefault(),this.currentPage+="left"===t.currentTarget.dataset.to?-1:1}_onClickPage(t){t.preventDefault();return t.target.dataset.page?(this.currentPage=t.target.dataset.page,this):this}get endPage(){return this._options.endPage}set endPage(t){return t="number"==typeof t?t:parseInt(t,10),s.core.logger.log("pagination","end page",t),this._options.endPage=t}get startPage(){return this._options.startPage}set startPage(t){return t="number"==typeof t?t:parseInt(t,10),s.core.logger.log("pagination","start page",t),this._options.startPage=t}get currentPage(){return this._options.currentPage}set currentPage(t){return(t=Math.max(this.startPage,Math.min(parseInt(t,10),this.endPage)))===this.currentPage?this.currentPage:(s.core.logger.log("pagination","current page",t),!this.el||(0,l.isUndefined)(this._options.currentPage)?this._options.currentPage=t:(this._options.currentPage=t,this.emit("change",t),this._render(),t))}get numButtons(){return this._options.numButtons}set numButtons(t){return(t=Math.max(7,parseInt(t,10)))===this.numButtons?this.numButtons:(this._options.numButtons=t,this.isRendered&&this._render(),t)}}},10703:(t,e,i)=>{i.d(e,{mW:()=>r,ev:()=>u,VC:()=>l,XM:()=>K,tv:()=>Ae,h7:()=>Ht,S3:()=>Wi,f7:()=>ke,yw:()=>f,FW:()=>Fi,i$:()=>Hi});var s=i(12953),n=i(65448);const r=new n.xs({STORY:1,COMMENT:2}),o=new n.xs({READY:0,PROGRESS:1,PLAY:2,PAUSE:3,ERROR:4}),a=new n.xs({APNG:"a",VIDEO:"v",VIDEO_CANVAS:"vc",APNG_CANVAS:"ac",WEBP:"w",GIF:"g"}),l=new n.xs({YOUTUBE:0,VIMEO:1,RUTUBE:2,LIVELEAK:4,VK:5}),u=new n.xs({WEBMA:"webma",WEBM:"webm",MP4:"mp4",AV1:"av1",APNG:"png",WEBP:"webp",GIF:"gif"}),h=new n.xs({PREPARE:0,UNSTARTED:1,LOADING:2,PLAYING:3,PAUSED:4,WAITING_RESOLVED_PLAY:5}),c=new n.xs({NONE:"none",IDLE:"idle",PLAY:"play",PAUSE:"pause",END:"end"}),d=new n.xs({READY:0,PROGRESS:1,TIMEUPDATE:2,PLAY:3,PAUSE:4,ENDED:5,SEEKED:6,ERROR:7,TIMELINE_CLICK:8,FULLSCREEN_CHANGE:9,SOUND_CHANGE:10,AD_REQUEST:11,AD_LOAD:12,SHOW_AD:13,REDEEMED_AD_SHOWED:14,CLICK_AD:15}),p=(new n.xs({PLAY:0,TOGGLE:1}),new n.xs({PLAY:"video_start",FINISHED:"video_end"}));var m=i(63907),_=i(11315);var g=i(36005);const v=i(19755);class f extends m.u1{constructor(t){super(),this._options.state=h.PREPARE,this.$els={player:void 0,preview:void 0,error:void 0,label:void 0,states:{},container:void 0},this.setOptions(t),this._currentPlayer=void 0,this._awaitsPlay=!1,this._playbacks=0}play(){return this._playbacks++,this}stop(){return this}pause(){return this}destroy(){this.stop(),super.destroy()}show(){return this._options.isShown=!0,super.show(),this}hide(){return this._options.isShown=!1,super.hide(),this}togglePlay(t){return(0,g.isUndefined)(t)?this.state===h.PREPARE?this:this.state===h.UNSTARTED?this.play():this.stop():(t?this.play():this.stop(),this)}_prepareState(t){let e=t.toString().toLowerCase(),i=this.$(`.player__state[data-type="${e}"]`);return i.length?this.$els.states[t]=i.eq(0):this.$els.states[t]=v(document.createElement("div")).addClass("player__state player__state_hide").attr("type",e).appendTo(this.$el)}_changeState(t,e){let i=!0;return t===h.PREPARE&&(t=h.LOADING),e&&this.limitWidth&&this.$els&&this.$els.player&&this.$el&&this.$el.toggleClass("player_width_limit",t===h.UNSTARTED||t===h.PREPARE),this.$els&&this.$els.states[t]?((t===h.UNSTARTED&&(!this.$els.states[h.UNSTARTED]||this.$els.states[h.UNSTARTED].is(":empty"))||t===h.PLAYING&&this.dimension&&(this.dimension.width<=50||this.dimension.height<=50))&&(i=!1),this.$els.states[t].attr("style","").toggle(i).removeClass("player__state_show player__state_hide").addClass(e?"player__state_show":"player__state_hide"),t===h.LOADING&&this._progressCircle&&(e?this._progressCircle.indeterminate=!0:this._progressCircle.stop()),this):this}progress(t){return this.showControls&&this.$els.states[h.LOADING]?(this._progressCircle||(this._progressCircle=new _.j({indeterminate:!1}),this._progressCircle.appendTo(this.$els.states[h.LOADING])),(0,g.isUndefined)(t)||t>=100?(this._progressCircle.indeterminate=!0,this):(this._progressCircle.indeterminate=!1,this._progressCircle.percent=t,this)):this}_toggleProbeMessage(t){let e=this.marks.has("probe-isShown");return(t=(0,g.isBoolean)(t)?t:!e)===e?this:(this.$els.player.toggleClass("player__player_error_yes",t),t?this.marks.set("probe-isShown",!0):this.marks.delete("probe-isShown"),t||this.$els.probeMessage?this.$els.probeMessage?(this.$els.probeMessage.toggle(t),this):(this.$els.probeMessage=v('<div class="player__error-overlay">\n\t<div class="player__error-message">\n\t\t<p>Воспроизведение видео доступно в предпросмотре, либо после публикации</p>\n\t</div>\n</div>\n').appendTo(this.$el),this.$els.probeMessage.click((t=>{t.preventDefault(),t.stopPropagation(),this.stop()})),this):this)}get isProbe(){return this._options.isProbe}set isProbe(t){this._options.isProbe!==(t=Boolean(t))&&(this._options.isProbe=t)}get state(){return this._options.state}set state(t){var e,i;if(t=h[t]||h.UNSTARTED,this._options.state===t)return this._options.state;this._options.state&&this._changeState(this._options.state,!1),this._changeState(t,!0),this._options.state=t,this.emit(t);const n=[h.UNSTARTED,h.PREPARE,h.WAITING_RESOLVED_PLAY].includes(t),r=this.$els.play;if(r){const e=!n||h.WAITING_RESOLVED_PLAY===t;r.toggleClass("player__play_hide",e),e?this.timeout("hidePlayButton",s.default.ui.css.transitionTimeDefault,(()=>{r.hide()})):(this.cancelTimeout("hidePlayButton"),r.show())}return null===(e=this.$els.preview)||void 0===e||e.toggleClass("player__preview_hide",!n),null===(i=this.$els.player)||void 0===i||i.toggleClass("player__player_hide",n),this._options.state}get isPlayed(){return this.state!==h.UNSTARTED&&this.state!==h.PREPARE}get dimension(){return this._options.dimension}set dimension(t){this._options.dimension=t}get source(){return this._options.source}set source(t){this._options.source=String(t)}get showControls(){return this._options.showControls}set showControls(t){this._options.showControls=Boolean(t)}get dimensionMode(){return this._options.dimensionMode}set dimensionMode(t){if(t=r[t]||r.STORY,!this.$el||t===this.dimensionMode)return this.dimensionMode;let e=t===r.STORY?this.$el.closest(".story__main"):this.$parent;return e=e.is("a")?e.parent():e,this.$els.container=e.is("a")?e.parent():e,this._options.dimensionMode=t}get playbacks(){return this._playbacks}get limitWidth(){return this._options.limitWidth}set limitWidth(t){this._options.limitWidth=Boolean(t)}}i(88674),i(66992),i(33948),i(41817);var y=i(16253),b=i(72044),w=i(81528),E=(i(2707),i(2439)),A=i(81780);function S(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class P{constructor({player:t,onVideoFinished:e}){S(this,"emitter",new E.v),S(this,"onVideoFinished",(()=>null)),this.player=t,this.onVideoFinished=e}resumePlay(){}isPlayerAutoplaying(t){return this.player.eid===t}}var C=i(33877);function T(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class k extends P{constructor(...t){super(...t),T(this,"state","paused"),T(this,"handleVideoFinished",(t=>{this.player.isPlaying&&this.player.pause({showIndicate:!1}),this.onVideoFinished(t)}))}async play(){"playing"===this.state||document.querySelector(".video-feed")||(this.state="playing",this.player.isStreamingInitialized instanceof Promise&&await Promise.race([this.player.isStreamingInitialized,(0,C.g)(500)]),this.player.renderPlayer(),Fi.hasUserInteractedWithVolume||(this.player.isMuted=!0),this.player.play({focusAfter:!1,showIndicate:!1,isAutoEvent:!0}),this.emitter.listenTo(this.player,"video-finished",this.handleVideoFinished))}pause(t=!1){"paused"!==this.state&&(this.state="paused",this.emitter.stopListening(this.player,"video-finished",this.handleVideoFinished),t||this.player.pause({showIndicate:!1,isAutoEvent:!0}))}resumePlay(){setTimeout((()=>{this.player.isAdShown||this.player.play({focusAfter:!1,showIndicate:!1})}),350)}}class D extends P{play(){const t=this.player;this.player.play(),this.emitter.listenTo(this.player,"gifx-play",(()=>{t!==this.player&&this.pause()}))}pause(){this.player.stop()}}function I(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class $ extends P{constructor(...t){super(...t),I(this,"handleVideoFinished",(()=>{this.player.stop(),this.onVideoFinished()}))}setUnstartedState(){this.player.state=d.UNSTARTED}play(){this.player.play(),this.emitter.listenTo(this.player.provider,"stop",this.handleVideoFinished)}pause(t=!1){this.emitter.stopListening(this.player.provider,"stop",this.handleVideoFinished),!t&&this.player.currentPlayer.ready?(this.setUnstartedState(),this.player.pause()):this.player.stop()}resumePlay(){setTimeout((()=>{this.player.play()}),350)}}var O=i(92934),x=i(9975);function B(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class L{static getInstance(){return L.instance||(L.instance=new L)}constructor(){B(this,"_activePlayerPlaybacks",0),B(this,"viewportPlayers",[]),B(this,"emitter",new E.v),B(this,"isDisabled",!1),B(this,"players",new WeakMap),B(this,"onVideoFinished",((t=!1)=>{t&&--this._activePlayerPlaybacks,++this.activePlayerPlaybacks})),B(this,"playNextVideoInQueue",(t=>{this.viewportPlayers.length&&!x.I.isFullScreen&&(t||(t=this.viewportPlayers[0]),this.createActivePlayer(t),this.playCurrentActivePlayer())})),this.emitter.listenTo(s.core,"playerSpecialPlay",(t=>{var e,i;null!==(e=this.currentActivePlayer)&&void 0!==e&&e.isPlayerAutoplaying(t)||(null===(i=this.currentActivePlayer)||void 0===i||i.pause())})),document.addEventListener("visibilitychange",(()=>{var t;"hidden"===document.visibilityState&&(null===(t=this.currentActivePlayer)||void 0===t||t.pause())})),this.initObserver(),this.handleViewportPlayersChangeDebounced=(0,O.D)(this.handleViewportPlayersChange.bind(this),100)}initPlayer({player:t}){this.players.set(t.el,t),this.observer.observe(t.el),this.emitter.listenTo(t,A.e.UNMOUNTED,(()=>{var e;this.observer.unobserve(t.el),this.viewportPlayers=this.viewportPlayers.filter((e=>e.player!==t)),(null===(e=this.currentActivePlayer)||void 0===e?void 0:e.player)===t&&(this.currentActivePlayer=void 0,this.stopActivePlayerAndPlayNext())}))}disable(){this.isDisabled=!0,s.core.initParams.isVideoAutoplayMode=!1,this.observer&&this.observer.disconnect()}createActivePlayer(t){const e={player:t,onVideoFinished:this.onVideoFinished};t instanceof Fi?this.currentActivePlayer=new k(e):t instanceof ke?this.currentActivePlayer=new D(e):t instanceof Hi&&t.providerType===l.RUTUBE&&(this.currentActivePlayer=new $(e))}isPlayerAutoplaying(t){var e;return Boolean(null===(e=this.currentActivePlayer)||void 0===e?void 0:e.isPlayerAutoplaying(t))}initObserver(){this.observer=new IntersectionObserver((t=>{let e=[];if(t.forEach((t=>{const i=this.players.get(t.target);i&&(t.isIntersecting?e.push({player:i,intersectionRatio:t.intersectionRatio}):(this.viewportPlayers=this.viewportPlayers.filter((t=>t.player!==i)),e=e.filter((t=>t.player!==i))))})),e.length>0)if(this.viewportPlayers.length){const t=e.map((t=>t.player)),i=this.viewportPlayers.filter((e=>!t.includes(e.player)));this.viewportPlayers=[...i,...e]}else this.viewportPlayers=e;this.handleViewportPlayersChangeDebounced()}),{threshold:[.5,1]})}handleViewportPlayersChange(){if(x.I.isFullScreen)return;this.viewportPlayers.sort(((t,e)=>t.player.el.getBoundingClientRect().top-e.player.el.getBoundingClientRect().top));let t,e=null;if(this.currentActivePlayer&&(t=this.viewportPlayers.find((t=>{var e;return t.player===(null===(e=this.currentActivePlayer)||void 0===e?void 0:e.player)})),t&&t.intersectionRatio<1&&(e=t.player.el.getBoundingClientRect().top>0?"bottom":"top")),t){if(e){const t="top"===e?this.viewportPlayers[1]:this.viewportPlayers[this.viewportPlayers.length-2];1===(null==t?void 0:t.intersectionRatio)&&this.stopActivePlayerAndPlayNext(!1,t.player)}}else{var i;let t;var s;if(this.viewportPlayers.length>0)t=this.viewportPlayers[0],t.intersectionRatio<1&&1===(null===(s=this.viewportPlayers[1])||void 0===s?void 0:s.intersectionRatio)&&(t=this.viewportPlayers[1]);this.stopActivePlayerAndPlayNext(!1,null===(i=t)||void 0===i?void 0:i.player)}}playCurrentActivePlayer(){this.currentActivePlayer&&!this.currentActivePlayer.player.isAdShown&&this.currentActivePlayer.play()}stopActivePlayerAndPlayNext(t=!1,e){var i;null===(i=this.currentActivePlayer)||void 0===i||i.pause(t),this.currentActivePlayer=void 0,this._activePlayerPlaybacks=0,this.playNextVideoInQueue(e)}get activePlayerPlaybacks(){return this._activePlayerPlaybacks}set activePlayerPlaybacks(t){var e;t>=3?this.stopActivePlayerAndPlayNext(!0):(this._activePlayerPlaybacks=t,null===(e=this.currentActivePlayer)||void 0===e||e.resumePlay())}}var M=i(68505),F=i(37733),R=i(91904),N=i(73736);function j(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const U=new Set,H=Math.random()>.15;class V{static getInstance(){return V.instance?V.instance:V.instance=new V}constructor(){j(this,"send",(t=>{var e,i,n;const r=t.spinnerStats,o=R.V.isUserInExperiment(F.t.VIDEO_STREAMING,"B")?"B":R.V.isUserInExperiment(F.t.VIDEO_STREAMING,"C")?"C":void 0;if(!r)return;r.lagStarted&&r.lags.push(Date.now()-r.lagStarted);const a=r.lags.filter((t=>t>500&&(!o||H))).map((t=>Math.min(t,12e4))),l=t.storyId,u=null===(e=s.core.ui.activeStoriesFeed)||void 0===e?void 0:e.stories.get(l),h={postId:l,tagsMask:(null==u?void 0:u.tagsMask)||0,contentType:(null==u?void 0:u.contentTypes)||"",position:t.getOption("position"),length:Math.trunc(1e3*(t.getOption("duration")||0)),time:Math.round(Date.now()-r.lastViewStarted),mode:t.videoType,list:[(null===(i=t.els.video)||void 0===i?void 0:i.videoWidth)||0,(null===(n=t.els.video)||void 0===n?void 0:n.videoHeight)||0,t.isVideoMuted?0:1],soundOn:t.isMuted?0:1,soundVolume:Math.trunc(100*t.volume),listF32:a,startUpTime:r.playingStartTime?Math.round(r.playingStartTime-r.lastViewStarted):void 0};h.listF32.length&&N.dV.send("spinnerShowed",h),R.V.isUserInExperiment(F.t.VIDEO_FINISHED,"B")&&N.dV.send("videoFinished",h)})),s.core.ui.on("unload",(()=>U.forEach(this.send)))}watch(t){(0,M.m)(t,(e=>{e.isIntersecting?U.add(t):(this.send(t),delete t.spinnerStats,U.delete(t))})),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&U.forEach((t=>{delete t.spinnerStats}))}))}}var W=i(95411),q=i(8233);function z(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Y(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const G=i(19755);class K extends y.vp{constructor(){super(),this._providers=new Ae,this._tehnologies=new Ht,this._currentPlayerId=void 0,this._attachedHotkey=!1}getTechnologyInstanceByType(t){return this._tehnologies.getTechnologyInstanceByType(t)}get technologies(){return this._tehnologies.technologies}getProviderInstanceByType(t){return this._providers.getProviderInstanceByType(t)}getProviderTypeBySource(t){return this._providers.getProviderTypeBySource(t)}get providers(){return this._providers.providers}async init(t,e={}){const{forceAutoPlay:i=!1,context:n={}}=e,o=(t=b.Zv.isJQuery(t)?t:b.Zv.isHTMLElement(t)?G(t):s.core.ui.$els.body).find(".player").toArray();for(let a of o){const t=G(a),e=t.data("type");let o,u,h=!1;if(t.data("player"))continue;switch(a.playerInitHTML=a.outerHTML,t.closest(".story__content").length?u=r.STORY:(u=r.COMMENT,h=!s.core.initParams.isCommAnimPreview),e){case"video-file":o=new Fi({$el:t,dimensionMode:u,context:n});break;case"video":h=t.hasClass("player_viewer"),o=new Hi({$el:t,dimensionMode:u,playAfterInitialization:h,context:n});break;case"gifx":o=new ke({$el:t,dimensionMode:u,playAfterInitialization:h&&void 0===s.core.initParams.isVideoAutoplayMode,context:n})}if(!o)continue;const c=t.closest(".story:not(.story_comment)"),d=Boolean(c.length),p=c.data("page"),m=()=>{if(!(["video-file","gifx"].includes(e)||"video"===e&&o.providerType===l.RUTUBE))return;const t=s.core.initParams.isVideoAutoplayMode&&d&&(!p||s.core.initParams.isExternalReferer),n="gifx"===e&&!d&&!s.core.initParams.isCommAnimPreview;(i||(t||n)&&"story-editor"!==s.core.initParams.pageName)&&L.getInstance().initPlayer({player:o})};"video"===e?s.core.ui.player.providers.then(m):m(),"video-file"===e&&V.getInstance().watch(o),t.data("player",o),await(0,q.y)()}}get animationsData(){return this._animationsData?this._animationsData:this._animationsData=new Map(Object.entries((0,w.I)(s.core.config("animations"))))}createAnimation(t,e){if(!this.animationsData.has(t))throw new Error("Not found animation "+t);let i=this.animationsData.get(t);return new Wi(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?z(Object(i),!0).forEach((function(e){Y(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):z(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({animationName:t,formats:i[Math.max(1,Math.min(2,Math.round(s.core.ui.devicePixelRatio)))],dimension:{width:i.width,height:i.height}},e))}preloadAnimation(t){if(!this.animationsData.has(t))throw new Error("Not found animation "+t);let e=this.animationsData.get(t)[Math.max(1,Math.min(2,Math.round(s.core.ui.devicePixelRatio)))][u.APNG];document.querySelector(`link[rel="preload"][href="${e}"]`)||G("head").append(G(`<link rel="preload" href="${e}" as="image">`))}attachHotkey(){return this._attachedHotkey||(s.core.ui.$els.document.on("mouseenter",".player",(t=>{if(!t.currentTarget)return!1;let e=m.u1.getUIElement(t.currentTarget);(e instanceof Hi||e instanceof ke||e instanceof Fi)&&(this._currentPlayerId=e.eid)})),this._attachedHotkey=!0,s.core.ui.hotkeys.on("r",(()=>{s.core.emit("playerSpecialToggle",this._currentPlayerId)}),{type:W.FM.KEYDOWN,repeat:!1})),this}static getPlayerFromElement(t){const e=m.u1.getUIElement(t);if(e instanceof f)return e}stop(t){return void 0===t?(s.core.emit("playerSpecialPlay",0),this):((0,g.forEach)(G(t).find(".player"),(t=>this._stopPlayer(K.getPlayerFromElement(t)))),this)}_stopPlayer(t){if(t&&"function"==typeof t.stop&&t instanceof f)try{t.stop()}catch(e){throw new Error("player stop() throuble"+e)}return this}get currentPlayer(){return this._currentPlayerId}set currentPlayer(t){const e=this._currentPlayerId;if(t&&"string"!=typeof t){if(!(t=K.getPlayerFromElement(t)))return;t=t.eid}e!==t&&(this._currentPlayerId=t)}get isPlayerInFullscreen(){var t,e;return Boolean(null===(t=document.fullscreenElement)||void 0===t||null===(e=t.closest)||void 0===e?void 0:e.call(t,".player"))}}var X=i(96637);class Z{constructor(){this._detailsSupport={supported:!1},this._ready=void 0}serialize(){return this._detailsSupport}deserialize(t){this._detailsSupport=t,this._ready=Promise.resolve(this._detailsSupport.supported)}canPlay(t){return!0}get detailsSupport(){return this._detailsSupport}async _checkSupported(){return this._detailsSupport.supported}get supported(){return this._ready?this._ready:this._ready=this._checkSupported()}}class Q extends Z{constructor(){super(),this._detailsSupport.supported=!0}}class J extends m.u1{constructor(t){super(),this._player=t,this.$parent=t.$els.player}mount(){return this.$el.appendTo(this.$parent),super.mount(),this}show(){return this._options.isShown=!0,super.show(),this}hide(){return this._options.isShown=!1,super.hide(),this}play(){return this.show(),this}stop(){return this.hide(),this}destroy(){this.stop(),delete this._player,super.destroy()}}const tt="pkb_Pt",et="pkb_WEBBAt",it="pkb_Ply_v",st="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3C/svg%3E",nt={[d.PLAY]:"video_play",[d.PAUSE]:"video_pause",[d.TIMELINE_CLICK]:"video_timeline_click",[d.FULLSCREEN_CHANGE]:"video_fullscreen",[d.SOUND_CHANGE]:"sound_change",[d.AD_REQUEST]:"ad_request",[d.AD_LOAD]:"ad_load",[d.SHOW_AD]:"show_ad",[d.REDEEMED_AD_SHOWED]:"redeemed_ad_showed",[d.CLICK_AD]:"click_ad"},rt={[l.YOUTUBE]:"youtube",[l.VIMEO]:"vimeo",[l.VK]:"vk"},ot='video/mp4; codecs="av01.0.00M.08, opus"',at=i(19755);class lt extends J{constructor(t){super(t),t.format=u.GIF}render(){if(this.isRendered)return this;this.emit(o.PROGRESS);const t=this._player.source;return"string"==typeof t?this.$el=at(document.createElement("img")).addClass("player__gif").on("error",(()=>this.emit(o.ERROR))).on("load",(()=>this.emit(o.READY))).attr("src",t):this.emit(o.ERROR),super.render(),this}destroy(){this.isRendered&&this.$el.attr("src",st),super.destroy()}}i(74916),i(15306);class ut extends Z{constructor(){super(),this._videoFormatTest={[u.MP4]:'video/mp4; codecs="avc1.42E01E"',[u.WEBM]:'video/webm; codecs="vp9"',[u.AV1]:ot}}canPlay(t){return t.has(u.WEBP)||t.has(u.MP4)||this._detailsSupport[u.WEBMA]&&t.has(u.WEBMA)||this._detailsSupport[u.AV1]&&t.has(u.AV1)}_checkSupportedWebmAlpha(){let t,e=document.createElement("video");return X.LocalStorage.get(et)?(this._detailsSupport[u.WEBMA]=!1,!0):(X.LocalStorage.set(et,"true"),s.core.ua.windows&&"XP"===s.core.ua.osversion?(this._detailsSupport[u.WEBMA]=!1,!0):new Promise((i=>{let s=()=>{e.remove(),this._detailsSupport[u.WEBMA]=!1,i(!1)};e.autoplay=!1,e.loop=!1,e.style.display="none",e.addEventListener("loadeddata",(()=>{let t,n=document.createElement("canvas");e.remove(),n.getContext&&n.getContext("2d")?(t=n.getContext("2d"),t.drawImage(e,0,0),0===t.getImageData(0,0,1,1).data[3]?(this._detailsSupport[u.WEBMA]=!0,X.LocalStorage.remove(et),i(!0)):s()):s()}),!1),e.addEventListener("error",s),e.addEventListener("stalled",s),e.addEventListener("abort",s),t=document.createElement("source"),t.src="data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAACBRFNm3RALE27i1OrhBVJqWZTrIHlTbuMU6uEFlSua1OsggEjTbuMU6uEHFO7a1OsggHo7AEAAAAAAACqAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAADIq17GDD0JATYCNTGF2ZjU3LjU3LjEwMFdBjUxhdmY1Ny41Ny4xMDBEiYhARAAAAAAAABZUrmsBAAAAAAAARq4BAAAAAAAAPdeBAXPFgQGcgQAitZyDdW5khoVWX1ZQOYOBASPjg4QCYloA4AEAAAAAAAARsIFAuoFAmoECU8CBAVSygQQfQ7Z1AQAAAAAAAGfngQCgAQAAAAAAAFuhooEAAACCSYNCAAPwA/YAOCQcGFQAADBgAABnP///NXgndmB1oQEAAAAAAAAtpgEAAAAAAAAk7oEBpZ+CSYNCAAPwA/YAOCQcGFQAADBgAABnP///Vttk7swAHFO7awEAAAAAAAARu4+zgQC3iveBAfGCAXXwgQM=",t.addEventListener("error",s),e.appendChild(t),document.body.appendChild(e)})))}_checkSupportedVideo(){let t=document.createElement("video"),e=!1;return!!t.canPlayType&&((0,g.forEach)(this._videoFormatTest,((i,n)=>{this._detailsSupport[n]=Boolean(t.canPlayType(i).replace(/^no$/,"")),s.core.ua.safari&&n===u.WEBM.toString()&&(this._detailsSupport[n]=!1),e=e||this._detailsSupport[n]})),e)}_checkSupported(){return s.core.ua.iphone&&!("playsInline"in document.createElement("video"))||s.core.ua.android&&!s.core.ua.check({chrome:"60.0.0"})||s.core.ua.mobile&&s.core.ua.opera?Promise.resolve(!1):Promise.all([this._checkSupportedVideo(),this._checkSupportedWebmAlpha()]).then((t=>this._detailsSupport.supported=(0,g.reduce)(t,((t,e)=>t||e),!1)))}}const ht=i(19755);class ct extends J{constructor(t){super(t),this._videoError=0,this._onVideoErrorBound=this._onVideoError.bind(this),this._videoPriority=this._getVideoPriority(),this._player.format=this._videoPriority[0],this._loadingVideo=void 0,this._hasMeta=!1,this._needPlay=!1}_getVideoPriority(){let t=s.core.ui.player.getTechnologyInstanceByType(a.VIDEO),e=[];return t.detailsSupport,[u.AV1,u.WEBMA,u.WEBM,u.MP4].forEach((i=>{let s=t.detailsSupport[i.toString()];i=u[i]||i,s&&u.has(i)&&this._player.formats.has(i)&&e.push(i)})),e}render(){return this.isRendered?this:this._videoPriority.length?(this.emit(o.PROGRESS),this.$el=ht(document.createElement("video")).addClass("player__video").prop({loop:"loop",muted:"muted",preload:"auto",playsinline:!0}).attr("playsinline","").attr("webkit-playsinline","").attr("muted","").appendTo(this._player.$els.player),this.el.loop=!0,this.$el.on({loadstart:this._onVideoLoading.bind(this),canplay:this._onVideoCanPlay.bind(this),loadedmetadata:this._onVideoLoadedMetaData.bind(this)}),this._videoPriority.forEach((t=>{let e;e=t===u.AV1?ot:"video/"+(t===u.WEBMA?u.WEBM.valueOf():t.valueOf()),ht(document.createElement("source")).prop({src:this._player.getSourceByFormat(t),type:e}).on("error",this._onVideoErrorBound).appendTo(this.$el)})),super.render(),this):(this.emit(o.ERROR),this)}_onVideoError(){if(++this._videoError<this._videoPriority.length)return this;s.core.logger.error("gifx","error loading HTML5 video"),this._stopWatchLoading(),this.emit(o.ERROR)}_onVideoLoading(){this.emit(o.PROGRESS)}_onVideoCanPlay(){this._hasMeta||this._player.state!==h.LOADING||this.emit(o.PLAY),this._needPlay&&this.el.play()}_onVideoLoadedMetaData(){return this._player.state===h.PLAYING||(this.emit(o.PROGRESS,0),this._hasMeta=!0,this._startWatchLoading()),!0}_startWatchLoading(){return this._loadingVideo||(this._loadingVideo=setInterval((()=>{let t,e,i=this.el.duration,s=this.el.buffered,n=s.length;for(;n--;)e=s.end(n)/i-s.start(n)/i;t=Number((100*e).toFixed()),this.emit(o.PROGRESS,t),t>=99&&(this.emit(o.PLAY),this._stopWatchLoading())}),100)),this}_stopWatchLoading(){return this._loadingVideo&&(clearInterval(this._loadingVideo),delete this._loadingVideo),this}play(){return super.play(),this.el.load(),s.core.ua.ios&&this.el.play(),this._needPlay=!0,this.emit(o.PROGRESS),this._startWatchLoading(),this}stop(){if(this._needPlay=!1,this.el&&(0,g.isFunction)(this.el.pause))try{this.el.pause()}catch(t){s.core.logger.error("player","gifx video technology",t)}return this._stopWatchLoading(),super.stop(),this}}class dt extends Z{canPlay(t){return t.has(u.MP4)}_checkSupported(){let t,e;return!s.core.ua.iphone||Number(s.core.ua.osversion.split(".")[0]||0)<=7?(this._detailsSupport.supported=!1,!1):(t=document.createElement("video"),e=document.createElement("canvas"),t.canPlayType&&"getContext"in e?this._detailsSupport.supported=Boolean(t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")):(this._detailsSupport.supported=!1,!1))}}const pt=i(19755);class mt extends J{constructor(t){super(t),this._player.format=u.MP4,this.els={video:void 0},this._lastTime=0,this._needPlay=!1,this._currentPlaying=!1,this._ctxWidth=0,this._ctxHeight=0}render(){return this.isRendered||(this.emit(o.PROGRESS),this._ctxWidth=this._player.$els.player.width(),this._ctxHeight=this._player.$els.player.height(),this.$el=pt(document.createElement("canvas")).appendTo(this._player.$els.player).attr("width",this._ctxWidth).attr("height",this._ctxHeight),this.els.ctx=this.el.getContext("2d"),this.$els.video=pt(document.createElement("video")).addClass("player__video").prop({preload:"auto"}).attr("muted","").hide().appendTo(this._player.$els.player),this.els.video=this.$els.video.get(0),this.$els.video.on({loadstart:this._onVideoLoading.bind(this),timeupdate:this._onVideoTimeUpdate.bind(this),canplay:this._onVideoCanPlay.bind(this),loadedmetadata:this._onVideoLoadedMetaData.bind(this)}),pt(document.createElement("source")).prop({src:this._player.source,type:"video/"+this._player.format.valueOf()}).on("error",this._onVideoError.bind(this)).appendTo(this.$els.video),this._loopBound=this._loop.bind(this),this.els.video.load(),super.render()),this}_loop(){let t=Date.now(),e=(t-this._lastTime)/1e3;return e>=.1&&(this.els.video.currentTime=this.els.video.currentTime+e,this._lastTime=t),this.els.video.currentTime>=this.els.video.duration&&(this.els.video.currentTime=0),this.animationFrame("loop",this._loopBound),this}_drawFrame(){this.els.ctx.drawImage(this.els.video,0,0,this._ctxWidth,this._ctxHeight)}_onVideoError(){s.core.logger.error("gifx","error loading HTML5 video"),this._stopWatchLoading(),this.emit(o.ERROR)}_onVideoTimeUpdate(){this._drawFrame()}_onVideoLoading(){this.emit(o.PROGRESS)}_onVideoCanPlay(){this._hasMeta||this._player.state!==h.LOADING||this.emit(o.READY),this._drawFrame()}_onVideoLoadedMetaData(){return this._player.state===h.PLAYING||(this.emit(o.PROGRESS,0),this._hasMeta=!0,this._startWatchLoading(),this._needPlay&&(this._currentPlaying=!0,this._loop())),!0}_startWatchLoading(){return this._loadingVideo||(this._loadingVideo=setInterval((()=>{let t,e,i=this.els.video.duration,s=this.els.video.buffered,n=s.length;for(;n--;)e=s.end(n)/i-s.start(n)/i;t=Number((100*e).toFixed()),this.emit(o.PROGRESS,t),t>=99&&(this.emit(o.PLAY),this._stopWatchLoading())}),100)),this}_stopWatchLoading(){return this._loadingVideo&&(clearInterval(this._loadingVideo),delete this._loadingVideo),this}play(){return super.play(),this._needPlay=!0,this.emit(o.PROGRESS),this._startWatchLoading(),this._loop(),this}destroy(){this.$els.video.off().remove(),delete this.els.video,delete this.els.ctx,super.destroy()}stop(){return this._currentPlaying=!1,this.cancelAnimationFrame("loop"),this._needPlay=!1,this._stopWatchLoading(),super.stop(),this}}const _t=i(19755);class gt extends Z{constructor(){super(),this._detailsSupport.supported=!0}canPlay(t){return t.has(u.APNG)}_checkSupported(){const t=document.createElement("canvas");return"getContext"in t?new Promise((e=>{const i=document.createElement("img");_t(i).on("load",(()=>{const s=t.getContext("2d");s.drawImage(i,0,0);const n=0===s.getImageData(0,0,1,1).data[3];e(this._detailsSupport.supported=n)})).on("error",(function(){e(!1)})).attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACGFjVEwAAAABAAAAAcMq2TYAAAANSURBVAiZY2BgYPgPAAEEAQB9ssjfAAAAGmZjVEwAAAAAAAAAAQAAAAEAAAAAAAAAAAD6A+gBAbNU+2sAAAARZmRBVAAAAAEImWNgYGBgAAAABQAB6MzFdgAAAABJRU5ErkJggg==")})):Promise.resolve(this._detailsSupport.supported=!1)}}const vt=i(19755);class ft extends J{constructor(t){super(t),t.format=u.APNG}render(){if(this.isRendered)return this;this.emit(o.PROGRESS);const t=this._player.source;return"string"==typeof t?this.$el=vt(document.createElement("img")).addClass("player__apng").on("error",(()=>this.emit(o.ERROR))).on("load",(()=>this.emit(o.READY))).attr("src",t):this.emit(o.ERROR),super.render(),this}destroy(){this.isRendered&&this.$el.attr("src",st),super.destroy()}}i(60285),i(41637);i(19755);class yt extends Z{canPlay(t){return t.has(u.APNG)}static checkSupportedABU(){return"ArrayBuffer"in window&&"URL"in window&&("http:"===location.protocol||"https:"===location.protocol)}_checkSupported(){const t=document.createElement("canvas");return this._detailsSupport.supported=!(!("getContext"in t)||!yt.checkSupportedABU)}}i(3462),i(33824);var bt=i(92927);const wt=function(){var t=this,e=0,i=0,s=null,n=!1,r=!1,o=[],a=function(t){for(;n&&e<=t;)l(t);n&&bt.$.request(a)},l=function(a){var l=i++%t.frames.length,u=t.frames[l];if(!(0===t.numPlays||i/t.frames.length<=t.numPlays))return n=!1,void(r=!0);for(0===l&&(o.forEach((function(e){e.clearRect(0,0,t.width,t.height)})),s=null,2===u.disposeOp&&(u.disposeOp=1)),s&&1===s.disposeOp?o.forEach((function(t){t.clearRect(s.left,s.top,s.width,s.height)})):s&&2===s.disposeOp&&o.forEach((function(t){t.putImageData(s.iData,s.left,s.top)})),(s=u).iData=null,2===s.disposeOp&&(s.iData=o[0].getImageData(u.left,u.top,u.width,u.height)),0===u.blendOp&&o.forEach((function(t){t.clearRect(u.left,u.top,u.width,u.height)})),o.forEach((function(t){t.drawImage(u.img,u.left,u.top)})),0===e&&(e=a);a>e+t.playTime;)e+=t.playTime;e+=u.delay};this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[],this.play=function(){n||r||(this.rewind(),n=!0,bt.$.request(a))},this.rewind=function(){e=0,i=0,s=null,n=!1,r=!1},this.addContext=function(t){if(o.length>0){let e=o[0].getImageData(0,0,this.width,this.height);t.putImageData(e,0,0)}o.push(t),t._apng_animation=this},this.removeContext=function(t){var e=o.indexOf(t);-1!==e&&(o.splice(e,1),0===o.length&&this.rewind(),"_apng_animation"in t&&delete t._apng_animation)},this.removeAllContext=function(){o=[]},this.isPlayed=function(){return n},this.isFinished=function(){return r}};let Et;const At=new Uint8Array([137,80,78,71,13,10,26,10]);function St(t){const e=new Uint8Array(t);return new Promise((function(t,i){for(let u=0;u<At.length;u++)if(At[u]!==e[u])return void i("Not a PNG file (invalid file signature)");let s=!1;if(Pt(e,(function(t){return"acTL"!==t||(s=!0,!1)})),!s)return void i("Not an animated PNG");let n=[],r=[],o=null,a=null,l=new wt;if(Pt(e,(function(t,e,i,s){switch(t){case"IHDR":o=e.subarray(i+8,i+8+s),l.width=Ct(e,i+8),l.height=Ct(e,i+12);break;case"acTL":l.numPlays=Ct(e,i+8+4);break;case"fcTL":a&&l.frames.push(a),a={},a.width=Ct(e,i+8+4),a.height=Ct(e,i+8+8),a.left=Ct(e,i+8+12),a.top=Ct(e,i+8+16);{let t=Tt(e,i+8+20),s=Tt(e,i+8+22)||100;a.delay=1e3*t/s}a.delay<=10&&(a.delay=100),l.playTime+=a.delay,a.disposeOp=kt(e,i+8+24),a.blendOp=kt(e,i+8+25),a.dataParts=[];break;case"fdAT":a&&a.dataParts.push(e.subarray(i+8+4,i+8+s));break;case"IDAT":a&&a.dataParts.push(e.subarray(i+8,i+8+s));break;case"IEND":r.push(Dt(e,i,12+s));break;default:n.push(Dt(e,i,12+s))}})),a&&l.frames.push(a),0!==l.frames.length){let e,s=0,u=new Blob(n),h=new Blob(r);for(let n=0;n<l.frames.length;n++){a=l.frames[n];let r=[];r.push(At),o.set($t(a.width),0),o.set($t(a.height),4),r.push(Ot("IHDR",o)),r.push(u);for(let t=0;t<a.dataParts.length;t++)r.push(Ot("IDAT",a.dataParts[t]));r.push(h),e=URL.createObjectURL(new Blob(r,{type:"image/png"})),delete a.dataParts,r=null,a.img=document.createElement("img"),a.img.onload=function(){URL.revokeObjectURL(this.src),s++,s===l.frames.length&&t(l)},a.img.onerror=function(){i("Image creation error")},a.img.src=e}}else i("Not an animated PNG")}))}const Pt=function(t,e){let i,s,n,r=8;do{i=Ct(t,r),s=It(t,r+4,4),n=e(s,t,r,i),r+=12+i}while(!1!==n&&"IEND"!==s&&r<t.length)},Ct=function(t,e){let i=0;i+=t[0+e]<<24>>>0;for(let s=1;s<4;s++)i+=t[s+e]<<8*(3-s);return i},Tt=function(t,e){let i=0;for(let s=0;s<2;s++)i+=t[s+e]<<8*(1-s);return i},kt=function(t,e){return t[e]},Dt=function(t,e,i){const s=new Uint8Array(i);return s.set(t.subarray(e,e+i)),s},It=function(t,e,i){const s=Array.prototype.slice.call(t.subarray(e,e+i));return String.fromCharCode.apply(String,s)},$t=function(t){return[t>>>24&255,t>>>16&255,t>>>8&255,255&t]},Ot=function(t,e){let i=t.length+e.length,s=new Uint8Array(new ArrayBuffer(i+8));s.set($t(e.length),0),s.set(function(t){let e=[];for(let i=0;i<t.length;i++)e.push(t.charCodeAt(i));return e}(t),4),s.set(e,8);let n=function(t,e,i){if(!Et){Et=new Uint32Array(256);for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)e=1&e?3988292384^e>>>1:e>>>1;Et[t]=e}}let s=-1;for(let n=e=e||0,r=e+(i=i||t.length-e);n<r;n++)s=s>>>8^Et[255&(s^t[n])];return-1^s}(s,4,i);return s.set($t(n),i+4),s};var xt={},Bt={};xt.parseBuffer=function(t){return St(t)},xt.parseURL=function(t){return t in Bt||(Bt[t]=function(t){return new Promise((function(e,i){var s=new XMLHttpRequest;s.open("GET",t),s.responseType="arraybuffer",s.onload=function(){200===this.status?e(this.response):i(this)},s.send()}))}(t).then(St)),Bt[t]},xt.animateContext=function(t,e){return xt.parseURL(t).then((function(t){return t.addContext(e),t.play(),t}))},xt.animateImage=function(t){return t.setAttribute("data-is-apng","progress"),xt.parseURL(t.src).then((function(e){t.setAttribute("data-is-apng","yes");let i=document.createElement("canvas");i.width=e.width,i.height=e.height,Array.prototype.slice.call(t.attributes).forEach((function(t){-1===["alt","src","usemap","ismap","data-is-apng","width","height"].indexOf(t.nodeName)&&i.setAttributeNode(t.cloneNode(!1))})),i.setAttribute("data-apng-src",t.src),""!==t.alt&&i.appendChild(document.createTextNode(t.alt));{let e="",s="",n=0,r="";""!==t.style.width&&"auto"!==t.style.width?e=t.style.width:t.hasAttribute("width")&&(e=t.getAttribute("width")+"px"),""!==t.style.height&&"auto"!==t.style.height?s=t.style.height:t.hasAttribute("height")&&(s=t.getAttribute("height")+"px"),""!==e&&""===s&&(n=parseFloat(e),r=e.match(/\D+$/)[0],s=Math.round(i.height*n/i.width)+r),""!==s&&""===e&&(n=parseFloat(s),r=s.match(/\D+$/)[0],e=Math.round(i.width*n/i.height)+r),i.style.width=e,i.style.height=s}{let e=t.parentNode;e.insertBefore(i,t),e.removeChild(t)}return e.addContext(i.getContext("2d")),e.play(),e}),(function(){t.setAttribute("data-is-apng","no")}))},xt.releaseCanvas=function(t){var e=t.getContext("2d");"_apng_animation"in e&&e._apng_animation.removeContext(e)};const Lt=xt,Mt=i(19755);class Ft extends J{constructor(t){super(t),t.format=u.APNG}render(){if(this.isRendered)return this;this.emit(o.PROGRESS);const t=this._player.source;return this.$el=Mt(document.createElement("img")).addClass("player__apng").attr("src",t),Lt.animateImage(this.el).then((t=>{this.emit(o.READY),this._apng=t})).catch((()=>this.emit(o.ERROR))),super.render(),this}destroy(){this._apng&&(this._apng.rewind(),this._apng.removeAllContext(),delete this._apng),super.destroy()}}const Rt=i(19755);class Nt extends Z{canPlay(t){return t.has(u.WEBP)}_checkSupported(){return new Promise((t=>{let e=document.createElement("img");Rt(e).on({load:()=>{2===e.width&&1===e.height?t(this._detailsSupport.supported=!0):t(!1)},error:()=>t(!1)}).attr("src","data:image/webp;base64,UklGRjIAAABXRUJQVlA4ICYAAACyAgCdASoCAAEALmk0mk0iIiIiIgBoSygABc6zbAAA/v56QAAAAA==")}))}}const jt=i(19755);class Ut extends J{constructor(t){super(t),t.format=u.WEBP}render(){return this.isRendered||(this.emit(o.PROGRESS),this.$el=jt(document.createElement("img")).addClass("player__webp").on("error",(()=>{this.emit(o.ERROR)})).on("load",(()=>{this.emit(o.READY)})).attr("src",this._player.source),super.render()),this}destroy(){this.isRendered&&this.$el.attr("src",st),super.destroy()}}class Ht{constructor(){this._supportTechnologies=new Map,this._ready=void 0,this._technologiesStorage=new Map}_loadSupportedTechnologiesStorage(){let t=X.LocalStorage.get(tt);return!(!((0,g.isObject)(t)&&"0.8"===t.v&&(0,g.isObject)(t.l)&&(0,g.isNumber)(t.t))||Number(t.t)+18e7<Date.now())&&((0,g.forEach)(t.l,((t,e)=>{a[e]&&((0,g.isBoolean)(t)||(0,g.isObject)(t))&&this._technologiesStorage.set(a[e],t)})),!0)}_saveSupportedTechnologiesStorage(){let t={l:{},v:"0.8",t:Date.now()};for(let[e,i]of this._technologiesStorage)t.l[e.valueOf()]=i;X.LocalStorage.set(tt,t)}async _getSupportedTechnologies(){let t;if(this._ready)return this._ready;t=this._loadSupportedTechnologiesStorage();for(let e of a.entries()){let t,i=Ht.getTechnologyByType(e);if(!i)throw new Error("Can't find technology "+e);t=new i,this._technologiesStorage.has(e)&&t.deserialize(this._technologiesStorage.get(e));const s=await t.supported;this._technologiesStorage.set(e,t.serialize()),s&&this._supportTechnologies.set(e,t)}return t||this._saveSupportedTechnologiesStorage(),this._supportTechnologies}static getTechnologyPlayerByType(t){switch(t){case a.APNG:return ft;case a.APNG_CANVAS:return Ft;case a.VIDEO:return ct;case a.VIDEO_CANVAS:return mt;case a.WEBP:return Ut;case a.GIF:return lt}throw new Error("Not found player technology for type "+t)}static getTechnologyByType(t){switch(t){case a.APNG:return gt;case a.APNG_CANVAS:return yt;case a.VIDEO:return ut;case a.VIDEO_CANVAS:return dt;case a.WEBP:return Nt;case a.GIF:return Q}throw new Error("Not found playback technology for type "+t)}getTechnologyInstanceByType(t){return this._supportTechnologies.get(t)}get technologies(){return this._ready?this._ready:this._ready=this._getSupportedTechnologies()}}var Vt=i(2355),Wt=i(5603);const qt=i(19755);class zt extends m.u1{constructor(t){super(),this._player=t,this.$parent=t.$els.player,this._adLoader=null,this._isPostollAutoPaused=!1,this._intersectionObserver=null,this.listenTo(s.core.ui,"visibilitychange",(()=>{const t=Vt.E.isShown,e=s.core.ui.elementInViewport(this.$el);this._onVisibilityChange(t&&e)})),this.listenTo(s.core.ui,"fullscreenchange",(async(t,e)=>{if(qt(e).closest(this.$parent).length){const e={status:t?"on":"off",view_time:await this.getCurrentTime()},i=this._player.el.dataset.subtype;i&&(e.type=i),this.emit(d.FULLSCREEN_CHANGE,e)}}))}render(){this.$el.on("mouseenter",(()=>{this.isMouseEnter=!0,setTimeout((()=>{this.isMouseEnter&&s.core.emit("video-iframe-enter")}),1500)})),this.$el.on("mouseleave",(()=>{this.isMouseEnter=!1}))}getCurrentTime(){return Promise.resolve(0)}set adLoader(t){this._adLoader=t}get adLoader(){return this._adLoader}initIntersectionObserver(){const t=!Wt.v,e=Boolean(this._intersectionObserver);if(t||e)return;s.core.ui.getHeaderHeight();this._intersectionObserver=new IntersectionObserver((t=>{t.length&&this._onVisibilityChange(t[0].isIntersecting)}),{rootMargin:"0px",threshold:.2}),this._intersectionObserver.observe(this.$parent.parent(".player")[0])}_onVisibilityChange(t){const e=this._getPostrollState(),i=e===c.PLAY,s=e===c.PAUSE;var n;t&&s&&this._isPostollAutoPaused&&(null===(n=this._adLoader)||void 0===n||n.setAdVolume(0),this._isPostollAutoPaused=!1,this._playPostroll());!t&&i&&(this._isPostollAutoPaused=!0,this._pausePostroll())}_playPostroll(){this._adLoader&&(this._getPostrollState()===c.PAUSE?this._adLoader.resumeAd():this._adLoader.playAd())}_pausePostroll(){this._adLoader&&this._adLoader.pauseAd()}_getPostrollState(){return this._adLoader&&c[this._adLoader.getAdPlayingState().toUpperCase()]||c.NONE}play(){return this.isShown||this.show(),this}stop(){return this.isShown&&this.hide(),this}destroy(){this.isDestroyed||(delete this._player,super.destroy())}_runAutoCloseTimer(t=1e3){return this.cancelTimeout("autoCloseAfterPause"),this.timeout("autoCloseAfterPause",t,(()=>{s.core.ui.elementInViewport(this._player.$el[0])?this._runAutoCloseTimer(t):this._player.stop()})),this}static addFrame(t){return qt(document.createElement("iframe")).attr("src","string"==typeof t?t:"_iframe-error").attr("width","100%").attr("height","100%").attr("frameborder","0").attr("webkitallowfullscreen",!0).attr("mozallowfullscreen",!0).attr("allowfullscreen",!0).attr("allow","clipboard-write")}}class Yt extends y.vp{constructor(){super(),this._supported=!0,this._ready=void 0}static canPlay(t){return!0}async _checkSupported(){return this._supported}get supported(){return this._ready?this._ready:this._ready=this._checkSupported()}get logo(){return this._logo||"video"}}const Gt=[/https?:\/\/www\.liveleak\.com/];class Kt extends Yt{static canPlay(t){return(0,g.some)(Gt,(e=>e.test(t)))}get supported(){return this._ready?this._ready:this._ready=Promise.resolve(this._supported)}}Kt.prototype._logo="LiveLeak";i(19755);class Xt extends zt{constructor(t){super(t),this._source=this._player.source}render(){return this.isRendered||(this.emit(d.READY),this.$el=zt.addFrame(this._source),super.render()),this}unmount(){return this.isMounted?(this.destroyAfterRemove=!1,this.$el=void 0,super.unmount(),this):this}}const Zt=[/^https?:\/\/rutube\.ru\/tracks\/[0-9]+\.html\?v=([0-9a-z]+)/,/^https?:\/\/rutube\.ru\/video\/([0-9a-z]+)/,/^https?:\/\/rutube\.ru\/play\/([0-9a-z]+)/];class Qt extends Yt{static canPlay(t){return(0,g.some)(Zt,(e=>e.test(t)))}get supported(){return this._ready?this._ready:(this._init(),this._ready=Promise.resolve(this._supported))}_init(){return this.listenTo(X.PostMessage.instance,"rutube.ru",(t=>{let e;try{e=JSON.parse(t.data)}catch(i){return!1}if("player:changeState"===e.type)switch(e.data.state){case"playing":this.emit("play",t.source);break;case"paused":this.emit("pause",t.source);break;case"stopped":this.emit("stop",t.source)}else"player:ready"===e.type&&this.emit("ready",t.source)})),this}}function Jt(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Qt.prototype._logo="Rutube";const te=i(19755);class ee extends zt{constructor(t){super(t),Jt(this,"_ready",!1),this._source=this._player.source+"?"+te.param({autostart:!0,sTitle:!1,sAuthor:!1})}render(){if(this.isRendered)return this;this.emit(d.PROGRESS);const t=this._getProvider();return this.listenTo(t,"play",this._onPlay),this.listenTo(t,"ready",this._onReady),this.listenTo(t,"pause",this._onPause),this.listenTo(t,"stop",this._onStop),this._player.original?(this.$el=this.$parent.find("iframe").attr("id",this._id),this._options.isMounted=!1):this.$el=zt.addFrame(this._source),super.render(),this}play(){return this.isShown?this._playerPlay():this.show(),this}pause(){return this._sendPlayerCommand("pause"),this}stop(){return this.isShown&&(this.hide(),this.ready=!1),this}unmount(){if(!this.isMounted)return this;this.destroyAfterRemove=!1,this.$el=void 0,super.unmount();const t=this._getProvider();return this.stopListening(t,"play",this._onPlay),this.stopListening(t,"ready",this._onReady),this.stopListening(t,"pause",this._onPause),this.stopListening(t,"stop",this._onStop),this}_getProvider(){return s.default.ui.player.getProviderInstanceByType(l.RUTUBE)}_onPlay(t){if(t!==this.$el[0].contentWindow)return!1;this.cancelTimeout("autoCloseAfterPause"),this.emit(d.PLAY)}_onPause(t){"story"!==s.default.initParams.pageName&&this._runAutoCloseTimer(6e4)}_onStop(t){this._runAutoCloseTimer(5e3)}_onReady(t){if(t!==this.$el[0].contentWindow)return!1;this.emit(d.READY),this.ready=!0,this._player.original||setTimeout((()=>{this._playerPlay()}),1e3)}_playerPlay(){this._sendPlayerCommand("play")}_sendPlayerCommand(t,e={}){var i,s;null===(i=this.el)||void 0===i||null===(s=i.contentWindow)||void 0===s||s.postMessage(JSON.stringify({type:"player:"+t,data:e}),"*")}set ready(t){this._ready=t}get ready(){return this._ready}}const ie=i(19755),se=[/^https?:\/\/(player\.)?vimeo\.com\/(video\/)?([0-9]+)/];class ne extends Yt{static canPlay(t){return(0,g.some)(se,(e=>e.test(t)))}get supported(){return this._ready?this._ready:this._ready=new Promise((t=>{if(window.Vimeo&&window.Vimeo.Player)return!0;ie.getScript("//player.vimeo.com/api/player.js",(()=>{t(Boolean(Vimeo&&Vimeo.Player))}))}))}}function re(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function oe(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}ne.prototype._logo="Vimeo";const ae=i(19755);class le extends zt{constructor(t){super(t),this._source=this._player.source+"?"+ae.param({api:1,autoplay:1,autohide:1,wmode:"opaque",showinfo:0,fs:1}),this._id=(0,g.uniqueId)("vi_v"),this._wasEnded=!1,this._wasSeeking=!1,this._wasStarted=!1,this._isFullscreenChanging=!1,this._isPlaying=!1,this._analyticsEventTimestamp=void 0}render(){return this.isRendered||(this.emit(d.PROGRESS),this._player.original?(this.$el=this.$parent.find("iframe").attr("id",this._id),this._options.isMounted=!1):this.$el=zt.addFrame(this._source),super.render()),this}mount(){return this.isMounted||(super.mount(),this._vimeo=new Vimeo.Player(this.el),this._vimeo.setColor("#8ac858"),this._vimeo.getDuration().then((t=>{this.duration=Number(t)})),this._vimeo.on("play",this._onPlay.bind(this)),this._vimeo.on("pause",this._onPause.bind(this)),this._vimeo.on("ended",this._onFinish.bind(this)),this._vimeo.on("seeked",this._onSeeked.bind(this)),this.listenTo(s.core.ui,"fullscreenchange",((t,e)=>{!this._isFullscreenChanging&&ae(e).closest(this.$el).length&&(this._isFullscreenChanging=!0,setTimeout((()=>{this._isFullscreenChanging=!1}),300))})),this.emit(d.READY)),this}getCurrentTime(){var t;return null===(t=this._vimeo)||void 0===t?void 0:t.getCurrentTime()}unmount(){return this.isMounted?(this._vimeo&&(this._vimeo.off("play"),this._vimeo.off("pause"),this._vimeo.off("ended"),this._vimeo.off("seeked"),delete this._vimeo),this.$el=void 0,super.unmount(),this):this}_emitPlayerEvent(t,e){const i=Date.now();i-this._analyticsEventTimestamp<150||(this._analyticsEventTimestamp=i,this._vimeo.getCurrentTime().then((i=>{this.emit(t,function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?re(Object(i),!0).forEach((function(e){oe(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):re(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({view_time:i},e))})))}_onPlay(){this.cancelTimeout("autoCloseAfterPause"),this._wasSeeking||this._isPlaying||this._isFullscreenChanging||this._emitPlayerEvent(d.PLAY),this._wasSeeking=!1,this._wasStarted=!0,this._isPlaying=!0}_onPause(t){!this._isFullscreenChanging&&1!==t.percent&&this._wasStarted&&this._isPlaying&&this._emitPlayerEvent(d.PAUSE),"story"!==s.core.initParams.pageName&&this._runAutoCloseTimer(6e4),this._isPlaying=!1}_onSeeked(t){this._wasEnded?this._wasEnded=!1:(this._isPlaying&&(this._wasSeeking=!0),this._emitPlayerEvent(d.TIMELINE_CLICK,{time_new:t.seconds}))}_onFinish(){this._wasEnded=!0,this._isPlaying=!1,this._runAutoCloseTimer(15e3)}_onPlayProgress(t){}play(){return this.cancelTimeout("autoCloseAfterPause"),this._player.original?this._vimeo.play():super.play(),this}stop(){return this._player.original?this._vimeo.unload():super.stop(),this}}const ue=i(19755),he=[/^https?:\/\/www\.youtube\.com\/embed\/([0-9A-Za-z_\-]+)/,/^https?:\/\/(www\.)?youtube\.com\/shorts\/([0-9A-Za-z_\-]+)/,/^https?:\/\/www\.youtube\.com.*v=([0-9A-Za-z_\-]+)/,/^https?:\/\/m\.youtube\.com.*v=([0-9A-Za-z_\-]+)/,/youtu\.be\/([0-9A-Za-z_\-]+)/];class ce extends Yt{constructor(){super(),this._readyResolve=null}static canPlay(t){return(0,g.some)(he,(e=>e.test(t)))}get supported(){return this._ready?this._ready:this._ready=new Promise(((t,e)=>{this._readyResolve=t,this._init()}))}get YT(){return window.YT}_onYoutubeReady(){if(!this._readyResolve)return this;this._readyResolve(this._supported=!0),this._readyResolve=void 0}_init(){let t=this._onYoutubeReady.bind(this);return window.YT?(window.YT.ready(t),this):(window.onYouTubeIframeAPIReady=t,ue.getScript("//www.youtube.com/iframe_api",(()=>{window.YT&&window.YT.ready(t)})),this)}}ce.prototype._logo="YouTube";var de=i(26216);const pe=new n.xs({ENDED:0,PLAYING:1,PAUSED:2,BUFFERING:3,CUED:4});var me=i(57852);function _e(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function ge(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const ve=i(19755);class fe extends zt{constructor(t){super(t),ge(this,"_eventsSequence",[]),ge(this,"_eventsTimer",null),ge(this,"_timeBeforeTimelineUpdate",0),ge(this,"_currentTime",0),ge(this,"_isFullscreenChanging",!1),ge(this,"_timeLineWasUpdated",!1),ge(this,"_onWebkitFullscreenChange",(()=>{this._restoreScrollPosition(),this._emitPlayerEvent(d.FULLSCREEN_CHANGE,{status:document.fullscreenElement?"on":"off"}),this._isFullscreenChanging=!0,setTimeout((()=>{this._isFullscreenChanging=!1}),1e3)})),ge(this,"_restoreScrollPosition",(()=>{if(!document.fullscreenElement){const t=()=>window.scroll(0,this._currentPosition);t(),setTimeout(t,0)}})),ge(this,"_onMessageCallback",(t=>{if(t.source===this._ytPlayer.getIframe().contentWindow)try{const{event:e,info:i}=JSON.parse(t.data);"infoDelivery"===e&&i&&void 0!==i.currentTime&&void 0===i.playerState&&void 0!==i.videoBytesLoaded&&this._currentTime!==i.currentTime&&setTimeout((()=>{this._currentTime=i.currentTime}))}catch(e){s.default.logger.log("youtube","error",e)}})),this._id=(0,g.uniqueId)("yt_v"),this._source=(0,g.last)(this._player.source.split("/")),this._currentPosition=null}render(){return this.isRendered||(this.emit(d.PROGRESS),this._player.original?(this.$el=this.$parent.find("iframe").attr("id",this._id),this._options.isMounted=!1):this.$el=ve(document.createElement("div")).attr("id",this._id),super.render()),this}mount(){if(this.isMounted)return this;super.mount();let t=s.default.ui.player.getProviderInstanceByType(l.YOUTUBE);return this._ytPlayer=new t.YT.Player(this._id,{width:"100%",height:"100%",videoId:this._source,events:{onReady:this._onYoutubePlayerReady.bind(this),onStateChange:this._onYoutubePlayerStateChange.bind(this)},playerVars:{rel:0,modestbranding:1,controls:2,showinfo:0,fs:"1",wmode:"opaque",autoplay:"1"}}),this._currentPosition=s.default.ui.scrollTop,window.addEventListener("webkitfullscreenchange",this._onWebkitFullscreenChange),window.addEventListener("fullscreenchange",this._restoreScrollPosition),window.addEventListener("message",this._onMessageCallback),this}unmount(){return this.isMounted?(this._ytPlayer&&(this._ytPlayer.destroy(),delete this._ytPlayer),super.unmount(),window.removeEventListener("webkitfullscreenchange",this._onWebkitFullscreenChange),window.removeEventListener("fullscreenchange",this._restoreScrollPosition),window.removeEventListener("message",this._onMessageCallback),this):this}getCurrentTime(){return Promise.resolve(this._ytPlayer.playerInfo.currentTime)}_onYoutubePlayerReady(){this._playing=!1,this.emit(d.READY)}_onPlayEventTriggered(){this._playing||(s.default.logger.log("youtube","play"),this._playing=!0,!this._timeLineWasUpdated&&this._emitPlayerEvent(d.PLAY)),this.cancelTimeout("autoCloseAfterPause"),this._timeLineWasUpdated=!1}_onPauseEventTriggered(){this._playing=!1,this._timeLineWasUpdated||this._isFullscreenChanging||this._emitPlayerEvent(d.PAUSE),this._isFullscreenChanging=!1,"story"!==s.default.initParams.pageName&&this._runAutoCloseTimer(6e4)}_onEndEventTriggered(){this._playing=!1,this._runAutoCloseTimer(15e3);!(s.default.initParams.isAdsDisabled||this.$parent.closest(".player").data("da"))&&this._player.duration>60&&this._initPostroll()}_emitPlayerEvent(t,e={}){const i=this._player.el.dataset.subtype;i&&(e.type=i),this.emit(t,function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?_e(Object(i),!0).forEach((function(e){ge(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):_e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({view_time:this._ytPlayer.playerInfo.currentTime},e))}_onYoutubePlayerStateChange(t){if(!t||(0,g.isUndefined)(t.data))return this;const e=t.data;if(this._eventsSequence=[...this._eventsSequence,e],1!==this._eventsSequence.length||e!==pe.PLAYING.value&&e!==pe.PAUSED.value||(this._timeBeforeTimelineUpdate=this._currentTime),!this._isFullscreenChanging&&((0,de.C)(this._eventsSequence,[pe.PAUSED.value,pe.BUFFERING.value])||(0,de.C)(this._eventsSequence,[pe.PAUSED.value,pe.PLAYING.value])))return this._timeLineWasUpdated=!0,this._emitPlayerEvent(d.TIMELINE_CLICK,{time_old:this._timeBeforeTimelineUpdate||0,time_new:this._ytPlayer.playerInfo.currentTime}),void(this._eventsSequence=[]);this._isFullscreenChanging&&(0,de.C)(this._eventsSequence,[pe.PAUSED.value,pe.PLAYING.value])?this._eventsSequence=[]:(clearTimeout(this._eventsTimer),e!==pe.BUFFERING.value&&(this._eventsTimer=setTimeout((()=>{switch(this._eventsSequence=[],e){case pe.PLAYING.value:this._onPlayEventTriggered();break;case pe.PAUSED.value:this._onPauseEventTriggered();break;case pe.ENDED.value:this._onEndEventTriggered()}}),300)))}_initPostroll(){if(!window.ya)return;const t=this.$parent.parent(".player"),e=t.data("bad");if(t.length){t.find(".player__adv")[0]&&t.find(".player__adv")[0].remove(),t.append('<video class="player__adv" controls></video>');const i=t.find(".player__adv")[0];s.default.ua.firefox&&document.fullscreenElement&&document.exitFullscreen(),Fi.loadPostrollVideo(i,t[0],e,!1).then((e=>{const n=e.createPlaybackController(i,t[0],{skipDelay:2,bufferFullTimeout:5e3});this.emit(d.AD_REQUEST,{type:me.L.VIDEO_END}),this.listenTo(s.default,"playerSpecialPlay",(()=>{this._pausePostroll()})),this.adLoader=n,n.subscribe("AdStopped",(()=>{s.default.logger.log("postroll","ad stopped playing"),this.$parent.removeClass("player__player_hide"),ve(i).remove()})),this._subscribeToEventsForAnalytics(n),document.fullscreenElement&&document.exitFullscreen(),this.$parent.addClass("player__player_hide"),n.playAd(),n.setAdVolume(0)})).catch((t=>{s.default.logger.error("postroll",t)}))}}_subscribeToEventsForAnalytics(t){t.subscribe("AdStarted",(()=>{this.emit(d.SHOW_AD,{type:me.L.VIDEO_END})})),t.subscribe("AdClickThru",(()=>{this.emit(d.CLICK_AD,{type:me.L.VIDEO_END})}))}play(){return this.cancelTimeout("autoCloseAfterPause"),this._player.original?this._ytPlayer&&(0,g.isFunction)(this._ytPlayer.playVideo)&&this._ytPlayer.playVideo():super.play(),this.initIntersectionObserver(),this}stop(){return this._player.original?this._ytPlayer&&(0,g.isFunction)(this._ytPlayer.stopVideo)&&this._ytPlayer.stopVideo():super.stop(),this}}const ye=[/^https?:\/\/(?:m\.)?vk\.com\/video(-?\d+_\d+)/,/^https?:\/\/(?:m\.)?vk\.com\/.*\?z=video(-?\d+_\d+)/,/^https?:\/\/vk\.com\/video_ext\.php/];class be extends Yt{static canPlay(t){return(0,g.some)(ye,(e=>e.test(t)))}get supported(){return this._ready?this._ready:this._ready=Promise.resolve(this._supported)}}be.prototype._logo="VK";class we extends zt{constructor(t){super(t),this._id=(0,g.uniqueId)("vk_v"),this._source=this._player.source+"&autoplay=1"}render(){return this.isRendered||(this.emit(d.PROGRESS),this._player.original?(this.$el=this.$parent.find("iframe").attr("id",this._id),this._options.isMounted=!1):this.$el=zt.addFrame(this._source),super.render()),this}mount(){return this.isMounted||(super.mount(),this.emit(d.READY)),this}unmount(){return this.isMounted?(this.$el=void 0,super.unmount(),this):this}}var Ee=i(12950);class Ae{constructor(){this._supportProviders=new Map,this._ready=void 0}async _getSupportedProviders(){if(this._ready)return this._ready;for(let t of l.entries()){let e,i=Ae.getProviderByType(t);if(!i)throw new Error("Can't find provider "+t);e=new i;await e.supported&&this._supportProviders.set(t,e)}return this._supportProviders}static getProviderPlayerByType(t){switch(t){case l.LIVELEAK:return Xt;case l.RUTUBE:return ee;case l.VIMEO:return le;case l.YOUTUBE:return fe;case l.VK:return we}throw new Error("Not found player technology for type "+t)}static getProviderByType(t){switch(t){case l.LIVELEAK:return Kt;case l.RUTUBE:return Qt;case l.VIMEO:return ne;case l.YOUTUBE:return ce;case l.VK:return be}throw new Error("Not found playback technology for type "+t)}getProviderInstanceByType(t){return this._supportProviders.get(t)}getProviderTypeBySource(t){for(let[e]of this._supportProviders){if(Ae.getProviderByType(e).canPlay(t))return e}}static getProviderTypeBySource(t){for(let e of l.entries()){if(Ae.getProviderByType(e).canPlay(t))return e}}static getVideoDetails(t){return Ee.cf.post("/ajax/gtpost_actions.php",{action:"get_video_info",url:t})}static getVideoFileDetails(t){let e=X.MemoryCacheStorage.getInstance("videoDetails"),i=String(t);if(e.has(i))return e.get(i);let s=Ee.cf.post("/ajax/gtpost_actions.php",{action:"get_video_file_info",fid:t});return s=s.then((t=>e.set(i,t.response.status===Ee.Wi?t.data:{}))),e.set(i,s)}get providers(){return this._ready?this._ready:this._ready=this._getSupportedProviders()}}i(44497);var Se=i(90312);function Pe(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Ce(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const Te=i(19755);class ke extends f{constructor(t={}){super(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Pe(Object(i),!0).forEach((function(e){Ce(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Pe(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({showControls:!0},t)),this._options.formats=new Map,this._queueTechnology=void 0,this._technologiesPriority=new Set,this._timeGifStartDownload=0,this._timeGifDownloaded=0,this._analyticsSending=!1,this._toggleBound=t=>{let e=t&&Te(t.target);if(e&&(e.closest(".player__save",this.$el).length||e.hasClass("player__try-again")))return this;t&&t.preventDefault&&t.preventDefault(),this.state===h.UNSTARTED&&(this._timeGifStartDownload=Date.now()),this.togglePlay()};const e=String(this.$el.data("source")||"");this.source=e.slice(0,e.indexOf("gif")),this.isProbe=Boolean(this.$el.data("probe")),this._setAvailableFormatsFromData(),this._setDimensionFromData(),this._setTechnologyPriority().then((()=>{this.show(),this.state=h.UNSTARTED,this._setNextTechnology(),this.playAfterInitialization&&!this.isProbe&&this.$el.is(":visible")&&this.play()})),this.isProbe||this.listenTo(s.default,"playerSpecialToggle",(t=>{t===this.eid&&this.togglePlay()}))}_updateDimension(){this._updateDimensionDesktop()}_updateDimensionDesktop(){if(!this.dimension)return;let t=2*s.default.ui.css.paddingLeft,e=this.$el.closest(".story__main"),i=e.width(),n=this.dimension.width,r=s.default.ui.windowHeight/10*7,o=this.dimension.height;const[a]=X.Utils.calculateAspectRatioFit(n,o,i,r,!1);e.hasClass("aflm__main")||this.$el.parent().toggleClass("story-block_padding_left",a+t<=i)}_updateDimensionMobile(){if(!this.dimension)return;let t=this.dimensionMode===r.COMMENT?this.$els.container.width()||150:this.$el.closest(".story__main").width();if(!t)return;let e=s.default.ui.windowWidth<1023?30:0,i=Math.floor(s.default.ui.screenHeight/10*7),n=this.dimension.height/this.dimension.width,[o,a]=X.Utils.calculateAspectRatioFit(t,t*n,t,i,!1);this.dimensionMode===r.STORY&&e&&(o<t?([o,a]=X.Utils.calculateAspectRatioFit(t,t*n,t-e,i,!1),this.$el.parent().toggleClass("story-block_padding_left",!0)):this.$el.parent().toggleClass("story-block_padding_left",!1))}render(){return this.isRendered||(this.$els.preview=this.$(".player__preview").eq(0),this.$els.player=this.$(".player__player").eq(0),this.$els.play=this.$(".player__play").eq(0),this.$els.label=this._prepareState(h.UNSTARTED),this._prepareState(h.LOADING).empty(),this.progress(),this.limitWidth=this.$el.hasClass("player_width_limit"),this._updateDimension(),this.dimensionMode===r.STORY&&this.listenTo(s.default.ui,"resize",(0,g.throttle)((()=>{this.animationFrame("resize",this._updateDimension)}),300)),this.$els.player.length||(this.$els.player=Te(document.createElement("div")).addClass("player__player player__player_hide").appendTo(this.$el)),this.$els.save=Te(document.createElement("a")).addClass("player__save").attr("href",this.getSourceByFormat(u.GIF)).attr("target","_blank").html(s.default.icon("ui__save","player")).appendTo(this._prepareState(h.PLAYING)),this.$el.click(this._toggleBound),super.render()),this}play(){return this.state!==h.UNSTARTED?this:this.isProbe?(this._toggleProbeMessage(!0),this):(this.technology||this._setNextTechnology(),this._currentPlayer&&this._currentPlayer.play(),this._updateDimension(),this._timeGifStartDownload=Date.now(),super.play(),this)}_sendAnalytics(){if(this._analyticsSending)return;this._analyticsSending=!0;const t=this._prepareAnalyticsParams();Se.c.getInstance().sendEvent("image_view",t),this._analyticsSending=!1}_prepareAnalyticsParams(){var t,e,i,n,r;let o,a,l;if(s.default.storage.gallery){l="gallery";const t=Te(s.default.storage.gallery.sourceElement);t.is(".story[data-story-id]")?o=t:a=t}else o=this.$el.closest(".story[data-story-id]"),a=this.$el.closest(".comment[data-id]");let u=Number((this.formats.get(this.format)/1024).toFixed(3));if(Number.isNaN(u)){const t=this.el.dataset.source,e=new XMLHttpRequest;e.open("HEAD",t,!1),e.send(null);const i=e.getResponseHeader("content-length");u=parseFloat((i/1048576).toFixed(3))}const h=null===(t=o)||void 0===t?void 0:t.data("story-id"),c=null===(e=a)||void 0===e?void 0:e.data("id"),d=o.data("subs-code");let p,m,_,g;if(h){p=o.data("comments"),m=Number(o.data("author-id"));const t=Te(".stories-feed__container").find(".story");t.length>0&&-1!==Te.inArray(o[0],t)&&(_=Te.inArray(o[0],t)+1)}c&&(m=Number(a.data("meta").match(/aid=(\d+)/)[1]));const v=(null!==(i=o)&&void 0!==i&&i.length?o:a).find('[data-type="gifx"]');return v.length>1&&(g=Te.inArray(this.el,v)+1),{"post_id!empty":null===(n=o)||void 0===n?void 0:n.data("story-id"),"comment_id!empty":null===(r=a)||void 0===r?void 0:r.data("id"),"comments!empty":p,author_id:m,"screen_index!empty":_,"type_i8!empty":d,list_f32:[Number(this.el.dataset.width),Number(this.el.dataset.height)],type:"gif",length:(this._timeGifDownloaded-this._timeGifStartDownload)/1e3,size:u,level:g,"component_name!empty":l}}stop(){return this.marks.has("error-isShown")&&this._toggleErrorLoading(!1),this.marks.has("probe-isShown")&&this._toggleProbeMessage(!1),this.state===h.UNSTARTED||(this.technology&&(this.technology=void 0,this._queueTechnology=void 0),this.state=h.UNSTARTED),this}_setDimensionFromData(){if(!this.$el)return this;let t={width:parseFloat(this.$el.data("width"))||0,height:parseFloat(this.$el.data("height"))||0};return t.width&&(this.dimension=t),this}_setAvailableFormatsFromData(){u.entries().forEach((t=>{let e=this.$el.data(`size-${t.valueOf()}`);e&&this._options.formats.set(t,e)}))}_updateStateFileSize(){let t=this.formats.get(this.format)||0;return t<=0||(this.$els.label.empty(),this.$els.label.append(s.default.i18n("player.providers.gif")),this.$els.label.append(Te(document.createElement("span")).addClass("player__label player__label_separator").html("&#x25CF;")),this.$els.label.append(t>1e3?(t/1024).toFixed(1)+" Мб":t+" Кб"),this.$els.states[h.UNSTARTED].show()),this}async _setTechnologyPriority(){return(await s.default.ui.player.technologies).forEach(((t,e)=>{t.canPlay(this._options.formats)&&this._technologiesPriority.add(e)})),this}_setNextTechnology(t){return this.technology=t||this._getNextTechnology(),this.technology||(this._queueTechnology=void 0,this._currentPlayer=void 0,this._toggleErrorLoading(!0)),this}_getNextTechnology(){return this._queueTechnology||(this._queueTechnology=this._technologiesPriority.values()),this._queueTechnology.next().value}_downgradeTechnology(){return s.default.logger.log("player","downgrade"),this.technology!==a.GIF&&this._technologiesPriority.delete(this.technology),this._setNextTechnology(),this}_toggleErrorLoading(t){let e=this.marks.has("error-isShown");return(t=(0,g.isBoolean)(t)?t:!e)===e?this:(this.$els.player.toggleClass("player__player_error_yes",t),t?this.marks.set("error-isShown",!0):this.marks.delete("error-isShown"),t||this.$els.errorOverlay?this.$els.errorOverlay?(this.$els.errorOverlay.toggle(t),this):(this.$els.errorOverlay=Te('<div class="player__error-overlay">\n\t<div class="player__error-message">\n\t\t<p>Непредвиденная ошибка</p>\n\n\t\t<p><button class="button button player__try-again">Попробовать еще раз?</button></p>\n\t</div>\n</div>\n').appendTo(this.$el),this.$els.errorOverlay.click((t=>{t.preventDefault(),t.stopPropagation(),this.stop()})).find(".player__try-again").click((t=>{t.preventDefault(),t.stopPropagation(),this.stop().play()})),this):this)}get playAfterInitialization(){return this._options.playAfterInitialization}set playAfterInitialization(t){return this._options.playAfterInitialization=Boolean(t)}get format(){return this._options.format}set format(t){this._options.format=u[t]||u.GIF,this._updateStateFileSize()}get technology(){return this._options.technology}set technology(t){if(t=a[t],this._options.technology===t)return this._options.technology;if(this._currentPlayer&&(this._currentPlayer.destroy(),this._currentPlayer=void 0),!t)return this._options.technology=t;let e=Ht.getTechnologyPlayerByType(t);return this._currentPlayer=new e(this),this.listenTo(this._currentPlayer,y.bB,this._playerEvent),this._options.technology=t,this.state!==h.UNSTARTED&&this._currentPlayer.play(),t}_playerEvent(t,e){return o[t]?t===o.ERROR?(this._downgradeTechnology(),this):t===o.PROGRESS?(this.state=h.LOADING,this.progress(e),this):(t!==o.PLAY&&t!==o.READY||(this._timeGifDownloaded=Date.now(),this._sendAnalytics(),this.emit("gifx-play")),this.state=h.PLAYING,this):this}getSourceByFormat(t){return this._options.source+t.valueOf()}get source(){return this.getSourceByFormat(this.format)}set source(t){return this._options.source=String(t)}get formats(){return this._options.formats}}i(85844),i(17727);var De=i(90477),Ie=i(36005);var $e=i(88358),Oe=i(26251),xe=(i(85827),i(6393)),Be=i(58749),Le=i(12182),Me=i(19755),Fe=i.n(Me),Re=i(52764);function Ne(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function je(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ne(Object(i),!0).forEach((function(e){Ue(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ne(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Ue(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class He{constructor(t,e=null){Ue(this,"_postId",void 0),Ue(this,"_commentId",void 0),Ue(this,"_comments",void 0),Ue(this,"_commentAuthorId",void 0),Ue(this,"_subscode",0),Ue(this,"_level",void 0),Ue(this,"_rating",void 0),Ue(this,"_authorId",void 0),Ue(this,"_closestComment",void 0),Ue(this,"_componentName",void 0),Ue(this,"_extFeedScreen",void 0),this._$player=t,this._currentPlayer=e,this._getStaticAnalyticsParams()}sendAnalytics(t,e){const i=nt[t];if(!i)return;t===d.TIMELINE_CLICK&&(e.view_time=void 0);const s=new Set(["view_time","time_old","time_new","length"]);for(const[o,a]of Object.entries(e))s.has(o)&&e[o]&&(e[o]=Math.floor(a));const n={"rating!undefined":this._rating,"post_id!empty":this._postId,"comment_id!empty":this._commentId,"comment_author_id!empty":this._commentAuthorId,"comments!empty":this._comments,"type_i8!empty":this._subscode,"author_id!empty":this._authorId,post_donation:this._hasDonateButton,"component_name!empty":this._componentName,"screen!empty":this._extFeedScreen};if(t!==d.SHOW_AD&&t!==d.CLICK_AD&&t!==d.AD_REQUEST&&t!==d.REDEEMED_AD_SHOWED)Se.c.getInstance().sendEvent(i,je(je({"level!empty":this._level},n),e));else{let t=Le.Q.getScreenIndex(this._postId.toString());t=t>0?t:"";let s={};var r;this._currentPlayer&&(s={length:null===(r=this._$player)||void 0===r?void 0:r.data("duration"),position:this._currentPlayer._options.position,list:[this._currentPlayer.videoWidth,this._currentPlayer.videoHeight,Number(!this._currentPlayer.isVideoMuted)],sound_on:Number(!this._currentPlayer.isMuted),sound_volume:(100*this._currentPlayer.volume).toFixed(),mode:this._currentPlayer.av1Link?"av1":"webm"}),Se.c.getInstance().sendEvent(i,je(je(je({"screen_index!empty":t},n),s),e))}}_getStaticAnalyticsParams(){var t,e,i,n,r,o;let a=this._$player.closest(".story[data-story-id]:not(.story_comment)");if(s.core.storage.gallery&&(this._componentName="gallery",a.length||s.core.storage.gallery.sourceElement.classList.contains("story_comment")||(a=Fe()(s.core.storage.gallery.sourceElement))),this._postId=null===(t=a)||void 0===t?void 0:t.data("story-id"),this._subscode=null===(e=a)||void 0===e?void 0:e.data("subs-code"),this._comments=null===(i=a)||void 0===i?void 0:i.data("comments"),this._hasDonateButton=(0,Re.v)(a.get(0)),this._componentName=null===(n=a)||void 0===n?void 0:n.data("component-name"),this._postId)return this._rating=Number(a.data("rating")),this._authorId=Number(a.data("author-id")),void(this._extFeedScreen=a.data("ext-feed"));const l=this._getCommentMeta();(0,Be.x)(l)||(this._rating=Number(l.rating),this._level=l.depth?Number(l.depth)+1:null,this._commentId=Number(l.id)||Number(null===(r=this.closestComment)||void 0===r?void 0:r.data("id")),this._commentAuthorId=Number(l.authorId),this._authorId=Number(l.storyAuthorId),this._postId=Number(l.storyId),this._subscode=Number(this._$player.data("subs-code"))||Number(null===(o=this.closestComment)||void 0===o?void 0:o.data("story-subs-code")))}_getCommentMeta(){var t;const e=this._$player.data("comment-meta")||(null===(t=this.closestComment)||void 0===t?void 0:t.data("meta"));if(!e)return{};const i=e.split(";").reduce(((t,e)=>{const[i,s]=e.split("=");return t[xe.hb[i]]=s||!0,t}),{});return i.id||(i.id=this._$player.data("comment-id")),i}get closestComment(){if(this._closestComment)return this._closestComment;if(this._closestComment=this._$player.closest(".comment[data-meta]"),!this._closestComment.length&&s.core.storage.gallery){const t=Fe()(s.core.storage.gallery.sourceElement);t.is(".comment[data-meta]")&&(this._closestComment=t)}return this._closestComment}}var Ve=i(7016);const We={"hot-stories":{id:"adfox_d_feed_hot_postroll",params:{p1:"ddebp",p2:"ittx"}},"best-stories":{id:"adfox_d_feed_best_postroll",params:{p1:"ddebr",p2:"ittx"}},"new-stories":{id:"adfox_d_feed_new_postroll",params:{p1:"dbeuh",p2:"hbee"}},"tag-search":{id:"adfox_d_feed_tag_postroll",params:{p1:"ddebn",p2:"ittx"}},story:{id:"adfox_d_story_postroll",params:{p1:"daqsu",p2:"ittx"}},default:{id:"adfox_d_feed_all_postroll",params:{p1:"daqsu",p2:"ittx"}}};var qe=i(87864);var ze,Ye,Ge=i(27478);function Ke(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t[t.NONE=0]="NONE",t[t.VIEW=1]="VIEW",t[t.REDEEMED_VIEW=2]="REDEEMED_VIEW"}(ze||(ze={}));class Xe{constructor(t){Ke(this,"analyticsRedeemedViewTimer",null),Ke(this,"analyticsViewState",ze.NONE),this.el=t,this.init()}setPlayerAnalytics(t){this.playerAnalytics=t}onAdLoad(){this.sendEvent(d.AD_REQUEST)}onAdLoaded(){this.sendEvent(d.AD_LOAD)}onAdHide(){this.stopRedeemedViewTimer(),this.analyticsViewState=ze.NONE}init(){this.el.addEventListener("click",(t=>{t.target.classList.contains("player-ad__skip")||this.sendEvent(d.CLICK_AD)}));let t=!1,e=!1;const i=this.el.querySelector(".player-ad__ad-container");i?((0,M.m)(i,(i=>{t=i.isIntersecting&&i.intersectionRatio>=Ge.nT,e=i.isIntersecting&&i.intersectionRatio>=Ge.CX,t&&this.analyticsViewState===ze.NONE&&(this.sendEvent(d.SHOW_AD),this.analyticsViewState=ze.VIEW),this.analyticsViewState===ze.VIEW&&(e?this.startRedeemedViewTimer():this.stopRedeemedViewTimer())}),{threshold:[Ge.nT,Ge.CX]}),document.addEventListener("visibilitychange",(()=>{this.analyticsViewState===ze.VIEW&&e&&("visible"===document.visibilityState?this.startRedeemedViewTimer():this.stopRedeemedViewTimer())}))):console.error("ad-container not found")}startRedeemedViewTimer(){this.analyticsViewState!==ze.VIEW||this.analyticsRedeemedViewTimer||(this.analyticsRedeemedViewTimer=setTimeout((()=>{this.analyticsRedeemedViewTimer=null,this.analyticsViewState=ze.REDEEMED_VIEW,this.sendEvent(d.REDEEMED_AD_SHOWED)}),Ge.Pd))}stopRedeemedViewTimer(){this.analyticsRedeemedViewTimer&&(clearTimeout(this.analyticsRedeemedViewTimer),this.analyticsRedeemedViewTimer=null)}sendEvent(t){var e;const i={type:me.L.VIDEO_END,content_type:"pikabu"};t!==d.SHOW_AD&&t!==d.REDEEMED_VIEW||(i.user_rate=1),null===(e=this.playerAnalytics)||void 0===e||e.sendAnalytics(t,i)}}function Ze(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Qe(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ze(Object(i),!0).forEach((function(e){Je(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ze(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Je(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t[t.NONE=0]="NONE",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ERROR=3]="ERROR"}(Ye||(Ye={}));class ti{static getInstance(){return ti.instance||(ti.instance=new ti),ti.instance}constructor(){var t;Je(this,"isShowing",!1),Je(this,"adfoxState",Ye.NONE),Je(this,"iteration",0),this.adConfig=this.getAdConfig(),this.el=(0,qe.m)(function(t){var e,i="";return i+'<div class="player-ad">\n\t<div class="player-ad__ad-container">\n\t\t<div class="player-ad__ad" id="'+(null==(e=t.adfoxBannerId)?"":e)+'"></div>\n\t</div>\n\t<div class="player-ad__buttons">\n\t\t<button class="player-ad__skip pkb-normal-btn pkb-normal-btn_small pkb-normal-btn_gray">Пропустить</button>\n\t</div>\n</div>\n'}({adfoxBannerId:this.adConfig.id})),this.adEl=this.el.querySelector(".player-ad__ad"),this.adEl.dataset.code=JSON.stringify(this.adConfig.params),this.skipButton=this.el.querySelector(".player-ad__skip"),null===(t=this.skipButton)||void 0===t||t.addEventListener("click",(()=>this.onSkipButtonClick())),document.body.append(this.el),this.analytics=new Xe(this.el)}preload(t){this.analytics.setPlayerAnalytics(t),this.isShowing&&this.hideDisplayedBanner(),this.adfoxState!==Ye.LOADED&&this.loadAdfox()}show(t){t.append(this.el);const e=this.adEl.offsetHeight,i=t.offsetHeight;if(this.isShowing=!0,e+64>i){this.el.classList.add("player-ad_shrunk");const t=Math.min(1,Math.max(.7,(i-48)/e));this.adEl.style.setProperty("transform",`scale(${t})`)}else this.el.classList.remove("player-ad_shrunk"),this.adEl.style.removeProperty("transform");return requestAnimationFrame((()=>{this.isShowing&&this.el.classList.add("show")})),setTimeout((()=>{this.isShowing&&(this.skipButton.style.opacity="1")}),2e3),new Promise((t=>{this.onBannerHide=t}))}hide(){this.isShowing&&(this.hideDisplayedBanner(),setTimeout((()=>{this.loadAdfox()})))}getAdConfig(){var t,e,i,n;let r=s.core.initParams.pageName;"search"===r&&(null!==(t=s.core.config("modules.searchTags"))&&void 0!==t&&t.length||null!==(e=s.core.config("modules.searchFilters"))&&void 0!==e&&null!==(i=e.tags)&&void 0!==i&&i.length)&&(r="tag-search");const o=We[r]||We.default,a=null===(n=window.YaHeaderBiddingSettings)||void 0===n?void 0:n.adUnits.find((t=>t.code===o.id));return Qe(Qe({},o),{},{hbConfig:a})}hideDisplayedBanner(t=!1){var e;this.isShowing&&(this.isShowing=!1,this.analytics.onAdHide(),document.body.append(this.el),this.el.classList.remove("show"),this.skipButton.style.opacity="0",null===(e=this.onBannerHide)||void 0===e||e.call(this,t),this.onBannerHide=void 0)}onSkipButtonClick(){this.hideDisplayedBanner(!0),this.loadAdfox()}async loadAdfox(){if(this.adfoxState===Ye.LOADING)return;const t=this.adfoxState!==Ye.NONE;if(this.adfoxState=Ye.LOADING,this.analytics.onAdLoad(),await(0,q.y)(),t){const t=this.adEl.id;try{var e;null===(e=window.Ya)||void 0===e||e.adfoxCode.destroy(t)}catch(n){}}this.iteration++;const i=this.adConfig.id+(this.iteration>1?`_${this.iteration}`:"");this.adEl.id=i;const s=this.iteration>1?this.adConfig.hbConfig:null;s?window.Ya.adfoxCode.hbCallbacks.push((()=>{window.Ya.headerBidding.pushAdUnits(Qe(Qe({},s),{},{code:i})),this.adfoxCodeCreate()})):this.adfoxCodeCreate()}adfoxCodeCreate(){window.yaContextCb.push((()=>{window.Ya.adfoxCode.create({ownerId:260477,containerId:this.adEl.id,params:this.adConfig.params,onLoad:()=>{this.adfoxState=Ye.LOADED,this.analytics.onAdLoaded()},onError:()=>this.adfoxState=Ye.ERROR})}))}get isPreloaded(){return!this.isShowing&&this.adfoxState===Ye.LOADED}}let ei,ii,si;function ni(){return ei}function ri(){var t;return void 0===ii&&MediaSource?ii=MediaSource.isTypeSupported('video/mp4; codecs="av01.0.00M.08, opus"'):null!==(t=ii)&&void 0!==t&&t}function oi(){var t;return void 0===si&&MediaSource?si=MediaSource.isTypeSupported('video/webm; codecs="vp9"'):null!==(t=si)&&void 0!==t&&t}var ai=i(53056);let li,ui;function hi(){return void 0===ui?ui="maybe"===document.createElement("video").canPlayType("application/vnd.apple.mpegURL"):ui}function ci(){if("boolean"==typeof li)return li;const t=self.SourceBuffer||self.WebKitSourceBuffer,e=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return li=Boolean(e)}var di=i(81143),pi=i(58330);var mi=i(10370),_i=i(25883);function gi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function vi(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const fi="pkb_vr",yi=50;function bi(t,e,i,n,r,o,a){var l;const u=pi.S.getInstance().get("UITextArea"),h=pi.S.getInstance().get("UIForm"),c=(0,mi.r)('<form class="video-report">\n    <div class="video-report__content">\n        <label><input type="radio" name="issue" value="slow" checked><span>Видео загружается медленно или рывками</span></label>\n        <label><input type="radio" name="issue" value="not-loaded"><span>Видео не запускается</span></label>\n        <label><input type="radio" name="issue" value="stuck"><span>Видео загружается до определенного момента и останавливается</span></label>\n        <label><input type="radio" name="issue" value="bad-sound"><span>В видео есть проблемы со звуком</span></label>\n        <label><input type="radio" name="issue" value="no-video"><span>У видео есть звук, но нет изображения</span></label>\n        <label><input type="radio" name="issue" value="other"><span>Иные проблемы с воспроизведением</span></label>\n        <label><input type="radio" name="issue" value="custom"><span>Описать проблему</span></label>\n        <textarea class="input__input" rows="1" name="message" placeholder="Добавить комментарий"></textarea>\n    </div>\n    <div class="video-report__submit">\n        <button class="button_medium button_success" type="submit">Отправить</button>\n        <button class="button_medium" type="reset">Отмена</button>\n    </div>\n</form>').querySelector("form");if(!c)return;let d;d=new di.L({header:"Сообщить о проблеме с видео",isHeaderLeftAlign:!0,content:c}),d.$els.header.addClass("popup__header_video-report");const p=new h(c),m=new u(c.querySelector("textarea")),_=p.getUIElement("issue","custom");m.on("focus",(()=>{_&&(_.checked=!0)})),p.on("change",(()=>{"custom"!==p.serialize().issue&&m.value&&(m.value="")})),_.el.addEventListener("click",(()=>m.focus())),p.on("submit",(l=>{l.preventDefault();const u=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?gi(Object(i),!0).forEach((function(e){vi(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):gi(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({story_id:t,position:e,current_time:r,video_format:(o?"shaka-":"")+i,video_url:n,is_shaka:o},p.serialize());d.hide(),u.video_url&&u.video_format&&("custom"!==u.issue&&delete u.message,s.core.ui.toasts.add("video-report",{content:"Спасибо! Переход к альтернативному формату"}),function(t){var e,i,s;const n=new Set(null===(e=localStorage)||void 0===e||null===(i=e.getItem(fi))||void 0===i?void 0:i.split(",").map((t=>parseInt(t,36))).filter((t=>Number.isInteger(t)))),r=(0,_i.k)(t);n.delete(r),n.add(r),null===(s=localStorage)||void 0===s||s.setItem(fi,Array.from(n).slice(-yi).map((t=>t.toString(36))).join(","))}(n),Ee.cf.post("/ajax.php?route=video-report",u),p.reset(),a&&a())})),null===(l=c.querySelector('button[type="reset"]'))||void 0===l||l.addEventListener("click",(()=>d.hide())),d.show()}function wi(t){var e,i;const s=new Set(null===(e=localStorage)||void 0===e||null===(i=e.getItem(fi))||void 0===i?void 0:i.split(",").map((t=>parseInt(t,36))).filter((t=>Number.isInteger(t)))),n=(0,_i.k)(t);return s.has(n)}const Ei="/pl.mpd";var Ai=i(10414);const Si=(0,Ai.I)((async()=>{try{const{MediaPlayer:t}=await i.e(535).then(i.t.bind(i,35176,23));ei=t}catch(t){s.core.logger.error("video",t)}}));let Pi;function Ci(){return Pi}const Ti="/pl.m3u8";const ki=(0,Ai.I)((async()=>{try{const{default:t}=await i.e(111).then(i.bind(i,93041));Pi=t}catch(t){s.core.logger.error("video",t)}}));var Di=i(39844);let Ii;function $i(t,e,i){const n=Ii;if(!("MediaSource"in window)||!n||s.core.ua.ios||!t&&!e&&!i||i&&wi(i+Ei)||e&&wi(e+Ei)||t&&wi(t+Ti))return;let r,o;if(i&&ri()?(r="dash-av1",o=i+Ei):e&&oi()?(r="dash-webm",o=e+Ei):t&&!s.core.ua.firefox&&ci()&&(r="hls",o=t+Ti),r&&o)try{const t=new n;return t.source=o,t.type=r,null==t||t.configure({streaming:{retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4},rebufferingGoal:2,bufferingGoal:10,bufferBehind:20,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,gapDetectionThreshold:.5,gapJumpTimerTime:.25,durationBackoff:1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0,inaccurateManifestTolerance:2,lowLatencyMode:!1,autoLowLatencyMode:!1,forceHTTPS:!1,preferNativeHls:!1,updateIntervalSeconds:1,dispatchAllEmsgBoxes:!1,observeQualityChanges:!1,maxDisabledTime:30,parsePrftBox:!1,segmentPrefetchLimit:0,liveSync:!1,liveSyncMaxLatency:1,liveSyncPlaybackRate:1.1},abr:{enabled:!0,useNetworkInformation:!0,defaultBandwidthEstimate:1e6,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictToElementSize:!1,restrictToScreenSize:!1,ignoreDevicePixelRatio:!1,clearBufferSwitch:!1,safeMarginSwitch:0}}),t}catch(a){s.core.logger.error("video",a)}}(0,Ai.I)((async()=>{try{t=await i.e(472).then(i.t.bind(i,81123,23)),Ii=t.Player}catch(e){s.core.logger.error("video",e)}var t}));var Oi=i(20817),xi=i(28524),Bi=i(66447);function Li(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Mi(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Fi extends f{static get volumeSettings(){return this._settings||(this._settings=new De.Lo({volume:this.parseVolume(),volumeBeforeMute:this.parseVolumeBeforeMute()}),this._settings.on(De.u$.CHANGE,(()=>{X.LocalStorage.set(it,{vo:this._settings.data.volume,vobm:this._settings.data.volumeBeforeMute})}))),this._settings.data}constructor(t){if(super((0,g.defaults)(t,{showControls:!0})),Mi(this,"spinnerStats",void 0),Mi(this,"videoType",void 0),Mi(this,"_contextmenu",void 0),Mi(this,"_contextMenuCallback",(t=>{let e=this._contextmenu;if(!e){var i,n,r;e=this._contextmenu=new $e._({content:`\n\t\t\t\t\t<div class="popup-menu popup-menu_dots-menu">\n\t\t\t\t\t\t<a class="popup-menu__item"\n\t\t\t\t\t\t\tdata-role="save" target="_blank"\n\t\t\t\t\t\t\thref="${this.source+".mp4"}"\n\t\t\t\t\t\t\tdownload>Сохранить видео</a>\n\t\t\t\t\t\t<div class="popup-menu__item" data-role="pip">Картинка в картинке</div>\n\t\t\t\t\t\t<div class="popup-menu__item" data-role="downgrade">Альтернативный плеер</div>\n\t\t\t\t\t</div>\n\t\t\t\t`,showArrow:!1,direction:$e.Lh.BOTTOM,alignment:$e.SE.START});const t=e.content.get(0);null===(i=t.querySelector('[data-role="save"]'))||void 0===i||i.addEventListener("click",(()=>e.hide())),null===(n=t.querySelector('[data-role="pip"]'))||void 0===n||n.addEventListener("click",(()=>{this.els.video.requestPictureInPicture(),e.hide()})),null===(r=t.querySelector('[data-role="downgrade"]'))||void 0===r||r.addEventListener("click",(()=>{e.hide(),this._technologyDowngrade()}))}t.preventDefault(),e.target={offset:{top:s.core.ui.scrollTop+t.clientY,left:s.core.ui.scrollLeft+t.clientX},height:1,width:1},e.show()})),Mi(this,"_removeUserInteractionAfterDelay",(0,g.debounce)((()=>{var t;this.isDestroyed||null===(t=this.$el)||void 0===t||t.removeClass("player_user-interaction")}),3e3)),Mi(this,"_onUserInteraction",(0,g.throttle)((()=>{this.isDestroyed||(this.$el.addClass("player_user-interaction"),this._removeUserInteractionAfterDelay())}),200)),Mi(this,"_removeVolumeInteractionAfterDelay",(0,g.debounce)(this._removeVolumeInteraction,3e3)),Mi(this,"_onVolumeInteraction",(0,g.throttle)((()=>{this._addVolumeInteraction(),this._removeVolumeInteractionAfterDelay()}),200)),Mi(this,"_sendAnalyticsVolumeChangedDebounced",(0,g.debounce)((()=>this._sendAnalytics(d.SOUND_CHANGE)),300)),Mi(this,"_addVolumeInteraction",(()=>{this.$els.volume.container.addClass("player__volume-container_interaction")})),Mi(this,"_removeVolumeInteraction",(()=>{!this._volumeBtnHovered&&this.$els.volume.container.removeClass("player__volume-container_interaction")})),Mi(this,"_togglePlay",(()=>{const t=this.state;!this.isPlayed||t!==h.PLAYING&&t!==h.WAITING_RESOLVED_PLAY?this.play():this.pause()})),Mi(this,"_cancelTechnologyDowngrade",(()=>this.cancelTimeout("downgrade"))),Mi(this,"_technologyAutoDowngrade",(()=>{this._options.dashAv1||this._options.dashWebm||this._options.hls})),Mi(this,"_technologyDowngrade",(()=>{var t;if(this.shakaPlayer)this.shakaPlayerIgnore=!0,null===(t=this.shakaPlayer)||void 0===t||t.destroy();else if(this._options.dashAv1||this._options.dashWebm){var e;delete this._options.dashAv1,delete this._options.dashWebm,delete this.videoType,delete this.currentSrc,null===(e=this.dashPlayer)||void 0===e||e.destroy()}else{if(!this._options.hls)return;var i;delete this._options.hls,delete this.videoType,delete this.currentSrc,null===(i=this.hlsPlayer)||void 0===i||i.detachMedia()}delete this.spinnerStats,this.$els.player.remove(),this.$els.loader.remove(),delete this.$els.player,this.stop(),this.play()})),Mi(this,"_loadHandler",(()=>{var t;if(this.spinnerStats)return;this.spinnerStats={lastViewStarted:Date.now(),playingStartTime:0,lagStarted:0,lags:[]},this.timeout("downgrade",5e3,this._technologyAutoDowngrade);let e=0,i=!1;const s=null===(t=this.els)||void 0===t?void 0:t.video;s&&this.interval("spinner-watching",50,(()=>{if(!this.spinnerStats)return;const t=s.paused,n=s.currentTime,r=i;i=n<e+.03&&!t,e=n,this.spinnerStats&&!this.spinnerStats.playingStartTime&&n>0&&(this.spinnerStats.playingStartTime=Date.now()),r!==i&&(i&&(this.spinnerStats.lagStarted=Date.now()),!i&&this.spinnerStats.lagStarted&&(this.spinnerStats.lags.push(Date.now()-this.spinnerStats.lagStarted),this.spinnerStats.lagStarted=0))}))})),Mi(this,"_stopSpinnerStats",(()=>{var t;const e=null===(t=this.els)||void 0===t?void 0:t.video;this.cancelInterval("spinner-watching"),this.cancelTimeout("downgrade"),e.removeEventListener("loadstart",this._loadHandler),e.removeEventListener("canplay",this._loadHandler),e.removeEventListener("canplaythrough",this._cancelTechnologyDowngrade)})),this._setVideoDetailFromData(),this.isProbe)return this.show(),void(this.state=h.UNSTARTED);this._adLoader=null,this._intersectionObserver=null,this._isIntersecting=!1,this._isPostollAutoPaused=!1,this._isMobileView=!1,this._timeBeforePlayerSpecialToggle=null,this._volumeBtnHovered=!1,this._isFullscreenChanging=!1,this._bufferedAmount=0,this._isBannerShown=!1,this._bannerLastShowTime=0,this.listenTo(s.core,"playerSpecialPlay",(t=>{t!==this.eid&&(this.$els.player.length&&!this.isAdShown&&(this.volume=Fi.volumeSettings.volume),!this.isPlayed||this.isAutoplaying||this.state!==h.PLAYING||x.I.isFullScreen||this.stop(),this._isBannerShown&&ti.getInstance(this.bannerType).hide())})),this.listenTo(s.core,"playerSpecialToggle",(t=>{t===this.eid&&(this._timeBeforePlayerSpecialToggle?this._timeBeforePlayerSpecialToggle=null:this._timeBeforePlayerSpecialToggle=this.currentTime,this.togglePlay())})),this.listenTo(s.core.ui,"fullscreenchange",((t,e)=>{Fe()(e).closest(this.$el).length&&(this.isFullScreen=t,this._sendAnalytics(d.FULLSCREEN_CHANGE,{status:t?"on":"off"}),this._isFullscreenChanging=!0,setTimeout((()=>{this._isFullscreenChanging=!1}),500))})),this.listenTo(s.core.ui,"visibilitychange",(()=>{const t=Vt.E.isShown,e=this._isIntersecting;this._onVisibilityChange(t&&e)})),this._showCurrentTime=!1,this.show(),this.state=h.UNSTARTED}render(){var t;if(this.isRendered)return this;const e=()=>setTimeout((()=>this.play()));return this.$els.preview=this.$(".player__preview").eq(0).on("click",e),this.$els.player=this.$(".player__player").eq(0),this.$els.play=this.$(".player__play").eq(0).on("click",e),this.$els.label=this._prepareState(h.UNSTARTED),this.limitWidth=this.$el.hasClass("player_width_limit"),this.$els.label.append(s.core.i18n("player.providers.pikabu")),this.$els.label.append(Fe()(document.createElement("span")).addClass("player__label player__label_separator").html("&#x25CF;")),this.$els.label.append((0,Oi.i)(this.duration)),this.$els.soundHint=this._createSoundHint(),this.$els.label.append(this.$els.soundHint),this._prepareState(h.LOADING).empty(),null!==(t=this._options.context)&&void 0!==t&&t.isPreview||Fe()('<div class="player__report" aria-label="Сообщить о проблеме с видео"></div>').append(s.core.icon("ui__ic_warning_2_16")).toggleClass("hint",!0).on("click",(()=>{var t;return bi(this.storyId,this.getOption("position"),this.videoType,this.currentSrc||(null===(t=this.els)||void 0===t?void 0:t.video.currentSrc),this.currentTime,Boolean(this.shakaPlayer),this._technologyDowngrade)})).appendTo(this.$el),this._playerAnalytics=new He(this.$el,this),this.state=h.UNSTARTED,super.render(),this}_initIntersectionObserver(){const t=!Ve.v,e=Boolean(this._intersectionObserver);if(t||e)return;const i=s.core.ui.getHeaderHeight(),n=this._isMobileView?`-${i}px`:"0px";this._intersectionObserver=new IntersectionObserver((t=>{t.length&&(this._isIntersecting=t[0].intersectionRatio>=.2,this._onVisibilityChange(this._isIntersecting))}),{rootMargin:n,threshold:[.2,0]}),this._intersectionObserver.observe(this.el)}_initAutoplayOptimizerObserver(){var t;if(!s.core.initParams.isVideoAutoplayMode||this.dashPlayer||this.hlsPlayer)return;let e;const i=null===(t=this.els)||void 0===t?void 0:t.video,n=()=>{e&&e.unobserve(this.el),e=new IntersectionObserver((t=>{if(!t.length||t[0].isIntersecting||!Vt.E.isShown||!this.isPlayed)return;this._getPostrollState()===c.PLAY||this._bufferedAmount>=90||queueMicrotask((()=>{const t=i.currentTime;i.src="",i.load(),i.removeAttribute("src"),i.currentTime=t}))}),{rootMargin:2*s.core.ui.screenHeight+"px"}),e.observe(this.el)};n(),this.listenTo(s.core.ui,"orientationchange",(()=>{n()}))}_sendAnalytics(t,e){const i=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Li(Object(i),!0).forEach((function(e){Mi(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Li(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({type:"pikabu",view_time:this._timeBeforePlayerSpecialToggle||this.currentTime,length:this.duration},e),s=Fi.getVolumePercents();i.sound_on=Boolean(s),i.sound_volume=s,this._playerAnalytics.sendAnalytics(t,i)}_initPostroll(t){if(!window.ya)return;const e=this.els.video,i=this.$els.player[0],n=this.$el.data("bad");Fi.loadPostrollVideo(e,i,n,!0).then((n=>{const r=n.createPlaybackController(e,i,{skipDelay:2,bufferFullTimeout:1e4,videoTimeout:1e4,vpaidTimeout:1e4});this._adLoader=r,this._playerAnalytics.sendAnalytics(d.AD_REQUEST,{type:me.L.VIDEO_END,content_type:"pikabu"}),r.subscribe("AdPlayingStateChange",(()=>{const t=this._adLoader.getAdPlayingState(),e="end"===t;"play"!==t&&"end"!==t||this.$el.toggleClass("player_postroll-active","play"===t),e&&(this.marks.set("postroll-playing",!1),this.emit("video-finished",!0),this.volume=this._options.volume)})),r.subscribe("AdStopped",(()=>{s.core.logger.log("postroll","ad stopped playing"),this.marks.set("postroll-playing",!1),this.emit("video-finished",!0),setTimeout((()=>{"idle"!==this._adLoader.getAdPlayingState()&&this._initPostroll(t),this.pause({showIndicate:!1})}),50)})),r.subscribe("AdStarted",(()=>{this._adLoader.setAdVolume(0),this._playerAnalytics.sendAnalytics(d.SHOW_AD,{type:me.L.VIDEO_END,content_type:"pikabu"})})),r.subscribe("AdClickThru",(()=>{this._playerAnalytics.sendAnalytics(d.CLICK_AD,{type:me.L.VIDEO_END,content_type:"pikabu"})}))})).catch((t=>{s.core.logger.error("postroll",t)}))}static loadPostrollVideo(t,e,i,s){var n;const r=null===(n=window.ya)||void 0===n?void 0:n.videoAd.loadModule("AdLoader").then((t=>t.AdLoader.create({adFoxParameters:{ownerId:"260477",params:{p1:i?"cnpjv":"cnpjw",p2:"grlr","target-ref":document.location.href}}}))).then((t=>(console.log("Post-roll video created"),t.loadAd())));return s&&r.then((t=>(t.preload({preloadTimeout:1e3,videoSlot:e,desiredBitrate:1e3}),new Promise((e=>{setTimeout((()=>{e(t)}),1e3)}))))),r}renderPlayer(){var t;if(this.$els.player&&this.$els.player.length&&this.$(".player__video").length)return;const e=[{url:this.av1Link,mime:ot,size:this._options.av1Size},{url:this.webmLink,mime:"video/webm",size:this._options.webmSize},{url:this.source+".mp4",mime:"video/mp4",size:this._options.mp4Size}].filter((t=>Boolean(t.url)));var i;(0,Di.L)()?console.log(`Old windows version detected. Use "${null===(i=e[0])||void 0===i?void 0:i.mime}" as primary video format`):e.sort(((t,e)=>t.size-e.size));!("MediaSource"in window)&&hi()&&this._options.hls&&e.unshift({url:this._options.hls+Ti,mime:"application/vnd.apple.mpegURL",size:this._options.mp4Size});const{dashAv1:n,dashWebm:r,hls:o}=this._options,a=this.shakaPlayer=this.shakaPlayerIgnore?void 0:$i(o,r,n),l=this.dashPlayer=a?void 0:function(t,e){const i=ni();if(!("MediaSource"in window)&&hi()||!i||s.core.ua.ios||!t&&!e||t&&wi(t+Ei)||e&&wi(e+Ei))return;let n,r;if(t&&ri()?(n="dash-av1",r=t+Ei):e&&oi()&&(n="dash-webm",r=e+Ei),n&&r)try{const t=i().create(),e=ai.m.get("dashjs_video_bitrate");return t.updateSettings({debug:{logLevel:2},streaming:{gaps:{enableSeekFix:!0,enableStallFix:!0,stallSeek:4},cacheInitSegments:!0,abr:{autoSwitchBitrate:{video:!0,audio:!0},initialBitrate:{video:"object"==typeof e&&"string"==typeof e.bitrate?Number(e.bitrate):void 0}},scheduling:{scheduleWhilePaused:!1},buffer:{enableSeekDecorrelationFix:!0,stableBufferTime:20,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:20,fastSwitchEnabled:!1},delay:{}}}),t.type=n,t.source=r,t}catch(o){s.core.logger.error("video",o)}}(n,r),u=this.hlsPlayer=a||l||!o?void 0:function(t){const e=Ci();if(("MediaSource"in window||!hi())&&t&&e&&!s.core.ua.ios&&ci()&&!wi(t))try{const i=new e({autoStartLoad:!0});return i.loadSource(t),i}catch(i){s.core.logger.error("video",i)}}(o+Ti),c=s.core.ua.ios&&document.querySelector(".player__video");if(c&&this.$(".player__player").remove(),this.el.insertAdjacentHTML("afterbegin",function(t){var e,i="",s=Ie.escape;return Array.prototype.join,i+='<div class="player__player player__player_hide">\n\t<div class="player__indicator" style="display: none"></div>\n\t',t.createVideoElement&&(i+='\n\t\t<video class="player__video" playsinline="" preload="none">\n\t\t\t',t.sources.forEach((({url:t,mime:n,size:r})=>{i+='\n\t\t\t\t<source src="'+(null==(e=t)?"":e)+'" type="'+s(n)+'" data-size="'+(null==(e=r)?"":e)+'">\n\t\t\t'})),i+="\n\t\t</video>\n\t"),i+='\n\t<div class="player__controls-wrapper">\n\t\t<div class="player__controls">\n\t\t\t<div class="player__play-button">\n\t\t\t\t<div class="player__play-arrow player__play-arrow_left"></div>\n\t\t\t\t<div class="player__play-arrow player__play-arrow_right"></div>\n\t\t\t</div>\n\n\t\t\t<div class="player-timeline">\n\t\t\t\t<div class="player-timeline__amounts">\n\t\t\t\t\t<div class="player-timeline__buffered-amount"></div>\n\t\t\t\t\t<div class="player-timeline__progress-amount"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="player-timeline__handler-wrapper">\n\t\t\t\t\t<div class="player-timeline__handler"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="player-timeline__hint"></div>\n\t\t\t</div>\n\n\t\t\t<div class="player__progress-time">'+(null==(e=t.duration)?"":e)+'</div>\n\t\t\t<div class="player__fullscreen">\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--player__expand icon--player__expand_player"><use xlink:href="#icon--player__expand"></use></svg>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class="player__volume-container">\n\t\t<div class="player__volume">\n\t\t\t<svg class="player__volume-icon" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<g fill-rule="evenodd">\n\t\t\t\t\t<path d="M0 5.499v5.01h3l5 4.998V.5L3 5.499z"/>\n\t\t\t\t\t<path d="M12 8.003c0-1.54-.817-2.862-2.003-3.506V11.5C11.183 10.865 12 9.543 12 8.003z"/>\n\t\t\t\t\t<path d="M9.997 0L10 2.004c2.479.785 4 3.107 4 6s-1.521 5.215-4 6l-.003 2.004C13.436 15.177 16 11.91 16 8.004 16 4.098 13.436.83 9.997 0z"/>\n\t\t\t\t\t<path d="M13 8.6L10.6 11l-.6-.6L12.4 8 10 5.6l.6-.6L13 7.4 15.4 5l.6.6L13.6 8l2.4 2.4-.6.6z"/>\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="player__volume-slider">\n\t\t\t<div class="player__volume-amounts">\n\t\t\t\t<div class="player__volume-amount"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div class="player__video-loader" style="display: none;">\n\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__progress-circle icon--ui__progress-circle_player-native"><use xlink:href="#icon--ui__progress-circle"></use></svg>\n</div>'}({source:this.source,duration:(0,Oi.i)(this.duration),sources:l?[]:e,createVideoElement:!c})),this.$els.player=this.$(".player__player"),this.$els.playButton=this.$(".player__play-button").on("click",this._togglePlay),this.$els.loader=this.$(".player__video-loader"),c){const t=K.getPlayerFromElement(c.closest(".player"));var d,p,m;if(t)t.stop(),null===(d=t.shakaPlayer)||void 0===d||d.destroy(),null===(p=t.dashPlayer)||void 0===p||p.destroy(),null===(m=t.hlsPlayer)||void 0===m||m.detachMedia();c.innerHTML="",c.removeAttribute("src"),Fe()(c).insertBefore(this.$(".player__controls-wrapper")),l||u||!e||(c.innerHTML=e.map((({url:t,mime:e,size:i})=>`<source src="${t}" type="${e}" data-size="${i||""}">`)).join(""),c.load())}this.$els.video=this.$(".player__video"),this.$els.video.off().on({dblclick:()=>this.isFullScreen=!this.isFullScreen,click:()=>this._togglePlay(),pause:()=>this._onPlayerPause(),play:()=>this.state===h.PAUSED&&this.play({showIndicate:!this.isAutoplaying}),loadedmetadata:()=>this.duration=this.els.video.duration,timeupdate:()=>this._onPlayerTimeupdate(),ended:()=>this._onVideoFinished(this.els.video.duration),progress:this._updateBufferedTime.bind(this),durationchange:()=>{const t=this.els.video.duration;t&&(this.duration=t)}}),this.els={video:this.$els.video.get(0)},a||l||u?this.el.addEventListener("contextmenu",this._contextMenuCallback):(this._contextmenu&&this._contextmenu.hide(),this.el.removeEventListener("contextmenu",this._contextMenuCallback)),a?(this.currentSrc=a.source,this.videoType=a.type,a.attach(this.els.video),a.load(a.source)):l?(this.currentSrc=l.source,this.videoType=l.type,l.on("error",(()=>{l.destroy(),delete this._options.dashWebm,delete this._options.dashAv1,this.state!==h.PAUSED&&(this.$els.player.remove(),this.$els.loader.remove(),delete this.$els.player,this.stop(),this.play())})),l.initialize(this.els.video,l.source)):u&&(this.videoType="hls",this.currentSrc=this._options.hls+Ti,u.attachMedia(this.els.video)),this._initHotkeys(),this._initAutoplayOptimizerObserver(),s.core.ua.ios&&null!==(t=window.screen)&&void 0!==t&&t.orientation&&this.listenTo(s.core.ui,"orientationchange",(({isPortrait:t})=>{t&&(this.$els.video.css("width",window.screen.width-1+"px"),setTimeout((()=>{this.$els.video.css("width","")}),50))})),this.$els.controlsWrapper=this.$(".player__controls-wrapper"),this.$els.indicator=this.$(".player__indicator").eq(0),this.$els.fullScreen=this.$(".player__fullscreen").eq(0).on("click",(()=>{s.core.ui.emit("fullscreen-prepare"),this.isFullScreen=!this.isFullScreen})),this._renderTimeline(),this._renderVolume(),this.$el.on("mousemove",this._onUserInteraction);let _=!1;this.$el.get(0).addEventListener("click",(t=>{if(2===t.detail&&_)return t.preventDefault(),void t.stopPropagation();_=!1,this._onUserInteraction()}),{capture:!0})}_isUserInteractionFlagSet(){return this.$el.hasClass("player_user-interaction")}_playPostroll(){this._adLoader&&(this.marks.set("postroll-playing",!0),this._getPostrollState()===c.PAUSE?this._adLoader.resumeAd():this._adLoader.playAd())}_pausePostroll(){this._adLoader&&(this.marks.set("postroll-playing",!1),this._adLoader.pauseAd())}_getPostrollState(){return this._adLoader&&c[this._adLoader.getAdPlayingState().toUpperCase()]||c.NONE}_isPostrollActive(){const t=this._getPostrollState();return t===c.PLAY||t===c.PAUSE}_createSoundHint(){const t=document.createElement("span");t.classList.add("player__sound-hint");const e=document.createElement("span");e.classList.add("player__sound-label"),this.isVideoMuted?(t.innerHTML=s.core.icon("player__sound-off"),e.textContent=s.core.i18n("player.sound-mode.no-audio")):(t.innerHTML=Fi.volumeSettings.volume>0?s.core.icon("player__sound-on"):s.core.icon("player__sound-off"),e.textContent=Fi.volumeSettings.volume>0?s.core.i18n("player.sound-mode.has-audio"):s.core.i18n("player.sound-mode.muted"));{const i=new $e.gR({target:t,destroyAfterHide:!1,direction:$e.Lh.TOP,alignment:$e.SE.END,distance:12,autoCloseOutsideClick:!1,delay:1e3});i.content.append(e),t.addEventListener("click",(()=>{i.isShown||i.show()}))}return t}_onPlayerPlay(){if(!this._isPostrollActive())if(this.videoType||(this.videoType=function(t){const e=t.currentSrc;return e.endsWith(".m3u8")?"hls":e.endsWith(".av1.mp4")?"av1":e.endsWith(".mp4")?"mp4":"webm"}(this.els.video)),this.marks.has("video-playing-before-mouse-down"))this.marks.delete("video-playing-before-mouse-down");else{const t=L.getInstance().isPlayerAutoplaying(this.eid);this.marks.get("postroll-playing")||this._getPostrollState()===c.END||t&&(!t||0!==L.getInstance().activePlayerPlaybacks)||this._sendAnalytics(d.PLAY,{launch:this._isAutoEvent?"auto":"manual",mode:this.videoType})}}_onPlayerPause(){this._isPostrollActive()||(this._isFullscreenChanging||this.marks.has("is-mousedown-in-timeline")||this.marks.get("postroll-playing")||Math.floor(this.currentTime)===Math.floor(this.duration)||this._getPostrollState()===c.END||this._sendAnalytics(d.PAUSE,{mode:this._isAutoEvent?"auto":"manual"}),this.marks.set("postroll-playing",!1),this.isVideoMuted&&this.state===h.PLAYING||this.marks.has("video-playing-before-mouse-down")||this.state===h.PAUSED||x.I.isFullScreen||this.pause({showIndicate:!this.isAutoplaying}))}_onPlayerTimeupdate(){this.marks.has("is-mousedown-in-timeline")||(this._updateProgressTime(this.currentTime),this.isCutMode&&(this.currentTime>=this.cutTo||this.currentTime<this.cutFrom)&&(this.currentTime=this.cutFrom))}_onVideoFinished(t){this._sendMetricsGoal(p.FINISHED,{video_end_duration_s:t});const e=ti.getInstance(this.bannerType).isPreloaded,i=!this.isAdsDisabled&&this._bannerLastShowTime+1e4<=Date.now()&&e&&this.duration>4;if(e||ti.getInstance(this.bannerType).preload(this._playerAnalytics),i){this._isBannerShown=!0;const t="player_ad-active";this.el.classList.add(t),ti.getInstance(this.bannerType).show(this.el).then((e=>{this.el.classList.remove(t),this._bannerLastShowTime=Date.now(),this._isBannerShown=!1,e&&(this.isAutoplaying||this.isVideoMuted)?this.els.video.play():this.isAutoplaying||this.stop()}))}this.isVideoMuted&&!i?this.els.video.play():this.dashPlayer&&(this.dashPlayer.setAutoPlay(this.isAutoplaying&&!i),this.dashPlayer.initialize(this.els.video,this.dashPlayer.source,!i),this.isAutoplaying||i||this.stop()),this.state!==h.UNSTARTED&&this._getPostrollState()!==c.PLAY&&this.emit("video-finished"),this._isIntersecting&&this._getPostrollState()!==c.PLAY&&!document.hidden&&setTimeout((()=>{this._playPostroll()}),0),this._getPostrollState()===c.PLAY&&this._adLoader.stopAd()}_initHotkeys(){if(this._initiedHotkeys)return;this._initiedHotkeys=!0,this.$el.prop("tabindex",-1);let t=new W.SV(this.$el),e=(0,g.throttle)((t=>{this.isCutMode?this.currentTime=t?Math.min(this.currentTime+5,this.cutTo):Math.max(this.currentTime-5,this.cutFrom):this.currentTime=t?Math.min(this.currentTime+5,this.duration):Math.max(this.currentTime-5,0),this._showIndicate(t?"player__forward":"player__backward")}),150,{trailing:!1}),i=(0,g.throttle)((t=>{this.volume=t?Math.min(this.volume+.1,1):Math.max(this.volume-.1,0),this._showIndicate(this.isMuted?"player__volume-mute":t?"player__volume-up":"player__volume-down"),Fi.hasUserInteractedWithVolume=!0}),100,{trailing:!1});return t.on({space:t=>{this._onUserInteraction(),this._togglePlay(),t.preventDefault()},right:t=>{this._onUserInteraction(),e(!0),t.preventDefault()},left:t=>{this._onUserInteraction(),e(!1),t.preventDefault()},up:t=>{this._onUserInteraction(),this._onVolumeInteraction(),!this.isVideoMuted&&i(!0),t.preventDefault()},down:t=>{this._onUserInteraction(),this._onVolumeInteraction(),!this.isVideoMuted&&i(!1),t.preventDefault()},m:t=>{this._onUserInteraction(),this._onVolumeInteraction(),this.isVideoMuted||(this._toggleMute(),this.isMuted&&this._showIndicate("player__volume-mute")),t.preventDefault()},f:t=>{this._onUserInteraction(),this._options.eid===s.core.ui.player.currentPlayer&&(this.isFullScreen=!this.isFullScreen,t.preventDefault())}},{type:W.FM.KEYDOWN}),this}_renderTimeline(){let t=bt.$.requestThrottle(this._onTimelineMouseMove.bind(this));return this.$els.timeline={el:this.$(".player-timeline"),handlerWrapper:this.$(".player-timeline__handler-wrapper"),handler:this.$(".player-timeline__handler"),bufferedAmount:this.$(".player-timeline__buffered-amount"),progressAmount:this.$(".player-timeline__progress-amount"),time:this.$(".player__progress-time"),hint:this.$(".player-timeline__hint")},this.$els.timeline.el.on({mouseenter:this._onTimelineMouseEnter.bind(this),mouseleave:this._onTimelineMouseLeave.bind(this),mousedown:this._onTimelineMouseDown.bind(this),mousemove:e=>{this.marks.has("is-mousedown-in-timeline")||t(e)}}),this.$els.timeline.time.click((()=>{this._showCurrentTime=!this._showCurrentTime,this._updateProgressTime(this.currentTime)})),this.els.timeline={el:this.$els.timeline.el.get(0)},this.marks.set("timeline-width",this.els.timeline.el.offsetWidth),this}_onTimelineMouseDown(t){this.marks.set("time-before-timeline-update",this.currentTime),this.marks.set("is-mousedown-in-timeline",!0),this.listenTo(s.core.ui,"pointer-move",this._onTimelineMouseMove),this.listenTo(s.core.ui,"pointer-up",this._onTimelineMouseUp);let e=t.pageX||(t.touches&&t.touches.length>0?t.touches[0].clientX:t);this._onTimelineMouseMove(e,!0),this.els.video.paused?this.marks.delete("video-playing-before-mouse-down"):(this.marks.set("video-playing-before-mouse-down",!0),this.els.video.pause())}_onTimelineMouseMove(t,e){let i=this.marks.get("timeline-width");i||this.marks.set("timeline-width",i=this.els.timeline.el.offsetWidth);let s="number"==typeof t.pageX?t.pageX:t,n=Math.max(0,Math.min(s-this.$els.timeline.el.offset().left,i))/i,r=this.duration*n,o=(0,Oi.i)(r);this.isCutMode&&(r=this.cutFrom+r),this._lastHintTime!==o&&(this._lastHintTime=o,this.$els.timeline.hint.text(o)),this.$els.timeline.hint.css("left",100*n+"%"),this.marks.has("is-mousedown-in-timeline")&&this._updateProgressTime(r),!0===e&&(this.currentTime=r)}_onTimelineMouseUp(t){this.marks.delete("is-mousedown-in-timeline"),this.stopListening(s.core.ui,"pointer-move"),this.stopListening(s.core.ui,"pointer-up");let e=t.pageX||(t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0].clientX:t);this._onTimelineMouseMove(e,!0),this.marks.has("video-playing-before-mouse-down")&&this.els.video.play(),this.marks.has("is-mouse-in-timeline")||this.$els.timeline.hint.removeClass("player-timeline__hint_visible"),this._sendAnalytics(d.TIMELINE_CLICK,{time_old:this.marks.get("time-before-timeline-update"),time_new:this.currentTime}),this.marks.delete("timeline-width")}_onTimelineMouseEnter(){this.marks.set("is-mouse-in-timeline",!0),this.marks.set("timeline-width",this.els.timeline.el.offsetWidth),this.$els.timeline.hint.addClass("player-timeline__hint_visible")}_onTimelineMouseLeave(){this.marks.delete("is-mouse-in-timeline"),this.marks.has("is-mousedown-in-timeline")||this.$els.timeline.hint.removeClass("player-timeline__hint_visible")}_renderVolume(){return this.$els.volume={container:this.$(".player__volume-container"),el:this.$(".player__volume-slider"),toggleBtn:this.$(".player__volume"),amount:this.$(".player__volume-amount"),amountScale:this.$(".player__volume-amounts"),icon:this.$(".player__volume-icon")},this.els.volume={el:this.$els.volume.el.get(0)},this.marks.set("volume-height",this.$els.volume.amountScale.get(0).offsetHeight),this.isVideoMuted?(this.$el.attr("data-muted","true"),this.$els.volume.container.hide(),this.volume=0,this):(this.volume=Fi.volumeSettings.volume,this.$els.volume.el.on("mousedown",this._onVolumeMouseDown.bind(this)),this._handleVolumeHover(),this.$els.volume.toggleBtn.on("click",this._toggleMute.bind(this)),this)}_handleVolumeHover(){const t=(0,g.debounce)(this._removeVolumeInteraction,500);this.$els.volume.toggleBtn.hover((()=>{this._volumeBtnHovered=!0,this._addVolumeInteraction()}),(()=>{this._volumeBtnHovered=!1,t()}))}_toggleMute(){return this.isMuted=!this.isMuted,Fi.hasUserInteractedWithVolume=!0,this}static _getVolumeSetingsFromLS(t){const e=X.LocalStorage.get(it);return(0,g.isObject)(e)?Math.max(0,Math.min(Number(e[t])||0,1)):this.hasUserInteractedWithVolume?1:0}static parseVolume(){return Fi._getVolumeSetingsFromLS("vo")}static parseVolumeBeforeMute(){return Fi._getVolumeSetingsFromLS("vobm")}static getVolumePercents(){return Math.ceil(100*Fi.parseVolume().toFixed(2))}_onVolumeMouseDown(t){this.marks.set("volume-height",this.$els.volume.amountScale.get(0).offsetHeight),this.listenTo(s.core.ui,"pointer-move",((t,e)=>this._onVolumeMouseMove(e))),this.listenTo(s.core.ui,"pointer-up",this._onVolumeMouseUp),this._onVolumeMouseMove(t.pageY)}_onVolumeMouseUp(){this.stopListening(s.core.ui,"pointer-move"),this.stopListening(s.core.ui,"pointer-up")}_onVolumeMouseMove(t){let e=this.marks.get("volume-height"),i=Math.max(0,Math.min(this.$els.volume.amountScale.offset().top+e-t,e));this.volume=i/e,Fi.hasUserInteractedWithVolume=!0}_onVisibilityChange(t){const e=this._getPostrollState(),i=e===c.PLAY,s=e===c.PAUSE;var n;t&&s&&this._isPostollAutoPaused&&(null===(n=this._adLoader)||void 0===n||n.setAdVolume(0),this._isPostollAutoPaused=!1,this._playPostroll(),this.volume=0);!t&&i&&(this._isPostollAutoPaused=!0,this._pausePostroll()),t||this.isAutoplaying||!this.isPlaying||this.pause()}_setVideoDetailFromData(){const t=String(this.$el.data("source")),e=this.$el.data("webm"),i="true"===e?`${t}.webm`:e&&"false"!==e?e:void 0,n=parseInt(this.$el.data("webmSize")||"0",10),r=this.$el.data("av1"),o=parseInt(this.$el.data("av1Size")||"0",10),a=parseInt(this.$el.data("mp4Size")||"0",10),l=this.$el.data("story-id"),u=this.$el.data("vid")||0,h=this.$el.data("hls"),c=this.$el.data("dash-webm"),d=this.$el.data("dash-av1");this._options.storyId=l,this._options.adId=!(!u||u===l)&&u,this.setOptions({source:t,webmLink:i,av1Link:r,av1Size:o,webmSize:n,mp4Size:a,hls:h,dashWebm:c,dashAv1:d,duration:parseInt(this.$el.data("duration"),10)||0,ratio:parseFloat(this.$el.data("ratio")||1.78),isProbe:Boolean(this.$el.data("probe")),position:parseInt(this.$el.data("position"))||1}),this._options.isVideoMuted=Boolean(this.$el.data("muted"));let p=this.$el.data("cut");if((0,g.isString)(p)&&p.includes(",")&&p.length>3){let[t,e]=p.split(",").map((t=>Number(t)));(0,g.isFinite)(t)&&(0,g.isFinite)(e)&&(this._options.isCutMode=!0,this._options.cutFrom=t,this._options.cutTo=e)}return s.core.ua.ios||s.core.ua.ios||(c||d?this.isStreamingInitialized=Boolean(ni())||Si():h&&(this.isStreamingInitialized=Boolean(Ci())||ki())),this}_showIndicate(t){let e=this.$els.indicator;e.show().removeClass("player__indicator_hide").html(s.core.icon(t,"player-indicator")),this.timeout("indicator-start-hide",300,(()=>{e.addClass("player__indicator_hide")})),this.timeout("indicator-hide",650,(()=>{e.hide().removeClass("player__indicator_hide")}))}_sendMetricsGoal(t,e,i=!0){const s=`goal-${t.value}`;i&&this.marks.has(s)||(this.marks.set(s,!0),Se.c.getInstance().yandex.goal(t.value,e))}play({focusAfter:t,showIndicate:e,isAutoEvent:i}={focusAfter:!0,showIndicate:!0,isAutoEvent:null}){var n;if(this.isProbe)return this._toggleProbeMessage(!0),this;if(this.state===h.PLAYING)return this;e&&this.state!==h.UNSTARTED&&this._showIndicate("player__play");const r=!(null!==(n=this.$els.player)&&void 0!==n&&n.length);this.renderPlayer(),this._initIntersectionObserver(),this._isAutoEvent=Boolean(i),r&&!i&&requestAnimationFrame(this._onUserInteraction),requestAnimationFrame((()=>{this.$el.addClass("player_rendered")})),this.state===h.UNSTARTED&&setTimeout((()=>{this.isDestroyed||(this._sendMetricsGoal(p.PLAY,{video_start_duration_s:this.els.video.duration}),this.isAdsDisabled||(this._initAds(),this.videoWidth=this.els.video.videoWidth,this.videoHeight=this.els.video.videoHeight))}),2e3);const o=r&&!this._isAutoEvent||this._isAutoEvent&&this.state===h.UNSTARTED||this.state===h.WAITING_RESOLVED_PLAY;return this.state=o?h.WAITING_RESOLVED_PLAY:h.PLAYING,this.isCutMode&&this.els.video.currentTime<this.cutFrom&&(this.els.video.currentTime=this.cutFrom),this.els.video.addEventListener("loadstart",this._loadHandler),this.els.video.addEventListener("canplay",this._loadHandler),this.els.video.addEventListener("canplaythrough",this._cancelTechnologyDowngrade),setTimeout((()=>{if(this.isDestroyed)return;if(this.state===h.PAUSED||this.state===h.UNSTARTED)return;const t=this.els.video;this.timeout("showBuffering",500,(()=>{this.isVideoBuffering=!0,this.dashPlayer&&this.currentTime<1&&(this.currentTime+=.1)})),t.play().then((()=>{o&&(this.state=h.PLAYING);let e=0;this.interval("detect-buffering",50,(()=>{const i=this.currentTime;this.isVideoBuffering=i<e+.03&&!t.paused,e=i}))})).catch((t=>{if("AbortError"!==t.name){if("NotAllowedError"===t.name)return L.getInstance().disable(),void this.stop();throw t}this.dashPlayer&&this.state!==h.UNSTARTED&&(this.state=h.PLAYING)})).finally((()=>this.cancelTimeout("showBuffering")))})),this.$els.playButton.addClass("player__play-button_active"),s.core.emit("playerSpecialPlay",this.eid),t&&this.$el.focus(),this.adId&&!Oe.o.isPlayVideo(this.adId)&&Oe.o.setPlayVideo(this.storyId,this.adId),super.play(),this}pause({showIndicate:t,isAutoEvent:e}={showIndicate:!0,isAutoEvent:null}){var i,s;return e&&this.spinnerStats&&this.spinnerStats.lagStarted&&(this.spinnerStats.lags.push(Date.now()-this.spinnerStats.lagStarted),this.spinnerStats.lagStarted=0),null!==(i=this.els)&&void 0!==i&&i.video?(this.state===h.PLAYING?this.state=h.PAUSED:this.state===h.WAITING_RESOLVED_PLAY&&(this.state=h.UNSTARTED),this._isAutoEvent=Boolean(e),this.els.video.pause(),null===(s=this.$els.playButton)||void 0===s||s.removeClass("player__play-button_active"),t&&this._showIndicate("player__pause"),this.cancelInterval("detect-buffering"),this.cancelInterval("spinner-watching"),this._cancelTechnologyDowngrade(),this._stopSpinnerStats(),this.isVideoBuffering=!1,this):this}stop(){return this.marks.has("probe-isShown")&&this._toggleProbeMessage(!1),this.state===h.UNSTARTED?this:this._getPostrollState()===c.PLAY||this._getPostrollState()===c.PAUSE?(this._pausePostroll(),this):(this.pause(),this.currentTime=this.isCutMode?this.cutFrom:0,this.$(".player__play-button").removeClass("player__play-button_active"),this.cancelInterval("detect-buffering"),this._stopSpinnerStats(),this.state=h.UNSTARTED,this._isPostollAutoPaused=!1,this)}_updateProgressTime(t){this.duration&&(t=Math.min(t,this.duration)),this.isCutMode&&(t-=this.cutFrom);let e=this.duration,i=`translateX(${(t/e*100).toFixed(2)}%`;this.$els.timeline.progressAmount.css("transform",i),this.$els.timeline.handlerWrapper.css("transform",i);let s=(0,Oi.i)(this._showCurrentTime?t:e-Math.min(e,t));s!==this._lastTimeBeforeEnd&&(this.$els.timeline.time.text(s),this._lastTimeBeforeEnd=s)}_updateBufferedTime(){let t=this.currentTime,e=this.els.video.buffered;for(let i=e.length;i--;)if(e.start(i)<=t){let t=this.isCutMode?Math.min(e.end(i)-this.cutFrom,this.duration)/this.duration*100:e.end(i)/this.duration*100;t=Math.min(100,t),this.$els.timeline.bufferedAmount.css("transform",`translateX(${t}%`),this._bufferedAmount=t;break}}_updateVolume(t){this.$els.volume.amount.css("transform",`translateY(${100-100*t}%`),this.$els.volume.icon.attr("data-value",0===t?"mute":t<.2?"min":t<.6?"mid":"max")}_initAds(){this._isBannerShown||ti.getInstance(this.bannerType).preload(this._playerAnalytics)}get bannerType(){var t;if(this._options.bannnerType)return this._options.bannnerType;const e=null===(t=this.el.closest(".story"))||void 0===t?void 0:t.parentElement;if(!e)return;const i=Bi.Z.closestUIElement(e);return i instanceof xi.Z?this._options.bannnerType="under-comments"===i.feedName?"under-comments":"main":void 0}get currentTime(){var t,e;return(null===(t=this.els)||void 0===t||null===(e=t.video)||void 0===e?void 0:e.currentTime)||0}set currentTime(t){this.currentTime!==t&&(this.dashPlayer&&!t?this.dashPlayer.seek(.04):this.els.video.currentTime=t,this._updateProgressTime(t))}get isVideoBuffering(){return this._options.isVideoBuffering}set isVideoBuffering(t){this._options.isVideoBuffering!==t&&(this._options.isVideoBuffering=t,this.cancelTimeout("buffering"),t&&!this.isPostrollPlaying?this.timeout("buffering",500,(()=>{this.$els.loader.show()})):this.$els.loader.hide())}get isMuted(){return 0===this._options.volume}set isMuted(t){this.isMuted===Boolean(t)||this.isVideoMuted||(t?(this.marks.set("before-mute",this.volume),Fi.volumeSettings.volumeBeforeMute=this.volume,this.volume=0):(this.volume=this.marks.get("before-mute")||Fi.volumeSettings.volumeBeforeMute||.5,this.marks.delete("before-mute")))}get isVideoMuted(){return this._options.isVideoMuted}get volume(){return this.els.video.volume}set volume(t){const e=0===t;this._options.volume===t&&this.els.video.volume===t&&Boolean(this.els.video.muted)===e||(this._options.volume=t,this.els.video.volume=t,this.els.video.muted=e,this._updateVolume(t),this.isVideoMuted||(Fi.volumeSettings.volume=t,t&&(Fi.volumeSettings.volumeBeforeMute=t),this._sendAnalyticsVolumeChangedDebounced()))}get isFullScreen(){return x.I.isFullScreen}set isFullScreen(t){let e=this.isFullScreen;if(s.core.ua.ios)t?this.els.video.webkitEnterFullscreen():this.els.video.webkitExitFullScreen();else{if(this.$el.toggleClass("player_fullscreen",t),this.$els.fullScreen.html(s.core.icon(t?"player__compress":"player__expand","player")),e===t)return;t?x.I.request(this.el):x.I.exit()}}get storyId(){return this._options.storyId}get adId(){return this._options.adId}get duration(){return this.isCutMode?this.cutTo-this.cutFrom:this._options.duration}set duration(t){(0,g.isFinite)(t)&&(this._options.duration=Number(t))}get ratio(){return this._options.ratio}set ratio(t){this._options.ratio=t||1.7777777778}get source(){return this._options.source}set source(t){this._options.source!==t&&(this._options.source=t)}get isCutMode(){return this._options.isCutMode}set isCutMode(t){this._options.isCutMode!==(t=Boolean(t))&&(this._options.isCutMode=t)}get cutFrom(){return this._options.cutFrom}get cutTo(){return this._options.cutTo}get webmLink(){return this._options.webmLink}get av1Link(){return this._options.av1Link}get isPostrollPlaying(){return this.marks.get("postroll-playing")}get isPlaying(){return this.state===h.PLAYING}get isAutoplaying(){return L.getInstance().isPlayerAutoplaying(this.eid)}get isAdShown(){return this._isBannerShown||this._isPostrollActive()}get isAdsDisabled(){return void 0===this._options.isAdsDisabled&&(this._options.isAdsDisabled=Boolean(s.core.initParams.isAdsDisabled||this.el&&"1"===this.el.dataset.da)),this._options.isAdsDisabled}}function Ri(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Ni(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ri(Object(i),!0).forEach((function(e){ji(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ri(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function ji(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Mi(Fi,"hasUserInteractedWithVolume",!1);const Ui=i(19755);class Hi extends f{constructor(t){super((0,g.defaults)(t,{showControls:!0})),this._toggleBound=t=>{let e=t&&Ui(t.target);if(e&&e.closest(".player__save",this.$el).length)return this;t&&t.preventDefault&&t.preventDefault(),this.togglePlay()},this._setVideoDetailFromData(),s.core.ui.player.providers.then((()=>{if(this.isDestroyed)return;if(this._providerType=s.core.ui.player.getProviderTypeBySource(this.source),this.provider=s.core.ui.player.getProviderInstanceByType(this._providerType),this.show(),this.isProbe)return void(this.state=h.UNSTARTED);let t=Ae.getProviderPlayerByType(this._providerType);this._currentPlayer=new t(this),this.listenTo(this._currentPlayer,y.bB,this._playerEvent),this.original?(this._currentPlayer.show(),this.state=h.PLAYING):(this.state=h.UNSTARTED,this.playAfterInitialization&&!this.isProbe&&this.$el.is(":visible")&&this.play())})),this.isProbe||(this.listenTo(s.core,"playerSpecialPlay",(t=>{t!==this.eid&&this.isPlayed&&this.stop()})),this.listenTo(s.core,"playerSpecialToggle",(async t=>{if(t===this.eid){if(this._currentPlayer&&this.state===h.PLAYING){const t=await this._currentPlayer.getCurrentTime();this._playerAnalytics.sendAnalytics(d.PAUSE,Ni({type:rt[this._providerType],length:this.duration},t&&{view_time:t}))}this.togglePlay()}})))}render(){return this.isRendered||(this.$els.preview=this.$(".player__preview").eq(0),this.$els.player=this.$(".player__player").eq(0),this.$els.play=this.$(".player__play").eq(0),this.limitWidth=this.$el.hasClass("player_width_limit"),this.$els.label=this._prepareState(h.UNSTARTED),this.$els.label.append(this.provider.logo),this.$els.label.append(Ui(document.createElement("span")).addClass("player__label player__label_separator").html("&#x25CF;")),this.$els.label.append((0,Oi.i)(this.duration)),this._prepareState(h.LOADING).empty(),this.progress(),this.$els.player.length||(this.$els.player=Ui(document.createElement("div")).addClass("player__player player__player_hide").appendTo(this.$el)),this.$els.preview&&this.$els.player.css("background-image",this.$els.preview.css("background-image")),this.$el.click(this._toggleBound),this._playerAnalytics=new He(this.$el),super.render()),this}_playerEvent(t,e){if(!d[t])return this;if(t===d.PROGRESS)return this.state=h.LOADING,this.progress(e),this;if(!this.adId){const i=this.marks.get("time-before-hotkey-toggle");if(t===d.SHOW_AD||t===d.CLICK_AD||t===d.AD_REQUEST||t===d.REDEEMED_AD_SHOWED)return this._playerAnalytics.sendAnalytics(t,Ni({content_type:rt[this._providerType]},e)),this;this._playerAnalytics.sendAnalytics(t,Ni(Ni({type:rt[this._providerType],length:this.duration},e),i&&{view_time:i}))}return t===d.PLAY&&this.adId&&!Oe.o.isPlayVideo(this.adId)&&Oe.o.setPlayVideo(this.storyId,this.adId,this.referrerStoryId),this.state=h.PLAYING,this}_setVideoDetailFromData(){const t=this.$el.data("story-id"),e=this.$el.data("vid")||0;if(this._options.storyId=t,this._options.adId=!(!e||e===t)&&e,this._options.adId){const e=Ui(`.story[data-story-id="${t}"][data-rsid]`);e.length&&e.data("rsid")&&(this._options.referrerStoryId=Number(e.data("rsid")))}return this._options.original=Boolean(this.$el.data("original")),this.setOptions({duration:parseInt(this.$el.data("duration"),10)||0,ratio:parseFloat(this.$el.data("ratio")||1.78),source:String(this.$el.data("source")),isProbe:Boolean(this.$el.data("probe"))}),this}play(){return this.isProbe?(this._toggleProbeMessage(!0),this):this.state===h.UNSTARTED&&this.provider?(this._currentPlayer&&this._currentPlayer.play(),s.core.emit("playerSpecialPlay",this.eid),super.play(),this):this}pause(){var t;return null===(t=this.currentPlayer)||void 0===t||t.pause(),this}stop(){return this.marks.has("probe-isShown")&&this._toggleProbeMessage(!1),this.state===h.UNSTARTED||(this._currentPlayer&&this._currentPlayer.stop(),this.original||(this.state=h.UNSTARTED)),this}get adId(){return this._options.adId}get storyId(){return this._options.storyId}get referrerStoryId(){return this._options.referrerStoryId}get duration(){return this._options.duration}set duration(t){this._options.duration=Number(t)}get ratio(){return this._options.ratio}set ratio(t){this._options.ratio=parseFloat(t)||1.7777777778}get provider(){return this._options.provider}set provider(t){this._options.provider=t}get providerType(){return this._providerType}set providerType(t){this._providerType=t}get currentPlayer(){return this._currentPlayer}set currentPlayer(t){this._currentPlayer=t}get original(){return this._options.original}get playAfterInitialization(){return this._options.playAfterInitialization}set playAfterInitialization(t){return this._options.playAfterInitialization=Boolean(t)}}const Vi=i(19755);class Wi extends f{constructor(t){super((0,g.defaults)(t,{showControls:!0})),this._currentPlayer=void 0,this._queueTechnology=void 0,this._technologiesPriority=new Set,this._setTechnologyPriority().then((()=>{this.isDestroyed||(this.render(),this.state=h.UNSTARTED,this._awaitsPlay&&this.play())}))}mount(){if(this.isMounted)return this;this.$el.parent().length||this.appendTo(this.$parent),super.mount()}render(){let t;return this.isRendered||(t=Vi(document.createElement("div")).addClass("player").attr("data-animation-name",this.animationName).attr("data-type","animation"),this.inside?(this.$el=Vi(document.createElement("div")).addClass("player__wrapper player__wrapper_absolute"),this.$els.inner=t.appendTo(this.$el),this.$parent=this.inside):this.$el=t,this.indent&&this.$el.addClass("player_indent"+(25===this.indent?"":"_"+this.indent)),Vi(document.createElement("div")).addClass("player__overlay").appendTo(this.$el),this.$els.player=Vi(document.createElement("div")).addClass("player__player player__player_hide").appendTo(t),super.render()),this}play(){if(this.state!==h.UNSTARTED)return this._awaitsPlay=!0,this;if(this.show(),this.inside){let[t,e]=X.Utils.calculateAspectRatioFit(this.dimension.width,this.dimension.height,this.$el.innerWidth()-2*this.indent,this.$el.innerHeight()-2*this.indent);this.$els.inner.css({width:t,height:e})}else this.$el.css(this.dimension);return this.technology||this._setNextTechnology(),this._currentPlayer&&this._currentPlayer.play(),this}stop(){return this.state===h.UNSTARTED?(this._awaitsPlay=!1,this):(this.technology&&(this.technology=void 0,this._queueTechnology=void 0),this.hide(),this.state=h.UNSTARTED,this)}async _setTechnologyPriority(){let t=await s.core.ui.player.technologies;return this.isDestroyed||t.forEach(((t,e)=>{t.canPlay(this._options.formats)&&this._technologiesPriority.add(e)})),this}_setNextTechnology(t){return this.technology=t||this._getNextTechnology(),this.technology||(this._queueTechnology=void 0,this._currentPlayer=void 0),this}_getNextTechnology(){return this._queueTechnology||(this._queueTechnology=this._technologiesPriority.values()),this._queueTechnology.next().value}_downgradeTechnology(){return s.core.logger.log("player","downgrade"),this.technology!==a.GIF&&this._technologiesPriority.delete(this.technology),this._setNextTechnology(),this}get format(){return this._options.format}set format(t){return t=u[t]||u.GIF,this._options.format=t}get technology(){return this._options.technology}set technology(t){if(t=a[t],s.core.logger.log("animation","technology",t),this._options.technology===t)return this._options.technology;if(this._currentPlayer&&this._currentPlayer.destroy(),!t)return this._options.technology=t;let e=Ht.getTechnologyPlayerByType(t);return this._currentPlayer=new e(this),this.listenTo(this._currentPlayer,y.bB,this._playerEvent),this._options.technology=t,this.state!==h.UNSTARTED&&this._currentPlayer.play(),t}_playerEvent(t){return o[t]?t===o.ERROR?(this._downgradeTechnology(),this):(this.state=h.PLAYING,this):this}getSourceByFormat(t){return t=u[t],this.formats.get(t)}get dimension(){return this._options.dimension}set dimension(t){return this.$els&&this.$els.player&&this.$els.player.css(t),this._options.dimension=t}get source(){return this.getSourceByFormat(this.format)}set source(t){return this._options.source=String(t)}get formats(){return this._options.formats}set formats(t){return this._options.formats||(this._options.formats=new Map),(0,g.forEach)(t,((t,e)=>{this._options.formats.set(u[e],t)})),this._options.formats}get inside(){return this._options.inside}set inside(t){return this._options.inside===t?this.inside:this._options.inside=t}get indent(){return this._options.indent||0}set indent(t){return t=(0,g.isBoolean)(t)?t?25:0:parseInt(t,10)||0,this._options.indent===t?this._options.indent:(this.isRendered&&this.$el.addClass("player_indent"+(25===t?"":"_"+t)),this._options.indent=t)}get animationName(){return this._options.animationName}set animationName(t){this._options.animationName!==t&&(this._options.animationName=t)}}},47069:(t,e,i)=>{i.d(e,{O:()=>l});var s=i(96637),n=i(40138),r=i(12953),o=i(42107);const a={cookieName:"pbp",hideTimeInDays:3,promoName:"pinball",targetUrl:"https://games.pikabu.ru/pinball?utm_source=pikabu&utm_medium=mbutton",img:"https://cs15.pikabu.ru/post_img/2024/08/13/7/172354700915125053.png",maxDate:new Date("2024-09-03T00:00+03:00")};class l{constructor(t=a){this.config=t,this.init()}init(){var t;if(this.config.maxDate&&new Date>this.config.maxDate)return;if(s.CookieStorage.get(this.config.cookieName))return;const e=document.createElement("a");e.target="_blank",e.href=this.config.targetUrl,e.classList.add("popup-button-promo"),e.insertAdjacentHTML("afterbegin",'<img src="'+this.config.img+'" alt="" />'),e.insertAdjacentHTML("afterbegin",`<button class="popup-button-promo__close">${(0,n.q)("ui__ic_close")}</button>`);const i=t=>{0!==t.button&&1!==t.button||o.cp.getInstance().sendEvent("specials_banner_tapped",{component_name:this.config.promoName})};e.addEventListener("click",i),e.addEventListener("auxclick",i),null===(t=e.querySelector(".popup-button-promo__close"))||void 0===t||t.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),o.cp.getInstance().sendEvent("banner_closed",{type:"specials",component_name:this.config.promoName}),e.remove();const i="function"==typeof this.config.hideTimeInDays?this.config.hideTimeInDays():this.config.hideTimeInDays;s.CookieStorage.set(this.config.cookieName,1,{expires:i})})),document.body.insertAdjacentElement("beforeend",e),requestAnimationFrame((()=>{e.classList.add("popup-button-promo_shown"),o.cp.getInstance().sendEvent("banner_showed",{type:"specials",component_name:this.config.promoName})}));let a=!1,l=0;r.core.ui.on("document-scroll",(t=>{if(a){if(Math.abs(t-l)>40){const i=t-l>0;l=t,e.classList.toggle("popup-button-promo_animation-hidden",i)}}else l=t;a=!0}))}}},19567:(t,e,i)=>{i.d(e,{b:()=>u});var s=i(12953),n=i(63907),r=i(31474),o=i(65027),a=i(36005);const l=i(19755);class u extends n.u1{constructor(t={}){super(),this.$els={arrow:void 0,container:void 0,wrapper:void 0},this.setOptions((0,a.defaults)((0,a.isObject)(t)?t:{},{wrapperExtraClass:"",theme:o.xb.DEFAULT}))}render(){return this.isRendered||(this.$el=l(document.createElement("div")).addClass(`popup ${this._options.wrapperExtraClass}`).hide(),this.zIndex&&this.$el.css("z-index",this.zIndex),this.$els.wrapper=l(document.createElement("div")).addClass("popup__wrapper").appendTo(this.$el),this.$els.wrapper.append(this._renderContainer().append(this._renderContent())),this.theme!==o.xb.DEFAULT&&this.$el.addClass(`popup_${this.theme.valueOf()}`),this.$els.container.append(this._renderFooter()),super.render()),this}_renderContainer(){return this.$els.container?this.$els.container:this.$els.container=l(document.createElement("div")).addClass("popup__container")}_renderContent(){return this.$els.content||(this.$els.content=l(document.createElement("div")).addClass("popup__content")),this.$els.content}_renderFooter(){return this.$els.footer||(this.$els.footer=l(document.createElement("div")).addClass("popup__footer").hide()),this.$els.footer}addCloseButtonIntoFooter(t="Закрыть",e=(()=>{}),i){return this.addButtonIntoFooter(s.core.i18n(t),(()=>{e(),this.hide()}),i),this}addCloseIcon(t={}){const{modificatorCss:e="",icon:i="ui__close"}=t,s=this.content.get(0),n=document.createElement("div");return n.classList.add("popup__close-icon"),e&&n.classList.add("popup__close-icon_"+e),n.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--${i}">\n\t\t\t\t\t\t\t<use xlink:href="#icon--${i}"></use>\n\t\t\t\t\t\t</svg>`,s.append(n),n.addEventListener("click",(()=>{this.emit("close-button-click"),this.hide()})),this}addButtonIntoFooter(t,e,i){return i=r.j[i],this._renderFooter().show().append(l(document.createElement("button")).addClass("button"+(i&&i!==r.j.DEFAULT?" button_"+i.valueOf():"")).html(s.core.i18n(t)).on("click",e)),this}addCustomIntoFooter(t){return this._renderFooter().show().append(t),this}updateWidth(){return this}append(t){return this._renderContent().append(t)}destroy(){this.isDestroyed||(delete this.$els.container,s.core.ui.hotkeys.off(null,null,{context:this}),super.destroy())}static toPx(t,e=!1){return e&&(t=Math.floor(t)),(0,a.isNumber)(t)?t+"px":t}static _getCurrentWidth(t,e){if(t)return(0,a.isNumber)(t)?t:Math.min(parseInt(t,10),400)*e}get indent(){return this._options.indent}set indent(t){this._options.indent!==t&&(this._renderContent().toggleClass("popup__content_indent",Boolean(t)),this._options.indent=t)}get footer(){return this._renderFooter()}set isFooterMultiline(t){let e=Boolean(t);this.footer.toggleClass("popup__footer_multiline",e)}get content(){return this._renderContent()}set content(t){t&&this._renderContent().empty().append(t)}get theme(){return this._options.theme||o.xb.DEFAULT}set theme(t){let e=this._options.theme;(t=o.xb[t])&&t!==e&&(this._options.theme=t,this.isRendered&&(e!==o.xb.DEFAULT&&this.$el.removeClass(`popup_${e.valueOf()}`),t!==o.xb.DEFAULT&&this.$el.addClass(`popup_${t.valueOf()}`)))}get width(){return this._options.width}set width(t){(0,a.isString)(t)&&t.includes("px")&&(t=Math.max(50,parseInt(t,10)||0)),this._options.width=t,this.isShown&&this.updateWidth()}get minWidth(){return this._options.minWidth}set minWidth(t){(0,a.isString)(t)&&t.includes("px")&&(t=Math.max(50,parseInt(t,10)||0)),this._options.minWidth=t,this.isShown&&this.updateWidth()}get maxWidth(){return this._options.maxWidth}set maxWidth(t){(0,a.isString)(t)&&t.includes("px")&&(t=Math.max(50,parseInt(t,10)||0)),this._options.maxWidth=t,this.isShown&&this.updateWidth()}get destroyAfterHide(){return this._options.destroyAfterHide}set destroyAfterHide(t){this._options.destroyAfterHide=(0,a.isBoolean)(t)?t:t>0&&Number(t)}get zIndex(){return this._options.zIndex}set zIndex(t){this._options.zIndex!==(t="number"==typeof t?t:parseInt(t))&&(this._options.zIndex=t,this.isRendered&&this.$el.css("z-index",t))}}},33324:(t,e,i)=>{i.d(e,{n:()=>I});i(88674),i(74916),i(15306),i(27207),i(41817);var s=i(12953),n=i(88358),r=i(36005);var o=i(82800);const a="complain-form__note",l="input__input",u="complain-form__footer",h="complain-form__submit",c="complain-form__close",d="complain-form__reasons",p="complain-form__reasons input",m="radio-round",_="complain-form__spinner",g="complain-form__result",v="result__message",f="result__checkbox",y="checkbox",b="close-icon";var w=i(12950),E=i(90312),A=i(33662),S=i(20610),P=i(58330),C=i(36005);function T(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function k(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?T(Object(i),!0).forEach((function(e){D(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function D(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i(19755);class I extends n.LD{constructor(t){super(t),this._targetId=t.targetId,this._targetType=t.targetType,this._authorId=Number(t.authorId),this._isUserIsAuthor=this._authorId===s.default.initParams.userID,this._name=t.name||"",this._name=t.name||"",this._isComplainSent=!1,this._isClosing=!1;const e=this._getFilteredReasons(s.default.initParams.reportReasons),n={targetType:this._targetType,isReportsDisabled:s.default.initParams.isReportsDisabled,reasons:e},o=function(t){var e,s="",n=r.escape;Array.prototype.join;const o=i(12953).core;if(s+='\n\n<div class="complain-form">\n        <div class="complain-form__header">\n        ',s+='\n            <div class="header__title">'+n(o.i18n(`complain.targetType.${t.targetType}`))+"</div>\n        </div>\n        ",t.isReportsDisabled)s+='\n            <p class="complain-form__message complain-form__message_disabled-send">Система отправки жалоб временно отключена для вашего профиля</p>\n            <div class="form_footer complain-form__footer_disabled-send">\n                <div class="button complain-form__close">Закрыть</div>\n            </div>\n        ';else if(t.reasons.length){s+='\n            <div class="complain-form__reasons">\n                ';for(let i=0;i<t.reasons.length;i++){s+="\n                    ";const n=t.reasons[i];s+='\n                    <div class="reason">\n                            <input\n                                    class="radio-round"\n                                    type="radio"\n                                    name="reason"\n                                    id="'+(null==(e=n.id)?"":e)+'"\n                                    value="'+(null==(e=n.id)?"":e)+'"\n                                    data-placeholder="'+(null==(e=n.notePlaceholder)?"":e)+'"\n                                    data-note_required = "'+(null==(e=n.isNoteRequired)?"":e)+'"\n                                    data-ignore_enable = "'+(null==(e=n.isIgnoreEnabled)?"":e)+'"\n                            >\n                            <label for="'+(null==(e=n.id)?"":e)+'">'+(null==(e=n.name)?"":e)+"</label>\n                    </div>\n                "}s+='\n            </div>\n            <div class="complain-form__note">\n                <div class="input_editor">\n                    <div\n                            class="input__input medium-editor-element medium-editor-placeholder"\n                            data-name="note"\n                            title=""\n                            data-placeholder="Добавить комментарий"\n                            contenteditable="true">\n                    </div>\n                </div>\n            </div>\n\n            <div class="complain-form__spinner hidden"></div>\n\n            <div class="complain-form__result result hidden">\n                <div class="result__message">Спасибо, ваша жалоба успешно отправлена модераторам.</div>\n                <div class="result__checkbox hidden">\n                    <label>\n                        <input type="checkbox" class="checkbox" data-name="ignore-checkbox" />\n                        <span>'+n(o.i18n(`complain.checkbox.${t.targetType}`))+'</span>\n                    </label>\n                </div>\n            </div>\n\n            <div class="form_footer complain-form__footer">\n                <button class="button button_success complain-form__submit" disabled>Отправить</button>\n                <div class="button complain-form__close">Отмена</div>\n            </div>\n        '}else s+='\n                <p class="complain-form__message">Жаловаться пока не на что</p>\n        ';return s+"\n</div>\n"}(n);if(this.setOptions((0,C.defaults)(t||{},{data:n,content:o})),this._getElements(),this._addListeners(),!e.length||n.isReportsDisabled)return;const a=P.S.getInstance().get("UIEditor"),l=P.S.getInstance().get("UICheckbox");this._checkboxIgnoreUser=new l({el:this.els.checkboxIgnoreUser}),this._editor=new a({el:this.els.input,isToolbarButtonsDisabled:!0})}_getFilteredReasons(t){if(!Object.keys(S.f0).includes(this._targetType))throw new Error("incorrect target type");return t.filter((t=>t.type===S.f0[`${this._targetType}`]))}_getElements(){const t=this.$els.content.get(0);this.els={content:t,note:t.querySelector("."+a),input:t.querySelector("."+l),footer:t.querySelector("."+u),submitButton:t.querySelector("."+h),closeButton:t.querySelector("."+c),reasonsBlock:t.querySelector("."+d),reasons:t.querySelectorAll("."+p),checkboxIgnoreUser:t.querySelector("."+y),result:t.querySelector("."+g),resultMessage:t.querySelector("."+v),ignoreCheckbox:t.querySelector("."+f),spinner:t.querySelector("."+_)}}_addListeners(){var t;this.els.content.addEventListener("keypress",(t=>{this.els.input.innerText.length>=S.YR&&(t.preventDefault(),this._showErrorHint("maxCharsInInput",this.els.input))})),this.els.content.addEventListener("click",(t=>{var e;t.target.className===m&&this._handleInputReason(t),t.target.className.includes(l)||!this.els.input||null!==(e=this.els.input)&&void 0!==e&&e.innerText.trim().length||this._handlePlaceholder(),!t.target.className.includes(l)&&this._validationHint&&(this._validationHint=null),t.target.className.includes(l)?this._handleClickInput(t):t.target.className.includes(h)?this._handleSubmit(t):(t.target.className.includes(c)||t.target.className.includes(b))&&(t.preventDefault(),this._handleClose())})),this.els.content.addEventListener("input",(t=>{if(t.target.className!==m)return t.target.className.includes(l)&&(t.preventDefault(),this._validationHint&&(this._validationHint.hide(),this._validationHint=null),this.els.input.innerText.length>=S.YR)?(this._showErrorHint("maxCharsInInput",this.els.input),!1):void 0;this._handleInputReason(t)}),!0),null===(t=this.els.input)||void 0===t||t.addEventListener("paste",(t=>{t.preventDefault();const e=this.els.input.innerText+t.clipboardData.getData("text/plain");this.els.input.innerText=e.substr(0,S.YR),e.length>=S.YR&&this._showErrorHint("maxCharsInInput",this.els.input)})),this.listenTo(s.default,"hide-complain",(()=>{this._handleClose()}))}_handleInputReason(t){this._reasonId=t.target.value,this._activeReason=t.target,!this.els.input.innerText.length&&t.target.dataset.placeholder.length&&this.els.input.setAttribute("data-placeholder",t.target.dataset.placeholder),this._noteRequired="true"===t.target.dataset.note_required,this._isIgnoreEnable="true"===t.target.dataset.ignore_enable,this._checkboxIgnoreUser.toggleChecked(this._isIgnoreEnable,!0,!1),this.els.submitButton.removeAttribute("disabled")}async _handleSubmit(t){if(t.preventDefault(),this._noteRequired&&0===this.els.input.innerText.length)return void this._showErrorHint("needNote",this.els.input);this._editor.value=this._editor.value.replaceAll("<br>"," "),this.els.note.classList.add("hidden"),this.els.reasonsBlock.classList.add("hidden"),this.els.submitButton.classList.add("hidden"),this.els.spinner.innerHTML=s.default.icon("ui__progress-circle","user-hint"),this.els.spinner.classList.remove("hidden"),this.els.closeButton.innerText="Закрыть";const e=await this._sendComplain();this._handleResponse(e),this.els.spinner.classList.add("hidden"),this.els.result.classList.remove("hidden"),this._isUserIsAuthor||this.els.ignoreCheckbox.classList.remove("hidden")}_handleClickInput(t){t.preventDefault(),this.els.input.removeAttribute("data-placeholder"),this._validationHint&&(this._validationHint.hide(),this._validationHint=null)}_handlePlaceholder(){var t;null===(t=this.els.input.querySelector("p"))||void 0===t||t.remove(),this._activeReason&&this._activeReason.dataset.placeholder?this.els.input.setAttribute("data-placeholder",this._activeReason.dataset.placeholder):this.els.input.setAttribute("data-placeholder","Добавить комментарий")}_showErrorHint(t,e){if(this._validationHint)return;const i=`<div class="story__popup-bull complain-form__validation-hint">\n\t\t\t\t\t\t\t${s.default.i18n("complain.message."+t)}\n\t\t\t\t\t\t</div>`,r=(0,C.extend)({direction:o.Lh.TOP,alignment:o.SE.START,theme:o.xb.DANGER,target:e,content:i,autoCloseOutsideClick:!0,destroyAfterHide:!0});this._validationHint=new n._(r),this._validationHint.show()}async _sendComplain(){try{const{response:t}=await w.cf.post(S.Jz,{action:"create",target_id:this._targetId,reason_id:Number(this._reasonId),note:this._editor.value||""});return t}catch(t){console.log("Error sending a complaint:",t)}}_handleResponse(t){this._showResponseMessage(t),this._sendAnalytics(t)}_showResponseMessage(t){t.result?this.els.resultMessage.innerText="Спасибо, ваша жалоба успешно отправлена модераторам.":t.message.length>0?this.els.resultMessage.innerText=t.message:this.els.resultMessage.innerText="Извините, что-то пошло не так.",this._isComplainSent=!0}_sendAnalytics(t){if(!t)return;const e=s.default.ui.screen;E.c.getInstance().sendEvent("report_send",k(k(k({author_id:this._authorId,type:this._targetType,reason:this._reasonId},"post"===this._targetType&&{post_id:this._targetId}),"comment"===this._targetType&&{comment_id:this._targetId}),e&&{screen:e}))}async _addIgnore(){let t;try{switch(this._targetType){case"post":t=await A.jj.addRule({authors:[{id:Number(this._authorId)}],communities:"",period:A.RO.WEEK,tags:"",keywords:""},"report",this._targetType);break;case"comment":t=await A.jj.addCommentsIgnore(this._authorId,"report",this._targetType);break;case"user":const e=await A.jj.addRule({authors:[{id:Number(this._authorId)}],communities:"",period:A.RO.WEEK,tags:"",keywords:""},"report",this._targetType),{users:i}=await A.jj.getCommentsIgnoreRules();if(i.some((t=>t.id===Number(this._authorId)))){t=e;break}const n=await A.jj.addCommentsIgnore(this._authorId,"report",this._targetType);n&&s.default.emit("successIgnoreCommentsInComplain",this),t=e&&n}}catch(e){return void s.default.ui.toasts.showError(e)}t&&s.default.ui.toasts.add({content:s.default.i18n("ignore.messages.success")})}_handleClose(){var t,e;this._isClosing||(this._isClosing=!0,null!==(t=this._checkboxIgnoreUser)&&void 0!==t&&t.checked&&this._isComplainSent&&!this._isUserIsAuthor&&this._addIgnore(),!this.isShown||null!==(e=this._timeoutList)&&void 0!==e&&e.size||this.hide())}}},20610:(t,e,i)=>{i.d(e,{Jz:()=>r,YR:()=>n,f0:()=>s});const s={post:1,comment:2,user:3},n=180,r="/ajax/reports_actions.php"},65027:(t,e,i)=>{i.d(e,{Lh:()=>r,SE:()=>o,xb:()=>n});var s=i(65448);const n=new s.xs({DEFAULT:"",GRAY:"gray",WARNING:"warning",DANGER:"danger",GREEN:"green"}),r=new s.xs({LEFT:0,RIGHT:1,TOP:2,BOTTOM:3}),o=new s.xs({START:0,CENTER:1,END:2})},88358:(t,e,i)=>{i.d(e,{SE:()=>o.SE,Lh:()=>o.Lh,xb:()=>o.xb,nk:()=>$,_:()=>y,Bu:()=>b,gR:()=>E,LD:()=>A.L,aI:()=>x});var s=i(19567),n=(i(66992),i(33948),i(12953)),r=i(72044),o=i(65027),a=(i(41817),i(36005));function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function u(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){h(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function h(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const c=i(19755);const d=class{constructor(t){this._options={},t&&this.from(t)}from(t){return r.Zv.isElement(t)?this.$target=c(t):(0,a.isObject)(t)&&!(0,a.isArray)(t)&&(this.$target=void 0,this.setOptions(t)),this}equals(t){return r.Zv.isElement(t)?!(0,a.isUndefined)(this._options.$target)&&this._options.$target.is(t):!(!(0,a.isObject)(t)||(0,a.isArray)(t))&&((0,a.isUndefined)(this._options.$target)&&(0,a.every)(t,((t,e)=>"offset"===e?!!(0,a.isObject)(t)&&(this.offset.left===t.left&&this.offset.top===t.top):this[e]===t)))}setOptions(t){return(0,a.isObject)(t)?((0,a.forEach)(t,((t,e)=>{this[e]=t})),this):this}get pos(){if(this._options.target){const t=this._options.target.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset,width:t.width,height:t.height}}return u(u({},this._options.offset),{},{width:this._options.width,height:this._options.height})}get offset(){if(this._options.target){const t=this._options.target.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}}return this._options.offset}set offset(t){(0,a.isObject)(t)&&(0,a.isFinite)(t.left)&&(0,a.isFinite)(t.top)&&(this._options.offset=t)}get width(){return this._options.target?this._options.target.getBoundingClientRect().width:this._options.width}set width(t){this._options.width="number"==typeof t?t:parseInt(t,10)}get height(){return this._options.target?this._options.target.getBoundingClientRect().height:this._options.height}set height(t){this._options.height="number"==typeof t?t:parseInt(t,10)}destroy(){this._options.$target&&delete this._options.$target}get $target(){return this._options.$target}set $target(t){this._options.$target=t,this._options.target=null==t?void 0:t.get(0)}get target(){return this._options.target}set target(t){this._options.target=t,this._options.$target=t?c(t):void 0}};var p=i(10553);const m=i(19755);class _ extends s.b{constructor(t){var e,i;(super(),(r.Zv.isElement(t)||t instanceof d)&&(this.target=t,t={}),this.setOptions((0,a.defaults)(t||{},{autoCloseOutsideClick:!0,autoCloseOnMobileMenuOpen:!1,autoCloseIfTargetNotVisible:!1,useLayerForClickAway:!1,delay:300,delayClose:150,distance:2,showArrow:!0,hideByScroll:!0,popupNonOverflow:!1,autoCorrectPosition:!0,direction:o.Lh.BOTTOM,alignment:o.SE.CENTER,bottomPosition:"",leftPosition:"",stickyPosition:!1})),this.useLayerForClickAway&&(this.autoCloseOutsideClick=!1),this._options.autoCloseOnMobileMenuOpen)&&(null===(e=n.default.ui.sidebar)||void 0===e||null===(i=e.on)||void 0===i||i.call(e,"sidebar-shown",(()=>this.hide())));return this._pointerGlobPosition={x:0,y:0},this}render(){return this.isRendered||(super.render(),this.showArrow&&this.$els.wrapper.append(this._renderArrow()),n.default.listenTo(n.default,"video-iframe-enter",(()=>{this.hide()}))),this}updateWidth(){var t;if(!this.$el)return this;const e=(Number(null===(t=this.target)||void 0===t?void 0:t.width)||50)/100;return this.$el.css({width:s.b._getCurrentWidth(this.width,e),minWidth:s.b._getCurrentWidth(this.minWidth,e),maxWidth:s.b._getCurrentWidth(this.maxWidth,e)}),this}show(){return this.isShown||(this._setVisibilityObserver(this.autoCloseIfTargetNotVisible),super.show()),this}hide(){return this._setVisibilityObserver(!1),super.hide()}destroy(){this._setVisibilityObserver(!1),super.destroy()}_renderArrow(){return this.$els.arrow?this.$els.arrow:this.$els.arrow=m(document.createElement("div")).html((0,p.t)("ui__tooltip-arrow")).addClass("popup__arrow")}onMouseMove(t,e){return this._pointerGlobPosition.x=t,this._pointerGlobPosition.y=e,this}isPointerOverBox(t){if(this.isDestroyed)return!0;try{let e=t instanceof d,{left:i,top:s}=e?t.offset:n.default.ui.offsetElement(t),r=(e?t.width:t.outerWidth())+3,o=(e?t.height:t.outerHeight())+3,a=this._pointerGlobPosition.x,l=this._pointerGlobPosition.y;return a>=i-3&&a<=i+r&&l>=s-3&&l<=s+o}catch(e){return!0}}updatePosition(){if(this.isDestroyed||!this.isShown||this.stickyPosition||!this.target)return this;const t=18,e=this.target.pos;let i,r,a,l,u=this.$el.outerWidth(),h=this.$el.outerHeight(),c=this.distance,d=24,p=e.left-u+d,m=e.left+e.width-d,_=e.top-h+d,g=e.top+e.height-d,v=Math.min(u,e.width),f=Math.min(h,e.height);this.showArrow&&(l={},c+=6);const y={top:n.default.ui.lastScrollTop,left:n.default.ui.lastScrollLeft,bottom:n.default.ui.lastScrollTop+n.default.ui.windowHeight,right:n.default.ui.lastScrollLeft+n.default.ui.windowWidth},b=this._options.viewPortBoundary;if(b){const t="function"==typeof b?b():b;t.left&&(y.left=Math.max(y.left,t.left)),t.right&&(y.right=Math.min(y.right,t.right)),t.top&&(y.top=Math.max(y.top,t.top)),t.bottom&&(y.bottom=Math.min(y.bottom,t.bottom))}{let t,s,n=Number.MAX_VALUE;if(this.autoCorrectPosition)switch(this.direction){case o.Lh.TOP:t=[o.Lh.TOP,o.Lh.BOTTOM,o.Lh.LEFT,o.Lh.RIGHT];break;case o.Lh.BOTTOM:t=[o.Lh.BOTTOM,o.Lh.TOP,o.Lh.LEFT,o.Lh.RIGHT];break;case o.Lh.LEFT:t=[o.Lh.LEFT,o.Lh.RIGHT,o.Lh.TOP,o.Lh.BOTTOM];break;case o.Lh.RIGHT:t=[o.Lh.RIGHT,o.Lh.LEFT,o.Lh.TOP,o.Lh.BOTTOM]}else t=[this.direction];for(let i of t){let t,r=0,a=0;switch(i){default:case o.Lh.BOTTOM:a=e.top+e.height+c,t=a+h-y.bottom;break;case o.Lh.TOP:a=e.top-h-c,t=y.top-a;break;case o.Lh.LEFT:r=e.left-u-c,t=y.left-r;break;case o.Lh.RIGHT:r=e.left+e.width+c,t=r+u-y.right}t<0&&(t=0),t<n&&(n=t,s=[i,r,a])}i=s[0]===o.Lh.BOTTOM||s[0]===o.Lh.TOP,r=s[1],a=s[2],this.arrowDirection=s[0]}switch(this.alignment){case o.SE.START:i?(r=e.left,this.showArrow&&(l.left=Math.max(6,Math.min(6,v/2-9)))):(a=e.top,this.showArrow&&(l.top=Math.max(6,Math.min(6,f/2-9))));break;case o.SE.END:i?(r=e.left+e.width-u,this.showArrow&&(l.left=Math.min(u-t-6,u-v/2-9))):(a=e.top+e.height-h,this.showArrow&&(l.top=Math.min(h-t-6,h-f/2-9)));break;default:case o.SE.CENTER:if(i){let t=u/2;r=e.left+e.width/2-t,this.showArrow&&(l.left=Math.max(6,t-9))}else{let t=h/2;a=e.top+e.height/2-t,this.showArrow&&(l.top=Math.max(6,t-9))}}if(i&&(r<y.left+d||r+u>y.right-5)&&(r<y.left+d&&(r=y.left+d),r+u>y.right-d&&(r=y.right-u-d),r<p&&(r=p),r>m&&(r=m),r<d&&(r=d),this.showArrow)){const t=Math.max(e.left,r+12),i=Math.min(e.left+e.width,r+u-12);l.left=t-r+((i-t)/2-9)}if(!i&&this.autoCorrectPosition&&(a<y.top+d||a+h>y.bottom-5)&&(a<y.top+d&&(a=y.top+d),a+h>y.bottom-d&&(a=y.bottom-h-d),a<_&&(a=_),a>g&&(a=g),a<d&&(a=d),this.showArrow)){const t=Math.max(e.top,a+12),i=Math.min(e.top+e.height,a+h-12);l.top=t-a+((i-t)/2-9)}return this._options.bottomPosition?this.$el.css({top:"auto",left:Math.abs(Math.ceil(r))+"px",bottom:this._options.bottomPosition,position:"fixed"}):this._options.topPosition?this.$el.css({bottom:"auto",left:Math.abs(Math.ceil(r))+"px",top:this._options.topPosition,position:"fixed"}):this._options.leftPosition?this.$el.css({left:this._options.leftPosition,top:Math.abs(Math.ceil(a))+"px"}):this.$el.css({left:Math.abs(Math.ceil(r))+"px",top:Math.abs(Math.ceil(a))+"px"}),this.showArrow&&(l.top=s.b.toPx(l.top),l.left=s.b.toPx(l.left),this.$els.arrow.css(l)),this}_setVisibilityObserver(t){!t&&this._visibilityObserver?(this._visibilityObserver.disconnect(),this._visibilityObserver=null):t&&!this._visibilityObserver&&this.target.$target&&(this._visibilityObserver=new IntersectionObserver((([t])=>{t.isIntersecting||(this.hide(),this._visibilityObserver.disconnect(),this._visibilityObserver=null)}),{threshold:1}),this._visibilityObserver.observe(this.target.$target.get(0)))}get showArrow(){return this._options.showArrow}set showArrow(t){return this._options.showArrow=Boolean(t)}get direction(){return this._options.direction||o.Lh.BOTTOM}set direction(t){let e=this._options.direction;(t=o.Lh[t])&&t!==e&&(this._options.direction=t)}get alignment(){return this._options.alignment||o.SE.CENTER}set alignment(t){let e=this._options.alignment;(t=o.SE[t])&&t!==e&&(this._options.alignment=t)}get autoCorrectPosition(){return this._options.autoCorrectPosition}set autoCorrectPosition(t){return this._options.autoCorrectPosition=Boolean(t)}get distance(){return this._options.distance}set distance(t){return t="number"==typeof t?t:parseInt(t,10),this._options.distance===t||(this._options.distance=t,this.isShown&&this.updatePosition()),t}get delay(){return this._options.delay}set delay(t){return this._options.delay=parseInt(t)}get delayClose(){return this._options.delayClose}set delayClose(t){return this._options.delayClose=parseInt(t)}get autoCloseOutsideClick(){return this._options.autoCloseOutsideClick}set autoCloseOutsideClick(t){return this._options.autoCloseOutsideClick=t}get useLayerForClickAway(){return this._options.useLayerForClickAway}set useLayerForClickAway(t){return this._options.useLayerForClickAway=Boolean(t)}get stickyPosition(){return this._options.stickyPosition}get arrowDirection(){return this._options.arrowDirection}set arrowDirection(t){return t=o.Lh[t],this.showArrow&&this.arrowDirection!==t?(this.$els.arrow&&this.$els.arrow.toggleClass("popup__arrow_left",t===o.Lh.LEFT).toggleClass("popup__arrow_right",t===o.Lh.RIGHT).toggleClass("popup__arrow_top",t===o.Lh.TOP).toggleClass("popup__arrow_bottom",t===o.Lh.BOTTOM),this._options.arrowDirection=t):this}get target(){return this._options.target}set target(t){if(this.target)if(t instanceof d)this.target.destroy(),this._options.target=t;else{if(this.target.equals(t))return this.target;this.target.from(t)}else this._options.target=new d(t);return this.isShown&&(this.updateWidth(),this.updatePosition()),this.emit("target"),this.target}get autoCloseIfTargetNotVisible(){return this._options.autoCloseIfTargetNotVisible}set autoCloseIfTargetNotVisible(t){this.isShown&&this._setVisibilityObserver(t),this._options.autoCloseIfTargetNotVisible=t}}var g=i(63907),v=i(91033);const f=i(19755);class y extends _{constructor(t){return super(t),this._skipNextClick=!1,this._hideByClickBound=this._hideByClick.bind(this),this._updatePositionBound=(0,a.throttle)(this.updatePosition.bind(this),300),this._onOverlayMouseDownBound=this._onOverlayMouseDown.bind(this),this._shouldHideImmediately=!1,this}_onOverlayMouseDown(){return this.hide(),this}render(){return this.isRendered||(super.render(),this.$el.addClass("popup_animate"),this.useLayerForClickAway&&this.$el.append(this._renderOverlay().click(this._onOverlayMouseDownBound)),this.popupNonOverflow&&this.$els.container.css({overflow:"initial"}),this._options.showDarkOverlay&&(this._renderOverlay(),this.$els.overlay.addClass("dark-overlay")),n.default.ua.ios&&(this.metaTheme=document.querySelector('meta[name="theme-color"]'))),this}_hideByClick(){if(this._skipNextClick)return this._skipNextClick=!1,this;let t=!this.isPointerOverBox(this.$el),e=!this.isPointerOverBox(this.target),i=!this.addTarget||!this.isPointerOverBox(this.addTarget);return t&&e&&i&&(this.emit("overlayClicked"),this.hide()),this}_renderOverlay(){return this.$els.overlay?this.$els.overlay:this.$els.overlay=f(document.createElement("div")).addClass("popup__balloon-overlay")}mount(){return this.isMounted||(super.mount(),this.stickyPosition?this.target.$target.append(this.$el):n.default.ui.overlays.balloon.appendPopup(this),this.addOverlay&&(this.$els.balloonOverlay=f(document.createElement("div")).addClass("popup-overlay").insertBefore(this.$el))),this}unmount(){return this.isMounted?(super.unmount(),n.default.ui.overlays.balloon.hidePopup(),this.addOverlay&&this.$els.balloonOverlay.remove(),this):this}show(){return this.isShown||this.isDestroyed||(n.default.ui.overlays.balloon.showPopup(),this.cancelTimeout("hide"),super.show(),this.updateWidth(),this.updatePosition(),this.$el.show().removeClass("popup_hide").addClass("popup_show"),this.listenTo(n.default.ui,"pointer-move",this.onMouseMove),this.listenTo(n.default,"close-auth",(()=>{this.shouldHideImmediately=!0,this.hide()})),this.autoCloseOutsideHandler=!0,this.listenTo(n.default.ui,"document-scroll",this._updatePositionBound),this.listenTo(n.default.ui,"orientationchange",(()=>{setTimeout((()=>{this.updatePosition()}),0)})),this._resizeObserver=new v.Z(this._updatePositionBound),this._resizeObserver.observe(document.documentElement),this.$el.on("DOMSubtreeModified",".popup__hint",(()=>{this.updateWidth(),this.updatePosition()})),this.interval("watch-visible",500,(()=>{(!this.target||this.target.$target&&this.target.$target.is(":hidden"))&&this.hide()})),n.default.ua.ios&&this.metaTheme.setAttribute("content",n.default.ui.css.colors.headerBackground)),this}destroy(){delete this.$els.overlay,this._resizeObserver&&this._resizeObserver.disconnect(),super.destroy()}hide(){return!this.isShown||this.isDestroyed||(this.stopListening(n.default.ui),this.cancelInterval("watch-visible"),this._options.isShown=!1,this.autoCloseOutsideHandler=!1,this.isRendered&&this.$el.removeClass("popup_show").addClass("popup_hide"),this.emit("hide"),this.emit(g.eM.HIDDEN),this.timeout("hide",this.animationDelay,(()=>{n.default.logger.log("balloon","hide removed"),super.hide(),this.destroyAfterHide&&this.destroy()}))),this}addClickTarget(t){this.addTarget=t}get popupNonOverflow(){return this._options.popupNonOverflow}get animationDelay(){return this.shouldHideImmediately?0:n.default.ui.css.animationPopup}get addOverlay(){return this._options.addOverlay}set addOverlay(t){this._options.addOverlay!==(t=Boolean(t))&&(this._options.addOverlay=t)}get zIndex(){return this._options.zIndex}set zIndex(t){this._options.zIndex!==(t=Number(t))&&(this._options.zIndex=t)}get hideByScroll(){return this._options.hideByScroll}set hideByScroll(t){this._options.hideByScroll!==(t=Boolean(t))&&(this._options.hideByScroll=t)}set autoCloseOutsideHandler(t){if(!this.autoCloseOutsideClick)return;if(this._options.autoCloseOutsideHandler!==t){if(this._options.autoCloseOutsideHandler=t,this._skipNextClick=t,this.cancelTimeout("skipNextClick"),t&&!this.isDestroyed&&this.isShown)return this._skipNextClick=!0,this.timeout("skipNextClick",100,(()=>{this._skipNextClick=!1})),f(document).on("click",this._hideByClickBound),void(this.hideByScroll&&f(document).on("scroll",this._hideByClickBound));f(document).off("click",this._hideByClickBound).off("scroll",this._hideByClickBound)}}set shouldHideImmediately(t){this._shouldHideImmediately=t}get shouldHideImmediately(){return this._shouldHideImmediately}}class b extends y{constructor(t){return super(t),this.els||(this.els={}),this.els.highlighter=void 0,this}show(){return this.isShown||this.isDestroyed||(super.show(),this._options.lockScroll&&document.body.style.setProperty("overflow","hidden"),this._options.highlightTarget&&(document.body.style.setProperty("overflow","hidden"),this.els.highlighter=document.createElement("div"),this.els.highlighter.classList.add("popup-highlighter"),this.els.highlighter.style.setProperty("z-index",this.zIndex),this.el.parentElement.insertBefore(this.els.highlighter,this.el),this.updateHighlighter())),this}hide(){var t;return!this.isShown||this.isDestroyed||(super.hide(),this._options.lockScroll&&document.body.style.removeProperty("overflow"),null===(t=this.els.highlighter)||void 0===t||t.remove()),this}updatePosition(){return this.updateHighlighter(),super.updatePosition()}updateHighlighter(){var t;if(!this.els.highlighter)return;const[e,i,s,n]=null!==(t=this._options.highlightOffset)&&void 0!==t?t:[0,0,0,0];this.els.highlighter.style.setProperty("width",`${this.target.width+n+i}px`),this.els.highlighter.style.setProperty("height",`${this.target.height+e+s}px`),this.els.highlighter.style.setProperty("left",this.target.offset.left-n+"px"),this.els.highlighter.style.setProperty("top",this.target.offset.top-e+"px")}}function w(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class E extends _{constructor(t){super(),w(this,"_onAncestorScroll",(t=>{t.target===document||this.targetEl&&!t.target.contains(this.targetEl)||this._checkMouseOut()})),this._checkMouseOutThrottle=(0,a.throttle)(this._checkMouseOut.bind(this),150),this._updatePositionBound=(0,a.throttle)(this.updatePosition.bind(this),300),this._onMouseEnterBound=this.onMouseEnter.bind(this),this._isDisabled=!1,this._addTargets=new Set,this._lastScrollPosition={x:0,y:0},(r.Zv.isElement(t)||t instanceof d)&&(this.target=t,t={}),this.setOptions((0,a.defaults)(t||{},{delay:800,destroyAfterHide:!0,interactive:!1,canHide:!0}))}onMouseEnter(t){if(t)return this.mouseInTarget=!0,super.onMouseMove(t.pageX,t.pageY),this}onMouseMove(t,e){return super.onMouseMove(t,e),this._checkMouseOutThrottle(),this}_checkMouseOut(){return this.mouseInTarget=!this._isMouseOut(),this}_isMouseOut(){return!(this.interactive&&this.$el&&this.isPointerOverBox(this.$el)||this.isPointerOverBox(this.target)||this._addTargets.size&&[...this._addTargets].some((t=>this.isPointerOverBox(t))))}destroy(){this.isDestroyed||(this.target&&(this.target.$target&&this.target.$target.removeData("hint"),this.target.destroy()),super.destroy())}render(){return this.isRendered||(super.render(),this.$el.addClass("popup_animate"),this.interactive?this.$el.on("mouseenter",this._onMouseEnterBound):this.$el.css("pointer-events","none")),this}show(){if(this.isShown||this.isDestroyed||this._isDisabled)return this;const t=this.targetEl;if(t&&!document.body.contains(t))return this.destroy(),this;n.default.logger.log("hint","show()"),this.cancelTimeout("hide","destroy"),super.show(),n.default.ui.overlays.hint.showPopup(),this.updateWidth(),this.updatePosition(),this._lastScrollPosition={x:n.default.ui.lastScrollLeft,y:n.default.ui.lastScrollTop};const e=(0,a.throttle)((()=>{this.updatePosition(),this.onScrollMove(),this._checkMouseOut()}),300);return this.listenTo(n.default.ui,"document-scroll",e),this.listenTo(n.default.ui,"resize",e),document.addEventListener("scroll",this._onAncestorScroll,{capture:!0}),this.$el.show().removeClass("popup_hide").addClass("popup_show"),this.listenToOnce(n.default,"ignore-actions-complain",(()=>{this.hide()})),this}onScrollMove(){let t=this._lastScrollPosition.y-n.default.ui.lastScrollTop,e=this._lastScrollPosition.x-n.default.ui.lastScrollLeft,i=this._pointerGlobPosition.x-e,s=this._pointerGlobPosition.y-t;return super.onMouseMove(i,s),this._lastScrollPosition.x=n.default.ui.lastScrollLeft,this._lastScrollPosition.y=n.default.ui.lastScrollTop,this}hide(){return this.isShown&&!this.isDestroyed&&this.canHide?(n.default.logger.log("hint","hide()"),this._options.isShown=!1,this.$el.removeClass("popup_show").addClass("popup_hide"),this.emit(g.eM.HIDDEN,this),this.timeout("hide",n.default.ui.css.animationPopup,(()=>{n.default.logger.log("hint","super.hide()",this.destroyAfterHide),super.hide();let t=this.destroyAfterHide;t&&(!0===t?this.destroy():this.timeout("destroy",(0,a.isNumber)(t)?t:200,(()=>{this.isShown||this.destroy()})))})),document.removeEventListener("scroll",this._onAncestorScroll,{capture:!0}),this):this}mount(){return this.isMounted||(super.mount(),n.default.ui.overlays.hint.appendPopup(this)),this}unmount(){return this.isMounted?(super.unmount(),n.default.ui.overlays.hint.hidePopup(),this):this}addMouseTarget(t){!this._addTargets.has(t)&&this._addTargets.add(t)}get interactive(){return this._options.interactive}set interactive(t){this._options.interactive=Boolean(t)}get targetEl(){const t=this._options.target;return t instanceof d?t.$target[0]:r.Zv.isJQuery(t)?t[0]:void 0}get target(){return this._options.target}set target(t){if(this.target)if(t instanceof d)this.target.$target&&this.target.$target.off(this._onMouseEnterBound),this.target.destroy(),this._options.target=t;else{if(this.target.equals(t))return this.target;this.target.$target&&this.target.$target.off(this._onMouseEnterBound),this.target.from(t)}else this._options.target=new d(t);return this.isShown&&(this.updateWidth(),this.updatePosition()),this.target.$target&&(this.target.$target.on("mouseenter",this._onMouseEnterBound),this.target.$target.on("mouseleave",(()=>{this.mouseInTarget=!1}))),this.target}get mouseInTarget(){return this._options.mouseInTarget}set mouseInTarget(t){return(t=Boolean(t))!==this.mouseInTarget&&(t&&!this._isListenerForCloseHintExist&&(this._isListenerForCloseHintExist=!0,this.listenTo(n.default.ui,"close-hint-shown",(()=>{this._options.mouseInTarget=!1,this.isShown=!1,this._isListenerForCloseHintExist=!1,this.stopListening(n.default.ui,"close-hint-shown")}))),this._options.mouseInTarget=t,this.stopListening(n.default.ui,"pointer-move"),t&&this.listenTo(n.default.ui,"pointer-move",((t,e)=>{this.onMouseMove(t,e)})),this.timeout("toggleDelay",t?this.delay:this.delayClose,(()=>{t&&this._checkMouseOut(),this.isShown=this.mouseInTarget})),n.default.logger.log("hint","mouse",t?"in":"out"),t)}set disabled(t){return this._isDisabled=Boolean(t),this._isDisabled}get canHide(){return this._options.canHide}set canHide(t){return this._options.canHide=Boolean(t)}}var A=i(81143),S=(i(88674),i(95411)),P=i(65448),C=i(58330),T=i(19755),k=i.n(T);const D=["modal.yes","green",!0],I=["modal.cancel"];class ${static confirmModal({header:t,content:e="Сделать это?",buttons:i=[],minWidth:s,maxWidth:r,buttonsAlign:o="left",callback:l,isHeaderLeftAlign:u=!1,wrapperExtraClass:h="",zIndex:c}={}){return new Promise((d=>{let p=!0,m=new A.L({destroyAfterHide:!0,indent:!0,minWidth:s||450,maxWidth:r,isHeaderLeftAlign:u,wrapperExtraClass:h});"center"===o&&m.footer.addClass(`popup__footer_${o}`),c&&(m.zIndex=c),t&&(m.header=n.core.i18n(t)),e&&(m.content=n.core.i18n(e)),(0,a.isArray)(i)&&i.length||(i=[D,I]),i.forEach(((t,e)=>{let[i,s,n]=t;0===e&&(p=!(0,a.isBoolean)(n)||n),m.addButtonIntoFooter(i||"modal.yes",(()=>{d(n),m.hide()}),s)})),m.on(g.eM.UNMOUNTED,(()=>{d(!1)})),n.core.ui.hotkeys.once("enter",(()=>{d(p),m.hide()}),{closest:m.$el,context:m,type:S.FM.KEYDOWN}),m.show(),l&&l()}))}static confirmBalloon({target:t,header:e,content:i,buttons:s=[],maxWidth:r}={}){return new Promise((l=>{let u=!0,h=new y({target:t,destroyAfterHide:!0,indent:!0,width:400,theme:o.xb.WARNING,maxWidth:r});e&&(h.header=n.core.i18n(e)),i&&(h.content=n.core.i18n(i)),(0,a.isArray)(s)&&s.length||(s=[D,I]),s.forEach(((t,e)=>{let[i,s,n]=t;0===e&&(u=!(0,a.isBoolean)(n)||n),h.addButtonIntoFooter(i||"modal.yes",(()=>{l(n),h.hide()}),s)})),h.on(g.eM.UNMOUNTED,(()=>{l(!1)})),n.core.ui.hotkeys.once("enter",(()=>{l(u),h.hide()}),{closest:h.$el,context:h,type:S.FM.KEYDOWN}),n.core.ui.hotkeys.once("escape",(()=>{h.hide()}),{closest:h.$el,context:h,type:S.FM.KEYDOWN}),h.show()}))}static popupEnum(t,e,i,s,r){const o=(0,a.uniqueId)("popup-enum"),l=void 0!==s,u="boolean"==typeof e?[!0,!1]:e.entries();"object"!=typeof i&&(i=i||"",i+="."===i.slice(-1)?"":"."),s=s instanceof P.Tf?s.valueOf():s;const h=u.map(((t,e)=>{const r=l?s===t.valueOf():0===e,a="object"!=typeof i?n.core.i18n(i+t.toString(),0):i[t.toString()];return`<p class="form__field${r?" form__field_current":""}"><label><input type="radio" name="${o}" value="${t.toString()}" ${r?'checked="checked"':""}> `+a+"</label></p>"})).join("\n"),c=new y({target:t,alignment:r,content:k()(`<form novalidate>${h}</form>`),indent:!0}),d=new(C.S.getInstance().get("UIForm"))(c.content);return c.marks.set("form",d),c.listenTo(d,"change",(()=>{const t=d.serialize()[o];c.emit("change",d,"boolean"==typeof e?1===t:e[t])})),c}}const O=i(19755);class x extends g.u1{constructor(t){super(t),this._openedPopups=0}appendPopup(t){return this.render(),t.zIndex||(t.zIndex=this.zIndex),t.appendTo(this.$el),this}render(){return this.isRendered||(this.$el=O(document.createElement("div")).addClass("overlay").css("z-index",this.zIndex),super.render()),this}showPopup(t=!1){return this._openedPopups++,n.default.logger.log("overlay","show",this.isShown),this.isShown||(t||this.emit("show"),this.show()),this}hidePopup(){return this._openedPopups--,n.default.logger.log("overlay",this._openedPopups),this._openedPopups>0||(this.emit("hide"),this.hide()),this}get zIndex(){return this._options.zIndex||6e3}set zIndex(t){return this._options.zIndex=t}get openedPopups(){return this._openedPopups}}},81143:(t,e,i)=>{i.d(e,{L:()=>h});var s=i(12953),n=i(92927),r=i(58330),o=i(19567),a=i(36005),l=i(47442);i(12052),i(81780);const u=i(19755);class h extends o.b{constructor(t){return super(),this.setOptions((0,a.extend)({autoClosePressEscape:!0,autoCloseOutsideClick:!0,isBlockOverflowTouch:!0,isModalMenu:!1,hideOverlay:!1,isBottomWidget:!1,isHeaderLeftAlign:!1,closeHintShown:!1,isNotCropHeight:!1},t||{})),this._onOverlayMouseDownBound=this._onOverlayMouseDown.bind(this),this._onOffElementMouseDownBound=this._onOffElementMouseDown.bind(this),this._updatePositionBound=(0,a.throttle)(this.updatePosition.bind(this),300),this}_onOverlayMouseDown(){this.hide()}_onOffElementMouseDown(t){let e=t.target;const i=this.$els.wrapper.get(0);if(e&&i&&i.contains(e))return!1;this.hide()}render(){return this.isRendered||(super.render(),s.default.logger.log("modal","render modal"),this.$el.prop("tabindex",0).addClass("popup_modal"),this._options.hideOverlay||this.$el.append(this._renderOverlay()),this._options.isModalMenu&&this.$el.addClass("popup_modal-menu"),this._options.isBottomWidget&&this.$el.addClass("popup_bottom-widget"),this.$el.addClass("popup_animate"),this.$el.addClass("popup_oldstyle"),this._options.header&&this.$els.container.prepend(this._renderHeader()),this._options.isFullSize&&this.$el.addClass("popup_full-size"),this.$el.on("click",".popup__close",(()=>this.hide()))),this}_renderOverlay(){return this.$els.overlay?this.$els.overlay:this.$els.overlay=u(document.createElement("div")).addClass("popup__overlay")}_renderHeader(){return this.$els.header||(this.$els.header=u(document.createElement("div")).addClass("popup__header").hide(),this._options.isHeaderLeftAlign&&this.$els.header.addClass("popup__header_align-left")),this.$els.header}show(){return this.isShown||(super.show(),this.cancelTimeout("hide"),s.default.ui.overlays.modal.showPopup(this._options.hideOverlay),this.$el.removeClass("popup_hide").show(),n.$.request((()=>{this.$el.addClass("popup_show")})),this.updatePosition(),this.listenTo(s.default.ui,"orientationchange",(()=>{setTimeout((()=>{this.updatePosition()}),0)})),"ResizeObserver"in window&&(this._resizeObserver=new ResizeObserver(this._updatePositionBound),this._resizeObserver.observe(document.documentElement)),this.autoCloseOutsideClick&&setTimeout((()=>{this._setAutoCloseOutsideClickHandler(!0)})),this.autoClosePressEscape&&this._setAutoClosePressEscapeHandler(!0),this.closeHintShown&&s.default.ui.emit("close-hint-shown"),s.default.emit("popup-modal-shown"),this.$el.focus()),this}mount(){return this.isMounted||(super.mount(),s.default.ui.overlays.modal.appendPopup(this)),this}unmount(){return this.isMounted?(super.unmount(),s.default.ui.overlays.modal.hidePopup(),this):this}hide(){return this.isShown?(this.$el.prev().focus(),this.autoClosePressEscape&&this._setAutoClosePressEscapeHandler(!1),this.autoCloseOutsideClick&&this._setAutoCloseOutsideClickHandler(!1),(this.autoClosePressEscape||this.autoCloseOutsideClick)&&"UIComplainModalPopup"===this._name&&s.default.emit("hide-complain"),this.$el.removeClass("popup_show").addClass("popup_hide"),this.timeout("hide",s.default.ui.css.animationPopup,(()=>{super.hide(),this.destroyAfterHide&&this.destroy()})),s.default.emit("popup-modal-hidden"),this):this}updatePosition(){var t;if(null===(t=this.$el)||void 0===t||!t.length)return this;s.default.ui.windowWidth,s.default.ui.windowHeight,this._renderFooter().outerHeight(),this._renderHeader().outerHeight();this.updateSize()}updateWidth(){return this}updateSize(){var t;if(null===(t=this.$el)||void 0===t||!t.length)return this;const e=this._renderFooter().outerHeight()+this._renderHeader().outerHeight(),i=s.default.ui.windowWidth-e-40,n=this._options.isNotCropHeight?s.default.ui.windowHeight:s.default.ui.windowHeight-e-40;return this._renderContent().css({width:this.width?Math.min(this.width,i):void 0,minWidth:this.minWidth?Math.min(this.minWidth,i):void 0,maxWidth:this.maxWidth?Math.min(this.maxWidth,i):void 0,maxHeight:this._options.isModalMenu||this._options.isFullSize?void 0:n}),this}showError(t){this.toasts.add({content:t,theme:l.K.DANGER,$parent:this.$els.overlay})}get isBlockOverflowTouch(){return this._options.isBlockOverflowTouch}set isBlockOverflowTouch(t){this._options.isBlockOverflowTouch!==t&&(this._options.isBlockOverflowTouch=t)}get toasts(){let t=this._options.toasts;return t||(t=this._options.toasts=new(r.S.getInstance().get("UIToasts")),t)}get header(){return this._renderHeader()}set header(t){return this._options.header=t=!!((0,a.isString)(t)&&t.length>0)&&String(t),t?this._renderHeader().show().html(t):this.$els.header?this._renderHeader().hide():void 0}get autoCloseOutsideClick(){return this._options.autoCloseOutsideClick}set autoCloseOutsideClick(t){t=Boolean(t);return this._options.autoCloseOutsideClick!==t&&this.isShown&&this._setAutoCloseOutsideClickHandler(t),this._options.autoCloseOutsideClick=t}_setAutoCloseOutsideClickHandler(t){var e,i;t?this._options.hideOverlay?document.addEventListener("click",this._onOffElementMouseDownBound):null===(e=this.$els.overlay)||void 0===e||e.click(this._onOverlayMouseDownBound):this._options.hideOverlay?document.removeEventListener("click",this._onOffElementMouseDownBound):null===(i=this.$els.overlay)||void 0===i||i.off("click")}get closeHintShown(){return this._options.closeHintShown}set closeHintShown(t){this._options.closeHintShown=Boolean(t)}get autoClosePressEscape(){return this._options.autoClosePressEscape}set autoClosePressEscape(t){t=Boolean(t);return this._options.autoClosePressEscape!==t&&this.isShown&&this._setAutoClosePressEscapeHandler(t),this._options.autoClosePressEscape=t}_setAutoClosePressEscapeHandler(t){t?s.default.ui.hotkeys.on("escape",this._onOverlayMouseDown,{closest:this.$el,context:this}):s.default.ui.hotkeys.off("escape",!1,{context:this})}get isSwipeable(){return Boolean(this._options.isSwipeable)}set isSwipeable(t){t=Boolean(t),this.isSwipeable}get onTopSwipeHandler(){return this._options.onTopSwipeHandler}}},31200:(t,e,i)=>{i.d(e,{kd:()=>y,Qm:()=>b,aM:()=>w,jE:()=>v,Ri:()=>f});i(41817),i(66992),i(33948),i(88674);var s=i(88358),n=i(96637);var r=i(81780),o=(i(75130),i(12953)),a=i(41773),l=i(82800),u=i(50071);const h=["id","endDateString","title","text","setShownStateOnHidden","showOnce","shownCheckStrategy","btnConfig","secondaryBtnConfig","cssModificators","overlapSidebars","showManually"];function c(t,e){if(null==t)return{};var i,s,n=function(t,e){if(null==t)return{};var i,s,n={},r=Object.keys(t);for(s=0;s<r.length;s++)i=r[s],e.indexOf(i)>=0||(n[i]=t[i]);return n}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(s=0;s<r.length;s++)i=r[s],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function d(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function p(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?d(Object(i),!0).forEach((function(e){m(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function m(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const _="pkb_notifs",g=500;function v(){const t=n.LocalStorage.get(_);return Array.isArray(t)?t:[]}function f(t){const e=v();n.LocalStorage.set(_,[...e,{id:t}])}function y(t){return w(p(p({},t),{},{shownCheckStrategy:{getIsShown:t=>v().some((e=>e.id===t)),setIsShown:function(t){this.getIsShown(t)||f(t)}}}))}function b(t){return w(p(p({},t),{},{shownCheckStrategy:{getIsShown:t=>a.E.has(t),setIsShown:function(t){this.getIsShown(t)||a.E.set(t,!0)}}}))}async function w(t){var e,i,n;const a=p({autoCloseOnMobileMenuOpen:!1,autoCloseOutsideClick:!1,indent:0},t),{id:d,endDateString:m,title:_,text:v,setShownStateOnHidden:f=!0,showOnce:y=!1,shownCheckStrategy:b,btnConfig:w,secondaryBtnConfig:E,cssModificators:A=[],overlapSidebars:S,showManually:P}=a,C=c(a,h),T=C.target instanceof HTMLElement?C.target:null===(e=C.target)||void 0===e?void 0:e.get(0);if(!T)return;let k=!1;if(b&&d)try{k=await b.getIsShown(d)}catch(R){console.error(R)}if(k||!function(t){const e=new Date;return!t||new Date(t)>e}(m))return;(0,u.k)(T)||await(0,u.A)();const D=null===(i=C.theme)||void 0===i?void 0:i.valueOf(),I=(...t)=>{const e="pkb-normal-btn";return[e,...t.filter(Boolean).map((t=>`${e}_${t}`))].join(" ")},$=(null==w?void 0:w.class)||I("small",D===l.xb.DANGER?"gray":D===l.xb.WARNING?"negative":""),O=(null==E?void 0:E.class)||I("small",D===l.xb.GREEN?"border":"gray");var x,B,L;C.content||(C.content=(x={customStyle:A.map((t=>`popup__content-notification_${t}`)).join(" "),title:_,text:v,mainBtnLabel:(null==w?void 0:w.label)||"Понятно",mainBtnClass:$,secondaryBtnLabel:null==E?void 0:E.label,secondaryBtnClass:O},L="",Array.prototype.join,L+='<div class="popup__content-notification '+(null==(B=x.customStyle?x.customStyle:"")?"":B)+'">\n\t',x.title&&(L+='\n\t<h4 class="popup__title">'+(null==(B=x.title)?"":B)+"</h4>\n\t"),L+="\n\t<p>"+(null==(B=x.text)?"":B)+'</p>\n\t<footer>\n\t\t<button class="popup__button popup__button_main '+(null==(B=x.mainBtnClass)?"":B)+'">'+(null==(B=x.mainBtnLabel)?"":B)+"</button>\n\t\t",x.secondaryBtnLabel&&(L+='\n\t\t<button class="popup__button popup__button_secondary '+(null==(B=x.secondaryBtnClass)?"":B)+'">'+(null==(B=x.secondaryBtnLabel)?"":B)+"</button>\n\t\t"),L+="\n\t</footer>\n</div>"));const M=new s.Bu(C);if(S||(M.zIndex=5e3),!P){const t=()=>{setTimeout((()=>{M.show(),y&&d&&(null==b||b.setIsShown(d,!0))}),g)};if(o.core.ui.elementInViewport(T))t();else{new IntersectionObserver(((e,i)=>{e.forEach((e=>{e.isIntersecting&&(t(),i.unobserve(e.target))}))}),{threshold:1}).observe(T)}}const F=null!==(n=null==w?void 0:w.handler)&&void 0!==n?n:M.hide.bind(M);return M.content.on("click",".popup__button_main",F),M.content.on("click",'[data-role="close"]',M.hide.bind(M)),E&&M.content.on("click",".popup__button_secondary",E.handler),M.on(r.e.HIDDEN,(()=>{if(f)try{d&&(null==b||b.setIsShown(d,!0))}catch(R){console.error(R)}})),t.onMounted&&M.on(r.e.MOUNTED,(()=>{var e;return null===(e=t.onMounted)||void 0===e?void 0:e.call(t)})),M}},11315:(t,e,i)=>{i.d(e,{j:()=>u});var s=i(12953),n=i(63907),r=i(96637),o=i(36005);const a=i(19755);class l extends n.u1{constructor(t){super(),this._width=100,this._radius=this._width/2,this._length=Math.PI*(2*this._radius),super.setOptions((0,o.defaults)(t||{},{percent:0,indeterminate:!0}))}mount(){return this.isMounted||(super.mount(),this.strokeWidth=this.strokeWidth||parseInt(this.$els.svg.css("stroke-width")||15,10)),this}render(){return this.isRendered||(this.$el=a(document.createElement("div")).addClass("progress-circle"),this.$els.svg=a(s.default.icon("ui__progress-circle")).toggleClass("icon--ui__progress-circle_determinate",!this.indeterminate).appendTo(this.$el),this.inside&&this.$el.addClass("progress-circle_absolute"),this.$els.svg.css({"stroke-dasharray":this._length,"stroke-dashoffset":this._length}),super.render()),this}stop(){this._stopIndeterminate(),this._stopSimulation()}_stopSimulation(){return this.marks.has("simulationInterval")&&(clearInterval(this.marks.get("simulationInterval")),this.marks.delete("simulationInterval")),this}_stopIndeterminate(){return this.indeterminate=!1,this}destroy(){this.stop(),super.destroy()}get inside(){return this._options.inside}set inside(t){return this._options.inside===t?this.inside:(this.$parent=t,this._options.inside=t)}get percent(){return this._options.percent||0}set percent(t){return(t=Math.min(Math.max(0,parseInt(t,10)||0),100))===this._options.percent?t:(this.render(),this.$els.svg.css({strokeDashoffset:(100-t)/100*this._length}),t>99&&this.stop(),this._options.percent=t)}get indeterminate(){return this._options.indeterminate}set indeterminate(t){return t=Boolean(t),this._options.indeterminate===t?this._options.indeterminate:(t&&0===this.percent&&(this.percent=20),this.$els.svg&&this.$els.svg.toggleClass("icon--ui__progress-circle_determinate",!t),this._options.indeterminate=Boolean(t))}get simulation(){return this._options.simulation}set simulation(t){let e=(0,o.isBoolean)(t)?t:Boolean(t);if((t=(0,o.isBoolean)(t)?3500:t)===this._options.simulation)return this._options.simulation;if(this._stopSimulation(),e){let e=300/t*100;this.marks.set("simulationInterval",setInterval((()=>{this.percent=this.percent+(e+r.Utils.random(6))}),350))}return this._options.simulation=e}get strokeWidth(){return this._options.strokeWidth}set strokeWidth(t){return t=Math.min(Math.max(1,parseInt(t,10)),this._width),this.$els.svg&&this.$els.svg.css({"stroke-width":t}),this._options.strokeWidth=t}}const u=l},39660:(t,e,i)=>{i.d(e,{V:()=>I});var s=i(43241),n=(i(66992),i(33948),i(88674),i(41817),i(51540)),r=i(33877),o=i(65704),a=i(58330),l=i(5568),u=i(42107),h=i(12953),c=i(12950);class d{static async getRatings(t=1){const{response:e,data:i}=await c.cf.post("/ajax.php",{route:"top-authors",page:t});if(!e.result)throw h.core.ui.toasts.showError(e.message),e.message;return d.convertRatingsResponse(i)}static convertRatingsResponse(t){return t.map((t=>({position:t.position,userId:t.user_id,userName:t.user_name,userAvatar:t.user_avatar,isSubscribed:t.is_subscribed,totalRating:t.total_rating,count:t.stories_count})))}}const p="public-ratings-list",m={main:p,container:`${p}__container`,item:`${p}__item`,itemCurrent:`${p}__item_current`,username:`${p}__username`,loader:`${p}__loader`};var _=i(1262);function g(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function v(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class f extends s.u{constructor(t){super(t),v(this,"loading",!1),v(this,"hasMore",!0),v(this,"page",2),v(this,"animationStart",Date.now()),v(this,"lastRequestId",""),v(this,"subsribeBtnsMap",new WeakMap),v(this,"lastListIndex",0),v(this,"currentUserItems",[]),v(this,"handleListContainerClick",(t=>{const e=t.target;if(!(e instanceof HTMLElement))return;const i=e.classList.contains(m.username)?e:e.closest("."+m.username);if(i)return void this.handleUserClick(i);if(e instanceof HTMLButtonElement&&null!=e&&e.dataset.userId)return void this.handleSubscribeBtnClick(e);const s=e.closest("button[data-user-id]");s&&this.handleSubscribeBtnClick(s)})),v(this,"handleScroll",(()=>{this.hasMore&&!this.loading&&h.core.ui.elementWillSoonScrolled(this.listContainer)&&this.load()})),this.show()}render(){var t;return this.isRendered||!this.el?this:(this.listContainer=null===(t=this.el)||void 0===t?void 0:t.querySelector("."+m.container),this.listContainer?(this.initLoader(),this.initLastIndex(),this.initCurrentUserItems(),this.observeCurrentUserItem(),this.listenTo(h.core.ui,"document-scroll",(0,n.P)(this.handleScroll,200)),this.listContainer.addEventListener("click",this.handleListContainerClick),this):this)}initLoader(){this.loader=h.core.ui.player.createAnimation("stories-spinner",{$parent:this.$("."+m.loader)})}initLastIndex(){this.lastListIndex=this.listContainer.querySelectorAll("."+m.item+`:not(.${m.itemCurrent})`).length}initCurrentUserItems(){this.currentUserItems=Array.from(this.listContainer.querySelectorAll(".public-ratings-list__item_current")).map((t=>t.cloneNode(!0)))}async initList(){this.listContainer&&this.el&&(this.lastListIndex=0,this.listContainer.hidden=!0,this.listContainer.innerHTML="",this.currentUserItems.forEach((t=>{this.listContainer.append(t)})),this.emit("empty",!1),this.page=1,this.hasMore=!0,this.el.hidden=!1,await this.load(),this.listContainer.hidden=!1)}async toggleLoading(t){this.loading!==t&&(t?(this.loader.$parent.show(),this.animationStart=Date.now()):(await(0,r.g)(500-(Date.now()-this.animationStart)),this.loader.$parent.hide()),this.loading=t,this.loader.togglePlay(t))}handleUserClick(t){const e=t.closest("."+m.item);u.cp.getInstance().sendEvent("transition_to_author",{type:"top_authors",screen_index:e.dataset.listPosition})}async handleSubscribeBtnClick(t){if(!h.core.isUserAuthorized)return void h.core.ui.authRequired();const e=a.S.getInstance().get("UIButton");let i=this.subsribeBtnsMap.get(t);if(i){if(i.progress)return}else i=new e(t),this.subsribeBtnsMap.set(t,i);const s=t.dataset.userId,n=new _.User(s),r=!t.classList.contains("button_success");i.progress=!0;try{var o;const e=t.closest("."+m.item);await n.subscribe(!r,{type:"top_authors",screen_index:e.dataset.listPosition}),h.core.emit("subscribeEnded",{id:s,type:"user",avatar:null==e||null===(o=e.querySelector(`[data-id="${s}"] img`))||void 0===o?void 0:o.getAttribute("src")}),(0,l.g7)(s,function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?g(Object(i),!0).forEach((function(e){v(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},(0,l.pv)(s))),t.classList.toggle("button_success",r)}catch(u){h.core.ui.toasts.showError(u)}finally{i.progress=!1}}async load(){if(this.el){this.toggleLoading(!0);try{const t=this.lastRequestId=(0,o.E)("public-ratings_"),e=await d.getRatings(this.page);if(t!==this.lastRequestId)return;if(this.hasMore=Boolean(e.length),!this.hasMore)return this.toggleLoading(!1),void(1===this.page&&(this.el.hidden=!0,this.emit("empty",!0)));1===this.page&&this.emit("empty",!1),this.renderListItems(e),this.page++,this.toggleLoading(!1)}catch(t){h.core.ui.toasts.showError(t)}}}renderListItems(t){const e=a.S.getInstance().get("UIRatingItem"),i=document.createDocumentFragment();t.forEach((t=>{const s=e.getElement(t);s.setAttribute("data-list-position",++this.lastListIndex),i.append(s)})),this.listContainer.append(i)}observeCurrentUserItem(){var t;const e=null===(t=this.listContainer)||void 0===t?void 0:t.querySelector('[data-current-list-item="1"]');if(!e)return;const i=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&(i.unobserve(t.target),u.cp.getInstance().sendEvent("reach_element",{type:"find_yourself_in_top",screen_index:e.getAttribute("data-list-position")}))}))}),{threshold:0});i.observe(e)}}i(17727);function y(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function b(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?y(Object(i),!0).forEach((function(e){w(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function w(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class E extends s.u{constructor(t){super(t),this.show()}render(){return this.isRendered||!this.el||this.initSubscribeButtons(),this}initSubscribeButtons(){var t;if(!this.el)return;const e=Array.from((null===(t=this.el)||void 0===t?void 0:t.querySelectorAll(".button"))||[]),i=a.S.getInstance().get("UIButton");for(const n of e){var s;const t=new i(n),e=n.closest(".public-ratings-previous__user"),r=null==e?void 0:e.dataset,o=r.userId,a={type:"top_authors",screen_index:r.listPosition};null==e||null===(s=e.querySelector(".user__nick"))||void 0===s||s.addEventListener("click",(()=>{u.cp.getInstance().sendEvent("transition_to_author",a)})),n.addEventListener("click",(()=>{if(t.porgress)return;if(!h.core.isUserAuthorized)return void h.core.ui.authRequired();const e=new _.User(o),i=!n.classList.contains("button_success");t.progress=!0,e.subscribe(!i,a).then((()=>(h.core.emit("subscribeEnded",{id:o,type:"user",avatar:n.dataset.userAvatar}),(0,l.g7)(o,b({},(0,l.pv)(o))),n.classList.toggle("button_success",i),!0))).finally((()=>{t.progress=!1})).catch((t=>{h.core.ui.toasts.showError(t)}))}))}}}var A=i(41773),S=i(53056);function P(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function C(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?P(Object(i),!0).forEach((function(e){T(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):P(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function T(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const k="pkb_prab";class D extends s.u{constructor(t){super(t),T(this,"handleCloseButtonClick",(()=>{this.el&&(this.el.remove(),this.setBannerState())})),this.show()}render(){if(this.isRendered||!this.el)return this;return this.getBannerState()||this.initCloseButtons(),this}initCloseButtons(){var t;const e=null===(t=this.el)||void 0===t?void 0:t.querySelector("button");null==e||e.addEventListener("click",this.handleCloseButtonClick),null==e||e.addEventListener("auxclick",this.handleCloseButtonClick)}getBannerState(){return h.core.initParams.userID>0?A.E.has(A.j.PUBLIC_RATINGS_AUTHORS_BANNER):"authors"in this.getLSState()}setBannerState(){if(h.core.initParams.userID>0)return void A.E.set(A.j.PUBLIC_RATINGS_AUTHORS_BANNER,!0);const t=this.getLSState();S.m.set(k,C(C({},t),{},{authors:1}))}getLSState(){var t;return null!==(t=S.m.get(k))&&void 0!==t?t:{}}}class I extends s.u{constructor(t){super(t),this.show()}render(){var t,e,i,s;return this.isRendered||(this.emptyListEl=null===(t=this.$(".public-ratings-empty"))||void 0===t?void 0:t.get(0),this.list=new f({el:null===(e=this.$(".public-ratings-list"))||void 0===e?void 0:e.get(0)}),new D({el:null===(i=this.$(".public-ratings-banner"))||void 0===i?void 0:i.get(0)}),new E({el:null===(s=this.$(".public-ratings-previous"))||void 0===s?void 0:s.get(0)}),this.initEmptyListObserver()),this}initEmptyListObserver(){if(!this.emptyListEl)return;const t=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(t.unobserve(e.target),u.cp.getInstance().sendEvent("reach_element",{type:"empty_list"}))}))}),{threshold:0});t.observe(this.emptyListEl),this.listenTo(this.list,"empty",(t=>{this.emptyListEl.hidden=!t}))}}},62895:(t,e,i)=>{i.d(e,{B:()=>h});i(88674);var s=i(43241),n=i(85823),r=i(33662),o=i(12953),a=i(47442);const l={authors:"author",communities:"community",tags:"tag"},u={authors:"user",communities:"community",tags:"tag"};class h extends s.u{constructor(t){if(super(t),this.$el){new n.x(this.$el.find("form")).on("submit",(t=>this.onSubmit(t)))}this.hideOnMouseOutTarget()}hideOnMouseOutTarget(){{var t;const e=null===(t=this._options.popup)||void 0===t?void 0:t.target.target;if(!e)return;const i=()=>{setTimeout((()=>{const t=this._options.popup._pointerGlobPosition,s=document.elementsFromPoint(t.x-window.scrollX,t.y-window.scrollY);s.includes(e)||s.includes(this._options.popup.el)||(e.removeEventListener("mouseleave",i),this._options.popup.hide())}),200)};e.addEventListener("mouseleave",i)}}async onSubmit(t){var e,i,s,n;if(t.preventDefault(),o.default.initParams.isDeleted)return o.default.ui.authRequired(),this._options.popup.hide(),null===(n=this._options.parentPopup)||void 0===n||n.hide(),void o.default.ui.emit("hideQuickIgnore",!0);if(!o.default.isUserAuthorized)return o.default.ui.authRequired({analyticsParams:{reason:"ignore","community_id!empty":"communities"===this._options.mode?this._options.item:null,"author_id!empty":"authors"===this._options.mode?this._options.item:null,"tag!empty":"tags"===this._options.mode?this._options.item:null}}),void this._options.popup.hide();null===(e=this.el)||void 0===e||null===(i=e.querySelector("button"))||void 0===i||i.setAttribute("disabled","disabled");const h=(null===(s=t.currentTarget)||void 0===s?void 0:s.elements.namedItem("period")).value,c={tags:[],authors:[],communities:[],keywords:[],[this._options.mode]:[this._options.item],period:r.RO[h],story_id:this._options.storyId||0};try{var d;await r.jj.addRule(c,l[this._options.mode]),this._options.popup.hide(),null===(d=this._options.parentPopup)||void 0===d||d.hide(),o.default.ui.emit("hideQuickIgnore",!0);new a.O({content:o.default.i18n("ignore.messages.success")}).show(),o.default.ui.emit("ignore",{type:u[this._options.mode],target:this._options.item,period:r.RO[h].valueOf()})}catch(t){if(null!=t&&t.message){new a.O({content:t.message,theme:a.K.DANGER}).show()}}}}},39965:(t,e,i)=>{i.d(e,{k:()=>h});var s=i(43241),n=i(58330),r=i(42107);const o="recommended-community",a=o,l=`${o}__link`;var u=i(12953);class h extends s.u{constructor(t){super({el:t}),this.show()}render(){if(this.isRendered)return this;const t=n.S.getInstance().get("UICarousel");return this.carousel=new t({el:this.el}),u.core.ui.attachSubscribeButtons(this.el),this.initLinkClick(),this}initLinkClick(){var t,e;const i=t=>{this.sendAnalytics(t)};null===(t=this.carousel)||void 0===t||t.els.content.addEventListener("click",i),null===(e=this.carousel)||void 0===e||e.els.content.addEventListener("auxclick",i)}sendAnalytics(t){var e;if(!(t.target instanceof HTMLElement&&t.target.closest("."+l)))return;const i=null===(e=this.carousel)||void 0===e?void 0:e.els.content.querySelectorAll(".carousel__item"),s=t.target.closest("."+a),n=null==s?void 0:s.querySelector(".recommended-community__link"),o=n instanceof HTMLElement?Number(n.dataset.id):null,u=i&&s?Array.from(i).indexOf(s)+1:null;o&&this.analyticsType&&r.cp.getInstance().sendEvent("transition_to_community",{type:this.analyticsType,community_id:o,screen_index:u})}get analyticsType(){var t,e;return(null===(t=this.el)||void 0===t||null===(e=t.dataset)||void 0===e?void 0:e.analyticsType)||""}}},42930:(t,e,i)=>{i.d(e,{Y:()=>p,D:()=>E});i(66992),i(33948),i(88674),i(85827),i(41817);var s=i(63907),n=i(73429),r=i(72346),o=i(12953),a=i(31474);var l=i(36005);function u(t){var e="",i=l.escape;return e+='<div class="input input_box input_flat reputation-label" data-id="'+i(t.id)+'" data-name="'+i(t.name)+'">\n    <span class="input__icon reputation-label__edit" data-role="edit"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__pencil icon--ui__pencil_size-large"><use xlink:href="#icon--ui__pencil"></use></svg></span>\n    <span class="input__box">\n\t\t<input class="input__input reputation-label__input" placeholder="Введите название" maxlength="25" autocomplete="off" value="'+i(t.name)+'" data-role="name" data-id="'+i(t.id)+'">\n\t</span>\n    <span data-role="count" class="reputation-label__count">'+i(t.count)+'</span>\n    <button data-role="remove" class="button_link reputation-label__remove"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close icon--ui__close_size-middle"><use xlink:href="#icon--ui__close"></use></svg></button>\n</div>'}var h=i(36005);function c(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const d=i(19755);class p extends s.u1{constructor(...t){super(...t),c(this,"_labels",[])}render(){return this.isRendered?this:(this.$el=d('<section class="reputation-labels-list">\n    <main class="reputation-labels-list__main">\n        <div class="reputation-labels-list__container"></div>\n        <div class="reputation-labels-list__empty">\n            Вы пока не добавили ни одной метки\n        </div>\n    </main>\n\n    <footer class="reputation-labels-list__footer">\n        <div class="input input_box input_section input_gray reputation-labels-list__add-input" data-role="find">\n            <button class="input__icon reputation-labels-list__add-btn button_link">\n                <span class="reputation-labels-list__plus"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__plus icon--ui__plus_size-middle"><use xlink:href="#icon--ui__plus"></use></svg></span>\n                <span class="reputation-labels-list__check"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__check-mark icon--ui__check-mark_size-middle"><use xlink:href="#icon--ui__check-mark"></use></svg></span>\n            </button>\n            <span class="input__box">\n                <input class="input__input" maxlength="25" data-action="add" placeholder="Новая метка" name="create_new_cat" value="" autocomplete="off">\n            </span>\n        </div>\n    </footer>\n</section>').hide(),this.$els={container:this.$(".reputation-labels-list__container"),addInput:this.$(".reputation-labels-list__add-input"),addBtn:this.$(".reputation-labels-list__add-btn"),main:this.$(".reputation-labels-list__main"),empty:this.$(".reputation-labels-list__empty").hide()},this._initAddLabelInput(),this._attachEvents(),this._fetchLabels().then((()=>this._renderLabels())),super.render())}_attachEvents(){this.$el.on("click",".reputation-label__remove",(t=>this._onRemoveClick(t))).on("click",".reputation-label__edit",(t=>this._onEditClick(t))).on("click",".reputation-labels-list__add-btn",(()=>this._onAddClick())).on("change",".reputation-label",(0,h.debounce)((t=>this._onNameChange(t)),500))}async _fetchLabels(){this._labels=await n.b.get()}_renderLabels(){const t=this._labels.reduce(((t,e)=>t+u(e)),"");this.$els.container.html(t),this._updateEmpty(),this.$el.show()}_initAddLabelInput(){const{UIInput:t}=this.useRegistry();this._addLabelInput=new t({$el:this.$els.addInput,addClearButton:!1});const e=t=>this.$els.addBtn.toggleClass("reputation-labels-list__add-btn_active",Boolean(t.length));this._addLabelInput.on("input",e),this._addLabelInput.on("blur",(t=>e(t.currentTarget.value)))}_updateEmpty(){this.$els.empty.toggle(!this._labels.length)}_onNameChange(t){const e=d(t.currentTarget),i=e.find("input").get(0),s=e.data("id"),n=e.data("name");if(!i)return;const r=i.value.trim();r.length?this._renameLabel(s,r):i.value=n}_onEditClick(t){const e=d(t.currentTarget).closest(".reputation-label").find("input").get(0);if(!e)return;const i=e.value.length;e.focus(),e.setSelectionRange(i,i)}async _onRemoveClick(t){const{PopupMaster:e}=this.useRegistry(),i=r.o.escape(),s=d(t.currentTarget).closest(".reputation-label"),n=s.data("id"),l=s.data("name");await e.confirmModal({content:o.core.i18n("reputation-labels-list.removeModal.content",i(l)),buttons:[["Удалить",a.j.DANGER,!0],["Отмена"]]})&&this._removeLabel(n)}_onAddClick(){const t=this._addLabelInput.value;t.length&&this._addLabel(t.trim())}async _renameLabel(t,e){try{const i=this.$(`.reputation-label[data-id="${t}"] .reputation-label__edit`);await n.b.rename(t,e),this._labels.find((e=>e.id===t)),i.removeClass("reputation-label__edit_error").addClass("reputation-label__edit_success"),setTimeout((()=>i.removeClass("reputation-label__edit_success")),800)}catch(i){o.core.ui.toasts.showError(i)}}async _removeLabel(t){await n.b.delete(t),this._labels.splice((0,h.findIndex)(this._labels,(e=>e.id===t)),1),this.$els.container.find(`.reputation-label[data-id="${t}"]`).remove(),this._updateEmpty()}async _addLabel(t){try{const e={id:await n.b.add(t),name:t,count:0};this._labels.push(e),this.$els.container.append(u(e)),this._addLabelInput.els.input.value="",this._addLabelInput.els.input.blur(),this._updateEmpty()}catch(e){o.core.ui.toasts.showError(e)}}}var m=i(88358),_=i(77416);var g=i(36005);function v(t){var e="",i=g.escape;return e+='<div class="reputation-label reputation-label_dropdown" data-id="'+i(t.id)+'" data-name="'+i(t.name)+'">\n    <div class="reputation-label__name" data-role="name">'+i(t.name)+'</div>\n    <div class="reputation-label__count" data-role="count" >'+i(t.count)+"</div>\n</div>"}function f(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function y(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?f(Object(i),!0).forEach((function(e){b(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function b(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const w=i(19755);class E extends m._{constructor(t={}){super(t=y({showArrow:!1,addOverlay:!1,autoCorrectPosition:!0,destroyAfterHide:!0,indent:!1,alignment:m.SE.START,distance:0,width:320},t)),b(this,"_labels",[]),b(this,"_query",""),this._result=new Promise((t=>{this._resolve=t}))}render(){if(this.isRendered)return this;const{UIInput:t}=this.useRegistry();return this.content='<section class="reputation-labels-list reputation-labels-list_dropdown">\n    <div class="reputation-labels-list__spinner">\n        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__progress-circle icon--ui__progress-circle_story-editor"><use xlink:href="#icon--ui__progress-circle"></use></svg>\n    </div>\n\n    <main class="reputation-labels-list__main">\n        <div class="reputation-labels-list__search input input_section" data-role="search">\n            <span class="input__icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__search icon--ui__search_input"><use xlink:href="#icon--ui__search"></use></svg></span>\n            <span class="input__box">\n                <input class="input__input" placeholder="Поиск метки" autocomplete="off" name="label">\n            </span>\n        </div>\n\n        <div class="reputation-labels-list__container"></div>\n    </main>\n\n    <footer class="reputation-labels-list__footer">\n        <div class="input input_box input_section input_gray reputation-labels-list__add-input" data-role="find">\n            <button class="input__icon reputation-labels-list__add-btn button_link">\n                <span class="reputation-labels-list__plus"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__plus icon--ui__plus_size-middle"><use xlink:href="#icon--ui__plus"></use></svg></span>\n                <span class="reputation-labels-list__check"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__check-mark icon--ui__check-mark_size-middle"><use xlink:href="#icon--ui__check-mark"></use></svg></span>\n            </button>\n            <span class="input__box">\n                <input class="input__input" maxlength="25" data-action="add" placeholder="Новая метка" name="create_new_cat" value="" autocomplete="off">\n            </span>\n        </div>\n    </footer>\n</section>',super.render(),this.$els=y(y({},this.$els),{},{queryInput:this.$(".reputation-labels-list__search"),addInput:this.$(".reputation-labels-list__add-input"),addBtn:this.$(".reputation-labels-list__add-btn"),spinner:this.$(".reputation-labels-list__spinner"),main:this.$(".reputation-labels-list__main").hide(),footer:this.$(".reputation-labels-list__footer").hide(),container:this.$(".reputation-labels-list__container")}),this._queryInput=new t({$el:this.$els.queryInput,addClearButton:!1}),this._attachEvents(),this._initAddLabelInput(),this._fetchLabels().then((()=>{this._renderLabels(),this.$els.spinner.hide(),this.$els.main.show(),this.$els.footer.show()})),this}hide(){return this._resolve(!1),super.hide(),this}result(){return this._result}async _fetchLabels(){this._labels=await n.b.get()}_renderLabels(){const t=this._labels.reduce(((t,e)=>""!==this._query&&-1===e.name.toLocaleLowerCase().indexOf(this._query)?t:t+v(e)),"");this.$els.container.html(t),this._updateEmpty(),""!==this._query&&_.Z.add(this.$els.container,this._query)}_attachEvents(){this.$el.on("input",'input[name="label"]',(()=>this._onInput())).on("click",".reputation-labels-list__add-btn",(()=>this._onAddClick())).on("click",".reputation-label",(t=>this._onLabelClick(t)))}_updateEmpty(){const t=0!==this._labels.length,e=""!==this.$els.container.html();this.$els.queryInput.toggleClass("reputation-labels-list__search_empty",!t||!e)}_initAddLabelInput(){const{UIInput:t}=this.useRegistry();this._addLabelInput=new t({$el:this.$els.addInput,addClearButton:!1});const e=t=>this.$els.addBtn.toggleClass("reputation-labels-list__add-btn_active",Boolean(t.length));this._addLabelInput.on("input",e),this._addLabelInput.on("blur",(t=>e(t.currentTarget.value)))}_onInput(){this._query=this._queryInput.value.trim().toLocaleLowerCase(),this._renderLabels()}_onLabelClick(t){const e=w(t.currentTarget).data("id"),i=this._labels.find((t=>t.id===e));this._resolve(i),this.hide()}_onAddClick(){const t=this._addLabelInput.value;t.length&&this._addLabel(t.trim())}async _addLabel(t){const e={id:await n.b.add(t),name:t,count:0};this._labels.push(e),this.$els.container.append(v(e)),this._addLabelInput.els.input.value="",this._addLabelInput.els.input.blur(),this._updateEmpty()}}},39334:(t,e,i)=>{i.d(e,{v:()=>c});i(41817);var s=i(12953),n=i(43241),r=i(81780),o=i(58330),a=i(42107),l=i(73736);function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function h(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class c extends n.u{constructor(t){super(t),h(this,"els",{}),h(this,"handleCarouselEvent",(t=>{const e=t.target;if("mousedown"===t.type)return s.default.ua.firefox&&t.preventDefault(),void(this.eventTarget=e);if("click"===t.type&&this.eventTarget===e&&this.carousel._isMouseMoved)return;if(s.default.ua.firefox&&"mousedown"===t.type)return;if(!(this.shortStories&&e instanceof HTMLElement))return;if(!e.closest("a")||0!==t.button&&1!==t.button)return;const i=e.closest(".short-story"),n=null==i?void 0:i.getAttribute("data-story-id"),r=Array.from(this.shortStories).findIndex((t=>t.dataset.storyId===n));a.cp.getInstance().sendEvent(this._options.analyticsParams.onStoryClickEvent,function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(Object(i),!0).forEach((function(e){h(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({type:this._options.analyticsParams.onStoryClickType,screen_index:r+1,"level!empty":this._options.analyticsParams.level,"component_name!empty":this._options.analyticsParams.componentName},this.getStoryAnalyticsData(r)))})),this.el&&(this.els={followBtn:this.el.querySelector(".carousel__follow")},this.shortStories=this.el.querySelectorAll(".short-story"),this.show())}render(){return this.isRendered||!this.els||(this.initCarousel(),this.initListeners()),this}initCarousel(){var t,e,i;const s=o.S.getInstance().get("UICarousel");this.carousel=new s({el:this.el,scrollBlocks:2}),null===(t=this.carousel)||void 0===t||t.els.content.addEventListener("click",this.handleCarouselEvent),null===(e=this.carousel)||void 0===e||e.els.content.addEventListener("auxclick",this.handleCarouselEvent),null===(i=this.carousel)||void 0===i||i.els.content.addEventListener("mousedown",this.handleCarouselEvent),this.initCommunityMiniProfile()}initListeners(){const t=t=>{0!==t.button&&1!==t.button||(a.cp.getInstance().sendEvent("transition_to_tab",{type:this._options.analyticsParams.followBtnClickType,"level!empty":this._options.analyticsParams.level,"component_name!empty":this._options.analyticsParams.componentName}),l.dV.send("transitionToTab",{type:this._options.analyticsParams.followBtnClickType,level:this._options.analyticsParams.level,componentName:this._options.analyticsParams.componentName}))};this.els.followBtn.addEventListener("click",t),this.els.followBtn.addEventListener("auxclick",t)}getStoryAnalyticsData(t=0){if(!this.shortStories||!this.shortStories[t])return{};const{storyId:e,authorId:i,comments:s,subsCode:n}=this.shortStories[t].dataset;return{"post_id!empty":e,"author_id!empty":i,"comments!undefined":s,"type_i8!empty":n}}initCommunityMiniProfile(){var t;const e=o.S.getInstance().get("UICommunityMiniProfile"),i=null===(t=this.carousel)||void 0===t?void 0:t.els.content.querySelectorAll(".short-story__community"),s=Array.from(i).map((t=>new e({el:t})));this.listenTo(this,r.e.DESTROYED,(()=>s.forEach((t=>t.destroy()))))}}},42478:(t,e,i)=>{i.d(e,{F:()=>h});i(88674),i(66992),i(33948);var s=i(79431),n=i(90312),r=i(36005);var o=i(87864),a=i(68505),l=i(85679);let u;u=[{campaignKey:"mts_t_m",buttonKey:"mts_t_m_1",url:"https://special.pikabu.ru/mts/travel_memories?utm_source=pikabu&utm_medium=dv&utm_campaign=side_banner&utm_content=1",img:"https://cs13.pikabu.ru/post_img/2023/12/14/4/1702528320113372490.png",type:"story"}];class h{async showStoryButton(t){const e=await this.getButton("story");if(!e)return;const i=this.createButton(e),s=document.createElement("div");s.classList.add("specials-promo-button-wrapper"),s.append(i),t.insertAdjacentElement("afterbegin",s),requestIdleCallback((()=>{i.classList.add("specials-promo-button_shown")}))}async showFeedButton(t){const e=await this.getButton("feed");if(!e)return;const i=this.createButton(e);t.prepend(i)}createButton(t){var e;const i=(0,o.m)((s=t,l="",u=r.escape,Array.prototype.join,l+='\n<a href="'+u(s.url)+'" class="specials-promo-button '+u(s.class)+'" target="_blank">\n    ',s.img&&(l+='\n        <img src="'+u(s.img)+'" />\n    '),l+='\n    <div role="close">\n        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__ic_close"><use xlink:href="#icon--ui__ic_close"></use></svg>\n    </div>\n</a>\n'));var s,l,u;null===(e=i.querySelector('[role="close"]'))||void 0===e||e.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),i.remove(),this.setButtonClosed(t),n.c.getInstance().sendEvent("banner_closed",{component_name:"feed_post",promo_id:t.buttonKey,type:"specials"})}));const h=e=>{0!==e.button&&1!==e.button||n.c.getInstance().sendEvent("specials_banner_tapped",{component_name:"feed_post",promo_id:t.buttonKey})};i.addEventListener("click",h),i.addEventListener("auxclick",h);const c=(0,a.m)(i,(e=>{e.isIntersecting&&(c(),this.setButtonViewTime(t),n.c.getInstance().sendEvent("banner_showed",{component_name:"feed_post",promo_id:t.buttonKey,type:"specials"}))}),{threshold:1});return i}async getState(){var t;return(null===(t=await s.NM.get(s.hA.SPECIALS_PROMO_BUTTON))||void 0===t?void 0:t[0])||{}}async getButton(t){const e=await this.getState(),i=Date.now()-l.mf;for(const r of u){var s,n;const o=null!==(s=e[r.campaignKey])&&void 0!==s?s:{};if(!1===o)continue;if(t!==r.type)continue;if((null!==(n=o[r.buttonKey])&&void 0!==n?n:0)<i)return r}return null}async setButtonViewTime(t){const e=await this.getState();if(!1===e[t.campaignKey])return;const i=e[t.campaignKey]||{};i[t.buttonKey]=Date.now(),e[t.campaignKey]=i,await s.NM.add(s.hA.SPECIALS_PROMO_BUTTON,e)}async setButtonClosed(t){const e=await this.getState();!1!==e[t.campaignKey]&&(e[t.campaignKey]=!1,await s.NM.add(s.hA.SPECIALS_PROMO_BUTTON,e))}}},29883:(t,e,i)=>{i.d(e,{RT:()=>a,nm:()=>d,qv:()=>g,jD:()=>n});i(88674);var s=i(43241);class n extends s.u{async showEditor(t){if(!this.seriesEditor){const{createApp:t}=await i(68528);this.seriesEditor=t({handleSeriesEdited:t=>this.emit("edit",t),handleSeriesDeleted:()=>window.location.reload()}).mount(document.createDocumentFragment())}return this.seriesEditor.show({storySeries:t,isStoriesAddingDisabled:this._options.disableStories}),this}}i(41817);var r=i(58330),o=(i(81780),i(61950),i(33877),i(42107));let a;!function(t){t[t.SERIES_LIMIT=1]="SERIES_LIMIT",t[t.STORIES_LIMIT=2]="STORIES_LIMIT"}(a||(a={}));var l=i(12950);function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function h(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(Object(i),!0).forEach((function(e){c(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function c(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class d{static async addStory({storyId:t,seriesId:e}){try{const{response:i}=await l.cf.post("/ajax.php",{route:"series/add-story",series_id:e,story_id:t});if(!i.result)throw i.messageCode===a.STORIES_LIMIT&&o.cp.getInstance().sendEvent("error_occurred",{type:"post_series_max_posts",post_id:t,post_series_id:e}),new Error(i.message);return!0}catch(i){throw new Error(i instanceof Error?i.message:"Не удалось добавить пост к серии")}}static async removeStory({storyId:t,seriesId:e}){try{return await l.cf.postOrFail("/ajax.php",{route:"series/remove-story",series_id:e,story_id:t}),!0}catch(i){throw new Error(i instanceof Error?i.message:"Не удалось удалить пост из серии")}}static async addSeries({title:t,cover:e,storiesIds:i}){try{const{response:s,data:n}=await l.cf.post("/ajax.php",{route:"series/add",title:t,cover:e,story_id:i});if(!s.result)throw s.messageCode===a.SERIES_LIMIT&&o.cp.getInstance().sendEvent("error_occurred",{type:"post_series_max_count"}),new Error(s.message);return{id:n.series_id,title:n.series_title,link:n.series_url,storiesCount:i.length}}catch(s){throw new Error(s instanceof Error?s.message:"Не удалось добавить серию")}}static async editSeries({storySeries:t,cover:e,addStoriesIds:i,removeStoriesIds:s}){try{return await l.cf.postOrFail("/ajax.php",{route:"series/edit",series_id:t.id,title:t.title,cover:e,add_story_id:i,remove_story_id:s}),h(h({},t),{},{storiesCount:t.storiesCount+i.length-s.length})}catch(n){throw new Error(n instanceof Error?n.message:"Не удалось отредактировать серию")}}static async removeSeries(t){try{return await l.cf.postOrFail("/ajax.php",{route:"series/delete",series_id:t}),!0}catch(e){throw new Error(e instanceof Error?e.message:"Не удалось отредактировать серию")}}static async searchStories(t){try{const{data:e}=await l.cf.getOrFail("/ajax.php",{route:"series/search-stories",q:t});return e}catch(e){throw new Error(e instanceof Error?e.message:"Не удалось найти подходящие посты")}}static async getStorySeries(){try{const{data:t}=await l.cf.getOrFail("/ajax.php",{route:"series/user-series"});return t.map((t=>this.convertStorySeries(t)))}catch(t){throw new Error(t instanceof Error?t.message:"Не удалось получить список постов")}}static async getStoriesList({seriesId:t,page:e=0}){try{const{data:i}=await l.cf.getOrFail("/ajax.php",{route:"series/stories-list",p:e,series_id:t});return i}catch(i){throw new Error(i instanceof Error?i.message:"Не удалось получить список постов")}}static async getSeriesList(){try{const{data:t}=await l.cf.getOrFail("/ajax.php",{route:"series/user-series"});return t.map((t=>this.convertStorySeries(t)))}catch(t){throw new Error(t instanceof Error?t.message:"Не удалось получить список серий")}}static convertStorySeries(t){return{id:t.id,title:t.title,coverImageUrl:t.cover_image_url,previewCoverImageUrl:t.preview_cover_image_url,storiesCount:t.stories_count,link:t.link,updatedAt:t.updated_at,createdAt:t.created_at}}}i(12953),i(96637);const p="profile-series-item",m={selector:p,addBtn:`${p}_add`};function _(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class g extends s.u{constructor(t){super(t),_(this,"handleItemContentClick",(t=>{if(!(t.target instanceof HTMLElement))return;const e=t.target.closest(".profile-series-item");if(!e)return;if(e.classList.contains("profile-series-item_add"))return void this.emit("add");const i=this.getStorySeriesFromEl(e);i&&(t.target.classList.contains("profile-series-item__edit-btn")?this.emit("edit",i):t instanceof MouseEvent&&(0===t.button||1===t.button)&&t.target.closest("a")&&o.cp.getInstance().sendEvent("transition_to_post_series",{type:"main_block",post_series_id:i.id}))})),this.show()}show(){var t,e;if(this.isRendered)return this;const i=r.S.getInstance().get("UICarousel");return this.carousel=new i({el:this.el}),null===(t=this.el)||void 0===t||t.addEventListener("click",this.handleItemContentClick.bind(this)),null===(e=this.el)||void 0===e||e.addEventListener("auxclick",this.handleItemContentClick.bind(this)),this}getItemsSize(){return this.carousel.els.items.filter((t=>!t.classList.contains(m.addBtn))).length||0}getStorySeriesFromEl(t){var e,i,s;const n=Number(t.getAttribute("data-id"));if(!n)return null;const r=(null===(e=t.querySelector(".profile-series-item__thumb img"))||void 0===e?void 0:e.getAttribute("src"))||void 0;return{id:n,title:(null===(i=t.querySelector(".profile-series-item__title"))||void 0===i||null===(s=i.textContent)||void 0===s?void 0:s.trim())||"",coverImageUrl:r,storiesCount:Number(t.getAttribute("data-stories-count"))||0,link:t.getAttribute("data-link")||""}}}},22470:(t,e,i)=>{i.d(e,{D8:()=>c,Yk:()=>d,gl:()=>h,tP:()=>a});i(88674);var s=i(81780),n=i(31200),r=i(42107),o=i(82800);const a="2025-11-01";async function l(t,e,i){if(!e)return;const l=await(0,n.kd)({id:t,autoCloseIfTargetNotVisible:!0,autoCloseOutsideClick:!1,target:e,direction:o.Lh.BOTTOM,alignment:void 0===i?o.SE.CENTER:o.SE.START,showOnce:!0,width:260,distance:i,endDateString:a,title:"Подписаться на комментарий",text:"Следить за обсуждениями стало проще: подписывайтесь \n\t\t\tна интересные комментарии и получайте обновления\n\t\t\tоб ответах в разделе подписок."});return null==l||l.on(s.e.MOUNTED,(()=>{r.cp.getInstance().sendEvent("popup_show",{name:"Подписаться на комментарий"})})),l}let u=!1;async function h(t){if(!u){u=!0;try{return await l("subs-comments-feed",t)}catch(e){u=!1}}}async function c(t){return l("subs-comments-feed-menu",t,-8)}async function d(t){if(!t)return;const e=await(0,n.kd)({id:"subs-feed-subscribed",autoCloseIfTargetNotVisible:!0,autoCloseOutsideClick:!1,target:t,direction:o.Lh.BOTTOM,alignment:o.SE.CENTER,distance:4,showOnce:!0,width:260,endDateString:a,title:"Вы подписались на комментарий",text:'\n\t\t\tТеперь все ответы на него — у вас в разделе <a href="/subs" target="_blank">Подписки</a>\n\t\t'});return null==e||e.on(s.e.MOUNTED,(()=>{r.cp.getInstance().sendEvent("popup_show",{name:"Вы подписались на комментарий"})})),e}},5651:(t,e,i)=>{i.d(e,{r:()=>_});i(88674),i(41817);var s=i(72044);var n=i(12950),r=i(12953),o=i(10370),a=i(68505),l=i(43241),u=i(90312),h=i(63907),c=i(51540),d=i(96637);function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function m(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class _ extends l.u{constructor(t){super(t),m(this,"isLoading",!1),m(this,"page",0),this.popup=this.createPopup(),this.popup.show();const e=this.popup.content.get(0);this.els={items:e.querySelector(".subscriptions-modal__items"),loadMoreTrigger:e.querySelector(".subscriptions-modal__loader")},this.initLoad()}createPopup(){let t="followers"===this._options.type?"Подписчики":"Подписки";this._options.userId===r.core.initParams.userID&&(t="Мои "+t.toLowerCase());const e=new s.LD(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){m(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({content:'<div class="subscriptions-modal">\n    <button data-role="close" class="subscriptions-modal__close">\n        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close_16"><use xlink:href="#icon--ui__close_16"></use></svg>\n    </button>\n\n    <div class="subscriptions-modal__items subscriptions-modal__items_init">\n        <div class="subscriptions-modal__loader">\n            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__progress-circle icon--ui__progress-circle_loading"><use xlink:href="#icon--ui__progress-circle"></use></svg>\n        </div>\n    </div>\n</div>',wrapperExtraClass:"popup_subscriptions",header:t},!1));return e.content.get(0).querySelector('[data-role="close"]').addEventListener("click",(()=>e.hide())),e.footer.show(),this.listenTo(e,h.eM.MOUNTED,(()=>{u.c.getInstance().sendEvent("form_show",this._options.analyticsParams)})),this.listenTo(e,h.eM.UNMOUNTED,(()=>{u.c.getInstance().sendEvent("form_close",this._options.analyticsParams)})),e}async initLoad(){await this.loadMore(),this.els.items.classList.remove("subscriptions-modal__items_init");const t=(0,c.P)((()=>this.loadMore()),500);(0,a.m)(this.els.loadMoreTrigger,(e=>{e.isIntersecting&&!this.isLoading&&t()}),{root:this.popup.content.get(0),rootMargin:"0px 0px 150% 0px",threshold:0})}async loadMore(){this.isLoading=!0,this.page+=1;const t=await this.fetchPage(this.page);this.insertItems(t),this.isLoading=!1,t.has_more||(this.els.loadMoreTrigger.remove(),t.unconfirmed&&this.showUnconfirmed(t.unconfirmed))}insertItems(t){const e=(0,o.r)(function(t){var e,s,n="";Array.prototype.join;const{Utils:r}=i(96637);return n+="\n\n",null===(e=t.communities)||void 0===e||e.forEach((t=>{n+='\n    <div class="subscriptions-modal__item subscriptions-modal__item_community">\n        <a href="/community/'+(null==(s=t.link)?"":s)+'" target="_blank">\n            <img class="avatar" src="'+(null==(s=t.avatar)?"":s)+'" alt="'+(null==(s=t.name)?"":s)+'">\n        </a>\n        <div>\n            <a href="/community/'+(null==(s=t.link)?"":s)+'" target="_blank" class="subscriptions-modal__community-name">'+(null==(s=t.name)?"":s)+'</a>\n            <div class="subscriptions-modal__community-info">\n                <span class="">'+(null==(s=t.stories_count+" "+r.pluralNounRU(t.stories_count,["пост","поста","постов"]))?"":s)+'</span>\n                <span class="">'+(null==(s=t.subscribers_count+" "+r.pluralNounRU(t.subscribers_count,["подписчик","подписчика","подписчиков"]))?"":s)+"</span>\n            </div>\n        </div>\n        <div>\n            ",n+='\n                <span\n                    data-type="community"\n                    data-id="'+(null==(s=t.id)?"":s)+'"\n                    data-name="'+(null==(s=t.name)?"":s)+'"\n                    data-role="subscribe"\n                    data-is-subscribed="'+(null==(s=t.is_subscribed?"true":"false")?"":s)+'"\n                >\n                </span>\n            ',n+="\n        </div>\n    </div>\n"})),n+="\n\n",t.users.forEach((e=>{n+='\n    <div class="subscriptions-modal__item subscriptions-modal__item_user" data-page="'+(null==(s=t.page)?"":s)+'">\n        <a href="/@'+(null==(s=e.name)?"":s)+'" target="_blank">\n            <img class="avatar" src="'+(null==(s=e.avatar)?"":s)+'" alt="'+(null==(s=e.name)?"":s)+'">\n        </a>\n        <a href="/@'+(null==(s=e.name)?"":s)+'" target="_blank" class="subscriptions-modal__user-name">\n            '+(null==(s=e.name)?"":s)+"\n        </a>\n        <div>\n            ",n+='\n                <span\n                    data-type="user"\n                    data-id="'+(null==(s=e.id)?"":s)+'"\n                    data-name="'+(null==(s=e.name)?"":s)+'"\n                    data-role="subscribe"\n                    data-is-subscribed="'+(null==(s=e.is_subscribed?"true":"false")?"":s)+'"\n                >\n                </span>\n            ',n+="\n        </div>\n    </div>\n"})),n}({communities:t.communities,users:t.users}));this.initSubscribeButtons(e),this.els.items.append(e,this.els.loadMoreTrigger)}showUnconfirmed(t){const e=d.Utils.pluralNounRU(t,["подписчик","подписчика","подписчиков"]);this.els.items.insertAdjacentHTML("beforeend",`<div class="subscriptions-modal__unconfirmed">+ ещё ${t} ${e}</div>`)}async fetchPage(t){const{response:e,data:i}=await n.cf.get("/ajax.php",{route:"following"===this._options.type?"user/subscriptions":"user/subscribers",user_id:this._options.userId,page:t});if(!e.result)throw r.core.ui.toasts.showError(e.message),e.message;return i}initSubscribeButtons(t){const e=JSON.stringify(this._options.analyticsParams);t.querySelectorAll('[data-role="subscribe"]').forEach((t=>{t.dataset.analytics=e})),r.core.ui.attachSubscribeButtons(t)}}},88227:(t,e,i)=>{i.d(e,{F:()=>l});i(66992),i(33948);var s=i(92927),n=i(63907),r=i(36005);const o=i(19755);class a extends n.u1{constructor(t){super(t),this._init()}_init(){let t;return(0,r.forEach)(this.$(".tabs__tab"),(e=>{let i=o(e),s=l.getTabId(i);this.$tabs.set(s,i),this.tabsPriority.push(s),i.hasClass("tabs__tab_visible")&&(t?i.removeClass("tabs__tab_visible"):t=s),t!==s&&i.hide()})),t&&(this._options.currentTab=t),this}static getTabId(t){return String(t.data("id")||(0,r.uniqueId)("tabs"))}prev(){return this.currentTab=this._getSiblingsTab(!1),this}next(){return this.currentTab=this._getSiblingsTab(!0),this}_getSiblingsTab(t=!0){let e,i=this.tabsPriority.length;return i&&1!==i?(e=this.tabsPriority.indexOf(this.currentTab),!e&&!t||e===i-1&&t?this.currentTab:this.tabsPriority[e+(t?1:-1)]):this.currentTab}get $tabs(){return this._options.$tabs?this._options.$tabs:this._options.$tabs=new Map}get tabsPriority(){return this._options.tabsPriority?this._options.tabsPriority:this._options.tabsPriority=[]}get currentTab(){return this._options.currentTab}set currentTab(t){if((0,r.isNumber)(t)&&(t=this.tabsPriority[t]),t&&this.currentTab===t||!this.$tabs.has(t))return this.currentTab;this.currentTab&&this.$tabs.get(this.currentTab).hide().toggleClass("tabs__tab_visible",!1);let e=this.$tabs.get(t);return s.$.request((()=>{e.toggleClass("tabs__tab_visible",!0).fadeIn(300),this.emit("change",t)})),this._options.currentTab=t}}const l=a},35263:(t,e,i)=>{i.d(e,{l:()=>c});i(41817);var s=i(51540);const n="tabset__item-btn",r="tabset__wrapper",o="tabset__tab",a="tabset__item-btn_current";var l=i(2439),u=i(12953);function h(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class c{constructor(t){var e;if(h(this,"tabs",[]),h(this,"emitter",new l.v),!t)throw new Error("No container element found");this.el=t,this.tabWrapper=this.el.querySelector("."+r);const i=Array.from(this.el.querySelectorAll("."+n));var c;(this.setListeners(i),null!==(e=i[0])&&void 0!==e&&e.classList.contains(a))||(null===(c=i[0])||void 0===c||c.classList.add(a));this.tabs=Array.from(this.el.querySelectorAll("."+o)),this.setTabTransform(0),u.core.ui.listenTo(u.core.ui,"resize",(0,s.P)((()=>{this.setTabTransform(i.indexOf(this.tabButtonCurrent))}),300))}getCurrentTabButton(){return this.tabButtonCurrent}subsribeOnTabChange(t){this.emitter.listenTo(this.emitter,"tab-change",t)}setListeners(t){t.forEach(((t,e)=>{t instanceof HTMLButtonElement&&(t.classList.contains(a)&&(this.tabButtonCurrent=t),t.addEventListener("click",this.onClickToggle({btn:t,i:e})))}))}onClickToggle({btn:t,i:e}){return()=>{var i;t!==this.tabButtonCurrent&&(null===(i=this.tabButtonCurrent)||void 0===i||i.classList.remove(a),t.classList.add(a),this.tabButtonCurrent=t,this.setTabTransform(e),this.emitter.emit("tab-change"))}}setTabTransform(t){const e=this.tabWrapper.clientWidth,i=this.tabs[t].getBoundingClientRect().height;this.tabWrapper.style.transform=`translateX(-${e*t}px)`,this.tabWrapper.style.height=i?`${i}px`:"auto"}}},7001:(t,e,i)=>{i.d(e,{P:()=>r,f:()=>n});var s=i(65448);const n=new s.xs({DEFAULT:"default"}),r=new s.xs({DARK:"dark",LIGHT:"light"})},49412:(t,e,i)=>{i.d(e,{PH:()=>s.P,f0:()=>s.f,fM:()=>n.f});var s=i(7001),n=i(42011)},42011:(t,e,i)=>{i.d(e,{f:()=>p});i(85827);var s=i(90477),n=i(16253),r=i(96637);const o="pkb_theme",a=1440;var l=i(7001);var u=i(36005),h=i(51540),c=i(12953);const d=i(19755);class p extends n.vp{constructor(){if(super(),this._data=new s.Lo(p.loadFromStorage(),!0),this.listenTo(this._data,s.u$.CHANGE,(0,h.P)(this._updateData,10)),this._updateData(),window.matchMedia&&!c.core.ua.ios){const t=window.matchMedia("(prefers-color-scheme: dark)");t.addEventListener&&t.addEventListener("change",t.addEventListener("change",this._onChangePrefersColors.bind(this)))}d(window).on("storage",(t=>{t.key===o&&(this._data.update(p.loadFromStorage()),this.emit("external-change",this.currentTheme,this.isDarkTheme))}))}_onChangePrefersColors(t){this.data.dark=t.matches,this.emit("external-change",this.currentTheme,this.isDarkTheme)}_updateData(){this.emit("change",this.currentTheme,this.isDarkTheme);let t=this.data.from,e=this.data.to;if(this._timeIdle&&clearTimeout(this._timeIdle),this.data.dark&&this.data.schedule&&null!==t&&null!==e&&t!==e){const i=p.seconds;let s;s=this.isDarkTheme?t>e&&i/60>e?86400-i+60*t:60*e-i:t<e&&i/60>e?86400-i+60*t:60*t-i,s>2&&(this._timeIdle=setTimeout(this._updateData.bind(this),1e3*s))}p.saveToStorage(this._data.plainData)}get currentTheme(){return this.data.theme}get isDarkTheme(){let t=null!==this.data.from&&null!==this.data.to&&(e=this.data.from,i=this.data.to,s=p.minutes,e===i||e>i&&(s>=e&&s<a||s>=0&&s<i)||e<i&&s>=e&&s<i);var e,i,s;return Boolean(this.data.dark&&(!this.data.schedule||t))}static defaultSettings(){return{theme:l.f.DEFAULT,dark:window.matchMedia("(prefers-color-scheme: dark)").matches,schedule:!1,from:1080,to:360}}static loadFromStorage(){const t=p.defaultSettings(),e=r.LocalStorage.get(o);return(0,u.isObject)(e)?(t.theme=l.f[e.t]||l.f.DEFAULT,t.dark=Boolean(e.d),t.schedule=Boolean(e.s),t.from=Number.isInteger(e.f)&&e.f>=0&&e.f<=a?e.f:null,t.to=Number.isInteger(e.to)&&e.to>=0&&e.to<=a?e.to:null,t):t}static saveToStorage(t){JSON.stringify(t)!==JSON.stringify(p.defaultSettings())?r.LocalStorage.set(o,{t:t.theme.valueOf(),d:t.dark,s:t.schedule,f:t.from,to:t.to,v:1}):r.LocalStorage.remove(o)}get data(){return this._data.data}static get minutes(){let t=new Date;return 60*t.getHours()+t.getMinutes()}static get seconds(){let t=new Date;return 3600*t.getHours()+60*t.getMinutes()+t.getSeconds()}static convertTimeToString(t){let e=Math.floor(t/60),i=t-60*e;return(e<10?"0"+e:e)+":"+(i<10?"0"+i:i)}static convertStringToTime(t){return t.split(":").map((t=>Number(t))).reduce(((t,e)=>60*t+e))}}},26451:(t,e,i)=>{let s;i.d(e,{K:()=>s}),function(t){t.DEFAULT="",t.WARNING="warning",t.DANGER="danger"}(s||(s={}))},47442:(t,e,i)=>{i.d(e,{K:()=>s.K,O:()=>u});var s=i(26451),n=i(12953),r=i(63907),o=i(36005),a=i(55529);const l=i(19755);class u extends r.u1{constructor(t={}){super(),this._autoHideTimeout=void 0,this._hover=!1,this.$els={content:void 0,closeButton:void 0},this.$parent=t.$parent||(t.isGlobal?l(document.body):n.core.ui.toasts.$el),this.setOptions((0,o.defaults)(t,{closeAfter:4e3,addCloseButton:!0,theme:s.K.DEFAULT})),this._hideBound=this.hide.bind(this)}_onMouseHover(t){this._hover="mouseenter"===t.type,this.stopAutoClose(),this._hover||this.startAutoClose()}_renderContent(){return this.$els.content?this.$els.content:this.$els.content=l(document.createElement("div")).addClass("toast__content")}_renderCloseButton(){return this.$els.closeButton?this.$els.content:l(document.createElement("div")).addClass("toast__close").append(n.core.icon("ui__close")).on("click",this.hide.bind(this))}render(){return this.isRendered||(this.$el=l(document.createElement("div")).addClass("toast"),this.theme!==s.K.DEFAULT&&this.$el.addClass(`toast_${this.theme}`),this.$el.append(this._renderContent()),this.addCloseButton&&this.$el.append(this._renderCloseButton()),this.$el.hover(this._onMouseHover.bind(this)),this._options.isGlobal&&this.$el.css({position:"fixed",top:0,zIndex:(0,a.e)()}),super.render()),this}show(){if(this.isShown)return this.stopAutoClose(),this.startAutoClose(),this;this.cancelTimeout("hide"),this.stopAutoClose(),super.show(),this.startAutoClose();try{this._slideDown()}catch(t){}return this}hide(){if(!this.isShown||this.isDestroyed)return this;this.stopAutoClose();try{this._slideUp()}catch(t){}return this.timeout("hide",600,(()=>{if(this.isShown)return this;super.hide(),this.destroyAfterHide&&this.destroy()})),this._options.isShown=!1,this}stopAutoClose(){return this._autoHideTimeout&&(clearTimeout(this._autoHideTimeout),this._autoHideTimeout=void 0),this}startAutoClose(){return this.closeAfter?(this.stopAutoClose(),this._autoHideTimeout=setTimeout(this._hideBound,this.closeAfter),this):this}destroy(){delete this.$els.container,super.destroy()}append(t){return this._renderContent().append(t)}_slideDown(){this.el.animate({maxHeight:[0,`${this.el.scrollHeight}px`]},{duration:n.core.ui.css.transitionTimeDefault}).finished.then((()=>{this.el.style.maxHeight="100%"}))}_slideUp(){this.el.animate({maxHeight:[`${this.el.scrollHeight}px`,0]},{duration:n.core.ui.css.transitionTimeDefault}).finished.then((()=>{this.el.style.maxHeight="0"}))}get closeAfter(){return this._options.closeAfter}set closeAfter(t){this._options.closeAfter!==(t=(0,o.isBoolean)(t)?!!t&&4e3:parseInt(t,10)||1e3)&&(this._options.closeAfter=t,this.isShown&&this.startAutoClose())}get addCloseButton(){return this._options.addCloseButton}set addCloseButton(t){this._options.addCloseButton=Boolean(t)}get theme(){return this._options.theme||s.K.DEFAULT}set theme(t){let e=this._options.theme;t!==e&&(this._options.theme=t,this.isRendered&&(e!==s.K.DEFAULT&&this.$el.removeClass(`toast_${e.valueOf()}`),t!==s.K.DEFAULT&&this.$el.addClass(`toast_${t.valueOf()}`)))}get content(){return this._renderContent()}set content(t){this._renderContent().empty().append(t)}get destroyAfterHide(){return this._options.destroyAfterHide}set destroyAfterHide(t){this._options.destroyAfterHide=Boolean(t),this.isRendered&&!this.isShown&&this.destroy()}}},47520:(t,e,i)=>{i.d(e,{K:()=>o});i(66992),i(33948);var s=i(66447),n=i(42107);const r=i(19755);class o extends s.Z{init(){var t,e;if(this.maxVisibleRows=null!==(t=this.maxVisibleRows)&&void 0!==t?t:1,this.oneRowHeight=null!==(e=this.oneRowHeight)&&void 0!==e?e:32,this.$els={wrapper:this.$(".community-top-tags__wrap"),list:this.$(".community-top-tags__list")},this._initAnalytics(),this._getRowsCount()<=this.maxVisibleRows)return this._hideSkeleton(),this;const i=this._findLastVisibleTag();if(!i)return this._hideSkeleton(),this;this._transformToButton(i),this._hideSkeleton()}_getRowsCount(){return Math.ceil(this.$els.list.height()/this.oneRowHeight)}_findLastVisibleTag(){const t=this.$els.wrapper.offset().top,e=[...this.$els.list.find(".community-top-tags__list-item")];for(let i=0;i<e.length;i++){if(r(e[i]).offset().top-t>this.oneRowHeight*this.maxVisibleRows)return e[i-1]}return null}_hideSkeleton(){this.$el.removeClass("community-top-tags_skeleton")}_transformToButton(t){const e=t.firstElementChild,i=r('<button class="community-top-tags__expand" title="Показать больше тегов"></button>'),s=i[0];i.css("margin-right",Math.ceil(r(e).width())-16+"px"),i.on("click",(()=>{s.remove(),t.appendChild(e),this.$els.wrapper.css("height",this.$els.list.height()+"px").removeClass("community-top-tags__wrap_collapsed")})),e.remove(),t.appendChild(s)}_initAnalytics(){const t=this._options.communityId,e=n.cp.getInstance();this.$els.list.on("click auxclick",".community-top-tags__list-link",(({currentTarget:i})=>{e.sendEvent("transition_to_tag",{type:"community_top_tags",tags:i.dataset.tag,community_id:t})}))}}},58330:(t,e,i)=>{i.d(e,{S:()=>s.S});var s=i(30796)},30796:(t,e,i)=>{i.d(e,{S:()=>n});i(41817);function s(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class n{constructor(){s(this,"localUiRegistryKey","__localUiRegistry"),s(this,"components",{})}static getInstance(){return n.instance?n.instance:n.instance=new n}fill(t){return this._fillStorage(this.components,t),this}get(t){return this._getFromStorage(this.components,t)}has(t){return this._hasInStorage(this.components,t)}fillLocal(t,e){if(!t||!t.prototype)throw new Error("Wrong context passed!");return t.prototype[this.localUiRegistryKey]||(t.prototype[this.localUiRegistryKey]={}),this._fillStorage(t.prototype[this.localUiRegistryKey],e),this}getLocal(t,e){const i=t[this.localUiRegistryKey];return i?this._getFromStorage(i,e):{}}_fillStorage(t,e){for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}_hasInStorage(t,e){return e in t}_getFromStorage(t,e){if(!e)return t;const i=t[e];if(!i)throw new Error("Requested item not found in registry");return i}}},89803:(t,e,i)=>{i.d(e,{Z:()=>V,C:()=>V});i(85844),i(88674),i(66992),i(33948),i(74916),i(41817);var s=i(16253),n=i(71648),r=i(2355),o=i(56927),a=i(12953),l=i(88611),u=i(9975),h=i(49412),c=i(83801),d=i(22359),p=i(20446),m=i(90312),_=i(27746),g=i(53056);const v="pkb_tc_visited";var f=i(35924),y=i(58453),b=i(80530),w=i(93266),E=i(36005),A=i(61279),S=i(55576),P=i(73736),C=i(23887),T=i(32677),k=i(41773),D=i(58330),I=i(8233),$=i(12950);var O=i(79431),x=i(85679),B=i(33877),L=i(91904);class M{static async getSocialNetworksMigrateConfig(){const{data:t}=await $.cf.postOrFail("/ajax.php?route=social-network-migrate/get");return t}static resetLastCheckTS(){return O.NM.clear(O.hA.DEPRECATED_AUTH_DIALOG_CHECK_TS)}static async updateLastCheckTS(){return await this.resetLastCheckTS(),O.NM.add(O.hA.DEPRECATED_AUTH_DIALOG_CHECK_TS,Date.now())}static async checkLastShownTs(){var t,e;if(!a.core.isUserAuthorized||!L.V.isUserInExperiment(L.t.GOOGLE_POPUP))return;const{type:s,source:n,result:r}=a.core.initParams.oauth_result||{};r&&"signin"===s&&"google"===n&&await this.resetLastCheckTS(),await(0,B.g)(60*x.vL);const o=null!==(t=null===(e=await O.NM.get(O.hA.DEPRECATED_AUTH_DIALOG_CHECK_TS))||void 0===e?void 0:e[0])&&void 0!==t?t:0;if(Number.isInteger(o)&&Date.now()-o<=x.mf)return;const l=await M.getSocialNetworksMigrateConfig();await M.updateLastCheckTS(),l.has_only_deprecating_social_networks&&requestIdleCallback((async()=>{const{createApp:t}=await i(18058);t().mount(document.createDocumentFragment())}))}}function F(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function R(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?F(Object(i),!0).forEach((function(e){N(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function N(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const j=i(19755),U=/\S/,H="scrollRestoration"in history;class V extends s.vp{constructor(){super(!0),this._isMobileSafari=(a.core.ua.ios||navigator.maxTouchPoints>1)&&a.core.ua.safari,a.core.ua.safari&&document.documentElement.classList.add("safari"),this._options={marks:void 0,beforeEndFactor:a.core.initParams.isAdsDisabled?3:1.5,viewportHeightEnd:0,isPageScrollable:!0},this.els={body:document.body},this.$els={body:j(this.els.body),html:j("html"),scrollAnimation:j("html, body"),window:j(window),document:j(document)},this._lastWindowWidth=0,this._lastWindowHeight=0,this.lastScrollTop=0,this.lastScrollLeft=0,this._screen=void 0,this._onWindowResize(!0),this._onDocumentScroll(!1,!0),this.$els.window.on("resize",(0,E.throttle)(this._onWindowResize.bind(this,!1),10)),this.addHook("orientationchange",j(window.matchMedia("(orientation: portrait)")),"change",(t=>this._onOrientationChange({isPortrait:t.target.matches}))),this.addHook("pointer-move",this.$els.document,this._onPointerMove.bind(this)),this.addHook("pointer-up",this.$els.document,this._onPointerUp.bind(this)),this.addHook("fullscreenchange",this.$els.document,u.I.onChangeEventName,this._onFullScreenChange.bind(this)),this.addHook("paste-image",this.$els.document,"paste",this._onPasteImage.bind(this)),this._dndEnd=(0,E.debounce)((()=>{this.dragState=!1}),100),this.addHook("dnd",this.$els.document,"dragenter dragleave dragover",this._onDnD.bind(this)),this.addHook("dnd-drop",this.$els.document,"drop",this._onDnDDrop.bind(this)),this.addHook("beforeunload",this.$els.window,"beforeunload",this._onBeforeEnd.bind(this)),this.addHook("unload",this.$els.window,"unload",this._onPageUnload.bind(this)),this.addHook("blur",this.$els.window,"blur",this._onWindowBlur.bind(this)),this.addHook("focus",this.$els.window,"focus",this._onWindowFocus.bind(this)),r.E.isSupported&&this.addHook("visibilitychange",this.$els.document,r.E.onChangeEventName,this._onVisibilityChange.bind(this)),this.addHook("document-scroll",this.$els.document,"scroll",this._onDocumentScroll.bind(this)),this.addHook("document-end",this.$els.document,"scroll",(0,E.throttle)(this._onDetectDocumentEnd.bind(this),200)),this._updateJQuery(),c.x&&j('meta[name="theme-color"]').attr("content",this.css.colors.headerBackground),j(".promo-button__tinkoff-dots").on("click",(t=>{if(t.preventDefault(),!this._tinkoffHint){const e=D.S.getInstance().get("UIPopupHint"),i=t.target;this._tinkoffHint=new e({target:i,content:i.dataset.mark,destroyAfterHide:!1,wrapperExtraClass:"promo-button__tinkoff-popup",distance:8})}this._tinkoffHint.show()})),o.z.getInstance().init(),this._initLogoLink(),this._initNotificationsLink(),this._initTopAuthorDialog(),this._initPikabuPlusPopup(),this._initRKNWarning(),M.checkLastShownTs(),(new y.B).init(),(new b.Y).init(),queueMicrotask((()=>this._checkAuthUrl()))}_initScrollStartAnalytics(){const t=["pointerdown","keydown","wheel"];let e=!1;const i=()=>{e=!0,t.map((t=>document.removeEventListener(t,i)))};t.map((t=>document.addEventListener(t,i)));const s=()=>{if(!e)return!1;let t;document.removeEventListener("scroll",s),"story"===a.core.initParams.pageName&&(t=a.core.initParams.pageRecordID),w.D.sendEvent("scroll_start",{post_id:t})};document.addEventListener("scroll",s,{passive:!0})}_initPikabuPlusPopup(){j("body").on("click auxclick",'span[data-type="pikabu-plus"]',(async t=>{const{createApp:e}=await i(90674);e().mount(document.createDocumentFragment()),m.c.getInstance().sendEvent("pikabu_plus_popup_showed",{})}))}_initRKNWarning(){var t;null===(t=document.querySelector('[data-role="rkn-close"]'))||void 0===t||t.addEventListener("click",(t=>{var e;!async function(){await $.cf.postOrFail("/ajax.php",{route:"rkn/hide-mass-subscribers-warning"})}(),j(null===(e=t.currentTarget)||void 0===e?void 0:e.closest("section")).slideUp()}))}_initPageCloseAnalytics(){const t=t=>{var e,i;const s=performance.now()-(null!==(e=null===(i=performance.getEntriesByType("navigation")[0])||void 0===i?void 0:i.domInteractive)&&void 0!==e?e:0);w.D.sendEvent("page_close",{type:t,view_time:s})};let e=!1;window.addEventListener("pagehide",(()=>{e=!0,t("unload")})),document.addEventListener("visibilitychange",(()=>{e||"hidden"!==document.visibilityState||t("hidden")}))}_sendOauthAnalytics(){const t=a.core.initParams.oauth_result;if(!t)return;const e="signin"===t.type?"authorization":"account_created";m.c.getInstance().sendEvent(e,R(R({},A._.get()),{},{type:t.source}))}init(){this.themeSettings.emit("noop"),new d.bi,new _.a,this._initPromoButtonAnalytics(),this._initScrollStartAnalytics(),this._initPageCloseAnalytics(),this._sendOauthAnalytics()}_insertBadge(t,e="NEW"){const i=document.createElement("span"),s=["bell","bell_profile-menu"];return i.innerText=e,i.classList.add(...s),null==t||t.insertAdjacentElement("beforeend",i),i}get marks(){return this._options.marks||(this._options.marks=new Map),this._options.marks}_updateJQuery(){let t=j.cleanData;j.cleanData=function(e){for(let t,i=0;void 0!==(t=e[i]);i++)j(t).triggerHandler("removed");t(e)}}addHook(t,e,i,n){if(!n&&(0,E.isFunction)(i)&&(n=i,i=t),!(0,E.isFunction)(n))return this;let r="pointer-move"===t;if("document-scroll"===t)return this.hook.on(t,(t=>{t!==s.ZK.FIRST_ON&&t!==s.ZK.LAST_OFF||this._scrollHookHandler(t,n)})),this;if("paste-image"===t)return this.hook.on(t,(t=>{t===s.ZK.FIRST_ON?window.document.addEventListener("paste",n,!0):t===s.ZK.LAST_OFF&&window.document.removeEventListener("paste",n)})),this;if(r||"pointer-up"===t)this.hook.on(t,(t=>{if(t===s.ZK.FIRST_ON){try{window.document.addEventListener(r?"touchmove":"touchend",n)}catch(e){}window.document.addEventListener(r?"mousemove":"mouseup",n)}else if(t===s.ZK.LAST_OFF){try{window.document.removeEventListener(r?"touchmove":"touchend",n)}catch(e){}window.document.removeEventListener(r?"mousemove":"mouseup",n)}}));else if("blur"===t||"focus"===t)return this.hook.on(t,(e=>{e===s.ZK.FIRST_ON?window.addEventListener(t,n):e===s.ZK.LAST_OFF&&window.removeEventListener(t,n)})),this;return this.hook.on(t,(t=>{t===s.ZK.FIRST_ON?e.on(i,n):t===s.ZK.LAST_OFF&&e.off(i,n)})),this}_initPromoButtonAnalytics(){}_initNotificationsLink(){j("body").on("click auxclick",".notification a, #notifications a",(t=>{if(0===t.button||1===t.button){if(m.c.getInstance().sendEvent("click",{type:"notification_link",link:t.currentTarget.href}),t.currentTarget.dataset.analyticsEvent)try{const e=JSON.parse(t.currentTarget.dataset.analytics||"{}");m.c.getInstance().sendEvent(t.currentTarget.dataset.analyticsEvent,e)}catch(e){}"pay-for-subscribe"===t.currentTarget.dataset.action&&(t.preventDefault(),(0,S.B)({authorId:Number(t.currentTarget.dataset.authorId),supportType:"subscribe"}))}}))}_scrollHookHandler(){}_onVisibilityChange(){return this.emit("visibilitychange",r.E.hidden),this}_onDnD(t){let e=this._options.dragState;if("dragleave"!==t.type){if("dragover"===t.type){if(!e)return;return t.preventDefault(),t.stopPropagation(),void this._dndEnd()}if("dragenter"===t.type){if(this._options.dragState||!t.originalEvent||!t.originalEvent.dataTransfer)return;let e=t.originalEvent.dataTransfer.types,i=e&&e.length;for(;i--;)if(e[i].indexOf("File")>-1){t.stopPropagation(),t.preventDefault(),this.dragState=!0;break}}}else{if(!e)return;this._dndEnd()}}_onDnDDrop(t){this.emit("dnd-drop",t)}_onBeforeEnd(t){return this.emitResult("beforeunload",t)}_onPageUnload(t){this.emit("unload",t)}_onWindowBlur(t){this.emit("blur",t)}_onWindowFocus(t){this.emit("focus",t)}_onDetectDocumentEnd(){let t=this.scrollTop,e=document.body.clientHeight-t;e<this._options.viewportHeightEnd&&this.emit("document-end",e,t)}_onPasteImage(t){if(!t||!t.clipboardData)return;let e=t.clipboardData.items;if(!e)return;if(3===e.length&&e[2].getAsFile()&&"image.png"===e[2].getAsFile().name&&"text/html"===e[1].type&&"text/plain"===e[0].type)return;let i=[];for(let s=0;s<e.length;s++)if(-1!==e[s].type.indexOf("image")){let t=e[s].getAsFile();t&&i.push(t)}i.length>0&&this.emit("paste-image",i,t)}elementWillSoonScrolled(t){return t.offsetHeight+t.offsetTop-this.scrollTop<this._options.viewportHeightEnd}elementInViewport(t,e=50){const i=V.isHTMLElement(t)?j(t):t;if(!i||!i.length)return!1;const s=i.offset(),n=this.windowHeight,r=s.top,o=i.height(),a=Math.floor(r-this.scrollTop),l=a+o;return a>=e&&a<=n||l<=n&&l>=e}_onPointerMove(t){return this.useTouchEvent&&t.touches&&t.touches.length>0?(this.emit("pointer-move",t.touches[0].clientX,t.touches[0].clientY,t),!0):(this.emit("pointer-move",t.pageX||t.clientX,t.pageY||t.clientY,t),!0)}_onPointerUp(t){return this.emit("pointer-up",t),!0}_onOrientationChange(t){this.emit("orientationchange",t),this.emit("gifx-orientationchange")}_onFullScreenChange(t){this.emit("fullscreenchange",u.I.isFullScreen,t.target)}_onWindowResize(t=!1){let e=this._isMobileSafari?window.innerWidth:document.documentElement.clientWidth,i=this._isMobileSafari?window.innerHeight:document.documentElement.clientHeight,s=!1;i===this._lastWindowHeight&&e===this._lastWindowWidth||(this._lastWindowHeight=i,this._lastWindowWidth=e,s=!0,this._options.viewportHeightEnd=i*this._options.beforeEndFactor),s&&!1===t&&this.emit("resize",e,i)}_attachRouteLinks(){return this.$els.document.on("click","a.link-route",(t=>{const e=t.currentTarget.getAttribute("href");t.preventDefault(),a.core.history.pushUrl(e,!0)})),this.listenTo(a.core,"route",(t=>{const e=t.path,i=document.querySelectorAll(`.menu__item_route[href="${e}"], .menu__item_route[data-route="${e}"]`);if(i&&i.length)for(let r of i){let t=r.parentNode.querySelectorAll(".menu__item_current");if(t.length)for(let e,i=t.length;i--;)e=t[i],e.classList.remove("menu__item_current");r.classList.add("menu__item_current")}const s="/subs"===e,n=a.core.initParams.subsCommentsCount<=0;(s&&n||"/blogs"===e)&&this.removeMenuCounter(s?"subs":"blogs")})),this.$els.document.on("click",".menu__item_route",(t=>{const e=t.currentTarget,i=e.getAttribute("href")||e.getAttribute("data-route");t.preventDefault(),t.target.classList.contains("menu__item_current")||i&&a.core.history.replaceUrl(i,!0)})),this}_attachTagsCut(){this.$els.document.on("click",".tags-cut",(t=>{const e=j(t.currentTarget),i=e.data("hint")||{};e.remove(),(0,E.isFunction)(i.destroy)&&i.destroy(),m.c.getInstance().yandex.goal("show_all_tags_pc")}))}_onDocumentScroll(t,e=!1){return this.lastScrollTop=this.scrollTop,this.lastScrollLeft=this.scrollLeft,!1===e&&this.emit("document-scroll"+((0,E.isNumber)(t)?":"+t:""),this.lastScrollTop,this.lastScrollLeft),this}removeMenuCounter(t){const e="header-menu";j(`.${e}`).removeClass(`${e}__item_notification-dot`),j(`.${e}__counter_${t}`).hide()}scrollTo(t,e=!1,i){if(a.core.emit("manualScrollStart"),t instanceof j&&!t.length&&(t=t[0]),t instanceof HTMLElement&&(t=this.scrollTop+t.getBoundingClientRect().top),t=Number(t)||0,!e){return(i||document.documentElement).scrollTop=t,new Promise((t=>{t(),setTimeout((()=>a.core.emit("manualScrollEnd")))}))}return new Promise((s=>{let n="number"==typeof e?e:200;(i?j(i):this.$els.scrollAnimation).stop().animate({scrollTop:t},n),setTimeout((()=>{s(),setTimeout((()=>a.core.emit("manualScrollEnd")))}),n)}))}offsetElement(t){if(t instanceof j){if(!t.length)return!1;t=t[0]}if(!t)return!1;let{left:e,top:i}=t.getBoundingClientRect();return{top:i+this.scrollTop,left:e+this.scrollLeft}}getHeaderHeight(){var t;void 0===this._options.headerHeight&&(this._options.headerHeight=(null===(t=document.querySelector(".header"))||void 0===t?void 0:t.offsetHeight)||0);return this._options.headerHeight}_getColor(t,e){let i=this._bodyComputedStyle;return i||(i=this._bodyComputedStyle=getComputedStyle(document.body)),(i.getPropertyValue(t)||e||"").trim()}_clearCSS(){delete this._css,delete this._bodyComputedStyle,this.emit("update-css")}get dragState(){return this._options.dragState}set dragState(t){this._options.dragState!==(t=Boolean(t))&&(this._options.dragState=t,this.emit("dnd",t))}get windowWidth(){return this._lastWindowWidth||(this._isMobileSafari?window.innerWidth:document.documentElement.clientWidth)}get windowHeight(){return this._lastWindowHeight||(this._isMobileSafari?screen.innerHeight:document.documentElement.clientHeight)}get screenHeight(){if(window.screen){if(navigator.userAgent.match(/iphone|ipod|ipad/i)){let t=n.E.type;return t===l.G.PORTRAIT_PRIMARY||t===l.G.PORTRAIT_SECONDARY?screen.height:screen.width}return screen.height}return window.innerHeight}get scrollTop(){return window.pageYOffset||document.documentElement.scrollTop}get scrollLeft(){return window.pageXOffset||document.documentElement.scrollLeft}get useTouchEvent(){return(0,E.isUndefined)(this._useTouchEvent)?this._useTouchEvent=Boolean("ontouchstart"in document.documentElement):this._useTouchEvent}get devicePixelRatio(){return window.devicePixelRatio}get scrollRestoration(){return H&&history.scrollRestoration||"auto"}set scrollRestoration(t){H&&(history.scrollRestoration=t)}get css(){return this._css||(this._css={margin:15,transitionTimeDefault:200,paddingLeft:25,animationPopup:250,fontFamily:'"Roboto", "Open Sans", Helvetica, Arial, sans-serif',colors:{bg:this._getColor("--color-bright-800","#fff"),green:this._getColor("--color-primary-700","#8ac858"),headerBackground:this._getColor("--color-bright-800","#fff"),caption:this._getColor("--color-black-700","#757575"),border:this._getColor("--color-black-430","#f3f4f5"),text:this._getColor("--color-black-940","#212121"),textGreen:this._getColor("--color-primary-900","#6c9b45")}}),this._css}get themeSettings(){if(this._themeSettings)return this._themeSettings;const t=this._themeSettings=new h.fM;return this.listenTo(t,"change",((t,e)=>{t===h.f0.DEFAULT?this.$els.html.removeAttr("data-theme"):this.$els.html.attr("data-theme",t.valueOf()),e?this.$els.html.attr("data-theme-dark",!0):this.$els.html.removeAttr("data-theme-dark"),this._clearCSS(),j('meta[name="theme-color"]').attr("content",a.core.ui.css.colors.headerBackground)})),t}static isHTMLElement(t){return t instanceof HTMLElement||t instanceof Element}static isJQuery(t){return t instanceof j&&t.length>0}static isElement(t){return V.isJQuery(t)||V.isHTMLElement(t)}static clearEmptyTextNode(t){if(t&&t.childNodes&&t.childNodes.length)for(let e=t.childNodes.length-1;e>=0;--e){let i=t.childNodes[e];8===i.nodeType||3===i.nodeType&&!U.test(i.nodeValue)?t.removeChild(i):1===i.nodeType&&V.clearEmptyTextNode(i)}}static fragment(t){let e,i,s=document.createElement("template");if(s.innerHTML=t,"content"in s)return s.content;for(i=document.createDocumentFragment(),e=s.childNodes;e[0];)i.appendChild(e[0]);return i}static reloadScripts(){j('script[data-type="reload-js"]').each(((t,e)=>{const i=j(e).attr("src"),s=e.textContent;j(e).remove(),i?j('<script data-type="reload-js">').attr("src",i).appendTo("head"):j('<script data-type="reload-js">').text(s).appendTo("head")}))}static removeOldAds(){j('[id^="adfox_"][id$="sidebar_1"], [id^="adfox_"][id$="sidebar_2"]').each(((t,e)=>{j(e).children("div, iframe").remove()}))}get isEmbedded(){return this.$els.app.hasClass("app_iframe")||this.$els.app.hasClass("app_iframe-fw")}get screen(){return this._screen}set screen(t){if(this._screen!==t){if(this._screen){try{var e;null===(e=window.anl)||void 0===e||e._params.setScreen(T.L[t])}catch(i){}m.c.getInstance().screenHistory.setScreen(t)}this._screen=t,t in C.qJ?P.dV.setScreen("number"==typeof t?t:C.qJ[t]):t in p.dt?P.dV.setScreen(C.qJ[p.dt[t]]):t.toUpperCase()in C.qJ&&P.dV.setScreen(C.qJ[t.toUpperCase()])}}_initLogoLink(){const t=document.querySelector(".header__logo a");if(!t)return;const{tcId:e,tcLink:i}=t.dataset;e&&i&&g.m.get(v)!==e&&t.addEventListener("click",(t=>{t.preventDefault(),g.m.set(v,e),window.open(i,"_blank")}),{once:!0})}_checkAuthUrl(){if(a.core.isUserAuthorized)return;const t=new f._(window.location.search);t.has("authRedirect")&&"auth"!==a.core.initParams.pageName&&a.core.ui.authRequired({formType:t.get("authType")})}async _initTopAuthorDialog(){if(!a.core.initParams.isUserTopAuthor||!k.E.has(k.j.PROPERTY_SHOW_SET_TOP_AUTHOR_TOOLTIP))return;const{createApp:t}=await i(24412);t().mount(document.createDocumentFragment()),k.E.set(k.j.PROPERTY_SHOW_SET_TOP_AUTHOR_TOOLTIP,!1)}async attachSubscribeButtons(t=document){const e=t.querySelectorAll('span[data-role="subscribe"]');if(!e.length)return;await(0,I.y)();const{createApp:s}=await i(81815);e.forEach((async t=>{await(0,I.y)();const e=document.createDocumentFragment(),i=R({},t.dataset);delete i.role;["isSubscribed","isFullBan","isIgnored","isIgnoredComments","showIcon","showText","wide","isPessimized"].forEach((t=>{void 0!==i[t]&&(i[t]="true"===i[t])})),i.actions=i.actions?i.actions.split(","):[];try{i.analytics=JSON.parse(i.analytics)}catch(n){i.analytics={}}void 0!==i.analyticsType&&(i.analytics.type=i.analyticsType,delete i.analyticsType),s(i).mount(e),t.replaceWith(e)}))}}},52314:(t,e,i)=>{var s=i(30796),n=i(88358),r=(i(88674),i(36005)),o=i(68016),a=i(12953),l=i(96637),u=i(63907),h=i(85823),c=i(32617),d=i(47442),p=i(31474),m=i(33662);var _=i(87864);const g=i(19755);class v extends n.LD{constructor(t){return super(),this.setOptions((0,r.extend)({header:a.core.i18n("ignore-rule-popup.modal.header"),isHeaderLeftAlign:!0,destroyAfterHide:!0,indent:!0,width:470,updateRule:!1,analyticsType:""},t||{})),this._ignoreRule=(0,r.extend)({tags:[],authors:[],communities:[],keywords:[],period:t&&t.ignoreRule&&t.ignoreRule.valid_until?m.RO.KEEP_EXISTING:m.RO.FOREVER},t&&t.ignoreRule||{}),this._initialIgnoreRule=JSON.parse(JSON.stringify(this._ignoreRule)),this._toast=void 0,this._ready=new Promise((t=>{this._resolve=t})),this}render(){return this.isRendered||(super.render(),this.content='<form class="ignore-rule-popup" action="javascript: void(0)" novalidate>\n\t<div class="ignore-rule-popup__annotation">\n\t\tВы не увидите пост, который будет соответствовать <strong>всем</strong> заданным условиям\n\t</div>\n\n\t<div class="form-group form-group_open">\n\t\t<div class="form-group__button form-group__button_disabled">\n\t\t\t<span>Период скрытия</span>\n\t\t</div>\n\t\t<div class="form-group__body ignore-rule-popup__duration">\n\t\t\t<div data-role="duration"></div>\n\t\t</div>\n\t</div>\n\n\t<div class="form-group">\n\t\t<div class="form-group__button">\n\t\t\t<a><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__plus icon--ui__plus_button-gray"><use xlink:href="#icon--ui__plus"></use></svg></a>\n\t\t\t<span>Теги</span>\n\t\t</div>\n\t\t<div class="form-group__body ignore-rule-popup__tags">\n\t\t\t<div class="input input_little input_wide input_inline" data-role="tag">\n\t\t\t\t<input class="input__input" placeholder="добавить тег" value="">\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class="form-group">\n\t\t<div class="form-group__button">\n\t\t\t<a><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__plus icon--ui__plus_button-gray"><use xlink:href="#icon--ui__plus"></use></svg></a>\n\t\t\t<span>Пользователь</span>\n\t\t</div>\n\t\t<div class="form-group__body ignore-rule-popup__users">\n\t\t\t<div class="input input_little input_wide input_inline" data-role="user">\n\t\t\t\t<input class="input__input" placeholder="добавить пользователя" value="">\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class="form-group">\n\t\t<div class="form-group__button">\n\t\t\t<a><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__plus icon--ui__plus_button-gray"><use xlink:href="#icon--ui__plus"></use></svg></a>\n\t\t\t<span>Сообщество</span>\n\t\t</div>\n\t\t<div class="form-group__body ignore-rule-popup__communities">\n\t\t\t<div class="input input_little input_wide input_inline" data-role="community">\n\t\t\t\t<input class="input__input" placeholder="добавить сообщество" value="">\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class="form-group">\n\t\t<div class="form-group__button">\n\t\t\t<a><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__plus icon--ui__plus_button-gray"><use xlink:href="#icon--ui__plus"></use></svg></a>\n\t\t\t<span>Ключевые слова</span>\n\t\t</div>\n\t\t<div class="form-group__body ignore-rule-popup__keywords">\n\t\t\t<div class="input input_little input_wide input_inline" data-role="keyword">\n\t\t\t\t<input class="input__input" placeholder="добавить слово" value="">\n\t\t\t</div>\n\t\t\t<div class="caption ignore-rule-popup__keywords-note">\n\t\t\t\tИспользуйте символ <span class="text-style text-style_color-red">*</span> для скрытия постов, в которых слова начинаются с указанных букв. Например: <span class="text-style text-style_color-default">полит*</span>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n</form>\n',this.addButtonIntoFooter("ignore-rule-popup.modal.save",(()=>this._handleSubmit()),p.j.SUCCESS),this.addCloseButtonIntoFooter("modal.cancel"),this.form=new h.x(g(this.content).find("form")),this.$els=(0,r.extend)(this.$els,{keywords:this.$(".ignore-rule-popup__keywords"),tags:this.$(".ignore-rule-popup__tags"),users:this.$(".ignore-rule-popup__users"),communities:this.$(".ignore-rule-popup__communities"),duration:this.$('.ignore-rule-popup__duration [data-role="duration"]'),submitButton:this.$(".popup__footer .button_success")}),this._prepareKeywordsControl(),this._prepareTagsControl(),this._prepareCommunitiesControl(),this._prepareUsersControl(),this._prepareDurationControl(),this._addHotkeys(),this.zIndex=6005,this.$els.header.after(this.$els.toasts=g(document.createElement("div")).addClass("ignore-rule-popup__toasts"))),this}ready(){return this._ready}hide(){return this._resolve(!1),super.hide(),this}_prepareTagsControl(){let t=new o.EZ({$el:this.$els.tags,items:this._ignoreRule.tags,addTagMenu:!1});t.on("change",(t=>this._ignoreRule.tags=t)),t.items.length>0&&u.u1.getUIElement(this.$els.tags.closest(".form-group")).open()}_prepareCommunitiesControl(){let t=new o.C2({$el:this.$els.communities,items:this._ignoreRule.communities,useWideButtons:!0,isIgnoreList:!0});t.on("change",(t=>this._ignoreRule.communities=t)),t.items.length>0&&u.u1.getUIElement(this.$els.communities.closest(".form-group")).open()}_prepareUsersControl(){let t=new o._d({$el:this.$els.users,items:this._ignoreRule.authors,useWideButtons:!0,showBanInformation:!0,suggestionFilter:t=>t.id!==a.core.initParams.userID});t.on("change",(t=>this._ignoreRule.authors=t)),t.items.length>0&&u.u1.getUIElement(this.$els.users.closest(".form-group")).open()}_prepareKeywordsControl(){let t=new o.YX({$el:this.$els.keywords,items:this._ignoreRule.keywords});t.on("change",(t=>this._ignoreRule.keywords=t)),t.on("error",(t=>this._showError(t))),t.items.length>0&&u.u1.getUIElement(this.$els.keywords.closest(".form-group")).open()}_prepareDurationControl(){var t;let e=c.Z.renderFromEnum(m.RO,"ignore.duration",this._ignoreRule.period,this.$els.duration),i=(0,r.last)(e);if(this._ignoreRule.period===m.RO.KEEP_EXISTING&&null!==(t=i.el)&&void 0!==t&&t.nextSibling&&i.el.nextSibling instanceof Text){let t=this._ignoreRule.valid_until,{daysUntil:e}=l.Utils.timestampToDaysUntil(t);i.el.nextSibling.replaceWith((0,_.m)(`<span>\n\t\t\t\t${i.el.nextSibling.wholeText}\n\t\t\t\t<span class="caption">\n\t\t\t\t\t(${e} ${a.core.i18n("plural.days",e)})\n\t\t\t\t</span>\n\t\t\t</span>`))}else i.disabled=!0,i.$parent.hide();e.map((t=>this.form.add(t))),this.form.on("change",(()=>{this._ignoreRule.period=m.RO[this.$els.duration.find(":checked").val()]}))}_addHotkeys(){a.core.ui.hotkeys.on("escape",(()=>this.hide()))}_showError(t){this._toast&&this._toast.hide(),a.core.logger.error("ignore popup",t),this._toast=new d.O({$parent:this.$els.toasts,content:t,theme:d.K.DANGER}),this._toast.show()}async _handleSubmit(){let t,{tags:e,communities:i,authors:s,keywords:n}=this._ignoreRule;if(e.length||i.length||s.length||n.length){try{let e=this._options.updateRule?m.jj.updateRule:m.jj.addRule,i=await e(this._ignoreRule,this._options.analyticsType);if(i){let t=new d.O({content:a.core.i18n("ignore.messages.success")});this._resolve({result:i,isInitial:this.isInitial}),t.show(),this.hide()}else t=a.core.i18n("errors.response")}catch(r){t=r.message}t&&this._showError(t)}else this._showError(a.core.i18n("ignore-rule-popup.result.empty-warning"))}get isInitial(){return(0,r.isEqual)(m.jj.prepareRule(this._initialIgnoreRule),m.jj.prepareRule(this._ignoreRule))}}var f=i(3668),y=i(32691),b=i(48218),w=i(99819),E=i(31991),A=i(92125),S=i(57215),P=i(28831),C=(i(41817),i(23006)),T=(i(66992),i(33948),i(16526));function k(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class D extends T.X{constructor(...t){super(...t),k(this,"fieldId","id")}render(){if(this.el)return this.el;super.render();const t=this.els.label=document.createElement("div");t.classList.add("dropdown-item__label"),t.textContent=this.data.name,this.el.setAttribute("data-type","reputation-label");const e=this.els.count=document.createElement("div");return e.classList.add("dropdown-item__info"),e.textContent=this.data.count,this.el.appendChild(t),this.el.appendChild(e),this.el}}var I=i(73429);function $(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function O(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class x extends C.V{constructor(t){super(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?$(Object(i),!0).forEach((function(e){O(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):$(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({highlightResult:!0,useNumericIds:!0},t)),this.items.DataObject=D}async _requestItems(t,e){const i=await I.b.get(),s=t.trim().toLocaleLowerCase();return i.filter((t=>-1!==t.name.toLocaleLowerCase().indexOf(s)))}}var B=i(63588),L=i(29883);class M extends C.V{constructor(t){super(t),this.items.DataObject=B.Sh,this.minQueryLength=3}render(){var t;return this.isRendered||(super.render(),null===(t=this.el)||void 0===t||t.classList.add("dropdown-list_search-series-stories")),this}async _requestItems(t){try{return L.nm.searchStories(t)}catch(e){e instanceof Error&&a.core.ui.toasts.showError(e.message)}return[]}}var F=i(41531),R=i(59297),N=i(68511),j=i(39799),U=i(42107);var H=i(18910),V=i(19477),W=i(96050),q=i(33416),z=i(53619),Y=i(65028),G=i(79849);s.S.getInstance().fill({storyStyle:P.lO,Story:P.s6,ModeratorTools:R.$,UIIgnoreRulePopup:v,UIDropDownReputationLabels:x,UIDropDownSearchSeriesStories:M,Sanitizers:f.op,UIInput:f.u3,UITextArea:w.G,UIForm:h.x,UIDropDownProfessions:E.J,UIDropDownSeries:A.i,PopupMaster:b.g,ReputationStoriesFeed:S.$m,UICarousel:N.y,UICommentsExtension:F.h,UIAuthModal:j.B,UICheckbox:y.m,UIEditor:V.Y,UIButton:H.y3,UIRatingItem:class{static getElement({position:t,userName:e,totalRating:i,userAvatar:s,count:n,isSubscribed:r,userId:o}){const l=a.core.initParams.userID===o,u=s?`<img src="${s}" alt="${e}" loading="lazy">`:'<span class="avatar__default"></span>',h=l?"":`<button class="button${r?"":" button_success"}" data-user-id="${o}">\n\t\t\t\t\t${a.core.icon("ui__rss-add")} ${a.core.icon("ui__rss-delete")}\n\t\t\t\t</button>`,c=document.createElement("tr"),d=t<=3,p=c.classList;if(p.add("public-ratings-list__item"),l){p.add(d?"table__row_highlight-primary":"table__row_highlight-warning");const t=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(t.unobserve(e.target),U.cp.getInstance().sendEvent("reach_element",{type:"find_yourself_in_top",screen_index:c.getAttribute("data-list-position")}))}))}),{threshold:0});t.observe(c)}else d&&p.add("table__row_highlight-primary");return(l||d)&&p.add("table__row_highlight"),c.innerHTML=`\n\t\t\t<td>${t}</td>\n\t\t\t<td>\n\t\t\t\t<a\n\t\t\t\t\tclass="public-ratings-list__username user__nick"\n\t\t\t\t\ttarget="_blank"\n\t\t\t\t\thref="/@${e}"\n\t\t\t\t\tdata-profile="true"\n\t\t\t\t\tdata-name="${e}"\n\t\t\t\t\tdata-id="${o}"\n\t\t\t\t>\n\t\t\t\t\t<span class="avatar avatar_small">\n\t\t\t\t\t\t<span class="avatar__inner">\n\t\t\t\t\t\t\t${u}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span>${e}</span>\n\t\t\t\t</a>\n\t\t\t</td>\n\t\t\t<td>${n}</td>\n\t\t\t<td class="public-ratings-list__sum">${i}</td>\n\t\t\t<td>${h}</td>\n\t\t`,c}},UIToasts:W.e,StoriesFeed:q._,UIImageViewer:z.p,UIRadio:c.Z,UIPopupHint:n.gR,UICommunityMiniProfile:Y.W,StoriesSocialFeature:G.B})},39799:(t,e,i)=>{i.d(e,{B:()=>p});i(66992),i(33948),i(41817);var s=i(12953),n=i(32022),r=i(88358),o=i(42107),a=i(81780),l=i(61279),u=i(72283);function h(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?h(Object(i),!0).forEach((function(e){d(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function d(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class p{constructor(t){d(this,"noticeMessageBlocked",!1);const{template:e,destroyAfterHide:i,componentName:o,showCloseIcon:a}=t;this.componentName=o,this.modal=new r.LD({content:e,destroyAfterHide:i,wrapperExtraClass:"feed_popup"===this.componentName?"popup_auth-modal":""});const[l]=this.modal.content;this.form=new n.h(l.firstElementChild,o),this.$elMessage=this.modal.$els.content.find(".auth-modal__notice, .auth__notice"),a&&this.modal.addCloseIcon({modificatorCss:"default"}),s.core.listenTo(s.core,"error-auth-toast",this.modal.hide.bind(this.modal)),s.core.listenTo(s.core,"success-auth-toast",this.modal.hide.bind(this.modal)),s.core.listenTo(s.core,"auth-tab-changed",(()=>{this.noticeMessageBlocked?this.noticeMessageBlocked=!1:this.$elMessage.hide()}))}showSignIn(t){this.show("signin",t)}showSignUp(t){this.show("signup",t)}showChangePassword(t){this.show("change-password",t)}showSignUpOauth(t){this.show("oauth",t)}show(t,e){var i,n;const r=(t,e={})=>{var i;o.cp.getInstance().sendEvent(t,c(c({component_name:"popup"},(null===(i=this.form.currentForm)||void 0===i?void 0:i.analyticsParams)||this.form.analyticsParams),e))};s.core.ui.activeAuth=this.form,setTimeout((()=>{r("form_show",{view_time:void 0})}),1),l._.set(null!==(i=null==e?void 0:e.analyticsParams)&&void 0!==i?i:{}),null!=e&&e.triggeredAction&&e.triggeredAction.action&&u.o.addAction(e.triggeredAction),this.modal.show(),null===(n=this.modal.$els.overlay)||void 0===n||n.on("click",(()=>r("click",{button:"empty_space"}))),s.core.listenToOnce(this.modal,a.e.UNMOUNTED,(()=>{r("form_close"),s.core.ui.activeAuth=null,l._.clear(),u.o.clearAction()})),this.modal.once("close-button-click",(()=>{r("click",{button:"close"})})),this.form.redirectUrl=null==e?void 0:e.redirectUrl,this.form.show(),this.$elMessage.show(),this.noticeMessageBlocked=!0,this.form.changeTab(t),this.form.analyticsParams=(null==e?void 0:e.analyticsParams)||{}}setMessage(t,e=""){const i=Boolean(t),s=this.modal.$els.content.find(".auth-modal__notice, .auth__notice");s.length&&(["warning","success"].forEach((t=>{["auth-modal__notice","auth__notice"].forEach((i=>{s.hasClass(i)&&s.toggleClass(`${i}_${t}`,e===t)}))})),s.html(t||""),s.toggle(i))}}},24126:(t,e,i)=>{i.d(e,{C:()=>f});i(74916),i(88674),i(41817);var s=i(12953),n=i(12551),r=i(1262),o=i(3668),a=(i(85823),i(72346)),l=i(95374),u=i(18910),h=i(88358),c=i(96637),d=(i(47442),i(90312)),p=i(20446),m=i(36005);function _(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function g(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?_(Object(i),!0).forEach((function(e){v(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):_(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function v(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class f extends n.T{constructor(t){super(t),this._passwordComplexity=void 0}render(){if(this.isRendered)return this;s.core.ui.screen=p.dt.RESTORE,super.render();let t={validationEvent:o.km.BLUR,validationHint:{direction:h.Lh.LEFT,alignment:h.SE.CENTER},sanitizerRules:[a.o.trim()],addSuccessState:!0,onValidityErrorMessage:(t,{input:e})=>{this._sendAnalytics(t,{input:e})}};return this.$els.complexity=this.$(".input__complexity"),this._password=new o.u3((0,m.defaults)({$el:this.$('input[data-role="password"]').parent().parent()},t)),this._password.validationRules={"auth.up.errors.password-short":l.c.isLength(4),"auth.up.errors.password-week":()=>c.PasswordStrength.test(this._password.value)>c.PASSWORD_STRENGTH.WEEK},this._passwordRepeat=new o.u3((0,m.defaults)({$el:this.$('input[data-role="password-repeat"]').parent()},t)),this._passwordRepeat.validationRules={"auth.up.errors.password-mismatch":()=>this._passwordRepeat.value===this._password.value},this.listenTo(this._password,"blur",(()=>{document.activeElement!==this._passwordRepeat.els.input&&Boolean(this._passwordRepeat.value)&&this._passwordRepeat.checkValidity()})),this.listenTo(this._password,"input",(0,m.debounce)((()=>{Boolean(this._passwordRepeat.value)&&this._passwordRepeat.checkValidity({showValidationHint:!1})}),200)),this.listenTo(this._password,"input",(0,m.throttle)((()=>{this._setPasswordComplexity(c.PasswordStrength.test(this._password.value))}),200)),this._submit=new u.y3({$el:this.$('button[type="submit"]')}),this._form.add(this._passwordRepeat),this._form.add(this._password),this.listenTo(this._form,"submit",this._onSubmit),this.listenToOnce(this._password,"input",this._onPasswordInput),this.listenToOnce(this._passwordRepeat,"input",this._onPasswordRepeatInput),this}_setPasswordComplexity(t){t!==this._passwordComplexity&&(this._passwordComplexity&&this.$els.complexity.removeClass("input__complexity_"+this._passwordComplexity.toString().toLowerCase()),this._passwordComplexity=t,this.$els.complexity.addClass("input__complexity_"+this._passwordComplexity.toString().toLowerCase()))}async _onSubmit(t,e){if(t&&(0,m.isFunction)(t.preventDefault)&&t.preventDefault(),this._submit.progress)return;if(d.c.getInstance().sendEvent("click",g(g({},this.analyticsParams),{},{button:"submit"})),this.setErrorMessage(),!(await e.checkValidity()))return;this._submit.progress=!0,this._submit.disabled=!0;let i=this._form.serialize(),n=this.$el.data("params");n=(0,m.isEmpty)(n)?{}:n,n.action="set_password",n.p=i.restore_passwd1;try{await r.User.restorePassword(n),s.core.ui.toasts.add({content:s.core.i18n("auth.forget.changed")}),this._submit.progress=!1,setTimeout((()=>{window.location.href="/"}),2e3)}catch(o){this.setErrorMessage(o.message||s.core.i18n("auth.forget.failure")),this._submit.progress=!1,this._submit.disabled=!1}}_onPasswordInput(){this._login=this.$el.find('[data-role="user-name"]').text(),d.c.getInstance().sendEvent("create_password",g(g({},this.analyticsParams),{},{repeated:0}))}_onPasswordRepeatInput(){this._login||(this._login=this.$el.find('[data-role="user-name"]').text()),d.c.getInstance().sendEvent("create_password",g(g({},this.analyticsParams),{},{repeated:1}))}get analyticsParams(){return{type:"password_recovery",component_name:"password_recovery"}}}},80459:(t,e,i)=>{i.d(e,{y:()=>u});var s=i(12953),n=i(31474),r=i(63907),o=i(11315),a=i(36005);const l=i(19755);class u extends r.u1{constructor(t){super(t),this.classes={item:"button",animation:"button_animation"},this.$el&&this.show()}render(){if(this.isRendered)return this;this.$el||(this.$el=l(document.createElement("button")).addClass("button"));let t=this.$el.find("button");this.$els.buttons=t.length?t:this.$el;let e=this.$els.buttons.eq(0);return e.on("click",(t=>{this.emit("click",t,this)})),this.$els.title=e.find(".button__title"),this.$els.title.length||(this.$els.title=l(document.createElement("span")).addClass("button__title").html(this.title||e.html()),e.html(this.$els.title)),this.theme&&this.theme.valueOf().length&&!e.hasClass(`button_${this.theme.valueOf()}`)&&e.addClass(`button_${this.theme.valueOf()}`),super.render(),this}_renderProgress(){return this._progress||(this.isRendered||this.render(),this._progress=new o.j({inside:this.$el})),this._progress}_renderAnimate(){return this._animation?this._animation:this._animation=s.default.ui.player.createAnimation(this.animationName,{inside:this.$el,indent:this.animationIndent||2})}get progress(){return this._options.progress}set progress(t){var e;let i=Boolean(t);return t=!(!(0,a.isBoolean)(t)&&!(0,a.isNumber)(t))&&t,this._options.progress===t?t:(this._renderProgress(),i?(0,a.isBoolean)(t)?(this._progress.percent=20,this._progress.indeterminate=!0):(this._progress.indeterminate=!1,this._progress.percent=t):this._progress.stop(),this._progress.toggle(i),null===(e=this.$el)||void 0===e||e.toggleClass(this.classes.animation,i),this._options.progress=t)}get animation(){return this._options.animation}set animation(t){return t=Boolean(t),this.animation===t?this:(this.animationName&&this._renderAnimate().togglePlay(t),this.$el.toggleClass(this.classes.animation,t),this._options.animation=t)}get animationIndent(){return this._options.animationIndent}set animationIndent(t){this._options.animationIndent!==(t=parseInt(t,10))&&(this._options.animationIndent=t)}get animationName(){return this._options.animationName}set animationName(t){return t=String(t),this._options.animationName===t?this.animationName:(s.default.ui.player.preloadAnimation(t),this._options.animationName=t)}get disabled(){return this._options.disabled}set disabled(t){return t=Boolean(t),this.$els.buttons&&(0,a.forEach)(this.$els.buttons,(e=>{t?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled")})),this._options.disabled=t}get title(){return this._options.title}set title(t){return this.$els.title&&this.$els.title.text(t),this._options.title=t}get theme(){return this._options.theme||n.j.DEFAULT}set theme(t){let e=this._options.theme;(t=n.j[t])&&t!==e&&(this._options.theme=t,this.isRendered&&(e&&e.valueOf().length&&this.$el.removeClass(`button_${e.valueOf()}`),t&&t.valueOf().length&&this.$el.addClass(`button_${t.valueOf()}`)))}}},18910:(t,e,i)=>{i.d(e,{jM:()=>u.j,y3:()=>s.y,BO:()=>a});var s=i(80459),n=i(72044),r=i(36005);const o=i(19755);class a extends s.y{constructor(t){super({}),this.classes={item:"button-group",animation:"button-group_animation"},n.Zv.isHTMLElement(t)&&(t=o(t)),t instanceof o&&(t={$el:t.eq(0)}),t&&this.setOptions((0,r.defaults)(t,{destroyAfterRemove:!0})),this.$el&&this.show()}render(){return this.isRendered||(this.$el||(this.$el=o(document.createElement("div")).addClass("button-group")),this.$el.find("button").length||(o(document.createElement("button")).html("Подписаться").appendTo(this.$el),o(document.createElement("button")).addClass("button_dot").appendTo(this.$el),this.$els.buttons=this.$el.find("button")),super.render()),this}}var l=i(65448);new l.xs({COMMUNITY:"community",USER:"user",TAG:"tag"}),new l.xs({SETTINGS:"settings",SETTINGS_BAN:"settings-ban",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",IGNORE_LIST:"ignore-list",COMPLAIN:"complain"});var u=i(31474)},68511:(t,e,i)=>{i.d(e,{y:()=>c});i(66992),i(33948),i(41817);var s=i(43241);const n="carousel",r={container:n,content:`${n}__content`,itemsWrapper:`${n}__helper`,item:`${n}__item`,btnLeft:`${n}__scroll_left`,btnRight:`${n}__scroll_right`,btnIsHidden:`${n}__scroll_hidden`,community:{container:`${n}__community`,link:`${n}__community-link`,btnSubscribe:`${n}__community-follow`}};var o=i(24431),a=i(51540);function l(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class u extends s.u{constructor(t){super(t),l(this,"els",{}),l(this,"scrollBlocks","auto"),l(this,"scrollDuration",200),l(this,"isScrolling",!1),l(this,"startViewTime",0),l(this,"timeViewed",0),this.el&&(this.els={content:this.el.querySelector("."+r.content),itemsWrapper:this.el.querySelector("."+r.itemsWrapper),btnLeft:this.el.querySelector("."+r.btnLeft),btnRight:this.el.querySelector("."+r.btnRight),items:Array.from(this.el.querySelectorAll("."+r.item))},this.els.content.scrollLeft=0,this.show())}render(){return this.isRendered||(this.initScrollHandlers(),this.initObserver(),super.render()),this}updateItems(){const t=this.el;this.els.items=Array.from(t.querySelectorAll("."+r.item)),(this.els.btnLeft||this.els.btnRight)&&this.updateButtonsState()}initScrollHandlers(){var t,e;null===(t=this.els.btnRight)||void 0===t||t.addEventListener("click",(()=>this.scroll(this.getScrollWidth("right")))),null===(e=this.els.btnLeft)||void 0===e||e.addEventListener("click",(()=>this.scroll(this.getScrollWidth("left")))),this.els.content.addEventListener("wheel",(t=>{const{shiftKey:e}=t;e&&(t.preventDefault(),this.scroll(this.getScrollWidth(t.deltaY>0?"right":"left")))})),this.toggleBtnObserver()}toggleBtnObserver(){(this.els.btnLeft||this.els.btnRight)&&(this.updateButtonsState(),this.els.content.addEventListener("scroll",(0,a.P)(this.updateButtonsState.bind(this),100)))}updateButtonsState(){var t,e;const{scrollLeft:i,scrollWidth:s,clientWidth:n}=this.els.content,o=Math.round(s-i-n);null===(t=this.els.btnLeft)||void 0===t||t.classList.toggle(r.btnIsHidden,i<=2),null===(e=this.els.btnRight)||void 0===e||e.classList.toggle(r.btnIsHidden,o<=2)}scroll(t){if(this.isScrolling)return;this.isScrolling=!0;const e=this.els.content,i=e.scrollLeft,s=i+t,n=s-i,r=performance.now();if(0===t)return void(this.isScrolling=!1);const a=t=>{const l=t-r;e.scrollLeft=Math.round((0,o.m)(l,i,n,this.scrollDuration)),l<this.scrollDuration?requestAnimationFrame(a):(e.scrollLeft=s,this.isScrolling=!1)};requestAnimationFrame(a)}initObserver(){if(!this.el)return;let t=!1;const e=()=>{this.timeViewed=Math.round((new Date).getTime()-this.startViewTime)/1e3,this.emit("carouselHidden"),this.el&&s.unobserve(this.el),document.removeEventListener("visibilitychange",i)},i=()=>{"hidden"===document.visibilityState&&t&&e()},s=new IntersectionObserver((s=>{for(const{isIntersecting:n}of s)n&&(t=!0,this.startViewTime=(new Date).getTime(),this.emit("carouselShown"),document.addEventListener("visibilitychange",i),this.updateButtonsState()),t&&!n&&this.el&&e()}),{threshold:[0,1]});s.observe(this.el)}getScrollWidth(t){const e=this.blockWidth,i=this.els.content.scrollLeft;let s,n;if("auto"===this.scrollBlocks){const t=this.els.content.offsetWidth/e;s=t%1>=.7?Math.ceil(t):Math.floor(t)}else s=this.scrollBlocks;return n="right"===t?Math.min(this.els.items.length-1,Math.round((i+e*s)/e)):Math.max(0,Math.round((i-e*s)/e)),this.els.items[n].offsetLeft-i-this.itemsWrapperOffset}get blockWidth(){const t=this.els.items[0];return t?t.offsetWidth+parseInt(window.getComputedStyle(t).marginRight,10):0}get itemsWrapperOffset(){return parseInt(window.getComputedStyle(this.els.itemsWrapper).paddingLeft,10)}}var h=i(1206);class c extends u{render(){if(this.isRendered)return this;super.render();const t=this.els.content;return(0,h.Z)(t,{scrollRatio:2,onDrag:e=>{if(t.classList.toggle("grabbing",e),!e){const{scrollWidth:e,scrollLeft:i,clientWidth:s}=t;i+s===e||this.scrollSnap()}}}),this}scrollSnap(){const t=this.els.content.scrollLeft,e=this.els.items.find((e=>e.offsetLeft+e.offsetWidth/2>=t));if(!e)return;const i=this.els.items[0].offsetLeft,s=e.offsetLeft-t-i;this.scroll(s)}}},32691:(t,e,i)=>{i.d(e,{m:()=>u});var s=i(12953),n=i(63907),r=i(72044),o=i(95411),a=i(36005);i(91904);const l=i(19755);class u extends n.u1{constructor(t){super(),r.Zv.isHTMLElement(t)&&(t=l(t)),t instanceof l&&(t={$el:t.eq(0)}),t&&this.setOptions(t),this.$els={input:void 0},this.el&&this.el.parentNode&&this.show()}render(){if(this.isRendered)return this;let t;if(this.$el&&this.$el.is(this.classes.input)&&(this.$els.input=t=this.$el),!this.$el||t){let e=l(document.createElement("span")).addClass(this.classes.item).append(this._createChecked()).attr("unselectable","on");t&&e.insertBefore(t),this.$el=e}return this.$el.attr("tabindex")||this.$el.attr("tabindex","0"),this.$els.input=this.$els.input&&this.$els.input.length?this.$els.input:this.$(this.classes.input),this.$els.input&&this.$els.input.length||(this.$els.input=l(document.createElement("input")).attr("type",this.classes.type)),this._hotkeys=new o.SV(this.$el),this._hotkeys.on("space",(t=>{t.preventDefault()}),{type:o.FM.KEYDOWN}).on("space",(t=>{t.preventDefault(),this.disabled||(this.checked=!this.checked)})),this.$els.input.attr("class")&&this.$el.addClass(this.$els.input.attr("class")),this.$els.input.hide().appendTo(this.$el).on({change:this._onChange.bind(this),update:this._onUpdate.bind(this)}),this.checked=this.$els.input.prop("checked"),this.disabled=this.$els.input.prop("disabled"),this.$el.parent().is("label")||this.$el.click(this.toggleChecked.bind(this,null,!0)),super.render(),this}_onChange(){this.checked=this.$els.input.prop("checked")}_onUpdate(){this._options.checked=this.$els.input.prop("checked"),this._updateToggle(this._options.checked,!0)}toggleChecked(t,e,i=!0){this.disabled||(t=(0,a.isBoolean)(t)?t:!this.checked,e&&this.$els.input.prop("checked",t),this.checked=t,i&&this.$el.focus())}setChecked(t,e=!1){return t=Boolean(t),this._options.checked===t?this._options.checked:(this.$els.input.prop("checked",t),this._updateToggle(t,!1),e||this.emit("change",t),this._options.checked=t)}_createChecked(){return this.$els.checkedIcon?this.$els.checkedIcon:this.$els.checkedIcon=l(s.default.icon("ui__approve","checkbox"))}_updateToggle(t,e=!0){this.$el.toggleClass(this.classes.checked,t)}destroy(){this.$els.input.off(),delete this.$els.input,super.destroy()}get disabled(){return this._options.disabled}set disabled(t){return t=Boolean(t),this._options.disabled===t?this._options.disabled:(this.$el.toggleClass(this.classes.disabled,t),this._options.disabled=t)}get checked(){return this._options.checked}set checked(t){return this.setChecked(t)}}u.prototype.classes={item:"checkbox",checked:"checkbox_checked",disabled:"checkbox_disabled",type:"checkbox",input:'input[type="checkbox"]'}},92393:(t,e,i)=>{i.d(e,{m:()=>s.m});var s=i(32691)},65028:(t,e,i)=>{i.d(e,{W:()=>a});i(88674),i(41817);var s=i(8233),n=i(43241),r=i(12953);function o(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class a extends n.u{constructor(t){super(t),o(this,"vueInstance",null),this.init()}init(){if(!this.el)return;const t="community-mini-profile-anchor";this.el.addEventListener("mouseenter",(async e=>{const n=e.currentTarget;if(!n)return;let o=!0;if(r.core.ui.showedProfile&&(r.core.ui.emit("close-extra-menu"),r.core.ui.showedProfile.canHide=!0,r.core.ui.showedProfile.hide()),n.addEventListener("mouseleave",(()=>{var t;null===(t=this.vueInstance)||void 0===t||t.hide(),o=!1}),{once:!0}),this.vueInstance)return void this.vueInstance.show();let a=n.querySelector("."+t);a||(n.style.position="relative",a=document.createElement("div"),a.classList.add(t),n.prepend(a));try{var l;const{createApp:t}=await i(31885);await(0,s.y)();const e=t({communityId:Number(n.dataset.id),onDestroy:()=>{e.unmount(),this.vueInstance=null}});if(await(0,s.y)(),!o)return;this.vueInstance=e.mount(a),null===(l=this.vueInstance)||void 0===l||l.show(),r.core.ui.showedProfile=this.vueInstance}catch(u){console.log(u)}}))}destroy(){var t;super.destroy(),null===(t=this.vueInstance)||void 0===t||t.hide(),r.core.ui.showedProfile=null}}},23703:(t,e,i)=>{i.d(e,{nT:()=>_.nT,U:()=>_.U,dt:()=>a,Vd:()=>s.V,DC:()=>m,Z6:()=>n.Z,xI:()=>h});var s=i(23006),n=i(30521),r=(i(88674),i(74916),i(84220)),o=i(2889);class a extends s.V{constructor(t){super(t),this.minQueryLength=2,this.items.DataObject=r.Ys}_hasRequestCache(t){return o.yV.hasSearchCache(t)}async _requestItems(t,e){const i=this._options.isIgnoreList?{only_in_title:1}:{};return await o.yV.search(t,i)}}var l=i(63588),u=i(1262);class h extends s.V{constructor(t){super(t),this.items.DataObject=l.VV,this.minQueryLength=2,this.editorReplacer={prefix:"@",suffix:", ",whitelist:/([.+a-zа-яё0-9]*)/i}}_requestItems(t,e){return u.Users.search(t)}_hasRequestCache(t){return u.Users.hasSearchCache(t)}async setPredefinedUsersInStory(t,e){let i=await u.Users.predefinedInStory(t,e);this.predefinedItems.set(i),this.predefinedItems.items.forEach((t=>t.marks.set("isPredefined",!0)))}}i(85827),i(66992),i(33948);var c=i(36005),d=i(12950),p=i(26947);class m extends s.V{constructor(t){super(t),this.minQueryLength=t.minQueryLength||3,this.items.prepareData=t=>{switch(t.type){case"header":return new r.fP(t);case"separator":return new r.mX;case"user":return new l.VV(t);case"tag":return new r.U(t);case"community":return new r.Up(t);case"search":return new r.NY}}}render(){return this.isRendered||(super.render(),this.$el.addClass("dropdown-list_search")),this}_hasRequestCache(t){let e=p.h.getInstance("dropdownSearch");return e.has(t)&&!(e.get(t)instanceof Promise)}async _requestItems(t,e){let i=p.h.getInstance("dropdownSearch");if(i.has(t))return i.get(t);let s=d.cf.post("/ajax/search_actions.php",{query:t,action:"find_tags_users_communities"});return i.set(t,s.then((t=>{let e=[];if(!t.response.result)return[];let i=[t.data.tags.reverse().map((t=>(0,c.extend)(t,{type:"tag"}))).slice(-9),t.data.users.reverse().map((t=>(0,c.extend)(t,{type:"user"}))).slice(-9),t.data.communities.reverse().map((t=>(0,c.extend)(t,{type:"community",id:Number(t.id)}))).slice(-9)],s=i.length,n=0,r=Math.min(9,i.reduce(((t,e)=>t+e.length),0)),o=[];for(;r;){let t=i[n++].pop();n>=s&&(n=0),t&&(o.push(t),r--)}let a=(0,c.groupBy)(o,(t=>t.type));return a.tag&&(e.push({type:"header",title:"Теги"}),e.push(...a.tag)),a.user&&(e.length&&e.push({type:"separator"}),e.push({type:"header",title:"Пользователи"}),e.push(...a.user)),a.community&&(e.length&&e.push({type:"separator"}),e.push({type:"header",title:"Сообщества"}),e.push(...a.community)),e.unshift({type:"search"}),e})))}}i(31991);var _=i(16106);i(92125)},16526:(t,e,i)=>{i.d(e,{X:()=>n});i(66992),i(33948);var s=i(90477);class n extends s.Lo{constructor(t){super(t||{}),this.el=void 0,this.els={},this.on("current",this._updateCurrent),this.on(s.u$.REMOVE,this._onRemove)}render(){if(this.el)return this.el;let t;return t=this.el=document.createElement("div"),t.classList.add("dropdown-item"),t.setAttribute("data-id",this.id),this.el}_onRemove(){this.data.current=!1,this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)}_updateCurrent(t,e){this.el&&this.el.parentNode&&this.el.classList.toggle("dropdown-item_current",e)}destroy(...t){this.isDestroyed||this.marks.has("isPredefined")||(this._onRemove(),super.destroy(...t))}}n.prototype.defaults={label:"",info:"",current:!1}},84220:(t,e,i)=>{i.d(e,{X:()=>s.X,Ys:()=>o,Up:()=>c,fP:()=>h,NY:()=>d,mX:()=>u,U:()=>n});var s=i(16526);class n extends s.X{render(){if(this.el)return this.el;let t,e;return super.render(),t=this.els.label=document.createElement("div"),t.classList.add("dropdown-item__label"),t.textContent=this.data.name,this.el.appendChild(t),this.el.setAttribute("data-type","tag"),this.data.count&&(e=this.els.count=document.createElement("div"),e.classList.add("dropdown-item__info"),e.textContent=this.data.count,this.el.appendChild(e)),this.el}}n.prototype.fieldId="name",n.prototype.defaults={count:0,current:!1};var r=i(72044);class o extends s.X{render(){if(this.el)return this.el;let t=this.el=r.Zv.fragment((e=this.data,s="",Array.prototype.join,s+='<div class="community">\n\t<div class="community-avatar"><img src="'+(null==(i=e.avatar)?"":i)+'" alt=""></div>\n\t<div class="community__wrapper">\n\t\t<div class="community__title">\n\t\t\t',e.is_nsfw&&(s+='\n\t\t\t\t<span class="text-muted">[18+]</span>\n\t\t\t'),s+="\n\t\t\t<span>"+(null==(i=e.name)?"":i)+'</span>\n\t\t\t<a href="/community/'+(null==(i=e.link)?"":i)+'" target="_blank" data-id="'+(null==(i=e.id)?"":i)+'"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__new-tab_16"><use xlink:href="#icon--ui__new-tab_16"></use></svg></a>\n\t\t</div>\n\t\t<div class="community__information caption">\n\t\t\t<span>'+(null==(i=e.stories)?"":i)+"</span> • <span>"+(null==(i=e.subs)?"":i)+'</span>\n\t\t</div>\n\t</div>\n\t<button class="button button_success community__add" type="button">Добавить</button>\n</div>\n')).firstChild;var e,i,s;t.classList.add("dropdown-item"),t.setAttribute("data-id",this.id);const n=t.querySelector(".community__title a");return n&&n.addEventListener("click",(t=>{t.stopPropagation()})),this.el}}o.prototype.fieldId="id",o.prototype.defaults={avatar:"",name:"",current:!1,subs:"",stories:"",link:"",tags:void 0,is_nsfw:!1};i(74916);var a=i(63588);class l extends a.VV{render(){if(this.el)return this.el;super.render();let t=document.createElement("div");return t.classList.add("dropdown-item__info"),t.textContent=this.data.is_developer?"разработчик":"модератор",this.el.appendChild(t),this.el}search(t){return t.test(this.data.name)}}l.prototype.fieldId="id",l.prototype.defaults={avatar:"",avatar80:"",name:"",is_developer:!1,current:!1};class u extends s.X{render(){return this.el||(this.el=document.createElement("hr")),this.el}}u.prototype.isSeparator=!0,u.prototype.defaults={current:!1};class h extends s.X{render(){return this.el||(this.el=document.createElement("h4"),this.el.textContent=this.data.title||"Header"),this.el}}h.prototype.isSeparator=!0,h.prototype.defaults={current:!1,title:void 0};class c extends s.X{render(){if(this.el)return this.el;let t,e,i;return super.render(),t=document.createElement("div"),t.classList.add("dropdown-item__icon","community-avatar","community-avatar_small"),"string"==typeof this.data.avatar?(i=document.createElement("img"),i.setAttribute("src",this.data.avatar),t.appendChild(i)):t.classList.add("community-avatar__default"),this.el.appendChild(t),e=document.createElement("div"),e.classList.add("community__title","dropdown-item__label"),e.textContent=this.data.name,this.el.appendChild(e),this.el}search(t){return t.test(this.data.name)}}c.prototype.fieldId="id",c.prototype.defaults={avatar:"",name:"",current:!1};class d extends s.X{render(){if(this.el)return this.el;super.render();let t=document.createElement("i");return t.classList.add("caption"),t.innerHTML="Показать все результаты",this.el.appendChild(t),this.el}}d.prototype.defaults={current:!1}},23006:(t,e,i)=>{i.d(e,{V:()=>g});i(88674),i(74916),i(24603);var s=i(12953),n=i(63907),r=i(90477),o=i(3668),a=i(19477),l=i(61950),u=i(88358),h=i(95411),c=i(84220),d=i(96637),p=i(77416),m=i(36005);const _=i(19755);class g extends n.u1{constructor(t){super(),t instanceof o.Y1&&(t={target:t}),this.setOptions((0,m.defaults)(t||{},{autoPreselectFirst:!0,highlightResult:!0,useNumericIds:!0})),this.classes={empty:"dropdown-list__empty",items:"dropdown-list__items",item:{el:"dropdown-item"}},this._options.items=new r.qg,this._options.items.DataObject=c.X,this.listenTo(this._options.items,r.u$.UPDATE,this._onChangeItems),this._searchItemsDebounce=void 0,this._isPressed=!1,this.render()}render(){return this.isRendered||(this.$el=_(document.createElement("div")).addClass("dropdown-list"),this.$els.empty=_(document.createElement("div")).addClass(this.classes.empty).appendTo(this.$el),this.$els.items=_(document.createElement("div")).addClass(this.classes.items).on("mousedown",this._onMouseDown.bind(this)).on("mouseenter",".dropdown-item",this._onMouseEnterItem.bind(this)).on("click",".dropdown-item",this._onClickItem.bind(this)).appendTo(this.$el),this.maxHeight&&this.$els.items.css("maxHeight",this.maxHeight),this._popup=new u._({alignment:u.SE.START,direction:u.Lh.BOTTOM,autoCorrectPosition:!0,distance:-1,showArrow:!1,zIndex:this._options.dropwDownZindex}),this.listenTo(this._popup,n.eM.HIDDEN,this.hide),this.$parent=this._popup.content,super.render()),this}show(){return this.isShown||(this.emit(n.eM.MOUNTED),super.show(),this._popup&&(this.cancelTimeout("hide"),this._popup.show())),this}hide(){return this.isShown?(this.currentItemId=!1,this._popup?(this.emit(n.eM.HIDDEN),this._popup.hide(),this._clearQuery(),this._options.isShown=!1,this.timeout("hide",s.default.ui.css.transitionTimeDefault,(()=>{super.hide()}))):super.hide(),this):this}_onKeyUpDown(t,e){if(!this.items.size||!this.isShown)return!0;e&&(0,m.isFunction)(e.preventDefault)&&e.preventDefault();let i=this.currentItemId,s=10;do{if(i=t?this.items.nextId(i):this.items.prevId(i),!i||!this.items.get(i).isSeparator)break}while(s-- >0);return(0,m.isUndefined)(i)&&(i=t?this.items.firstId():this.items.lastId()),this.currentItemId=i,this.currentItemId&&this._scrollToItem(this.items.get(this.currentItemId).el),!1}_onKeyEnter(t){if(!this.items.size||!this.isShown)return!0;let e=(0,m.isUndefined)(this.currentItemId)?null:this.items.get(this.currentItemId);return e&&t&&((0,m.isFunction)(t.preventDefault)&&t.preventDefault(),(0,m.isFunction)(t.stopPropagation)&&t.stopPropagation()),s.default.logger.log("dropdown","select item by enter",this.currentItemId),this.emit(l.n.SELECT,e),this}_scrollToItem(t){let e=_(t),i=this.$els.items.height(),s=e.outerHeight(!0),n=this.$els.items.scrollTop()||0,r=e.offset().top-this.$els.items.offset().top+n,o=r-i+s;r+s>i+n?this.$els.items.scrollTop(o):r<n&&this.$els.items.scrollTop(r)}_onChangeItems(t,e){var i;(s.default.logger.log("dropdown","update items, size:",t.size),e&&e.inserted&&t.items.forEach((t=>this.$els.items.append(t.render()))),this._popup&&this._popup.$el&&this._popup.updatePosition(),t.size?this.autoPreselectFirst&&!this.items.has(this.currentItemId)&&(this.currentItemId=t.items[0].id):this.currentItemId=!1,this.emit(l.n.SET,t,e),this.$els.empty&&this.$els.empty.toggle(!t.size),this.highlightResult)&&(p.y.remove(this.el,"dropdown-item__highlight"),this.query&&this.query.length>0&&p.y.add(null===(i=this.$els.items.find(".dropdown-item"))||void 0===i?void 0:i.slice(1),this.queryRegExp,"dropdown-item__highlight"))}_onMouseDown(){this._isPressed=!0;const t=()=>{this._isPressed=!1,document.removeEventListener("mouseup",t,{capture:!0})};document.addEventListener("mouseup",t,{capture:!0})}_onMouseEnterItem(t){let e,i,s=t.currentTarget;s&&(e=s.getAttribute("data-id"),i=s.getAttribute("data-type")),this._options.useNumericIds&&"tag"!==i&&(0,m.isFinite)(e)&&(e=Number(e)),(0,m.isUndefined)(e)||(this.currentItemId=e)}_onClickItem(t){let e,i,n=t.currentTarget;n&&(e=n.getAttribute("data-id"),i=n.getAttribute("data-type")),this._options.useNumericIds&&"tag"!==i&&(0,m.isFinite)(e)&&(e=Number(e)),(0,m.isUndefined)(e)||(this.currentItemId=e,s.default.logger.log("dropdown","select item by click",this.currentItemId),this.emit(l.n.SELECT,(0,m.isUndefined)(this.currentItemId)?null:this.items.get(this.currentItemId),t))}async _searchItems(t,e){let i=await this._requestItems(t,e);this.query===t?(this.parseFilter&&(i=i.filter(this.parseFilter)),this.items.set(i),this.emit(l.n.SEARCH_END)):s.default.logger.log("dropdown","search ignore response for",t)}_hasRequestCache(t){return!1}async _requestItems(t,e){return[]}_searchPredefinedItems(t){let e=t?this.predefinedItems.items.filter((e=>e.search&&e.search(t))):this.predefinedItems.items;this.parseFilter&&(e=e.filter(this.parseFilter)),this.items.set(e),this.emit(l.n.SEARCH_END)}_clearQuery(){this._options.query=this._options.queryRegExp=void 0,this.emit(l.n.SEARCH_END)}get query(){return this._options.query}set query(t){let e=this._options.query;if("boolean"==typeof t)return this._clearQuery(),void this.items.clear();if(e===(t=t.trim().toLowerCase()))return;s.default.logger.log("suggestion","search",'"',t,'"'),this._options.query=t;let i=this._options.queryRegExp=new RegExp(d.Utils.escapeStringRegExp(t),"i");this.emit(l.n.SEARCH_START);let n=t.length,r=this.minQueryLength;this.strategy===l.$.PREDEFINED||n<r&&this.predefinedItems.size?this._searchPredefinedItems(n?i:void 0):n>=r?this._hasRequestCache(t)?this._searchItems(t,i):(this._searchItemsDebounce||(this._searchItemsDebounce=(0,m.debounce)(this._searchItems.bind(this),300)),this._searchItemsDebounce(t,i)):(this.emit(l.n.SEARCH_END),this.items.clear())}get queryRegExp(){return this._options.queryRegExp}get currentItemId(){return this._options.currentItemId}set currentItemId(t){let e=this.currentItemId,i=null;return t===e?e:(this.items.has(e)&&(this.items.get(e).data.current=!1),this.items.has(t)&&(i=this.items.get(t),i.data.current=!0),this.emit(l.n.CURRENT,i),this._options.currentItemId=t)}get items(){let t=this._options.items;return t||(t=this._options.items=new r.qg,t.DataObject=c.X,this.listenTo(t,r.u$.UPDATE,this._onChangeItems)),t}get predefinedItems(){let t=this._options.predefinedItems;return t||(t=this._options.predefinedItems=new r.qg(!1,this.items.DataObject)),t}get target(){return this._options.target}set target(t){return this.target!==t&&(this._popup&&(t instanceof o.Y1?(t instanceof a.Y?this._popup.distance=0:(this._popup.minWidth="100%",this._popup.maxWidth="300%"),this._popup.target=t.$el):this._popup.target=t),this._options.target=t)}get targetInput(){return this._options.targetInput}set targetInput(t){return this.targetInput===t?this.targetInput:(this._hotkeys=new h.SV(t),this._hotkeys.on("up",this._onKeyUpDown.bind(this,!1),{type:h.FM.KEYDOWN}),this._hotkeys.on("down",this._onKeyUpDown.bind(this,!0),{type:h.FM.KEYDOWN}),this._hotkeys.on("enter",this._onKeyEnter.bind(this),{type:h.FM.KEYDOWN}),this._options.targetInput=t)}get minQueryLength(){return this._options.minQueryLength||2}set minQueryLength(t){t=Math.max(0,Math.min(10,parseInt(t,10))),this._options.minQueryLength=t}get editorReplacer(){return this._options.editorReplacer}set editorReplacer(t){t instanceof a.l||(t=new a.l(t)),this._options.editorReplacer=t}get highlightResult(){return this._options.highlightResult}set highlightResult(t){this._options.highlightResult=Boolean(t)}get autoPreselectFirst(){return this._options.autoPreselectFirst}set autoPreselectFirst(t){this._options.autoPreselectFirst=Boolean(t)}get strategy(){return this._options.strategy||l.$.REQUEST}set strategy(t){this._options.strategy=l.$[t]||l.$.REQUEST}get parseFilter(){return this._options.parseFilter}set parseFilter(t){return(0,m.isFunction)(t)?this._options.parseFilter=t:this.parseFilter}get maxHeight(){return this._options.maxHeight}set maxHeight(t){(0,m.isString)(t)&&t.includes("px")&&(t=Math.max(50,parseInt(t,10)||0)),t=this._options.maxHeight=(0,m.isFinite)(t)&&t>0?t:"auto",this.isShown&&this.$els.items.css("max-height",t)}get isPressed(){return!0===this._isPressed}}},31991:(t,e,i)=>{i.d(e,{J:()=>o});i(88674),i(74916);var s=i(23006),n=i(89655),r=i(60320);i(19755);class o extends s.V{constructor(t){super(t),this.minQueryLength=2,this.items.DataObject=n.v,this.$els.empty.append('<div class="dropdown-item__empty-block"><p>К сожалению, по вашему запросу ничего не найдено</p><button tabindex="2" class="button button_success dropdown-item__empty-button">Запросить добавление</button></div>'),this.$els.empty.button=this.$els.empty.find(".dropdown-item__empty-button"),this.$el.append('<div class="dropdown-item__black-list">Данная информация находится в черном списке</div>'),this.$els.blacklist=this.$(".dropdown-item__black-list"),this.$els.blacklist.hide()}showBlacklist(){this.show(),this.$els.blacklist.show(),this.$els.items.hide()}_hasRequestCache(t){return r.F.hasSearchCache(t)}async _requestItems(t,e){return this.$els.items.show(),this.$els.blacklist.hide(),await r.F.search(t)}}},92125:(t,e,i)=>{i.d(e,{i:()=>o});i(66992),i(33948),i(74916),i(88674);var s=i(23006),n=i(93975),r=i(12953);class o extends s.V{constructor(t){super(t),this.items.DataObject=n.S,this.minQueryLength=1,this._initPredefinedItems()}prependItem(t){const e=this.predefinedItems.items.filter((t=>!t.data.isAddBtn)).map((t=>t.plainData));this._setPredefinedItems([t,...e])}_requestItems(t,e){const[i,...s]=this.predefinedItems.items,n=s.filter((t=>e.test(t.data.title)));return Promise.resolve(n.length<r.core.initParams.limitSeriesPerUser?[i,...n]:n)}async _initPredefinedItems(){this._setPredefinedItems(this._options.seriesList)}_setPredefinedItems(t){const e=t.length<r.core.initParams.limitSeriesPerUser?[{title:"Создать новую серию",isAddBtn:!0},...t]:t;this.predefinedItems.set(e),this.predefinedItems.items.forEach((t=>t.marks.set("isPredefined",!0)))}}},30521:(t,e,i)=>{i.d(e,{Z:()=>l});i(74916);var s=i(23006),n=i(84220),r=i(44361),o=i(19359),a=i(36005);class l extends s.V{constructor(t){super((0,a.defaults)(t,{useNumericIds:!1,filter:o.ll.ALL})),this.items.DataObject=n.U,this._tagsLineMode=!0===(t||{}).tagsLine}_hasRequestCache(t){return r.Hx.hasSearchCache(t,this.filter)}_requestItems(t,e){return this._tagsLineMode?r.Hx.searchTagsLine(t,this.filter===o.ll.SEARCH):r.Hx.search(t,this.filter)}get filter(){return this._options.filter}}},19477:(t,e,i)=>{i.d(e,{l:()=>f,Y:()=>v});i(66992),i(33948),i(88674),i(74916),i(15306);var s=i(12953),n=i(23265);const r=i(19755);let o=function(){var t=this;this.button=document.createElement("button"),this.button.className="medium-editor-action medium-editor-action-quote",this.button.innerHTML='<i class="fa fa-quote-left"></i>',this.button.onclick=function(e){t.onClick.call(t,e)},this.up=function(t,e){do{if(1===t.nodeType&&t.nodeName.toLowerCase()===e.toLowerCase())return t}while(t=t.parentNode);return!1}};o.prototype.onClick=function(){var t=window.getSelection().getRangeAt(0),e=this.up(t.startContainer,"blockquote"),i=r(e);if(e)i.parent().append(e.innerHTML),i.remove();else{let i=t.startContainer.parentNode,s=t.endContainer.parentNode,n=this.up(t.startContainer,"p"),r=this.up(t.endContainer,"p");"#text"===t.startContainer.nodeName&&n&&(i=n),"#text"===t.endContainer.nodeName&&r&&(s=r),0===t.endOffset&&s?t.setEndBefore(t.endContainer):s&&t.setEndAfter(s),i&&t.setStartBefore(i),e=document.createElement("blockquote"),t.surroundContents(e)}},o.prototype.getButton=function(){return this.button},o.prototype.checkState=function(t){this.up(t,"blockquote")&&this.button.classList.add("medium-editor-button-active")},o.prototype.coverAll=function(t){var e,i=[];for(e=0;e<this.rangeCount;e++){let t=this.getRangeAt(e);t.setStart(t.startContainer,0),t.setEnd(t.endContainer,t.endContainer.nodeValue.length),i.push(t)}for(t.removeAllRanges(),e=0;e<i.length;e++)t.addRange(i[e])};var a=i(95411),l=i(3668),u=i(61950);const h={name:"bold",action:"bold",aria:s.default.i18n("editor.buttons.bold"),tagNames:["b"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:s.default.icon("editor__bold")},c={name:"italic",action:"italic",aria:s.default.i18n("editor.buttons.italic"),tagNames:["i"],useQueryState:!1,contentDefault:s.default.icon("editor__italic")},d={name:"strikethrough",action:"strikethrough",aria:s.default.i18n("editor.buttons.strikethrough"),tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:s.default.icon("editor__strikethrough")},p={name:"anchor",action:"createLink",aria:s.default.i18n("editor.buttons.anchor"),tagNames:["a"],contentDefault:s.default.icon("editor__anchor")},m={name:"quote",action:"append-blockquote",aria:s.default.i18n("editor.buttons.quote"),tagNames:["blockquote"],contentDefault:s.default.icon("editor__quote")};var _=i(36005);const g=i(19755);class v extends l.Y1{constructor(t){super(t),(0,_.isUndefined)(this._options.canAddAnchor)&&(this._options.canAddAnchor=!0),this.$el&&this.render()}destroy(){this._editor.destroy(),super.destroy()}render(){if(this.isRendered)return this;super.render(),this.els.input.defaultValue=this.value;const t=this.canAddAnchor?[h,c,d,p,m]:[h,c,d,m];return this.validationRules=new Map,this._editor=new n.t(this.$els.input[0],{disableReturn:this.disableReturn,imageDragging:!1,toolbar:{buttons:t,isShowToolbar:!this.isToolbarButtonsDisabled},placeholder:{text:this.$els.input.data("placeholder")||s.core.i18n("editor.placeholder.editor"),hideOnClick:!0},extensions:{bq:new o},anchor:{placeholderText:s.core.i18n("editor.placeholder.anchor"),linkValidation:!0,targetCheckbox:!1},paste:{forcePlainText:!1,cleanPastedHTML:!0,allowPastedTags:["b","i","s","blockquote","br","p"]},keyboardCommands:{commands:[{command:function(){},key:"U",meta:!0,shift:!1,alt:!1}]}}),this._lastHeight=this.$els.input.height(),this._initialHeight=this._lastHeight,this._editor.subscribe("editableInput",this.onChange.bind(this)),this.$els.input.on("update",this.onChange.bind(this)),this._editor.subscribe("editablePaste",(()=>{this.$els.input.focus(),this.onChange()})),this.$els.input.on("update",(()=>this.timeout("update",50,(()=>{this._editor.trigger("blur",null,this.els.input)})))),this._hotkeys=new a.SV(this.$els.input),this._hotkeys.on(["left","right"],(async()=>{this.suggestion&&await this._searchSuggestion()})),this._hotkeys.on("backspace",this.onChange.bind(this)),this._hotkeys.on("escape",(()=>{this.suggestion&&this.suggestion.isShown?this.suggestion.hide():this.emit("escape")})),this._hotkeys.on("enter",(t=>{this.emit("enter",t)}),{type:a.FM.KEYDOWN,ignoreModifiers:!0}),this.submitHotkey&&this._hotkeys.on(this.submitHotkey,this._submit.bind(this),{type:a.FM.KEYDOWN}),this.newlineHotkey&&this._hotkeys.on(this.newlineHotkey,this._newline.bind(this),{type:a.FM.KEYDOWN}),this.suggestion&&(this.suggestion.targetInput=this.$els.input),this._saveCaretPositionThrottle=(0,_.throttle)(this.saveCaretPosition.bind(this),400),this}focus(){return this.$els.input.focus(),this._editor.trigger("focus",null,this.els.input),this.restoreCaretPosition(),this}blur(){return this.$els.input.blur(),this._editor.trigger("blur",null,this.els.input),this}turnOff(){return this.disabled=!0,this._hotkeys.off(),this._editor.destroy(),this._editor=new n.t(this.$els.input[0],{disableEditing:!0,disableReturn:!0,imageDragging:!1,paste:{forcePlainText:!1,cleanPastedHTML:!1},placeholder:{text:this.$els.input.data("placeholder")||s.core.i18n("editor.placeholder.editor"),hideOnClick:!1}}),this}onChange(t){this.value||(this.isFixedValue=!1);const e=this.$els.input.height();return this._lastHeight!==e&&(this._lastHeight=e,this.emit("resize",this._initialHeight===e)),super.onChange(t)}_searchSuggestion(){if(this.marks.has("skipNextSearch"))return void this.marks.delete("skipNextSearch");let t=window.getSelection();if(!t.rangeCount)return void(this.suggestion.query=!1);let e,i,n,r,o,a,l=t.getRangeAt(0),u=l.cloneRange();l.startContainer&&3===l.startContainer.nodeType?(u.selectNodeContents(l.startContainer),e=u.toString(),i=e.substring(0,l.startOffset),r=this.suggestion.editorReplacer.search(i),(0,_.isNull)(r)?this.suggestion.query=!1:(o=l.cloneRange(),o.setStart(l.startContainer,l.startOffset-(r.length+1)),a=o.getBoundingClientRect(),n={top:a.top+s.core.ui.scrollTop,left:a.left+s.core.ui.scrollLeft},o.detach(),this.suggestion.target={height:a.height,offset:n},this.suggestion.query=r)):this.suggestion.query=!1}_onSuggestionSelect(t){if((0,_.isNull)(t))return this.suggestion.hide(),this;this.isFocused?this.marks.set("skipNextSearch",!0):this.restoreCaretPosition();let e,i,s=window.getSelection(),n=s.getRangeAt(0),r=n.cloneRange();r.selectNodeContents(n.startContainer),e=r.toString();const[o,a]=this.suggestion.editorReplacer.replace(e.substring(0,n.startOffset),e.substring(n.startOffset),t.data.name);return n.selectNodeContents(n.startContainer),n.deleteContents(),i=document.createTextNode(o+a),n.insertNode(i),n.setStart(i,o.length),n.collapse(!0),s.removeAllRanges(),s.addRange(n),this.suggestion.hide(),this}saveCaretPosition(t=!1){if(document.activeElement!==this.els.input)return;let e=window.getSelection().getRangeAt(0).cloneRange();return t?(e.setStart(this.els.input,0),this._lastRange=e.toString().length):this._lastRange=e,this}restoreCaretPosition(){if((0,_.isUndefined)(this._lastRange))return this;let t=window.getSelection();if((0,_.isNumber)(this._lastRange)){let e=v.getTextNodeAtPosition(this.els.input,this._lastRange),i=new Range;t.removeAllRanges(),i.setStart(e.node,e.position),t.addRange(i)}else t.removeAllRanges(),t.addRange(this._lastRange);return this}static getTextNodeAtPosition(t,e){let i=null,s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,(t=>e>t.textContent.length?(e-=t.textContent.length,i=t,NodeFilter.FILTER_REJECT):NodeFilter.FILTER_ACCEPT),void 0).nextNode();return{node:s||t,position:s?e:0}}onKeyUp(t){super.onKeyUp(t),this._saveCaretPositionThrottle()}onBlur(t){return super.onBlur(t),this}onClick(t){this.els.input.contains(t.target)?this.saveCaretPosition():this.focus()}paste(t,e){return this._editor.pasteHTML(t,e),this.saveCaretPosition(),this}unwrapBlockquotes(){this.$els.input.get(0).querySelectorAll("p > blockquote").forEach((t=>{const e=t.parentNode;for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.remove()}))}_submit(t){if(t&&(0,_.isFunction)(t.preventDefault)&&t.preventDefault(),this.suggestion&&this.suggestion.isShown)return;let e=this.el.closest("form");e&&g(e).trigger("submit")}_newline(t){t&&(0,_.isFunction)(t.preventDefault)&&t.preventDefault(),document.execCommand("insertHTML",!1,"<br>")}get textContentLength(){return this.textContent.length}get isEmpty(){return!Boolean(this.textContentLength)}get value(){return this.$els.input.html()}set value(t){this.$els.input.empty().focus(),document.getSelection().collapse(this.els.input),this._editor.pasteHTML(t||"",{cleanPastedHTML:!1}),this.onChange()}get autoHeight(){return this._options.autoHeight}set autoHeight(t){return this._options.autoHeight=Boolean(t)}get suggestion(){return this._options.suggestion}set suggestion(t){return!1===t?(this.suggestion&&(this.stopListening(this.suggestion),this.suggestion.destroy()),void delete this._options.suggestion):(this._options.suggestion=t,t.target={width:10,height:10,offset:{left:0,top:0}},this.isRendered&&(t.targetInput=this.$els.input),this.listenTo(this,"input",this._searchSuggestion),this.listenTo(t,u.n.SET,this._onSuggestionChanged),this.listenTo(t,u.n.SELECT,this._onSuggestionSelect),t)}_onSuggestionChanged(t){t.size?this.suggestion.show():this.suggestion.hide()}get submitHotkey(){return this._options.submitHotkey}set submitHotkey(t){return this.submitHotkey===t||(0,_.isBoolean)(this.submitHotkey)&&(0,_.isBoolean)(t)?this.submitHotkey:(this._hotkeys&&(this.submitHotkey&&this._hotkeys.off(this.submitHotkey),(0,_.isBoolean)(t)||this._hotkeys.on(t,this._submit.bind(this),{type:a.FM.KEYDOWN})),this._options.submitHotkey=t)}get newlineHotkey(){return this._options.newlineHotkey}set newlineHotkey(t){return this.newlineHotkey===t||(0,_.isBoolean)(this.newlineHotkey)&&(0,_.isBoolean)(t)||"shift+enter"===t?this.newlineHotkey:(this._hotkeys&&(this.newlineHotkey&&this._hotkeys.off(this.newlineHotkey),(0,_.isString)(t)&&this._hotkeys.on(t,this._newline.bind(this),{type:a.FM.KEYDOWN})),this._options.newlineHotkey=t)}get canAddAnchor(){return this._options.canAddAnchor}set canAddAnchor(t){this._options.canAddAnchor!==(t=Boolean(t))&&(this._options.canAddAnchor=t)}get isToolbarButtonsDisabled(){return this._options.isToolbarButtonsDisabled}set isToolbarButtonsDisabled(t){this._options.isToolbarButtonsDisabled!==(t=Boolean(t))&&(this._options.isToolbarButtonsDisabled=t)}get isFixedValue(){return this._options.isFixedValue}set isFixedValue(t){t=Boolean(t),this._options.isFixedValue=t,this.$els.input.attr("contenteditable",String(!t)).toggleClass("input__input_fixed",t)}get disableReturn(){return this._options.disableReturn}set disableReturn(t){this._options.disableReturn!==(t=Boolean(t))&&(this._options.disableReturn=t)}}i(24603),i(92087);class f{constructor(t){(0,_.isObject)(t)||(t={}),this._options={},this.setOptions(t)}setOptions(t){return(0,_.isObject)(t)?((0,_.forEach)(t,((t,e)=>{this[e]=t})),this):this}get _searchRegExp(){return this._options.searchRegExp?this._options.searchRegExp:this._options.searchRegExp=new RegExp("\\B"+this.prefix+this.whitelist.source+"$",this.whitelist.flags)}get _postRegExp(){return this._options.postRegExp?this._options.postRegExp:this._options.postRegExp=new RegExp("^"+this.whitelist.source+",",this.whitelist.flags)}search(t){let e=this._searchRegExp.exec(t);return(0,_.isNull)(e)?null:e[1]}replace(t,e,i){let s=this.suffix;const n=this._searchRegExp.test(t);return n&&(e=e.replace(this._postRegExp,"")),this.suffix&&0===e.indexOf(this.suffix.charAt(0))&&(s=""),n?t=t.replace(this._searchRegExp,this.prefix+i+s):t+=" "+this.prefix+i+s,[t,e]}paste(t,e=""){return e+this.prefix+t+this.suffix}get whitelist(){return this._options.whitelist}set whitelist(t){return this._options.whitelist=t}get prefix(){return this._options.prefix||""}set prefix(t){return this._options.prefix=String(t)}get suffix(){return this._options.suffix||""}set suffix(t){return this._options.suffix=String(t)}}},8251:(t,e,i)=>{i.d(e,{x:()=>b});i(66992),i(33948),i(88674),i(74916),i(15306);var s=i(63907),n=i(92393),r=i(78060),o=i(32617),a=i(81772),l=i(81605);class u extends s.u1{constructor(t){super(t),this.$els={button:this.$(".form-group__button"),body:this.$(".form-group__body")};let e="form-group_open";this.setOptions({openedClass:e,opened:this.$el.hasClass(e)}),this.$els.button.on("click",(()=>this.toggleGroup(null,!0)))}open(t){this.isOpened||(this.isOpened=!0,t&&setTimeout((()=>{this.$el.find(".input:first input").trigger("focus")}),0))}close(){this.isOpened=!1}toggleGroup(t,e){(t="boolean"==typeof t?t:!this.isOpened)?this.open(e):this.close()}get isOpened(){return this._options.opened}set isOpened(t){let e=Boolean(t);this._options.opened=e,this.$el.toggleClass(this._options.openedClass,e)}}var h=i(3668),c=i(95411),d=i(36005);class p extends h.Y1{_createWrapper(){return super._createWrapper(),this._debounceEnter=(0,d.debounce)(this._onEnter.bind(this),10),this._isClicked=!1,this.$els.input.attr("type","text").on("click",(t=>{this._isClicked=!0,this._debounceEnter(t)})).on("paste",(t=>t.preventDefault())).on("focus",this._debounceEnter).on("keypress",this._onKeyPress.bind(this)),this._selectionGroup=0,this}render(){return this.isRendered||(super.render(),this._hotkeys=new c.SV(this.$els.input),this._hotkeys.on({tab:t=>{0===this._selectionGroup&&(t.preventDefault(),this._selectGroup(1))},up:t=>{t.preventDefault();let[e,i]=this.els.input.value.split(":").map((t=>Number(t)));0===this._selectionGroup?e=e>22?0:e+1:i=i>58?0:i+1,this._result(e,i)},down:t=>{t.preventDefault();let[e,i]=this.els.input.value.split(":").map((t=>Number(t)));0===this._selectionGroup?e=e<1?23:e-1:i=i<1?59:i-1,this._result(e,i)},"right left enter":t=>{this._selectGroup(0===this._selectionGroup?1:0),t.preventDefault()},backspace:t=>{let[e,i]=this.els.input.value.split(":").map(((t,e)=>this._selectionGroup===e?t[0]:t));this._result(e,i),t.preventDefault()}},{type:c.FM.KEYDOWN})),this}_result(t,e,i){this.els.input.value=[t,e].map((t=>String(t).length<2?"0"+t:t)).join(":"),this._selectGroup(i||this._selectionGroup),this.onChange()}_onEnter(t){t.preventDefault();let e=Number(this.els.input.selectionEnd);this._selectGroup(e<3||!this._isClicked&&5===e?0:1),this._isClicked=!1}_selectGroup(t){this._selectionGroup=t;let e=this.els.input.value.indexOf(":");this.els.input.setSelectionRange(...0===t?[0,e]:[e+1,e+3])}_onKeyPress(t){if("Tab"!==t.key&&t.preventDefault(),/\d/.test(t.key)){let[e,i]=this.$els.input.val().split(":").map(((e,i)=>{if(this._selectionGroup===i){let s=Number(e+t.key);return 0===i&&s>23||1===i&&s>59?t.key:s}return e}));this._result(e,i)}}}const m=i(19755),_=h.op.escape(),g=/^(?:submit|button|image|reset|file)$/i,v=/^(?:input|select|textarea|keygen)/i,f=/^(?:checkbox|radio)$/i,y=/\r?\n/g;class b extends s.u1{constructor(t){super(t),this._elements=new Set,this.el&&(this.show(),this._initElements())}getUIElement(t,e){if(!t&&!e)return null;let i="input";t&&(i+=`[name="${t}"]`),e&&(i+=`[value="${e}"]`);const n=this.$(i);return n.length?s.u1.getUIElement(n.eq(0).parent()):null}_initElements(){return(0,d.forEach)(this.$('input[type="checkbox"]:not(.pkb-switch__checkbox)'),(t=>{let e=new n.m(t);this.listenTo(e,"change",(()=>this._onChange(e)))})),(0,d.forEach)(this.$('input[type="radio"]'),(t=>{let e=new o.Z(t);this.listenTo(e,"change",(()=>this._onChange(e)))})),(0,d.forEach)(this.$('input[type="time"]'),(t=>{let e=new p(t.closest(".input")||t);e.show(),this.listenTo(e,"change",(()=>this._onChange(e)))})),(0,d.forEach)(this.$('select[data-role="slider"]'),(t=>{let e=new a.T(t);this.listenTo(e,"change",(()=>this._onChange(e)))})),(0,d.forEach)(this.$('select[data-role="listbox"]'),(t=>{let e=new l.C(t);this.listenTo(e,"change",(()=>this._onChange(e)))})),(0,d.forEach)(this.$('input[type="hidden"]'),(t=>{m(t).on("change",(()=>this._onChange(t)))})),(0,d.forEach)(this.$(".form-group"),(t=>{new u(t)})),this}render(){if(this.isRendered)return this;if(this.$el){if(!this.$el.is("form")){let t=this.$el&&this.$el.find("form");t&&t.length>0?this.$el=t.eq(0):this.$el=m(document.createElement("form")).insertBefore(this.$el).append(this.$el)}}else this.$el=m(document.createElement("form")).addClass("form");return this.$el.on({reset:this._onReset.bind(this),submit:this._onSubmit.bind(this)}),super.render(),this}add(t){return this.listenTo(t,"change",this._onChange),this.listenTo(t,"destroy",this._onDestroy),this._elements.add(t),this}_onSubmit(t){this.emit("submit",t,this)}_onChange(t){this.emit("change",this,t)}_onDestroy(t){this._elements.has(t)&&this._elements.delete(t)}submit(){return this.$el.trigger("submit"),this}async checkValidity(t){null==t||t.returnErrorType;for(let e of this._elements){if(!e||e.$el.is(":hidden")||!(0,d.isFunction)(e.checkValidity))continue;const i=await e.checkValidity(t);if(!i||(0,d.isBoolean)(null==i?void 0:i.isValid)&&(null==i||!i.isValid))return i}return!0}serialize(){let t=new Map,e=new Map,i={};return(0,d.forEach)(this.$el.find('[contenteditable="true"]'),(e=>{let i,s=e.getAttribute("name")||e.getAttribute("data-name")||e.id;s&&(i=t.get(s),i||t.set(s,i=[]),i.push(e))})),(0,d.forEach)(this.$el.prop("elements"),(e=>{let i=m(e),s=e.name||e.id||i.data("name"),n=String(e.type).toLowerCase();if(s&&(!i.is(":disabled")||e.checked)&&v.test(e.nodeName)&&!g.test(n)&&(i.data("to-boolean")||e.checked||!f.test(n)||"true"===i.val()||"false"===i.val()&&"checkbox"===n)){let i=t.get(s);i||t.set(s,i=[]),i.push(e)}})),t.forEach(((t,i)=>{let n=t.length<2;(0,d.forEach)(t,(t=>{let o,a=m(t),l=s.u1.closestUIElement(t),u=l instanceof r.Y?l.value:"true"===t.contentEditable?a.html():a.val();if(f.test(t.type)&&(n&&a.data("to-boolean")?u=t.checked:"true"===u?u=t.checked?1:0:"false"===u&&(u=t.checked?0:1)),(0,d.isNull)(u))return!1;o=e.get(i),o||e.set(i,o=[]),(0,d.isArray)(u)?o.concat((0,d.map)(u,(t=>(0,d.isFinite)(t)?parseInt(t,10):t.replace(y,"\r\n")))):o.push("text"!==t.type&&(0,d.isFinite)(u)?parseInt(u,10):(0,d.isString)(u)?u.replace(y,"\r\n"):u)}))})),e.forEach(((t,e)=>{if(0===t.length)return!1;1===t.length?i[e]=t[0]:i[e]=t})),e.clear(),t.clear(),i}deserialize(t){let e=document.createEvent("Events");return e.initEvent("update",!1,!0),(0,d.forEach)(t,((t,i)=>{let s,n=this.el.querySelectorAll(`[name="${i}"],[id="${i}"]`);n.length&&(s=n[0],s.matches('input[type="radio"]')?n.forEach((i=>{i.checked=i.getAttribute("value")===String(t),i.dispatchEvent(e)})):(s.matches("div[contenteditable]")?s.innerHTML=_(t):s.matches('input[type="checkbox"]')?(0,d.isBoolean)(t)?s.checked=t:"true"===s.value?s.checked=1===t||"1"===t:s.checked=String(t)===s.value:s.value=t,s.dispatchEvent(e)))})),this}saveAsDefault(){return this.el.querySelectorAll("input, textarea").forEach((t=>{t.matches('input[type="radio"]')||t.matches('input[type="checkbox"]')?t.defaultChecked=t.checked:t.defaultValue=t.value})),this.el.querySelectorAll("select > option").forEach((t=>{t.defaultSelected=t.selected})),this.el.querySelectorAll('div[contenteditable="true"]').forEach((t=>{t.defaultValue=t.innerHTML})),this}_onReset(){this.timeout("update",50,(()=>{this.el.querySelectorAll("select, input, textarea").forEach((t=>{m(t).trigger("update")})),this.el.querySelectorAll('div[contenteditable="true"]').forEach((t=>{(0,d.isUndefined)(t.defaultValue)||m(t).html(t.defaultValue).trigger("update")}))}))}reset(){return this.$el.trigger("reset"),this}}},85823:(t,e,i)=>{i.d(e,{x:()=>s.x});var s=i(8251)},53619:(t,e,i)=>{i.d(e,{p:()=>o});i(41817);var s=i(29069);function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function r(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class o extends s.i{constructor(t={}){super(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){r(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({startupAnimationDuration:100,skipImageStartupAnim:!0,showImageBackground:!0,showScrollArrows:!0,closeByClick:!0,useHistoryState:!1,showLargeImageLoader:!0,showHelpButton:!0},t))}}},78060:(t,e,i)=>{i.d(e,{Y:()=>h});var s=i(12953),n=(i(88358),i(81042)),r=i(95374),o=i(61950),a=i(36005),l=i(55474);const u=i(19755);class h extends l.u3{constructor(t){return super(t),this._lastValue=void 0,this._validationHint=this._validationHint||void 0,this._disabledHint=this._disabledHint||void 0,this._autocorrect=Boolean(t.autocorrect),this}render(){this.el||(this.el=document.createElement("input")),this.$els={input:this.$(".input__input"),box:this.$(".input__box"),error:u(document.createElement("div")).addClass("popup__hint"),clearButton:void 0};const t=document.createElement("span");return t.className="input__validation-message",this.els={input:void 0,validationErrorElement:t},this._validationHint&&(this._validationHint.content=this.$els.error),this._createWrapper(),this.addClearButton&&this._createClearButton(),this.$els.input.on({focus:this.onFocus.bind(this),blur:this.onBlur.bind(this),change:(0,a.throttle)(this.onChange.bind(this),40),keyup:this.onKeyUp.bind(this),keydown:this.onKeyDown.bind(this),paste:this.onPaste.bind(this),cut:this.onCut.bind(this)}),this._autocorrect&&this.$el.on("input",(t=>{t.target.value=this.sanitize(t.target.value)})),s.default.ua.mac&&"password"===this.$els.input.attr("type")&&(this.$els.input.attr("type","text"),this.$els.input.addClass("input__input_apple")),this.$el.on("click",this.onClick.bind(this)),this.validationThrottle=(0,a.debounce)(this.checkValidity.bind(this),500),this.validationHint&&this._createValidationHint().setOptions(this.validationHint),this.disabledMessage&&this.disabled&&this._createDisabledHint(),this.toggleClearButton(),super.render(),this}onBlur(t){return this.timeout("onBlur",150,(()=>{this.removeState(n.d.FOCUS),this.emit("blur",t),this.validationRules&&this.validationEvent===n.k.BLUR&&this._isInputVisible()&&this.checkValidity(),this.suggestion&&!this.suggestion.isPressed&&this.timeout("suggestionHide",150,(()=>{this.suggestion.hide()}))})),this}onKeyUp(t){this.emit("keyup",t);let e=this.value;return this.toggleClearButton(),this._lastValue===e||(this._lastValue=e,t&&this.emit("input",e,t),this.validationRules&&this.validationEvent===n.k.KEYUP&&this.validationThrottle()),this}onKeyDown(t){this.emit("keydown",t)}_createClearButton(){return this.$els.clearButton?this.$els.clearButton:this.$els.clearButton=u('\n\t\t\t\t<span class="input__clear">\n\t\t\t\t\t<span class="input__clear-inner">\n\t\t\t\t\t\t<span class="input__clear-background"></span>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t').appendTo(this.$els.box).click((()=>{this.emit("clear"),this.value="",this.focus()}))}_createValidationHint(){return super._createValidationHint(!1)}transferValidationRules(t){let e=(t.prop("type")||"").toLowerCase(),i=t.prop("required"),s=Math.max(0,t.attr("minlength")||0),n=Math.max(0,t.attr("maxlength")||0),o=t.prop("min"),a=t.prop("max");"email"===e&&this.validationRules.set("validation-rules.email",r.c.email(i)),i&&this.validationRules.set("validation-rules.required",r.c.required()),s&&this.validationRules.set(`^validation-rules.too-short('${s}')`,r.c.isLength(s)),n&&this.validationRules.set(`^validation-rules.too-long('${n}')`,r.c.isLength(0,n)),o&&this.validationRules.set(`^validation-rules.min('${o}')`,r.c.min(o,!i)),a&&this.validationRules.set(`^validation-rules.max('${a}')`,r.c.max(a,!i))}_onSuggestionChanged(t,e){this.progress=!1,t.size?this.suggestion.show():this.suggestion.hide()}_onSuggestionSelect(t,e){return this.progress=!1,this.emit(o.n.SELECT,t,e),this.suggestion.hide(),this.focus(),this}_isInputVisible(){let t=this.$els.input[0];for(;t!==document.body;){if(!t||"none"===t.style.display)return!1;t=t.parentElement}return!0}get suggestion(){return this._options.suggestion}set suggestion(t){let e=this._options.suggestion;e!==t&&(this._options.suggestion=t,t?(t.target=this,t.targetInput=this.render().$els.input,this.listenTo(this,"input",(t=>this.suggestion.query=t)),this.listenTo(t,o.n.SET,this._onSuggestionChanged),this.listenTo(t,o.n.SELECT,this._onSuggestionSelect),this.listenTo(t,o.n.SEARCH_START,(()=>this.progress=!0)),this.listenTo(t,o.n.SEARCH_END,(()=>this.progress=!1))):e&&(this.stopListening(e),e.destroy()))}}},81042:(t,e,i)=>{i.d(e,{d:()=>s.d,k:()=>s.k});var s=i(63371)},3668:(t,e,i)=>{i.d(e,{km:()=>u.k,op:()=>s.o,u3:()=>l,Y1:()=>r.Y,K1:()=>h.K,cX:()=>n.c});var s=i(72346),n=i(95374),r=i(78060),o=i(95411),a=i(36005);class l extends r.Y{constructor(t){super(t),(0,a.isUndefined)(this.addClearButton)&&(this.addClearButton=!0),this.render()}render(){return this.isRendered||(super.render(),this._hotkeys=new o.SV(this.$els.input),this._hotkeys.on("escape",(()=>{this.suggestion&&this.suggestion.isShown?this.suggestion.hide():this.value.length>0?this.value="":this.$els.input.blur()})),this._hotkeys.on("enter",(t=>{this.emit("enter",t)}),{type:o.FM.KEYDOWN})),this}}var u=i(81042),h=i(21906)},21906:(t,e,i)=>{i.d(e,{K:()=>_});i(88674),i(66992),i(33948);var s=i(95411),n=i(96637),r=i(78060),o=i(23703),a=i(81042),l=i(90477),u=i(72044),h=i(95374),c=i(72346),d=i(17393),p=i(36005);const m=i(19755);class _ extends r.Y{constructor(t){super(t),u.Zv.isHTMLElement(t)&&(t=m(t)),t instanceof m&&(t={$el:t.eq(0)}),(0,p.isObject)(t)&&this.setOptions((0,p.defaults)(t,{validationHint:!0,validationEvent:a.k.BLUR,createOnBlur:!0,softLimitsValidation:!1})),this._options.items=new l.qg(!1,o.U),this.sanitizerRules.add(c.o.toTag()).add(c.o.trim()).add(c.o.singleSpace()),this.classes={item:"tag",itemActive:"tag_active"},this.render()}render(){if(this.isRendered)return this;super.render(),this.placeholder=this.placeholder||this.$els.input.data("placeholder")||this.$els.input.prop("placeholder"),this.$els.input.hide(),this.$els.inputCarriage=m(document.createElement("input")).addClass("input__input input__input_carriage").attr("type","text").prop("placeholder",this.$els.input.prop("placeholder")||"Введите теги").insertAfter(this.$els.input).on({focus:this.onFocus.bind(this),blur:this.onBlur.bind(this),keyup:this.onKeyUp.bind(this),input:this._autoWidthCarriage.bind(this),paste:this._onPaste.bind(this)}),this.$els.input.insertAfter(this.$els.box);let t=this.$els.input.attr("id");t&&(this.$els.inputCarriage.attr("id",t),this.$els.input.removeAttr("id"));let e=this.$els.input.attr("minlength"),i=this.$els.input.attr("maxlength");e&&this.$els.inputCarriage.attr("minlength",e),i&&this.$els.inputCarriage.attr("maxlength",i);let s=Number(this.$el.attr("data-min")||0),n=Number(this.$el.attr("data-max")||0);return s&&(this.minTags=s),n&&(this.maxTags=n),this._togglePlaceholder(0===this.$(`.${this.classes.item}`).length),this._attachHotkeys(),(0,p.forEach)(this.$(`.${this.classes.item}`),(t=>{this.items.add({name:t.textContent})})),this.value=this.serialize(),this}transferValidationRules(t){let e=this._options.validationRules,i=Number(t.attr("data-min")||0),s=Number(t.attr("data-max")||0);this._options.validationRules=void 0,super.transferValidationRules(t),this._options.inputValidationRules=this._options.validationRules||[],this._options.validationRules=e,i&&(this.minTags=i),s&&(this.maxTags=s)}serialize(){return this.items.items.map((t=>t.id)).join(",")}deserialize(t){(0,p.isString)(t)&&t.split(",").map((t=>this.createItem(t)))}clear(){this.items.clear(),this.$(`.${this.classes.item}`).remove(),this.value="",this.inputValue="",this._togglePlaceholder(!0)}onBlur(t){return this.suggestion&&this.suggestion.isPressed||this.timeout("onBlur",150,(()=>{this.$(`.${this.classes.itemActive}`).toggleClass(this.classes.itemActive);let e=this.inputValue;this.createOnBlur&&e.length&&(this.checkValidity({inputValue:e,inputRules:this.inputValidationRules,changeValidityState:!1}).then((t=>{t&&this.createItem(e)})),this.inputValue=""),super.onBlur(t),this.removeState(a.d.FOCUS),this.emit("blur"),this.validationRules&&this.validationEvent===a.k.BLUR&&this.checkValidity(),this.suggestion&&this.suggestion.isShown&&this.timeout("suggestionHide",150,(()=>{this.suggestion.hide()}))})),this}_onPaste(){this.timeout("paste",0,(async()=>{let t=this.$els.inputCarriage.val().split(",").map((t=>this.sanitize(t))),e=t.pop()||"";for(let i of t)await this.checkValidity({inputValue:i,inputRules:this.inputValidationRules,changeValidityState:!1})&&this.createItem(i);this.inputValue=e}))}onClick(t){t.target.matches(`.${this.classes.item}`)?(this.$(`.${this.classes.itemActive}`).removeClass(this.classes.itemActive),t.target.classList.toggle(this.classes.itemActive),this.isLocked=!0):this.isLocked=this._isMaximumTags(),super.onClick(t)}_attachHotkeys(){return this._hotkeys=new s.SV(this.$els.inputCarriage),this._hotkeys.on("escape",(()=>{this.suggestion&&this.suggestion.isShown?this.suggestion.hide():this.inputValue.length>0?this.inputValue="":this.isLocked&&!this._isMaximumTags()?this.isLocked=!1:this.blur()})),this._hotkeys.on(",",(async t=>{if(this.maxTags>0&&this.filteredItems.length>=this.maxTags&&!this._checkSoftLimitsValidation())return!1;let e=this.$els.inputCarriage.val(),i=this._getCaretPosition(),s=this.sanitize(e.substr(0,i)),n=this.sanitize(e.substr(i));if(t.preventDefault(),0===i)return;await this.checkValidity({inputValue:s,inputRules:this.inputValidationRules})&&this.createItem(s)?(this.inputValue=n,this.$els.inputCarriage.get(0).setSelectionRange(0,0)):this.inputValue=s+n}),{type:s.FM.KEYPRESS}),this._hotkeys.on("backspace",(()=>{let t=this._getCaretPosition();0!==this.$els.inputCarriage.val().length&&0!==t||this.removeItemCarriage(!0)}),{type:s.FM.KEYDOWN}),this._hotkeys.on("enter",(async t=>{if(t.preventDefault(),this.suggestion&&this.suggestion.isShown)return!1;if(this.maxTags>0&&this.filteredItems.length>=this.maxTags&&!this._checkSoftLimitsValidation())return!1;let e=this.inputValue;await this.checkValidity({inputValue:e,inputRules:this.inputValidationRules})&&this.createItem(e)&&(this.inputValue="")}),{type:s.FM.KEYDOWN}),this._hotkeys.on("left",(()=>{if(0!==this.$els.inputCarriage.val().length||!this.items.size)return;let t=this.$(`.${this.classes.itemActive}`);if(t.length){let e=t.prev();e.length&&!e.is(t)&&(t.removeClass(this.classes.itemActive),e.addClass(this.classes.itemActive))}else this.isLocked=!0})),this._hotkeys.on("right",(()=>{if(0!==this.$els.inputCarriage.val().length||!this.items.size)return;let t=this.$(`.${this.classes.itemActive}`);if(!t.length)return;let e=t.next(`.${this.classes.item}`);e.length&&!e.is(t)?(t.removeClass(this.classes.itemActive),e.addClass(this.classes.itemActive)):this.isLocked=this._isMaximumTags()})),this._hotkeys.on("delete",(()=>{let t=this._getCaretPosition(),e=this.$els.inputCarriage.val().length;0!==e&&t!==e||this.removeItemCarriage(!1)}),{type:s.FM.KEYDOWN}),this}removeItemCarriage(t=!0){let e=this.$els.inputCarriage[t?"prev":"next"](),i=this.$(`.${this.classes.itemActive}`);return i.length?((0,p.forEach)(i,(t=>this.items.remove(t.textContent))),i.remove()):e&&e.is(`.${this.classes.item}`)&&((0,p.forEach)(e,(t=>this.items.remove(t.textContent))),e.remove()),this._togglePlaceholder(!Boolean(this.items.size)),this.isLocked=this._isMaximumTags(),this.value=this.serialize(),this}createItem(t,e){if(this.maxTags>0&&this.filteredItems.length>=this.maxTags&&!this._checkSoftLimitsValidation())return!1;let i=e||0,s=(t=this.sanitize(t)).toLowerCase();if(!t||0===t.length)return!1;if((0,p.some)(this.items.items,(t=>t.id.toLowerCase()===s)))return!0;this.items.add({name:t,count:i});const r=m(document.createElement("span")).addClass(this.classes.item).text(t).insertBefore(this.$els.inputCarriage);return 0!==i&&r.addClass("hint").attr("aria-label",`${i} ${n.Utils.pluralNounRU(i,["пост","поста","постов"])}`),this.emit("new-tag"),this._togglePlaceholder(!1),this.isLocked=this._isMaximumTags(),this.value=this.serialize(),this.suggestion&&this.suggestion.hide(),this._checkSoftLimitsValidation(),!0}_isMaximumTags(){return this.softLimitsValidation?0!==this.maxTags&&this.filteredItems.length>=20:0!==this.maxTags&&this.filteredItems.length>=this.maxTags}onKeyUp(t){if(this.isLocked)this.$els.inputCarriage.val("");else{let e=this.inputValue;if(this._lastValue===e)return this;this._lastValue=e,this.validationRules&&this.validationEvent===a.k.KEYUP&&this.validationThrottle(),this._checkSoftLimitsValidation(),t&&this.emit("input",e,t)}return this}_togglePlaceholder(t){return t=(0,p.isBoolean)(t)?t:!Boolean(this.$els.input.prop("placeholder")),this.$els.inputCarriage.prop("placeholder",t?this.placeholder:""),this._autoWidthCarriage(),this}focus(){return this.$els.inputCarriage.focus(),this}blur(){return this.$els.inputCarriage.blur(),this}_getCaretPosition(){let t,e,i=this.$els.inputCarriage.get(0);return"selectionStart"in i?i.selectionEnd:(t=document.selection.createRange(),e=t.text.length,t.moveStart("character",-i.value.length),Math.abs(t.text.length-e))}_autoWidthCarriage(){this.$els.bufferInput||(this.$els.bufferInput=m(document.createElement("div")).addClass("input-buffer").appendTo(document.body));let t=this.$els.inputCarriage.val()||this.$els.inputCarriage.prop("placeholder");return this.$els.bufferInput.text(t),this.$els.inputCarriage.width(this.$els.bufferInput.width()+10),this}_parseFilter(t){return!this.items.has(t.name)}get isLocked(){return this._options.isLocked}set isLocked(t){this._options.isLocked!==(t=Boolean(t))&&(this._options.isLocked=t,this.isRendered&&(t&&!this.$(`.${this.classes.itemActive}`).length?this.$(`.${this.classes.item}:last`).addClass(this.classes.itemActive):t||this.$(`.${this.classes.itemActive}`).removeClass(this.classes.itemActive),this.$els.inputCarriage.css({position:t?"absolute":"relative",left:t?-1e3:0})))}get inputValidationRules(){return this._options.inputValidationRules}get inputValue(){let t=this.$els.inputCarriage.val();for(let e of this.sanitizerRules)t=e(t);return t}set inputValue(t){this._currentQuery=t,this.$els&&this.$els.inputCarriage&&(this.$els.inputCarriage.val(t),this.onKeyUp(),this._autoWidthCarriage())}get placeholder(){return this._options.placeholder}set placeholder(t){this._options.placeholder=String(t)}get suggestion(){return this._options.suggestion}set suggestion(t){let e=this._options.suggestion;e!==t&&(this._options.suggestion=t,t?(t.target=this,t.targetInput=this.render().$els.inputCarriage,t.parseFilter=this._parseFilter.bind(this),this.listenTo(this,"input",(e=>t.query=e)),this.listenTo(t,o.nT.SET,this._onSuggestionChanged),this.listenTo(t,o.nT.SELECT,this._onSuggestionSelect)):e&&(this.stopListening(e),e.destroy()))}_onSuggestionSelect(t){return t&&(this.inputValue="",this.createItem(t.id,t.plainData.count)),this.suggestion.hide(),this.focus(),this}_onSuggestionChanged(t){this.progress=!1,t.size?this.suggestion.show():this.suggestion.hide()}get items(){return this._options.items}get filteredItems(){return this._options.items.items.map((t=>t.id)).filter(h.c.filterBuiltInTags())}get minTags(){return this._options.minTags}set minTags(t){let e=this._options.minTags;t=Math.max(0,parseInt(t,10)),isNaN(t)||e===t||(this._options.minTags=t,e&&this.validationRules.delete(`^validation-rules.min-tags('${e}')`),t&&this.validationRules.set(`^validation-rules.min-tags('${t}')`,{validationFunction:h.c.minTags(t),analyticsType:d.t[d.A.ERROR_TAG_MIN_TAG]}))}get maxTags(){return this._options.maxTags}set maxTags(t){let e=this._options.maxTags;t=Math.max(0,parseInt(t,10)),isNaN(t)||e===t||(this._options.maxTags=t,e&&this.validationRules.delete(`^validation-rules.max-tags('${e}')`),t&&this.validationRules.set(`^validation-rules.max-tags('${t}')`,{validationFunction:h.c.maxTags(t),analyticsType:"error_tag_max-tags"}))}get createOnBlur(){return this._options.createOnBlur}set createOnBlur(t){this._options.createOnBlur!==(t=Boolean(t))&&(this._options.createOnBlur=t)}get softLimitsValidation(){return this._options.softLimitsValidation}set softLimitsValidation(t){this._options.softLimitsValidation!==t&&(this._options.softLimitsValidation=t)}_checkSoftLimitsValidation(){if(!this.softLimitsValidation)return!1;let t=this.filteredItems.length;return this.maxTags>0&&(t>this.maxTags||t===this.maxTags&&""!==this.inputValue)?(this.setCustomValidity(`^validation-rules.max-tags('${this.maxTags}')`,!0),!1):(this.setCustomValidity(),!0)}}},68016:(t,e,i)=>{i.d(e,{C2:()=>u,YX:()=>C,EZ:()=>f,_d:()=>E});i(66992),i(33948);var s=i(23703),n=i(3668),r=i(63907),o=i(36005);class a extends r.u1{constructor(t){super(t),this.setOptions(t),this.items=t.items||[],this.$el.addClass("items-list"),this.$els.input=this.$(".input"),this.render(),this.on("change",(()=>this._updateInputState()))}addItem(t,e=!1){}removeItem(t,e=!1){if("string"==typeof t&&0===(t=this.$el.find(`.items-list__item[data-value="${t}"]`).eq(0)).length)return;const i=[...this.items];t.remove();let s=String(t.data("value"));this.items=this.items.filter((t=>t.hasOwnProperty("name")?t.name!==s:t!==s)),e||this.emit("change",this.items,i),(0,o.defer)((()=>{t.parent().find(".input input").focus()}))}_updateInputState(){const t=this.items.length<this._options.maxItems;this.$els.input.toggle(t),this.$els.button&&this.$els.button.toggle(t)}}const l=i(19755);class u extends a{constructor(t){super(t),this.setOptions((0,o.defaults)({maxItems:t.maxItems,useWideButtons:t.useWideButtons,isIgnoreList:t.isIgnoreList},{maxItems:1,useWideButtons:!1,isIgnoreList:!1})),this._renderCommunityInput()}_renderCommunityInput(){this.items.forEach((t=>{this.addItem(t,!0)}));let t=new n.u3(this.$els.input);t.suggestion=new s.dt({parseFilter:this._options.suggestionFilter,isIgnoreList:this._options.isIgnoreList}),this.listenTo(t,s.nT.SELECT,(e=>{if(e){let i=e.data;this.addItem({id:i.id,name:i.name,avatar:i.avatar,link:i.link}),t.value=""}}))}addItem(t,e=!1){if(!t.name&&!t.avatar&&!t.id)return;if(!e){let e=!1;for(let i of this.items)if(i.id===t.id){e=!0;break}if(e)return;this.items.push(t),this.items.length>this._options.maxItems&&this.items.shift()}let i=l((s=(0,o.extend)(t,{useWideButtons:this._options.useWideButtons}),r="",Array.prototype.join,r+='<span class="items-list__item items-list__item_community '+(null==(n=s.useWideButtons?"items-list__item_wide":"")?"":n)+'" data-value="'+(null==(n=s.name)?"":n)+'">\n\t<span class="avatar">\n\t\t',s.avatar?r+='\n\t\t\t<img src="'+(null==(n=s.avatar)?"":n)+'" alt="">\n\t\t':r+='\n\t\t\t<span class="community-avatar__default"></span>\n\t\t',r+='\n\t</span>\n\t<span class="items-list__name">'+(null==(n=s.name)?"":n)+'</span>\n\t<span class="items-list__close"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close icon--ui__close_search-item"><use xlink:href="#icon--ui__close"></use></svg></span>\n</span>\n'));var s,n,r;i.find(".items-list__close").on("click",(()=>this.removeItem(i))),this.$els.input.before(i),this.emit("change",this.items)}}i(41817);var h=i(88358),c=i(63331),d=i(72346);function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function m(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const _=i(19755),g=d.o.toTag(),v=d.o.unescape();class f extends a{constructor(t){super(t),this.setOptions((0,o.defaults)({maxItems:t.maxItems,addTagMenu:t.addTagMenu},{maxItems:8,addTagMenu:!0})),this._renderTagInput()}_renderTagInput(){this.items.forEach((t=>{this.addItem(t,!0)}));let t=this.tagsInput=new n.u3(this.$(".input"));t.suggestion=new s.Z6(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){m(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({parseFilter:this._options.suggestionFilter},this._options.filter&&{filter:this._options.filter})),this.listenTo(t,s.nT.SELECT,(e=>{e&&(this.addItem(e.id),t.value="")}))}_attachTagMenu(t){let e,i;return t.find(".items-list__more").on("click",(t=>{let s=_(t.target).closest(".items-list__more");s.data("hint")||(i&&this.stopListening(i),i=new c.Z({target:s,direction:h.Lh.TOP,alignment:h.SE.END,interactive:!0,delay:0,useLayerForClickAway:!0,actionCallback:()=>{s.removeClass("items-list__more_loading"),clearTimeout(e)}}),s.data("hint",i),i.onMouseEnter(t),this.listenTo(i,"select",(()=>{e=setTimeout((()=>{s.addClass("items-list__more_loading")}),100)})))})),t}addItem(t,e=!1){if(!(t=this.sanitizeTag(t)))return;const i=[...this.items];if(!e){if(this.items.indexOf(t)>-1)return;this.items.push(t),this.items.length>this._options.maxItems&&this.items.shift()}let s=this._options.addTagMenu,n=_((r={tag:t,menuNeeded:s,analyticsType:this._options.analyticsType},a="",Array.prototype.join,a+='<span\n\tclass="items-list__item items-list__item_tag '+(null==(o=r.menuNeeded?"":"items-list__item_no-menu")?"":o)+'" \tdata-value="'+(null==(o=r.tag)?"":o)+'"\n>\n\t<span>'+(null==(o=r.tag)?"":o)+'</span>\n\t<span class="items-list__close">\n\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close icon--ui__close_search-item"><use xlink:href="#icon--ui__close"></use></svg>\n\t</span>\n\n\t',r.menuNeeded&&(a+='\n\t\t<span class="items-list__more" data-tag="'+(null==(o=r.tag)?"":o)+'" data-analytics-type="'+(null==(o=r.analyticsType)?"":o)+'">\n\t\t\t<span class="items-list__more-loader"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__progress-circle"><use xlink:href="#icon--ui__progress-circle"></use></svg></span>\n\t\t</span>\n\t'),a+="\n</span>\n"));var r,o,a;s&&(n=this._attachTagMenu(n)),n.find(".items-list__close").on("click",(()=>this.removeItem(n))),this.$els.input.before(n),this.emit("change",this.items,i)}sanitizeTag(t){return g(v(String(t)))}}var y=i(12953),b=i(36005);const w=i(19755);class E extends a{constructor(t){super(t),this.render(),this.setOptions((0,o.defaults)({maxItems:t.maxItems,useWideButtons:t.useWideButtons,showBanInformation:t.showBanInformation},{maxItems:1,useWideButtons:!1,showBanInformation:!1})),this._renderUserInput()}_renderUserInput(){this.items.forEach((t=>{this.addItem(t,!0)}));let t=new n.u3(this.$(".input"));t.suggestion=new s.xI({parseFilter:this._options.suggestionFilter}),this.listenTo(t,s.nT.SELECT,(e=>{let i=e.data;e&&(this.addItem({id:i.id,name:i.name,avatar:i.avatar80||i.avatar,is_permabanned:i.is_permabanned,banReason:i.ban_reason?y.core.i18n("users.permabanned",i.ban_reason):y.core.i18n("users.permabanned-without-reason")}),t.value="")}))}addItem(t,e=!1){if(!t.name&&!t.avatar&&!t.id)return;if(!e){let e=!1;for(let i of this.items)if(i.id===t.id){e=!0;break}if(e)return;this.items.push(t),this.items.length>this._options.maxItems&&this.items.shift()}let s=w(function(t){var e,s="",n=b.escape;Array.prototype.join;const r=i(12953).core;s+="\n";const o=t.banReason||r.i18n("users."+(t.ban_reason?"permabanned":"permabanned-without-reason"),t.ban_reason);return s+='\n\n<span class="items-list__item items-list__item_user '+(null==(e=t.useWideButtons?"items-list__item_wide":"")?"":e)+'" data-value="'+(null==(e=t.name)?"":e)+'">\n\t<span class="avatar avatar_small">\n\t\t',t.avatar?s+='\n\t\t\t<img src="'+(null==(e=t.avatar)?"":e)+'" alt="">\n\t\t':s+='\n\t\t\t<span class="avatar__default"></span>\n\t\t',s+='\n\t</span>\n\t<span class="items-list__name">'+(null==(e=t.name)?"":e)+"</span>\n\t",o&&t.is_permabanned&&(s+='\n\t\t<span class="ignore-rule__ban-status hint" data-zindex="6006" aria-label="'+n(o)+'">\n            \t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__ban icon--ui__ban_profile"><use xlink:href="#icon--ui__ban"></use></svg>\n\t\t</span>\n\t'),s+'\n\t<span class="items-list__close"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close icon--ui__close_search-item"><use xlink:href="#icon--ui__close"></use></svg></span>\n</span>\n'}((0,o.extend)(t,{useWideButtons:this._options.useWideButtons,showBanInformation:this._options.showBanInformation})));s.find(".items-list__close").on("click",(()=>this.removeItem(s))),this.$els.input.before(s),this.emit("change",this.items)}}i(88674);var A=i(33662);i(95411);const S=i(19755),P="ignore.errors.keyword-short";class C extends a{constructor(t){super(t),this.setOptions((0,o.defaults)({maxItems:t.maxItems},{maxItems:8})),this.$els.input=this.$(".input"),this.$els.container=this.$els.input.wrap('<div class="items-list__container"></div>').parent(),this.$els.button=this.$els.input.after(`\n\t\t\t\t<button type="button" class="button_success button_small">${y.core.i18n("modal.add")}</button>\n\t\t\t`).next(),this._renderKeywordInput()}_renderKeywordInput(){this._input=new n.u3({$el:this.$els.input,sanitizerRules:[d.o.toKeyword()],validationRules:{[P]:n.cX.isLength(A.Hc),"ignore.errors.keyword-long":n.cX.isLength(0,A.fv),"ignore.errors.keyword-wrong-asterisk":n.cX.keywordAsterisk()}}),this._input.on("enter",(()=>this.$els.button.trigger("click"))),this._input.$el.on("input",(t=>t.target.value=this._input.sanitize(t.target.value))),this.$els.button.on("click",(async()=>{let t=this._input.value,e=await this._input.checkValidity({inputValue:t}),i=this._input.validationMessage,s=i===P?A.Hc:A.fv;e?(this.addItem(t),this._input.value=""):this.emit("error",y.core.i18n(i,s))})),this.items.forEach((t=>{this.addItem(t,!0)}))}addItem(t,e=!1){if(!(t=this._input.sanitize(t)))return;if(!e){if(this.items.indexOf(t)>-1)return;this.items.push(t),this.items.length>this._options.maxItems&&this.items.shift()}let i=S(""+'<span class="items-list__item items-list__item_keyword" data-value="'+(null==(n=(s={keyword:t}).keyword)?"":n)+'">\n\t<span>'+(null==(n=s.keyword)?"":n)+'</span>\n\t<span class="items-list__close">\n\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close icon--ui__close_search-item"><use xlink:href="#icon--ui__close"></use></svg>\n\t</span>\n</span>\n');var s,n;i.find(".items-list__close").on("click",(()=>this.removeItem(i))),this.$els.container.before(i),this.emit("change",this.items)}}},48218:(t,e,i)=>{i.d(e,{g:()=>v});i(88674),i(66992),i(33948);var s=i(12953),n=i(18910),r=i(3668),o=i(88358),a=i(63907),l=i(95411),u=i(85823),h=i(96637);var c=i(88690),d=i(90312),p=i(38654),m=i(36005),_=i(28650);const g=i(19755);class v extends o.nk{static async confirmSMS({header:t,content:e="",id:i,callback:u,attempts:g=-1,inputAttrs:v="",beforeShow:f,analyticsData:y,wrapperExtraClass:b=""}){const w=s.core.initParams.withoutCaptcha?-1:await p.K.getInstance().getScore("registration_code_request");return d.c.getInstance().sendEvent("registration_code_request",Object.assign(y||{},{rec_score:w})),new Promise((p=>{let y=new o.LD({destroyAfterHide:!0,indent:!0,minWidth:475,header:s.core.i18n(String(t||"auth.up.confirm.header")),content:(S={content:e,inputAttrs:v},C="",C+='<form method="POST" action="javascript: void(0);" novalidate>\n\t<div class="">\n\t\t'+(null==(P=S.content)?"":P)+'\n\t</div>\n\t<div class="input input_section">\n\t\t<div class="input__box">\n\t\t\t<input class="input__input" type="text" autocomplete="off" name="confirm" minlength="4" maxlength="4" placeholder="Код из SMS" '+(null==(P=S.inputAttrs)?"":P)+">\n\t\t</div>\n\t</div>\n</form>"),autoClosePressEscape:!1,autoCloseOutsideClick:!1,wrapperExtraClass:"popup_confirm-sms "+b}),w=new r.u3({$el:y.content.find(".input"),validationEvent:r.km.MANUAL,validationHint:{direction:o.Lh.LEFT,alignment:o.SE.CENTER},sanitizerRules:[r.op.trim()],addSuccessState:!0}),E=new n.y3({title:s.core.i18n("auth.up.confirm.button"),theme:n.jM.SUCCESS}),A=async()=>{if(E.progress)return;if(d.c.getInstance().sendEvent("click",{button:"approve_account",component_name:"settings"}),E.progress||!(await w.checkValidity()))return;E.progress=!0;let t=Date.now();try{let e=await u(w.value,w,y);await h.Utils.delay(1e3-(Date.now()-t)),E.progress=!1,d.c.getInstance().sendEvent("approve_account",{component_name:"settings",type:"phone"}),p(e),y.hide()}catch(e){await h.Utils.delay(1e3-(Date.now()-t)),E.progress=!1,w.setCustomValidity(e.message)}-1!==g&&g--<=1&&(p(!1),y.hide())};var S,P,C;y.listenTo(E,"click",A),y.on(a.eM.UNMOUNTED,(()=>{p(!1)})),y.addCustomIntoFooter(E.show().$el),y.addCloseButtonIntoFooter(),y.addCustomIntoFooter((0,c.Z)(i));const T=new _.X({sessionId:i}).render();y.content.append(T.el),y.content.find("form").on("submit",(t=>{t.preventDefault(),A()})),s.core.ui.hotkeys.once("enter",(()=>{A()}),{closest:y.$el,context:y,type:l.FM.KEYDOWN}),(0,m.isFunction)(f)&&f(y),y.show(),setTimeout((()=>{w.focus()}),100)}))}static popupCheckboxes(t){let{target:e,enumEntries:i,localePrefix:n,currentValues:r,disabledOptions:a,alignment:l}=t,h=(0,m.uniqueId)("popup-checkboxes"),c=(0,m.isBoolean)(i)?[!0,!1]:i.entries();n=n||"",n+="."===n.slice(-1)?"":".",a=a?a.split(","):"";let d=c.map((t=>{if(!r||!r.hasOwnProperty(t.valueOf()))return;let e=r[t.valueOf()],i=a.includes(t.valueOf());return`<p class="form__field  ${i?"form__field_disabled":""}">\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\tname="${h}"\n\t\t\t\t\t\t\t\tvalue="${t.valueOf()}"\n\t\t\t\t\t\t\t\t${e?'checked="checked"':""}\n\t\t\t\t\t\t\t\t${i?"disabled":""}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t${s.core.i18n(n+t.valueOf(),0)}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</p>`})).join("\n"),p=new o._({target:e,alignment:l,content:g(`<form novalidate>${d}</form>`),indent:!0}),_=new u.x(p.content);return p.marks.set("form",_),p.listenTo(_,"change",(()=>{let t=_.serialize()[h]||[],e=(0,m.isArray)(t)?t:t.split(),i={};c.forEach((t=>{r.hasOwnProperty(t.valueOf())&&(i[t.valueOf()]=e.includes(t.valueOf()))})),p.emit("change",_,i)})),p}}},32617:(t,e,i)=>{i.d(e,{Z:()=>l});i(66992),i(33948);var s=i(92393),n=i(12953),r=i(65448),o=i(36005);const a=i(19755);class l extends s.m{constructor(t={}){super(t),this.el&&(this._childrenSelector=`.radio_checked input[type="radio"][name="${this.$els.input.attr("name")}"]`)}render(){return super.render(),this}_createChecked(){return this.$els.checkedIcon?this.$els.checkedIcon:this.$els.checkedIcon=a(document.createElement("div")).addClass("radio__bullet")}_updateToggle(t,e=!0){!e&&t&&this.$el.closest("form").find(this._childrenSelector).trigger("update"),super._updateToggle(t,e)}static renderFromEnum(t,e,i,s){if(!t||t instanceof r.xs==!1)throw new Error("No enum specified!");if(!e)throw new Error("No i18n string specified!");let u=i instanceof r.Tf?i.valueOf():i,h=(0,o.uniqueId)("enum-radio"),c=e||"";return c+="."===c.slice(-1)?"":".",t.entries().map(((t,e)=>{let i=(0,o.isUndefined)(u)?0===e:u===t.valueOf(),r=a(`\n\t\t\t\t\t<p class="form__field">\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\ttype="radio" \n\t\t\t\t\t\t\t\tname="${h}"\n\t\t\t\t\t\t\t\tvalue="${t.toString()}"\n\t\t\t\t\t\t\t\t${i?'checked="checked"':""}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${n.core.i18n(c+t.toString(),0)}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</p>\n\t\t\t\t`);return s&&s.append(r),new l(r.find("input"))}))}}l.prototype.classes={item:"radio",checked:"radio_checked",disabled:"radio_disabled",type:"radio",input:'input[type="radio"]'}},81605:(t,e,i)=>{i.d(e,{C:()=>r});var s=i(3668);const n=i(19755);class r extends s.Y1{constructor(t){super(t),this.render()}_createWrapper(){if(this.$el&&this.$el.is(".select")){if(this.$els.input=this.$("select"),!this.$els.input.length)throw new Error("UISelect not found <select> element")}else{let t=this.$el.parent();this.$els.input=this.$el,t.length&&t.is(".select")?this.$el=t:this.$el=n(document.createElement("div")).addClass("select").insertBefore(this.$els.input).append(this.$els.input)}n(document.createElement("div")).addClass("select__icon fa fa-angle-down").appendTo(this.$el)}}},81772:(t,e,i)=>{i.d(e,{T:()=>h});var s=i(63907),n=i(12953),r=i(95411),o=i(72044),a=i(36005);const l=i(19755);class u extends s.u1{constructor(t){let e;super(),o.Zv.isElement(t)?(e=t,t={}):(0,a.isObject)(t)&&t.$el&&(e=t.$el,delete t.$el),this.setOptions(t),e&&(e=l(e),e.is("select")||e.is("input")?(this.$els.input=e,this.$els.options||this._getOptionsFromSelect()):this.$el=e,this.show())}mount(){return this.$el&&this.$parent&&this.$el.parent()!==this.$parent&&this.$el.appendTo(this.$parent),super.mount()}render(){return this.isRendered||(this.$els.input||(this.$els.input=l(document.createElement("input")).attr("type","hidden").val(this.value)),this.$els.input.hide().on("update",(()=>{this.value=u.prepareValue(this.$els.input.val())})),this.$el?this.$el.addClass("slider").append(this.$els.input):this.$el=l(document.createElement("div")).addClass("slider").insertBefore(this.$els.input).append(this.$els.input),this.$el.prop("tabindex",0),this.$els.component=l(document.createElement("div")).addClass("slider__component").appendTo(this.$el),this.$els.wrapper=l(document.createElement("div")).addClass("slider__wrapper").appendTo(this.$els.component),this.$els.handle=l(document.createElement("div")).addClass("slider__handle").appendTo(this.$els.wrapper),this.$el.on({mousedown:this._onMouseDown.bind(this)}),this._hotkeys=new r.SV(this.$el),this._hotkeys.on({left:this._onKeyLeft.bind(this),right:this._onKeyRight.bind(this)}),this.$els.quantity=l(document.createElement("div")).addClass("slider__quantity").appendTo(this.$els.component),this._updateWidth(),this.listenTo(n.default.ui,"resize",this._updateWidth),(0,a.isUndefined)(this.value)||(this.value=this.value),super.render()),this}_getOptionsFromSelect(){if(!this.$els.input.is("select"))return this;let t=parseInt(this.$els.input.val(),10);return this.options=(0,a.map)(this.$els.input.find("option"),(t=>({value:u.prepareValue(t.getAttribute("value")),title:t.innerText}))),void 0!==t&&(this.value=t),this}static prepareValue(t){return(0,a.isFinite)(t)?parseInt(t,10):t}destroy(){this.$els.input&&(this.$els.input.off(),delete this.$els.input),super.destroy()}_onKeyLeft(){let t=(0,a.findIndex)(this.options,{value:this.value});return t>0&&(this.value=this.options[t-1].value),this}_onKeyRight(){let t=(0,a.findIndex)(this.options,{value:this.value});return t<this.options.length-1&&(this.value=this.options[t+1].value),this}_onMouseDown(t){this.listenTo(n.default.ui,"pointer-move",this._onMove),this.listenTo(n.default.ui,"pointer-up",this._onMouseUp),this._onDown(t)}_onMouseUp(){this.stopListening(n.default.ui,"pointer-move"),this.stopListening(n.default.ui,"pointer-up"),this._onUp()}_onDown(t){t.touches&&t.touches.length>0&&(t=t.touches[0]),this.$el.focus(),n.default.logger.log("slider","down"),this._updateWidth(),this.unselectable=!0,this._onMove(t.clientX,0,t)}_onMove(t,e,i){i&&(0,a.isFunction)(i.preventDefault)&&i.preventDefault();let s=t-this.$el.offset().left;if(this.options){s=Math.max(0,Math.min(s,this._restrictHandleX));let t=s/this._restrictHandleX,e=1/(this.options.length-1),i=Math.round(t/e),n=this.options[i].value;return n!==this.value&&(this.value=n,this.emit("change",this.value,this.title)),this}}_onUp(){n.default.logger.log("slider","up"),this.unselectable=!1}_setPosition(t){return this.$els.handle[0].style.left=t+"%",this.$els.quantity[0].style.width=t+"%",this}_updateWidth(){return this._restrictHandleX=this.$el[0].offsetWidth,this}get value(){return this._options.value}set value(t){if(this.$el&&this.options){let e=(0,a.findIndex)(this.options,(e=>e.value===t));e>-1&&(this._options.title=this.options[e].title,this.$els.input&&this._options.value!==t&&this.$els.input.val(t).change(),this._setPosition(100/(this.options.length-1)*e))}return this._options.value=t}get title(){return this._options.title}set unselectable(t){return t=Boolean(t),n.default.ui.$els.body.toggleClass("i-slider_move",t),this.$el.toggleClass("slider_unselectable",t)}get options(){return this._options.options}set options(t){if(!(0,a.isArray)(t))throw new Error("UISlider can receive as options only Array<{value, title}>");return this._options.options=(0,a.map)(t,(t=>(0,a.isObject)(t)?t:{value:t})),(0,a.isUndefined)(this.value)||(this.value=this.value),this.options}get name(){return this._options.name}set name(t){return t=String(t).trim(),this.$els.input&&this.$els.input.attr("name",t),this._options.name=String(t)}}const h=u},36012:(t,e,i)=>{i.d(e,{$:()=>l});i(85827),i(2707),i(66992),i(33948);var s=i(75021),n=i(63907),r=i(72044),o=i(90477),a=i(36005);class l extends n.u1{constructor(t){super(t),this._options.rows=new o.qg(!0),this.listenTo(this.rows,o.u$.UPDATE,(0,a.throttle)(this._onUpdateRows,10)),this.listenTo(this.rows,o.u$.SORT,this.update),this._updateThrottle=(0,a.throttle)(this._update,10)}_onUpdateRows(t,e){if(!this.isRendered)return;let i=this.header.find((t=>t.orderActive));i?this._sortRows(i):this.update()}update(t=!1){(t=!0===t)?this._update(t):this._updateThrottle(t)}_update(t=!1){if(!t&&!this.isRendered)return;let e=this._renderV();this.el?this.marks.has("_vnode")?s.zM.node(this.marks.get("_vnode"),e,"root").reduce(s.nq.updateElement(void 0,this),this.el):r.Zv.clearEmptyTextNode(this.el):this.el=s.wK.createElement(e,"root",void 0,this),this.marks.set("_vnode",e)}render(){return this.isRendered||(this.update(!0),this.$el.on("click","th",(t=>{let e=t.currentTarget.getAttribute("data-id"),i=this.header[e];i&&i.orderBy&&(i.order=!i.orderActive||!i.order,this.header.forEach((t=>t.orderActive=!1)),i.orderActive=!0,this._sortRows(i))})),super.render()),this}_sortRows(t){"string"===t.sortType?this.rows.sort(((e,i)=>{let s=e.data[t.orderBy].toLowerCase(),n=i.data[t.orderBy].toLowerCase();return s>n?t.order?1:-1:s<n?t.order?-1:1:0})):this.rows.sort(((e,i)=>{let s=e.data[t.orderBy],n=i.data[t.orderBy];return t.order?s-n:n-s}))}_renderV(){return s.vu.create("table",{className:"table table_standard"},s.vu.create("colgroup",null,s.vu.create("col",null),this.header.map((t=>{let e="col"+(t.col?" col_"+t.col:"");return s.vu.create("col",{className:e})}))),s.vu.create("thead",null,s.vu.create("tr",null,this.header.map(((t,e)=>{let i="table__arrow"+(t.orderActive?t.order?" table__arrow_asc":" table__arrow_desc":"");return s.vu.create("th",{key:e,"data-id":e},t.label,t.orderBy?s.vu.create("i",{className:i}):null)})))),this.renderBody(this.rows))}get renderBody(){return this._options.renderBody}set renderBody(t){this._options.renderBody!==t&&(this._options.renderBody=t)}get canSort(){return this._options.canSort}set canSort(t){this._options.canSort!==(t=Boolean(t))&&(this._options.canSort=t)}get header(){return this._options.header}set header(t){this._options.header!==t&&(t=t.map((([t,e,i,s,n])=>({label:t||"",orderBy:i,col:e,sortType:s,orderActive:Boolean(n)}))),this._options.header=t)}get rows(){return this._options.rows}get isEmpty(){return this._options.isEmpty}set isEmpty(t){this._options.isEmpty!==(t=Boolean(t))&&(this._options.isEmpty=t)}}},99819:(t,e,i)=>{i.d(e,{G:()=>a});var s=i(95411),n=i(3668),r=(i(12953),i(36005));const o=i(19755);class a extends n.Y1{constructor(t){super(t),this.$el&&this.render()}render(){return this.isRendered||(super.render(),this.$els.input.is("textarea")&&this.autoSize(),this._hotkeys=new s.SV(this.$els.input),this.submitHotkey&&this._hotkeys.on(this.submitHotkey,this._submit.bind(this),{type:s.FM.KEYDOWN}),this.newlineHotkey,this.$els.input.on("input",this.autoSize.bind(this))),this}autoSize(){return this.els.input.style.height=0,this.els.input.style.height=this.$els.input[0].scrollHeight+"px",this}_submit(t){if(t&&(0,r.isFunction)(t.preventDefault)&&t.preventDefault(),this.suggestion&&this.suggestion.isShown)return;let e=this.el.closest("form");e&&o(e).trigger("submit")}get value(){return this.$els.input.val()}set value(t){this.$els.input.val(t)}get padding(){return this._options.paddding?this._options.paddding:this._options.paddding=(parseInt(this.$els.input.css("padding-top"),10)||0)+(parseInt(this.$els.input.css("padding-bottom"),10)||0)}get autoHeight(){return this._options.autoHeight}set autoHeight(t){return this._options.autoHeight=Boolean(t)}get submitHotkey(){return this._options.submitHotkey}set submitHotkey(t){return this.submitHotkey===t||(0,r.isBoolean)(this.submitHotkey)&&(0,r.isBoolean)(t)?this.submitHotkey:(this._hotkeys&&(this.submitHotkey&&this._hotkeys.off(this.submitHotkey),(0,r.isBoolean)(t)||this._hotkeys.on(t,this._submit.bind(this),{type:s.FM.KEYDOWN})),this._options.submitHotkey=t)}get newlineHotkey(){return this._options.newlineHotkey}set newlineHotkey(t){return this.newlineHotkey===t||(0,r.isBoolean)(this.newlineHotkey)&&(0,r.isBoolean)(t)||"shift+enter"===t?this.newlineHotkey:(this._hotkeys&&(this.newlineHotkey&&this._hotkeys.off(this.newlineHotkey),(0,r.isString)(t)),this._options.newlineHotkey=t)}}},96050:(t,e,i)=>{i.d(e,{e:()=>b});i(66992),i(33948),i(41817);var s=i(12953),n=i(63907),r=i(47442),o=i(47994),a=i(90312),l=i(13218),u=i.n(l),h=i(91747),c=i.n(h),d=i(47037),p=i.n(d),m=i(16253);function _(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function g(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?_(Object(i),!0).forEach((function(e){v(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):_(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function v(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const f=i(19755),y=i(30381);class b extends m.vp{constructor(){super(),this._warningToastList=new Map,this._namedToastList=new Map,this.activeToasts=new Set,this.$el=f(".header__messages")}add(t,e){let i,r=t;var o;(e&&!u()(t)||(e=t,r=void 0),r)&&(i=this._namedToastList.get(r),null!==(o=i)&&void 0!==o&&o.isDestroyed&&(i=void 0));return i||((e=e||{}).content=s.core.i18n(e.content||""),e=c()(e,{destroyAfterHide:!0}),i=this._createToast(e),r&&(this._namedToastList.set(r,i),i.on(n.eM.DESTROYED,(()=>{this._namedToastList.delete(r)})))),i.show(),i}showError(t,e){let i;return i=t instanceof Error?t.message:p()(t)?s.core.i18n(t)||t:"Упс! Возникла внутренняя ошибка",this.add(i,g(g({},e),{},{content:i,theme:r.K.DANGER}))}showWarningMessage(t,...e){let i,n,l;t!==s.ZF.AUTHORIZATION_REQUIRED||s.core.ui.auth||(t=s.ZF.AUTHORIZATION_REQUIRED_NO_LINKS),i=this._warningToastList.get(t),n=("string"!=typeof t?"comments.ignore.":"warning-message.")+t.toString(),i||(l=r.K.DANGER,(t===s.ZF.AUTHORIZATION_REQUIRED||s.ZF.AUTHORIZATION_REQUIRED_NO_LINKS)&&(l=r.K.WARNING),t===s.ZF.BANNED&&(e=[y(s.core.initParams.userEndDateOfBan||Date.now()).fromNow()]),i=this._createToast({theme:l,content:s.core.i18n(n,...e)}),this._warningToastList.set(t,i),i.content.on("click","a",(()=>{i.hide()}))),t===s.ZF.NEED_MORE_RATING&&(i.content=s.core.i18n(n,Math.abs(s.core.userRating-(e[0]||0)))),t===o.IV.COMMUNITY_IGNORES_YOU&&(i.content=s.core.i18n(n,...e)),i.show(),t===s.ZF.AUTHORIZATION_REQUIRED&&a.c.getInstance().sendEvent("tip_show",{type:"unauth_is_trying_auth_activity"})}_createToast(...t){const e=new r.O(...t);return e.on(n.eM.MOUNTED,(()=>{this.activeToasts.add(e),this.emit("toast-show")})),e.on(n.eM.UNMOUNTED,(()=>{this.activeToasts.delete(e),this.emit("toast-hide")})),e}}},77702:(t,e,i)=>{i.d(e,{j:()=>ze});i(66992),i(33948),i(88674),i(41817);var s=i(12953),n=i(63907),r=i(49412),o=i(72044),a=i(85823);function l(t){var e,i="";Array.prototype.join;return i+='<div class="theme-picker__popup">\n\t<form>\n\t\t',t.themes.length>1&&(i+='\n\t\t\t<div class="theme-picker__buttons">\n\t\t\t\t',t.themes.forEach((function(s){i+='\n\t\t\t\t<div class="theme-picker__button'+(null==(e=s===t.currentTheme?" theme-picker__button_current":"")?"":e)+'" data-type="'+(null==(e=s.valueOf())?"":e)+'"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__checkmark_16"><use xlink:href="#icon--ui__checkmark_16"></use></svg></div>\n\t\t\t\t'})),i+="\n\t\t\t</div>\n\t\t"),i+='\n\t\t<div class="theme-picker__option theme-picker__option_dark">\n\t\t\t<label><h4>Ночная тема</h4><input class="checkbox_switch" name="dark" type="checkbox" '+(null==(e=t.dark?"checked":"")?"":e)+' value="true"></label>\n\t\t</div>\n\t\t<div class="theme-picker__settings'+(null==(e=t.dark?" theme-picker__settings_visible":"")?"":e)+'">\n\t\t\t<div class="theme-picker__schedule"><label><input name="schedule" type="checkbox" value="true" '+(null==(e=t.schedule?"checked":"")?"":e)+'> Применять автоматически</label></div>\n\t\t\t<div class="theme-picker__schedule-times'+(null==(e=!t.dark||t.schedule?" theme-picker__schedule-times_visible":"")?"":e)+'">\n\t\t\t\t<span class="theme-picker__schedule-caption">с</span>\n\t\t\t\t<span class="input input_inline">\n\t\t\t\t\t<input class="input__input" type="time" name="from" value="'+(null==(e=t.from)?"":e)+'">\n\t\t\t\t</span>\n\t\t\t\t<span class="theme-picker__schedule-caption">до</span>\n\t\t\t\t<span class="input input_inline">\n\t\t\t\t\t<input class="input__input" type="time" name="to" value="'+(null==(e=t.to)?"":e)+'">\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t</form>\n</div>'}var u=i(42011),h=i(96637),c=i(90312),d=i(1262);class p extends n.u1{_onChangeForm(t){const e=t.serialize(),i=1===e.dark,n=1===e.schedule;if(i!==s.core.ui.themeSettings.data.dark){const t=s.core.ui.themeSettings.data.dark?r.PH.DARK:r.PH.LIGHT,e=i?r.PH.DARK:r.PH.LIGHT;d.User.sendSettingsChangeAnalytics("color_theme",t,e),c.c.getInstance().yandex.goal(i?"color-theme_dark_on":"color-theme_dark_off")}n!==s.core.ui.themeSettings.data.schedule&&c.c.getInstance().yandex.goal(n?"color-theme_dark-schedule_on":"color-theme_dark-schedule_off"),this.$els.settings.toggleClass("theme-picker__settings_visible",i),this.$els.times.toggleClass("theme-picker__schedule-times_visible",!i||n),s.core.ui.themeSettings.data.dark=i,s.core.ui.themeSettings.data.schedule=n,s.core.ui.themeSettings.data.from=u.f.convertStringToTime(e.from),s.core.ui.themeSettings.data.to=u.f.convertStringToTime(e.to),s.core.emit("need-calendar-redraw"),h.SessionStorage.get("pkb_set_theme")||(h.SessionStorage.set("pkb-set-theme",!0),c.c.getInstance().yandex.goal(s.core.isUserAuthorized?"color-theme_auth":"color-theme_guest"))}}var m=i(36005),_=i(19755),g=i.n(_);class v extends p{render(){if(this.isRendered)return this;this.$el=g()(document.createElement("div")),this.$el.addClass("theme-picker").append(s.core.icon("ui__fill"));const t=s.core.ui.themeSettings.data;this._popup=new o.gR({delay:300,delayClose:300,destroyAfterHide:!1,interactive:!0,indent:!0,target:this.$el,direction:o.Lh.TOP,alignment:o.SE.END,content:l({themes:[r.f0.DEFAULT],currentTheme:t.theme,dark:t.dark,schedule:t.schedule,from:r.fM.convertTimeToString(t.from),to:r.fM.convertTimeToString(t.to)})}),this.listenTo(this._popup,n.eM.MOUNTED,(()=>this.$el.addClass("theme-picker_shown"))),this.listenTo(this._popup,n.eM.UNMOUNTED,(()=>{this.$el.removeClass("theme-picker_shown"),this.previewTheme=s.core.ui.themeSettings.currentTheme})),this.$els={html:g()("html"),body:g()("body"),settings:this._popup.content.find(".theme-picker__settings"),buttons:this._popup.content.find(".theme-picker__buttons"),times:this._popup.content.find(".theme-picker__schedule-times")};const e=new a.x(this._popup.content.find("form"));return this.listenTo(e,"change",this._onChangeForm),this._popup.content.on("click",".theme-picker__button",(t=>{const e=s.core.ui.themeSettings.data.theme.value;s.core.ui.themeSettings.data.theme=r.f0[t.currentTarget.dataset.type],s.core.emit("need-calendar-redraw"),d.User.sendSettingsChangeAnalytics("site_color",e,s.core.ui.themeSettings.data.theme),c.c.getInstance().yandex.goal("color-theme_"+s.core.ui.themeSettings.data.theme.valueOf()),this._popup.content.find(".theme-picker__button_current").removeClass("theme-picker__button_current"),t.currentTarget.classList.add("theme-picker__button_current")})),this._popup.content.on("mouseenter",".theme-picker__button",(0,m.throttle)((t=>{t&&t.currentTarget instanceof HTMLElement&&(this.previewTheme=r.f0[t.currentTarget.dataset.type]||r.f0)}),150,{leading:!1})),this._popup.content.on("mouseleave",".theme-picker__buttons",(()=>{this.previewTheme=s.core.ui.themeSettings.currentTheme})),super.render(),this}destroy(){this.isDestroyed||(this._popup.destroy(),super.destroy())}get previewTheme(){return this._options.previewTheme||r.f0.DEFAULT}set previewTheme(t){let e=this._options.previewTheme;(t=r.f0[t])&&t!==e&&(t===r.f0.DEFAULT?this.$els.html.removeAttr("data-theme"):this.$els.html.attr("data-theme",String(t.valueOf())),this._options.previewTheme=t)}}var f=i(96050),y=(i(74916),i(85827),i(12950)),b=i(23703),w=i(3668),E=i(16253),A=i(88358),S=i(49912),P=i(88251),C=i(92927);const T=new(i(65448).xs)({MAIN:1,PROFILE:2,SEARCH_HOVER:3,SEARCH_FOCUS:4,NOTIFICATIONS:5,EXTRA_MENU:6,OUT:7});var k=i(51294),D=i(36005);function I(t){var e,i="",s=D.escape;Array.prototype.join;const n=t.from?`?from=${t.from}`:"";return i+='\n<div class="menu menu_vertical">\n\t<a class="menu__item" href="/answers'+s(n)+'" data-menu-item="answers">Ответы '+(null==(e=t.answersBell||"")?"":e)+'</a>\n\t<a class="menu__item" href="/comments'+s(n)+'" data-menu-item="comments">Комментарии</a>\n\t<a class="menu__item" href="/liked'+s(n)+'" data-menu-item="ratings">Оценки</a>\n\t<a class="menu__item" href="/saved-stories'+s(n)+'" data-menu-item="saved">Сохраненные</a>\n\t<a class="menu__item" href="/subs-list'+s(n)+'" data-menu-item="manage_subs">Управление подписками</a>\n\t<a class="menu__item" href="/ignore-list'+s(n)+'" data-menu-item="ignore_list">Игнор-лист</a>\n\t<a class="menu__item" href="/notes'+s(n)+'" data-menu-item="notes">Заметки</a>\n    <a class="menu__item" href="/settings'+s(n)+'" data-menu-item="settings">Настройки</a>\n\t<span class="menu__item" data-role="logout" data-menu-item="signout">Выйти</span>\n</div>\n'}var $=i(36005);function O(t){var e,i="";return i+='<div class="notifications-hint">\n    <div class="notifications-hint__body notifications-hint__body_visible" data-is-new="'+(null==(e=t.isNew)?"":e)+'">\n        <div class="notification">\n            <div class="notification__main">\n                <div class="notification__header">\n                    <div class="notification__icon notification__icon_inline">\n                        <i class="fa fa-envelope-o" aria-hidden="true"></i>\n                    </div>\n                    <time class="notification__datetime" datetime="'+(null==(e=t.datetime)?"":e)+'">'+(null==(e=t.dateFormat)?"":e)+'</time>\n                </div>\n                Приветствуем на Пикабу!\n                <br>\n                <br>\n                <a href="#signup" class="to-signup" data-type="welcome">Зарегистрируйтесь</a>, чтобы получить возможность:\n                <br>– скрывать просмотренные посты\n                <br>– общаться в комментариях\n                <br>– голосовать за лучший контент\n                <br>– делать собственные посты\n                <br>– подписываться на интересные темы\n                <br>– и ещё много всего интересного\n            </div>\n        </div>\n    </div>\n    <div class="notifications-hint__more">\n        <a href="/information/welcome" class="notifications-hint__more-link">Показать уведомление</a>\n    </div>\n</div>'}var x=i(32677),B=i(31200),L=i(12182),M=i(57852),F=i(93172);var R=i(41773),N=i(73736),j=i(68505),U=i(30381),H=i.n(U);function V(t){return H()(t).format("DD MMMM YYYY, HH:mm")}var W=i(80037);function q(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function z(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const Y=i(19755),G={[S.t.DELETED_STORY]:"fa-trash-o",[S.t.NEWS]:"fa-newspaper-o",[S.t.BAN]:"fa-ban"};class K extends E.vp{constructor(t){var e;if(super(),this.ui=t,this._options={},this.$el=Y(".header"),!this.$el.length)return;this.$els={inner:this.$(".header__inner"),main:this.$(".header__main"),wrapper:this.$(".header__wrapper"),menu:this.$(".header-menu"),menuItems:this.$(".header-menu__item"),extra:this.$(".header-menu__extra"),extraWrapper:this.$(".header-menu__extra-wrapper"),branding:this.$("a > div"),avatar:this.$(".header-right-menu__item.avatar"),notifications:this.$(".header-right-menu__notification"),notificationsBell:this.$(".header-right-menu__notification .bell"),search:{el:this.$(".header-right-menu__search"),form:this.$(".header-right-menu__search > form"),btn:this.$('.header-right-menu__search button[type="submit"]')},logo:this.$(".logo"),loginBtn:this.$(".header-right-menu__login-button")},this._calcHeight(),this.hideNext=!1,this._isBranding=this.$el.get(0).firstElementChild!==this.$els.main.get(0)&&!this.$el.find(".external_branding").length,this._activeElements=new P.F,this.listenTo(this._activeElements,"update",this._onUpdateElements),s.core.isUserAuthorized?(this._initProfileMenu(),this._initNotifications()):(s.core.initParams.isDeleted||this._initWelcomeNotification(),this.$els.loginBtn.click((t=>{this.isCollapsedShown=!1,c.c.getInstance().sendEvent("click",{button:"authorization",component_name:"header"}),s.core.ui.authRequired({formType:"signIn",analyticsParams:{component_name:"popup",reason:"header"}})}))),this.ui.on("document-scroll",(0,m.throttle)((()=>{this.hideNext&&(this.isCollapsedShown=!1,this.hideNext=!1),this._updateCollapsedState()}),200)),Y(document).on("mouseout",(t=>{if(!this.isCollapsed)return;let e=t.clientX,i=t.clientY,s=document.elementFromPoint(e,i),n=this._votingArea&&this._votingArea.x1<e&&this._votingArea.x2>e;s&&s.closest(".header__main")?n||this._activeElements.toggle(T.MAIN,!0):(this._activeElements.toggle(T.MAIN,!1),i<5&&!n?this._activeElements.toggle(T.OUT,!0):this._activeElements.toggle(T.OUT,!1))}));let i=document.querySelector(".story__left");if(i){let{x:t,width:e}=i.getBoundingClientRect();this._votingArea={x1:t,x2:t+e}}this._updateCollapsedState(),this._searchInput=void 0,this._searchShown=!1,this._searchTimerId=0,this._searchBtnEnabled=!1,this._notificationsTimerId=0,this._notificationsWasTimerEvent=!1,this._extraMenu=null,this._initSearch(),this._initExtraMenu(),this.listenTo(s.core.ui,"resize",(0,m.throttle)(this._toggleExtraMenu.bind(this),400)),this.$els.menuItems.on("click",(t=>{if("courses"===t.currentTarget.dataset.type)return void c.c.getInstance().sendEvent("click",{button:"courses"});const e=t.currentTarget.dataset.feedKey,i=x.L[e];if(!i)return;let s={};try{const e=t.currentTarget.dataset.analyticsParams;e&&(s=JSON.parse(e))}catch(n){console.log(n)}c.c.getInstance().sendEvent("transition_to_tab",function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?q(Object(i),!0).forEach((function(e){z(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):q(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({type:e,level:i,transition_source:"header"},s)),N.dV.send("transitionToTab",{level:i})})),null===(e=document.getElementById("yandex-context-script"))||void 0===e||e.addEventListener("load",(()=>{this._initBranding()})),this._initBrandingCampaignAnalytics()}_calcHeight(){this._headerHeight=this.$el.height(),this.$el.css("--header-full-height",`${this._headerHeight}px`)}_getExtraMenuItems(){return(0,m.filter)(this.$els.menuItems,(t=>t.offsetTop>0))}_onUpdateElements(t){"story-editor"!==s.core.initParams.pageName&&(this.isCollapsedShown=0!==t.valueOf());let e=t.has(T.SEARCH_HOVER),i=t.has(T.SEARCH_FOCUS),n=this._searchInput&&this._searchInput.isEmpty,r=e||i&&!n;this._searchShown!==r&&(this._searchShown=r,this.emit("searchbar-shown",r),this.$els.search.el.toggleClass("header-right-menu__search_focus",r),setTimeout((()=>{this._searchBtnEnabled=r}),200),r&&!i?this._searchInput.focus():!r&&i&&this._searchInput.blur())}_toggleExtraMenu(){const t=()=>(0,m.filter)(this.$els.menuItems,(t=>t.offsetTop>0)),e=0===t().length;if(this.$els.extra.hide(),e)return this;this.$els.menuItems.eq(this.$els.menuItems.length-t().length).before(this.$els.extraWrapper),this.$els.extra.show();const i=t();return this._extraMenu.content=Y(document.createElement("div")).addClass("menu menu_vertical menu_multiline").append((0,m.map)(i,(t=>{const e=Y(t);return e.children().clone().addClass("menu__item").data("feed-key",e.data("feed-key")).click((e=>{if("courses"===t.dataset.type)return void c.c.getInstance().sendEvent("click",{button:"courses"});const i=Y(e.currentTarget).data("feed-key"),s=x.L[i];s&&(c.c.getInstance().sendEvent("transition_to_tab",{type:i,level:s,transition_source:"header"}),N.dV.send("transitionToTab",{level:s}))})).toggleClass("menu__item_current",e.hasClass("header-menu__item_current"))}))),this}_initExtraMenu(){return this._extraMenu||(this._extraMenu=new A.gR({delay:100,target:this.$els.extra,direction:A.Lh.BOTTOM,width:180,interactive:!0,destroyAfterHide:!1}),this.listenTo(this._extraMenu,"_eventAll",this._onElementEvent.bind(this,T.EXTRA_MENU)),this.listenTo(s.core.ui,"visibilitychange",(t=>{t?(this._clearSearchTimer(),this._toggleSearch(!1)):this._toggleExtraMenu()})),this._toggleExtraMenu()),this}_onElementEvent(t,e){e===n.eM.MOUNTED&&this._activeElements.set(t),e===n.eM.UNMOUNTED&&this._activeElements.remove(t)}_toggleSearch(t){!t&&this._extraMenu&&this._extraMenu.isShown||(this._activeElements.toggle(T.SEARCH_HOVER,t),requestAnimationFrame((async()=>{this.$els.extra.hide(),setTimeout((()=>{this._toggleExtraMenu()}),500)})))}_clearSearchTimer(){this._searchTimerId&&(clearTimeout(this._searchTimerId),this._searchTimerId=0)}_initSearch(){this._searchInput=new w.u3({$el:this.$els.search.el,suggestion:new b.DC({maxHeight:500,minQueryLength:2})}),this.listenTo(this._searchInput.suggestion,b.nT.SELECT,(t=>{if(!t)return;let e;switch(t.data.type){case"user":e=`/@${t.data.name}`;break;case"community":e=`/community/${t.data.link}`;break;case"tag":const i=t.data.name;F.v.createSearchSession().sendSearchEvent("",{tags:[i]}),e=`/tag/${encodeURIComponent(i)}`}e?s.core.history.location.href=e:this.$els.search.form.trigger("submit")})),this.listenTo(this._searchInput,"focus",(()=>{this._activeElements.set(T.SEARCH_FOCUS)})),this.listenTo(this._searchInput,"blur",(()=>{this._activeElements.remove(T.SEARCH_FOCUS)})),this.$els.search.form.on("submit",(()=>{F.v.createSearchSession().sendSearchEvent(this._searchInput.value)}));let t=!1;this.$els.search.btn.click((t=>{this._searchBtnEnabled||t.preventDefault()}));const e=e=>{const i="mouseenter"===e.type;if(this._clearSearchTimer(),i===t&&e.target!==this.$els.extra[0])return!1;t=i,this._toggleExtraMenu(),this._searchTimerId=setTimeout(this._toggleSearch.bind(this),i?200:2e3,i)};return this.$els.search.el.hover(e),this.$els.extra.mouseleave(e),this._initMenuPositionFix(),this}_initMenuPositionFix(){const t=this.$els.menu.get(0);this.on("searchbar-shown",(e=>{if(!e)return;const i=t.offsetLeft+parseInt(window.getComputedStyle(t).paddingLeft);t.style.setProperty("width","100%"),t.style.setProperty("padding-left",i+"px")})),this.$els.search.el.on("transitionend transitioncancel",(({originalEvent:e})=>{"width"!==e.propertyName||this._searchShown||(t.style.removeProperty("width"),t.style.removeProperty("padding-left"))}))}_initProfileMenu(){const t={target:this.$els.avatar,direction:A.Lh.BOTTOM,alignment:A.SE.END,interactive:!0,destroyAfterHide:!1,delay:200,content:I({from:"avatar-menu",userName:s.core.initParams.userName,answersBell:Y('.menu__item[href="/answers"] > .bell').clone().prop("outerHTML")})},e=new A.gR(t);return e.content.find('.menu__item[data-role="logout"]').click(k.n.logout),e.content.find("[data-menu-item]").on("click auxclick",(t=>{0!==t.button&&1!==t.button||c.c.getInstance().sendEvent("click",{component_name:"profile_menu",menu_item:t.currentTarget.dataset.menuItem})})),this.listenTo(e,"_eventAll",this._onElementEvent.bind(this,T.PROFILE)),this.listenTo(e,n.eM.MOUNTED,(()=>{c.c.getInstance().yandex.goal("avatar-menu-open")})),this}_initWelcomeNotification(){if(!this.$els.notifications.length)return;const t="header-welcome";let e=(0,B.jE)().filter((({id:e})=>e===t)).length>0;e||(this.$els.notificationsBell=Y('<span class="bell">1</span>'),this.$els.notifications.append(this.$els.notificationsBell).addClass("header-right-menu__notification_active"));const i={};i.isNew=!e,i.datetime=new Date(Date.now()).toISOString(),i.dateFormat=V(i.datetime);const s=new A.gR({target:this.$els.notifications,content:O(i),destroyAfterHide:!1,showArrow:!1,width:350,distance:5,interactive:!0}),r=()=>{e||((0,B.Ri)(t),e=!0)};this.$els.notifications.click(r),s.content.on("click",(({target:t})=>{t.classList.contains("to-signup")&&s.hide(),t.classList.contains("notifications-hint__more-link")&&r()}));let o=0,a=!1;this.listenTo(s,n.eM.MOUNTED,(()=>{if(!this.$els.notificationsBell.length||a)return;o=setTimeout((()=>{r(),this.$els.notificationsBell.remove(),s.content.find(".notifications-hint__body").attr("data-is-new","false"),o=0,a=!0}),2e3)})),this.listenTo(s,n.eM.UNMOUNTED,(()=>{o&&(clearTimeout(o),o=0)}))}get _notificationBellCount(){return this.$els.notificationsBell.is(":visible")?Number(this.$els.notificationsBell.data("count")):0}_sendNotificationShownAnalytics(){c.c.getInstance().yandex.goal("notification_popup_view"),c.c.getInstance().sendEvent("reach_element",{type:"notification_popup",comments:this._notificationBellCount})}_initNotifications(){const t=new A.gR({target:this.$els.notifications,content:(s.core.initParams.userName,'<div class="notifications-hint">\n\t<div class="notifications-hint__loading">\n\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__progress-circle icon--ui__progress-circle_notifications"><use xlink:href="#icon--ui__progress-circle"></use></svg>\n\t</div>\n\t<div class="notifications-hint__body"></div>\n\t<div class="notifications-hint__more">\n\t\t<a\n\t\t\tclass="pkb-normal-btn pkb-normal-btn_gray pkb-normal-btn_wide"\n\t\t\thref="/notifications"\n\t\t>\n\t\t\tПоказать все уведомления\n\t\t</a>\n\t</div>\n</div>'),destroyAfterHide:!1,showArrow:!1,width:350,distance:5,interactive:!0});this.listenTo(t,"_eventAll",this._onElementEvent.bind(this,T.NOTIFICATIONS));let e=!1,i=[];return this.listenTo(t,n.eM.MOUNTED,(async()=>{if(this._sendNotificationShownAnalytics(),e)return void this._startNotificationsTimerEvent(t,i);const n=Date.now();let r=!1;try{i=await k.n.getNotifications(1)}catch(a){s.core.ui.toasts.showError(a)}await h.Utils.delay(500-(Date.now()-n));const o=i.slice(0,1).reduce(((t,e)=>(e.dateFormat=V(e.datetime),e.fa=e.icon||G[e.type]||"fa-envelope-o",e.is_new&&(r=!0),t+function(t){var e,i="",s=$.escape;return Array.prototype.join,i+='<div class="notification"> ',i+='\n\t<div class="notification__main">\n\t\t<div class="notification__header">\n\t\t\t<div class="notification__icon notification__icon_inline">\n\t\t\t\t',t.icon&&t.icon!==t.fa?i+='\n\t\t\t\t<img width="34" height="34" src="'+s(t.icon)+'">\n\t\t\t\t':i+='\n\t\t\t\t<i class="fa '+(null==(e=t.fa)?"":e)+'" aria-hidden="true"></i>\n\t\t\t\t',i+='\n\t\t\t</div>\n\t\t\t<time class="notification__datetime" datetime="'+(null==(e=t.datetime)?"":e)+'">'+(null==(e=t.dateFormat)?"":e)+"</time>\n\t\t</div>\n\t\t"+(null==(e=t.text)?"":e)+"\n\t</div>\n</div>"}(e))),"");t.content.find(".notifications-hint__loading").hide(),t.content.find(".notifications-hint__body").html(o.length?o:s.core.i18n("notifications.message")).attr("data-is-new",r).show(),t.updatePosition(),e=!0,this._startNotificationsTimerEvent(t,i)})),this.listenTo(t,n.eM.UNMOUNTED,this._stopNotificationsTimerEvent.bind(this)),this}async initNewRecsTooltip(){const t=document.getElementById("menu-subs");if(!t)return;const e=await(0,B.Qm)({id:R.j.INTERESTED_TOPICS_TOOLTIP,target:t,text:"\n\t\t\t\t<p><strong>Рекомендации Пикабу</strong></p>\n\t\t\t\t<p>Спасибо за выбор предпочтений!<br>\n\t\t\t\tРекомендованные посты ждут вас в ленте подписок.</p>\n\t\t\t",theme:A.xb.GREEN,direction:A.Lh.BOTTOM,alignment:A.SE.CENTER,delay:500,hideByScroll:!1,showOnce:!0,btnConfig:{label:"Понятно",handler:()=>{e.hide()}}});this.listenTo(e,n.eM.MOUNTED,(()=>{c.c.getInstance().sendEvent("tip_show",{type:"post_recs"})})),this.listenTo(e,n.eM.UNMOUNTED,(()=>{c.c.getInstance().sendEvent("tip_close",{type:"post_recs"})}))}_startNotificationsTimerEvent(t,e,i=!0){if(!this.$els.notificationsBell.length||this._notificationsWasTimerEvent)return;const n=e.map((({id:t})=>t)).join(",");this._notificationsTimerId=setTimeout((async()=>{try{if(await async function(t){const{data:e}=await y.cf.postOrFail("/ajax/notifications_actions.php?action=mark_read",{ids:t});return e}(n)){this._decrementNotificationsCount();const i=t.content.find(".notifications-hint__body");e.forEach((t=>{(0,W.I)(t),t.is_new=!1})),i.attr("data-is-new","false")}}catch(r){s.core.logger.log("notifications_actions.php",r)}finally{this._notificationsTimerId=0,i&&(this._notificationsWasTimerEvent=!0)}}),2e3)}_decrementNotificationsCount(){let t=this._notificationBellCount;if(1===t)this.$els.notificationsBell.data("count",0),this.$els.notificationsBell.remove();else{t--;const e=t>99?"99+":t;this.$els.notificationsBell.text(e),this.$els.notificationsBell.data("count",t)}}_stopNotificationsTimerEvent(){this._notificationsTimerId&&(s.core.logger.log("header","notifications","timer event clear"),clearTimeout(this._notificationsTimerId),this._notificationsTimerId=0)}_initBrandingCampaignAnalytics(){const t=document.getElementById("branding_ad_header");if(!t)return;const e=(0,j.m)(t,(t=>{t.isIntersecting&&(c.c.getInstance().sendEvent("show_ad",{type:"banner",content_type:"branding_campaign"}),e())}),{threshold:.5})}_initBranding(){if(window.Ya)try{const t="adfox_169341806233939701",e=document.getElementById(t),i=e?t:"adfox_156570562144159249",n={p1:e?"czdkx":"cnpjm",p2:e?"inlk":"gmxe"},r=e||document.getElementById(i);r&&(r.dataset.code=JSON.stringify(n));const o=264,a=this;window.yaContextCb.push((()=>{var t;null===(t=window.Ya)||void 0===t||t.adfoxCode.create({ownerId:260477,containerId:i,params:n,onLoad:t=>{s.core.logger.log("adfox banner onLoad",t);const e=t.bundleParams;e&&(a.$el.removeClass("header_animation"),Y(".external_branding").css({height:o,backgroundColor:e.bodyBackgroundColor,marginBottom:"-64px"}),a._isBranding=!0,a._calcHeight(),a._updateCollapsedState(),a.isCollapsed?(a.$el.removeClass("header_animation"),setTimeout((()=>{a.$el.addClass("header_animation")}),1500)):a.$el.addClass("header_dark"),a.emit("dynamic-branding"))},onRender:()=>{window.adInfoStorage=(window.adInfoStorage||new Set).add(i),L.Q.instance.watch(Y(".external_branding"),M.L.BANNER),a._calcHeight()},onError:t=>s.core.logger.log("adfox banner onError",t),onStub:()=>s.core.logger.log("adfox banner onStub")})}))}catch(t){s.core.logger.log("adfox",t)}}_updateCollapsedState(){this.isCollapsed=this.ui.scrollTop>this._collapseScrollPos,this._collapseScrollPos=this._headerHeight-2}get isCollapsed(){return this._options.isCollapsed}set isCollapsed(t){this._options.isCollapsed!==t&&(this._options.isCollapsed=t,t?setTimeout((()=>{C.$.request((()=>{this.$el.addClass("header_animation")}))}),50):(this.isCollapsedShown=!1,this.$el.removeClass("header_animation")),this._isBranding&&this.$el.toggleClass("header_dark",!t),this.$el.toggleClass("header_collapsed",t))}get isCollapsedShown(){return this._options.isCollapsedShown}set isCollapsedShown(t){this._options.isCollapsedShown!==t&&(this._options.isCollapsedShown=t,t||this._updateCollapsedState(),this.$el.get(0).classList.toggle("header_shown",t))}get hideNext(){return this._options.hideNext}set hideNext(t){this._options.hideNext!==t&&(this._options.hideNext=t)}$(t){return this.$el.find(t)}}var X=i(32022),Z=i(95411),Q=i(48218),J=i(53619);let tt,et;!function(t){t.STUCK_TO_TOP="stuckToTop",t.STUCK_TO_BOTTOM="stuckToBottom",t.STATIC="static"}(tt||(tt={})),function(t){t.UP="up",t.DOWN="down"}(et||(et={}));var it=i(44497);var st=i(74436),nt=i(43241);function rt(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ot extends nt.u{constructor(t){super(t),rt(this,"mentionsCountsMap",{comment:0,comment_reply:0,feedback:0,story:0}),rt(this,"$els",{}),rt(this,"totalUnreadMentionsCount",0),this.init(),this.render()}reduceAllCountByType(t){if(""===t)return Object.keys(this.mentionsCountsMap).forEach((t=>{this.mentionsCountsMap[t]=0})),void this.reduceCountBy(this.totalUnreadMentionsCount);const e=this.mentionsCountsMap[t];void 0!==e&&(this.reduceCountBy(e),this.mentionsCountsMap[t]=0)}getTotalUnreadMentionsCount(){return this.totalUnreadMentionsCount}getMentionsCountsMap(){return this.mentionsCountsMap}decrementMentionsByType(t){if(""===t)return;const e=this.mentionsCountsMap[t];void 0!==e&&(this.mentionsCountsMap[t]=e-1,this.reduceCountBy(1))}reduceCountBy(t){if(0===this.totalUnreadMentionsCount)return;const e=this.totalUnreadMentionsCount-t;if(e<=0)return this.$els.bell.hide(),void(this.totalUnreadMentionsCount=0);e<=99&&this.$els.bell.text(e),this.totalUnreadMentionsCount=e}init(){const t=s.core.config("modules.new-reputation-mentions")||this.mentionsCountsMap;for(const[e,i]of Object.entries(t))this.mentionsCountsMap[e]=Number(i);this.initTotalUnreadMentions()}initTotalUnreadMentions(){this.totalUnreadMentionsCount=Object.values(this.mentionsCountsMap).reduce(((t,e)=>t+e),0),this.$els.bell=g()(".bell_profile-menu")}}var at=i(91033),lt=i(51540),ut=i(14025),ht=i(85679),ct=i(12411),dt=i(83257),pt=i(7016);function mt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function _t(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?mt(Object(i),!0).forEach((function(e){gt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):mt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function gt(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const vt=i(19755);class ft{constructor(t,e){gt(this,"_isStickyAdScrolled",!1),this.ui=t,this._sidebarMarginTop=s.core.ui.css.margin,this._options={},this.$el=e,this.el=this.$el.get(0),this.$els={pageMain:vt(".main"),inner:this.$(".sidebar__inner"),accounts:this.$(".sidebar-block__account"),emailForm:this.$(".email-block"),reputationMenuItem:this.$('.menu__item[data-role="reputation"]'),top50Comments:this.$('a[data-type="top-comments"]'),dailyTopComment:this.$(".sidebar-comment-day"),footerLinks:this.$(".sidebar-block-links > .sidebar-block__content"),footerSocials:this.$(".sidebar-block-links > .sidebar-block-links__footer"),publicRatings:this.$(".sidebar-public-ratings")},this.els={pageMain:this.$els.pageMain.get(0),inner:this.$els.inner.get(0),footer:this.$(".sidebar-footer").get(0),stickyAd:this.$('[id^="adfox_"][id$="sidebar_fix"]').get(0),stickyAdWrapper:this.$(".sidebar-sticky-wrapper").get(0)},this.els.stickyAd||(this.els.stickyAd=this.$(".sidebar-footer + .sidebar-block [id^=adfox_]").get(0)),this.$els.emailForm.length&&(this._subscriptionForm=new st.o({$el:this.$els.emailForm,formClass:a.x,inputClass:w.u3,type:"sidebar_right"})),this._isBlogFeedOrStory="advert-blogs-stories"===s.core.initParams.pageName||"story"===s.core.initParams.pageName&&document.querySelector(".story").getAttribute("data-blog"),this.ui.on("resize",(0,lt.P)(this._resizeSidebar.bind(this),200)),this._resizeSidebar(),s.core.deviceType===it.me.DESKTOP&&"story-editor"!==s.core.initParams.pageName&&(this._onScroll(),this.ui.on("document-scroll",(()=>this._onScroll())),this._resizeObserver=new at.Z((()=>this._onScroll(!0))),this._resizeObserver.observe(this.el),this._isBlogFeedOrStory&&setTimeout((()=>{this.firstScroll=!0,this._onScroll()}),2500));let i=s.core.config("modules.sidebar-cookie");var n,r,o;i&&(this.$els.cookie=vt((n=i,o="",o+'<a class="sidebar-cookie hint" href="'+(null==(r=n.story_url)?"":r)+'" aria-label="'+(null==(r=n.hint)?"":r)+'" data-direction="top">\n\t<img src="'+(null==(r=n.image_url)?"":r)+'" alt="'+(null==(r=n.hint)?"":r)+'">\n</a>')).appendTo(this.$el)),this.$el.find('.social-icon[data-type="telegram"]').on("click",(()=>{c.c.getInstance().yandex.goal("tap_telegram_pk")})),this.$el.find(".sidebar-block_humor").on("click",(()=>{c.c.getInstance().sendEvent("click",{type:"humor_feed"})})),this.$el.find(".communities-links__community").on("mousedown",(t=>{const e=t.currentTarget;c.c.getInstance().sendEvent("transition_to_community",{type:"sidebar_subs",screen_index:vt(t.currentTarget).index()+1,"community_id!empty":e.dataset.id})}));const l=this.$el.find(".sidebar-achievements");if(l.length){new ut.Qp({$el:l}).show()}const u=this.el.querySelectorAll(".sidebar-block-links a");ut.DT.initSitesEventLinks(u),this.$el.find("[data-menu-item]").on("click auxclick",(t=>{if(0!==t.button&&1!==t.button)return;let e={component_name:"sidebar",menu_item:t.currentTarget.dataset.menuItem};t.currentTarget.dataset.analyticsParams&&(e=_t(_t({},e),JSON.parse(t.currentTarget.dataset.analyticsParams))),c.c.getInstance().sendEvent("click",e)})),this.$el.find("[data-button]").on("click auxclick",(t=>{if(0!==t.button&&1!==t.button)return;let e={component_name:"sidebar",button:t.currentTarget.dataset.button};c.c.getInstance().sendEvent("click",e)})),this.$el.find('.sidebar-block__alert[data-role="account-confirm"] a').on("click",(()=>{c.c.getInstance().sendEvent("click",{button:"approve_account",component_name:"sidebar"})})),this._initReputationMonitoringMenuItem(),this._initPublicRatings(),this.$els.accounts.length&&this._initAccountButtons(),this._initReadMoreButtons(),this._initAnalytics(),this._initContainerOverflowCheck(),this._initInstabilityWarning()}_initReadMoreButtons(){const t=this.el.querySelectorAll(".community-info-block-long");t.length&&t.forEach((t=>{const e=t.parentElement.querySelector(".community-info-block__read-more");e.addEventListener("click",(()=>{t.classList.remove("community-info-block-long"),e.remove()}),{once:!0})}))}_initAnalytics(){const{top50Comments:t,dailyTopComment:e}=this.$els,i="click auxclick",s=c.c.getInstance(),n=(t,e)=>s.sendEvent(t,e);if(t.on(i,n.bind(null,"click",{type:"top_comment"})),e.length){const t="sidebar_top_comment",s=e.find(".comment__user");s.on(i,n.bind(null,"transition_to_author",{type:t,author_id:Number(s.data("id"))})),e.find(".comment__link a").on(i,n.bind(null,"transition_to_post",{type:t})),e.find('.comment__tool[data-role="link"]').on(i,n.bind(null,"share_to_social_network",{type:t}))}this.$els.footerLinks.on(i,"a",(({target:t})=>{const e=t.dataset.name;if(e)s.sendEvent("click",{type:"sidebar_"+e});else if(t.dataset.button){var i;const e=null!==(i=t.closest(".sidebar-block"))&&void 0!==i&&i.classList.contains("sidebar-footer")?"sidebar_footer":"sidebar";s.sendEvent("click",{button:t.dataset.button,component_name:e})}})),this.$els.footerSocials.on(i,"a",(({target:t})=>{const e=t.href;e&&s.sendEvent("click_external_link",{type:"sidebar_socials",link:e})}))}_initReputationMonitoringMenuItem(){this.$els.reputationMenuItem.length&&(this.reputationMonitoringMenuItem=new ot({$el:this.$els.reputationMenuItem}))}_initPublicRatings(){this.$els.publicRatings.length&&(this.$els.publicRatings.on("click",".user__nick",(t=>{c.c.getInstance().sendEvent("transition_to_author",{type:t.currentTarget.dataset.analyticsType})})),this.$els.publicRatings.on("click",'a[href="/top/authors"]',(t=>{c.c.getInstance().sendEvent("click",{type:"top_users",component_name:"sidebar"})})))}_initContainerOverflowCheck(){const t=this.el,e=t.parentElement;new at.Z((0,lt.P)((()=>{if(this._scrollState!==tt.STATIC)return;const i=e.offsetHeight-t.offsetHeight;parseInt(t.style.top)>i&&(t.style.top=`${i}px`)})),100).observe(e)}_initAccountButtons(){this.$els.accounts.on("click",(async t=>{let e=vt(t.currentTarget);if(e.hasClass("sidebar-block__account_active"))return;let i=e.data("id"),{response:n}=await y.cf.post("/ajax/login_actions.php",{action:"login_as",user_id:i});n.result?window.location.reload():s.core.ui.toasts.showError(n.message)}))}refresh(){return this._resizeSidebar(),this}empty(){this.$els.inner.empty()}append(t){this.$els.inner.append(t)}_resizeSidebar(){this.$els.inner.css("width","auto"),this.$els.inner.css("width",this.$el.width()),this._onScroll(!0)}_onScroll(t=!1){this._onScrollStart();if(this._scrollState!==this._lastScrollState||this.firstScroll||t){const t=this.el,e=0;switch(this._scrollState){case tt.STUCK_TO_TOP:t.style.position="sticky",t.style.top=`${e}px`;break;case tt.STUCK_TO_BOTTOM:t.style.position="sticky",t.style.top=`calc(100vh - ${t.offsetHeight+this._getOffset()}px)`;break;case tt.STATIC:const i=this.$els.pageMain.get(0),s=Math.min(t.offsetTop,this._scrollTop)-i.offsetTop,n=Math.max(s,0);t.style.position="relative",t.style.top=`${n}px`}this.firstScroll=!1}this._updateStickyAdPosition(),this._onScrollEnd()}_onScrollStart(){this._scrollTop=this.ui.scrollTop,this._scrollDirection=this._lastScrollTop>this._scrollTop?et.UP:et.DOWN,this._scrollState=this._getScrollState()}_onScrollEnd(){this._lastScrollTop=this._scrollTop,this._lastScrollDirection=this._scrollDirection,this._lastScrollState=this._scrollState}_getScrollState(){var t;const e=this.el,i=e.offsetTop+e.offsetHeight+this._getOffset(),s=(null===(t=this.ui.header)||void 0===t?void 0:t._headerHeight)||0,n=Math.round(e.offsetTop+s)>=Math.round(this._scrollTop),r=Math.round(i)<=Math.round(this._scrollTop+this.ui.windowHeight-s);return n&&r||this._scrollDirection===et.UP&&n?tt.STUCK_TO_TOP:this._scrollDirection===et.DOWN&&r?tt.STUCK_TO_BOTTOM:this._scrollDirection!==this._lastScrollDirection?tt.STATIC:this._lastScrollState}_getOffset(){var t,e;if(null===(t=this.els.footer)||void 0===t||!t.isConnected)return 0;let i=this.els.footer.offsetHeight+this._sidebarMarginTop;if(null!==(e=this.els.stickyAd)&&void 0!==e&&e.isConnected){const t=this.els.stickyAd.offsetHeight+this._sidebarMarginTop;return i=this._isBlogFeedOrStory?0:i,this.ui.windowHeight-i-t}return this.ui.windowHeight-i}_updateStickyAdPosition(){var t;if(!this.els.stickyAdWrapper||null===(t=this.els.stickyAd)||void 0===t||!t.isConnected)return;const e=this.els.inner.getBoundingClientRect(),i=this.els.stickyAd.offsetHeight||0,s=this._scrollTop+e.bottom,n=s-i,r=this.ui.windowHeight;let o=0;const a=this._getFeedAdsBlocks();var l,u;if(!a.length)return null===(l=this.els.stickyAdWrapper)||void 0===l||l.style.setProperty("--shift",o+"px"),void(null===(u=this.els.stickyAdWrapper)||void 0===u||u.style.setProperty("--height",i+"px"));let h=0,c=document.body.scrollHeight;for(let f=0;f<a.length;f++){const t=a[f],e=t.offsetTop,i=e+t.offsetHeight;if(e<n){h=i;break}c=e}const d=c-s,p=n-h,m=Math.max(r-d,0),_=Math.max(r-p,0);_?o=-_:m&&(o=m),this.els.stickyAdWrapper.style.setProperty("--shift",o+"px"),this.els.stickyAdWrapper.style.setProperty("--height",i+"px");const g=o>s-this._scrollTop,v=g&&!this._isStickyAdScrolled;this._isStickyAdScrolled=g,v&&this._reloadStickyAd()}_getFeedAdsBlocks(){return[...this.els.pageMain.querySelectorAll("[id^=adfox_d_feed]")].map((t=>t.closest(".story"))).filter(Boolean).reverse()}_reloadStickyAd(){L.Q.instance.reload(this.els.stickyAdWrapper.querySelector(".sidebar-block_sticky"))}async _initAutoUsernameCreatePopup(){const t=c.c.getInstance(),e=await(0,B.aM)({target:this.el.querySelector(".user__info-item"),text:"Ваш никнейм создан автоматически.<br>Его можно изменить в любой момент в разделе «Настройки»",direction:o.Lh.LEFT,alignment:o.SE.CENTER,theme:o.xb.GREEN,hideByScroll:!1,autoCloseOutsideClick:!1,btnConfig:{label:"В настройки",handler:()=>{t.sendEvent("click",{button:"auto_nickname_settings"}),s.core.history.location.href="/settings/security#autonickname"}}});if(!e)return!1;const i="auto_nickname";e.once(n.eM.MOUNTED,(()=>t.sendEvent("tip_show",{type:i}))),e.once(n.eM.HIDDEN,(()=>t.sendEvent("tip_close",{type:i})))}async _initInstabilityWarning(){if(!s.core.initParams.userSignupDate||s.core.initParams.userSignupDate>=((new Date).getTime()-3*ht.mf)/1e3||R.E.has(R.j.ADBLOCK_WARNING)||!this.$els.inner.length||!(await(0,dt.Pf)()))return;const t=document.createElement("div");if(t.innerHTML=(0,ct.Z)(),t.classList.add("pkb-alert","pkb-alert_yellow","awarning-wrapper"),t.querySelector('[data-role="close"]').addEventListener("click",(()=>{t.remove(),c.c.getInstance().sendEvent("adblock_breaker_info_ok_button_tapped",{})})),t.querySelector('[data-role="moreinfo"]').addEventListener("click",(()=>{t.remove(),c.c.getInstance().sendEvent("adblock_breaker_info_detailed_button_tapped",{})})),pt.v){const e=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&(e.unobserve(t.target),c.c.getInstance().sendEvent("adblock_breaker_info_showed",{}),R.E.set(R.j.ADBLOCK_WARNING,!0))}))}));e.observe(t)}this.$els.inner.prepend(t)}$(t){return this.$el.find(t)}get maxWidth(){return this._options.width}set maxWidth(t){this._options.width!==(t=Number(t))&&(this._options.width=t,this.$el.css("max-width",t||""),this._resizeSidebar())}}var yt=i(18910),bt=i(10703);const wt=i(19755);class Et extends n.u1{constructor(t){super(t),this.show(),t.isAttachedToHeader?this.el.classList.add("scroll-up-button_mode-header-attached"):(this.el.classList.add("scroll-up-button_mode-detached"),this.listenTo(s.core.ui,"document-scroll",this._scrollHandler))}render(){return this.isRendered||(this.$el=wt(document.createElement("div")).addClass("scroll-up-button").on("click",(0,m.debounce)(this._onClick.bind(this),250,!0)).append(s.core.icon("scroll-up-button__arrow")),this.listenTo(s.core,"scroll-up-button:reset",(()=>{this.isPossibleBack=!1})),s.core.ua.firefox&&(this.el.style.height="99vh"),super.render()),this}async _onClick(){this.marks.set("scrolling",!0),this.isPossibleBack?(await s.core.ui.scrollTo(this.marks.get("last-scroll-top"),!0),this.isPossibleBack=!1):(this.isPossibleBack=!0,await s.core.ui.scrollTo(0,!0)),this.marks.delete("scrolling")}_scrollHandler(t){const e=t>80;this._isPageScrolled!==e&&(this._isPageScrolled=e,this.el.classList.toggle("scroll-up-button_scrolled",e))}get isPossibleBack(){return this._options.isPossibleBack}set isPossibleBack(t){this._options.isPossibleBack!==(t=Boolean(t))&&(this._options.isPossibleBack=t,this.$el.toggleClass("scroll-up-button_active",t),t?(this.marks.set("last-scroll-top",s.core.ui.scrollTop),s.core.ua.firefox&&(this.el.style.height=`calc(99vh + ${this._options.header._headerHeight}px)`)):(this.marks.delete("last-scroll-top"),s.core.ua.firefox&&(this.el.style.height="99vh")))}}var At=i(2889),St=i(29281),Pt=i(98858);const Ct=i(19755);class Tt extends E.vp{constructor(t){return super(),this.$el=o.Zv.isHTMLElement(t)?Ct(t):t,this.$els={controls:Ct('<div class="background__upload">\n\t<span class="attach">изменить фон</span>\n\t<span>убрать фон</span>\n</div>')},this._forbidden=this.$el.data("forbidden"),this._communityId=this.$el.data("community-id")||0,this._isCommunity=this.$el.data("is-community"),this.render(),this}render(){this.$el.attr("data-inited",!0),this.$els.controls.appendTo(this.$el),this.$els.controls.find("span:first-child").click((()=>{this._createModal(),this._modal.show()})),this.$els.controls.find("span:last-child").on("click",(async()=>{try{this._communityId?await new At.S1(this._communityId).dropBackground():this._isCommunity||await d.User.dropBackground(),this.$el.attr("data-default","true").find(".background__placeholder").css("background-image","")}catch(t){s.core.ui.toasts.showError(t)}}))}_openCropper(t){let e=s.core.ui.backgroundCropper;e.file=t,this._modal.hide(),e.show(),this._communityId||this._isCommunity?(e.data={community_id:this._communityId},e.type=St.x6.COMMUNITY_BACKGROUND):(e.type=St.x6.PROFILE_BACKGROUND,e.data=!1),this.stopListening(e),this.listenTo(e,"upload",(t=>{this.$el.removeAttr("data-default").find(".background__placeholder").css("background-image","url("+t.small.file_url+")")}))}_createModal(){if(this._modal)return this._modal;this._modal=new A.LD({header:s.core.i18n("background-attach.popup.header")});let t=Ct('<div class="background-select">\n\t<div class="background-select__upload">\n\t\t<span class="button button_success attach background-select__btn" data-role="attach">\n\t\t\tВыбрать изображение<input type="file" accept="image/*">\n\t\t</span>\n\t\t<button class="button" data-role="hide">Отмена</button>\n\t</div>\n\t<div class="background-select__note">Оптимальный размер: 1400 х 280</div>\n</div>\n'),e=t.find("input");return this.$els.dragEnterBlock=t.find(".background-select__upload"),t.find(".button").click((t=>{"attach"===Ct(t.target).data("role")?e.click():this._modal.hide()})),e.on("click",(t=>this._checkForbidden(t))),e.on("drop",(t=>this._checkForbidden(t))),e.on("change",(t=>{this._modal.hide();let e=Pt.nO.getImageFiles(t);e.length&&(t.target.value="",this._openCropper(e[0]))})),this.listenTo(s.core.ui,"dnd",(t=>{this.$els.dragEnterBlock.toggleClass("background-select__upload_drag",t),t?this.$els.dragEnterBlock.on({"dragenter dragleave":this._drag.bind(this),drop:this._drop.bind(this)}):this.$els.dragEnterBlock.off("dragenter dragleave drop")})),this._modal.content=t,this._modal}_checkForbidden(t){if(t&&t.stopPropagation(),this._forbidden)return t&&t.preventDefault(),Q.g.confirmModal({content:s.core.i18n("page-settings.background-blocked.content"),header:s.core.i18n("page-settings.background-blocked.header"),buttonsAlign:"center",maxWidth:650,buttons:[["Закрыть"]]}),!0}_drag(t){this.$els.dragEnterBlock.toggleClass("background-select__upload_drop","dragenter"===t.type)}_drop(t){if(t.preventDefault(),t.stopPropagation(),this.$els.dragEnterBlock.toggleClass("background-select__upload_drop",!1),this._checkForbidden(t))return;if(!t.originalEvent.dataTransfer||!t.originalEvent.dataTransfer.files)return;let e=t.originalEvent.dataTransfer.files,i=[];for(let s=0;s<e.length;s++)-1!==e[s].type.indexOf("image")&&i.push(e[s]);i.length&&this._openCropper(i[0])}}var kt=i(63331),Dt=i(32038);const It=i(19755);class $t extends n.u1{constructor(t={}){super(),this._clickEventName="click",this._showSourceButton=!0,this._videoData={},this._targetImage=null,this._useHistoryState=!0===t.useHistoryState}setTarget(t){return this._targetImage=It(t),this}show(){if(!this._targetImage.length&&!this.$el)return;if(this._videoData=this._targetImage.data(),It.isEmptyObject(this._videoData))return;const t=this._targetImage.closest(".comment[data-id]");var e,i,n;return this.$el=It((e={info:{id:this._videoData.id,embedUrl:this._videoData.url,host:this._videoData.host,ratio:this._videoData.ratio,thumb:this._videoData.thumb,originalLink:this._videoData.externalLink,duration:this._videoData.duration,commentId:t.data("id"),commentMeta:t.data("meta"),subsCode:t.data("story-subs-code")},options:{showSourceButton:this._showSourceButton&&this._videoData.externalLink.length}},n="",Array.prototype.join,n+='<div class="external-video-viewer">\n\t<div class="external-video-viewer__overlay"></div>\n\t<div class="external-video-viewer__wrapper">\n\t\t<div class="player player_viewer"\n\t\t\t data-type="video"\n\t\t\t data-id="'+(null==(i=e.info.id)?"":i)+'"\n\t\t\t data-size-type="story"\n\t\t\t data-source="'+(null==(i=e.info.embedUrl)?"":i)+'"\n\t\t\t data-ratio="'+(null==(i=e.info.ratio)?"":i)+'"\n\t\t\t data-duration="'+(null==(i=e.info.duration)?"":i)+'"\n\t\t\t data-comment-id="'+(null==(i=e.info.commentId)?"":i)+'"\n\t\t\t data-comment-meta="'+(null==(i=e.info.commentMeta)?"":i)+'"\n\t\t\t data-subs-code="'+(null==(i=e.info.subsCode)?"":i)+'">\n\t\t\t<div class="player__stretch" style="padding-bottom: '+(null==(i=e.info.ratio&&"youtube"!==e.info.host?100/e.info.ratio:56.25)?"":i)+'%"></div>\n\t\t\t<div class="player__logo"></div>\n\t\t\t<div class="player__play player__play_hidden"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--player__play icon--player__play_player"><use xlink:href="#icon--player__play"></use></svg></div>\n\t\t\t<div class="player__preview" style="background-image: url('+(null==(i=e.info.thumb)?"":i)+');"></div>\n\t\t\t<div class="player__state player__state_large" data-type="loading"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__progress-circle icon--ui__progress-circle_player"><use xlink:href="#icon--ui__progress-circle"></use></svg></div>\n\t\t</div>\n\t</div>\n\t<div class="external-video-viewer__button external-video-viewer__button_close">\n\t\t<svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close icon--ui__close_size-large"><use xlink:href="#icon--ui__close"></use></svg>\n\t</div>\n\t',e.options.showSourceButton&&(n+='\n\t<a href="'+(null==(i=e.info.originalLink)?"":i)+'" target="_blank" class="external-video-viewer__button external-video-viewer__button_link">\n\t\t<i class="fa fa-external-link"></i>\n\t</a>\n\t'),n+="\n</div>\n")),this.$els={player:this.$(".player"),playerBlock:this.$(".external-video-viewer__wrapper"),overlay:this.$(".external-video-viewer__overlay"),closeButton:this.$(".external-video-viewer__button_close"),linkButton:this.$(".external-video-viewer__link")},It("body").append(this.$el),s.default.ui.isPageScrollable=!1,this.$el.addClass("external-video-viewer_show"),this._useHistoryState&&(s.default.history.pushState({id:"external-video-viewer"},document.title),this.listenTo(s.default.history,"popstate",(()=>{this.hide()}))),this.$els.closeButton.on(this._clickEventName,this.hide.bind(this)),this.$els.overlay.on(this._clickEventName,this.hide.bind(this)),It(document).on("keyup.externalVideoView",(t=>{switch(t.key||t.keyCode){case"Esc":case"Escape":case 27:this.hide()}})),this._updateWidth(),this.listenTo(s.default.ui,"resize",(0,m.throttle)(this._updateWidth.bind(this,!1),400)),s.default.ui.player.init(this.$el),this}hide(){return It(document).off("keyup.externalVideoView"),this.$el?(this.$el.removeClass("external-video-viewer_show"),this.timeout("hide",s.default.ui.css.animationPopup,(()=>{this.destroy()})),s.default.ui.isPageScrollable=!0,this):this}_updateWidth(){let t=s.default.ui.windowWidth>800?800:s.default.ui.windowWidth,e=s.default.ui.windowHeight-40;e-=40,t/this._videoData.ratio>e&&(t=e*this._videoData.ratio,this.$els.playerBlock.css("max-width",t))}}class Ot extends $t{constructor(t={}){super({useHistoryState:!0})}}var xt=i(83801);const Bt=i(19755),Lt=i(30381);function Mt(t){t.$els.document.on("mouseenter",".hint",(t=>{!function(t,e=null){if(!e){const{left:i,top:s}=t.getBoundingClientRect();e={pageX:window.pageXOffset+i,pageY:window.pageYOffset+s}}const i=Bt(t);if(i.data("hint"))return t.dataset.clickToggles&&i.data("hint").hide(),!0;if(t.dataset.hintDisabled)return;const s=t.matches("time[datetime]")&&!t.hasAttribute("title")&&!t.hasAttribute("aria-label"),r=t.classList.contains("story__comments-link-icon"),o=r?A.Lh.RIGHT:A.Lh[(t.dataset.direction||"").toUpperCase()]||A.Lh.TOP,a=r?A.SE.CENTER:A.SE[(t.dataset.alignment||"").toUpperCase()]||A.SE.CENTER,l=t.dataset.delay?t.dataset.delay:800,u=s?Lt(t.getAttribute("datetime")).local().format("D MMMM YYYY [в] H:mm"):t.getAttribute("title")||t.getAttribute("aria-label"),h=A.xb[(t.dataset.theme||"").toUpperCase()]||A.xb.DEFAULT,d=Boolean(t.dataset.interactive),p=t.getAttribute("data-zindex"),m={target:t,content:Bt(document.createElement("div")).addClass("popup__hint"+(t.classList.contains("hint_left")?" popup__hint_left":"")+(r?" popup__hint_new-comment":"")).html(u),direction:o,alignment:a,theme:h,interactive:d,delay:l,zIndex:p,destroyAfterHide:1500},_=t.dataset.width;_&&(m.width=Number(_));const g=new A.gR(m);i.data("hint",g),g.onMouseEnter(e);const v=g.target.$target;g.on(n.eM.MOUNTED,(()=>{if(!t.classList.contains("hint"))return void setTimeout((()=>{g.hide()}));v.addClass("hint_shown");const e=i.data("analytics-type");e&&e.length&&c.c.getInstance().sendEvent("tooltip_popup",{type:e,position:"sidebar_right"});const s=i.data("analytics-params");s&&"object"==typeof s&&c.c.getInstance().sendEvent(i.data("analytics-event")||"tooltip_popup",s)})),g.on(n.eM.HIDDEN,(()=>v.removeClass("hint_shown")))}(t.currentTarget,t)}))}var Ft=i(47442),Rt=i(42107),Nt=(i(97314),i(2439)),jt=i(26117),Ut=i(53056);function Ht(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Vt{constructor(){Ht(this,"emitter",new Nt.v)}async loadImages(t){if(!t.length)return;if(t.every((t=>!this.isSupportedImage(t))))return this.showWrongFormatToast(),void this.emitter.emit("loading",!1);this.emitter.emit("loading",!0),this.emitter.emit("draftChecking",!0);const e=await jt.co.checkIsDraftsLimitReached();if(this.emitter.emit("loading",!1),e){if(!(await jt.a_.show({analyticsType:"drafts_limit"})))return Rt.cp.getInstance().sendEvent("tip_close",{type:"drafts_limit"}),void this.emitter.emit("draftChecking",!1)}this.emitter.emit("draftChecking",!1),this.emitter.emit("loading",!0);const{imageFiles:i,unsupportedFiles:n,limitExceeded:r}=this.getImageFiles(t),o=[];if(0===i.length)return void this.showWrongFormatToast();r&&i.length<t.length&&o.push({messageAfterReload:this.getImageLoadErorrMessage(s.core.i18n("story-editor.limits.max-images",s.core.initParams.LIMIT_MAX_MEDIA_BLOCKS_COUNT)),theme:Ft.K.DANGER}),n.length>0&&o.push({messageAfterReload:this.getImageLoadErorrMessage("формат файла не поддерживается"),theme:Ft.K.DANGER});const a=await Promise.allSettled(i.map((t=>y.ff.upload({type:"story_image",save:1,uid:0},t,{}))));this.onImagesLoaded(a,e,o)}onImagesLoaded(t,e,i){const n=[],r=[];if(t.forEach((t=>{var e,i;"fulfilled"===t.status&&null!=t&&null!==(e=t.value)&&void 0!==e&&null!==(i=e.response)&&void 0!==i&&i.result?n.push(t):r.push(t)})),r.length&&i.push({messageAfterReload:s.core.i18n("story-editor.errors.upload"),theme:Ft.K.DANGER}),!n.length)return i.forEach((t=>{s.core.ui.toasts.showError(t.messageAfterReload)})),void this.emitter.emit("loading",!1);i.length&&Ut.m.set("pkb_msar",i),this.saveDraft(n,e)}async saveDraft(t,e){const i=t.map((({value:{data:{small:t}}})=>({id:Date.now(),type:"image",url:t.file_url,size:t.image_size,is_animated_image:!1})));try{const{draftId:t}=await jt.co.saveDraft({color_theme:0,is_adult:!1,is_authors:!1,is_donations_disabled:!1,story_id:0,is_community:!1,community_data:null,community:0,tags:"",title:"",blocks:i},e?"overwrite_oldest":void 0);s.core.history.redirect(`/add?draft_id=${t}&from=drag-and-drop`)}catch(n){this.emitter.emit("loading",!1),console.error(n)}}getImageFiles(t){const e=[],i=[],n=t.some((t=>(this.isSupportedImage(t)?e.push(t):i.push(t),e.length>=s.core.initParams.LIMIT_MAX_MEDIA_BLOCKS_COUNT)));return{imageFiles:e,unsupportedFiles:i,limitExceeded:n}}isSupportedImage(t){return t&&Pt.nO.isSupportedImage(t)&&t.size<=s.core.initParams.LIMIT_IMAGES_BYTES}getImageLoadErorrMessage(t){return`Некоторые изображения не удалось загрузить. Причина: ${t}`}showWrongFormatToast(){const t=Math.floor(s.core.initParams.LIMIT_IMAGES_BYTES/1e3/1e3);s.core.ui.toasts.showError(`Недопустимый формат файла. Требования к изображению: png, jpg, jpeg или gif не более ${t} МБ`),Rt.cp.getInstance().sendEvent("error_occured",{type:"post_create_drag_and_drop_bad_image"})}}function Wt(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class qt extends nt.u{constructor(){super(),Wt(this,"overlayEl",null),Wt(this,"_isLoading",!1),Wt(this,"storyImageDndService",new Vt),Wt(this,"isDndDisabled",!1),Wt(this,"isDraggingLocalFiles",!1),Wt(this,"visibleCommentEditors",new Set),Wt(this,"toggleIsDndDisabled",(t=>{this.isDndDisabled=t})),Wt(this,"handleDrag",(t=>{t.preventDefault(),t.stopImmediatePropagation()})),Wt(this,"handleDrop",(t=>{t.preventDefault(),t.stopPropagation(),this.storyImageDndService.loadImages(Pt.nO.File.getFiles(t))})),s.core.isUserAuthorized&&!qt.IGNORE_PAGES.includes(s.core.initParams.pageName)&&this.init()}init(){this.listenTo(s.core.ui,"dnd-drop",(t=>t.preventDefault())),this.listenTo(s.core.ui,"dnd",(t=>{this.isDndDisabled||this.isDraggingLocalFiles||(this.setOverlayVisibility(t||this.isLoading),this.isLoading||(t?(this.overlay.addEventListener("dragenter",this.handleDrag,!1),this.overlay.addEventListener("dragleave",this.handleDrag,!1),this.overlay.addEventListener("drop",this.handleDrop,!1)):(this.overlay.removeEventListener("dragenter",this.handleDrag),this.overlay.removeEventListener("dragleave",this.handleDrag),this.overlay.removeEventListener("drop",this.handleDrop))))})),this.listenTo(this.storyImageDndService.emitter,"loading",(t=>{t?(this.setOverlayVisibility(!0),this.isLoading=!0):this.setOverlayVisibility(!1)})),this.listenTo(this.storyImageDndService.emitter,"draftChecking",this.toggleIsDndDisabled),this.listenTo(s.core.ui,"comment-editor-visibility",((t,e)=>{t?this.visibleCommentEditors.add(e):this.visibleCommentEditors.delete(e),this.toggleIsDndDisabled(this.visibleCommentEditors.size>0)})),document.addEventListener("dragstart",(()=>{this.isDraggingLocalFiles=!0})),document.addEventListener("dragend",(()=>{this.isDraggingLocalFiles=!1}))}setOverlayVisibility(t){this.overlay.hidden=!t,t||(this.isLoading=!1)}set isLoading(t){t!==this._isLoading&&(this.overlay.classList.toggle("dnd-overlay_loading",t),this._isLoading=t,t&&Rt.cp.getInstance().sendEvent("reach_element",{type:"drag_and_drop"}))}get isLoading(){return this._isLoading}get overlay(){return this.overlayEl||(this.overlayEl=document.createElement("div"),this.overlayEl.classList.add("dnd-overlay"),this.overlayEl.innerHTML=`\n\t\t\t<div class="dnd-overlay__container">\n\t\t\t\t<div class="dnd-overlay__content">\n\t\t\t\t\t<div class="dnd-overlay__call-to-action">\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tПеретащите сюда изображение для быстрой публикации поста\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t${s.core.icon("ui__dnd")}\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class="dnd-overlay__loading">${s.core.icon("ui__preloader")} Загружаем изображение…</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,document.body.append(this.overlayEl)),this.overlayEl}}Wt(qt,"IGNORE_PAGES",["story-editor","community-add","community-setup","experts"]);var zt=i(58330),Yt=i(33877);const Gt=async()=>{const{response:t,data:e}=await y.cf.get("/ajax.php",{route:"recent-subscriptions"});if(!t.result)throw s.core.ui.toasts.showError(t.message),t.message;return e.ready?[...e.subscriptions]:(await(0,Yt.g)(1e3),await Gt())},Kt="fast-links",Xt=`${Kt}__item`,Zt=Xt;function Qt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Jt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Qt(Object(i),!0).forEach((function(e){te(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Qt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function te(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ee extends nt.u{constructor(t){super({el:t}),te(this,"handleClick",(t=>{if(!(t.target instanceof HTMLElement))return;if(0!==t.button&&1!==t.button)return;const e=t.target.closest("."+Zt);if(!e)return;const i=e.getAttribute("data-link"),n={c:"community_id!empty",u:"author_id!empty",ts:"type!empty"};if(e.dataset.id&&e.dataset.type&&n[e.dataset.type]){var r;const t=Array.from((null===(r=e.parentElement)||void 0===r?void 0:r.querySelectorAll(`.${Zt}`))||[]);Rt.cp.getInstance().sendEvent("compilation_tapped",Jt({screen_index:t.indexOf(e)+1,[n[e.dataset.type]]:e.dataset.id},this.getAnalyticsParams()))}i&&s.core.history.redirect(i)})),this.show()}render(){return this.isRendered||this.init(),this}async init(){var t,e;const i=zt.S.getInstance().get("UICarousel");this.carousel=new i({el:this.el}),s.core.isUserAuthorized&&await this.fetchFastLinks(),this.initObserver(),null===(t=this.carousel)||void 0===t||t.els.content.addEventListener("click",this.handleClick),null===(e=this.carousel)||void 0===e||e.els.content.addEventListener("auxclick",this.handleClick),await(0,Yt.g)(5),this.emit("initialized")}getAnalyticsParams(){return{list:this.getLinksList().slice(0,30).map((t=>t.dataset.id))}}async fetchFastLinks(){try{const t=await Gt(),e=this.getLinksList();if(!e.length)return;for(let i=0;i<t.length;i++){const s=t[i],n=e[i];n.innerHTML=this.getFastLinkTemplate(s),n.dataset.id=String(s.id),n.dataset.type=s.type,n.dataset.link="c"===s.type?`/community/${s.link}/new`:s.link}}catch(t){console.error(t)}}getFastLinkTemplate({type:t,name:e,hasUnread:i,avatarUrl:s}){const n="c"===t;let r=i?'<span class="fast-links__unread-bullet"></span>':"";if(s){const t=`<img\n\t\t\t\tloading="lazy"\n\t\t\t\tsrc="${s}"\n\t\t\t\talt="Аватар ${n?`сообщества &quot;${e}&quot;`:`пользователя ${e}}`} "\n\t\t\t\twidth="40"\n\t\t\t\theight="40">`;r+=n?t:`<span class="avatar">${t}</span>`}else r+=n?'<span class="community-avatar__default"></span>':'<span class="avatar avatar_40"><span class="avatar__default"></span></span>';return`<div class="fast-links__avatar">${r}</div>`+`<div class="fast-links__name">${e}</div>`}getLinksList(){var t;return(null===(t=this.carousel)||void 0===t?void 0:t.els.items.filter((t=>!t.classList.contains("fast-links__item_thematic")&&!t.classList.contains("fast-links__item_topic"))))||[]}initObserver(){if(!this.el)return;const t=new IntersectionObserver((([e])=>{var i;e.isIntersecting&&(Rt.cp.getInstance().sendEvent("compilations_showed",Jt({length:null===(i=this.el)||void 0===i?void 0:i.querySelectorAll(`.${Zt}`).length},this.getAnalyticsParams())),t.disconnect())}));t.observe(this.el)}}var ie=i(39799),se=i(57443),ne=i(91904);var re=i(1206);function oe(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ae{constructor(t,e,i){oe(this,"activeIndex",-1),this.el=t,e.forEach(((e,i)=>{const s=new Image;s.dataset.index=i.toString(),s.src=e,t.appendChild(s)})),t.addEventListener("click",(t=>{if(t.target instanceof HTMLImageElement){var e;const s=parseInt(null!==(e=t.target.dataset.index)&&void 0!==e?e:"");Number.isNaN(s)||i(s)}})),(0,re.Z)(t)}setActiveItem(t){var e,i;null===(e=this.el.children[this.activeIndex])||void 0===e||e.classList.remove("gallery-viewer__thumbnail-item_active"),null===(i=this.el.children[t])||void 0===i||i.classList.add("gallery-viewer__thumbnail-item_active"),this.activeIndex=t}scrollToItem(t,e=!0){const i=this.el;if(i.scrollWidth<=i.offsetWidth)return;const s=e=>{const s="left"===e?Math.max(0,t-2):Math.min(t+2,i.children.length-1);return i.children[s]};let n;const r=s("left");if(i.scrollLeft>r.offsetLeft)n=r.offsetLeft;else{const t=s("right"),e=i.scrollLeft+i.offsetWidth,r=t.offsetLeft+t.offsetWidth;e<r&&(n=r-i.offsetWidth)}void 0!==n&&i.scrollTo({left:n,behavior:e?"smooth":"auto"})}}function le(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const ue="gallery-viewer",he={active:"gallery-viewer__item_active"},ce={active:"gallery-viewer__new-tab-button_visible"};class de extends nt.u{constructor(t){var e;super(t),le(this,"activeItemIndex",0),le(this,"isTransitionActive",!1),this.items=t.items,this.activeItemIndex=null!==(e=t.startIndex)&&void 0!==e?e:0,this.container=this.createContainer(),this.els={items:this.container.querySelector(".gallery-viewer__items"),thumbnails:this.container.querySelector(".gallery-viewer__thumbnails"),newTabButton:this.container.querySelector(".gallery-viewer__new-tab-button")}}async init(){this.items.forEach(((t,e)=>{this.els.items.appendChild(t.container),t.container.classList.add("gallery-viewer__item"),e===this.activeItemIndex&&t.container.classList.add(he.active)})),this.items.length>1&&(this.thumbnails=new ae(this.els.thumbnails,this.items.map((t=>t.previewImageUrl)),(t=>this.switchItem(t,"auto")))),document.body.appendChild(this.container),await Promise.all(this.items.map((t=>{var e;return null===(e=t.init)||void 0===e?void 0:e.call(t)}))),this.switchItem(this.activeItemIndex,"none"),this.els.newTabButton.addEventListener("click",(()=>{var t,e;null===(t=(e=this.activeItem).onOpenInNewTab)||void 0===t||t.call(e)}))}hide(){return this.container.remove(),this.items.forEach((t=>t.destroy())),this.destroy(),this}createContainer(){const t=document.createElement("div");return t.classList.add(ue),t.innerHTML='<div class="gallery-viewer__items"></div>\n<div class="gallery-viewer__thumbnails"></div>\n\n<button type="button" class="gallery-viewer__icon-button gallery-viewer__new-tab-button">\n    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__new-tab_16"><use xlink:href="#icon--ui__new-tab_16"></use></svg>\n</button>',t}switchItem(t,e){var i,s;const n=this.items[this.activeItemIndex],r=this.items[t];if(this.emit("itemSwitch"),null===(i=this.thumbnails)||void 0===i||i.setActiveItem(t),n.container.classList.remove(he.active),r.show(),r.container.classList.add(he.active),this.els.newTabButton.classList.toggle(ce.active,"onOpenInNewTab"in r),"none"!==e&&this.activeItemIndex!==t){let i;i="auto"===e?this.activeItemIndex>t?"left":"right":e,this.isTransitionActive=!0,this.animateSwitch(n,r,i).then((()=>{var t;null===(t=n.reset)||void 0===t||t.call(n),n.hide(),this.isTransitionActive=!1})).catch((()=>{}))}null===(s=this.thumbnails)||void 0===s||s.scrollToItem(t,"none"!==e),this.activeItemIndex=t}animateSwitch(t,e,i){if(!("animate"in t.container))return Promise.resolve();const s=this.els.items.style.getPropertyValue("--x")||"0",n=t.container.animate("left"===i?[{transform:`translateX(${s})`},{transform:"translateX(100%)"}]:[{transform:`translateX(${s})`},{transform:"translateX(-100%)"}],{duration:200});return e.container.animate("left"===i?[{transform:"translateX(-100%)"},{transform:"translateX(0)"}]:[{transform:"translateX(100%)"},{transform:"translateX(0)"}],{duration:200}),new Promise((t=>{n.addEventListener("finish",(()=>t()))}))}switchItemLeft(){let t=this.activeItemIndex-1;t<0&&(t=this.items.length-1),this.switchItem(t,"left")}switchItemRight(){let t=this.activeItemIndex+1;t>=this.items.length&&(t=0),this.switchItem(t,"right")}get activeItem(){return this.items[this.activeItemIndex]}}function pe(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class me extends Nt.v{constructor(t,e){super(),pe(this,"maxScaleRatio",3),pe(this,"minScale",.3),pe(this,"scale",1),pe(this,"shiftX",0),pe(this,"shiftY",0);const i=document.createElement("div");i.classList.add("gallery-image"),this.container=i,this.previewImageUrl=t,this.imageUrl=e,this.els={}}async init(){this.container.addEventListener("dragstart",(t=>{t.preventDefault()})),await this.initContainerResizeObserver()}show(){if(this.els.img)return;const t=this.previewImageUrl!==this.imageUrl,e=new Image;if(e.alt=" ",e.src=this.previewImageUrl,this.container.appendChild(e),this.els.img=e,e.addEventListener("load",(()=>{this.els.img&&(e.src===this.imageUrl&&this.emit("imageLoaded",e),this.calcMaxScale(e))})),t){const t=new Image;t.src=this.imageUrl,t.addEventListener("load",(()=>{this.els.img&&(e.src=t.src)}),{once:!0}),t.addEventListener("error",(()=>{this.els.img&&this.emit("imageLoaded",null)}),{once:!0})}}hide(){this.els.img&&(this.els.img.remove(),this.els.img=void 0)}reset(){this.setScale(1,void 0,!1),this.setShift(0,0)}handlePointerDrag(t,e){const i=this.moveImage(t,e);return{x:0!==i.dx,y:0!==i.dy}}getContentRect(){if(!this.els.img)throw Error();const{x:t,y:e,width:i,height:s}=this.calcPosition().fitSize,n=this.els.img.getBoundingClientRect();return new DOMRect(t+n.x,e+n.y,i,s)}onOpenInNewTab(){this.els.img&&window.open(this.els.img.src)}calcMaxScale(t){const e=this.calcPosition().fitSize.width/t.naturalWidth;return this.maxScale=Math.max(1,this.maxScaleRatio/e),e}calcPosition(){const t=this.els.img;if(!t)throw Error();const e=function(t,e,i,s){const n=t.width*e,r=t.height*e;return new DOMRect(t.x-(n-t.width)/2+i*e,t.y-(r-t.height)/2+s*e,n,r)}(this.containerContentRect,this.scale,this.shiftX,this.shiftY),i=function(t,e,i,s){const n=i/s;let r=0,o=0;return n>t/e?(r=t,o=r/n):(o=e,r=o*n),{width:r,height:o,x:(t-r)/2,y:(e-o)/2}}(e.width,e.height,t.naturalWidth,t.naturalHeight),s=new DOMRect(e.x+i.x,e.y+i.y,i.width,i.height);return{fitSize:i,imgContainerOffset:{top:s.top,right:this.containerSize.width-s.right,bottom:this.containerSize.height-s.bottom,left:s.left}}}setScale(t,e,i=!0){if(void 0===this.maxScale||void 0===this.minScale)return;t=Math.max(Math.min(t,this.maxScale),this.minScale);const s=this.els.img;if(!s)throw Error();const n=this.scale,r=this.scale>t;this.scale=t;const o=s.width,a=s.height;if(s.style.setProperty("--scale",t.toString()),e){const{imgContainerOffset:s}=this.calcPosition(),l=s.left<=0&&s.right<=0&&s.top<=0&&s.bottom<=0;if(i&&!l)r&&this.adjustPosition();else{const i=t/n,s=o*((i-1)/2),r=a*((i-1)/2),l=o/2,u=a/2,h=(e.x-l)/l*s,c=(e.y-u)/u*r;this.setShift(this.shiftX-h/this.scale,this.shiftY-c/this.scale)}}}setShift(t,e){var i,s;this.shiftX=t,this.shiftY=e,null===(i=this.els.img)||void 0===i||i.style.setProperty("--shift-x",t.toString()+"px"),null===(s=this.els.img)||void 0===s||s.style.setProperty("--shift-y",e.toString()+"px")}initContainerResizeObserver(){let t=!1;return new Promise((e=>{new at.Z((([i])=>{var s;this.containerContentRect=i.contentRect,this.containerSize={width:this.container.offsetWidth,height:this.container.offsetHeight},null!==(s=this.els.img)&&void 0!==s&&s.isConnected&&this.adjustPosition(),t||(t=!0,e())})).observe(this.container)}))}adjustPosition(){const{fitSize:t,imgContainerOffset:e}=this.calcPosition();let i=0;t.width<=this.containerSize.width?i=-this.shiftX*this.scale:e.left>0&&e.right<0?i=Math.max(e.right,-1*e.left):e.right>0&&e.left<0&&(i=Math.min(e.right,-1*e.left));let s=0;t.height<=this.containerSize.height?s=-this.shiftY*this.scale:e.top>0&&e.bottom<0?s=Math.max(e.bottom,-1*e.top):e.bottom>0&&e.top<0&&(s=Math.min(e.bottom,-1*e.top)),this.setShift(this.shiftX+i/this.scale,this.shiftY+s/this.scale)}moveImage(t,e){const{imgContainerOffset:i}=this.calcPosition();if(i.top>=0&&i.right>=0&&i.bottom>=0&&i.left>=0)return{dx:0,dy:0};const s={x:t,y:e};return s.x>0&&i.left<0?s.x=Math.min(s.x,-1*i.left):s.x<0&&i.right<0?s.x=Math.max(s.x,i.right):s.x=0,s.y>0&&i.top<0?s.y=Math.min(s.y,-1*i.top):s.y<0&&i.bottom<0?s.y=Math.max(s.y,i.bottom):s.y=0,this.setShift(this.shiftX+s.x/this.scale,this.shiftY+s.y/this.scale),{dx:s.x,dy:s.y}}}var _e=i(87864);class ge extends Nt.v{constructor(t){super();const e=(0,_e.m)(t);this.playerInit=e,this.container=document.createElement("div"),this.container.classList.add("gallery-video");const i=e.querySelector(".player__preview");var s,n;i instanceof HTMLImageElement?this.previewImageUrl=i.src:this.previewImageUrl=null!==(s=null==i||null===(n=i.style.backgroundImage.match(/url\(["']?([^"']*)["']?\)/))||void 0===n?void 0:n[1])&&void 0!==s?s:""}hide(){bt.XM.getPlayerFromElement(this.player).destroy(),this.player=void 0}show(){if(this.player&&this.player.isConnected)return;this.player=this.playerInit.cloneNode(!0),this.container.appendChild(this.player);const t=s.core.initParams.isVideoAutoplayMode;s.core.ui.player.init(this.container,{forceAutoPlay:t}),this.emit("init")}handlePointerDrag(){return{x:!1,y:!1}}getContentRect(){if(!this.player)throw Error();const t=this.player;return new DOMRect(t.offsetLeft,t.offsetTop,t.offsetWidth,t.offsetHeight)}}var ve=i(52764);function fe(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function ye(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?fe(Object(i),!0).forEach((function(e){be(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):fe(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function be(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class we{constructor(t,e){be(this,"staticParams",{}),this.gallery=e,this.sourceElement=t,this.init()}init(){this.initStaticParameters(),this.gallery.items.forEach((t=>{t instanceof me?this.initImageItem(t):t instanceof ge&&this.initVideoItem(t)})),this.gallery.on("itemSwitch",(()=>{this.lastItemSwitchTime=Date.now()})),this.initTime=Date.now()}initStaticParameters(){const t=this.staticParams;if(this.sourceElement.classList.contains("story")){var e;const i=this.sourceElement;t.post_id=i.dataset.storyId,t.post_donation=(0,ve.v)(i),t["type_i8!empty"]=i.dataset.subsCode,t["comments!empty"]=i.dataset.comments,t.author_id=i.dataset.authorId;const s=null===(e=i.closest(".stories-feed__container"))||void 0===e?void 0:e.querySelectorAll(".story");null!=s&&s.length&&(t["screen_index!empty"]=Array.from(s).indexOf(i))}else{const e=this.sourceElement;t.comment_id=e.dataset.id,t.comment_author_id=e.dataset.authorId;const n=e.dataset.meta;var i,s;if(n)t["post_id!empty"]=null===(i=n.match(/sid=(\d+)/))||void 0===i?void 0:i[1],t.author_id=Number(null===(s=n.match(/said=(\d+)/))||void 0===s?void 0:s[1])}}initImageItem(t){const e=this.gallery.items.indexOf(t)+1;t.on("imageLoaded",(t=>{if(!t)return;const i=t.naturalWidth,s=t.naturalHeight;this.send({item_index:e,type:"image",list_f32:[i,s]})}))}initVideoItem(t){const e=this.gallery.items.indexOf(t)+1;t.on("init",(()=>{setTimeout((()=>{var i;const s=t.player?this.getVideoType(t.player):"";this.send({item_index:e,length:null===(i=t.player)||void 0===i?void 0:i.dataset.duration,type:s})}),1)}))}send(t){let e,i;this.lastItemSwitchTime?(i=this.lastItemSwitchTime,e="gallery_transition"):(i=this.initTime,e="gallery_open"),Rt.cp.getInstance().sendEvent(e,ye(ye(ye({},this.staticParams),t),{},{create_at:i}))}getVideoType(t){const e=t.dataset.type;if("video-file"===e)return"video";if("gifx"===e)return"gif";{var i,s,n;const e=null===(i=bt.XM.getPlayerFromElement(t))||void 0===i?void 0:i._providerType;return null!==(s=null==e||null===(n=e._name)||void 0===n?void 0:n.toLowerCase())&&void 0!==s?s:""}}}class Ee{static createGallery(t){return new this(t).initGallery()}constructor(t){this.target=t}async initGallery(){this.initItems(),this.beforeShow();const t=this.createGallery();return await t.init(),s.core.storage.gallery={instance:t,sourceElement:this.sourceElement},t.once("uiDestroyed",(()=>{this.onHide(),delete s.core.storage.gallery})),new we(this.sourceElement,t),t}initItems(){if(this.sourceElement=this.target.closest(".story[data-story-id]")||this.target.closest(".comment"),this.sourceElement){const t=this.sourceElement.classList.contains("comment")?this.sourceElement.querySelector(":scope > .comment__body"):this.sourceElement;this.viewableElements=Array.from(t.querySelectorAll('img[data-viewable="true"], .player'))}else this.viewableElements=[this.target];this.items=this.viewableElements.map((t=>t instanceof HTMLImageElement?this.createImageItem(t):this.createVideoItem(t))),this.startIndex=this.viewableElements.indexOf(this.target)}createGallery(){return new de({items:this.items,startIndex:this.startIndex})}createImageItem(t){var e;return new me(t.dataset.src||t.src,null!==(e=t.dataset.largeImage)&&void 0!==e?e:"")}createVideoItem(t){return new ge(t.playerInitHTML)}beforeShow(){document.body.classList.add("i-overlay_show"),s.core.ui.player.stop()}onHide(){document.body.classList.remove("i-overlay_show")}}class Ae extends me{async init(){await super.init(),this.initWheelHandler()}initWheelHandler(){this.container.addEventListener("wheel",(t=>{if(t.preventDefault(),t.stopPropagation(),t.ctrlKey)this.moveImage(0,-1*t.deltaY);else{const e=t.deltaY<0,i=.1*this.scale;this.setScale(this.scale+(e?i:-i),{x:t.clientX,y:t.clientY})}}))}}function Se(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Pe extends de{constructor(...t){super(...t),Se(this,"isDragging",!1),Se(this,"onKeyUp",(t=>{switch(t.key){case"Escape":this.hide();break;case"ArrowRight":this.switchItemRight();break;case"ArrowLeft":this.switchItemLeft()}}))}async init(){await super.init(),document.addEventListener("keyup",this.onKeyUp),this.initDragging()}hide(){return document.removeEventListener("keyup",this.onKeyUp),super.hide()}createContainer(){var t,e;const i=super.createContainer(),s=this._options.items.length>1;var n,r,o,a;(i.insertAdjacentHTML("afterbegin",(n={showArrowButtons:s},r="",Array.prototype.join,r+='<button type="button" class="gallery-viewer__icon-button gallery-viewer__close-button">\n    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__close_20"><use xlink:href="#icon--ui__close_20"></use></svg>\n</button>\n\n',n.showArrowButtons&&(r+='\n    <button type="button" class="gallery-viewer__icon-button gallery-viewer__scroll-button gallery-viewer__scroll-button_left">\n        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__arrow-left"><use xlink:href="#icon--ui__arrow-left"></use></svg>\n    </button>\n\n    <button type="button" class="gallery-viewer__icon-button gallery-viewer__scroll-button gallery-viewer__scroll-button_right">\n        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon--ui__arrow-right"><use xlink:href="#icon--ui__arrow-right"></use></svg>\n    </button>\n'),r+="\n")),null===(t=i.querySelector(".gallery-viewer__close-button"))||void 0===t||t.addEventListener("click",(()=>{this.hide()})),s)&&(null===(o=i.querySelector(".gallery-viewer__scroll-button_left"))||void 0===o||o.addEventListener("click",(()=>{this.switchItemLeft()})),null===(a=i.querySelector(".gallery-viewer__scroll-button_right"))||void 0===a||a.addEventListener("click",(()=>{this.switchItemRight()})));return null===(e=i.querySelector(".gallery-viewer__items"))||void 0===e||e.addEventListener("click",(t=>{this.onItemsClick(t)})),i}onItemsClick(t){this.isTransitionActive||this.isDragging||(this.activeItem instanceof Ae||!this.isPointerInsideContent(t.x,t.y))&&this.hide()}isPointerInsideContent(t,e){const i=this.activeItem.getContentRect();return t>=i.left&&t<=i.right&&e>=i.top&&e<=i.bottom}initDragging(){let t,e={x:0,y:0},i=!1;this.els.items.addEventListener("pointerdown",(s=>{0===s.button&&this.isPointerInsideContent(s.x,s.y)&&(i=!0,e={x:s.x,y:s.y},t=e)})),this.els.items.addEventListener("pointermove",(s=>{if(!i)return;if(!this.isDragging){const e=s.x-t.x,i=s.y-t.y;if(Math.abs(e)+Math.abs(i)<5)return;this.isDragging=!0}const n=s.x-e.x,r=s.y-e.y;e={x:s.x,y:s.y};const o=this.activeItem.handlePointerDrag(n,r);!o.x&&!o.y||this.els.items.hasPointerCapture(s.pointerId)||this.els.items.setPointerCapture(s.pointerId)}));const s=()=>{i=!1,this.isDragging&&setTimeout((()=>{this.isDragging=!1}),1)};this.els.items.addEventListener("pointerup",s),this.els.items.addEventListener("pointercancel",s)}}class Ce extends Ee{createGallery(){return new Pe({items:this.items,startIndex:this.startIndex})}createImageItem(t){var e;return new Ae(t.dataset.src||t.src,null!==(e=t.dataset.largeImage)&&void 0!==e?e:"")}}var Te=i(72283),ke=i(55529),De=i(55576),Ie=i(99867),$e=i(81780),Oe=i(47037),xe=i.n(Oe),Be=i(82800),Le=i(33662);function Me(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Fe(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Me(Object(i),!0).forEach((function(e){Re(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Me(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Re(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Ne(t,e){let i=null,s=null,n=null,r=null,o=t;for(;o;){if(o.classList.contains("story__user-link")){i={source:"from_post_mini",show:"user_profile_mini_post"};const t=o.closest(".story");null!=t&&t.dataset.extFeed&&(s={component_name:"extension",screen:t.dataset.extFeed}),n=Number(o.dataset.id)}o.classList.contains("comment__user")&&(i={source:"from_comments_mini",show:"user_profile_mini_comments"},n=Number(o.dataset.id)),o.classList.contains("sidebar-comment-day")&&(i={source:"mini_profile_best_comment_daily",show:"user_profile_mini_best_comment_daily"},r=Number(o.dataset.id)),o.classList.contains("comment")&&(r=Number(o.dataset.id)),o=o.parentElement}if(i&&n){var a,l,u;Rt.cp.getInstance().sendEvent("form_show",Fe({type:null===(a=i)||void 0===a?void 0:a.show,author_id:n,"comment_id!empty":r},s)),e.find(".profile__nick a").on("click auxclick",(t=>{var e;0!==t.button&&1!==t.button||Rt.cp.getInstance().sendEvent("transition_to_author",Fe({type:null===(e=i)||void 0===e?void 0:e.source,author_id:n},s))}));const t=s?JSON.stringify(Fe({type:null===(l=i)||void 0===l?void 0:l.source},s)):null;null===(u=e.get(0))||void 0===u||u.querySelectorAll('[data-role="subscribe"], [data-role="ignore"], .profile__user-notification-bell').forEach((e=>{var s;e instanceof HTMLElement&&(e.dataset.analyticsType=null===(s=i)||void 0===s?void 0:s.source,t&&(e.dataset.analytics=t))}))}}var je=i(75130);class Ue extends nt.u{constructor(t){super(t),this.init()}init(){var t,e;if(!this.el)return;const i=(0,j.m)(this,(t=>{t.isIntersecting&&(c.c.getInstance().sendEvent("tip_show",{type:"reg_disable_pin_text"}),i())}),{threshold:[0,1]});null===(t=this.el.querySelector(".pkb-alert__close"))||void 0===t||t.addEventListener("click",(()=>{var t;(new je.U).set("isProfileDeprecatingAuthWarningClosed",!0),null===(t=this.el)||void 0===t||t.remove(),c.c.getInstance().sendEvent("tip_close",{type:"reg_disable_pin_text"})})),null===(e=this.el.querySelector("a"))||void 0===e||e.addEventListener("click",(t=>{0!==t.button&&1!==t.button||c.c.getInstance().sendEvent("click",{type:"go_to_help_page",component_name:"reg_disable_pin_text"})}))}}function He(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Ve(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?He(Object(i),!0).forEach((function(e){We(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):He(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function We(t,e,i){return e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const qe=i(19755);class ze extends o.Zv{constructor(){var t;super(),this.$els=Ve(Ve({},null!==(t=this.$els)&&void 0!==t?t:{}),{app:qe(".app"),appInner:qe(".app__inner"),sidebar:qe(".sidebar_right"),sidebarAuth:qe(".sidebar-auth"),main:qe(".main"),footer:qe(".footer"),emailBlock:qe("#subscribe-email"),authModal:qe("#auth-modal"),restoreButton:qe('[data-restore="true"]'),fastLinks:qe(".fast-links_carousel")}),this._hotkeys=void 0,Mt(this),g()(document).on("mouseenter",'.user__nick[data-profile="true"], .user[data-profile="true"], .comment__user[data-profile="true"], .avatar[data-profile="true"][data-name], .user-call[data-profile="true"][data-name], .users-list__nick-inner[data-profile="true"][data-name]',(async t=>{const e=t.currentTarget;if(!e)return;const i=g()(e),n=e.querySelector(".user__nick")||e;if(!n||i.data("hint"))return;const r=String(i.attr("data-name")||n.textContent),o=d.User.getMiniProfile(r),a=xe()(o),l=t=>{const e=(0,_e.m)(t),i=e.querySelector(".mini-profile__note-inner");return i&&(i.innerHTML=d.User.noteValueToHtml(i.innerText,{commentLinks:!0,cropLinks:!0})),e},u=new A.gR({interactive:!0,target:i,direction:Be.Lh.TOP,content:a?l(o):g()(document.createElement("div")).addClass("popup__user-hint").html(s.core.icon("ui__progress-circle","user-hint")),destroyAfterHide:3e3}),h=()=>{const t=new Ie.J1({parentHint:u,notificationBellOptions:{el:u.content.find(".mini-profile__user-notification-bell")[0],user:new d.User(u.content.find(".mini-profile").data("user-id")),showHint:!0,profileType:"author_mini_profile"}});s.core.listenToOnce(u,$e.e.DESTROYED,(()=>{s.core.ui.showedProfile=null,t.destroy()}))},c=()=>{var t;null===(t=u.content.find(".mini-profile__support-btn")[0])||void 0===t||t.addEventListener("click",(t=>{var e;u.hide(),Rt.cp.getInstance().sendEvent("author_donation_button_tapped",{type:"author_support",component_name:"user_profile",subscribers:null===(e=t.target)||void 0===e?void 0:e.dataset.subsCount}),(0,De.B)({authorId:u.content.find(".mini-profile").data("user-id"),supportType:"subscribe",giveChoice:!0})}))};if([Le.AJ.COMMENTS,Le.AJ.STORIES].forEach((t=>{s.core.listenTo(s.core,t,(()=>{u.hide(),d.User.flushMiniProfilesCache()}))})),s.core.ui.showedProfile&&(s.core.ui.emit("close-extra-menu"),s.core.ui.showedProfile.canHide=!0,s.core.ui.showedProfile.hide(),s.core.ui.showedProfile instanceof A.gR&&s.core.ui.showedProfile.destroy()),s.core.ui.listenTo(s.core.ui,"subscribe-menu-open",(t=>{t?u&&(u.canHide=!1):u&&(u.canHide=!0)})),i.data("hint",u),u.onMouseEnter(t),s.core.ui.showedProfile=u,a)return h(),Ne(e,u.content),void c();if(await(0,Yt.g)(500),u.isDestroyed)return!1;try{const t=await o;if(u.isDestroyed)return!1;u.content=l(t),h(),Ne(e,u.content),c(),u.isShown&&(u.updateWidth(),u.updatePosition())}catch(D){u.destroy()}})),this._attachTagMenu(),this._attachPaginationHotkey(),this.overlays={hint:new A.aI({$parent:this.$els.body,zIndex:6002}),balloon:new A.aI({$parent:this.$els.body,zIndex:6001}),modal:new A.aI({$parent:this.$els.body,zIndex:6e3})},this.$els.restoreButton.on("click",(t=>{t.preventDefault(),this._attachRestoreAccount()})),this._marginBody=0,this.listenTo(this.overlays.modal,"show",(()=>this.isPageScrollable=!1)),this.listenTo(this.overlays.modal,"hide",(()=>this.isPageScrollable=!0)),this.auth=void 0,this._attachImageViewer(),this._attachExternalVideoViewer(),this._attachAddButtons(),this.attachSubscribeButtons(),this._attachCommunityInfoBlock(),this._attachLabels(),this._attachRouteLinks(),this._attachTagsCut(),this._attachImageNewTab(),this._attachPageUpDown(),this._attachBestComment(),this._detectUserIsLeaving(),this._initFastLinksCarousel(),new Ue({el:this.$els.main.find(".deprecating-auth-warning").get(0)}),s.core.ua.mac&&document.querySelectorAll('input[type="password"]').forEach((t=>{t.type="text",t.style.webkitTextSecurity="disc"})),setTimeout((()=>{s.core.isUserAuthorized&&Te.o.runActions()}),100)}authRequired({analyticsParams:t,formType:e,redirectUrl:i,triggeredAction:n}={}){if(s.core.initParams.isDeleted)return this.modalRestore||this._attachRestoreAccount(),this.modalRestore.show(),void c.c.getInstance().sendEvent("form_show",Ve({type:"restore_account",component_name:"popup"},t));this.authModal?(this.authModal.modal.zIndex=(0,ke.e)(),"signIn"===e?this.authModal.showSignIn({analyticsParams:t,redirectUrl:i,triggeredAction:n}):this.authModal.showSignUp({analyticsParams:t,redirectUrl:i,triggeredAction:n})):this.toasts.showWarningMessage(s.ZF.AUTHORIZATION_REQUIRED)}_scrollHookHandler(t,e){t===E.ZK.FIRST_ON?window.addEventListener("scroll",e,{passive:!0}):window.removeEventListener("scroll",e)}_attachBestComment(){qe(".comment__show-all").on("click",(t=>{t.preventDefault(),qe(t.currentTarget).hide().prev().removeClass("comment__content_overflow")}))}_detectUserIsLeaving(){document.addEventListener("mouseout",(t=>{null===t.relatedTarget&&t.clientY<50&&c.c.getInstance().clickhouse.sendImmediately()}))}_attachPageUpDown(){this.marks.set("page-boost",0);let t=(0,m.throttle)(((t=!0)=>{if(!this.marks.get("page-scrolling"))return;let e=this.marks.get("page-boost")+1;this.marks.set("page-boost",e),qe(document.documentElement).animate({scrollTop:this.scrollTop+100*e*(t?1:-1)},100,"linear"),document.activeElement.blur()}),110);this.hotkeys.on("c",(()=>{this.marks.set("page-scrolling",!0),t(!0),this.marks.set("page-boost",0)}),{type:Z.FM.KEYDOWN,repeat:!0}),this.hotkeys.on("z",(()=>{this.marks.set("page-scrolling",!0),t(!1),this.marks.set("page-boost",0)}),{type:Z.FM.KEYDOWN,repeat:!0})}_attachPaginationHotkey(){let t=t=>{let e=qe(`.pagination__to[data-role="${t}"]`);1!==e.length||e.hasClass("pagination__to_disabled")||(e.click(),s.core.history.location.href=e.attr("href"))};this.hotkeys.on("alt+left",t.bind(this,"prev")),this.hotkeys.on("alt+right",t.bind(this,"next")),this.hotkeys.on("alt+a",t.bind(this,"prev")),this.hotkeys.on("alt+d",t.bind(this,"next"))}_attachAuth(){if(this.$els.sidebarAuth.length&&(this.auth=new X.h(this.$els.sidebarAuth.parent()),this.auth.show()),this.$els.authModal.length){const[t]=this.$els.authModal,e=t.content.cloneNode(!0);this.authModal=new ie.B({template:e,componentName:"feed_popup"})}return this}_attachProfile(){return this.$els.app.on("click",".user__exit",(async t=>{const e=t.currentTarget;if(this.marks.has("confirm-logout"))return;if(!e.getAttribute("data-confirm"))return void(await d.User.logout());this.marks.set("confirm-logout",!0);const i=await Q.g.confirmBalloon({target:e,content:"Вы действительно хотите выйти?",buttons:[["Выйти",yt.jM.DANGER,!0],["modal.cancel"]],maxWidth:300});this.marks.delete("confirm-logout"),i&&await d.User.logout()})),this}_attachRestoreAccount(){this.modalRestore=new A.LD({content:`<p class="restore-account">\n\t\t\tВаш аккаунт удален. У вас осталось ${s.core.initParams.remainingRestoringDays}\n\t\t\t${s.core.i18n("plural.days",s.core.initParams.remainingRestoringDays)} на восстановление,\n\t\t\tпосле чего аккаунт станет недоступен. Желаете восстановить аккаунт?</p>`,wrapperExtraClass:"popup_remove-account popup_remove-account-thin",zIndex:7e3}),this.modalRestore.addButtonIntoFooter(s.core.i18n("modal.restore"),(async()=>{this.modalRestore.hide();await se.c.restoreAccount()&&(this.toasts.add({content:s.core.i18n("warning-message.RESTORE"),theme:Ft.K.DEFAULT,closeAfter:3e3}),setTimeout((()=>{s.core.history.location.href="/"}),3e3))}),yt.jM.SUCCESS),this.modalRestore.addCloseButtonIntoFooter(s.core.i18n("modal.cancel")),this.modalRestore.show()}_attachImageViewer(){return this.$els.document.on("click",'img[data-viewable="true"]',(t=>{t.shiftKey||t.ctrlKey||t.metaKey||(t.preventDefault(),t.stopPropagation(),ne.V.isUserInExperiment(ne.t.GALLERY)?Ce.createGallery(t.currentTarget):(new J.p).setTarget(t.currentTarget).show())})),this}_attachImageNewTab(){this.$els.document.on("click auxclick",".image-link",(t=>{s.core.ua.firefox||(t.preventDefault(),t.stopPropagation(),(1===t.button||t.ctrlKey||t.metaKey)&&window.open(t.currentTarget.getAttribute("href"),"_blank"))}))}_attachExternalVideoViewer(){return this.$els.document.on("click",'[data-external-video="true"]',(t=>{t.shiftKey||t.ctrlKey||t.metaKey||(t.preventDefault(),t.stopPropagation(),(new Ot).setTarget(t.currentTarget).show())})),this}_attachTagMenu(){let t,e;this.$els.document.on("mouseenter",'[data-tag-menu="true"]',(i=>{let n=qe(i.currentTarget);e=String(n.data("tag")),n.data("hint")||(t=new kt.Z({delay:1200,target:n,direction:A.Lh.TOP,alignment:A.SE.START,interactive:!0,tag:e,content:qe(document.createElement("div")).addClass("popup__tag-menu").html(s.core.icon("ui__progress-circle","user-hint"))}),n.data("hint",t),t.onMouseEnter(i))}))}_attachAddButtons(){return this.$els.document.on("click",".button_add",(t=>{if(!s.core.isUserAuthorized)return t.preventDefault(),this.authRequired({analyticsParams:{reason:"publish"}}),void c.c.getInstance().sendEvent("click",{type:"post_add"});const e=t.target.dataset.type||"main_sidebar";c.c.getInstance().sendEvent("click_create_post",{type:e})})),this.$els.document.on("click",".community__add-story",(t=>{if(!s.core.isUserAuthorized)return t.preventDefault(),this.authRequired({analyticsParams:{reason:"publish",community_id:t.currentTarget.dataset.id}}),void c.c.getInstance().sendEvent("click",{type:"post_add"});c.c.getInstance().sendEvent("click_create_post",{type:"comm_description"})})),this}_attachCommunityInfoBlock(){return this.$els.document.on("click",".community-info-block__rules-header",(t=>{let e=qe(t.currentTarget),i=e.find("i"),s=i.hasClass("fa-angle-up");i.toggleClass("fa-angle-up",!s).toggleClass("fa-angle-down",s),e.next().slideToggle(200)})),this}_attachLabels(){return this.$els.document.on("click","label",(t=>{const e=t.currentTarget;if(!e||!e.htmlFor)return;const i=document.getElementById(e.htmlFor);i&&"true"===i.contentEditable&&i.focus()})),this}get profileAvatarCropper(){let t=this._options.profileAvatarCropper;return t||(t=this._options.profileAvatarCropper=new St.hA({outputSize:[256,256],type:St.x6.PROFILE_AVATAR,indent:!0})),t}get communityAvatarCropper(){let t=this._options.communityAvatarCropper;return t||(t=this._options.communityAvatarCropper=new St.hA({outputSize:[256,256],type:St.x6.COMMUNITY_AVATAR,indent:!0})),t}get backgroundCropper(){let t=this._options.backgroundCropper;return t||(t=this._options.backgroundCropper=new St.hA({outputSize:[1400,280],type:St.x6.PROFILE_BACKGROUND,indent:!0})),t}_attachChangeProfileAvatar(){let t=(0,m.map)(qe('.avatar[data-editable="true"]'),(t=>qe(t))),e=(0,m.map)(qe('.avatar[data-own="true"]'),(t=>qe(t)));return t.filter((t=>!t.data("inited"))).forEach((t=>{let i=qe(document.createElement("input")).attr("type","file").attr("accept","image/*").on("click",(t=>t.stopPropagation())).on("change",(t=>{let i=Pt.nO.getImageFiles(t);i.length&&(t.target.value="",this.profileAvatarCropper.file=i[0],this.profileAvatarCropper.show(),this.stopListening(this.profileAvatarCropper),this.listenTo(this.profileAvatarCropper,"upload",(t=>{e.forEach((e=>{let i=e.find("img"),s=t.large.file_url;i.length||(i=qe(document.createElement("img")).appendTo(e),e.find(".avatar__default").remove()),e.hasClass("avatar_large")&&(s=t.share.file_url),i.attr("src",s)}))})))}));t.attr("data-inited",!0).append(qe(document.createElement("div")).addClass("avatar__upload attach").append(s.core.icon("ui__photo","avatar")).click((()=>i.click())).append(i))})),this}_attachChangeCommunityAvatar(){return(0,m.map)(qe('.community-avatar[data-editable="true"]'),(t=>qe(t))).filter((t=>!t.data("inited"))).forEach((t=>{let e=t.data("community-id"),i=Boolean(e),n=qe(document.createElement("input")).attr("type","file").attr("accept","image/*").on("click",(t=>t.stopPropagation())).on("change",(s=>{let n=Pt.nO.getImageFiles(s);n.length&&(s.target.value="",this.communityAvatarCropper.data={community_id:e||0,save:Boolean(e)?1:0},this.communityAvatarCropper.file=n[0],this.communityAvatarCropper.show(),this.stopListening(this.communityAvatarCropper),this.listenTo(this.communityAvatarCropper,"upload",(s=>{let n=i?qe('.community-avatar[data-community-id="'+e+'"]'):t,r=i?s.small.file_url:s.tmp_file_url;(0,m.forEach)(n,(t=>{let e=qe(t),i=e.find("img"),s=r;i.length||(i=qe(document.createElement("img")).appendTo(e),e.find(".community-avatar__default").remove()),i.attr({src:s,class:"image-loaded"})})),i||t.find('input[type="hidden"]').val(s.tmp_file_name)})))}));t.attr("data-inited",!0).append(qe(document.createElement("div")).addClass("community-avatar__upload attach").append(s.core.icon("ui__photo","avatar")).click((()=>n.click())).append(n))})),this}_initFastLinksCarousel(){if(0===this.$els.fastLinks.length)return;const t=new ee(this.$els.fastLinks.get(0)),e=this.$els.fastLinks.get(0).querySelectorAll(".fast-links__item_topic");e.length>0&&t.once("initialized",(()=>{e.forEach((t=>{t instanceof HTMLElement&&t.querySelectorAll(".fast-links__avatar-skeleton, .fast-links__name-skeleton").forEach((t=>t.classList.remove("fast-links__avatar-skeleton","fast-links__name-skeleton")))}))}))}_attachChangeBackground(){return qe('.background[data-editable="true"]').not('[data-inited="true"]').each(((t,e)=>{new Tt(e)})),this}init(){if(super.init(),this.$els.appInner.hasClass("app__inner_wide")||(this.sidebar=new ft(this,this.$els.sidebar)),this.toasts=new f.e,this._showToastAfterReload(),this._showToastListAfterReload(),this.header=new K(this),this.player=new bt.XM,s.core.initParams.isScrollTopBtn){let t;t=this.header.$el.length?{isAttachedToHeader:!0,$parent:this.header.$el,header:this.header}:{$parent:this.$els.body},new Et(t)}if(s.core.isUserAuthorized?this._attachProfile()._attachChangeProfileAvatar()._attachChangeCommunityAvatar()._attachChangeBackground():this._attachAuth(),!this.isEmbedded&&xt.x&&(this._themePicker=new v({$parent:qe("body")}),this._themePicker.show(),this.listenTo(this.themeSettings,"external-change",(()=>{this._themePicker.destroy(),this._themePicker=new v({$parent:qe("body")}).show()}))),s.core.config("modules.ad-video"))try{(0,Dt.F)()}catch(e){s.core.logger.error("ads","error initializing video ads",e)}const t=qe(".sidebar-block_placeholder");return L.Q.instance.watch(t.filter(":not(.sidebar-block_sticky)"),M.L.RIGHT),L.Q.instance.watch(t.filter(".sidebar-block_sticky"),M.L.RIGHT_LAST),new qt,this._initToastsOverlayFix(),this._checkAuthError(),document.querySelectorAll('a[data-role="app-link"]').forEach((t=>{t.addEventListener("click",(()=>{let e="";this.$els.sidebar.get(0).contains(t)?e="sidebar_footer":this.$els.footer.get(0).contains(t)&&(e="footer"),c.c.getInstance().sendEvent("click",{button:"download",content_type:t.dataset.type,component_name:e})}))})),this}get hotkeys(){return this._hotkeys?this._hotkeys:this._hotkeys=new Z.SV(this.$els.document)}get isPageScrollable(){return this._options.isPageScrollable}set isPageScrollable(t){this._options.isPageScrollable!==(t=Boolean(t))&&(this._options.isPageScrollable=t,this.emit("lock-page-scroll",!t),t?this.$els.body.removeClass("i-overlay_show").css("margin-right",""):(this._marginBody=this.$els.body.outerWidth(),this.$els.body.addClass("i-overlay_show"),this._marginBody=this.$els.body.outerWidth()-this._marginBody,this._marginBody>0&&this.$els.body.css("margin-right",this._marginBody)))}_showToastAfterReload(){const t=h.LocalStorage.get("pkb_mar");t&&(this._showToast(t),h.LocalStorage.remove("pkb_mar"))}_showToastListAfterReload(){const t=h.LocalStorage.get("pkb_msar");null!=t&&t.length&&(t.forEach((t=>this._showToast(t))),h.LocalStorage.remove("pkb_msar"))}_showToast({messageAfterReload:t,theme:e,timeBeforeClose:i}={}){t&&this.toasts.add({content:t,theme:e||Ft.K.DEFAULT,closeAfter:i||3e3})}_initToastsOverlayFix(){var t;const e=null===(t=this.toasts)||void 0===t?void 0:t.$el.get(0);if(!e)return;const i=e.parentElement,s="header__messages_detached";let n=!1;const r=t=>{setTimeout((()=>{t?(e.classList.add(s),document.body.append(e)):(e.classList.remove(s),i.append(e),e.style.removeProperty("z-index"))})),n=t},o=()=>{n&&setTimeout((()=>{e.style.setProperty("z-index",(0,ke.e)())}))};this.listenTo(this.overlays.modal,"show",o);let a=0;this.on("lock-page-scroll",(t=>{a+=t?1:-1,a>0?(!n&&this.toasts.activeToasts.size>0&&r(!0),n&&o()):0===a&&n&&r(!1)})),this.toasts.on("toast-show",(()=>{!n&&a>0&&r(!0)}))}_checkAuthError(){const t=Number(s.core.initParams.oauthError),e=s.core.initParams.oauthErrorMessage||"";t&&e.length&&this.toasts.add("oauth-error",{theme:Ft.K.DANGER,closeAfter:5e3,content:e})}get activeAuth(){return this._activeAuth||this.auth}set activeAuth(t){this._activeAuth=t}}}}]);