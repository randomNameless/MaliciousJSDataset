var LogAll=function(t,e){const i=new Date;let n=i.getMilliseconds().toString();for(;n.length<3;)n="0"+n;const s=i.toTimeString().substring(0,8)+"."+n+":",r=Array.prototype.slice.call(arguments,1);if(r.unshift(s),"undefined"!=typeof LogView&&LogView.add(r.join(" ")),"undefined"==typeof console)return;(console[t]||console.log).apply(console,r)};LogAll.proxy=function(t){return function(e){try{const e=Array.prototype.slice.call(arguments);e.unshift(t),LogAll.apply(Log,e)}catch(t){}}};var ErrorCollector,Log={debug:LogAll.proxy("log"),info:LogAll.proxy("info"),note:LogAll.proxy("info"),warn:LogAll.proxy("warn"),error:LogAll.proxy("error"),server:function(t,e,i){e=e||"info";const n="/client_log",s=new FormData;s.append("exc",i?"1":"0"),s.append("msg",t.substring(0,1e3)),s.append("lvl",e),s.append("r",Math.random().toString().substring(2));const r=document.body.classList.contains("staging");if(navigator.sendBeacon&&!r)Log.debug("server log "+e+": "+t),navigator.sendBeacon(n,s);else{Log.debug("(image beacon) about to send server log entry: "+e+": "+t),s.append("old","1");let i=document.createElement("img");i.style.display="none",i.onload=function(){try{Log.debug("server log entry success: "+e+": "+t),i.onload=i.onerror=null,i=null}catch(t){}},i.onerror=function(){try{Log.debug("server log entry error: "+e+": "+t),i.onload=i.onerror=null,i=null}catch(t){}};const r=new URLSearchParams(s);i.src=n+"?"+r.toString(),i=null}}},U={trim:function(t){return $.trim(t)},isObject:function(t){return $.isPlainObject(t)},augmentObject:function(t,e,i){if(i)for(const n in i){const s=i[n];t[s]=e[s]}else for(const i in e)t[i]=e[i]},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t&&isFinite(t)},isArray:function(t){return $.isArray(t)},elt:function(t){return U.isString(t)?(t=t.replace(/\./g,"\\."),$("#"+t.toString()).get(0)):$(t).get(0)},stopEvent:function(t){const e=$.Event(t);e.stopPropagation(),e.preventDefault()},pagedataBlob:function(){return window.PagedataBlob||$("#pagedata").data("blob")||{}}};function $assert(t,e){if(!t){null==e&&(e="");confirm("Assertion failed. "+e+"\n\nSelect Cancel to debug.")}}ErrorCollector=function(t){const e={enabled:!0,sampleRate:null,maxBatchSize:3,maxBatches:3,saveDelay:5e3},i=[];let n=0,s=0,r=0,a=null,o="";for(const i in e)e.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(t[i]=e[i]);function l(){if(clearTimeout(a),a=null,!c()||!i.length)return;const e=[],r=Math.min(i.length,t.maxBatchSize);for(let t=0;t<r;t++)e.push(i[t].join("\t"));Log.server(e.join("\n"),"debug",!0),n=(new Date).getTime(),i.length=0,s++}function c(){return t.enabled&&s<t.maxBatches}return t.enabled&&null!=t.sampleRate&&Math.random()>t.sampleRate?(Log.debug("ErrorCollector: disabled due to sample rate"),t.enabled=!1):Log.debug("ErrorCollector: "+(t.enabled?"enabled":"disabled")),window.$&&(o=0,$(document).ready((function(){o=1}))),t.add=function(e,s,u){if((window.isDebug||window.Identities&&window.Identities.isAdmin())&&alert("JavaScript error: "+e+". Check the console."),c()){const c=function(t,e,i){var n;if(!t)return null;if("[object Event]"==t.toString()){t=t.message||t.msg||t.toString(),e=e||t.filename||t.file||"";const n=function(t){return 0===t?new Number(0):t};i=n(i)||n(t.lineno)||n(t.line)||""}if(e){const t=Url.toHash(e).host,i=location.host;if(!t)return null;if(!/(^|\.)(bandcamp\.com|bcbits\.com)$/.test(t)){const e=i.length-t.length;if(e<0||i.lastIndexOf(t)!=e)return null}}if("gecko"===(null===(n=window)||void 0===n?void 0:n.Browser.type)&&0===i&&(/Permission denied to access property 'toString'/.test(t)||/Location\.toString/.test(t)))return null;let s=location.href;e==s&&(s="---");let a=[];const l=window._jsb;if(l){const t=Math.min(l.length,20);for(let e=0;e<t;e++)a.push(l[e].n+":"+(l[e].c||0));t<l.length&&a.unshift("(omitted "+(l.length-t)+")")}return a=a.join(","),[t,e,i,s,++r,o,a]}(e,s,u);c?(i.push(c),function(){if(!a){const e=Math.max(n+t.saveDelay-(new Date).getTime(),250);a=setTimeout(l,e)}}()):Log.debug("ErrorCollector: skipping runtime error")}},t.enabled&&(window.onerror=t.add),t}(ErrorCollector||{});var Iter={each:function(t,e){let i=0,n=null;for(i=0;t&&i<t.length;i++)if(n=e(t[i]),n)return n},eachWithIndex:function(t,e){let i=0,n=null;for(i=0;t&&i<t.length;i++)if(n=e(t[i],i),n)return n},collect:function(t,e){e||(e=function(t){return t});const i=t.length,n=new Array(i);for(let s=0;s<i;s++)n[s]=e(t[s]);return n},find:function(t,e){const i=t.length;for(let n=0;n<i;n++)if(e(t[n]))return t[n];return null},findAll:function(t,e){const i=t.length,n=[];for(let s=0;s<i;s++){const i=t[s];e(i)&&n.push(i)}return n},index:function(t,e){if("function"==typeof t.indexOf)return t.indexOf(e);const i=t.length;for(let n=0;n<i;n++)if(t[n]==e)return n;return-1},reduce:function(t,e,i){"use strict";if("function"==typeof t.reduce)return arguments.length<3?t.reduce(e):t.reduce(e,i);let n=i,s=0;const r=t.length;if(arguments.length<3){for(;s<r&&!(s in t);)s++;if(s>=r)throw new TypeError("Reduce of empty array with no initial value");n=t[s++]}for(;s<r;s++)s in t&&(n=e(n,t[s],s,t));return n}};const _Text={notEmpty:function(t){return null!=t&&t.toString().length>0},collate:function(){for(let t=0;t<arguments.length;t++){const e=arguments[t];if(Text.notEmpty(e))return e}return""},escapeHtml:function(t){return(t=t.toString()).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},unescapeHtml:function(t){const e=document.createElement("div");return e.innerHTML=t,e.firstChild.nodeValue},markupMatch:function(t,e,i,n,s){const r=s?t.indexOf(e):t.toLowerCase().indexOf(e.toLowerCase());return-1==r?t:[t.substr(0,r),i,t.substr(r,e.length),n,t.substr(r+e.length)].join("")},regexpEscape:function(t){return t.replace(/([\\\^\$\*\+\?\.\,\:\!\|\(\)\[\]\{\}])/g,"\\$1")},truncate:function(t,e,i){return t?(null==e&&(e=50),null==i&&(i=""),t.length<=e?t:i.length>e?"":(e=Math.max(0,e-i.length),t.substr(0,e)+i)):""}};window.Text?Object.keys(_Text).forEach((t=>{if(void 0!==window.Text[t])throw new Error("problem adding ".concat(t," to Text"));window.Text[t]=_Text[t]})):window.Text=_Text;var Url={PATTERN_URL:/^(?:(https?\:)\/\/([^\:\/\?#]+)(?:\:(\d+))?)?(\/?[^\?#]*)?(?:\?|(\?[^#]*))?(?:#|(#.*))?$/,PATTERN_URL_NO_SPACE:/^(?:(https?\:)\/\/([^\:\/\?\s#]+)(?:\:(\d+))?)?(\/?[^\?\s#]*)?(?:\?|(\?[^#]*))?(?:#|(#.*))?$/,toHash:function(t,e){t=t.trim();let i=Url.PATTERN_URL.exec(t)||[];return e&&(i=Url.PATTERN_URL_NO_SPACE.exec(t)||[]),{href:i[0]||"",protocol:i[1]||"",host:(i[2]||"")+(i[3]?":"+i[3]:""),hostname:i[2]||"",port:i[3]||"",pathname:i[4]||"/",search:i[5]||"",hash:i[6]||""}},fromHash:function(t){$assert(U.isObject(t));const e=[];return t.protocol&&e.push(t.protocol,"//"),t.hostname&&e.push(t.hostname),t.port&&e.push(":",t.port),t.pathname&&e.push(t.pathname),t.search&&e.push(t.search),t.hash&&e.push(t.hash),e.join("")},isLocal:function(t){const e=Url._hashify(t);return e.protocol==location.protocol&&e.host==location.host},isFullyQualified:function(t){const e=Url._hashify(t);return e.protocol&&e.host},equals:function(t,e,i){const n=Url._hashify(t),s=Url._hashify(e);return n.protocol==s.protocol&&n.hostname==s.hostname&&(n.port||80)==(s.port||80)&&n.pathname==s.pathname&&n.search==s.search&&(i||n.hash==s.hash)},fullyQualify:function(t,e){const i=Url._hashify(t);e=e||location;const n=Url._hashify(e);if($assert(!i.protocol&&!i.hostname&&!i.port,"expected a non-qualified URL"),$assert(n.protocol&&n.hostname,"expected a fully-qualified base URL"),$(["protocol","hostname","port"]).each((function(t,e){i[e]=n[e]})),i.pathname){if("/"!=i.pathname.charAt(0)){const t=n.pathname||"/";$assert("/"==t.charAt(0),"expected a fully-qualified base URL path"),"/"==t.charAt(t.length-1)?i.pathname=t+i.pathname:i.pathname=t.replace(/[^\/]+$/,i.pathname)}}else i.pathname="/";return Url.fromHash(i)},parseQuery:function(t){const e={};return $.each(Url.parseQueryArray(t),(function(){e[this.name]=this.value})),e},joinQuery:function(t){const e=[];for(const i in t)t.hasOwnProperty(i)&&e.push({name:i,value:t[i]});return Url.joinQueryArray(e)},parseQueryArray:function(t){t=t.replace(/^[\?&\s]*(.*?)[&\s]*$/,"$1");const e=[];if(t){const i=t.split(/&+/);$.each(i,(function(){if(this&&"="!=this){const t=this.split("=");let i,n;try{i=decodeURIComponent(t[0]),n=t[1]?decodeURIComponent(t[1]):""}catch(t){return Log.error("parseQueryArray: error when decoding URL parameter, skipping; ",t),!0}e.push({name:i,value:n})}}))}return e},joinQueryArray:function(t){t=t||[];const e=[];let i;for(let n=0;n<t.length;n++)i=t[n],i&&null!=i.name&&""!=i.name&&(e.length&&e.push("&"),e.push(encodeURIComponent(i.name)),null!=i.value&&""!=i.value&&e.push("=",encodeURIComponent(i.value)));return e.join("")},addQueryParams:function(t,e){if(!e)return t;const i=t.indexOf("?")+1,n=i>0?t.substr(i):"",s=Url.parseQuery(n);for(const t in e)s[t]=e[t];return(i>0?t.substring(0,i):t+"?")+Url.joinQuery(s)},removeQueryParams:function(t,e){if(!e)return t;const i=t.indexOf("?")+1,n=i>0?t.substr(i):"",s=Url.parseQuery(n);let r=0;for(const t in e)delete s[e[t]],r+=1;if(0===r)return t;return(i>0?t.substring(0,i):t+"?")+Url.joinQuery(s)},getQueryParam:function(t,e){const i=Url.toHash(t);return Url.parseQuery(i.search)[e]},_hashify:function(t){return U.isString(t)?Url.toHash(t):t},isCustomDomain:function(t){$assert(window.siteroot,"expected siteroot");const e=t||location.hostname;return!new RegExp("\\.?"+Url.toHash(siteroot).hostname.replace(/\./g,"\\.")+"$").test(e)}},elt=U.elt,LangUtils={makeclass:function(t){return LangUtils.makesubclass(null,t)},makesubclass:function(t,e){let i=function(){};for(var n in e.ctor&&(i=e.ctor,e.ctor=null),t&&$.extend(i,t),e.prototype)i.prototype[n]=e.prototype[n];for(var n in e.statics)i[n]=e.statics[n];return i}},EventSender=LangUtils.makeclass({ctor:function(){this._listeners=[]},prototype:{get_adder:function(){const t=this;return function(e,i){t._listeners.push({callback:e,target:i})}},get_remover:function(){const t=this;return function(e,i){for(let n=0;n<t._listeners.length;)t._listeners[n].callback==e&&t._listeners[n].target==i?t._listeners.splice(n,1):n++}},fire:function(){for(let t=0;t<this._listeners.length;t++){const e=this._listeners[t];try{e.callback.apply(e.target,arguments)}catch(t){Log.debug("exception caught in event handler: "+e.callback.toString())}}}},statics:{create:function(t,e){const i=new EventSender;return i.serial=EventSender.serial++,t["on"+e]=i.get_adder(),t["remove_on"+e]=i.get_remover(),function(){i.fire.apply(i,arguments)}},serial:1}}),Form={_classDefinition:1,_allowSubmit:!1,_submitTimer:null,delaySubmitUntilReady:function(t,e,i,n){n||(n=100);const s="event: "+t.type+", delay_interval: "+n+", change_ui: "+typeof i;Log.debug("delaySubmitUntilReady: "+s),Form._allowSubmit||(U.stopEvent(t),i&&i(),e?(fn=Form.makeSubmitClosure(n,e),Form._submitTimer=setTimeout(fn,n)):alert("The page is still loading; please wait just a moment..."))},makeSubmitClosure:function(t,e){return function(){if(Log.debug("anon fn: delay interval: "+t),Form._submitTimer&&clearTimeout(Form._submitTimer),Form._allowSubmit)Log.debug("Allowing Submit"),e(null,!0);else{Log.debug("delaying "+t+" millis...");const i=Form.makeSubmitClosure(t,e);Form._submitTimer=setTimeout(i,t)}}}};window.HTML5Player=function(){"use strict";function t(t,e){this.buffer=[],this.flushInterval=e||1e4,this.tag=Math.round(Math.random()*Math.pow(2,32)).toString(16),this.name=t||"DebugLog",this.enable()}t.prototype.log=function(t){const e=new Date;let i=e.getMilliseconds().toString();for(;i.length<3;)i="0"+i;const n=e.toTimeString().substring(0,8)+"."+i;this.buffer.push(n+" : "+t)},t.prototype.flush=function(){if(this.buffer.length>0){Log.debug("DebugLog flushing "+this.buffer.length+" messages to server");const t=this.buffer;this.buffer=[];const e={tag:this.tag,name:this.name,messages:t};$.ajax({url:"/api/debug/1/clientlog",type:"post",data:JSON.stringify(e),dataType:"json",success:function(t){Log.debug("posted client log")},failure:function(t){Log.error("failed to post client log: "+t)}})}},t.prototype.disable=function(){this.interval&&(window.clearInterval(this.interval),this.interval=null),this.flush()},t.prototype.enable=function(){this.interval||(this.interval=window.setInterval(this.flush.bind(this),this.flushInterval),this.interval=null)};let e=1;function i(){const n=Browser.platform,r=Browser.make;Browser.type;let o=Cookie.get("volume");if(o&&(o=parseFloat(o,10)),this._id=e,e++,this._options={debug:!1,simulateEndedAndroid:"chrome"==r&&"android"==n,safeLoad:"androidbrowser"==r&&"android"==n,playKick:"androidbrowser"==r&&"android"==n&&Browser.version[0]<4,loadStartKick:"androidbrowser"==r&&"android"==n&&Browser.version[0]>=4,deferPlayEvents:("chrome"==r||"androidbrowser"==r)&&"android"==n||"iphone"==n,retryErrors:!0,volume:o||.7,deferredSeeks:!1,resetOnStall:!1,reloadOnSeek:!1,simulateEndedSafari:!1},i.logEnabled()&&(this._debugLog=new t("HTML5Player"),this._options.debug=!0),window.Url){const t=Url.parseQuery(location.search);for(const e in this._options)if(t.hasOwnProperty(e))if("volume"==e){const i=parseFloat(t[e]);i&&(this._options[e]=i)}else this._options[e]=!("0"==t[e]||"false"==t[e])}if(this._handlers={state:[],time:[],loaded:[],info:[],volume:[]},this._listeners=[],this._volume=this._options.volume,this._recentpos=[],this._options.debug){const t=["constructed; options: "];for(const e in this._options)t.push(e,"=",this._options[e],"; ");this._info(t.join(""))}if(this._createmedia(),this._changestate(a),"iphone"==Browser.platform){const t=this;window.addEventListener("popstate",(function(){const e=t._recentpos;if(t._state==s&&e.length&&(t.pause(),e.length>1&&0===e[e.length-1]&&e[e.length-2]>0)){const i=e[e.length-2];t._warn("detected iOS page navigation bug; resetting playhead position to "+i),t._fire_event("time",{position:i}),e.pop()}}))}this._options.safeLoad&&(this._nativeLoad=this._nativeLoadSafe)}i.prototype={load:function(t){this._debug("load()"),this._stallcount=0,this._errorRetryCount=0,this._loadedurl=t,this._wantstoplay=!1,this._recentpos.length=0,h||(this._nativePause(),this._nativeLoad(),this._changestate(n),this._nativeSrc(t),this._nativeLoad(),this._finishedloading=!1,this._loadStartKicked=!1,this._playingEventDeferred=!1)},play:function(){this._debug("play()"),h?(this._debug("locationhack"),window.location=this._loadedurl):(this._debug("wants to play? ".concat(this._wantstoplay)),this._debug("state === ".concat(this._state)),this._wantstoplay=!0,this._nativePlay())},pause:function(){this._debug("pause()"),this._cancelPlayKick(),this._wantstoplay=!1,this._nativePause()},playpause:function(){switch(this._debug("playpause()"),this._state){case s:case n:this.pause();break;default:this.play()}},stop:function(){this._debug("stop()"),this._cancelPlayKick(),this._wantstoplay=!1,this._nativePause()},seek:function(t){this._debug("seek() to "+t);let e=!1;const i=this;if(this._options.reloadOnSeek&&"&nl=1"!=this._mediaElem.src.substring(this._mediaElem.src.length-5)){let n=!1;for(let e=0;e<this._mediaElem.buffered.length;e++)if(this._mediaElem.buffered.start(e)<=t&&t<=this._mediaElem.buffered.end(e)){n=!0;break}if(!n){this._debug("refreshing with non-rate-limited URL"),this._nativePause(),this._nativeSrc(this._mediaElem.src+"&nl=1");var r=function(e){this.removeEventListener("loadedmetadata",r),i._nativeSeek(t),i._nativePlay()};this._mediaElem.addEventListener("loadedmetadata",r,!1),this._nativeLoad(),e=!0}}if(!e)if(this._options.deferredSeeks)switch(this._wantstoplay=!0,this._state){case s:case n:this._debug("doing deferred seek during playback"),this._wantseek=!0,this._wantpos=t;break;default:this._seek_inner(t)}else this._seek_inner(t)},_seek_inner:function(t){if(this.position()==t)this._debug("seek: new position ("+t+") matches current, so taking no action");else try{this._nativeSeek(t)}catch(t){this._warn("caught error seeking -- perhaps your downloader does not support byte ranges? "+t)}this.play()},position:function(){return this._mediaElem&&this._mediaElem.currentTime},state:function(){return this._state},setrate:function(t){this._mediaElem.playbackRate=t},vol_up:function(){this.setvol(this._volume+.05)},vol_down:function(){this.setvol(this._volume-.05)},setvol:function(t){if(t>1?t=1:t<0&&(t=0),this._volume!=t){this._volume=t,this._debug("setting media element volume to "+this._volume);try{this._mediaElem.volume=this._volume}catch(t){this._warn("caught exception setting volume: "+t)}}this._fire_event("volume",{volume:this._volume})},getvol:function(){return this._volume},onstate:function(t){this._add_event_handler("state",t)},ontime:function(t){this._add_event_handler("time",t)},onloaded:function(t){this._cancelReset(),this._add_event_handler("loaded",t)},oninfo:function(t){this._add_event_handler("info",t)},onvolume:function(t){this._add_event_handler("volume",t)},enableLog:function(e){if(e){this._options.debug=!0;const e=6048e5;Cookie.set("PlayerDebugLog",(new Date).valueOf()+e),this._debugLog||(this._debugLog=new t("HTML5Player"))}else Cookie.clear("PlayerDebugLog"),this._debugLog&&(this._debugLog.disable(),this._debugLog=null)},_createmedia:function(){if(this._mediaElem=document.createElement("audio"),this._mediaElem.style.width="0px",this._mediaElem.style.height="0px",this._mediaElem.style.visibility="hidden",this._mediaElem.controls=!1,document.body.appendChild(this._mediaElem),this._options.debug)for(let t=0;t<this._loggedEvents.length;t++)this._logevt(this._loggedEvents[t]);this._mediaElem.volume=this._volume,this._addlistener("loadstart",this._handle_loadstart,this),this._addlistener("timeupdate",this._handle_timeupdate,this),this._addlistener("progress",this._handle_progress,this),this._addlistener("canplay",this._handle_canplay,this),this._addlistener("canplaythrough",this._handle_canplay,this),this._addlistener("durationchange",this._handle_durationchange,this),this._addlistener("playing",this._handle_playing,this),this._addlistener("pause",this._handle_pause,this),this._addlistener("ended",this._handle_ended,this),this._addlistener("stalled",this._handle_stalled,this),this._addlistener("waiting",this._handle_waiting,this),this._addlistener("error",this._handle_error,this)},_loggedEvents:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],_logevt:function(t){this._addlistener(t,this._loghandler(t),this)},_destroymedia:function(){this._removelisteners(),this._mediaElem&&(document.body.removeChild(this._mediaElem),this._nativePause(),this._mediaElem=null)},_addlistener:function(t,e,i){const n=function(){e.apply(i,arguments)};this._listeners.push({name:t,handler:n}),this._mediaElem.addEventListener(t,n,!1)},_removelisteners:function(){if(this._mediaElem)for(;this._listeners.length>0;){const t=this._listeners.pop();this._mediaElem.removeEventListener(t.name,t.handler,!1)}},_handle_loadstart:function(t){const e=this._mediaElem;this._options.loadStartKick&&!this._loadStartKicked&&1==e.duration&&4==e.readyState&&(this._loadStartKicked=!0,this._warn("loadstart: looks like Android Browser duration=1 bug; kicking media.src..."),this._nativeSrc(e.src))},_handle_waiting:function(t){this._debug("waiting")},_handle_timeupdate:function(t){try{const t=this._mediaElem;this._options.deferredSeeks&&this._wantseek&&(this._debug("applying deferred seek"),this._seek_inner(this._wantpos),this._wantseek=!1),this._cancelPlayKick(),5==this._recentpos.length&&this._recentpos.shift(),this._recentpos.push(t.currentTime),this._playingEventDeferred&&this._state==n&&(this._warn("Play event was deferred; simulating it now..."),this._playingEventDeferred=!1,this._handle_playing_inner());let e={position:t.currentTime};if(isFinite(t.duration)&&t.duration>0&&(e.duration=t.duration),this._fire_event("time",e),this._options.simulateEndedSafari&&this._mediaElem.ended&&this._handle_ended_inner(),!this._finishedloading){const i=this._amountLoaded();i>=t.duration&&(this._finishedloading=!0),i!=this._lastloaded&&(this._lastloaded=i,e={loaded:i},isFinite(t.duration)&&(e.total=t.duration),this._cancelReset(),this._fire_event("loaded",e))}}catch(t){this._warn("exception in _handle_timeupdate: "+t)}},_handle_progress:function(){const t=this._mediaElem;if(this._options.simulateEndedAndroid&&this._state==s&&!t.paused&&!t.ended&&!isNaN(t.duration)){const e=function(t){return Math.round(1e3*t)},i=e(t.currentTime),n=e(t.duration),s=e(this._amountLoaded());i>0&&i===n&&i===s&&(this._warn("Did we just hit the Chrome/Android bug in which the 'ended' event isn't fired?"),this._warn("Compensating by simulating the event ourselves..."),this._handle_ended_inner())}},_handle_ended:function(){this._debug("_handle_ended"),this._options.simulateEndedSafari||this._handle_ended_inner()},_handle_ended_inner:function(){this._debug("_handle_ended_inner");try{this._wantstoplay=!1,this._changestate(o)}catch(t){this._warn("exception in _handle_ended: "+t)}},_scheduleReset:function(t){if(!this._options.resetOnStall)return;this._cancelReset();const e=this;this._warn("scheduling media reset in "+t+"ms"),this._resetTimer=setTimeout((function(){e._resetTimer=null,e._warn("Resetting media (amtloaded = "+e._amountLoaded()+")"),e._nativeLoad()}),t)},_cancelReset:function(){this._options.resetOnStall&&this._resetTimer&&(this._warn("canceling media reset due to load progress (amtloaded = "+this._amountLoaded()+")"),clearTimeout(this._resetTimer),this._resetTimer=null)},_schedulePlayKick:function(t){if(!this._options.playKick)return;this._cancelPlayKick();const e=this;this._warn("scheduling playkick in "+t+"ms"),this._playKickTimer=setTimeout((function(){e._warn("kicking"),e._playKickTimer=null,e._nativePause(),e._nativePlay(),e._warn("kicked")}),t)},_cancelPlayKick:function(){this._options.playKick&&this._playKickTimer&&(this._warn("canceling playkick timer"),clearTimeout(this._playKickTimer),this._playKickTimer=null)},_amountLoaded:function(){return this._mediaElem.buffered.length>0?this._mediaElem.buffered.end(this._mediaElem.buffered.length-1):0},_handle_stalled:function(){this._mediaElem.readyState!=c&&(this._stallcount+=1,this._stallcount>u?(this._error("Too many stalls.  Giving up on this track."),this._nativePause(),this._changestate(o)):(this._debug("stalled, readyState="+this._mediaElem.readyState+", amtloaded="+this._amountLoaded()),this._scheduleReset(7500)))},_handle_playing:function(){this._options.deferPlayEvents&&this._state==n?(this._debug("deferring play event to the next timeupdate"),this._playingEventDeferred=!0):this._handle_playing_inner()},_handle_playing_inner:function(){try{this._changestate(s)}catch(t){this._warn("exception in _handle_playing_inner: "+t)}},_handle_pause:function(){this._state!==o||!this._options.simulateEndedSafari&&!this._options.simulateEndedAndroid?this._mediaElem.paused&&this._changestate(r):this._debug("ignoring 'pause' event because state is COMPLETED")},_handle_canplaythrough:function(){this._handle_canplay()},_handle_canplay:function(){try{this._wantstoplay&&this._nativePlay()}catch(t){this._warn("exception in _handle_canplay: "+t)}},_is_cloud_streaming_url:function(){const t=Url.toHash(this._mediaElem.src).pathname.split("/");if(5==t.length&&""==t[0]&&"stream"==t[1]){const e=parseInt(t[4],10);return NaN!=e?e:null}return null},_is_stream_redirect_url:function(){const t=Url.toHash(this._mediaElem.src).pathname.split("/");return 2===t.length&&"stream_redirect"===t[1]},_refresh_cloud_streaming_url:function(){const t=this,e=this._mediaElem.src,i=this._mediaElem.currentTime;$.ajax({url:"/api/stream/1/refresh",type:"get",data:{url:e},dataType:"json",success:function(e){t._is_cloud_streaming_url()==e.track_id&&(t._nativeSrc(e.url),t._nativeLoad(),t._nativeSeek(i))}})},_reload_stream_redirect_url:function(){const t=this._mediaElem.currentTime;this._nativeSrc(this._mediaElem.src),this._nativeSeek(t)},_handle_error:function(t){const e=this._mediaElem.error&&this._mediaElem.error.code;if(this._error("got native error event; error.code="+e),this._options.retryErrors&&(e==this._mediaElem.error.MEDIA_ERR_SRC_NOT_SUPPORTED||e==this._mediaElem.error.MEDIA_ERR_NETWORK))if(this._errorRetryCount<5){this._errorRetryCount+=1,this._warn("assuming error is due to an expired stream URL and reloading; count="+this._errorRetryCount);null!=this._is_cloud_streaming_url()?this._refresh_cloud_streaming_url():this._is_stream_redirect_url()&&this._reload_stream_redirect_url()}else this._warn("exceeded maximum number of error retries; giving up on this track"),this._nativePause(),this._changestate(o)},_handle_durationchange:function(){this._schedulePlayKick(500)},_loghandler:function(t){const e=this;return function(){const i=e._mediaElem;let n=null;try{n=i.buffered.end(i.buffered.length-1)}catch(t){}this._debug("[native] "+t+"; paused="+i.paused+"; ended="+i.ended+"; readyState="+i.readyState+"; duration="+i.duration+"; currentTime="+i.currentTime+"; buffered="+n)}},_isbuffering:function(){try{return this._mediaElem.readyState<l}catch(t){}return!1},_changestate:function(t){if(this._debug("state changing from ".concat(this._state," to ").concat(t)),t===s&&this._isbuffering()&&(t=n),t!==this._state){const e=this._state;this._state=t,this._debug("state changed from "+e+" to "+t),this._fire_event("state",{newstate:this._state,oldstate:e})}},_fire_event:function(t,e){const i=this._handlers[t];if(i)for(let n=0;n<i.length;n++)try{i[n](this,e)}catch(e){this._warn('caught exception in handler for event "'+t+'": '+e)}},_add_event_handler:function(t,e){this._handlers[t].push(e)},_nativeSrc:function(t){this._debug("[native] setting src to: "+t),this._mediaElem.src=t},_nativeLoad:function(){this._debug("[native] load()"),this._mediaElem.load()},_nativeLoadSafe:function(){this._debug("[native] load() -- with exception handling");try{this._mediaElem.load()}catch(t){this._warn("Got exception when calling native load() -- assuming this is okay and continuing: "+t)}},_nativePlay:function(){this._debug("[native] play()"),this._mediaElem.play()},_nativePause:function(){this._debug("[native] pause()"),this._mediaElem.pause()},_nativeSeek:function(t){this._debug("[native] setting currentTime to: "+t+"; previous position: "+this._mediaElem.currentTime),this._mediaElem.currentTime=t},_debug:function(t){this._options.debug&&this._log("debug",t)},_info:function(t){this._log("info",t)},_warn:function(t){this._log("warn",t)},_error:function(t){this._log("error",t)},_log:function(t,e){this._debugLog&&this._debugLog.log(t.toUpperCase()+" - "+e),void 0!==Log&&Log[t]("HTML5Player-"+this._id+": "+e)}};var n="BUFFERING",s="PLAYING",r="PAUSED",a="IDLE",o="COMPLETED",l=3,c=4,u=20,h=!1;function d(t){const e=t.split(".");for(let t=0;t<e.length;t++)e[t]=Number(e[t]);return e}return i.supportedFormats=function(){const t={};if(-1!=navigator.userAgent.indexOf("iPhone")){const t=function(t){const e=t.match(/Version\/([0-9\.]*)/);return e?d(e[1]):null}(navigator.userAgent);if(t&&(t[0]<4||4===t[0]&&0===t[1]&&(2===t.length||0===t[2])))return{}}try{const e=document.createElement("audio");let i=e.canPlayType("audio/mpeg");t["mp3-128"]="probably"==i||"maybe"==i,t["mp3-v0"]="probably"==i||"maybe"==i,i=e.canPlayType('audio/mpeg; codecs="mp4a.40.2"'),t["aac-lo"]="probably"==i||"maybe"==i,t["aac-lo"]||(i=e.canPlayType('audio/mp4; codecs="mp4a.40.2"'),t["aac-lo"]="probably"==i||"maybe"==i),i=e.canPlayType('audio/ogg; codecs="vorbis"'),t["vorbis-lo"]="probably"==i||"maybe"==i,i=e.canPlayType('audio/ogg; codecs="opus"'),t["opus-lo"]="probably"==i||"maybe"==i,t["opus-lo"]&&-1!=navigator.userAgent.indexOf(" Chrome/")&&(t["opus-lo"]=!1)}catch(t){}if(!t){const e=navigator.userAgent.toString().match(/Android ([0-9\.]*)/);if(e){const i=d(e[1]);(i[0]<2||2==i[0]&&i[1]<3)&&(h=!0,Log.debug("using location <= stream workaround"),t["mp3-128"]=!0,t["aac-lo"]=!0)}}return t},i.needLocationHack=function(){const t=navigator.userAgent.toString().match(/Android ([0-9\.]*)/);if(!t)return!1;const e=d(t[1]);return e[0]<3||3==e[0]&&e[1]<3},i.enableLog=function(t){t?Cookie.set("PlayerDebugLog",(new Date).valueOf()+6048e5):Cookie.clear("PlayerDebugLog")},i.logEnabled=function(){const t=Cookie.get("PlayerDebugLog");return t&&parseInt(t)>(new Date).valueOf()},i}(),window.ImageUtils=function(){"use strict";const t={JPEG:"jpg",PNG:"png"};function e(e,n,s,r){if(!n)return TemplGlobals.static_siteroot+"/img/blank.gif";s=i(s);const a=ImageUtils.imageRoot(r);let o;return o=s.anim_ok?"":s.file_format&&"original"!=s.file_format?"."+t[s.file_format]:"",a+"/img/"+e+(n=("000000000"+n).slice(-10))+"_"+s.id+o}function i(t){if("object"==typeof t)return t;const e=TemplGlobals.image_formats;if(e)for(let i=0;i<e.length;++i)if(e[i].id==t||e[i].name==t)return e[i];return Log.error("bad image format",t),null}const n={imageURL:function(t,i,n){return e("",t,i,n)},artURL:function(t,i,n){return e("a",t,i,n)},imageFormat:i,imageDimensions:function(t,e,n){let s,r;return(n=i(n))&&"original"!=n.resize_algo?"thumb"==n.resize_algo?(s=n.width,r=n.height):"fit"==n.resize_algo?t<=n.width&&e<=n.height?(s=t,r=e):t/n.width>e/n.height?(s=n.width,r=Math.round(e*(n.width/t))):(s=Math.round(t*(n.height/e)),r=n.height):(Log.error("bad image resize algo",n),s=t,r=e):(s=t,r=e),{width:s,height:r}},imageRoot:function(t){return void 0===t&&(t="https:"===window.location.protocol),t?TemplGlobals.image_siteroot_https:TemplGlobals.image_siteroot}};return"uploadImage"in window&&(n.upload=uploadImage),n}(),window.Imager=ImageUtils;var Sound={_callbacks:[],_status:null,_loadstarted:!1,whenloaded:function(t){if(Sound._showdebug("wl"),Sound._status)try{t(Sound._status)}catch(t){}else Sound._showdebug("init"),Sound._callbacks.push(t),Sound._load_wrapper()},_docallbacks:function(){for(;Sound._callbacks.length>0;)Sound._docallback(Sound._callbacks.pop())},_docallback:function(t){try{t(Sound._status)}catch(t){Log.error("caught error in Sound.whenloaded callback: "+t)}},_showdebug:function(t){const e=document.getElementById("sounddebug");e&&(e.innerText=t)},_load_wrapper:function(){Sound._status={success:!0,subsystem:"wrapper",has_viz:"false"},Sound.SoundPlayer=WrapperSoundPlayer,Sound._docallbacks()}},WrapperSoundPlayer=function(){const t=this;t._html5player=null,t._html5formats=HTML5Player.supportedFormats(),t._currentplayer=null,t._handlers={state:[],time:[],loaded:[],info:[],volume:[]};const e=[];for(const i in t._html5formats)t._html5formats.hasOwnProperty(i)&&1==t._html5formats[i]&&e.push(i);function i(e){return function(){const i=arguments;"html5"==t._currentplayer&&t._html5player[e].apply(t._html5player,i)}}function n(e){return function(){const i=arguments;"html5"==t._currentplayer?t._html5player[e].apply(t._html5player,i):Log.error("WrapperSoundPlayer proxy for "+e+"(): no _soundplayer instance!")}}e.length>0&&(t._html5player=new HTML5Player,t._html5player.ontime((function(e,i){t._fire_event("time",i)})),t._html5player.onstate((function(e,i){t._fire_event("state",i)})),t._html5player.onloaded((function(e,i){t._fire_event("loaded",i)})),t._html5player.oninfo((function(e,i){t._fire_event("info",i)})),t._html5player.onvolume((function(e,i){t._fire_event("volume",i)})),t._currentplayer="html5"),t._add_event_handler=function(e,i){t._handlers[e].push(i)},t.onstate=function(e){t._add_event_handler("state",e)},t.ontime=function(e){t._add_event_handler("time",e)},t.onloaded=function(e){t._add_event_handler("loaded",e)},t.oninfo=function(e){t._add_event_handler("info",e)},t.onvolume=function(e){t._add_event_handler("volume",e)},t._fire_event=function(e,i){if(handlers=t._handlers[e],handlers)for(let n=0;n<handlers.length;n++)try{"html5"==t._currentplayer&&handlers[n](t._html5player,i)}catch(t){Log.debug('caught exception in handler for event "'+e+'": '+t)}},t.load=function(e,i){let n=null,s=null;if("string"==typeof e)s=e,n="mp3-128";else{const r=["aac-lo","mp3-128","opus-lo","vorbis-lo"];i&&r.unshift("mp3-v0");for(let i=0;i<r.length;i++)if(t._html5formats[r[i]]&&e[r[i]]){n=r[i];break}n||Log.error("no available HTML5-supported format"),s=e[n]}t._currentplayer="html5",t._html5player.load(s)};const s=["play","pause","stop","seek"],r={};for(let t=0;t<s.length;t++)r[s[t]]=!0;for(const e in HTML5Player.prototype)"load"!=e&&"ontime"!=e&&"onstate"!=e&&"onloaded"!=e&&"oninfo"!=e&&"onvolume"!=e&&"function"==typeof HTML5Player.prototype[e]&&"_"!=e.substr(0,1)&&(r[e]?t[e]=i(e):t[e]=n(e))},LazySound=function(){const t=this;function e(e){return function(){const i=arguments;t.whenInstanceReady((function(t){t[e].apply(t,i)}))}}function i(e){return function(){const i=arguments;if(t._soundplayer)try{t._soundplayer[e].apply(t._soundplayer,i)}catch(i){t._loggedException||(t._loggedException=!0,Log.error("LazySound proxy for "+e+"(): caught exception: "+i))}else Log.error("LazySound proxy for "+e+"(): no _soundplayer instance!")}}t._soundplayer=null,t._loggedException=!1,t.whenInstanceReady=function(e){Sound.whenloaded((function(i){i.success?(t._soundplayer||(t._soundplayer=new Sound.SoundPlayer),e(t._soundplayer)):Log.error("LazySound: Sound.whenloaded failed: ",i)}))};const n=["play","pause","stop","load","onstate","ontime","onloaded","oninfo","onvolume","seek"],s={};for(let t=0;t<n.length;t++)s[n[t]]=!0;for(const n in HTML5Player.prototype)"function"==typeof HTML5Player.prototype[n]&&"_"!=n.substr(0,1)&&(s[n]?t[n]=e(n):t[n]=i(n))};!function(){"use strict";const t={beacon:function(t,e){return this._loadImage(t,e,!0)},loadImage:function(t){return this._loadImage(t)},_loadImage:function(t,e,i,n){let s=document.createElement("img");const r=s;return s.style.display="none",s.onload=s.onerror=function(){try{s=null,n&&n()}catch(t){}},i&&!e.rand&&(e.rand=Math.random().toString().substring(2)),s.src=Url.addQueryParams(t,e),r}},e={ALT_IDENTITY_PARAM:"BandcampIdentity",get:function(t){$assert(Text.notEmpty(t));let i=e.getAll()[t];return null==i&&(i=null),i},getAll:function(){function t(t,e){const n=i[t];n?U.isArray(n)?n.push(e):i[t]=[n,e]:i[t]=e}const e=document.cookie.split(/;\s*/),i={};for(let i=0;i<e.length;i++){const n=e[i].split("=");if(n[1]){let e,i;try{e=decodeURIComponent(n[0]),i=decodeURIComponent(n[1])}catch(t){Log.error("Cookie.getAll: error when decoding URL parameter, skipping; ",t);continue}t(e,i)}}return i},set:function(t,i,n,s,r,a,o){let l;if($assert(Text.notEmpty(t)),$assert(null==n||U.isNumber(n)),null==i&&(i=""),s||(s="/"),r||(r=e._secondLevelDomain()),null!=n&&(l=new Date((new Date).getTime()+1e3*n)),window.BCCookies&&BCCookies.isCookieAllowed(t)){const e=encodeURIComponent,n=e(t)+"="+e(i)+";path="+s+(null!=r?";domain="+r:"")+(l?";expires="+l.toUTCString():"")+(a?";secure":"")+(o?";SameSite=".concat(o):"");return document.cookie=n,n}},clear:function(t,i,n,s,r){return e.set(t,"",-1,i,n,s,r)},_secondLevelDomain:function(){const t=location.hostname.split("."),e=t.length;return $assert(e>=1),1===e?null:"."+t[e-2]+"."+t[e-1]}};window.CommUtils=t,window.Cookie?Object.assign(window.Cookie,e):window.Cookie=e}();var HiddenParams={};!function(){"use strict";HiddenParams.hide=function(t){Array.isArray(t)||(t=[t]),Log.debug("hiding params ["+t.join(", ")+"] from url query");const e={};t.forEach((function(t){e[t]=!0}));const i=Url.parseQueryArray(location.search),n=[];for(let t=0;t<i.length;t++)e[i[t].name]||n.push(i[t]);let s=location.pathname.replace(/^\/+/,"/");n.length>0&&(s+="?"+Url.joinQueryArray(n)),s+=location.hash;const r=()=>{history.replaceState(null,document.title,s)};BCTracker.afterPageView?BCTracker.afterPageView(r):BCTracker.didRecordPageView?r():setTimeout(r,300)},HiddenParams.get=function(t,e){if(!HiddenParams.hasOwnProperty(t)){void 0===e&&(e=!0);const i=Url.parseQueryArray(location.search);let n;for(let e=0;e<i.length;e++)if(i[e].name===t){n=i[e].value;break}HiddenParams[t]=n,e&&HiddenParams.hide(t)}return HiddenParams[t]};const t=document.currentScript.dataset.hideParams;if(t){const e=JSON.parse(t);e.push(".reload"),e.push("mvp"),e.forEach((function(t){HiddenParams.get(t,!1)})),HiddenParams.hide(e)}}();var Stats=function(){"use strict";return{RECORD_URL:"/stat_record",hash_code:function(t){if(!t)return 0;let e=0;const i=t.length;for(let n=0;n<i;n++){e=(e<<5)-e+t.charCodeAt(n),e|=0}return e<0&&(e=4294967295+e+1),e.toString(16)},record_sendbeacon:function(t){if(!t.band_id&&window.BandData&&(t.band_id=BandData.id),t.uac=Stats.hash_code(navigator.userAgent),navigator.sendBeacon){t.rand="b"+Math.round(1e16*Math.random()).toString();let e=siteroot_current+Stats.RECORD_URL;e=Url.addQueryParams(e,t),navigator.sendBeacon(e)}else Stats.record(t)},record:function(t){const e=$("#pagedata").data(),i=e&&e.blob&&e.blob.disable_stats;if(i){if(!Array.isArray(i))return;if(i.includes(t.kind))return}!t.band_id&&window.BandData&&(t.band_id=BandData.id);try{CommUtils.beacon(siteroot_current+Stats.RECORD_URL,t)}catch(t){Log.warn("CommsUtil.beacon error")}},_recorded_clicks:{},record_click_once:function(t){Stats._recorded_clicks[t]||(Stats._recorded_clicks[t]=!0,Stats.record({kind:"click",click:t}))},share_menu_click:function(t){"wordpress"==t&&(t="wordpress.com"),Stats.record({kind:"share menu",click:t})}}}();Stats.PhasedStat=function(){"use strict";function t(t,e){this._params=t,this._params.phase=e,this._params.reference_num=Math.round(1e9*Math.random()),Stats.record(this._params)}return t.prototype={change_phase:function(t){this._params.phase=t,Stats.record(this._params)},done:function(){this.change_phase("complete")},error:function(t){this._params.info=t,this.change_phase("error")},add_params:function(t){this._params=this.merge(this._params,t)},merge:function(t,e){const i={};let n;for(n in t)i[n]=t[n];for(n in e)i[n]=e[n];return i}},t}();var Identities=function(t){"use strict";const e=new function(e){const a=this;this.initialData=e,this.user=ko.observable(e.user),this.fan=ko.observable(e.fan),this.partner=ko.observable(e.partner),this.isAdmin=ko.observable(e.is_admin),this.ip_country_code=e.ip_country_code,this.pageBand=e.page_band&&new i(e.page_band),this.bmgr=new n(e.bands),this.lmgr=new r(e.labels),this.labels=this.lmgr.labels,this.labelIds=ko.computed((function(){return Iter.collect(a.labels(),(function(t){return t.id}))})),this.linkedNonLabelMemberBands=ko.computed((function(){return Iter.findAll(a.bmgr.bands(),(function(t){return!a.lmgr.isLabelMemberBand(t.id)}))})),this.linkedNonLabelBands=ko.computed((function(){return Iter.findAll(a.linkedNonLabelMemberBands(),(function(e){return-1===t.inArray(e.id,a.labelIds())}))})),this.hasLabels=ko.computed((function(){return a.labels().length>0})),this.pageBandParentLabel=ko.computed((function(){return Iter.find(a.labels(),(function(t){return t.id===e.page_band_parent_label_id}))}));const o=e.page_label&&new s(e.page_label);this.pageLabel=ko.computed((function(){return a.pageBandParentLabel()||a.pageBand&&a.labels()&&Iter.find(a.labels(),(function(t){return t.id===a.pageBand.id}))||o})),this.isPageBandMember=ko.observable(e.is_page_band_member),this.isPageBandNonLabelMember=ko.computed((function(){return a.pageBand&&Iter.find(a.bmgr.bands(),(function(t){return t.id==a.pageBand.id}))})),this.isParentLabel=ko.computed((function(){return!!a.pageBandParentLabel()})),this.hasFullAccess=ko.computed((function(){return a.isPageBandMember()||a.isAdmin()})),this.hasLimitedAccess=ko.computed((function(){return a.isParentLabel()&&e.page_band&&!e.page_band.authed})),this.isPageBand=function(t){return a.pageBand&&t===a.pageBand.id},this.isMemberOfBand=function(t){return a.bmgr.bandByID(t)||a.lmgr.isMemberBandAuthed(t)},this.activeLicenses=ko.observableArray(e.active_licenses),this.subscribedToPageBand=ko.observable(e.subscribed_to_page_band||!1),this.updateFromHash=function(t){t.bands&&a.bmgr.updateBands(Iter.collect(t.bands,(function(t){return new i(t)}))),t.page_band&&a.pageBand&&(t.page_band.name&&a.pageBand.name(t.page_band.name),t.page_band.photo&&a.pageBand.photo(t.page_band.photo),t.page_band.trackpipe_local_url&&a.pageBand.trackpipeLocalUrl(t.page_band.trackpipe_local_url)),a.isPageBandMember(t.is_page_band_member)},this.add=function(t){t.bands&&t.bands.length>0&&a.bmgr.addBands(t.bands),t.labels&&t.labels.length>0&&a.lmgr.addLabels(t.labels)},this.remove=function(t){t.bands&&t.bands.length>0&&a.bmgr.removeBands(t.bands),t.labels&&t.labels.length>0&&(a.lmgr.removeLabels(t.labels),a.bmgr.removeBands(t.labels))}}(U.pagedataBlob().identities||{});return e.BandVM=i,e.BandsMgr=n,window.ko&&window.ko.options.bindingGlobals&&(window.ko.options.bindingGlobals.Identities=e),e;function i(t){const e=this;this.id=t.id,this.name=ko.observable(t.name||""),this.photo=ko.observable(t.photo||t.bio&&t.bio.image_id),this.trackpipeUrl=ko.observable(t.trackpipe_url||t.url),this.trackpipeLocalUrl=ko.observable(t.trackpipe_local_url||t.url||t.trackpipe_url),this.trackpipeUrlHttps=ko.observable(t.trackpipe_url_https),this.dashboardUrl=ko.computed((function(){return e.trackpipeLocalUrl()+"/dashboard"})),this.isPro=ko.observable(t.is_pro),this.hasService=ko.observable(t.has_service),this.serviceName=ko.observable(t.service_name),this.serviceUrlFragment=ko.observable(t.service_url_fragment),this.isLabel=ko.observable(t.is_label),this.isLabelMemberBand=ko.observable(!1)}function n(t){const e=this;let n;this.addBands=function(t){let e,s;e=Iter.collect(t,(function(t){return t instanceof i?t:new i(t)})),s=[Number.MAX_VALUE,0].concat(e),n.splice.apply(n,s)},this.bandByID=function(t){return Iter.find(n(),(function(e){return e.id===t}))},this.removeBands=function(t){const e=Iter.findAll(n(),(function(e){return!!Iter.find(t,(function(t){return t===e.id}))}));n.removeAll(e)},this.updateBandName=function(t,i){const n=e.bandByID(t);n&&n.name(i)},this.updateBands=function(t){n(t)},n=ko.observableArray(Iter.collect(t||[],(function(t){return new i(t)}))),this.bands=ko.computed((function(){const t=n.slice(0);return t.sort((function(t,e){return(t=t.name().toLowerCase())<(e=e.name().toLowerCase())?-1:t>e?1:0})),t})).extend({throttle:1}),this.anyPro=ko.computed((function(){return!!Iter.find(n(),(function(t){return t.isPro()}))}))}function s(t){const e=this;this.id=t.id,this.name=ko.observable(t.name),this.url=ko.observable(t.url),this.memberBands=ko.observableArray(Iter.collect(t.member_bands,(function(t){const e=new i(t);return e.isLabelMemberBand(!0),e.isAuthed=ko.observable(t.authed),e.hasItems=ko.observable(t.band_has_items),e}))),this.memberBandIds=ko.computed((function(){return Iter.collect(e.memberBands(),(function(t){return t.id}))}))}function r(t){const e=this;this.labels=ko.observableArray(Iter.collect(t||[],(function(t){return new s(t)})));const i=ko.computed((function(){const t={};return Iter.each(e.labels(),(function(e){Iter.each(e.memberBands(),(function(e){t[e.id]=t[e.id]||e.isAuthed()}))})),t}));this.isMemberBandAuthed=function(t){return i()[t]},this.isLabelMemberBand=function(t){return t in i()},this.labelByID=function(t){return Iter.find(e.labels(),(function(e){return e.id===t}))},this.addLabels=function(t){const i=Iter.collect(t,(function(t){return new s(t)})),n=[Number.MAX_VALUE,0].concat(i);e.labels.splice.apply(e.labels,n)},this.removeLabels=function(t){Iter.each(t,(function(t){const i=e.labelByID(t);e.labels.remove(i)}))}}}(jQuery),Color={isDark:function(t){const e=this.hex2rgb(t);return this.rgb2hsl(e)[2]<.5},lowContrast:function(t,e,i){let n,s;return void 0===i&&(i=3),this.luminance(e)>this.luminance(t)?(n=this.luminance(e),s=this.luminance(t)):(n=this.luminance(t),s=this.luminance(e)),ratio=(n+.05)/(s+.05),ratio<i},luminance:function(t){const e=this.hex2rgb(t);let i,n,s;for(let t=0;t<e.length;t++)e[t]<=.03928?e[t]=e[t]/12.92:e[t]=Math.pow((e[t]+.055)/1.055,2.4);return i=e[0],n=e[1],s=e[2],.2126*i+.7152*n+.0722*s},rgb2hex:function(t){const e=Math.round(255*t[0]),i=Math.round(255*t[1]),n=Math.round(255*t[2]);return(e<16?"0":"")+e.toString(16)+(i<16?"0":"")+i.toString(16)+(n<16?"0":"")+n.toString(16)},hex2rgb:function(t){return 6==(t=t.replace(/^#/,"")).length?[parseInt("0x"+t.substring(0,2))/255,parseInt("0x"+t.substring(2,4))/255,parseInt("0x"+t.substring(4,6))/255]:3==t.length?[parseInt("0x"+t.substring(0,1))/15,parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15]:void 0},hsl2rgb:function(t){let e,i;const n=t[0],s=t[1],r=t[2];i=r<=.5?r*(s+1):r+s-r*s,e=2*r-i;const a=function(t,e,i){return 6*(i=i<0?i+1:i>1?i-1:i)<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(.66666-i)*6:t};return[a(e,i,n+.33333),a(e,i,n),a(e,i,n-.33333)]},rgb2hsl:function(t){let e,i,n,s,r,a;const o=t[0],l=t[1],c=t[2];return e=Math.min(o,Math.min(l,c)),i=Math.max(o,Math.max(l,c)),n=i-e,a=(e+i)/2,r=0,a>0&&a<1&&(r=n/(a<.5?2*a:2-2*a)),s=0,n>0&&(i==o&&i!=l&&(s+=(l-c)/n),i==l&&i!=c&&(s+=2+(c-o)/n),i==c&&i!=o&&(s+=4+(o-l)/n),s/=6),[s,r,a]}},Share={openFacebookShare:function(t,e){let i="https://www.facebook.com/sharer.php?u="+encodeURIComponent(t);return i+="&p[title]=ptitle&p[summary]=psummary",e&&(i+="&t="+encodeURIComponent(e)),window.open(i,"sharer","toolbar=0,status=0,width=626,height=436"),!1},openTwitterShare:function(t,e){const i={};return i.text=t,e&&(i.url=e),window.open(Url.addQueryParams("https://twitter.com/intent/tweet",i)),!1},_panelInited:!1,_panelData:null,_alreadyStattedEmail:!1,initPanel:function(t,e,i){var n,s,r;if(document.querySelector(".share-embed"))return;let a;document.querySelectorAll("#band-links a").forEach((t=>{const e=/twitter\.com\/(?:#!)?(\w+)/i.exec(t.href);e&&!a&&(a=e[1])})),Share._panelData={linkback:i,is_track:t,enable_social_buttons:e,title:TralbumData.current.title,artist:TralbumData.artist,twitter_username:a,download_pref:TralbumData.current.download_pref,embed_info:EmbedData.embed_info};const o={embed_info:U.pagedataBlob().embed_info};null===(n=document.querySelector(".share-panel-wrapper-desktop"))||void 0===n||n.insertAdjacentHTML("beforeend",Templ.render("tralbum_common/share_collect_controls",o)),null===(s=document.querySelector(".share-embed"))||void 0===s||s.addEventListener("click",(()=>{Share.togglePanel()})),null===(r=document.querySelector(".exclusive-embed"))||void 0===r||r.addEventListener("click",(()=>{var t;null===(t=EmbedDialog)||void 0===t||t.open("exclusive")}))},showFromEmbed:function(){const t=Share._panelData,e=$(Templ.render("tralbum_common/share_embed_panel",t)).dialog({draggable:!0,position:"center",modal:!0,title:"Share",width:380,height:260});e.find(".email-im-link-text").blur(),Share._initPanelControls(e,t,(function(){e.dialog("close")})),Share._panelData.enable_social_buttons&&SocialControls.initFromDOM(e)},_initPanelControls:function(t,e,i){t.querySelector(".close").addEventListener("click",(()=>{i()}));const n=t=>{var e,n,s;Stats.record({kind:"click",click:t?"embed_other_exclusive":"embed_other"}),EmbedDialog.open(t?"exclusive":null),BCTracker.record("click",{feature:"tralbum-share-embed",click_type:"share",share_type:t?"embed":"exclusive_embed",user_id:null===(e=Identities.user())||void 0===e?void 0:e.id,item_id:null===(n=TralbumData.current)||void 0===n?void 0:n.id,item_type:null===(s=TralbumData.current)||void 0===s?void 0:s.type}),i()};t.querySelectorAll(".embed-other-services a").forEach((t=>{t.addEventListener("click",(()=>n(!1)))})),t.querySelectorAll(".embed-other-services-exclusive a").forEach((t=>{t.addEventListener("click",(()=>n(!0)))})),document.addEventListener("click",(t=>{(t.target.closest(".share-buttons .facebook-link")||t.target.closest(".share-buttons .twitter-link")||t.target.closest(".share-buttons .tumblr-link"))&&i()}));const s=t.querySelector(".email-im-link input");s.addEventListener("focus",(()=>(Share._alreadyStattedEmail||(Stats.record({kind:"click",click:"email_tralbum"}),Share._alreadyStattedEmail=!0),!1))),s.addEventListener("click",s.select)},togglePanel:function(){let t=null;if(Share._panelInited)t=Share._panelRoot;else{const e=Share._panelData;t=document.querySelector(".share-panel-wrapper-desktop");const i=Templ.render("tralbum_common/share_embed_panel",e);t.insertAdjacentHTML("beforeend",i),Share._initPanelControls(t,e,(function(){Share.togglePanel()})),Share._panelRoot=t}const e=t.querySelector(".share-embed-container"),i=!e.classList.contains("visible");if(setTimeout((()=>{if(e.classList.toggle("visible",i),i){var t,n,s;Dom.scrollToElement(e,20,!0);const i=document.querySelectorAll(".email-im-link-text");i.forEach((t=>{t.disabled=!0})),setTimeout((()=>{i.forEach((t=>{t.disabled=!1}))}),10),BCTracker.record("click",{feature:"tralbum-share-embed",click_type:"open_dialog",user_id:null===(t=Identities.user())||void 0===t?void 0:t.id,item_id:null===(n=TralbumData.current)||void 0===n?void 0:n.id,item_type:null===(s=TralbumData.current)||void 0===s?void 0:s.type})}}),10),!Share._panelInited){var n;if(Share._panelData.enable_social_buttons)null===(n=SocialControls)||void 0===n||n.initFromDOM(t);Share._panelInited=!0}}},Dom={getText:function(t){return(t=elt(t))?t.textContent:""},setText:function(t,e){(t=elt(t))&&(t.textContent=e)},getValue:function(t){switch((t=elt(t)).type){case"checkbox":return t.checked?t.value:null;case"radio":var e=document.getElementsByName(t.name);for(let t=0,i=e.length;t<i;t++)if(e[t].checked)return e[t].value;return null}return t.value},setUnselectable:function(t){(t=elt(t))&&(t.style.userSelect="none")},focus:function(t){t=elt(t);try{t.focus()}catch(t){}},select:function(t,e){t=elt(t);try{t.select(),e&&t.focus()}catch(t){}},getDocumentHeight:function(){return document.documentElement["gecko"==Browser.type?"offsetHeight":"scrollHeight"]},wrapElem:function(t,e){return U.isString(e)&&(e=document.createElement(e)),$(e).insertBefore(t).append(t),e},scrollToElement:function(t,e,i){if(t.charAt&&"#"!=t.charAt(0)&&(t="#"+t),!(t=$(t)).length)return;t.parents().each((function(t,e){e.style&&"none"==e.style.display&&(e.style.display="")}));let n=document.scrollingElement;if(n||(n=document.documentElement&&null!=document.documentElement.scrollTop?document.documentElement:document.body),null==e&&(e=-10),i){const i=document.documentElement.clientHeight,s=t.height(),r=n.scrollTop,a=n.scrollTop+i,o=t.offset().top,l=t.offset().top+s;if(o>=r){if(l<a)return;e+=l-i}else e+=o}else e+=t.offset().top;$(n).animate({scrollTop:e},500)},hideEverythingStack:[],hideEverythingThanksAndroid:function(){if("androidbrowser"==Browser.make){const t=Array.prototype.slice.call(arguments);if(0==t.length)return;const e=$(".logView")[0];e&&t.push(e),$(this.hideEverythingStack[0]).css("visibility","inherit"),$(t).css("visibility","visible"),$(t).each((function(t,e){})),this.hideEverythingStack.unshift(t),$(document.body).css("visibility","hidden")}},unhideEverythingThanksAndroid:function(){if("androidbrowser"==Browser.make){const t=Array.prototype.slice.call(arguments),e=this.hideEverythingStack[0];let i=!1;if(e&&e.length>0&&$(t).each((function(t,n){$(e).each((function(t,e){i=i||n==e}))})),!i)return void Log.error("Elt not found unhiding for android fixup");this.hideEverythingStack.shift(),elems=this.hideEverythingStack[0]||document.body,$(elems).css("visibility","visible"),$(elems).each((function(t,e){}))}},hackLinkClicksThanksSafari:function(t,e){t=$(t),"iphone"==Browser.platform?t.on({touchend:function(t){const e=this.getAttribute("href");e&&"#"!=e.substring(0,1)&&this.setAttribute("href","#"+e)},click:function(t){const i=this.getAttribute("href");if(i&&"#"==i.substring(0,1)&&this.setAttribute("href",i.substring(1)),e)return e.apply(this,arguments)}}):e&&t.on("click",e)},inViewport:function(t){let e=t.offsetTop,i=t.offsetLeft;const n=t.offsetWidth,s=t.offsetHeight;for(;t.offsetParent;)e+=(t=t.offsetParent).offsetTop,i+=t.offsetLeft;return e<window.pageYOffset+window.innerHeight&&i<window.pageXOffset+window.innerWidth&&e+s>window.pageYOffset&&i+n>window.pageXOffset},getCursorPosition:function(t){let e,i=0;return document.selection?(t.focus(),e=document.selection.createRange(),e.moveStart("character",-t.value.length),i=e.text.length):void 0!==t&&void 0!==t.selectionStart&&(i=t.selectionStart),i},setCursorPosition:function(t,e){let i;t.setSelectionRange?(t.focus(),t.setSelectionRange(e,e)):t.createTextRange&&(i=t.createTextRange(),i.collapse(!0),i.moveEnd("character",e),i.moveStart("character",e),i.select())},getXY:function(t){if("none"==window.getComputedStyle(t).display)return!1;const e=t.ownerDocument,i=e.documentElement,n=e.body,s=Math.max(i.scrollLeft,n.scrollLeft),r=Math.max(i.scrollTop,n.scrollTop),a=t.getBoundingClientRect();return xy=new Array(2),xy[0]=Math.round(a.left+s),xy[1]=Math.round(a.top+r),xy}},TextFormat={currency:function(t,e,i,n,s){t.is_money&&(window.CurrencyData||Log.server("Missing CurrencyData for TextFormat.currency on "+window.location.pathname,"error"),e=window.CurrencyData.info[t.currency],t=t.amount/100);const r=e||{prefix:"$",symbol:"USD",places:2};let a=t>=1||0==t?r.places:2;n&&t>=1&&Math.round(t)==t&&(a=0);let o=t.toFixed(a);return i?o:(o=TextFormat.commafyNumber(o),r.symbol&&!s&&(o+=" "+r.symbol),r.prefix_utf8+o)},money:function(t,e,i){"use strict";window.CurrencyData||Log.server("Missing CurrencyData for TextFormat.money on "+window.location.pathname,"error"),t&&t.is_money&&("number"==typeof e&&(i=e),e=t.currency,t=t.amount/100),t=t||0,e=e||"USD",i=i||1;const n=CurrencyData.info[e];let s=n.places;t===Math.round(t)?2!==i&&7!==i&&9!==i||(s=0):0===s&&(s=2);let r=t.toFixed(s);return 5!==i&&8!==i&&9!==i&&(r=this.commafyNumber(r)),4===i&&"-"===r[0]&&(r="("+r.substr(1)+")"),1===i||2===i?r=n.prefix_utf8+r:6!==i&&7!==i||(r=n.prefix_utf8+" "+r),5===i&&(r=Array(8-r.length).join(" ")+r),r},formatMillions:function(t,e){"use strict";let i,n=Math.round(t),s=!1;"ja"===e?n>=100?(s=!0,t=n/100,n=Math.round(t)):(t*=100,n=Math.round(t)):n>=1e3&&(s=!0,t=n/1e3,n=Math.round(t));let r=!1;const a=parseFloat(t.toFixed(1)),o=parseFloat(t.toFixed(2));return a>=100?i=n:o>=10?i=a:(i=o,"de"===e||"es"===e?1===o&&(r=!0):o<2&&(r=!0)),{large:s,one:r,value:i}},million_usd:function(t,e){"use strict";const i="en"===e?"$":"",n=TextFormat.formatMillions(t,e);let s;switch(e){case"fr":s=n.large?n.one?"milliard de dollars":"milliards de dollars":n.one?"million de dollars":"millions de dollars";break;case"ja":s=n.large?"":"";break;case"de":s=n.large?n.one?"Milliarde Dollar":"Milliarden Dollar":n.one?"Million Dollar":"Millionen Dollar";break;case"es":s=n.large?"mil millones de dlares":n.one?"milln de dlares":"millones de dlares";break;case"pt":s=n.large?"mil milhes de dlares":n.one?"milho de dlares":"milhes de dlares";break;default:s=n.large?"billion":"million"}return"fr"!==e&&"de"!==e&&"es"!==e&&"pt"!==e||(n.value=n.value.toString().replace(/\./g,",")),"".concat(i).concat(n.value).concat(s)},toMb:function(t,e){const i=e?1e3:1024;let n=1,s=i;const r=Iter.find([" bytes","K","MB","GB","TB","PB"],(function(){return t<s||(n=s,s*=i,!1)}));if(!r)return t.toString();const a=Math.round(t/n*10);return a%10==0?a/10+r:(a/10).toFixed(1)+r},pad:function(t,e,i){for(t=t.toString();parseInt(t,10)<i&&i>1;i/=10)t=e+t;return t},_determine_locale_separators:function(){1.2.toFixed(1).indexOf(".")>=0?TextFormat._separators={decimal:".",thousands:","}:TextFormat._separators={decimal:",",thousands:"."}},commafyNumber:function(t){TextFormat._separators||TextFormat._determine_locale_separators();const e=t.split(TextFormat._separators.decimal);let i=e[0];const n=e[1]?TextFormat._separators.decimal+e[1]:"";let s=!1;if(0==i&&!n)return"0";"-"===i.substr(0,1)&&(i=i.substr(1),s=!0);const r=i.length;let a="",o=0;for(;(r-o)%3>0;)a+=i.substr(o,1),o++;for(a.length>0&&r-o>0&&(a+=TextFormat._separators.thousands);r-o>3;)a+=i.substr(o,3)+TextFormat._separators.thousands,o+=3;return r-o>0&&(a+=i.substr(o)),(s?"-":"")+a+n},noOrphan:function(t){return t.replace(/([^ ]+) +([^ ]+)$/,"$1$2")}};function addExpandEventListeners(t,e){$(t).off(".bcExpand").on("paste.bcExpand keyup.bcExpand focus.bcExpand",(function(t){updateFieldHeight(t,e)}))}function updateFieldHeight(t,e){const i=t.target,n=250,s=parseInt(i.clientHeight);let r=parseInt(i.scrollHeight);e?(i.style.height="auto",i.style.height=r>n?n+"px":i.scrollHeight+"px"):r>s&&(r>n&&(r=n),i.style.height=r+"px")}function addShrinkEventListeners(t,e){$(t).blur((function(t){shrinkFieldHeight(t,e)}))}function shrinkFieldHeight(t,e){const i=t.target;parseInt(i.scrollHeight)>e&&(i.style.height=e+"px")}function addCharacterCountdownEventListeners(t,e,i){function n(n){let s=i-$(t).val().length;$(e).toggleClass("notable",s<=0),s<0&&n&&($(t).val($(t).val().substr(0,i)),s=0),$(e).find(".counter").text(""+s)}$(t).on("input",(function(){n(!0)})),(!("oninput"in t)||"ie"===Browser.make&&Browser.version[0]<=9)&&$(t).on("paste cut keyup",(function(){setTimeout(n,0,!0)})),n(!1)}function InterruptibleTimer(){this._timer=null}InterruptibleTimer.prototype={start:function(t,e){this.stop(),this._timer=setTimeout(t,e)},stop:function(){clearTimeout(this._timer)}};var WatchInput={watchInput:function(t,e,i){$assert("string"==typeof t),null==this.__watching&&(this.__watching={});const n=this.__watching[t]={};n.__watchInput_elt=t,n.__watchInput_default=e,n.__watchInput_type=i||"float";const s=this;setTimeout((function(){s.__watchInput(t)}),500)},__watchInput:function(t){const e=this.__watching[t];if(!e)return;let i;const n=elt(e.__watchInput_elt);if(!n)return void(this.__watching[t]=null);const s=null==n.value?n.innerHTML:n.value;switch(e.__watchInput_type){case"float":var r=parseFloat(s);isNaN(r)&&(r=e.__watchInput_default);break;case"integer":r=parseInt(s);isNaN(r)&&(r=e.__watchInput_default);break;default:r=s}if(r!=e.__watchInput_Last&&this.inputChanged)try{this.inputChanged(r,e.__watchInput_elt)}catch(i){Log.error(i)}e.__watchInput_Last=r;const a=this;setTimeout((function(){a.__watchInput(t)}),500)}},Expression={eval:function(t,e,i){const n=this.init(t,e,i),s=this.parse_top(n);if("end"!=this.next_token(n).kind)throw"Expression error: '"+n.expr+"' -- end expected";return s},dump:function(t,e,i){const n=this.init(t,e,i);for(;;){const t=this.next_token(n);if(console.log(t.kind+" "+t.value),"end"==t.kind)break}},init:function(t,e,i){const n={};return n.expr=t,n.handle_constants=i,n.eval_lambda=e,n.return_prev_token=!1,n.short_circuit=!1,n},OPERATORS:["||","&&","<=","==","!=",">=","<",">","+","-","*","/","%","!","(",")"],next_token:function(t){if(t.return_prev_token)return t.return_prev_token=!1,t.previous_token;const e={};if(t.expr=t.expr.replace(/^\s+/,""),""==t.expr)e.kind="end";else{for(let i=0;i<this.OPERATORS.length;++i){const n=this.OPERATORS[i];if(t.expr.substr(0,n.length)==n){e.kind=n,t.expr=t.expr.slice(n.length);break}}if(!e.kind){let i;i=t.expr.match(/^(\'[^\']*\')/)||t.expr.match(/^(\"[^\"]*\")/)||t.expr.match(/([^\s\+\-\*\/\%\(\)\<\=\>\!\&\|\'\"]+)/),i&&(e.value=i[1],e.kind="term",t.expr=t.expr.slice(e.value.length))}}return t.previous_token=e,e},backup:function(t){t.return_prev_token=!0},is_true:function(t){return!1!==t&&null!=t},parse_top:function(t){return this.parse_boolean_op(t)},parse_boolean_op:function(t){let e=this.parse_comparison_op(t);for(;;)switch(this.next_token(t).kind){case"||":if(this.is_true(e)){var i=t.short_circuit;t.short_circuit=!0,this.parse_boolean_op(t),t.short_circuit=i}else e=this.parse_comparison_op(t);break;case"&&":if(this.is_true(e))e=this.parse_comparison_op(t);else{i=t.short_circuit;t.short_circuit=!0,this.parse_boolean_op(t),t.short_circuit=i}break;default:return this.backup(t),e}},parse_comparison_op:function(t){let e,i=this.parse_additive_op(t);for(;;)switch(e=this.next_token(t).kind){case"<":case"<=":case"==":case"!=":case">=":case">":i=this.evaluate_comparison(e,i,this.parse_additive_op(t));break;default:return this.backup(t),i}},evaluate_comparison:function(t,e,i){if("=="===t)return e&&e.is_money?i&&i.is_money&&e.currency===i.currency&&e.amount===i.amount:e==i;if("!="===t)return!this.evaluate_comparison("==",e,i);if(void 0!==e&&void 0!==i||Log.error("Expression: inequality comparison with an undefined operand will always return false"),e&&e.is_money){if(!i||!i.is_money)throw"money cannot be compared with non-money";if(e.currency!==i.currency)throw"money comparison currency mismatch";e=e.amount,i=i.amount}switch(t){case"<":return e<i;case">":return e>i;case"<=":return e<=i;case">=":return e>=i;default:throw"invalid comparison operator: "+t}},parse_additive_op:function(t){let e=this.parse_multiplicative_op(t);for(;;)switch(this.next_token(t).kind){case"+":e+=this.parse_multiplicative_op(t);break;case"-":e-=this.parse_multiplicative_op(t);break;default:return this.backup(t),e}},parse_multiplicative_op:function(t){let e=this.parse_term(t);for(;;)switch(this.next_token(t).kind){case"*":e*=this.parse_term(t);break;case"/":e/=this.parse_term(t);break;case"%":e%=this.parse_term(t);break;default:return this.backup(t),e}},parse_term:function(t){const e=this.next_token(t);let i;switch(e.kind){case"(":if(i=this.parse_top(t),")"!=this.next_token(t).kind)throw"Expression error: '"+t.expr+"' -- unbalanced parentheses";break;case"+":i=this.parse_term(t);break;case"-":i=-this.parse_term(t);break;case"!":i=!this.is_true(this.parse_term(t));break;case"term":if(!t.short_circuit){let n=t.handle_constants;if(n&&(n=this.constant(e.value),n&&(i=n.v)),!n){if(!t.eval_lambda)throw"Expression error: '"+t.expr+"' -- not a term";i=t.eval_lambda(e.value)}}}return t.short_circuit?1:i},constant:function(t){let e;return t.match(/^\d/)?t.match(/e|E|\./)?{v:parseFloat(t)}:{v:parseInt(t)}:(e=t.match(/^\'(.*)\'$/)||t.match(/^\"(.*)\"$/))?{v:e[1]}:"true"==t?{v:!0}:"false"==t?{v:!1}:"nil"==t?{v:null}:null}},StatusSpinny={spinnyID:"status-spinny",spinningClass:"spinning",timeouts:[],showQueue:[],showingQueue:!1,isShown:!1,spinny:function(t){let e=$("#"+StatusSpinny.spinnyID);return 0===e.length&&(e=$('<div id="'+StatusSpinny.spinnyID+'"></div>').appendTo(document.body)),"boolean"==typeof t&&e[t?"addClass":"removeClass"](StatusSpinny.spinningClass),e},show:function(t,e,i,n){void 0!==i&&null!=i||(i=""),StatusSpinny.resetTimeouts();const s=function(){StatusSpinny.isShown=!0,StatusSpinny.spinny(e).html(i).fadeIn(t),"number"==typeof n&&StatusSpinny.timeout(n)};StatusSpinny.isShown?StatusSpinny.scheduleShow(i,s):s()},scheduleShow:function(t,e){if(StatusSpinny.showQueue.push({message:t,fn:e}),!StatusSpinny.showingQueue){StatusSpinny.showingQueue=!0;var i=function(){StatusSpinny.hide(100,null,(function(){if(StatusSpinny.showQueue.length>2){const t=StatusSpinny.showQueue.shift();for(;StatusSpinny.showQueue.length>1&&t.message==StatusSpinny.showQueue[1].message;)StatusSpinny.showQueue=StatusSpinny.showQueue.slice(2);t.fn()}else{if(!(StatusSpinny.showQueue.length>0))return StatusSpinny.showingQueue=!1,null;StatusSpinny.showQueue.shift().fn()}window.setTimeout(i,1500)}))};i()}},wouldShowAfter:function(t,e,i,n,s){const r=StatusSpinny.timeoutId(),a=StatusSpinny.spinny();return a.on(r,(function(){StatusSpinny.show(e,i,n,s)})),window.setTimeout((function(){a.trigger(r)}),t),r},hide:function(t,e,i){void 0!==e&&"string"==typeof e&&StatusSpinny.spinny().off(e),void 0===t&&(t="fast"),StatusSpinny.spinny().fadeOut(t,i),StatusSpinny.isShown=!1},timeout:function(t){const e=StatusSpinny.timeoutId(),i=StatusSpinny.spinny();i.on(e,StatusSpinny.hide),StatusSpinny.timeouts.push(e),window.setTimeout((function(){i.trigger(e)}),t)},resetTimeouts:function(){for(;StatusSpinny.timeouts.length>0;)StatusSpinny.spinny().off(StatusSpinny.timeouts.shift())},timeoutId:function(){return(new Date).getTime()+""+Math.random()}},TaskQueue=function(){this.queue=[]};TaskQueue.prototype.addTask=function(t,e){this.queue.push({task:t,delay:e})},TaskQueue.prototype.run=function(){const t=this.queue.shift(),e=this;t&&setTimeout((function(){t.task(),e.run()}),t.delay)};var PromiseQueue=function(){this._queue=[]};PromiseQueue.prototype.add=function(t){this._queue.push(t),1===this._queue.length&&this.execute()},PromiseQueue.prototype.execute=function(){const t=this;if(0===this._queue.length)return;const e=this._queue[0];e().then((function(){t._queue.splice(t._queue.indexOf(e),1),t.execute()}))};var Templ=function(){"use strict";const t=function(){const t=document.querySelector("#pagedata");return t&&JSON.parse(t.dataset.blob)},e="en",i=t(),n=window.Translate&&Translate.locale||i&&i.locale||e,s=n!==e?"."+n:"",r="(\\s+|^)",a="(\\()?",o="(http://|https://)?",l="(([^@\\./\\s\\/'\"><&]+)(\\.[^@\\./\\s\\/'\"><&]+)*(\\.[a-z]{2,}))",c="(?::\\d+)?",u="(/[^?\\s]*?)?",h="(\\?[^#\\s]*?)?",d="(#[^\\s]*?)?",p="(\\))?",_="([.,;](\\s|$)|\\s+|$)",m=new RegExp(r+a+o+l+c+u+h+d+p+_+"|(\\s+\\(?|^\\(?)([^\\s\\(\\)\"'/><,@]+@\\w([^\\s\\(\\)\"'/><&,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/><&,@]*\\w)(\\)?\\s+|\\)?$)","i"),f=new RegExp(r+a+o+l+c+u+h+d+p+_),g={".com":!0,".ru":!0,".org":!0,".net":!0,".de":!0,".jp":!0,".uk":!0,".br":!0,".it":!0,".pl":!0,".fr":!0,".in":!0,".au":!0,".ir":!0,".info":!0,".nl":!0,".cn":!0,".es":!0,".cz":!0,".kr":!0,".ca":!0,".eu":!0,".ua":!0,".co":!0,".gr":!0,".za":!0,".ro":!0,".biz":!0,".ch":!0,".se":!0,".tw":!0,".mx":!0,".vn":!0,".hu":!0,".be":!0,".tr":!0,".at":!0,".dk":!0,".tv":!0,".me":!0,".ar":!0,".sk":!0,".no":!0,".us":!0,".fi":!0,".id":!0,".cl":!0,".xyz":!0,".io":!0,".pt":!0,".by":!0,".il":!0,".ie":!0,".nz":!0,".kz":!0,".hk":!0,".lt":!0,".cc":!0,".my":!0,".sg":!0,".club":!0,".bg":!0,".edu":!0,".pk":!0,".su":!0,".top":!0,".th":!0,".hr":!0,".rs":!0,".pe":!0,".pro":!0,".si":!0,".lv":!0,".az":!0,".pw":!0,".ae":!0,".ph":!0,".online":!0,".ng":!0,".ee":!0,".ws":!0,".ve":!0,".pizza":!0,".cat":!0},b=new RegExp("(^|\\.)("+["bandcamp\\.com","bigcartel\\.com","blogspot\\.com","dailymotion\\.com","facebook\\.com","instagram\\.com","myspace\\.com","patreon\\.com","soundcloud\\.com","spotify\\.com","tumblr\\.com","twitter\\.com","vimeo\\.com","wordpress\\.com","youtu\\.be","youtube\\.com"].join("|")+")$"),y=new RegExp("^www\\.(\\w+\\.("+["bandcamp\\.com","blogspot\\.com","bigcartel\\.com","tumblr\\.com","wordpress\\.com"].join("|")+"))$"),k=/(?:^|\.)bandcamp.com$/i,v=/\brel=["']([^"']*)["']/i,w=/\breferrerpolicy=["']/i,D=/(^|\s)\*(\S|\S.*?\S)\*(?=\s|$)/g;function x(t,e){t=""+t;let i="";for(D.lastIndex=0;;){const n=D.lastIndex,s=D.exec(t);if(!s){i+=t.substring(n,t.length);break}i+=t.substring(n,s.index),i+=s[1],e&&(i+="<"+e+">"),i+=s[2],e&&(i+="</"+e+">")}return i}return{cfgFlags:i&&i.cfg||{},locale:n,locale_suffix:s,templates:{},globals:null,register:function(t){Object.assign(Templ.templates,t)},getGlobals:function(){if(!Templ.globals){const e=t(),i=e&&e.templglobals,n="undefined"!=typeof TemplGlobals?TemplGlobals:null;Templ.globals=Object.assign({},n,i)}return Templ.globals},RENDER_SPEED_TEST:!1,render:function(t,e){const i=Object.assign({},Templ.getGlobals(),e),n=new Templ.Context(i);let s=[];if(this.RENDER_SPEED_TEST){Log.debug(">>> start rendering "+t);const e=new Date;for(let e=0;e<100;++e)s=[],Templ.renderInternal(t,n,s);const i=new Date;Log.debug(">>> end rendering "+t+" - "+(i-e)/100+"ms")}else Templ.current_context=n,Templ.renderInternal(t,n,s),Templ.current_context=null;return s.join("")},runWithContext:function(t){const e=new Templ.Context(Templ.getGlobals());Templ.current_context=e,t(),Templ.current_context=null},renderElem:function(t,e,i){(t=elt(t)).innerHTML=Templ.render(e,i)},renderTableRow:function(t,e,i){t=elt(t);const n=document.createElement("DIV");n.innerHTML="<table><tbody><tr>"+Templ.render(e,i)+"</tr></tbody></table>";const s=n.firstChild.firstChild.firstChild;for(;null!=t.firstChild;)t.removeChild(t.firstChild);for(;null!=s.firstChild;)t.appendChild(s.removeChild(s.firstChild))},renderInternal:function(t,e,i){const n=Templ.templates[t+Templ.locale_suffix]?Templ.templates[t+Templ.locale_suffix]:Templ.templates[t];if(n)Templ.renderTokens(n,e,i);else{const e="[template not found: "+t+"]";i.push(e),Log.server(e,"warn")}},renderTokens:function(t,e,i){if(t)for(let n=0;n<t.length;n++){const s=t[n];if("string"==typeof s)i.push(s);else try{Templ.renderOneToken(s,e,i)}catch(t){throw Log.error("Error rendering token",s,"context",e),t}}},renderOneToken:function(t,e,i){let n,s;switch(t.type){case"translate":case"translateVariable":Templ.renderTokens(t.nodelist,e,i);break;case"translatePlural":for(n=0;n<t.blocks.length;n++)if(s=t.blocks[n],Templ.evalNCondition(s,e)){Templ.renderTokens(s.attachment,e,i);break}break;case"variable":if(!t.name)return;var r=Expression.eval(t.name,(function(t){return e.resolve(t)})),a=Templ.filters;Iter.each(t.filters,(function(t){const i=Iter.collect(t[1],(function(t){return e.resolve(t)})),n=t[0]?a[t[0]]:null;n?(i.unshift(r),r=n.apply(null,i)):(r="[template error: filter not found: "+t[0]+"]",Log.error(r))})),null!=r&&(Array.isArray(r)&&(r=r.join("")),i.push(r));break;case"assign":e.hash[t.to]=e.resolve(t.from);break;case"case":case"if":var o=t.blocks;for(n=0;n<o.length;n++)if(s=o[n],Templ.evalCondition(s,e)){Templ.renderTokens(s.attachment,e,i);break}break;case"for":var l=e.resolve(t.collection_name);l instanceof Templ.Range&&(l=l.expand());var c=t.nodelist,u=null!=t.attribs.offset?e.resolve(t.attribs.offset):0,h=l?l.length-u:0;null!=t.attribs.limit&&(h=Math.min(h,e.resolve(t.attribs.limit)));var d=l?l.slice(u,u+h):[];for(t.reversed&&d.reverse(),e.stashLoopvars(),n=0;n<h;n++)e.hash[t.variable_name]=d[n],e.hash.forloop={length:h,index:n+1,index0:n,rindex:h-n,rindex0:h-n-1,first:0===n,last:n===h-1},Templ.renderTokens(c,e,i);e.restoreLoopvars();break;case"include":var p=e.resolve(t.template_name);Templ.renderInternal(p,e,i);break;case"capture":var _=[];Templ.renderTokens(t.nodelist,e,_);var m="";for(n=0;n<_.length;n++)m+=_[n];e.hash[t.to]=m;break;case"ef":for(o=t.blocks,n=0;n<o.length;n++)if(s=o[n],Templ.evalNCondition(s,e)){Templ.renderTokens(s.attachment,e,i);break}break;case"let":e.hash[t.variable]=Expression.eval(t.expression,(function(t){return e.resolve(t)}))}},evalNCondition:function(t,e){return"else_ncondition"==t.type||Templ.isTrue(Expression.eval(t.expression,(function(t){return e.resolve(t)})))},evalCondition:function(t,e){if("else_condition"==t.type)return!0;let i;const n=e.resolve(t.left),s=t.operator;if(s){const r=Templ.operators[s];if(!r)return Log.error("template: unrecognized operator: "+s),!1;i=r(n,e.resolve(t.right))}else i=Templ.isTrue(n);return"or"==t.child_relation?i=Templ.isTrue(i)||Templ.isTrue(Templ.evalCondition(t.child_condition,e)):"and"==t.child_relation&&(i=Templ.isTrue(i)&&Templ.isTrue(Templ.evalCondition(t.child_condition,e))),i},isTrue:function(t){return!1!==t&&null!=t},EMPTY:{equals:function(t){return t==this||(!t||""===t.toString())}},Range:function(t,e){this.start=t,this.end=e,this.expand=function(){const t=[];for(let e=this.start;e<=this.end;e++)t.push(e);return t}},operators:{"==":T,"!=":function(t,e){return!T(t,e)},"<>":function(t,e){return!T(t,e)},"<":function(t,e){return Expression.evaluate_comparison("<",t,e)},">":function(t,e){return Expression.evaluate_comparison(">",t,e)},"<=":function(t,e){return Expression.evaluate_comparison("<=",t,e)},">=":function(t,e){return Expression.evaluate_comparison(">=",t,e)},contains:function(t,e){if("string"==typeof t)return t.indexOf(e)>=0;if(Array.isArray(t)){for(let i=0;i<t.length;i++)if(t[i]==e)return!0;return!1}return t instanceof Templ.Range&&(e>=t.start&&e<=t.end)}},filters:{size:function(t){return t?t.length:0},downcase:function(t){return null!=t?t.toString().toLowerCase():""},upcase:function(t){return null!=t?t.toString().toUpperCase():""},escape:function(t){return null!=t?Text.escapeHtml(t.toString()):""},escape_html_attr:function(t){return Templ.filters.escape(t)},noblanks:function(t,e){let i;return i=e?t.replace(/(\n *)+/g,"").replace(/\n--/g,"\n"):t.replace(/(\n *)+/g,"\n").replace(/\n--/g,"\n"),i},strip:function(t){return null!=t?t.toString().trim():""},strip_html:function(t){return null!=t?t.toString().replace(/<.*?>/g,""):""},strip_newlines:function(t){return null!=t?t.toString().replace(/\n/g,""):""},newline_to_br:function(t){return null!=t?t.toString().replace(/\n/g,"<br />\n"):""},newline_to_gap:function(t,e){const i=e?/(\n[\r\t ]*)+\n/g:/\n[\r\t ]*\n/g;return null!=t?t.toString().replace(i,'<br /><span class="lightweightBreak" /></span><br />').replace(/\n/g,"<br />\n"):""},replace:function(t,e,i){return Templ.filters.replace_regex(t,Text.regexpEscape(e),i)},replace_regex:function(t,e,i){if(null==t)return"";null==i&&(i="");return(t=t.toString()).replace(new RegExp(e,"gm"),i)},replace_first:function(t,e,i){return null==i&&(i=""),null!=t?t.toString().replace(e,i):""},remove:function(t,e){return Templ.filters.replace(t,e)},remove_first:function(t,e){return Templ.filters.replace_first(t,e)},encode_uri_c:function(t){return null!=t?encodeURIComponent(t).replace(/'/g,"%27"):""},join:function(t,e){return null==e&&(e=" "),Array.isArray(t)?t.join(e):t},sort:function(t){return Array.isArray(t)?t.slice(0).sort((function(t,e){return t>e?1:t<e?-1:0})):t},first:function(t){return Array.isArray(t)?t[0]:null},last:function(t){return Array.isArray(t)&&t.length?t[t.length-1]:null},edit_if_empty:function(t,e,i,n){return t&&t.length>0?t:Templ.filters.edit_field(n,e,i)},edit_field:function(t,e,i){return'<a href="/edit?id='+e+"&focus="+i+'">'+t+"</a>"},date:function(t,e){return"string"==typeof t&&(t=new Date(Date.parse(t))),Time.strftime(t,e)},time:function(t,e,i){return Time.toUi(t,e,n,i)},ui_datetime:function(t){return t?Time.toUi(t,1,n):""},ui_date:function(t,e){return t?e?Time.toUi(t,4,n):Time.toUi(t,2,n):""},to_date:function(t){return new Date(1e3*t)},relative_day:function(t,e){return t?Time.relativeDay(t,n,e):""},relative_time:function(t,e){return t?Time.relativeTime(t,n,e):""},relative_duration:function(t,e){return t?Time.relativeDuration(t,n,e):""},json:function(t){return JSON.stringify(t)},plural:function(t,e,i){return null==i&&(i=e+"s"),"1"==t?e:i},capitalize:function(t){return t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()},capitalize_first_character:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},titlecase:function(t){return null!=t?t.toString().replace(/\w\S*/g,(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})):""},currency:function(t,e,i,n,s){return null==t?"":TextFormat.currency(t,window.CurrencyData?CurrencyData.info[e||"USD"]:null,i,n,s)},money:function(t,e,i){return TextFormat.money(t,e,i)},million_usd:function(t){return TextFormat.million_usd(t,n)},negate:function(t){return t&&t.is_money?{amount:-t.amount,currency:t.currency,is_money:!0}:"number"==typeof t?-t:""},abs:function(t){return t&&t.is_money?{amount:Math.abs(t.amount),currency:t.currency,is_money:!0}:"number"==typeof t?Math.abs(t):""},truncate:function(t,e,i){return i=i||"...",Text.truncate(t,e,i)},add_query_parm:function(t,e){return t?null===e||0===e.length?t:t+(t.indexOf("?")>-1?"&":"?")+e:""},mb:function(t){return TextFormat.toMb(t)},mb_si:function(t){return TextFormat.toMb(t,!0)},url:function(t,e,i){let n=e?"https_url":"url";return i&&("_"!=(i+="").charAt(i.length-1)&&(i+="_"),n=i+n),t[n]},commafy:function(t){return TextFormat.commafyNumber(""+t)},smallest_number_text:function(t,e){const i=parseInt(t);let n=i.toString();if(isNaN(i)||n.length<=e)return TextFormat.commafyNumber(n);let s=Math.floor(i/1e3*10)/10;if(s>0&&(n=s+"K"),n.length<=e)return n;if(s=Math.floor(s),s>0&&(n=s+"K"),n.length<=e||i<1e6)return n;let r=Math.floor(i/1e6*10)/10;return n=r+"M",n.length<=e||(r=Math.floor(r),n=r+"M",n.length),n},fan_link:function(t,e){return"<a href='"+t.trackpipe_url+"' style='"+e+"'>"+t.name+"</a>"},add_product_utm:function(t,e){let i="";if(!t)return i;let n,s=0,r=t;for(;s<300&&(n=f.exec(r));){if(s++,i+=r.substring(0,n.index),r=r.substring(n.index+n[0].length),!n[3]&&!g[n[7].toLowerCase()]){i+=n[0];continue}let t=[n[3]||"http://",n[4],n[8],n[9],n[10],n[11]].join(""),e="";"("===n[2]&&")"===t[t.length-1]&&(t=t.substring(0,t.length-1),e=")"),i+=(n[1]||"")+(n[2]||""),i+=t,i+=e,i+=void 0===n[12]?" ":n[12]}return i+=r,i},highlight_mention:function(t,e){return t.split("@"+e).join("<span class='mention-highlight'>@"+e+"</span>")},html_autolink:function(t,e,i){i=i||!0;let n="";if(!t)return n;e?" "!==e[0]&&(e=" "+e):e="",t=t.replace(/ +/g," ");let s,r=0;const a=i?m:f;let o=t;for(;r<300&&(s=a.exec(o));){if(r++,n+=Text.escapeHtml(o.substring(0,s.index)),o=o.substring(s.index+s[0].length),s[15])n+=" ",n+=Text.escapeHtml(s[14].substring(s[14].length-1)),n+='<a href="mailto:',n+=Text.escapeHtml(s[15]),n+='">',n+=Text.escapeHtml(s[15]),n+="</a>",n+=Text.escapeHtml(void 0===s[17]?" ":s[17]);else{if(!s[3]&&!g[s[7].toLowerCase()]){n+=s[0];continue}const t="https://"==s[3]||b.test(s[4])?"https://":"http://",i=s[4].replace(y,"$1"),r=s[9]&&"?"+s[9].substr(1).split("&").filter((function(t){return"utm_"!==t.substr(0,4)})).join("&");let a=[i,"/"===s[8]?"":s[8],r,s[10],s[11]].join(""),o=[t,i,s[8],s[9],s[10],s[11]].join(""),l="";"("===s[2]&&")"===o[o.length-1]&&(o=o.substring(0,o.length-1),a=a.substring(0,a.length-1),l=")"),n+=" ",n+=Text.escapeHtml((s[1]||"")+(s[2]||"")),n+='<a href="',n+=Text.escapeHtml(o),n+='"',n+=S(a,e),n+=">",n+=Text.escapeHtml(a),n+="</a>",n+=l,n+=Text.escapeHtml(void 0===s[12]?" ":s[12])}n+=" "}return n+=Text.escapeHtml(o),n},plus:function(t,e){return t+e},minus:function(t,e){return t-e},times:function(t,e){return t*e},divided_by:function(t,e){return t==Math.floor(t)&&e==Math.floor(e)?Math.floor(t/e):t/e},image:function(t,e){const i="number"==typeof t||!t,n=i?t:t.image_id,s=Templ.filters.image_url(n,e);if(i)return'src="'+s+'"';{const i=ImageUtils.imageDimensions(t.width,t.height,e);return'src="'+s+'" width="'+i.width+'" height="'+i.height+'"'}},image_url:function(t,e){return ImageUtils.imageURL(t,e,Templ.current_context.resolve("is_https"))},art:function(t,e){return'src="'+Templ.filters.art_url(t,e)+'"'},art_url:function(t,e){return ImageUtils.artURL(t,e,Templ.current_context.resolve("is_https"))},popup_image:function(t,e){const i="number"==typeof t,n=i?t:t.image_id,s=Templ.filters.image_url(n,e);if(i)return'href="'+s+'"';{const i=ImageUtils.imageDimensions(t.width,t.height,e);return'href="'+s+'" data-image-size="'+i.width+","+i.height+'"'}},image_width:function(t,e){return ImageUtils.imageDimensions(t.width,t.height,e).width},image_height:function(t,e){return ImageUtils.imageDimensions(t.width,t.height,e).height},possessify:function(t){return null===t||"string"!=typeof t||n&&n!=e?t:/s$/.test(t)?t+"'":t+"'s"},possessify_smart:function(t){return null===t||"string"!=typeof t||n&&n!=e?t:/s$/.test(t)?t+"":t+"s"},enumerate_items:function(t,e){void 0===e&&(e="and");var i=function(t){return 0===t.length||null===t?"":1===t.length?t[0]:2===t.length?t[0]+" "+e+" "+t[1]:t[0]+", "+i(t.slice(1,t.length))};return i(t)},fan_page_url:function(t){return Templ.current_context.resolve("siteroot_current")+"/"+t},band_url:function(t){if(!t)return"";const e=t.custom_domain,i=t.custom_domain_verified,n=t.subdomain,s=Templ.current_context.resolve("custom_domains_active"),r=Templ.current_context.resolve("base_port_str")||"",a=Templ.current_context.resolve("sitedomain");return s&&e&&i?"https://"+e+r:n?location.protocol+"//"+n+"."+a:""},lpad:function(t,e){void 0===e&&(e=10);const i=(t=String(t)).length;let n="";return e-i>0&&(n=new Array(e-i+1).join(" ")),n+t},asterisks_to_em:function(t){return x(t,"em")},strip_asterisks:function(t){return x(t,null)},tralbum_url:function(t){if(!t)return"";let e="";switch(t.item_type){case"a":e="/album/";break;case"t":e="/track/";break;case"p":e="/merch/";break;case"c":e="/campaign/"}return Templ.filters.band_url(t)+e+t.slug},subscribe_url:function(t){if(!t)return"";const e=t.subscribe_url_fragment||"subscribe";return Templ.filters.band_url(t)+"/"+e},featured_track_url:function(t,e){return t?Templ.filters.tralbum_url(t)+"?t="+e:""},hex_to_rgb:function(t){if(!t)return null;if("#"===t[0]&&(t=t.substring(1)),!t.match(/[0-9A-Fa-f]{6}/))return null;const e=parseInt(t,16);return(e>>16&255)+", "+(e>>8&255)+", "+(255&e)},fixnum:function(t,e){return t.toFixed(e)},wrap_emojis:function(t){const e=/(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDC8F\uDC91\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD0C\uDD0F\uDD18-\uDD1F\uDD26\uDD30-\uDD39\uDD3C-\uDD3E\uDD77\uDDB5\uDDB6\uDDB8\uDDB9\uDDBB\uDDCD-\uDDCF\uDDD1-\uDDDD\uDEC3-\uDEC5\uDEF0-\uDEF8])(?:\uD83C[\uDFFB-\uDFFF])?|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDED5-\uDED7\uDEDC-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDDFF\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEDC-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDDFF\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8])\uFE0F/g;if(t.match(e)&&!t.match(/\u270C/g)){return"<span>"+t.replace(e,(function(t){return"<span class='emoji'>"+t+"</span>"}))+"</span>"}return t}},Context:function(t){this.hash=t||{},this.loopvars=null}};function T(t,e){return t==Templ.EMPTY?t.equals(e):e==Templ.EMPTY?e.equals(t):Expression.evaluate_comparison("==",t,e)}function S(t,e){const i=t.split("/")[0];let n;if(k.test(i))return e;if(n=v.exec(e)){let t=n[1];-1===t.indexOf("nofollow")&&(t+=" nofollow ugc"),e=e.substring(0,n.index)+'rel="'+t+'"'+e.substring(n.index+n[0].length)}else e+=' rel="nofollow ugc"';return w.test(e)||(e+=' referrerpolicy="strict-origin-when-cross-origin"'),e}}();Templ.filters.h=Templ.filters.escape,Templ.filters.a=Templ.filters.attr=Templ.filters.escape_html_attr,Templ.filters.u=Templ.filters.encode_uri_c,Templ.Context.prototype=function(){"use strict";const t=/\[[^\]]+\]|[\w-]+\??/g,e=/^\[(.+)\]$/;return{resolve:function(t){switch(t){case null:case"nil":case"null":case"":return null;case"true":return!0;case"false":return!1;case"empty":return Templ.EMPTY}let e;return(e=/^'(.*)'$/.exec(t))||(e=/^"(.*)"$/.exec(t))?e[1]:/^\d+$/.test(t)?parseInt(t):(e=/^\((\S+)\.\.(\S+)\)$/.exec(t))?new Templ.Range(this.resolve(e[1]),this.resolve(e[2])):/^(\d[\d\.]+)$/.test(t)?parseFloat(t):this.variable(t)},variable:function(i){const n=t.lastIndex;t.lastIndex=0;let s,r,a,o=this.hash;try{for(;s=t.exec(i);)a=s[0],(r=e.exec(a))&&(a=this.resolve(r[1])),o="size"!==a&&"first"!==a&&"last"!==a||o&&"object"==typeof o&&o.hasOwnProperty(a)?o&&o[a]:Templ.filters[a](o);return o}finally{t.lastIndex=n}},stashLoopvars:function(){const t=this.hash.forloop;t&&(this.loopvars=this.loopvars||[],this.loopvars.push(t))},restoreLoopvars:function(){this.loopvars&&(this.hash.forloop=this.loopvars.pop())}}}();var HTMLEmbeddedPlayer3=function(){function t(t,i,s){const r=this;this._playlist=t,this._params=i,this._playerdata=s,this._tracklistelems=[],this._artist=s.artist,this._elems={},this._root_elem=document.getElementById("player");for(const t in n){const e=n[t];this._elems[e]=document.getElementById(e)}this._albumtitle=s.album_title,this._is_exclusive=!!i.esig||!!i.fesig,this.effectively_single_track=!1,this._is_exclusive&&this._playlist.first_playable_track===this._playlist.last_playable_track&&(this.effectively_single_track=!0),this._hookup_ui(),i.bgcol&&(i.transparent||(this._elems.player.style.background="#"+i.bgcol),Color.isDark(i.bgcol)&&(e(document.body,"invertIconography"),e(this._root_elem,"theme-dark")));const a=i.twittercard&&"true"==i.twittercard;let o=s.linkback+"?from="+(a?"twittercard":"embed")+(i.daily?"&context=daily":""),l="";if(i.campaign&&""!=i.campaign&&i.campaign.length<=50&&/^[a-z0-9_-]+$/.test(i.campaign)&&(l="&campaign="+i.campaign,o+=l),this._elems.maintextlink.href=o,this._elems.subtextlink.href=o,this._elems.tracknamelink.href=o,this._elems.artlink.href=o,$(this._root_elem).find(".artlink").attr("href",o),this._elems.infolink.href=o,$(this._root_elem).find(".logo").attr("href",o),this._elems.logoalt.href=o,this._elems.logoalt2.href=o,this._elems.buyordownloadlink.href=s.linkback+"?action="+(s.linkback_action?s.linkback_action:"download")+"&from="+(a?"twittercard":"embed")+(i.daily?"&context=daily":"")+l,this._elems.buyordownloadlinkalt.href=this._elems.buyordownloadlink.href,this._elems.sharelink.href=s.linkback+"?action=share&from="+(a?"twittercard":"embed")+(i.daily?"&context=daily":"")+l,this._elems.sharelinkalt.href=this._elems.sharelink.href,$(this._elems.sharelink).click(this._makehandler("_handle_share_click")),$(this._elems.sharelinkalt).click(this._makehandler("_handle_share_click")),s.linkback_action){const t="buy"==s.linkback_action?"buy":"download";$(this._root_elem).addClass(t),this._is_exclusive?(s.is_preorder?$(this._root_elem).addClass("preorder"):$(this._root_elem).addClass("optional-streaming"),this._elems.buyordownloadlink.innerHTML="buy"==s.linkback_action?1==s.is_preorder?"pre-order":"buy":"download",this._elems.buyordownloadlinkalt.innerHTML="buy"==s.linkback_action?1==s.is_preorder?"pre-order":"buy":"download"):(s.is_preorder&&$(this._root_elem).addClass("preorder"),this._elems.buyordownloadlink.innerHTML="buy"==s.linkback_action?1==s.is_preorder?"pre-order":"buy":"download",this._elems.buyordownloadlinkalt.innerHTML="buy"==s.linkback_action?1==s.is_preorder?"pre-order":"buy":"download")}else this._elems.buyordownload.style.display="none",this._elems.buyordownloadalt.style.display="none";let c=null;if(i.album&&i.track){const e=Number(i.track);for(var u=0;u<t.length();u++){if((h=t.get_track_info(u)).id==e){i.t=u+1;break}}}if(i.t){const e=Number(i.t)-1;e>=0&&e<t.length()&&(c=e,t.set_initial_track(c))}if(null!=c&&"small"==i.size&&i.album){var h=t.get_track_info(c);this._elems.tracknamelink.href=h.title_link,t.load([h])}else for(u=0;u<t.length();u++){h=t.get_track_info(u);const e=this._create_playlist_item(h);var d=this;h.file?$(e).click(function(t){return function(){d._playlist.play_track(t)}}(u)):$(e).addClass("nostream"),$(this._elems.tracklist_ul).append(e),this._tracklistelems[h.tracknum+1]=e}const p=i.width;p&&p.match(/^[0-9]+$/)&&$(this._root_elem).css("width",p+"px");const _=i.size,m=i.artwork,f=!("large"!=_&&"medium"!=_||"none"!=m&&"false"!=m),g="medium"==_&&"none"!=m&&"false"!=m;if("large"==_&&"true"!=i.notracklist&&"false"!=i.tracklist&&$(this._root_elem).addClass("hastracklist"),f&&$(this._root_elem).addClass("noartwork"),g&&$(this._root_elem).addClass("smallartwork"),i.package&&s.packages){e(this._root_elem,"hasmerch");const t=Number(i.package);for(u=0;u<s.packages.length;u++){const i=s.packages[u];if(i.id==t){if(this._package=i,i.arts)for(let t=0;t<i.arts.length;t++){const n=i.arts[t];if(!n)continue;const s=document.createElement("div"),r=ImageUtils.imageURL(n.image_id,"art_thumbthumb");e(s,"merchthumb"),s.style.backgroundImage="url("+r+")";const a=function(t,e,i){const n=i;return function(i){$(".merchthumb").removeClass("selected"),t._showing_package_image!=e&&$(n).addClass("selected"),U.stopEvent(i),t.toggle_package_image(e)}}(this,t,s);$(s).click(a),this._elems.merch.appendChild(s)}break}}}this.isAlbum()?this.effectively_single_track?e(this._root_elem,"standalonetrackplayer"):e(this._root_elem,"albumplayer"):$(this._root_elem).is(".classic")?e(this._root_elem,"trackplayer"):this._albumtitle&&""!=this._albumtitle?e(this._root_elem,"albumtrackplayer"):e(this._root_elem,"standalonetrackplayer"),this._is_exclusive&&e(this._root_elem,"exclusive"),this._choose_size_classes(),this._root_elem.style.display="block",this._switch_track_artwork(c),this._setup_infolayer(),this._adjust_tracklist(),$(window).resize((function(){r._choose_size_classes(),r._setup_infolayer(),r._adjust_tracklist()}));try{window.parent.postMessage("playerinited","*")}catch(t){Log.warn("failed to postMessage: "+t)}}t.prototype={_switch_track_artwork:function(t){const e=this;$(this._root_elem).find(".art, #art").each((function(i,n){if(!(n=$(n)).is(":visible"))return;let s=n.width();const r=n.attr("id");let a=e._track_art_url(t,s);"art"==r&&(s=$(e._elems.art).width(),a=e._track_art_url(t,s),e._original_art=a,e._showing_package_image)||n.css("backgroundImage","url("+a+")")}))},toggle_package_image:function(t){if(this._showing_package_image==t)this._elems.art.style.backgroundImage="url("+this._original_art+")",this._showing_package_image=null;else{const e=this._package;this._elems.art.style.backgroundImage="url("+ImageUtils.imageURL(e.arts[t].image_id,"screen")+")",this._showing_package_image=t}},_hookup_ui:function(){$(this._elems.play).click(this._makehandler("_handle_play_click")),$(this._elems.tinyplayer).click(this._makehandler("_handle_tiny_click")),$(this._elems.next).click(this._makehandler("_handle_next_click")),$(this._elems.prev).click(this._makehandler("_handle_prev_click")),$("#artlink").click(this._makehandler("_handle_art_click")),$(".artlink").click(this._makehandler("_handle_art_click")),$("#artarea").click(this._makehandler("_handle_art_click")),$(".art").click(this._makehandler("_handle_art_click")),this._playlist.onstatechanged(this._handle_playlist_statechanged,this),this._playlist.ontime(this._handle_playlist_time,this),this._playlist.onloaded(this._handle_playlist_loaded,this),this._playlist.ontrackchanged(this._handle_playlist_trackchanged,this),this._playlist.onplaylistchanged(this._handle_playlist_playlistchanged,this);const t=this._playlist.get_track();this._handle_playlist_trackchanged(this._playerdata.tracks[t]),this._handle_playlist_time({position:0}),$("#shareurl").focus((function(){$(this).select().one("mouseup",(function(t){$(this).unbind("keyup"),t.preventDefault()})).one("keyup",(function(){$(this).select().unbind("mouseup")}))})),this._is_phone()?$(this._elems.timeline).on("touchstart",this._makehandler("_handle_seek_touchstart")):$(this._elems.progbar_thumb).draggable({start:this._makehandler("_handle_thumb_startdrag"),drag:this._makehandler("_handle_thumb_drag"),stop:this._makehandler("_handle_thumb_enddrag"),containment:"parent",axis:"x"})},_adjust_tracklist:function(){if($(this._root_elem).hasClass("has_info_slider"))return void $(this._root_elem).removeClass("hastracklist");const t=$(this._root_elem).height(),e=$(this._elems.tracklist),i=$(this._elems.infolayer),n=i.position().top+i.outerHeight(),s=e.position().top,r=(e.outerHeight(),$("#nonartarea").outerHeight()-$("#nonartarea").height());e.css("height",t-n-r+"px")},_scroll_tracklist:function(t){const e=$("#tracklist"),i=$("#tracklist li")[t-1];if(!i)return;const n=$(i).position().top-$("#tracklist").position().top,s=n+$(i).outerHeight(),r=e.scrollTop(),a=e.outerHeight();n<0?e.scrollTop(r+n):s>a&&e.scrollTop(r+s-a)},_setup_infolayer:function(){i(this._root_elem,"has_info_slider"),i(this._elems.infolayer,"fixed");const t=$(this._elems.infolayer),n=$("#artarea").width(),s=$("#artarea").height(),r=$(this._root_elem).width(),a=$(this._root_elem).height();if(a>s||r>n)return void e(this._elems.infolayer,"fixed");const o=t.position(),l=o.left,c=o.top,u=t.outerWidth(),h=t.outerHeight();this._infolayer_show_x=null,this._infolayer_show_y=null,l<0?this._infolayer_show_x=0:l>=r&&(this._infolayer_show_x=r-u),c<0?this._infolayer_show_y=0:c>=a&&(this._infolayer_show_y=a-h),null==this._infolayer_show_x&&null==this._infolayer_show_y||(e(this._root_elem,"has_info_slider"),this._infolayer_hide_x=l,this._infolayer_hide_y=c,null===this._infolayer_show_x&&(this._infolayer_show_x=l),null===this._infolayer_show_y&&(this._infolayer_show_y=c),t.css({left:l+"px",top:c+"px",bottom:"auto"}),$(this._root_elem).on("mouseenter",this._makehandler("_handle_hover")).on("mouseleave",this._makehandler("_handle_unhover")),$(window).resize(this._makehandler("_handle_doc_resize")))},_choose_size_classes:function(){i(this._elems.play,"big"),$(this._elems.play).width()>35&&e(this._elems.play,"big")},_handle_doc_resize:function(){if(this._infolayer_hide_x>0){const t=$(this._root_elem).width()-this._infolayer_hide_x;this._infolayer_hide_x+=t,this._infolayer_show_x+=t}if(this._infolayer_hide_y>0){const t=$(this._root_elem).height()-this._infolayer_hide_y;this._infolayer_hide_y+=t,this._infolayer_show_y+=t}(this._infolayer_hide_x>0||this._infolayer_hide_y>0)&&this._handle_unhover()},_makehandler:function(t){const e=this;return function(i){e[t].apply(e,[i])}},_handle_hover:function(){if($(this._root_elem).hasClass("has_info_slider")){$(this._elems.infolayer).stop(!0,!1).delay(400).animate({left:this._infolayer_show_x+"px",top:this._infolayer_show_y+"px",opacity:"1"},"fast","linear")}},_handle_unhover:function(){if($(this._root_elem).hasClass("has_info_slider")){$(this._elems.infolayer).stop(!0,!1).delay(1e3).animate({left:this._infolayer_hide_x,top:this._infolayer_hide_y,opacity:"0"})}},_handle_play_click:function(t){U.stopEvent(t),this._playlist.playpause(),this._hasplayed()},_handle_tiny_click:function(t){"tinyplayer"==t.target.id&&this._handle_play_click(t)},_handle_next_click:function(t){U.stopEvent(t),this._playlist.next_track(),this._playlist.play(),this._hasplayed()},_handle_prev_click:function(t){U.stopEvent(t),this._playlist.prev_track(),this._playlist.play(),this._hasplayed()},_handle_art_click:function(t){U.stopEvent(t),this._classic||(t.preventDefault(),this._playlist.playpause(),this._hasplayed())},_handle_share_click:function(t){const e=$(this._root_elem).width(),i=$(this._root_elem).height();!$(playerui._root_elem).is(".classic")&&e>=300&&i>=300&&(U.stopEvent(t),$("#sharedialog").dialog({width:"280px",height:210,modal:!0,position:{at:"center",of:"#artarea"},open:function(t,e){$(".ui-widget-overlay").bind("click",(function(){$("#sharedialog").dialog("close")})),this._social_controls_inited||(SocialControls.initFromDOM($("#sharedialog")),$(".share-embed-container").show(),this._social_controls_inited=!0)}}))},_handle_playlist_statechanged:function(t){switch(t.newstate){case"PLAYING":e(this._root_elem,"playing"),i(this._elems.play,"busy"),e(this._elems.play,"playing"),e(this._elems.tinyplayer,"playing");break;case"BUFFERING":case"BUSY":e(this._root_elem,"playing"),i(this._elems.play,"playing"),e(this._elems.play,"busy"),e(this._elems.tinyplayer,"playing");break;default:"COMPLETED"==t.newstate&&this._handle_playlist_time({position:0}),i(this._root_elem,"playing"),i(this._elems.tinyplayer,"playing"),i(this._elems.play,"busy"),i(this._elems.play,"playing")}},_handle_playlist_time:function(t){this._dragging||(this._trackpos=t.position),t.duration&&(this._tracklength=t.duration),this._updateprog()},_handle_playlist_loaded:function(t){this._loadpercent=t,this._updateprog()},_handle_playlist_trackchanged:function(t){this._trackinfo=t,this._tracklength=t.duration,this._songtitle=t.title||"";let n=this._tracklistelems[this._currentTrack];n&&i(n,"currenttrack"),this._currentTrack=t.tracknum+1,this._scroll_tracklist(this._currentTrack),n=this._tracklistelems[this._currentTrack],n&&e(n,"currenttrack"),$("#tracklist .currenttrack .currenttime").html(Time.timeStr(0)),this._numTracks=this._playlist.length,this._update_text(),this._updateprog(),this._showhide_nextprev(),this._hasplayed(),this._switch_track_artwork(this._currentTrack-1)},_handle_playlist_playlistchanged:function(t){const e=this._playlist.get_track_info();e&&this._handle_playlist_trackchanged(e)},_handle_thumb_startdrag:function(t){this._dragging=!0,this._playlist.seeking=!0,this._dragoffset=t.pageX-$(t.target).offset().left},_handle_thumb_drag:function(t){const e=$(this._elems.timeline).offset().left,i=$(this._elems.timeline).width()-$(this._elems.progbar_thumb).width();let n=t.pageX-e-this._dragoffset;n<0?n=0:n>i&&(n=i),n*=this._tracklength/i,this._trackpos=n,this._updateprog()},_handle_thumb_enddrag:function(t){this._playlist.seek(this._trackpos),this._dragging=!1,this._playlist.seeking=!1,this._hasplayed()},_create_playlist_item:function(t){const e=$("<li>");let i=Text.escapeHtml(t.title);return t.artist&&""!=t.artist&&t.artist!=this._artist&&(i=Text.escapeHtml(t.artist)+" &mdash; "+i),e.append($("<span>",{class:"tracknum",text:t.tracknum+1+"."})),e.append($("<a>",{href:"#"}).append($("<span>",{class:"tracktitle",html:i})).append($("<span>",{class:"currenttime"})).append($("<span>",{class:"tracktime",text:Time.timeStr(t.duration)}))),e},_handle_seek_touchstart:function(t){t.preventDefault();const e=$(this._elems.timeline);this._seek_move_handler=this._makehandler("_handle_seek_touchmove"),this._seek_end_handler=this._makehandler("_handle_seek_touchend"),this._seek_cancel_handler=this._makehandler("_handle_seek_touchcancel"),e.on("touchmove",this._seek_move_handler),e.on("touchend",this._seek_end_handler),e.on("touchcancel",this._seek_cancel_handler),this._playlist.seeking=!0,this._dragging=!0,this._dragtimerhandler=this._makehandler("_handle_drag_timeout"),this._dragtimer=setTimeout(this._dragtimerhandler,1e3)},_handle_seek_touchmove:function(t){const e=t.originalEvent.changedTouches[0].pageX;let i=this._elems.timeline;const n=this._elems.progbar_thumb.clientWidth;let s=n/2;do{s+=i.offsetLeft}while(i=i.offsetParent);let r=(e-s)/(s+this._elems.timeline.clientWidth-n-s);r>1?r=1:r<0&&(r=0),this._trackpos=this._tracklength*r,this._updateprog(),clearTimeout(this._dragtimer),this._dragtimer=setTimeout(this._dragtimerhandler,1e3)},_handle_seek_touchend:function(t){clearTimeout(this._dragtimer),this._finishdrag(!0)},_handle_seek_touchcancel:function(t){this._finishdrag(!1)},_handle_drag_timeout:function(t){this._finishdrag(!0)},_finishdrag:function(t){const e=$(this._elems.timeline);e.off("touchmove",this._seek_move_handler),e.off("touchend",this._seek_end_handler),e.off("touchcancel",this._seek_cancel_handler),this._playlist.seeking=!1,this._dragging=!1,t&&(this._trackpos==this._tracklength?this._playlist.next_track():0==this._trackpos&&this._seekorigpos<3?this._playlist.prev_track():this._playlist.seek(this._trackpos),this._hasplayed())},isAlbum:function(){return!!this._params.album},_update_text:function(){let t=Text.escapeHtml(this._songtitle||"");this._trackinfo.artist&&""!==this._trackinfo.artist&&this._trackinfo.artist!==this._artist?(t=Text.escapeHtml(this._trackinfo.artist)+" &mdash; "+t,this._elems.artist.innerHTML=Text.escapeHtml(this._trackinfo.artist)):this._elems.artist.innerHTML=Text.escapeHtml(this._artist||""),this.isAlbum()?(this._elems.maintextlink.innerHTML=Text.escapeHtml(this._albumtitle||""),this._elems.tracknamelink.innerHTML=Text.escapeHtml(this._songtitle||""),this._elems.currenttitle_title.innerHTML=t,this._elems.currenttitle_tracknum.innerHTML=Text.escapeHtml(this._currentTrack.toString()||"")+"."):(this._elems.maintextlink.innerHTML=Text.escapeHtml(this._songtitle||""),this._elems.currenttitle_title.innerHTML=t,this._elems.currenttitle_tracknum.innerHTML=Text.escapeHtml(this._currentTrack.toString()||"")+"."),this._elems.subtextlink.innerHTML=Text.escapeHtml(this._trackinfo.artist||""),this._elems.album.innerHTML=Text.escapeHtml(this._albumtitle||"")},_updateprog:function(){const t=$("#timeline .progbar_empty").width()-this._elems.progbar_thumb.offsetWidth,e=this._tracklength?this._trackpos/this._tracklength*t:0;if(this._elems.progbar_thumb.style.left=Math.round(e)+"px",this._elems.progbar_fill.style.width=(this._loadpercent||0)+"%",this._elems.currenttime.innerHTML=Time.timeStr(this._trackpos),this._elems.totaltime.innerHTML=Time.timeStr(this._tracklength>1?this._tracklength:1),!this._playlist.seeking){const t=this._loadpercent/100*this._tracklength,e=t>0?this._trackpos/t*100:0;this._elems.progbar_fill_played.style.width=e+"%"}$("#tracklist .currenttrack .currenttime").html(Time.timeStr(this._trackpos))},_showhide_nextprev:function(){const t=this._playlist.get_track(),e=this._playlist.first_playable_track,i=this._playlist.last_playable_track;this._elems.prev&&this.showhide_elem(this._elems.prev,e>=0&&t>e),this._elems.next&&this.showhide_elem(this._elems.next,i>=0&&t<i)},showhide_elem:function(t,n){n?i(t,"hiddenelem"):e(t,"hiddenelem")},_is_phone:function(){return"phone"==Browser.media_mode},_hasplayed:function(){i(this._root_elem,"initialstate")},_track_art_url:function(t,e){let i=null;null!=t&&(i=(n=this._playerdata.tracks[t])&&n.art_id);if(!i){var n=this._playlist.get_track();i=this._playerdata.album_art_id||this._playerdata.tracks[n].art_id}const s=function(t,e){const i=[];for(var n=0;n<TemplGlobals.image_formats.length;n++){const t=TemplGlobals.image_formats[n];"thumb"==t.resize_algo&&t.height==t.width&&(e&&t.anim_ok||!e&&!t.anim_ok)&&i.push(t)}i.sort((function(t,e){return t.width-e.width})),e&&(t*=2);for(n=0;n<i.length;n++)if(i[n].width>=t)return i[n].name;return i[i.length-1].name}(e,this._params.anim_ok);return ImageUtils.artURL(i,s)}};var e=function(t,e){$(t).addClass(e)},i=function(t,e){$(t).removeClass(e)},n=["prev","next","play","art","artarea","artlink","artist","trackname","tracknamelink","album","maintext","maintextlink","subtext","subtextlink","logoalt","logoalt2","currenttitle","currenttime","totaltime","timeline","linkarea","linkareaalt","tracklist","tinyplayer","progbar_thumb","progbar_fill","progbar_fill_played","currenttitle_tracknum","currenttitle_title","buyordownload","buyordownloadalt","buyordownloadlink","buyordownloadlinkalt","share","sharealt","sharelink","sharelinkalt","infolink","player","tracklist_ul","merch","infolayer"];return t.init=function(t,e,i){Sound.whenloaded((function(n){if(t&&n.success){const n=new Sound.SoundPlayer,r=!!i.album?"embedded album player":"embedded track player";let a=null;i.esig&&(a={esig:i.esig,tracks:i.tracks,album:i.album,track:i.track,url_referrer:i.url_referrer});const o=new Player.Playlist(n,r,e,{url_params:a});o._trackstate=!1;for(var s=0;s<t.tracks.length;s++){const e=o.add_track(t.tracks[s]);i.t||t.tracks[s].id!==t.featured_track_id||o.set_initial_track(e)}if(i.extratracks)for(s=t.tracks.length;s<20;s++)o.add_track(t.tracks[s%t.tracks.length]);new HTMLEmbeddedPlayer3(o,i,t);if(o.init_complete(i.t),i.twittercard){const t="width=device-width,height="+470*$("#player").width()/350;$("#viewportmeta").attr("content",t)}else i["facebook.com"]&&o.play()}else t?document.getElementById("badbrowsererror").style.visibility="visible":document.getElementById("badtralbumerror").style.visibility="visible"}))},t}();!function(){"use strict";const t=document.currentScript.dataset;if(window.Browser=JSON.parse(t.browser),window.siteroot_current=JSON.parse(t.siterootCurrent),window.TemplGlobals=JSON.parse(t.templGlobals),!JSON.parse(t.useScript))return;const e=JSON.parse(t.parentPage),i=JSON.parse(t.playerData||"null"),n=JSON.parse(t.params||"{}");if(JSON.parse(t.initHep3||"false"))return Log.debug("initing HTMLEmbeddedPlayer3: "+t.initHep3),void document.addEventListener("DOMContentLoaded",(function(){HTMLEmbeddedPlayer3.init(i,e,n)}));const s=JSON.parse(t.playerErrors||"null");let r=null,a=null;const o=!!n.album;let l=null;document.addEventListener("DOMContentLoaded",(function(){Sound.whenloaded((function(t){if(i&&t.success){a=new Sound.SoundPlayer;const t=o?"embedded album player":"embedded track player";r=new Player.Playlist(a,t,e,{url_params:n}),r._trackstate=!1;for(var c=0;c<i.tracks.length;c++){const t=r.add_track(i.tracks[c]);n.t||i.tracks[c].id!==i.featured_track_id||r.set_initial_track(t)}if(n.extratracks)for(c=i.tracks.length;c<20;c++)r.add_track(i.tracks[c%i.tracks.length]);if(l=new HTMLEmbeddedPlayer3(r,n,i),r.init_complete(),n.twittercard){const t="width=device-width,height="+470*$("#player").width()/350;$("#viewportmeta").attr("content",t)}}else i?(document.getElementById("player").style.display="block",document.getElementById("badbrowsererror").style.visibility="visible"):(document.getElementById("player").style.display="block",s&&s.tralbum_permissions_error?(document.getElementById("tralbumpermissionserror").style.visibility="visible",$("#tralbumpermissionserror .hostname").text(s.tralbum_permissions_error)):s&&s.tralbum_wordpress_permissions_error?(document.getElementById("tralbumwordpresspermissionserror").style.visibility="visible",$("#tralbumwordpresspermissionserror .hostname").text(s.tralbum_wordpress_permissions_error)):document.getElementById("badtralbumerror").style.visibility="visible")}))}))}();var Player={};Player.TrackInfo=function(){function t(t){this.update(t)}t.prototype={update:function(t){const i=e;for(let e=0;e<i.length;e++)this[i[e]]=t[i[e]];return this},is_playable:function(){return!!this.file},is_busy:function(){return this.encoding_pending&&!this.encoding_error},mark_as_capped:function(){this.is_capped=!0},copy:function(){const t={},i=e;for(let e=0;e<i.length;e++)t[i[e]]=this[i[e]];return t}},t.is_same=function(t,i){const n=e;for(let e=0;e<n.length;e++)if(t[n[e]]!=i[n[e]])return!1;return!0};var e=["tracknum","file","encoding_error","encoding_pending","title","title_link","id","track_license_id","has_lyrics","has_info","is_downloadable","free_album_download","has_free_download","duration","private","album_private","artist","album_preorder","unreleased_track","alt_link","continuous","video_source_type","video_caption","video_id","video_mobile_url","is_capped"];return t}(),Player.Playlist=function(){function t(e,i,n,s){s=s||{},this._options=s,this._player=e,this._playlist=[],this._playing_from=i,s.url_params&&s.url_params.esig&&(s.url_params.album||s.url_params.track)&&(n+="&esig="+s.url_params.esig+"&rsig="+s.url_params.rsig+(s.url_params.album?"&album="+s.url_params.album:"&track="+s.url_params.track),this._url_referrer=s.url_params.url_referrer),this._referer=n,this._track=0,this._loadedtrack=-1,this._loadpercent=0,this._duration=null,this._state="IDLE",this._unloaded=!0,this._scrubbed=!1,this._trackstate=!s.no_trackstate,this._trackchanged=EventSender.create(this,"trackchanged"),this._trackplayed=EventSender.create(this,"trackplayed"),this._trackcapped=EventSender.create(this,"trackcapped"),this._scrubbedback=EventSender.create(this,"scrubbedback"),this._completedplay=EventSender.create(this,"completedplay"),this._playlistchanged=EventSender.create(this,"playlistchanged"),this._statechanged=EventSender.create(this,"statechanged"),this._loaded=EventSender.create(this,"loaded"),this._timechanged=EventSender.create(this,"time"),this.first_playable_track=-1,this.last_playable_track=-1,this._ui_listeners=new Object,this._usecomm=!0;const r=$("#pagedata").data("blob")||{};this._stream_buffer_duration_stats=r.cfg&&r.cfg.stream_buffer_duration_stats||null,this._buffering_start_time=null;const a=this;this._player.onstate((function(t,e){a._unloaded||a._handle_state({oldstate:a._state,newstate:e.newstate})})),this._player.ontime((function(t,e){a._unloaded||a._handle_time(e)})),this._player.onloaded((function(t,e){a._unloaded||a._handle_load(e)})),t.coordinator||(t.coordinator=new Player.PlaylistCoordinator),t.coordinator.add(this)}t.prototype={getoption:function(t){return this._options[t]},add_track:function(t){t=new Player.TrackInfo(t);if(this._url_referrer&&t.file)for(const e in t.file)t.file[e]+="&urlref="+document.URL.replace(/\&/g,"/");const e=this._playlist.push(t)-1;return this._playlist[e].tracknum=e,t.is_playable()&&(-1==this.first_playable_track&&(this.first_playable_track=e,this._track=e),this.last_playable_track=e),this._playlistchanged(),e},set_initial_track:function(t){this._playlist[t]&&this._playlist[t].is_playable()&&(this._track=t)},update_trackinfo:function(t,e){if(e.tracknum=t,e=this._playlist[t].update(e),this._loadedtrack=-1,e.is_playable())(-1==this.first_playable_track||t<this.first_playable_track)&&(this.first_playable_track=t),(-1==this.last_playable_track||t>this.last_playable_track)&&(this.last_playable_track=t);else{if(t==this.first_playable_track){this.first_playable_track=-1;for(var i=t+1;i<this._playlist.length;i++)if(this._playlist[i].is_playable()){this.first_playable_track=i;break}}if(t==this.last_playable_track){this.last_playable_track=-1;for(i=t-1;i>=0;i--)if(this._playlist[i].is_playable()){this.last_playable_track=i;break}}}this._playlistchanged(),"BUSY"==this._state&&e.is_playable()&&this.play()},playpause:function(){let t=null;switch(this._state){case"IDLE":case"COMPLETED":case"PAUSED":this.play(),t=1;break;case"PLAYING":case"BUFFERING":this._player.pause(),t=-1;break;case"BUSY":this._player.stop(),this._handle_state({newstate:"IDLE",oldstate:this._state}),t=0}return t},play:function(){let t=this._playlist[this._track];if(t&&t.is_capped)return this._reset(),void this._trackcapped(t.id);switch(this._state){case"IDLE":case"COMPLETED":case"BUSY":if(Log.debug("playlist loading track "+this._track),!t)break;for(;!t.is_playable()&&this._track<this.last_playable_track;)this._track++,t=this._playlist[this._track];if(!t.is_playable()&&1==this._playlist.length&&t.encoding_pending)this._handle_state({newstate:"BUSY",oldstate:this._state});else if(this._playlist[this._track].file&&(this._load(),this._player.play(),this._usecomm))try{this._comm_start(),this._stop_other_players()}catch(t){}break;case"PAUSED":case"BUFFERING":if(this._player.play(),this._usecomm)try{this._comm_start(),this._stop_other_players()}catch(t){}}const e=this._track;this._trackplayed(e)},pause:function(){switch(this._state){case"PLAYING":case"BUFFERING":this._player.pause();break;case"BUSY":this._player.stop(),this._handle_state({newstate:"IDLE",oldstate:this._state})}},stop:function(){this._player.stop(),this._handle_state({newstate:"IDLE",oldstate:this._state})},seek:function(t){if(this._unloaded=!1,(e=this._playlist[this._track])&&e.is_capped)return this._reset(),void this._trackcapped(e.id);if(t<=2&&null==this._playstat){var e;if((e=this._playlist[this._track])&&e.is_capped)return this._reset(),void this._trackcapped(e.id);e&&this._scrubbedback(e.id),this._scrubbed=!0}this._player.seek(t)},play_track:function(t,e){const i=this.get_track_info(t);if(i&&i.is_capped)return this._reset(),void this._trackcapped(i.id);this._loadedtrack!=t&&(this._state="IDLE",this._player.stop(),this._track=t,this._load()),this._unloaded=!1,null!=e?this.seek(e):this.play()},percent_loaded:function(){return this._loadpercent||0},position:function(){return this._position},duration:function(){if(null!=this._duration)return this._duration;{const t=this.get_track_info();return t?t.duration:0}},init_complete:function(t){this._trackstate&&this._loadstate()||(t||this._track>0)&&this._trackchanged(this._playlist[this._track])},register_listener:function(t,e){let i=this._ui_listeners[t];i?($assert($.isArray(i),"expected array of event listeners"),i.push(e)):(i=new Array,i.push(e),this._ui_listeners[t]=i)},player:function(){return this._player},unload:function(){this.stop(),this._unloaded=!0,this._playlist=[],this._track=0,this._loadedtrack=-1,this._loadpercent=0,this._position=0,this.first_playable_track=-1,this.last_playable_track=-1,this._playlistchanged(),this._handle_state({newstate:"IDLE",oldstate:this._state})},load:function(t){this.unload();for(let e=0;e<t.length;e++)this.add_track(t[e])},_reset:function(){this.stop(),this._track=this.first_playable_track,this._trackchanged(this._playlist[this._track]),this._loadedtrack=-1},_handle_state:function(t){if(this._state!=t.newstate){if("PLAYING"!=t.newstate&&"BUFFERING"!=t.newstate&&("PAUSED"!=t.newstate&&(this._position=0),this._clearstate()),this._state=t.newstate,"COMPLETED"!=t.newstate||"PLAYING"!=t.oldstate&&"BUFFERING"!=t.oldstate&&"PAUSED"!=t.oldstate)this._statechanged(t);else if(!this.seeking)if(this._track+1<=this.last_playable_track){this._state="IDLE",this._player.stop();const e=this.get_track_info();e&&0==e.continuous?this._statechanged(t):this.next_track()}else this._track=0,this._loadedtrack=-1,this._statechanged(t),this._trackchanged(this._playlist[this.first_playable_track]);1==this._stream_buffer_duration_stats&&("BUFFERING"!=t.newstate||"IDLE"!=t.oldstate&&"COMPLETED"!=t.oldstate?null!=this._buffering_start_time&&"PLAYING"==t.newstate&&(buffering_duration=Date.now()-this._buffering_start_time,this._buffering_start_time=null,this._playstat&&this._playstat.report_stream_buffer_duration(buffering_duration,this._options.hq)):this._buffering_start_time=Date.now()),"PAUSED"==t.newstate&&this._playstat&&this._playstat.report_stream_end(this._position)}},_handle_load:function(t){0==t.total?this._loadpercent=0:this._loadpercent=100*t.loaded/t.total,this._loaded(this._loadpercent)},_handle_time:function(t){this._trackstate&&this._savestate(t.position),this._position=t.position,this._duration=t.duration,this._timechanged(t);const e=this._playlist[this._track];this._playstat&&t.duration>0&&(this._playstat.play_progress(t.position,t.duration)||(this._playstat=null,e&&"undefined"!=e&&this._completedplay(e.id)));Player.PlayStat.is_complete(t.position,t.duration)&&this._scrubbed&&(this._scrubbed=!1,e&&"undefined"!=e&&this._completedplay(e.id,!0))},prev_track:function(){let t=this._track;do{t--}while(t>=0&&!this._playlist[t].file);-1==t&&(t=0),this._track=t,this._isplaying()&&(this._state="IDLE",this._player.stop()),this.play()},next_track:function(){let t=this._track;do{t++}while(t<this._playlist.length&&!this._playlist[t].file);t==this._playlist.length&&(t=0),this._track=t,this._isplaying()&&(this._state="IDLE",this._player.stop()),this.play()},get_state:function(){return this._state},get_track:function(){return this._track},get_track_info:function(t){return 0==this._playlist.length?null:void 0!==t?this._playlist[t].copy():this._playlist[this._track].copy()},cap_playback_for_track:function(t){for(let e=0;this._playlist&&e<this._playlist.length;e++){const i=this._playlist[e];if(i.id==t){i.mark_as_capped();break}}},length:function(){return this._playlist.length},_notify_listeners:function(t,e){const i=this._ui_listeners[t];if(i)for(let t=i.length-1;t>=0;t--)i[t](e)},_load:function(){if(this._loadedtrack==this._track)return void this.seek(0);this._loadedtrack=this._track,this._unloaded=!1,this._player.load(this._playlist[this._track].file,this._options.hq),this._loadpercent=0;const t=this._playlist[this._track];this._trackchanged(t),this._playstat=new Player.PlayStat(t,this._playing_from,this._referer),this._scrubbed=!1},_isplaying:function(){return"PLAYING"==this._state||"PAUSED"==this._state||"BUFFERING"==this._state},_managestate:"iphone"!=Browser.platform,_loadstate:function(){return!!this._managestate&&(Log.debug("reading/clearing playlist state"),!1)},_clearstate:function(){if(this._managestate)try{Cookie.clear(e)}catch(t){}},_savestate:function(t){if(!this._managestate||"PLAYING"!=this._state&&"BUFFERING"!=this._state)return;const s=this._playlist[this._track].id;if(Math.abs(this._saved_pos-t)>n||s!=this._saved_track_id){this._saved_track_id=s,this._saved_pos=t;const n={track_id:s,pos:t};try{const t=JSON.stringify(n);Cookie.set(e,t,i)}catch(t){}}},_comm_start:function(){this._comm||(this._comm=new Cookie.CommChannel("playback"),this._comm.subscribe((t=>this._comm_recv(t))))},_comm_recv:function(t){if("stop"===t)Log.debug("received cookie comm stop command.  stopping."),this.stop()},_stop_other_players:function(){this._comm.send("stop")}};var e="playlist_state",i=30,n=1;return t.PLAY_TRACK="play_track",t}(),Player.PlaylistCoordinator=function(){function t(){this._playlists=[],this._playingcount=0,this._playing=EventSender.create(this,"playing"),this._stopped=EventSender.create(this,"stopped")}return t.prototype.add=function(t){const e=this;t.onstatechanged((function(i){e._handle_playlist_statechanged(t,i)})),this.onplaying((function(e){t!=e&&(t.getoption("savepos")?t.pause():t.stop())}))},t.prototype._handle_playlist_statechanged=function(t,e){const i="PLAYING"==e.newstate||"BUFFERING"==e.newstate,n="PLAYING"==e.oldstate||"BUFFERING"==e.oldstate;i&&!n?this._playingcount++:n&&!i&&(this._playingcount--,0==this._playingcount&&this._stopped()),i&&this._playing(t)},t}(),Player.PlayStat=function(){function t(t,i,n){params={kind:"track play",track_id:t.id,track_license_id:t.track_license_id,from:i,from_url:n||location.toString(),stream_duration:null},e.call(this,params,"started")}var e=Stats.PhasedStat;for(const e in Stats.PhasedStat.prototype)t.prototype[e]=Stats.PhasedStat.prototype[e];return t.prototype.play_progress=function(e,i){const n=t.is_partial(e,i),s=t.is_past_30(e,i),r=t.is_complete(e,i);return!this._partial_sent&&n&&(this._partial_sent=!0,this.change_phase("partial")),!this._30_seconds_sent&&s&&(this._30_seconds_sent=!0,this.change_phase("thirty")),!(!this._complete_sent&&r)||(this._complete_sent=!0,this._params.stream_duration=i,this.change_phase("complete"),!1)},t.is_partial=function(t,e){let i=!1;return t&&e&&(partial=10*e/100,i=t>partial),i},t.is_past_30=function(t){let e=!1;return t&&(e=t>30),e},t.is_complete=function(t,e){let i=!1;return t&&e&&(complete=90*e/100,i=t>complete),i},t.prototype.report_stream_end=function(t){t>30&&this._params.stream_duration<t&&(this._params.stream_duration=t,this.change_phase("stream_end"))},t.prototype.report_stream_buffer_duration=function(t,e){return Stats.record({kind:"stream buffer duration",duration_ms:t,is_hq:e}),!0},t}(),window.SocialControls={initFromDOM:function(t){const e=this,i=$(t);i.add(".social-controls",i).filter(".social-controls").each((function(){const t=$(this);e._initControlsOfType(t.find(".facebook-share-ctrl"),"renderFacebookShare"),e._initControlsOfType(t.find(".facebook-share-dlg-ctrl"),"renderFacebookDialogShare"),e._initControlsOfType(t.find(".twitter-ctrl"),"renderTwitterShare"),e._initControlsOfType(t.find(".reddit-ctrl"),"renderRedditShare"),e._initControlsOfType(t.find(".tumblr-ctrl"),"renderTumblrShare"),e._initControlsOfType(t.find(".email-ctrl"),"renderEmailShare")}))},renderFacebookDialogShare:function(t,e){!function(t,e,i){const n=t.getElementsByTagName(e)[0],s=t.createElement(e);s.id="facebook-jssdk",s.src="https://connect.facebook.net/en_US/sdk.js",n.parentNode.insertBefore(s,n)}(document,"script"),window.fbAsyncInit=function(){FB.init({appId:e.appId,autoLogAppEvents:!0,xfbml:!0,version:"v3.2"})};$(t).find(".facebook-link").first().click((function(t){FB.ui({method:"share_open_graph",action_type:"og.shares",action_properties:JSON.stringify({object:{"og:url":e.url,"og:title":e.title,"og:description":e.text,"og:image":e.image,"og:image:width":100,"og:image:height":100}})},(function(t){}))}))},renderFacebookShare:function(t,e){const i=this,n=$(t),s={url:location.href};const r={u:(e=$.extend(s,e)).url},a=!window.MediaView||"desktop"==MediaView.mode,o=Url.addQueryParams(a?"https://www.facebook.com/sharer.php":"https://m.facebook.com/sharer.php",r);let l=n.find(".facebook-link").first();l.length||(l=$('<a class="facebook-link" title="Share on Facebook">Share</a>').appendTo(n)),l.attr({href:o,target:"_blank"}).click((function(t){var n,s,r;window.TralbumData&&BCTracker.record("click",{feature:"tralbum-share-embed",click_type:"share",share_type:"facebook",user_id:null===(n=Identities.user())||void 0===n?void 0:n.id,item_id:null===(s=TralbumData.current)||void 0===s?void 0:s.id,item_type:null===(r=TralbumData.current)||void 0===r?void 0:r.type});i._statClick(e,"on"),a&&(window.open(o,"share_fb","toolbar=0,status=0,width=626,height=436"),t.preventDefault())}))},renderTwitterShare:function(t,e){const i=this,n=$(t),s={url:location.href};const r={url:(e=$.extend(s,e)).url},a=!window.MediaView||"phone"!=MediaView.mode;e.text&&(r.text=e.text);const o=Url.addQueryParams("https://twitter.com/intent/tweet",r);let l=n.find(".twitter-link").first();if(!l.length){let t,e;"undefined"==typeof TM?(t="Tweet",e="Share on Twitter"):(t=TM("Tweet"),e=TM("Share on Twitter")),l=$('<a class="twitter-link" title="'+e+'">'+t+"</a>").appendTo(n)}l.attr({href:o,target:"_blank"}).click((function(t){var n,s,r;(i._statClick(e,"on"),a&&(window.open(o,"share_tw","toolbar=0,status=0,width=550,height=450"),t.preventDefault()),window.TralbumData)&&BCTracker.record("click",{feature:"tralbum-share-embed",click_type:"share",share_type:"twitter",user_id:null===(n=Identities.user())||void 0===n?void 0:n.id,item_id:null===(s=TralbumData.current)||void 0===s?void 0:s.id,item_type:null===(r=TralbumData.current)||void 0===r?void 0:r.type})}))},renderRedditShare:function(t,e){const i=this,n=$(t),s={url:location.href};const r={url:(e=$.extend(s,e)).url,title:e.title,kind:"self"},a=!window.MediaView||"phone"!=MediaView.mode,o=Url.addQueryParams("https://www.reddit.com/submit",r);let l=n.find(".reddit-link").first();if(!l.length){const t=TM("Reddit"),e=TM("Share on Reddit");l=$('<a class="reddit-link" title="'+e+'">'+t+"</a>").appendTo(n)}l.attr({href:o,target:"_blank"}).click((function(t){i._statClick(e,"on"),a&&(window.open(o,"share_rd","toolbar=0,status=0,width=550,height=450"),t.preventDefault())}))},renderTumblrShare:function(t,e){const i=this,n=$(t),s={url:location.href,type:"link"};const r={};"audio"==(e=$.extend(s,e)).type?(r.external_url=e.url,e.text&&(r.caption=e.text)):(r.url=e.url,e.title&&(r.name=e.title),e.text&&(r.description=e.text));const a=Url.addQueryParams("https://www.tumblr.com/share/"+e.type,r);let o=n.find(".tumblr-link").first();o.length||(o=$('<a class="tumblr-link" title="Share on Tumblr">Share on Tumblr</a>').appendTo(n)),o.attr({href:a,target:"_blank"}).click((function(t){var n,s,r;(i._statClick(e,"on"),window.TralbumData)&&BCTracker.record("click",{feature:"tralbum-share-embed",click_type:"share",share_type:"tumblr",user_id:null===(n=Identities.user())||void 0===n?void 0:n.id,item_id:null===(s=TralbumData.current)||void 0===s?void 0:s.id,item_type:null===(r=TralbumData.current)||void 0===r?void 0:r.type})}))},renderEmailShare:function(t,e){const i=this,n=$(t),s={url:location.href},r={body:(e=$.extend(s,e)).url};e.text&&(r.body=e.text+"\r\n\r\n"+r.body),e.subject&&(r.subject=e.subject);const a="mailto:?"+Url.joinQuery(r);let o=n.find(".email-link").first();o.length||(o=$('<a class="email-link" title="Share via email">Email</a>').appendTo(n)),o.attr({href:a}).click((function(t){var n,s,r;(i._statClick(e,"on"),window.TralbumData)&&BCTracker.record("click",{feature:"tralbum-share-embed",click_type:"share",share_type:"email",user_id:null===(n=Identities.user())||void 0===n?void 0:n.id,item_id:null===(s=window.TralbumData.current)||void 0===s?void 0:s.id,item_type:null===(r=window.TralbumData.current)||void 0===r?void 0:r.type});return setTimeout((function(){location.href=a}),100),!1}))},_initControlsOfType:function(t,e){const i=this;$(t).each((function(){i[e](this,i._getData(this))}))},_getData:function(t,e){const i=$(t),n=i.data(),s=i.closest(".social-controls").data();return $.extend(e||{},s,n)},_statClick:function(t,e){let i=null;"on"==e?i=t.stat||t.statOn:"off"==e&&(i=t.statOff),i&&Stats.record({kind:"click",click:i})}},function(t,e){t.widget("ui.draggable",t.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"==this.options.helper&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var i=this.options;return!(this.helper||i.disabled||t(e.target).is(".ui-resizable-handle"))&&(this.handle=this._getHandle(e),!!this.handle&&(t(!0===i.iframeFix?"iframe":i.iframeFix).each((function(){t('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")})),!0))},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),!1===this._trigger("start",e)?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(!1===this._trigger("drag",e,n))return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=!1;t.ui.ddmanager&&!this.options.dropBehaviour&&(i=t.ui.ddmanager.drop(this,e)),this.dropped&&(i=this.dropped,this.dropped=!1);for(var n=this.element[0],s=!1;n&&(n=n.parentNode);)n==document&&(s=!0);if(!s&&"original"===this.options.helper)return!1;if("invalid"==this.options.revert&&!i||"valid"==this.options.revert&&i||!0===this.options.revert||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var r=this;t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),(function(){!1!==r._trigger("stop",e)&&r._clear()}))}else!1!==this._trigger("stop",e)&&this._clear();return!1},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each((function(){this.parentNode.removeChild(this)})),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){var i=!this.options.handle||!t(this.options.handle,this.element).length;return t(this.options.handle,this.element).find("*").andSelf().each((function(){this==e.target&&(i=!0)})),i},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"==i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"==i.appendTo?this.element[0].parentNode:i.appendTo),n[0]!=this.element[0]&&!/(fixed|absolute)/.test(n.css("position"))&&n.css("position","absolute"),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;if("parent"==e.containment&&(e.containment=this.helper[0].parentNode),"document"!=e.containment&&"window"!=e.containment||(this.containment=["document"==e.containment?0:t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==e.containment?0:t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==e.containment?0:t(window).scrollLeft())+t("document"==e.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==e.containment?0:t(window).scrollTop())+(t("document"==e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||e.containment.constructor==Array)e.containment.constructor==Array&&(this.containment=e.containment);else{var i=t(e.containment),n=i[0];if(!n)return;i.offset();var s="hidden"!=t(n).css("overflow");this.containment=[(parseInt(t(n).css("borderLeftWidth"),10)||0)+(parseInt(t(n).css("paddingLeft"),10)||0),(parseInt(t(n).css("borderTopWidth"),10)||0)+(parseInt(t(n).css("paddingTop"),10)||0),(s?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(t(n).css("borderLeftWidth"),10)||0)-(parseInt(t(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(t(n).css("borderTopWidth"),10)||0)-(parseInt(t(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i}},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"==e?1:-1,s=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(s[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:s.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:s.scrollLeft())*n}},_generatePosition:function(e){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(n[0].tagName),r=e.pageX,a=e.pageY;if(this.originalPosition){var o;if(this.containment){if(this.relative_container){var l=this.relative_container.offset();o=[this.containment[0]+l.left,this.containment[1]+l.top,this.containment[2]+l.left,this.containment[3]+l.top]}else o=this.containment;e.pageX-this.offset.click.left<o[0]&&(r=o[0]+this.offset.click.left),e.pageY-this.offset.click.top<o[1]&&(a=o[1]+this.offset.click.top),e.pageX-this.offset.click.left>o[2]&&(r=o[2]+this.offset.click.left),e.pageY-this.offset.click.top>o[3]&&(a=o[3]+this.offset.click.top)}if(i.grid){var c=i.grid[1]?this.originalPageY+Math.round((a-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY;a=o&&(c-this.offset.click.top<o[1]||c-this.offset.click.top>o[3])?c-this.offset.click.top<o[1]?c+i.grid[1]:c-i.grid[1]:c;var u=i.grid[0]?this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX;r=o&&(u-this.offset.click.left<o[0]||u-this.offset.click.left>o[2])?u-this.offset.click.left<o[0]?u+i.grid[0]:u-i.grid[0]:u}}return{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():s?0:n.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():s?0:n.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,i,n){return n=n||this._uiHash(),t.ui.plugin.call(this,e,[i,n]),"drag"==e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,n)},plugins:{},_uiHash:function(t){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i){var n=t(this).data("draggable"),s=n.options,r=t.extend({},i,{item:n.element});n.sortables=[],t(s.connectToSortable).each((function(){var i=t.data(this,"sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",e,r))}))},stop:function(e,i){var n=t(this).data("draggable"),s=t.extend({},i,{item:n.element});t.each(n.sortables,(function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"==n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,s))}))},drag:function(e,i){var n=t(this).data("draggable"),s=this;t.each(n.sortables,(function(r){var a=!1,o=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(a=!0,t.each(n.sortables,(function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!=o&&this.instance._intersectsWith(this.instance.containerCache)&&t.ui.contains(o.instance.element[0],this.instance.element[0])&&(a=!1),a}))),a?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(s).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",e),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",e),n.dropped=!1)}))}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i){var n=t("body"),s=t(this).data("draggable").options;n.css("cursor")&&(s._cursor=n.css("cursor")),n.css("cursor",s.cursor)},stop:function(e,i){var n=t(this).data("draggable").options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i){var n=t(i.helper),s=t(this).data("draggable").options;n.css("opacity")&&(s._opacity=n.css("opacity")),n.css("opacity",s.opacity)},stop:function(e,i){var n=t(this).data("draggable").options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(e,i){var n=t(this).data("draggable");n.scrollParent[0]!=document&&"HTML"!=n.scrollParent[0].tagName&&(n.overflowOffset=n.scrollParent.offset())},drag:function(e,i){var n=t(this).data("draggable"),s=n.options,r=!1;n.scrollParent[0]!=document&&"HTML"!=n.scrollParent[0].tagName?(s.axis&&"x"==s.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-n.overflowOffset.top<s.scrollSensitivity&&(n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop-s.scrollSpeed)),s.axis&&"y"==s.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-n.overflowOffset.left<s.scrollSensitivity&&(n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft-s.scrollSpeed))):(s.axis&&"x"==s.axis||(e.pageY-t(document).scrollTop()<s.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-s.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<s.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+s.scrollSpeed))),s.axis&&"y"==s.axis||(e.pageX-t(document).scrollLeft()<s.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-s.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<s.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+s.scrollSpeed)))),!1!==r&&t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(n,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i){var n=t(this).data("draggable"),s=n.options;n.snapElements=[],t(s.snap.constructor!=String?s.snap.items||":data(draggable)":s.snap).each((function(){var e=t(this),i=e.offset();this!=n.element[0]&&n.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})}))},drag:function(e,i){for(var n=t(this).data("draggable"),s=n.options,r=s.snapTolerance,a=i.offset.left,o=a+n.helperProportions.width,l=i.offset.top,c=l+n.helperProportions.height,u=n.snapElements.length-1;u>=0;u--){var h=n.snapElements[u].left,d=h+n.snapElements[u].width,p=n.snapElements[u].top,_=p+n.snapElements[u].height;if(h-r<a&&a<d+r&&p-r<l&&l<_+r||h-r<a&&a<d+r&&p-r<c&&c<_+r||h-r<o&&o<d+r&&p-r<l&&l<_+r||h-r<o&&o<d+r&&p-r<c&&c<_+r){if("inner"!=s.snapMode){var m=Math.abs(p-c)<=r,f=Math.abs(_-l)<=r,g=Math.abs(h-o)<=r,b=Math.abs(d-a)<=r;m&&(i.position.top=n._convertPositionTo("relative",{top:p-n.helperProportions.height,left:0}).top-n.margins.top),f&&(i.position.top=n._convertPositionTo("relative",{top:_,left:0}).top-n.margins.top),g&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left),b&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d}).left-n.margins.left)}var y=m||f||g||b;if("outer"!=s.snapMode){m=Math.abs(p-l)<=r,f=Math.abs(_-c)<=r,g=Math.abs(h-a)<=r,b=Math.abs(d-o)<=r;m&&(i.position.top=n._convertPositionTo("relative",{top:p,left:0}).top-n.margins.top),f&&(i.position.top=n._convertPositionTo("relative",{top:_-n.helperProportions.height,left:0}).top-n.margins.top),g&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left),b&&(i.position.left=n._convertPositionTo("relative",{top:0,left:d-n.helperProportions.width}).left-n.margins.left)}!n.snapElements[u].snapping&&(m||f||g||b||y)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,e,t.extend(n._uiHash(),{snapItem:n.snapElements[u].item})),n.snapElements[u].snapping=m||f||g||b||y}else n.snapElements[u].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,e,t.extend(n._uiHash(),{snapItem:n.snapElements[u].item})),n.snapElements[u].snapping=!1}}}),t.ui.plugin.add("draggable","stack",{start:function(e,i){var n=t(this).data("draggable").options,s=t.makeArray(t(n.stack)).sort((function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)}));if(s.length){var r=parseInt(s[0].style.zIndex)||0;t(s).each((function(t){this.style.zIndex=r+t})),this[0].style.zIndex=r+s.length}}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i){var n=t(i.helper),s=t(this).data("draggable").options;n.css("zIndex")&&(s._zIndex=n.css("zIndex")),n.css("zIndex",s.zIndex)},stop:function(e,i){var n=t(this).data("draggable").options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}})}(jQuery),function(t,e){var i="ui-dialog ui-widget ui-widget-content ui-corner-all ",n={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},s={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};t.widget("ui.dialog",{version:"1.9.2",options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;i<0&&t(this).css("top",e.top-i)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),"string"!=typeof this.originalTitle&&(this.originalTitle=""),this.oldPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.options.title=this.options.title||this.originalTitle;var e,n,s,r,a,o=this,l=this.options,c=l.title||"&#160;";e=(this.uiDialog=t("<div>")).addClass(i+l.dialogClass).css({display:"none",outline:0,zIndex:l.zIndex}).attr("tabIndex",-1).keydown((function(e){l.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE&&(o.close(e),e.preventDefault())})).mousedown((function(t){o.moveToTop(!1,t)})).appendTo("body"),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(e),n=(this.uiDialogTitlebar=t("<div>")).addClass("ui-dialog-titlebar  ui-widget-header  ui-corner-all  ui-helper-clearfix").bind("mousedown",(function(){e.focus()})).prependTo(e),s=t("<a href='#'></a>").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click((function(t){t.preventDefault(),o.close(t)})).appendTo(n),(this.uiDialogTitlebarCloseText=t("<span>")).addClass("ui-icon ui-icon-closethick").text(l.closeText).appendTo(s),r=t("<span>").uniqueId().addClass("ui-dialog-title").html(c).prependTo(n),a=(this.uiDialogButtonPane=t("<div>")).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),(this.uiButtonSet=t("<div>")).addClass("ui-dialog-buttonset").appendTo(a),e.attr({role:"dialog","aria-labelledby":r.attr("id")}),n.find("*").add(n).disableSelection(),this._hoverable(s),this._focusable(s),l.draggable&&t.fn.draggable&&this._makeDraggable(),l.resizable&&t.fn.resizable&&this._makeResizable(),this._createButtons(l.buttons),this._isOpen=!1,t.fn.bgiframe&&e.bgiframe(),this._on(e,{keydown:function(i){if(l.modal&&i.keyCode===t.ui.keyCode.TAB){var n=t(":tabbable",e),s=n.filter(":first"),r=n.filter(":last");if(i.target===r[0]&&!i.shiftKey)return s.focus(1),!1;if(i.target===s[0]){if(i.shiftKey)return r.focus(1),!1;n[1]&&n[1].focus()}}}})},_init:function(){this.options.autoOpen&&this.open()},_destroy:function(){var t,e=this.oldPosition;this.overlay&&this.overlay.destroy(),this.uiDialog.hide(),this.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(t=e.parent.children().eq(e.index)).length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},close:function(e){var i,n,s=this;if(this._isOpen&&!1!==this._trigger("beforeClose",e))return this._isOpen=!1,this.overlay&&this.overlay.destroy(),this.options.hide?this._hide(this.uiDialog,this.options.hide,(function(){s._trigger("close",e)})):(this.uiDialog.hide(),this._trigger("close",e)),t.ui.dialog.overlay.resize(),this.options.modal&&(i=0,t(".ui-dialog").each((function(){this===s.uiDialog[0]||isNaN(n=t(this).css("z-index"))||(i=Math.max(i,n))})),t.ui.dialog.maxZ=i),this},isOpen:function(){return this._isOpen},moveToTop:function(e,i){var n,s=this.options;return s.modal&&!e||!s.stack&&!s.modal?this._trigger("focus",i):(s.zIndex>t.ui.dialog.maxZ&&(t.ui.dialog.maxZ=s.zIndex),this.overlay&&(t.ui.dialog.maxZ+=1,t.ui.dialog.overlay.maxZ=t.ui.dialog.maxZ,this.overlay.$el.css("z-index",t.ui.dialog.overlay.maxZ)),n={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()},t.ui.dialog.maxZ+=1,this.uiDialog.css("z-index",t.ui.dialog.maxZ),this.element.attr(n),this._trigger("focus",i),this)},open:function(){if(!this._isOpen){var e,i=this.options,n=this.uiDialog;return this._size(),this._position(i.position),n.show(i.show),this.overlay=i.modal?new t.ui.dialog.overlay(this):null,this.moveToTop(!0),(e=this.element.find(":tabbable")).length||(e=this.uiDialogButtonPane.find(":tabbable")).length||(e=n),e.eq(0).focus(),this._isOpen=!0,this._trigger("open"),this}},_createButtons:function(e){var i=this,n=!1;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),"object"==typeof e&&null!==e&&t.each(e,(function(){return n=!0,!1})),n?(t.each(e,(function(e,n){var s,r;n=t.isFunction(n)?{click:n,text:e}:n,r=(n=t.extend({type:"button"},n)).click,n.click=function(){r.apply(i.element[0],arguments)},s=t("<button></button>",n).appendTo(i.uiButtonSet),t.fn.button&&s.button()})),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog)):this.uiDialog.removeClass("ui-dialog-buttons")},_makeDraggable:function(){var e=this,i=this.options;function n(t){return{position:t.position,offset:t.offset}}this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(i,s){t(this).addClass("ui-dialog-dragging"),e._trigger("dragStart",i,n(s))},drag:function(t,i){e._trigger("drag",t,n(i))},stop:function(s,r){i.position=[r.position.left-e.document.scrollLeft(),r.position.top-e.document.scrollTop()],t(this).removeClass("ui-dialog-dragging"),e._trigger("dragStop",s,n(r)),t.ui.dialog.overlay.resize()}})},_makeResizable:function(e){e=void 0===e?this.options.resizable:e;var i=this,n=this.options,s=this.uiDialog.css("position"),r="string"==typeof e?e:"n,e,s,w,se,sw,ne,nw";function a(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:n.maxWidth,maxHeight:n.maxHeight,minWidth:n.minWidth,minHeight:this._minHeight(),handles:r,start:function(e,n){t(this).addClass("ui-dialog-resizing"),i._trigger("resizeStart",e,a(n))},resize:function(t,e){i._trigger("resize",t,a(e))},stop:function(e,s){t(this).removeClass("ui-dialog-resizing"),n.height=t(this).height(),n.width=t(this).width(),i._trigger("resizeStop",e,a(s)),t.ui.dialog.overlay.resize()}}).css("position",s).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(e){var i,n=[],s=[0,0];e?(("string"==typeof e||"object"==typeof e&&"0"in e)&&(1===(n=e.split?e.split(" "):[e[0],e[1]]).length&&(n[1]=n[0]),t.each(["left","top"],(function(t,e){+n[t]===n[t]&&(s[t]=n[t],n[t]=e)})),e={my:n[0]+(s[0]<0?s[0]:"+"+s[0])+" "+n[1]+(s[1]<0?s[1]:"+"+s[1]),at:n.join(" ")}),e=t.extend({},t.ui.dialog.prototype.options.position,e)):e=t.ui.dialog.prototype.options.position,(i=this.uiDialog.is(":visible"))||this.uiDialog.show(),this.uiDialog.position(e),i||this.uiDialog.hide()},_setOptions:function(e){var i=this,r={},a=!1;t.each(e,(function(t,e){i._setOption(t,e),t in n&&(a=!0),t in s&&(r[t]=e)})),a&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",r)},_setOption:function(e,n){var s,r,a=this.uiDialog;switch(e){case"buttons":this._createButtons(n);break;case"closeText":this.uiDialogTitlebarCloseText.text(""+n);break;case"dialogClass":a.removeClass(this.options.dialogClass).addClass(i+n);break;case"disabled":n?a.addClass("ui-dialog-disabled"):a.removeClass("ui-dialog-disabled");break;case"draggable":(s=a.is(":data(draggable)"))&&!n&&a.draggable("destroy"),!s&&n&&this._makeDraggable();break;case"position":this._position(n);break;case"resizable":(r=a.is(":data(resizable)"))&&!n&&a.resizable("destroy"),r&&"string"==typeof n&&a.resizable("option","handles",n),r||!1===n||this._makeResizable(n);break;case"title":t(".ui-dialog-title",this.uiDialogTitlebar).html(""+(n||"&#160;"))}this._super(e,n)},_size:function(){var e,i,n,s=this.options,r=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),s.minWidth>s.width&&(s.width=s.minWidth),e=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),i=Math.max(0,s.minHeight-e),"auto"===s.height?t.support.minHeight?this.element.css({minHeight:i,height:"auto"}):(this.uiDialog.show(),n=this.element.css("height","auto").height(),r||this.uiDialog.hide(),this.element.height(Math.max(n,i))):this.element.height(Math.max(s.height-e,0)),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),t.extend(t.ui.dialog,{uuid:0,maxZ:0,getTitleId:function(t){var e=t.attr("id");return e||(this.uuid+=1,e=this.uuid),"ui-dialog-title-"+e},overlay:function(e){this.$el=t.ui.dialog.overlay.create(e)}}),t.extend(t.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:t.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),(function(t){return t+".dialog-overlay"})).join(" "),create:function(e){0===this.instances.length&&(setTimeout((function(){t.ui.dialog.overlay.instances.length&&t(document).bind(t.ui.dialog.overlay.events,(function(e){if(t(e.target).zIndex()<t.ui.dialog.overlay.maxZ)return!1}))}),1),t(window).bind("resize.dialog-overlay",t.ui.dialog.overlay.resize));var i=this.oldInstances.pop()||t("<div>").addClass("ui-widget-overlay");return t(document).bind("keydown.dialog-overlay",(function(n){var s=t.ui.dialog.overlay.instances;0!==s.length&&s[s.length-1]===i&&e.options.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===t.ui.keyCode.ESCAPE&&(e.close(n),n.preventDefault())})),i.appendTo(document.body).css({width:this.width(),height:this.height()}),t.fn.bgiframe&&i.bgiframe(),this.instances.push(i),i},destroy:function(e){var i=t.inArray(e,this.instances),n=0;-1!==i&&this.oldInstances.push(this.instances.splice(i,1)[0]),0===this.instances.length&&t([document,window]).unbind(".dialog-overlay"),e.height(0).width(0).remove(),t.each(this.instances,(function(){n=Math.max(n,this.css("z-index"))})),this.maxZ=n},height:function(){var e;return t.ui.ie?(e=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight))<Math.max(document.documentElement.offsetHeight,document.body.offsetHeight)?t(window).height()+"px":e+"px":t(document).height()+"px"},width:function(){var e;return t.ui.ie?(e=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth))<Math.max(document.documentElement.offsetWidth,document.body.offsetWidth)?t(window).width()+"px":e+"px":t(document).width()+"px"},resize:function(){var e=t([]);t.each(t.ui.dialog.overlay.instances,(function(){e=e.add(this)})),e.css({width:0,height:0}).css({width:t.ui.dialog.overlay.width(),height:t.ui.dialog.overlay.height()})}}),t.extend(t.ui.dialog.overlay.prototype,{destroy:function(){t.ui.dialog.overlay.destroy(this.$el)}})}(jQuery),function(){function t(t,e){var u,h=this;if(h.element="object"==typeof t?t:document.getElementById(t),h.wrapper=h.element.parentNode,h.element.style.webkitTransitionProperty="-webkit-transform",h.element.style.webkitTransitionTimingFunction="cubic-bezier(0,0,0.25,1)",h.element.style.webkitTransitionDuration="0",h.element.style.webkitTransform=l+"0,0"+c,h.options={bounce:i,momentum:i,checkDOMChanges:!0,topOnDOMChanges:!1,hScrollbar:i,vScrollbar:i,fadeScrollbar:n||!s,shrinkScrollbar:n||!s,desktopCompatibility:!1,overflow:"auto",snap:!1,bounceLock:!1,scrollbarColor:"rgba(0,0,0,0.5)",onScrollEnd:function(){}},"object"==typeof e)for(u in e)h.options[u]=e[u];h.options.desktopCompatibility&&(h.options.overflow="hidden"),h.onScrollEnd=h.options.onScrollEnd,delete h.options.onScrollEnd,h.wrapper.style.overflow=h.options.overflow,h.refresh(),window.addEventListener("onorientationchange"in window?"orientationchange":"resize",h,!1),(s||h.options.desktopCompatibility)&&(h.element.addEventListener(r,h,!1),h.element.addEventListener(a,h,!1),h.element.addEventListener(o,h,!1)),h.options.checkDOMChanges&&h.element.addEventListener("DOMSubtreeModified",h,!1)}function e(t,e,i,n,s){var r=this,a=document;r.dir=t,r.fade=i,r.shrink=n,r.uid=++u,r.bar=a.createElement("div"),r.bar.style.cssText="position:absolute;top:0;left:0;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;-webkit-transition-duration:0;-webkit-transition-delay:0;-webkit-transition-property:-webkit-transform;z-index:10;background:"+s+";-webkit-transform:"+l+"0,0"+c+";"+("horizontal"==t?"-webkit-border-radius:3px 2px;min-width:6px;min-height:5px":"-webkit-border-radius:2px 3px;min-width:5px;min-height:6px"),r.wrapper=a.createElement("div"),r.wrapper.style.cssText="-webkit-mask:-webkit-canvas(scrollbar"+r.uid+r.dir+");position:absolute;z-index:10;pointer-events:none;overflow:hidden;opacity:0;-webkit-transition-duration:"+(i?"300ms":"0")+";-webkit-transition-delay:0;-webkit-transition-property:opacity;"+("horizontal"==r.dir?"bottom:2px;left:2px;right:7px;height:5px":"top:2px;right:2px;bottom:7px;width:5px;"),r.wrapper.appendChild(r.bar),e.appendChild(r.wrapper)}t.prototype={x:0,y:0,enabled:!0,handleEvent:function(t){var e=this;switch(t.type){case r:e.touchStart(t);break;case a:e.touchMove(t);break;case o:e.touchEnd(t);break;case"webkitTransitionEnd":e.transitionEnd();break;case"orientationchange":case"resize":e.refresh();break;case"DOMSubtreeModified":e.onDOMModified(t)}},onDOMModified:function(t){var e=this;t.target.parentNode==e.element&&(setTimeout((function(){e.refresh()}),0),!e.options.topOnDOMChanges||0==e.x&&0==e.y||e.scrollTo(0,0,"0"))},refresh:function(){var t,i=this,n=i.x,s=i.y;i.scrollWidth=i.wrapper.clientWidth,i.scrollHeight=i.wrapper.clientHeight,i.scrollerWidth=i.element.offsetWidth,i.scrollerHeight=i.element.offsetHeight,i.maxScrollX=i.scrollWidth-i.scrollerWidth,i.maxScrollY=i.scrollHeight-i.scrollerHeight,i.directionX=0,i.directionY=0,i.scrollX&&(i.maxScrollX>=0?n=0:i.x<i.maxScrollX&&(n=i.maxScrollX)),i.scrollY&&(i.maxScrollY>=0?s=0:i.y<i.maxScrollY&&(s=i.maxScrollY)),i.options.snap&&(i.maxPageX=-Math.floor(i.maxScrollX/i.scrollWidth),i.maxPageY=-Math.floor(i.maxScrollY/i.scrollHeight),n=(t=i.snap(n,s)).x,s=t.y),n==i.x&&s==i.y||(i.setTransitionTime("0"),i.setPosition(n,s,!0)),i.scrollX=i.scrollerWidth>i.scrollWidth,i.scrollY=!i.options.bounceLock&&!i.scrollX||i.scrollerHeight>i.scrollHeight,i.options.hScrollbar&&i.scrollX?(i.scrollBarX=i.scrollBarX||new e("horizontal",i.wrapper,i.options.fadeScrollbar,i.options.shrinkScrollbar,i.options.scrollbarColor),i.scrollBarX.init(i.scrollWidth,i.scrollerWidth)):i.scrollBarX&&(i.scrollBarX=i.scrollBarX.remove()),i.options.vScrollbar&&i.scrollY&&i.scrollerHeight>i.scrollHeight?(i.scrollBarY=i.scrollBarY||new e("vertical",i.wrapper,i.options.fadeScrollbar,i.options.shrinkScrollbar,i.options.scrollbarColor),i.scrollBarY.init(i.scrollHeight,i.scrollerHeight)):i.scrollBarY&&(i.scrollBarY=i.scrollBarY.remove())},setPosition:function(t,e,i){var n=this;n.x=t,n.y=e,n.element.style.webkitTransform=l+n.x+"px,"+n.y+"px"+c,i||(n.scrollBarX&&n.scrollBarX.setPosition(n.x),n.scrollBarY&&n.scrollBarY.setPosition(n.y))},setTransitionTime:function(t){var e=this;t=t||"0",e.element.style.webkitTransitionDuration=t,e.scrollBarX&&(e.scrollBarX.bar.style.webkitTransitionDuration=t,e.scrollBarX.wrapper.style.webkitTransitionDuration=i&&e.options.fadeScrollbar?"300ms":"0"),e.scrollBarY&&(e.scrollBarY.bar.style.webkitTransitionDuration=t,e.scrollBarY.wrapper.style.webkitTransitionDuration=i&&e.options.fadeScrollbar?"300ms":"0")},touchStart:function(t){var e,i=this;i.enabled&&(t.preventDefault(),t.stopPropagation(),i.scrolling=!0,i.moved=!1,i.distX=0,i.distY=0,i.setTransitionTime("0"),(i.options.momentum||i.options.snap)&&((e=new WebKitCSSMatrix(window.getComputedStyle(i.element).webkitTransform)).e==i.x&&e.f==i.y||(document.removeEventListener("webkitTransitionEnd",i,!1),i.setPosition(e.e,e.f),i.moved=!0)),i.touchStartX=s?t.changedTouches[0].pageX:t.pageX,i.scrollStartX=i.x,i.touchStartY=s?t.changedTouches[0].pageY:t.pageY,i.scrollStartY=i.y,i.scrollStartTime=t.timeStamp,i.directionX=0,i.directionY=0)},touchMove:function(t){if(this.scrolling){var e=this,i=s?t.changedTouches[0].pageX:t.pageX,n=s?t.changedTouches[0].pageY:t.pageY,r=e.scrollX?i-e.touchStartX:0,a=e.scrollY?n-e.touchStartY:0,o=e.x+r,l=e.y+a;t.stopPropagation(),e.touchStartX=i,e.touchStartY=n,(o>=0||o<e.maxScrollX)&&(o=e.options.bounce?Math.round(e.x+r/3):o>=0||e.maxScrollX>=0?0:e.maxScrollX),(l>=0||l<e.maxScrollY)&&(l=e.options.bounce?Math.round(e.y+a/3):l>=0||e.maxScrollY>=0?0:e.maxScrollY),e.distX+e.distY>5?(e.distX-3>e.distY?(l=e.y,a=0):e.distY-3>e.distX&&(o=e.x,r=0),e.setPosition(o,l),e.moved=!0,e.directionX=r>0?-1:1,e.directionY=a>0?-1:1):(e.distX+=Math.abs(r),e.distY+=Math.abs(a))}},touchEnd:function(t){if(this.scrolling){var e,i,n,r,a,o=this,l=t.timeStamp-o.scrollStartTime,c=s?t.changedTouches[0]:t,u=0,h=o.x,d=o.y;if(o.scrolling=!1,o.moved)!o.options.snap&&l>250?o.resetPosition():(o.options.momentum&&(n=!0===o.scrollX?o.momentum(o.x-o.scrollStartX,l,o.options.bounce?-o.x+o.scrollWidth/5:-o.x,o.options.bounce?o.x+o.scrollerWidth-o.scrollWidth+o.scrollWidth/5:o.x+o.scrollerWidth-o.scrollWidth):{dist:0,time:0},r=!0===o.scrollY?o.momentum(o.y-o.scrollStartY,l,o.options.bounce?-o.y+o.scrollHeight/5:-o.y,o.options.bounce?(o.maxScrollY<0?o.y+o.scrollerHeight-o.scrollHeight:0)+o.scrollHeight/5:o.y+o.scrollerHeight-o.scrollHeight):{dist:0,time:0},u=Math.max(Math.max(n.time,r.time),1),h=o.x+n.dist,d=o.y+r.dist),o.options.snap&&(h=(a=o.snap(h,d)).x,d=a.y,u=Math.max(a.time,u)),o.scrollTo(h,d,u+"ms"));else if(o.resetPosition(),s){for(e=c.target;1!=e.nodeType;)e=e.parentNode;(i=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,t.view,1,c.screenX,c.screenY,c.clientX,c.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null),i._fake=!0,e.dispatchEvent(i)}}},transitionEnd:function(){document.removeEventListener("webkitTransitionEnd",this,!1),this.resetPosition()},resetPosition:function(){var t=this,e=t.x,i=t.y;t.x>=0?e=0:t.x<t.maxScrollX&&(e=t.maxScrollX),t.y>=0||t.maxScrollY>0?i=0:t.y<t.maxScrollY&&(i=t.maxScrollY),e!=t.x||i!=t.y?t.scrollTo(e,i):(t.moved&&(t.onScrollEnd(),t.moved=!1),t.scrollBarX&&t.scrollBarX.hide(),t.scrollBarY&&t.scrollBarY.hide())},snap:function(t,e){var i=this;return t=i.directionX>0?Math.floor(t/i.scrollWidth):i.directionX<0?Math.ceil(t/i.scrollWidth):Math.round(t/i.scrollWidth),i.pageX=-t,(t*=i.scrollWidth)>0?t=i.pageX=0:t<i.maxScrollX&&(i.pageX=i.maxPageX,t=i.maxScrollX),e=i.directionY>0?Math.floor(e/i.scrollHeight):i.directionY<0?Math.ceil(e/i.scrollHeight):Math.round(e/i.scrollHeight),i.pageY=-e,(e*=i.scrollHeight)>0?e=i.pageY=0:e<i.maxScrollY&&(i.pageY=i.maxPageY,e=i.maxScrollY),{x:t,y:e,time:Math.round(Math.max(Math.abs(i.x-t)/i.scrollWidth*500,Math.abs(i.y-e)/i.scrollHeight*500))}},scrollTo:function(t,e,i){var n=this;n.x!=t||n.y!=e?(n.moved=!0,n.setTransitionTime(i||"350ms"),n.setPosition(t,e),"0"===i||"0s"==i||"0ms"==i?n.resetPosition():document.addEventListener("webkitTransitionEnd",n,!1)):n.resetPosition()},scrollToPage:function(t,e,i){var n,s=this;s.options.snap||(s.pageX=-Math.round(s.x/s.scrollWidth),s.pageY=-Math.round(s.y/s.scrollHeight)),"next"==t?t=++s.pageX:"prev"==t&&(t=--s.pageX),"next"==e?e=++s.pageY:"prev"==e&&(e=--s.pageY),t=-t*s.scrollWidth,e=-e*s.scrollHeight,t=(n=s.snap(t,e)).x,e=n.y,s.scrollTo(t,e,i||"500ms")},scrollToElement:function(t,e){if(t="object"==typeof t?t:this.element.querySelector(t)){var i=this,n=i.scrollX?-t.offsetLeft:0,s=i.scrollY?-t.offsetTop:0;n>=0?n=0:n<i.maxScrollX&&(n=i.maxScrollX),s>=0?s=0:s<i.maxScrollY&&(s=i.maxScrollY),i.scrollTo(n,s,e)}},momentum:function(t,e,i,n){var s,r=Math.abs(t)/e*1e3,a=r*r/2.5/1e3;return t>0&&a>i?(r=r*i/a/2.5,a=i):t<0&&a>n&&(r=r*n/a/2.5,a=n),a*=t<0?-1:1,s=r/1.2,{dist:Math.round(a),time:Math.round(s)}},destroy:function(t){var e=this;return window.removeEventListener("onorientationchange"in window?"orientationchange":"resize",e,!1),e.element.removeEventListener(r,e,!1),e.element.removeEventListener(a,e,!1),e.element.removeEventListener(o,e,!1),document.removeEventListener("webkitTransitionEnd",e,!1),e.options.checkDOMChanges&&e.element.removeEventListener("DOMSubtreeModified",e,!1),e.scrollBarX&&(e.scrollBarX=e.scrollBarX.remove()),e.scrollBarY&&(e.scrollBarY=e.scrollBarY.remove()),t&&e.wrapper.parentNode.removeChild(e.wrapper),null}},e.prototype={init:function(t,e){var i,n=this,s=document,r=Math.PI;"horizontal"==n.dir?n.maxSize!=n.wrapper.offsetWidth&&(n.maxSize=n.wrapper.offsetWidth,(i=s.getCSSCanvasContext("2d","scrollbar"+n.uid+n.dir,n.maxSize,5)).fillStyle="rgb(0,0,0)",i.beginPath(),i.arc(2.5,2.5,2.5,r/2,-r/2,!1),i.lineTo(n.maxSize-2.5,0),i.arc(n.maxSize-2.5,2.5,2.5,-r/2,r/2,!1),i.closePath(),i.fill()):n.maxSize!=n.wrapper.offsetHeight&&(n.maxSize=n.wrapper.offsetHeight,(i=s.getCSSCanvasContext("2d","scrollbar"+n.uid+n.dir,5,n.maxSize)).fillStyle="rgb(0,0,0)",i.beginPath(),i.arc(2.5,2.5,2.5,r,0,!1),i.lineTo(5,n.maxSize-2.5),i.arc(2.5,n.maxSize-2.5,2.5,0,r,!1),i.closePath(),i.fill()),n.size=Math.max(Math.round(n.maxSize*n.maxSize/e),6),n.maxScroll=n.maxSize-n.size,n.toWrapperProp=n.maxScroll/(t-e),n.bar.style["horizontal"==n.dir?"width":"height"]=n.size+"px"},setPosition:function(t){var e=this;"1"!=e.wrapper.style.opacity&&e.show(),(t=Math.round(e.toWrapperProp*t))<0?(t=e.shrink?t+3*t:0,e.size+t<7&&(t=6-e.size)):t>e.maxScroll&&(t=e.shrink?t+3*(t-e.maxScroll):e.maxScroll,e.size+e.maxScroll-t<7&&(t=e.size+e.maxScroll-6)),t="horizontal"==e.dir?l+t+"px,0"+c:l+"0,"+t+"px"+c,e.bar.style.webkitTransform=t},show:function(){i&&(this.wrapper.style.webkitTransitionDelay="0"),this.wrapper.style.opacity="1"},hide:function(){i&&(this.wrapper.style.webkitTransitionDelay="350ms"),this.wrapper.style.opacity="0"},remove:function(){return this.wrapper.parentNode.removeChild(this.wrapper),null}};var i="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,n=/iphone|ipad/gi.test(navigator.appVersion),s="ontouchstart"in window,r=s?"touchstart":"mousedown",a=s?"touchmove":"mousemove",o=s?"touchend":"mouseup",l="translate"+(i?"3d(":"("),c=i?",0)":")",u=0;window.iScroll=t}();
