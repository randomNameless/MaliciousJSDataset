var ce=Object.defineProperty;var ae=(s,h,_)=>h in s?ce(s,h,{enumerable:!0,configurable:!0,writable:!0,value:_}):s[h]=_;var re=(s,h,_)=>(ae(s,typeof h!="symbol"?h+"":h,_),_);var se=(s,h,_)=>new Promise((R,I)=>{var k=S=>{try{D(_.next(S))}catch(A){I(A)}},V=S=>{try{D(_.throw(S))}catch(A){I(A)}},D=S=>S.done?R(S.value):Promise.resolve(S.value).then(k,V);D((_=_.apply(s,h)).next())});(()=>{const s="RIGHT",h="SIGNIN",_="NO_FOCUS";function R(e){return typeof e=="string"||e instanceof String}function I(e){return typeof e=="function"}function k(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Math.random()*16|0,i=e=="x"?n:n&3|8;return i.toString(16)})}function V(){return window.crypto&&I(window.crypto.randomUUID)?crypto.randomUUID():k()}const D=V(),S=(()=>{const e={ERROR:0,WARNING:1,INFO:2,VERBOSE:3,TRACE:4};let n=e.ERROR,i=!1;function m(a){for(const u of Object.values(e))if(u==a)return u}(()=>{const a="autoLogEvents",u=new URLSearchParams(new URL(window.location.href).searchParams);if(u.has(a)){const T=m(u.get(a));if(T===void 0)return;n=T,i=!0}})();function g(a,...u){u.length!==0?console.error(a,u):console.error(a)}function c(a,...u){u.length!==0?console.warn(a,u):console.warn(a)}function f(a,...u){u.length!==0?console.log(a,u):console.log(a)}function p(a,u,...T){!i||a>n||(a===e.ERROR?g(u,...T):a===e.WARNING?c(u,...T):f(u,...T))}return{error:function(a,...u){p(e.ERROR,a,...u)},warning:function(a,...u){p(e.WARNING,a,...u)},info:function(a,...u){p(e.INFO,a,...u)},verbose:function(a,...u){p(e.VERBOSE,a,...u)},trace:function(a,...u){p(e.TRACE,a,...u)}}})();class A{constructor(n){re(this,"contextStr","");this.contextStr=n}getMessage(n){return this.contextStr?this.contextStr+" "+n:n}error(n,...i){S.error(this.getMessage(n),...i)}warning(n,...i){S.warning(this.getMessage(n),...i)}info(n,...i){S.info(this.getMessage(n),...i)}verbose(n,...i){S.verbose(this.getMessage(n),...i)}trace(n,...i){S.trace(this.getMessage(n),...i)}}const P=new A("ms_auth_server_common:");function B(e,n=void 0,i=!1){const m=n||window.parent;i&&(e.uuid=D),m.postMessage(e,"*")}function G(e=""){return!window.chrome||!chrome.edgeEasyAuthPrivate?!1:!e||E.isFunctionSupported(e)}function K(e){if(!window.chrome||!chrome.edgeEasyAuthPrivate)return!1;try{E.getProfileMSAAccountInfo(e)}catch(n){return P.error("startDetectingMSAProfileInfo: chrome.edgeEasyAuthPrivate.getProfileMSAAccountInfo call failed: ",n),!1}return!0}function j(e){if(!G("getAccountType"))return!1;try{E.getAccountType(e)}catch(n){return P.error("startGettingAccountType: chrome.edgeEasyAuthPrivate.getAccountType call failed: ",n),!1}return!0}function X(e){if(!G("accountInfoReceived"))return!1;try{E.accountInfoReceived(e)}catch(n){return P.error("notifyAccountInfoReceived: chrome.edgeEasyAuthPrivate.accountInfoReceived call failed: ",n),!1}return!0}function Z(e){try{if(e.byteLength!==0){const n=new Blob([e]),i=URL.createObjectURL(n);document.getElementById("photo-img").src=i}else P.info("loadProfileImageFromArrayBuffer: Did not find profile image")}catch(n){P.error("loadProfileImageFromArrayBuffer: Ran into problems with image: ",n)}}function J(){if(!window.chrome||!chrome.edgeEasyAuthPrivate)return{found:!1};if(!chrome.edgeEasyAuthPrivate.VersionEnum)return{found:!1};const e=Object.keys(chrome.edgeEasyAuthPrivate.VersionEnum);if(!Array.isArray(e)||e.length!==1)return{found:!1};const i=e[0].split("_");if(i.length!==2)return{found:!1};if(!/^\d+$/.test(i[1]))return{found:!1};let m=-1;try{return m=Number.parseInt(i[1]),{found:!0,version:m}}catch(g){}return{found:!1}}const $=(()=>window.trustedTypes&&trustedTypes.createPolicy?trustedTypes.createPolicy("default",{createHTML:e=>e.replace(/</g,"&lt;")}):null)();function w(e){return $?$.createHTML(e):e}const E={easyAuthApiVersion:-1,initialized:!1,initialize:function(){if(!this.initialized){if(this.initialized=!0,!window.chrome||!chrome.edgeEasyAuthPrivate){this.easyAuthApiVersion=-1;return}if(this.tryFindVersion()){P.info(`initialize: Got version using tryFindVersion: this.easyAuthApiVersion: ${this.easyAuthApiVersion}`);return}console.error("easyAuthVersionWrapper: initialize: Could not find version. Setting default version to 5"),this.easyAuthApiVersion=5}},tryFindVersion:function(){const e=J();return e.found?(this.easyAuthApiVersion=e.version,!0):!1},deprecatedShowSignInPrompt:function(e,n){let i=!1;e.auto_sign_in&&(i=!0);let m=!0;e.cancel_on_tap_outside!==void 0&&e.cancel_on_tap_outside!==null&&(m=e.cancel_on_tap_outside);const g={title_string:"",fallback_domain_string:"",continue_as_user_string:"",close_string:"",verifying_string:"",verifying_with_email_string:"",privacy_statement_string:""};if(e.strings)for(const c in g)R(e.strings[c])&&(g[c]=e.strings[c]);chrome.edgeEasyAuthPrivate.showSignInPrompt({position:e.position||s,context:e.context||h,auto_sign_in:i,cancel_on_tap_outside:m,unique_id:e.unique_id||"",focus_behavior:e.focus_behavior||_,strings:g},n)},easyAuthApiV5:{getProfileMSAAccountInfo:function(e){chrome.edgeEasyAuthPrivate.getProfileMSAAccountInfo(e)},removeIgnoreCAW:function(e){chrome.edgeEasyAuthPrivate.removeIgnoreCAW(e)},showSignInPrompt:function(e,n){let i=!1;e.auto_sign_in&&(i=!0);let m=!0;e.cancel_on_tap_outside!==void 0&&e.cancel_on_tap_outside!==null&&(m=e.cancel_on_tap_outside);const g={title_string:"",fallback_domain_string:"",continue_as_user_string:"",close_string:"",verifying_string:"",verifying_with_email_string:""};if(e.strings)for(const c in g)R(e.strings[c])&&(g[c]=e.strings[c]);chrome.edgeEasyAuthPrivate.showSignInPrompt({position:e.position||s,context:e.context||h,auto_sign_in:i,cancel_on_tap_outside:m,unique_id:e.unique_id||"",focus_behavior:e.focus_behavior||_,strings:g},n)},closeSignInPrompt:function(e,n){chrome.edgeEasyAuthPrivate.closeSignInPrompt(n)}},easyAuthApiV6:{getProfileMSAAccountInfo:function(e){chrome.edgeEasyAuthPrivate.getProfileMSAAccountInfo(e)},removeIgnoreCAW:function(e){chrome.edgeEasyAuthPrivate.removeIgnoreCAW(e)},showSignInPrompt:function(e,n){E.deprecatedShowSignInPrompt(e,n)},closeSignInPrompt:function(e,n){chrome.edgeEasyAuthPrivate.closeSignInPrompt(n)}},easyAuthApiV7:{getProfileMSAAccountInfo:function(e){chrome.edgeEasyAuthPrivate.getProfileMSAAccountInfo(e)},removeIgnoreCAW:function(e){chrome.edgeEasyAuthPrivate.removeIgnoreCAW(e)},showSignInPrompt:function(e,n){E.deprecatedShowSignInPrompt(e,n)},closeSignInPrompt:function(e,n){chrome.edgeEasyAuthPrivate.closeSignInPrompt(n)},getAccountType:function(e){chrome.edgeEasyAuthPrivate.getAccountType(e)}},easyAuthApiV8:{getProfileMSAAccountInfo:function(e){chrome.edgeEasyAuthPrivate.getProfileMSAAccountInfo(e)},removeIgnoreCAW:function(e){chrome.edgeEasyAuthPrivate.removeIgnoreCAW(e)},showSignInPrompt:function(e,n){E.deprecatedShowSignInPrompt(e,n)},closeSignInPrompt:function(e,n){chrome.edgeEasyAuthPrivate.closeSignInPrompt(n)},getAccountType:function(e){chrome.edgeEasyAuthPrivate.getAccountType(e)},accountInfoReceived:function(e){chrome.edgeEasyAuthPrivate.accountInfoReceived(e)}},easyAuthApiV9:{getProfileMSAAccountInfo:function(e){chrome.edgeEasyAuthPrivate.getProfileMSAAccountInfo(e)},removeIgnoreCAW:function(e){chrome.edgeEasyAuthPrivate.removeIgnoreCAW(e)},showSignInPrompt:function(e,n){let i=!1;e.auto_sign_in&&(i=!0);let m=!0;e.cancel_on_tap_outside!==void 0&&e.cancel_on_tap_outside!==null&&(m=e.cancel_on_tap_outside);const g={title_string:"",fallback_domain_string:"",continue_as_user_string:"",close_string:"",verifying_string:"",verifying_with_email_string:"",privacy_statement_string:""};if(e.strings)for(const c in g)R(e.strings[c])&&(g[c]=e.strings[c]);chrome.edgeEasyAuthPrivate.showSignInPrompt({position:e.position||s,context:e.context||h,auto_sign_in:i,cancel_on_tap_outside:m,unique_id:e.unique_id||"",focus_behavior:e.focus_behavior||_,strings:g,redirect_mode:e.redirect_mode},n)},closeSignInPrompt:function(e,n){chrome.edgeEasyAuthPrivate.closeSignInPrompt(n)},getAccountType:function(e){chrome.edgeEasyAuthPrivate.getAccountType(e)},accountInfoReceived:function(e){chrome.edgeEasyAuthPrivate.accountInfoReceived(e)}},easyAuthApiV10:{getProfileMSAAccountInfo:function(e){chrome.edgeEasyAuthPrivate.getProfileMSAAccountInfo(e)},removeIgnoreCAW:function(e){chrome.edgeEasyAuthPrivate.removeIgnoreCAW(e)},showSignInPrompt:function(e,n){let i=!1;e.auto_sign_in&&(i=!0);let m=!0;e.cancel_on_tap_outside!==void 0&&e.cancel_on_tap_outside!==null&&(m=e.cancel_on_tap_outside);const g={title_string:"",fallback_domain_string:"",continue_as_user_string:"",close_string:"",verifying_string:"",verifying_with_email_string:"",privacy_statement_string:""};if(e.strings)for(const c in g)R(e.strings[c])&&(g[c]=e.strings[c]);chrome.edgeEasyAuthPrivate.showSignInPrompt({position:e.position||s,context:e.context||h,auto_sign_in:i,cancel_on_tap_outside:m,unique_id:e.unique_id||"",focus_behavior:e.focus_behavior||_,strings:g,redirect_mode:e.redirect_mode,will_show_verify_prompt:e.will_show_verify_prompt},n)},closeSignInPrompt:function(e,n){chrome.edgeEasyAuthPrivate.closeSignInPrompt(n)},getAccountType:function(e){chrome.edgeEasyAuthPrivate.getAccountType(e)},accountInfoReceived:function(e){chrome.edgeEasyAuthPrivate.accountInfoReceived(e)},showVerifyingPrompt:function(e,n){easyAuthApiV10.showSignInPrompt(e,n)}},easyAuthApiV11:{getProfileMSAAccountInfo:function(e){chrome.edgeEasyAuthPrivate.getProfileMSAAccountInfo(e)},removeIgnoreCAW:function(e){chrome.edgeEasyAuthPrivate.removeIgnoreCAW(e)},showSignInPrompt:function(e,n){let i=!1;e.auto_sign_in&&(i=!0);let m=!0;e.cancel_on_tap_outside!==void 0&&e.cancel_on_tap_outside!==null&&(m=e.cancel_on_tap_outside);const g={title_string:"",fallback_domain_string:"",continue_as_user_string:"",close_string:"",verifying_string:"",verifying_with_email_string:"",privacy_statement_string:""};if(e.strings)for(const c in g)R(e.strings[c])&&(g[c]=e.strings[c]);chrome.edgeEasyAuthPrivate.showSignInPrompt({position:e.position||s,context:e.context||h,auto_sign_in:i,cancel_on_tap_outside:m,unique_id:e.unique_id||"",focus_behavior:e.focus_behavior||_,strings:g,redirect_mode:e.redirect_mode,will_show_verify_prompt:e.will_show_verify_prompt,partner_name:e.partner_name},n)},closeSignInPrompt:function(e,n){chrome.edgeEasyAuthPrivate.closeSignInPrompt(n)},getAccountType:function(e){chrome.edgeEasyAuthPrivate.getAccountType(e)},accountInfoReceived:function(e){chrome.edgeEasyAuthPrivate.accountInfoReceived(e)},showVerifyingPrompt:function(e,n){easyAuthApiV10.showSignInPrompt(e,n)}},getCorrectVersionObject:function(){return this.easyAuthApiVersion===5?this.easyAuthApiV5:this.easyAuthApiVersion===6?this.easyAuthApiV6:this.easyAuthApiVersion===7?this.easyAuthApiV7:this.easyAuthApiVersion===8?this.easyAuthApiV8:this.easyAuthApiVersion===9?this.easyAuthApiV9:this.easyAuthApiVersion===10?this.easyAuthApiV10:this.easyAuthApiVersion===11?this.easyAuthApiV11:(P.error(`easyAuthVersionWrapper: getCorrectVersionObject: No easyAuthApi available for version: ${this.easyAuthApiVersion}. Default use easyAuthApiV5`),this.easyAuthApiV5)},getProfileMSAAccountInfo:function(e){this.getCorrectVersionObject().getProfileMSAAccountInfo(e)},removeIgnoreCAW:function(e){this.getCorrectVersionObject().removeIgnoreCAW(e)},showSignInPrompt:function(e,n){this.getCorrectVersionObject().showSignInPrompt(e,n)},closeSignInPrompt:function(e,n){this.getCorrectVersionObject().closeSignInPrompt(e,n)},getAccountType:function(e){this.getCorrectVersionObject().getAccountType(e)},accountInfoReceived:function(e){this.getCorrectVersionObject().accountInfoReceived(e)},isFunctionSupported:function(e){return I(this.getCorrectVersionObject()[e])},canSupportVerifyPrompt:function(){return this.easyAuthApiVersion>=10}};function q(e){P.info("In doSignInAfterIgnoreCAW"),O(e)}function z(e){if(!window.chrome||!chrome.edgeEasyAuthPrivate)return!1;try{E.removeIgnoreCAW(e)}catch(n){return P.error("startRemovingIgnoreCAW: chrome.edgeEasyAuthPrivate.removeIgnoreCAW call failed: ",n),!1}return!0}function O(e){P.info("In sendSignInClickToParent"),B({message:"sign-in-clicked",scenario:e})}function W(e=!1,n=!1){P.info("signIn: called");let i="";if(e?(i="dropdown-button-sign-in",H.sendDropdownSignInButtonClicked()):(i=n?"msa-button-sign-in":"button-sign-in",H.sendSignInClicked(n)),n&&z(()=>{q(i)})){P.info("signIn: Attempting to remove IgnoreCAW");return}O(i)}const H=(()=>{let e=null,n="",i="",m=(()=>{const f=window.location.href.match(/\/(v\d+(\.\d+)?)\//);return f.length>1?f[1]:"unknown"})();const g=(()=>{const f="samplingDisabled",p=new URLSearchParams(new URL(window.location.href).searchParams);return p.has(f)?p.get(f)==="true":!1})();function c(f,p=void 0,a=void 0){const u=window.location.origin,T=new Date,Y=p||"",ee=a||0,x={EasyAuthSessionId:e,LibVersion:m,AccountType:"UNKNOWN",events:[{EventName:f,Count:1,Message:Y,Timestamp:T.toISOString(),Duration:ee}]};function oe(M){return!!M.email_or_phone}function ne(M){return se(this,null,function*(){const t=new TextEncoder().encode(M),r=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(r)).map(d=>d.toString(16).padStart(2,"0")).join("")})}function Q(M){fetch(u+"/metric",{method:"POST",headers:{"Content-Type":"application/json",Origin:u},body:JSON.stringify(M)}).then(U=>{U.status>=400&&P.error("Telemetry failed with http code:",U.status)})}function F(M){if(M&&(x.AccountType=M),i.length===0&&n.length>0){ne(n).then(U=>{i=U,x.ClientId=i,Q(x)});return}x.ClientId=i,Q(x)}j(F)||F()}return{sendSignInClicked:function(f){c("SignIn.Clicked",f===!0?"MSA Button":"non-MSA Button")},sendSignResult:function(f,p,a){f==="success"?c("SignIn.Success",p,a):f==="fail"&&c("SignIn.Failure",p,a)},sendRedirectSignIn:function(f){c("SignIn.Redirect",f)},sendButtonShown:function(){c("Button.Shown")},sendPromptShown:function(){c("Prompt.Shown")},sendDropdownShown:function(){c("Dropdown.Shown")},sendDropdownSignInButtonClicked:function(){c("Dropdown.SignInButton.Clicked")},sendDropdownUseAnotherButtonClicked:function(){c("Dropdown.UseAnotherButton.Clicked")},sendPromptContinueClicked:function(){c("Prompt.Continue.Clicked")},sendMethodCalled:function(f){(g||Math.random()<=.1)&&c(f+".Called")},sendMethodResult:function(f,p){(g||Math.random()<=.1)&&c(`${f}.Result`,`${p}`)},sendScenarioResult:function(f,p){c(`${f}`,`${p}`)},setSessionInfo:function(f){e=f.sessionUUID,n=f.clientID}}})();window.ms={serverCommon:{signIn:W,startDetectingMSAProfileInfo:K,loadProfileImageFromArrayBuffer:Z,easyAuthVersionWrapper:E,startRemovingIgnoreCAW:z,postMessage:function(e,n=!1){B(e,void 0,n)},postMessageWithParent:function(e,n,i=!1){B(e,n,i)},matchesSessionUuid:function(e){return e===D},getLoggerWithContext:function(e){return new A(e)},telemetrySender:H,notifyAccountInfoReceived:X,createTrustedHTMLIfSupported:w}}})(),(()=>{const s=window.ms.serverCommon.getLoggerWithContext("ms_auth_server_button:"),h=window.ms.serverCommon.postMessage;s.info("ms_auth_server.js loaded");let _=`URL is ${window.location.href}`,R=!1,I=!1;const k=new URL(window.location.href);_+=`
Params
====================
`;function V(t){return typeof t=="string"||t instanceof String}function D(t){return V(t)&&!!t}function S(t){return V(t)?/^[a-z]{2}-[A-Z]{2}$/.test(t):!1}const A=(()=>k.pathname.endsWith("/signinprompt"))();A?s.info("This is sign-in-prompt context"):s.info("This is button context");const P=(()=>A?new URLSearchParams(window.location.search).get("client_id"):"")(),B=(()=>{const r=new URLSearchParams(window.location.search).get("locale");return S(r)?r:"en-US"})(),G=(()=>{if(!A)return"";const r=new URLSearchParams(window.location.search).get("context");return V(r)?r:""})(),K=(()=>{const r=new URLSearchParams(window.location.search).get("theme");return V(r)?r.includes("piano"):!1})();function j(){return A?!1:new URLSearchParams(window.location.search).get("use_dropdown_list")==="true"}let X=new Map;for(const[t,r]of k.searchParams)X.set(t,decodeURIComponent(r)),_+=`${t} = ${decodeURIComponent(r)}
`;s.info(_);const Z="RIGHT",J="SIGNIN",$="NO_FOCUS",w={NONE:0,PROMPT_FETCHING_STRINGS:1,PROMPT_REQUEST_SENT_TO_EDGE:2,PROMPT_OPENED_IN_EDGE:3,PROMPT_IN_AUTO_SIGNIN_MODE:4,PROMPT_SIGNIN_IN_PROGRESS:5,PROMPT_CLOSE_REQUEST_SENT_TO_EDGE:6};window.ms.serverCommon.easyAuthVersionWrapper.initialize();const E=new URLSearchParams(window.location.search),q=E.get("uuid"),z=E.get("client_id");if(q){const t={sessionUUID:q,clientID:z||""};window.ms.serverCommon.telemetrySender.setSessionInfo(t),E.get("send_session_started")==="true"&&s.info("Session started")}function O(t){s.info("In sendSignInPromptResultToParent"),h({message:"sign-in-prompt-result",result:t})}function W(t,r){let o={type:"display",displayed:t};r&&(o.reason=r),O(o)}function H(t){O({type:"skipped",reason:t})}function e(t){O({type:"dismissed",reason:t})}function n(t){O({type:"internal",reason:t})}const i=(()=>{let t=!1,r=w.NONE,o="",d;function b(l){if(s.info("promptStateChangeListener: ",l),l.unique_id&&o&&o!==l.unique_id){s.info("promptStateChangeListener: Got event for different unique id - Exiting");return}if(l.value==="PROCEED_WITH_SIGNIN"){if(r==w.PROMPT_OPENED_IN_EDGE){r=w.PROMPT_SIGNIN_IN_PROGRESS;const y=()=>{n("user_clicked_continue"),window.ms.serverCommon.telemetrySender.sendPromptContinueClicked()};window.ms.serverCommon.startRemovingIgnoreCAW(y)||(n("user_clicked_continue"),window.ms.serverCommon.telemetrySender.sendPromptContinueClicked())}}else{r=w.NONE,o="";let y="unknown";l.value==="USER_CANCELLED"?y="user_cancelled":l.value==="CLOSED_ON_TAP_OUTSIDE"?y="tap_outside":l.value==="PROFILE_SIGNED_OUT"?y="profile_signed_out":l.value==="PROFILE_ACCOUNT_REMOVED"&&(y="profile_account_removed"),H(y)}}function L(){if(window.chrome&&chrome.edgeEasyAuthPrivate){if(chrome.edgeEasyAuthPrivate.onSignInPromptStateChanged)try{chrome.edgeEasyAuthPrivate.onSignInPromptStateChanged.addListener(b),t=!0}catch(l){s.error(l)}if(chrome.edgeEasyAuthPrivate.onConsentPromptSuppressionTimedOut)try{chrome.edgeEasyAuthPrivate.onConsentPromptSuppressionTimedOut.addListener(l=>{if(l.url){const y={message:"consent-suppression-timed-out",url:l.url};h(y)}})}catch(l){s.error(l)}}}function C(){const l=new URL("/promptstrings",window.location.origin);return l.searchParams.append("placeholder_style","percent"),G&&l.searchParams.append("context",G),B&&l.searchParams.append("locale",B),l.toString()}function N(l){if(d){s.info("showPromptCallbackWithStringsInternal: Calling with cachedStrings: ",d),l(d);return}r=w.PROMPT_FETCHING_STRINGS;const y=C();s.info("showPromptCallbackWithStringsInternal: promptStringsUrl: ",y),fetch(y).then(v=>{if(!v.ok)throw new Error(`Network response not OK: status: ${v.status}, statusText: ${v.statusText}`);return v.json()}).then(v=>{s.info("showPromptCallbackWithStringsInternal: Calling callback with stringsJson: ",v),d=v,l(v)}).catch(v=>{s.error(v.message),s.warning("showPromptCallbackWithStringsInternal: FAILED: Calling callback with undefined"),l()})}return A&&L(),{hasSupportForPromptEvents:function(){return t},setCurrentState:function(l){t&&(r=l,l===w.NONE&&(o=""))},getCurrentState:function(){return r},setPromptId:function(l){o=l},showPromptCallbackWithStrings:function(l){return N(l),!0}}})();window.window.ms.serverCommon.easyAuthVersionWrapper.initialize();const m=document.getElementById("no-existing-sign-in-container"),g=document.getElementById("existing-signin-container");function c(t){h(t)}function f(t){document.getElementById("dropdown-arrow-target").setAttribute("aria-expanded",t.toString())}function p(){const t=document.getElementById("microsoft-button");if(!t)return;t.ariaExpanded="true";const r=t.getBoundingClientRect().height;c({message:"open-dropdown-list-from-signin-button",msButtonHeight:r}),I=!0,f(I)}function a(){const t=document.getElementById("microsoft-button");!t||(t.ariaExpanded="false",c({message:"close-dropdown-list-from-signin-button"}),I=!1,f(I))}if(!A){const t=document.getElementById("dropdown-arrow");t.addEventListener("click",r=>{r.stopPropagation(),I?a():p()}),t.addEventListener("keydown",r=>{switch(r.key){case"Enter":case" ":I||(r.preventDefault(),p());return;default:return}})}function u(t){const r=document.getElementById("microsoft-button");!r||r.setAttribute("aria-labelledby",t)}function T(){A||(R=!1,u("unknown-user-button-label"),m.classList.remove("hidden"),g.classList.add("hidden"),window.ms.serverCommon.telemetrySender.sendButtonShown())}function Y(){A||(R=!0,u("button-label"),m.classList.add("hidden"),g.classList.remove("hidden"),window.ms.serverCommon.telemetrySender.sendButtonShown(),h({message:"create-dropdown-list-iframe"}))}function ee(t){if(A)return;let r=t.email_or_phone||"",o=t.full_name||"",d=t.first_name||"";if(!(r||o||d)){T(),s.info("handleMSAProfileAccountInfo - no account found");return}let L=j();document.getElementById("photo-img").ariaLabel=`${d}`,document.getElementById("ms-logo-title").innerHTML=window.ms.serverCommon.createTrustedHTMLIfSupported(`Sign in as ${r}`),document.getElementById("sign-in-as-div").innerHTML=window.ms.serverCommon.createTrustedHTMLIfSupported(`${d}`),document.getElementById("email-div").innerHTML=window.ms.serverCommon.createTrustedHTMLIfSupported(`${r}`);const C=document.getElementById("microsoft-button");if(C){const N=C.classList.contains("type--icon");N||C.classList.add("user--known"),L&=!N}if(L){const N=document.getElementById("dropdown-arrow");N&&(C.ariaExpanded="false",N.classList.replace("hidden","shown"))}else C&&(C.classList.contains("type--icon")||C.classList.add("user--nodropdown"));window.ms.serverCommon.loadProfileImageFromArrayBuffer(t.profile_image),Y()}const x=document.getElementById("microsoft-button");x&&(x.addEventListener("click",t=>{j()&&I&&a(),window.ms.serverCommon.signIn(!1,R)}),x.addEventListener("keydown",t=>{switch(t.key){case"Enter":case" ":t.preventDefault(),window.ms.serverCommon.signIn(!1,R);return;default:return}})),(K||!window.ms.serverCommon.startDetectingMSAProfileInfo(ee))&&T();function oe(t){t==="OPENED"?(W(!0),i.setCurrentState(w.PROMPT_OPENED_IN_EDGE)):(W(!1,t==="INCORRECT_PROFILE"?"non_msa_profile":"unknown"),i.setCurrentState(w.NONE))}function ne(t){if(s.info("handleSignInPromptResult: ",t),t.value==="PROCEED_WITH_SIGNIN"){s.info("handleSignInPromptResult: Proceed with sign-in");const r={value:"PROCEED_WITH_SIGNIN"},o=()=>{O(r)};window.ms.serverCommon.startRemovingIgnoreCAW(o)||O(r)}else{if(i.hasSupportForPromptEvents()){oe(t.value);return}const r={value:t.value};O(r)}}function Q(t){if(!t)return{};const r=[["title","title_string"],["fallbackDomain","fallback_domain_string"],["continueAsUser","continue_as_user_string"],["close","close_string"],["verifying","verifying_string"],["verifyingWithEmail","verifying_with_email_string"],["consentStatement","privacy_statement_string"]],o=new Map(r),d={};return o.forEach((b,L)=>{D(t[L])&&(d[b]=t[L])}),d}function F(t="",r="",o=Z,d=J,b=!1,L=!1,C=!1,N=!1,l=""){if(!A)return!1;if(!window.chrome||!chrome.edgeEasyAuthPrivate)return W(!1,"browser_not_supported"),!1;if(i.getCurrentState()!==w.NONE)return W(!1,"another_prompt_running"),!1;function y(v){s.info("showSignInPrompt: In doActualPromptWork");try{v=Q(v);const te=$;window.ms.serverCommon.easyAuthVersionWrapper.showSignInPrompt({url:t,unique_id:r,position:o,context:d,cancel_on_tap_outside:b,auto_sign_in:L,focus_behavior:te,strings:v,redirect_mode:C,will_show_verify_prompt:N,partner_name:l},ne),i.setCurrentState(w.PROMPT_REQUEST_SENT_TO_EDGE),i.setPromptId(r)}catch(te){return s.error("showSignInPrompt: chrome.edgeEasyAuthPrivate.showSignInPrompt call failed: ",te),!1}return window.ms.serverCommon.telemetrySender.sendPromptShown(),!0}return P?(i.showPromptCallbackWithStrings(y),i.setPromptId(r),!0):(s.warning("showSignInPrompt: no client id found, proceeding without cooldown check"),i.showPromptCallbackWithStrings(y))}function ie(t="",r="",o=!0){if(!!A){if(!window.chrome||!chrome.edgeEasyAuthPrivate)return!1;try{window.ms.serverCommon.easyAuthVersionWrapper.closeSignInPrompt({url:t,unique_id:r},function(d){s.info("closeSignInPrompt: Close sign-in prompt returned"),i.setCurrentState(w.NONE),o&&e("cancel_called")}),i.setCurrentState(w.PROMPT_CLOSE_REQUEST_SENT_TO_EDGE)}catch(d){return s.error("closeSignInPrompt: chrome.edgeEasyAuthPrivate.closeSignInPrompt call failed: ",d),!1}return!0}}function M(t,r){h({message:"ignore-caw-operation-done",context:t,additionalInfo:r})}function U(t,r){const o=t?!!t.email_or_phone:!1;h({message:"has-msa-account-result",id:r,result:o})}window.addEventListener("message",t=>{const r=["dropdown-list-closed"];s.info("Message EventHandler: Event received in iframe: ",t);let o=t.data;if(o){if(s.info("Message EventHandler: DataObject: ",o),!window.ms.serverCommon.matchesSessionUuid(o.uuid)&&!(r.indexOf(o.message)!=-1)){s.warning(`Message EventHandler: Neglecting message with incorrect uuid: ${o.uuid}`);return}if(o.message==="start-sign-in-prompt"){F(o.url,o.unique_id,o.position,o.context,o.cancel_on_tap_outside,o.auto_sign_in,o.redirect_mode,!1,o.partner_name);return}if(o.message==="start-verifing-prompt"){if(!window.ms.serverCommon.easyAuthVersionWrapper.canSupportVerifyPrompt()){W(!1,"browser_not_supported");return}F(o.url,o.unique_id,o.position,o.context,o.cancel_on_tap_outside,o.auto_sign_in,o.redirect_mode,o.will_show_verify_prompt);return}if(o.message==="start-sign-in-prompt-for-button"){window.ms.serverCommon.easyAuthVersionWrapper.closeSignInPrompt({url:"",unique_id:""},function(){i.setCurrentState(w.NONE),F(o.url,o.unique_id,o.position,o.context,o.cancel_on_tap_outside,o.auto_sign_in,o.redirect_mode,o.will_show_verify_prompt)}),i.setCurrentState(w.PROMPT_CLOSE_REQUEST_SENT_TO_EDGE);return}if(o.message==="close-sign-in-prompt"){ie(o.url,o.unique_id,o.called_by_cancel_api);return}if(o.message==="remove-ignore-caw"){const d=()=>{M(o.context,o.additionalInfo)};window.ms.serverCommon.startRemovingIgnoreCAW(d)||d()}if(o.message==="dropdown-list-closed"){I=!1,f(I);return}if(o.message==="sign-in-result"){window.ms.serverCommon.telemetrySender.sendSignResult(o.result,o.scenario,o.duration);return}if(o.message==="redirect-sign-in"){window.ms.serverCommon.telemetrySender.sendRedirectSignIn(o.scenario);return}if(o.message==="method-called"){window.ms.serverCommon.telemetrySender.sendMethodCalled(o.method);return}if(o.message==="method-result"){window.ms.serverCommon.telemetrySender.sendMethodResult(o.method,o.result);return}if(o.message==="scenario-result"){window.ms.serverCommon.telemetrySender.sendScenarioResult(o.scenario,o.result);return}if(o.message==="has-msa-account"){const d=o.id,b=C=>{U(C,d)};window.ms.serverCommon.startDetectingMSAProfileInfo(b)||U(null,d)}if(o.message==="account-info-received"){const d=o.accountInfo,b={first_name:d.givenName,last_name:d.surname,email_or_phone:d.email};window.ms.serverCommon.notifyAccountInfoReceived(b);return}}}),h({message:A?"easy-auth-server-signin-prompt-ready":"easy-auth-server-button-ready"},!0)})();
