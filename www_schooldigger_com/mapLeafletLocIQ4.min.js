function gmLoadMapInitial(){var n=getParameterByName("a");n&&(sd2LoadMap(!0,n),n=null);map.on("moveend",function(){bMapLoading||(clearGMParams(!0),gmParams.mapMove="1",sd2LoadMap(!1))})}function disableClickPropagation(n){$(n).on("mouseover",function(){map.dragging.disable()});$(n).on("mouseout",function(){map.dragging.enable()})}function gmInitGoogleMap(n){var t=L.tileLayer.Unwired({key:"pk.8791a3e9f92609854af80c6777984379",scheme:"streets"});map=L.map("map_canvas",{zoomControl:!1,scrollWheelZoom:!1,layers:[t],zoomOffset:-1,minZoom:1,crossOrigin:!0});L.control.zoom({position:"topright"}).addTo(map);bRepopulateOnMapMove=n;map.on("moveend",function(){bMapLoading||sd2RefreshSchoolList()});typeof gmLegendDiv!="undefined"&&(L.Control.sdLegend=L.Control.extend({onAdd:function(){return $("#divMapLegend").show(),L.DomUtil.get(gmLegendDiv)},onRemove:function(){}}),L.control.sdLegend=function(n){return new L.Control.sdLegend(n)},L.control.sdLegend({position:"bottomright"}).addTo(map),disableClickPropagation(gmLegendDiv));gtag("event","loadLocIQ",{event_category:"map",event_label:pageName()})}function gmInitGoogleMapState(n){var t=L.tileLayer.Unwired({key:"pk.8791a3e9f92609854af80c6777984379",scheme:"streets"});map=L.map("map_canvas",{zoomControl:!1,scrollWheelZoom:!1,layers:[t],zoomOffset:-1,minZoom:1,crossOrigin:!0}).fitBounds(n);L.control.zoom({position:"topright"}).addTo(map);L.Control.sdOptions=L.Control.extend({onAdd:function(){return $(".gmMenu").addClass("gmMenuLeaflet"),$(".gmMenu .panel-body").addClass("gmMenuPad"),$(".gmMenu").removeClass("gmMenu"),L.DomUtil.get("divOptions")},onRemove:function(){}});L.control.sdOptions=function(n){return new L.Control.sdOptions(n)};L.control.sdOptions({position:"topleft"}).addTo(map);disableClickPropagation("#divOptions");L.Control.sdMessage=L.Control.extend({onAdd:function(){return $(".gmMessageList").addClass("gmMessageListLeaflet"),$(".gmMessageList").removeClass("gmMessageList"),L.DomUtil.get("divMapMessagePanel")},onRemove:function(){}});L.control.sdMessage=function(n){return new L.Control.sdMessage(n)};L.control.sdMessage({position:"topright"}).addTo(map);disableClickPropagation("#divMapMessagePanel");L.Control.sdLegend=L.Control.extend({onAdd:function(){return $("#divMapLegend").show(),L.DomUtil.get("divMapLegend")},onRemove:function(){}});L.control.sdLegend=function(n){return new L.Control.sdLegend(n)};L.control.sdLegend({position:"bottomright"}).addTo(map);disableClickPropagation("#divMapLegend");gtag("event","loadLocIQ",{event_category:"map",event_label:pageName()})}function getBoundObject(n,t,i,r){var u=L.latLng(n,t),f=L.latLng(i,r);return L.latLngBounds(u,f)}function sd2LoadMap(n,t){var i,r,u;if(bMapLoading=!0,modalOn(),t){if(i=decodeURIComponent(t),t.acResult){r=t.acResult.split("_")[0];switch(r){case"3":gmSetControlsForPublic();gmChangeBoundary(2,"District ",!1);break;case"6":gmChangeBoundary(1,"County ",!1);break;case"7":gmChangeBoundary(4,"Zip ",!1)}}}else if(typeof map!="undefined"&&(gmParams.mapBoundsLeaflet=map.getBounds()),gmParams.divOptions=$("#divOptions").find("input, textarea, select, hidden").serialize(),i=JSON.stringify(gmParams),gmParams.acResult){u=gmParams.acResult.split("_")[0];switch(u){case"3":gmSetControlsForPublic();gmChangeBoundary(2,"District ",!1);break;case"6":gmChangeBoundary(1,"County ",!1);break;case"7":gmChangeBoundary(4,"Zip ",!1)}}$.ajax({url:"/aj/getMapDataState.aspx",dataType:"xml",data:i,success:function(t){gmDisplayMessagesState(t);gmLoadAjaxResultIntoMap(t,n,gmStateMapSchoolClick,gmStateOpenInfoWindowPolygon)},complete:function(){modalOff();setTimeout(function(){bMapLoading=!1},750);!t&&window.history.pushState&&window.history.pushState(null,null,window.location.href.split("?")[0]+"?a="+encodeURIComponent(JSON.stringify(gmParams)))}})}function gmLoadAjaxResultIntoMap(n,t,i,r){var e,s,c,f,nt,l,bt,a,ht,ct,tt,lt,v,it;if(typeof map=="undefined")return 0;i||(i=mapSchoolClick);gmDeleteOverlays(mapMarkers);gmDeletePolygons(polygons);gmDeletePolygons(polygonsBoundary);mapMarkers=[];polygons=[];polygonsBoundary=[];mapBounds=null;var y,u=n.getElementsByTagName("m"),p=u.length,rt=!1;if(p>0)for(e=0;e<p;e++){var at=parseFloat(u[e].getElementsByTagName("lt")[0].textContent),vt=parseFloat(u[e].getElementsByTagName("lg")[0].textContent),w=u[e].getElementsByTagName("id")[0].textContent,ut=u[e].getElementsByTagName("ip")[0].textContent,ft=" ";u[e].getElementsByTagName("l").length>0&&(ft=u[e].getElementsByTagName("l")[0].textContent);var b,k=.9,et=!1,ot=u[e].getElementsByTagName("iw");u[e].getElementsByTagName("fi").length>0&&u[e].getElementsByTagName("fi")[0].textContent==="1"&&(k=.2,et=!0);ot.length>0&&(b=ot[0].textContent);s=" ";switch(ft){case"1":s="E";break;case"2":s="M";break;case"3":s="H";break;case"4":s="A";break;case"5":s="P";break;default:s=" "}c=new L.latLng(at,vt);y=et?new L.Marker.SVGMarker(c,{iconOptions:{circleRatio:0,color:"rgb(204,204,204)",fillColor:ut,fillOpacity:k,fontSize:8,iconSize:[24,36]},draggable:!1,zIndexOffset:-1e3,id:w,iw:b}).addTo(map):new L.Marker.SVGMarker(c,{iconOptions:{circleRatio:0,circleText:s,color:"rgb(0,0,0)",fillColor:ut,opacity:1,fillOpacity:k,fontSize:14,iconSize:[24,36]},draggable:!1,id:w,iw:b}).addTo(map);y.on("click",function(){i(this)});mapBounds===null?mapBounds=new L.latLngBounds(c,c):mapBounds.extend(c);mapMarkers[e]={};mapMarkers[e].marker=y;mapMarkers[e].id=w;rt=!0}else if(u=n.documentElement.getElementsByTagName("bnd"),u.length>0){var d=parseFloat(u[0].getElementsByTagName("ltt")[0].textContent),g=parseFloat(u[0].getElementsByTagName("lgl")[0].textContent),h=new L.latLng(d,g);mapBounds===null?mapBounds=new L.latLngBounds(h,h):mapBounds.extend(h);d=parseFloat(u[0].getElementsByTagName("ltb")[0].textContent);g=parseFloat(u[0].getElementsByTagName("lgr")[0].textContent);h=new L.latLng(d,g);mapBounds===null?mapBounds=new L.latLngBounds(h,h):mapBounds.extend(h);rt=!0}var o=n.documentElement.getElementsByTagName("p"),yt=null,pt=!1,wt=u.length===1,st;for(st=r?r:openInfoWindowPolygon,f=0;f<o.length;f++){for(nt="",l=0;l<o[f].getElementsByTagName("b")[0].childNodes.length;l++)nt+=o[f].getElementsByTagName("b")[0].childNodes[l].nodeValue;bt=o[f].getElementsByTagName("np")[0].textContent;o[f].getElementsByTagName("n").length>0&&(a=o[f].getElementsByTagName("n")[0].textContent);ht=o[f].getElementsByTagName("ip").length>0?o[f].getElementsByTagName("ip")[0].textContent:"#CCCCCC";ct=o[f].getElementsByTagName("id").length>0?o[f].getElementsByTagName("id")[0].textContent:"";lt=L.Polyline.fromEncoded(nt);tt=L.polygon(lt.getLatLngs(),{color:"#000000",weight:1,fillColor:ht,fillOpacity:.5,stroke:!0}).addTo(map);tt.on("click",function(n){st(n,this)});polygons[f]={};polygons[f].polygon=tt;a&&(polygons[f].polygon.name=a);polygons[f].polygon.dbid=ct;wt&&mapBounds!==null&&mapBounds.extend(polygons[f].polygon.getBounds());yt=a;pt=!0}return v=!1,t&&(it=$("#gmReqType"),it.length>0?it[0].value!=="4"&&(v=!0):v=!0,v===!0&&mapBounds&&map.fitBounds(mapBounds)),p}function openInfoWindowPolygon(n,t){if(bMapLoading=!0,t.name.length===13&&t.name.substring(0,1)==="s"){var i=getNameFromMapPoint(t.name);mapSchoolClick(i.marker)}else L.popup().setLatLng(n.latlng).setContent("<div style='overflow:hidden'>"+t.name+"<\/div>").openOn(map),setTimeout(function(){bMapLoading=!1},750)}function gmStateOpenInfoWindowPolygon(n,t){if(bMapLoading=!0,t.options.name)L.popup().setLatLng(n.latlng).setContent("<div style='overflow:hidden'>"+t.options.name+"<\/div>").openOn(map),setTimeout(function(){bMapLoading=!1},500);else dataQS="id="+t.dbid,$.ajax({url:"/aj/ajIW.aspx",dataType:"xml",success:gmPolygonIWOnCompleteSD2,context:n,errorL:gmIWOnError,data:dataQS})}function gmPolygonIWOnCompleteSD2(n){var t=n.documentElement.getElementsByTagName("iw"),i;t.length>0&&(i=t[0].textContent,L.popup().setLatLng(this.latlng).setContent(i).openOn(map));gmDeletePolygons(polygonsBoundary);setTimeout(function(){bMapLoading=!1},500)}function mapSchoolClick(n){if(bMapLoading=!0,n.options.iw)n.bindPopup(n.options.iw).openPopup(),setTimeout(function(){bMapLoading=!1},500);else dataQS=isBreakpoint("xs")?"s="+n.options.id+"&xs=1":"s="+n.options.id,$.ajax({url:"/aj/ajSchool.aspx",dataType:"xml",success:gmIWOnCompleteSD2,context:n,errorL:gmIWOnError,data:dataQS});highlightSD(n.options.id,!isBreakpoint("xs"))}function gmIWOnCompleteSD2(n){var e=n.documentElement.getElementsByTagName("iw"),t=n.documentElement.getElementsByTagName("sb"),o,r,u,s,i;if(e.length>0)if(o=e[0].textContent,this.bindPopup(o).openPopup(),$.totalStorage(this.id)){$(".addSchButtonIW").addClass("btn-success").removeClass("btn-default");$(".addSchButtonIW").children("span").addClass("glyphicon-ok").removeClass("glyphicon-plus");$(".addSchButtonIW").on("click",btnSchoolClicked)}else $(".addSchButtonIW").on("click",btnSchoolClicked);if(gmDeletePolygons(polygonsBoundary),r=t.length,r>0){for(scI=0;scI<r;scI++){for(u="",s=t[scI].getElementsByTagName("b")[0].childNodes.length,i=0;i<s;i++)u+=t[scI].getElementsByTagName("b")[0].childNodes[i].nodeValue;var a=t[scI].getElementsByTagName("np")[0].textContent,h=t[scI].getElementsByTagName("n")[0].textContent,c=t[scI].getElementsByTagName("ip")[0].textContent,f,l=L.Polyline.fromEncoded(u);f=L.polygon(l.getLatLngs(),{color:"#000000",weight:1,fillColor:c,fillOpacity:.5,stroke:!0,name:h}).addTo(map);f.on("click",function(n){gmStateOpenInfoWindowPolygon(n,this)});polygonsBoundary[scI]={};polygonsBoundary[scI].polygon=f}polysLighten()}setTimeout(function(){bMapLoading=!1},1e3)}function gmIWOnError(){this.bindPopup("There was an error loading this information").openPopup();setTimeout(function(){bMapLoading=!1},500)}function gmStateMapSchoolClick(n){if(bMapLoading=!0,n.options.iw)n.bindPopup(n.options.iw).openPopup(),setTimeout(function(){bMapLoading=!1},500);else dataQS="s="+n.options.id+"&noSave=1",$.ajax({url:"/aj/ajSchool.aspx",dataType:"xml",success:gmStateIWOnCompleteSD2,context:n,errorL:gmIWOnError,data:dataQS})}function gmStateIWOnCompleteSD2(n){var o=n.documentElement.getElementsByTagName("iw"),t=n.documentElement.getElementsByTagName("sb"),s,u,f,h,i,a,r,c,e,l;if(o.length>0&&(s=o[0].textContent,this.bindPopup(s).openPopup()),gmDeletePolygons(polygonsBoundary),u=t.length,u>0){for(scI=0;scI<u;scI++){for(f="",h=t[scI].getElementsByTagName("b")[0].childNodes.length,i=0;i<h;i++)f+=t[scI].getElementsByTagName("b")[0].childNodes[i].nodeValue;a=t[scI].getElementsByTagName("np")[0].textContent;t[scI].getElementsByTagName("n").length>0&&(r=t[scI].getElementsByTagName("n")[0].textContent);c=t[scI].getElementsByTagName("ip")[0].textContent;l=L.Polyline.fromEncoded(f);e=L.polygon(l.getLatLngs(),{color:"#000000",weight:1,fillColor:c,fillOpacity:.5,stroke:!0,name:r+" attendance boundary"}).addTo(map);e.on("click",function(n){gmStateOpenInfoWindowPolygon(n,this)});polygonsBoundary[scI]={};polygonsBoundary[scI].polygon=e;r&&(polygonsBoundary[scI].polygon.name=r)}polysLighten()}setTimeout(function(){bMapLoading=!1},1e3)}function polysLighten(){if(polygons){var n=polygons.length;for(i=0;i<n;i++)polygons[i].polygon.options.fillOpacity=.2}}function polysDarken(){if(polygons){var n=polygons.length;for(i=0;i<n;i++)polygons[i].polygon.options.fillOpacity=.5}}function gmDeleteOverlays(n){if(n){for(i in n)n[i].marker.remove();n.length=0}}function gmDeletePolygons(n){if(n){for(i in n)n[i].polygon.remove();n.length=0}}function getNameFromMapPoint(n){for(var i=null,t=0;t<mapMarkers.length;t++)if(mapMarkers[t].id===n){i=mapMarkers[t];break}return i}function redrawMap(){setTimeout(function(){map},500)}function sd2RefreshSchoolList(){if(bBeenHereOnce){if(!bRepopulateOnMapMove)return;sd2LoadSchoolList(!1)}bBeenHereOnce=!0}function sd2LoadSchoolList(n){typeof map!="undefined"&&$("#gmMapBoundsLeaflet").val(map.getBounds().toBBoxString());var t=$("#divWidgetParams").find("input, textarea, select, hidden").serialize();modalOn();$.ajax({type:"GET",url:"/aj/getMapData.aspx?"+t,dataType:"xml",success:function(t){gmDisplayMessages(t);gmLoadAjaxResultIntoMap(t,n);gmLoadAjaxResultIntoTable(t);gmLoadAjaxResultIntoGrid(t);modalOff();initSaveSchoolButtons()},error:function(){modalOff()}})}function slH(n){var t,i;mapExists()&&(map.closePopup(),t=findMarker(n),t===null||(gmDimOverlays(mapMarkers,t),i="s="+mapMarkers[t].id+"&bnd=1",$.ajax({url:"/aj/ajSchool.aspx",dataType:"xml",success:gmIWOnCompleteSD2,context:mapMarkers[t].marker,errorL:gmIWOnError,data:i})))}function slUH(){gmLightOverlays(mapMarkers)}function resizeMapBounds(){var n,t;if(typeof map!="undefined"){n=new L.latLngBounds;for(t in mapMarkers)n.extend(mapMarkers[t].marker.getLatLng());map.fitBounds(n)}}function gmLightOverlays(n){if(!isIE()&&n)for(var t in n)n[t].marker.setStyle({opacity:1})}function gmDimOverlays(n,t){var r,i;if(!isIE()&&n)for(r in n)i=parseInt(r),i!==t&&n[i].marker.setStyle({opacity:.3})}function isIE(){var n=window.navigator.userAgent;return/MSIE|Trident/.test(n)}var bBeenHereOnce=!1,zindexHold=1;