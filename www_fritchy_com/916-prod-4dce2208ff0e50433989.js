(self.webpackChunk_multimediallc_cb_ts=self.webpackChunk_multimediallc_cb_ts||[]).push([[916],{1048:(e,t)=>{"use strict";var i,s;function n(e){switch(e){case i.All:case i.Male:case i.Female:case i.Couple:case i.Trans:return e;case i.OldTrans:case s.Transfemme:case s.Transmasc:case s.Nonbinary:return i.Trans;default:return i.All}}t.IL=t.hf=t.CM=t.YT=void 0,t.P_=n,t.Bg=function(e){var s,o,r,a;let l=null!==(s=null==e?void 0:e.pathname)&&void 0!==s?s:window.location.pathname;l.endsWith("/")||(l+="/");const h=l.split("/");if(4===h.length&&"tag"===h[1])return i.All;if(3===h.length&&t.IL.has(h[1]))return i.All;const d=null!==(o=h[h.length-2])&&void 0!==o?o:"",c=d.endsWith("-cams")?d.slice(0,-5):d,u=null!==(r=t.IL.get(c))&&void 0!==r?r:n(c);if(u!==i.All)return u;const p=null!==(a=null==e?void 0:e.searchParams)&&void 0!==a?a:new URLSearchParams(window.location.search);for(const e of["gender","genders","g"]){const t=p.get(e);if(null!==t)return n(t.split(",")[0])}return i.All},function(e){e.All="",e.Male="m",e.Female="f",e.Couple="c",e.Trans="t",e.OldTrans="s"}(i||(t.YT=i={})),function(e){e.Transfemme="tf",e.Transmasc="tm",e.Nonbinary="tn"}(s||(t.CM=s={})),t.hf=new Map([[i.All,""],[i.Male,"male"],[i.Female,"female"],[i.Couple,"couple"],[i.Trans,"trans"],[i.OldTrans,"trans"]]),t.IL=new Map,t.hf.forEach(((e,i)=>t.IL.set(e,i))),t.IL.set("trans",i.Trans)},7193:(e,t,i)=>{"use strict";i.d(t,{Yz:()=>h,z3:()=>l,pq:()=>r,R8:()=>a});const s=!1;let n;try{n=!0}catch(e){console.error("@multimediallc/logging failed to initialize, probably due to undefined process.env.NODE_ENV.",e),n=!0}const o=window.newrelic;function r(e,t){s||void 0!==window.console&&(void 0!==console.info||n?console.info(e,u(t)):console.log("INFO ",e,u(t)))}function a(e,t,i=""){if(s)return;let o;void 0!==window.console&&(void 0!==console.warn||n?console.warn(i.concat("WARN "),e,u(t)):console.log(i.concat("WARN "),e,u(t)),d());try{o="object"==typeof e?JSON.stringify(e):String(e)}catch(t){o=`${e}`}c(i.concat("WARN"),new Error(o),t)}function l(e,t,i=""){if(s)return;let o;void 0!==window.console&&(void 0!==console.error||n?console.error(i.concat("ERROR "),e,u(t)):console.log(i.concat("ERROR "),e,u(t)),d());try{o="object"==typeof e?JSON.stringify(e):String(e)}catch(t){o=`${e}`}c(i.concat("ERROR"),new Error(o),t)}function h(e,t){s||n||void 0!==window.console&&(void 0!==console.debug||n?console.debug(e,u(t)):console.log("DEBUG ",e,u(t)))}function d(){s||n||void 0!==window.console&&void 0!==console.trace&&console.trace()}function c(e,t,i={}){try{if(void 0===o)return;const s={};if(s["attributes.level"]=e,"object"==typeof i)for(const e in i)if("xhrErrorAttributes"!==e)s[`attributes.${e}`]=i[e];else{const t=i[e];s["attributes.xhrError"]=!0,s["attributes.xhrState"]=t.readyState,s["attributes.xhrStatus"]=t.status,s["attributes.xhrReason"]=t.reason}else s["attributes.extra"]=i;o.noticeError(t,s)}catch(e){console.error(`New Relic Error in reportError: ${e}`)}}function u(e){return void 0===e?"":e}},6262:(e,t,i)=>{"use strict";i.d(t,{ZB:()=>O,Ge:()=>F,yR:()=>N});var s=i(6624),n=i(7623),o=i(6784),r=i(5216),a=i(2709),l=i(5020),h=i(3955),d=i(8423),c=i(8451),u=i(9060),p=i(7407),m=i(1452),g=i(4947),v=i(1372),f=i(82),y=i(816),b=i(9930),w=i(9447),C=i(6861);class S extends C.A{styleRow(e){}styleLabelContainer(e){}styleLabel(e){(0,w.fZ)(e,w.aG.defaultColor)}styleFieldContainer(e){(0,w.fZ)(e,w.aG.defaultColor)}styleField(e){}styleHelpText(e){(0,w.fZ)(e,w.aG.defaultColor)}}const x=[{label:g.R.showLocations,value:!0}],T=[{label:g.R.previewRooms,value:!0}];class P extends f.b{initData(e){super.initData(e),(0,u.rT)()?s.UrlState.current.listen(["showType"],(e=>{this.setHidden(this.showLocationCheckboxes,e.showType===s.ShowType.FOLLOW_OFFLINE)}),this.element):b.Xv.listen((()=>this.setHidden(this.showLocationCheckboxes,(0,s.isOfflineFollowed)())))}createElement(e){return this.showLocationCheckboxes=new y.Ws({choices:x,name:"show_location",defaultValue:e.showLocation,styles:new S}),this.animateThumbnailsCheckboxes=new y.Ws({choices:T,name:"animate_thumbnails",defaultValue:e.animateThumbnails,disabled:e.animateThumbnailsDisabled,styles:new S}),this.setDisabled(this.animateThumbnailsCheckboxes,e.animateThumbnailsDisabled),this.setHidden(this.showLocationCheckboxes,(0,s.isOfflineFollowed)()),(0,v.tT)("div",{id:"advanced_options"},(0,v.tT)("label",null,g.R.settings,":"),(0,v.tT)("form",{id:"filter_options_form",action:"/ax/update_option_filters/",method:"post"},this.showLocationCheckboxes.getField()),(0,v.tT)("form",{id:"animate_thumbnails_form",action:"/ax/update_animate_thumbnails_options/",method:"post"},this.animateThumbnailsCheckboxes.getField()))}initUI(e){super.initUI(e),this.setIdAndForAttribute(this.showLocationCheckboxes,"id_show_location"),this.setIdAndForAttribute(this.animateThumbnailsCheckboxes,"id_animate_thumbnails")}setDisabled(e,t){const i=e.getField().querySelector("input");null!==i&&(i.disabled=t)}setHidden(e,t){e.getField().style.display=t?"none":"block",this.setDisabled(e,t)}setIdAndForAttribute(e,t){const i=e.getField().querySelector("input");if(null!==i){i.id=t;const e=i.closest("td label");null!==e&&(e.htmlFor=i.id)}}}const k=[{label:g.R.refresh30Seconds,value:"30"},{label:g.R.refresh45Seconds,value:"45"},{label:g.R.refresh60Seconds,value:"60"},{label:g.R.refresh90Seconds,value:"90"},{label:g.R.refreshDisable,value:"0"}];class A extends f.b{createElement(e){var t;return this.refreshThumbnailsSelect=new y.l6({choices:k,name:"refresh_frequency",defaultValue:(null!==(t=e.initial)&&void 0!==t?t:60).toString()}),(0,v.tT)("div",{className:"refresh"},(0,v.tT)("form",{id:"refresh_cams_form",action:"/ax/update_refresh_frequency/",method:"post"},(0,v.tT)("label",null,g.R.refreshThumbnailsEvery,":"),this.refreshThumbnailsSelect.getField()))}initUI(e){super.initUI(e);const t=this.element.querySelector("select");null!==t&&(t.id="id_refresh_frequency",t.dataset.testid="refresh-frequency-select",(0,h.ZM)(t,{marginTop:"4px"}))}}const M=[{label:g.R.northAmericaTitle,value:"NA"},{label:g.R.southAmericaTitle,value:"SA"},{label:g.R.asiaTitle,value:"AS"},{label:g.R.europeRussiaTitle,value:"ER"},{label:g.R.otherTitle,value:"O"}];class R extends f.b{createElement(e){const t={choices:M,name:"visible_regions",defaultValue:""!==e.initial?e.initial:"NA,SA,AS,ER,O",styles:new S};return this.checkboxes=new y.Ws(t),(0,v.tT)("div",{className:"filter_location checkboxes"},(0,v.tT)("label",null,g.R.visibleRegionsTag,":"),(0,v.tT)("form",{id:"filter_location_form",method:"post",action:"/ax/update_location_filters/"},this.checkboxes.getField()))}initUI(e){super.initUI(e),this.initCheckboxInputElements()}initCheckboxInputElements(){let e=0;this.element.querySelectorAll("input[type=checkbox]").forEach((t=>{t.id=`id_visible_regions_${e}`,t.closest("label[class=checkboxFieldLabel]").htmlFor=t.id,e+=1,t.autocomplete="off"}))}}var I=i(9461),E=i(7321),L=i(83);class D extends L.wx{createElement(e){return(0,v.tT)("div",{className:"mobile suggestionsDiv"})}initData(e){super.initData(e);const t=document.getElementById("mobile_advanced_options_container");t instanceof HTMLDivElement&&(t.dataset.testid="advanced-search-options-component",this.mobileAdvancedOptionsContainer=t)}hideSuggestions(){super.hideSuggestions(),(0,h.ZM)(this.mobileAdvancedOptionsContainer,{overflow:"hidden"})}showSuggestions(){super.showSuggestions(),(0,h.ZM)(this.mobileAdvancedOptionsContainer,{overflow:this.suggestionsList.length?"visible":"hidden"})}}var B=i(7995);class U extends B.D{initUI(e){super.initUI(e),this.element.classList.add("MobileSearchInput");const t=(0,v.tT)("button",{className:"submit",onClick:e=>{e.preventDefault(),this.onSubmitSearchInput()}},"search");this.form.appendChild(t),this.handleMobileSortDisplay(),(0,s.isMobileSpaShown)()&&s.UrlState.current.listen(s.ALL,(e=>{var t;const i=null!==(t=e.keywords)&&void 0!==t?t:"";this.input.value=i,this.styleInputDelete()}),this.element)}initSuggestions(){return(0,v.tT)(D,{classRef:e=>{this.suggestionsDiv=e},input:this.input,searchInput:this})}onSubmitSearchInput(){super.onSubmitSearchInput(),this.handleMobileSortDisplay()}handleMobileSortDisplay(){const e=document.querySelector("#mobile-sort-container");e&&(""!==this.searchKeywords?e.style.display="none":e.style.display="block")}}var _=i(9603);const F=new d.c_("showSearchingOverlay"),N=new d.c_("updateShowLocation");class O extends a.u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.isMobile=e,this.skipOverlays=t,this.isAnimThumbUnlocked=!1,this.showAnimateThumbnails=!1,this.regionsChanged=new d.c_("regionsChanged"),this.toggle=()=>{this.toggleShowHide(),(0,p.bT)("AdvancedSearchOptionsClicked")},this.bindAdvancedSearchRegion=()=>{const e=document.querySelectorAll(".advanced_search_region"),t=document.querySelector("#main");null!==t&&e.forEach((e=>{e.onclick=()=>{this.showElement(),(0,n.J8)().scrollTop>t.offsetTop&&t.scrollIntoView()}}))},this.setShowAnimateThumbnails=()=>{this.showAnimateThumbnails=null!==this.animateThumbnailsInput&&this.animateThumbnailsInput.checked};const i=document.querySelector("#advanced_search_options");if(null!==i){this.element=i,this.element.dataset.testid="advanced-search-options-component";const e=this.createAdvancedSearchForms(),t=i.firstElementChild;null!==t&&t.insertAdjacentElement("afterend",e)}this.bindAnimateThumbnailForm(),this.bindFilterLocationForm(),this.bindFilterOptionsForm(),this.bindAdvancedSearchRegion(),this.bindRefreshCamForm(),this.bindShowLocationOptionsForm(),this.bindSearchInput(),this.bindCloseButton(),this.bindOpenCloseButtons(),this.isAnimThumbUnlocked&&(0,E.Cx)(this.showAnimateThumbnails),F.listen((e=>{e?this.showSearchingOverlays():this.hideSearchingOverlays()}))}createAdvancedSearchForms(){const e=!I.Bm.current.loggedInUser||!I.Bm.current.loggedInUser.isSupporter;return(0,v.tT)("div",{className:"advance-search-element"},(s.UrlState.current.state.pageType!==s.PageType.HOME||!(0,u.rT)())&&(0,v.tT)(R,{initial:I.Bm.current.regions}),(0,v.tT)(P,{showLocation:I.Bm.current.showLocation,animateThumbnails:I.Bm.current.animateThumbnails,animateThumbnailsDisabled:e}),(0,v.tT)(A,{initial:I.Bm.current.refreshFrequency}))}setTooltipDisplayBehavior(e,t){e.onmouseover=()=>{e.style.display="block"};const i=e=>e.matches(":hover");e.onmouseout=()=>{window.setTimeout((()=>{i(e)||i(t)||(e.style.display="none")}),75)},t.onmouseover=()=>{e.style.display="block"},t.onmouseout=()=>{window.setTimeout((()=>{i(e)||i(t)||(e.style.display="none")}),75)}}createRoomAnimTooltip(e,t){t.style.cursor="default",t.style.opacity="0.5",e.style.cursor="default";const i=(0,_.q)({content:g.R.supporterToUseFeature(I.Bm.current.PurchaseEventSources.SUPPORTER_SOURCE_PREVIEW_ROOMS_UPSELL),hasHTML:!0,width:"auto",divotPosition:l.Wi.Top,divotLeftOrTop:"40px"}),s=i.querySelector("a");return null!==s&&(s.onclick=()=>{(0,p.bT)("SupporterPageOpened",{source:"AnimateRoomImagesTooltip"})}),(0,h.ZM)(i,{marginTop:"5px",marginLeft:"42px",borderStyle:"solid"}),this.setTooltipDisplayBehavior(i,t),e.readOnly=!0,e.onclick=()=>{},i}bindFilterLocationForm(){const e=document.querySelector("#filter_location_form");null!==e&&(e.onchange=()=>{this.onFilterFormChange(e)},e.querySelectorAll("input[type=checkbox]").forEach((t=>{(0,o.wu)("change",t,(()=>{const i=new FormData(e).getAll("visible_regions").join(",");this.regionsChanged.fire(i),(0,p.bT)("RoomsFilterRegionClicked",{region:t.value,checked:t.checked})}))})))}bindFilterOptionsForm(){const e=document.querySelector("#filter_options_form");null!==e&&(e.onchange=()=>{this.onFilterFormChange(e)})}bindAnimateThumbnailForm(){const e=document.querySelector("#animate_thumbnails_form");if(this.animateThumbnailsInput=document.querySelector("#id_animate_thumbnails"),null!==e&&null!==this.animateThumbnailsInput&&(this.animateThumbnailsInput.disabled||(this.isAnimThumbUnlocked=!0),this.showAnimateThumbnails=this.animateThumbnailsInput.checked,(0,o.wu)("change",this.animateThumbnailsInput,(()=>{this.isAnimThumbUnlocked&&this.onFilterFormChange(e)})),(this.isAnimThumbUnlocked?this.animateThumbnailsInput:e).onclick=e=>{var t;(0,p.bT)("AnimateRoomImagesClicked",{checked:null===(t=this.animateThumbnailsInput)||void 0===t?void 0:t.checked})},!this.isAnimThumbUnlocked)){const t=e.querySelector("label[for='id_animate_thumbnails']");if(null!==t){const i=this.createRoomAnimTooltip(this.animateThumbnailsInput,t);e.appendChild(i)}}}openOrCloseMenu(e){if((0,s.isMobileSpaShown)()){const t=document.querySelector("#mobile_advanced_options_link"),i=document.querySelector("#mobile_advanced_options_container");if(null!==t&&null!==i){const s=()=>{t.textContent="Options",i.classList.remove("opened"),i.classList.add("closed")},n=()=>{t.textContent="Hide Options",i.classList.add("opened"),i.classList.remove("closed")},o=()=>{i.classList.contains("opened")?s():n()};!0===e?n():!1===e?s():o()}}else void 0!==e?this.showOrHideElement(e):this.toggleShowHide()}bindOpenCloseButtons(){if((0,s.isMobileSpaShown)()){const e=document.querySelector("#mobile_advanced_options_link");null!==e&&(0,o.wu)("click",e,(e=>{e.preventDefault(),this.openOrCloseMenu()}))}else{const e=document.querySelector(".advanced_search_button");null!==e&&(e.dataset.testid="advanced-search-button",e.onclick=this.toggle)}}showSearchingOverlays(){clearTimeout(this.optionsUpdateTimeout),document.querySelectorAll(".searching-overlay").forEach((e=>{this.updateOverlayPosition(e),e.style.display="block"}))}hideSearchingOverlays(){const e=document.querySelectorAll(".searching-overlay");e.forEach((e=>{this.updateOverlayPosition(e)})),clearTimeout(this.optionsUpdateTimeout),this.optionsUpdateTimeout=window.setTimeout((()=>{e.forEach((e=>{e.style.display="none"}))}),300)}onFilterFormChange(e){this.setShowAnimateThumbnails(),this.skipOverlays||F.fire(!0),(0,r.KF)(e.action,new FormData(e)).then((()=>{this.isAnimThumbUnlocked&&(0,E.Cx)(this.showAnimateThumbnails),this.bindAdvancedSearchRegion(),E.HA.getInstance().loadRooms((()=>{this.skipOverlays||F.fire(!1)}))})).catch(m.h5)}getTargetedOverlayContainer(e){const t=e.nextElementSibling;if(null!==t){if("discover_root"===t.id)return t;{let e=t.querySelector(".list");return null===e&&(e=t.lastElementChild),null===e?void 0:e}}}updateOverlayPosition(e){const t=this.getTargetedOverlayContainer(e);if(void 0!==t){const i=t,s=i.getBoundingClientRect().width,n=i.getBoundingClientRect().height;e.style.height=`${n}px`,e.style.left=`${i.offsetLeft}px`,e.style.top=`${i.offsetTop}px`,e.style.right=document.documentElement.clientWidth-i.offsetLeft-s+"px",e.style.lineHeight=`${n}px`;const o=e.querySelector(".searching-overlay-spinner");null!==o&&(n<50?(o.classList.add("searching-overlay-spinner-very-small"),o.classList.remove("searching-overlay-spinner-small"),o.classList.remove("searching-overlay-spinner-medium")):n>=50&&n<200?(o.classList.remove("searching-overlay-spinner-very-small"),o.classList.add("searching-overlay-spinner-small"),o.classList.remove("searching-overlay-spinner-medium")):n>=200&&n<550?(o.classList.remove("searching-overlay-spinner-very-small"),o.classList.remove("searching-overlay-spinner-small"),o.classList.add("searching-overlay-spinner-medium")):(o.classList.remove("searching-overlay-spinner-very-small"),o.classList.remove("searching-overlay-spinner-small"),o.classList.remove("searching-overlay-spinner-medium")))}}bindRefreshCamForm(){const e=document.querySelector("#refresh_cams_form");null!==e&&(e.onchange=()=>{const t=e.querySelector("#id_refresh_frequency");if(null!==t){const i=parseInt(t.value);this.setShowAnimateThumbnails(),(0,r.KF)(e.action,new FormData(e)).then((()=>{(0,p.bT)("RefreshFrequencyChanged",{seconds:i}),this.isAnimThumbUnlocked&&(0,E.Cx)(this.showAnimateThumbnails),E.HA.scheduleImageRefresh(i),I.Db.setState({refreshFrequency:i})})).catch(m.h5)}})}showElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"block";super.showElement(e),this.element.classList.remove("collapsed"),void 0!==this.closeButton&&(this.closeButton.style.display="block")}hideElement(){super.hideElement(),this.element.classList.add("collapsed"),void 0!==this.closeButton&&(this.closeButton.style.display="none")}isShown(){return!this.element.classList.contains("collapsed")}bindSearchInput(){if(this.isMobile){const e=new U({}),t=document.getElementById("SearchInputEntry");null!==t&&t.appendChild(e.element)}const e=document.querySelector(".search_input"),t=document.querySelector("#search_icon"),i=document.querySelector(".suggestionsDiv");if(null!==e&&null!==t&&null!==i){const s=()=>{(0,p.bT)("RoomsFilterSearchClicked",{keyword:e.value})};[t,i].forEach((e=>{(0,o.wu)("click",e,(e=>{s()}),!0)})),[e,t,i].forEach((e=>{(0,o.wu)("keydown",e,(e=>{(0,c.Ci)(e)&&s()}),!0)}))}}bindCloseButton(){if(!this.isMobile){const e={position:"absolute",height:"12px",width:"14px",right:"17px",top:"25px",cursor:"pointer",display:"none"};this.closeButton=(0,v.tT)("img",{style:e,src:`${STATIC_URL}option_close.svg`,onClick:this.toggle}),this.element.appendChild(this.closeButton)}}bindShowLocationOptionsForm(){const e=document.querySelector("#id_show_location");null!==e&&(0,o.wu)("change",e,(()=>{(0,p.bT)("ShowLocationClicked",{checked:e.checked}),N.fire(e.checked)}))}}},7871:(e,t,i)=>{"use strict";i.d(t,{$q:()=>f,Ac:()=>g,L8:()=>p,Zw:()=>v,_e:()=>C,aL:()=>c,c2:()=>b,cR:()=>w,eH:()=>u,fy:()=>y,ld:()=>S,p6:()=>r});var s=i(4936),n=i(5216),o=i(3916);function r(e){return(0,n.Aw)(`api/public/asp/control/app/${e}/`).then((e=>function(e){const t=new s.N6(e);let i;if(void 0!==t.getAny("settingsValues")){const e=t.getMap("settingsValues");i={},e.keys().map((t=>{i[t]=e.getAny(t)}))}return{id:t.getString("id"),name:t.getString("name"),isPublic:t.getBoolean("isPublic",!1,!1),isInstalled:t.getBoolean("isInstalled",!1,!1),isActive:t.getBoolean("isActive",!1,!1),hasUpdate:t.getBoolean("hasUpdate",!1,!1),installed:void 0!==t.getAny("installed")?l(t.getMap("installed")):void 0,latest:l(t.getMap("latest")),settingsValues:i,permissionsValues:void 0!==t.getAny("permissionsValues")?a(t.getMap("permissionsValues")):void 0,reason:t.getStringOrUndefined("reason"),slot:t.getNumberOrUndefined("slot")}}(e.responseText)))}function a(e){return{videoPanel:e.getBoolean("videoPanel"),rewriteMessages:e.getBoolean("rewriteMessages"),tipOptions:e.getBoolean("tipOptions")}}function l(e){return{version:e.getString("version"),id:e.getString("id"),summary:e.getString("summary"),description:e.getString("description"),author:e.getString("author"),settings:h(e.getMap("settings")),permissions:d(e.getMap("permissions"))}}function h(e){const t={};return e.keys().map((i=>{t[i]=function(e){return{type:e.getString("type"),title:e.getStringOrUndefined("title",!1),description:e.getStringOrUndefined("description",!1),minimum:e.getNumberOrUndefined("minimum",!1),maximum:e.getNumberOrUndefined("maximum",!1),minLength:e.getNumberOrUndefined("minLength",!1),maxLength:e.getNumberOrUndefined("maxLength",!1),pattern:e.getStringOrUndefined("pattern",!1),default:e.getAny("default"),required:e.getBoolean("required",!1,!1),order:e.getNumberOrUndefined("order"),enum:e.getStringListOrUndefined("enum")}}(e.getMap(i))})),t}function d(e){function t(e){return{settings:e.getString("settings")}}return{videoPanel:t(e.getMap("videoPanel")),rewriteMessages:t(e.getMap("rewriteMessages")),tipOptions:t(e.getMap("tipOptions"))}}function c(e){return{appList:e.getStringList("order").map((e=>function(e){const t=new s.N6(e);return{id:t.getString("id"),name:t.getString("name"),panelType:t.getString("system")}}(e))),appName:e.getString("app_name",!1),template:e.getString("template",!1),layers:e.getList("layers"),url:e.getStringOrUndefined("url",!1),webcOrigin:e.getStringOrUndefined("webc_origin",!1),webcAuthToken:e.getStringOrUndefined("webc_auth_token"),error:e.getStringOrUndefined("error",!1)}}function u(e){const t=new FormData;for(const[i,s]of Object.entries(e))Array.isArray(s)?s.forEach((e=>{t.append(i,e)})):t.set(i,s);return(0,n.KF)("api/public/asp/control/applist/",t).then((e=>function(e){var t,i;const n=new s.N6(e);return{items:null!==(t=null===(i=n.getList("items"))||void 0===i?void 0:i.map((e=>{return{id:(t=e).getString("id"),name:t.getString("name"),isPublic:t.getBoolean("isPublic",!1,!1),isInstalled:t.getBoolean("isInstalled",!1,!1),isActive:t.getBoolean("isActive",!1,!1),hasUpdate:t.getBoolean("hasUpdate",!1,!1),author:t.getString("author"),summary:t.getString("summary"),latestVersion:t.getStringOrUndefined("latestVersion"),installedVersion:t.getStringOrUndefined("installedVersion"),permissionsValues:void 0!==t.getAny("permissionsValues")?a(t.getMap("permissionsValues")):void 0,reason:t.getStringOrUndefined("reason"),slot:t.getNumberOrUndefined("slot")};var t})))&&void 0!==t?t:[],limit:n.getNumber("limit"),offset:n.getNumber("offset"),total:n.getNumber("total")}}(e.responseText)))}function p(){return u({offset:"0",limit:"10",hasSlot:"1"})}let m;function g(e){return void 0===m&&(t=e,m=(0,n.Aw)(`api/public/asp/broadcast/applist/${t}/`).then((e=>{return t=e.responseText,{items:null!==(i=null===(n=new s.N6(t).getList("items"))||void 0===n?void 0:n.map((e=>{return{id:(t=e).getString("id"),name:t.getString("name"),slot:t.getNumber("slot")};var t})))&&void 0!==i?i:[]};var t,i,n}))),window.setTimeout((()=>{m=void 0}),1e3),m;var t}function v(){return u({isInstalled:"1",permissions:Object.values(o.y.EXCLUSIVE_PERMISSIONS)})}function f(e,t,i,s,o,r,a){(0,n.KF)(`api/public/asp/control/app/install/${e}/`,{settings:JSON.stringify(t),permissions:JSON.stringify(i),slot:s.toString(),replace_slot:o.toString()}).then((e=>{r()})).catch((e=>{a(e)}))}function y(e,t,i,s,o,r,a){(0,n.KF)(`api/public/asp/control/app/update/${e}/`,{settings:JSON.stringify(t),permissions:JSON.stringify(i),original_settings:JSON.stringify(s),original_permissions:JSON.stringify(o)}).then((e=>{r()})).catch((e=>{a(e)}))}function b(e,t,i,s,o,r){(0,n.KF)(`api/public/asp/control/app/upgrade/${e}/${t}/`,{settings:JSON.stringify(i),permissions:JSON.stringify(s)}).then((e=>{o()})).catch((e=>{r(e)}))}async function w(e,t){await(0,n.KF)(`api/public/asp/control/app/stop/${e}/`,{}).then((e=>{t()})).catch((e=>{error("Error stopping app",e)}))}async function C(e,t,i){await(0,n.KF)(`api/public/asp/control/app/uninstall/${e}/`,{delete_slot:t.toString()}).then((e=>{i()})).catch((e=>{error("Error removing app",e)}))}function S(e,t,i,o){let r=`api/public/asp/panel/${e}/`;const a=new URLSearchParams;return void 0!==i&&a.append("app_id",i),void 0!==o&&a.append("system",o),t&&a.append("bcp_fallback","1"),""!==a.toString()&&(r+=`?${a.toString()}`),(0,n.Aw)(r).then((e=>new s.N6(e.responseText)))}},2201:(e,t,i)=>{"use strict";i.d(t,{N:()=>s,m:()=>o});var s,n=i(5216);function o(e){return(0,n.Aw)(`api/ts/chat/room-access/${e}/`)}!function(e){e.AccessDenied="access-denied",e.Unauthorized="unauthorized",e.PasswordProtected="password-required",e.Ok="ok"}(s||(s={}))},8598:(e,t,i)=>{"use strict";i.d(t,{$:()=>o,t:()=>n});var s=i(5216);async function n(e){const t={room_user:e.roomUser,created_by:e.createdBy,banned_user:e.bannedUser,is_silence:e.isSilence.toString()};return(0,s.KF)("api/ts/chat/ban-id/",t).then((e=>JSON.parse(e.responseText).banid))}function o(e,t,i,n,o){(0,s.KF)("edit_room_ban/",{banid:String(e),action:t,room_username:i}).then((e=>{const t=e.responseText;if(null===t)return void o();let i;try{i=JSON.parse(t)}catch(e){return void o()}void 0===i.error?n():o()})).catch((()=>{o()}))}},3417:(e,t,i)=>{"use strict";i.d(t,{Bq:()=>d,Kw:()=>c,V6:()=>m,pi:()=>g,vu:()=>p,zS:()=>a});var s=i(5216),n=i(7407),o=i(9461),r=i(897);const a=2e3;let l,h=new Set;function d(e){return(0,s.KF)("api/ts/chat/ignored-users/",{username:e}).then((t=>{var i;return u(t.responseText),(0,n.bT)("IgnoreUser",{username:null===(i=o.Bm.current.loggedInUser)||void 0===i?void 0:i.username,to_user:e,list_size:m().size}),!0})).catch((e=>(error("Error posting ignore user",e),!1)))}function c(e){return(0,s.ju)("api/ts/chat/ignored-users/",{username:e}).then((()=>{var t;return h.delete(e),(0,n.bT)("UnignoreUser",{username:null===(t=o.Bm.current.loggedInUser)||void 0===t?void 0:t.username,to_user:e,list_size:m().size}),!0})).catch((e=>(error("Error posting unignore user",e),!1)))}function u(e){try{h=new Set(JSON.parse(e).users)}catch(e){error("Cannot parse ignore list",{reason:e.toString()})}}function p(){if((0,s.Aw)("api/ts/chat/ignored-users/").then((e=>{u(e.responseText)})).catch((e=>{error("Network error retrieving ignore list",e)})),void 0===l){var e;const t=null===(e=o.Bm.current.loggedInUser)||void 0===e?void 0:e.userUid;void 0!==t&&(l=new r.T_(t).onMessage.listen((e=>{var t;e.isIgnored?(t=e.username,h.add(t)):function(e){h.delete(e)}(e.username)})))}}function m(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&p(),h}function g(e){const t=m();return void 0===t?(error("ignoreSet should not be undefined"),!1):t.has(e)}},20:(e,t,i)=>{"use strict";i.d(t,{Cr:()=>y,F_:()=>M,M7:()=>k,O2:()=>T,SU:()=>f,Xw:()=>A,bi:()=>C,cb:()=>P,j:()=>g,j4:()=>b,lX:()=>v,mi:()=>w,ug:()=>I});var s=i(4936),n=i(213),o=i(5216),r=i(6844),a=i(438),l=i(8423),h=i(6440),d=i(7407),c=i(7569),u=i(4947),p=i(2945),m=i(9461);const g=50,v=new l.c_("createNewSession");function f(){return m.Bm.current.dmsEnabled}var y;function b(e){return{message:e.getString("m"),numUnread:e.getNumber("num_unread"),time:1e3*e.getNumber("created_at"),fromUsername:e.getString("from_user"),otherUser:(0,a.Rh)(new s.N6(e.getObject("other_user"))),hasMedia:e.getBoolean("has_media")}}function w(e){return{username:e,isBroadcaster:!0,inFanclub:!1,hasTokens:!1,isMod:!1,tippedRecently:!1,tippedALotRecently:!1,tippedTonsRecently:!1,exploringHashTag:"",sourceName:"df"}}function C(e){return{message:"",numUnread:0,fromUsername:e,hasMedia:!1,otherUser:w(e)}}function S(e){const t=e.getList("messages");return void 0===t?{messages:[],numUnread:0}:{messages:t.map((e=>(0,a.Y6)(e))),numUnread:e.getNumber("num_unread")}}!function(e){e.PM="PM",e.DM="DM"}(y||(y={}));const x=new Map;function T(e,t,i){if(void 0===i||(0,r.ok)())return Promise.resolve({messages:[],numUnread:0});const n=`${e}-${t}-${i}`;let a=x.get(n);if(void 0===a){const r=(0,p.Go)({offset:i,room:t});a=(0,o.Aw)(`api/ts/chatmessages/pm_list/${e}/?${r}`).then((e=>S(new s.N6(e.responseText)))),x.set(n,a),window.setTimeout((()=>{x.delete(n)}),100)}return a}function P(e,t){let i=(0,h.f)("RefactorDm")?`api/messaging/history/${e}/`:`api/ts/chatmessages/pm_history/${e}/`;return void 0!==t&&(i+=`?${(0,p.Go)({offset:t})}`),(0,o.Aw)(i).then((e=>S(new s.N6(e.responseText))))}function k(e,t,i){return new Promise(((s,n)=>{T(e,t,null!=i?i:"0").then((e=>{if(e.numUnread<=0)return s([]);const t=e.messages.slice(-e.numUnread);return s(t)})).catch((e=>{n(e)}))}))}const A=["roomviewPM","mobilePM","mobile","DM"];async function M(e){if(c.fM.isShortcodeSyntax(e.message)){const t={username:e.username,errorMessage:"DM"===e.source?u.R.shortcodeNotSupportedInDMs:u.R.shortcodeNotSupportedInPMs,showDmLink:!1};return Promise.reject(t)}if(void 0===m.Bm.current.loggedInUser)return error("Sending private message as anon"),Promise.reject(u.R.loggedInForFeature);if(m.Bm.current.isNoninteractiveUser)return(0,n.Q$)(u.R.internalStaffMessage),Promise.reject({username:e.username,errorMessage:u.R.internalStaffMessage,showDmLink:!1});const{username:t,source:i,roomName:r=""}=e,a=m.Aw.getState().privateShowId,l=new FormData,p=function(e){const t={m:e.message};return void 0!==e.media&&(t.media_id=e.media.map((e=>e.mediaId))),JSON.stringify(t)}(e);l.append("room",r),l.append("to_user",t),l.append("from_user",m.Bm.current.loggedInUser.username),l.append("message",p),""!==a&&l.append("private_show_id",a);const g=(0,h.f)("RefactorDm")&&""===r?"api/messaging/publish/":"api/ts/chatmessages/pm_publish/";return(0,o.KF)(g,l).then((e=>{const n=new s.N6(e.responseText),o={username:t,source:i,is_reply:n.getBoolean("is_reply"),token_color:n.getStringOrUndefined("token_color"),in_fanclub:n.getBoolean("in_fanclub",void 0,!1),success:"Ok"===n.getString("status")};(0,d.bT)("SendPrivateMessage",o);const r=n.getStringOrUndefined("status",!1);if("Ok"!==r){const e={username:t,errorMessage:null!=r?r:u.R.errorSendingMessage,showDmLink:n.getBoolean("show_sitewide_pm_link",!1,!1)};return Promise.reject(e)}return Promise.resolve()})).catch((e=>{if(error("Could not send private message: ",e),e instanceof o.fr){const t=new s.N6(e.xhr.responseText).getStringOrUndefined("error");return void 0!==t?Promise.reject({errorMessage:t,isOfflineUserError:!1}):Promise.reject({errorMessage:u.R.errorSendingMessage,isOfflineUserError:!1})}return Promise.reject(e)}))}const R=new Map;function I(e,t){let i="";void 0!==t&&""!==t&&(i=`?${(0,p.Go)({room:t})}`);const n=(0,h.f)("RefactorDm")&&""===i?`api/messaging/profile/${e}/`:`api/ts/chatmessages/user_info/${e}/${i}`;if(R.has(n))return R.get(n);const r=(0,o.Aw)(n).then((i=>{const o={numUnread:null!==(l=(r=new s.N6(i.responseText)).getNumberOrUndefined("num_unread",!1))&&void 0!==l?l:0,canPm:r.getBoolean("can_pm"),canTip:r.getBoolean("can_tip"),user:(0,a.Rh)(new s.N6(r.getObject("user"))),sitewideUser:(0,a.Rh)(new s.N6(r.getObject("sitewide_user")))};var r,l;const h=void 0===t,d=m.Aw.getState().room;return h&&""!==d&&e===d&&(o.user.isBroadcaster=!0),window.setTimeout((()=>{R.delete(n)}),2500),o})).catch((i=>{throw error("Error getting user info",{user:e,room:t,error:i.toString()}),R.delete(n),i}));return R.set(n,r),r}},6318:(e,t,i)=>{"use strict";i.d(t,{C0:()=>d,IM:()=>f,bs:()=>h,f1:()=>p,nu:()=>v,sc:()=>u,vI:()=>l,wy:()=>y,xV:()=>a});var s=i(5216),n=i(1519),o=i(8423),r=i(9510);const a=new o.c_("pmMediaDrop",{listenersWarningThreshold:()=>o.hI}),l=new o.c_("pmMediaUpload",{listenersWarningThreshold:()=>o.hI}),h=new o.c_("pmMediaDeleted",{listenersWarningThreshold:()=>2+2*o.hI}),d=new o.c_("pmMediaRejected",{listenersWarningThreshold:()=>2+2*o.hI}),c=52428800;function u(e,t){let i;if(e.size>c)i=Promise.reject("file_too_large");else{const t=new FormData;t.append("media",e),i=(0,s.KF)("api/ts/chatmessages/media/upload/",t).then((e=>{const t=JSON.parse(e.responseText).payload;return{mediaId:t.media_id,url:t.media_url,thumbnailUrl:t.media_thumbnail_url,opened:!1,fromUserUID:t.user_uid}}))}return l.fire({toUser:t,promise:i}),i}function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.V5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,s.Aw)(`api/ts/chatmessages/media/?media_type=I&limit=${e}&offset=${t}`).then((e=>{const t=[],i=JSON.parse(e.responseText).media;for(const e of i)t.push({mediaId:e.media_id,url:e.media_url,thumbnailUrl:e.media_thumbnail_url,opened:!1,fromUserUID:e.user_uid});return t.sort(((e,t)=>Number(t.mediaId)-Number(e.mediaId))),t}))}let m;const g=new n.a((()=>{m=p()}),{bounceLimitMS:10,debounceType:0});function v(){return g.callFunc(),m}function f(e){return(0,s.KF)("api/ts/chatmessages/media/delete/",{media_id:e.toString()}).then((t=>200===t.status?(h.fire(e),Promise.resolve()):Promise.reject())).catch((e=>Promise.reject()))}function y(e,t,i){const n=new FormData;return n.append("from_user_uid",e),n.append("message_id",t),n.append("media_id",i.toString()),(0,s.KF)("api/ts/chatmessages/media/opened/",n).then((e=>204===e.status)).catch((()=>!1))}},8377:(e,t,i)=>{"use strict";i.d(t,{n:()=>o});var s=i(5216),n=i(1650);function o(e){return new Promise(((t,i)=>{(0,s.KF)("api/ts/accounts/editsubgender/",e).then((()=>{t(e.get("subgender")),"function"==typeof window[n.J9]&&window[n.J9]()})).catch((()=>{i()}))}))}},1474:(e,t,i)=>{"use strict";i.d(t,{D:()=>d,ae:()=>g,ew:()=>h,kb:()=>p,xj:()=>c});var s=i(352),n=i(4936),o=i(5216),r=i(8423),a=i(3049),l=i(9461);const h=new r.c_("tipsInPast24HoursUpdate"),d=new r.c_("tokenBalanceUpdate"),c=6;function u(e){const t=[];for(const i of JSON.parse(e)){const e=new n.N6(JSON.stringify(i));t.push({label:e.getAsString("label")}),e.logUnusedDebugging("parseOptions")}return t}function p(e){return new Promise(((t,i)=>{(0,o.Aw)(`tipping/current_tokens/?room=${e}`).then((e=>{const i=function(e){const t=new n.N6(e),i={tokenBalance:t.getNumber("token_balance")},s=t.getStringOrUndefined("tip_options");return void 0!==s&&(i.tipOptions=function(e){let t=new n.N6(e);const i=t.getObjectStringOrUndefined("tip_options");if(void 0===i)return;t=new n.N6(i);const s={label:t.getAsString("label"),options:u(t.getObjectString("options"))};return t.logUnusedDebugging("parseTipOptions"),s}(s)),t.logUnusedDebugging("parseCurrentTokensResponse"),i}(e.responseText);d.fire({tokens:i.tokenBalance}),t(i)})).catch((e=>{i(e.status)}))}))}let m=!1;function g(e){return new Promise(((t,i)=>{var r,h;m||((0,a.kt)()&&(0,s.trackCustomEvent)({name:"SendTip",data:{roomName:e.roomName,tipAmount:e.tipAmount,message:e.message,source:e.source,tipRoomType:e.tipRoomType,tipType:e.tipType,videoMode:e.videoMode}}),m=!0,(0,o.KF)(`tipping/send_tip/${e.roomName}/`,{tip_amount:e.tipAmount,message:e.message,source:e.source,tip_room_type:e.tipRoomType,tip_type:e.tipType,video_mode:e.videoMode,from_username:null!==(r=null===(h=l.Bm.current.loggedInUser)||void 0===h?void 0:h.username)&&void 0!==r?r:""}).then((e=>{m=!1;const i=function(e){const t=new n.N6(e),i={success:t.getBoolean("success")},s=t.getStringOrUndefined("error",!1);return void 0!==s?(i.error=s,i.showPurchaseLink=t.getBoolean("show_purchase_tokens",!1,!1)):(i.tokenBalance=t.getNumber("token_balance"),i.tipsInPast24Hours=t.getNumber("tipped_performer_last_24hrs")),t.logUnusedDebugging("parseSendTipResponse"),i}(e.responseText);void 0!==i.tokenBalance&&d.fire({tokens:i.tokenBalance}),t(i)})).catch((e=>{m=!1,i(e.xhr.status)})))}))}},9945:(e,t,i)=>{"use strict";i.d(t,{ak:()=>E,W2:()=>U,CO:()=>z,SF:()=>V,BT:()=>$});var s=i(7623),n=i(2758),o=i(8377),r=i(394),a=i(6784),l=i(213),h=i(2028),d=i(2922);class c{constructor(e){this.algorithm=2,this.level=0,void 0!==e&&(this.algorithm=e)}avgAlgorithm(e){const t=e.reduce(((e,t)=>e+t*t));this.level=Math.sqrt(t/e.length)}maxAlgorithm(e){let t=Number.MIN_SAFE_INTEGER;e.map((e=>(e>t&&(t=e),e))),0===e.length||t<0?t=0:t>1?t=1:this.level=t}connect(e){this.level=0,(0,s.o)()&&("webkitAudioContext"in window?this.context=new webkitAudioContext:this.context=new AudioContext,this.script=this.context.createScriptProcessor(2048,1,1),this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),this.script.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0);1===this.algorithm?this.avgAlgorithm(t):2===this.algorithm?this.maxAlgorithm(t):error("invalid algorithm choice",this.algorithm)})}stop(){return(0,s.o)()?(this.mic.disconnect(),this.script.disconnect(),this.context.close()):Promise.resolve()}}var u=i(4548),p=i(2709),m=i(3955),g=i(1779),v=i(7882),f=i(3124),y=i(7407),b=i(34),w=i(1452),C=i(4947),S=i(3860),x=i(1673),T=i(9447),P=i(5901),k=i(9937),A=i(9461);const M="we-only-need-a-silent-mic",R="382px",I=["public","private","hidden","away","connecting"],E="broadcast_muted",L="selected_mic",D="selected_cam",B="selected_res",U={days:60};function _(e){const t=document.createElement("div");return t.style.paddingLeft="10px",t.style.paddingTop="3px",t.style.fontSize="20px",t.textContent=e,t}function F(e){const t=_(e);return t.style.paddingTop="10px",t.style.fontFamily="UbuntuRegular",t.style.fontSize="15px",t}function N(){const e=document.createElement("select");return(0,T.fZ)(e,"select"),e.style.width="177px",e.style.height="20px",e.style.marginLeft="10px",e.style.marginTop="10px",e.style.fontFamily="UbuntuRegular",e.style.fontSize="12px",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.overflow="hidden",e}function O(){const e=document.createElement("video");return e.autoplay=!0,e.muted=!0,e.setAttribute("playsinline",""),e.oncontextmenu=e=>{e.preventDefault()},e}class H{constructor(){this.broadcasting=!1,this.stopPromise=void 0}setup(e,t,i){const n={video:{deviceId:{exact:i.camId},width:{ideal:i.width}},frameRate:{min:24,max:30}};return(0,s.Xb)()?n.aspectRatio=1.777777778:n.video.height={ideal:i.height},i.micId!==M&&(n.audio={deviceId:{exact:i.micId}},n.audio.advanced=[{autoGainControl:!0},{noiseSuppression:!0}],(0,s.H8)()&&(n.audio.advanced.push({googEchoCancellation:!0}),n.audio.advanced.push({googExperimentalEchoCancellation:!0}),n.audio.advanced.push({googHighpassFilter:!0}))),this.handler=new u.Y9(t,e,"desktop"),this.uuid=this.handler.uuid,new Promise(((e,t)=>{void 0!==this.handler&&this.handler.setup(n).then((t=>{this.stream=t,void 0!==this.handler&&this.handler.setMute(i.muted),e()})).catch((e=>{t(e)}))}))}stop(){return void 0===this.stopPromise&&(this.stopPromise=new Promise((e=>{const t=()=>{this.handler=void 0,this.stream=void 0,this.broadcasting=!1,e()};void 0!==this.handler?this.handler.stop().then((e=>{this.uuid===e&&t()})).catch(w.yZ):t()}))),this.stopPromise}start(){return this.broadcasting=!1,void 0!==this.handler?(0,f.FW)()&&(0,f.K$)()?Promise.reject(new Error(C.R.turnDeviceLandscape)):new Promise(((e,t)=>{if(void 0!==this.handler){let i=!1;const s=t=>{void 0!==t&&t!==this.uuid||!1===i&&(this.broadcasting=!0,i=!0,u.ni.removeListener(n),e())},n=e=>{s(e)};u.ni.listen(n),this.handler.start().then((()=>{s()})).catch((e=>{!0===e.fatal&&(u.ni.removeListener(n),t(e))}))}})):Promise.resolve()}streaming(){return void 0!==this.handler}setMute(e){return void 0!==this.handler&&void 0!==this.stream&&(this.handler.setMute(e),!0)}}class W extends p.u{constructor(e,t,i,s){super(),this.videoWidth=268,this.videoRatio=16/9,this.dossier=e,this.user=s,this.config=i,this.constraints=t,this.helpOverlay=this.createHelpOverlay(),this.createPreviewPanel()}start(){const e=()=>{if(void 0!==this.streamer){(0,P.Rz)((()=>this.setStartButtonDisabled(!1)));const e=Math.floor(this.videoWidth/this.videoRatio);this.video.style.height=`${e}px`,this.startMeter()}};this.stop().then((()=>{this.streamer=new H,this.streamer.setup(this.video,this.dossier,this.constraints).then(e).catch((t=>{(0,s.H8)()&&(0,s.hj)()&&"Could not start video source"===t.message?e():(0,l.Q$)(`${C.R.couldNotSetupPreview}:\n${t.message}`)}))})).catch(w.yZ)}stop(){return this.setStartButtonDisabled(!0),this.stopMeter().then((()=>void 0!==this.streamer?this.streamer.stop():Promise.resolve()))}stopMeter(){return new Promise((e=>{void 0!==this.volumeRange&&(this.volumeRange.style.width="0%"),void 0!==this.volumeMeter?this.volumeMeter.stop().then((()=>{clearInterval(this.volumeMeterInterval),this.volumeMeter=void 0,e()})).catch(w.yZ):e()}))}startMeter(){this.stopMeter().then((()=>{(0,s.o)()&&void 0!==this.streamer&&void 0!==this.streamer.stream&&this.streamer.stream.getAudioTracks().length>0&&(this.volumeMeter=new c,this.volumeMeter.connect(this.streamer.stream),this.volumeMeterInterval=window.setInterval((()=>{if(void 0!==this.volumeMeter&&void 0!==this.volumeRange){const e=100*this.volumeMeter.level;this.volumeRange.style.width=`${e}%`}})))})).catch(w.yZ)}updateResolution(e){const t=this.devices.cams.get(this.constraints.camId);if(void 0!==t){const i=t.resolutions.get(e.value);void 0!==i&&(this.constraints.width=i.width,this.constraints.height=i.height,this.videoRatio=i.ratio,void 0!==this.hdLabel&&(i.isHD?this.hdLabel.style.visibility="visible":this.hdLabel.style.visibility="hidden"),this.start())}}updateResolutions(){const e=this.devices.cams.get(this.constraints.camId);if(void 0!==e){for(let e=this.resSelect.options.length-1;e>=0;e-=1)this.resSelect.removeChild(this.resSelect.options[e]);const t=(0,n.y1)(B);let i=0,o=-1;const r=(0,s.Pb)();e.resolutions.forEach((e=>{if(!r||960!==e.width){const s=document.createElement("option");s.label=e.label,s.text=e.label,s.value=e.id,this.resSelect.add(s),s.value===t&&(o=i),i+=1}})),-1===o&&(o=Math.floor(this.resSelect.options.length/2));const a=this.resSelect.options[o];a.selected=!0,this.updateResolution(a)}}onCamChange(){const e=this.camSelect.selectedIndex;if(e>=0){const t=this.camSelect.options[e];this.constraints.camId=t.value,(0,n.aR)(D,t.value,U),window.localStorage.removeItem(B),this.updateResolutions()}}onResChange(){const e=this.resSelect.selectedIndex;if(e>=0){const t=this.resSelect.options[e];(0,n.aR)(B,t.value,U),this.updateResolution(t)}}createPreviewPanel(){(0,T.fZ)(this.element,"previewPanel"),this.element.style.height=R,this.element.style.width="488px",this.element.style.paddingLeft="5px",this.element.appendChild(this.createTitle()),this.element.appendChild(this.createMediaSettingsPanel()),this.element.appendChild(this.createVideoPanel())}createTitle(){const e=document.createElement("div");(0,T.fZ)(e,"welcomeTitle"),e.dataset.testid="preview-title",e.style.width="100%",e.style.height="32px";const t=document.createElement("span");return t.style.paddingLeft="10px",t.style.verticalAlign="sub",t.style.lineHeight="32px",t.textContent=`${C.R.welcomeBack}, ${this.dossier.room}`,e.appendChild(t),e}createMediaSettingsPanel(){const e=document.createElement("div");return e.style.width="198px",e.style.cssFloat="left",e.style.height="318px",e.style.padding="10px 0 10px 0",e.appendChild(this.createCamSettingsPanel()),e.appendChild(this.createMicSettingsPanel()),(0,h.Nn)().then((e=>{e?this.getUserMedia():(this.setStartButtonDisabled(!0),this.showHelpOverlay())})).catch((()=>{this.getUserMedia()})),e}getUserMedia(){this.hideHelpOverlay(),(0,h.s9)(!1).then((e=>{if(this.setStartButtonDisabled(!1),this.devices=e,e.mics.size>0&&void 0!==this.micSelect){const t=document.createElement("option");t.label=C.R.noMicrophone,t.text=t.label,t.value=M,this.micSelect.add(t);const i=(0,n.y1)(L);let s=1,o=1;t.value===i&&(o=0),e.mics.forEach((e=>{const t=document.createElement("option");t.label=e.label,t.text=e.label,t.value=e.id,void 0!==this.micSelect&&this.micSelect.add(t),t.value===i&&(o=s),s+=1}));const r=this.micSelect.options[o];r.selected=!0,this.constraints.micId=r.value}if(e.cams.size>0){const t=(0,n.y1)(D);let i=0,s=0;e.cams.forEach((e=>{const n=document.createElement("option");n.label=e.label,n.text=e.label,n.value=e.id,this.camSelect.add(n),n.value===t&&(s=i),i+=1}));const o=this.camSelect.options[s];o.selected=!0,this.constraints.camId=o.value,this.updateResolutions()}})).catch((e=>{this.setStartButtonDisabled(!0);let t="",i="";null!==e.message&&void 0!==e.message?t="OverconstrainedError"===e.name||"NotFoundError"===e.name||"DevicesNotFoundError"===e.name?C.R.noCameraFound:"PermissionDeniedError"===e.name||"NotAllowedError"===e.name?C.R.camAndMicPermissionDenied:"NotReadableError"===e.name?`${e.message}. ${C.R.noOtherTabsOpen}`:e.message:null!==e.name&&void 0!==e.name&&(t=e.name),""!==t&&(i=". "),this.showHelpOverlay(`${C.R.couldNotGetDevices}${i}${t}`)}))}hideHelpOverlay(){for(const e of[this.camSelect,this.resSelect,this.micSelect])void 0!==e&&(e.disabled=!1);this.helpOverlay.style.display="none"}showHelpOverlay(e){void 0!==e&&(W.permissionsErrorString=e),void 0!==W.permissionsErrorString?(this.permissionsErrorSpan.textContent=W.permissionsErrorString,this.permissionsErrorSpan.style.display="",this.requestDevicesButton.style.display="none"):(this.permissionsErrorSpan.style.display="none",this.requestDevicesButton.style.display="");for(const e of[this.camSelect,this.resSelect,this.micSelect])void 0!==e&&(e.disabled=!0);this.helpOverlay.style.display=""}createHelpOverlay(){const e=document.createElement("div");(0,T.fZ)(e,"helpOverlay"),e.style.fontSize="14px",e.style.fontFamily="UbuntuRegular",e.style.display="none",e.style.width="304px",e.style.fontWeight="bold",e.style.borderRadius="6px",e.style.textAlign="center",e.style.padding="8px",e.style.position="absolute",e.style.top="25%",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.zIndex="1",e.style.borderWidth="2px",e.style.borderStyle="solid";const t=document.createElement("div");t.style.marginBottom="16px",(0,s.gm)()?(t.textContent=C.R.camAndMicPermissionPromptFF,indexedDB.open("test").onerror=()=>{this.showHelpOverlay(C.R.privateBrowsingMessage)}):t.textContent=C.R.camAndMicPermissionPrompt,e.appendChild(t),this.permissionsErrorSpan=document.createElement("div"),(0,T.fZ)(this.permissionsErrorSpan,"error"),this.permissionsErrorSpan.style.display="none",e.appendChild(this.permissionsErrorSpan),this.requestDevicesButton=document.createElement("button"),this.requestDevicesButton.style.width="268px",this.requestDevicesButton.style.padding="7px 6px",this.requestDevicesButton.style.margin="auto",this.requestDevicesButton.style.fontWeight="normal",this.requestDevicesButton.style.fontSize="14px",this.requestDevicesButton.style.fontFamily="UbuntuRegular",this.requestDevicesButton.style.cursor="pointer",this.requestDevicesButton.innerText=C.R.requestDevicePermissions,this.requestDevicesButton.onclick=()=>{"fullscreen"===S.L.getVideoMode()&&(0,s.Pb)()&&!A.Bm.current.isMobile&&(0,g.Eh)(),this.getUserMedia()},e.appendChild(this.requestDevicesButton);const i=document.createElement("div");i.style.marginTop="16px",i.innerHTML=C.R.camAndMicPermissionSupportInfo();const n=i.querySelector("#camAndMicInfoLink");return null!==n&&(n.onclick=()=>(0,y.bT)("DevicePermsInfoLinkClicked")),e.appendChild(i),this.element.appendChild(e),e}createCamSettingsPanel(){const e=document.createElement("div");(0,T.fZ)(e,"settingsPanel"),e.style.width="100%",e.style.height="158px",e.style.marginBottom="5px",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.boxSizing="border-box";const t=_(C.R.cameraLabel);t.style.lineHeight="28px",t.style.paddingTop="8px",t.dataset.testid="camera-label",e.appendChild(t);const i=N();i.style.marginTop="8px",i.style.height="32px",i.dataset.testid="camera-selection",e.appendChild(i);const s=F(C.R.resolutionLabel);s.style.marginTop="16px",s.style.fontSize="12px",s.style.paddingTop="0",s.dataset.testid="resolution-label",e.appendChild(s);const n=N();return n.style.marginTop="5px",n.style.height="32px",n.dataset.testid="resolution-selection",e.appendChild(n),i.onchange=()=>{this.onCamChange()},n.onchange=()=>{this.onResChange()},this.camSelect=i,this.resSelect=n,e}createMicSettingsPanel(){const e=document.createElement("div");(0,T.fZ)(e,"settingsPanel"),e.style.width="100%",e.style.height="162px",e.style.paddingTop="8px",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.boxSizing="border-box";const t=_(C.R.microphoneLabel);t.style.lineHeight="28px",e.appendChild(t);const i=N();e.appendChild(i),i.style.marginTop="8px",i.style.height="32px",i.dataset.testid="microphone-selection",i.onchange=()=>{const e=i.selectedIndex;if(e>=0){const t=i.options[e];this.constraints.micId=t.value,(0,n.aR)(L,t.value,U),this.start()}};const o=(0,s.o)();if(o){const t=document.createElement("div"),i=F(`${C.R.inputLevelLabel}:`);i.style.paddingTop="16px",i.style.paddingLeft="8px",i.style.display="inline-block",t.appendChild(i);const s=document.createElement("div");(0,T.fZ)(s,"inputLevelBar"),s.style.width="82px",s.style.margin="23px 8px 0 10px",s.style.borderWidth="1px",s.style.borderStyle="solid",s.style.display="inline-block",s.style.height="7px",s.dataset.testid="audio-level-bar";const n=document.createElement("div");n.style.width="78px",n.style.height="7px",n.style.width="0%",n.style.backgroundColor="lightgreen",this.volumeRange=n,s.appendChild(n),t.appendChild(s),e.appendChild(t),this.tuneLabelFontSizeWithinSettingsPanel(i)}const r=document.createElement("div"),a=new k.m(16,!1,(()=>{const e=!this.constraints.muted;h(e)&&(this.constraints.muted=e)}));a.setCheckboxValue("Mute"),a.setCheckboxId("mutebox-input"),a.element.id="mutebox",a.element.style.marginTop="8px",a.element.style.marginLeft="8px",a.element.dataset.testid="mute-box",a.disable();const l=window.setInterval((()=>{h(this.constraints.muted)&&(a.enable(),clearInterval(l))}),200);r.appendChild(a.element);const h=e=>void 0!==this.streamer&&!!this.streamer.setMute(e)&&(e?a.setCheckedDirectly(!0):a.setCheckedDirectly(!1),(0,n.aR)(E,String(e),U),!0),d=document.createElement("label");return d.textContent=C.R.muteLabel,d.htmlFor="mutebox-input",d.style.paddingLeft="5px",d.style.transform="translateY(-4px)",d.style.fontFamily="UbuntuRegular",d.style.fontSize="14px",d.style.display="inline-block",d.style.lineHeight="22px",r.appendChild(d),o||(a.element.style.marginTop="100px",d.style.marginTop="70px"),e.appendChild(r),this.micSelect=i,e}tuneLabelFontSizeWithinSettingsPanel(e){let t=16;const i=85-((0,s.nr)()?8:0);for(;(0,m.jl)(`${C.R.inputLevelLabel}:`,`${t}px UbuntuRegular`)>i&&t>1;)t-=1;e.style.fontSize=`${t}px`}createVideoPanel(){const e=document.createElement("div");e.style.width="289px",e.style.cssFloat="left",e.style.height="318px",e.style.padding="10px 0 10px 0",e.dataset.testid="preview-video-panel";const t=O();t.style.width=`${this.videoWidth}px`,t.style.height="150px",t.style.marginLeft="10px",t.style.marginRight="10px",e.appendChild(t),this.video=t;const i=document.createElement("div");(0,T.fZ)(i,"hdLabel"),i.style.fontSize="24px",i.style.fontFamily="UbuntuBold",i.style.marginLeft="10px",i.style.marginTop="10px",i.textContent="HD",i.style.visibility="hidden",this.hdLabel=i,e.appendChild(i),e.appendChild(this.createStartButton());const s=F(`${C.R.highQualityStream}:`);s.style.fontSize="11px",s.style.paddingLeft="0",s.style.paddingTop="5px",s.style.textAlign="center",e.appendChild(s);const n=document.createElement("div");n.style.textAlign="center";const o=document.createElement("a");return(0,T.fZ)(o,T.aG.hrefColor),o.style.fontSize="12px",o.text=C.R.useOBS,o.style.cursor="pointer",o.dataset.testid="obs-link",n.appendChild(o),e.appendChild(n),o.onclick=()=>{this.config.onOBSClick()},e}createStartButton(){const e=document.createElement("div");e.style.textAlign="center";const t=document.createElement("button");if((0,T.fZ)(t,"startButton"),t.style.marginTop="75px",t.style.width="268px",t.style.height="32px",t.style.fontWeight="normal",t.style.fontSize="14px",t.textContent=C.R.startBroadcasting,t.style.fontFamily="UbuntuBold",t.style.cursor="pointer",e.appendChild(t),t.onclick=()=>{if(this.user)if(this.user.gender===v.YT.OldTrans&&void 0===this.user.subgender){const e=new r.k,t={acceptText:C.R.subgenderSelectionConfirm,separator:!1,allowDecline:!1,orange:!0};(0,l.SI)(e.element,(()=>{(0,o.n)(new FormData(e.element)).then((e=>{this.user&&(this.user.subgender=e),this.startBroadcast()})).catch(w.yZ)}),void 0,void 0,t,!0)}else this.startBroadcast()},this.startButton=t,this.setStartButtonDisabled(!0),(0,s.gm)()){const e=F(`${C.R.firefoxWarning}`);(0,m.ZM)(e,{fontSize:"11px",paddingLeft:"5px",textAlign:"center"}),t.before(e),t.style.marginTop="15px"}return e}setStartButtonDisabled(e){this.startButton.disabled=e,this.startButton.style.opacity=e?".5":"1",this.startButton.style.cursor=e?"default":"pointer"}startBroadcast(){(0,d.w)((()=>{(0,P.Yc)().then((e=>{""!==e?((0,l.Q$)(C.R.showMyCamCurrentlySharing(e)),this.setStartButtonDisabled(!0),(0,P.Rz)((()=>{this.setStartButtonDisabled(!1)}))):this.stop().then((()=>{this.config.onStartBroadcast()})).catch(w.yZ)})).catch(w.yZ)}))}}class $ extends W{constructor(e,t,i){super(e,t,i)}stop(){return super.stop()}start(){super.start()}createPreviewPanel(){this.element.style.width="402px",this.element.style.backgroundColor="transparent",this.element.style.position="relative",this.element.appendChild(this.createTitle()),this.element.appendChild(this.createClose()),this.element.appendChild(this.createVideoPanel()),this.element.appendChild(this.createInfoPanel()),this.element.appendChild(this.createMediaSettingsPanel()),this.element.appendChild(this.createStartButton())}createTitle(){const e=document.createElement("div");e.style.width="200px",e.style.height="26px",e.style.display="inline-block";const t=document.createElement("div");return(0,T.fZ)(t,"title"),t.style.fontFamily="UbuntuBold",t.style.fontSize="18px",t.textContent=this.config.title,t.dataset.testid="preview-title",e.appendChild(t),e}createClose(){const e=document.createElement("div");e.style.display="inline-block",e.style.position="relative",e.style.right="-1px",e.style.width=e.style.height="17px",e.style.cssFloat="right",e.style.cursor="pointer",e.dataset.testid="cam-to-cam-preview-close-button",e.onclick=this.config.onClose;const t=document.createElement("img");return t.src=`${STATIC_URL_ROOT}tsdefaultassets/close-gray.svg`,t.style.width=t.style.height="100%",e.appendChild(t),e}createVideoPanel(){this.videoWidth=400;const e=document.createElement("div");e.style.textAlign="center",e.dataset.testid="preview-video-panel";const t=O();return t.style.width=`${this.videoWidth}px`,t.style.height=this.videoWidth/this.videoRatio+"px",e.appendChild(t),this.video=t,e}createInfoPanel(){const e=document.createElement("div");(0,T.fZ)(e,"infoPanel"),e.style.marginTop="6px",e.style.padding="6px 5px 9px 4px",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.boxSizing="border-box",e.dataset.testid="cam-to-cam-preview-info-panel";const t=()=>{const e=document.createElement("div");return e.style.fontFamily="UbuntuRegular",e.style.fontStyle="normal",e.style.fontWeight="bold",e.style.fontSize="12px",e.style.lineHeight="14px",e.style.textAlign="center",e},i=this.config.infoText;let s;for(s of i){const i=t();i.textContent=s,e.appendChild(i)}return e}createMediaSettingsPanel(){const e=super.createMediaSettingsPanel();return e.style.width="100%",e.style.height="auto",e.style.padding="9px 0px 0px 0px",e.style.cssFloat="",e}createHelpOverlay(){const e=super.createHelpOverlay();return e.style.top="11%",e}createCamSettingsPanel(){const e=document.createElement("div");(0,T.fZ)(e,"settingsPanel"),e.style.width="100%",e.style.height="68px",e.style.paddingTop="5px",e.style.borderWidth="2px",e.style.borderStyle="solid",e.style.boxSizing="border-box";const t=document.createElement("div");t.style.display="inline-block";const i=this.createMediaSettingLabel(C.R.cameraLabel);i.dataset.testid="camera-label";const s=N();s.style.marginLeft="8px",s.style.marginTop="8px",t.appendChild(i),t.appendChild(s);const n=document.createElement("div");n.style.display="inline-block",n.style.paddingLeft="16px";const o=this.createMediaSettingLabel(C.R.resolutionLabel);o.style.paddingLeft="10px",o.dataset.testid="resolution-label";const r=N();return r.style.marginTop="8px",n.appendChild(o),n.appendChild(r),e.appendChild(t),e.appendChild(n),s.onchange=()=>{this.onCamChange()},r.onchange=()=>{this.onResChange()},this.camSelect=s,s.dataset.testid="camera-selection",this.resSelect=r,r.dataset.testid="resolution-selection",e}createMicSettingsPanel(){this.constraints.micId=M;const e=document.createElement("div");return e.style.display="none",e}createStartButton(){const e=document.createElement("div");e.style.textAlign="center",e.style.padding="10px 0px 2px";const t=document.createElement("button");return(0,T.fZ)(t,"startButton"),t.style.width="305px",t.style.height="27px",t.style.borderWidth="1px",t.style.borderStyle="solid",t.style.borderRadius="4px",t.textContent=this.config.startButtonText,t.style.fontFamily="UbuntuBold",t.style.fontSize="16px",t.style.cursor="pointer",t.style.whiteSpace="nowrap",t.style.overflow="hidden",t.style.textOverflow="ellipsis",e.appendChild(t),t.onclick=()=>{t.disabled=!0,this.startBroadcast()},t.dataset.testid="cam-to-cam-preview-start-button",this.startButton=t,this.setStartButtonDisabled(!0),e}createMediaSettingLabel(e){const t=document.createElement("div");return t.style.paddingLeft="8px",t.style.paddingTop="3px",t.style.fontSize="16px",t.style.fontFamily="UbuntuBold",t.textContent=e,t}}class V extends p.u{constructor(e,t,i){super(),this.stopping=!1,this.timeStarted=0,this.dossier=e,this.config=i,this.constraints=t,this.createBroadcastPanel();let s=!1,n=!1,o=!1,r=!0;const a=(e,t)=>{void 0!==this.status&&void 0!==this.warning&&(!0!==t||n?!0!==t&&n&&(this.status.style.color="black",this.status.style.fontFamily="UbuntuRegular",this.status.style.width="",this.status.style.paddingLeft="0px",this.status.style.cssFloat="none",this.status.title="",this.warning.style.display="none",n=!1):(n=!0,this.status.style.color="#D80000",this.status.style.fontFamily="UbuntuBold",this.status.style.width="28%",this.status.style.paddingLeft="18%",this.status.style.cssFloat="left",this.status.title=this.warning.title=C.R.poorBroadcast,this.warning.style.display=""),this.status.textContent=e,e.length>27?this.status.style.paddingTop="2px":this.status.style.paddingTop="10px")},l=()=>{let e=performance.now();const t=window.setInterval((()=>{if(!r)return void clearInterval(t);const i=performance.now(),s=Math.floor((i-e)/1e3);s<1||(s>=10&&(e=i),void 0!==this.fps&&(this.fps.textContent=""),void 0!==this.status&&(this.status.textContent=`${C.R.pleaseWaitConnecting} ${10-s+1}...`,this.status.textContent.length>33?this.status.style.paddingTop="2px":"ja"===A.Bm.current.languageCode?this.status.style.fontSize="14px":this.status.style.paddingTop="10px"))}),200)};l(),this.onStreamStatusUpdate=e=>{if(void 0===this.streamer||this.streamer.uuid!==e.uuid)return;const t=e.data;if(void 0!==t.fps&&(s=!this.setFPS(t.fps)),void 0!==t.status){const e=t.status;if("connecting"!==e&&(r=!1),this.isStatusOffline(e))return void a("(Offline)");if("away"!==e||o)if("away"!==e&&o)void 0!==this.away&&(this.away.style.display="none"),this.main.style.display="",o=!1;else{const t=e.charAt(0).toUpperCase()+e.slice(1);"connecting"===e?r||(r=!0,l()):s&&this.timeStarted>0&&performance.now()-this.timeStarted>5e3?a(C.R.lowFPS,!0):a(`(${t} Broadcasting)`)}else this.main.style.display="none",void 0!==this.away&&(this.away.style.display=""),o=!0}},this.onStreamStop=e=>{void 0===this.streamer||this.streamer.uuid!==e||this.stopping||this.stop(!0)},u.Ay.listen(this.onStreamStatusUpdate),u.vN.listen(this.onStreamStop),this.start()}createBroadcastPanel(){const e=this.createMain();e.appendChild(this.createVideo()),e.appendChild(this.createControls());const t=document.createElement("div");t.innerText=C.R.incorrectOrientation,(0,m.ZM)(t,{color:"#ffffff",position:"absolute",fontSize:"1.0em",fontWeight:"bold",top:"8px",left:"8px",zIndex:100,display:"none",backgroundColor:"rgba(255, 255, 255, 0.5)",lineHeight:"150%",padding:"1px"}),t.setAttribute("draggable","false"),(0,a.wu)("orientationchange",window,(()=>{(0,f.FW)()&&(0,f.K$)()?(t.style.display="",t.innerText=C.R.incorrectPortrait):t.style.display="none"})),e.appendChild(t);const i=this.createAway();i.appendChild(this.createTitle()),i.appendChild(this.createMessage()),i.appendChild(this.createLink()),(0,T.fZ)(this.element,"broadcastPanel"),this.element.appendChild(e),this.element.appendChild(i),this.main=e,this.away=i}isBroadcasting(){return void 0!==this.streamer&&this.streamer.broadcasting}start(){this.stop().then((()=>{let e=0;const t=(i,n)=>{this.streamer=new H,this.streamer.setup(this.video,this.dossier,this.constraints).then((()=>{void 0!==this.streamer&&this.streamer.start().then((()=>{this.onBeforeUnload=e=>(e.preventDefault(),e.returnValue=!1,C.R.wantToLeaveConfirmation),(0,a.wu)("beforeunload",window,this.onBeforeUnload),this.onUnload=()=>{this.stop(!0)},(0,a.wu)((0,s.p0)(),window,this.onUnload),x.Ve.fire(!0),i()})).catch((e=>{n(`${C.R.couldNotStartBroadcast}: ${e.message}`)}))})).catch((o=>{if((0,s.J0)()&&"Invalid constraint"===o.message){if(e+=1,e<=5)return void this.stop().then((()=>{window.setTimeout((()=>{t(i,n)}),500)})).catch(w.yZ);n(C.R.ipadFailedToSetup)}n(`${C.R.couldNotSetupBroadcast}: ${o.message}`)}))};new Promise(t).catch((e=>{(0,l.Q$)(e),this.stop(!0)}))})).catch(w.yZ)}stop(e){this.stopping=!0,void 0!==this.onBeforeUnload&&((0,a.Pf)("beforeunload",window,this.onBeforeUnload),this.onBeforeUnload=void 0),void 0!==this.onUnload&&((0,a.Pf)((0,s.p0)(),window,this.onUnload),this.onUnload=void 0);let t=Promise.resolve();return void 0!==this.streamer&&(t=this.streamer.stop()),new Promise(((i,s)=>{t.then((()=>{this.stopping=!1,!0===e&&(u.Ay.removeListener(this.onStreamStatusUpdate),u.vN.removeListener(this.onStreamStop),this.config.onStopBroadcast(),x.Ve.fire(!1)),i()})).catch(s)}))}setFPS(e){let t=20,i=15;(0,s.Xb)()&&(t=12,i=9);let n,o=!0;return(e=Math.round(e))>=t?n="frameRateGood":e>=i?n="frameRateAvg":(n="frameRateBad",o=!1),void 0!==this.fps&&(this.fps.className="",(0,T.fZ)(this.fps,n),this.fps.textContent=`${e} FPS`),o}createMain(){const e=document.createElement("div");return e.style.height=R,e.style.width="100%",e.style.overflow="unset",e}createAway(){const e=document.createElement("div");return e.style.height=R,e.style.width="100%",e.style.backgroundColor="black",e.style.display="none",e}createVideo(){const e=O();return e.style.width="100%",e.style.height="370px",e.style.backgroundColor="black",this.video=e,e}createControls(){const e=document.createElement("div");(0,T.fZ)(e,"controls"),e.style.width="100%",e.style.height="35px";const t=document.createElement("button");t.style.border="0px";const i=document.createElement("div");(0,T.fZ)(i,"muteImg"),i.textContent="",i.style.height="20px",i.style.width="20px",i.style.border="0px",i.style.paddingTop="9px",(0,s.nr)()&&!(0,s.Xb)()&&(i.style.paddingTop="3px"),i.style.outline="none",t.appendChild(i);const o=document.createElement("div");o.style.cssFloat="left",o.style.textAlign="center",o.style.height="34px",o.style.borderRight="1px solid black",o.style.width="10%",(0,s.OF)()&&(0,s.nr)()&&(o.style.width="12%"),o.appendChild(t),e.appendChild(o);const r=e=>void 0!==this.streamer&&!!this.streamer.setMute(e)&&(e?(0,T.fZ)(i,"muted"):(0,T.SA)(i,"muted"),(0,n.aR)(E,String(e),U),!0);t.onclick=()=>{const e=!this.constraints.muted;r(e)&&(this.constraints.muted=e)},t.disabled=!0;const a=window.setInterval((()=>{r(this.constraints.muted)&&(t.disabled=!1,clearInterval(a))}),200),l=document.createElement("div");(0,T.fZ)(l,"inBrowserStatus"),l.style.cssFloat="left",l.style.textAlign="center",l.style.height="34px",l.style.width="51%",l.dataset.testid="stream-status",(0,s.OF)()&&(l.style.width="44%"),l.style.borderRight="1px solid black",l.style.padding="0px",l.style.fontFamily="UbuntuRegular";const h=_("");h.style.cssFloat="left",h.style.paddingLeft="5px",h.style.paddingTop="10px";const d=F("");d.style.paddingLeft="0px";const c=document.createElement("img");c.src=`${STATIC_URL_ROOT}broadcastassets/warning.png`,c.style.height="16px",c.style.paddingTop="9px",c.style.paddingLeft="5px",c.style.display="none",c.style.cssFloat="left",l.appendChild(h),l.appendChild(d),l.appendChild(c),this.fps=h,this.status=d,this.warning=c,e.appendChild(l);const u=document.createElement("button"),p=document.createElement("input");p.type="image",p.src=`${STATIC_URL_ROOT}broadcastassets/stop.svg`,p.style.verticalAlign="middle",p.style.height="16px",p.style.paddingTop="1px",u.appendChild(p);const m=document.createElement("span");m.style.fontFamily="UbuntuRegular",m.textContent=m.innerText=C.R.stopBroadcasting;const g=m.innerText.length;g>24?(m.style.fontSize="11px",m.style.paddingLeft="1px"):g<24&&g>18?(m.style.fontSize="13px",m.style.paddingLeft="2px"):(m.style.fontSize="18px",m.style.paddingLeft="7px"),m.style.verticalAlign="middle",u.appendChild(m),u.style.paddingTop="5px",u.style.cssFloat="right",u.style.border="0",u.dataset.testid="stop-broadcasting-web-rtc-button";const v=document.createElement("div");return v.style.cssFloat="left",v.style.textAlign="center",v.style.height="34px",v.appendChild(u),e.appendChild(v),u.onclick=()=>{this.stop(!0)},e}createTitle(){const e=document.createElement("div");e.style.textAlign="center",e.style.paddingTop="90px";const t=document.createElement("span");return(0,T.fZ)(t,"awayTitle"),t.textContent=C.R.youAreAway,t.style.fontFamily="UbuntuRegular",t.style.fontSize="40px",e.appendChild(t),e}createMessage(){const e=document.createElement("div");e.style.textAlign="center",e.style.paddingLeft="16%",e.style.paddingRight="16%",e.style.paddingTop="50px";const t=document.createElement("span");return(0,T.fZ)(t,"inBrowserAwayMessage"),t.style.fontFamily="UbuntuRegular",t.style.fontSize="14px",t.textContent=C.R.wentToAway,e.appendChild(t),e}createLink(){const e=document.createElement("div");e.style.textAlign="center",e.style.paddingTop="35px";const t=document.createElement("a");return(0,T.fZ)(t,"awayLink"),t.text=C.R.exitAwayMode,t.style.fontFamily="UbuntuRegular",t.style.fontSize="20px",t.style.cursor="pointer",t.style.textDecoration="underline",e.appendChild(t),t.onclick=()=>{(0,b.vZ)()},e}isStatusOffline(e){return!I.some((t=>t===e))}}class z extends p.u{constructor(e,t,i){super(),this.startCounter=1,this.dossier=e,this.user=i,this.config=t;const s="true"===(0,n.y1)(E);this.constraints={micId:"",camId:"",width:0,height:0,muted:void 0!==s&&s},(0,T.fZ)(this.element,"Broadcast"),this.element.style.width="498px",this.element.style.height="407px",this.element.style.fontFamily="UbuntuBold",this.element.style.fontSize="18px",this.element.style.position="relative",this.previewPanel=this.createPreview(),this.addChild(this.previewPanel)}isBroadcasting(){return void 0!==this.broadcastPanel&&this.broadcastPanel.isBroadcasting()}createPreview(){return new W(this.dossier,this.constraints,{onOBSClick:this.config.onOBSClick,onStartBroadcast:()=>{void 0!==this.previewPanel&&(this.removeChild(this.previewPanel),this.previewPanel=void 0),(0,y.bT)("WebRTCBroadcastStart",{startCount:this.startCounter}),this.startCounter+=1,this.broadcastPanel=this.createBroadcast(),this.addChild(this.broadcastPanel)}},this.user)}createBroadcast(){return new V(this.dossier,this.constraints,{onStopBroadcast:()=>{void 0!==this.broadcastPanel&&(this.removeChild(this.broadcastPanel),this.broadcastPanel=void 0),this.previewPanel=this.createPreview(),this.addChild(this.previewPanel)}})}}},1673:(e,t,i)=>{"use strict";i.d(t,{I1:()=>r,Ve:()=>o,WK:()=>n});var s=i(8423);const n=new s.c_("anyRTCBroadcastStartStop"),o=new s.c_("webRTCBroadcastStartStop"),r=new s.c_("OBSBroadcastStartStop"),a=e=>{n.fire(e)};o.listen(a),r.listen(a)},9447:(e,t,i)=>{"use strict";i.d(t,{SA:()=>r,aG:()=>n,fZ:()=>o});var s=i(2709);const n={textColor:"textColor",bgColor:"bgColor",brandColor:"brandColor",tabSectionBorder:"tabSectionBorder",tabBorder:"tabBorder",tabActiveBorder:"tabActiveBorder",tabInactiveBgColor:"tabInactiveBgColor",tabInactiveColor:"tabInactiveColor",tabActiveBgColor:"tabActiveBgColor",tabActiveColor:"tabActiveColor",chatAreaTabColor:"chatAreaTabColor",defaultColor:"defaultColor",defaultTooltipColor:"defaultTooltipColor",disabledTooltipColor:"disabledTooltipColor",roomSubjectToolTipColor:"roomSubjectToolTipColor",hrefColor:"hrefColor",tagFontColor:"tagFontColor",tagExhibColor:"tagExhibColor",tagNewColor:"tagNewColor",tagLineColor:"tagLineColor",tagOfflineColor:"tagOfflineColor",tagPrivateGroupColor:"tagPrivateGroupColor",tagGamingColor:"tagGamingColor",camBgColor:"camBgColor",camBorderColor:"camBorderColor",camSubjectColor:"camSubjectColor",camSubjectTagColor:"camSubjectTagColor",camAltTextColor:"camAltTextColor",camHrefColor:"camHrefColor",nextCamBgColor:"nextCamBgColor",navigationAlt2BgImage:"navigationAlt2BgImage",navigationAlt2BgColor:"navigationAlt2BgColor",dismissibleMessageColor:"dismissibleMessageColor",userInfoDropdownBgColor:"userInfoDropdownBgColor",userInfoDropdownHighlightColor:"userInfoDropdownHighlightColor",userInfoDropdownTextColor:"userInfoDropdownTextColor"};function o(e,t){""!==t&&(e instanceof s.u?e.element:e).classList.add(t)}function r(e,t){""!==t&&(e instanceof s.u?e.element:e).classList.remove(t)}},9757:(e,t,i)=>{"use strict";i.d(t,{c:()=>o});class s{update(e){}dispose(){}}class n extends s{constructor(e,t){super();const i=document.createElement("span");i.style.color="red",i.textContent="Error loading component",t.appendChild(i),warn("Created dummy React component")}update(e){warn("Update called on dummy React component")}dispose(){warn("Dispose called on dummy React component")}}class o{static get(e){return void 0===window.ReactComponentRegistry?(error("ReactComponentRegistry is undefined - React code is likely not loaded",{argument:e}),n):void 0===window.ReactComponentRegistry[e]?(error(`ReactComponentRegistry does not contain component ${e} - React code may not be up to date`,{argument:e}),n):window.ReactComponentRegistry[e]}}},4801:(e,t,i)=>{"use strict";i.d(t,{T:()=>o});var s=i(82),n=i(9757);class o extends s.b{constructor(e){super(e),this.element.setAttribute("ts",`${e.component}Wrapper`)}createBaseElement(e,t){return document.createElement("div")}initUI(e){this.reactComponent=new(n.c.get(e.component))(e.componentProps,this.element),void 0!==e.reactRef&&e.reactRef(this.reactComponent)}update(e){null!==this.reactComponent&&this.reactComponent.update(e)}dispose(){null!==this.reactComponent&&this.reactComponent.dispose()}}},718:(e,t,i)=>{"use strict";i.d(t,{BK:()=>c,HQ:()=>d,p1:()=>b});var s=i(4936),n=i(82),o=i(4947),r=i(1372),a=i(5389),l=i(7871),h=i(9447);function d(e){const t=new s.N6(e),i=t.getStringOrUndefined("detail",!1);if(void 0!==i)return{msg:i,type:"legacy"};const n=t.getMap("detail");return{msg:n.getString("msg"),type:n.getString("type"),app:n.getStringOrUndefined("app",!1)}}function c(e){return`${function(e){return e.id.split("-",1)[0]}(e)}-${t=e.name,t.replace(/[^a-zA-Z0-9]/g,"-")}`;var t}const u=e=>{const t=`/v2apps?slot=${e.slot}`,i=`appdir-slot-${e.slot}`;return(0,r.tT)("a",{style:x,colorClass:h.aG.hrefColor,href:t,onClick:t=>{t.preventDefault(),(0,a.aH)(t.target.href,i,"status=0,toolbar=1,menubar=0,directories=0,resizable=1,scrollbars=1,height=768,width=860,top=50,left=50").then((t=>{void 0!==t&&e.registerPopUp(i,t)})).catch((e=>error(e)))},"data-test":`choose-app-btn-${e.slot}`},e.text)},p=e=>{const t=`/v2apps?slot=${e.app.slot}&app_path=${c(e.app)}`;return(0,r.tT)("a",{style:{...x,visibility:e.hidden?"hidden":"visible"},colorClass:h.aG.hrefColor,href:t,onClick:t=>{const i=`appdir-slot-${e.app.slot}`;t.preventDefault(),(0,a.aH)(t.target.href,i,a.fp).then((t=>{void 0!==t&&e.registerPopUp(i,t)})).catch((e=>error(e)))},"data-test":`app-${e.text.toLowerCase()}-link-${e.app.slot}`},e.text)},m=e=>{const t={width:"50px",display:"inline-block",textAlign:"left"};return e.app.isInstalled&&!e.app.isActive&&Boolean(e.app.reason)&&"user requested"!==e.app.reason?(0,r.tT)("span",{style:t,colorClass:"deactivate","data-test":`app-status-${e.app.slot}`},o.R.crashed):e.app.isActive?(0,r.tT)("span",{style:t,colorClass:"activeStatus","data-test":`app-status-${e.app.slot}`},o.R.running):(0,r.tT)("span",{style:t,colorClass:"noneSelected","data-test":`app-status-${e.app.slot}`},o.R.stopped)},g=e=>(0,r.tT)("a",{style:{...x,width:"40px",textAlign:"left"},colorClass:"deactivate",href:"#",onClick:t=>{(0,l.cR)(e.app.id,(()=>{})).catch((e=>{error(e)}))},"data-test":`app-stop-btn-${e.app.slot}`},o.R.stop),v=e=>(0,r.tT)("a",{style:x,colorClass:"deactivate",href:"#",onClick:t=>{(0,l._e)(e.app.id,!0,(()=>{})).catch((e=>{error(e)}))},"data-test":`app-uninstall-btn-${e.app.slot}`},e.text),f=e=>(0,r.tT)("tr",{colorClass:"row"},(0,r.tT)("td",{style:C},(0,r.tT)("legend",{style:S,colorClass:"label","data-test":`app-label-${e.slot}`},`v2 App #${e.slot}:`)),(0,r.tT)("td",{style:{fontStyle:"italic"},colorClass:"noneSelected","data-test":`app-name-${e.slot}`},o.R.noneSelected),(0,r.tT)("td",{colSpan:4},(0,r.tT)("span",{style:{cssFloat:"right",paddingRight:"8px"}},(0,r.tT)(u,{text:o.R.chooseAnApp,slot:e.slot,registerPopUp:e.registerPopUp})))),y=e=>(0,r.tT)("tr",{colorClass:"row"},(0,r.tT)("td",{style:C},(0,r.tT)("legend",{style:S,colorClass:"label","data-test":`app-label-${e.slot}`},"v2 App #",e.slot,":")),(0,r.tT)("td",{style:{fontStyle:e.app.isActive?"normal":"italic",width:"430px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},colorClass:e.app.isActive?"activeStatus":"noneSelected","data-test":`app-name-${e.slot}`},e.app.name),(0,r.tT)("td",null,(0,r.tT)(m,{app:e.app})),(0,r.tT)("td",null,(0,r.tT)(p,{app:e.app,text:e.app.hasUpdate?o.R.upgrade:o.R.settings,hidden:!e.app.isActive,registerPopUp:e.registerPopUp})),(0,r.tT)("td",null,!e.app.isActive&&(0,r.tT)(p,{app:e.app,text:o.R.restart,hidden:!1,registerPopUp:e.registerPopUp}),e.app.isActive&&(0,r.tT)(g,{app:e.app})),(0,r.tT)("td",{style:{width:0,paddingRight:"8px"}},(0,r.tT)(v,{app:e.app,text:o.R.uninstall})));class b extends n.b{initData(e){this.authUrl=e.authUrl,this.savedApps=e.savedApps,this.appDirectoryPopUps=e.appDirectoryPopUps,this.populateAppsRows()}initUI(){super.initUI(),this.element=(0,r.tT)("div",{style:{width:"850px",borderStyle:"solid",borderWidth:"1px",borderRadius:"5px 5px 0 0"}},this.createAppsTable(),(0,r.tT)("div",{style:{margin:"10px 8px"}},this.createDevportalMessage())),(0,h.fZ)(this.element,"aspPanel")}createAppsTable(){return(0,r.tT)("table",{style:w},(0,r.tT)("tr",null,(0,r.tT)("th",{colSpan:6,style:{fontSize:"14px",padding:"8px",borderRadius:"5px 5px 0 0"},colorClass:"header","data-test":"v2-apps-header"},"v2 ",o.R.apps,(0,r.tT)("span",{colorClass:"headerBadge",style:{padding:"2px 7px",margin:"0 5px",borderRadius:"2px"}},o.R.newCapitalized))),(0,r.tT)("tr",null,(0,r.tT)("td",{colSpan:6},(0,r.tT)("div",{style:{fontSize:"12px",margin:"8px 8px",padding:"8px 10px",borderRadius:"5px"},colorClass:"notice","data-test":"v2-apps-header-text"},o.R.v2AppsDescription))),this.appRows.slice(0,10).map((e=>e)))}registerPopUp(e,t){this.appDirectoryPopUps[e]=t}notifyDirectoryPopUpsRefresh(){for(const e of Object.values(this.appDirectoryPopUps))e.closed||e.postMessage("asp-tab-refresh","*")}populateAppsRows(){this.appRows=[];for(let e=0;e<10;++e)this.appRows.push((0,r.tT)(f,{slot:e+1,registerPopUp:this.registerPopUp.bind(this)}));this.savedApps.forEach((e=>{void 0!==e.slot?this.appRows[e.slot-1]=(0,r.tT)(y,{app:e,slot:e.slot,registerPopUp:this.registerPopUp.bind(this)}):error(`${e.name} has no slot`)}))}createDevportalMessage(){const e=o.R.devportalMessage(this.authUrl),t=document.createElement("p");return t.innerHTML=e.replace(/\s{2,}/gm," "),t.style.margin="0",t.style.fontSize="12px",t.setAttribute("data-test","dev-portal-link-text"),t}render(){return this.element}}const w={borderCollapse:"collapse",textAlign:"left",width:"100%"},C={width:"110px"},S={padding:"3px 8px"},x={verticalAlign:"middle",display:"inline-block"}},3916:(e,t,i)=>{"use strict";i.d(t,{y:()=>d});var s,n=i(2709),o=i(4947),r=i(1372),a=i(9447),l=i(9937);function h(e){return e in d.APP_PERMISSIONS}class d extends n.u{constructor(e){super("div",e)}initData(e){this.app=e.app,this.onChange=e.onChange,this.submit=e.submit,this.exclusiveApps=e.exclusiveApps,this.cbappAppUsed=e.cbappsAppUsed,this.showPermissions=!1,this.initExclusivePermissions()}initUI(e){this.permissionsForm=this.createPermissionsForm(),this.permissionsForm.style.display="none",this.element=(0,r.tT)("div",null,this.showPermissions&&(0,r.tT)("div",{onClick:()=>{this.togglePermissionsForm()},style:{display:"flex",justifyContent:"space-between",margin:"10px 10px 0"}},(0,r.tT)("h3",{style:{fontSize:"12px",fontFamily:"ubuntumedium",fontWeight:500,minWidth:"200px",color:"#494949"}},o.R.permissions),(0,r.tT)("h3",{ref:e=>{this.permissionsStatus=e},style:{fontSize:"12px"},colorClass:"subText"},this.getStatusText()),(0,r.tT)("div",null),(0,r.tT)("div",null),(0,r.tT)("div",null,(0,r.tT)("div",{style:{margin:"10px 10px 0 0",width:"15px",height:"15px",backgroundSize:"cover"},ref:e=>{this.chevronDown=e},colorClass:"chevronDown"}),(0,r.tT)("div",{style:{margin:"10px 10px 0 0",width:"15px",height:"15px",backgroundSize:"cover",display:"none"},ref:e=>{this.chevronUp=e},colorClass:"chevronUp"}))),(0,r.tT)("div",null,this.permissionsForm)),(0,a.fZ)(this.element,"appForm"),!this.app.isInstalled&&this.showPermissions&&this.togglePermissionsForm()}togglePermissionsForm(){this.showPermissions&&(this.permissionsForm.style.display="none"===this.permissionsForm.style.display?"block":"none",this.chevronDown.style.display="none"===this.chevronDown.style.display?"block":"none",this.chevronUp.style.display="none"===this.chevronUp.style.display?"block":"none")}initialValue(e,t){var i;return!this.app.isInstalled||(h(e)?!(!this.app.hasUpdate||"ask"===(null===(i=this.app.installed)||void 0===i?void 0:i.permissions[e].settings)||e in d.EXCLUSIVE_PERMISSIONS&&""!==this.exclusivePermissions[e])||t:(warn(`Invalid permission key: ${e}`),!1))}createPermissionsForm(){let e={};if(this.app.isInstalled&&void 0!==this.app.permissionsValues)e=this.app.permissionsValues;else for(const t of Object.keys(d.APP_PERMISSIONS))e[t]=!1;return(0,r.tT)("form",{onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),this.submit())}},(0,r.tT)("ul",null,Object.entries(e).map((e=>{let[t,i]=e;const s=this.app.latest.permissions;if(!h(t))return"";if("ask"===s[t].settings){this.showPermissions=!0;const e=this.initialValue(t,i);return this.renderPermission(t,e)}return""}))))}initExclusivePermissions(){const e=Object.keys(d.EXCLUSIVE_PERMISSIONS);this.exclusivePermissions={};for(const t of e)this.exclusivePermissions[t]="";for(const i of this.exclusiveApps)if(this.app.id!==i.id)for(const s of e){var t;Boolean(null===(t=i.permissionsValues)||void 0===t?void 0:t[s])&&(this.exclusivePermissions[s]=i.name)}}getStatusText(){let e=0;[...this.permissionsForm.elements].forEach((t=>{t.checked&&(e+=1)}));const t=e/this.permissionsForm.elements.length;return 1===t?o.R.allPermissionsText:0===t?o.R.noPermissionsText:o.R.somePermissionsText}exclusiveAppTextElement(e){var t;const i=null===(t=this.exclusivePermissions)||void 0===t?void 0:t[e];let s=d.APP_PERMISSIONS[e].exclusiveText;return this.cbappAppUsed&&""!==s?s=o.R.activeAppOverrideText:e in this.exclusivePermissions&&""!==this.exclusivePermissions[e]&&(s=o.R.usedByText(i)),(0,r.tT)("p",{style:{width:"450px",padding:"0 0 0 25px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},s)}checkboxElement(e,t){const i=new l.m(16,t,this.onChange);return i.setName(e),i.element.style.minWidth="16px",i.element}renderPermission(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!h(e))return;const s=d.APP_PERMISSIONS[e],n=this.checkboxElement(e,t);return(0,r.tT)("li",{style:{display:"flex",justifyContent:"left",cssFloat:"none",alignItems:"center",borderBottom:"1px solid #E5E5E5",padding:"10px",margin:"0"}},(0,r.tT)("div",{style:{minWidth:"220px",margin:"0 8px 0 0"}},(0,r.tT)("p",{style:{fontSize:"12px",margin:0,padding:0,fontFamily:"ubuntumedium",fontWeight:500}},s.label),(0,r.tT)("p",{style:{fontSize:"10px",margin:0,padding:0},colorClass:"subText"},s.description)),n,i?"":this.exclusiveAppTextElement(e))}updateStatusText(){void 0!==this.permissionsStatus&&(this.permissionsStatus.innerText=this.getStatusText(),[...this.permissionsForm.elements].forEach((e=>{if(!e.checked)return;const t=e.nextSibling;""!==t.innerText&&(t.innerText="")})))}formData(){const e=d.ALL_PERMISSIONS,t={};for(const i of Object.values(e))t[i]=!1;const i=new FormData(this.permissionsForm);for(const s of i.keys())s in e&&(t[e[s]]=!0);return t}modalFormData(e){const t=d.ALL_PERMISSIONS,i={};for(const s of e.elements){const e=s;e.name in t&&(i[t[e.name]]=e.checked)}return i}getFormData(e){let t={};return void 0!==e&&(t=this.modalFormData(e)),{...this.formData(),...t}}getSelectedExclusiveConflicts(){const e=new FormData(this.permissionsForm).keys(),t=[];for(const i of e)i in this.exclusivePermissions&&""!==this.exclusivePermissions[i]&&t.push(i);return t}shouldConfirmModal(){return this.getSelectedExclusiveConflicts().length>0}confirmModalForm(){const e=this.getSelectedExclusiveConflicts();return(0,r.tT)("form",null,(0,r.tT)("ul",null,e.map(((t,i)=>{const s=this.renderPermission(t,!0,!0);return void 0!==s&&e.length===i+1&&(s.style.borderBottom="none"),s}))))}render(){return this.element}}(s=d).EXCLUSIVE_PERMISSIONS={videoPanel:"videoPanel",tipOptions:"tipOptions"},s.ALL_PERMISSIONS={...s.EXCLUSIVE_PERMISSIONS,rewriteMessages:"rewriteMessages"},s.APP_PERMISSIONS={videoPanel:{label:o.R.videoPanelLabel,description:o.R.exclusiveAppPermissionText,exclusiveText:o.R.aspPermissionOverrideText},rewriteMessages:{label:o.R.transformMessagesLabel,description:"",exclusiveText:""},tipOptions:{label:o.R.tipOptionsLabel,description:o.R.exclusiveAppPermissionText,exclusiveText:""}}},7596:(e,t,i)=>{"use strict";i.d(t,{d:()=>u});var s=i(6624),n=i(6844),o=i(82),r=i(7463),a=i(4947),l=i(1372),h=i(9461),d=i(6064);class c extends o.b{constructor(e){super(e),this.props=e,this.isMobile=h.Bm.current.isMobile}initData(e){super.initData(e),this.setState({isActive:!0===e.isFollowing})}createElement(e){return this.hideTitle=void 0!==e.hideTitle&&e.hideTitle,(0,l.tT)("div",{bind:{className:()=>`follow_star ${this.getIconClass()}`,title:()=>this.getTitle(),style:()=>this.getStyle()},"data-slug":e.slug,onClick:t=>{this.handleClick(),!0!==e.allowPropagation&&t.stopPropagation(),t.preventDefault()},"data-testid":"follow-star"})}getIconClass(){return void 0===this.state.isActive?"icon_update_following":this.state.isActive?"icon_following":"icon_not_following"}getTitle(){return this.hideTitle||void 0===this.state.isActive?"":this.state.isActive?a.R.unfollowText:a.R.followText}getStyle(){return{}}setHover(){this.element.classList.add("no_hover"),window.setTimeout((()=>{this.element.classList.remove("no_hover")}),3e3)}setFollowing(e){this.setState({isActive:e})}handleClick(){if((0,n.ok)()&&(!this.isMobile||(0,s.isMobileSpaShown)()))return void(0,d.DC)({fromFeature:!0});const e=!0===this.state.isActive;this.setState({isActive:void 0}),this.callFollowApi(!e).then((()=>{this.setState({isActive:!e}),this.setHover()})).catch((()=>{this.setState({isActive:e})}))}}class u extends c{callFollowApi(e){var t;const i=e?(0,r.j4)(this.props.slug,(0,n.ok)()):(0,r.QH)(this.props.slug,(0,n.ok)());return null!==(t=null==i?void 0:i.then((e=>e?Promise.resolve():Promise.reject())))&&void 0!==t?t:Promise.reject()}}},8863:(e,t,i)=>{"use strict";i.d(t,{F:()=>v,p:()=>g});var s,n=i(4936),o=i(7623),r=i(5216),a=i(2709),l=i(3955),h=i(8423),d=i(4947),c=i(1372),u=i(1224);const p=()=>(0,c.tT)("img",{src:u.m.logoImageName,style:{maxWidth:"198px"}}),m=e=>{var t;const i=e=>(0,c.tT)("div",{style:{display:"inline-block",verticalAlign:"middle",...e.style}},e.children);return(0,c.tT)("div",{className:"game-search-result",style:{marginTop:"12px",position:"relative"}},(0,c.tT)(i,{style:{paddingRight:"1em"}},(0,c.tT)("img",{src:e.image,style:{borderRadius:"5px",objectFit:"cover",overflow:"hidden"},width:"42px",height:"42px"})),(0,c.tT)(i,null,(0,c.tT)("div",{style:{fontSize:"14px",lineHeight:"22px",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif",height:"50%"}},(0,c.tT)("a",{href:"#",onClick:t=>{t.preventDefault(),e.onClick()}},e.name)),(0,c.tT)("div",{style:{fontSize:"12px",lineHeight:"20px",height:"50%"}},"Viewers: ",null!==(t=e.viewers)&&void 0!==t?t:0)),(0,c.tT)(i,{style:{position:"absolute",right:"0",top:"50%",transform:"translateY(-50%)"}},(0,c.tT)("div",{style:{fontSize:"12px",lineHeight:"14px",borderRadius:"4px",cursor:"pointer",display:"inline-block",padding:"7px 8px",marginRight:"18px",userSelect:"none"},className:"selectGameButton","data-testid":"select-game-button",onClick:e.onClick},"Select game")))},g=e=>{const t=document.createElement("p");return t.innerHTML=e.replace(/\s{2,}/gm," "),t.style.width="90%",t};class v extends a.u{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1?arguments[1]:void 0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";super(),this.totalGames=i,this.currentPage=s,this.searchQuery=n,this.OBS_TUTORIAL_URL="https://support.chaturbate.com/hc/en-us/articles/360037971952-How-do-I-set-up-OBS-",this.SEARCH_DELAY=500,(0,l.ZM)(this.element,{position:"relative",width:"unset",height:"unset"}),this.element.appendChild(this.render()),this.searchAPIResults=t,this.renderSearchResults(),this.renderPagination(),null===(e=document.getElementById("search_games_input"))||void 0===e||e.focus(),this.searchTimer=void 0}render(){var e;const t=document.body.classList.contains("darkmode");return(0,c.tT)("div",{className:"GameSelection",ref:e=>{this.displayElement=e}},(0,c.tT)("div",{className:"title"},(0,c.tT)("h1",{style:{color:"#494949",marginBottom:"0px",fontSize:"1.3em",fontWeight:"bolder"},"data-testid":"select-game-header-text"},d.R.selectGameHeaderText),(0,c.tT)("p",{style:{fontSize:"14px",lineHeight:"22px",margin:"12px 0 0"},className:"title"},g(d.R.selectGameSectionText(u.m.sanitizedSiteName,u.m.cbGamesUrl)))),(0,c.tT)("div",null,(0,c.tT)("div",{style:{borderRadius:"4px",display:"inline-block",padding:"5px 8px",verticalAlign:"middle",fontSize:"14px"},className:"searchBar"},(0,c.tT)("input",{id:"search_games_input",type:"text",placeholder:"Search Games",style:{width:"210px",border:"0",outline:"none"},onInput:e=>{this.searchQueryChanged(e)},value:null!==(e=this.searchQuery)&&void 0!==e?e:"",maxLength:50}),(0,c.tT)("label",{for:"search_games_input"},(0,c.tT)("img",{src:`${STATIC_URL_ROOT}images/search${t?"_dm":""}.svg`,width:"12",height:"12",style:{verticalAlign:"middle"}})))),(0,c.tT)("div",{ref:e=>{this.searchResults=e}}),(0,c.tT)("ul",{ref:e=>{this.paginationDOM=e}}))}renderSearchResults(){var e;if(void 0===this.searchAPIResults)return;const t=this.searchAPIResults.length>0?(0,c.tT)("div",null,this.searchAPIResults.map((e=>(0,c.tT)(m,{name:e.name,gameUrl:e.gameUrl,viewers:e.viewers,image:e.image,uid:e.uid,onClick:()=>{window.location.href=(0,r._Y)(encodeURI(`/games/confirm_game/${e.uid}/`))}})))):(0,c.tT)("h3",{style:{fontSize:"14px",color:"#0B5D81"}},"No Results"),i=(0,c.tT)("div",null,t);null===(e=this.displayElement)||void 0===e||e.replaceChild(i,this.searchResults),this.searchResults=i}renderPagination(){var e;let t=Math.floor(this.totalGames/20);this.totalGames%20>0&&(t+=1);const i=""===this.searchQuery?"?":`?q=${this.searchQuery}&`,s=[...(n=t,Array.from({length:n},((e,t)=>t)))].map((e=>{e+=1;const t=this.currentPage===e?"active":"ok";return(0,c.tT)("li",{className:t,style:{margin:"0 2px",display:this.totalGames<=20?"none":""}},(0,c.tT)("a",{href:encodeURI(`${i}p=${e}`)},`${e}`))}));var n;const o=(0,c.tT)("ul",{className:"paging",style:{display:"flex",justifyContent:"center"}},(0,c.tT)("li",{style:{display:1===this.currentPage?"none":"inline-block",cursor:"pointer"}},(0,c.tT)("a",{className:"prev",style:{height:"100%"},href:encodeURI(`${i}p=${this.currentPage-1}`)})),s,(0,c.tT)("li",{style:{display:this.totalGames<20||this.currentPage===t?"none":"inline-block",cursor:"pointer"}},(0,c.tT)("a",{href:encodeURI(`${i}p=${this.currentPage+1}`),className:"next",style:{height:"100%"}})));null===(e=this.displayElement)||void 0===e||e.replaceChild(o,this.paginationDOM),this.paginationDOM=o}searchQueryChanged(e){if(e.stopPropagation(),this.searchQuery=e.target.value,0===this.searchQuery.length||this.searchQuery.length>1){this.currentPage=1,this.scheduleSearch();const e=document.getElementsByTagName("title")[0].innerHTML,t=0===this.searchQuery.length?{}:{q:this.searchQuery},i=0===this.searchQuery.length?`${location.pathname}`:`${location.pathname}?q=${this.searchQuery}`;window.history.replaceState(t,e,(0,r._Y)(i))}}scheduleSearch(){void 0!==this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=window.setTimeout((()=>{this.doSearch()}),this.SEARCH_DELAY)}async doSearch(){try{var e;let t=`${v.GAME_QUERY_URL}?q=${encodeURI(this.searchQuery)}`;1!==this.currentPage&&(t+=`&p=${this.currentPage}`);const i=await(0,r.Aw)(t),s=new n.N6(i.responseText);this.totalGames=s.getNumber("total");const a=s.getList("games");this.searchAPIResults=void 0!==a?v.parseSearchResults(a):[],this.renderSearchResults(),this.renderPagination(),null===(e=document.getElementById("search_games_input"))||void 0===e||e.focus(),(0,o.J8)().scrollTop=0,this.searchTimer=void 0}catch(e){this.searchTimer=void 0}}async selectGameAndClose(e){await v.selectGame(e)}static async selectGame(e){let t=!1;try{const i=await(0,r.KF)(v.GAME_SELECT_URL,{uid:e}),s=v.parseSelection(i.responseText);v.selectionChange.fire(s),t=!0}catch(e){}return t}static async deselectGame(){await(0,r.KF)(v.GAME_DESELECT_URL,{}),v.selectionChange.fire(void 0)}static async getCurrentGame(e){const t=await(0,r.Aw)(`${v.GAME_CURRENT_URL}${encodeURI(e)}`);return v.parseSelection(t.responseText)}static parseSearchResults(e){return e.map((e=>{const t=e.getNumberOrUndefined("viewers");return{image:e.getString("image_64x64"),name:e.getString("name"),gameUrl:e.getString("game_url"),uid:e.getString("uid"),viewers:void 0===t?0:t}}))}static parseSelection(e){if(void 0===e)return;const t=JSON.parse(e);return null!==t?{description:t.description,gameUrl:t.game_url,image:t.image_64x64,name:t.name,uid:t.uid,viewers:t.viewers}:void 0}static generateHeader(){let e=(0,c.tT)("a",null),t=(0,c.tT)("div",null);return{headerContainer:(0,c.tT)("div",{className:"OBSInfoSection"},(0,c.tT)("div",null,(0,c.tT)(p,null)),(0,c.tT)("div",{className:"title"},(0,c.tT)("a",{href:"#",style:{display:"none"},ref:t=>{e=t}},(0,c.tT)("p",{style:{fontSize:"24px",lineHeight:"32px",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif",margin:"16px 0 10px",color:"#0a5a83"}},"Games")),(0,c.tT)("p",{ref:e=>{t=e},style:{fontSize:"24px",lineHeight:"32px",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif",margin:"16px 0 10px",display:"block"}},"Games"))),headerWithPageLink:e,header:t}}}(s=v).GAME_QUERY_URL="api/ts/games/search/",s.GAME_SELECT_URL="api/ts/games/select/",s.GAME_INFO_URL="api/ts/games/info/",s.GAME_DESELECT_URL="api/ts/games/deselect/",s.GAME_CURRENT_URL="api/ts/games/current/room/",s.selectionChange=new h.c_("gameSelectionChanged")},9118:(e,t,i)=>{"use strict";function s(e,t){return t<1?[]:[...Array(t).keys()].map((t=>t+e))}i.d(t,{d:()=>g});var n,o=i(1519),r=i(82),a=i(8423),l=i(1372),h=i(5216),d=i(2945);function c(e,t,i){var s;i=null!==(s=i)&&void 0!==s?s:"page";let n="",o="";if(void 0!==t){const e=t.split("?");2===e.length?(n=e[0],o=e[1]):e.length<=1&&(n=t)}else n=window.location.pathname,o=window.location.search;const r=(0,d.JO)(o);return r[i]=`${e}`,`${n}?${(0,d.Go)(r)}`}class u extends r.b{createElement(e){return(0,l.tT)("li",null,(0,l.tT)("a",{className:`${e.direction} no-link condensed`,"data-testid":`${e.direction}-button`,onClick:e.onClick,href:(0,h._Y)(c(e.page,e.baseUrl,e.pageParam)),ref:e=>{this._anchorElement=e}}))}toggleDisable(e){e?this._anchorElement.classList.add("no-link"):this._anchorElement.classList.remove("no-link")}isDisabled(){return this.element.classList.contains("no-link")}}class p extends r.b{createElement(e){return(0,l.tT)("li",{className:"page_number_container"},(0,l.tT)("a",{onClick:e.onClick,"data-testid":"page-number-button",href:(0,h._Y)(c(e.page,e.baseUrl,e.pageParam))},e.page))}toggleSelected(e){e?this.element.classList.add("active"):this.element.classList.remove("active")}isSelected(){return this.element.classList.contains("active")}}class m extends r.b{createElement(){return(0,l.tT)("span",{className:"endless_separator","data-testid":"endless-separator"},"...")}setShowHide(e){e?this.showElement():this.hideElement()}}class g extends r.b{constructor(e){var t;if(super(e),this.pageParam=null!==(t=e.pageParam)&&void 0!==t?t:"page",this.setState({currentPage:1,totalItems:0}),!0===e.makeResponsive){const e=new o.a((()=>{this.updateState()}),{bounceLimitMS:250,debounceType:2});window.setTimeout((()=>{null!==this.element.parentElement&&void 0!==window.ResizeObserver&&new ResizeObserver((()=>{e.callFunc()})).observe(this.element.parentElement)}))}}get currentPage(){return this.state.currentPage}set currentPage(e){this.setState({...this.state,currentPage:e})}createElement(e){return this.props=e,this.prevNavigationLink=this.createDirectionalButton("prev",this.state.currentPage-1),this.nextNavigationLink=this.createDirectionalButton("next",this.state.currentPage+1),(0,l.tT)("ul",{className:"paging","data-paction":"PageNumber",bind:{display:()=>this.getDisplay()}},this.prevNavigationLink.element,(0,l.tT)(m,{classRef:e=>{this.previousSpacer=e}}),(0,l.tT)(m,{classRef:e=>{this.nextSpacer=e}}),this.nextNavigationLink.element)}static calculateMaxPages(e,t){return Math.max(Math.ceil(e/t),1)}generatePaginationNumberSequence(){this.maxPages=g.calculateMaxPages(this.state.totalItems,this.props.itemsPerPage),(this.state.currentPage>this.maxPages||this.state.currentPage<1)&&(this.state.currentPage=1);const e=this.getMaxPageNumsFitWithinParentWidth(),t=Math.min(g.MAX_PAGE_NUMBERS_PER_SIDE,Math.floor(e/2)),i=new Set([1,...s(this.currentPage-t,t),this.currentPage,...s(this.currentPage+1,t),this.maxPages]),n=Array.from(i).filter((e=>e>=1&&e<=this.maxPages));return{pageNumbers:n,showPreviousEllipses:n.length>2&&n[0]+1!==n[1],showNextEllipses:n.length>2&&n[n.length-2]+1!==n[n.length-1]}}getMaxPageNumsFitWithinParentWidth(){var e,t;const i=(null!==(e=null===(t=this.element.parentElement)||void 0===t?void 0:t.offsetWidth)&&void 0!==e?e:1e3)-280;return Math.max(0,Math.floor(i/40))}createDirectionalButton(e,t){let i=this.nextNavigationLink,s=this.maxPages;"prev"===e&&(i=this.prevNavigationLink,s=1);const n=new u({direction:e,baseUrl:this.props.baseUrl,onClick:e=>{e instanceof MouseEvent&&(e.ctrlKey||e.metaKey||e.shiftKey)||(this.props.reloadOnPageChange||e.preventDefault(),i.isDisabled()||this.onUserInitiatedPageChange(t))},page:t,pageParam:this.props.pageParam});return n.toggleDisable(this.state.currentPage===s),n}createPageNumber(e,t){const i=(t,i)=>{t instanceof MouseEvent&&(t.ctrlKey||t.metaKey||t.shiftKey)||(this.props.reloadOnPageChange||t.preventDefault(),i.isSelected()||this.onUserInitiatedPageChange(e))},s=new p({baseUrl:this.props.baseUrl,onClick:e=>{i(e,s)},page:e,pageParam:this.props.pageParam});return s.toggleSelected(t),s}rearrangePaginationButtons(e){this.removeAllDOMChildren(),this.addChild(this.createDirectionalButton("prev",this.state.currentPage-1));for(let t=0;t<e.length;t++){t===e.length-1&&this.addChild(this.nextSpacer);const i=this.createPageNumber(e[t],this.state.currentPage===e[t]);t===e.length-1&&!0===this.props.addLastPageAction&&(i.element.dataset.pactionName="LastPage"),this.addChild(i),0===t&&this.addChild(this.previousSpacer)}this.addChild(this.createDirectionalButton("next",this.state.currentPage+1))}updateState(){const e=this.generatePaginationNumberSequence(),t=e.pageNumbers;this.rearrangePaginationButtons(t),this.nextSpacer.setShowHide(e.showNextEllipses),this.previousSpacer.setShowHide(e.showPreviousEllipses),super.updateState()}onUserInitiatedPageChange(e){this.setState({...this.state,currentPage:e}),void 0!==this.props.onPageChange&&this.props.onPageChange(e),g.pageNumberChanged.fire()}isLastPage(){return this.maxPages===this.state.currentPage}getDisplay(){return this.maxPages>1?"flex":"none"}}(n=g).MAX_PAGE_NUMBERS_PER_SIDE=3,n.pageNumberChanged=new a.c_("pageNumberChanged")},478:(e,t,i)=>{"use strict";i.d(t,{Ni:()=>a,Qc:()=>h,aZ:()=>l});var s=i(2709),n=i(4947),o=i(1372);class r extends s.u{constructor(e){super(),this.config=e,this.clickCallback=e=>{e.stopPropagation(),this.config.onClick()}}}class a extends r{constructor(e){super(e),this.config=e,this.openConversationElement=(0,o.tT)("a",{className:"mobileChatLink msg-link underline-link","data-conversation-type":this.config.conversationType,style:{textDecoration:"none",cursor:"pointer"}},` (${n.R.openConversationLower})`),this.openConversationElement.onclick=this.clickCallback}}class l extends r{constructor(e){super(e);const t=(0,o.tT)("a",{className:"msg-link underline-link",onClick:this.clickCallback,style:{cursor:"pointer"}},n.R.openConversationLower);this.openConversationElement=(0,o.tT)("span",{style:{fontWeight:"bold",textDecoration:""}}," (",t,")")}}class h extends r{constructor(e){super(e),this.openConversationElement=(0,o.tT)("span",{dangerouslySetInnerHTML:{__html:n.R.newPrivateMessageClickPrompt},onClick:this.clickCallback,style:{fontWeight:"bold",textDecoration:""}})}}},3172:(e,t,i)=>{"use strict";i.d(t,{fY:()=>d,Ew:()=>c,wt:()=>u});var s=i(6784),n=i(2690),o=i(1372),r=i(6318),a=i(9461),l=i(4754),h=i(7660);class d extends n.zf{get mediaList(){return this.mediasetProps.mediaList}get currentItem(){return this.mediaList[this.currentIndex]}constructor(){super({onShow:()=>{this.element.classList.add("data-hj-suppress"),this.element.style.display="block",this.repositionChildren()},onHide:()=>this.clearCurrent(),easyExit:!0}),this.currentIndex=0,r.bs.listen((e=>{this.deleteMedia(e)}),!1),r.C0.listen((e=>{this.deleteMedia(e)}),!1)}static loadMedia(e,t){void 0===d.instance&&(d.instance=new d),d.instance.mediasetProps!==e&&d.instance.init(e),d.instance.displayImage(d.instance.mediaList.indexOf(t))}init(e){var t,i,s,n,r;this.mediasetProps=e,this.mediasetProps.outgoing=null!==(t=this.mediasetProps.outgoing)&&void 0!==t&&t;const l=(null!==(i=null===(s=visualViewport)||void 0===s?void 0:s.height)&&void 0!==i?i:window.innerHeight)>(null!==(n=null===(r=visualViewport)||void 0===r?void 0:r.width)&&void 0!==n?n:window.innerWidth),h=`calc(100% - ${l?72:20}px)`;let c=`calc(100% - ${l?20:72}px)`;this.mediaList.length>1&&(c=`calc(100% - ${a.Bm.current.isMobile?92:180}px)`);for(const e of this.mediaList){if(void 0!==e.imageElement)break;e.imageElement=(0,o.tT)("img",{src:e.url,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxHeight:h,maxWidth:c},onLoad:()=>{var e;null===(e=d.instance)||void 0===e||e.repositionChildren()}})}this.rebuildUI()}rebuildUI(){this.arrowContainers=void 0,this.mediaList.filter((e=>""!==e.thumbnailUrl)).length>1&&(this.arrowContainers=new l.m((()=>{this.previous()}),(()=>{this.next()})),this.arrowContainers.shiftArrows(a.Bm.current.isMobile?8:25)),this.element=(0,o.tT)("div",{tabIndex:-1,style:{position:"fixed",zIndex:1101,outline:"none",width:"80vw",height:"80vh",top:"50%",left:"50%",transform:"translate(-50%, -50%)",boxSizing:"border-box"},colorClass:"ChatMediaCarousel"},function(e){const t=(0,o.tT)("path",{fill:"#E2E2E2",d:"M11.7255 0.392534C11.6095 0.276307 11.4717 0.184097 11.32 0.121183C11.1684 0.0582692 11.0058 0.0258858 10.8415 0.0258858C10.6773 0.0258858 10.5147 0.0582692 10.363 0.121183C10.2113 0.184097 10.0735 0.276307 9.95753 0.392534L6.23553 4.11453C6.18867 4.16125 6.1252 4.18748 6.05903 4.18748C5.99287 4.18748 5.9294 4.16125 5.88253 4.11453L2.15953 0.392534C2.0448 0.270837 1.90682 0.173402 1.75375 0.106C1.60068 0.0385979 1.43564 0.00259895 1.26841 0.000135597C1.10118 -0.00232775 0.935151 0.0287947 0.780163 0.0916592C0.625176 0.154524 0.484381 0.247852 0.366117 0.366117C0.247852 0.484381 0.154524 0.625176 0.0916592 0.780163C0.0287947 0.935151 -0.00232775 1.10118 0.000135597 1.26841C0.00259895 1.43564 0.0385979 1.60068 0.106 1.75375C0.173402 1.90682 0.270837 2.0448 0.392534 2.15953L4.11453 5.88153C4.13782 5.90476 4.15629 5.93234 4.16889 5.96272C4.18149 5.99309 4.18798 6.02565 4.18798 6.05853C4.18798 6.09142 4.18149 6.12398 4.16889 6.15435C4.15629 6.18472 4.13782 6.21231 4.11453 6.23553L0.392534 9.95953C0.158287 10.1941 0.0267145 10.512 0.0267145 10.8435C0.0267145 11.175 0.158287 11.493 0.392534 11.7275C0.629353 11.9575 0.946449 12.0861 1.27653 12.0861C1.60662 12.0861 1.92371 11.9575 2.16053 11.7275L5.88253 8.00553C5.90567 7.98228 5.93317 7.96383 5.96346 7.95124C5.99375 7.93865 6.02623 7.93217 6.05903 7.93217C6.09184 7.93217 6.12431 7.93865 6.1546 7.95124C6.18489 7.96383 6.2124 7.98228 6.23553 8.00553L9.95953 11.7255C10.1967 11.9548 10.5137 12.0829 10.8435 12.0829C11.1734 12.0829 11.4904 11.9548 11.7275 11.7255C11.9618 11.491 12.0934 11.173 12.0934 10.8415C12.0934 10.51 11.9618 10.1921 11.7275 9.95753L8.00553 6.23553C7.98225 6.21231 7.96378 6.18472 7.95118 6.15435C7.93857 6.12398 7.93209 6.09142 7.93209 6.05853C7.93209 6.02565 7.93857 5.99309 7.95118 5.96272C7.96378 5.93234 7.98225 5.90476 8.00553 5.88153L11.7255 2.15953C11.8416 2.04354 11.9337 1.90581 11.9965 1.75422C12.0593 1.60262 12.0917 1.44013 12.0917 1.27603C12.0917 1.11194 12.0593 0.949446 11.9965 0.797851C11.9337 0.646255 11.8416 0.508526 11.7255 0.392534Z"});return(0,o.tT)("div",{className:"closeButton",style:{position:"absolute",width:"15px",padding:"15px",right:"0px",zIndex:1102,cursor:"pointer"},onMouseEnter:()=>{t.style.fill="#B8B8B8"},onMouseLeave:()=>{t.style.fill="#E2E2E2"},onClick:e},(0,o.tT)("svg",{viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t))}((()=>{this.hide()})),void 0!==this.arrowContainers?this.arrowContainers.leftContainer:void 0,void 0!==this.arrowContainers?this.arrowContainers.rightContainer:void 0),(0,s.wu)("keydown",this.element,(e=>{switch(e.key){case"Left":case"ArrowLeft":this.previous();break;case"Right":case"ArrowRight":this.next();break;case"Esc":case"Escape":this.hide()}}))}clearCurrent(){var e;null===(e=this.currentItem)||void 0===e||null===(e=e.imageElement)||void 0===e||null===(e=e.parentElement)||void 0===e||e.removeChild(this.currentItem.imageElement)}displayImage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.show(),this.clearCurrent(),this.currentIndex=e,void 0!==this.currentItem&&void 0!==this.currentItem.imageElement&&(this.element.appendChild(this.currentItem.imageElement),this.mediasetProps.outgoing||!1!==this.currentItem.opened||(this.currentItem.opened=!0,(0,r.wy)(this.currentItem.fromUserUID,this.mediasetProps.messageId,this.currentItem.mediaId),h._.markOpened(this.mediasetProps.messageId,this.currentItem.mediaId))),this.repositionChildren()}deleteMedia(e){const t=this.mediaList.findIndex((t=>t.mediaId===e));var i;-1!==t&&(this.currentIndex===t&&this.hide(),this.mediaList.splice(t,1),this.currentIndex>t&&(this.currentIndex-=1),1===this.mediaList.length&&(null===(i=this.arrowContainers)||void 0===i||i.hideArrows()))}next(){let e=(this.currentIndex+1)%this.mediaList.length;for(;""===this.mediaList[e].thumbnailUrl;)e=(e+1)%this.mediaList.length;this.displayImage(e)}previous(){let e=this.currentIndex>0?this.currentIndex-1:this.mediaList.length-1;for(;""===this.mediaList[e].thumbnailUrl;)e=e>0?e-1:this.mediaList.length-1;this.displayImage(e)}repositionChildren(){var e;null===(e=this.arrowContainers)||void 0===e||e.repositionArrows(this.element.offsetHeight)}}const c=64,u={width:`${c}px`,height:`${c}px`,margin:"0px 1px",display:"inline-block",backgroundSize:"cover",backgroundPosition:"center",position:"relative",cursor:"pointer",borderRadius:"4px",overflow:"hidden",zIndex:0}},1728:(e,t,i)=>{"use strict";i.d(t,{U:()=>_,i:()=>U});var s=i(6844),n=i(2939),o=i(2709),r=i(8423),a=i(6440),l=i(7407),h=i(1452),d=i(4947),c=i(1372),u=i(4110),p=i(20),m=i(9447),g=i(9461),v=i(1224),f=i(3885),y=i(4364),b=i(4936),w=i(7623),C=i(5276),S=i(3955),x=i(3118),T=i(8785),P=i(7176),k=i(8039),A=i(268);const M="calc(100% - 36px)";class R extends o.u{constructor(e){super("div",e)}initData(e){this.isDropdown=e.isDropdown,this.userColorClass=(0,T.Kb)(e.rawData.otherUser),this.otherUsername=e.rawData.otherUser.username,this.fromUser=e.rawData.fromUsername,this.message=e.rawData.message,this.hasMedia=e.rawData.hasMedia,this.numUnread=e.rawData.numUnread,this.time=e.rawData.time,this.isDropdown=e.isDropdown,this.rawData=e.rawData}getRawData(){return this.rawData}initUI(e){const t={display:"inline-block",left:`${R.CHAT_HEADER_LEFT_PX}px`,position:"absolute",verticalAlign:"bottom",whiteSpace:"nowrap"},i={bottom:"8px",paddingLeft:R.CHAT_HEADER_LEFT_PX-8+"px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",width:M,boxSizing:"border-box"},s=this.getElapsedTimeString(),n=this.getMessagePreview(),o=this.otherUsername!==this.fromUser;o&&(n.style.maxWidth="calc(100% - 14px)");const r=this.numUnread>0&&(""!==this.message||this.hasMedia);this.numUnreadContainer=(0,c.tT)("span",{"data-testid":"unread-message-count"},r?` (${this.numUnread})`:""),this.elapsedTimeContainer=(0,c.tT)("div",{className:"timeString",style:{fontSize:"10px",position:"absolute",right:"8px",textAlign:"right",top:"8px"},"data-testid":"message-timestamp"},s),this.usernameSpan=this.getUsernameSpan({fontFamily:"Tahoma, Arial, Helvetica, sans-serif",fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",verticalAlign:"bottom"}),this.updateUsernameMaxWidth(),this.element=(0,c.tT)("div",{colorClass:["conversationListItem",r?"unreadBg":""],style:{borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",fontFamily:"Tahoma, Arial, Helvetica, sans-serif",fontSize:"12px",height:"40px",lineHeight:"14px",overflowX:"hidden",padding:"8px",position:"relative",textAlign:"left"},"data-testid":"conversation-list-item",onClick:()=>{e.openConversationEvent.fire(this.otherUsername)}},(0,c.tT)(I,{name:this.otherUsername,style:{marginTop:"-16px",position:"absolute",top:"50%"},color:"",size:"32px",userColorClass:this.userColorClass}),(0,c.tT)("div",{style:t,ref:e=>this.chatHeader=e},this.usernameSpan,this.numUnreadContainer,(0,k.It)()&&!this.isDropdown&&(0,c.tT)(A.i,{classRef:e=>this.inRoomIndicator=e,username:this.otherUsername,style:{verticalAlign:"middle",position:"relative",top:"-1px"}})),this.elapsedTimeContainer,(0,c.tT)("div",{colorClass:"messageDiv",style:i,ref:e=>this.messageDiv=e},o&&""!==this.message?(0,P.sx)("replyIconSvg",{display:"inline-block",verticalAlign:"top"}):"",n))}render(){return this.element}hide(){var e;null===(e=this.parent)||void 0===e||e.removeChild(this),this.element.remove(),this.dispose()}dispose(){var e;null===(e=this.inRoomIndicator)||void 0===e||e.dispose()}repositionChildren(){super.repositionChildren(),this.hideElapsedTimeResponsive()}afterDOMConstructed(){super.afterDOMConstructed(),this.hideElapsedTimeResponsive()}updateTimeContainer(){const e=void 0===this.time||this.isEmptyMessage()?"":(0,b.lI)(new Date(this.time));this.elapsedTimeContainer.innerText=e,this.updateUsernameMaxWidth(),this.updateCloseButtonTop()}updateUsernameMaxWidth(){var e,t;if(!this.isDropdown)return;const i=228-(0,S.q_)(null!==(e=this.elapsedTimeContainer.textContent)&&void 0!==e?e:"",this.elapsedTimeContainer)-(0,S.q_)(null!==(t=this.numUnreadContainer.textContent)&&void 0!==t?t:"",this.numUnreadContainer);this.usernameSpan.style.maxWidth=`${i}px`}getUsernameSpan(e){return(0,c.tT)("span",{colorClass:this.userColorClass,style:e,"data-testid":"conversation-list-username"},this.otherUsername)}addCloseBtn(){this.closeButton=(0,P.fh)();const e=this.closeButton;(0,S.ZM)(e,{position:"absolute",right:"8px"}),e.onclick=e=>{e.stopPropagation(),e.preventDefault(),U(this.otherUsername,this.isDropdown)},(0,w.Xb)()?(e.style.display="block",this.messageDiv.style.width=`calc(${M} - 20px)`):(e.style.display="none",(0,S.JR)(this.element).listen((t=>{t?(e.style.display="block",this.elapsedTimeContainer.style.display="none",this.messageDiv.style.width=`calc(${M} - 20px)`):(e.style.display="none",this.elapsedTimeContainer.style.display="block",this.messageDiv.style.width=M)}))),this.updateCloseButtonTop(),this.element.appendChild(e)}updateCloseButtonTop(){void 0!==this.closeButton&&((0,w.Xb)()&&""!==this.elapsedTimeContainer.textContent?this.closeButton.style.top="50%":this.closeButton.style.top="calc(50% - 8px)")}hideElapsedTimeResponsive(){if(this.element.clientWidth>0){const e=this.chatHeader.clientWidth>this.element.clientWidth-R.CHAT_HEADER_LEFT_PX-8-this.elapsedTimeContainer.clientWidth;this.elapsedTimeContainer.style.visibility=e?"hidden":""}}getOtherUsername(){return this.otherUsername}getNumUnread(){return this.numUnread}setNumUnread(e){this.numUnread=e,0===this.numUnread?(this.numUnreadContainer.innerText="",(0,m.SA)(this.element,"unreadBg")):(this.numUnreadContainer.innerText=` (${this.numUnread})`,(0,m.fZ)(this.element,"unreadBg"))}getUserColorClass(){return this.userColorClass}getMessagePreview(){if(""===this.message&&this.hasMedia)return(0,c.tT)("span",null,d.R.imageAttached);const e=new x.j(this.message),t=e.stringParts()[0],i=(0,c.tT)("span",{style:{maxWidth:"100%",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",display:"inline-block"},"data-testid":"message-preview"},t.split("\n")[0]);for(let t=1;t<e.stringParts().length;t+=1){const s=(0,c.tT)("span",{style:{cursor:"pointer"}},`:${e.emoticons()[t-1].name}`);if(i.appendChild(s),""!==e.stringParts()[t]){const s=(0,c.tT)("span",null,e.stringParts()[t]);i.appendChild(s)}}return(0,w.AD)()?i:C.A.parse(i)}isEmptyMessage(){return""===this.message&&!this.hasMedia}getElapsedTimeString(){return void 0===this.time||this.isEmptyMessage()?"":(0,b.lI)(new Date(this.time))}}R.CHAT_HEADER_LEFT_PX=48;const I=e=>{const t={width:e.size,height:e.size,borderRadius:"50%",background:e.color,textAlign:"center",display:"table-cell",fontFamily:"UbuntuLight, Tahoma, Arial, Helvetica, sans-serif",fontSize:"16px",lineHeight:"14px",margin:"auto",verticalAlign:"middle"};return(0,c.tT)("div",{colorClass:"avatarBubble",style:{position:"relative",...e.style}},(0,c.tT)("div",{colorClass:e.userColorClass,style:t},e.name.charAt(0).toLocaleUpperCase()))};var E=i(3910),L=i(4564),D=i(1885);const B=new Set;function U(e,t){t||D.wl.fire(e),y.cV.hide(e),B.forEach((i=>{i.isDms===t&&i.hideConversation(e)})),t&&E.x7.fire({username:e})}class _ extends o.u{get searchPrefix(){return this.searchBar.value.trim()}constructor(e){super("div",e),this.currentIndex=-1,this.currentConversationColorClass="currentConvo",B.add(this),n.X0.listen((e=>{this.room=e.dossier.room,y.cV.clear(),this.addBroadcasterToTopOfDOM()})).addTo(this.listenerGroup),y.yT.conversationDataChanged.listen((e=>{void 0!==e&&(this.room=e.dossier.room),this.updateList()})).addTo(this.listenerGroup),y.yT.conversationRead.listen((e=>{let{username:t,isDm:i}=e;if(i===this.isDms){const e=this.renderedConversations.find((e=>e.getOtherUsername()===t));void 0!==e&&e.setNumUnread(0)}})),y.yT.conversationItemAdded.listen((e=>{if(this.isDms&&""!==e.room||!this.isDms&&""===e.room)return;y.cV.show(e.fromUsername);const t=!this.isDms&&1===this.renderedConversations.length;0===this.renderedConversations.length||t?this.updateList():(this.removeOldConversation(e.otherUser.username),this.addConversationIfPrefixMatch(e,!0))})),u.E3.listen((e=>{y.cV.show(e.username)})),e.openConversationEvent.listen((()=>{e.clearSearchOnSelect&&(this.currentIndex=-1,this.filterConversations("").catch(h.yZ),this.searchBar.clear())})).addTo(this.listenerGroup),this.startTimeContainerUpdates()}startTimeContainerUpdates(){const e=()=>{for(const e of this.renderedConversations)e.updateTimeContainer();window.setTimeout(e,1e4)};window.setTimeout(e,1e4)}conversationIsRendered(e){return this.renderedConversations.findIndex((t=>t.getRawData().otherUser.username===e))>-1}initData(e){this.isDms=!0===e.isDms,this.isFullVideoMode=e.isFullVideoMode,this.inBroadcast=!0===e.inBroadcast,this.listenerGroup=new r.gt,this.renderedConversations=[],this.isRefactorDMFlagActive=(0,a.f)("RefactorDm"),(0,s.ok)()||(this.conversationListData=y.yT.getInstance()),this.openConversationEvent=e.openConversationEvent,this.room="",this.emptyListMessage=(0,c.tT)(F,null)}initUI(e){const t={fontSize:"12px",fontFamily:"UbuntuRegular, Tahoma, Arial, Helvetica, sans-serif",height:"100%",lineHeight:"16px",overflowX:"hidden",overflowY:"hidden",position:"relative",textAlign:"left",width:"100%",zIndex:2,...this.isDms&&{flex:1,display:"flex",flexDirection:"column"}},i={maxHeight:"calc(100% - 32px)",overflowY:"auto",width:"100%",...this.isDms&&{flex:1}};this.conversationBodyRoot=(0,c.tT)("div",{style:i,colorClass:"conversationBodyRoot","data-testid":"conversation-body-root"},(0,c.tT)("div",{className:"loadingDiv",style:{position:"absolute",top:"60px",left:"50%",transform:"translateX(-50%)"}},(0,c.tT)(f.N,null))),this.element=(0,c.tT)("div",{style:t,colorClass:"conversationList"},this.conversationBodyRoot),this.renderSearchBar()}render(){return this.element}repositionChildrenRecursive(){super.repositionChildrenRecursive();for(const e of this.renderedConversations)e.repositionChildrenRecursive()}afterDOMConstructedIncludingChildren(){super.afterDOMConstructedIncludingChildren();for(const e of this.renderedConversations)e.afterDOMConstructedIncludingChildren()}renderSearchBar(){this.searchBar=new L.I({isFullVideoMode:this.isFullVideoMode,room:this.room}),this.searchBar.events.navigateSuggestions.listen((e=>{this.navigateSuggestions(e.event)})).addTo(this.listenerGroup),this.searchBar.events.openCurrentSuggestion.listen((()=>{this.openCurrentSuggestion()})).addTo(this.listenerGroup),this.searchBar.events.inputChange.listen((e=>{e.isFullVideo===this.isFullVideoMode&&(this.currentIndex=-1,e.isValid?this.filterConversations(e.prefix):this.clearConversationListDOM())})).addTo(this.listenerGroup);const e=(0,c.tT)("div",null,this.searchBar.element);this.element.insertBefore(e,this.element.firstChild)}async updateList(){var e;if((0,s.ok)()||this.isRefactorDMFlagActive&&this.isDms&&!1===(null===(e=this.conversationListData)||void 0===e?void 0:e.isInitialDMFetchComplete()))return;this.clearConversationListDOM();const t=await this.addBroadcasterToTopOfDOM();if(void 0!==this.conversationListData){const e=(this.isDms?this.conversationListData.getDms():this.conversationListData.getPms()).filter((e=>this.conversationMatchesPrefix(e)));this.populateConversationsToDOM(e,t)}}dispose(){this.listenerGroup.removeAll(),this.searchBar.dispose()}clearConversationListDOM(){for(;null!==this.conversationBodyRoot.firstChild;)this.conversationBodyRoot.removeChild(this.conversationBodyRoot.firstChild);this.renderedConversations.forEach((e=>e.dispose())),this.renderedConversations=[]}getRoomUserCount(){return this.conversationBodyRoot.childNodes.length}getLastConversation(){var e;return null===(e=this.conversationListData)||void 0===e?void 0:e.getDms()[0]}getMessageThreads(){var e;null===(e=this.conversationListData)||void 0===e||e.getMessageThreads()}shouldAddBroadcaster(e){var t;const i=(null===(t=g.Bm.current.loggedInUser)||void 0===t?void 0:t.username)===this.room;if(""===this.room||i)return!1;const n=void 0===e||this.room.startsWith(e);return!this.isDms&&n&&!this.inBroadcast&&((0,s.ok)()||!i)}async addBroadcasterToTopOfDOM(){const e=this.shouldAddBroadcaster();if(e)if((0,s.ok)()){this.clearConversationListDOM();const e=(0,p.bi)(this.room);this.addConversationIfPrefixMatch(e)}else if(void 0!==this.conversationListData){const t=this.conversationListData.getConversation(this.room);if(void 0===t){const t=await(0,p.ug)(this.room,this.room);return void 0===this.conversationListData.getConversation(this.room)&&(this.clearConversationListDOM(),this.addConversationIfPrefixMatch({message:"",numUnread:0,fromUsername:t.user.username,otherUser:t.user,hasMedia:!1})),e}this.clearConversationListDOM(),this.addConversationIfPrefixMatch(t)}return e}shouldSkipPopulating(e,t){return y.cV.have(e.otherUser.username)?!y.cV.isShowing(e.otherUser.username):!(!t||this.room!==e.otherUser.username)}maybeAddEmptyListMessage(){this.isDms&&""===this.searchPrefix&&0===this.renderedConversations.length&&this.conversationBodyRoot.appendChild(this.emptyListMessage)}populateConversationsToDOM(e,t){e.forEach((e=>{this.shouldSkipPopulating(e,t)||(this.addConversationListItemToDOM(e),this.isDms||p.lX.fire(e.otherUser.username))})),this.maybeAddEmptyListMessage()}addConversationListItemToDOM(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.conversationIsRendered(e.otherUser.username))return;const i=(0,c.tT)(R,{rawData:e,openConversationEvent:this.openConversationEvent,isDropdown:this.isDms,classRef:i=>{const s=e.otherUser.username===this.room;this.isDms||s||i.addCloseBtn(),t?this.isDms||s?this.renderedConversations.unshift(i):this.renderedConversations.splice(1,0,i):this.renderedConversations.push(i)}});if(t){var s;const t=this.conversationBodyRoot.firstChild,n=(null===(s=g.Bm.current.loggedInUser)||void 0===s?void 0:s.username)===this.room,o=e.otherUser.username===this.room;this.isDms||o||n||null===t?this.conversationBodyRoot.insertBefore(i,t):this.conversationBodyRoot.insertBefore(i,t.nextSibling)}else this.conversationBodyRoot.appendChild(i);e.otherUser.username===this.currentConversation&&(0,m.fZ)(i,this.currentConversationColorClass),this.repositionChildrenRecursive(),(0,l.bT)("PmListItemAdded",{rendered_pm_count:this.renderedConversations.length,other_user:e.otherUser.username})}hideConversation(e){const t=this.renderedConversations.find((t=>t.getOtherUsername()===e)),i=!this.isDms&&(null==t?void 0:t.getOtherUsername())===this.room;void 0===t||i||(this.renderedConversations.splice(this.renderedConversations.indexOf(t),1),t.hide(),(0,l.bT)("PmListItemRemoved",{rendered_pm_count:this.renderedConversations.length,other_user:e})),this.maybeAddEmptyListMessage()}async filterConversations(e){let t=!1;if(void 0!==this.conversationListData){this.clearConversationListDOM();const i=this.isDms?this.conversationListData.getDms():this.conversationListData.getPms();if(this.shouldAddBroadcaster(e)){let e;const i=this.conversationListData.getConversation(this.room);e=void 0!==i?i:(0,p.bi)(this.room),this.addConversationListItemToDOM(e),t=!0}const s=i.filter((t=>this.conversationMatchesPrefix(t,e)));this.populateConversationsToDOM(s,t)}}conversationMatchesPrefix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.searchPrefix;return 0===t.length||e.otherUser.username.startsWith(t)}addConversationIfPrefixMatch(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;this.conversationMatchesPrefix(e,i)&&this.addConversationListItemToDOM(e,t)}removeOldConversation(e){let t;for(let i=this.renderedConversations.length-1;i>=0;i-=1){const s=this.renderedConversations[i];s.getOtherUsername()===e&&(t=s,this.renderedConversations.splice(i,1),s.element.remove())}return t}navigateSuggestions(e){if(this.unHighlightSelectedIndex(this.currentIndex),"ArrowDown"===e.key||40===e.keyCode?this.currentIndex=this.currentIndex+1>=this.renderedConversations.length?-1:this.currentIndex+1:"ArrowUp"!==e.key&&38!==e.keyCode||(this.currentIndex=this.currentIndex-1<-1?this.renderedConversations.length-1:this.currentIndex-1),this.currentIndex>-1){const e=this.renderedConversations[this.currentIndex].getOtherUsername();this.highlightSelectedIndex(this.currentIndex,!0),this.searchBar.events.suggestionActiveEvent.fire({slug:e})}else this.searchBar.events.suggestionActiveEvent.fire({slug:""})}openCurrentSuggestion(){if(this.currentIndex>-1){const e=this.renderedConversations[this.currentIndex],t=""===this.room?"PMWindow":"PMTab",i=e.getUserColorClass();(0,l.bT)("PMSearchResultClicked",{location:t,color:i}),this.searchBar.events.suggestionActiveEvent.fire({slug:""}),this.openConversationEvent.fire(e.getOtherUsername())}}highlightSelectedIndex(e,t){if(e>-1){const i=this.renderedConversations[e];if(t){const e=this.conversationBodyRoot.clientHeight,t=i.element.clientHeight;this.conversationBodyRoot.scrollTop=this.currentIndex*t-e/2}(0,m.SA)(i.element,"unreadBg"),(0,m.fZ)(i.element,"selected")}}unHighlightSelectedIndex(e){if(e>-1){const t=this.renderedConversations[e];(0,m.SA)(t.element,"selected"),t.getNumUnread()>0?(0,m.fZ)(t.element,"unreadBg"):(0,m.SA)(t.element,"unreadBg")}}setCurrentConversation(e){this.currentConversation=e,this.renderedConversations.forEach((t=>{t.getOtherUsername()===e?(0,m.fZ)(t.element,this.currentConversationColorClass):(0,m.SA)(t.element,this.currentConversationColorClass)}))}focusSearchBar(){this.searchBar.focus()}}const F=()=>(0,c.tT)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",lineHeight:"20px",padding:"50px",boxSizing:"border-box"}},(0,c.tT)("img",{src:`${STATIC_URL}pms/empty-chat-state.svg`,style:{margin:"13px",width:"30px"},alt:"empty-chat-state"}),(0,c.tT)("span",{style:{fontFamily:"UbuntuBold, Arial, Helvetica, sans-serif",fontSize:"14px"},colorClass:"sendDmPrompt"},d.R.sendDirectMessage),(0,c.tT)("span",{colorClass:"cautionMessage"},d.R.conversationCautionMessage(v.m.siteName)))},4364:(e,t,i)=>{"use strict";i.d(t,{yT:()=>U,cV:()=>B});var s=i(6624),n=i(4936),o=i(5216),r=i(6844),a=i(7437),l=i(2939),h=i(8423),d=i(6440),c=i(1452),u=i(2945),p=i(4110),m=i(7623),g=i(8861),v=i(6784),f=i(1519);class y{constructor(){this.endpoint="api/ts/chatmessages/update_pms_last_seen/",this.queuedPmReads=new Set,this.sendDebouncer=new f.a((()=>{this.sendPost()}),{bounceLimitMS:0,debounceType:1}),(0,v.wu)((0,m.p0)(),window,(()=>this.sendBeacon()))}sendRead(e){this.queuedPmReads.add(e),this.sendDebouncer.callFunc()}getFormData(){if(0===this.queuedPmReads.size)return;this.pmReadsBatch=new Set(this.queuedPmReads),this.queuedPmReads.clear();const e=new FormData;return this.pmReadsBatch.forEach((t=>{e.append("from_usernames",t)})),e.append("csrfmiddlewaretoken",(0,g.I7)("csrftoken")),e}requeueData(){var e;null===(e=this.pmReadsBatch)||void 0===e||e.forEach((e=>this.queuedPmReads.add(e)))}sendPost(){const e=this.getFormData();void 0!==e&&(0,o.KF)(this.endpoint,e).catch((e=>{error("post error marking PMs as read",e),this.requeueData()}))}sendBeacon(){const e=this.getFormData();void 0!==e&&(navigator.sendBeacon((0,o._Y)(this.endpoint),e)||(error("beacon error marking PMs as read"),this.requeueData()))}}class b extends y{constructor(){super(),l.X0.listen((e=>{this.room=e.chatConnection.room()})),l.Gr.listen((()=>{this.sendPost()}))}getFormData(){const e=super.getFormData();return void 0!==e&&void 0!==this.room?(e.append("room",this.room),e):void 0}}class w extends y{constructor(){super(),this.endpoint=(0,d.f)("RefactorDm")?"api/messaging/last-seen/":this.endpoint}}let C,S;var x,T=i(20),P=i(6318),k=i(9461),A=i(7477),M=i(897),R=i(9930),I=i(9525),E=i(3910),L=i(7660),D=i(1885);const B=new class{constructor(){this.showList=new Set,this.hideList=new Set}show(e){this.showList.add(e),this.hideList.delete(e)}hide(e){this.hideList.add(e),this.showList.delete(e)}remove(e){this.showList.delete(e),this.hideList.delete(e)}isShowing(e){return this.showList.has(e)}isHiding(e){return this.hideList.has(e)}have(e){return this.showList.has(e)||this.hideList.has(e)}clear(){this.showList.clear(),this.hideList.clear()}};class U{constructor(){this.isRefactorDMFlagActive=(0,d.f)("RefactorDm"),this.pms=new Map,this.dms=new Map,this.initialDMFetchComplete=!1,this.room="",this.roomListeners=new h.gt,this.listenToMessagePushTopics(),D.wl.listen((e=>{D.Si.fire(e)})),D.Si.listen((e=>{this.markAsRead(e,!1),k.Bm.current.mergePmDm&&this.markAsRead(e,!0)})),D.ot.listen((e=>{this.markAsRead(e.username,!0),k.Bm.current.mergePmDm&&this.markAsRead(e.username,!1)})),D.H4.listen((e=>{this.handleIncomingMessage(e,!0).catch(c.yZ)})),D.J9.listen((e=>{this.handleIncomingMessage(e,!1).catch(c.yZ)})),l.X0.listen((e=>{var t;this.room=e.dossier.room,this.chatConnection=e.chatConnection,this.pms.clear(),this.removeEmptyDms();for(const e of this.dms.values())e.otherUser.isBroadcaster=e.otherUser.username===this.room;void 0!==U.instance&&U.conversationDataChanged.fire(e),(null===(t=k.Bm.current.loggedInUser)||void 0===t?void 0:t.username)!==this.room&&(0,T.ug)(this.room,this.room).then((e=>{e.user.username===this.room&&this.addConversation({message:"",numUnread:0,time:Date.now(),fromUsername:this.room,otherUser:e.user,hasMedia:!1,room:this.room})})).catch(c.yZ),this.listenToRoomPushTopics(e.dossier.roomUid)})),l.Gr.listen((()=>{this.roomListeners.removeAll()})),p.E3.listen((e=>{e.focus&&(this.pms.has(e.username)?U.conversationDataChanged.fire(void 0):(0,T.ug)(e.username,this.room).then((e=>{this.addConversation({message:"",numUnread:0,time:Date.now(),fromUsername:this.room,otherUser:e.user,hasMedia:!1,room:this.room})})).catch(c.yZ))})),p.xw.listen((e=>{var t;let i=!1;const s=this.pms.get(e.username);if(void 0!==s&&(s.otherUser.isMod=e.isMod,i=!0),(null===(t=k.Bm.current.loggedInUser)||void 0===t?void 0:t.username)===this.room){const t=this.dms.get(e.username);void 0!==t&&(t.otherUser.isMod=e.isMod,i=!0)}i&&U.conversationDataChanged.fire(void 0)})),U.conversationLoaded.listen((e=>{var t,i;const s=this.getConversation(e.otherUser.username,void 0===e.room||""===e.room),n=""===(null!==(t=null==s?void 0:s.message)&&void 0!==t?t:"")&&!(null!==(i=null==s?void 0:s.hasMedia)&&void 0!==i&&i),o=""===e.message&&!e.hasMedia;n&&!o&&this.addConversation(e)})),(0,R.r)()&&s.UrlState.current.listenGlobal(["pageType"],(()=>{this.room=""})),this.isRefactorDMFlagActive?this.dmUnreadData=I.B.getInstance():this.getMessageThreads()}static getInstance(){return void 0===U.instance&&(U.instance=new U),U.instance}getMessageThreads(){this.fetchInitialDms().finally((()=>{E.$o.listen((e=>{void 0===this.getConversation(e,!0)&&(0,T.ug)(e).then((t=>{this.addConversation({message:"",numUnread:0,time:Date.now(),fromUsername:e,otherUser:t.user,hasMedia:!1,room:""})})).catch(c.yZ)}))})).catch(c.yZ)}setInitialDMFetchComplete(){this.initialDMFetchComplete=!0,U.initialDMFetchCompleteEvent.fire()}isInitialDMFetchComplete(){return this.initialDMFetchComplete}fetchInitialDms(){if(!(0,T.SU)()||(0,r.ok)())return Promise.resolve();const e=(0,u.Go)({offset:"0"}),t=this.isRefactorDMFlagActive?`api/messaging/threads/?${e}`:`api/ts/chatmessages/pm_users/?${e}`;return(0,o.Aw)(t).then((e=>{this.setInitialDMFetchComplete(),JSON.parse(e.responseText).reverse().forEach((e=>{const t=(0,T.j4)(new n.N6(e));this.addConversation({...t,room:""})})),U.conversationDataChanged.fire(void 0)})).catch((e=>{error("Error fetching dm conversations",e)}))}getDms(){return Array.from(this.dms.values()).reverse()}getPms(){return Array.from(this.pms.values()).reverse()}async handleIncomingMessage(e,t){const i=this.removeConversation(e.otherUsername,t);let s,n;if(void 0===i){const i=await(0,T.ug)(e.otherUsername,t?void 0:this.room);s=i.user,n=t||k.Bm.current.mergePmDm?i.numUnread:1}else s=i.otherUser,n=i.numUnread+1;e.fromUser.username!==e.otherUsername&&(n=0),this.incrUnreadDMCount(t,n,i),this.addConversation({message:e.message,time:Date.now(),numUnread:n,fromUsername:e.fromUser.username,otherUser:s,hasMedia:e.mediaList.length>0,room:t?"":this.room,origMessage:e})}addConversation(e){var t;const i=""===e.room,s=i?this.dms:this.pms;s.delete(e.otherUser.username),s.set(e.otherUser.username,e),U.conversationItemAdded.fire(e),e.fromUsername===(null===(t=k.Bm.current.loggedInUser)||void 0===t?void 0:t.username)&&U.conversationRead.fire({username:e.otherUser.username,isDm:i}),this.isRefactorDMFlagActive&&i||this.updateUnreadCount()}getConversation(e){return(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.dms:this.pms).get(e)}removeConversation(e,t){const i=t?this.dms:this.pms,s=i.get(e);return i.delete(e),s}removeEmptyDms(){var e;const t=null===(e=E.qt.getInstance())||void 0===e?void 0:e.shownWindowUsername();this.dms.forEach(((e,i)=>{""!==e.message||e.hasMedia||i===t||this.dms.delete(i)}))}markAsRead(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=(t?this.dms:this.pms).get(e);var n;void 0!==s&&0!==s.numUnread&&(s.numUnread=0,U.conversationRead.fire({username:e,isDm:t}),this.isRefactorDMFlagActive&&t?null===(n=this.dmUnreadData)||void 0===n||n.decrUnreadCount():this.updateUnreadCount(),i||function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(void 0===S&&(S=new w),S.sendRead(e)):(void 0===C&&(C=new b),C.sendRead(e))}(e,t))}updateUnreadCount(){U.unreadConversationsCountUpdate.fire({dmsCount:[...this.dms.values()].filter((e=>e.numUnread>0)).length,pmsCount:[...this.pms.values()].filter((e=>e.numUnread>0)).length})}incrUnreadDMCount(e,t,i){var s;this.isRefactorDMFlagActive&&e&&t>0&&(!i||0===i.numUnread)&&(null===(s=this.dmUnreadData)||void 0===s||s.incrUnreadCount())}isPrivateShowMessage(e){var t,i,s;const n=null!==(t=null===(i=this.chatConnection)||void 0===i?void 0:i.getPrivateShowUser())&&void 0!==t?t:"";return!0===(null===(s=this.chatConnection)||void 0===s?void 0:s.inPrivateRoom())&&(e.otherUsername===n||e.otherUsername===this.room)&&""!==e.room}listenToMessagePushTopics(){var e;const t=null===(e=k.Bm.current.loggedInUser)||void 0===e?void 0:e.userUid;void 0!==t&&(new M.y8(t).onMessage.listen((e=>{if(this.isPrivateShowMessage(e)&&void 0!==this.chatConnection){if(e.otherUsername===this.chatConnection.getPrivateShowUser()||e.otherUsername===this.room){const t={...e,isPrivateShowMessage:!0};(0,a.V8)(t,this.room,e.room)}}else(0,a.V8)(e,this.room,e.room)})),new M.gV(t).onMessage.listen((e=>{L._.markOpened(e.messageId,e.mediaId),this.pms.forEach((t=>{var i;t.hasMedia&&(null===(i=t.origMessage)||void 0===i||i.mediaList.forEach((t=>{t.mediaId===e.mediaId&&(t.opened=!0)})))}))})),new M.vs(t).onMessage.listen((e=>{e.isCompliance?P.C0.fire(e.mediaId):P.bs.fire(e.mediaId)})),new M.IX(t).onMessage.listen((e=>{k.Bm.current.mergePmDm?(this.markAsRead(e.otherUsername,!0,!0),this.markAsRead(e.otherUsername,!1,!0)):""===e.room||void 0===e.room?this.markAsRead(e.otherUsername,!0,!0):e.room===this.room&&this.markAsRead(e.otherUsername,!1,!0)})))}listenToRoomPushTopics(e){new A.H1(e).onMessage.listen((e=>{var t;let i=!1;const s=this.pms.get(e.fromUser.username);if(void 0!==s&&(s.otherUser.inFanclub=!0,i=!0),(null===(t=k.Bm.current.loggedInUser)||void 0===t?void 0:t.username)===this.room){const t=this.dms.get(e.fromUser.username);void 0!==t&&(t.otherUser.inFanclub=!0,i=!0)}i&&U.conversationDataChanged.fire(void 0)})).addTo(this.roomListeners),new A.HW(e).onMessage.listen((e=>{var t;const i=null===(t=k.Bm.current.loggedInUser)||void 0===t?void 0:t.username;i===this.room?E.x7.fire({username:e.username}):i===e.username&&E.x7.fire({username:this.room})})).addTo(this.roomListeners)}}(x=U).conversationDataChanged=new h.c_("conversationDataChanged"),x.conversationItemAdded=new h.c_("conversationItemAdded"),x.unreadConversationsCountUpdate=new h.c_("unreadConversationsCountUpdate"),x.conversationRead=new h.c_("conversationRead"),x.conversationLoaded=new h.c_("conversationLoaded"),x.initialDMFetchCompleteEvent=new h.c_("initialDMFetchComplete")},637:(e,t,i)=>{"use strict";i.d(t,{D:()=>b,W:()=>w});var s=i(7623),n=i(5216),o=i(2709),r=i(8423),a=i(6440),l=i(4947),h=i(1372),d=i(5389),c=i(9461),u=i(1728),p=i(4364),m=i(4500),g=i(3910),v=i(1585),f=i(1885);const y="changePopoutConvo";class b{static show(e){if(b.showingEvent.fire(),void 0!==this.popout&&!this.popout.closed)if((0,s.OF)())this.popout.close();else if(void 0!==this.popout[y])return this.popout.focus(),void window.setTimeout((()=>{document.hasFocus()?b.openNewPopoutWindow(e):void 0!==this.popout&&void 0!==this.popout[y]&&this.popout[y](e)}),0);b.openNewPopoutWindow(e)}static openNewPopoutWindow(e){let t="/dm/";void 0!==e&&(t+=`${e}/`);const i=(screen.width/2-425).toString(),s=`resizable,dependent,scrollbars,height=768,width=850,top=${(screen.height/2-384).toString()},left=${i}`;(0,d.aH)(t,"dmpopout",s).then((e=>{this.popout=e})).catch((()=>{}))}}b.showingEvent=new r.c_("DmPopoutShowingEvent");class w extends o.u{constructor(e){var t;super("div",e),this.bindListeners(),window[y]=e=>{void 0!==e&&this.showConversation(e)},void 0!==e.username&&e.username!==(null===(t=c.Bm.current.loggedInUser)||void 0===t?void 0:t.username)&&g.$o.fire(e.username)}initData(e){super.initData(e),this.conversationListData=p.yT.getInstance(),this.dmList=new u.U({isDms:!0,clearSearchOnSelect:!1,isFullVideoMode:!1,openConversationEvent:g.$o}),this.dmWindowsMap=new Map,(0,a.f)("RefactorDm")&&this.conversationListData.getMessageThreads()}initUI(e){super.initUI(e),this.element=(0,h.tT)("div",{style:{display:"flex",justifyContent:"space-between",height:"100%"},colorClass:"DmPopout",className:"fill-view-height"},(0,h.tT)("div",{style:{width:"300px",display:"inline-flex",flexDirection:"column",borderRightStyle:"solid",borderRightWidth:"1px",flexShrink:0},colorClass:"dmListContainer","data-testid":"dm-convo-list"},(0,h.tT)("div",{style:{paddingLeft:"8px",height:"34px",display:"flex",flexDirection:"column",justifyContent:"center",borderBottomWidth:"2px",borderBottomStyle:"solid",fontFamily:"UbuntuRegular, Tahoma, Arial, Helvetica, sans-serif",fontSize:"14px"},colorClass:"header"},(0,h.tT)("span",null,l.R.directMessageLabel,(0,h.tT)("span",{style:{marginLeft:"4px"},ref:e=>this.numUnreadDOM=e,"data-testid":"unread-conversation-count"}))),this.dmList.element),(0,h.tT)("div",{style:{width:"calc(100vw - 301px)",display:"inline-block",flexGrow:1},ref:e=>this.dmWindowContainer=e}))}bindListeners(){f.H4.listen((e=>{var t;null===(t=this.dmWindowsMap.get(e.otherUsername))||void 0===t||t.handleNewMessage(e)})),g.$o.listen((e=>{this.showConversation(e)})),g.x7.listen((e=>{var t;let{username:i,deleteWindow:s}=e;(null===(t=this.currentDmWindow)||void 0===t?void 0:t.username)===i&&this.hideCurrentDmWindow(),!0===s&&this.dmWindowsMap.delete(i)})),p.yT.conversationRead.listen((e=>{let{username:t,isDm:i}=e;if(i){const e=this.dmWindowsMap.get(t);null==e||e.markRead()}})),p.yT.unreadConversationsCountUpdate.listen((e=>{let{dmsCount:t}=e;this.updateNumUnread(t)})),(0,v.L)((e=>this.dmWindowsMap.get(e)))}showConversation(e){var t,i;let s=this.dmWindowsMap.get(e);if(void 0===s)s=new m.H2(e),this.dmWindowsMap.set(e,s);else if(s===this.currentDmWindow)return void s.scrollAndFocus();this.hideCurrentDmWindow(),this.dmWindowContainer.appendChild(s.element),s.setIsShowing(!0),s.openOrCollapseWindow(!0,!0),this.dmList.setCurrentConversation(e),this.currentDmWindow=s,document.title=l.R.directMessagesPageTitle(null!==(t=null===(i=c.Bm.current.loggedInUser)||void 0===i?void 0:i.username)&&void 0!==t?t:"",e),window.history.pushState("","",(0,n._Y)(`/dm/${e}`))}hideCurrentDmWindow(){var e;null===(e=this.currentDmWindow)||void 0===e||e.removeFromDOM(),this.currentDmWindow=void 0}updateNumUnread(e){this.numUnreadDOM.textContent=e>0?`(${e})`:""}}},9525:(e,t,i)=>{"use strict";i.d(t,{B:()=>o});var s=i(5216),n=i(8423);class o{constructor(){this.unreadCount=0,this.fetchUnreadData()}static getInstance(){return void 0===o.instance&&(o.instance=new o),o.instance}async fetchUnreadData(){try{const e=await(0,s.Aw)("/api/messaging/unread/"),t=JSON.parse(null==e?void 0:e.responseText);this.unreadCount=t.unread_count,o.unreadDataUpdated.fire({unread:this.unreadCount})}catch(e){error("Error fetching DM unread status",e)}}getUnreadCount(){return this.unreadCount}incrUnreadCount(){this.unreadCount+=1,o.unreadDataUpdated.fire({unread:this.unreadCount})}decrUnreadCount(){this.unreadCount>0&&(this.unreadCount-=1,o.unreadDataUpdated.fire({unread:this.unreadCount}))}}o.unreadDataUpdated=new n.c_("unreadDataUpdated")},227:(e,t,i)=>{"use strict";i.d(t,{_I:()=>g,vs:()=>v});var s=i(6844),n=i(5746),o=i(2396),r=i(7407),a=i(3587),l=i(5173),h=i(8785),d=i(4947),c=i(1372),u=i(3417),p=i(9757),m=i(2394);function g(){return v.isVisible}class v extends l.Q{constructor(e){super(),this.props=e,this.tearDown=()=>{var e;this.props.tearDownFunc(),null===(e=this.reactUserNote)||void 0===e||e.dispose(),v.isVisible=!1},this.popoutConversation=()=>{this.props.popoutFunc(),this.tearDown()},this.ignoreUser=()=>{this.props.ignoreFunc(),this.tearDown()},this.unignoreUser=()=>{this.props.unignoreFunc(),this.tearDown()},this.reportUser=()=>{void 0!==this.lastReceivedMessage?((0,r.bT)("reportPMUser",{location:"PMWindow"}),this.chatReport=new n.V(this.props.userInfo.username,this.lastReceivedMessage,this.ignoreUser),this.element.removeChild(this.menuContents),this.element.appendChild(this.chatReport.element),this.chatReport.focusForm(),this.chatReport.closeChatReportRequest.listen((()=>{this.tearDown()}))):error("PMUserContextMenu - reporting with no received message")},this.element=this.createMenuContents(),v.isVisible=!0,this.overlayClick.listen((()=>{this.element.style.display="none",this.tearDown()}))}createMenuContents(){var e,t;const i={display:"inline-block",cssFloat:"right",verticalAlign:"top",width:"36px",marginRight:"8px"};(0,o.b)(this.props.userInfo.username).then((e=>{this.menuRightSpan.replaceWith((0,c.tT)("span",{style:i},(0,c.tT)(b,{menuData:e}),(0,c.tT)(w,{gender:e.gender}))),e.online&&(this.element.insertBefore((0,c.tT)(f,{imgURL:e.imageUrl}),this.menuContents),this.props.dontRepositionForThumbnail||(this.element.style.top="-75px"))})).catch((e=>{error("Could not process user menu request",{username:this.props.userInfo.username,reason:e.toString()})})),this.ucmDescription=(0,c.tT)(C,{user:this.props.userInfo});const n=this.createUcmLinks(),r=document.createElement("div"),l=p.c.get("UserNote");this.reactUserNote=new l({username:this.props.userInfo.username,handleInputFocus:m.O,badgeManager:a.T.getOrCreateInstance(),isNotLoggedIn:s.rC,removeMenu:this.tearDown},r);const h=null!==(e=null===(t=this.props.usernameLabel)||void 0===t?void 0:t.element)&&void 0!==e?e:(0,c.tT)(y,{userInfo:this.props.userInfo});return(0,c.tT)("div",{style:{borderWidth:"1px",borderStyle:"solid",borderRadius:"4px",fontFamily:"Tahoma, Arial, Helvetica, sans-serif",cursor:"initial",display:"none",position:"absolute",left:"0px",top:"0",minWidth:"188px",maxWidth:"220px",zIndex:1001},colorClass:"pmUcmContainer",onClick:e=>e.stopPropagation(),"data-testid":"dm-ucm-container"},(0,c.tT)("div",{ref:e=>this.menuContents=e},(0,c.tT)("div",{style:{padding:"9px 0 4px 9px",position:"relative",overflow:"hidden",boxSizing:"border-box"},colorClass:"pmUcmHeader"},h,(0,c.tT)("span",{style:i,ref:e=>this.menuRightSpan=e},(0,c.tT)("span",{colorClass:"placeholder",style:{width:"14px",height:"14px",cssFloat:"left"}}),(0,c.tT)("span",{colorClass:"placeholder",style:{width:"14px",height:"14px",cssFloat:"right"}}))),this.ucmDescription,n,r))}createUcmLinks(){return(0,c.tT)("ul",{style:{borderTopWidth:"1px",borderTopStyle:"solid",listStyle:"none",padding:"5px 0",margin:0},colorClass:"pmUcmLinks"},this.props.includePopoutLink&&(0,c.tT)(S,{iconColorClass:"pmUcmPopoutIcon",innerText:d.R.popoutInNewWindow,clickHandler:this.popoutConversation,newIconStyle:{width:"12px",height:"12px",marginBottom:"1px"},dataid:"dm-popout"}),(0,c.tT)(S,{iconColorClass:"pmUcmIgnoreIcon",innerText:(0,u.pi)(this.props.userInfo.username)?d.R.unignoreThisUserText:d.R.ignoreThisUserText,clickHandler:(0,u.pi)(this.props.userInfo.username)?this.unignoreUser:this.ignoreUser,dataid:"ignore-toggle"}),(0,c.tT)(S,{ref:e=>this.reportLinkItem=e,iconColorClass:"pmUcmReportIcon",innerText:d.R.reportThisUserText,clickHandler:this.reportUser,newLinkItemStyle:void 0!==this.lastReceivedMessage?{}:{display:"none"},dataid:"report-room"}))}setLastReceivedMessage(e){void 0!==e&&(this.lastReceivedMessage=e,this.reportLinkItem.style.display="flex")}render(){return this.element}}const f=e=>(0,c.tT)("div",{style:{width:"100%",height:"75px",overflow:"hidden",borderRadius:"4px 4px 0px 0px"}},(0,c.tT)("img",{style:{position:"relative",width:"188px",top:"-50%",left:"50%",transform:"translateX(-50%)"},src:e.imgURL,"data-testid":"thumbnail"})),y=e=>{const t=(0,c.tT)("a",{href:`/${e.userInfo.username}/`,target:"_blank",rel:"noopener noreferrer","data-testid":"username",style:{fontWeight:"bold",textDecoration:"none",overflow:"hidden",textOverflow:"ellipsis",width:"120px",display:"inline-block",cursor:"pointer"},onClick:t=>{(0,r.bT)("ViewProfile",{username:e.userInfo.username}),t.stopPropagation()}},e.userInfo.username);return t.onmouseenter=()=>{t.style.textDecoration="underline"},t.onmouseleave=()=>{t.style.textDecoration="none"},t},b=e=>{var t;const i={display:"inline-block",width:"15px",minHeight:"14px",fontSize:"12px",fontWeight:"bold",marginRight:"6px",verticalAlign:"top",...e.newAgeStyle};let s="";return!0===(null===(t=e.menuData)||void 0===t?void 0:t.canAccess)&&!isNaN(e.menuData.displayAge)&&e.menuData.displayAge>=18&&(s=e.menuData.displayAge),i.background="",(0,c.tT)("span",{style:i,colorClass:"ageIcon","data-testid":"age"},s)},w=e=>{const t={display:"inline-block",width:"15px",height:"14px",verticalAlign:"top",...e.newGenderSpanStyle},i={display:"inline-block",width:"14px",height:"14px",...e.newGenderIconStyle};let s=(0,c.tT)("img",null);return void 0!==e.gender&&""!==e.gender&&(s=(0,c.tT)("img",{style:i,src:(0,h.e0)(e.gender),title:d.R.genderSymbolToIconTitle(e.gender),"data-testid":"gender-icon"})),(0,c.tT)("span",{style:t},s)},C=e=>{const t=(0,h.DG)(e.user),i=(0,h.Kb)(e.user),s=(0,h.LD)(e.user);if(void 0!==t){const e={padding:"9px 10px",borderTopWidth:"1px",borderTopStyle:"solid",fontSize:"12px"},n={height:"12px",width:"100%",fontWeight:"bold"},o={height:"10px",fontSize:"10px",marginTop:"4px",WebkitTextSizeAdjust:"none"};let r="";return void 0!==s&&(r=(0,c.tT)("div",{style:o},s)),(0,c.tT)("div",{style:e,colorClass:"pmUcmDescription"},(0,c.tT)("div",{style:n,colorClass:i,"data-testid":"user-label"},t),r)}},S=e=>{const t={display:"flex",padding:"3px 8px 3px 12px",whiteSpace:"nowrap",fontWeight:"normal",fontFamily:"Tahoma, Arial, Helvetica, sans-serif",fontSize:"12px",WebkitTextSizeAdjust:"none",cursor:"pointer",boxSizing:"border-box",...e.newLinkItemStyle},i={flexShrink:0,padding:"0px 4px 0px 0px",width:"14px",height:"14px",display:"inline-block",marginRight:"4px",marginTop:"2px",...e.newIconStyle};return(0,c.tT)("li",{style:t,onClick:e.clickHandler,colorClass:"pmUcmLinkItem"},(0,c.tT)("span",{style:i,colorClass:e.iconColorClass}),(0,c.tT)("span",{style:{fontWeight:"normal",fontFamily:"Tahoma, Arial, Helvetica, sans-serif",fontSize:"12px",overflow:"hidden",textOverflow:"ellipsis",WebkitTextSizeAdjust:"none"},"data-testid":e.dataid},e.innerText))}},2394:(e,t,i)=>{"use strict";i.d(t,{O:()=>n,Z:()=>s});const s=new(i(8423).c_)("requestDmInputFocus",{listenersWarningThreshold:1,reportIfNoListeners:!1});function n(e){s.listenerCount()>0?s.fire(e):e instanceof HTMLElement&&e.focus()}},4500:(e,t,i)=>{"use strict";i.d(t,{Jn:()=>ae,sG:()=>le,wV:()=>he,H2:()=>de,s2:()=>oe});var s=i(4936),n=i(7623),o=i(6784),r=i(213),a=i(5216),l=i(2939),h=i(2709),d=i(5020),c=i(3955),u=i(8423),p=i(9060),m=i(7463),g=i(7407),v=i(1452),f=i(8785),y=i(4947),b=i(1372),w=i(3860),C=i(1474),S=i(9461),x=i(1679),T=i(2394);class P extends h.u{constructor(e,t){super(),this.username=e,this.removeUI=t,this.tokenBalance=0,this.tipAmountChange=()=>{(0,x.Pt)(this.tipInputDOM),this.checkValidTip(),this.isHighTipAmountWarningActive&&this.resetTipButtonText()},this.handleTipKeyPress=e=>{"Enter"===e.code&&(this.sendTipFn(),e.preventDefault())},this.sendTipFn=()=>{if(!(0,x.sI)(this.tipInputDOM.value))return void(0,r.Q$)(y.R.tipAmountInvalid);const e=parseInt(this.tipInputDOM.value);if(S.Bm.current.isNoninteractiveUser)(0,r.Q$)(y.R.internalStaffTip);else if(e>this.tokenBalance)(0,x.qr)(y.R.notEnoughTokensMessage,S.Bm.current.PurchaseEventSources.TOKEN_SOURCE_LOW_TOKEN_BALANCE);else{if((0,g.bT)("SendTipClicked",{amount:e,location:"DmWindow"}),e>100&&!this.isHighTipAmountWarningActive)return this.setTipButtonText(y.R.tipConfirmationMessage(e)),this.isHighTipAmountWarningActive=!0,void this.sendTipButtonDOM.focus();(0,C.ae)({roomName:this.username,tipAmount:this.tipInputDOM.value,message:this.tipMessageDOM.value,source:"DM",tipRoomType:f.CJ.DM,tipType:"public",videoMode:w.L.getVideoMode()}).then((t=>{t.success?((0,g.bT)("SendTipSuccess",{amount:e,location:"DmWindow"}),this.hideTipping()):void 0!==t.error?!0===t.showPurchaseLink?(0,x.qr)(t.error):(0,r.Q$)(t.error):(error("unknown send tip error"),(0,r.Q$)(y.R.errorSendingTip)),this.tipMessageDOM.value="",void 0!==t.tipsInPast24Hours&&C.ew.fire({tokens:t.tipsInPast24Hours,roomName:this.username})})).catch((e=>{error(`Error sending tip (${e})`),(0,r.Q$)(y.R.errorSendingTip)})).finally((()=>{this.resetTipButtonText()}))}},this.hideTipping=()=>{this.removeUI()},this.listenerGroup=new u.gt,this.isHighTipAmountWarningActive=!1,this.updateCurrentTipBalance(),C.D.listen((e=>{this.updateTokenBalance(e.tokens)}),!1).addTo(this.listenerGroup)}createOverlay(){const e={display:"block",width:"100%",height:`calc(100% - ${le.headerHeight})`,position:"absolute",bottom:0,left:0,cursor:"pointer"};return this.overlay=(0,b.tT)("div",{style:e,colorClass:"dmWindowTipOverlay",onClick:this.hideTipping}),this.overlay}createUI(){return this.tipInputDOM=(0,x.Gz)("tipInput"),(0,c.ZM)(this.tipInputDOM,{width:"69px",height:"24px",borderWidth:"1px",borderStyle:"solid",boxSizing:"border-box",borderRadius:"4px",marginLeft:"5px"}),(0,o.wu)("input",this.tipInputDOM,this.tipAmountChange),(0,o.wu)("keydown",this.tipInputDOM,this.handleTipKeyPress),(0,o.wu)("pointerdown",this.tipInputDOM,T.O),this.element=(0,b.tT)("div",{colorClass:"dmWindowTipCallout",style:{position:"absolute",bottom:"0px",right:"0px",height:"183px",minWidth:"280px",maxWidth:"100%",fontSize:"12px",zIndex:999},"data-testid":"dm-window-tip-callout"},(0,b.tT)("div",{style:{height:"31px",lineHeight:"31px",borderRadius:"4px 4px 0px 0px",padding:"0 6px"},colorClass:"titleBar"},(0,b.tT)("span",{style:{fontSize:"14px",fontWeight:"bold"}},y.R.sendTipText),(0,b.tT)(ae,{style:{right:"5px",top:"-4px",cursor:"pointer"},clickHandler:this.hideTipping})),(0,b.tT)("div",{style:{padding:"6px",boxSizing:"border-box"}},(0,b.tT)("div",null,(0,b.tT)("span",null,y.R.currentBalanceText),(0,b.tT)("span",{style:{margin:"0 5px",display:"inline-block",width:"90px"},"data-testid":"token-balance",colorClass:"tokenBalance",ref:e=>this.currentBalanceDOM=e}),(0,b.tT)("a",{onClick:()=>{(0,x.di)({source:S.Bm.current.PurchaseEventSources.TOKEN_SOURCE_PRIVATE_MESSAGE_WINDOW})},colorClass:"purchaseLink","data-testid":"purchase-tokens",style:{textDecoration:"underline",cursor:"pointer"},ref:e=>this.getMoreLinkDOM=e},y.R.getMoreLabel)),(0,b.tT)("div",null,(0,b.tT)("span",null,y.R.tipAmountText),this.tipInputDOM,(0,b.tT)("span",{style:{marginLeft:"8px",display:"none"},colorClass:"tokenInputError",ref:e=>{this.wrongTipNoticeDOM=e}},y.R.invalidAmount)),(0,b.tT)("div",null,y.R.TipOptionalMessageLabel),(0,b.tT)("textarea",{style:{width:"100%",height:"32px",borderRadius:"4px",resize:"none",borderWidth:"1px",borderStyle:"solid",margin:"5px 0 0 0",boxSizing:"border-box"},"data-testid":"tip-message-textarea",colorClass:"tipMessage",onPointerDown:T.O,ref:e=>this.tipMessageDOM=e}),(0,b.tT)("div",{style:{width:"100%",display:"flex",justifyContent:"flex-end",marginTop:"5px"}},(0,b.tT)("button",{style:{boxSizing:"border-box",maxWidth:"100%",height:"32px",fontSize:"14px",fontWeight:"bold",cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},colorClass:"sendTipButton","data-testid":"send-tip-button",onClick:this.sendTipFn,ref:e=>this.sendTipButtonDOM=e},y.R.sendTipToUser(this.username))))),this.element}dispose(){this.listenerGroup.removeAll()}focus(){(0,T.O)(this.tipInputDOM),this.tipInputDOM.setSelectionRange(0,9999)}setFields(e,t){void 0!==e&&(this.tipInputDOM.value=String(e)),void 0!==t&&(this.tipMessageDOM.value=t),this.checkValidTip(),this.updateCurrentTipBalance()}updateCurrentTipBalance(){(0,C.kb)(this.username).then((e=>{this.tokenBalance=e.tokenBalance,this.currentBalanceDOM.innerText=`${e.tokenBalance} ${y.R.tokenOrTokensText(e.tokenBalance,!1)}`})).catch(v.yZ)}updateTokenBalance(e){this.currentBalanceDOM.innerText=`${e} ${y.R.tokenOrTokensText(e,!1)}`}checkValidTip(){(0,x.sI)(this.tipInputDOM.value)?(this.hideInvalidTipNotice(),this.sendTipButtonDOM.style.cursor="pointer",this.sendTipButtonDOM.disabled=!1):(this.showInvalidTipNotice(),this.sendTipButtonDOM.style.cursor="",this.sendTipButtonDOM.disabled=!0)}showInvalidTipNotice(){this.wrongTipNoticeDOM.style.display=""}hideInvalidTipNotice(){this.wrongTipNoticeDOM.style.display="none"}setTipButtonText(e){this.sendTipButtonDOM.textContent=e,this.sendTipButtonDOM.title=e}resetTipButtonText(){this.setTipButtonText(y.R.sendTipToUser(this.username)),this.isHighTipAmountWarningActive=!1}}class k extends P{constructor(e,t){super(e,t)}createOverlay(){return this.overlay=(0,b.tT)("div",{style:{display:"block",width:"100%",position:"absolute",top:0,right:0,bottom:0,left:0},colorClass:"dmWindowTipOverlay",onClick:this.hideTipping}),this.overlay}createUI(){const e=super.createUI();return(0,c.ZM)(e,{bottom:"",height:"",top:"50%",left:"50%",transform:"translate(-50%, -50%"}),(0,c.ZM)(this.tipInputDOM,{fontSize:"16px",fontFamily:"UbuntuRegular, Helvetica, Arial, sans-serif"}),(0,c.ZM)(this.tipMessageDOM,{fontSize:"16px",fontFamily:"UbuntuRegular, Helvetica, Arial, sans-serif"}),(0,c.ZM)(this.wrongTipNoticeDOM,{marginLeft:""}),(0,c.ZM)(this.getMoreLinkDOM,{display:"block",textAlign:"right"}),e}showInvalidTipNotice(){this.wrongTipNoticeDOM.style.display="block"}}var A,M=i(7569),R=i(4110),I=i(20),E=i(9447),L=i(3910);class D extends h.u{constructor(e){super("div",e),this.props=e,this.isInputExpanded=!1,this.disableSend=!0,this.disableTip=!0}initData(e){this.listenerGroup=new u.gt,R.n2.listen((e=>{this.emojiButton})).addTo(this.listenerGroup)}initUI(e){const t={position:"absolute",bottom:"0",width:"calc(100% - 4px)",height:this.trueHeight(!1),margin:"0px 2px 3px",boxSizing:"border-box",borderWidth:"1px",borderStyle:"solid",borderRadius:"2px"};this.element=(0,b.tT)("div",{style:t,colorClass:"dmWindowInput"},(0,b.tT)("textarea",{style:{position:"absolute",width:"100%",resize:"none",boxSizing:"border-box",backgroundColor:"transparent",border:"none",outline:"none",fontFamily:"Tahoma, Helvetica, Arial, sans-serif",fontSize:"12px",padding:"8px 0 0 8px"},className:"noScrollbar",placeholder:y.R.sendAMessageDesktop,maxLength:oe,ref:e=>this.inputBar=e,onKeyDown:e=>this.keyDownHandler(e),onInput:()=>this.expandOrCollapseInputBar(),onFocus:e.onFocus,onPointerDown:e=>this.focus(e),"data-testid":"dm-input"}),(0,b.tT)("div",{style:{position:"absolute",bottom:"4px",right:"0px",padding:"2px 6px 0px",margin:"4px 0px"},ref:e=>this.buttonsContainer=e},(0,b.tT)("span",{style:{height:"23px",width:"47px",borderRadius:"4px",fontSize:"12px",lineHeight:"14px",cursor:"pointer",padding:"4px"},colorClass:["sendButton","disabled"],onClick:()=>this.submit(),ref:e=>this.sendDmButton=e,"data-testid":"dm-send-button"},y.R.sendCAPS),(0,b.tT)("span",{style:{height:"23px",width:"47px",borderRadius:"4px",fontSize:"12px",lineHeight:"14px",padding:"4px",cursor:"pointer",marginLeft:"4px",display:"none"},colorClass:["tipButton"],onClick:()=>this.props.showTipping(),ref:e=>this.sendTipButton=e,"data-testid":"dm-tip-button"},y.R.tipCAPS)))}enableSend(){this.disableSend=!1,(0,E.SA)(this.sendDmButton,"disabled")}enableTip(){this.disableTip=!1,this.sendTipButton.style.display=""}focus(e){(0,T.O)(null!=e?e:this.inputBar)}blur(){this.inputBar.blur()}isFocused(){return document.activeElement===this.inputBar}dispose(){this.listenerGroup.removeAll()}submit(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.disableSend)return;if(S.Bm.current.isNoninteractiveUser)return void(0,r.Q$)(y.R.internalStaffMessage);const t=this.inputBar.value.trim();if(this.inputBar.value="",this.expandOrCollapseInputBar(),e&&this.focus(),""===t)return;const i=(0,M.PR)(t,"DM");if(i.messageType===M.gW.TipRequest){const e=i;this.handleTipRequestMessage(e)}else(0,I.F_)({message:t,username:this.props.toUsername,source:"DM"}).catch((e=>{this.props.sendDmFailedCallback(e)}))}handleTipRequestMessage(e){this.disableTip||this.props.showTipping(e.messageData.amount,e.messageData.message)}keyDownHandler(e){switch(e.keyCode){case 76:(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),L.x7.fire({username:this.props.toUsername}));break;case 13:e.shiftKey||(e.preventDefault(),this.submit())}}expandOrCollapseInputBar(){const e=this.buttonsContainer.getBoundingClientRect().x-this.element.getBoundingClientRect().x;(0,c.q_)(this.inputBar.value,this.inputBar)>=e-20||this.inputBar.value.includes("\n")?(()=>{this.isInputExpanded||(this.props.onInputExpand(),this.element.style.height=this.trueHeight(!0),this.isInputExpanded=!0)})():(()=>{this.isInputExpanded&&(this.props.onInputCollapse(),this.element.style.height=this.trueHeight(!1),this.isInputExpanded=!1)})()}render(){return this.element}trueHeight(e){return`calc(${e?D.expandedHeight:D.height} - 3px)`}}(A=D).height="38px",A.expandedHeight="76px";class B extends D{constructor(e){super(e)}initUI(e){this.element=(0,b.tT)("div",{style:{bottom:"1px",width:"100%",height:"33px",borderWidth:"1px",borderStyle:"solid",borderRadius:"2px",boxSizing:"border-box",display:"flex"},colorClass:"dmWindowInput"},(0,b.tT)("textarea",{style:{width:"274px",resize:"none",boxSizing:"border-box",backgroundColor:"transparent",border:"none",outline:"none",fontFamily:"Tahoma, Helvetica, Arial, sans-serif",fontSize:"16px",padding:"6px 0 0 6px"},className:"noScrollbar",placeholder:y.R.sendAMessageDesktop,maxLength:oe,ref:e=>this.inputBar=e,onKeyDown:e=>this.keyDownHandler(e),onInput:()=>this.expandOrCollapseInputBar(),"data-testid":"dm-input"}),(0,b.tT)("div",{style:{padding:"0 3px 3px 3px",display:"flex",alignItems:"flex-end"},ref:e=>this.buttonsContainer=e},(0,b.tT)("span",{style:{borderRadius:"4px",fontSize:"12px",lineHeight:"14px",cursor:"pointer",padding:"4px"},colorClass:["sendButton","disabled"],onClick:()=>this.submit(!1),ref:e=>this.sendDmButton=e,"data-testid":"dm-send-button"},y.R.sendCAPS),(0,b.tT)("span",{style:{borderRadius:"4px",fontSize:"12px",lineHeight:"14px",padding:"4px",cursor:"pointer",marginLeft:"4px",display:"none"},colorClass:["tipButton"],onClick:()=>this.props.showTipping(),ref:e=>this.sendTipButton=e,"data-testid":"dm-tip-button"},y.R.tipCAPS)))}handleTipRequestMessage(e){this.disableTip||this.props.showTipping(e.messageData.amount,e.messageData.message,(0,n.OF)())}}var U=i(4580),_=i(7789),F=i(8936),N=i(3417),O=i(897),H=i(1224),W=i(5052),$=i(442),V=i(3885),z=i(7596),G=i(4364);class q{constructor(){this.historyDms=new Set,this.newDms=new Set}filterDuplicates(e,t){const i=t?this.historyDms:this.newDms,s=t?this.newDms:this.historyDms;if(void 0===i||void 0===s)return e;if(0===s.size)return e.forEach((e=>i.add(e.messageID))),e;{const t=e.filter((e=>!s.has(e.messageID)));return t.length>0&&(this.historyDms=void 0,this.newDms=void 0),t}}isMessageDuplicate(e,t){return 0===this.filterDuplicates([e],t).length}}var j=i(2359),Z=i(1448);function K(e,t,i,s,n){const o={padding:"5px 8px",display:"inline-block",textAlign:"left",maxWidth:"77%",borderRadius:"10px",overflowWrap:"break-word"},r={...o,marginRight:"8px"},a={...o,borderWidth:"1px",borderStyle:"solid",position:"relative"},l={textAlign:t?"right":"left",padding:"1px 0"},h=t?r:a,d=t?"sent-message":"received-message";return(0,b.tT)("div",{colorClass:i,style:l},(0,b.tT)("div",{colorClass:s,style:h,title:null!=n?n:"","data-testid":d},e))}class J extends h.u{constructor(e){super("div",e),this.timestampThresholdSeconds=3600,this.updateForPrevTimestamp(e.prevTimestamp)}initData(e){super.initData(e),this.dm=e.dm,this.timestamp=e.dm.createdAt}initUI(e){super.initUI(e);const t=e.isMine?"me":"other",i=void 0!==this.dm.createdAt?this.tooltipTimestampString(this.dm.createdAt):"",s=(0,Z.bB)(this.dm),n=(0,j.e4)(this.dm.message);n.style.display="block",this.element=(0,b.tT)("div",{style:{marginTop:"1px"}},this.createTimestamp(),""!==this.dm.message&&K(n,e.isMine,"dmWindowMessage",t,i),s&&K(s,e.isMine,"dmWindowMessage",t))}showTimestamp(){this.timestampDiv.style.display="block"}updateForPrevTimestamp(e){this.timestampDiv.style.display=this.shouldShowTimestamp(e)?"block":"none"}createTimestamp(){let e="";return void 0!==this.dm.createdAt&&(e=this.timestampString(this.dm.createdAt)),this.timestampDiv=(0,b.tT)("div",{style:{textAlign:"center",display:"none",padding:"7px 0 3px"},colorClass:"timestamp"},e),this.timestampDiv}timestampString(e){return e.toLocaleDateString()===(new Date).toLocaleDateString()?y.R.todayAtTime(e.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})):e.toLocaleDateString()===new Date(Date.now()-864e5).toLocaleDateString()?y.R.yesterdayAtTime(e.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})):e.getFullYear()===(new Date).getFullYear()?e.toLocaleString([],{month:"short",day:"numeric",weekday:"short",hour:"numeric",minute:"numeric"}):e.toLocaleString([],{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}tooltipTimestampString(e){return e.toLocaleString([],{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})}shouldShowTimestamp(e){return void 0!==this.timestamp&&void 0!==e&&(0,s.gn)(this.timestamp,e)>this.timestampThresholdSeconds}}var Y=i(637),Q=i(227),X=i(9603);class ee extends h.u{constructor(e){super("div",e)}initUI(e){const t=void 0!==e.divotPosition?e.divotPosition:d.Wi.Bottom;this.element=(0,X.q)({content:e.message,hasHTML:!1,width:"auto",divotPosition:t,divotLeftOrTop:"auto"}),(0,c.ZM)(this.element,{fontFamily:"Tahoma, Arial, Helvetica, sans-serif",lineHeight:"27px",bottom:void 0===e.toolTipBottom?"40px":e.toolTipBottom,right:void 0===e.toolTipRight?"0px":e.toolTipRight,padding:"0px 8px",whiteSpace:"nowrap"});const i=this.element.querySelector(".divot");null!==i&&(0,c.ZM)(i,{right:void 0===e.caretRight?"21px":e.caretRight,bottom:void 0===e.caretBottom?"auto":e.caretBottom})}changeMessage(e){this.element.firstChild&&(this.element.firstChild.textContent=e)}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}render(){return this.element}}var te,ie=i(1885);class se extends h.u{constructor(e){var t;super("div",e),this.props=e,this.colorClass=null!==(t=e.colorClass)&&void 0!==t?t:"defaultUser",this.applyColor(this.colorClass)}initUI(e){this.element=(0,b.tT)("div",{style:{position:"relative",display:"inline-block",margin:"10px 0 0 8px",width:"calc(100% - 48px)",fontSize:"12px",fontFamily:"Tahoma, Arial, Helvetica, sans-serif",fontWeight:"bold",lineHeight:"14px"}},(0,b.tT)("a",{style:{maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"inline-block",cursor:"pointer"},onClick:t=>{t.stopPropagation(),e.clickUsernameFn()},target:"_blank",ref:e=>this.usernameLink=e,"data-testid":"username"},e.username),(0,b.tT)(ne,{classRef:e=>this.numUnreadDisplay=e}))}applyColor(e){(0,E.SA)(this.usernameLink,this.colorClass),this.colorClass=e,(0,E.fZ)(this.usernameLink,e),"inFanclub"===e?void 0===this.icon&&(this.icon=document.createElement("img"),this.icon.src=`${STATIC_URL}badge_star.svg`,this.icon.height=16,this.element.insertBefore(this.icon,this.usernameLink),this.usernameLink.style.position="relative",this.usernameLink.style.marginLeft="5px",this.usernameLink.style.marginBottom="2px",this.usernameLink.style.maxWidth="calc(100% - 24px)"):void 0!==this.icon&&(this.element.removeChild(this.icon),this.icon=void 0,this.usernameLink.style.position="",this.usernameLink.style.marginLeft="",this.usernameLink.style.marginBottom="",this.usernameLink.style.maxWidth="100%")}updateNumUnread(e){this.numUnreadDisplay.updateNum(e)}toggleUnreadDot(e){this.numUnreadDisplay.toggleDot(e)}activateUsernameLink(){this.usernameLink.href=(0,a._Y)(`/${this.props.username}`)}clone(){const e=new se({...this.props,colorClass:this.colorClass});return e.updateNumUnread(this.numUnreadDisplay.getNum()),e.toggleUnreadDot(this.numUnreadDisplay.usingDot()),e}render(){return this.element}}class ne extends h.u{constructor(){super("div")}initUI(){this.element=(0,b.tT)("div",{style:{display:"none"}},(0,b.tT)("div",{className:"numDisplay",style:{position:"relative",display:"none",left:"4px",bottom:"2px",minWidth:"16px",height:"15px",paddingTop:"1px",backgroundColor:"#F47321",color:"#FFFFFF",fontFamily:"Tahoma, Arial, Helvetica, sans-serif",textAlign:"center",borderRadius:"4px",fontWeight:"normal"},ref:e=>this.numDisplay=e}),(0,b.tT)("img",{src:`${STATIC_URL}orange_dot.svg`,style:{position:"relative",top:"-8px",marginLeft:"4px",display:"none"},ref:e=>this.dot=e}))}updateNum(e){this.numUnread=e,e>0?(this.element.style.display="inline-block",this.numDisplay.textContent=e>9?"9+":`${e}`,this.numDisplay.style.width=`${(0,c.q_)(this.numDisplay.textContent,this.numDisplay)+4}px`):this.element.style.display="none"}getNum(){return this.numUnread}toggleDot(e){e?(this.numDisplay.style.display="none",this.dot.style.display=""):(this.numDisplay.style.display="",this.dot.style.display="none")}usingDot(){return""===this.dot.style.display}render(){return this.element}}const oe=4096,re=e=>(0,b.tT)("div",{style:{position:"absolute",height:"25px",width:"25px",borderRadius:"5px",top:"5px",...e.style},onMouseEnter:()=>e.parentDiv&&(0,E.fZ)(e.parentDiv,"noHighlight"),onMouseLeave:()=>e.parentDiv&&(0,E.SA)(e.parentDiv,"noHighlight"),colorClass:"button",onClick:e.clickHandler,"data-testid":e.testID},e.children),ae=e=>(0,b.tT)(re,{parentDiv:e.parentDiv,style:e.style,clickHandler:t=>{t.stopPropagation(),e.clickHandler()},testID:"close"},(0,b.tT)("img",{src:`${STATIC_URL}close-gray.svg`,height:"13px",width:"13px",style:{position:"relative",height:"13px",width:"13px",left:"6px",top:"7px"}}));class le extends h.u{constructor(e){var t;super(),this.fetchFailed=!1,this.isShowing=!0,this.fetched=!1,this.isAllHistoryLoaded=!1,this.dmDuplicateChecker=new q,this.removeMenu=()=>{void 0!==this.menu&&(this.element.removeChild(this.menu.overlay),this.element.removeChild(this.menu.element),this.unHighlightHeader(),this.menu=void 0)},this.popoutConvo=()=>{Y.D.show(this.username),this.openOrCollapseWindow(!1)},this.ignoreUser=()=>{const e=()=>this.handleNewNotice(this.createLogMessage(y.R.errorIgnoringUser(this.username)),!1);(0,N.Bq)(this.username).then((t=>!t&&e())).catch(e)},this.unignoreUser=()=>{const e=()=>this.handleNewNotice(this.createLogMessage(y.R.errorUnignoringUser(this.username)),!1);(0,N.Kw)(this.username).then((t=>!t&&e())).catch(e)},this.username=e.username,this.myUsername=e.myUsername,this.raiseWindowZIndexToTop=e.raiseWindowZIndexToTop,this.listenerGroup=new u.gt,this.initTippingUI(),this.constructElement(),this.setFollowStar(),this.openOrCollapseWindow(e.open,e.markAsRead,!0),(0,p.QC)()&&(this.newMessageNotice=new W.W({getUnreadCount:()=>{var e;return null===(e=this.scrollDownButton)||void 0===e?void 0:e.getUnreadCount()},isConversationShowing:()=>this.isOpenAndShowing(),isScrolledUp:()=>this.isScrolledUp(),setParentScrollTop:e=>this.setScrollTop(e),scrollParentDiv:this.messageDiv}));const i=null===(t=S.Bm.current.loggedInUser)||void 0===t?void 0:t.userUid;if(void 0!==i){const e=new O.y8(i);e.isSubscribed()?this.enableSend():e.onSubscribeChange.listen((e=>{e.subscribed&&this.enableSend()})).addTo(this.listenerGroup)}(0,I.ug)(this.username).then((t=>{let{sitewideUser:i,canPm:s,canTip:n}=t;this.userInfo=i,this.colorClass=(0,f.Kb)(i),this.canSendDm=s,n&&this.enableTip(),this.usernameLabel.applyColor(this.colorClass),this.fetchConversation(e.markAsRead),l.X0.listen((e=>{this.userInfo.isBroadcaster=this.username===e.dossier.room,this.colorClass=(0,f.Kb)(this.userInfo),this.usernameLabel.applyColor(this.colorClass)}))})).catch((e=>{const t=new s.N6(e.xhr.responseText).getStringOrUndefined("error");void 0!==t?(0,r.Q$)(t):(0,r.Q$)(y.R.errorLoadingDms(this.username)),L.x7.fire({username:this.username,deleteWindow:!0})}))}constructElement(){this.createHeaderBar(),this.createChatDiv(),this.constructFollowStarUI();const e={cssFloat:"right",position:"relative",marginRight:"7px",borderRadius:"4px 4px 0px 0px",width:"280px",height:le.expandedHeight};this.element=(0,b.tT)("div",{colorClass:"dmWindow",style:e},this.headerBar,this.chatDiv)}createHeaderBar(){const e={position:"relative",height:le.headerHeight,borderRadius:"4px 4px 0px 0px",borderBottomWidth:"2px",borderBottomStyle:"solid",cursor:"pointer"};this.headerBar=(0,b.tT)("div",{style:e,colorClass:"dmWindowHeader",onMouseEnter:()=>{this.highlightHeader()},onMouseLeave:()=>{this.unHighlightHeader()},onClick:()=>this.openOrCollapseWindow(!this.isOpen)}),this.usernameLabel=new se({username:this.username,colorClass:this.colorClass,clickUsernameFn:()=>this.showUCM()}),this.headerBar.appendChild(this.usernameLabel.element);const t=(0,b.tT)(ae,{parentDiv:this.headerBar,style:{right:"5px"},"data-testid":"dm-close-button",clickHandler:()=>L.x7.fire({username:this.username})});this.closeToolTip=new ee({message:y.R.dmCloseTabShortcut}),(0,o.wu)("mouseenter",t,(()=>{var e;null===(e=this.closeToolTip)||void 0===e||e.show()})),(0,o.wu)("mouseleave",t,(()=>{var e;null===(e=this.closeToolTip)||void 0===e||e.hide()})),t.appendChild(this.closeToolTip.element),this.headerBar.appendChild(t)}initTippingUI(){this.tippingUI=new P(this.username,(()=>this.hideTipping())),this.tippingWindow=this.tippingUI.createUI(),this.tippingOverlay=this.tippingUI.createOverlay()}enableSend(){this.input.enableSend()}enableTip(){this.input.enableTip()}changeWindowZIndex(e){this.element.style.zIndex=`${e}`}onIgnoreUnignore(e){e?this.handleNewNotice(this.createLogMessage(y.R.ignoringUser(this.username))):this.handleNewNotice(this.createLogMessage(y.R.noLongerIgnoring(this.username)))}showUCM(){if(this.isOpen){if(void 0===this.menu){const e=this.usernameLabel.clone();e.activateUsernameLink(),e.element.style.margin="0",this.menu=new Q.vs({currentUsername:this.myUsername,userInfo:this.userInfo,usernameLabel:e,tearDownFunc:this.removeMenu,popoutFunc:this.popoutConvo,ignoreFunc:this.ignoreUser,unignoreFunc:this.unignoreUser,includePopoutLink:!(this instanceof de),dontRepositionForThumbnail:this instanceof de}),this.element.appendChild(this.menu.overlay),this.element.appendChild(this.menu.element)}this.menu.setLastReceivedMessage(this.lastReceivedMessage),this.raiseWindowZIndexToTop(this.username),"none"===this.menu.element.style.display&&(this.menu.element.style.display="block",this.menu.showOverlay(),(0,g.bT)("DmMenuClicked",{location:"DmWindow"}))}else this.openOrCollapseWindow(!0)}showTipping(e,t,i){this.tippingUI.setFields(e,t),this.element.appendChild(this.tippingOverlay),this.element.appendChild(this.tippingWindow),!0===i?window.setTimeout((()=>{this.tippingUI.focus()}),990):this.tippingUI.focus(),(0,g.bT)("SendTipViewed",{location:"DmWindow",tipType:"public",localStorage:(0,n.Pf)()})}hideTipping(){var e,t;null===(e=this.tippingOverlay.parentElement)||void 0===e||e.removeChild(this.tippingOverlay),null===(t=this.tippingWindow.parentElement)||void 0===t||t.removeChild(this.tippingWindow)}onTip(e){const t=e.fromUser.username===this.myUsername;let i;i=t?y.R.sentTipDmNotice(e.amount):e.message.length>0?y.R.receivedTipDmNoticeWithMessage(this.username,e.amount,e.message):y.R.receivedTipDmNotice(this.username,e.amount);const s=this.createLogMessage(i,t?2:1,"tipNotice");(0,c.ZM)(s,{fontWeight:"bold"}),this.handleNewNotice(s,e.roomType!==f.CJ.DM,t)}getNumUnread(){var e;return null!==(e=this.numUnread)&&void 0!==e?e:0}createChatDiv(){const e={height:`calc(100% - ${le.headerHeight})`,position:"relative",fontFamily:"Tahoma, Arial, Helvetica, sans-serif",fontSize:"12px"},t={position:"relative",height:`calc(100% - ${D.height})`,paddingBottom:"8px",boxSizing:"border-box",overflowY:"auto"};let i,s;(0,p.QC)()&&(t.overflowX="hidden"),this.chatDiv=(0,b.tT)("div",{style:e,ref:e=>{this.chatDiv=e}},(0,b.tT)("div",{style:t,onScroll:()=>{this.handleChatDivScroll()},onMouseDown:e=>{i=e.pageX,s=e.pageY},onMouseUp:e=>{const t=e.pageX-i,n=e.pageY-s;Math.sqrt(t*t+n*n)<2&&this.input.focus()},ref:e=>this.messageDiv=e},(0,b.tT)("div",{style:{width:"100%",boxSizing:"border-box",padding:"0px 4px"},ref:e=>this.messageList=e},this.createLogMessage(y.R.privateConversationWithText(this.username)),this.createLogMessage(y.R.conversationCautionMessage(H.m.siteName)),(0,b.tT)("div",{ref:e=>this.messageHistoryDiv=e},(0,b.tT)("div",{style:{marginTop:"44px"},ref:e=>this.loadingDiv=e},(0,b.tT)(V.N,{extraStyle:{margin:"auto"}}))))),(0,b.tT)(D,{classRef:e=>this.input=e,toUsername:this.username,onInputExpand:()=>this.onInputExpand(),onInputCollapse:()=>this.onInputCollapse(),showTipping:(e,t)=>this.showTipping(e,t),sendDmFailedCallback:e=>{this.handleNewNotice(this.createLogMessage(e.errorMessage),!1)},onFocus:()=>this.onInputFocus()}),(0,p.QC)()&&(0,b.tT)($.w,{scrollToBottom:()=>this.scrollToBottom(),bottomStyle:`calc(${D.height} + 4px)`,classRef:e=>this.scrollDownButton=e}))}handleChatDivScroll(){var e,t,i;0!==this.messageDiv.scrollTop||this.isAllHistoryLoaded||this.fetchConversation(!0,this.earliestMessageId),this.isScrolledUp(0)||this.fireDmsRead(),this.isScrolledUp()?null===(e=this.scrollDownButton)||void 0===e||e.showElement():(null===(t=this.scrollDownButton)||void 0===t||t.hideElement(),null===(i=this.scrollDownButton)||void 0===i||i.clearUnread())}setFollowStar(){(0,m.wF)(this.username).then((e=>{this.followProhibited=!e,(0,a.Aw)(`follow/is_following/${this.username}/`).then((t=>{const i=JSON.parse(t.responseText).following;(e||i)&&this.followUnfollow(i)})).catch(v.yZ)})).catch(v.yZ)}constructFollowStarUI(){this.followButton=(0,b.tT)(re,{parentDiv:this.headerBar,testID:"dm-follow-button",style:{right:"30px"},clickHandler:()=>{}}),this.followStar=new z.d({slug:this.username,hideTitle:!0}),(0,c.ZM)(this.followStar,{height:"20px",width:"20px",backgroundSize:"20px 20px",backgroundPosition:"center",padding:"2px 3px",margin:"0px"}),this.constructFollowToolTip(),(0,o.wu)("mouseenter",this.followButton,(()=>{var e;this.followStar.isShown()&&(null===(e=this.followToolTip)||void 0===e||e.show())})),(0,o.wu)("mouseleave",this.followButton,(()=>{var e;null===(e=this.followToolTip)||void 0===e||e.hide()})),this.followButton.appendChild(this.followStar.element),void 0!==this.followToolTip&&this.followButton.appendChild(this.followToolTip.element),this.headerBar.appendChild(this.followButton)}constructFollowToolTip(){this.followToolTip=new ee({message:y.R.unfollowText})}followUnfollow(e){var t;this.followStar.setFollowing(e),null===(t=this.followToolTip)||void 0===t||t.changeMessage(e?y.R.unfollowText:y.R.followText),this.followProhibited&&!e?this.followButton.style.display="none":this.followButton.style.display="block"}getUserInfo(){return this.userInfo}setUserInfo(e){this.userInfo={...this.userInfo,...e},this.usernameLabel.applyColor((0,f.Kb)(this.userInfo))}openWindow(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.chatDiv.style.display="block",(0,E.SA)(this.element,"collapsed"),this.element.style.bottom=le.expandedHeight,this.element.style.height=le.expandedHeight,null===(t=this.closeToolTip)||void 0===t||t.changeMessage(y.R.dmCloseTabShortcut),this.usernameLabel.toggleUnreadDot(!0),e&&(i||this.scrollAndFocus(),this.fireDmsRead())}collapseWindow(){var e,t;this.chatDiv.style.display="none",(0,E.fZ)(this.element,"collapsed"),this.element.style.bottom="36px",this.element.style.height="36px",null===(e=this.closeToolTip)||void 0===e||e.changeMessage(y.R.dmCloseTab),this.usernameLabel.toggleUnreadDot(!1),this.getNumUnread()>0?this.usernameLabel.updateNumUnread(this.getNumUnread()):null===(t=this.newMessageNotice)||void 0===t||t.remove(!0),this.hideTipping()}openOrCollapseWindow(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.isOpen=e,e?this.openWindow(t,i):this.collapseWindow();const s={username:this.username,isOpen:e};L.oB.fire(s),L.c9.fire(void 0)}setIsShowing(e){this.isShowing=e,e&&this.fetchFailed&&this.fetchConversation(!0)}removeFromDOM(){var e,t;null===(e=this.closeToolTip)||void 0===e||e.hide(),this.hideTipping(),this.element.remove(),this.setIsShowing(!1),null===(t=this.newMessageNotice)||void 0===t||t.remove(!0)}isWindowOpen(){return this.isOpen}isInputFocused(){return this.input.isFocused()}blurInput(){this.input.blur()}isScrolledUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return this.messageList.offsetHeight-(this.messageDiv.scrollTop+this.messageDiv.offsetHeight)>e}scrollToBottom(){var e;(0,n.OF)()&&(0,c.WV)(this.messageDiv),this.messageDiv.scrollTop=this.messageList.offsetHeight,null===(e=this.scrollDownButton)||void 0===e||e.hideElement()}handleImageLoadScrolling(e){this.isScrolledUp()||e.querySelectorAll("img").forEach((e=>{const t=e.src;e.src="",e.onload=()=>this.scrollToBottom(),e.src=t}))}scrollAndFocus(){this.scrollToBottom(),document.activeElement!==this.input.element&&this.input.focus()}onInputFocus(){this.isScrolledUp()||this.fireDmsRead()}onInputExpand(){const e=this.isScrolledUp();this.messageDiv.style.height=`calc(100% - ${D.expandedHeight})`,e||this.scrollToBottom()}onInputCollapse(){this.messageDiv.style.height=`calc(100% - ${D.height})`}fetchConversation(e,t){(0,I.cb)(this.username,t).then((i=>{const s=i.messages;var n;if(s.length<I.j&&(this.isAllHistoryLoaded=!0),this.fetched||(this.fetched=!0,this.fetchFailed=!1,this.loadingDiv.remove(),this.setNumUnread(i.numUnread),null===(n=this.scrollDownButton)||void 0===n||n.incUnread(i.numUnread),e&&this.fireDmsRead()),s.length>0)if(this.earliestMessageId=s[0].messageID,void 0===this.lastReceivedMessage&&(this.lastReceivedMessage=[...s].reverse().find((e=>e.fromUser.username===this.username))),void 0===this.latestTimestamp&&(this.latestTimestamp=s[s.length-1].createdAt),void 0===t){const e=this.dmDuplicateChecker.filterDuplicates(s,!0);this.addPreviousBatch(e,i.numUnread),this.maybeAddCanDmNotice(),this.scrollToBottom(),this.handleImageLoadScrolling(this.messageHistoryDiv)}else this.addPreviousBatch(s);else void 0===t&&this.maybeAddCanDmNotice();this.maybeUpdateConversationListItem(s)})).catch((()=>{this.handleNewNotice(this.createLogMessage(y.R.errorLoadingConversationHistory),!1),this.loadingDiv.remove(),this.fetchFailed=!0}))}maybeUpdateConversationListItem(e){var t,i;if(0===e.length)return;const s=e[e.length-1];G.yT.conversationLoaded.fire({message:s.message,numUnread:null!==(t=this.numUnread)&&void 0!==t?t:0,time:null===(i=this.latestTimestamp)||void 0===i?void 0:i.getTime(),fromUsername:s.fromUser.username,otherUser:this.userInfo,hasMedia:s.mediaList.length>0,room:""})}addPreviousBatch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(0===e.length)return;const i=(0,b.tT)("div",null);let s,n;void 0!==this.oldestMessage&&this.oldestMessage.updateForPrevTimestamp(e[e.length-1].createdAt),e.forEach(((o,r)=>{const a=o.fromUser.username===this.myUsername;var l;s=new J({dm:o,isMine:a,prevTimestamp:n}),(0,p.QC)()&&r===e.length-t&&i.appendChild(null===(l=this.newMessageNotice)||void 0===l?void 0:l.element),i.appendChild(s.element),n=o.createdAt,0===r&&(s.showTimestamp(),this.oldestMessage=s)})),this.messageHistoryDiv.insertBefore(i,this.messageHistoryDiv.firstChild),this.messageDiv.scrollTop=i.offsetHeight}createLogMessage(e){let t=arguments.length>2?arguments[2]:void 0;switch(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0){case 0:const i={maxWidth:"271px",textAlign:"center",fontSize:"11px",lineHeight:"12px",padding:"4px",margin:"auto"};return(0,b.tT)("div",{style:i,colorClass:"logMessage"},e);case 2:return K(e,!0,"logMessage",t);case 1:return K(e,!1,"logMessage",t)}}addMessageToEnd(e,t){var i;let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this.messageDiv.scrollTop,o=this.isScrolledUp();var r;this.handleImageLoadScrolling(e),t||this.setNumUnread(this.getNumUnread()+1),!o&&this.isOpenAndShowing()||t||null===(r=this.scrollDownButton)||void 0===r||r.incUnread(),!0===(null===(i=this.newMessageNotice)||void 0===i?void 0:i.shouldAppendNewMessageNotice(!0,!1))&&this.messageList.appendChild(this.newMessageNotice.element),this.messageList.appendChild(e),this.handleScrollAfterNewMessage(t,o,n,s),this.isOpenAndShowing()&&!o&&this.fireDmsRead()}isOpenAndShowing(){return this.isOpen&&this.isShowing}maybeAddCanDmNotice(){if(!this.canSendDm){var e;const t=!0===(null===(e=S.Bm.current.loggedInUser)||void 0===e?void 0:e.isAgeVerified)?y.R.dmSupporterNoticeAgeVerified:y.R.dmSupporterNotice;this.handleNewNotice(this.createLogMessage(t))}}handleNewNotice(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.addMessageToEnd(e,i,t)}handleNewMessage(e){if(this.dmDuplicateChecker.isMessageDuplicate(e,!1))return;const t=e.fromUser.username===this.myUsername;t||(this.lastReceivedMessage=e);const i=new J({dm:e,isMine:t,prevTimestamp:this.latestTimestamp});this.latestTimestamp=e.createdAt,void 0===this.oldestMessage&&(i.showTimestamp(),this.oldestMessage=i),this.addMessageToEnd(i.element,t)}handleScrollAfterNewMessage(e,t,i,s){var n;!t||e&&!s?this.scrollToBottom():null===(n=this.newMessageNotice)||void 0===n||n.maybeScrollJump(i)}setScrollTop(e){this.messageDiv.scrollTo({top:e})}setNumUnread(e){0!==e?(this.numUnread=e,this.usernameLabel.updateNumUnread(e)):this.fireDmsRead()}fireDmsRead(){0!==this.getNumUnread()&&document.hasFocus()&&(this.markRead(),ie.ot.fire({username:this.username}))}markRead(){0!==this.getNumUnread()&&(this.numUnread=0,this.usernameLabel.updateNumUnread(0))}highlightHeader(){(0,E.fZ)(this.headerBar,"highlight")}unHighlightHeader(){(0,E.SA)(this.headerBar,"highlight")}highlightHeaderForShow(){(0,E.fZ)(this.headerBar,"loadedHighlight"),window.clearTimeout(this.loadedHighlightTimeout),this.loadedHighlightTimeout=window.setTimeout((()=>(0,E.SA)(this.headerBar,"loadedHighlight")),4e3)}}(te=le).headerHeight="34px",te.expandedHeight="260px";class he extends le{constructor(e){super(e),"ResizeObserver"in window&&new ResizeObserver((()=>this.onResize())).observe(this.messageDiv)}constructElement(){this.createHeaderBar(),this.createChatDiv(),this.constructFollowStarUI(),this.element=(0,b.tT)("div",{colorClass:"dmWindow",style:{boxShadow:"none",display:"flex",flexDirection:"column",flex:1,height:"1px"}},this.headerBar,this.chatDiv,(0,p.QC)()&&(0,b.tT)($.w,{scrollToBottom:()=>this.scrollToBottom(),bottomStyle:`calc(${D.height} + 4px)`,classRef:e=>this.scrollDownButton=e}),(0,b.tT)(B,{classRef:e=>this.input=e,toUsername:this.username,onInputExpand:()=>{},onInputCollapse:()=>{},showTipping:(e,t,i)=>this.showTipping(e,t,i),sendDmFailedCallback:e=>{this.handleNewNotice(this.createLogMessage(e.errorMessage),!1)},onFocus:()=>this.onInputFocus()}))}createHeaderBar(){this.headerBar=(0,b.tT)("div",{style:{position:"relative",height:"34px",borderRadius:"4px 4px 0px 0px",borderBottomWidth:"1px",borderBottomStyle:"solid"},colorClass:"dmWindowHeader"}),this.usernameLabel=new se({username:this.username,colorClass:this.colorClass,clickUsernameFn:()=>this.showUserPanel()}),this.headerBar.appendChild(this.usernameLabel.element)}createChatDiv(){const e={fontFamily:"Tahoma, Arial, Helvetica, sans-serif",fontSize:"12px",flex:1,height:`calc(100% - ${le.headerHeight} - ${D.height})`,display:"flex",position:"relative"};this.chatDiv=(0,b.tT)("div",{style:e,ref:e=>{this.chatDiv=e}},(0,b.tT)("div",{style:{width:"100%",height:"100%",overflowY:"auto",position:"relative"},onScroll:()=>{this.handleChatDivScroll()},ref:e=>this.messageDiv=e},(0,b.tT)("div",{style:{width:"100%",boxSizing:"border-box",padding:"4px 4px 8px 4px"},ref:e=>this.messageList=e},this.createLogMessage(y.R.privateConversationWithText(this.username)),this.createLogMessage(y.R.conversationCautionMessage(H.m.siteName)),(0,b.tT)("div",{ref:e=>this.messageHistoryDiv=e},(0,b.tT)("div",{style:{marginTop:"44px"},ref:e=>this.loadingDiv=e},(0,b.tT)(V.N,{extraStyle:{margin:"auto"}}))))))}initTippingUI(){this.tippingUI=new k(this.username,(()=>this.hideTipping())),this.tippingWindow=this.tippingUI.createUI(),this.tippingOverlay=this.tippingUI.createOverlay()}constructFollowStarUI(){this.followStar=new z.d({slug:this.username}),(0,c.ZM)(this.followStar,{height:"20px",width:"20px",backgroundSize:"20px 20px",backgroundPosition:"center",padding:"2px 3px",margin:"0px"}),this.followButton=(0,b.tT)(re,{style:{right:"8px"},clickHandler:()=>{}}),this.followButton.appendChild(this.followStar.element),this.headerBar.appendChild(this.followButton)}openOrCollapseWindow(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?this.showElement():this.hideElement(),super.openOrCollapseWindow(e,t)}hideElement(){super.hideElement(),this.removeUserPanelDOM()}openWindow(e){this.chatDiv.style.display="flex",(0,E.SA)(this.element,"collapsed"),this.scrollToBottom(),e&&this.fireDmsRead()}resizeTipCallout(){const e=(0,F.mJ)();e<250?(0,c.ZM)(this.tippingUI,{height:`${e}px`,overflow:"scroll",transform:"translate(-50%)",top:"",bottom:"0",overscrollBehavior:"contain"}):(0,c.ZM)(this.tippingUI,{height:"",overflow:"",transform:"translate(-50%, -50%)",top:"50%",bottom:"",overscrollBehavior:""})}showUCM(){}showUserPanel(){void 0===this.userPanel&&(this.userPanel=new _.T,(0,c.ZM)(this.userPanel.element,{top:`${this.headerBar.offsetHeight}px`,backgroundColor:"#FFF",fontSize:"12px"}),U.bW.listen((()=>{this.removeUserPanelDOM()})).addTo(this.listenerGroup),this.userPanel.overlayClick.listen((()=>{this.removeUserPanelDOM()})).addTo(this.listenerGroup)),this.userPanel.updateContents(this.username,this.lastReceivedMessage),this.headerBar.appendChild(this.userPanel.overlay),this.headerBar.appendChild(this.userPanel.element),this.userPanel.showOverlay()}removeUserPanelDOM(){var e;null===(e=this.userPanel)||void 0===e||e.hide()}showElement(){super.showElement("flex")}highlightHeaderForLoad(){}onResize(){this.isScrolledUp(600)||this.scrollToBottom()}}class de extends le{constructor(e){var t,i;super({username:e,myUsername:null!==(t=null===(i=S.Bm.current.loggedInUser)||void 0===i?void 0:i.username)&&void 0!==t?t:"",open:!0,markAsRead:!0,raiseWindowZIndexToTop:()=>{}}),"ResizeObserver"in window&&new ResizeObserver((()=>this.onResize())).observe(this.messageDiv)}constructElement(){this.createHeaderBar(),this.createChatDiv(),this.constructFollowStarUI(),this.element=(0,b.tT)("div",{colorClass:"dmWindow",style:{position:"relative",height:"100%"},"data-testid":"dm-window"},this.headerBar,this.chatDiv)}createHeaderBar(){this.headerBar=(0,b.tT)("div",{style:{position:"relative",height:"34px",borderRadius:"4px 4px 0px 0px",borderBottomWidth:"2px",borderBottomStyle:"solid"},colorClass:"dmWindowHeader"}),this.usernameLabel=new se({username:this.username,colorClass:this.colorClass,clickUsernameFn:()=>this.showUCM()}),this.headerBar.appendChild(this.usernameLabel.element)}constructFollowStarUI(){super.constructFollowStarUI(),this.followButton.style.right="8px"}constructFollowToolTip(){this.followToolTip=new ee({message:y.R.unfollowText,toolTipBottom:"auto",toolTipRight:"40px",divotPosition:d.Wi.Right,caretRight:"0px",caretBottom:"24px"})}openWindow(e){super.openWindow(e),this.element.style.bottom="",this.element.style.height="100%"}highlightHeaderForLoad(){}onResize(){this.isScrolledUp(600)||this.scrollToBottom()}}},1585:(e,t,i)=>{"use strict";i.d(t,{L:()=>a,N:()=>r});var s=i(7463),n=i(9461),o=i(897);function r(e){const t=(e||document).querySelectorAll(".dmWindow");return Array.from(t).reduce(((e,t)=>Math.max(e,t.offsetHeight)),0)}function a(e){var t;const i=null===(t=n.Bm.current.loggedInUser)||void 0===t?void 0:t.userUid;void 0!==i&&(new o.aT(i).onMessage.listen((t=>{var i;const s=null===(i=n.Bm.current.loggedInUser)||void 0===i?void 0:i.username,o=t.fromUser.username!==s?t.fromUser.username:t.toUsername,r=e(null!=o?o:"");null==r||r.onTip(t)})),new o.T_(i).onMessage.listen((t=>{const i=e(t.username);null==i||i.onIgnoreUnignore(t.isIgnored)})),s.im.listen((t=>{const i=e(t.roomName);null==i||i.followUnfollow(t.following)})),new o.vc(i).onMessage.listen((t=>{const i=e(t.fromUser.username);null==i||i.setUserInfo({inFanclub:!0})})))}},3910:(e,t,i)=>{"use strict";i.d(t,{$o:()=>C,Z4:()=>A,c9:()=>T,oB:()=>x,qt:()=>k,x7:()=>S});var s=i(7623),n=i(6784),o=i(2709),r=i(8423),a=i(8936),l=i(3124),h=i(9439),d=i(1372),c=i(4110),u=i(3158),p=i(3417),m=i(9461),g=i(9466),v=i(4364),f=i(2394),y=i(4500),b=i(1585),w=i(1885);const C=new r.c_("createDmWindowRequest"),S=new r.c_("removeDMWindowRequest"),x=new r.c_("updateWindowIsOpenEvent"),T=new r.c_("dmsHeightChanged"),P="pmChatWindow";class k extends o.u{constructor(e){super(),this.allDmWindowsMap=new Map,this.focusingTablet=!1,this.tabletFocusState=2,this.raiseWindowZIndexToTop=e=>{this.allDmWindowsMap.forEach(((t,i)=>{i===e?t.changeWindowZIndex(2):t.changeWindowZIndex(1)}))},this.myUsername=e,this.bindListeners(),(0,n.wu)("mousedown",this.element,(()=>(0,h.jb)(!1))),(0,n.wu)("mouseup",window,(()=>(0,h.jb)(!0)))}static getOrCreateInstance(e){return void 0===k.instance&&(k.instance=new k(e)),k.instance}static getInstance(){return k.instance}initData(){this.manuallyHandlingTabletKeyboard=(0,s.Xb)()&&!!window.visualViewport&&void 0===navigator.virtualKeyboard}initUI(){if(super.initUI(),this.shownDmContainer=(0,d.tT)("div",{style:{display:"inline-block",cssFloat:"right"}}),this.element=(0,d.tT)("div",{id:"DmWindowBar",style:{position:"fixed",bottom:"0px",right:"10px",minWidth:"350px",width:"100vw",height:"0px",backgroundColor:"rgba(255, 255, 255, 0.5)",zIndex:1005}},this.shownDmContainer),f.Z.listen((e=>this.handleInputFocus(e))),this.manuallyHandlingTabletKeyboard)(0,n.wu)("focus",this.element,(()=>this.onTabletFocus()),!0),(0,n.wu)("blur",this.element,(()=>this.onTabletBlur()),!0),(0,g.QR)(document,(()=>{this.focusingTablet||this.blur()})),(0,n.wu)("touchstart",document,(e=>{e.target instanceof Element&&!this.element.contains(e.target)&&this.blur()}));else if(void 0!==navigator.virtualKeyboard){const e=navigator.virtualKeyboard;(0,n.wu)("focus",document,(t=>{e.overlaysContent=t.target instanceof Element&&this.element.contains(t.target)}),!0),(0,n.wu)("blur",this.element,(()=>{this.element.style.bottom="0px"}),!0),e.addEventListener("geometrychange",(e=>{this.element.contains(document.activeElement)&&(this.element.style.bottom=`${e.target.boundingRect.height}px`)}))}if((0,s.Xb)()){var e;let t;(0,n.wu)("focusin",document,(e=>{e.target instanceof HTMLElement&&(0,u.i)(e.target)&&!this.element.contains(e.target)&&(this.element.style.visibility="hidden")})),(0,n.wu)("focusout",document,(()=>{this.element.style.visibility=""})),null===(e=window.visualViewport)||void 0===e||e.addEventListener("resize",(()=>{const e=window.visualViewport?Math.round(10*window.visualViewport.scale):void 0;void 0!==t&&e!==t&&this.blur(),t=e}))}}handleInputFocus(e){if(!this.manuallyHandlingTabletKeyboard)return void(e instanceof HTMLElement&&e.focus());let t;if(e instanceof HTMLElement)t=e;else{if(!(e.target instanceof HTMLElement))return;if(document.activeElement===e.target&&(0,s.OF)()&&this.isPositionedForKeyboard())return;e.preventDefault(),t=e.target}this.handleTabletInputFocus(t)}handleTabletInputFocus(e){e.blur();const t=window.scrollX,i=window.scrollY;this.maxZoomedTabletTop=document.body.offsetHeight,this.focusingTablet=!0;const s=()=>{window.scrollTo(t,i),(0,a.z1)()&&this.setTabletStyleForZoomFocus()};(0,n.wu)("scroll",document,s),window.setTimeout((()=>{(0,n.Pf)("scroll",document,s),this.focusingTablet=!1}),1e3),this.setTabletStyleForFocus(0),e.focus()}onTabletFocus(){window.setTimeout((()=>{this.setTabletStyleForFocus(1)}),(0,s.OF)()?75:350)}onTabletBlur(){window.setTimeout((()=>{this.setTabletStyleForFocus(0),window.setTimeout((()=>{this.element.contains(document.activeElement)?(0,s.OF)()&&this.setTabletStyleForFocus(1):this.setTabletStyleForFocus(2)}),0)}),0)}setTabletStyleForFocus(e){if(e===this.tabletFocusState)return;if(this.tabletFocusState=e,(0,a.z1)())return void this.setTabletStyleForZoomFocus();if((0,s.Pb)())return;const t=!this.isPositionedForKeyboard();switch(this.element.style.top="unset",this.element.style.bottom="unset",this.element.style.visibility="",e){case 0:t?(0,s.OF)()?(this.element.style.visibility="none",this.element.style.bottom="60vh"):this.element.style.bottom=(0,l.K$)()?"35vh":"60vh":this.element.style.top="calc(var(--vh, 1vh) * 100 - 2px)";break;case 1:this.element.style.top="calc(var(--vh, 1vh) * 100)";break;case 2:this.element.style.bottom="0px";break;default:error("DmWindowManager - invalid focusState"),this.element.style.bottom="0px"}}setTabletStyleForZoomFocus(){if(!(0,s.OF)())return this.element.style.position="fixed",void(this.element.style.bottom="0px");switch(this.element.style.top="unset",this.element.style.bottom="unset",this.tabletFocusState){case 0:case 1:if(window.visualViewport){this.element.style.position="absolute";const e=Math.min(window.scrollY+window.visualViewport.height,this.maxZoomedTabletTop);this.element.style.top=`${e}px`}break;case 2:this.element.style.position="fixed",this.element.style.bottom="0px";break;default:error("DmWindowManager - invalid zoom focusState"),this.element.style.position="fixed",this.element.style.bottom="0px"}}isPositionedForKeyboard(){return this.element.getBoundingClientRect().bottom<=window.innerHeight-5}blur(){document.activeElement instanceof HTMLElement&&this.element.contains(document.activeElement)&&document.activeElement.blur()}bindListeners(){S.listen((e=>{var t;let{username:i,deleteWindow:s}=e;(null===(t=this.shownWindow)||void 0===t?void 0:t.username)===i&&this.removeShownWindow(),!0===s&&this.allDmWindowsMap.delete(i)})),x.listen((()=>{this.updateLocalStorage()})),w.H4.listen((e=>{const t=this.allDmWindowsMap.get(e.otherUsername);null==t||t.handleNewMessage(e)})),v.yT.conversationRead.listen((e=>{let{username:t,isDm:i}=e;if(i){const e=this.allDmWindowsMap.get(t);null==e||e.markRead()}})),m.Bm.current.isBroadcast&&c.xw.listen((e=>{const t=this.allDmWindowsMap.get(e.username);null==t||t.setUserInfo({isMod:e.isMod})})),(0,b.L)((e=>this.allDmWindowsMap.get(e)))}shownWindowUsername(){var e;return null===(e=this.shownWindow)||void 0===e?void 0:e.username}showUserConversation(e,t,i){if(this.transferToShown(e,i))return;const s=new y.sG({username:e,myUsername:this.myUsername,open:t,markAsRead:i,raiseWindowZIndexToTop:this.raiseWindowZIndexToTop});this.allDmWindowsMap.set(e,s),this.shownDmContainer.appendChild(s.element),this.showWindow(s,t,i)}removeShownWindow(){void 0!==this.shownWindow&&(this.shownWindow.removeFromDOM(),this.shownWindow=void 0,this.updateLocalStorage(),T.fire(void 0))}transferToShown(e,t){const i=this.allDmWindowsMap.get(e);return void 0!==i&&(this.shownDmContainer.appendChild(i.element),this.showWindow(i,!0,t),!0)}showWindow(e,t,i){this.removeShownWindow(),this.shownDmContainer.appendChild(e.element),e.setIsShowing(!0),e.openOrCollapseWindow(t,i,!i),i&&e.highlightHeaderForShow(),this.shownWindow=e,this.updateLocalStorage(),T.fire(void 0)}updateLocalStorage(){if(!(0,s.Pf)())return;let e;void 0!==this.shownWindow&&(e={username:this.shownWindow.username,isOpen:this.shownWindow.isWindowOpen()});const t=window.localStorage.getItem(P),i=null!==t?JSON.parse(t):{};i[this.myUsername]=JSON.stringify(e),window.localStorage.setItem(P,JSON.stringify(i))}}function A(e){let t;(0,p.vu)();const i=(i,s,n)=>{e!==i&&(void 0===t&&(t=k.getOrCreateInstance(e),document.body.appendChild(t.element)),t.showUserConversation(i,s,n))};(()=>{if(!(0,s.Pf)())return;const t=window.localStorage.getItem(P);if(null!==t){const s=JSON.parse(t)[e];if(void 0===s)return;const n=JSON.parse(s);i(n.username,n.isOpen,!1),T.fire(void 0)}})(),C.listen((e=>{i(e,!0,!0)}))}},268:(e,t,i)=>{"use strict";i.d(t,{i:()=>m});var s,n=i(6784),o=i(2709),r=i(5020),a=i(3955),l=i(8423),h=i(4947),d=i(1372),c=i(9447),u=i(8039),p=i(9603);class m extends o.u{constructor(e){super("span",e),this.listeners=new l.gt,this.hideTooltip=()=>{var e;null===(e=this.shownTooltip)||void 0===e||null===(e=e.parentElement)||void 0===e||e.removeChild(this.shownTooltip),this.shownTooltip=void 0};const t={display:"inline-block",width:"16px",height:"16px",marginLeft:"4px",...e.style};this.element=(0,d.tT)("span",{colorClass:"InRoomIndicator",style:t}),this.createTooltips(),this.setupTooltipListeners(),u.tb.listen((()=>{this.userInRoomState=u.SJ.getInstance().userInRoomState(e.username),this.updateUI()})).addTo(this.listeners),this.userInRoomState=u.SJ.getInstance().userInRoomState(e.username),this.updateUI()}dispose(){this.listeners.removeAll()}setupTooltipListeners(){m.documentClick.listen(this.hideTooltip).addTo(this.listeners),m.documentScroll.listen(this.hideTooltip).addTo(this.listeners),(0,a.JR)(this.element).listen((e=>{e?this.showTooltip():this.hideTooltip()})),(0,n.wu)("touchend",this.element,(e=>{void 0===this.shownTooltip?this.showTooltip():this.hideTooltip(),e.preventDefault()}))}createTooltips(){const e={hasHTML:!1,divotPosition:r.Wi.Bottom,divotLeftOrTop:"5px"};this.inRoomTooltip=(0,p.q)({content:h.R.userInRoom,...e}),this.notInPrivateTooltip=(0,p.q)({content:h.R.userNotInPrivate,...e}),this.notInRoomTooltip=(0,p.q)({content:h.R.userNotInRoom,...e});const t=[this.inRoomTooltip,this.notInPrivateTooltip,this.notInRoomTooltip];for(const e of t)e.style.position="fixed",e.style.display=""}showTooltip(){var e;let t;switch(this.hideTooltip(),this.userInRoomState){case 0:t=this.inRoomTooltip;break;case 1:t=this.notInPrivateTooltip;break;case 2:t=this.notInRoomTooltip}document.body.appendChild(t);const i=this.element.getBoundingClientRect(),s=(0,a.Mx)(),n=-s.left+i.left-7,o=-s.top+i.top-t.offsetHeight-6;t.style.top=`${o}px`,t.style.left=`${n}px`,t.style.width=`${(0,a.q_)(null!==(e=t.textContent)&&void 0!==e?e:"",t)+1}px`,this.shownTooltip=t}updateUI(){switch((0,c.SA)(this.element,"inRoom"),(0,c.SA)(this.element,"notInPrivate"),(0,c.SA)(this.element,"notInRoom"),this.userInRoomState){case 0:(0,c.fZ)(this.element,"inRoom");break;case 1:(0,c.fZ)(this.element,"notInPrivate");break;case 2:(0,c.fZ)(this.element,"notInRoom")}}render(){return this.element}}(s=m).documentClick=new l.c_("InRoomIndicator.documentClick",{listenersWarningThreshold:()=>50+3*l.hI}),s.documentScroll=new l.c_("InRoomIndicator.documentScroll",{listenersWarningThreshold:()=>50+3*l.hI})},9510:(e,t,i)=>{"use strict";i.d(t,{$w:()=>k,Xt:()=>A,c6:()=>D,V5:()=>w,xf:()=>S,$x:()=>x,TL:()=>C});var s=i(6784),n=i(213),o=i(5216),r=i(6844),a=i(2709),l=i(3955),h=i(8423),d=i(9447),c=i(2690);class u extends c.zf{constructor(){super(),(0,d.fZ)(this.element,"mediaPreviewModal"),(0,l.ZM)(this.element,{position:"fixed",width:"auto",height:"auto",left:"50%",top:"50%",transform:"translate(-50%, -50%)",borderRadius:"6px",padding:"10px",fontSize:"12px",fontFamily:"UbuntuRegular, Helvetica, Arial, sans-serif",zIndex:1005,textAlign:"center",boxShadow:"0 0 18px rgba(0, 0, 0, 0.4)"}),(0,l.ZM)(this.overlay,{backgroundColor:"#000000",opacity:"0.4",zIndex:1005}),this.element.dataset.testid="emoticon-modal";const e=document.createElement("div");(0,d.fZ)(e,"closeButton"),(0,l.ZM)(e,{display:"inline-block",position:"absolute",width:"10px",height:"10px",top:"9px",right:"9px",cursor:"pointer",opacity:"1"}),e.onclick=()=>{this.hide()},e.onmouseenter=()=>{e.style.opacity="1"},e.onmouseleave=()=>{e.style.opacity="0.5"},e.dataset.testid="close-button",this.element.appendChild(e),this.previewImage=document.createElement("img"),(0,l.ZM)(this.previewImage,{verticalAlign:"middle",padding:"10px",maxHeight:"60vh",maxWidth:"80vw"}),(0,s.wu)("load",this.previewImage,(()=>{this.previewImage.style.visibility="visible",this.repositionChildren()})),this.previewImage.dataset.testid="preview-image",this.element.appendChild(this.previewImage),this.overlayClick.listen((()=>{this.hide()}))}initAndShow(e){this.previewImage.style.visibility="hidden",this.previewImage.src=e,super.show(),this.removeDocumentFocus(),this.repositionChildren()}hide(){super.hide()}show(){super.show(),this.element.style.visibility="",this.repositionChildren()}removeDocumentFocus(){null!==document.activeElement&&document.activeElement.blur()}}var p=i(4947),m=i(1372),g=i(3860),v=i(6318),f=i(3885),y=i(3172);const b={...y.wt,cursor:"default"},w=20,C=new h.c_("showMobileMediaDock"),S=new h.c_("mobileMediaUploadProgress"),x=()=>64;class T extends a.u{constructor(e){super(),this.parentContents=e,this.scrollSize=P.itemWidth,this.mediaPreviewModal=new u,this.listeners=new h.gt;const t={height:"100%",position:"absolute",zIndex:1e3,opacity:.8,borderRadius:0,border:"none",fill:"currentColor",cursor:"pointer"},i={minHeight:"77px",width:"auto",minWidth:"100%",cssFloat:"left",boxSizing:"border-box",padding:`${T.padding}px`,whiteSpace:"nowrap",position:"relative"};this.dock=new a.u,(0,l.ZM)(this.dock,i),this.element=(0,m.tT)("div",{className:"pmMediaDockContainer",style:{flexShrink:0,position:"relative",display:"none",overflowX:"hidden",whiteSpace:"nowrap",bottom:0}},(0,m.tT)("button",{ref:e=>this.scrollLeftBtn=e,onClick:()=>{this.scrollLeft()},style:{...t,left:0},colorClass:"scrollButton"},(0,m.tT)("svg",{width:"8",height:"12",viewBox:"0 0 8 12",xmlns:"http://www.w3.org/2000/svg"},(0,m.tT)("path",{d:"M9.19276e-07 5.98581C-0.000425611 5.65497 0.147594 5.33999 0.406233 5.12135L6.21431 0.216066C6.6146 -0.106384 7.20982 -0.0630863 7.55493 0.313586C7.90004 0.690259 7.8688 1.26253 7.48456 1.6025L2.40562 5.89181C2.37742 5.91555 2.36125 5.9498 2.36125 5.98581C2.36125 6.02182 2.37742 6.05607 2.40562 6.07981L7.48456 10.3691C7.75191 10.5845 7.87679 10.922 7.81086 11.251C7.74493 11.58 7.49854 11.8489 7.16704 11.9537C6.83554 12.0584 6.47093 11.9826 6.21431 11.7556L0.408316 6.85177C0.149051 6.63276 0.000328855 6.31734 9.19276e-07 5.98581Z",fill:"#222222"}))),(0,m.tT)("button",{ref:e=>this.scrollRightBtn=e,onClick:()=>{this.scrollRight()},style:{...t,right:0},colorClass:"scrollButton"},(0,m.tT)("svg",{width:"8",height:"12",viewBox:"0 0 8 12",xmlns:"http://www.w3.org/2000/svg"},(0,m.tT)("path",{d:"M8 5.98581C8.00043 5.65497 7.85241 5.33999 7.59377 5.12135L1.78569 0.216066C1.3854 -0.106384 0.790178 -0.0630863 0.44507 0.313586C0.0999627 0.690259 0.131205 1.26253 0.515437 1.6025L5.59438 5.89181C5.62258 5.91555 5.63875 5.9498 5.63875 5.98581C5.63875 6.02182 5.62258 6.05607 5.59438 6.07981L0.515437 10.3691C0.248085 10.5845 0.123215 10.922 0.189144 11.251C0.255072 11.58 0.501458 11.8489 0.832959 11.9537C1.16446 12.0584 1.52907 11.9826 1.78569 11.7556L7.59168 6.85177C7.85095 6.63276 7.99967 6.31734 8 5.98581Z",fill:"#222222"}))),(0,m.tT)("div",{ref:e=>this.scrollContainer=e,onScroll:()=>{this.setScrollButtonVisibility()},style:{overflow:"scroll",width:"100%",position:"relative"},className:"noScrollbar"},this.dock.element)),this.setScrollButtonVisibility(),v.bs.listen((e=>{var t;null===(t=this.getImageById(e))||void 0===t||t.removeElement()})).addTo(this.listeners),v.C0.listen((e=>{var t;null===(t=this.getImageById(e))||void 0===t||t.markRejected()})).addTo(this.listeners)}repositionChildren(){this.setScrollButtonVisibility()}scrollLeft(){this.scrollContainer.scrollLeft-=this.scrollSize,this.setScrollButtonVisibility()}scrollRight(){this.scrollContainer.scrollLeft+=this.scrollSize,this.setScrollButtonVisibility()}setScrollButtonVisibility(){const e=this.scrollContainer;this.scrollLeftBtn.style.display=e.scrollLeft>0?"block":"none",this.scrollRightBtn.style.display=e.scrollLeft+2<e.scrollWidth-e.offsetWidth?"block":"none"}toggle(){this.isShown()?this.hide():this.show(),window.setTimeout((()=>{this.setScrollButtonVisibility()}),0)}show(){this.isShown()||(this.showElement(),this.scrollRightBtn.click(),this.scrollLeftBtn.click(),this.parentContents.repositionChildrenRecursive())}hide(){this.hideElement(),this.onHide(),this.hideMediaPreview(),this.parentContents.repositionChildrenRecursive()}setPreviewModal(e){this.mediaPreviewModal.initAndShow(e)}hideMediaPreview(){this.mediaPreviewModal.hide()}removeItem(e){this.dock.removeChild(e)}items(){return this.dock.children()}getImageById(e){return this.items().find((t=>{var i;return(null===(i=t.media)||void 0===i?void 0:i.mediaId)===e}))}clear(){for(;this.items().length>0;)this.items().forEach((e=>{e.remove()}))}isEmpty(){return 0===this.items().length}async mediaList(){return Promise.all(this.items().map((e=>e.mediaPromise)))}onHide(){}}T.padding=5;class P extends a.u{constructor(e,t){super(),this.mediaPromise=e,this.parentDock=t,this.element=(0,m.tT)("div",{style:{...b,backgroundImage:""},colorClass:"mediaDockItem"},(0,m.tT)("img",{src:`${STATIC_URL_ROOT}tsdefaultassets/mediaDock/closeButton.svg`,onClick:e=>{e.stopPropagation(),this.remove()},ref:e=>this.removeBtn=e,style:{position:"absolute",top:0,right:0,zIndex:1,cursor:"pointer"}}),(0,m.tT)("div",{style:{...b,position:"absolute"},ref:e=>this.imageContainer=e},(0,m.tT)(f._,{myRef:e=>{this.loadingSpinner=e}}))),e.then((e=>{this.onload(e)})),this.loadingSpinner.dataset.testid="chat-image-loading-spinner"}onload(e){this.media=e;const t=new Image;t.onload=()=>{const e=new Image;e.src=t.src,e.style.width="100%",e.style.height="auto",this.imageContainer.appendChild(e),this.loadingSpinner.style.display="none"},t.src=e.thumbnailUrl}removeElement(){this.parentDock.removeItem(this)}}P.itemWidth=y.Ew+2;class k extends T{constructor(e,t,i){super(e),this.toUser=t,this.videoModes=i,this.fileInput=(0,m.tT)("input",{type:"file",accept:".jpg,.jpeg,.png,.gif,.heic,.heif,.webp",multiple:!0}),this.loadingSpinner=new M,this.initSibling();const s=(0,m.tT)("div",{style:{...b,cursor:"pointer",backgroundImage:"none",backgroundColor:"#2C2C2C"}},(0,m.tT)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) scale(1.5)"}},(0,m.tT)("img",{src:`${STATIC_URL_ROOT}tsdefaultassets/mediaDock/uploadBackground.svg`}),(0,m.tT)("img",{src:`${STATIC_URL_ROOT}tsdefaultassets/mediaDock/uploadSymbol.svg`,style:{position:"absolute",bottom:0,right:0,transform:"translate(50%, 25%) scale(0.66)"}})));s.dataset.testid="upload-image-button",s.onclick=()=>{this.showSelectDialog()},this.dock.element.appendChild(s),this.dock.element.dataset.testid="image-dock",this.fileInput.onchange=()=>{this.onFileInputChange()},(0,r.ok)()||this.getLatest(),g.L.changeVideoMode.listen((e=>{this.videoModes.includes(e.currentMode)&&!(0,r.ok)()&&this.getLatest()})).addTo(this.listeners),v.xV.listen((e=>{const t=g.L.getVideoMode();this.videoModes.includes(t)&&this.toUser===e.toUser&&(this.handleFileUpload(...e.files),this.show())})).addTo(this.listeners),v.vI.listen((e=>{this.videoModes.includes(g.L.getVideoMode())&&this.addItem(new I(e.promise,this,this.toUser===e.toUser))}),!1).addTo(this.listeners)}initSibling(){this.sibling=new E(this.parentContents),this.sibling.sibling=this}dispose(){this.listeners.removeAll(),this.sibling.dispose()}async onFileInputChange(){null!==this.fileInput.files&&(this.handleFileUpload(...this.fileInput.files),this.fileInput.value="")}async handleFileUpload(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(const e of t)await(0,v.sc)(e,this.toUser)}showSelectDialog(){this.fileInput.click()}addItem(e){for(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&this.items().length>0?this.dock.addChildBeforeIndex(e,0):this.dock.addChild(e),e.mediaPromise.then((t=>{const i=this.sibling.getImageById(t.mediaId);void 0!==i&&e.setSibling(i)}));this.items().length>w;)this.dock.removeChild(this.dock.lastChild());this.setScrollButtonVisibility()}getImageById(e){return this.items().find((t=>{var i;return(null===(i=t.media)||void 0===i?void 0:i.mediaId)===e}))}getLatest(){this.dock.removeAllChildren(),this.dock.addChild(this.loadingSpinner),this.setScrollButtonVisibility(),(0,v.nu)().then((e=>{this.dock.removeAllChildren(),this.loadingSpinner.element.style.display="none";for(const t of e)this.addItem(new I(Promise.resolve(t),this),!0);this.setScrollButtonVisibility()})).catch((()=>{this.loadingSpinner.element.style.display="none",this.setScrollButtonVisibility()}))}items(){return super.items()}show(){super.show(),this.sibling.showIfNonempty()}hide(){super.hide(),this.sibling.hide()}}class A extends T{constructor(e){super(e),this.parentContents=e,this.scrollSize=R.itemWidth,this.loadingSpinner=new M,this.fileInput=(0,m.tT)("input",{type:"file",accept:".jpg,.jpeg,.png,.gif,.heic,.heif,.webp",multiple:!0}),this.room="",this.element.style.boxSizing="border-box",this.element.style.borderTopLeftRadius="4px",this.element.style.borderTopRightRadius="4px",this.element.style.borderBottom="none",this.element.dataset.testid="mobile-image-dock",(0,d.fZ)(this.element,"SelectedMediaDock"),this.dock.element.style.borderTopColor="#EFEFEF",this.dock.element.style.borderTopWidth="1px",this.dock.element.style.borderTopStyle="solid",this.dock.removeAllChildren(),this.hideLoadingSpinner(),this.fileInput.onchange=()=>{this.onFileInputChange()},this.element.ontouchmove=e=>{e.stopPropagation()}}repositionChildren(){this.setScrollButtonVisibility()}show(){this.isShown()||(window.setTimeout((()=>{this.setScrollButtonVisibility()}),0),this.showElement(),this.parentContents.repositionChildrenRecursive())}hide(){super.hide(),C.fire(!1)}showLoadingSpinner(){this.dock.removeAllChildren(),this.dock.addChild(this.loadingSpinner),this.loadingSpinner.showElement()}hideLoadingSpinner(){var e;null===(e=this.loadingSpinner.parent)||void 0===e||e.removeChild(this.loadingSpinner),this.loadingSpinner.hideElement()}setRoom(e){this.room=e}getRoom(){return this.room}onFileInputChange(){null!==this.fileInput.files&&(this.processFiles(...this.fileInput.files),this.fileInput.value="")}processFiles(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(const e of t){if(this.mobileItems().length>=10){(0,n.Q$)(p.R.errorUploadMediaLimit(10));break}this.addMediaItem(new R(e,this))}Promise.all(this.mobileItems().map((e=>e.uploadPromise))).then((e=>{e.some((e=>!1===e))&&(0,n.Q$)(p.R.errorUploadingMedia)}))}showSelectDialog(){this.fileInput.click()}addItem(e){}addMediaItem(e){for(this.mobileItems().length>0?this.dock.addChildBeforeIndex(e,0):(this.show(),this.dock.addChild(e),C.fire(!0));this.mobileItems().length>10;)this.dock.removeChild(this.dock.lastChild());S.fire()}removeItem(e){this.dock.removeChild(e),this.isEmpty()&&this.hide(),S.fire()}mobileItems(){return this.dock.children().filter((e=>e!==this.loadingSpinner))}clear(){for(;this.mobileItems().length>0;)this.mobileItems().forEach((e=>{e.removeElement()}))}isEmpty(){return 0===this.mobileItems().length}mobileMediaList(){return this.mobileItems().map((e=>e.media))}isUploading(){return this.mobileItems().some((e=>void 0===e.media))}onHide(){this.clear()}dispose(){this.listeners.removeAll()}}class M extends a.u{constructor(){super(),this.element=(0,m.tT)("div",{style:{...b,backgroundImage:""}},(0,m.tT)("div",{style:{...b,position:"absolute"}},(0,m.tT)(f._,null)))}}class R extends a.u{constructor(e,t){super(),this.parentDock=t,this.file=e,this.element=(0,m.tT)("div",{style:{...b,backgroundImage:""},colorClass:"mediaDockItem"},(0,m.tT)("img",{src:`${STATIC_URL_ROOT}tsdefaultassets/mediaDock/closeButton.svg`,onClick:e=>{e.stopPropagation(),this.remove()},style:{position:"absolute",top:0,right:0,zIndex:1,cursor:"pointer",width:"15px",height:"15px"}}),(0,m.tT)("div",{style:{...b,position:"absolute"},ref:e=>this.imageContainer=e},(0,m.tT)(f._,{myRef:e=>{this.loadingSpinner=e},extraStyle:{background:"rgba(0,0,0,0.1)"}}))),(0,l.ZM)(this.imageContainer,{display:"flex",justifyContent:"center",alignItems:"center"});const i=this.createThumbnail();this.imageContainer.appendChild(i),this.uploadPromise=this.uploadMediaFile(e,i)}createThumbnail(){const e=new Image;return e.style.width="auto",e.style.width="-moz-available",e.style.width="-webkit-fill-available",e.style.width="fill-available",e.style.height="auto",e.style.height="-moz-available",e.style.height="-webkit-fill-available",e.style.height="fill-available",e.onclick=()=>{void 0!==this.media&&this.parentDock.setPreviewModal(this.media.url)},e}uploadMediaFile(e,t){return(0,v.sc)(e,this.parentDock.getRoom()).then((e=>(t.src=e.thumbnailUrl,this.media=e,this.hideLoadingSpinner(),!0))).catch((e=>{if(this.parentDock.removeItem(this),e instanceof o.fr){if(400===e.xhr.status){const t=JSON.parse(e.xhr.responseText).errors;if(void 0!==t)return void("invalid_media"===t.media?(0,n.Q$)(p.R.invalidFileErrorUploadingMedia):"legal_block"===t.media&&(0,n.Q$)(p.R.legalBlockErrorUploadingMedia))}return!1}"file_too_large"===e&&(0,n.Q$)(p.R.fileSizeErrorUploadingMedia)})).finally((()=>{S.fire()}))}remove(){if(void 0===this.media||this.isSpinnerVisible())return;this.showLoadingSpinner();const e=this.imageContainer.querySelector("img");this.imageContainer.removeChild(e),(0,v.IM)(this.media.mediaId).then((()=>{})).catch((()=>{this.hideLoadingSpinner(),this.imageContainer.appendChild(e),(0,n.Q$)(p.R.errorDeletingMedia)}))}removeElement(){this.parentDock.removeItem(this)}showLoadingSpinner(){this.loadingSpinner.style.display="block"}hideLoadingSpinner(){this.loadingSpinner.style.display="none"}isSpinnerVisible(){return"none"!==this.loadingSpinner.style.display}}R.itemWidth=y.Ew+2;class I extends P{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e,t),this.autoselect=i,this.selected=!1,this.rejected=!1,e.catch((e=>{if(this.removeElement(),e instanceof o.fr){if(400===e.xhr.status){const t=JSON.parse(e.xhr.responseText).errors;if(void 0!==t)return void("invalid_media"===t.media?(0,n.Q$)(p.R.invalidFileErrorUploadingMedia):"legal_block"===t.media&&(0,n.Q$)(p.R.legalBlockErrorUploadingMedia))}(0,n.Q$)(p.R.errorUploadingMedia)}else"file_too_large"===e&&(0,n.Q$)(p.R.fileSizeErrorUploadingMedia)})),this.selectedIcon=(0,m.tT)("img",{ref:e=>this.selectedIcon=e,src:`${STATIC_URL_ROOT}tsdefaultassets/mediaDock/selected.svg`,style:{position:"absolute",bottom:0,right:0,zIndex:1,display:"none"}}),this.element.appendChild(this.selectedIcon),this.removeBtn.style.display="none"}onload(e){super.onload(e),this.removeBtn.style.display="block",this.autoselect&&window.setTimeout((()=>{this.select()}),0),this.element.onclick=()=>{this.toggleSelect()}}toggleSelect(){this.selected?this.deselect():this.select()}select(){this.selected||(this.selected=!0,this.removeBtn.style.display="none",this.selectedIcon.style.display="block",this.createSibling(),this.parentDock.sibling.addItem(this.sibling),this.parentDock.sibling.show(),this.parentDock.sibling.setScrollButtonVisibility())}createSibling(){void 0===this.sibling&&(this.sibling=new L(this.mediaPromise,this.parentDock.sibling),this.sibling.sibling=this)}setSibling(e){void 0===this.sibling?(this.selected=!0,this.removeBtn.style.display="none",this.selectedIcon.style.display="block",this.sibling=e,this.sibling.sibling=this):error("LibraryMediaDockItem sibling exists")}deselect(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;this.selected=!1,this.removeBtn.style.display="block",this.selectedIcon.style.display="none",e||null===(t=this.sibling)||void 0===t||t.remove(!0)}remove(){this.rejected?this.removeElement():(0,n.mf)(p.R.confirmPhotoDelete,(()=>{if(void 0===this.media)return void error("Attempting to delete media before it is loaded");this.loadingSpinner.style.display="block";const e=this.imageContainer.querySelector("img");this.imageContainer.removeChild(e),(0,v.IM)(this.media.mediaId).then((()=>{})).catch((()=>{this.loadingSpinner.style.display="none",this.imageContainer.appendChild(e),(0,n.Q$)(p.R.errorDeletingMedia)}))}))}markRejected(){this.element.removeChild(this.imageContainer),this.element.onclick=null;const e=(0,m.tT)("div",{style:{whiteSpace:"break-spaces",fontSize:"11px",width:"100%",height:"100%",padding:"2px"},colorClass:"rejected"},p.R.removedForViolation);this.element.appendChild(e),this.rejected=!0}removeElement(){var e;super.removeElement(),(0,v.f1)(1,w-1).then((e=>{var t;if(e.length>0){const t=Promise.resolve(e[0]),i=new I(t,this.parentDock);this.parentDock.addItem(i,!0)}null===(t=this.parentDock)||void 0===t||t.setScrollButtonVisibility()})),this.loadingSpinner.style.display="none",null===(e=this.parentDock)||void 0===e||e.setScrollButtonVisibility()}}class E extends T{constructor(e){super(e),this.element.style.boxSizing="border-box",this.element.style.borderTopLeftRadius="4px",this.element.style.borderTopRightRadius="4px",this.element.style.borderBottom="none",this.element.dataset.testid="staged-image-dock",(0,d.fZ)(this.element,"SelectedMediaDock")}addItem(e){this.dock.addChild(e)}getImageById(e){return super.getImageById(e)}showIfNonempty(){this.isEmpty()||this.show()}hideIfEmpty(){this.isEmpty()&&this.hide()}onHide(){this.clear()}dispose(){this.listeners.removeAll()}}class L extends P{constructor(e,t){super(e,t),this.element.onclick=()=>{void 0!==this.media&&this.parentDock.setPreviewModal(this.media.url)}}remove(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;this.removeElement(),this.parentDock.setScrollButtonVisibility(),this.parentDock.hideIfEmpty(),e||null===(t=this.sibling)||void 0===t||t.deselect(!0)}markRejected(){this.remove()}}function D(e,t){const i=(0,m.tT)("div",{style:{position:"absolute",top:"0",left:"0",boxSizing:"border-box",height:"100%",width:"100%",background:"rgba(0,0,0,0.5)",padding:"10px",display:"none",zIndex:1e3}},(0,m.tT)("div",{style:{border:"3px dashed white",padding:"10px",height:"calc(100% - 26px)"}}));e.appendChild(i),(0,s.Xq)(["dragenter","dragover","dragleave","drop"],e,(e=>{e.preventDefault(),e.stopPropagation()})),(0,s.Xq)(["dragenter","dragover"],e,(e=>{e.dataTransfer&&e.dataTransfer.types.includes("Files")&&(i.style.display="block")})),(0,s.Xq)(["dragleave","drop"],i,(e=>{i.style.display="none"})),(0,s.wu)("drop",i,(e=>{if(!(0,r.rC)()){var i,s;const n=Array.from(null!==(i=null===(s=e.dataTransfer)||void 0===s?void 0:s.files)&&void 0!==i?i:[]);v.xV.fire({toUser:t,files:n})}}))}},7660:(e,t,i)=>{"use strict";i.d(t,{_:()=>u});var s,n=i(7623),o=i(213),r=i(3955),a=i(4947),l=i(1372),h=i(6318),d=i(3885),c=i(3172);class u{constructor(e){var t;this.mediasetProps=e,this.element=(0,l.tT)("div",null),this.overlays=new Map,this.thumbnails=new Map,this.images=new Map,m||(h.C0.listen((e=>{u.deleteMediasetsMedia(e)})),m=!0),u.messageLedger.has(e.messageId)||u.messageLedger.set(e.messageId,[]),null===(t=u.messageLedger.get(e.messageId))||void 0===t||t.push(this),this.mediasetProps.mediaList.forEach((e=>{var t;const i=this.createThumbnail(e);this.element.appendChild(i),this.thumbnails.set(e.mediaId,i),u.mediaLedger.has(e.mediaId)||u.mediaLedger.set(e.mediaId,[]),null===(t=u.mediaLedger.get(e.mediaId))||void 0===t||t.push(this)}))}createThumbnail(e){if(""===e.url){const e=(0,l.tT)("div",{style:c.wt});return p(e),e}let t,i,s,o=!1;return t=(0,l.tT)("div",{style:c.wt},(0,l.tT)(d._,{myRef:e=>{i=e},extraStyle:{background:"rgba(0,0,0,0.6)"}}),(0,l.tT)("img",{src:e.thumbnailUrl,ref:e=>s=e,style:{position:"absolute",maxHeight:"100%"},onLoad:()=>{if(o=!0,this.images.set(e.mediaId,s),i.style.display="none",s.dataset.testid="pvt-img",!0!==e.opened)if(this.mediasetProps.outgoing){const i=function(){const e={color:"#FFFFFF",backgroundColor:"#2067AB",fontFamily:"'UbuntuBold', Arial, Helvetica, sans-serif",fontSize:"8px",position:"absolute",bottom:"2px",right:"2px",padding:"0px 1px",lineHeight:"20px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:c.Ew-4+"px",boxSizing:"border-box",zIndex:1},t=document.createElement("span");return t.textContent=a.R.unopenedCAPS,t.title=t.textContent,(0,r.ZM)(t,e),t}();this.overlays.set(e.mediaId,i),t.appendChild(i)}else s.dataset.testid="blurred-pvt-img",s.style.filter="blur(8px)"},onError:async e=>{i.style.display="block",(0,n.lT)()&&(await new Promise((e=>window.setTimeout(e,300))),o)?i.style.display="none":p(t)}})),t.onclick=()=>{const t={...this.mediasetProps,mediaList:[...this.mediasetProps.mediaList]};c.fY.loadMedia(t,e)},t}static markOpened(e,t){var i;const s=null!==(i=u.messageLedger.get(e))&&void 0!==i?i:[];for(const e of s)if(void 0!==e){var n;const i=e.overlays.get(t);null==i||null===(n=i.parentElement)||void 0===n||n.removeChild(i),e.overlays.delete(t);const s=e.images.get(t);s&&(s.style.filter="",s.dataset.testid="pvt-img")}}deleteMedia(e){this.mediasetProps.mediaList=this.mediasetProps.mediaList.filter((t=>t.mediaId!==e));const t=this.thumbnails.get(e);void 0!==t&&p(t)}static deleteMediasetsMedia(e){for(const i of null!==(t=u.mediaLedger.get(e))&&void 0!==t?t:[]){var t;i.deleteMedia(e)}}}function p(e){const t=(0,l.tT)("img",{src:`${STATIC_URL_ROOT}images/no_thumbnail_1.jpg`,style:{position:"absolute",maxHeight:"100%",left:"-9px"}});for(;null!==e.firstChild;)e.removeChild(e.firstChild);e.appendChild(t),e.onclick=()=>{(0,o.Q$)(a.R.errorLoadingMedia)}}(s=u).messageLedger=new Map,s.mediaLedger=new Map;let m=!1},5728:(e,t,i)=>{"use strict";i.d(t,{b3:()=>g,od:()=>p,sV:()=>m,yA:()=>u});var s=i(8638),n=i(2709),o=i(8423),r=i(9060),a=i(4947),l=i(1372),h=i(9461),d=i(8039),c=i(268);const u=new o.c_("goPMList"),p=new o.c_("ignoreUser");class m extends n.u{constructor(e,t){super();const i={margin:"0 8px",display:t===h.Aw.getState().room?"none":"",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"};this.element=(0,l.tT)("div",{colorClass:"PMControlBar",style:{width:"100%",height:"31px",lineHeight:"32px",borderBottomWidth:"1px",borderBottomStyle:"solid",fontSize:"12px",justifyContent:"flex-start"},id:"pm-control-bar"},(0,l.tT)("span",{colorClass:"backButton",style:{marginLeft:"10px",cursor:"pointer"},onClick:()=>{u.fire(e)},"data-testid":"back-to-conversation-list-button"},(0,r.nV)()?s.i._({id:"iH8pgl",message:"Back"}):a.R.back),(0,l.tT)("span",{style:i},(0,r.nV)()?s.i._({id:"IOpwtm",message:"(Ctrl+L to close)"}):a.R.ctrlLToClose),(0,d.It)()&&(0,l.tT)(c.i,{classRef:e=>this.inRoomIndicator=e,username:t,style:{marginTop:"8px"}})),this.element.classList.add("pm-control-bar")}dispose(){var e;null===(e=this.inRoomIndicator)||void 0===e||e.dispose()}}class g{constructor(){this.showing=!1,this.getElement=()=>this.element,this.isShowing=()=>this.showing,this.hideLoading=()=>{this.element.style.display="none",this.showing=!1},this.showLoading=()=>{this.element.style.display="block",this.showing=!0},this.element=(0,l.tT)("div",{style:{display:"none",textAlign:"center"}},(0,r.nV)()?s.i._({id:"gQVjn8",message:"Loading More Messages"}):a.R.loadingMoreMessages)}}},4564:(e,t,i)=>{"use strict";i.d(t,{I:()=>c});var s=i(7623),n=i(1519),o=i(2709),r=i(8423),a=i(7407),l=i(4947),h=i(1372),d=i(9461);class c extends o.u{constructor(e){super("div",e),this.listenerGroup=new r.gt,this.events={navigateSuggestions:new r.c_("navigateSuggestions"),openCurrentSuggestion:new r.c_("openCurrentSuggestion"),inputChange:new r.c_("inputChange"),suggestionActiveEvent:new r.c_("suggestionActiveEvent")},this.value="",this.events.suggestionActiveEvent.listen((e=>{const t=e.slug;this.input.value=""===t?this.value:t})).addTo(this.listenerGroup),this.debouncer=new n.a((()=>{const t=this.value.match(/^[\w-]*$/);this.events.inputChange.fire({isFullVideo:e.isFullVideoMode,isValid:null!==t,prefix:this.value})}),{bounceLimitMS:100,debounceType:1})}initUI(e){const t={background:"none",height:"24px",borderWidth:"1px",borderStyle:"solid",boxSizing:"border-box",borderRadius:"3px",margin:"0",padding:"5px 22px 5px 8px",width:"100%",outline:"none",fontFamily:"Tahoma, Arial, Helvetica, sans-serif",fontSize:d.Bm.current.isMobile?"16px":"12px"},i={height:"1em",margin:"auto",position:"absolute",right:"10px",top:d.Bm.current.isMobile?"7px":"10px"};this.element=(0,h.tT)("div",{colorClass:"SearchBar",style:{position:"relative",width:"100%",padding:"4px",boxSizing:"border-box",borderBottomWidth:"1px",borderBottomStyle:"solid"}},(0,h.tT)("input",{colorClass:"searchUserInput",className:"search_autocomplete","data-testid":"username-search",type:"text",placeholder:l.R.searchUsers,style:t,onFocus:()=>{const t=""===e.room?"PMWindow":"PMTab";(0,a.bT)("PMSearchStarted",{location:t})},onKeyDown:e=>{!function(e){return"ArrowDown"===e.key||"ArrowUp"===e.key||40===e.keyCode||38===e.keyCode}(e)?"Enter"!==e.key&&13!==e.keyCode||(e.preventDefault(),(0,s.Xb)()&&this.input.blur(),this.events.openCurrentSuggestion.fire(void 0)):(e.preventDefault(),this.events.navigateSuggestions.fire({event:e}))},onInput:()=>{const e=this.input.value.toLowerCase();this.value=e,this.input.value=e,this.debouncer.callFunc()},ref:e=>this.input=e}),(0,h.tT)("img",{src:`${STATIC_URL}pms/icon-search.svg`,alt:"Search",style:i}))}getInput(){return this.input}focus(){this.input.focus()}render(){return this.element}clear(){this.input.value=""}dispose(){this.listenerGroup.removeAll()}}},1885:(e,t,i)=>{"use strict";i.d(t,{BM:()=>r,H4:()=>o,J9:()=>n,Si:()=>l,ot:()=>h,wl:()=>a});var s=i(8423);const n=new s.c_("privateMessage"),o=new s.c_("directMessage"),r=new s.c_("showPmSession"),a=new s.c_("closePmSession"),l=new s.c_("allPmsRead"),h=new s.c_("allDmsRead")},753:(e,t,i)=>{"use strict";i.d(t,{X:()=>l});var s=i(6784),n=i(6144),o=i(1372),r=i(816),a=i(9937);class l extends r.D0{constructor(e){super(e)}initializeData(e){super.initializeData(e),this.choices=void 0===e.choices?[]:e.choices,this.maxLength=e.maxLength,this.currentValues=void 0===e.defaultValue?[]:e.defaultValue}getValue(){return this.currentValues.join(",")}createField(){return this.activeChoicesContainer=(0,o.tT)("div",{className:"activeChoicesContainer","data-testid":"multiSelectActiveChoices",tabIndex:0},(0,o.tT)("div",{className:"dropdownMenuIcon"})," ",this.currentValues.map((e=>this.createActiveChoice(e)))),this.activeChoicesContainer}initCheckboxesDropdown(){this.checkboxesDropdown=new h(this.activeChoicesContainer,{choices:this.choices,defaultValue:this.currentValues,fieldName:this.name,disabled:this.disabled,handleCheckboxChange:(e,t)=>{this.handleCheckboxChange(e,t),this.fieldChanged.fire()}}),this.disableEnableCheckboxes()}disableEnableCheckboxes(){const e=this.maxLength;void 0!==e&&this.checkboxesDropdown.checkboxes.forEach((t=>{t.isChecked()||(this.currentValues.length>=e?t.disable():t.enable())}))}handleCheckboxChange(e,t){e.target.checked?(this.currentValues.push(t),this.activeChoicesContainer.appendChild(this.createActiveChoice(t))):(this.currentValues=this.currentValues.filter((e=>e!==t)),this.removeActiveChoice(t)),this.disableEnableCheckboxes()}createActiveChoice(e){var t;return(0,o.tT)("div",{className:"activeChoiceElement","data-testid":"multiSelectActiveChoice","data-value":e},null===(t=this.choices.find((t=>String(t.value)===e)))||void 0===t?void 0:t.label)}removeActiveChoice(e){const t=this.activeChoicesContainer.querySelector(`[data-value="${e}"]`);t&&this.activeChoicesContainer.removeChild(t)}assembleField(){this.widget=this.createField(),this.initCheckboxesDropdown(),this.widgetContainer.appendChild(this.widget),this.widgetContainer.appendChild(this.checkboxesDropdown.element)}afterAssembleField(){super.afterAssembleField(),this.getHelpTextElement().classList.add("helpText"),this.getWidgetContainer().classList.add("multiSelectDropdown"),(0,s.wu)("keydown",this.widgetContainer,(e=>{switch(e.code){case"Escape":case"Tab":this.checkboxesDropdown.isShown()&&(e.preventDefault(),this.checkboxesDropdown.hideElement(),this.activeChoicesContainer.focus());break;case"ArrowDown":e.preventDefault(),this.checkboxesDropdown.focus();break;case"ArrowUp":e.preventDefault(),this.checkboxesDropdown.focus(!0)}}))}}class h extends n.v{constructor(e,t){super(e,!0,t),this.focusedIndex=0}initData(e){this.checkboxes=[],this.choices=e.choices,this.defaultValue=e.defaultValue,this.fieldName=e.fieldName,this.disabled=e.disabled}initUI(e){super.initUI(e),this.element=(0,o.tT)("div",{className:"checkboxesDropdown","data-testid":"multiSelectCheckboxesDropdown",style:{display:"none"},onKeyDown:e=>this.onKeyDown(e)},this.choices.map((t=>(0,o.tT)("label",{className:"checkboxFieldLabel"},this.createCheckbox(t.value,e.handleCheckboxChange),(0,o.tT)("div",{className:"checkFieldName"},String(t.label))))))}onKeyDown(e){switch(e.code){case"ArrowDown":e.preventDefault(),e.stopPropagation(),this.focusNext();break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),this.focusPrev()}}createCheckbox(e,t){const i=-1!==this.defaultValue.indexOf(String(e)),s=new a.m(16,i);return s.setName(this.fieldName),s.setCheckboxValue(String(e)),this.disabled&&s.disable(),this.checkboxes.push(s),void 0!==t&&s.element.addEventListener("change",(i=>{t(i,String(e))})),s.element}focusNext(){const e=(this.focusedIndex+1)%this.checkboxes.length;this.focusIndex(e)}focusPrev(){const e=(this.focusedIndex>0?this.focusedIndex:this.checkboxes.length)-1;this.focusIndex(e)}focusIndex(e){this.checkboxes[e].focus(),this.focusedIndex=e}showElement(){const e=this.toggleElement;return null!==e&&(null==e||e.classList.add("dropdown-shown")),super.showElement("flex")}hideElement(){const e=this.toggleElement;return null!==e&&(null==e||e.classList.remove("dropdown-shown")),super.hideElement()}focus(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.focusIndex(e?this.checkboxes.length-1:0)}}},7209:(e,t,i)=>{"use strict";i.d(t,{w:()=>A,J:()=>T});var s=i(4936),n=i(213),o=i(6844),r=i(2939),a=i(82),l=i(3955),h=i(8423),d=i(6440),c=i(7407),u=i(1452),p=i(4947),m=i(9461),g=i(6064),v=i(7537),f=i(1372);class y extends v.o{constructor(e){super(e),this.defineTabbableElements([this.okButton])}createElement(){return(0,f.tT)("div",{className:"promoteDisabledModal"},(0,f.tT)("div",{className:"title"},p.R.promotionUnavailableTitle),(0,f.tT)("div",{className:"description"},p.R.promotionUnavailableDescription),(0,f.tT)("div",{className:"buttonDiv"},(0,f.tT)("div",{className:"okButton","data-testid":"promotion-disabled-accept",onClick:()=>{this.hide()},ref:e=>{this.okButton=e}},p.R.confirmOK)))}}var b=i(8861),w=i(1474),C=i(1679),S=i(2650);class x extends v.o{constructor(e){super(e),this.props=e,this.defineTabbableElements([this.notNotButton,this.acceptButton])}createElement(e){return(0,f.tT)("div",{className:"promoteRoomConfirmation"},(0,f.tT)("div",{className:"title"},p.R.promotionConfirmTitle),(0,f.tT)("div",{className:"description"},p.R.promotionConfirmDescription),(0,f.tT)("div",{className:"price",ref:e=>{this.priceText=e}},`${p.R.userPromotionCurrentPriceLabel}:`),(0,f.tT)("div",{className:"buttonDiv"},(0,f.tT)("div",{className:"notNowButton","data-testid":"promote-confirm-notnow",onClick:()=>{this.hide()},ref:e=>{this.notNotButton=e}},p.R.notNowText),(0,f.tT)("div",{className:"promoteButton","data-testid":"promote-confirm-accept",onClick:()=>{this.promoteRoom(),this.hide()},ref:e=>{this.acceptButton=e}},p.R.promotionConfirmPromoteText)))}setPrice(e){this.setState({price:e}),this.priceText.textContent=p.R.promotionConfirmPriceText(this.state.price)}promoteRoom(){const e=new FormData;e.append("csrfmiddlewaretoken",(0,b.I7)("csrftoken")),e.append("token_price",`${this.state.price}`),e.append("slug",this.props.slug),new URLSearchParams(window.location.search).forEach(((t,i)=>{e.append(t,i)})),S._.submitPromotion(e).then((e=>{const t=new s.N6(e.responseText);w.D.fire({tokens:t.getNumber("token_balance")}),(0,c.bT)("ViewerPromoteConfirmSuccess")})).catch((e=>{const t=new s.N6(e.xhr.responseText),i=t.getStringOrUndefined("detail"),o=t.getStringOrUndefined("code");void 0!==i&&("pending"===o?this.props.showDisabledFunc():"tokens_over_limit"===o?(0,C.qr)(i,m.Bm.current.PurchaseEventSources.TOKEN_SOURCE_LOW_TOKEN_BALANCE):(0,n.Q$)(i)),(0,c.bT)("ViewerPromoteConfirmFail",{status:null!=o?o:`${e.xhr.statusText} (${e.xhr.status})`,detail:null!=i?i:`${e.xhr.responseText} (${e.toString()})`})}))}}const T=new h.c_("userPromotionPush"),P=["too_soon","unauthorized"],k=new Set(["unknown","notconnected"]);class A extends a.b{constructor(e){super(e),this.listenerGroup=new h.gt,(0,o.ok)()||(r.X0.listen((e=>{let t=!1;const i=e=>{const i=this.state.roomStatus;this.setState({...this.state,roomStatus:e}),["privatenotwatching","away","privatewatching","hidden","passwordprotected"].includes(i)&&this.state.eligibility===S.S.ACCOUNT_INELIGIBLE?t&&this.refreshData():this.updateActiveState()};var s;this.slug=e.dossier.room,i(e.dossier.roomStatus),void 0===this.statusChangeListener&&(this.statusChangeListener=e.chatConnection.event.statusChange.listen((e=>{i(e.currentStatus)})),null===(s=this.statusChangeListener)||void 0===s||s.addTo(this.listenerGroup)),e.chatConnection.event.settingsUpdate.listen((e=>{e.activePassword||this.refreshData()})),this.refreshData().then((()=>{t=!0})).catch((e=>{(0,u.h5)(e)}))})).addTo(this.listenerGroup),T.listen((()=>{this.promotionStartUpdate()})).addTo(this.listenerGroup))}initData(e){if(super.initData(e),this.setState({eligibility:S.S.ACCOUNT_INELIGIBLE,price:0,isActive:!1,roomStatus:"unknown"}),(0,d.f)("PremPrivShow")){const e=(0,l.ce)();e.style.bottom="48px",void 0===m.Bm.current.loggedInUser?e.textContent=p.R.userPromotionMustBeLoggedInAlert:e.textContent=p.R.cannotPromoteRoom,this.element.appendChild(e),(0,l.JR)(this.element).listen((t=>{this.state.isActive||(e.style.display=t?"block":"none",e.style.opacity=t?"1":"0")}))}}refreshData(){const e=new URLSearchParams(window.location.search);return e.set("slug",this.slug),S._.promotionPrice(e.toString()).then((e=>{const t=new s.N6(e.responseText),i=t.getString("eligibility"),n=t.getNumber("token_price");this.setState({...this.state,eligibility:i,price:n}),this.updateActiveState()})).catch((e=>{(0,u.h5)(e)}))}updateActiveState(){var e;const t="public"===this.state.roomStatus&&this.state.eligibility===S.S.ELIGIBLE;var i;t||!0!==(null===(e=this.confirmModal)||void 0===e?void 0:e.isShown())||null===(i=this.confirmModal)||void 0===i||i.hide(),this.setState({...this.state,isActive:t})}clickHandler(){(0,c.bT)("ViewerPromoteLinkClick",{activeState:`${this.state.isActive}`}),(0,o.ok)()?(0,g.DC)({fromFeature:!0}):"public"===this.state.roomStatus?m.Bm.current.isNoninteractiveUser?(0,n.Q$)(p.R.internalStaffPromotion):this.refreshData().then((()=>{this.state.isActive?this.showConfirmationModal():this.state.eligibility===S.S.PURCHASER_INELIGIBLE?(0,n.Q$)(p.R.promotionIneligibleUserMessage):this.showDisabledModal()})).catch((e=>{const t=new s.N6(e.xhr.responseText),i=t.getStringOrUndefined("code"),o=t.getStringOrUndefined("detail");P.includes(null!=i?i:"")&&void 0!==o?(0,n.Q$)(o):(0,n.Q$)(p.R.feedbackUnknownError),(0,c.bT)("ViewerPromoteRefreshError",{status:null!=i?i:e.xhr.statusText,detail:null!=o?o:e.xhr.responseText})})):(0,n.Q$)(k.has(this.state.roomStatus)?p.R.promotionUnavailableTitle:p.R.promotionUnavailableOffline)}showDisabledModal(){void 0===this.unavailableModal&&(this.unavailableModal=new y({})),this.unavailableModal.show()}showConfirmationModal(){void 0===this.confirmModal&&(this.confirmModal=new x({slug:this.slug,showDisabledFunc:()=>{this.showDisabledModal()}})),this.confirmModal.setPrice(this.state.price),this.confirmModal.show(),(0,c.bT)("ViewerPromoteConfirmShow")}promotionStartUpdate(){this.setState({...this.state,eligibility:S.S.ACTIVE}),this.updateActiveState(),window.setTimeout((()=>{this.setState({...this.state,eligibility:S.S.ELIGIBLE}),this.updateActiveState()}),33e4)}dispose(){this.listenerGroup.removeAll()}getRoomStatusState(){return this.state.roomStatus}}},2650:(e,t,i)=>{"use strict";i.d(t,{S:()=>s,_:()=>o});var s,n=i(5216);class o{static promotionPrice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,n.Aw)(`promotion/api/promote_price/?${e}`,{timeout:2e4})}static promotionState(){return(0,n.Aw)("promotion/api/promotion_info/")}static submitPromotion(e){return(0,n.KF)("promotion/api/purchase_promotion/",e)}static promotionReport(){return(0,n.Aw)("promotion/api/promotion_report/")}}!function(e){e.ELIGIBLE="ELIGIBLE",e.ACCOUNT_INELIGIBLE="ACCOUNT_INELIGIBLE",e.PURCHASER_INELIGIBLE="PURCHASER_INELIGIBLE",e.ROOM_STATUS_OFFLINE="ROOM_STATUS_OFFLINE",e.PENDING_START="PENDING_START",e.PENDING_FINISH="PENDING_FINISH",e.ACTIVE="ACTIVE"}(s||(s={}))},4184:(e,t,i)=>{"use strict";i.d(t,{BL:()=>a,J:()=>l,pR:()=>h});var s=i(1329),n=i(4801);const o="",r="xx";function a(e){let t=function(e){var t,i;const n=s.find((t=>t.code===e));return{flagCode:null!==(t=null==n?void 0:n.code)&&void 0!==t?t:o,flagName:null!==(i=null==n?void 0:n.name)&&void 0!==i?i:o}}(e);return t.flagCode===r&&(t={flagCode:o,flagName:o}),t}function l(){document.querySelectorAll(".room_list_room span[data-country]").forEach((e=>{const{flagCode:t,flagName:i}=a(e.dataset.country);t&&i?e.appendChild(new n.T({component:"FlagIcon",componentProps:{countryCode:t,countryName:i}}).render()):e.remove()}))}function h(e){return["ru",r,o].includes(e)}},878:(e,t,i)=>{"use strict";i.d(t,{AV:()=>d,KM:()=>h,xX:()=>l});var s=i(6624),n=i(1048),o=i(2758),r=i(9060),a=i(2945);function l(e){(0,o.aR)(s.FILTER_PANEL_OPEN_CACHE_KEY,String(e),s.N_DAYS_HOMEPAGE_FILTERS_CACHE_EXP)}function h(){const e=(0,n.Bg)();return e===n.YT.Trans?n.YT.OldTrans:e}function d(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if((0,r.rT)())return;const t=function(){const e=new URL(s.UrlState.current.convertStateToUrl({pageType:s.PageType.HOME,...(0,s.getFilterPanelPartialState)(s.UrlState.current.state)},!1)),t=(0,a.JO)(e.search),i=(0,s.getPageHashtag)();return void 0!==i&&(t[s.TAG_FILTER_KEY]=i),0===Object.keys(t).length?"":`?${(0,a.Go)(t)}`}();void 0!==window.sessionStorage&&window.sessionStorage.setItem(s.FILTER_PANEL_SELECTED_PARAMS_CACHE_KEY,t),e||(0,o.aR)(s.FILTER_PANEL_SELECTED_PARAMS_CACHE_KEY,t,s.N_DAYS_HOMEPAGE_FILTERS_CACHE_EXP)}},836:(e,t,i)=>{"use strict";i.d(t,{$F:()=>a,Iq:()=>h,SU:()=>o,p5:()=>r});var s=i(4947),n=i(9461);function o(e){return"rec_config"===l(e)}function r(e){return void 0!==e&&o(e)}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown";var i;if(void 0!==e&&("rec_config"===l(e)&&null!==(i=n.Bm.current)&&void 0!==i&&i.isInternal))return e;return t}function l(e){return e.startsWith("rec_config")?"rec_config":"Popular"===e?"Popular":"unknown"}function h(e){return"recommended"===e?s.R.recommendedCAPS:e}},5079:(e,t,i)=>{"use strict";i.d(t,{OM:()=>E,kb:()=>A,Eh:()=>L,ak:()=>P});var s,n=i(6784),o=i(4941),r=i(82),a=i(8451),l=i(9060),h=i(8269),d=i(9268),c=i(4947),u=i(1372),p=i(9447),m=i(9461),g=i(7321),v=i(7596),f=i(4184),y=i(836),b=i(4801),w=i(6624),C=i(878),S=i(9930);class x extends r.b{initUI(){for(const e of this.element.querySelectorAll("a"))(0,p.fZ)(e,p.aG.camSubjectTagColor),(0,n.wu)("click",e,(t=>{(0,l.rT)()?(w.UrlState.current.state.pageType===w.PageType.HOME||(0,w.isRoomRoomlistSpaActive)()&&w.UrlState.current.state.pageType===w.PageType.ROOM)&&(t.preventDefault(),w.UrlState.current.navigateTo(e.href)):(S.XS.fire(t),(0,C.AV)())})),(0,w.shouldShowHomepageFilters)()&&(e.href=w.UrlState.current.getURLFromPartialURL(e.href));(0,w.shouldShowHomepageFilters)()||(0,g.T1)(this.element)}createElement(e){const t=(0,u.tT)("ul",{className:`subject ${p.aG.camSubjectColor}`},(0,u.tT)("li",{dangerouslySetInnerHTML:{__html:e.subject}}));return t.title=t.textContent,t}}class T extends r.b{createElement(e){const t=e.roomInfo.viewers,i=t>-1?c.R.numViewerOrViewers(t):"",s=""!==i&&""!==e.roomInfo.timeOnline;return(0,u.tT)("div",{className:"details"},(0,u.tT)("div",{className:"cardTitle title"},(0,a.HK)((0,u.tT)("a",{href:`/${e.roomInfo.room}/`,"data-room":e.roomInfo.room,"data-room-nav":"true","data-testid":"room-card-username"},e.roomInfo.room)),(0,u.tT)("div",{className:"age_gender_container"},(0,u.tT)("span",{className:"age","data-testid":"room-card-age"},e.roomInfo.displayAge),(0,u.tT)("span",{className:`${p.aG.camAltTextColor} ${T.getGenderClassName(e.roomInfo.gender)}`,title:c.R.genderSymbolToIconTitle(e.roomInfo.gender),"data-testid":"room-card-gender"}),e.roomInfo.countryCode&&(0,u.tT)("span",{className:"thumbnail_flag","data-testid":"room-card-thumbnail-flag"},(0,u.tT)(b.T,{component:"FlagIcon",componentProps:{countryCode:e.roomInfo.countryCode,countryName:e.roomInfo.countryName,"data-testid":"room-card-country"}})))),(0,u.tT)(x,{subject:e.roomInfo.subject}),(0,u.tT)("ul",{className:`sub-info ${p.aG.camAltTextColor}`},void 0!==e.roomInfo.location?(0,u.tT)("li",{className:"location",style:T.subInfoItemStyle,"data-testid":"room-card-location"},e.roomInfo.location):"",(0,u.tT)("li",{className:"cams "+(s?"":"no-viewers"),style:T.subInfoItemStyle},(0,u.tT)("span",{className:"time"+(-1===e.roomInfo.viewers?" time-since":"")},e.roomInfo.timeOnline),(0,u.tT)("span",{className:"comma"},s?", ":""),(0,u.tT)("span",{className:"viewers"},i))))}static getGenderClassName(e){return e.includes("t")?"genders":`gender${e}`}}function P(e){var t;const i=(e,t)=>{const i=e.getNumber(t,!1);return isNaN(i)?-1:i},s=e.getString("label",!1),n=e.getNumberOrUndefined("start_timestamp",!1),r=null===(t=e.getStringOrUndefined("country"))||void 0===t?void 0:t.toLowerCase(),{flagCode:a,flagName:l}=(0,f.BL)(r);return{room:e.getString("room",!1)||e.getString("username",!1),label:s,img:e.getString("img"),gender:e.getString("gender"),subject:e.getString("subject",!1)||e.getString("room_subject",!1),timeOnline:(0,o.tR)("offline"===s,0===n?void 0:n),viewers:Math.max(i(e,"viewers"),i(e,"num_users")),location:e.getStringOrUndefined("location"),displayAge:e.getStringWithNumbers("display_age",!1)||e.getStringWithNumbers("age",!1),isFollowing:e.getBoolean("is_following",!1,!1),isNew:e.getBoolean("is_new",!1,!1),isGaming:e.getBoolean("is_gaming",!1,!1),sourceName:(0,g.Ys)(e.getStringOrUndefined("source_name")),sourcePosition:e.getNumberOrUndefined("source_position"),sourceInfo:e.getStringOrUndefined("source_info"),startTimestamp:n,countryCode:a,countryName:l,privatePrice:e.getNumberOrUndefined("private_price"),spyPrice:e.getNumberOrUndefined("spy_show_price"),extendedInfo:k(e)}}function k(e){var t;const i=new URL(window.location.href).searchParams;if(null!==(t=m.Bm.current)&&void 0!==t&&t.isInternal&&"1"===i.get("show_rankings"))return{score:e.getNumberOrUndefined("score"),scoreRank:e.getNumberOrUndefined("score_rank"),baseScore:e.getNumberOrUndefined("base_score"),baseRank:e.getNumberOrUndefined("base_rank"),satScore:e.getNumberOrUndefined("sat_score"),satPercent:e.getNumberOrUndefined("sat_percent"),defaultPenalty:e.getNumberOrUndefined("default_penalty"),manualPenalty:e.getNumberOrUndefined("manual_penalty"),numRegs:e.getNumberOrUndefined("num_regs"),coloredRegs:e.getNumberOrUndefined("colored_regs"),tipRate:e.getNumberOrUndefined("tip_rate"),smallRoomScore:e.getNumberOrUndefined("small_room_sort_score")}}T.subInfoItemStyle={whiteSpace:"nowrap"};class A extends r.b{initUI(e){this.props=e,this.setImageStreamer(),(0,n.Xq)(["click","mousedown","touchstart"],this.element,(e=>{this.fireBeforeRoomClick(e)}))}fireBeforeRoomClick(e){e.target instanceof HTMLElement&&null!==e.target.getAttribute("data-room-nav")&&this.props.roomList.roomBeforeClickEvent.fire({index:this.props.roomIndex,roomInfo:this.props.roomInfo,event:e})}fireRoomClick(e){e.target instanceof HTMLElement&&null!==e.target.getAttribute("data-room-nav")&&this.props.roomList.roomClickEvent.fire({index:this.props.roomIndex,roomInfo:this.props.roomInfo,event:e})}onRoomClick(e){this.element.querySelector(`a[${h.rS}]`)?d.zG.listen((()=>this.fireRoomClick(e))):this.fireRoomClick(e)}blurThumbnail(e){e.roomInfo.img=e.roomInfo.img.replace("/riw/","/ribw/"),e.roomInfo.img=e.roomInfo.img.replace("/ri/","/rib/")}createElement(e){const t=(0,y.$F)(e.roomInfo.sourceInfo,e.roomInfo.label);return(0,S.PS)()&&this.blurThumbnail(e),(0,u.tT)("li",{className:`roomCard ${p.aG.camBgColor}`,"data-testid":"room-card",onClick:e=>this.onRoomClick(e)},(0,a.HK)((0,u.tT)("a",{href:`/${e.roomInfo.room}/`,"data-room-nav":"true","data-room":e.roomInfo.room},(0,u.tT)("img",{width:180,height:101,src:e.roomInfo.img,loading:"lazy","data-testid":"room-card-image",alt:e.roomInfo.room,"data-room-nav":"true",ref:e=>{this.img=e},className:"room_thumbnail"}))),this.showPrivateSpyRoomTokens(e,t),(0,u.tT)(T,{roomInfo:e.roomInfo}),this.createFollowStar(e))}createFollowStar(e){return(0,u.tT)(v.d,{slug:e.roomInfo.room,isFollowing:e.roomInfo.isFollowing,classRef:e=>this.followStar=e})}setImageStreamer(){(0,n.Xq)(["mouseenter","touchstart"],this.element,(()=>{(0,g.$r)()&&(this.img.removeAttribute("loading"),(0,g.DL)(this.props.roomInfo.room,this.img))})),(0,n.Xq)(["mouseleave","touchend"],this.element,(()=>{(0,g.$r)()&&(0,g.Hy)(this.props.roomInfo.room)}))}afterRemovedFromParent(){(0,g.$r)()&&void 0!==this.props&&(0,g.Hy)(this.props.roomInfo.room),super.afterRemovedFromParent()}getRoomName(){return this.props.roomInfo.room}updateFollowStar(e){var t;null===(t=this.followStar)||void 0===t||t.setFollowing(e)}showPrivateSpyRoomTokens(e,t){return(0,l.Gy)()?(0,u.tT)("div",{className:"labelContainer"},(0,u.tT)(M,{roomLabel:t}),(0,u.tT)(R,{roomLabel:t,privateTokens:e.roomInfo.privatePrice,spyTokens:e.roomInfo.spyPrice})):(0,u.tT)(M,{roomLabel:t})}}(s=A).labelTextMap={promoted:c.R.promotedCAPS,recommended:c.R.recommendedCAPS,offline:c.R.offlineCAPS,exhib:c.R.exhibitionistCAPS,new:c.R.newCAPS,private:c.R.inPrivateCAPS,gaming:c.R.gamingCAPS},s.labelClassMap={promoted:"thumbnail_label thumbnail_label_c_promoted",offline:"thumbnail_label thumbnail_label_offline",exhib:"thumbnail_label thumbnail_label_exhibitionist",new:"thumbnail_label thumbnail_label_c_new",private:"thumbnail_label_featured thumbnail_label_c_private_show",gaming:"thumbnail_label thumbnail_label_c_gaming",recommended:"thumbnail_label thumbnail_label_c thumbnail_label_recommender"};const M=e=>{var t,i;const s=(0,y.SU)(e.roomLabel)?e.roomLabel:null!==(t=A.labelTextMap[e.roomLabel])&&void 0!==t?t:"",n=(0,y.SU)(e.roomLabel)?A.labelClassMap.recommended:null!==(i=A.labelClassMap[e.roomLabel])&&void 0!==i?i:"thumbnail_label";return(0,u.tT)("div",{className:n,"data-testid":"thumbnail-label"},s)},R=e=>{var t;const i=null!==(t=e.privateTokens)&&void 0!==t?t:"private"===e.roomLabel?e.spyTokens:void 0;if(void 0===i||0===i)return;const s=void 0!==e.privateTokens?"privateTokens":"spyTokens",n=void 0!==e.privateTokens?c.R.tooltipPrivateMinute:c.R.tooltipSpyMinute;return(0,u.tT)("div",{className:`${s} tokenLabel thumbnail_label`,"data-tooltip":n},c.R.tokensBadge(i))};class I extends A{initUI(e){}createElement(e){return(0,u.tT)("li",{className:`roomCard placeholder ${p.aG.camBgColor}`,"data-testid":"room-card-placeholder"},(0,u.tT)("a",null,(0,u.tT)("div",{className:"room_thumbnail"})),(0,u.tT)("div",{className:"details"},(0,u.tT)("div",{className:"title"}," "),(0,u.tT)("div",{className:"subject"}," "),(0,u.tT)("div",{className:"sub-info"}," ")))}}const E={roomList:{},roomIndex:0,roomInfo:{},animate:!1},L=()=>new I(E)},8374:(e,t,i)=>{"use strict";i.d(t,{L:()=>f,y:()=>v});var s=i(6624),n=i(4936),o=i(6784),r=i(5216),a=i(82),l=i(8423),h=i(6716),d=i(4580),c=i(1452),u=i(1372),p=i(6262),m=i(9461),g=i(7321);class v extends a.b{constructor(e){super(e),this.rooms=[],this.pageShowCallback=()=>{this.updateFollowStars()},this.bindCachedFollowStarFix()}createElement(){return(0,u.tT)("ul",{className:"list"})}initData(e){this.listeners=new l.gt}initUI(e){super.initUI(e),this.roomListProps=e,this.roomClickEvent=new l.c_("roomClick"),this.listeners.add(this.roomClickEvent.listen((e=>{const t=e.event;t.ctrlKey||t.metaKey||t.shiftKey||(m.Bm.current.isMobile?d.VZ.fire(e.roomInfo.room):(e.event.preventDefault(),h.VZ.fire(e.roomInfo.room)))}))),this.roomBeforeClickEvent=new l.c_("roomBeforeClick"),this.listeners.add(this.roomBeforeClickEvent.listen((t=>{this.saveRoomListSourceCookie(t,e)}))),this.updateShowLocation(e.showLocation),this.listeners.add(p.yR.listen((e=>this.updateShowLocation(e))))}bindCachedFollowStarFix(){(0,o.Vo)("pageshow",window,this.pageShowCallback)}unbindCachedFollowStarFix(){(0,o.Pf)("pageshow",window,this.pageShowCallback)}saveRoomListSourceCookie(e,t){const i="un"===e.roomInfo.sourceName?t.roomListSource:e.roomInfo.sourceName;(0,g.sl)(e.roomInfo.room,i,e.index,this.getOptionalSourceInfo(e,t))}getOptionalSourceInfo(e,t){return{sourceIndex:void 0===t.sourceIndex?e.roomInfo.sourcePosition:t.sourceIndex(e),hashtag:void 0===t.hashtag?void 0:t.hashtag(e),sourceInfo:void 0===t.sourceInfo?void 0:t.sourceInfo(e)}}updateState(){super.updateState(),this.resetRooms()}resetRooms(){this.removeAllChildren(),this.rooms=[];const e=this.roomListProps.rooms();let t=!1;e.forEach(((e,i)=>{this.appendRoomCard(i+1,e),t=t||void 0!==e.location})),f(this.element,t&&this.showLocation)}appendRoomCard(e,t){const i=this.createRoomCard({roomList:this,roomIndex:e,roomInfo:t,animate:(0,g.$r)()});this.rooms.push(i),this.addChild(i)}updateShowLocation(e){this.showLocation=e,f(this.element,e)}updateFollowStars(){if(void 0===m.Bm.current.loggedInUser||(0,s.isFollowedCams)()||0===this.rooms.length)return;const e=this.rooms.map((e=>e.getRoomName())),t=`api/ts/follow/followed_usernames/?usernames=${encodeURIComponent(e.join(","))}`;(0,r.Aw)(t).then((e=>{const t=new n.N6(e.responseText).getStringList("followed_usernames"),i=new Set(t);this.rooms.forEach((e=>{e.updateFollowStar(i.has(e.getRoomName()))}))})).catch(c.h5)}dispose(){this.listeners.removeAll(),this.unbindCachedFollowStarFix()}}function f(e,t){t?e.classList.add("show-location"):e.classList.remove("show-location")}},9111:(e,t,i)=>{"use strict";i.d(t,{a:()=>o,b:()=>r});var s=i(6624),n=i(8861);const o="rlsrt";function r(){const e=(0,n.oD)(o);return Object.values(s.SortOption).includes(e)?e:s.SortOption.Popular}},9232:(e,t,i)=>{"use strict";i.d(t,{C:()=>c,y:()=>d});var s=i(6624),n=i(82),o=i(8423),r=i(9060),a=i(4947),l=i(1372),h=i(7995);const d=new o.c_("updateNoResultsMessage");class c extends n.b{createElement(){return(0,l.tT)("div",{className:"searching-keyword",bind:{display:()=>!0!==this.state.filterPanelActive&&0===this.state.numRooms?"none":"block"}})}initData(e){this.listeners=new o.gt}initUI(){this.updateMessage(),this.listeners.add(h.D.onSubmit.listen((e=>{this.updateMessage(e)}))),this.listeners.add(d.listen((e=>{0!==e.length&&this.updateNoSearchResultsMessage(e)}))),(0,r.rT)()&&s.UrlState.current.listen(["keywords"],(e=>{this.updateMessage(e.keywords)}),this.element)}updateMessage(e){const[t,i]=(0,s.extractKeywords)(e);if(0===t.length&&0===i.length)this.removeAllDOMChildren();else{const e=i.map((e=>`#${e}`)),s=[...t,...e].join(" ");this.removeAllDOMChildren(),this.element.appendChild((0,l.tT)("p",null,a.R.searchResultsFor(s)))}}updateNoSearchResultsMessage(e){const t=document.querySelector(".endless_page_template .no-rooms-available");null!==t&&(t.textContent=this.constructNoResultsMessage(e))}constructNoResultsMessage(e){const t=(0,s.getPageHashtag)(),[i,n]=(0,s.extractKeywords)(e),o=n.map((e=>`#${e}`));Boolean(t)&&o.push(`#${t}`);const r=[...i,...o].join(" ");return a.R.noSearchResultsMatch(r)}dispose(){this.listeners.removeAll()}}},9930:(e,t,i)=>{"use strict";i.d(t,{Cb:()=>C,PS:()=>x,X9:()=>S,XS:()=>f,Xv:()=>y,jS:()=>b,r:()=>P,tb:()=>k,v_:()=>g,wd:()=>v});var s=i(6624),n=i(4936),o=i(8861),r=i(5216),a=i(8423),l=i(6440),h=i(9060),d=i(7882),c=i(4947),u=i(5389),p=i(9461),m=i(1224);function g(){if(m.m.isWhiteLabel&&void 0!==m.m.homepageTitle&&""!==m.m.homepageTitle)return m.m.homepageTitle;const e=[],t=(0,s.getPageHashtag)(),i=(0,d.Bg)(),o=(0,n.nx)(m.m.siteName);return void 0!==t&&e.push(c.R.roomlistPageTitleHashtag((0,n.nx)(t),o)),(0,s.isPremium)()&&e.push(c.R.roomlistPageTitlePremium(o)),i===d.YT.Female?e.push(c.R.roomlistPageTitleFemale(o)):i===d.YT.Male?e.push(c.R.roomlistPageTitleMale(o)):i===d.YT.Couple?e.push(c.R.roomlistPageTitleCouple(o)):i===d.YT.Trans||i===d.YT.OldTrans?e.push(c.R.roomlistPageTitleTrans(o)):void 0!==t||(0,s.isPremium)()||e.push(c.R.roomlistPageTitleDefault(o)),e.join(" ")}const v=new a.c_("genderFilterUpdateFromNav"),f=new a.c_("spaNavigation"),y=new a.c_("newSpaLoad"),b="data-roomlist-spa-nav",w="jnoldsms";function C(){(0,o.$G)(w,"1",(0,h.DV)())}function S(e){return!(void 0!==e&&(e.classList.contains("nooverlay")||e.classList.contains("purchase_tokens")||"#"===e.getAttribute("href"))||void 0!==p.Bm.current.loggedInUser||"1"===(0,o.oD)(w))}function x(){if(!(0,l.f)("BlurThumbnails"))return!1;if(document.getElementsByClassName("entrance-terms--shown").length>0){const e=document.getElementById("entrance_terms_overlay");return null!==e?T(e)&&(0,u.T8)():(0,u.T8)(),!0}if(p.Bm.current.isAgeGated){const e=document.getElementById("age_gate_overlay");return null!==e?T(e)&&(0,u.T8)():(0,u.T8)(),!0}return!1}function T(e){return"none"===e.style.display||"hidden"===e.style.visibility||""!==e.style.opacity||""!==e.style.zIndex}function P(){return(0,s.isRoomRoomlistSpaActive)()&&void 0!==p.Db.getState().pageLocation}function k(e,t){const i=(null!=e?e:[]).map((e=>e===d.YT.Trans?d.YT.OldTrans:e)),s=new URLSearchParams(i.map((e=>["genders",e])));return void 0!==t&&s.set("count",String(t)),(0,r.Aw)(`/api/ts/hashtags/top_tags/?${s.toString()}`).then((e=>new n.N6(e.responseText).getStringList("all_tags")))}},4054:(e,t,i)=>{"use strict";i.d(t,{p:()=>W,r:()=>G});var s=i(4936),n=i(7623),o=i(6784),r=i(213),a=i(5216),l=i(1134),h=i(1131),d=i(9332),c=i(5746),u=i(2709),p=i(7668),m=i(8423),g=i(1284),v=i(7407),f=i(338),y=i(580),b=i(1452),w=i(5424),C=i(2609),S=i(3957),x=i(74),T=i(4947),P=i(5389),k=i(1673),A=i(9447),M=i(9461),R=i(897);let I=[];function E(e){if(I.some((t=>t.getUserUid()===e)))return;const t=new R.eR(e);t.enterPresence(),I.push(t)}function L(e){void 0!==e?I=I.filter((t=>t.getUserUid()!==e||(t.leavePresence(),!1))):(I.forEach((e=>{e.leavePresence()})),I=[])}var D=i(369),B=i(3910),U=i(1585),_=i(5901);const F=9/16,N="smcPlayerSettings",O=new m.c_("stopCamRequest"),H=new m.c_("shutdownCamRequest");class W extends u.u{constructor(e){var t;super(),this.roomChatConn=e,this.camUserInfos=new Map,this.cams=new Map,this.dummyRoomStatusNotifier=new C.k(!1),this.noticeRateLimits=new Map,this.height=0,this.bottom=16,this.cachedBottom=this.bottom,this.right=16,this.width=208,this.numCams=0,this.listenedForPublicStatus=!1,this.viewCamFailedListeners=new Map,(0,A.fZ)(this.element,"SmcBroadcaster"),this.getSettingsLocalstorage(),this.element.style.display="none",this.element.style.width=`${this.width}px`,this.element.style.height="",this.element.style.position="fixed",this.element.style.right=`${this.right}px`,this.element.style.overflow="visible",this.element.style.zIndex=`${_.MS}`,this.recalcPosition(),(0,o.wu)("scroll",window,(()=>{this.recalcPosition()})),D.oO.listen((()=>{this.recalcPosition()})),this.playerContainer=document.createElement("div"),this.playerContainer.style.display="table-cell",this.playerContainer.style.verticalAlign="bottom",this.playerContainer.style.width="100%",this.element.appendChild(this.playerContainer),this.addDrag(),this.addResize();const i=null===(t=M.Bm.current.loggedInUser)||void 0===t?void 0:t.userUid;void 0!==i&&new R.cc(i).onMessage.listen((e=>{e.started?R.KD.fire(e):R.Oh.fire(e)}));const n=new Set;R.KD.listen((e=>{if(2!==this.getCamState(e.username)||n.has(e.username))return;n.add(e.username);let t=!1,i=!1,s=10;const o=R.Oh.listen((t=>{t.username===e.username&&(i=!0,o.removeListener())}),!1),r=window.setInterval((()=>{if(t||i||s<=0)return clearInterval(r),n.delete(e.username),o.removeListener(),void(t&&!i&&(this.camUserInfos.set(e.username,e),this.setCamState(e.username,1)));s-=1,(0,_.yC)(e.username).then((e=>{t=e})).catch(b.yZ)}),1e3);(0,_.yC)(e.username).then((e=>{t=e})).catch(b.yZ)})),R.Oh.listen((e=>{const t=e.username,i=this.cams.get(t);this.camUserInfos.set(e.username,e),void 0!==(null==i?void 0:i.player)&&this.stopViewingCam(t),this.setCamState(t,2)})),this.roomChatConn.event.statusChange.listen((e=>{"privatewatching"===e.currentStatus&&this.endAllCamsExcept(this.roomChatConn.getPrivateShowUser())})),window.setInterval((()=>{this.monitorInactive()}),3e4),k.WK.listen((t=>{if(t){if(!this.listenedForPublicStatus){const t=i=>{if("public"===i.currentStatus){e.event.statusChange.removeListener(t),this.listenedForPublicStatus=!0;const i=[],n=R.Oh.listen((e=>{i.push(e.username)}));(0,a.Aw)("api/ts/chat/share-my-cam/").then((e=>{const t=new s.N6(e.responseText).getList("shared_rooms");if(void 0!==t)for(const e of t)-1===i.indexOf(e.getString("username"))&&R.KD.fire((0,_.p8)(e));n.removeListener()})).catch(b.yZ)}};e.event.statusChange.listen(t)}}else this.stopAllCams(),this.listenedForPublicStatus=!1})),O.listen((e=>{this.stopViewingCam(e.username)})),H.listen((e=>{const t=this.cams.get(e);void 0!==(null==t?void 0:t.player)&&this.stopViewingCam(e),this.setCamState(e,2)})),(0,o.wu)("beforeunload",window,(()=>{this.stopAllCams()})),this.noticeRateLimitSetting=M.Aw.getState().userChatSettings.c2cNotificationLimit,x.EZ.listen((e=>{this.noticeRateLimitSetting=e.c2cNotificationLimit;for(const e of this.noticeRateLimits.keys())this.unsetNoticeRateLimit(e)})),B.c9.listen((()=>{this.recalcPosition()})),l.T.registerGenerator("smcBadge",(e=>this.createChatBadge(e)))}static getOrCreateInstance(e){return void 0===W.singletonInstance&&(W.singletonInstance=new W(e)),W.singletonInstance}static getInstance(){return W.singletonInstance}addDrag(){(0,p.S)(this.playerContainer,((e,t,i)=>{const s=this.getCorrectedRight(this.right),n=this.getCorrectedBottom(this.bottom);let o=s,r=n;const a=t,l=i;let h=!1;return{enabled:!0,move:(e,t)=>{const i=e-a,d=t-l;!h&&(Math.abs(i)>5||Math.abs(d)>5)&&(h=!0,this.forEachPlayer(((e,t)=>{t.setDragging(!0)}))),r=this.getCorrectedBottom(n-d),o=this.getCorrectedRight(s-i),this.element.style.bottom=`${r}px`,this.element.style.right=`${o}px`,this.forEachPlayer(((e,t)=>{t.positionChanged()}))},end:()=>{this.right=o,this.bottom=r,this.cachedBottom=r,this.saveSettingsLocalstorage(),h=!1,window.setTimeout((()=>{this.forEachPlayer(((e,t)=>{t.setDragging(!1)}))}),100)}}}))}addResize(){!function(e,t){const i=t=>{const i=document.createElement("div");return i.style.position="absolute",i.style.cursor=t,i.style.backgroundColor="rgba(0, 0, 0, 0.01)",e.appendChild(i),i},s=i("nwse-resize");s.style.height="10px",s.style.width="10px",s.style.top="-5px",s.style.left="-5px";const n=i("nesw-resize");n.style.height="10px",n.style.width="10px",n.style.top="-5px",n.style.right="-5px";const o=i("nwse-resize");o.style.height="10px",o.style.width="10px",o.style.bottom="-5px",o.style.right="-5px";const r=i("nesw-resize");r.style.height="10px",r.style.width="10px",r.style.bottom="-5px",r.style.left="-5px";const a=i("ew-resize");a.style.height="calc(100% - 10px)",a.style.width="10px",a.style.top="5px",a.style.left="-5px";const l=i("ew-resize");l.style.height="calc(100% - 10px)",l.style.width="10px",l.style.top="5px",l.style.right="-5px";const h=i("ns-resize");h.style.height="10px",h.style.width="calc(100% - 10px)",h.style.left="5px",h.style.bottom="-5px";const d=i("ns-resize");d.style.height="5px",d.style.width="calc(100% - 10px)",d.style.left="5px",d.style.top="-5px",(0,p.S)(o,t(2)),(0,p.S)(r,t(3)),(0,p.S)(n,t(1)),(0,p.S)(s,t(0)),(0,p.S)(a,t(4)),(0,p.S)(l,t(5)),(0,p.S)(h,t(6)),(0,p.S)(d,t(7))}(this.element,(e=>(t,i,s)=>{t.stopPropagation();const n={initialBottom:this.bottom,initialRight:this.right,initialWidth:this.width,initialX:i,initialY:s,minWidth:200,ratio:F};let o=this.right,r=this.bottom,a=this.width;return{enabled:!0,move:(t,i)=>{const s=function(e,t,i,s){const n=function(e,t,i,s){switch(s){case 0:return e.ratio*(e.initialX-t+(e.initialY-i));case 1:return e.ratio*(e.initialY-i-(e.initialX-t));case 2:return e.ratio*(-(e.initialX-t)-(e.initialY-i));case 3:return e.ratio*(e.initialX-t-(e.initialY-i));case 4:return e.initialX-t;case 5:return-(e.initialX-t);case 6:return-(e.initialY-i)/e.ratio;case 7:return(e.initialY-i)/e.ratio}}(e,t,i,s),o=Math.min(Math.max(e.minWidth,e.initialWidth+n),.66*window.innerWidth),r=e.initialWidth-o;let a=e.initialBottom,l=e.initialRight;switch(s){case 1:l=e.initialRight+r;break;case 2:l=e.initialRight+r,a=e.initialBottom+r*e.ratio;break;case 3:a=e.initialBottom+r*e.ratio;break;case 4:a=e.initialBottom+r*e.ratio/2;break;case 5:l=e.initialRight+r,a=e.initialBottom+r*e.ratio/2;break;case 6:l=e.initialRight+r/2,a=e.initialBottom+r*e.ratio;break;case 7:l=e.initialRight+r/2}return{bottom:a,right:l,width:o}}(n,t,i,e);[o,r,a]=[s.right,s.bottom,s.width],o=this.getCorrectedRight(o,a),this.element.style.right=`${o}px`,this.element.style.width=`${a}px`,this.forEachPlayer(((e,t)=>{t.updateHeight()}));const l=this.element.offsetHeight;r=this.getCorrectedBottom(r,l),this.element.style.bottom=`${r}px`,this.forEachPlayer(((e,t)=>{t.positionChanged()}))},end:()=>{this.bottom=r,this.cachedBottom=r,this.right=o,this.width=a,this.height=this.element.getBoundingClientRect().height,this.saveSettingsLocalstorage()}}}))}getCorrectedBottom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.height;return Math.max(0,Math.min(window.innerHeight-t,e))}getCorrectedRight(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.width;return Math.max(0,Math.min(window.innerWidth-t,e))}recalcPosition(){const e=(0,U.N)();this.bottom=e>0?Math.max(this.cachedBottom,e+4):this.cachedBottom,this.element.style.bottom=`${this.getCorrectedBottom(this.bottom)}px`,this.element.style.right=`${this.getCorrectedRight(this.right)}px`}getSettingsLocalstorage(){if(!(0,n.Pf)())return;const e=window.localStorage.getItem(N);if(null!==e){const t=JSON.parse(e);this.bottom=t.bottom,this.cachedBottom=t.bottom,this.right=t.right,this.width=t.width}}saveSettingsLocalstorage(){if(!(0,n.Pf)())return;const e={bottom:this.bottom,right:this.right,width:this.width};window.localStorage.setItem(N,JSON.stringify(e))}startViewingCam(e){return this.unsetNoticeRateLimit(e),this.numCams>=5?((0,r.Q$)(T.R.showMyCamTooManyCams),(0,v.bT)("SharedCamViewStartFailed",{cam_user:e}),void(0,v.bT)("SharedCamViewStartTooManyCams",{cam_user:e})):2===this.getCamState(e)?(error("smcBroadcaster - no such cam"),void(0,v.bT)("SharedCamViewStartFailed",{cam_user:e})):void(0,_.yC)(e).then((t=>{t?(0,w.Bc)(e).then((t=>{const i=this.cams.get(e);if(void 0!==i&&void 0!==i.player)return;this.element.style.display="table";const s=new $(t,this.roomChatConn,this.dummyRoomStatusNotifier);this.playerContainer.appendChild(s.element),s.updateHeight(),s.startViewing(),this.numCams+=1,this.height=this.element.getBoundingClientRect().height,this.recalcPosition(),(0,v.bT)("SharedCamViewStarted",{cam_user:e,num_cams_open:this.numCams}),this.setCamState(e,1,s);const n=window.setTimeout((()=>{const t=this.cams.get(e);void 0!==(null==t?void 0:t.player)&&this.stopViewingCam(e),o.removeListener(),(0,v.bT)("SharedCamViewStartFailed",{cam_user:e})}),1e3*(y.Mc-1)),o=s.playerComponent.playbackStart.once((()=>{const i=this.cams.get(e);if(void 0!==i&&s===i.player){var o;this.setCamState(e,0,s),E(t.roomUid),null===(o=this.viewCamFailedListeners.get(e))||void 0===o||o.removeListener();const i=new R.eR(t.roomUid).onAuthFail.listen((()=>{0===this.getCamState(e)&&(this.stopViewingCam(e),(0,r.Q$)(T.R.showMyCamCouldNotView))}));this.viewCamFailedListeners.set(e,i),clearTimeout(n)}})),a=s.playerComponent.videoOfflineChange.listen((t=>{t&&(this.stopViewingCam(e),a.removeListener())}))})).catch(b.yZ):(this.setCamState(e,2),(0,r.Q$)(T.R.showMyCamCamOffline),(0,v.bT)("SharedCamViewStartFailed",{cam_user:e}))})).catch(b.yZ)}stopViewingCam(e){var t;null===(t=this.viewCamFailedListeners.get(e))||void 0===t||t.removeListener();const i=this.getCamState(e),s=this.cams.get(e);if((0,S.Nt)(!1,S.aw.SMC),void 0!==s&&void 0!==s.player){s.player.stopViewing(),this.setCamState(e,1);const t=s.player;void 0!==s.player.reportMenu?s.player.reportMenu.closeChatReportRequest.once((()=>{this.cleanUpCam(e,t)})):this.cleanUpCam(e,t)}else warn("stopViewingCam no player for cam",{camUser:e,state:i})}cleanUpCam(e,t){t.element.style.height="0",t.element.style.width="0",this.numCams-=1,this.height=this.element.getBoundingClientRect().height,this.recalcPosition(),0===this.numCams&&(this.element.style.display="none"),(0,v.bT)("SharedCamPlayerRemoved",{cam_user:e,num_cams_open:this.numCams})}forEachPlayer(e){for(const t of this.cams.keys()){const i=this.cams.get(t);void 0!==i&&void 0!==i.player&&e(t,i.player)}}stopAllCams(){this.forEachPlayer(((e,t)=>{this.stopViewingCam(e)}))}endAllCamsExcept(e){for(const t of this.cams.keys()){if(t===e)continue;const i=this.cams.get(t);void 0!==i&&void 0!==i.player&&this.stopViewingCam(t),this.setCamState(t,2)}}monitorInactive(){for(const e of this.cams.keys())2!==this.getCamState(e)&&(0,_.yC)(e).then((t=>{if(!t){const t=this.cams.get(e);void 0!==(null==t?void 0:t.player)&&this.stopViewingCam(e),this.setCamState(e,2)}})).catch(b.yZ)}getCamState(e){const t=this.cams.get(e);return void 0!==t?t.state:2}setCamState(e,t,i){const s=this.camUserInfos.get(e),n=this.getCamState(e);switch(t){case 2:this.cams.delete(e),this.camUserInfos.delete(e),2!==n&&(0,v.bT)("SharedCamViewerBroadcastStopped",{cam_user:e,num_cams_total:this.cams.size});break;case 1:this.cams.set(e,{state:1,player:i}),2===n&&(0,v.bT)("SharedCamViewerBroadcastStarted",{cam_user:e,num_cams_total:this.cams.size});break;case 0:void 0!==i?this.cams.set(e,{state:0,player:i}):error("smcBroadcaster - no player provided for active cam")}this.updateChatBadges(e),void 0!==s&&this.sendChatNoticeForStateChange(s,n,t)}sendChatNoticeForStateChange(e,t,i){if(t===i)return;let s;if(2===t&&2!==i&&(s=this.getCamStartNotice(e.username)),void 0!==s){const t=(0,g.W2)(this.roomChatConn.room(),e);this.roomChatConn.event.roomNotice.fire({messages:[[(0,d.H5)("User "===t?T.R.showMyCamSharingPrefix:t),(0,d.JH)(e),(0,d.H5)(s)]],showInPrivateMessage:!1})}}getCamStartNotice(e){const t=this.noticeRateLimits.get(e);if(!0!==(null==t?void 0:t.preventStartNotice))return this.setNoticeRateLimit(e),T.R.showMyCamStartedSharing}setNoticeRateLimit(e){let t,i;switch(this.noticeRateLimitSetting){case 0:t=!1;break;case 300:t=!0,i=window.setTimeout((()=>this.unsetNoticeRateLimit(e)),3e5);break;case-1:t=!0;break;default:error("smcBroadcaster - invalid rate limit setting",this.noticeRateLimitSetting),t=!1}this.noticeRateLimits.set(e,{preventStartNotice:t,timeout:i})}unsetNoticeRateLimit(e){const t=this.noticeRateLimits.get(e);void 0!==t?(window.clearTimeout(t.timeout),this.noticeRateLimits.set(e,{preventStartNotice:!1})):error("smcBroadcaster - no notice rate limit to unset")}getContextMenuLinkInfo(e){const t=this.getCamState(e);if(2===t)return{linkText:"",icon:"",action:()=>{}};const i=this.cams.get(e);let s,n,o;return n=1===t?`${STATIC_URL_ROOT}broadcastassets/inactive-cam.svg`:`${STATIC_URL_ROOT}broadcastassets/active-cam.svg`,void 0!==i&&void 0!==i.player?(s=T.R.showMyCamStopView,o=()=>{(0,v.bT)("SharedCamViewStopClicked",{cam_user:e}),this.stopViewingCam(e)}):(s=T.R.showMyCamView,o=()=>{(0,v.bT)("SharedCamViewStartClicked",{cam_user:e}),this.startViewingCam(e)}),{linkText:s,icon:n,action:o}}createChatBadge(e){const t=this.getCamState(e),i=document.createElement("img");return i.style.marginRight=".2em",i.style.height="1.2em",i.style.position="relative",i.title=T.R.sharingCam,2===t?i.style.display="none":i.src=1===t?`${STATIC_URL_ROOT}broadcastassets/inactive-cam.svg`:`${STATIC_URL_ROOT}broadcastassets/active-cam.svg`,i}updateChatBadges(e){const t=this.getCamState(e),i=l.T.getBadgeElements("smcBadge",e);let s="";1===t?s=`${STATIC_URL_ROOT}broadcastassets/inactive-cam.svg`:0===t&&(s=`${STATIC_URL_ROOT}broadcastassets/active-cam.svg`);for(let e=i.length-1;e>=0;e-=1){const t=i[e];t.src=s,t.style.display=""!==s?"":"none"}}}class $ extends f.N{constructor(e,t,i){super(!0,i),this.camDossier=e,this.roomChatConn=t,this.dragging=!1,this.hideAllTooltips=new m.c_("hideAllTooltips"),this.blockMouseEvent=e=>{e.stopPropagation()},this.element.dataset.testid="cam-to-cam-broadcast-panel",this.playerComponent.element.dataset.testid="cam-to-cam-video",this.watermark.style.visibility="hidden",this.element.style.position="relative",this.element.style.width="100%",this.element.style.minWidth="200px",this.element.style.backgroundColor="#000",this.element.style.border="1px solid #FFF",this.element.style.marginTop="-1px",this.element.style.overflow="visible",(0,o.wu)("mouseenter",this.element,(e=>{this.controls.style.display="block"})),(0,o.wu)("mouseleave",this.element,(e=>{this.controlsFrozen||(this.controls.style.display="none")}));let s=0;(0,o.wu)("touchstart",this.element,(e=>{"none"===this.controls.style.display?(this.controls.style.display="block",s=1):s+=1})),(0,o.wu)("touchend",this.element,(e=>{window.setTimeout((()=>{(s>1||this.dragging)&&!this.controlsFrozen&&(this.controls.style.display="none")}),0)})),(0,o.wu)("touchstart",document,(e=>{this.element.contains(e.target)||this.controlsFrozen||(this.controls.style.display="none")})),this.username=e.room,this.element.appendChild(this.createUsernameBar()),this.element.appendChild(this.createControls()),this.element.appendChild(this.createReportDiv())}startViewing(){this.chatConn=new h.Z(this.camDossier),this.playerComponent.handleRoomLoaded({dossier:this.camDossier,chatConnection:this.chatConn})}stopViewing(){var e;this.playerComponent.stop(),void 0===this.popoutWindow||this.popoutWindow.closed||this.popoutWindow.close(),this.chatConn.leaveRoom(),L(this.camDossier.roomUid),void 0!==this.reportMenu?(null!==(null===(e=this.usernameBar)||void 0===e?void 0:e.firstChild)&&(this.usernameBar.firstChild.textContent+=` ${T.R.showMyCamConnectionClosed}`),this.reportMenu.closeChatReportRequest.once((()=>{this.attemptRemoveFromDom()}))):this.attemptRemoveFromDom()}setDragging(e){this.dragging=e}reportCam(){const e=new V(this,this.username,this.roomChatConn);e.closeChatReportRequest.listen((e=>{void 0!==this.reportMenu&&(this.reportDiv.removeChild(this.reportMenu.element),this.reportMenu.tearDown(),this.reportMenu=void 0),e?((0,v.bT)("SharedCamReportSent",{cam_user:this.username}),this.attemptRemoveFromDom()):(this.reportDiv.style.display="none",this.controls.style.display="none",this.hideAllTooltips.fire(!0),this.freezeControls(!1))})),this.freezeControls(!0),this.reportDiv.appendChild(e.element),this.reportMenu=e,this.reportDiv.style.display="block",this.reportMenu.focusForm()}freezeControls(e){this.controlsFrozen=e,e?((0,o.wu)("mouseenter",this.element,this.blockMouseEvent,!0),(0,o.wu)("mouseleave",this.element,this.blockMouseEvent,!0)):((0,o.Pf)("mouseenter",this.element,this.blockMouseEvent,!0),(0,o.Pf)("mouseleave",this.element,this.blockMouseEvent,!0))}popoutCam(){if(void 0!==this.popoutWindow&&!this.popoutWindow.closed)return void this.popoutWindow.focus();const e=(screen.width/2-425).toString(),t=`resizable,dependent,scrollbars,height=768,width=850,top=${(screen.height/2-384).toString()},left=${e}`;(0,P.aH)(`/popout/${this.username}`,"_blank",t).then((e=>{this.popoutWindow=e})).catch(b.yZ)}attemptRemoveFromDom(){null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element)}createUsernameBar(){const e=document.createElement("div");e.style.position="absolute",e.style.bottom="0px",e.style.width="100%",e.style.height="auto",e.style.minHeight="20px",e.style.maxHeight="40px",e.style.color="#FFF",e.style.backgroundColor="rgba(0, 0, 0, 0.4)",e.style.zIndex=`${_.MS}`;const t=document.createElement("span");return t.style.zIndex=`${_.MS}`,t.textContent=this.username,t.style.fontFamily="UbuntuRegular",t.style.fontSize="12px",t.style.color="#EEE",t.style.position="relative",t.style.left="5px",t.style.bottom="-3px",e.appendChild(t),this.usernameBar=e,e}createControls(){const e=(0,_.ru)(),t=(0,_.uN)({iconAsset:"broadcastassets/close.svg",tooltipText:T.R.showMyCamCloseCam,iconSize:23,centerTop:"50%",onClick:()=>{this.controlsFrozen||this.dragging||((0,v.bT)("SharedCamViewStopClicked",{cam_user:this.username}),O.fire(this))},hideAllTooltips:this.hideAllTooltips});t.style.left="50%",t.style.transform="translateX(-50%) translateX(-50px)",e.appendChild(t);const i=(0,_.uN)({iconAsset:"tsdefaultassets/smc_popout.svg",tooltipText:T.R.showMyCamPopoutCam,iconSize:23,centerTop:"50%",onClick:()=>{this.controlsFrozen||this.dragging||this.popoutCam()},hideAllTooltips:this.hideAllTooltips});i.style.left="50%",i.style.transform="translateX(-50%)",e.appendChild(i);const s=(0,_.uN)({iconAsset:"broadcastassets/report.svg",tooltipText:T.R.showMyCamReportCam,iconSize:23,centerTop:"50%",onClick:()=>{this.controlsFrozen||this.dragging||this.reportCam()},hideAllTooltips:this.hideAllTooltips});return s.style.left="50%",s.style.transform="translateX(-50%) translateX(50px)",e.appendChild(s),this.controls=e,e}createReportDiv(){const e=document.createElement("div");return(0,A.fZ)(e,"reportDiv"),e.style.width="207px",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.position="absolute",e.style.transform="translate(-100%, -100%) translateX(-5px)",e.style.borderRadius="4px",e.style.display="none",e.style.zIndex="999",e.style.fontWeight="normal",e.style.fontSize="12px",e.onmouseenter=()=>{e.style.cursor="default"},this.reportDiv=e,e}updateHeight(){this.element.style.height=this.element.offsetWidth*F+"px"}positionChanged(){this.element.getBoundingClientRect().left-this.reportDiv.offsetWidth<0?this.reportDiv.style.transform=`translateY(-100%) translateX(${this.element.offsetWidth+5}px)`:this.reportDiv.style.transform="translate(-100%, -100%) translateX(-5px)"}}class V extends c.n{constructor(e,t,i){super(t,void 0,i),this.cam=e,this.username=t,this.chatConnection=i,(0,o.wu)("touchstart",this.element,(e=>{e.stopPropagation()})),(0,o.wu)("mousedown",this.element,(e=>{e.stopPropagation()}))}categories(){return{public:T.R.showMyCamReportPublic,rude:T.R.showMyCamReportRude,intoxicated:T.R.showMyCamReportIntoxicated,sleeping:T.R.showMyCamReportSleeping,spam:T.R.showMyCamReportSpamming,underage:T.R.showMyCamReportUnderage,other:T.R.reportMessageOther}}reportEndpoint(){return`abuse/report/${this.username}/`}additionalFinishReportLinks(){const e=this.chatConnection.room(),t=document.createElement("button"),i=document.createElement("button");return(0,A.fZ)(t,A.aG.hrefColor),(0,A.fZ)(i,A.aG.hrefColor),t.textContent=T.R.silenceDurationMessage,i.textContent=T.R.kickBan,i.dataset.testid="kick-ban",t.onclick=i=>{i.preventDefault(),(0,a.KF)(`roomsilence/${this.username}/${e}/`,{}).catch((t=>{error("smcBroadcaster Unable to silence user",{room:e,username:this.username,reason:t.toString()}),(0,r.Q$)(`Error silencing user ${this.username}`)})),t.style.color="",t.style.cursor="",t.onclick=()=>{}},i.onclick=s=>{s.preventDefault(),(0,a.KF)(`roomban/${this.username}/${this.chatConnection.room()}/`,{}).catch((t=>{error("smcBroadcaster Unable to ban user",{room:e,username:this.username,reason:t.toString()}),(0,r.Q$)(T.R.banUserError(this.username))})),t.style.color="",t.style.cursor="",t.onclick=()=>{},i.style.color="",i.style.cursor="",i.onclick=()=>{}},[t,i]}onChatReportClosed(e){super.onChatReportClosed(e),e&&O.fire(this.cam)}}let z=!1;function G(e,t){var i;z||(z=!0,""!==e.roomUid&&new R.eR(e.roomUid).onAuthFail.listen((()=>{t.stop(),(0,r.Q$)(T.R.showMyCamCouldNotView),L(e.roomUid)})),!0===(null===(i=M.Bm.current)||void 0===i||null===(i=i.loggedInUser)||void 0===i?void 0:i.isBroadcasting)&&(L(),(0,a.Aw)("api/ts/chat/share-my-cam/").then((t=>{const i=new s.N6(t.responseText).getList("shared_rooms");if(void 0!==i)for(const t of i)t.getString("username")===e.room&&E(e.roomUid)})).catch(b.yZ)))}},5901:(e,t,i)=>{"use strict";i.d(t,{MS:()=>o,Rz:()=>d,Yc:()=>h,p8:()=>c,ru:()=>r,uN:()=>a,yC:()=>l});var s=i(6784),n=i(5216);const o=1003;function r(){const e=document.createElement("div");return e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.top="0px",e.style.left="0px",e.style.display="none",e.style.zIndex=`${o+1}`,e.style.backgroundColor="rgba(0, 0, 0, .3)",e.style.boxShadow="0px 0px 4px rgba(0, 0, 0, 0.5)",e}function a(e){const t=Math.floor(e.iconSize/2),i=document.createElement("div");i.style.display="inline-block",i.style.position="absolute",i.style.width=i.style.height=`${e.iconSize}px`,i.style.top=`calc(${e.centerTop} - ${t}px)`;const n=document.createElement("img");n.src=`${STATIC_URL_ROOT}${e.iconAsset}`,n.style.position="relative",n.style.height="100%",n.style.width="100%",n.style.zIndex="1",i.appendChild(n);const o=document.createElement("div");o.style.position="absolute",o.style.display="none",o.style.width="39px",o.style.height="39px",o.style.top=`${-19+t}px`,o.style.left=`${-19+t}px`,o.style.borderRadius="4px",o.style.zIndex="0",o.style.backgroundColor="rgba(255, 255, 255, .25)";const r=document.createElement("div");r.textContent=e.tooltipText,r.style.position="relative",r.style.display="inline-block",r.style.top="42px",r.style.left="50%",r.style.transform="translateX(-50%)",r.style.padding="0px 7px",r.style.whiteSpace="nowrap",r.style.fontFamily="UbuntuRegular",r.style.fontSize="12px",r.style.color="#FFF",r.style.backgroundColor="rgba(0, 0, 0, .9)",r.style.border="1px solid #8A8A8A",o.appendChild(r),i.appendChild(o),void 0!==e.hideAllTooltips&&e.hideAllTooltips.listen((()=>{o.style.display="none"})),void 0!==e.onClick&&(n.style.cursor="pointer",(0,s.wu)("click",n,e.onClick)),(0,s.wu)("mouseenter",n,(()=>{o.style.display="block"})),(0,s.wu)("mouseleave",n,(()=>{o.style.display="none"}));let a=!1;const l=e=>{e.target!==n&&(o.style.display="none",a=!1,(0,s.Pf)("touchstart",document,l,!0))};return(0,s.wu)("touchstart",n,(t=>{a?void 0!==e.onClick&&(0,s.ck)("touchend",n,e.onClick):(o.style.display="block",a=!0,(0,s.wu)("touchstart",document,l,!0),t.preventDefault(),t.stopPropagation())})),i}function l(e){return(0,n.Aw)(`api/online/${e}/`).then((e=>JSON.parse(e.responseText).online))}function h(){return(0,n.Aw)("api/ts/chat/share-my-cam/").then((e=>{const t=JSON.parse(e.responseText).cam_room;return t.length>0?t[0]:""}))}function d(e){const t=()=>{h().then((i=>{""===i?e():window.setTimeout(t,5e3)})).catch((()=>{}))};t()}function c(e){return{username:e.getString("username"),isBroadcaster:!1,inFanclub:e.getBoolean("in_fanclub"),hasTokens:e.getBoolean("has_tokens"),isMod:e.getBoolean("is_mod"),tippedRecently:e.getBoolean("tipped_recently"),tippedALotRecently:e.getBoolean("tipped_alot_recently"),tippedTonsRecently:e.getBoolean("tipped_tons_recently"),exploringHashTag:"",sourceName:"df"}}},3956:(e,t,i)=>{"use strict";i.d(t,{fL:()=>H,Md:()=>G,BG:()=>q});var s=i(4936),n=i(7623),o=i(6784),r=i(213),a=i(5216),l=i(6844);var h=i(4548),d=i(7809),c=i(9332),u=i(2939),p=i(5020),m=i(3955),g=i(7668),v=i(8423),f=i(6440),y=i(1779),b=i(2690),w=i(7407),C=i(1452),S=i(8331),x=i(4947),T=i(5389),P=i(20),k=i(9945),A=i(9447),M=i(9461),R=i(897),I=i(369),E=i(3910),L=i(1585),D=i(5901);const B=5e3,U="smcBroadcastSettings",_=new Set(["privatenotwatching","privatespying","passwordprotected","notconnected","offline"]);let F,N,O="notconnected";function H(){return F}(0,o.wu)("pageshow",window,(e=>{e.persisted&&void 0!==N&&N.stopCam()}));const W=new v.c_("showMyCamDidNotStart"),$=new v.c_("requestChangeClickListener"),V=new v.c_("showMyCamStateChanged");function z(){if(!(0,n.YU)()||!h.Y9.canUseWebRTC())return!1;let e,t;return u.X0.listen((i=>{if(void 0!==N&&i.chatConnection.room()!==N.roomChatConn.room()&&(N.cleanup(),N=void 0),(0,l.ok)()){var n;$.fire((()=>{(0,l.rC)()})),null===(n=e)||void 0===n||n.removeListener(),e=i.chatConnection.event.statusChange.listen((e=>{O=e.currentStatus,_.has(e.currentStatus)?V.fire("disabled"):_.has(e.previousStatus)&&V.fire("ready")}))}else{void 0===N&&(N=new K(i.chatConnection));const e=()=>{V.fire("starting"),$.fire((()=>{})),void 0!==t&&t.removeListener(),t=W.listen((()=>{_.has(O)||V.fire("ready"),$.fire(e)}),!1),(0,a.Aw)(`api/ts/chat/can-share-cam/${i.dossier.room}/`).then((e=>{const t=new s.N6(e.responseText);t.getBoolean("can_share")&&0===t.getStringList("shared_cam").length?void 0!==N&&N.startCam():(t.getBoolean("show_upsell")?(0,r.mf)(x.R.showMyCamMayNotShareUpsell,(()=>{const e=`/tipping/purchase_tokens/?source=${M.Bm.current.PurchaseEventSources.TOKEN_SOURCE_SHOW_MY_CAM}`;(0,w.bT)("SharedCamPurchaseTokensClicked"),(0,T.gr)(e,"_blank","height=615, width=850, scrollbars=1")})):t.getBoolean("is_private")?(0,r.Q$)(x.R.showMyCamMayNotShareIsPrivate):t.getStringList("shared_cam").length>0?((0,r.Q$)(x.R.showMyCamAlreadyBroadcasting),(0,w.bT)("SharedCamAlreadySharing")):(0,r.Q$)(t.getString("message")),W.fire(void 0))})).catch(C.yZ)};N.setOnStart((()=>{V.fire("started"),$.fire((()=>{(0,w.bT)("SharedCamBroadcastStopClicked"),void 0!==N&&N.stopCam(!0)}))})),N.setOnStop((()=>{_.has(O)||(V.fire("cooldown"),$.fire((()=>{}))),window.setTimeout((()=>{_.has(O)||V.fire("ready"),$.fire((()=>{e()}))}),B)})),$.fire((()=>{e()}))}})),!0}function G(e,t){$.listen((t=>{M.Bm.current.isNoninteractiveUser?e.onclick=()=>{(0,r.Q$)(x.R.internalStaffC2C)}:e.onclick=()=>{e.classList.contains("disabled")||t()}}));const i=(0,m.ce)();return e.textContent=x.R.showMyCamShow,(0,A.fZ)(e,"disabled"),e.ariaDisabled="true",(0,f.f)("PremPrivShow")&&(i.style.bottom="32px",t.appendChild(i),void 0===M.Bm.current.loggedInUser?i.textContent=x.R.showMyCamLoginRequired:i.textContent=x.R.waitingToConnect,(0,m.JR)(e).listen((t=>{e.classList.contains("disabled")?(i.style.display=t?"block":"none",i.style.opacity=t?"1":"0"):(i.style.display="none",i.style.opacity="0")}))),V.listen((t=>{switch((0,A.SA)(e,"disabled"),t){case"ready":e.textContent=x.R.showMyCamShow,(0,f.f)("PremPrivShow")||(e.title=x.R.showMyCamShow);break;case"starting":(0,f.f)("PremPrivShow")?i.textContent=x.R.waitingToConnect:e.title=x.R.waitingToConnect,e.textContent=x.R.showMyCamShow,(0,A.fZ)(e,"disabled"),e.ariaDisabled="true";break;case"started":(0,f.f)("PremPrivShow")||(e.title=x.R.showMyCamStop),e.textContent=x.R.showMyCamStop;break;case"cooldown":(0,f.f)("PremPrivShow")?i.textContent=x.R.showMyCamCooldownAlert(B/1e3):e.title=x.R.showMyCamCooldownAlert(B/1e3),e.textContent=x.R.showMyCamShow,(0,A.fZ)(e,"disabled"),e.ariaDisabled="true";break;case"disabled":var s,n;(0,f.f)("PremPrivShow")?i.textContent=null!==(s=j(O))&&void 0!==s?s:"":e.title=null!==(n=j(O))&&void 0!==n?n:x.R.showMyCamShow,e.textContent=x.R.showMyCamShow,(0,A.fZ)(e,"disabled"),e.ariaDisabled="true"}})),z()}function q(e){return $.listen((t=>{M.Bm.current.isNoninteractiveUser?e.element.onclick=()=>{e.isDisabled()||(0,r.Q$)(x.R.internalStaffC2C)}:e.element.onclick=()=>{e.isDisabled()||t()}})),(0,f.f)("PremPrivShow")&&void 0===M.Bm.current.loggedInUser?e.setTooltipTextOverride(x.R.showMyCamLoginRequired):e.setTooltipTextOverride(x.R.waitingToConnect),e.disable(),V.listen((t=>{switch(t){case"ready":Z(e,x.R.showMyCamShow),e.enable();break;case"starting":Z(e,x.R.showMyCamShow),e.disable();break;case"started":Z(e,x.R.showMyCamStop),e.enable();break;case"cooldown":Z(e,x.R.showMyCamShow),e.setTooltipTextOverride(x.R.showMyCamCooldownAlert(B/1e3)),e.disable();break;case"disabled":Z(e,x.R.showMyCamShow);const t=j(O);void 0!==t&&e.setTooltipTextOverride(t),e.disable()}})),z()}function j(e){switch(e){case"notconnected":return x.R.waitingToConnect;case"offline":case"passwordprotected":return x.R.showMyCamMustBeConnected;case"privatenotwatching":case"privatespying":return x.R.showMyCamMayNotShareIsPrivate;default:return}}function Z(e,t){e.updateTextLabel(t),e.clearTooltipTextOverride(),S.o9?e.setTooltipTextFromLabel():e.clearTooltipText()}class K{constructor(e){var t;this.onStartBroadcast=[],this.onStopBroadcast=[],this.listenerGroup=new v.gt,this.startBroadcast=()=>{if(void 0!==this.previewModal&&this.previewModal.hide(),(0,w.bT)("SharedCamBroadcastStartClicked"),_.has(O))return void this.handleSMCNotAllowed();const e=this.onStopBroadcast;this.onStopBroadcast=[],this.stopCam().then((()=>{this.onStopBroadcast=e;let t=!1;const i=window.setTimeout((()=>{void 0!==this.broadcastModal&&this.broadcastModal.stopBroadcast(),(0,w.bT)("SharedCamBroadcastStartTimedOut"),(0,r.Q$)(x.R.showMyCamBroadcastTimeoutError),error("smcViewer - timeout starting cam"),t=!0}),2e4);this.connectingTimeout=i,(0,a.KF)("api/ts/chat/share-my-cam/",{username:this.roomChatConn.room()}).then((()=>{if(!t){this.broadcastModal=new Y(this.camDossier,this.constraints,this.broadcastStop,this.roomChatConn,i),this.broadcastModal.showBroadcast(),this.fullscreenChangeListener=y._c.listen(this.broadcastModal.showBroadcast);for(const e of this.onStartBroadcast)e()}})).catch((()=>{t||((0,r.Q$)(x.R.showMyCamBroadcastError),W.fire(void 0))}))})).catch(C.yZ)},this.broadcastStop=()=>{var e;void 0!==this.broadcastModal&&(null===(e=this.fullscreenChangeListener)||void 0===e||e.removeListener(),this.fullscreenChangeListener=void 0,this.broadcastModal.currentlyViewed&&this.roomChatConn.event.roomNotice.fire({messages:[[(0,c.JH)((0,P.mi)(this.roomChatConn.room())),(0,c.H5)(x.R.showMyCamStoppedViewing)]],showInPrivateMessage:!0})),window.clearTimeout(this.connectingTimeout),this.connectingTimeout=void 0,this.broadcastModal=void 0;for(const e of this.onStopBroadcast)e()},this.roomChatConn=e,this.constraints={micId:"",camId:"",width:0,height:0,muted:!0},e.event.statusChange.listen((e=>{O=e.currentStatus,_.has(e.currentStatus)?(this.stopCam(),V.fire("disabled")):_.has(e.previousStatus)&&V.fire("ready")})).addTo(this.listenerGroup);const i=null===(t=M.Bm.current.loggedInUser)||void 0===t?void 0:t.userUid;void 0!==i&&new R.Vg(i).onMessage.listen((e=>{e.started?R.Vu.fire(e):R.DL.fire(e)})).addTo(this.listenerGroup)}startCam(){(0,w.bT)("SharedCamStartClicked"),_.has(O)?this.handleSMCNotAllowed():(0,D.yC)(this.roomChatConn.username()).then((e=>{if(e)(0,r.Q$)(x.R.showMyCamAlreadyBroadcasting),W.fire(void 0);else if(d.i.areTermsAccepted())this.showBroadcastPreview();else{const e=()=>{this.showBroadcastPreview()},t=()=>{W.fire(void 0)};new d.i(!1,e,t).show()}})).catch(C.yZ)}stopCam(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return void 0!==this.broadcastModal?this.broadcastModal.stopBroadcast(e):Promise.resolve()}cleanup(){this.stopCam(),this.listenerGroup.removeAll()}showBroadcastPreview(){_.has(O)?this.handleSMCNotAllowed():new Promise(((e,t)=>{(0,a.Aw)("api/broadcastvideocontext/").then((t=>{var i;e((i=t.responseText,new Promise(((e,t)=>{const n=new s.N6(i);n.getNumber("status",!1)>=400?t(`Bad response from server: ${i}`):e({room:n.getString("room"),originHost:n.getString("originHost"),originPassword:n.getString("originPassword"),originWSEndpoint:n.getString("originWSEndpoint")})}))))})).catch(t)})).then((e=>{this.camDossier=e,void 0!==this.previewModal&&this.previewModal.hide(),this.previewModal=new J(this.camDossier,this.constraints,this.startBroadcast,this.roomChatConn.room()),this.previewModal.show()})).catch(C.yZ)}handleSMCNotAllowed(){switch(O){case"notconnected":case"offline":case"passwordprotected":(0,r.Q$)(x.R.showMyCamMustBeConnected);break;case"privatenotwatching":case"privatespying":(0,r.Q$)(x.R.showMyCamMayNotShareIsPrivate);break;default:(0,r.Q$)(x.R.showMyCamBroadcastError)}W.fire(void 0)}setOnStart(e){this.onStartBroadcast.push(e)}setOnStop(e){this.onStopBroadcast.push(e)}isBroadcasting(){return void 0!==this.broadcastModal}}class J extends b.zf{constructor(e,t,i,s){super({onShow:()=>{this.paused&&this.previewPanel.start(),(0,w.bT)("SharedCamPreviewDisplayed")},onHide:()=>{W.fire(void 0),this.previewPanel.stop(),this.paused=!0},easyExit:!0}),this.paused=!1,this.preventChatFocus=!0,this.overlay.style.backgroundColor="rgba(0, 0, 0, 0.4)",this.element.id="smc-preview-modal",this.element.style.boxShadow="0px 0px 10px rgba(0, 0, 0, 0.3)",this.element.style.position="fixed",this.element.style.overflow="hidden",this.element.style.height="auto",this.element.style.width="422px",this.element.style.top="50%",this.element.style.left="50%",this.element.style.transform="translate(-50%, -56%)",this.element.style.borderRadius="6px",this.previewPanel=new k.BT(e,t,{onOBSClick:()=>{},onStartBroadcast:i,title:x.R.showMyCamPreviewTitle,infoText:[x.R.showMyCamPreviewInfo1(s),x.R.showMyCamPreviewInfo2],startButtonText:x.R.showMyCamStart(s),onClose:()=>{this.hide()}}),this.element.style.padding="8px 10px",this.element.style.boxSizing="border-box",this.addChild(this.previewPanel)}}class Y extends k.SF{constructor(e,t,i,s,n){super(e,t,{onStopBroadcast:()=>{(0,a.ju)("api/ts/chat/share-my-cam/?",{username:this.roomUsername}),this.removeFromDom(),this.listenerGroup.removeAll(),F=void 0,i()}}),this.roomChatConn=s,this.currentlyViewed=!1,this.listenerGroup=new v.gt,this.bottom=16,this.cachedBottom=this.bottom,this.right=16,this.fullscreenBottom=32,this.fullscreenRight=0,this.currentWatchers=new Map,this.showBroadcast=()=>{const e=(0,y.Gy)();(0,y.aS)()&&void 0!==e?(e.appendChild(this.element),this.main.style.bottom=`${this.fullscreenBottom}px`,this.main.style.right=`${this.fullscreenRight}px`):(document.body.appendChild(this.element),this.main.style.bottom=`${this.bottom}px`,this.main.style.right=`${this.right}px`)},this.roomUsername=s.room(),this.getSettingsLocalstorage(),this.createBroadcastDisplay(),I.oO.listen((()=>{this.recalcPosition()}));let o=!0;h.Ay.listen((e=>{const t=e.data.status;void 0!==t?"connecting"!==t&&o&&"hidden"===t?(clearTimeout(n),o=!1,this.onConnected()):!o&&this.isStatusOffline(t)&&(this.stopBroadcast(),(0,r.Q$)(x.R.showMyCamBroadcastError),error("smcViewer - cam went offline")):warn("smcViewer - connectionStatus is undefined")}),!1).addTo(this.listenerGroup),E.c9.listen((()=>{this.recalcPosition()})).addTo(this.listenerGroup)}onConnected(){(0,w.bT)("SharedCamBroadcastStarted"),F=this.roomUsername,R.Vu.listen((e=>{this.updateCamStatus(!0,e)}),!1).addTo(this.listenerGroup),R.DL.listen((e=>{this.updateCamStatus(!1,e)}),!1).addTo(this.listenerGroup)}stopBroadcast(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,o.wu)("mouseenter",this.element,(e=>{e.stopPropagation()}),!0),(0,o.wu)("mouseleave",this.element,(e=>{e.stopPropagation()}),!0),e&&(0,w.bT)("SharedCamBroadcastStopClicked",{is_broadcaster_viewing:this.currentlyViewed}),this.stop(!0)}removeFromDom(){null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element)}updateCamStatus(e,t){let i;this.currentlyViewed=e,e?this.currentWatchers.has(t.username)||(this.statusIcon.src=`${STATIC_URL_ROOT}broadcastassets/active-cam-overlaying-video.svg`,this.statusTooltipText.textContent=`${this.roomUsername} ${x.R.showMyCamIsViewing}`,this.currentWatchers.set(t.username,t),i=x.R.showMyCamStartedViewing):this.currentWatchers.has(t.username)&&(this.statusIcon.src=`${STATIC_URL_ROOT}broadcastassets/inactive-cam-overlaying-video.svg`,this.statusTooltipText.textContent=`${this.roomUsername} ${x.R.showMyCamNotViewing}`,this.currentWatchers.delete(t.username),i=x.R.showMyCamStoppedViewing),void 0!==i&&this.roomChatConn.event.roomNotice.fire({messages:[[(0,c.JH)((0,P.mi)(t.username)),(0,c.H5)(i)]],showInPrivateMessage:!0})}createBroadcastPanel(){}createBroadcastDisplay(){this.element.style.height="auto",this.element.style.width="auto",this.main=this.createMain(),this.main.appendChild(this.createCamStatus()),this.main.appendChild(this.createVideo()),this.main.appendChild(this.createControls()),this.element.appendChild(this.main),this.setupUIEventListeners()}createMain(){const e=document.createElement("div");return e.style.height="117px",e.style.width=117*this.constraints.width/this.constraints.height+"px",e.style.backgroundColor="#000",e.style.position="fixed",e.style.zIndex=`${D.MS}`,e.style.border="1px solid #FFF",e.dataset.testid="cam-to-cam-broadcast-panel",e}createCamStatus(){const e=document.createElement("div");e.style.position="absolute",e.style.right="5px",e.style.top="5px",e.style.width=e.style.height="15px",e.style.zIndex=`${D.MS+2}`;const t=document.createElement("img");t.src=`${STATIC_URL_ROOT}broadcastassets/inactive-cam-overlaying-video.svg`;const i=document.createElement("div");(0,A.fZ)(i,"smc-status-tooltip"),i.style.position="absolute",i.style.width="175px",i.style.padding="9px",i.style.borderRadius="4px",i.style.fontSize="14px",i.style.display="none",i.style.zIndex="5",i.style.bottom="25px",i.style.left="-168px",i.dataset.testid="cam-to-cam-status-tooltip";const s=document.createElement("span");s.textContent=`${this.roomUsername} ${x.R.showMyCamNotViewing}`,i.appendChild(s);const n=(0,p.Uv)("","","168px",2);return(0,A.fZ)(n,"divotBottom"),i.appendChild(n),e.appendChild(t),e.appendChild(i),this.statusIcon=t,this.statusTooltip=i,this.statusTooltipText=s,e}createVideo(){const e=super.createVideo();return e.style.height="100%",e.dataset.testid="cam-to-cam-video",e}createControls(){const e=(0,D.ru)(),t=document.createElement("div");t.style.width="100%",t.style.height="26px",t.style.backgroundColor="rgba(0, 0, 0, 0.4)",t.style.cursor="move",this.addDrag(t);const i=document.createElement("div");i.style.paddingLeft="10px",i.style.position="relative",i.style.top="50%",i.style.transform="translateY(-50%)",i.style.color="#FFF",i.style.cursor="default",i.textContent=x.R.showMyCamMyCam,i.style.cursor="move",this.addDrag(i),t.appendChild(i),e.appendChild(t);const s=(0,D.uN)({iconAsset:"broadcastassets/volume-mute-grey.svg",tooltipText:x.R.showMyCamMuted,iconSize:31,centerTop:"60%"});s.style.left="50%",s.style.transform="translateX(calc(-50% - 30px))",e.appendChild(s);const n=(0,D.uN)({iconAsset:"broadcastassets/close.svg",tooltipText:x.R.showMyCamCloseCam,iconSize:23,centerTop:"60%",onClick:()=>{this.stopBroadcast(!0)}});return n.style.left="50%",n.style.transform="translateX(calc(-50% + 30px))",e.appendChild(n),this.controls=e,e}setupUIEventListeners(){const e=()=>{this.controls.style.display="block",this.currentlyViewed?this.statusIcon.src=`${STATIC_URL_ROOT}broadcastassets/active-cam.svg`:this.statusIcon.src=`${STATIC_URL_ROOT}broadcastassets/inactive-cam.svg`},t=()=>{this.controls.style.display="none",this.currentlyViewed?this.statusIcon.src=`${STATIC_URL_ROOT}broadcastassets/active-cam-overlaying-video.svg`:this.statusIcon.src=`${STATIC_URL_ROOT}broadcastassets/inactive-cam-overlaying-video.svg`};(0,o.wu)("mouseenter",this.main,e),(0,o.wu)("mouseleave",this.main,t);let i=0;(0,o.wu)("touchstart",this.main,(t=>{"none"===this.controls.style.display?(e(),i=1):i+=1})),(0,o.wu)("touchend",this.main,(e=>{i>1&&t()})),(0,o.wu)("touchstart",document,(e=>{this.element.contains(e.target)||t()})),(0,o.wu)("mouseenter",this.statusIcon,(e=>{this.statusTooltip.style.display="block"})),(0,o.wu)("mouseleave",this.statusIcon,(e=>{this.statusTooltip.style.display="none"})),(0,o.wu)("touchstart",this.statusIcon,(e=>{this.statusTooltip.style.display="block"})),(0,o.wu)("touchstart",document,(e=>{this.statusTooltip.style.display="none"}),!0)}addDrag(e){(0,g.S)(e,((e,t,i)=>{const s=this.getCorrectedRight((0,y.aS)()?this.fullscreenRight:this.right),n=this.getCorrectedBottom((0,y.aS)()?this.fullscreenBottom:this.bottom);let o=s,r=n;const a=t,l=i;return{enabled:!0,move:(e,t)=>{const i=e-a,h=t-l;r=this.getCorrectedBottom(n-h),o=this.getCorrectedRight(s-i),this.main.style.bottom=`${r}px`,this.main.style.right=`${o}px`},end:()=>{(0,y.aS)()?(this.fullscreenRight=o,this.fullscreenBottom=r):(this.right=o,this.bottom=r,this.cachedBottom=r),this.saveSettingsLocalstorage()}}}))}getCorrectedBottom(e){return Math.max(0,Math.min(window.innerHeight-this.main.offsetHeight,e))}getCorrectedRight(e){return Math.max(0,Math.min(window.innerWidth-this.main.offsetWidth,e))}recalcPosition(){if((0,y.aS)())this.main.style.bottom=`${this.getCorrectedBottom(this.fullscreenBottom)}px`,this.main.style.right=`${this.getCorrectedRight(this.fullscreenRight)}px`;else{const e=(0,L.N)(),t=4;this.bottom=e>0?Math.max(this.cachedBottom,e+t):this.cachedBottom,this.main.style.bottom=`${this.getCorrectedBottom(this.bottom)}px`,this.main.style.right=`${this.getCorrectedRight(this.right)}px`}}getSettingsLocalstorage(){if(!(0,n.Pf)())return;const e=window.localStorage.getItem(U);if(null!==e){const t=JSON.parse(e);this.bottom=t.bottom,this.cachedBottom=t.bottom,this.right=t.right,this.fullscreenBottom=t.fullscreenBottom,this.fullscreenRight=t.fullscreenRight}}saveSettingsLocalstorage(){if(!(0,n.Pf)())return;const e={bottom:this.bottom,right:this.right,fullscreenBottom:this.fullscreenBottom,fullscreenRight:this.fullscreenRight};window.localStorage.setItem(U,JSON.stringify(e))}}},9937:(e,t,i)=>{"use strict";i.d(t,{l:()=>l,m:()=>r});var s=i(2709),n=i(9447);class o extends s.u{constructor(e,t,i){super(),this.checkbox=document.createElement("input"),this.onChange=()=>{},this.disabled=!1,this.checkbox.type="checkbox",this.element.style.overflow="visible",this.element.style.position="relative",(0,n.fZ)(this.element,"checkboxComponent"),this.subclassInit(i),void 0!==e&&this.setChecked(e),void 0!==t&&this.setOnChange(t),this.element.appendChild(this.checkbox),this.updateStyles(),this.element.onclick=e=>{this.disabled||e.target===this.checkbox||(this.toggle(),this.checkbox.focus(),e.preventDefault())},this.checkbox.onchange=()=>{this.updateStyles(),this.onChange()}}toggle(){this.checkbox.click()}focus(){this.checkbox.focus()}blur(){this.checkbox.blur()}isActiveElement(){return document.activeElement===this.checkbox}isChecked(){return this.checkbox.checked}setChecked(e){this.checkbox.checked=e,this.updateStyles(),this.onChange()}setCheckedDirectly(e){this.checkbox.checked=e,this.updateStyles()}setOnChange(e){this.onChange=e}disable(){this.disabled=!0,this.checkbox.disabled=!0,this.checkbox.tabIndex=-1,this.updateStyles()}enable(){this.disabled=!1,this.checkbox.disabled=!1,this.checkbox.removeAttribute("tabindex"),this.updateStyles()}setCheckboxValue(e){this.checkbox.value=e}getCheckboxValue(){return this.checkbox.value}setCheckboxId(e){this.checkbox.id=e}getCheckboxId(){return this.checkbox.id}}class r extends o{constructor(e,t,i){super(t,i),this.element.style.height=`${e}px`,this.element.style.width=`${e}px`}subclassInit(){(0,n.fZ)(this.element,"transparentCheckbox")}updateStyles(){this.checkbox.checked?(0,n.fZ)(this.element,"checked"):(0,n.SA)(this.element,"checked"),this.disabled?((0,n.fZ)(this.element,"disabled"),this.element.style.cursor="default"):((0,n.SA)(this.element,"disabled"),this.element.style.cursor="pointer")}setName(e){this.checkbox.name=e}getName(){return this.checkbox.name}setTitle(e){this.checkbox.title=e}}const a="rgb(246, 115, 0)";class l extends o{constructor(e,t,i){super(e,t,i)}subclassInit(e){var t,i;const s=null!==(t=null==e?void 0:e.width)&&void 0!==t?t:50,o=null!==(i=null==e?void 0:e.height)&&void 0!==i?i:30,r=`${s}px`,a=`${o}px`,l=2*o/3+"px";this.toggledOnLeftStyle=s-o+"px",this.element.style.width=r,this.element.style.height=a,this.element.style.borderRadius=l,this.element.style.lineHeight=a,(0,n.fZ)(this.element,"toggle"),this.button=document.createElement("div"),this.button.style.height=a,this.button.style.width=a,(0,n.fZ)(this.button,"toggleButton"),this.element.appendChild(this.button)}updateStyles(){this.checkbox.checked?(this.element.style.backgroundColor=`${a}`,this.element.style.boxShadow=`${a} 0 0 0 16px inset`,this.element.style.border=`1px solid ${a}`,this.button.style.left=this.toggledOnLeftStyle):(this.element.style.backgroundColor="rgb(233, 233, 233)",this.element.style.boxShadow="rgb(233, 233, 233) 0 0 0 16px inset",this.element.style.border="1px solid rgb(223, 223, 223)",this.button.style.left="0")}}},9419:(e,t,i)=>{"use strict";i.d(t,{k:()=>c});var s=i(6844),n=i(2939),o=i(8423),r=i(3959),a=i(1452),l=i(9461),h=i(8039),d=i(6428);class c{constructor(){this.invalidMentions=new Set,this.chatListeners=new o.gt,this.userListNeedsRefresh=!0,this.userList=[],n.X0.listen((e=>{e.chatConnection.event.statusChange.listen((e=>{this.statusChangeShouldRefresh(e.currentStatus,e.previousStatus)})).addTo(this.chatListeners),(0,s.ok)()||e.chatConnection.event.roomNotice.listen((e=>{if(e.noticeType!==r.k.RoomLeave)for(const t of e.messages)for(const e of t)0===e.partType&&void 0!==e.user&&this.addRecentUser(e.user)})).addTo(this.chatListeners)})),n.Gr.listen((()=>{this.chatListeners.removeAll(),this.userList=[],this.userListNeedsRefresh=!0}))}static getInstance(){return void 0===c.instance&&(c.instance=new c),c.instance}refreshUserListIfNeeded(){return this.userListNeedsRefresh?this.refreshUserList():Promise.resolve()}setUserListRefreshCooldown(){this.userListNeedsRefresh=!1,window.setTimeout((()=>{this.userListNeedsRefresh=!0}),6e4)}getSortedList(){return this.userList.sort(((e,t)=>e.user.username.toLowerCase()<t.user.username.toLowerCase()?-1:e.user.username.toLowerCase()>t.user.username.toLowerCase()?1:0)),this.userList}users(){return this.userList.map((e=>e.user))}refreshUserList(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=l.Aw.getState().room;return h.SJ.getInstance().fetchRoomUsers().then((i=>{if(l.Aw.getState().room!==t)return void(this.userList=[]);const s=document.createElement("div");e?this.removeNonRecentUsers():this.userList=[];for(const e of i.roomUsers)this.userInList(e.username)||this.userList.push({user:e,slug:e.username,element:s,recent:!1}),this.invalidMentions.has(e.username)&&(d.$u.fire(void 0),this.invalidMentions.delete(e.username));this.setUserListRefreshCooldown()})).catch((e=>{error("Error loading username autocomplete",e)}))}addRecentUser(e){const t=document.createElement("div"),i=this.getUser(e.username);void 0===i?this.userList.push({user:e,slug:e.username,element:t,recent:!0}):(i.user=e,i.recent=!0),this.invalidMentions.has(e.username)&&(d.$u.fire(void 0),this.invalidMentions.delete(e.username))}addInvalidUsers(e){for(const t of e)this.invalidMentions.add(t)}shouldNotRefresh(e){return["offline","notconnected","hidden","passwordprotected"].indexOf(e)>-1}statusChangeShouldRefresh(e,t){if((0,s.ok)()||this.shouldNotRefresh(e))return;const i=new Set(["privatespying","privatewatching","privatenotwatching"]),n=!i.has(t),o=!i.has(e);n!==o?this.refreshUserList(o).catch(a.yZ):this.refreshUserListIfNeeded().catch(a.yZ)}removeNonRecentUsers(){this.userList=this.userList.filter((e=>e.recent))}getUser(e){return this.userList.find((t=>t.user.username===e))}userInList(e){return void 0!==this.getUser(e)}}},6428:(e,t,i)=>{"use strict";i.d(t,{$u:()=>c,jE:()=>p,ti:()=>u});var s=i(6657),n=i(6066),o=i(8423),r=i(9586),a=i(1452),l=i(8785),h=i(9447),d=i(9419);const c=new o.c_("updateUserMention",{reportIfNoListeners:!1});class u extends s.c{constructor(e){super(e),this.config=e,this.userList=d.k.getInstance()}initData(){super.initData(),this.disableCache=!0,this.maxOptionLength=30}initUI(e){super.initUI(e),this.element.dataset.testid="user-mention-modal"}promptRegex(){return"@"}searchSlugRegex(){return"[\\w-]*"}userMatchesPrefix(e){return e.username.toLowerCase().startsWith(this.searchSlug.toLowerCase())}getData(){this.isGetDataCancelled()||this.userList.refreshUserListIfNeeded().then((()=>{this.setItems(this.userList.getSortedList().filter((e=>this.userMatchesPrefix(e.user))))})).catch(a.yZ)}appendItem(e,t){const i=super.appendItem(e,t);return(0,h.fZ)(i,(0,l.Kb)(e.user)),i.dataset.testid="user-mention-modal-item",i.style.fontWeight="bold",i}pickItem(e,t){super.pickItem(e,t),t||(this.finalizeSelection(),this.hide())}getDataEndpoint(){return""}parseResponse(e){return[]}getDataDebounceMS(){return 0}}class p extends u{constructor(e){super(e),(0,r.H)(this.list),new n.v({autocompleteConfig:this.config,element:this.element,list:this.list,overlayClick:this.overlayClick,listenerGroup:this.listenerGroup,isVisible:()=>this.visible,hide:()=>this.hide(),pickItem:(e,t)=>this.pickItem(e,t),hideOnSpace:!0})}initUI(e){super.initUI(e),this.element.style.border="",this.element.style.fontSize="14px",this.element.style.lineHeight="26px",this.element.style.boxShadow="0px 0px 8px rgba(0, 0, 0, 0.32)",this.element.style.marginLeft="7px",this.element.style.boxSizing="content-box",this.element.style.position="fixed",this.element.style.bottom=e.inputDivHeight-3+"px"}repositionChildren(){}}},7964:(e,t,i)=>{"use strict";i.d(t,{QQ:()=>g,Tj:()=>m,tI:()=>p});var s=i(6784),n=i(6844),o=i(5431),r=i(5173),a=i(9439),l=i(4947),h=i(9447),d=i(9461);let c;function u(e){return(Array.from(e,(e=>e.charCodeAt(0))).reduce(((e,t)=>(e<<5)-e+t|0),0)>>>0).toString(16)}function p(){var e;return void 0!==c&&(null===(e=c)||void 0===e?void 0:e.isShown())}function m(){var e;return null===(e=c)||void 0===e?void 0:e.hide()}function g(e){m();const t=d.Aw.getState(),i=t.room,s=t.chatRules,r=t.userChatSettings;return!(0,n.ok)()&&s.trim().length>0&&!function(e,t){var i;const s=null===(i=d.Bm.current.loggedInUser)||void 0===i?void 0:i.username;if(s===e)return!0;const n=u(t.trim()),o=`rules_accepted_${s}_${e}`;return localStorage.getItem(o)===n}(i,s)&&(e instanceof o.i?(c=new v({inputContainer:e.centerControlsDiv,customInputField:e.chatInput,roomName:i,chatRules:s,container:e.getMobileRoot().getMobilePlayer(),chatSettings:r},!0),c.element.style.position="fixed",c.element.style.zIndex="999999"):(c=new v({inputContainer:e.inputDiv,customInputField:e.customInputField,roomName:i,chatRules:s,container:e,chatSettings:r}),c.element.style.zIndex="1001"),c.show(),!0)}class v extends r.Q{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(e),this.isVisible=!1,this.captureKeys=e=>{(0,a.Vx)()||("Tab"===e.key?(document.activeElement===this.acceptBtn?this.closeBtn.focus():this.acceptBtn.focus(),e.stopPropagation(),e.preventDefault()):"Escape"===e.key?(this.hide(),e.stopPropagation(),e.preventDefault()):"Enter"!==e.key&&(e.stopPropagation(),e.preventDefault()))},this.isMobile=d.Bm.current.isMobile,this.overlayClick.listen((()=>{this.hide()})),t?(this.element.style.width="70%",this.element.style.left="15%"):(this.element.style.width="95%",this.element.style.left="2.5%"),this.updateScrollIndicator()}applyChatSettingsFontStyles(e){this.element.style.fontFamily=e.fontFamily,this.element.style.fontSize=e.fontSize}initData(e){this.chatRules=e.chatRules.trim()}initUI(e){super.initUI(),this.element.style.bottom="10px",this.element.style.borderWidth="1px",this.element.style.borderStyle="solid",this.element.style.borderRadius="4px",this.element.style.margin="0 auto",this.element.style.padding="10px",this.element.style.boxSizing="border-box",this.element.style.maxHeight="95%",this.applyChatSettingsFontStyles(e.chatSettings),(0,h.fZ)(this.element,"rulesModal"),this.inputContainer=e.inputContainer,this.customInput=e.customInputField,this.roomName=e.roomName,this.container=e.container,this.element.style.position="absolute",this.element.style.textAlign="center",this.element.style.height="auto",this.element.style.display="none";const t=document.createElement("div");t.style.fontWeight="bold",t.style.textAlign="left",t.style.paddingBottom="5px",t.style.paddingRight="10px",t.style.whiteSpace="nowrap",t.style.textOverflow="ellipsis",t.style.overflow="hidden";const i=`${this.roomName[0].toUpperCase()}${this.roomName.substring(1)}`;t.innerText=`${i}'s Rules:`,this.element.appendChild(t),this.textPar=this.createTextContent(this.chatRules),this.scrollIndicator=this.createScrollIndicator();const s=document.createElement("div");s.style.position="relative",s.appendChild(this.textPar),s.appendChild(this.scrollIndicator),s.dataset.testid="chat-rules",this.element.appendChild(s),this.acceptBtn=this.createAcceptButton(),this.closeBtn=this.createCloseButton(),this.element.appendChild(this.acceptBtn),this.element.appendChild(this.closeBtn),this.repositionChildren()}createTextContent(e){const t=document.createElement("div");return t.style.whiteSpace="pre-line",t.style.textAlign="left",t.style.lineHeight="1.4",t.style.height="auto",t.style.paddingBottom="15px",t.style.boxSizing="border-box",t.style.width="100%",t.style.overflowY="auto",t.style.overflowWrap="break-word",t.style.wordBreak="break-word",t.style.wordWrap="break-word",t.style.cssText+="; -ms-overflow-style: -ms-autohiding-scrollbar",t.style.marginBottom="3px",t.style.paddingRight="15px",t.onscroll=()=>{this.updateScrollIndicator()},t.appendChild(document.createTextNode(e)),t}isTextScrolledToBottom(){return this.textPar.scrollHeight-this.textPar.scrollTop-this.textPar.clientHeight<=1}updateScrollIndicator(){this.isTextScrolledToBottom()?this.scrollIndicator.style.display="none":this.scrollIndicator.style.display="block"}createScrollIndicator(){const e=document.createElement("div");return(0,h.fZ)(e,"scrollIndicator"),e.style.height="50px",e.style.position="absolute",e.style.bottom="0",e.style.fontWeight="bold",e.style.textAlign="center",e.style.boxSizing="border-box",e.style.width="100%",e}repositionChildren(){const e=this.container.element.getBoundingClientRect().height;this.textPar.style.maxHeight=`calc(${e}px - 120px)`,this.updateScrollIndicator()}show(){this.isVisible||(this.container.addChild(this),this.isVisible=!0,this.element.style.display="block",this.customInput.disable(),this.inputContainer.style.pointerEvents="none",this.showOverlay(),this.repositionChildren(),this.isMobile||(0,s.wu)("keydown",document,this.captureKeys,!0))}hide(){this.isVisible&&(super.hide(),this.isVisible=!1,this.customInput.enable(),this.inputContainer.style.pointerEvents="",this.element.remove(),this.overlay.remove(),this.container.repositionChildrenRecursive(),c=void 0,this.isMobile||(0,s.Pf)("keydown",document,this.captureKeys,!0))}accept(){var e;const t=`rules_accepted_${null===(e=d.Bm.current.loggedInUser)||void 0===e?void 0:e.username}_${this.roomName}`,i=u(this.chatRules);localStorage.setItem(t,i),this.hide(),this.customInput.focus()}createAcceptButton(){const e=document.createElement("button");return e.innerText=l.R.acceptRules,e.style.fontFamily="'UbuntuRegular',sans-serif",e.style.display="inline-block",e.style.boxSizing="content-box",e.style.width="calc(100% - 16px)",e.style.padding="8px",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.fontWeight="500",e.style.lineHeight="16px",e.style.whiteSpace="nowrap",e.style.overflow="hidden",e.style.textOverflow="ellipsis",e.style.fontSize="120%",e.style.zIndex="2",e.dataset.testid="chat-rules-accept",(0,s.wu)("click",e,(()=>{this.accept()})),(0,h.fZ)(e,"acceptRulesButton"),e}createCloseButton(){const e=document.createElement("button"),t=document.createElement("img");return t.src=`${STATIC_URL}close_icon.svg`,t.style.backgroundColor="inherit",e.appendChild(t),e.style.boxSizing="border-box",e.style.padding="5px 5px 4px 5px",e.style.position="absolute",e.style.top="2px",e.style.right="2px",e.style.cursor="pointer",e.dataset.testid="chat-rules-close",(0,s.wu)("click",e,(()=>{this.hide()})),(0,h.fZ)(e,"closeRulesButton"),e}}},5411:(e,t,i)=>{"use strict";i.d(t,{E:()=>s});const s=new(i(8423).c_)("openFeedbackForm")},1280:(e,t,i)=>{"use strict";i.d(t,{f:()=>F,I:()=>U});var s=i(8861),n=i(6784),o=i(5216),r=i(2709),a=i(3955),l=i(6440),h=i(2690),d=i(1452),c=i(3957),u=i(4947),p=i(9447),m=i(9461),g=i(1224),v=i(6064),f=i(7623),y=i(8423),b=i(1675);class w{constructor(e,t,i){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.element=document.createElement("div"),this.label=document.createElement("label"),this.label.htmlFor=t,this.label.innerText=i,"textarea"===e?this.input=document.createElement("textarea"):(this.input=document.createElement("input"),this.input.type=e),this.input.name=t,s&&(this.input.required=s),this.error=document.createElement("p"),this.error.style.display="none",this.element.appendChild(this.label),this.element.appendChild(this.input),this.element.appendChild(this.error)}setError(e){this.error.textContent=e,this.error.style.display=""}clearError(){this.error.textContent="",this.error.style.display="none"}}var C=i(664);const S=new y.c_("canvasOpen"),x=new y.c_("canvasClose"),T=e=>{const t=document.createElement("div");return t.style.display="block",void 0!==e&&e.appendChild(t),t};class P extends r.u{initData(){this.element=T(),this.control=document.createElement("button"),this.control.type="button",this.control.tabIndex=0,this.element.appendChild(this.control)}initUI(){this.element.style.position="absolute",this.element.style.top="0",this.element.style.right="0",this.element.style.margin="12px 12px 0 0",(0,p.fZ)(this.control,"closeControl"),this.control.style.padding="4px",this.control.style.cursor="pointer",this.control.style.width="12px",this.control.style.height="12px",this.control.style.border="none",this.control.style.boxSizing="content-box"}}class k extends r.u{initData(){this.element=T(),(0,p.fZ)(this.element,"header"),this.header=document.createElement("h2"),this.header.textContent=u.R.sendFeedbackTextLc,this.element.appendChild(this.header)}initUI(){(0,a.ZM)(this.header,{fontSize:"14px",lineHeight:"18px",fontFamily:"UbuntuRegular, Helvetica, Arial, sans-serif",margin:"0 0 8px"})}}class A extends r.u{initData(){this.element=T(),(0,p.fZ)(this.element,"submitRow"),this.submit=document.createElement("button"),this.submit.type="submit",this.submit.textContent=u.R.feedbackSubmit,this.submit.disabled=!0,this.element.appendChild(this.submit)}initUI(){this.element.style.textAlign="right",(0,a.ZM)(this.submit,{fontFamily:"UbuntuRegular, Helvetica, Arial, sans-serif",marginTop:"16px",borderStyle:"solid",borderWidth:"1px",borderRadius:"4px",boxSizing:"border-box",opacity:"0.5",padding:"7px"})}disable(){this.submit.disabled=!0,this.submit.style.opacity="0.5",this.submit.style.cursor="default"}enable(){this.submit.disabled=!1,this.submit.style.opacity="1",this.submit.style.cursor="pointer"}}class M extends r.u{constructor(){super(),this.inputChange=new y.c_("inputChange"),this.defaultPrompt=u.R.feedbackSentimentLabel(g.m.siteName),this.element=T(),this.formInput=new w("hidden","sentiment",this.defaultPrompt,!1),this.element.appendChild(this.formInput.element);const e=T();(0,a.ZM)(e,{height:"auto",width:"224px",margin:"12px auto 16px",position:"relative"}),e.appendChild(this.createSentimentSelection(c.PL.InTrouble)),e.appendChild(this.createSentimentSelection(c.PL.Unhappy)),e.appendChild(this.createSentimentSelection(c.PL.Indifferent)),e.appendChild(this.createSentimentSelection(c.PL.Smirk)),e.appendChild(this.createSentimentSelection(c.PL.InLove,!0)),this.element.appendChild(e)}createSentimentSelection(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=document.createElement("button");return i.type="button",(0,p.fZ)(i,"sentimentOption"),i.appendChild((0,C.S)(e)),(0,a.ZM)(i,{height:"24px",width:"24px",padding:"4px",boxSizing:"content-box",backgroundPosition:"center center",backgroundRepeat:"no-repeat",display:"inline-block",backgroundColor:"transparent",border:"none",cursor:"pointer",marginRight:t?"0":"16px",verticalAlign:"middle"}),this.inputChange.listen((t=>{t===e?(0,p.fZ)(i,"selected"):(0,p.SA)(i,"selected")})),i.onclick=()=>{this.setValue(e)},i}setValue(e){this.formInput.input.value=e,this.inputChange.fire(e)}getValue(){return this.formInput.input.value}setPrompt(e){this.formInput.label.textContent=""===e?this.defaultPrompt:e}clearSelection(){this.setValue("")}}class R extends r.u{constructor(e){super(),this.props=e,this.commentItems=[],this.element=T();for(const t of e.prompts){const i=new w("textarea","comments",t,e.required);(0,p.fZ)(i.input,"feedbackComment"),(0,a.ZM)(i.input,{width:"306px",resize:"none",minHeight:`${e.textBoxHeight}px`,boxSizing:"border-box",marginBottom:"8px"}),i.input.maxLength=5e3,(0,p.fZ)(i.error,"error"),i.error.style.marginBottom="12px",(0,n.wu)("keyup",i.input,e.onChange),(0,n.wu)("touchend",i.input,e.onChange),(0,n.wu)("paste",i.input,e.onChange),(0,n.wu)("cut",i.input,e.onChange),this.element.appendChild(i.element),this.commentItems.push(i)}for(let e=0;e<this.commentItems.length;e++)(0,n.wu)("keydown",this.commentItems[e].input,(0,a.eh)((()=>e+1<this.commentItems.length?this.commentItems[e+1].input:void 0),(()=>e>0?this.commentItems[e-1].input:void 0)))}prompts(){return this.props.prompts}values(){return this.commentItems.map((e=>e.input.value))}clear(){for(const e of this.commentItems)e.input.value=""}focus(){this.commentItems[0].input.focus()}blur(){this.commentItems.forEach((e=>e.input.blur()))}firstInput(){return this.commentItems[0].input}lastInput(){return this.commentItems[this.commentItems.length-1].input}setError(e,t){(t<0||t>=this.commentItems.length)&&error("Feedback comments error index out of range"),e.length>0&&this.commentItems[t].setError(e)}clearErrors(){this.commentItems.forEach((e=>e.clearError()))}anyCommentsNonempty(){return this.commentItems.some((e=>""!==e.input.value.trim()))}}class I extends r.u{constructor(e,t){super("div",{control:e}),this.canvas=t}initData(e){this.element=document.createElement("div"),(0,p.fZ)(this.element,"screenshot"),this.editToggle=document.createElement("button"),this.editToggle.type="button",(0,p.fZ)(this.editToggle,"editToggle"),this.editImage=new Image,this.editImage.src=`${STATIC_URL_ROOT}images/feedback/select.svg`,this.editToggle.appendChild(this.editImage),this.editText=document.createElement("div"),this.editText.textContent=u.R.feedbackCanvasToggle,this.editToggle.appendChild(this.editText),(0,n.wu)("click",this.editToggle,(()=>{this.canvas.show()})),(0,n.wu)("mouseenter",this.editToggle,(()=>{this.editImage.src=`${STATIC_URL_ROOT}images/feedback/select_active.svg`})),(0,n.wu)("mouseleave",this.editToggle,(()=>{this.editImage.src=`${STATIC_URL_ROOT}images/feedback/select.svg`})),this.element.appendChild(this.editToggle),this.closeButton=document.createElement("button"),this.closeButton.type="button",this.closeButton.onclick=()=>{e.control.removeScreenshot()},this.element.appendChild(this.closeButton)}initUI(){this.element.style.width="100%",this.element.style.minHeight="140px",this.element.style.maxHeight="340px",this.element.style.position="relative",this.element.style.backgroundSize="contain",this.element.style.backgroundRepeat="no-repeat",this.element.style.backgroundPosition="center",this.element.style.justifyContent="center",this.element.style.alignItems="center",this.element.style.display="none",this.editToggle.style.width="75%",this.editToggle.style.height="100px",this.editToggle.style.boxShadow="0px 4px 16px rgba(0, 0, 0, 0.3)",this.editToggle.style.borderRadius="4px",this.editToggle.style.textAlign="center",this.editToggle.style.cursor="pointer",this.editToggle.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",this.editText.style.width="100%",(0,a.ZM)(this.closeButton,{position:"absolute",right:"10px",top:"10px",height:"24px",width:"24px",padding:"4px",background:`transparent url(${STATIC_URL}feedback/remove-screenshot.svg) no-repeat center center`,border:"none",cursor:"pointer"})}}class E extends r.u{constructor(e,t){super("div",{canvas:t}),this.modal=e,this.canvas=t,this.isCapturing=!1}initData(e){this.element=T(),this.button=document.createElement("button"),this.button.type="button",this.button.textContent=u.R.feedbackAddScreenshot,(0,n.wu)("click",this.button,(e=>{e.preventDefault(),this.addScreenshot()})),this.element.appendChild(this.button),this.screenshot=new I(this,e.canvas),this.addChild(this.screenshot,this.element),this.info=document.createElement("div"),this.info.style.display="none",this.element.appendChild(this.info),this.error=document.createElement("span"),this.element.appendChild(this.error)}initUI(){this.element.style.width="306px",this.element.style.textAlign="center",this.element.style.marginBottom="8px",(0,p.fZ)(this.element,"screenShotControl"),(0,p.fZ)(this.button,"sscButton"),(0,a.ZM)(this.button,{fontFamily:"UbuntuRegular, Arial, Helvetica, sans-serif",border:"none",boxSizing:"border-box",display:"block",cursor:"pointer",textDecoration:"underline",padding:"0",marginBottom:"16px"}),(0,p.fZ)(this.error,"error"),(0,p.fZ)(this.info,"info"),this.info.style.margin="8px 0 10px"}addScreenshot(){if(!this.canvas.canScreenshot())return;if(this.removeScreenshot(),this.canvas.createScreenshot(),this.error.textContent="",void 0===this.canvas.screenshot)return;const e=this.canvas.screenshot.getContext("2d");if(null===e)return;this.isCapturing=!0,this.modal.hide();let t=!1;const i=document.createElement("video");i.style.display="none",this.canvas.element.appendChild(i),this.canvas.getDisplayMedia().then((s=>{i.srcObject=s,this.videoStream=s,i.play(),(0,n.wu)("canplay",i,(()=>{t||(t=!0,window.setTimeout((()=>{const t=window.innerWidth,s=window.innerHeight,n=i.videoWidth/i.videoHeight;let o,r;s*n<t?(o=s*n,r=s):(r=t/n,o=t),this.canvas.setScreenshotDims(o,r),e.drawImage(i,0,0,o,r),this.screenshot.element.style.backgroundImage=`url("${e.canvas.toDataURL("image/png")}")`,this.screenshot.element.style.height=r/o*306+"px",this.screenshot.element.style.display="flex",this.info.style.display="block",this.button.style.display="none",i.pause(),this.videoStream.getTracks().forEach((e=>{e.stop()})),this.canvas.element.removeChild(i),this.modal.show(),window.setTimeout((()=>{this.isCapturing=!1}),1e3)}),250))}),!1)})).catch((e=>{this.modal.show(),"NotAllowedError"===e.name?this.error.textContent=u.R.feedbackPermissionDenied:this.error.textContent=u.R.feedbackUnknownCaptureError,this.canvas.element.removeChild(i),this.removeScreenshot()}))}removeScreenshot(){this.canvas.canScreenshot()&&(this.screenshot.element.style.backgroundImage="",this.screenshot.element.style.display="none",this.button.textContent=u.R.feedbackAddScreenshot,this.info.style.display="none",this.button.style.display="block",this.canvas.deleteScreenshot(),this.canvas.hide())}}class L extends r.u{constructor(e){super("div",{canvas:e}),this.canvas=e,(0,p.fZ)(this.element,"drawControls")}setScreenshot(e){this.screenshot=e}initData(e){this.element=T(),this.element.tabIndex=-1,this.drag=document.createElement("div"),this.drag.style.background=`url(${STATIC_URL_ROOT}images/feedback/drag.svg) no-repeat center`,this.element.appendChild(this.drag),this.highlight=document.createElement("button"),this.highlight.type="button",(0,p.fZ)(this.highlight,"highlight"),this.highlightImage=new Image,this.highlightImage.src=`${STATIC_URL_ROOT}images/feedback/highlight_issue.svg`,this.highlight.appendChild(this.highlightImage),this.highlightText=document.createElement("span"),this.highlightText.textContent=u.R.feedbackHighlightControl,this.highlight.appendChild(this.highlightText),(0,n.wu)("click",this.highlight,(()=>{this.canvas.highlightBrush()})),this.element.appendChild(this.highlight),this.hide=document.createElement("button"),this.hide.type="button",this.hideImage=document.createElement("div"),this.hide.appendChild(this.hideImage),this.hideText=document.createElement("span"),this.hideText.textContent=u.R.feedbackHideControl,this.hide.appendChild(this.hideText),(0,p.fZ)(this.hide,"highlight"),(0,n.wu)("click",this.hide,(()=>{this.canvas.hideBrush()})),this.element.appendChild(this.hide),this.hr=document.createElement("hr"),this.element.appendChild(this.hr),this.done=document.createElement("a"),(0,p.fZ)(this.done,"done"),this.done.style.textDecoration="none",(0,n.wu)("click",this.done,(e=>{e.preventDefault(),this.updateScreenshotBackground(),this.canvas.hide()})),this.element.appendChild(this.done),(0,b.eB)(this.element,{},[this.drag]),(0,n.wu)("keydown",e.canvas.element,(e=>{e.stopPropagation(),27===e.keyCode&&"block"===this.element.style.display&&(e.stopImmediatePropagation(),this.updateScreenshotBackground(),this.canvas.hide())}))}updateScreenshotBackground(){void 0!==this.canvas.screenshot&&void 0!==this.screenshot&&(this.screenshot.element.style.backgroundImage=`url("${this.canvas.screenshot.toDataURL("image/png")}")`)}initUI(){(0,a.ZM)(this.element,{borderRadius:"4px",padding:"10px 15px 5px 15px",position:"fixed",zIndex:2010,textAlign:"right",width:"115px",height:"101px",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif",userSelect:"none",boxShadow:"10px 10px 25px -5px rgba(0,0,0,0.75)"}),(0,a.ZM)(this.drag,{width:"20px",height:"10px",position:"absolute",right:"0",top:"5px"}),(0,p.fZ)(this.highlight,"highlight"),(0,a.ZM)(this.highlight,{border:"0",display:"inline-block",padding:"5px",position:"relative",margin:"7px 0 0 0",left:"-15px",width:"145px",textAlign:"left",cursor:"pointer",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif"}),(0,a.ZM)(this.highlightImage,{width:"23px",verticalAlign:"middle",marginRight:"10px"}),this.highlightText.style.verticalAlign="middle",(0,p.fZ)(this.hide,"highlight"),(0,a.ZM)(this.hide,{border:"0",display:"inline-block",padding:"5px",position:"relative",margin:"0",left:"-15px",width:"145px",textAlign:"left",cursor:"pointer",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif"}),(0,p.fZ)(this.hideImage,"hideImage"),(0,a.ZM)(this.hideImage,{width:"20px",verticalAlign:"middle",marginRight:"10px",height:"20px",display:"inline-block"}),this.hideText.style.verticalAlign="middle",(0,a.ZM)(this.done,{padding:"4px",cursor:"pointer",textAlign:"right"}),this.done.textContent=u.R.doneText}}class D extends r.u{constructor(){super(),this.fillRect=!1,this.mediaStreams=navigator.mediaDevices,void 0!==this.mediaStreams&&void 0!==this.mediaStreams.getDisplayMedia||(this.mediaStreams=void 0),void 0===document.createElement("canvas").toBlob&&(this.mediaStreams=void 0),this.controls=new L(this),this.addChild(this.controls,this.element)}initData(){this.element=T(),this.infoTooltip=T(this.element),this.infoTooltip.innerHTML=`${u.R.feedbackHighlightInfo} (<a href="#" onclick="this.parentNode.style.display='none';">${u.R.dismissLower}</a>)`,(0,n.wu)("click",this.infoTooltip,(()=>{var e;null===(e=this.draw)||void 0===e||e.focus()})),this.infoTooltip.style.userSelect="none"}initUI(){(0,p.fZ)(this.element,"canvas"),(0,a.ZM)(this.element,{display:"none",position:"absolute",height:"100%",width:"100%"}),(0,p.fZ)(this.infoTooltip,"infoToolTip"),(0,a.ZM)(this.infoTooltip,{position:"fixed",borderWidth:"1px",borderStyle:"solid",boxSizing:"border-box",zIndex:2020,top:"100px",left:"0",right:"0",margin:"0 auto",padding:"12px",fontWeight:"bold",width:"500px",textAlign:"center",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif",fontSize:"1.3em"})}canScreenshot(){return void 0!==this.mediaStreams&&!(0,f.Xb)()}getDisplayMedia(){if(!this.canScreenshot())throw new ReferenceError("Display media not supported by browser");return this.mediaStreams.getDisplayMedia({video:{displaySurface:"browser",cursor:!1},audio:!1})}createScreenshot(){this.deleteScreenshot(),this.screenshot=document.createElement("canvas"),(0,a.ZM)(this.screenshot,{zIndex:2e3,top:"50%",left:"50%",transform:"translate(-50%, -50%)",margin:"0px auto",position:"fixed"}),this.hide(),this.element.appendChild(this.screenshot)}deleteScreenshot(){this.deleteDraw(),void 0!==this.screenshot&&(this.element.removeChild(this.screenshot),this.screenshot=void 0)}setScreenshotDims(e,t){void 0!==this.screenshot&&(this.screenshot.width=e,this.screenshot.height=t,this.screenshot.style.width=`${e}px`,this.screenshot.style.height=`${t}px`)}createDraw(){void 0!==this.screenshot&&(void 0!==this.draw&&(this.element.removeChild(this.draw),this.draw=void 0),this.draw=this.screenshot.cloneNode(),this.draw.style.zIndex="2001",this.draw.tabIndex=0,this.element.appendChild(this.draw),this.refreshDraw())}deleteDraw(){void 0!==this.draw&&(this.element.removeChild(this.draw),this.draw=void 0)}hide(){this.element.style.display="none",this.clearBrush(),this.deleteDraw(),document.body.style.overflow="",x.fire(void 0)}show(){this.element.style.display="block",this.controls.element.style.left="75px",this.controls.element.style.bottom="30px",this.infoTooltip.style.display="block",document.body.style.overflow="hidden",this.createDraw(),this.highlightBrush(),void 0!==this.draw&&this.draw.focus(),S.fire(void 0)}copyCanvas(e,t){if(void 0===e||void 0===t)return;const i=t.getContext("2d");if(null===i)return;const s=i.globalAlpha;i.globalAlpha=1,i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0),i.globalAlpha=s}refreshDraw(){if(void 0===this.draw)return;const e=this.draw.getContext("2d");if(null===e)return;this.copyCanvas(this.screenshot,this.draw);const t=e.globalAlpha,i=e.strokeStyle;e.globalAlpha=.1,e.strokeStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.draw.width,this.draw.height),e.globalAlpha=t,e.strokeStyle=i}clearBrush(){this.controls.hide.style.backgroundColor="transparent",this.controls.hide.classList.toggle("active",!1),this.controls.highlight.style.backgroundColor="transparent",this.controls.highlight.classList.toggle("active",!1),void 0!==this.draw&&(void 0!==this.brushMouseListeners&&((0,n.Pf)("mousedown",this.draw,this.brushMouseListeners.down),(0,n.Pf)("mouseup",window,this.brushMouseListeners.up),(0,n.Pf)("mousemove",window,this.brushMouseListeners.move),this.brushMouseListeners=void 0),this.draw.style.cursor="default")}hideBrush(){if(this.clearBrush(),this.createDraw(),void 0===this.draw)return;const e=this.draw.getContext("2d");null!==e&&((0,p.fZ)(this.controls.hide,"active"),e.globalAlpha=1,e.strokeStyle="rgb(0, 0, 0)",e.lineWidth=5,this.fillRect=!0,this.canvasBrush())}highlightBrush(){if(this.clearBrush(),this.createDraw(),void 0===this.draw)return;const e=this.draw.getContext("2d");null!==e&&((0,p.fZ)(this.controls.highlight,"active"),e.globalAlpha=.8,e.strokeStyle="rgb(249, 185, 144)",e.lineWidth=5,this.fillRect=!1,this.canvasBrush())}canvasBrush(){if(void 0===this.draw)return;this.draw.style.cursor="crosshair";const e=this.draw.getContext("2d");if(null===e)return;let t=0,i=0,s=0,o=0,r=0,a=0,l=!1;const h=()=>{t=0,i=0,r=0,a=0,l=!1};this.brushMouseListeners={down:s=>{l&&(this.drawBoxOnScreenshot(t,i,r,a,e),h());const n=this.draw.getBoundingClientRect();t=s.clientX-n.left,i=s.clientY-n.top,l=!0,e.canvas.style.cursor="crosshair"},up:s=>{l&&(this.drawBoxOnScreenshot(t,i,r,a,e),h())},move:n=>{if(l){const l=this.draw.getBoundingClientRect();s=n.clientX-l.left,o=n.clientY-l.top,this.refreshDraw(),r=s-t,a=o-i,this.drawBox(t,i,r,a,e)}}},(0,n.wu)("mousedown",this.draw,this.brushMouseListeners.down),(0,n.wu)("mouseup",window,this.brushMouseListeners.up),(0,n.wu)("mousemove",window,this.brushMouseListeners.move)}drawBox(e,t,i,s,n){n.beginPath(),n.rect(e,t,i,s),this.fillRect?n.fill():n.stroke()}drawBoxOnScreenshot(e,t,i,s,n){if(void 0===this.screenshot)return;this.screenshot.style.cursor="crosshair";const o=this.screenshot.getContext("2d");null!==o&&(o.globalAlpha=n.globalAlpha,o.strokeStyle=n.strokeStyle,o.lineWidth=n.lineWidth,this.drawBox(e,t,i,s,o))}}class B extends r.u{constructor(e){super("div",e),this.errors=[],this.canvas.canScreenshot()&&(this.updateInfoText(),this.errors.push(this.screenshot.error)),this.errors.push(this.globalError),(0,n.wu)("submit",this.form,(e=>{e.preventDefault(),this.submit()}))}initUI(e){if(this.element=T(),this.form=document.createElement("form"),this.form.action=(0,o._Y)("/feedback/submit/"),this.form.method="POST",this.element.appendChild(this.form),this.globalError=document.createElement("p"),this.globalError.style.color="red",this.globalError.style.marginBottom="8px",this.form.appendChild(this.globalError),this.sentiment=this.createSentimentSelection(),this.form.appendChild(this.sentiment.element),this.comments=this.createComments(),this.form.appendChild(this.comments.element),this.canvas=e.canvas,this.canvas.canScreenshot()&&(this.screenshot=new E(e.modal,this.canvas),this.addChild(this.screenshot,this.form)),this.notice=document.createElement("p"),(0,p.fZ)(this.notice,"privacyNotice"),this.notice.style.fontSize="10.5px",this.notice.style.lineHeight="14px",this.notice.textContent=u.R.feedbackNotice.replace("%SITE_NAME%",g.m.siteName),this.form.appendChild(this.notice),window.location.pathname.startsWith("/billingsupport/")&&(0,l.e)("TestFE")){const e=this.notice.cloneNode(!0);e.textContent="TestFE is active.",this.form.appendChild(e)}this.csrf=document.createElement("input"),this.csrf.type="hidden",this.csrf.name="csrfmiddlewaretoken",this.csrf.value=(0,s.I7)("csrftoken"),this.form.appendChild(this.csrf),this.url=document.createElement("input"),this.url.type="hidden",this.url.name="url",this.url.value=document.location.href.substr(0,255),this.form.appendChild(this.url),this.source=document.createElement("input"),this.source.type="hidden",this.source.name="source",this.source.value="",this.form.appendChild(this.source),this.submitRow=new A,this.addChild(this.submitRow,this.form)}createSentimentSelection(){return new M}createComments(){return new R({prompts:[u.R.feedbackCommentsLabel],onChange:()=>{window.setTimeout((()=>{this.comments.anyCommentsNonempty()?this.submitRow.enable():this.submitRow.disable()}),200)},required:!0,textBoxHeight:72})}canAddScreenshot(){return this.canvas.canScreenshot()&&"none"!==this.screenshot.button.style.display}updateInfoText(){this.canAddScreenshot()&&(this.screenshot.info.textContent="footer"===this.source.value?u.R.feedbackAddScreenshotInfoScrollUp:u.R.feedbackAddScreenshotInfoScrollDown)}updateCSRF(){this.csrf.value=(0,s.I7)("csrftoken")}updateURL(){this.url.value=document.location.href.substr(0,255)}updateSource(e){this.source.value=e,this.updateInfoText()}updateSentiment(e){this.sentiment.setValue(e)}clearErrors(){this.errors.forEach((e=>{e.textContent=""})),this.comments.clearErrors()}resetForm(){this.forceForm(),this.clearErrors(),this.comments.clear(),this.sentiment.clearSelection(),this.submitRow.disable(),this.form.reset(),this.canvas.canScreenshot()&&this.screenshot.removeScreenshot()}forceForm(){this.removeAllDOMChildren(),this.element.appendChild(this.form),this.comments.focus()}submit(){this.clearErrors();const e=new FormData;e.append("sentiment",this.sentiment.formInput.input.value),this.comments.prompts().forEach((t=>{e.append("prompts",t)})),this.comments.values().forEach((t=>{e.append("responses",t)})),e.append("url",document.location.href.substr(0,255)),e.append("source",this.source.value),e.append("csrfmiddlewaretoken",(0,s.I7)("csrftoken")),void 0!==this.canvas.screenshot?this.canvas.screenshot.toBlob((t=>{null!==t&&e.append("screenshot",t,"screenshot.png"),this.postFeedback(e)})):this.postFeedback(e)}postFeedback(e){this.submitRow.disable(),(0,o.KF)(this.form.action,e).then((e=>{const t=e.getResponseHeader("content-type");if(null!==t&&t.includes("text/html"))this.globalError.textContent=u.R.feedbackBannedUser,this.submitRow.enable();else{this.resetForm(),this.element.removeChild(this.form);const e=document.createElement("p");e.textContent=u.R.feedbackSubmitted,this.element.appendChild(e)}})).catch((e=>{if(429===e.xhr.status)this.globalError.textContent=u.R.feedbackRateLimitError;else try{const t=JSON.parse(e.xhr.response).responses;void 0!==t&&t.forEach(((e,t)=>this.comments.setError(e,t)))}catch{this.globalError.textContent=u.R.feedbackUnknownError}this.submitRow.enable()}))}}class U extends h.zf{static show(e){void 0===U.instance&&(U.instance=new U),U.instance.showFromSource(e)}constructor(){super({onShow:()=>{this.onShow()},onHide:()=>{this.onHide()},easyExit:!0}),this.isVisible=!1,this.overlayClickStayOpen=!0,this.preventChatFocus=!0,this.element.classList.add("block_CB1_chat_focus"),this.element.dataset.testid="user-feedback-modal",(0,p.fZ)(this.overlay,"overlayOpacity"),(0,p.fZ)(this.element,"userFeedbackForm"),(0,p.fZ)(this.element,p.aG.defaultColor),S.listen((()=>{this.element.style.display="none"})),x.listen((()=>{this.element.style.display="block"})),v.Fd.listen((()=>{this.hide()})),this.overlayClick.listen((()=>{this.hide()}))}initData(){this.canvas=new D,this.canvas.canScreenshot()&&document.body.appendChild(this.canvas.element),this.inner=T(this.element),this.close=new P,(0,n.wu)("click",this.close.control,(()=>{this.hide()})),this.addChild(this.close,this.inner),this.header=new k,this.addChild(this.header,this.inner),this.form=this.createFormContent(),this.canvas.canScreenshot()&&this.canvas.controls.setScreenshot(this.form.screenshot.screenshot),this.addChild(this.form,this.inner);const e=()=>this.form.submitRow.submit.disabled?this.close.control:this.form.submitRow.submit;this.element.querySelectorAll(".sentimentOption").forEach((e=>{(0,n.wu)("keydown",e,(0,a.eh)(this.form.comments.firstInput(),this.close.control))})),(0,n.wu)("keydown",this.form.comments.element,(0,a.eh)((()=>this.form.canAddScreenshot()?this.form.screenshot.button:e()),this.close.control)),this.form.canAddScreenshot()&&(0,n.wu)("keydown",this.form.screenshot.button,(0,a.eh)(e,this.form.comments.lastInput())),(0,n.wu)("keydown",this.form.submitRow.submit,(0,a.eh)(this.close.control,(()=>this.form.canAddScreenshot()?this.form.screenshot.button:this.form.comments.lastInput()))),(0,n.wu)("keydown",this.close.control,(0,a.eh)(this.form.comments.firstInput(),(()=>this.form.submitRow.submit.disabled?this.form.canAddScreenshot()?this.form.screenshot.button:this.form.comments.lastInput():this.form.submitRow.submit)))}initUI(){(0,a.ZM)(this.element,{position:"fixed",top:"150px",fontSize:"12px",left:"50%",marginLeft:"-157px",width:"310px",height:"auto",border:"4px",borderRadius:"4px",padding:"15px",fontFamily:"UbuntuRegular, Helvetica, Arial, sans-serif"}),this.canvas.canScreenshot()&&(0,n.wu)("resize",window,(()=>{this.form.screenshot.isCapturing||void 0===this.canvas.screenshot||(this.form.screenshot.removeScreenshot(),this.form.screenshot.error.textContent=u.R.feedbackResize)}))}createFormContent(){return new B({modal:this,canvas:this.canvas})}showFromSource(e){this.form.updateSource(e.source),void 0!==e.sentiment&&this.form.updateSentiment(e.sentiment),this.show()}onShow(){this.form.updateCSRF(),this.form.updateURL(),this.element.style.display="",this.repositionChildren(),this.isVisible=!0,(0,n.wu)("keydown",this.element,N),(0,n.wu)("keydown",document.body,O),this.form.forceForm()}onHide(){const e=this.isVisible;this.element.style.display="none",this.isVisible=!1,e&&((0,n.Pf)("keydown",this.element,N),(0,n.Pf)("keydown",document.body,O));try{window.dispatchEvent(new Event("resize"))}catch{if(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0){const e=document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}else error("Could not fire resize event")}this.canvas.hide()}}class _ extends B{constructor(e){super(e),this.sentiment.inputChange.listen((()=>{this.submitRow.enable()}))}createSentimentSelection(){const e=new M;return e.setPrompt(u.R.feedbackBroadcasterLabel(g.m.siteName)),e}createComments(){return new R({prompts:[u.R.haveYouNoticedAnyBugs],onChange:()=>{window.setTimeout((()=>{""===this.sentiment.getValue()&&(this.comments.anyCommentsNonempty()?this.submitRow.enable():this.submitRow.disable())}),200)},required:!1,textBoxHeight:52})}forceForm(){super.forceForm(),this.comments.blur()}submit(){var e,t;super.submit();const i=new FormData;i.append("rating",this.sentiment.formInput.input.value),i.append("url",document.location.href.substr(0,255)),i.append("room_user",null!==(e=null===(t=m.Bm.current.loggedInUser)||void 0===t?void 0:t.username)&&void 0!==e?e:""),(0,o.KF)(c.eN,i).catch(d.yZ)}}class F extends U{static show(){void 0===F.instance&&(F.instance=new F),F.instance.show()}constructor(){super(),this.form.updateSource("broadcaster_sentiment_survey")}createFormContent(){return new _({modal:this,canvas:this.canvas})}}const N=e=>{27!==e.keyCode&&e.stopImmediatePropagation()},O=e=>{32===e.keyCode&&e.target===document.body&&e.preventDefault()}},7872:(e,t,i)=>{"use strict";i.d(t,{GC:()=>c,cl:()=>d,gY:()=>h,zD:()=>u});var s=i(7623),n=i(2758),o=i(6784),r=i(5216);const a=10,l=60;function h(e){const t=e.querySelectorAll("a.dismiss_notice_tfa_and_email"),i=e.querySelectorAll("a.dismiss_notice"),s=e.querySelectorAll("a.dismiss_notice_no_persist"),h=e.querySelectorAll("a.dismiss_notice_ajax"),d=e.getAttribute("data-cache-key");null!==d&&"1"!==(0,n.y1)(d)&&(e.style.display=""),t.forEach((e=>{(0,o.wu)("click",e,(()=>{u(e,a)}))})),i.forEach((e=>{(0,o.wu)("click",e,(()=>{u(e,l)}))})),s.forEach((e=>{(0,o.wu)("click",e,(()=>{u(e)}))})),h.forEach((e=>{(0,o.wu)("click",e,(()=>{!function(e){const t=e.closest("div.dismissible_notice");if(null!==t){const i=e.getAttribute("data-dismiss-url");null!==i&&(0,r.KF)(i,{}),t.style.display="none"}}(e)}))}))}function d(){const e=document.querySelectorAll("div.dismissible_notice");for(const t of e)"ie-support-notice"===t.id&&(0,s.hl)()||h(t)}function c(){if(["/security"].some((e=>window.location.pathname.includes(e))))return;const e=document.querySelectorAll("div.dismissible_notice_global");for(const t of e){const e=t.querySelector("a.dismiss_notice");if(null===e)continue;const i=t.getAttribute("data-cache-key");null!==i&&("1"!==(0,n.y1)(i)&&(t.style.display="",(0,o.wu)("click",e,(()=>{t.style.display="none",(0,n.aR)(i,"1",{days:l})}))))}}function u(e,t){const i=e.closest("div.dismissible_notice");if(null!==i){const e=i,s=e.getAttribute("data-cache-key");null!==s&&void 0!==t&&(0,n.aR)(s,"1",{days:t}),e.style.display="none"}}},9461:(e,t,i)=>{"use strict";i.d(t,{Hb:()=>s,Bm:()=>l,Aw:()=>h,Db:()=>d});var s,n=i(8423),o=i(2042);class r{constructor(){this.isSet=!1}get current(){return this.value}set current(e){this.isSet||(this.value=e,this.isSet=!0)}}class a{constructor(e){this.state=e}getState(){return{...this.state}}setState(e){if(!this.hasChanges(e))return;const t=this.state;this.state={...this.state,...e},this.onUpdate.fire(t)}hasChanges(e){for(const t in e)if(!(0,o.k)(e[t],this.state[t]))return!0;return!1}}!function(e){e.RoomlistPage="roomlistPage",e.RoomPage="chatroom"}(s||(s={}));const l=new class extends r{},h=new class extends a{constructor(){super(...arguments),this.onUpdate=new n.c_("RoomDossierContextUpdate",{maxHistorySize:1})}}({room:"",chatUserName:"",viewerPassword:"",roomPasswordHash:"",lastSubmittedPasswordHash:"",chatRules:"",roomUid:"",viewerUid:"",host:"",roomTitle:"",appsRunning:[{app_name:"",app_location:""}],roomStatus:"public",userName:"",edgeAuth:"",viewerGender:"m",hlsSource:"",allowAnonymousTipping:!1,privateMinMinutes:0,allowShowRecordings:!1,numViewers:0,isWidescreen:!1,roomGender:"f",allowPrivateShow:!1,privatePrice:6,spyPrice:0,premiumPrivatePrice:0,premiumPrivateMinMinutes:0,premiumShowActive:!1,privateShowId:"",hasLowSatisfactionScore:!1,isAgeVerified:!0,hiddenMessage:"",following:!0,followNotificationFrequency:"smart",isModerator:!1,broadcasterIsOnNewChat:!1,tokenBalance:0,isSupporter:!1,needsSupporterToPm:!0,serverName:"",numFollowed:0,numFollowedOnline:0,hasStudio:!1,isMobile:!1,ignoredEmoticons:[],hideSatisfactionScore:!1,satisfactionScore:{upVotes:0,downVotes:0,percent:100},tipsInPast24Hours:0,lastVoteInPast24Hours:0,lastVoteInPast90DaysDown:!1,tfaEnabled:!1,dismissibleMessages:[],showMobileSiteBannerLink:!1,exploringHashTag:"",sourceName:"un",isInFanClub:!1,hasFanClub:!1,paidTokensFanClub:!1,userChatSettings:{fontSize:"",fontColor:"",fontFamily:"",showEmoticons:!0,emoticonAutocompleteDelay:5,sortUsersKey:"a",modExpiration:0,roomEntryFor:1,roomLeaveFor:1,c2cNotificationLimit:0,silenceBroadcasters:"false",ignoredUsers:"",allowedChat:"",tipVolume:0,highestTokenColor:"",collapseNotices:!0},browserId:"",aspAuthUrl:"",quality:{quality:"good",rate:0,stopped:!0},edgeRegion:"",userlistColor:"g",activePassword:!1,summaryCardImage:""}),d=new class extends a{constructor(){super(...arguments),this.onUpdate=new n.c_("SPAPageContextUpdate",{maxHistorySize:1})}}({})},7254:(e,t,i)=>{"use strict";i.d(t,{AJ:()=>s,CM:()=>o});var s,n=i(4947);!function(e){e.Fanclub="fanclub",e.Follow="follow",e.Signup="signup",e.Supporter="supporter",e.Tip="tip",e.Help="help"}(s||(s={})),s.Fanclub,s.Follow,s.Signup,s.Supporter,s.Help,s.Tip;const o=(e,t)=>{let i=`${n.R.shortcodeHelp}\n\n    ${n.R.shortcode}: [cb:help]\n    ${n.R.shortcodeHelpHelp}\n\n    ${n.R.shortcode}: [cb:signup]\n    ${n.R.shortcodeHelpSignup()}\n\n    ${n.R.shortcode}: [cb:supporter]\n    ${n.R.shortcodeHelpSupporter()}\n\n    ${n.R.shortcode}: [cb:fanclub]\n    ${n.R.shortcodeHelpFanclub(e)}\n\n    ${n.R.shortcode}: [cb:follow]\n    ${n.R.shortcodeHelpFollow(e)}`;return t&&(i+=`\n\n            ${n.R.shortcode}: [cb:tip amount=50 message="${n.R.shortcodeHelpTipExample}"]\n            ${n.R.shortcodeHelpTip()}`),i}},4754:(e,t,i)=>{"use strict";i.d(t,{m:()=>n});var s=i(2709);class n extends s.u{constructor(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.userCanAccess=i,this.leftContainer=document.createElement("div"),this.rightContainer=document.createElement("div"),this.leftContainer.style.display=this.rightContainer.style.display="inline-block",this.leftContainer.style.height=this.rightContainer.style.height="calc(100% - 20px)",this.leftContainer.style.width=this.rightContainer.style.width="50%",this.leftContainer.style.top=this.rightContainer.style.top="0px",this.leftContainer.style.position=this.rightContainer.style.position="absolute",this.leftContainer.style.left=this.rightContainer.style.right="0px",this.userCanAccess&&(this.leftContainer.style.cursor=this.rightContainer.style.cursor="pointer"),this.leftArrow=document.createElement("div"),this.rightArrow=document.createElement("div"),this.leftArrow.style.position=this.rightArrow.style.position="absolute",this.leftArrow.style.top=this.rightArrow.style.top=(this.leftContainer.offsetHeight-50)/2+"px",this.leftArrow.style.height=this.rightArrow.style.height="50px",this.leftArrow.style.width=this.rightArrow.style.width="30px",this.leftArrow.style.userSelect=this.rightArrow.style.userSelect="none",this.leftArrow.style.webkitUserSelect=this.rightArrow.style.webkitUserSelect="none",this.leftArrow.style.left=this.rightArrow.style.right="0";const s=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("d","M5.7 0L0 5.55 18.6 24 0 42.45 5.7 48 30 24 5.7 0z"),i.setAttribute("fill","#E2E2E2"),"left"===e&&i.setAttribute("transform","translate(30, 0) scale(-1,1)"),t.appendChild(i),t.setAttribute("viewBox","0 0 30 50"),t},n=s("left");n.dataset.testid="left-arrow";const o=s("right");o.dataset.testid="right-arrow",this.leftArrow.appendChild(n),this.rightArrow.appendChild(o),this.leftContainer.appendChild(this.leftArrow),this.rightContainer.appendChild(this.rightArrow);const r=this.leftArrow.firstChild.firstChild,a=this.rightArrow.firstChild.firstChild,l=e=>{this.userCanAccess&&("left"===e?r.style.fill="#B8B8B8":a.style.fill="#B8B8B8")},h=e=>{"left"===e?r.style.fill="#E2E2E2":a.style.fill="#E2E2E2"};this.leftContainer.onmouseenter=()=>{l("left")},this.leftContainer.onmouseleave=()=>{h("left")},this.rightContainer.onmouseenter=()=>{l("right")},this.rightContainer.onmouseleave=()=>{h("right")},this.leftContainer.onclick=e,this.rightContainer.onclick=t}repositionArrows(e){this.leftArrow.style.top=this.rightArrow.style.top=(e-50)/2+"px"}shiftArrows(e){this.leftArrow.style.left=this.rightArrow.style.right=`${e}px`}showArrows(){this.leftContainer.style.visibility=this.rightContainer.style.visibility="normal",this.userCanAccess&&(this.leftContainer.style.cursor=this.rightContainer.style.cursor="pointer")}hideArrows(){this.leftContainer.style.visibility=this.rightContainer.style.visibility="hidden"}}},5330:(e,t,i)=>{"use strict";i.d(t,{HC:()=>S,PK:()=>u,Q5:()=>l,Q8:()=>d,T$:()=>b,gV:()=>h,jC:()=>w,kP:()=>c,s5:()=>y,tW:()=>a,x2:()=>f});var s=i(4936),n=i(5216),o=i(8423),r=i(4947);const a=new o.c_("photoSetDetail");function l(e){return new Promise(((t,i)=>{(0,n.Aw)(`photo_videos/api/photoset_links/${e}/`).then((e=>{const s=JSON.parse(e.responseText);s.error&&i(s.error),t(s.urls)})).catch((e=>{i(e)}))}))}function h(e){return new Promise(((t,i)=>{(0,n.Aw)(`photo_videos/api/photoset_links/${e}/`).then((e=>{const s=JSON.parse(e.responseText);s.error&&i(s.error),t(s.urls[0])})).catch((e=>{i(e)}))}))}function d(e){return new Promise(((t,i)=>{(0,n.Aw)(`photo_videos/api/photoset_action_links/${e}/`).then((e=>{t(e.responseText)})).catch((e=>{i(e)}))}))}function c(e){return new Promise(((t,i)=>{(0,n.Aw)(`photo_videos/api/pvcontext/${e}/`).then((e=>{t(u(e.responseText))})).catch((e=>{i(e)}))}))}function u(e){const t=new s.N6(e);return{room:t.getString("room"),isBroadcaster:t.getBoolean("is_broadcaster"),isStaff:t.getBoolean("is_staff"),hasFanClub:t.getBoolean("has_fan_club"),isFanClubMember:t.getBoolean("is_fan_club_member"),photosets:p(t.getObjectString("photo_sets"))}}function p(e){const t=[];for(const i of JSON.parse(e)){const e=new s.N6(JSON.stringify(i));t.push({id:e.getNumber("id"),name:e.getString("name"),coverUrl:e.getString("cover_url"),tokens:e.getNumber("tokens"),isVideo:e.getBoolean("is_video"),userCanAccess:e.getBoolean("user_can_access"),purchaseCount:e.getNumber("purchase_count"),userHasPurchased:e.getBoolean("user_has_purchased"),pendingApproval:e.getBoolean("pending_approval",!1,!1),failedApproval:e.getBoolean("failed_approval",!1,!1),rejectionNotes:e.getString("rejection_notes",!1),fanClubOnly:e.getBoolean("fan_club_only"),fanClubUnlock:e.getBoolean("fan_club_unlock"),labelText:e.getString("label_text"),labelColor:e.getString("label_color"),description:e.getString("description"),numPhotos:e.getNumber("num_photos"),created:e.getString("created"),videoHasSound:e.getBoolean("video_has_sound"),legacyVideo:e.getBoolean("legacy_video"),videoDuration:e.getNumber("video_duration"),videoId:e.getNumberOrUndefined("video_id",!1),videoIsReady:e.getBoolean("video_ready",!1,!1),videoErrorProcessing:e.getBoolean("video_error_processing",!1,!1),visibility:e.getString("visibility")}),e.logUnusedDebugging("parseBioApiResponse.photoset")}return t}const m=0,g=1,v=2,f="purchase_only",y="fanclub_or_purchase",b="fanclub_only",w="free",C="not_approved";function S(e,t){const i={labelColor:"#AAA",labelParts:[],labelType:w};return e.failedApproval?(i.labelType=C,i.labelColor="#5e81a4",i.labelParts=[{token:r.R.failedCAPS,size:m},{token:r.R.approvalCAPS,size:m}]):function(e){return e.isVideo&&e.videoErrorProcessing}(e)?(i.labelType=C,i.labelColor="#5e81a4",i.labelParts=[{token:r.R.errorCAPS,size:m},{token:r.R.processingCAPS,size:m}]):function(e){return e.isVideo&&!e.videoIsReady}(e)?(i.labelType=C,i.labelColor="#5e81a4",i.labelParts=[{token:r.R.videoCAPS,size:m},{token:r.R.processingCAPS,size:m}]):e.pendingApproval?(i.labelType=C,i.labelColor="#5e81a4",i.labelParts=[{token:r.R.pendingCAPS,size:m},{token:r.R.approvalCAPS,size:m}]):function(e,t,i){return!e&&i>0||!t&&i>0}(e.fanClubUnlock,t,e.tokens)?(i.labelType=f,i.labelParts=[{token:`${e.tokens}`,size:g},{token:r.R.tokenOrTokensText(e.tokens,!0),size:m}]):e.fanClubOnly?(i.labelType=b,i.labelColor="#090",i.labelParts=[{token:r.R.fanTextCAPS,size:g},{token:r.R.clubTextCAPS,size:g}]):e.fanClubUnlock&&e.tokens>0&&(i.labelType=y,i.labelColor="#090",i.labelParts=[{token:r.R.fanTextCAPS,size:g},{token:r.R.clubTextCAPS,size:g},{token:r.R.orCAPS,size:v},{token:`${e.tokens}`,size:g},{token:r.R.tokenOrTokensText(e.tokens,!0),size:m}]),i}},2042:(e,t,i)=>{"use strict";function s(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(isNaN(e)&&isNaN(t)&&"number"==typeof e&&"number"==typeof t)return!0;if(e===t)return!0;if(e instanceof Function)return e===t;if("function"==typeof e&&"function"==typeof t||e instanceof Date&&t instanceof Date||e instanceof RegExp&&t instanceof RegExp||e instanceof String&&t instanceof String||e instanceof Number&&t instanceof Number)return e.toString()===t.toString();if(!(e instanceof Object&&t instanceof Object))return!1;if(e.isPrototypeOf(t)||t.isPrototypeOf(e))return!1;if(e.constructor!==t.constructor)return!1;if(e.prototype!==t.prototype)return!1;for(const s in t)if(!(i.indexOf(s)>=0)){if(t.hasOwnProperty(s)!==e.hasOwnProperty(s))return!1;if(typeof t[s]!=typeof e[s])return!1}for(const n in e)if(!(i.indexOf(n)>=0)){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(typeof t[n]!=typeof e[n])return!1;switch(typeof e[n]){case"object":case"function":if(!s(e[n],t[n],i))return!1;break;default:if(e[n]!==t[n])return!1}}return!0}i.d(t,{k:()=>s})},5914:(e,t,i)=>{"use strict";i.d(t,{U:()=>H});var s=i(4936),n=i(1519),o=i(8423),r=i(7407),a=i(1452),l=i(9461),h=i(7623),d=i(6784),c=i(4516);function u(e){switch(e){case"initialized":return"initialized";case"connecting":return"connecting";case"connected":return"connected";case"closing":return"closing";case"closed":return"closed";case"disconnected":case"unavailable":return"disconnected";case"failed":return"failed";case"suspended":return"suspended";default:return"unknown"}}function p(e){switch(e){case"initialized":return"initialized";case"attaching":return"subscribing";case"attached":return"subscribed";case"detaching":return"unsubscribing";case"detached":return"unsubscribed";case"failed":return"failed";case"suspended":return"suspended";default:return"unknown"}}function m(e,t){if(void 0===t)return;const i=t;Object.keys(t).forEach((t=>{const s=i[t];e.set(t,s)}))}class g{constructor(e){e.ignore("client_id"),this.topicKeyToChannelName=new Map,this.channelNameToTopicKeys=new Map,this.channelNameToTopicsMap=new Map,this.failures=new Map,e.keys().includes("settings")||warn("PushServiceContext: settings not found in context",{contextKeys:e.keys().join(","),context:e.stringMessage});const t=e.getParsedSubMap("settings");this.settings=this.parseSettings(t),m(this.settings.flags,t.getObjectOrUndefined("flags")),this.populateTopics(e.getObjectOrUndefined("channels")),m(this.failures,e.getObjectOrUndefined("failures"))}populateTopics(e){if(void 0===e)return;const t=Object.keys(e);for(const i of t){const t=i.split("#")[0],s=i.split("#")[1],n=e[i];this.topicKeyToChannelName.set(s,n);const o=this.channelNameToTopicKeys.get(n);void 0===o?this.channelNameToTopicKeys.set(n,[s]):(o.push(s),this.channelNameToTopicKeys.set(n,o));let r=this.channelNameToTopicsMap.get(n);if(void 0===r)r=new Map;else if(r.has(t))return void warn("A topic with different topic keys is being registered on the same channel. This should never happen!",{channelName:n,topicId:t},"PUSH_");r.set(t,s),this.channelNameToTopicsMap.set(n,r)}}getChannelName(e){return this.topicKeyToChannelName.get(e)}getTopicKeys(e){return this.channelNameToTopicKeys.get(e)}deleteChannel(e){this.channelNameToTopicKeys.delete(e)}deleteTopic(e){this.topicKeyToChannelName.delete(e)}getChannelTopicMap(e){return this.channelNameToTopicsMap.get(e)}getFailedTopics(){return Array.from(this.failures.keys(),(e=>e.split("#")[1]))}}class v{constructor(e){this.callbacks=e,this.activeSubscriptions=new Set,this.topicsToSubscribe=new Set,this.topicPromises=new Map,this.creationTime=(new Date).getTime(),this.seenMessages=new Map,this.seenMessagesLimit=5e3,this.messagesInChat=new Map,this.failedTopics=new Map,this.criticalFailLimit=3,this.subscribedTopicKeysByChannel=new Map}addPageAction(e,t){(0,r.PF)()&&(t.action=e,t.created=this.creationTime,t.client=this.clientName,(0,r.bT)("PushServiceClient",t))}connect(){return this.isConnected()?Promise.resolve():this.hasBusyConnection()&&void 0===this.connectPromise?Promise.reject("Connection is currently busy!"):(void 0===this.connectPromise&&(this.connectPromise=new Promise(((e,t)=>{const i=s=>{"connected"===s.current?this.isConnected()&&(this.connectPromise=void 0,this.connectionChange.removeListener(i),e()):"connecting"===s.previous&&(this.connectPromise=void 0,this.connectionChange.removeListener(i),t(s.reason))};this.connectionChange.listen(i),this._connect()}))),this.connectPromise)}isConnected(){return"connected"===this.getConnectionState()}hasBusyConnection(){return new Set(["connecting","closing"]).has(this.getConnectionState())}ensureConnected(){return this.isConnected()?Promise.resolve():this.connect()}ensureConnectedAndAuthed(e){return this.ensureConnected().then((()=>this.auth.canAccessTopic(e)?Promise.resolve():Promise.reject(`Auth context has no access: ${this.auth.serialize()}`)))}getAuthPromise(e){const t=[],i=[];return e.forEach((e=>{-1===this.auth.getTopicKeys().indexOf(e)&&t.push(e),this.isSubscribedTo(e)&&!c.J.hasPresence(e)||i.push(e)})),t.length<1?Promise.resolve():this.auth.updateAuthToken()}isSubscribedTo(e){return this.auth.canAccessTopic(e)&&this.activeSubscriptions.has(e)}subscribe(e){return this.topicsToSubscribe.add(e),this.updateChannelSubscription(e).then((()=>(this.topicPromises.delete(e),Promise.resolve()))).catch((t=>(this.handleTopicFailure(e),this.topicPromises.delete(e),["closed","closing","disconnected"].includes(this.getConnectionState())?Promise.resolve():Promise.reject(t))))}unsubscribe(e){return this.topicsToSubscribe.delete(e),this.updateChannelSubscription(e).then((()=>{this.topicPromises.delete(e)})).catch((t=>(this.handleUnsubscribed(e),this.topicPromises.delete(e),Promise.reject(t))))}updateChannelSubscription(e){const t=this.topicPromises.get(e);if(void 0!==t)return t.then((()=>this.updateChannelSubscription(e)));const i=this.getChannelName(e);if(void 0===i)return Promise.reject({code:"topic_error",message:"Unknown topic key"});const s=this.getChannelState(i),n=this.topicsToSubscribe.has(e),o=this.subscribedTopicKeysByChannel.get(i);return n?"subscribed"===s||"subscribing"===s?Promise.resolve():this.checkSubscribe(i,o,e):"unsubscribed"===s||"unsubscribing"===s?Promise.resolve():this.checkUnsubscribe(i,o,e)}checkForReauth(e){if("reauth"===e.getStringOrUndefined("_control")){const t=e.getStringList("_channel_names"),i=[],s=c.J.getPresenceKeys();t.forEach((e=>{const t=this.getTopicKeys(e);void 0!==t?t.forEach((e=>{i.push(this.unsubscribe(e))})):i.push(Promise.resolve())})),i.push(...s.map((e=>this.unsubscribe(e)))),Promise.all(i).then((()=>{t.forEach((e=>{var t;const i=this.getTopicKeys(e);null===(t=this.context)||void 0===t||t.deleteChannel(e),void 0!==i&&i.forEach((e=>{var t;null===(t=this.context)||void 0===t||t.deleteTopic(e)}))})),H.updateAuthorization()})).catch((e=>{e.topics=t,error("Error during re-auth detach",e,"PUSH_")}))}}handleSubscribed(e){this.failedTopics.delete(e),this.activeSubscriptions.add(e),this.callbacks.onSubscribe(this.clientName,e,!0)}handleUnsubscribed(e){this.failedTopics.delete(e),this.activeSubscriptions.delete(e),this.callbacks.onSubscribe(this.clientName,e,!1)}handleTopicFailure(e){const t=this.failedTopics.get(e);this.failedTopics.set(e,void 0===t?1:t+1)}shouldRetrySubscribe(){const e=this.auth.getTopicKeys();for(const[t,i]of this.failedTopics.entries())if(e.includes(t)&&i<this.criticalFailLimit)return!0;return!1}getCriticallyFailedTopics(){return Array.from(this.failedTopics.keys()).filter((e=>{const t=this.failedTopics.get(e);return void 0!==t&&t>this.criticalFailLimit}))}getConnectionType(){return""}getConnectionId(){return""}getClientId(){return""}getConnectionHost(){return""}getConnectionServer(){return""}getConnectionSerial(){return""}getChannelName(e){var t;return null===(t=this.context)||void 0===t?void 0:t.getChannelName(e)}getTopicKeys(e){var t;return null===(t=this.context)||void 0===t?void 0:t.getTopicKeys(e)}getChannelTopicMap(e){var t;return null===(t=this.context)||void 0===t?void 0:t.getChannelTopicMap(e)}addExternalMessage(e,t){const i=`${this.getChannelName(e)}:${t}`;return void 0!==this.messagesInChat.get(i)||(this.messagesInChat.set(i,[]),void 0!==this.seenMessages.get(i))}handleMessageDuplicate(e,t,i){const s=`${e}:${i}`,n=this.seenMessages.get(s);if(void 0===n){if(this.seenMessages.size>this.seenMessagesLimit){const e=Array.from(this.seenMessages.entries());this.seenMessages=new Map(e.splice(Math.floor(-.5*e.length)))}return this.seenMessages.set(s,[this.getDuplicateMessageMeta(t)]),!1}return n.push(this.getDuplicateMessageMeta(t)),0!==n.length&&this.reportDuplicateMessage(e,t,i,n),!0}reportDuplicateMessage(e,t,i,s){const n=this.duplicateMessageAttributes(e,t,i,s);debug("[PushService] Duplicate Message: ",n),(0,r.PF)()&&(0,r.bT)("PushDuplicateMessage",n)}duplicateMessageAttributes(e,t,i,s){var n;const o=s[0],r=null!==(n=t.getParsedSubMap("providerData").getStringOrUndefined("id"))&&void 0!==n?n:"invalid_provider_id",a=this.hashMessage(t.stringMessage),l=t.getStringOrUndefined("_topic");let h={};return 0===Math.floor(400*Math.random())&&(h=t),{tid:i,first_seen_time:o.timestamp,time_since_first_seen:(new Date).getTime()-o.timestamp,num_duplicates:s.length,client:this.clientName,connection_host:this.getConnectionHost(),connection_type:this.getConnectionType(),connection_state:this.getConnectionState(),num_reconnects:this.getReconnectCount(),same_content:a===o.hash,same_pid:r===o.providerId,same_server:o.server===this.hashMessage(this.getConnectionServer()),same_host:o.host===this.hashMessage(this.getConnectionHost()),orig_connection_serial:o.connectionSerial,channel_name:e,pid:r,topic:l,messageData:JSON.stringify(h)}}hashMessage(e){return""===e?"":Array.from(e,(e=>e.charCodeAt(0))).reduce(((e,t)=>e+t)).toString()+e.length.toString()}getDuplicateMessageMeta(e){var t;return{timestamp:(new Date).getTime(),hash:this.hashMessage(e.stringMessage),providerId:null!==(t=e.getParsedSubMap("providerData").getStringOrUndefined("id"))&&void 0!==t?t:"invalid_provider_id",server:this.hashMessage(this.getConnectionServer()),host:this.hashMessage(this.getConnectionHost()),connectionSerial:this.getConnectionSerial()}}checkSubscribe(e,t,i){if(void 0===t)this.subscribedTopicKeysByChannel.set(e,[i]);else if(!t.includes(i))return t.push(i),this.subscribedTopicKeysByChannel.set(e,t),Promise.resolve();return this._subscribe(i).then((()=>{const t=this.getTopicKeys(e);void 0!==t&&t.forEach((e=>{this.handleSubscribed(e)}))}))}checkUnsubscribe(e,t,i){if(void 0!==t&&t.includes(i)){const s=t.indexOf(i);if(t.splice(s,1),this.subscribedTopicKeysByChannel.set(e,t),0!==t.length)return Promise.resolve();this.subscribedTopicKeysByChannel.delete(e)}return this._unsubscribe(i).then((()=>{const t=this.getTopicKeys(e);void 0!==t&&t.forEach((e=>{this.handleUnsubscribed(e)}))}))}}const f="a";class y extends v{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e),this.clientName=f,this.shouldRewind=new Set,this.settings=t,this.connectionChange=new o.c_("AblyClientConnection"),this.shouldAutoDisconnect=!i;try{this.realtime=new Ably.Realtime.Promise(this.getClientOptions())}catch(e){throw P("connect",e.toString())}this.auth=new T(this.realtime);const s=["disconnected","failed","suspended"];this.realtime.connection.on((e=>{if(e.previous!==e.current){var t;const i=u(e.previous),n=u(e.current),o=k("connect",e.reason);(s.includes(n)&&204!==(null===(t=e.reason)||void 0===t?void 0:t.statusCode)||"connected"===n)&&this.connectionChange.fire({previous:i,current:n,reason:o,client:"a"})}})),this.shouldAutoDisconnect||(0,d.wu)((0,h.p0)(),window,(()=>{this.close()}))}getClientOptions(){const e={autoConnect:!1,closeOnUnload:this.shouldAutoDisconnect,log:{level:1},authCallback:(e,t)=>{this.auth.fetchTokenRequest().then((e=>{e.isValid()?(this.context=e,t(void 0,e.getTokenRequest())):t("Invalid token request")})).catch((e=>{t(e.message)}))},restHost:this.settings.restHost,realtimeHost:this.settings.realtimeHost,transportParams:{remainPresentFor:"0"}};return this.settings.fallbackHosts.length>0&&(e.fallbackHosts=this.settings.fallbackHosts),e}_connect(){this.realtime.connect()}close(){this.realtime.close()}getConnectionState(){return u(this.realtime.connection.state)}getChannelState(e){return p(this.realtime.channels.get(e).state)}getConnectionType(){var e,t;return null!==(e=null===(t=this.realtime.connection)||void 0===t||null===(t=t.connectionManager)||void 0===t||null===(t=t.activeProtocol)||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.shortName)&&void 0!==e?e:""}getConnectionId(){return this.realtime.connection.id}getClientId(){var e,t;return null!==(e=null===(t=this.realtime.connection)||void 0===t||null===(t=t.connectionManager)||void 0===t||null===(t=t.connectionDetails)||void 0===t?void 0:t.clientId)&&void 0!==e?e:""}getConnectionHost(){var e,t;return null!==(e=null===(t=this.realtime.connection)||void 0===t||null===(t=t.connectionManager)||void 0===t?void 0:t.host)&&void 0!==e?e:""}getConnectionServer(){var e,t;return null!==(e=null===(t=this.realtime.connection)||void 0===t||null===(t=t.connectionManager)||void 0===t||null===(t=t.connectionDetails)||void 0===t?void 0:t.serverId)&&void 0!==e?e:""}getConnectionSerial(){var e,t;return null!==(e=null===(t=this.realtime.connection)||void 0===t||null===(t=t.connectionManager)||void 0===t?void 0:t.connectionSerial)&&void 0!==e?e:""}getReconnectCount(){return-1}duplicateMessageAttributes(e,t,i,s){var n,o,r,a,l,h;const d=super.duplicateMessageAttributes(e,t,i,s);return d.connection_id=this.getConnectionId(),d.recovery_key=this.realtime.connection.recoveryKey,d.client_id=this.getClientId(),d.server_id=this.getConnectionServer(),d.connection_serial=this.getConnectionSerial(),d.connection_key=null!==(n=null===(o=this.realtime.connection)||void 0===o||null===(o=o.connectionManager)||void 0===o||null===(o=o.connectionDetails)||void 0===o?void 0:o.connectionKey)&&void 0!==n?n:"",d.msg_serial=null!==(r=null===(a=this.realtime.connection)||void 0===a||null===(a=a.connectionManager)||void 0===a?void 0:a.msgSerial)&&void 0!==r?r:"",d.recovery_key=null!==(l=null===(h=this.realtime.connection)||void 0===h?void 0:h.recoveryKey)&&void 0!==l?l:"",d}_subscribe(e){const t=this.getChannelName(e);if(void 0===t)return Promise.reject(P("topic_error","Invalid topic key reached subscribe"));const i=this.realtime.channels.get(t),n=new Promise(((n,o)=>{this.ensureConnectedAndAuthed(e).then((()=>{const t=this.shouldRewind.delete(e);return i.setOptions({cipher:void 0,params:t?{rewind:"30s"}:{},modes:["SUBSCRIBE","PRESENCE"]})})).then((()=>i.attach())).then((()=>(i.unsubscribe(),i.subscribe((e=>{e.data.providerData={id:e.id,ts:e.timestamp};const i=new s.N6(e.data);this.checkForReauth(i);const n=this.getChannelTopicMap(t);let o;if(void 0!==n&&(o=n.get(i.getString("_topic"))),void 0!==o){if(this.handleMessageDuplicate(t,i,i.getString("tid")))return;this.callbacks.onMessage(this.clientName,o,i)}else"o"!==i.getStringOrUndefined("_sm")&&warn("Received message for unknown topic",{topic:i.getString("_topic"),client:this.clientName})}))))).then((()=>{n()})).catch((e=>{"suspended"===i.state&&i.detach().then().catch((()=>{})),o(P("subscribe",e))}))}));return this.topicPromises.set(e,n),n}_unsubscribe(e){const t=this.getChannelName(e);if(void 0===t)return Promise.reject(P("topic_error","Invalid topic key reached unsubscribe"));const i=this.realtime.channels.get(t),s=p(i.state);if(i.unsubscribe(),["unsubscribed","initialized","failed"].includes(s))return Promise.resolve();const n=new Promise(((e,t)=>{i.detach().then((()=>{e()})).catch((e=>{t(P("unsubscribe",e))}))}));return this.topicPromises.set(e,n),n}enterPresence(e,t){let i=this.topicPromises.get(e);if(void 0!==i)return Promise.reject(P("topic_error","Called subscribe while channel is busy"));const s=this.getChannelName(e);if(void 0===s)return Promise.reject(P("topic_error","Unknown topic key"));const n=this.realtime.channels.get(s);return i=new Promise(((i,o)=>{this.ensureConnectedAndAuthed(e).then((()=>n.setOptions({cipher:void 0,params:{},modes:["SUBSCRIBE","PRESENCE"]}))).then((()=>n.attach())).then((()=>{const e=this.auth.getCapabilities()[s];return Array.isArray(e)&&e.includes("presence")?void 0!==t&&t.changed?n.presence.update(t.data):Promise.resolve():Promise.reject(P("presence","Token does not have capability for presence"))})).then((()=>{this.handleSubscribed(e),i()})).catch((t=>{this.topicPromises.delete(e),this.handleTopicFailure(e),o(P("presence",t))}))})),i}leavePresence(e){const t=this.getChannelName(e);return void 0===t?Promise.reject(P("topic_error","Unknown topic key")):this.realtime.channels.get(t).presence.leave().then((()=>{this.handleUnsubscribed(e)})).catch((t=>(this.handleUnsubscribed(e),Promise.reject(P("presence",t)))))}getSubscriptionState(e){const t=this.getChannelName(e);return void 0===t?"unknown":p(this.realtime.channels.get(t).state)}isSubscribedTo(e){return"subscribed"===this.getSubscriptionState(e)}}class b extends g{constructor(e){super(e),this.tokenRequest=e.getObjectOrUndefined("token_request"),this.jwtToken=e.getStringOrUndefined("token"),void 0!==this.jwtToken&&void 0!==this.tokenRequest&&""!==this.jwtToken&&void 0!==this.tokenRequest.keyName||warn("invalid AblyContext",{contextKeys:e.keys().join(","),context:e.stringMessage}),e.ignore("token_request"),e.logUnusedDebugging("AblyContext")}parseSettings(e){return b.parseSettings(e)}static parseSettings(e){const t={backend:f,restHost:e.getStringOrUndefined("rest_host"),realtimeHost:e.getStringOrUndefined("realtime_host"),fallbackHosts:e.getStringList("fallback_hosts"),flags:new Map,verifyEnabled:!1};return m(t.flags,e.getObjectOrUndefined("flags")),t}isValid(){return void 0!==this.tokenRequest}getTokenRequest(){if(void 0===this.jwtToken)throw new Error("Access to AblyContext.tokenRequest on an invalid context!");return this.jwtToken}serialize(){return JSON.stringify(this.tokenRequest)}}var w=i(5216);const C="push_service/auth/";function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=H.getClientName()===e;l.Bm.current.isNoninteractiveUser&&(i=!1);const n=H.getTopicKeysToAuth();n.length>100&&(warn("PushService is attempting to request too many topics",{},"PUSH_"),n.length=100);const o={};n.forEach((e=>{const t=H.getTopicAuthData(e);void 0===t||t.subscribeOnlyOnPrimaryBackend&&!i||(o[t.key]=t.payload)}));const r={presence_id:`${i?"+":"-"}${H.presenceId}`,topics:JSON.stringify(o),backend:e,...t};return(0,w.KF)(C,r).then((e=>{try{const t=new s.N6(e.responseText);return Promise.resolve(t)}catch(e){return Promise.reject(e)}}))}class x{constructor(e){this.tokenDetails=e,this.capability=this.parseCapability(e.getString("x-ably-capability"))}getChannelNames(){return Object.keys(this.capability)}parseCapability(e){const t={},i=JSON.parse(e),s=Object.keys(i);for(const n of s){const s=i[n];s instanceof Array?t[n]=s:error(`Invalid capability type for topic: ${n}`,{capability:e},"PUSH_")}return t}}class T{constructor(e,t){this.consecutiveAuthFails=0,this.realtime=e,this.ablyContext=t}serialize(){var e;return!0!==(null===(e=this.ablyContext)||void 0===e?void 0:e.isValid())?"":this.ablyContext.serialize()}getCapabilities(){const e=this.authToken;return void 0===e?{}:e.capability}fetchTokenRequest(){return new Promise(((e,t)=>{S(f).then((t=>{this.consecutiveAuthFails=0,this.reportFailedTopics(t),this.ablyContext=new b(t),e(this.ablyContext)})).catch((e=>{this.consecutiveAuthFails+=1,t(e)}))}))}reportFailedTopics(e){const t=e.getObjectOrUndefined("failures");"object"==typeof t&&0!==Object.keys(t).length&&(0,r.bT)("PushServiceClient",{action:"token_request_failed_topics",topics:JSON.stringify(t),client:f})}canAccessTopic(e){var t;const i=null===(t=this.ablyContext)||void 0===t?void 0:t.getChannelName(e);return void 0!==i&&void 0!==this.authToken&&this.authToken.getChannelNames().includes(i)}getTopicKeys(){if(void 0===this.authToken)return[];const e=this.authToken.getChannelNames(),t=[];return e.forEach((e=>{var i;const s=null===(i=this.ablyContext)||void 0===i?void 0:i.getTopicKeys(e);void 0!==s&&t.push(...s)})),t}updateAuthToken(){return new Promise(((e,t)=>{this.realtime.auth.authorize().then((t=>{const i=JSON.parse(atob(t.token.split(".")[1]));this.authToken=new x(new s.N6(i)),e()})).catch((e=>{const i=P("auth",e);t(i)}))}))}invalidateAuth(){this.authToken=void 0}}function P(e,t){let i;return i=void 0===t?{code:e,message:"Unknown",providerCode:""}:"string"==typeof t?{code:e,message:t,providerCode:""}:"statusCode"in t?k(e,t):t,i}function k(e,t){const i={code:e,message:"Unknown failure",providerCode:""};return void 0!==t&&(i.message=t.message,i.providerCode=t.code.toString(),void 0!==t.cause&&"code"in t.cause&&(i.cause=t.cause.code)),i}class A extends g{constructor(e){super(e),this.tokenRequest=e.getObject("token_request"),e.logUnusedDebugging("DevContext")}static parseSettings(e){const t={backend:R,flags:new Map,url:e.getStringOrUndefined("url"),verifyEnabled:!1};return m(t.flags,e.getObjectOrUndefined("flags")),t}parseSettings(e){return A.parseSettings(e)}isValid(){return void 0!==this.tokenRequest}getTokenRequest(){if(void 0===this.tokenRequest)throw new Error("Access to tokenRequest on an invalid context!");return this.tokenRequest}serialize(){return JSON.stringify(this.tokenRequest)}}class M{constructor(e,t){this.client=e,this.consecutiveAuthFails=0,this.context=t}serialize(){var e;return!0!==(null===(e=this.context)||void 0===e?void 0:e.isValid())?"":this.context.serialize()}fetchAccessToken(){return this.getRequestToken().then((e=>this.getAccessToken(e)))}getRequestToken(){return new Promise(((e,t)=>{S(R).then((i=>{this.consecutiveAuthFails=0;const s=i.getObjectOrUndefined("failures");if("object"==typeof s&&0!==Object.keys(s).length&&(0,r.bT)("PushServiceClient",{action:"token_request_failed_topics",topics:JSON.stringify(s),client:R}),this.context=new A(i),this.context.isValid()){this.client.context=this.context;const t=this.context.getTokenRequest();e(t)}else t("Invalid token request")})).catch((e=>{this.consecutiveAuthFails+=1,this.consecutiveAuthFails>=3&&debug("Should be closing connection and reverting to ably/wowza"),t(e)}))}))}getAccessToken(e){return new Promise(((t,i)=>{if(void 0===this.context)return void i("no context");const n=new XMLHttpRequest,o=void 0===this.context.settings.url?"":`http://${this.context.settings.url}`;n.open("POST",`${o}/auth/access_token`,!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.onload=()=>{if((0,w.W9)(n.status)){const e=new s.N6(n.responseText);t(e.getString("access_token"))}else i(new w.fr(n))},n.send(JSON.stringify({request_token:e}))}))}canAccessTopic(e){var t;return void 0!==(null===(t=this.context)||void 0===t?void 0:t.getChannelName(e))}getTopicKeys(){return[]}getFailedTopics(){return[]}updateAuthToken(){return this.client.updateAuth()}reportFailedTopics(e){debug("Failed topics on dev service",e.stringMessage)}invalidateAuth(){}}const R="hermod";class I extends v{constructor(e){super(e),this.clientName=R,this.connectionState="unknown",this.connectionChange=new o.c_("HermodClientConnection"),this.auth=new M(this)}close(){var e,t;null===(e=this.websocket)||void 0===e||e.send("send closing message"),null===(t=this.websocket)||void 0===t||t.close()}_connect(){this.auth.fetchAccessToken().then((e=>{var t,i;const n=void 0===(null===(t=this.auth.context)||void 0===t?void 0:t.settings.url)?`${window.location.hostname}:${window.location.port}/hermod`:`${null===(i=this.auth.context)||void 0===i?void 0:i.settings.url}`;this.websocket=new WebSocket(`ws://${n}`),this.websocket.onmessage=e=>{const t=new s.N6(e.data),i=t.getNumber("action"),n=t.getString("channel",!1);switch(i){case 4:this.connectionChange.fire({previous:this.connectionState,current:"connected"}),this.connectionState="connected";break;case 6:this.connectionChange.fire({previous:this.connectionState,current:"disconnected"}),this.connectionState="disconnected";break;case 9:warn("Error on websocket",t,"PUSH_");break;case 11:case 13:break;case 15:const e=t.getList("messages");null==e||e.forEach(((e,i)=>{this.checkForReauth(e);const o=`${t.getString("id")}:${i}`,r=new s.N6({...e.getParsed(),channel:n,providerData:{id:o,ts:t.getNumber("timestamp")}}),a=this.getChannelTopicMap(n);let l;if(void 0!==a&&(l=a.get(r.getString("_topic"))),void 0!==l){if(this.handleMessageDuplicate(n,r,r.getString("tid")))return;this.callbacks.onMessage(this.clientName,l,r)}else"o"!==r.getStringOrUndefined("_sm")&&warn("Received message for unknown topic",{topic:r.getString("_topic"),client:this.clientName})}))}},this.websocket.onopen=()=>{var t;null===(t=this.websocket)||void 0===t||t.send(JSON.stringify({action:3,message:{accessToken:e}}))}})).catch((e=>{error(e)})),this.connectionState="connecting"}updateAuth(){return this.isConnected()?this.auth.fetchAccessToken().then((e=>void 0===this.websocket?Promise.reject("Invalid websocket during update"):(this.websocket.send(JSON.stringify({action:17,message:{accessToken:e}})),Promise.resolve()))).catch((e=>{error(e)})):this.connect()}getConnectionState(){return this.connectionState}getChannelState(e){return"unknown"}getReconnectCount(){return-1}_subscribe(e){const t=this.getChannelName(e);return void 0===t?Promise.reject("invalid channel name reached subscribe"):this.ensureConnectedAndAuthed(e).then((()=>void 0===this.websocket?Promise.reject("websocket undefined"):(this.websocket.send(JSON.stringify({action:10,channelName:t})),Promise.resolve())))}_unsubscribe(e){const t=this.getChannelName(e);return void 0===t?Promise.reject("invalid channel name reached unsubscribe"):this.ensureConnectedAndAuthed(e).then((()=>void 0===this.websocket?Promise.reject("websocket undefined"):(this.websocket.send(JSON.stringify({action:12,channelName:t})),Promise.resolve())))}enterPresence(e,t){const i=this.getChannelName(e);return void 0===i?Promise.reject("invalid channel name"):this.ensureConnectedAndAuthed(e).then((()=>this.subscribe(e))).then((()=>{var e;return void 0===this.websocket?Promise.reject("websocket undefined"):(this.websocket.send(JSON.stringify({action:14,channelName:i,message:null!==(e=null==t?void 0:t.data)&&void 0!==e?e:{}})),Promise.resolve())}))}leavePresence(e){return this.unsubscribe(e)}}const E="p";function L(e,t){return{providerCode:"",code:e,message:null!=t?t:""}}class D extends v{constructor(e,t){super(e),this.clientName=E,this.connectionChange=new o.c_("PusherClientConnection"),this.settings=t,this.auth=new B(this)}close(){void 0!==this.client&&this.client.disconnect(),this.auth.reset(),this.client=void 0}_connect(){const e={cluster:this.settings.cluster,channelAuthorization:{endpoint:C,transport:"ajax",customHandler:(e,t)=>{const i=this.auth.getAuthToken(e.channelName);void 0!==i?t(null,{auth:i,channel_data:this.auth.channelDataString}):t(new Error("Pusher js no auth token"),null)}}};void 0!==this.settings.host&&""!==this.settings.host&&(e.wsHost=`ws.${this.settings.host}`,e.httpHost=`sockjs.${this.settings.host}`),this.client=new Pusher(this.settings.key,e),this.client.connection.bind("state_change",(e=>{"connected"===e.current&&void 0!==this.client&&(void 0!==this.socketId&&this.socketId!==this.client.connection.socket_id&&(this.auth.reset(),this.activeSubscriptions.clear()),this.socketId=this.client.connection.socket_id);const t={current:u(e.current),previous:u(e.previous),client:"p"};this.connectionChange.fire(t)})),Pusher.log=e=>debug(e),this.connect().catch((()=>{}))}getConnectionState(){return void 0===this.client?"disconnected":u(this.client.connection.state)}getChannelState(e){return void 0===this.client?"unknown":void 0===(t=this.client.channel(e))?"uninitialized":t.subscriptionPending?"subscribing":t.subscribed?"subscribed":t.subscriptionCancelled?"failed":"initialized";var t}getReconnectCount(){return-1}_subscribe(e){const t=this.getChannelName(e);if(void 0===t)return Promise.reject(L("topic_error","Invalid topic key reached subscribe"));if(void 0===this.client)return Promise.reject(L("connect","Client not initialized at subscribe"));const i=this.client.subscribe(t),n=new Promise(((n,o)=>{this.ensureConnectedAndAuthed(e).then((()=>{i.unbind_all(),i.bind("notify",(e=>{e.providerData={id:"pusher:id:1",ts:(new Date).getTime()};const i=new s.N6(e);this.checkForReauth(i);const n=this.getChannelTopicMap(t);let o;if(void 0!==n&&(o=n.get(i.getString("_topic"))),void 0!==o){if(this.handleMessageDuplicate(t,i,i.getString("tid")))return;this.callbacks.onMessage(this.clientName,o,i)}else"o"!==i.getStringOrUndefined("_sm")&&warn("Received message for unknown topic",{topic:i.getString("_topic"),client:this.clientName})})),n()})).catch((e=>{i.unbind_all(),i.unsubscribe(),o(L("subscribe",e))}))}));return this.topicPromises.set(e,n),n}_unsubscribe(e){const t=this.getChannelName(e);if(void 0===t)return Promise.reject(L("topic_error","Invalid topic key reached unsubscribe"));if(void 0===this.client)return Promise.reject(L("connect","Client not initialized at unsubscribe"));const i=this.client.channel(t);if(void 0===i)return Promise.resolve();const s=new Promise(((e,s)=>{i.unbind_all(),i.unsubscribe(),this.auth.removeTopicAuth(t),e()}));return this.topicPromises.set(e,s),s}enterPresence(e,t){return this.subscribe(e).then((()=>{const i=this.getChannelName(e);if(void 0===i)return Promise.reject(L("topic_error","Invalid topic key reached enterPresence"));if(void 0===this.client)return Promise.reject(L("connect","Client not initialized at enterPresence"));const s=this.client.channel(i);return void 0===s?Promise.reject(L("topic_error","Invalid channel state after subscribe in enterPresence")):(s.members.me.info=t,Promise.resolve())}))}leavePresence(e){return this.unsubscribe(e)}getConnectionType(){return""}getConnectionId(){let e="";return void 0!==this.client&&(e=this.client.connection.socket_id),e}getClientId(){let e="";return void 0!==this.client&&(e=this.client.sessionID.toString()),e}getConnectionHost(){return this.settings.key}getConnectionServer(){return this.settings.cluster}}class B{constructor(e){this.realtime=e,this.tokens=new Map,this.consecutiveAuthFails=0}serialize(){return JSON.stringify(this.tokens)}getTopicKeys(){const e=Array.from(this.tokens.keys()),t=[];return e.forEach((e=>{var i;const s=null===(i=this.realtime.context)||void 0===i?void 0:i.getTopicKeys(e);void 0!==s&&t.push(...s)})),t}reset(){this.tokens.clear(),this.consecutiveAuthFails=0}removeTopicAuth(e){this.tokens.delete(e)}getAuthToken(e){return this.tokens.get(e)}canAccessTopic(e){var t;return void 0!==(null===(t=this.realtime.context)||void 0===t?void 0:t.getChannelName(e))}updateAuthToken(){return this.realtime.ensureConnected().then((()=>{const e=this.realtime.getConnectionId();return S(E,{socket_id:e}).then((t=>{this.consecutiveAuthFails=0,this.reportFailedTopics(t);const i=t.getParsedSubMap("tokens"),s=t.getObject("tokens");return 0===Object.keys(s).length&&warn("Pusher auth has no tokens",{req_socket_id:e,socket_id:this.realtime.getConnectionId(),authCtx:t.stringMessage}),this.channelDataString=t.getStringOrUndefined("channel_data",!0),Array.from(Object.keys(s)).forEach((e=>{this.tokens.set(e,i.getString(e))})),this.realtime.context=new U(t),Promise.resolve()})).catch((e=>(this.consecutiveAuthFails+=1,this.consecutiveAuthFails>=3&&this.realtime.close(),Promise.reject(e))))}))}reportFailedTopics(e){const t=e.getObjectOrUndefined("failures");"object"==typeof t&&0!==Object.keys(t).length&&(0,r.bT)("PushServiceClient",{action:"token_request_failed_topics",topics:JSON.stringify(t),client:E})}invalidateAuth(){this.tokens.clear()}}class U extends g{constructor(e){super(e),e.logUnusedDebugging("PusherContext")}parseSettings(e){return U.parseSettings(e)}static parseSettings(e){const t={backend:E,flags:new Map,key:e.getString("key"),cluster:e.getString("cluster"),host:e.getStringOrUndefined("host"),verifyEnabled:!1};return m(t.flags,e.getObjectOrUndefined("flags")),t}isValid(){return!0}}class _{constructor(e){this.activeClients=e,this.startTime=(new Date).getTime(),this.messages=new Map,this.timeouts=new Set,this.totalFailures=0,this.connectedClients=[],this.connectionHistory={},this.messageCount={},this.expireTime=9e4,this.lateTime=3e3,this.invalidateClient("w")}verify(e,t,i){if(this.setLastMessage(e,(new Date).getTime()),this.activeClients.includes(e)||this.activeClients.push(e),this.connectedClients.includes(e)||this.connectedClients.push(e),this.activeClients.length<2)return;const s={clientName:e,topicKey:t,tid:i.getString("tid"),messageHash:this.hashMessage(i),initialClients:this.connectedClients};this.doVerify(s)}invalidateClient(e){this.activeClients=this.activeClients.filter((t=>t!==e))}buildMeta(e){return{messageHash:e.messageHash,timestamp:(new Date).getTime(),clients:[e.clientName],initialClients:e.initialClients}}doVerify(e){const t=this.messages.get(e.tid);if(void 0!==t)return this.handleItemMatch(t,e);const i=this.buildMeta(e);this.messages.set(e.tid,i),this.trackTimeout((()=>{this.handleItemNeverArrived(e.tid,i,e.topicKey),this.messages.delete(e.tid)}))}recordFailure(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this.totalFailures+=1;const s={...t,...this.connectionHistory,...this.messageCount,topic:i.split(":")[0],topicKey:i,userid:i.split(":")[1],reason:e,start_time:this.startTime,total_failures:this.totalFailures,room_count:this.roomCount};debug("Push Service clients verifier failure",s),(0,r.PF)()&&(0,r.bT)("PushClientVerifier",s)}handleItemMatch(e,t){if(e.clients.includes(t.clientName))return;e.clients.push(t.clientName);const i=(new Date).getTime()-e.timestamp;i>this.lateTime&&this.handleItemLate(e,t,i),e.messageHash!==t.messageHash&&this.handleItemDiffers(e,t),0===this.activeClients.filter((t=>!e.clients.includes(t))).length&&debug("Push service clients verifier success",e)}handleItemNeverArrived(e,t,i){const s=this.activeClients.filter((e=>!t.clients.includes(e)));s.length>0&&this.recordFailure("never_arrived",{tid:e,first_ts:t.timestamp,first_client:t.clients[0],failedClients:s,initialClients:t.initialClients,connectedClients:this.connectedClients,isConnected:!!this.connectedClients.includes(s[0])},i)}handleItemDiffers(e,t){this.recordFailure("differs",{tid:t.tid,first_ts:e.timestamp,first_client:e.clients[0],failed_client:t.clientName,first_hash:e.messageHash,differ_hash:t.messageHash},t.topicKey)}handleItemLate(e,t,i){this.recordFailure("late",{late:i,tid:t.tid,first_ts:e.timestamp,first_client:e.clients[0],failed_client:t.clientName},t.topicKey)}trackTimeout(e){const t=window.setTimeout((()=>{e(),this.timeouts.delete(t)}),this.expireTime);this.timeouts.add(t)}hashMessage(e){const t=JSON.parse(e.stringMessage);return delete t.providerData,delete t.id,delete t.pub_ts,delete t.ts,delete t.method,delete t.channel,JSON.stringify(t)}recordDisconnect(e){this.connectedClients=this.connectedClients.filter((t=>t!==e))}setLastMessage(e,t){var i;this.connectionHistory[`${e}_time`]=t,this.messageCount[`${e}_messages`]=(null!==(i=this.messageCount[`${e}_messages`])&&void 0!==i?i:0)+1}setRoomCount(e){this.roomCount=e}validateClient(e){this.activeClients.includes(e)||this.activeClients.push(e)}}var F;const N="w";class O{constructor(e){this.clients=new Map,this.resetting=!1,this.counter=0,this.contexts=this.parseContext(e);const t=()=>{this.contexts.forEach((e=>{const i=this.clients.get(e.backend);if(void 0!==i&&i.close(),e.backend===N)return;e.backend===H.clientToVerify&&(e.verifyEnabled=!0);const s=this.initializeClient(e);void 0!==s?(this.clients.set(e.backend,s),s.connectionChange.listen((e=>{this.verifier.recordDisconnect(s.clientName),e.primary=this.isPrimaryClient(s),debug("PushClient connection change",{client:s.clientName,event:e}),["failed","closed","disconnected"].includes(e.current)&&!this.resetting&&e.primary&&(this.invalidateClient(s.clientName),this.counter+=1,this.resetting=!0,window.setTimeout((()=>{t(),H.updateAuthorization(),this.resetting=!1,this.informReconnect(s.clientName,this.getPrimaryClient(),this.counter)}),3e3)),H.connectionChange.fire(e),"connected"===e.current&&(this.lastConnection=Date.now(),H.updateAuthorization(),this.verifier.validateClient(s.clientName))}))):warn("client not initialized",{client:e.backend},"PUSH_")}))};t(),this.verifier=new _(this.contexts.map((e=>e.backend)))}getFlag(e){var t;const i=this.contexts.find((e=>e.backend!==N));return void 0===i&&warn("getting flag without any valid context",{},"PUSH_"),null!==(t=null==i?void 0:i.flags.get(e))&&void 0!==t&&t}setVerified(e){void 0!==e&&this.contexts.forEach((t=>{t.backend===e&&t.flags.set("verify_enabled",!0)}))}isWowzaPrimary(){return this.contexts.length<1||this.contexts[0].backend===N}isPrimaryClient(e){const t=this.contexts.find((e=>e.backend!==N&&!0===e.flags.get("is_live")));return(null==t?void 0:t.backend)===e.clientName}getPrimaryClient(){const e=this.contexts.find((e=>e.backend!==N)),t={contexts:Array.from(this.contexts.keys()),clients_keys:Array.from(this.clients.keys()),clients:Array.from(this.clients.values()).map((e=>e.clientName))};if(void 0!==e)return this.clients.get(e.backend);warn("no valid push service context",t,"PUSH_")}getActiveClients(){return Array.from(this.clients.values()).filter((e=>{const t=this.contexts.find((t=>t.backend===e.clientName));return this.isPrimaryClient(e)||!0===(null==t?void 0:t.verifyEnabled)||!0===(null==t?void 0:t.flags.get("is_live"))}))}updateOrder(e){e.length!==this.contexts.length&&warn("invalid chat backends",{backends:e},"PUSH_"),debug("Changing push service backends",e),this.contexts=this.contexts.filter((t=>e.includes(t.backend))).sort(((t,i)=>e.indexOf(t.backend)-e.indexOf(i.backend)))}initializeClient(e){const t=e=>{var t;return(null===(t=this.contexts.find((e=>e.backend!==N)))||void 0===t?void 0:t.backend)===e},i={onMessage:(e,i,s)=>{this.verifier.verify(e,i,s),t(e)&&c.J.fireMessage(i,s)},onSubscribe:(e,i,s)=>{t(e)&&c.J.fireSubscribeChange(i,{subscribed:s,isCriticalFail:!1})}};try{switch(e.backend){case f:return new y(i,e,H.isBroadcaster);case E:return new D(i,e);case R:return new I(i)}}catch(t){H.getClientName()===e.backend&&H.primaryClientFailure.fire("client failure"),error("An exception was thrown during client construction",t,"PUSH_")}}parseContext(e){const t={backend:N,flags:new Map,verifyEnabled:!1},i=[];for(const s of e)switch(s.getStringOrUndefined("backend")){case f:i.push(b.parseSettings(s));break;case R:i.push(A.parseSettings(s));break;case E:i.push(U.parseSettings(s));break;case N:i.push(t);break;default:warn("unrecognized backend during parseContext",{failed_context:s},"PUSH_")}return 1===i.length&&!0!==i[0].flags.get("is_live")&&(warn("first context is not is_live",{context:i[0]},"PUSH_"),i[0].flags.set("is_live",!0)),i}invalidateClient(e){for(const[e,t]of this.clients)t.close();this.orderLast(e);let t=0;for(;!0!==this.contexts[0].flags.get("is_live")&&t<3;)this.orderLast(this.contexts[0].backend),t+=1}orderLast(e){this.updateOrder(this.contexts.map((e=>e.backend)).filter((t=>t!==e)).concat([e]))}setVerifierRoomCount(e){this.verifier.setRoomCount(e)}informReconnect(e,t,i){window.setTimeout((()=>{const s={failedClient:e,lastConnection:this.lastConnection,newClient:null==t?void 0:t.clientName,success:null==t?void 0:t.isConnected(),connectionAttempt:i};(0,r.bT)("PushServiceReconnect",s)}),3e3)}}class H{static initialize(e){var t;const i=new s.N6(e);H.servicesContext=i.getList("push_services"),H.presenceId=null!==(t=i.getStringOrUndefined("presence_id"))&&void 0!==t?t:H.presenceId,H.clientToVerify=i.getStringOrUndefined("push_service_verify"),void 0!==H.servicesContext?(H.isBroadcaster=void 0!==i.getAny("broadcastDossier"),H.clientManager=new O(H.servicesContext),H.clientManager.setVerified(H.clientToVerify)):error("PushService parseContext failed",{context_keys:i.keys()},"PUSH_")}static isConnected(){const e=H.getClient();return void 0!==e&&e.isConnected()}static isEnabledForVerify(){return H.isEnabledForUI()||void 0!==l.Bm.current.loggedInUser}static isEnabledForUI(){return void 0!==H.clientManager&&!H.clientManager.isWowzaPrimary()}static isEnabledForUserList(){return H.isConnected()}static changeChatHandler(e){void 0!==H.clientManager?H.clientManager.updateOrder(e):error("attempting to change backends on not ready push service",{backends:e},"PUSH_")}static updateAuthorization(){H.updateAuthThrottler.callFunc()}static forceUpdateAuthorization(){var e,t;(null!==(e=null===(t=H.clientManager)||void 0===t?void 0:t.getActiveClients())&&void 0!==e?e:[]).forEach((e=>{e.auth.invalidateAuth()})),this.updateAuthorization()}static _updateAuthorizationAndSubscriptions(){var e,t;const i=null!==(e=null===(t=H.clientManager)||void 0===t?void 0:t.getActiveClients())&&void 0!==e?e:[];if(i.length<1)return void c.J.getTopicKeys().forEach((e=>{c.J.fireSubscribeChange(e,{subscribed:!1,isCriticalFail:!0})}));H.authId+=1;const s=H.authId;window.clearTimeout(H.pushReconnectTimeout);const n=H.getTopicKeysToAuth(),o=(new Date).getTime();i.forEach((e=>{const t=H.isPrimaryClient(e);e.getAuthPromise(n).then((()=>{if(H.pushReconnectTimer=5e3,s<H.authId)return;var i;t&&(null===(i=e.context)||void 0===i||i.getFailedTopics().forEach((e=>c.J.fireAuthFail(e))));let n=!1;const a=e.connectionChange.listen((e=>{"closed"!==e.current&&"disconnected"!==e.current||(n=!0)}),!1),l=(new Date).getTime();H.subscribeToEligibleTopics(e).then((i=>{const h=(new Date).getTime();if(a.removeListener(),s<H.authId)return;const d=i.filter((e=>"fulfilled"===e.status)).length,u=e.auth.getTopicKeys().filter((t=>!e.isSubscribedTo(t)));if((0,r.bT)("PushServiceTopicSetup",{client:e.clientName,all_topics_success:0===u.length,topics_requested_count:i.length,successful_topic_count:d,failed_topic_list:u.toSorted().toString(),is_push_connected:H.isConnected(),elapsed_time:h-l,elapsed_time_auth:h-o}),e.shouldRetrySubscribe()&&!n&&(H.pushReconnectTimeout=window.setTimeout((()=>{H.updateAuthorization()}),1e4)),t){const t=e.getCriticallyFailedTopics();u.forEach((e=>{c.J.fireSubscribeChange(e,{subscribed:!1,isCriticalFail:n||t.includes(e),retryCallback:n?void 0:()=>{H.updateAuthorization()}})}))}})).catch((()=>{}))})).catch((i=>{var o,r;s<H.authId||t&&(H.primaryClientFailure.fire("auth failure"),H.pushReconnectTimeout=window.setTimeout((()=>{H.updateAuthorization()}),H.pushReconnectTimer),H.pushReconnectTimer*=2,n.filter((e=>!H.isListeningFor(e))).forEach((e=>{c.J.fireAuthFail(e)})),i.message.includes("access denied")||e.addPageAction("auth_failure",{client_id:e.getClientId(),user_uid:null!==(o=null===(r=l.Bm.current.loggedInUser)||void 0===r?void 0:r.userUid)&&void 0!==o?o:"anon",message:i.message,provider_status:i.providerCode,cause:i.cause,code:i.code}))}))}))}static getTopicKeysToAuth(){return c.J.getTopicKeys().concat(c.J.getPendingTopics())}static getTopicAuthData(e){const t=c.J.getTopicAuthData(e);return void 0===t&&warn("undefined topic data",{topic:e},"PUSH_"),t}static getClient(){var e;const t=null===(e=H.clientManager)||void 0===e?void 0:e.getPrimaryClient();return void 0===t&&error("No valid push service client",{},"PUSH_"),t}static listenFor(e,t){return e.isSubscribedTo(t)?Promise.resolve():e.subscribe(t).catch((i=>{e.addPageAction("subscribe_failure",{is_primary:H.isPrimaryClient(e),topic:t,auth:e.auth.serialize(),code:i.code,message:i.message,providerCode:i.providerCode})}))}static stopListeningFor(e){var t,i;const s=null!==(t=null===(i=H.clientManager)||void 0===i?void 0:i.getActiveClients())&&void 0!==t?t:[];if(s.length<1)return Promise.reject("PushService client is not initialized");const n=s.map((t=>{const i=H.isPrimaryClient(t),s=t.unsubscribe(e).catch((s=>{t.addPageAction("unsubscribe_failure",{is_primary:i,topic:e,auth:t.auth.serialize(),code:s.code,message:s.message,providerCode:s.providerCode})}));return i?s:void 0})).find((e=>void 0!==e));return null!=n?n:Promise.reject("Primary client lost during unsubscribe")}static isListeningFor(e){const t=H.getClient();return void 0!==t&&t.isSubscribedTo(e)}static subscribeToEligibleTopics(e){const t=c.J.getTopicKeys().filter((t=>(c.J.hasPresence(t)||!e.isSubscribedTo(t))&&e.auth.canAccessTopic(t))).map((t=>{const i=c.J.getPresence(t);return void 0!==i?e.enterPresence(t,i):H.listenFor(e,t)}));return Promise.all((0,a.rO)(t))}static close(){var e,t;(null!==(e=null===(t=H.clientManager)||void 0===t?void 0:t.getActiveClients())&&void 0!==e?e:[]).forEach((e=>e.close())),void 0!==H.servicesContext&&(H.clientManager=new O(H.servicesContext))}static addExternalMessage(e,t){var i,s;const n=null!==(i=null===(s=H.clientManager)||void 0===s?void 0:s.getActiveClients())&&void 0!==i?i:[];let o=!1;for(const i of n)i.addExternalMessage(e,t)&&H.isPrimaryClient(i)&&(o=!0);return o}static getConnectionType(){const e=H.getClient();return void 0===e?"not_connected":e.getConnectionType()}static getConnectionId(){const e=H.getClient();return void 0===e?"":e.getConnectionId()}static isPrimaryClient(e){return void 0!==H.clientManager&&H.clientManager.isPrimaryClient(e)}static setVerifierRoomCount(e){var t;null===(t=H.clientManager)||void 0===t||t.setVerifierRoomCount(e)}static getClientName(){var e,t;return null!==(e=null===(t=H.getClient())||void 0===t?void 0:t.clientName)&&void 0!==e?e:""}}(F=H).pushReconnectTimer=5e3,F.isBroadcaster=!1,F.connectionChange=new o.c_("PushServiceClientConnection"),F.primaryClientFailure=new o.c_("PushServicePrimaryClientFailure"),F.updateAuthThrottler=new n.a((()=>{F._updateAuthorizationAndSubscriptions()}),{bounceLimitMS:800,debounceType:1}),F.presenceId=Math.random().toString(36).substring(2),F.authId=0},2823:(e,t,i)=>{"use strict";i.d(t,{K:()=>a,v:()=>r});var s=i(8423),n=i(5914),o=i(4516);function r(e){e.providerData={id:"",ts:0},e.pub_ts=0,e.method="UI"}class a{constructor(e){this.subscribeOnlyOnPrimaryBackend=!1,this.maxListeners=50,this.routerOptions={listenersWarningThreshold:5,onListenerAdded:()=>{this.onListenerAdded()},onListenerRemoved:()=>{this.onListenerRemoved()}},this.initData(e),this.authData=e,this.onMessage=new s.c_(this.getKey(),this.routerOptions),this.onAuthFail=new s.c_("TopicAuthFail",this.routerOptions),this.onSubscribeChange=new s.c_("TopicSubscribeChange",this.routerOptions)}getAuthKey(){return`${this.getId()}#${this.getKey()}`}parseData(e){return{tid:e.getString("tid"),providerId:e.getParsedSubMap("providerData").getString("id"),publishMethod:e.getString("method")}}isSubscribed(){return n.U.isListeningFor(this.getKey())}enterPresence(e){o.J.enterPresence(this,e)}leavePresence(){o.J.leavePresence(this)}getAuthData(){return this.authData}onListenerAdded(){1===this.onMessage.listenerCount()+this.onSubscribeChange.listenerCount()+this.onAuthFail.listenerCount()&&o.J.registerTopic(this)}onListenerRemoved(){0===this.onMessage.listenerCount()+this.onSubscribeChange.listenerCount()+this.onAuthFail.listenerCount()&&o.J.removeTopic(this)}uidCheck(e){if(7!==e.length&&14!==e.length)throw new Error("Invalid uid passed into topic")}}},8650:(e,t,i)=>{"use strict";i.d(t,{JS:()=>h,TP:()=>d,UT:()=>o,ZT:()=>l,bu:()=>a,qN:()=>r});var s=i(438),n=i(7477);class o extends n.PT{getId(){return"RoomModeratorNoticeTopic"}parseData(e){return{...super.parseData(e),...(0,s.rI)(e),toGroup:"red",toUser:void 0,ts:Math.floor(1e3*e.getNumber("ts"))}}}class r extends n.PT{getId(){return"RoomFanClubTopic"}parseData(e){return{...super.parseData(e),...(0,s.rI)(e),toGroup:"green",toUser:void 0,ts:Math.floor(1e3*e.getNumber("ts"))}}}class a extends n.PT{getId(){return"RoomLightPurpleTopic"}parseData(e){return{...super.parseData(e),...(0,s.rI)(e),toGroup:"lightpurple",toUser:void 0,ts:Math.floor(1e3*e.getNumber("ts"))}}}class l extends n.PT{getId(){return"RoomDarkPurpleTopic"}parseData(e){return{...super.parseData(e),...(0,s.rI)(e),toGroup:"darkpurple",toUser:void 0,ts:Math.floor(1e3*e.getNumber("ts"))}}}class h extends n.PT{getId(){return"RoomDarkBlueTopic"}parseData(e){return{...super.parseData(e),...(0,s.rI)(e),toGroup:"darkblue",toUser:void 0,ts:Math.floor(1e3*e.getNumber("ts"))}}}class d extends n.PT{getId(){return"RoomLightBlueTopic"}parseData(e){return{...super.parseData(e),...(0,s.rI)(e),toGroup:"lightblue",toUser:void 0,ts:Math.floor(1e3*e.getNumber("ts"))}}}},8300:(e,t,i)=>{"use strict";i.d(t,{QD:()=>r,ZW:()=>h,fn:()=>a,hw:()=>l});var s=i(438),n=i(2823);class o extends n.K{constructor(e,t){if(super({broadcaster_uid:e,show_id:t}),0===e.length)throw new Error("room uid cannot be empty");if(0===t.length)throw new Error("show ID cannot be empty")}getKey(){return`${this.getId()}:${this.roomUid}:${this.showId}`}initData(e){this.roomUid=e.broadcaster_uid,this.showId=e.show_id}}class r extends o{constructor(){super(...arguments),this.maxListeners=1}getId(){return"PrivateRoomUserPresenceTopic"}}class a extends o{getId(){return"PrivateRoomMessageTopic"}parseData(e){return{...super.parseData(e),...(0,s.YE)(e),ts:Math.floor(1e3*e.getNumber("ts"))}}}class l extends o{getId(){return"PrivateRoomTipAlertTopic"}parseData(e){return{...super.parseData(e),fromUser:(0,s.Rh)(e),message:e.getString("message",!1),amount:e.getNumber("amount"),isAnonymousTip:e.getBoolean("is_anonymous_tip"),toUsername:e.getString("to_username"),ts:Math.floor(1e3*e.getNumber("ts")),roomType:"private"}}}class h extends o{getId(){return"PrivateRoomEnterLeaveTopic"}parseData(e){return{...super.parseData(e),user:(0,s.by)(e.getParsedSubMap("user")),action:e.getString("action"),viewers:e.getNumber("count"),connections:e.getNumber("num_connections")}}}},7477:(e,t,i)=>{"use strict";i.d(t,{BP:()=>N,C9:()=>R,EJ:()=>T,Fh:()=>m,H1:()=>A,HW:()=>w,IJ:()=>b,Io:()=>M,KU:()=>k,Mt:()=>y,PT:()=>l,Q4:()=>L,Tp:()=>x,Uv:()=>u,WQ:()=>P,bq:()=>v,dq:()=>F,eB:()=>I,fH:()=>E,iS:()=>_,iX:()=>p,n1:()=>D,pr:()=>U,rr:()=>f,sL:()=>S,t1:()=>d,uB:()=>g,ug:()=>C,vE:()=>c,yv:()=>B});var s=i(4936),n=i(438),o=i(8255),r=i(8863),a=i(2823);class l extends a.K{constructor(e){super({broadcaster_uid:e}),this.uidCheck(this.roomUid)}initData(e){this.roomUid=e.broadcaster_uid}getKey(){return`${this.getId()}:${this.roomUid}`}}class h extends a.K{constructor(e,t){super({broadcaster_uid:e,user_uid:t}),this.uidCheck(this.roomUid),this.uidCheck(this.userUid)}getKey(){return`${this.getId()}:${this.roomUid}:${this.userUid}`}initData(e){this.roomUid=e.broadcaster_uid,this.userUid=e.user_uid}}class d extends l{constructor(){super(...arguments),this.maxListeners=1}getId(){return"PrivilegedSessionTopic"}}class c extends h{constructor(){super(...arguments),this.maxListeners=1}getId(){return"RoomUserPresenceTopic"}}class u extends l{constructor(){super(...arguments),this.subscribeOnlyOnPrimaryBackend=!0}getId(){return"RoomAnonPresenceTopic"}}class p extends l{constructor(){super(...arguments),this.maxListeners=1}getId(){return"RoomPasswordProtectedTopic"}parseData(e){return{...super.parseData(e),passwordHash:e.getString("hash")}}}class m extends l{getId(){return"RoomTitleChangeTopic"}parseData(e){return{...super.parseData(e),title:e.getString("title")}}}class g extends l{getId(){return"RoomTipAlertTopic"}parseData(e){return{...super.parseData(e),fromUser:(0,n.Rh)(e),message:e.getString("message"),amount:e.getNumber("amount"),isAnonymousTip:e.getBoolean("is_anonymous_tip"),toUsername:e.getString("to_username"),ts:Math.floor(1e3*e.getNumber("ts")),roomType:"public"}}}class v extends l{getId(){return"RoomStatusTopic"}parseData(e){return{...super.parseData(e),status:(0,o.PZ)(e.getString("status")),message:e.getString("message"),substatus:e.getStringOrUndefined("substatus")}}}class f extends h{getId(){return"RoomUserHiddenCamStatusTopic"}parseData(e){return{...super.parseData(e),status:e.getString("status")}}}class y extends l{getId(){return"RoomMessageTopic"}parseData(e){return{...super.parseData(e),...(0,n.YE)(e),ts:Math.floor(1e3*e.getNumber("ts"))}}}class b extends l{getId(){return"RoomSilenceTopic"}parseData(e){return{...super.parseData(e),username:e.getString("username"),fromUser:e.getString("from_username")}}}class w extends l{getId(){return"RoomKickTopic"}parseData(e){return{...super.parseData(e),username:e.getString("username"),fromUser:"Unknown"}}}class C extends l{getId(){return"RoomModeratorPromotedTopic"}parseData(e){return{...super.parseData(e),username:e.getString("username"),fromUser:e.getString("from_username")}}}class S extends l{getId(){return"RoomModeratorRevokedTopic"}parseData(e){return{...super.parseData(e),username:e.getString("username"),fromUser:e.getString("from_username")}}}class x extends l{getId(){return"RoomNoticeTopic"}parseData(e){return{...super.parseData(e),...(0,n.rI)(e),ts:Math.floor(1e3*e.getNumber("ts")),toGroup:void 0,toUser:void 0}}}class T extends h{getId(){return"RoomUserNoticeTopic"}parseData(e){return{...super.parseData(e),...(0,n.rI)(e),ts:Math.floor(1e3*e.getNumber("ts")),toGroup:void 0,toUser:this.userUid}}}class P extends l{getId(){return"RoomAppLogTopic"}parseData(e){return{...super.parseData(e),...(0,n.tV)(e)}}}class k extends l{getId(){return"RoomPurchaseTopic"}parseData(e){return{...super.parseData(e),fromUser:(0,n.by)(e.getParsedSubMap("user")),message:e.getString("message"),ts:Math.floor(1e3*e.getNumber("ts"))}}}class A extends l{getId(){return"RoomFanClubJoinedTopic"}parseData(e){return{...super.parseData(e),fromUser:(0,n.by)(e.getParsedSubMap("user")),message:e.getString("message"),ts:Math.floor(1e3*e.getNumber("ts"))}}}class M extends l{getId(){return"RoomSettingsTopic"}parseData(e){var t,i;return{...super.parseData(e),allowPrivateShow:e.getBoolean("allow_private_shows"),privatePrice:e.getNumber("private_show_tokens_per_minute"),spyPrice:e.getNumber("spy_on_private_show_tokens_per_minute"),privateMinMinutes:e.getNumber("private_min_minutes"),allowShowRecordings:e.getBoolean("allow_show_recordings"),hasFanClub:e.getBoolean("has_fan_club"),activePassword:e.getBoolean("active_password"),fanClubSpyPrice:e.getNumberOrUndefined("fan_club_spy_on_private_show_tokens_per_minute"),premiumPrivatePrice:null!==(t=e.getNumberOrUndefined("premium_private_show_tokens_per_minute"))&&void 0!==t?t:0,premiumPrivateMinMinutes:null!==(i=e.getNumberOrUndefined("premium_private_show_minimum_minutes"))&&void 0!==i?i:0}}}class R extends l{getId(){return"RoomEnterLeaveTopic"}parseData(e){return{...super.parseData(e),user:(0,n.by)(e.getParsedSubMap("user")),action:e.getString("action"),viewers:e.getNumber("count"),connections:e.getNumber("num_connections")}}}class I extends l{getId(){return"RoomPrivilegedEnterTopic"}parseData(e){var t;const i={...e.getObject("user"),source_name:e.getStringOrUndefined("source"),exploringHashTag:null!==(t=e.getStringOrUndefined("exploring_hash"))&&void 0!==t?t:""};return{...super.parseData(e),action:"enter",user:(0,n.by)(new s.N6(i)),connections:e.getNumber("num_connections"),viewers:e.getNumber("count")}}}class E extends l{getId(){return"RoomPrivilegedLeaveTopic"}parseData(e){return{...super.parseData(e),action:"leave",user:(0,n.by)(e.getParsedSubMap("user")),viewers:e.getNumber("count"),connections:e.getNumber("num_connections")}}}class L extends l{getId(){return"RoomUpdateTopic"}parseData(e){const t={...super.parseData(e),target:e.getString("target"),appId:e.getStringOrUndefined("app_id",!1),appSystem:e.getStringOrUndefined("app_system",!1)},i=e.getString("target_user");return""!==i&&(t.targetUser=i),t}}class D extends h{getId(){return"RoomUserPrivateStatusTopic"}parseData(e){var t;return{...super.parseData(e),status:e.getString("status"),privateShowId:e.getStringWithNumbers("show_id"),isPremium:null!==(t=e.getBooleanOrUndefined("premium"))&&void 0!==t&&t,reason:e.getStringOrUndefined("reason")}}}class B extends l{getId(){return"QualityUpdateTopic"}parseData(e){return{...super.parseData(e),quality:e.getString("quality"),rate:e.getNumber("rate"),stopped:e.getBoolean("stopped")}}}class U extends l{getId(){return"LatencyUpdateTopic"}parseData(e){return{...super.parseData(e),localTimeTranscoderInput:e.getNumberOrUndefined("local_time_transcoder_input"),streamTimeTranscoderInput:e.getNumberOrUndefined("stream_time_transcoder_input"),localTimeSegmentStart:e.getNumberOrUndefined("local_time_segment_start"),streamTimeSegmentStart:e.getNumberOrUndefined("stream_time_segment_start")}}}class _ extends l{getId(){return"RoomShortcodeTopic"}parseData(e){var t;const i=null!==(t=e.getList("shortcodes"))&&void 0!==t?t:[];return{...super.parseData(e),...(0,n.YE)(e),ts:Math.floor(1e3*e.getNumber("ts")),shortcodes:(0,n.U3)(i)}}}class F extends l{getId(){return"GameUpdateTopic"}parseData(e){return{...super.parseData(e),game:r.F.parseSelection(e.getObjectStringOrUndefined("game"))}}}class N extends l{getId(){return"ViewerPromotionTopic"}parseData(e){return{...super.parseData(e),purchaser:(0,n.Rh)(e.getParsedSubMap("purchaser")),durationMins:e.getNumber("duration_mins")}}}},4516:(e,t,i)=>{"use strict";i.d(t,{J:()=>o});var s,n=i(5914);class o{static fireMessage(e,t){const i=o.topics.get(e);if(void 0===i){if(o.missingTopics.has(e))return;o.missingTopics.add(e);const t={topicKey:e,client:n.U.getClientName()};void 0!==e&&e.includes(":")&&(t.topic=e.split(":")[0],t.userId=e.split(":")[1],t.subscribedTopics=o.getTopicKeys().toSorted().toString());const i=o.unsubscribedTracker.get(e);return void 0!==i&&(t.timeSinceListen=(new Date).getTime()-i.getTime()),void warn("calling fireMessage with no topics in TopicManager",t,"PUSH_")}i.forEach((e=>{e.onMessage.fire(e.parseData(t))})),t.logUnusedDebugging(e)}static fireMessageDirect(e,t){const i=o.topics.get(e.getKey());void 0!==i?i.forEach((e=>{e.onMessage.fire(t)})):warn("calling fireMessageDirect with no topics in TopicManager",{topicKey:e.getKey(),client:n.U.getClientName()},"PUSH_")}static fireSubscribeChange(e,t){var i;null===(i=o.topics.get(e))||void 0===i||i.forEach((e=>{e.onSubscribeChange.fire(t)}))}static fireAuthFail(e){var t;null===(t=o.topics.get(e))||void 0===t||t.forEach((e=>{e.onAuthFail.fire(void 0)}))}static registerTopic(e){let t=o.topics.get(e.getKey());void 0===t?t=[e]:(t.length>e.maxListeners&&warn("Too many instances of topic created",{topic:e.getKey(),num_listeners:t.length},"PUSH_"),t.push(e)),o.topics.set(e.getKey(),t),n.U.updateAuthorization()}static removeTopic(e){const t=o.topics.get(e.getKey());if(void 0!==t){const i=t.indexOf(e);if(t.splice(i,1),t.length<1){if(o.topics.delete(e.getKey()),o.pending.set(e.getKey(),e),o.unsubscribedTracker.size>o.unsubscribedLimit){const e=Array.from(o.unsubscribedTracker.entries());o.unsubscribedTracker=new Map(e.splice(0,o.unsubscribedLimit/2))}o.unsubscribedTracker.set(e.getKey(),new Date),n.U.stopListeningFor(e.getKey()).then((()=>{o.pending.delete(e.getKey())})).catch((()=>{}))}else o.topics.set(e.getKey(),t)}}static getTopicKeys(){const e=Array.from(o.presence.keys()),t=e=>e.onMessage.listenerCount()>0||e.onSubscribeChange.listenerCount()>0;return o.topics.forEach(((i,s)=>{i.some(t)&&e.push(s)})),e}static getPresenceKeys(){return Array.from(o.presence.keys())}static getPendingTopics(){return Array.from(o.pending.keys())}static hasPresence(e){return o.presence.has(e)}static getPresence(e){return o.presence.get(e)}static getTopic(e){const t=o.presence.get(e);if(void 0!==t)return t.topic;const i=o.pending.get(e);if(void 0!==i)return i;const s=o.topics.get(e);return void 0!==s&&0!==s.length?s[0]:void 0}static getTopicAuthData(e){const t=o.getTopic(e);if(void 0!==t)return{key:t.getAuthKey(),payload:t.getAuthData(),subscribeOnlyOnPrimaryBackend:t.subscribeOnlyOnPrimaryBackend}}static enterPresence(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.presence.set(e.getKey(),{changed:!0,data:t,topic:e}),n.U.updateAuthorization()}static leavePresence(e){const t=e.getKey();o.presence.has(t)&&(o.presence.delete(t),o.pending.set(t,e),n.U.stopListeningFor(e.getKey()).then((()=>{o.pending.delete(t)})).catch((()=>{})))}}(s=o).topics=new Map,s.presence=new Map,s.pending=new Map,s.missingTopics=new Set,s.unsubscribedTracker=new Map,s.unsubscribedLimit=100},897:(e,t,i)=>{"use strict";i.d(t,{DL:()=>S,HD:()=>h,HJ:()=>v,IX:()=>L,Jf:()=>I,KD:()=>b,LS:()=>k,O$:()=>c,O_:()=>A,Oh:()=>w,T_:()=>E,Tg:()=>u,Vg:()=>T,Vu:()=>C,aT:()=>m,bb:()=>g,cc:()=>x,cu:()=>f,eR:()=>P,gV:()=>M,mt:()=>y,nH:()=>p,vc:()=>D,vs:()=>R,y8:()=>d});var s=i(438),n=i(8423),o=i(5901),r=i(2823);class a extends r.K{constructor(e){super({user_uid:e}),this.uidCheck(this.userUid)}getKey(){return`${this.getId()}:${this.userUid}`}initData(e){this.userUid=e.user_uid}}class l extends a{parseData(e){return{...super.parseData(e),timestamp:e.getNumber("read_ts")}}}class h extends l{getId(){return"UserNewsSeenTopic"}}class d extends a{getId(){return"UserMessageTopic"}parseData(e){return{...super.parseData(e),room:e.getString("room"),createdAt:new Date(Math.floor(1e3*e.getNumber("ts"))),fromUser:(0,s.Rh)(e.getParsedSubMap("from_user")),message:e.getString("message"),textColor:e.getStringOrUndefined("font_color",!1),messageID:e.getString("id",!1),otherUsername:e.getString("other_user"),font:e.getString("font_family"),backgroundColor:e.getStringOrUndefined("background"),mediaList:(0,s.ew)(e.getObjectOrUndefined("media")),isPrivate:!0}}}class c extends a{getId(){return"UserUpdateTopic"}parseData(e){return{...super.parseData(e),target:e.getString("target")}}}class u extends a{getId(){return"UserColorUpdateTopic"}parseData(e){return{...super.parseData(e),hasTokens:e.getBoolean("has_tokens"),tippedRecently:e.getBoolean("tipped_recently"),tippedAlotRecently:e.getBoolean("tipped_alot_recently"),tippedTonsRecently:e.getBoolean("tipped_tons_recently")}}}class p extends a{getId(){return"UserTokenUpdateTopic"}parseData(e){return{...super.parseData(e),tokens:e.getNumber("tokens")}}}class m extends a{getId(){return"UserTipAlertTopic"}parseData(e){return{...super.parseData(e),fromUser:(0,s.Rh)(e),message:e.getString("message"),amount:e.getNumber("amount"),isAnonymousTip:e.getBoolean("is_anonymous_tip"),toUsername:e.getString("to_username"),ts:Math.floor(1e3*e.getNumber("ts")),roomType:e.getString("room_type")}}}class g extends a{getId(){return"UserOneClickTopic"}parseData(e){return{...super.parseData(e),is_one_click_eligible:e.getBoolean("is_one_click_eligible")}}}class v extends a{getId(){return"OfflineTipNotificationTopic"}parseData(e){return{...super.parseData(e),...(0,s.Lf)(e)}}}class f extends a{getId(){return"UpdateOfflineTipNotificationTopic"}parseData(e){return{...super.parseData(e),...(0,s.Lf)(e),fromUsername:e.getString("from_username")}}}class y extends a{getId(){return"RoomBroadcasterPrivateStatusTopic"}parseData(e){var t,i;return{...super.parseData(e),status:e.getString("status"),privateShowId:e.getStringWithNumbers("show_id"),requester:e.getString("requester",!1),earlyCancelTokens:e.getNumber("early_cancel_tokens"),reason:e.getStringOrUndefined("reason"),isPremium:null!==(t=e.getBooleanOrUndefined("premium"))&&void 0!==t&&t,delayFiringEvent:null!==(i=e.getBooleanOrUndefined("delay_firing_event"))&&void 0!==i&&i}}getAuthData(){return{broadcaster_uid:this.userUid}}}const b=new n.c_("showMyCamStarted"),w=new n.c_("showMyCamStopped"),C=new n.c_("showMyCamViewStarted"),S=new n.c_("showMyCamViewStopped");class x extends a{getId(){return"UserSMCBroadcastNotifyTopic"}parseData(e){return{...super.parseData(e),...(0,o.p8)(e),started:e.getBoolean("started")}}}class T extends a{getId(){return"UserSMCWatchingTopic"}parseData(e){return{...super.parseData(e),...(0,o.p8)(e),started:e.getBoolean("started")}}}class P extends a{getId(){return"SMCPresenceTopic"}parseData(e){return super.parseData(e)}getUserUid(){return this.userUid}}class k extends a{getId(){return"UserAlertTopic"}parseData(e){return{...super.parseData(e),message:e.getString("message")}}}class A extends a{getId(){return"BroadcasterWarningTopic"}parseData(e){return{...super.parseData(e),text:e.getString("text"),warningId:e.getNumber("warning_id"),response:e.getBoolean("response")}}}class M extends a{getId(){return"UserChatMediaOpenedTopic"}parseData(e){return{...super.parseData(e),mediaId:e.getNumber("media_id"),messageId:e.getString("message_id")}}}class R extends a{getId(){return"UserChatMediaRemovedTopic"}parseData(e){return{...super.parseData(e),mediaId:e.getNumber("media_id"),isCompliance:e.getBoolean("is_compliance")}}}class I extends a{getId(){return"UserFollowerTopic"}parseData(e){return{...super.parseData(e),followerUsername:e.getString("follower_username"),followedUsername:e.getString("followed_username"),isFollowing:e.getBoolean("is_following")}}}class E extends a{getId(){return"UserIgnoreTopic"}parseData(e){return{...super.parseData(e),username:e.getString("username"),isIgnored:e.getBoolean("is_ignored")}}}class L extends a{getId(){return"UserPmReadTopic"}parseData(e){return{...super.parseData(e),otherUsername:e.getString("other_username"),room:e.getStringOrUndefined("room")}}}class D extends a{getId(){return"UserJoinedFanClubTopic"}parseData(e){return{...super.parseData(e),fromUser:(0,s.by)(e.getParsedSubMap("user")),message:e.getString("message"),ts:Math.floor(1e3*e.getNumber("ts"))}}}},7321:(e,t,i)=>{"use strict";i.d(t,{$r:()=>E,Cx:()=>I,DL:()=>L,HA:()=>x,Hy:()=>D,Qd:()=>f,T1:()=>B,Ys:()=>b,s:()=>S,sl:()=>C,tF:()=>P,yK:()=>y});var s=i(6624),n=i(8861),o=i(5216),r=i(9060),a=i(3062),l=i(7882),h=i(7407),d=i(1452),c=i(5088),u=i(9930),p=i(9461),m=i(1224);const g=30,v="tbu_",f=1e3,y=900;function b(e){switch(e){case"df":case"rc":case"ft":case"rf":case"fn":case"fo":case"ff":case"ml":case"mr":case"tp":case"pr":case"bs":case"nc":case"sc":case"dc":case"tr":case"sm":case"ps":case"cc":case"ac":return e;default:return"un"}}function w(){var e,t,i,n,o,r,a;const l=s.UrlState.current.state;return JSON.stringify({gender:null===(e=l.genders)||void 0===e?void 0:e[0],tag:null===(t=l.tags)||void 0===t?void 0:t[0],regions:null===(i=l.regions)||void 0===i?void 0:i.join(","),private_prices:null===(n=l.privatePrices)||void 0===n?void 0:n.join(","),room_size:l.roomSize,ages:void 0===l.ageMin&&void 0===l.ageMax?void 0:`${null!==(o=l.ageMin)&&void 0!==o?o:""}-${null!==(r=l.ageMax)&&void 0!==r?r:""}`,languages:null===(a=l.spokenLanguages)||void 0===a?void 0:a.join(",")})}function C(e,t,i,s){const o=JSON.stringify({source:t,index:i,source_filter:w(),source_index:null==s?void 0:s.sourceIndex,hashtag:null==s?void 0:s.hashtag,source_info:null==s?void 0:s.sourceInfo,row_num:null==s?void 0:s.rowNum,col_num:null==s?void 0:s.colNum,room_list_id:null==s?void 0:s.roomListId},((e,t)=>""===t?void 0:null!=t?t:void 0));!function(e){const t=document.cookie;if(t.length+e.length<4096)return;const i=Object.fromEntries(t.split(";").slice(0,50).map((e=>{const[t,i]=e.trim().split("=");return[`cookielen-${t}`,i.length]})));(0,h.bT)("BroadcasterSourceOversizedCookie",{cookie_length:t.length,data_length:e.length,...i})}(o),(0,n.uC)(`${function(e){return`${v}${e}`}(e)}`,o,{seconds:g},"/",(0,r.DV)())}function S(e){return p.Bm.current.isTestbed||p.Bm.current.noImage?`${STATIC_URL_ROOT}images/no_thumbnail_1_wide.jpg`:`${m.m.jpegRoomImgUrl}riw/${e}.jpg?${Math.floor((new Date).getTime()/3e4)}`}class x{constructor(){this.onLoadhandlers=[],this.streamers=new Map}getContainers(){const e=[];let t=".endless_page_template, .MoreRooms, .followedDropdown";if((0,u.r)()){const e=[".followedDropdown"];void 0!==s.UrlState.current.state.room?e.push(".MoreRooms"):e.push(".endless_page_template"),t=e.join(", ")}const i=document.querySelectorAll(t);for(const t of i)e.push(t);return e}addOnLoadHandler(e){this.onLoadhandlers.push(e)}onSuccess(){for(const e of this.onLoadhandlers)e()}static getInstance(){return void 0===x.instance&&(x.instance=new x),x.instance}getUrl(e){let t="";const i=e.getAttribute("data-href");if("skip"===i)return;t="string"!=typeof i||0===i.length?window.location.href.replace(""===location.hash?"#":location.hash,""):"/"===i[0]?i.substr(1):i;let s="?";-1!==t.indexOf("?")&&(s="&");const n=document.getElementById("filter_search_form");return t+s+(null!==n?(0,a.R)(n,!1).serialize():"")}static scheduleRefresh(e){x.clearRefresh(),e>0&&(x.refreshTimer=window.setTimeout((()=>{x.getInstance().loadRooms(),x.scheduleRefresh(e)}),e*f))}static scheduleImageRefresh(e){x.clearImageRefresh();let t=e;(0,u.PS)()&&(t=1),e>0&&(x.refreshImageTimer=window.setTimeout((()=>{x.getInstance().loadImages(),x.scheduleImageRefresh(e)}),t*f))}static clearRefresh(){clearTimeout(x.refreshTimer)}static clearImageRefresh(){clearTimeout(x.refreshImageTimer)}loadRooms(e){for(const e of this.streamers.values())e.stopStreaming();this.streamers.clear();const t=this.getContainers(),i=[];for(const e of t){const t=this.getUrl(e);void 0!==t&&i.push((0,o.Aw)(t).then((t=>{e.innerHTML=t.responseText})))}Promise.all(i).then((()=>{this.onSuccess(),void 0!==e&&e()})).catch(d.yZ)}loadImages(){if(!(0,u.PS)())for(const e of this.getContainers())"none"!==e.style.display&&e.querySelectorAll("img.room_thumbnail").forEach((e=>{if(null!==e.parentElement){const t=e.parentElement.dataset.room;if(void 0!==t){const i=new Image(e.width,e.height);i.onload=()=>{e.src=i.src},i.src=S(t)}}}))}getImageStreamer(e){return this.streamers.get(e)}removeImageStreamer(e){this.streamers.delete(e)}getOrCreateImageStreamer(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3?arguments[3]:void 0,n=this.getImageStreamer(e);return void 0===n&&(n=new c.QR(e,t,{startStreaming:i,useWideImages:void 0===s?!p.Bm.current.isMobile:s,streamingFadeoutTimeoutMs:0}),this.streamers.set(e,n)),n}safariReloadAllImages(){for(const e of this.streamers.values())e.safariReloadImage()}static exportToJS(){return{addOnLoadHandler:T,loadRooms:P,scheduleRefresh:k,chatRoomListOnClick:M,startStreaming:L,stopStreaming:D,clearRefresh:A,setRoomAnimation:I}}}function T(e){x.getInstance().addOnLoadHandler(e)}function P(e){x.getInstance().loadRooms(e)}function k(e){x.scheduleRefresh(e)}function A(){x.clearRefresh()}function M(e,t,i,s,n,o){C(e,b(t),i,{sourceIndex:s,hashtag:n,roomListId:o})}let R=!1;function I(e){R=e}function E(){return R}function L(e,t,i,s){(void 0===s?E():s)&&null!==t&&x.getInstance().getOrCreateImageStreamer(e,t,!0,i).startStreaming()}function D(e,t){if(void 0===t?E():t){const t=x.getInstance().getImageStreamer(e);void 0!==t&&(t.stopStreaming(),x.getInstance().removeImageStreamer(e))}}function B(e){const t=(0,l.Bg)();if(t!==l.YT.All){const i=p.Bm.current.isMobile?".subject > a":".subject > li > a";e.querySelectorAll(i).forEach((e=>{e.href=(0,o._Y)(e.href.concat(`${l.hf.get(t)}/`))}))}}},8039:(e,t,i)=>{"use strict";i.d(t,{SJ:()=>k,It:()=>S,tb:()=>x});var s=i(9461),n=i(6440);const o=new Map([["o",1],["m",2],["f",3],["l",4],["p",5],["tr",6],["t",7],["g",8]]);function r(e,t,i,s){const n={username:e,isBroadcaster:!1,inFanclub:!1,isFollowing:"t"===s,hasTokens:!1,isMod:!1,tippedRecently:!1,tippedALotRecently:!1,tippedTonsRecently:!1,exploringHashTag:"",gender:i,sourceName:"un"};return"o"===t?n.isBroadcaster=!0:"m"===t?n.isMod=!0:"f"===t?n.inFanclub=!0:"l"===t?n.tippedTonsRecently=!0:"p"===t?n.tippedALotRecently=!0:"tr"===t?n.tippedRecently=!0:"t"===t?n.hasTokens=!0:"g"!==t&&error("Unexpected IUserInfo colorGroup",{colorGroup:t}),n}function a(e){return e.isBroadcaster?"o":e.isMod?"m":e.inFanclub?"f":e.tippedTonsRecently?"l":e.tippedALotRecently?"p":e.tippedRecently?"tr":e.hasTokens?"t":"g"}var l=i(2939),h=i(8423),d=i(7407),c=i(1452),u=i(74),p=i(5216),m=i(2945);const g=new Map;var v=i(8650),f=i(8300),y=i(7477);const b=(e,t)=>e+Math.floor(Math.random()*t),w=30*b(1,10)*1e3,C=w+60*b(2,10)*1e3,S=()=>s.Bm.current.realtimeUserlistEnabled,x=new h.c_("roomUsersUpdate",{maxHistorySize:1,listenersWarningThreshold:()=>50+3*h.hI}),T=["o","m","f","l","p","tr","t","g"],P=(e,t)=>{const i=T.indexOf(a(e)),s=T.indexOf(a(t));return i!==s?i<s?-1:1:e.username.localeCompare(t.username)};class k{get activeUserList(){var e;return null!==(e=this.privateUserList)&&void 0!==e?e:this.publicUserList}constructor(){this.recentPublicEnterLeaves=new Map,this.publicListeners=new h.gt,this.privateListeners=new h.gt,this.refetchDisabled=!1,l.X0.listen((e=>{this.chatConnection=e.chatConnection,this.room=e.dossier.room,this.roomUid=e.dossier.roomUid,this.sortUsersBy=e.dossier.userChatSettings.sortUsersKey,this.roomLoadTime=performance.now(),this.refetchCounter=0,this.initializePublicUserList(),this.chatConnection.event.statusChange.listen((e=>{"privatewatching"===e.currentStatus?this.initializePrivateUserList():"privatewatching"===e.previousStatus&&(this.cleanUpPrivateUserList(),x.fire(this.getRoomUsersInfo()))}))})),u.EZ.listen((e=>{e.sortUsersKey!==this.sortUsersBy&&(this.sortUsersBy=e.sortUsersKey,this.refetch(!0).catch(c.yZ))})),l.Gr.listen((()=>{this.cleanupPublicUserList(),this.cleanUpPrivateUserList(),x.fire(this.getRoomUsersInfo())}))}static getInstance(){return void 0===k.instance&&(k.instance=new k),k.instance}getRoomUsersInfo(){var e,t,i;const s=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.publicUserList:this.activeUserList;return{totalCount:null!==(e=null==s?void 0:s.getTotalUsers())&&void 0!==e?e:0,anonCount:null!==(t=null==s?void 0:s.getAnonUsers())&&void 0!==t?t:0,roomUsers:null!==(i=null==s?void 0:s.getUsers())&&void 0!==i?i:[]}}userInRoomState(e){var t,i;return!0===(null===(t=this.activeUserList)||void 0===t?void 0:t.hasUser(e))?0:!0===(null===(i=this.publicUserList)||void 0===i?void 0:i.hasUser(e))?1:2}async refetch(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!s.Bm.current.isBroadcast)return;if(!e&&(void 0!==this.refetchedRecentlyTimeout||this.refetchDisabled))return;window.clearTimeout(this.refetchedRecentlyTimeout),this.refetchedRecentlyTimeout=window.setTimeout((()=>{this.refetchedRecentlyTimeout=void 0}),2e3);const i=await this.fetchRoomUsers(!0),n=new A(i,this.sortUsersBy);n.includeCurrentUser(),this.recentPublicEnterLeaves.forEach((e=>{let{user:t,action:i}=e;"enter"===i?n.addUser(t):n.deleteUser(t)}));const o=void 0!==this.publicUserList&&!n.equals(this.publicUserList);if(t||s.Bm.current.isBroadcast&&o){var r;let e;void 0!==this.latestRefetchTime&&(e=performance.now()-this.latestRefetchTime,e=(e-w)/6e4),(0,d.bT)("RoomUserListsMismatched",{current_size:null===(r=this.publicUserList)||void 0===r?void 0:r.getUsers().length,new_size:n.getUsers().length,time_elapsed_m:(performance.now()-this.roomLoadTime)/6e4,time_since_last_refetch_m:e,refetch_count:this.refetchCounter,lag_window_m:w/6e4})}this.latestRefetchTime=performance.now(),this.refetchCounter+=1,this.publicUserList=n,x.fire(this.getRoomUsersInfo())}toggleRefetch(e){this.refetchDisabled=!e}fetchRoomUsers(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(void 0===this.room)return error("roomUsers: calling fetchRoomUsers when not in a room"),Promise.reject("not in a room");const a=!i&&null!==(e=null===(t=this.chatConnection)||void 0===t?void 0:t.inPrivateRoom())&&void 0!==e&&e;return function(e,t,i){const a={roomname:e,private:i,sort_by:t,exclude_staff:!0};s.Bm.current.isNoninteractiveUser||(a.exclude_staff=!1);const l=(0,m.Go)(a),h=g.get(l);if(void 0!==h)return h;const d=new Promise(((e,t)=>{(0,p.Aw)(`api/getchatuserlist/?${l}`).then((t=>{e(function(e){let t=e.split(",");const i=~~t[0];t=t.slice(1);const a=[];let l=!!s.Bm.current.isBroadcast;const h=s.Aw.getState(),d=h.userlistColor,c=h.following?"t":"f",u=(0,n.f)("PushEnblRecEnter")&&!s.Bm.current.isNoninteractiveUser;for(const e of t){const[t,i,n,h]=e.split("|"),f=i;if(u&&!l&&void 0!==s.Bm.current.loggedInUser){var p,m;const e=s.Bm.current.loggedInUser.username===t?0:s.Bm.current.loggedInUser.username>t?1:-1;if(0===e)l=!0;else if(f===d){if(e<0){var g;const e=r(s.Bm.current.loggedInUser.username,d,null!==(g=s.Bm.current.loggedInUser.gender)&&void 0!==g?g:"",c);a.push(e),l=!0}}else if((null!==(p=o.get(f))&&void 0!==p?p:0)>(null!==(m=o.get(d))&&void 0!==m?m:0)){var v;const e=r(s.Bm.current.loggedInUser.username,d,null!==(v=s.Bm.current.loggedInUser.gender)&&void 0!==v?v:"",c);a.push(e),l=!0}}const y=r(t,f,n,h);a.push(y)}if((0,n.f)("PushEnblRecEnter")&&!l&&void 0!==s.Bm.current.loggedInUser&&!s.Bm.current.isNoninteractiveUser){var f;const e=r(s.Bm.current.loggedInUser.username,d,null!==(f=s.Bm.current.loggedInUser.gender)&&void 0!==f?f:"",c);a.push(e),l=!0}return{totalCount:i+a.length,anonCount:i,roomUsers:a}}(t.responseText)),window.setTimeout((()=>g.delete(l)),3e3)})).catch((e=>{t(e),g.delete(l)}))}));return g.set(l,d),d}(this.room,this.sortUsersBy,a)}initializePublicUserList(){this.listenForPublicEnterLeaves(),window.setTimeout((()=>{this.refetch().catch(c.yZ)}),3e3),window.setTimeout((()=>{this.refetch().catch(c.yZ)}),w),this.refetchInterval=window.setInterval((()=>{this.refetch().catch(c.yZ)}),C)}cleanupPublicUserList(){this.publicListeners.removeAll(),this.recentPublicEnterLeaves.clear(),window.clearTimeout(this.refetchedRecentlyTimeout),window.clearInterval(this.refetchInterval),this.refetchedRecentlyTimeout=void 0,this.publicUserList=void 0}listenForPublicEnterLeaves(){void 0!==this.roomUid?(s.Bm.current.isBroadcast||s.Aw.getState().isModerator)&&(new y.eB(this.roomUid).onMessage.listen((e=>{this.onPublicEnterLeave(e.user,e.action)})).addTo(this.publicListeners),new y.fH(this.roomUid).onMessage.listen((e=>{0===e.connections&&this.onPublicEnterLeave(e.user,e.action)})).addTo(this.publicListeners),new v.UT(this.roomUid).onMessage.listen((()=>{})).addTo(this.publicListeners)):error("roomUsers: listening for public enter/leaves without room uid")}onPublicEnterLeave(e,t){var i,s;"enter"===t?null===(i=this.publicUserList)||void 0===i||i.addUser(e):null===(s=this.publicUserList)||void 0===s||s.deleteUser(e),this.recordRecentPublicEnterLeave(e,t),x.fire(this.getRoomUsersInfo())}recordRecentPublicEnterLeave(e,t){const i=this.recentPublicEnterLeaves.get(e.username);void 0!==i&&window.clearTimeout(i.timeout);const s=window.setTimeout((()=>{this.recentPublicEnterLeaves.delete(e.username)}),w);this.recentPublicEnterLeaves.set(e.username,{user:e,action:t,timeout:s})}initializePrivateUserList(){if(this.privateUserList=new A(void 0,this.sortUsersBy),this.privateUserList.includeCurrentUser(),s.Bm.current.isBroadcast){var e;const i=null===(e=this.chatConnection)||void 0===e?void 0:e.getPrivateShowUser();if(void 0===i)error("roomUsers: no private show user when initializing private user list");else{var t;const e=null===(t=this.publicUserList)||void 0===t?void 0:t.getLatestUserInfo(i);void 0!==e&&this.privateUserList.addUser(e)}}x.fire(this.getRoomUsersInfo()),this.listenForPrivateEnterLeaves()}cleanUpPrivateUserList(){this.privateListeners.removeAll(),this.privateUserList=void 0}listenForPrivateEnterLeaves(){const e=e=>{void 0!==this.roomUid?new f.ZW(this.roomUid,e).onMessage.listen((e=>{"leave"===e.action&&0!==e.connections||this.onPrivateEnterLeave(e.user,e.action)})).addTo(this.privateListeners):error("roomUsers: listening for private enter/leaves without room uid")},t=s.Aw.getState();if(""!==t.privateShowId)e(t.privateShowId);else{let t=-1;const i=s.Aw.onUpdate.listen((n=>{const o=s.Aw.getState().privateShowId;""!==o&&(e(o),i.removeListener(),clearTimeout(t))}),!1);t=window.setTimeout((()=>{error("roomUsers: no private show ID after 10 seconds"),i.removeListener()}),1e4)}}onPrivateEnterLeave(e,t){var i,s;"enter"===t?null===(i=this.privateUserList)||void 0===i||i.addUser(e):null===(s=this.privateUserList)||void 0===s||s.deleteUser(e),x.fire(this.getRoomUsersInfo())}}class A{constructor(e,t){var i,s;this.currentUsersSet=new Set,this.historicalUsers=new Map,this.currentUsers=null!==(i=null==e?void 0:e.roomUsers)&&void 0!==i?i:[],this.anonUsers=null!==(s=null==e?void 0:e.anonCount)&&void 0!==s?s:0,this.sortUsersBy=t,this.currentUsers.forEach((e=>{this.currentUsersSet.add(e.username),this.historicalUsers.set(e.username,e)}))}getUsers(){return this.currentUsers}getTotalUsers(){return this.currentUsers.length+this.anonUsers}getAnonUsers(){return this.anonUsers}getLatestUserInfo(e){return this.historicalUsers.get(e)}hasUser(e){return this.currentUsersSet.has(e)}addUser(e){this.hasUser(e.username)||("a"===this.sortUsersBy?this.addUserAlphaSorted(e):this.addUserTokenSorted(e))}deleteUser(e){if(!this.hasUser(e.username))return;const t=this.currentUsers.findIndex((t=>t.username===e.username));this.currentUsers.splice(t,1),this.currentUsersSet.delete(e.username)}includeCurrentUser(){const e=function(){var e;if(void 0!==s.Bm.current.loggedInUser&&s.Bm.current.isBroadcast)return r(s.Bm.current.loggedInUser.username,"o",null!==(e=s.Bm.current.loggedInUser.gender)&&void 0!==e?e:"","f")}();void 0!==e&&this.addUser(e)}equals(e){return e.getUsers().length===this.currentUsers.length&&this.currentUsers.every((t=>e.hasUser(t.username)))}addUserAlphaSorted(e){const t=function(e,t,i){let s=0,n=e.length;for(;s<n;){const o=Math.floor((s+n)/2);i(t,e[o])>=0?s=o+1:n=o}return s}(this.currentUsers,e,P);this.currentUsers.splice(t,0,e),this.currentUsersSet.add(e.username),this.historicalUsers.set(e.username,e)}addUserTokenSorted(e){this.currentUsers.push(e),this.currentUsersSet.add(e.username),this.historicalUsers.set(e.username,e)}}},1224:(e,t,i)=>{"use strict";i.d(t,{c:()=>r,m:()=>a});var s=i(5216),n=i(4947),o=i(2416);const r={CBAlias:"chaturbate.com",DBWLDomain:"",tagLine:n.R.tagLine,tagLineColor:"#0b5d81",siteName:"Chaturbate",sanitizedSiteName:"Chaturbate",jpegStreamUrl:"https://jpeg.live.mmcdn.com/",jpegRoomImgUrl:"https://thumb.live.mmcdn.com/",cbGamesUrl:"https://games.multimediallc.com/",canonicalBaseUrl:"https://chaturbate.com/",bgColor:"#ffffff",navigationBgColor:"#0c6a93",navigationFontColor:"#ffffff",navigationAltBgColor:"#f47321",navigationAlt2BgColor:"#ffffff",navigationAlt2BgImage:`url(${STATIC_URL_ROOT}tsdefaultassets/gender_tab_bg.gif) repeat-x`,h1Color:"#004B5E",textColor:"#494949",defaultColor:"#494949",defaultTooltipColor:"#222222",userInfoAreaTextColor:"#222222",hrefColor:"#0A5B83",tabBorderColor:"#8bb3da",tabActiveColor:"#ffffff",tabInactiveColor:"#dde9f5",tabActiveFontColor:"#dc5500",tabInactiveFontColor:"#5e81a4",tagExhibColor:"#6D85B5",tagFontColor:"#FFF",tagOfflineColor:"#4F4F4F",tagPrivateColor:"#B60A42",tagSpyPriceColor:"#F37321",contentBgColor:"#FFFFFF",camBgColor:"#F0F1F1",camBorderColor:"#ACACAC",camSubjectColor:"#000",camSubjectTagColor:"#0A5A83",camAltTextColor:"#575757",camHrefColor:"#0A5A83",tokenHrefColor:"#e45900",footerHrefColor:"#676767",footerTextColor:"#494949",copyrightTextColor:"#494949",logoImageName:(0,o.f)(),signupBgColor:"#f47321",signupAltBgColor:"#CD5D26",logoWidth:void 0,footerHtml:"",headerGif:`#ffffff url(${STATIC_URL_ROOT}tsdefaultassets/header_bg.gif) repeat-x`,footerGif:`#ffffff url(${STATIC_URL_ROOT}tsdefaultassets/footer_bg.gif) repeat-x`,userInfoBgColor:"#e9e9e9",usernameColor:"#ffffff",nextCamBgColor:"#FCEADB",footerColNameColor:"#494949",footerRowColor:"#0A5A83",footerSiteNavColor:"#dc5500",chatAreaTabColor:"#4C4C4C",defaultCampaignSlug:"",isWhiteLabel:!1,shouldHideWaterMark:!1,shouldChangeFooterBorder:!1,shouldChangeFooterTextColor:!1,shouldAddWhiteLabelPoweredBy:!1,shouldShowHeaderAd:!0,showEarnFreeTokens:!0,shouldShowAltLanguages:!0,shouldShowFooterAddress:!0,roomSubjectToolTipColor:"#494949",loginOverlayColor:"#000000",dismissibleMessageColor:"#494949",userInfoDropdownBgColor:"#3C87BA",userInfoDropdownHighlightColor:"#F47321",userInfoDropdownTextColor:"#ffffff",userUpdatesFeedbackLink:"https://www.surveymonkey.com/r/DXYF5T8",hideEntranceTerms:!0===window.hide_entrance_terms,carouselActiveCircleColor:"#F47321",carouselArrowBgColor:"#FFFFFF",carouselArrowColor:"#000000",carouselBgColor:"#F8F9fA",carouselBorderColor:"#ACACAC",carouselCircleColor:"#6E6F70",carouselHrefColor:"#0A5B83",carouselTitleColor:"#494949",filterPanelBgColor:"#F8F9FA",filterOptionBorderColor:"#E0EEFB",filterPanelHighlightColor:"#306A91",filterSectionPrimaryTextColor:"#525252",filterSectionSupportTextColor:"#6E6F70",filterPanelButtonActiveBgColor:"#E9E9E9",filterPanelButtonHoverBgColor:"#EEEEEE"};let a=r;void 0!==window.siteSettings?a=function(e){const t=e.navigation_font_color,i=e.text_color,s=e.tab_inactive_color,n=e.tab_inactive_font_color,o=e.content_bgcolor,a=e.footer_href_color,l=e.footer_text_color,h=e.tab_inactive_color,d=e.tab_active_color,c=e.tab_active_font_color,u=e.cam_href_color,p=e.site_name,m=document.createElement("span");m.innerText=p;const g=m.innerHTML;return{CBAlias:e.chaturbate_alias,DBWLDomain:e.dbwl_domain,tagLine:e.tagline,tagLineColor:e.tagline_color,siteName:p,sanitizedSiteName:g,jpegStreamUrl:e.jpeg_stream_url,jpegRoomImgUrl:e.jpeg_room_img_url,cbGamesUrl:e.cb_games_url,canonicalBaseUrl:e.canonical_base_url,bgColor:e.bgcolor,navigationBgColor:e.navigation_bgcolor,navigationFontColor:t,navigationAltBgColor:e.navigation_alt_bgcolor,navigationAlt2BgColor:e.navigation_alt_2_bgcolor,navigationAlt2BgImage:"",h1Color:e.h1_color,textColor:i,defaultColor:r.defaultColor,defaultTooltipColor:r.defaultTooltipColor,userInfoAreaTextColor:i,hrefColor:e.href_color,tabBorderColor:e.tab_border_color,tabActiveColor:e.tab_active_color,tabInactiveColor:s,tabActiveFontColor:e.tab_active_font_color,tabInactiveFontColor:n,tagExhibColor:e.tag_exhibitionist_color,tagFontColor:e.tag_font_color,tagOfflineColor:e.tag_offline_color,tagPrivateColor:e.tag_private_group_color,tagSpyPriceColor:e.tag_spy_price_color,contentBgColor:o,camBgColor:e.cam_background_color,camBorderColor:e.cam_border_color,camSubjectColor:e.cam_text_color,camSubjectTagColor:"#0C6A93",camAltTextColor:e.cam_text_alt_color,camHrefColor:u,tokenHrefColor:u,footerHrefColor:a,footerTextColor:l,copyrightTextColor:l,logoImageName:e.logo_image_name,signupBgColor:e.signup_bg_color,signupAltBgColor:e.signup_alt_bg_color,logoWidth:e._logo_width,footerHtml:e.footer_html,headerGif:"",footerGif:"",userInfoBgColor:o,usernameColor:t,nextCamBgColor:s,footerColNameColor:n,footerRowColor:a,footerSiteNavColor:a,chatAreaTabColor:"#0C6A93",defaultCampaignSlug:e.default_campaign_slug,isWhiteLabel:!0,shouldHideWaterMark:!0,shouldChangeFooterBorder:!0,shouldChangeFooterTextColor:!0,shouldAddWhiteLabelPoweredBy:!0,shouldShowHeaderAd:!1,showEarnFreeTokens:!1,shouldShowAltLanguages:!1,shouldShowFooterAddress:!1,roomSubjectToolTipColor:"#222222",loginOverlayColor:i,dismissibleMessageColor:i,recordHitURL:e.whitelabel_hit_count_referring_url,userInfoDropdownBgColor:h,userInfoDropdownHighlightColor:d,userInfoDropdownTextColor:c,userUpdatesFeedbackLink:r.userUpdatesFeedbackLink,hideEntranceTerms:r.hideEntranceTerms,carouselActiveCircleColor:e.carousel_active_circle_color,carouselArrowBgColor:e.carousel_arrow_bg_color,carouselArrowColor:e.carousel_arrow_color,carouselBgColor:e.carousel_bg_color,carouselBorderColor:e.carousel_border_color,carouselCircleColor:e.carousel_circle_color,carouselHrefColor:e.carousel_href_color,carouselTitleColor:e.carousel_title_color,filterPanelBgColor:e.filter_panel_bg_color,filterOptionBorderColor:e.filter_option_border_color,filterPanelHighlightColor:e.filter_panel_highlight_color,filterSectionPrimaryTextColor:e.filter_section_primary_text_color,filterSectionSupportTextColor:e.filter_section_support_text_color,filterPanelButtonActiveBgColor:e.filter_panel_button_active_bg_color,filterPanelButtonHoverBgColor:e.filter_panel_button_hover_bg_color,metaDescription:e.meta_description,homepageTitle:e.title}}(window.siteSettings):void 0!==window.siteUrls&&(a.jpegStreamUrl=window.siteUrls.jpeg_stream_url,a.jpegRoomImgUrl=window.siteUrls.jpeg_room_img_url,a.cbGamesUrl=window.siteUrls.cb_games_url,a.canonicalBaseUrl=window.siteUrls.canonical_base_url),void 0!==a.recordHitURL&&(0,s.KF)("whitelabels/record_hit/",{referer:a.recordHitURL}).catch((e=>{error("Error recording whitelabel hit",e)}))},9505:(e,t,i)=>{"use strict";i.d(t,{J:()=>a,z:()=>s});var s,n=i(2709),o=i(3955),r=i(1372);!function(e){e[e.Text=0]="Text",e[e.Icon=1]="Icon"}(s||(s={}));class a extends n.u{constructor(e){super("div",e)}initData(e){this.columnGap=null==e?void 0:e.columnGap}initUI(e){const t={display:"flex",alignItems:"center",minWidth:"0px",...null==e?void 0:e.containerStyle};this.element=(0,r.tT)("div",{style:t})}addButton(e,t){void 0!==this.lastChildEl&&void 0!==this.columnGap&&(0,o.ZM)(this.lastChildEl,{marginRight:this.columnGap}),e instanceof n.u?this.addChild(e):this.element.appendChild(e);const i=e instanceof n.u?e.element:e;t===s.Text&&(0,o.ZM)(i,{minWidth:"0px"}),this.lastChildEl=i}}},8746:(e,t,i)=>{"use strict";i.d(t,{O:()=>p,Z:()=>u});var s=i(4936),n=i(213),o=i(5216),r=i(2709),a=i(4947),l=i(9447),h=i(753),d=i(816),c=i(6861);class u{static parseData(e){const t=new s.N6(e),i=t.getObject("initial"),n=t.getMap("schema"),o=n.getList("fieldsets");let r;r=void 0===o?[]:o.map((e=>({fields:e.getStringList("fields"),label:e.getString("label")})));const a=JSON.parse(e).schema.fields,l={};for(const e of Object.keys(a)){const t=new s.N6(JSON.stringify(a[e])),n=null===i[e]?void 0:i[e];l[e]=u.parseField(e,t,n),t.logUnusedDebugging("parse DjangoForm field")}return{extra:t.getObject("extra"),initial:i,schema:{prefix:n.getStringOrUndefined("prefix"),fields:l,fieldsets:r,label_suffix:n.getStringOrUndefined("label_suffix"),field_order:n.getStringList("field_order")}}}static parseField(e,t,i){return{defaultValue:i,name:e,minLength:t.getNumberOrUndefined("min_length"),maxLength:t.getNumberOrUndefined("max_length"),emptyValue:t.getStringOrUndefined("empty_value"),choices:u.parseSelectOptions(t.getList("choices")),required:t.getBoolean("required"),disabled:t.getBoolean("disabled"),helpText:t.getString("help_text"),labelText:t.getString("label"),fieldType:t.getString("type"),siteKey:t.getStringOrUndefined("site_key")}}static parseSelectOptions(e){if(void 0===e)return[];const t=[];for(const i of e)t.push({label:i.getStringWithNumbers("label"),value:i.getStringWithNumbersOrBoolean("value")});return t}}class p extends r.u{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super("form"),this.data=e,this.fields={},this.fieldsets={},this.loading=!1,this.initializeOptions(i),this.element.style.position="static",this.isAutoSaveForm=s;const n=document.createElement("table");this.element.appendChild(n),this.tbody=document.createElement("tbody"),n.appendChild(this.tbody),this.submitButton=this.createSubmitButton(),this.element.appendChild(this.submitButton),this.endpoint=t,this.generateFields(),this.isAutoSaveForm?this.handleAutoSaveAndUnsavedLabels():this.element.onsubmit=e=>{e.preventDefault(),this.onSubmit()}}handleAutoSaveAndUnsavedLabels(){}triggerExternalSubmit(){this.isAutoSaveForm&&this.formHasChanged()&&this.onSubmit()}onSubmit(){if(this.loading)return;this.loading=!0;const e=new FormData(this.element);let t=!1;this.hasChanged=!1,(0,o.KF)(this.endpoint,e).then((()=>{this.loading=!1,this.options.onSubmitSuccess(e),this.isAutoSaveForm&&this.clearUnsavedLabels()})).catch((e=>{this.loading=!1;try{const i=JSON.parse(e.xhr.responseText);if(void 0!==i.throttle_error)return t=!0,void(0,n.Q$)(i.throttle_error);const s=i.errors;if(null===s||"object"!=typeof s)return;this.handleErrors(s)}catch(e){}finally{t||this.options.onSubmitError(e)}})).finally((()=>{this.hideErrorMessages()}))}initializeOptions(e){const t={field:new c.Dr,checkbox:new c.oM,input:new c.V8,select:new c.x9,textarea:new c.np,multipleCheckboxes:new c.A,multipleSelect:new c.xx,noReCaptcha:new c.n$};this.options={onSubmitSuccess:void 0===e.onSubmitSuccess?()=>{}:e.onSubmitSuccess,onSubmitError:void 0===e.onSubmitError?()=>{}:e.onSubmitError,styles:void 0===e.styles?t:{...t,...e.styles}}}generateFields(){if(this.data.schema.field_order.length>0)for(const e of this.data.schema.field_order){const t=this.data.schema.fields[e];this.addField(this.createField(t))}else if(void 0!==this.data.schema.fieldsets)for(const e of this.data.schema.fieldsets){this.addFieldset(e.label);for(const t of e.fields){const i=this.data.schema.fields[t];this.addFieldToFieldset(this.createField(i),e.label)}}else for(const e of Object.keys(this.data.schema.fields)){const t=this.data.schema.fields[e];this.addField(this.createField(t))}this.listenFormChanges()}createField(e){var t;switch(e.fieldType){case"CharField":return void 0===e.maxLength?new d.fs({...e,styles:this.options.styles.textarea}):new d.pd({...e,styles:this.options.styles.input});case"EmailField":return new d.pd({...e,styles:this.options.styles.input});case"BooleanField":return new d.Oc({...e,styles:this.options.styles.checkbox});case"ChoiceField":case"TypedChoiceField":return new d.l6({...e,styles:this.options.styles.select});case"TypedMultipleChoiceField":return new h.X({...e});case"MultiSelectFormField":return new d.Ws({...e,styles:this.options.styles.multipleSelect});case"DateField":return new d.BS({...e,day:this.data.initial[`${e.name}__day`],month:this.data.initial[`${e.name}__month`],year:this.data.initial[`${e.name}__year`],styles:this.options.styles.select});case"NoReCaptchaField":const i=null!==(t=e.siteKey)&&void 0!==t?t:"";return""===i&&error("siteKey must be provided for NoReCaptchaField"),new d.r9({...e,siteKey:i,styles:this.options.styles.noReCaptcha});default:return error(`DjangoForm received an unknown field type: ${e.fieldType}`),new d.pd({name:""})}}addField(e){void 0===this.fields[e.getName()]?(this.fields[e.getName()]=e,this.tbody.appendChild(e.getField())):error(`Field ${e.getName()} already exists`)}clearUnsavedLabels(){for(const e of Object.keys(this.fields)){const t=this.fields[e];void 0!==t&&(t.setUnsaved(!1),t.clearError())}}addFieldToFieldset(e,t){const i=this.getFieldset(t);void 0!==i?void 0===this.fields[e.getName()]?(this.fields[e.getName()]=e,i.appendChild(e.getField())):error(`Field ${e.getName()} already exists`):error(`Fieldset ${t} does not exist`)}removeField(e){const t=this.fields[e];void 0!==t&&(t.getField().remove(),delete this.fields[e])}createFieldset(e){const t=document.createElement("fieldset"),i=document.createElement("table"),s=document.createElement("tbody");return t.appendChild(this.createLegend(e)),t.appendChild(i),i.appendChild(s),this.fieldsets[e]=s,t}createLegend(e){const t=document.createElement("legend");return(0,l.fZ)(t,"label"),t.innerText=e,t.style.fontSize="1.266em",t.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",t.style.fontWeight="normal",t.style.padding="10px 0px 10px 0px",t}handleErrors(e){for(const i of Object.keys(this.fields)){var t;if(null===(t=this.fields[i])||void 0===t||t.onFormError(),!(i in e)){const e=this.fields[i];void 0!==e&&e.clearError()}}for(const t in e){const i=e[t][0];if("string"!=typeof i)break;const s=this.getField(t);void 0===s?error(`Form error on unknown field ${t}`):s.setError(i)}}hideErrorMessages(){for(const e of Object.keys(this.fields)){const t=this.fields[e];void 0===t||t.hasError()||t.clearError()}}formHasChanged(){return this.hasChanged}listenFormChanges(){for(const e of Object.keys(this.getFields())){const t=this.getField(e);void 0!==t&&t.fieldChanged.listen((()=>{this.hasChanged=!0}))}}createSubmitButton(){const e=document.createElement("input");return e.type="submit",e.value=a.R.submitCAPS,e.className="button",e.style.display="block",e.style.cursor="pointer",e.style.padding="0px 30px 2px 15px",e.style.margin="15px 0px 0px 137px",e.style.width="auto",e.style.height="28px",e.style.borderRadius="4px",e.style.font="1.16em/1.0em 'UbuntuMedium', Arial, Helvetica, sans-serif",this.isAutoSaveForm&&(e.style.display="none",e.disabled=!0),e}focusFirstField(){const e=Object.keys(this.fields)[0];if(void 0!==e){const t=this.fields[e];void 0!==t&&t.getWidget().focus()}}focusField(e){const t=this.getField(e);void 0!==t&&t.getWidget().focus()}getFields(){return this.fields}getField(e){return this.fields[e]}getFieldset(e){return this.fieldsets[e]}getSubmitButton(){return this.submitButton}prependFieldset(e){this.tbody.insertBefore(this.createFieldset(e),this.tbody.firstChild)}addFieldset(e){this.tbody.appendChild(this.createFieldset(e))}setSubmitText(e){this.submitButton.value=e}}},4873:(e,t,i)=>{"use strict";i.d(t,{Dw:()=>d,Dy:()=>c,g2:()=>p});var s=i(2709),n=i(3955),o=i(8423),r=i(9447),a=i(369),l=i(520),h=i(1848);class d extends s.u{constructor(e,t){super(e),this.defaultDisplay="inline-block",this.collapseEvent=new o.c_("collapse",{reportIfNoListeners:!1}),this.overflownSibling=[],this.shownSibling=[],this.spacer=new h.m,this.collapsedTabs=[],this.listeners=new o.gt,void 0!==e&&"string"!=typeof e||this.styleElement(),this.dropDown=this.createDropDown(!0===t),(0,n.ZM)(this,{userSelect:"none"}),this.hideElement(),(0,n.ZM)(this.spacer,{cssFloat:"right",height:"100%",visibility:"hidden"}),this.listeners.add(this.dropDown.toggleEvent.listen((e=>{this.onToggle(e)}))),this.listeners.add(a.oO.listen((e=>{this.dropDown.isShown()&&this.dropDown.hideElement(),this.collapseIfNeeded(!e)}))),window.setTimeout((()=>{this.attachSpacer(),this.collapseIfNeeded()}))}collapseIfNeeded(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.dropDown.isShown();t&&this.restoreTabsFromDropDown(),this.separateOverflownSiblings(),this.showOrHideBasedOnOverflownSiblings(),e&&this.isShown()&&this.fixLeftPosition(),t&&(0===this.overflownSibling.length?this.dropDown.hideElement():(this.addTabsToDropDown(),this.dropDown.reposition()))}showOrHideBasedOnOverflownSiblings(){0===this.overflownSibling.length?this.isShown()&&(this.hideElement(),this.spacer.element.style.paddingLeft="0px",this.collapseEvent.fire(!1)):1===this.overflownSibling.length&&this.isShown()&&this.lastOverflownElementHasEnoughSpace()?this.tryToHideThisAndShowLastOverflown():this.isShown()||(this.showElement(this.defaultDisplay),this.reposition(),this.collapseEvent.fire(!0),this.separateOverflownSiblings())}tryToHideThisAndShowLastOverflown(){this.hideElement();const e=this.spacer.element.style.paddingLeft;this.spacer.element.style.paddingLeft="0px",this.separateOverflownSiblings(),this.overflownSibling.length>0?(this.showElement(this.defaultDisplay),this.spacer.element.style.paddingLeft=e):this.collapseEvent.fire(!1)}lastOverflownElementHasEnoughSpace(){const e=this.overflownSibling[0],t=getComputedStyle(e.element);return e.element.offsetWidth+(0,n.Lx)(t.marginLeft)+(0,n.Lx)(t.marginRight)+5<=this.element.offsetWidth+this.spacer.element.offsetLeft-this.element.offsetLeft}setSpacerWidth(e){this.spacer.element.style.width=`${e}px`}isTargetOverflownAnchor(e){return this.overflownSibling.some((t=>t.element.children[0]===e))}lastShownSibling(){return this.shownSibling[this.shownSibling.length-1]}firstTab(){if(void 0!==this.parent)for(const e of this.parent.children())if(u(e.element))return e}repositionChildren(){super.repositionChildren(),this.collapseIfNeeded()}onToggle(e){e.isShowing?(this.separateOverflownSiblings(),this.addTabsToDropDown()):this.restoreTabsFromDropDown()}addTabsToDropDown(){this.overflownSibling.forEach((e=>{this.collapsedTabs.unshift([e,e.nextSibling()]),this.dropDown.addChild(e),e.collapse(!0)}))}restoreTabsFromDropDown(){const e=this.parent;this.collapsedTabs.forEach((t=>{const i=t[0];e.addChildBefore(i,t[1]),i.collapse(!1)})),this.collapsedTabs=[]}collapsibleSiblings(){return void 0===this.parent?[]:this.parent.children().filter((e=>e instanceof p&&e.isShown()))}createDropDown(e){return new l.s(this.element,e)}separateOverflownSiblings(){if(null===this.element.parentElement||null===this.element.parentElement.offsetParent)return;const e=this.collapsibleSiblings();this.overflownSibling=[],this.shownSibling=[],e.forEach((e=>{c(e)?this.overflownSibling.push(e):this.shownSibling.push(e)}))}reposition(){null!==this.element.parentElement&&((0,n.ZM)(this.element,{position:"absolute",boxSizing:"border-box",textAlign:"center"}),this.spacer.element.style.paddingLeft=`${this.element.offsetWidth}px`,""===this.element.style.width&&(this.element.style.width=`${this.element.offsetWidth+1}px`))}attachSpacer(){if(void 0!==this.parent||null!==this.element.parentElement){const e=void 0===this.parent?this.element.parentElement:this.parent.element,t=this.firstTab();void 0!==t&&e.insertBefore(this.spacer.element,t.element.nextSibling)}}styleElement(){return this.element.appendChild(document.createTextNode(d.DOTDOTDOT_TEXT)),(0,r.fZ)(this.element,r.aG.chatAreaTabColor),(0,n.ZM)(this.element,{cursor:"pointer",width:"",height:"",padding:"0 10px",textAlign:"center"}),this.element}fixLeftPosition(){if(void 0!==this.parent){let e=0;for(const t of this.parent.children())!u(t.element)||t===this||t instanceof p&&-1===this.shownSibling.indexOf(t)||(e=Math.max(t.element.offsetLeft+t.element.offsetWidth+(0,n.Lx)(getComputedStyle(t.element).marginRight),e));this.element.offsetLeft!==e&&(this.element.style.left=`${e}px`,window.setTimeout((()=>{this.element.style.left=""})))}}dispose(){this.dropDown.dispose(),this.listeners.removeAll()}}function c(e){if(null===e.element.parentElement)return!1;if(e.element.parentElement.offsetHeight<=e.element.offsetHeight)return.5*e.element.offsetHeight+e.element.offsetTop>=e.element.parentElement.offsetHeight;const t=e.element.parentElement.scrollHeight>e.element.parentElement.offsetHeight,i=e.element.parentElement.offsetHeight<=.5*e.element.offsetHeight+e.element.offsetTop;return t&&i}function u(e){return"none"!==e.style.display&&"right"!==e.style.cssFloat&&"absolute"!==e.style.position&&"fixed"!==e.style.position}d.DOTDOTDOT_TEXT=". . .";class p extends s.u{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div"),this.onCollapseEvent=new o.c_("collapse",{reportIfNoListeners:!1}),this.collapsed=!1,window.setTimeout((()=>{this.onCollapseEvent.fire(this.collapsed)}))}collapse(e){this.collapsed=e,e?this.element.classList.add("collapsed"):this.element.classList.remove("collapsed"),this.onCollapseEvent.fire(e)}}},6861:(e,t,i)=>{"use strict";i.d(t,{A:()=>c,Dr:()=>n,Gw:()=>h,V8:()=>a,n$:()=>u,np:()=>l,oM:()=>d,x9:()=>o,xx:()=>r});var s=i(9447);class n{styleRow(e){e.style.padding="3px 0"}styleLabelContainer(e){e.style.minWidth="130px",e.style.width="auto",e.style.paddingTop="10px",e.style.paddingBottom="1px",e.style.verticalAlign="top",e.style.textAlign="right"}styleLabel(e){(0,s.fZ)(e,s.aG.defaultColor),e.style.textAlign="right",e.style.fontWeight="bold",e.style.font="1em/1.3em 'UbuntuMedium', Arial, Helvetica, sans-serif",e.style.padding="0",e.style.margin="0 4px 0 0"}styleFieldContainer(e){(0,s.fZ)(e,s.aG.defaultColor)}styleField(e){(0,s.fZ)(e,"field"),e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.padding="2px 4px",e.style.lineHeight="18px",e.style.marginTop="4px",e.style.width="225px"}styleHelpText(e){(0,s.fZ)(e,s.aG.defaultColor),e.style.fontFamily="UbuntuRegular, Arial, Helvetica, sans-serif",e.style.fontSize="11px",e.style.width="350px"}}class o extends n{styleField(e){super.styleField(e),e.style.width="auto",e.style.marginTop="7px"}}class r extends o{styleField(e){super.styleField(e),e.style.height="",e.size=10}}class a extends n{}class l extends n{styleField(e){(0,s.fZ)(e,"fieldTextArea"),e.style.width="350px",e.style.lineHeight="18px",e.style.marginTop="4px",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.padding="2px 4px",e.style.overflow="hidden",e.style.height="150px"}}class h extends l{styleLabel(e){(0,s.fZ)(e,s.aG.defaultColor),e.style.width="100%",e.style.textAlign="left",e.style.fontWeight="bold",e.style.font="1em/1.3em 'UbuntuMedium', Arial, Helvetica, sans-serif",e.style.margin="0px 4px 6px"}styleLabelContainer(e){e.style.minWidth="130px",e.style.width="auto",e.style.paddingLeft="10px",e.style.paddingBottom="1px",e.style.verticalAlign="top",e.style.textAlign="right"}}class d extends n{styleFieldContainer(e){super.styleFieldContainer(e),e.style.paddingTop="7px"}}class c extends n{styleFieldContainer(e){super.styleFieldContainer(e),e.style.paddingTop="7px"}styleField(e){super.styleField(e),e.style.width="auto",e.style.marginTop="7px"}}class u extends n{styleField(e){super.styleField(e),e.style.position="",e.style.padding="",e.style.overflow="",e.style.background="",e.style.border=""}}},816:(e,t,i)=>{"use strict";i.d(t,{Oc:()=>w,ib:()=>S,BS:()=>x,D0:()=>m,pd:()=>g,Ws:()=>C,LP:()=>y,r9:()=>T,l6:()=>f,Ru:()=>b,fs:()=>v});var s=i(6784),n=i(8423),o=i(2709),r=i(6716);let a;const l=new n.c_("recaptchaLoaded",{maxHistorySize:1});window.recaptchaLoadCallback=()=>{a=window.grecaptcha,l.fire(void 0)};class h extends o.u{constructor(){super(),this.element.style.height="",this.element.style.width=""}render(e){l.once((()=>{void 0===e.theme&&(e.theme=document.body.classList.contains("darkmode")?"dark":"light"),void 0===this.listener&&(this.listener=r.gh.listen((e=>{void 0!==this.widgetData&&(this.widgetData.parameters.theme="darkmode"===e?"dark":"light",this.reset())})));const t=a.render(this.element,e);this.widgetData={widgetID:t,parameters:e}}))}reset(){void 0!==this.widgetData&&(a.reset(this.widgetData.widgetID),this.updateTheme())}getResponse(){return void 0!==this.widgetData?a.getResponse(this.widgetData.widgetID):""}updateTheme(){if(void 0!==this.widgetData){const e=this.element.getElementsByTagName("iframe")[0];"dark"===this.widgetData.parameters.theme?e.src=e.src.replace("theme=light","theme=dark"):e.src=e.src.replace("theme=dark","theme=light")}}}var d=i(4947),c=i(9447),u=i(9937),p=i(6861);class m{constructor(e){this.required=!1,this.unsaved=!1,this.disabled=!1,this.errorMessage="",this.initializeData(e),this.errorContainer=document.createElement("div"),(0,c.fZ)(this.errorContainer,"fieldError"),this.errorContainer.style.display="none",this.createLabel(),this.createLabelContainer(),this.createWidgetContainer(),this.labelContainer.appendChild(this.label),this.createRow(),this._assembleField()}initializeData(e){this.name=e.name,this.defaultValue=void 0===e.defaultValue?"":String(e.defaultValue),this.labelText=void 0===e.labelText?"":e.labelText,this.helpText=void 0===e.helpText?"":e.helpText,this.required=void 0!==e.required&&e.required,this.disabled=void 0!==e.disabled&&e.disabled,this.onChange=void 0===e.onChange?()=>{}:e.onChange,this.fieldChanged=new n.c_(`${this.name}Changed`),this.fieldTouched=new n.c_(`${this.name}Touched`),this.styles=void 0===e.styles?new p.Dr:e.styles}getField(){return this.field}getWidget(){return this.widget}getWidgetContainer(){return this.widgetContainer}getName(){return this.name}getLabelContainer(){return this.labelContainer}onFormError(){}hasError(){return""===this.errorContainer.style.display}setError(e){this.errorContainer.style.display="",this.errorContainer.innerText=e,(0,c.fZ)(this.label,"fieldError")}clearError(){this.errorContainer.style.display="none",this.errorContainer.innerText="",(0,c.SA)(this.label,"fieldError"),this.styles.styleLabel(this.label)}setDisabled(e){this.disabled=e,"disabled"in this.widget&&(this.widget.disabled=e)}setOnChange(e){this.onChange=e}_assembleField(){this.assembleField(),this.afterAssembleField()}afterAssembleField(){this.widgetContainer.appendChild(this.createHelpText()),this.widgetContainer.appendChild(this.errorContainer)}createLabel(){this.label=document.createElement("label"),this.styles.styleLabel(this.label),this.label.innerText=this.formatLabelText()}createLabelContainer(){this.labelContainer=document.createElement("th"),this.styles.styleLabelContainer(this.labelContainer),""===this.labelText&&(this.labelContainer.style.display="none")}updateLabelText(e){this.labelText=e,this.label.innerText=this.formatLabelText(),""===this.labelText?this.labelContainer.style.display="none":this.labelContainer.style.display=""}formatLabelText(){return`${this.labelText}${this.unsaved?` ${d.R.unsavedText}`:""}: ${this.required?"*":""}`}setUnsaved(e){this.unsaved=e,this.label.innerText=this.formatLabelText(),void 0!==this.unsavedHelpTextSpan&&(this.unsavedHelpTextSpan.style.display=e?"":"none")}createWidgetContainer(){this.widgetContainer=document.createElement("td"),this.styles.styleFieldContainer(this.widgetContainer)}createHelpText(){return this.helpText instanceof HTMLElement?(this.styles.styleHelpText(this.helpText),this.helpTextElement=this.helpText):(this.helpTextElement=document.createElement("div"),""===this.helpText?this.helpTextElement.style.display="none":(this.styles.styleHelpText(this.helpTextElement),this.helpTextElement.innerHTML=this.helpText)),this.helpTextElement}createUnsavedHeptextSpan(){return this.unsavedHelpTextSpan=document.createElement("span"),this.unsavedHelpTextSpan.innerText=` ${d.R.unsavedText}`,this.unsavedHelpTextSpan.style.display="none",this.unsavedHelpTextSpan.style.whiteSpace="pre",this.unsavedHelpTextSpan}getHelpTextElement(){return this.helpTextElement}createRow(){this.field=document.createElement("tr"),this.styles.styleRow(this.field),this.field.appendChild(this.labelContainer),this.field.appendChild(this.widgetContainer)}}class g extends m{constructor(e){super(e)}getValue(){return this.widget.value}createField(){const e=document.createElement("input");return e.name=this.name,e.value=this.defaultValue,this.styles.styleField(e),e.style.width="225px",e.required=this.required,e.disabled=this.disabled,void 0!==this.minLength&&(e.minLength=this.minLength),void 0!==this.maxLength&&(e.maxLength=this.maxLength),(0,s.wu)("input",e,(()=>{this.fieldChanged.fire()})),e}assembleField(){this.widget=this.createField(),this.widgetContainer.appendChild(this.widget)}initializeData(e){super.initializeData(e),this.minLength=e.minLength,this.maxLength=e.maxLength,this.styles=void 0===e.styles?new p.V8:e.styles}}class v extends m{constructor(e){super(e)}getValue(){return this.widget.value}createField(){const e=document.createElement("textarea");e.name=this.name,e.id=`id_${this.name}`,e.value=this.defaultValue,e.required=this.required,e.disabled=this.disabled,void 0!==this.minLength&&(e.minLength=this.minLength),void 0!==this.maxLength&&(e.maxLength=this.maxLength),this.styles.styleField(e);const t=()=>{const t=e.offsetHeight-e.clientHeight;e.style.height="auto",e.style.height=`${e.scrollHeight+t+15}px`};return window.setTimeout((()=>{t()}),0),(0,s.wu)("input",e,(()=>{t(),this.fieldChanged.fire()})),e}assembleField(){this.widget=this.createField(),this.widgetContainer.appendChild(this.widget)}initializeData(e){super.initializeData(e),this.minLength=e.minLength,this.maxLength=e.maxLength,this.styles=void 0===e.styles?new p.np:e.styles}}class f extends m{constructor(e){super(e)}getValue(){return this.widget.value}createField(){const e=document.createElement("select");e.name=this.name,e.multiple=this.multiple,e.required=this.required,e.disabled=this.disabled,this.styles.styleField(e);const t=this.defaultValue.split(",");for(const i of this.choices){const s=document.createElement("option");s.innerText=String(i.label),s.value=String(i.value),s.selected=t.includes(s.value),e.appendChild(s)}return(0,s.wu)("change",e,(()=>{this.onChange(this),this.fieldChanged.fire()})),(0,s.wu)("blur",e,(()=>{this.fieldTouched.fire()})),e}assembleField(){this.widget=this.createField(),this.widgetContainer.appendChild(this.widget)}initializeData(e){super.initializeData(e),this.multiple=void 0!==e.multiple&&e.multiple,this.choices=void 0===e.choices?[]:e.choices,this.styles=void 0===e.styles?new p.x9:e.styles,"true"===this.defaultValue?this.defaultValue="True":"false"===this.defaultValue&&(this.defaultValue="False")}}class y extends f{constructor(e){super(e)}getValue(){const e=[];for(const t of this.selectedOptions.options)e.push(t.value);return e}createField(){const e=document.createElement("select");this.selectedOptions=document.createElement("select");const t=document.createElement("div");t.style.clear="both",t.style.display="none",this.widgetContainer.appendChild(t);const i=e=>{const i=document.createElement("input");i.type="checkbox",i.style.display="none",i.name=this.name,i.value=e,i.checked=!0,i.id=`listselect_${this.name}_${e}`,t.appendChild(i)},n=e=>{const i=document.getElementById(`listselect_${this.name}_${e}`);null!==i&&t.removeChild(i)};this.styles.styleField(e),this.styles.styleField(this.selectedOptions);const o=this.defaultValue.split(",");for(const t of this.choices){const s=document.createElement("option");s.innerText=String(t.label),s.value=String(t.value),o.includes(s.value)?(this.selectedOptions.appendChild(s),i(s.value)):e.appendChild(s)}e.multiple=!0,e.disabled=this.disabled,this.selectedOptions.multiple=!0,this.selectedOptions.disabled=this.disabled;const r=(e,t,s)=>{const o=e.selectedOptions.length,r=[...e.selectedOptions];for(let e=0;e<o;e+=1){const o=r[e];o.selected=!1,t.appendChild(o),s?i(o.value):n(o.value)}};return(0,s.wu)("change",e,(()=>{r(e,this.selectedOptions,!0),this.fieldChanged.fire(),this.onChange(this)})),(0,s.wu)("change",this.selectedOptions,(()=>{r(this.selectedOptions,e,!1),this.fieldChanged.fire(),this.onChange(this)})),e}initializeData(e){super.initializeData(e),this.selectedHeader=void 0===e.selectedHeader?"":e.selectedHeader,this.unselectedHeader=void 0===e.unselectedHeader?"":e.unselectedHeader,this.styles=void 0===e.styles?new p.xx:e.styles}createHeader(e){const t=document.createElement("strong");return(0,c.fZ)(t,"label"),t.style.fontWeight="bold",t.innerText=e,t}createSelectContainer(){const e=document.createElement("div");return e.style.marginRight="5px",e.style.cssFloat="left",e.style.width="200px",e}assembleField(){const e=this.createSelectContainer(),t=this.createSelectContainer(),i=this.createHeader(this.unselectedHeader),s=this.createHeader(this.selectedHeader);this.widget=this.createField(),e.appendChild(i),e.appendChild(this.widget),t.appendChild(s),t.appendChild(this.selectedOptions),this.widgetContainer.appendChild(e),this.widgetContainer.appendChild(t)}}class b extends m{createField(){return this.transparentCheckbox=new u.m(16,"True"===this.defaultValue,(()=>{this.transparentCheckbox.setCheckboxValue(this.getChecked()?"True":"False"),this.onChange(this)})),this.transparentCheckbox.setName(this.name),this.styles.styleField(this.transparentCheckbox.element),this.setDisabled(this.disabled),(0,s.wu)("change",this.transparentCheckbox.element,(()=>{this.fieldChanged.fire()})),this.transparentCheckbox.element}assembleField(){this.widget=this.createField(),this.widgetContainer.appendChild(this.widget)}getValue(){return this.transparentCheckbox.getCheckboxValue()}initializeData(e){super.initializeData(e),this.styles=void 0===e.styles?new p.oM:e.styles,"true"===this.defaultValue?this.defaultValue="True":"false"===this.defaultValue&&(this.defaultValue="False")}setChecked(e){this.transparentCheckbox.setCheckedDirectly(e)}getChecked(){return this.transparentCheckbox.isChecked()}setDisabled(e){e?this.transparentCheckbox.disable():this.transparentCheckbox.enable()}}class w extends g{createField(){const e=document.createElement("input");return e.name=this.name,e.value=this.defaultValue,e.checked="True"===this.defaultValue,e.required=this.required,e.disabled=this.disabled,e.type="checkbox",this.styles.styleField(e),(0,s.wu)("change",e,(()=>{this.widget.value=e.checked?"True":"False",this.fieldChanged.fire(),this.onChange(this)})),e}getValue(){return this.widget.value}initializeData(e){super.initializeData(e),this.styles=void 0===e.styles?new p.oM:e.styles,"true"===this.defaultValue?this.defaultValue="True":"false"===this.defaultValue&&(this.defaultValue="False")}setChecked(e){this.widget.checked=e}getChecked(){return this.widget.checked}}class C extends g{constructor(e){super(e)}getValue(){const e=[];for(const t of this.checkboxes)t.isChecked()&&e.push(t.getCheckboxValue());return e}initializeData(e){super.initializeData(e),this.choices=void 0===e.choices?[]:e.choices,this.styles=void 0===e.styles?new p.A:e.styles}createCheckboxesField(){const e=document.createElement("div");this.checkboxes=[];for(const t of this.choices){const i=-1!==this.defaultValue.indexOf(String(t.value)),n=new u.m(16,i);n.setName(this.name),n.setCheckboxValue(String(t.value)),this.styles.styleField(n.element),this.disabled&&n.disable(),(0,s.wu)("change",n.element,(()=>{this.fieldChanged.fire()})),this.checkboxes.push(n);const o=document.createElement("label");o.className="checkboxFieldLabel";const r=document.createTextNode(String(t.label));o.appendChild(n.element),o.appendChild(r),e.appendChild(o)}return e}assembleField(){const e=this.createCheckboxesField();this.widgetContainer.appendChild(e)}}class S extends m{constructor(e){super(e)}initializeData(e){super.initializeData(e),this.customElement=e.customElement}getValue(){return""}createField(){return document.createElement("div")}assembleField(){this.widgetContainer.appendChild(this.customElement)}}class x extends f{constructor(e){super({...e,choices:[]})}initializeData(e){super.initializeData({...e,choices:[]}),this.defaultDay=void 0===e.day?"0":e.day.toString(10),this.defaultMonth=void 0===e.month?"0":e.month.toString(10),this.defaultYear=void 0===e.year?"0":e.year.toString(10)}getValue(){return[this.monthField.value,this.dayField.value,this.yearField.value]}createDateField(e,t,i){const s=document.createElement("select");s.name=`${this.name}_${i}`,this.styles.styleField(s);for(const t of e){const e=document.createElement("option");e.innerText=`${t.label}`,e.value=`${t.value}`,s.appendChild(e)}return s.value=t,s.required=this.required,s}getDayOptions(){const e=[];e.push({label:"---",value:"0"});for(let t=1;t<=31;t+=1){const i=t.toString(10);e.push({label:i,value:i})}return e}getMonthOptions(){const e=[],t=[d.R.january,d.R.february,d.R.march,d.R.april,d.R.may,d.R.june,d.R.july,d.R.august,d.R.september,d.R.october,d.R.november,d.R.december];e.push({label:"---",value:"0"});for(let i=0;i<t.length;i+=1)e.push({label:t[i],value:(i+1).toString(10)});return e}getYearOptions(){const e=[],t=(new Date).getFullYear()-18;e.push({label:"---",value:"0"});for(let i=t;i>1900;i-=1){const t=i.toString(10);e.push({label:t,value:t})}return e}assembleField(){this.dayField=this.createDateField(this.getDayOptions(),this.defaultDay,"day"),this.monthField=this.createDateField(this.getMonthOptions(),this.defaultMonth,"month"),this.yearField=this.createDateField(this.getYearOptions(),this.defaultYear,"year"),this.widgetContainer.appendChild(this.monthField),this.widgetContainer.appendChild(this.dayField),this.widgetContainer.appendChild(this.yearField),(0,s.wu)("change",this.dayField,(()=>{this.fieldChanged.fire()})),(0,s.wu)("change",this.monthField,(()=>{this.fieldChanged.fire()})),(0,s.wu)("change",this.yearField,(()=>{this.fieldChanged.fire()}))}}class T extends m{constructor(e){super(e)}initializeData(e){super.initializeData(e),this.styles=void 0===e.styles?new p.n$:e.styles,this.sitekey=e.siteKey}getValue(){return this.recaptcha.getResponse()}createField(){return this.recaptcha=new h,this.styles.styleField(this.recaptcha.element),this.recaptcha.element}assembleField(){this.widget=this.createField(),this.recaptcha.render({sitekey:this.sitekey}),this.widgetContainer.appendChild(this.widget)}onFormError(){super.onFormError(),this.recaptcha.reset()}}},6064:(e,t,i)=>{"use strict";i.d(t,{DC:()=>D,Fd:()=>S,QZ:()=>B});var s=i(352),n=i(7623),o=i(8861),r=i(6784),a=i(2326),l=i(5216),h=i(2939),d=i(8423),c=i(1779),u=i(3124),p=i(2690),m=i(7407),g=i(3049),v=i(3004),f=i(4947),y=i(1372),b=i(5389),w=i(9461),C=i(1224);const S=new d.c_("loginOverlayShown"),x=`${v.k6}?src=login_gate`,T=e=>{"Escape"!==e.key&&e.stopImmediatePropagation()};let P="",k="";h.X0.listen((e=>{P=e.chatConnection.room(),k=e.dossier.roomUid}));let A,M,R=0;function I(e){const t=(0,v.G6)(`/auth-sso/login/${e.provider}/?popup=1`,(0,v.TI)({ignoreExistingRoom:!0}));return(0,y.tT)("a",{className:"auth_option",href:"#",onClick:i=>{i.preventDefault(),R+=1,R>1||((0,m.bT)("SsoSignupClick",{provider:e.provider,source:"loginOverlay"}),(0,b.gr)(t,"_blank",b.NL)),window.setTimeout((()=>{R=0}),1e3)}},(0,y.tT)("div",null,(0,y.tT)("img",{src:`${STATIC_URL_ROOT}images/sso-${e.provider}.svg`,alt:e.provider}),(0,y.tT)("p",null,f.R.signInWithSocialAuth(e.name))))}class E extends p.zf{constructor(){super({onShow:()=>this.onShow(),onHide:e=>this.onHide(e),easyExit:!0}),this.isVisible=!1,this.autofillPollInterval=0,this.requiredForPage=!1,this.tabListenerFactory=(e,t)=>i=>{"Tab"===i.key&&(i.preventDefault(),i.shiftKey?t.focus():e.focus())},this.detectInputFilled=()=>{""!==this.passwordInput.value.trim()&&""!==this.usernameInput.value.trim()?(this.loginButton.removeAttribute("disabled"),this.rememberMeCheckBox.onkeydown=this.tabListenerFactory(this.loginButton,this.forgotPasswordLink),this.loginButton.onkeydown=this.tabListenerFactory(this.signupLink,this.rememberMeCheckBox),this.signupLink.onkeydown=this.tabListenerFactory(this.closeButton,this.loginButton),this.clearAutofillPollInterval()):(this.loginButton.disabled=!0,this.rememberMeCheckBox.onkeydown=this.tabListenerFactory(this.signupLink,this.forgotPasswordLink),this.signupLink.onkeydown=this.tabListenerFactory(this.closeButton,this.rememberMeCheckBox),this.createAutofillPollInterval())},this.clearAutofillPollInterval=()=>{this.autofillPollInterval&&(window.clearInterval(this.autofillPollInterval),this.autofillPollInterval=0)},this.createAutofillPollInterval=()=>{this.autofillPollInterval||(this.autofillPollInterval=window.setInterval((()=>{this.detectInputFilled()}),200))};const e=e=>{const t=document.createElement("div");return t.style.display="block",t.style.margin="10px 0 0 0",e.appendChild(t),t};this.element.style.display="none",this.element.style.position="fixed",this.element.style.fontSize="12px",this.element.style.width="364px",this.element.style.height="auto",this.element.style.color="currentSiteSettings.defaultColor",this.element.style.margin="auto",this.element.style.boxShadow="0px 0px 10px rgba(0, 0, 0, 0.4)",this.element.style.background="white",this.element.style.border="3px solid #0E6C92",this.element.style.borderRadius="10px",this.element.style.visibility="visible",this.element.id="LoginOverlay",this.element.dataset.testid="login-form",this.overlay.classList.add("blurred-login-overlay"),this.overlay.style.visibility="visible",this.overlay.style.background="",this.overlay.style["-webkit-overflow-scrolling"]="touch",this.loginContainer=document.createElement("form"),this.loginContainer.target="_top",this.loginContainer.style.padding="5px 30px 10px 30px",this.loginContainer.action=(0,l._Y)((0,v.G6)(v.ii,(0,v.TI)({ignoreExistingRoom:!0}))),this.loginContainer.method="POST",this.loginContainer.onclick=e=>{e.stopPropagation()},this.element.appendChild(this.loginContainer);const t=e(this.loginContainer),i=e(this.loginContainer),n=e(this.loginContainer),r=e(this.loginContainer),a=e(this.loginContainer),d=e(this.loginContainer),c=e(this.loginContainer),u=e(this.loginContainer),p=e(this.loginContainer);a.style.display="flex",a.style.alignItems="center",this.closeButton=document.createElement("input"),this.closeButton.type="button",this.closeButton.onclick=e=>{e.preventDefault(),this.hide()},this.closeButton.value="",this.closeButton.style.background=`transparent url(${STATIC_URL}close_icon2.svg) no-repeat center center`,this.closeButton.style.backgroundSize="10px",this.closeButton.style.padding="10px 20px 8px 12px",this.closeButton.style.border="none",this.closeButton.style.cursor="pointer",this.closeButton.dataset.testid="login-modal-close-button",t.appendChild(this.closeButton),t.style.position="absolute",t.style.top="0px",t.style.right="0px",t.style.margin="0px",this.header=document.createElement("h1"),this.header.style.font="18px ubuntumedium,Arial,Helvetica,sans-serif",this.header.style.color="#f47422",i.appendChild(this.header),i.style.textAlign="center",this.usernameInput=this.createFormInput(n,`${f.R.usernameText}:`,"text","username"),this.usernameInput.required=!0,this.usernameInput.dataset.testid="username-input",this.forgotPasswordLink=document.createElement("a"),this.forgotPasswordLink.target="_top",this.forgotPasswordLink.href=(0,l._Y)("/auth/password_reset/"),this.forgotPasswordLink.tabIndex=0,this.forgotPasswordLink.textContent=f.R.forgotPassword,this.forgotPasswordLink.style.cssFloat="right",this.forgotPasswordLink.dataset.testid="forgot-password-link",r.appendChild(this.forgotPasswordLink),this.passwordInput=this.createFormInput(r,`${f.R.passwordText}:`,"password","password"),this.passwordInput.required=!0,this.passwordInput.dataset.testid="password-input",this.rememberMeCheckBox=this.createFormInput(a,`${f.R.keepLoggedInText}:`,"checkbox","rememberme"),this.rememberMeCheckBox.style.marginLeft="10px",this.rememberMeCheckBox.dataset.testid="remember-me-check-box",this.loginButton=document.createElement("input"),this.loginButton.dataset.testid="login-button",this.loginButton.id="id_login_btn",this.loginButton.type="submit",this.loginButton.disabled=!0,this.loginButton.value=f.R.loginVerbText,C.m.isWhiteLabel&&(this.loginButton.style.backgroundColor=C.m.signupBgColor),(0,g.kt)()&&(this.loginButton.onclick=()=>{this.loginButton.disabled||(0,s.trackCustomEvent)({name:"LoginRequest",data:{roomName:P,broadcasterID:k}})}),d.appendChild(this.loginButton);const m=w.Bm.current.socialAuths;if(void 0!==m&&m.length>0){const e=(0,y.tT)("div",{className:"or_separator"},(0,y.tT)("p",null," ",f.R.orSimple," "));c.appendChild(e);for(const e of m)c.appendChild(I(e));c.style.marginBottom="16px"}const b=document.createElement("p");b.textContent=`${f.R.dontHaveAccountYet} `,b.style.display="inline",this.signupLink=document.createElement("a"),this.signupLink.target="_top",this.signupLink.classList.add("signupLogin"),this.signupLink.href=x,this.signupLink.tabIndex=0,this.signupLink.textContent=f.R.signUpText,u.appendChild(b),u.appendChild(this.signupLink),u.style.textAlign="center",this.nextField=document.createElement("input"),this.csrfField=document.createElement("input"),this.nextField.type=this.csrfField.type="hidden",this.nextField.name="next",this.nextField.value=(()=>{const e=(0,v.TI)({ignoreExistingRoom:!0});return-1!==(0,v.bP)().indexOf("/al/")||void 0===e.nextParam?"/":e.nextParam})(),this.csrfField.name="csrfmiddlewaretoken",this.csrfField.value=(0,o.I7)("csrftoken"),p.appendChild(this.nextField),p.appendChild(this.csrfField),p.style.display="none",this.closeButton.onkeydown=this.tabListenerFactory(this.usernameInput,this.signupLink),this.usernameInput.onkeydown=this.tabListenerFactory(this.passwordInput,this.closeButton),this.passwordInput.onkeydown=this.tabListenerFactory(this.forgotPasswordLink,this.usernameInput),this.forgotPasswordLink.onkeydown=this.tabListenerFactory(this.rememberMeCheckBox,this.passwordInput),this.rememberMeCheckBox.onkeydown=this.tabListenerFactory(this.loginButton,this.forgotPasswordLink),this.loginButton.onkeydown=this.tabListenerFactory(this.signupLink,this.rememberMeCheckBox),this.signupLink.onkeydown=this.tabListenerFactory(this.closeButton,this.loginButton),this.usernameInput.oninput=this.detectInputFilled,this.passwordInput.oninput=this.detectInputFilled,h.X0.listen((()=>{this.nextField.value=(0,v.bP)()}))}initAndShow(e){var t;if((0,b.GZ)()&&""!==P)(0,b.gr)(`/auth/login/?next=/${P}/`);else{if(S.fire(void 0),this.header.innerText=void 0!==e.fromFeature&&e.fromFeature?f.R.loginToUseFeature:f.R.loginToContinue,this.header.dataset.testid="login-modal-header-text",this.csrfField.value=(0,o.I7)("csrftoken"),this.element.style.display="block",super.show(),void 0!==e.seeBackground&&e.seeBackground&&(this.unhideBodyElement(),this.overlay.style.backgroundColor="rgba(0, 0, 0, 0.5)"),this.signupLink.href=(0,l._Y)(!1===e.returnToPage?x:(0,v.G6)(x,(0,v.TI)({}))),!0===e.refreshOpener){const e=(0,v.TI)({ignoreExistingRoom:!0});void 0!==e.nextParam&&(e.nextParam.endsWith("/")?e.nextParam+="?refresh_opener=1":e.nextParam+="/refresh_opener=1",this.nextField.value=e.nextParam),this.loginContainer.action=(0,l._Y)((0,v.G6)(`${v.ii}`,e)),this.signupLink.href=`${this.signupLink.href}?refresh_opener=1`}this.requiredForPage=null!==(t=e.requiredForPage)&&void 0!==t&&t,this.createAutofillPollInterval(),this.usernameInput.focus()}}createFormInput(e,t,i,s){const n=document.createElement("label"),o=document.createElement("input");return n.innerText=t,n.htmlFor=s,o.type=i,o.id=s,o.name=s,o.style.height="checkbox"===i?"18px":"26px",o.style.width="checkbox"===i?"18px":"100%",o.style.font="100% Arial,Helvetica,sans-serif",o.style.color="#000",o.style.boxSizing="border-box",o.style.border="1px solid #d5d5d5",o.style.padding="2px 4px",o.style.margin="1px 0",o.style.lineHeight="18px",o.style.borderRadius="4px",(0,r.wu)("keydown",o,(e=>{"Enter"===e.key&&(e.preventDefault(),this.loginButton.click())})),e.appendChild(n),e.appendChild(o),o}unhideBodyElement(){void 0!==this.bodyElement&&(this.bodyElement.style.visibility="",this.bodyElement.style.backgroundColor="",this.bodyElement.style.overflow="",this.bodyElement.style.position="",this.bodyElement.classList.remove("blurred-login-overlay-shown","embed-blurred-login-overlay"))}hideBodyElement(){this.unhideBodyElement(),null!==this.element.parentElement&&(this.bodyElement=this.element.parentElement,this.bodyElement.style.overflow="hidden",this.bodyElement.classList.add("blurred-login-overlay-shown"),(0,n.Pb)()&&(this.bodyElement.style.position="fixed",this.bodyElement.classList.add("embed-blurred-login-overlay")))}repositionChildren(){const e=Math.max(document.documentElement.clientWidth,window.innerWidth),t=Math.max(document.documentElement.clientHeight,window.innerHeight);this.element.style.left=(e-this.loginContainer.offsetWidth)/2+"px",this.element.style.top=(t-this.loginContainer.offsetHeight)/2+"px"}onShow(){this.repositionChildren(),this.isVisible=!0,this.usernameInput.focus(),(0,r.wu)("keydown",this.element,T),this.fullscreenChangeListener=c._c.listen((()=>this.hideBodyElement())),this.hideBodyElement()}onHide(e){this.requiredForPage&&!e&&(0,b.EO)();const t=this.isVisible;var i;this.element.style.display="none",this.isVisible=!1,t&&((0,r.Pf)("keydown",this.element,T),null===(i=this.fullscreenChangeListener)||void 0===i||i.removeListener(),this.fullscreenChangeListener=void 0),this.unhideBodyElement(),this.clearAutofillPollInterval()}}class L extends E{constructor(){super(),this.element.style.width="calc(96% - 6px)",this.element.style.maxWidth="364px",this.element.style.margin="",this.element.style.fontSize="12px",this.element.style.position="fixed",this.element.style.overflow="scroll"}createFormInput(e,t,i,s){const n=super.createFormInput(e,t,i,s);return n.style.fontFamily="'UbuntuRegular', Arial, Helvetica, sans-serif",n.style.fontSize="16px",n}repositionChildren(){const e=Math.max(document.documentElement.clientWidth,window.innerWidth),t=Math.max(document.documentElement.clientHeight,window.innerHeight),i=(e-this.loginContainer.offsetWidth)/2;let s=Math.max(50,(t-this.loginContainer.offsetHeight)/2);(0,n.m0)()&&(s=Math.max(50,(t-this.loginContainer.offsetHeight)/5));const o=(0,u.K$)(),r=!o&&t<576;this.element.style.left=`${i}px`,this.element.style.top=r?"0px":`${s}px`,this.element.style.bottom=r?"0px":"",(document.activeElement===this.usernameInput||document.activeElement===this.passwordInput)&&!o&&window.setTimeout((()=>{var e;null===(e=document.activeElement)||void 0===e||e.scrollIntoView()}),510)}}function D(e){w.Bm.current.isMobile?(void 0===M&&(M=new L,(0,m.bT)("LoginOverlayOpened")),M.initAndShow(e)):(void 0===A&&(A=new E,(0,m.bT)("LoginOverlayOpened")),A.initAndShow(e)),(0,a.J)()}function B(){return void 0!==A&&A.isVisible}},2416:(e,t,i)=>{"use strict";i.d(t,{f:()=>n});var s=i(9461);function n(){var e,t;return null!==(e=null===(t=s.Bm.current)||void 0===t?void 0:t.current_logo)&&void 0!==e?e:`${STATIC_URL_ROOT}images/logo.svg`}},5052:(e,t,i)=>{"use strict";i.d(t,{W:()=>a});var s=i(2709),n=i(3955),o=i(7407),r=i(1448);class a extends s.u{constructor(e){super("div",e),this.props=e,this.scrollJumpNeeded=!1}initUI(){this.element=(0,r.rc)()}remove(){(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.props.isConversationShowing())&&this.element.remove()}getScrollJumpNeeded(){return this.scrollJumpNeeded}maybeScrollJump(e){this.scrollJumpNeeded&&(this.scrollJumpNeeded=!1,this.props.setParentScrollTop(e-this.element.offsetHeight))}shouldAppendNewMessageNotice(e,t){const i=1===this.props.getUnreadCount()&&e,s=this.props.isScrolledUp()||!this.props.isConversationShowing(),o=!(0,n.Mo)(this.element,this.props.scrollParentDiv)||!this.props.isConversationShowing();if(t||i&&s&&o){const e=this.props.scrollParentDiv.contains(this.element);return e&&(this.scrollJumpNeeded=this.element.offsetTop<this.props.scrollParentDiv.scrollTop),this.props.isConversationShowing()&&this.trackNoticeAppended(t,e),!0}return!1}trackNoticeAppended(e,t){const i=e?"First History Unread":"Scrolled Out of View";(0,o.bT)("NewMessageLineNoticeAppended",{reason:i,wasRepositioned:t})}render(){return this.element}}},634:(e,t,i)=>{"use strict";i.d(t,{HY:()=>m,tj:()=>u,x4:()=>v,xT:()=>p,zG:()=>c});var s=i(6784),n=i(213),o=i(8423),r=i(7407),a=i(5173),l=i(4947),h=i(9447),d=i(9461);function c(){const e=document.createElement("div");return(0,h.fZ)(e,"title"),e.innerText=l.R.followerBrowserNotifications,e.style.fontFamily="UbuntuBold, Helvetica, Arial, sans-serif",e}function u(){const e=document.createElement("div");return e.innerText=l.R.allowBrowserNotificationsMessage,e.style.margin="5px 0 10px",e.style.fontSize="11px",e}function p(e){const t=document.createElement("div");return(0,h.fZ)(t,"confirmButton"),t.innerText=l.R.yesText,t.style.display="inline-block",t.style.padding="5px 30px",t.style.marginLeft="10px",t.style.borderRadius="3px",t.style.cursor="pointer",(0,s.wu)("click",t,e),t}function m(e){const t=document.createElement("div");return(0,h.fZ)(t,"denyButton"),t.innerText=l.R.notNowText,t.style.display="inline-block",t.style.padding="5px 18px",t.style.cursor="pointer",(0,s.wu)("click",t,e),t}const g={numTimeoutsKey:"numPushNotificationTimeouts",timeoutDateKey:"pushNotificationTimeout"};class v extends a.Q{constructor(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g),this.closed=new o.c_("closed"),e){this.skipOverlay=!0;const e=e=>{e.target!==this.element&&this.element.contains(e.target)||this.close()};return(0,s.wu)("click",document,e),void this.closed.once((()=>{try{(0,s.Pf)("click",document,e)}catch(e){debug("NotificationsModal listener was already removed")}}))}this.overlayClick.listen((()=>{this.close()}))}initData(e){super.initData(),this.numTimeoutsLocalStorageKey=e.numTimeoutsKey,this.timeoutDateLocalStorageKey=e.timeoutDateKey;const t=window.localStorage.getItem(this.numTimeoutsLocalStorageKey),i=window.localStorage.getItem(this.timeoutDateLocalStorageKey);null!==t&&null!==i?(this.timeoutDate=new Date(i),this.numTimeouts=parseInt(t)+1):(this.timeoutDate=new Date,this.numTimeouts=1)}afterDOMConstructedIncludingChildren(){super.afterDOMConstructedIncludingChildren(),this.skipOverlay||this.showOverlay()}canRequestPermission(){return new Date>=this.timeoutDate}close(){this.element.style.display="none",this.skipOverlay||this.hideOverlay(),this.closed.fire(void 0)}subscribeToBrowserPush(e,t){const i=window.subscribeUserToPush;void 0!==d.Bm.current.loggedInUser&&i(d.Bm.current.loggedInUser.signedUsername).then((()=>{e(),(0,r.bT)("PushNotificationSettingsUpdated",{new_status:!0,old_status:!1,location:"notif-modal"})})).catch(t)}onConfirmClick(){this.subscribeToBrowserPush((()=>{}),(e=>{void 0===e||400===e.status?(0,n.Q$)(l.R.followSubscribeFailedMessage):(window.localStorage.removeItem(this.numTimeoutsLocalStorageKey),window.localStorage.removeItem(this.timeoutDateLocalStorageKey))}))}onDenyClick(){const e=new Date,t=Math.min(Math.pow(2,this.numTimeouts),168);this.timeoutDate.setTime(e.getTime()+60*t*60*1e3),window.localStorage.setItem(this.numTimeoutsLocalStorageKey,this.numTimeouts.toString()),window.localStorage.setItem(this.timeoutDateLocalStorageKey,this.timeoutDate.toString())}}},369:(e,t,i)=>{"use strict";i.d(t,{BL:()=>m,Rk:()=>p,oO:()=>d,x0:()=>c});var s=i(7623),n=i(6784),o=i(1519),r=i(2709),a=i(3955),l=i(8423),h=i(8936);const d=new class extends l.c_{listen(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=super.listen(e,t);return u.callFunc(),i}addListener(e,t){super.addListener(e,t),u.callFunc()}}("resizeDebounceEvent");let c=!1;const u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:80;const i=new o.a((()=>{e(!0)}),{bounceLimitMS:t,debounceType:2}),s=new o.a((()=>{e(!1)}),{bounceLimitMS:200,debounceType:1});return(0,n.wu)("resize",window,(()=>{i.callFunc(),s.callFunc()})),(0,n.wu)("orientationchange",window,(()=>{e(!1),window.setTimeout((()=>{e(!1)}),80)})),s}((e=>{c=e,d.fire(e)}));function p(e,t,i,s,n){const o=()=>{const o=e instanceof r.u?e.element:e;s.forEach((e=>{const s=(e=>{const s=e.min instanceof Function?e.min():e.min;return s+((e.max instanceof Function?e.max():e.max)-s)*(Math.max(Math.min(document.body.clientWidth,i),t)-t)/(i-t)})(e);o.style[e.name]=`${s}px`,void 0!==n&&n(s)})),e instanceof r.u&&e.repositionChildrenRecursive()};return d.addListener(o,e),window.setTimeout((()=>{o()})),o}function m(e){const t=new l.c_(`width-less-than${e}`);let i=!1;return d.listen((()=>{(0,h.DK)()<e?i||(i=!0,t.fire(!0)):i&&(i=!1,t.fire(!1))})),t}if((0,s.J0)()&&(0,s.nr)()){const e=document.createElement("div");(0,a.ZM)(e,{position:"absolute",width:"100%"}),document.body.appendChild(e);let t=e.offsetWidth;window.setInterval((()=>{t!==e.offsetWidth&&(d.fire(!0),t=e.offsetWidth)}),150)}},442:(e,t,i)=>{"use strict";i.d(t,{w:()=>c});var s=i(7623),n=i(6784),o=i(2709),r=i(3955),a=i(7407),l=i(4947),h=i(1372);function d(){return(0,h.tT)("svg",{width:"9px",height:"13px",viewBox:"0 0 9 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,h.tT)("path",{d:"M4.50848 7.97048V1.5",stroke:"white","stroke-width":"1.4","stroke-linecap":"round"}),(0,h.tT)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1.24099 4.92406C0.957097 4.66164 0.496814 4.66164 0.21292 4.92406C-0.0709734 5.18648 -0.0709734 5.61194 0.21292 5.87436L3.90125 9.28368C4.18515 9.5461 4.64543 9.5461 4.92932 9.28368L8.67227 5.82387C8.95617 5.56145 8.95617 5.13599 8.67227 4.87357C8.38838 4.61115 7.9281 4.61115 7.6442 4.87357L4.41529 7.85823L1.24099 4.92406ZM0.655497 11.2058C0.298143 11.2058 0.00844965 11.4955 0.00844965 11.8528C0.00844965 12.2102 0.298143 12.4999 0.655498 12.4999H8.3614C8.71876 12.4999 9.00845 12.2102 9.00845 11.8528C9.00845 11.4955 8.71876 11.2058 8.3614 11.2058H0.655497Z",fill:"white"}))}class c extends o.u{constructor(e){super("div",e),this.props=e,this.unreadCount=0,this.hideElement(),(0,n.wu)("animationend",this.element,(e=>{this.buttonContent.classList.remove("flash")}))}initUI(e){const t={maxWidth:`calc(100% - ${(0,r.XJ)()}px)`};this.element=(0,h.tT)("div",{className:"scrollDownButtonWrapper",onClick:()=>this.onClick(),style:t,title:l.R.scrollToBottom,"data-paction":"Chat","data-paction-name":"ScrollDownButton"},(0,h.tT)("div",{className:"scrollDownButton",style:{maxWidth:"calc(100% - 8px)"},ref:e=>this.buttonContent=e},(0,h.tT)(d,null),(0,h.tT)("span",{ref:e=>this.textSpan=e,className:"scrollDownText","data-testid":"scroll-down-text"},l.R.scrollToBottom)))}getUnreadCount(){return this.unreadCount}incUnread(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.unreadCount+=e,this.unreadCount>10?this.setText(l.R.tenPlusNewMessages):this.setText(l.R.nNewMessages(this.unreadCount)),this.flashBackground()}clearUnread(){this.unreadCount=0,this.setText(l.R.scrollToBottom)}setText(e){this.textSpan.textContent=e,this.isShown()&&(0,s.OF)()&&(this.hideElement(),(0,r.aN)(),this.showElement())}flashBackground(){this.isShown()&&this.buttonContent.classList.add("flash")}onClick(){(0,a.bT)("ScrollDownButtonClicked"),this.props.scrollToBottom(),this.hideElement()}repositionChildren(){this.element.style.bottom="string"==typeof this.props.bottomStyle?this.props.bottomStyle:this.props.bottomStyle()}showElement(){this.isShown()||(0===this.unreadCount&&(0,a.bT)("ScrollDownButtonShown"),this.repositionChildren(),super.showElement("flex"))}hideElement(){this.isShown()&&(this.buttonContent.classList.remove("flash"),super.hideElement())}render(){return this.element}}},9466:(e,t,i)=>{"use strict";i.d(t,{QR:()=>h,cL:()=>l,kG:()=>a,r0:()=>r});var s=i(6784),n=i(1519),o=i(8423);function r(e,t){const i=new n.v(t);return(0,s.wu)("scroll",e,(()=>{i.callFunc()})),i}class a extends o.c_{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super("scrollEndDebounceEvent",arguments.length>2?arguments[2]:void 0),this.listenerObj=e,this.scrollOrientation=t,this.lastScroll=this.getCurrentScroll()}get element(){return this.listenerObj instanceof Document?this.listenerObj.documentElement:this.listenerObj}getCurrentScroll(){return 0===this.scrollOrientation?this.element.scrollTop:this.element.scrollLeft}listen(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=super.listen(e,t);return this.registerDebouncer(),i}addListener(e,t){super.addListener(e,t),this.registerDebouncer()}registerDebouncer(){r(this.listenerObj,(e=>{const t=this.getCurrentScroll();this.fire({isStart:e,scrollDirection:t>this.lastScroll?1:0}),this.lastScroll=t}))}}function l(e,t,i){const s=e.scrollLeft;let n;const o=i,r=i=>{n=void 0===n?i:n;const a=i-n;e.scrollLeft=s<t?s+(t-s)*a/o:s-(s-t)*a/o,a<o?window.requestAnimationFrame(r):e.scrollLeft=t};window.requestAnimationFrame(r)}function h(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;const o=new n.a(t,{bounceLimitMS:i,debounceType:2});return(0,s.wu)("scroll",e,(()=>{o.callFunc()})),o}},7404:(e,t,i)=>{"use strict";i.d(t,{W:()=>o,g:()=>s});var s,n=i(8423);!function(e){e.Online="online",e.Offline="offline",e.Hashtag="hashtags",e.History="history",e.Keywords="keywords"}(s||(s={}));const o=new n.c_("SearchBlur")},83:(e,t,i)=>{"use strict";i.d(t,{wx:()=>V,R5:()=>$});var s=i(6624),n=i(4936),o=i(7623),r=i(5216),a=i(6844),l=i(82),h=i(8451),d=i(7882),c=i(7407),u=i(1372),p=i(9447),m=i(9461),g=i(8423),v=i(7404),f=i(1421);const y=new g.c_("SuggestionClicked"),b={display:"inline-block",position:"relative",top:"6px",height:"18px",padding:"5px 10px",width:"18px"},w={display:"inline-block",margin:"0px",position:"relative"},C={borderBottomStyle:"solid",borderBottomWidth:"1px",cursor:"pointer",height:"42px",position:"relative"},S={textDecoration:"none"},x={display:"inline-block",position:"absolute",top:"6px",height:"35px",width:(0,o.Xb)()?"calc(100% - 38px)":"180px"},T={font:"12px UbuntuBold, Arial, Helvetica, sans-serif",marginRight:"0px"},P={font:"12px UbuntuRegular, Arial, Helvetica, sans-serif",marginRight:"0px"};class k extends l.b{getIconClassName(){return""}getStatusText(){return""}getRowClassName(){return""}createLabelElements(e){let t=e.input;t=e.labelText.startsWith("#")?t.replace(/%23/g,"#"):t.replace(/#/g,"");const i=e.labelText.toLowerCase().indexOf(t.toLowerCase()),s=i>=0?e.labelText.slice(i,i+t.length):e.labelText,n=i>0?e.labelText.slice(0,i):"",o=i+t.length<e.labelText.length&&i>=0?e.labelText.slice(i+t.length):"";return[(0,u.tT)("span",{style:T},n),(0,u.tT)("span",{style:P},s),(0,u.tT)("span",{style:T},o),(0,u.tT)("div",{className:"statusText"},this.getStatusText())]}createElement(e){return(0,u.tT)("a",{style:S,href:e.href,tabIndex:-1,onKeyDown:t=>{(0,h.Ci)(t)&&this.onClickHandler(e)},onContextMenu:e=>!(0,o.Xb)()&&!m.Bm.current.isMobile||(e.preventDefault(),!1),onBlur:e=>{v.W.fire(e)},onClick:t=>{""===e.href&&t.preventDefault(),this.onClickHandler(e,t)}},(0,u.tT)("div",{className:this.getRowClassName(),style:C},(0,u.tT)("div",{className:this.getIconClassName(),style:b}),(0,u.tT)("div",{style:x},(0,u.tT)("p",{className:this.getRowClassName(),style:w},this.createLabelElements(e)))))}onClickHandler(e,t){(0,f.ig)(e.labelText,v.g.Online);const i={resultType:"broadcaster",resultString:e.labelText};(0,c.bT)("SearchBarResultsClick",i)}}var A=i(878),M=i(9930);class R extends k{getIconClassName(){return"icon-hashtag"}getStatusText(){return""}getRowClassName(){return"hashtag_suggestion"}onClickHandler(e,t){const i=`#${e.labelText}`;(0,f.ig)(i,v.g.Hashtag);const n={resultType:"hashtag",resultString:i};(0,c.bT)("SearchBarResultsClick",n),void 0!==t&&((0,s.isFilterInPathActive)()&&!m.Bm.current.isMobile||(0,s.isMobileSpaActive)()?s.UrlState.current.state.pageType===s.PageType.HOME&&(t.preventDefault(),s.UrlState.current.navigateTo(e.href)):(M.XS.fire(t),(0,A.AV)()))}}var I=i(4947);const E=new g.c_("historyDeleteClicked"),L={width:"23px",height:"23px",display:"block",position:"absolute",top:"20%",left:"unset",right:"2px",backgroundPosition:"50% top",backgroundSize:"14px 14px"};class D extends k{getIconClassName(){return"icon-history"}getStatusText(){return I.R.previouslySearched}getRowClassName(){return"history_suggestion"}onClickHandler(e,t){const i={resultType:"history",resultString:e.labelText};(0,c.bT)("SearchBarResultsClick",i),e.href.includes("/tag/")?((0,f.ig)(e.labelText,v.g.Hashtag),void 0!==t&&((0,s.isFilterInPathActive)()&&!m.Bm.current.isMobile||(0,s.isMobileSpaActive)()?s.UrlState.current.state.pageType===s.PageType.HOME&&(t.preventDefault(),s.UrlState.current.navigateTo(e.href)):(M.XS.fire(t),(0,A.AV)()))):""!==e.href?(0,f.ig)(e.labelText,v.g.Online):y.fire(e.labelText)}createElement(e){const t=super.createElement(e),i=(0,o.Xb)()?L:{},s=(0,u.tT)("div",{style:i,className:"historyDelete",onClick:e=>{e.preventDefault(),e.stopPropagation()},onMouseDown:t=>{t.ctrlKey||t.metaKey||2===t.button||((0,f.og)(e.labelText),E.fire(e.labelText),t.preventDefault(),t.stopPropagation())}}),n=t.firstElementChild;if(null!==n){const e=n.lastElementChild;null!==e&&e.appendChild(s)}return t}}var B=i(9060);const U=new g.c_("keywordsSearchClicked");class _ extends k{getIconClassName(){return"icon-keywords"}getStatusText(){return"in room subjects and tags"}getRowClassName(){return"keywords_suggestion"}onClickHandler(e,t){null==t||t.preventDefault(),U.fire();const i=(0,B.fm)();void 0!==i&&(0,c.bT)("KeywordsSearch",{active_test:i,keywords:e.input})}}var F=i(6716);class N extends k{getIconClassName(){return"icon-offline"}getStatusText(){return I.R.recentlyOnline}getRowClassName(){return"broadcaster_suggestion"}onClickHandler(e,t){super.onClickHandler(e,t),(0,M.r)()&&(null==t||t.preventDefault(),F.VZ.fire(e.labelText))}}class O extends k{getIconClassName(){return"icon-online"}getStatusText(){return I.R.broadcastingNow}getRowClassName(){return"broadcaster_suggestion"}onClickHandler(e,t){super.onClickHandler(e,t),(0,M.r)()&&(null==t||t.preventDefault(),F.VZ.fire(e.labelText))}}var H=i(7995);const W=[v.g.Hashtag,v.g.Online,v.g.Offline],$="Tab";class V extends l.b{constructor(){super(...arguments),this.currentIndex=-1,this.highestIndex=-1,this.keyNavigated=!1,this.pauseSuggestions=!1,this.timeoutId=0}createElement(e){return(0,u.tT)("div",{className:"suggestionsDiv"})}initData(e){this.input=e.input,this.searchInput=e.searchInput,this.suggestionsList=[],this.gender=(0,d.Bg)(),H.D.onSubmit.listen((()=>{this.lastSearch=void 0})),y.listen((e=>{null!==e&&(this.input.value=e,this.searchInput.onSubmitSearchInput())})),E.listen((e=>{const t=this.suggestionsList.findIndex((t=>t.label===e));this.suggestionsList[t].element.remove(),this.suggestionsList.splice(t,1),this.highestIndex=this.suggestionsList.length-1,this.showSuggestions(),this.input.focus(),this.input.select()})),U.listen((()=>{this.searchInput.onSubmitSearchInput()}))}styleActiveSuggestion(e){(0,p.fZ)(e,"active")}styleInactiveSuggestion(e){(0,p.SA)(e,"active")}removeExistingSuggestions(){for(this.suggestionsList=[],this.highestIndex=-1;null!==this.element.lastChild;)this.element.removeChild(this.element.lastChild);this.hideElement()}createUrlForHashtagSuggestion(e){const t={...!m.Bm.current.isMobile||(0,s.isMobileSpaActive)()?(0,s.getFilterPanelPartialState)():{},pageType:s.PageType.HOME,genders:s.UrlState.current.state.genders,tags:[e]};return s.UrlState.current.convertStateToUrl(t)}createUrlForKeywordsSuggestion(e){const t={...!m.Bm.current.isMobile||(0,s.isMobileSpaActive)()?(0,s.getFilterPanelPartialState)():{},pageType:s.PageType.HOME,genders:s.UrlState.current.state.genders,keywords:e};return s.UrlState.current.convertStateToUrl(t)}createSuggestion(e,t,i,s,n){let o,r=`/${e}/`;switch(this.gender=(0,d.Bg)(),i){case v.g.Online:o=new O({labelText:e,input:t,count:s,href:r}).element;break;case v.g.Offline:o=new N({labelText:e,input:t,count:s,href:r}).element;break;case v.g.Hashtag:r=this.createUrlForHashtagSuggestion(e),o=new R({labelText:e,input:t,count:s,href:r}).element,o.dataset.testid="search-hashtag-suggestion";break;case v.g.Keywords:r=this.createUrlForKeywordsSuggestion(t),o=new _({labelText:e,input:t,count:s,href:r}).element,o.dataset.testid="search-keywords-suggestion";break;default:n===v.g.Hashtag?r=this.createUrlForHashtagSuggestion(e.replace("#","")):n===v.g.History&&(r=""),o=new D({labelText:e,input:t,count:s,href:r}).element}this.element.appendChild(o);const a=o.firstElementChild;a.onmouseenter=()=>{this.styleInactiveLastSug(),this.styleActiveSuggestion(a);const e=o.getAttribute("index");null!==e&&(this.currentIndex=parseInt(e,10)),this.keyNavigated=!1},a.onmouseleave=()=>{this.styleInactiveLastSug(),this.styleInactiveSuggestion(a),this.currentIndex=-1,this.keyNavigated=!1},this.suggestionsList.push({label:e,element:a,resultType:i})}navigateSuggestions(e){if(this.suggestionsList.length>0){this.saveFirstText(),this.keyNavigated=!0;const t=this.currentIndex;t>-1&&this.styleInactiveSuggestion(this.suggestionsList[t].element),this.tabThroughSuggestions(e),(0,h.LV)(e)?this.currentIndex=this.currentIndex+1<=this.highestIndex?this.currentIndex+1:0:(0,h.IM)(e)&&(this.currentIndex=this.currentIndex-1>=0?this.currentIndex-1:this.highestIndex,e.preventDefault());const i=this.suggestionsList[this.currentIndex];void 0!==i&&(this.replaceInputValue(i),this.styleActiveSuggestion(i.element)),this.styleAllInactiveSuggestions()}}replaceInputValue(e){var t;const i=null!==(t=e.element.getAttribute("class"))&&void 0!==t?t:"";""!==i&&e.resultType!==v.g.Keywords&&(this.input.value=i.includes("hashtag_suggestion")?`#${e.label}`:e.label)}tabThroughSuggestions(e){if(e.key===$)if(this.currentIndex>-1&&this.currentIndex<=this.highestIndex){if(e.shiftKey){if(0===this.currentIndex)return this.resetSuggestionsNavigation(),void(this.input.value=this.firstText);this.currentIndex=this.currentIndex-1}else{if(this.currentIndex===this.highestIndex)return this.resetSuggestionsNavigation(),void(this.input.value=this.firstText);this.currentIndex=this.currentIndex+1}e.preventDefault()}else-1!==this.currentIndex||e.shiftKey||(this.currentIndex=0,e.preventDefault())}saveFirstText(){this.keyNavigated||(this.firstText=this.input.value)}getSuggestionsAfterTime(e){if(this.pauseSuggestions)""===this.input.value&&this.removeExistingSuggestions();else{0!==this.timeoutId&&window.clearTimeout(this.timeoutId);const t=this.input.value.trim().replace(/^#/,"%23"),i=t.split(" "),s=e=>e.some((e=>e.length>30))||e.length>6||t.length>60,n=(0,d.Bg)();t===this.lastSearch&&this.gender===n||s(i)?(s(i)&&this.showHistorySuggestions(t),e?this.showSuggestions():this.hideSuggestions()):this.timeoutId=window.setTimeout((()=>{this.suggestionPromise=this.getSuggestions(e)}),250)}}styleAllInactiveSuggestions(){for(const e of this.suggestionsList)e!==this.suggestionsList[this.currentIndex]&&this.styleInactiveSuggestion(e.element)}async getSuggestions(e){const t=this.input.value,i=t.trim().replace(/^#/,"%23");return this.timeoutId=0,""===t?(this.lastSearch=void 0,this.showHistorySuggestions(t),void this.showSuggestions()):await(0,r.Aw)(`ax/search/?keywords=${i}`).then((s=>{if(this.input.value!==t)return;this.lastSearch=i,this.showHistorySuggestions(t);let o=this.suggestionsList.length;const r=new n.N6(s.responseText);W.forEach((e=>{const i=r.getStringList(e);void 0!==i&&i.forEach((i=>{o>=10||(this.createSuggestion(i,t,e,o),this.highestIndex=o,o+=1)}))})),this.preventShow?this.preventShow=!1:e?this.showSuggestions():this.hideSuggestions()})).catch((e=>{this.pauseSuggestions=!0,window.setTimeout((()=>{this.pauseSuggestions=!1}),6e4),(0,c.bT)("TooManySearchAutocompleteError"),warn("Too many autocomplete queries, wait before resuming",e)}))}showHistorySuggestions(e){if(this.removeExistingSuggestions(),""!==e&&new n.yk(["SbjSrch","SbjSrchSrt"],"RlSbjSrch").active){const t=`Search "${e}"`;this.createSuggestion(t,e,v.g.Keywords,0)}this.createHistorySuggestions(e),this.highestIndex=this.suggestionsList.length-1}createHistorySuggestions(e){if(!(0,o.Pf)())return;(0,f.Y4)();let t=0;if(!(0,a.ok)()){const i=window.localStorage.getItem((0,f.Dc)());null!==i&&JSON.parse(i).forEach((i=>{void 0!==i.content&&i.content.includes(e.replace(/%23/g,"#").toLowerCase())&&(t+=1,this.createSuggestion(i.content,e,v.g.History,t,i.type))}))}}hideSuggestions(){this.styleInactiveLastSug(),this.hideElement(),this.resetSuggestionsNavigation(),window.setTimeout((()=>{document.activeElement instanceof HTMLElement&&this.element.contains(document.activeElement)&&document.activeElement.blur()}))}getCurrentNavigatedSuggestion(){return this.suggestionsList[this.currentIndex]}isSuggestionsNavigated(){return this.keyNavigated&&this.currentIndex>-1&&this.suggestionsList.length>this.currentIndex}resetSuggestionsNavigation(){this.currentIndex=-1,this.keyNavigated=!1}styleInactiveLastSug(){this.currentIndex>-1&&this.suggestionsList.length>this.currentIndex&&this.styleInactiveSuggestion(this.suggestionsList[this.currentIndex].element)}preventShowOnGetSuggestions(e){this.preventShow=e}showSuggestions(){this.suggestionsList.length&&document.activeElement===this.input?this.showElement():this.hideElement()}}},1421:(e,t,i)=>{"use strict";i.d(t,{Dc:()=>a,Y4:()=>d,ig:()=>l,og:()=>h});var s=i(7623),n=i(9461);const o="searchHistory",r=5;function a(){return void 0!==n.Bm.current.loggedInUser?`${o}:${n.Bm.current.loggedInUser.username}`:""}function l(e,t){if((0,s.Pf)()&&void 0!==n.Bm.current.loggedInUser&&""!==e){const i=e.toLowerCase().trim(),s=window.localStorage.getItem(a()),n={content:i,type:t};let o=JSON.stringify([n]);if(null!==s){const e=JSON.parse(s);let t=0;for(const s of e){if(s.content===i){e.splice(t,1);break}t+=1}e.unshift(n),e.length>r&&e.pop(),o=JSON.stringify(e)}window.localStorage.setItem(a(),o)}}function h(e){if(!(0,s.Pf)())return;const t=window.localStorage.getItem(a());if(null!==t){const i=null!==t?JSON.parse(t):[];i.splice(i.findIndex((t=>t.content===e)),1);const s=JSON.stringify(i);window.localStorage.setItem(a(),s)}}function d(){const e=window.localStorage.getItem(a());if(null!==e)try{const t=JSON.parse(e);for(const e of t)if(void 0===e.content||void 0===e.type)return void window.localStorage.removeItem(a())}catch{return warn("Failed to parse and iterate search history, clearing",{searchHistory:e}),void window.localStorage.removeItem(a())}}},7995:(e,t,i)=>{"use strict";i.d(t,{D:()=>w});var s=i(6624),n=i(7623),o=i(5216),r=i(82),a=i(3955),l=i(8423),h=i(8451),d=i(9060),c=i(4947),u=i(1372),p=i(2945),m=i(9232),g=i(9461),v=i(7321),f=i(7404),y=i(83),b=i(1421);class w extends r.b{constructor(){super(...arguments),this.searchKeywords=""}createElement(e){const t=void 0!==(0,d.fm)(),i=t?"SbjSrch":"",s=t?c.R.searchBarPlaceholderSbjSrch:c.R.searchBarPlaceholder;return(0,u.tT)("div",{className:`SearchInput ${i}`,id:"SearchInput"},(0,u.tT)("form",{id:"filter_search_form",method:"GET",action:(0,o._Y)("/"),ref:e=>{this.form=e}},(0,u.tT)("input",{type:"text",style:{display:"none"}}),(0,u.tT)("input",{type:"password",style:{display:"none"}}),(0,u.tT)("input",{id:"keywords",name:"keywords",className:"search_input",maxLength:150,placeholder:s,type:"text",autocomplete:"off",ref:e=>{this.input=e},onFocus:e=>{this.isFocusInsideSearch(e)&&this.onInputFocus()},onBlur:e=>{f.W.fire(e)},onInput:()=>{this.onInput()},onKeyDown:e=>{this.inputKeyDown(e)}}),(0,u.tT)("div",{className:"inputDelete",ref:e=>{this.delete=e},onMouseDown:e=>{e.ctrlKey||e.metaKey||2===e.button||this.onInputDeleteClick(e)}}),this.initSuggestions()))}initUI(e){super.initUI(e),this.styleInputDelete()}initSuggestions(){return(0,u.tT)(y.wx,{classRef:e=>{this.suggestionsDiv=e},input:this.input,searchInput:this})}initData(e){var t,i;super.initData(e),this.pushSearches=null!==(t=e.pushSearches)&&void 0!==t&&t,this.searchKeywords=(0,s.cleanSearchKeyword)(null!==(i=new URLSearchParams(window.location.search).get("keywords"))&&void 0!==i?i:""),(0,p.KZ)(new Map([["keywords",this.searchKeywords]])),m.y.fire(this.searchKeywords),this.input.value=this.searchKeywords,f.W.listen((e=>{this.isFocusInsideSearch(e)||window.setTimeout((()=>{this.onInputBlur()}),250)})),""!==this.input.value&&(this.suggestionsDiv.getSuggestionsAfterTime(!1),(0,b.ig)(this.input.value,f.g.History))}inputKeyDown(e){(0,h.Ci)(e)?(e.preventDefault(),this.suggestionsDiv.styleInactiveLastSug(),this.suggestionsDiv.isSuggestionsNavigated()?this.suggestionsDiv.getCurrentNavigatedSuggestion().element.click():this.onSubmitSearchInput()):"ArrowDown"===e.key||"ArrowUp"===e.key||e.key===y.R5?this.suggestionsDiv.navigateSuggestions(e):e.shiftKey||e.key===y.R5||(this.suggestionsDiv.styleInactiveLastSug(),this.suggestionsDiv.resetSuggestionsNavigation()),this.styleInputDelete()}onInputFocus(){this.styleInputDelete(),this.suggestionsDiv.getSuggestionsAfterTime(!0)}onInputBlur(){this.suggestionsDiv.hideSuggestions()}styleInputDelete(){""!==this.input.value?(0,a.ZM)(this.delete,{visibility:"visible",display:"block"}):(0,a.ZM)(this.delete,{visibility:"hidden",display:"none"})}onInputDeleteClick(e){this.input.value="",this.styleInputDelete(),(0,n.J0)()&&this.onInputFocus(),this.input.focus(),this.suggestionsDiv.getSuggestionsAfterTime(!0),e.preventDefault(),e.stopImmediatePropagation()}showInputBar(){(0,a.ZM)(this.input,{display:"block"}),(0,a.ZM)(this.delete,{visibility:"visible"})}hideInputBar(){(0,a.ZM)(this.input,{display:"none"}),(0,a.ZM)(this.delete,{visibility:"hidden"}),this.suggestionsDiv.hideSuggestions()}showHideInputBar(){""!==this.input.value?this.showInputBar():this.hideInputBar()}onInput(){this.suggestionsDiv.getSuggestionsAfterTime(!0),this.styleInputDelete()}onSubmitSearchInput(){const e=new URLSearchParams(window.location.search);if(0!==this.input.value.trim().length||e.has("keywords")){if(this.searchKeywords=(0,s.cleanSearchKeyword)(this.input.value),!window.location.pathname.includes("/tags/")){const e=new Map([["keywords",this.searchKeywords],["page",""]]);this.pushSearches?(0,p.W2)(e):(0,p.KZ)(e)}this.input.value=this.searchKeywords,this.input.blur(),this.styleInputDelete(),this.suggestionsDiv.hideSuggestions(),(0,b.ig)(this.searchKeywords,f.g.History),this.completeSearch()}}completeSearch(){w.onSubmit.fire(this.searchKeywords),window.scrollTo(0,0),this.suggestionsDiv.preventShowOnGetSuggestions(!0),window.setTimeout((()=>{this.suggestionsDiv.preventShowOnGetSuggestions(!1)}),400),v.HA.getInstance().loadRooms((()=>{g.Bm.current.isMobile?this.styleInputDelete():this.showHideInputBar(),m.y.fire(this.searchKeywords)})),((0,d.rT)()||(0,s.isMobileSpaShown)())&&s.UrlState.current.setPartialState({pageType:s.PageType.HOME,keywords:this.searchKeywords.slice(0,s.KEYWORDS_LENGTH_LIMIT)})}isFocusInsideSearch(e){return this.element.contains(document.activeElement)||this.input===document.activeElement||e.relatedTarget instanceof Node&&this.element.contains(e.relatedTarget)}}w.onSubmit=new l.c_("onSubmit")},3885:(e,t,i)=>{"use strict";i.d(t,{N:()=>n,_:()=>o});var s=i(1372);function n(e){const t={width:"30px",height:"31px",background:`url("${STATIC_URL_ROOT}images/loading_spinner.svg")`,backgroundSize:"cover",animationName:"spin",animationDuration:"2s",animationTimingFunction:"linear",animationIterationCount:"infinite",...e.extraStyle};return(0,s.tT)("div",{style:t})}function o(e){const t={display:!0===e.startHidden?"none":"block",width:"100%",height:"100%",position:"absolute",...e.extraStyle};return(0,s.tT)("div",{style:t,ref:e.myRef},(0,s.tT)(n,{extraStyle:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",margin:"-15px 0 0 -15px"}}))}},394:(e,t,i)=>{"use strict";i.d(t,{k:()=>h});var s=i(2709),n=i(7882),o=i(4947),r=i(1372);const a={marginLeft:"8px",verticalAlign:"middle",fontSize:"14px"},l={marginLeft:"10px",fontSize:"14px"};class h extends s.u{constructor(){super(),this.element=(0,r.tT)("form",{className:"subgenderModal",style:{position:"relative"}},(0,r.tT)("p",{style:l},o.R.subgenderSelectionHeader),(0,r.tT)("p",{style:l},o.R.subgenderSelectionPrompt),(0,r.tT)("div",{style:{margin:"5px"}},(0,r.tT)("input",{type:"radio",name:"subgender",id:"subgender1",value:n.CM.Transfemme,checked:!0}),(0,r.tT)("label",{style:a,htmlFor:"subgender1"},o.R.subgenderFemme)),(0,r.tT)("div",{style:{margin:"5px"}},(0,r.tT)("input",{type:"radio",name:"subgender",id:"subgender2",value:n.CM.Transmasc}),(0,r.tT)("label",{style:a,htmlFor:"subgender2"},o.R.subgenderMasc)),(0,r.tT)("div",{style:{margin:"5px"}},(0,r.tT)("input",{type:"radio",name:"subgender",id:"subgender3",value:n.CM.Nonbinary}),(0,r.tT)("label",{style:a,htmlFor:"subgender3"},o.R.subgenderNonbinary)))}}},664:(e,t,i)=>{"use strict";i.d(t,{S:()=>o});var s=i(3957),n=i(1372);function o(e){switch(e){case s.PL.InTrouble:return(0,n.tT)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,n.tT)("g",{opacity:"0.4","clip-path":"url(#clip0)"},(0,n.tT)("path",{d:"M22.948 10.5C22.8167 10.5054 22.6878 10.5366 22.5686 10.5919C22.4494 10.6471 22.3423 10.7253 22.2533 10.822C22.1643 10.9187 22.0953 11.0319 22.0501 11.1553C22.0049 11.2787 21.9845 11.4097 21.99 11.541C21.996 11.692 22 11.841 22 11.999C21.9983 14.1333 21.3133 16.2109 20.0452 17.9277C18.7772 19.6444 16.9927 20.91 14.9533 21.5391C12.9138 22.1682 10.7265 22.1278 8.71174 21.4237C6.69694 20.7196 4.96052 19.3889 3.7568 17.6265C2.55309 15.864 1.94533 13.7625 2.02255 11.6296C2.09976 9.4967 2.85789 7.44458 4.1859 5.77379C5.5139 4.103 7.342 2.90132 9.40244 2.34478C11.4629 1.78823 13.6474 1.90606 15.636 2.68099C15.8831 2.77753 16.1583 2.77197 16.4013 2.66555C16.5216 2.61285 16.6303 2.53697 16.7213 2.44225C16.8123 2.34753 16.8837 2.23582 16.9315 2.11349C16.9793 1.99116 17.0025 1.86062 16.9999 1.72931C16.9972 1.59801 16.9688 1.46851 16.9161 1.34821C16.8634 1.22791 16.7875 1.11917 16.6928 1.02819C16.598 0.937219 16.4863 0.865792 16.364 0.817991C13.9758 -0.114361 11.3518 -0.257336 8.87638 0.410013C6.40101 1.07736 4.20443 2.51995 2.60851 4.52641C1.01259 6.53286 0.101223 8.9977 0.00794807 11.5598C-0.0853267 14.1218 0.644395 16.6464 2.09019 18.7636C3.53599 20.8808 5.62185 22.4793 8.04214 23.3249C10.4624 24.1704 13.0899 24.2187 15.5396 23.4624C17.9893 22.7062 20.1324 21.1853 21.6549 19.1226C23.1774 17.0599 23.9992 14.5637 24 12C24 11.818 24 11.639 23.988 11.459C23.9711 11.1961 23.8536 10.9499 23.66 10.7713C23.4663 10.5928 23.2114 10.4956 22.948 10.5Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M20.5 9.49994C21.4283 9.49994 22.3185 9.13119 22.9749 8.47482C23.6313 7.81844 24 6.9282 24 5.99994C24 4.42994 21.951 1.34094 21.323 0.431943C21.2261 0.305815 21.1014 0.203655 20.9587 0.133354C20.816 0.0630519 20.6591 0.0264893 20.5 0.0264893C20.3409 0.0264893 20.184 0.0630519 20.0413 0.133354C19.8986 0.203655 19.7739 0.305815 19.677 0.431943C19.049 1.34094 17 4.42994 17 5.99994C17 6.9282 17.3687 7.81844 18.0251 8.47482C18.6815 9.13119 19.5717 9.49994 20.5 9.49994ZM20.285 3.19094C20.3071 3.15364 20.3386 3.12273 20.3763 3.10127C20.414 3.0798 20.4566 3.06852 20.5 3.06852C20.5434 3.06852 20.586 3.0798 20.6237 3.10127C20.6614 3.12273 20.6929 3.15364 20.715 3.19094C21.3011 4.04677 21.7357 4.99692 22 5.99994C22 6.39777 21.842 6.7793 21.5607 7.0606C21.2794 7.34191 20.8978 7.49994 20.5 7.49994C20.1022 7.49994 19.7206 7.34191 19.4393 7.0606C19.158 6.7793 19 6.39777 19 5.99994C19.2643 4.99692 19.6989 4.04677 20.285 3.19094Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M7.50827 18.37C7.73904 18.5003 8.01212 18.5338 8.2675 18.4629C8.52289 18.392 8.73969 18.2226 8.87027 17.992C9.16681 17.4109 9.61344 16.9197 10.1638 16.5695C10.7142 16.2192 11.3483 16.0226 12.0003 16C12.6523 16.0226 13.2863 16.2192 13.8367 16.5695C14.3871 16.9197 14.8337 17.4109 15.1303 17.992C15.2653 18.2138 15.4813 18.3743 15.7325 18.4397C15.9838 18.5051 16.2507 18.4702 16.4767 18.3424C16.7027 18.2146 16.8701 18.0039 16.9436 17.7549C17.017 17.5058 16.9907 17.238 16.8703 17.008C16.4021 16.1166 15.7032 15.3672 14.8466 14.8381C13.9899 14.309 13.007 14.0195 12.0003 14C10.9936 14.0195 10.0106 14.309 9.15396 14.8381C8.29732 15.3672 7.59843 16.1166 7.13027 17.008C6.99993 17.2388 6.96652 17.5118 7.0374 17.7672C7.10828 18.0226 7.27764 18.2394 7.50827 18.37Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M8.5 11.5C9.60457 11.5 10.5 10.6046 10.5 9.5C10.5 8.39543 9.60457 7.5 8.5 7.5C7.39543 7.5 6.5 8.39543 6.5 9.5C6.5 10.6046 7.39543 11.5 8.5 11.5Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M15.5 11.5C16.6046 11.5 17.5 10.6046 17.5 9.5C17.5 8.39543 16.6046 7.5 15.5 7.5C14.3954 7.5 13.5 8.39543 13.5 9.5C13.5 10.6046 14.3954 11.5 15.5 11.5Z",fill:"#49494F"})),(0,n.tT)("defs",null,(0,n.tT)("clipPath",{id:"clip0"},(0,n.tT)("rect",{width:"24",height:"24",fill:"white"}))));case s.PL.Unhappy:return(0,n.tT)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,n.tT)("g",{opacity:"0.4","clip-path":"url(#clip0)"},(0,n.tT)("path",{d:"M12 0C9.62663 0 7.30655 0.703788 5.33316 2.02236C3.35977 3.34094 1.8217 5.21509 0.913451 7.4078C0.00519943 9.60051 -0.232441 12.0133 0.230582 14.3411C0.693605 16.6689 1.83649 18.8071 3.51472 20.4853C5.19295 22.1635 7.33115 23.3064 9.65892 23.7694C11.9867 24.2324 14.3995 23.9948 16.5922 23.0866C18.7849 22.1783 20.6591 20.6402 21.9776 18.6668C23.2962 16.6935 24 14.3734 24 12C23.9966 8.81846 22.7312 5.76821 20.4815 3.51852C18.2318 1.26883 15.1815 0.00344108 12 0V0ZM12 22C10.0222 22 8.08879 21.4135 6.4443 20.3147C4.79981 19.2159 3.51809 17.6541 2.76121 15.8268C2.00433 13.9996 1.8063 11.9889 2.19215 10.0491C2.578 8.10929 3.53041 6.32746 4.92894 4.92893C6.32746 3.53041 8.10929 2.578 10.0491 2.19215C11.9889 1.8063 13.9996 2.00433 15.8268 2.7612C17.6541 3.51808 19.2159 4.79981 20.3147 6.4443C21.4135 8.08879 22 10.0222 22 12C21.9971 14.6513 20.9426 17.1931 19.0679 19.0679C17.1931 20.9426 14.6513 21.9971 12 22Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M8 11C9.10457 11 10 10.1046 10 9C10 7.89543 9.10457 7 8 7C6.89543 7 6 7.89543 6 9C6 10.1046 6.89543 11 8 11Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M16 11C17.1046 11 18 10.1046 18 9C18 7.89543 17.1046 7 16 7C14.8954 7 14 7.89543 14 9C14 10.1046 14.8954 11 16 11Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M17.2149 14.186C15.7885 13.873 14.3036 13.9565 12.9212 14.4273C11.5389 14.8982 10.3118 15.7384 9.37291 16.857C9.27893 16.9558 9.20617 17.0728 9.1591 17.2009C9.11203 17.3289 9.09164 17.4651 9.09919 17.6013C9.10674 17.7375 9.14206 17.8707 9.20299 17.9927C9.26392 18.1147 9.34917 18.223 9.45349 18.3109C9.55781 18.3987 9.679 18.4643 9.80961 18.5036C9.94022 18.5429 10.0775 18.555 10.213 18.5393C10.3484 18.5236 10.4793 18.4803 10.5974 18.4122C10.7155 18.344 10.8185 18.2524 10.8999 18.143C11.6044 17.3047 12.5248 16.6752 13.5614 16.3227C14.5981 15.9701 15.7115 15.908 16.7809 16.143C16.9099 16.1734 17.0437 16.1779 17.1745 16.1561C17.3053 16.1344 17.4305 16.0868 17.5427 16.0163C17.6549 15.9457 17.752 15.8536 17.8283 15.7451C17.9046 15.6367 17.9586 15.5142 17.9871 15.3847C18.0156 15.2552 18.0181 15.1214 17.9944 14.9909C17.9707 14.8605 17.9213 14.7361 17.8491 14.6249C17.7768 14.5137 17.6832 14.418 17.5737 14.3433C17.4641 14.2687 17.3408 14.2165 17.2109 14.19L17.2149 14.186Z",fill:"#49494F"})),(0,n.tT)("defs",null,(0,n.tT)("clipPath",{id:"clip0"},(0,n.tT)("rect",{width:"24",height:"24",fill:"white"}))));case s.PL.Indifferent:return(0,n.tT)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,n.tT)("g",{opacity:"0.4","clip-path":"url(#clip0)"},(0,n.tT)("path",{d:"M17 15H7C6.73478 15 6.48043 15.1054 6.29289 15.2929C6.10536 15.4804 6 15.7348 6 16C6 16.2652 6.10536 16.5196 6.29289 16.7071C6.48043 16.8946 6.73478 17 7 17H17C17.2652 17 17.5196 16.8946 17.7071 16.7071C17.8946 16.5196 18 16.2652 18 16C18 15.7348 17.8946 15.4804 17.7071 15.2929C17.5196 15.1054 17.2652 15 17 15Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M12 0C9.62663 0 7.30655 0.703788 5.33316 2.02236C3.35977 3.34094 1.8217 5.21509 0.913451 7.4078C0.00519943 9.60051 -0.232441 12.0133 0.230582 14.3411C0.693605 16.6689 1.83649 18.8071 3.51472 20.4853C5.19295 22.1635 7.33115 23.3064 9.65892 23.7694C11.9867 24.2324 14.3995 23.9948 16.5922 23.0866C18.7849 22.1783 20.6591 20.6402 21.9776 18.6668C23.2962 16.6935 24 14.3734 24 12C23.9966 8.81846 22.7312 5.76821 20.4815 3.51852C18.2318 1.26883 15.1815 0.00344108 12 0V0ZM12 22C10.0222 22 8.08879 21.4135 6.4443 20.3147C4.79981 19.2159 3.51809 17.6541 2.76121 15.8268C2.00433 13.9996 1.8063 11.9889 2.19215 10.0491C2.578 8.10929 3.53041 6.32746 4.92894 4.92893C6.32746 3.53041 8.10929 2.578 10.0491 2.19215C11.9889 1.8063 13.9996 2.00433 15.8268 2.7612C17.6541 3.51808 19.2159 4.79981 20.3147 6.4443C21.4135 8.08879 22 10.0222 22 12C21.9971 14.6513 20.9426 17.1931 19.0679 19.0679C17.1931 20.9426 14.6513 21.9971 12 22Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M8 11C9.10457 11 10 10.1046 10 9C10 7.89543 9.10457 7 8 7C6.89543 7 6 7.89543 6 9C6 10.1046 6.89543 11 8 11Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M16 11C17.1046 11 18 10.1046 18 9C18 7.89543 17.1046 7 16 7C14.8954 7 14 7.89543 14 9C14 10.1046 14.8954 11 16 11Z",fill:"#49494F"})),(0,n.tT)("defs",null,(0,n.tT)("clipPath",{id:"clip0"},(0,n.tT)("rect",{width:"24",height:"24",fill:"white"}))));case s.PL.Smirk:return(0,n.tT)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,n.tT)("g",{opacity:"0.4","clip-path":"url(#clip0)"},(0,n.tT)("path",{d:"M17.8871 13.077C17.7659 13.0264 17.6359 13.0002 17.5046 12.9999C17.3732 12.9996 17.2431 13.0251 17.1216 13.0751C17.0002 13.125 16.8897 13.1984 16.7967 13.291C16.7036 13.3837 16.6296 13.4938 16.5791 13.615C16.0168 14.9609 14.9436 16.0289 13.595 16.5845C12.2463 17.1402 10.7323 17.1382 9.38508 16.579C9.14028 16.4769 8.86495 16.4762 8.61965 16.5771C8.37436 16.678 8.17918 16.8722 8.07708 17.117C7.97497 17.3618 7.97429 17.6371 8.07518 17.8824C8.17608 18.1277 8.37028 18.3229 8.61508 18.425C10.4519 19.1885 12.5166 19.1918 14.3558 18.4344C16.1951 17.6769 17.6586 16.2205 18.4251 14.385C18.4756 14.2638 18.5018 14.1338 18.5022 14.0025C18.5025 13.8711 18.477 13.741 18.427 13.6195C18.377 13.4981 18.3036 13.3876 18.211 13.2946C18.1184 13.2015 18.0083 13.1275 17.8871 13.077Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M12 0C9.62663 0 7.30655 0.703788 5.33316 2.02236C3.35977 3.34094 1.8217 5.21509 0.913451 7.4078C0.00519943 9.60051 -0.232441 12.0133 0.230582 14.3411C0.693605 16.6689 1.83649 18.8071 3.51472 20.4853C5.19295 22.1635 7.33115 23.3064 9.65892 23.7694C11.9867 24.2324 14.3995 23.9948 16.5922 23.0866C18.7849 22.1783 20.6591 20.6402 21.9776 18.6668C23.2962 16.6935 24 14.3734 24 12C23.9966 8.81846 22.7312 5.76821 20.4815 3.51852C18.2318 1.26883 15.1815 0.00344108 12 0V0ZM12 22C10.0222 22 8.08879 21.4135 6.4443 20.3147C4.79981 19.2159 3.51809 17.6541 2.76121 15.8268C2.00433 13.9996 1.8063 11.9889 2.19215 10.0491C2.578 8.10929 3.53041 6.32746 4.92894 4.92893C6.32746 3.53041 8.10929 2.578 10.0491 2.19215C11.9889 1.8063 13.9996 2.00433 15.8268 2.7612C17.6541 3.51808 19.2159 4.79981 20.3147 6.4443C21.4135 8.08879 22 10.0222 22 12C21.9971 14.6513 20.9426 17.1931 19.0679 19.0679C17.1931 20.9426 14.6513 21.9971 12 22Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M8 11C9.10457 11 10 10.1046 10 9C10 7.89543 9.10457 7 8 7C6.89543 7 6 7.89543 6 9C6 10.1046 6.89543 11 8 11Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M16 11C17.1046 11 18 10.1046 18 9C18 7.89543 17.1046 7 16 7C14.8954 7 14 7.89543 14 9C14 10.1046 14.8954 11 16 11Z",fill:"#49494F"})),(0,n.tT)("defs",null,(0,n.tT)("clipPath",{id:"clip0"},(0,n.tT)("rect",{width:"24",height:"24",fill:"white"}))));case s.PL.InLove:return(0,n.tT)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,n.tT)("g",{opacity:"0.4","clip-path":"url(#clip0)"},(0,n.tT)("path",{d:"M15.7724 14.452C15.3637 15.0802 14.8047 15.5963 14.146 15.9536C13.4873 16.3109 12.7498 16.498 12.0004 16.498C11.251 16.498 10.5135 16.3109 9.85479 15.9536C9.19608 15.5963 8.63703 15.0802 8.22838 14.452C8.08331 14.2298 7.85588 14.0743 7.59615 14.0197C7.33641 13.9651 7.06563 14.0159 6.84338 14.161C6.62113 14.3061 6.46561 14.5335 6.41104 14.7933C6.35646 15.053 6.40731 15.3238 6.55238 15.546C7.14252 16.454 7.95016 17.2001 8.90194 17.7167C9.85372 18.2332 10.9195 18.5038 12.0024 18.5038C13.0853 18.5038 14.151 18.2332 15.1028 17.7167C16.0546 17.2001 16.8622 16.454 17.4524 15.546C17.5975 15.3238 17.6483 15.053 17.5937 14.7933C17.5391 14.5335 17.3836 14.3061 17.1614 14.161C16.9391 14.0159 16.6683 13.9651 16.4086 14.0197C16.1489 14.0743 15.9215 14.2298 15.7764 14.452H15.7724Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M5.13896 11.345C5.18563 11.3937 5.24168 11.4325 5.30372 11.459C5.36576 11.4854 5.43251 11.4991 5.49996 11.4991C5.56742 11.4991 5.63417 11.4854 5.69621 11.459C5.75825 11.4325 5.81429 11.3937 5.86096 11.345L9.26296 7.80002C9.63565 7.42708 9.88166 6.94641 9.96618 6.42599C10.0507 5.90557 9.96947 5.37174 9.73396 4.90002C9.55667 4.54205 9.29672 4.23141 8.97559 3.9938C8.65447 3.75619 8.28141 3.59842 7.88724 3.53354C7.49307 3.46866 7.08912 3.49853 6.70878 3.62068C6.32844 3.74283 5.98264 3.95376 5.69996 4.23602L5.67396 4.26302C5.6268 4.30956 5.56322 4.33565 5.49696 4.33565C5.43071 4.33565 5.36712 4.30956 5.31996 4.26302L5.29996 4.23602C4.82894 3.76248 4.18909 3.49544 3.52118 3.49366C2.85327 3.49188 2.21201 3.7555 1.73846 4.22652C1.26492 4.69755 0.997884 5.33739 0.996103 6.0053C0.994321 6.67322 1.25794 7.31448 1.72896 7.78802L5.13896 11.345Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M14.2663 4.89103C14.0292 5.36181 13.9463 5.89529 14.0294 6.41581C14.1125 6.93634 14.3574 7.41749 14.7293 7.79103L18.1393 11.348C18.186 11.3967 18.242 11.4355 18.3041 11.462C18.3661 11.4884 18.4329 11.5021 18.5003 11.5021C18.5678 11.5021 18.6345 11.4884 18.6966 11.462C18.7586 11.4355 18.8147 11.3967 18.8613 11.348L22.2613 7.79903C22.634 7.42609 22.88 6.94542 22.9645 6.425C23.0491 5.90458 22.9678 5.37075 22.7323 4.89903C22.5548 4.5415 22.2949 4.23129 21.9739 3.99403C21.6529 3.75677 21.2801 3.59926 20.8862 3.53449C20.4923 3.46972 20.0887 3.49956 19.7086 3.62154C19.3285 3.74352 18.9829 3.95415 18.7003 4.23603L18.6743 4.26303C18.6272 4.30957 18.5636 4.33566 18.4973 4.33566C18.4311 4.33566 18.3675 4.30957 18.3203 4.26303L18.3003 4.23603C18.0183 3.95407 17.6732 3.74317 17.2936 3.62071C16.9141 3.49826 16.5108 3.46776 16.1172 3.53173C15.7235 3.5957 15.3507 3.7523 15.0294 3.98864C14.7081 4.22497 14.4476 4.53426 14.2693 4.89103H14.2663Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M23 11C22.7348 11 22.4804 11.1054 22.2929 11.2929C22.1054 11.4804 22 11.7348 22 12C22 14.6522 20.9464 17.1957 19.0711 19.0711C17.1957 20.9464 14.6522 22 12 22C9.34784 22 6.8043 20.9464 4.92893 19.0711C3.05357 17.1957 2 14.6522 2 12C2 11.7348 1.89464 11.4804 1.70711 11.2929C1.51957 11.1054 1.26522 11 1 11C0.734784 11 0.48043 11.1054 0.292893 11.2929C0.105357 11.4804 0 11.7348 0 12C0 15.1826 1.26428 18.2348 3.51472 20.4853C5.76516 22.7357 8.8174 24 12 24C15.1826 24 18.2348 22.7357 20.4853 20.4853C22.7357 18.2348 24 15.1826 24 12C24 11.7348 23.8946 11.4804 23.7071 11.2929C23.5196 11.1054 23.2652 11 23 11Z",fill:"#49494F"}),(0,n.tT)("path",{d:"M9.72711 2.25897C11.2228 1.91397 12.7774 1.91397 14.2731 2.25897C14.348 2.27557 14.4244 2.28396 14.5011 2.28397C14.7458 2.28281 14.9816 2.19197 15.1638 2.02865C15.346 1.86534 15.462 1.64088 15.4899 1.39778C15.5177 1.15468 15.4554 0.909807 15.3149 0.70952C15.1743 0.509232 14.9652 0.367434 14.7271 0.31097C12.9326 -0.102029 11.0677 -0.102029 9.27311 0.31097C9.01478 0.371174 8.79096 0.53153 8.65087 0.756761C8.51078 0.981992 8.4659 1.25365 8.52611 1.51197C8.58631 1.77029 8.74667 1.99412 8.9719 2.1342C9.19713 2.27429 9.46879 2.31917 9.72711 2.25897V2.25897Z",fill:"#49494F"})),(0,n.tT)("defs",null,(0,n.tT)("clipPath",{id:"clip0"},(0,n.tT)("rect",{width:"24",height:"24",fill:"white"}))))}}},9394:(e,t,i)=>{"use strict";i.d(t,{H:()=>n});var s=i(1372);function n(){return(0,s.tT)("div",{style:{height:"1.2em",width:"1.2em",display:"inline-block",position:"relative"},colorClass:"followerStarSvg"},(0,s.tT)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"8 7 48 46"},(0,s.tT)("g",{transform:"translate(0,-952.36218)"},(0,s.tT)("path",{d:"M32,959.4l8,14.3l16,3.2L44.9,989l1.9,16.3L32,998.4l-14.8,6.9l1.9-16.3L8,976.9l16-3.2L32,959.4z"}))))}},2331:(e,t,i)=>{"use strict";i.d(t,{YI:()=>c,ZZ:()=>d,Zz:()=>h});var s=i(6784),n=i(2709),o=i(3955),r=i(9447),a=i(4873),l=i(1848);class h extends n.u{constructor(){super(),this.tabHandleStyle={position:"relative",padding:"5px",margin:"2px 0 0 2px",borderRadius:"4px 4px 0 0",minWidth:"16px",width:"auto",height:"100%",fontSize:"10px",cursor:"pointer",cssFloat:"left",textSizeAdjust:"none",WebkitTextSizeAdjust:"none",userSelect:"none",lineHeight:"1.2"},this.tabHandleActiveStyle={cursor:"default"},(0,r.fZ)(this.element,"BaseTabsContainer"),this.tabHandlesRow=new l.m,this.tabHandlesRow.element.id="tab-row",this.tabHandlesRow.element.style.overflow="hidden",this.tabHandlesRow.element.style.width="100%",this.tabHandlesRow.element.style.borderRadius="2px 2px 0 0",super.addChild(this.tabHandlesRow),this.window=document.createElement("div"),this.window.style.width="100%",this.window.style.position="absolute",(0,r.fZ)(this.window,"window"),this.element.appendChild(this.window)}addFooter(e){this.element.appendChild(e)}getTabRow(){return this.tabHandlesRow}repositionChildren(){const e=this.element.clientHeight-this.tabHandlesRow.element.offsetHeight;this.window.style.height=`${e}px`}addChild(e){throw new Error("addChild not implemented")}addTab(e){return e.element.style.width="100%",e.element.style.height="100%",e.element.style.display="none",super.addChild(e,this.window),this.attachTabToDOM(e),e}attachTabToDOM(e){const t=e.constructTabHandle();return this.tabHandlesRow.addChild(t),e.adjustTab(),(0,r.fZ)(t,"tab"),(0,r.fZ)(t,r.aG.chatAreaTabColor),t}children(){return super.children().filter((e=>e instanceof d))}changeToTab(e){e!==this.currentTab&&(this.currentTab=e,e.setAsCurrentTab()),this.showCurrentTab()}changeToFirstTab(){this.changeToTab(this.children()[0])}getCurrentTab(){return this.currentTab}showCurrentTab(){const e=this.children();for(let t=e.length-1;t>=0;t-=1){const i=e[t];i!==this.currentTab?i.hideElement():this.currentTab.active||i.showElement()}this.repositionChildrenRecursive(),this.afterDOMConstructedIncludingChildren()}refreshTabs(){let e=!1;for(const t of this.children())e=t.adjustTab()||e;e&&this.tabHandlesRow.repositionChildrenRecursive()}getHandleStyle(e){return e.active?(0,r.fZ)(e.handle,"active"):((0,r.SA)(e.handle,"active"),e instanceof c&&(e.collapsed?(0,r.fZ)(e.handle,"collapsed"):(0,r.SA)(e.handle,"collapsed"))),{...this.tabHandleStyle,...e instanceof c&&e.collapsed?e.handleCollapseStyle:{},...e.active?this.tabHandleActiveStyle:{}}}}class d extends n.u{constructor(){super(),this.active=!1,this.element.style.position="relative"}tabHandleClicked(e){this.changeToThisTab()}shouldHideTabHandle(){return!this.handle.isShown()}getTabHandleContent(){return[document.createTextNode(" ")]}getTabId(){return""}setAsCurrentTab(){}adjustTab(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.handle.element.textContent;if(!e){let e=document.createElement("span");null!==this.handle.element.firstChild&&(e=this.handle.element.firstChild,e.innerHTML="");for(const t of this.getTabHandleContent())e.appendChild(t);this.handle.element.appendChild(e)}this.adjustHandleStyle();const i="none"===this.handle.element.style.display;return this.shouldHideTabHandle()?this.handle.element.style.display="none":this.handle.element.style.display="inline-block",t!==this.handle.element.textContent||i!==("none"===this.handle.element.style.display)}constructTabHandle(){for(this.handle=this.constructTabHandleComponent(),(0,s.Xq)(["click","touchstart"],this.handle.element,(e=>{this.tabHandleClicked(e)}));null!==this.handle.element.firstChild;)this.handle.element.removeChild(this.handle.element.firstChild);const e=document.createElement("span");for(const t of this.getTabHandleContent())e.appendChild(t);return this.handle.element.appendChild(e),this.handle.element.id=this.getTabId(),this.handle.element.dataset.testid=this.getTabId(),this.adjustHandleStyle(),this.handle}constructTabHandleComponent(){return new n.u(document.createElement("div"))}changeToThisTab(){void 0!==this.parent?this.parent.changeToTab(this):error("no parent")}isCurrentTab(){return void 0===this.parent?(error("no parent"),!1):this.parent.getCurrentTab()===this}refreshTabs(){void 0!==this.parent?this.parent.refreshTabs():error("no parent")}getHandleStyle(){return void 0!==this.parent?this.parent.getHandleStyle(this):{}}adjustHandleStyle(){(0,o.ZM)(this.handle,this.getHandleStyle())}hideElement(){super.hideElement(),this.active=!1,this.adjustHandleStyle()}showElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"block";super.showElement(e),this.active=!0,this.adjustHandleStyle()}}class c extends d{constructor(){super(...arguments),this.handleCollapseStyle={display:"block",cssFloat:"none",padding:"9px 12px",margin:0,borderRadius:"",border:"none",boxSizing:"border-box",width:"100%",height:"auto"}}constructTabHandleComponent(){const e=new a.g2(document.createElement("div"));return e.onCollapseEvent.listen((e=>{this.collapsed=e,void 0!==this.onCollapse&&this.onCollapse(e),this.adjustTab()})),e}}},1679:(e,t,i)=>{"use strict";i.d(t,{p5:()=>B,HH:()=>Z,Pt:()=>F,Gz:()=>O,sI:()=>N,tU:()=>z,di:()=>G,qr:()=>q,bv:()=>_,lc:()=>U,yL:()=>V,hw:()=>j});var s=i(7623),n=i(9461),o=i(6784),r=i(213),a=i(5216),l=i(2939),h=i(2032),d=i(2709),c=i(5020),u=i(8423),p=i(6440),m=i(7407),g=i(5173),v=i(4947),f=i(5389),y=i(9447),b=i(3955),w=i(3124),C=i(2690),S=i(1474),x=i(9757);const T="TokenSourcePurchaseMedia";class P extends C.zf{constructor(e,t){super(),(0,b.ZM)(this.element,{width:"100%",position:"fixed",minHeight:"250px",maxHeight:"100%",height:"unset",overflowY:"auto",transition:"bottom 500ms",zIndex:1006,bottom:"-400px",borderRadius:"8px 8px 0px 0px",backgroundColor:"#F8F9FA",touchAction:"none"}),(0,b.ZM)(this.overlay,{zIndex:1005,background:"rgba(0, 0, 0, 0.5)",touchAction:"none"}),this.content=document.createElement("div"),this.content.classList.add("oneclickflowMobile"),this.element.appendChild(this.content);const i=document.createElement("div");i.onclick=()=>this.hide();const s=e===T?{height:"14.6px",width:"14.6px",right:"25px",top:"20px"}:{height:"12.73px",width:"12.73px",right:"15px",top:"10px"};(0,b.ZM)(i,{display:"inline-block",cursor:"pointer",position:"absolute",...s});const n=t=>{const i=document.createElement("div");i.classList.add("oneclickflow__closeButtonSlash");const s=e===T?{width:"4.5px",height:"22px",left:"10px"}:{width:"3px",height:"15px",left:"5px"};return(0,b.ZM)(i,{position:"absolute",transform:t,...s}),i};i.appendChild(n("rotate(-135deg)")),i.appendChild(n("rotate(-45deg)")),this.element.appendChild(i),this.show(e,t)}show(e,t){this.orientationChangeListener=w.DQ.once((()=>{this.hide()}),!1);const i=x.c.get("OneClickFlow");this.oneClickFlowInstance=new i({source:null!=e?e:"",roomType:null!=t?t:"public",closeModal:()=>this.hide(),openPurchasePage:()=>{z(null!=e?e:""),this.hide()}},this.content),super.show(),void 0===e||e!==T||(0,w.K$)()?window.setTimeout((()=>{this.element.style.bottom="0"}),1):window.setTimeout((()=>{this.element.style.bottom="-60px"}),1)}hide(){var e;this.element.style.bottom="-400px",null===(e=this.orientationChangeListener)||void 0===e||e.removeListener(),window.setTimeout((()=>{var e;super.hide(),null===(e=this.oneClickFlowInstance)||void 0===e||e.dispose()}),1)}}class k extends C.zf{constructor(e,t,i){var s,o;super(),this.isOpen=!1,this.tokenBalance=null!==(s=null===n.Bm||void 0===n.Bm||null===(o=n.Bm.current)||void 0===o||null===(o=o.loggedInUser)||void 0===o?void 0:o.tokenBalance)&&void 0!==s?s:0,this.outSideHandlerClick=e=>{e.target===this.element&&this.element.contains(e.target)||this.hide()},this.createCloseButton=()=>{const e=document.createElement("div");e.onclick=()=>this.hide(),(0,b.ZM)(e,{display:"inline-block",cursor:"pointer",position:"absolute",height:"12.73px",width:"12.73px",right:"15px",top:"10px"});const t=e=>{const t=document.createElement("div");return t.classList.add("oneclickflow__closeButtonSlash"),(0,b.ZM)(t,{position:"absolute",transform:e,width:"3px",height:"15px",left:"5px"}),t};return e.appendChild(t("rotate(-135deg)")),e.appendChild(t("rotate(-45deg)")),e},this.overrideBasedOnSource=e=>{var t,i;const s={TokenSourceUserInfoPanel:{top:"100px",right:"1%"}},n=null!=e&&s.hasOwnProperty(e)&&s[e],o=null!==(t=null===(i=document)||void 0===i||null===(i=i.body)||void 0===i||null===(i=i.getBoundingClientRect())||void 0===i?void 0:i.top)&&void 0!==t?t:0;!1!==n?(0,b.ZM)(this.element,{transform:"none",top:"unset",right:"unset",left:"unset",...n}):(0,b.ZM)(this.element,{left:"unset",top:`calc(50% - ${o}px)`,right:"50%",transform:"translate(50%, -50%)"})},this.applyDarkModeStyles=()=>{const e=document.body.classList.contains("darkmode");(0,b.ZM)(this.element,{backgroundColor:e?"#202c39":"#F8F9FA",boxShadow:e?"0 0 12px rgba(0,0,0,0.8)":"0px 3px 10px 0px rgba(0, 0, 0, 0.10)",border:"1px solid  "+(e?"#17202a":"#ACACAC")})},(0,b.ZM)(this.element,{width:"313px",position:"absolute",minHeight:"218px",height:"unset",overflowY:"auto",zIndex:1006,borderRadius:"8px"}),this.content=document.createElement("div"),this.content.classList.add("oneclickflowDesktop"),this.element.appendChild(this.content);const r=this.createCloseButton();this.element.appendChild(r),this.show(e,t,i),S.D.listen((e=>{var t,i;this.tokenBalance=null!==(t=null==e?void 0:e.tokens)&&void 0!==t?t:0,void 0!==this.oneClickFlowInstance&&(null===(i=this.oneClickFlowInstance)||void 0===i||i.update({tokenBalance:this.tokenBalance}))}))}overrideBasedOnTarget(e){const t=window.innerWidth-(e.x+e.width)<323,i=window.innerHeight-(e.y+e.height)+window.scrollY<230;(0,b.ZM)(this.element,{right:"unset",transform:"unset",top:i?`${window.innerHeight-220-10+window.scrollY}px`:`${e.y}px`,left:t?window.innerWidth-313-10+"px":`${e.right}px`})}applyPositionOverrides(e,t){const i=void 0!==e?(0,b.$R)(e):void 0;i?this.overrideBasedOnTarget(i):this.overrideBasedOnSource(t)}show(e,t,i){if(this.isOpen)return void this.hide();this.isOpen=!0,this.applyDarkModeStyles(),this.applyPositionOverrides(i,e);const s=x.c.get("OneClickFlow");this.oneClickFlowInstance=new s({source:null!=e?e:"",roomType:null!=t?t:"public",desktop:!0,tokenBalance:this.tokenBalance,openPurchasePage:()=>{z(null!=e?e:""),this.hide()}},this.content),super.show(),(0,b.ZM)(this.overlay,{display:"none"}),window.setTimeout((()=>(0,o.wu)("click",document,this.outSideHandlerClick)),10)}hide(){var e;super.hide(),null===(e=this.oneClickFlowInstance)||void 0===e||e.dispose(),this.oneClickFlowInstance=void 0,(0,o.Pf)("click",document,this.outSideHandlerClick),this.isOpen=!1}}class A extends C.zf{constructor(e){super(),this.isOpen=!1,this.createCloseButton=()=>{const e=document.createElement("div");e.onclick=()=>this.hide(),(0,b.ZM)(e,{display:"inline-block",cursor:"pointer",position:"absolute",height:"16px",width:"16px",right:"16px",top:"22px"});const t=e=>{const t=document.createElement("div");return t.classList.add("cb-purchase-page__closeButtonSlash"),(0,b.ZM)(t,{position:"absolute",transform:e,width:"2px",height:"16px",left:"5px"}),t};return e.appendChild(t("rotate(-135deg)")),e.appendChild(t("rotate(-45deg)")),e},(0,b.ZM)(this.element,{position:"absolute",height:"unset",width:"unset",overflowY:"auto",zIndex:1101,borderRadius:"4px",top:"13%",right:"16px",background:"#fff"}),(0,b.ZM)(this.overlay,{background:"rgba(0, 0, 0, 0.5)"}),this.element.classList.add("purchasePage-main"),this.content=document.createElement("div"),this.content.classList.add("purchasePageWrapper"),this.element.appendChild(this.content);const t=this.createCloseButton();this.element.appendChild(t),this.show(e)}show(e){if(this.isOpen)return void this.hide();this.isOpen=!0;const t=x.c.get("PurchasePage");this.purchasePageInstance=new t({source:null!=e?e:"",openPurchasePage:()=>{z(null!=e?e:""),this.hide()},closeModal:()=>this.hide(),desktop:!0},this.content),super.show()}hide(){var e;super.hide(),null===(e=this.purchasePageInstance)||void 0===e||e.dispose(),this.purchasePageInstance=void 0,this.isOpen=!1}}class M extends C.zf{constructor(e,t){super(),(0,b.ZM)(this.element,{width:"100%",position:"fixed",minHeight:"250px",height:"unset",overflowY:"auto",transition:"bottom 500ms",zIndex:1006,bottom:"-400px",borderRadius:"8px 8px 0px 0px",backgroundColor:"#F8F9FA",touchAction:"none"}),(0,b.ZM)(this.overlay,{zIndex:1005,background:"rgba(0, 0, 0, 0.5)",touchAction:"none"}),this.content=document.createElement("div"),this.content.classList.add("purchasePageWrapper-mobile"),this.element.appendChild(this.content);const i=document.createElement("div");i.onclick=()=>this.hide();const s=e===T?{height:"14.6px",width:"14.6px",right:"25px",top:"20px"}:{height:"12.73px",width:"12.73px",right:"16px",top:"22px"};(0,b.ZM)(i,{display:"inline-block",cursor:"pointer",position:"absolute",...s});const n=t=>{const i=document.createElement("div");i.classList.add("cb-purchase-page__closeButtonSlash");const s=e===T?{width:"4.5px",height:"22px",left:"10px"}:{width:"2px",height:"16px",left:"5px"};return(0,b.ZM)(i,{position:"absolute",transform:t,...s}),i};i.appendChild(n("rotate(-135deg)")),i.appendChild(n("rotate(-45deg)")),this.element.appendChild(i),this.show(e,t)}show(e,t){this.orientationChangeListener=w.DQ.once((()=>{this.hide()}),!1);const i=x.c.get("PurchasePage");this.purchasePageInstance=new i({source:null!=e?e:"",openPurchasePage:()=>{z(null!=e?e:""),this.hide()},closeModal:()=>this.hide(),desktop:!1},this.content),super.show(),void 0===e||e!==T||(0,w.K$)()?window.setTimeout((()=>{this.element.style.bottom="0"}),1):window.setTimeout((()=>{this.element.style.bottom="-60px"}),1)}hide(){var e;this.element.style.bottom="-400px",null===(e=this.orientationChangeListener)||void 0===e||e.removeListener(),window.setTimeout((()=>{var e;super.hide(),null===(e=this.purchasePageInstance)||void 0===e||e.dispose()}),1)}}var R=i(897),I=i(9603);const E=16;class L extends d.u{constructor(e){super(),this.data=e,this.disabled=!1,this.onClick=e=>{this.disabled?void 0!==this.disabledMouseClick&&this.disabledMouseClick(e):this.enabledMouseClick(e)},this.onTouch=e=>{this.disabled&&(e.preventDefault(),void 0!==this.data.disabledModalText?(0,r.mf)(this.data.disabledModalText,(()=>{void 0!==this.disabledMouseClick&&this.disabledMouseClick(e)})):void 0!==this.disabledMouseClick&&this.disabledMouseClick(e))},this.showTooltip=()=>{void 0!==this.disabledTooltip&&(this.disabledTooltip.style.display="block")},this.hideTooltip=()=>{void 0!==this.disabledTooltip&&(this.disabledTooltip.style.display="none")},this.element.removeAttribute("id"),(0,y.fZ)(this.element,"menuItem"),this.element.style.padding="9px 0",this.element.style.cursor="pointer",this.element.style.boxSizing="border-box",this.element.style.position="relative",this.element.style.overflow="visible",this.element.style.borderWidth="1px",this.element.style.borderStyle="solid",void 0!==e.disabledTooltip&&(this.disabledTooltip=e.disabledTooltip,this.disabledTooltip.style.top="57px",this.element.appendChild(e.disabledTooltip)),this.dt=document.createElement("dt"),this.dt.style.margin="0",this.dt.style.padding="0 8px 5px 28px",this.dt.style.backgroundSize="14px 14px",this.dt.innerText=e.label,e.label===v.R.anonTippingText&&(this.dt.dataset.testid="anon-tip-option"),this.element.appendChild(this.dt);const t=e.description;void 0!==t&&t.length>0&&(this.dd=document.createElement("dd"),this.dd.style.margin="0",this.dd.style.padding="0 8px 0 28px",this.dd.innerText=t,this.element.appendChild(this.dd));const i=L.createItemId("ButtonMenuItem");this.input=document.createElement("input"),this.input.id=i,this.input.name=i,this.input.type="radio",this.input.style.cursor="pointer",this.input.style.position="absolute",this.input.style.opacity="0",this.input.style.width="0",this.input.style.height="0",this.element.appendChild(this.input),void 0!==e.disabledMouseClick&&(this.disabledMouseClick=e.disabledMouseClick),(0,o.wu)("mouseenter",this.element,(()=>{this.disabled&&void 0!==this.disabledTooltip&&this.showTooltip()})),(0,o.wu)("mouseleave",this.element,(()=>{this.disabled&&void 0!==this.disabledTooltip&&this.hideTooltip()})),this.enabledMouseClick=e.enabledMouseClick,(0,o.wu)("click",this.element,this.onClick),(0,o.wu)("touchstart",this.element,this.onTouch),(0,o.wu)("focus",this.input,(()=>{this.element.style.outline="2px solid Highlight"})),(0,o.wu)("blur",this.input,(()=>{this.element.style.removeProperty("outline")}))}select(){(0,y.fZ)(this.dt,"selected")}deselect(){(0,y.SA)(this.dt,"selected")}getValue(){return this.data.value}getButtonLabel(){const e=this.data.buttonLabel;return void 0===e?this.data.label:e}disable(){this.disabled||(this.disabled=!0,(0,y.fZ)(this.element,"disabled"))}enable(){this.disabled&&(this.disabled=!1,(0,y.SA)(this.element,"disabled"))}static createItemId(e){return L.lastId+=1,e+L.lastId.toString()}}L.lastId=0;class D extends g.Q{constructor(e,t){super(),this.width=280,this.visible=!1,this.visibilityChange=new u.c_("visibilityChange"),this.selectionChange=new u.c_("selectionChange");const i=[],s=e.length;0===s&&error("ButtonMenu requires at least one option!"),(0,y.fZ)(this.element,"menu"),this.element.style.padding="0",this.element.style.display="none",this.element.style.width=`${this.width}px`,this.element.style.textAlign="left",this.element.style.fontSize="14px",this.element.style.lineHeight="14px",this.element.style.borderRadius="4px",this.overlay.style.zIndex="1002",this.element.style.zIndex="1003",this.element.style.overflow="visible",this.element.style.removeProperty("height");let n=-1;const r=s-1;for(let a=0;a<s;a+=1){const s=e[a];s.value===t&&(n=a),s.enabledMouseClick=e=>{e.stopPropagation(),this.onItemClick(l)};const l=this.createMenuItem(s),h=e=>(e.preventDefault(),e.stopPropagation(),l.onClick(e),!1);(0,o.wu)("keyup",l.input,(e=>32!==e.keyCode||h(e))),(0,o.wu)("keydown",l.input,(e=>13!==e.keyCode||h(e))),0===a&&(l.element.style.borderTopWidth="1px",l.element.style.borderTopLeftRadius="2px",l.element.style.borderTopRightRadius="2px"),a===r&&(l.element.style.borderBottomLeftRadius="2px",l.element.style.borderBottomRightRadius="2px"),this.addChild(l),i.push(l.input)}const a=this.children();n=-1===n?0:n,this.selectedItem=a[n],this.focusElements=i,this.selectionChange.listen((e=>{this.onSelectionChange(e)})),this.overlayClick.listen((()=>{this.hide()}))}getValue(){return this.selectedItem.getValue()}getButtonLabel(){return this.selectedItem.getButtonLabel()}isVisible(){return this.visible}show(e){this.isVisible()||(this.visibilityChange.fire(!0),this.element.style.display="inline-block",this.element.style.top=`${e.top}px`,this.element.style.left=`${e.left}px`,this.showOverlay(),this.visible=!0,this.repositionChildrenRecursive())}hide(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isVisible()&&(super.hide(),e||this.visibilityChange.fire(!1),this.visible=!1)}toggle(e){this.isVisible()?this.hide():this.show(e)}disableItem(e){const t=this.children();e<t.length&&t[e].disable()}enableItem(e){const t=this.children();e<t.length&&t[e].enable()}afterDOMConstructedIncludingChildren(){super.afterDOMConstructedIncludingChildren(),this.onSelectionChange({current:this.selectedItem})}findBoundary(){let e;for(let t=this.parent;void 0!==t;t=t.parent)if("hidden"===window.getComputedStyle(t.element).overflowY){e=t.element;break}return e}repositionChildren(){if(!this.isVisible())return;const e=this.findBoundary(),t=(void 0!==e?e.getBoundingClientRect().bottom:document.documentElement.clientHeight)-this.element.getBoundingClientRect().bottom;t<32&&(this.element.style.top=this.element.offsetTop-(32-t)+"px")}createMenuItem(e){return new L(e)}onSelectionChange(e){e.current.select(),void 0!==e.previous&&e.previous.deselect()}onItemClick(e){const t=this.selectedItem;this.hide(),e!==t&&(this.selectedItem=e,this.selectionChange.fire({previous:t,current:e}))}}class B extends d.u{constructor(e){super(),this.menuEnabled=!0,this.anonymousEnabled=!0,this.enabled=!0,this.tipTypeChange=new u.c_("tipTypeChange"),(0,y.fZ)(this.element,"sendTip"),this.element.style.margin="6px",this.element.style.marginLeft="auto",this.element.style.display="inline-block",this.element.style.verticalAlign="top",this.element.style.cssFloat="right",this.element.style.overflow="visible",this.element.style.position="static",this.element.style.removeProperty("width"),this.element.style.removeProperty("height"),this.submitButton=this.createSubmitButton(),this.submitButton.style.marginLeft="6px",this.submitButton.dataset.testid="send-tip-button",this.dropDownButton=this.createDropDownMenu(),this.dropDownButton.innerHTML="&#9660;",this.dropDownButton.id="id_tip_type_select_tm",this.dropDownButton.dataset.testid="tip-type-dropdown-button",this.dropDownMenu=new D(B.menuItemsData,e),this.submitButton.innerText=this.dropDownMenu.getButtonLabel();for(const e of this.dropDownMenu.children())this.styleButtonMenuItem(e);this.element.appendChild(this.submitButton),this.element.appendChild(this.dropDownButton),this.tipType=this.dropDownMenu.getValue(),this.addChild(this.dropDownMenu),this.dropDownMenu.selectionChange.listen((e=>{if(this.isAnonymousEnabled()){const t=e.current.getValue();this.changeTipType(t),this.submitButton.focus()}})),(0,o.wu)("mouseenter",this.submitButton,(e=>{this.submitButton.style.textDecoration="underline"})),(0,o.wu)("mouseleave",this.submitButton,(e=>{this.submitButton.style.textDecoration="none"})),(0,o.wu)("click",this.dropDownButton,(e=>(e.preventDefault(),e.stopPropagation(),this.dropDownMenu.toggle(this.getMenuOffsets()),!1))),this.dropDownMenu.visibilityChange.listen((e=>{e||this.submitButton.focus()})),this.focusElements=[this.submitButton,this.dropDownButton],l.X0.listen((e=>{e.dossier.allowAnonymousTipping?this.enableAnonymousTips():this.disableAnonymousTips()}))}getOffsetWidth(){return this.element.offsetWidth}hideMenu(){this.dropDownMenu.hide(!0)}promptUser(e){this.submitButton.innerHTML=`${e} &#9656;`,this.submitButton.title=e,this.disableMenu()}cancelPrompt(){this.resetText(),this.enableMenu()}resetText(){this.submitButton.innerText=this.dropDownMenu.getButtonLabel(),this.submitButton.title=this.dropDownMenu.getButtonLabel()}isAnonymousEnabled(){return this.anonymousEnabled}isEnabled(){return this.enabled}disable(){this.isEnabled()&&(this.enabled=!1,this.dropDownMenu.hide(),this.submitButton.disabled=!0,(0,y.fZ)(this.submitButton,"disabled"),this.dropDownButton.disabled=!0,(0,y.fZ)(this.dropDownButton,"disabled"))}enable(){this.isEnabled()||(this.enabled=!0,this.submitButton.disabled=!1,(0,y.SA)(this.submitButton,"disabled"),this.dropDownButton.disabled=!1,(0,y.SA)(this.dropDownButton,"disabled"))}getTipType(){return this.tipType}hasFocus(){return this.getCurrentFocusData().index>-1}focusPrev(){const e=this.getCurrentFocusData(),t=e.elements.length;if(e.index-=1,-2===e.index)e.index=t-1;else if(-1===e.index)return!1;return this.focusElement(e),!0}focusPrevMenuItem(){if(!this.menuEnabled||!this.dropDownMenu.isVisible())return!1;const e=this.getCurrentFocusData(),t=e.elements.length;return e.index-=1,e.index<=t-this.dropDownMenu.focusElements.length-1&&(e.index=t-1),this.focusElement(e),!0}focusNext(){const e=this.getCurrentFocusData(),t=e.elements.length;return e.index+=1,!(e.index>=t||(this.focusElement(e),0))}focusNextMenuItem(){if(!this.menuEnabled||!this.dropDownMenu.isVisible())return!1;const e=this.getCurrentFocusData(),t=e.elements.length;return e.index+=1,(e.index>=t||e.index<=t-this.dropDownMenu.focusElements.length-1)&&(e.index=t-this.dropDownMenu.focusElements.length),this.focusElement(e),!0}focusElement(e){const t=e.index;e.elements[t].focus()}getCurrentFocusData(){let e=this.focusElements;return this.menuEnabled&&this.dropDownMenu.isVisible()&&(e=this.focusElements.concat(this.dropDownMenu.focusElements)),{elements:e,index:e.indexOf(document.activeElement)}}getMenuOffsets(){const e=this.element,t=(0,h.w_)(this.submitButton),i=e.offsetLeft+e.offsetWidth+1-this.dropDownMenu.width;return{top:t.height+2*t.top,left:i}}enableAnonymousTips(){const e=this.dropDownMenu.getValue();this.anonymousEnabled=!0,this.dropDownMenu.enableItem(1),this.changeTipType(e)}disableAnonymousTips(){this.anonymousEnabled=!1,this.dropDownMenu.disableItem(1),this.changeTipType("public")}enableMenu(){this.menuEnabled||(this.menuEnabled=!0,this.submitButton.style.borderRadius="4px 0 0 4px",this.dropDownButton.style.display="inline-block",this.focusElements=[this.submitButton,this.dropDownButton],this.repositionChildrenRecursive())}disableMenu(){this.menuEnabled&&(this.hasFocus()&&this.submitButton.focus(),this.menuEnabled=!1,this.dropDownMenu.hide(),this.submitButton.style.borderRadius="4px",this.dropDownButton.style.display="none",this.focusElements=[this.submitButton])}changeTipType(e){this.tipType=e,this.tipTypeChange.fire(e),this.resetText()}styleButtonMenuItem(e){e.dt.style.fontFamily="'UbuntuMedium', Helvetica, Arial, sans-serif",void 0!==e.dd&&(e.dd.style.fontFamily="'UbuntuRegular', Helvetica, Arial, sans-serif")}createCommonButton(){const e=document.createElement("button");return(0,y.fZ)(e,"buttons"),e.style.position="relative",e.style.display="inline-block",e.style.cursor="pointer",e.style.fontSize="14px",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.height="auto",e.style.verticalAlign="top",e.style.margin="0",(0,o.wu)("focus",e,(()=>{e.style.zIndex="100"})),(0,o.wu)("blur",e,(()=>{e.style.zIndex="auto"})),e}createSubmitButton(){const e=this.createCommonButton();return e.type="submit",e.title=v.R.sendTipButtonText,e.style.padding="6px 18px",e.style.borderRadius="4px 0 0 4px",e.style.borderRight="0 none transparent",e.style.overflow="hidden",e.style.textOverflow="ellipsis",e}createDropDownMenu(){const e=this.createCommonButton();return e.style.padding="6px 0",e.style.borderRadius="0 4px 4px 0",e.style.width="24px",e}}function U(e,t){window.setTimeout((()=>{if(t.isAnonymousEnabled()){const i=t.getTipType();(0,m.bT)("SendTipViewed",{source:e,tipType:i,localStorage:(0,s.Pf)()})}}),0)}B.menuItemsData=[{label:v.R.publicTippingText,value:"public",description:v.R.publicTippingDesc,buttonLabel:v.R.sendTipButtonText,enabledMouseClick:()=>{}},{label:v.R.anonTippingText,value:"anonymous",description:v.R.anonTippingDesc,buttonLabel:v.R.anonButtonText,enabledMouseClick:()=>{},disabledMouseClick:e=>{(0,m.bT)("SupporterPageOpened",{source:"anon_tip"}),null!==window.top&&(window.top.location.href=(0,a._Y)(`/supporter/upgrade/?source=${n.Bm.current.PurchaseEventSources.SUPPORTER_SOURCE_ANON_TIP_UPSELL}`))},disabledTooltip:(0,I.q)({content:v.R.mustBeSupporterFeature,hasHTML:!1,width:240,divotPosition:c.Wi.Top,divotLeftOrTop:"40px"}),disabledModalText:`${v.R.mustBeSupporterFeature} ${v.R.anonTipDisabledModalCont}`}];const _="/tipping/purchase_tokens/";function F(e){const t=e.value.replace(/[^\d]+/g,"").substring(0,E);e.value!==t&&(e.value="",e.value=t)}function N(e){return null===e.match(/[^\d]/)&&parseInt(e)>0}function O(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"tipAmountInput";const t=document.createElement("input");return(0,y.fZ)(t,e),t.dataset.testid="tip-amount-input",t.type="tel",t.autocomplete="off",t.value="25",(0,o.wu)("beforeinput",t,(e=>{null!==e.data&&(!isNaN(parseInt(e.data))&&t.value.length<E||e.preventDefault())})),(0,o.wu)("input",t,(()=>F(t))),t}let H,W,$=!1;const V=()=>{var e,t,i;if(null===n.Bm||void 0===n.Bm||null===(e=n.Bm.current)||void 0===e||!e.loggedInUser||null===(t=n.Bm.current)||void 0===t||null===(t=t.loggedInUser)||void 0===t||!t.userUid)return;$=n.Bm.current.loggedInUser.canWegOneClick;const s=null===(i=n.Bm.current)||void 0===i||null===(i=i.loggedInUser)||void 0===i?void 0:i.userUid;new R.bb(s).onMessage.listen((e=>{$=e.is_one_click_eligible}))},z=e=>{const t=function(e){let t,{source:i}=e;const s=void 0===n.Bm.current.loggedInUser;return""===window.location.search?(t=_,null!=i&&""!==i?(t+=`?source=${i}`,s&&(t+="&refresh_opener=1")):s&&(t+="?refresh_opener=1")):(t=`${_}${window.location.search}`,null!=i&&""!==i&&(t+=`&source=${i}`),s&&(t+="&refresh_opener=1")),t}({source:e});if((0,p.e)("TknParalNew3")||(0,p.e)("TknParalRet3"))return W?void W.show(null!=e?e:""):void(W=n.Bm.current.isMobile?new M(null!=e?e:""):new A(null!=e?e:""));(0,f.gr)(t,"_blank","height=615, width=850, scrollbars=1")};function G(){var e;let{source:t,roomType:i,target:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null!==(e=$)&&void 0!==e&&e?n.Bm.current.isMobile?H?H.show(null!=t?t:"",i):H=new P(null!=t?t:"",i):H?H.show(null!=t?t:"",i,s):H=new k(null!=t?t:"",i,s):z(null!=t?t:"")}function q(e,t,i){(0,r.mf)(e,(()=>{G({source:t,roomType:i})}),void 0,{acceptText:v.R.purchaseTokensText})}function j(e){const t=document.querySelectorAll(".tokencount[updatable-count]");for(const i of t)i.textContent=`${e}`}function Z(e){e.onclick=t=>{if(e.classList.contains("welcome-page-purchase-tokens")&&(0,m.bT)("WelcomePagePurchaseTokensClicked"),!t.ctrlKey&&!t.metaKey){const i=function(e){const t=e.dataset.purchaseEventSource;if(null!=t&&""!==t)return Object.values(n.Bm.current.PurchaseEventSources).includes(t)?Object.values(n.Bm.current.PurchaseEventSources).find((e=>e===t)):void 0}(e);t.preventDefault(),G({source:i})}},""===e.href&&(e.href=(0,a._Y)(_))}},9603:(e,t,i)=>{"use strict";i.d(t,{q:()=>o});var s=i(5020),n=i(9447);function o(e){const t=document.createElement("div");(0,n.fZ)(t,"tooltip"),e.hasHTML?t.innerHTML=e.content:t.textContent=e.content,void 0!==e.width&&(t.style.width="number"==typeof e.width?`${e.width}px`:e.width),t.style.borderWidth="1px",t.style.position="absolute",t.style.borderStyle="solid",t.style.borderRadius="4px",t.style.fontSize="14px",t.style.padding="8px",t.style.display="none",t.style.zIndex="5";const i=(0,s.Hq)(e.divotPosition,e.divotLeftOrTop,e.borderWidth);return void 0!==i&&t.appendChild(i),t}},520:(e,t,i)=>{"use strict";i.d(t,{s:()=>n});var s=i(6909);class n extends s.B{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super({},e,t),this.toggleElement=e,this.alignRight=t}}},6909:(e,t,i)=>{"use strict";i.d(t,{B:()=>l,g:()=>h});var s=i(4936),n=i(2709),o=i(3955),r=i(2997),a=i(369);class l extends r.ij{constructor(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(e,t,!1),this.toggleElement=t,this.alignRight=i,this.topMargin=4,this.toggleStylesToKeep=["color","background-color","text-decoration"],this.initAddChildren(),this.resizeDebounceListener=a.oO.listen((()=>{this.isShown()&&this.reposition()})),document.body.appendChild(this.element),this.hideElement()}initAddChildren(){this.connectedOverlay=new h,this.addChild(this.connectedOverlay)}showElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"block",t=arguments.length>1?arguments[1]:void 0;return!!super.showElement(e,t)&&(this.toggleElement.classList.add("active"),this.reposition(),!0)}hideElement(e){return!!super.hideElement(e)&&(this.toggleElement.classList.remove("active"),!0)}reposition(){const e=(0,o.$R)(this.toggleElement),t=this.alignRight||e.left+this.element.offsetWidth>document.documentElement.clientWidth&&e.right-this.element.offsetWidth>0;this.setDropDownStyleFromToggle(t);const i=(0,o.Lx)(getComputedStyle(this.element).borderBottomWidth)-(0,o.Lx)(getComputedStyle(this.toggleElement).borderLeftWidth);this.setDropDownPosition(e,i,t),this.connectedOverlay.positionAndStyle(this.toggleElement,this,i,t),this.element.style.zIndex=getComputedStyle(this.connectedOverlay.element).zIndex}dispose(){super.dispose(),this.element.remove(),this.resizeDebounceListener.removeListener()}setBorderRadius(e,t){""!==t&&(this.element.style.borderRadius=`${e?`${t} 0`:`0 ${t}`} ${t} ${t}`)}setDropDownStyleFromToggle(e){this.element.style.position="absolute",this.element.style.backgroundColor=(0,o.gK)(this.toggleElement),"0px"!==this.getToggleStyle(e?"borderRightWidth":"borderLeftWidth")&&(this.element.style.borderWidth=this.getToggleStyle(e?"borderRightWidth":"borderLeftWidth"),this.element.style.borderStyle=this.getToggleStyle(e?"borderRightStyle":"borderLeftStyle"),this.element.style.borderColor=this.getToggleStyle(e?"borderRightColor":"borderLeftColor"));const t=this.getToggleStyle(e?"borderTopRightRadius":"borderTopLeftRadius");this.setBorderRadius(e,t)}setDropDownPosition(e,t,i){if(this.element.style.top=`${e.bottom+this.topMargin}px`,i){this.element.style.left="";const i=document.documentElement.clientWidth-e.right-t;this.element.style.right=`${i}px`,this.element.style.right=i-c(this.toggleElement,this.element)-t+"px"}else{this.element.style.right="";const i=e.left-t;this.element.style.left=`${i}px`,this.element.style.left=i+d(this.toggleElement,this.element)-t+"px"}}getToggleStyle(e){const t=getComputedStyle(this.toggleElement);return(0,s.zm)(this.toggleElement.style[e],t[e])}}class h extends n.u{constructor(){super(),(0,o.ZM)(this.element,{position:"absolute",zIndex:4})}positionAndStyle(e,t,i,n){const r=getComputedStyle(t.element);this.element.style.borderLeftWidth=r.borderLeftWidth,this.element.style.borderLeftStyle=r.borderLeftStyle,this.element.style.borderLeftColor=r.borderLeftColor,this.element.style.borderRightWidth=r.borderLeftWidth,this.element.style.borderRightStyle=r.borderLeftStyle,this.element.style.borderRightColor=r.borderLeftColor;const a=(0,o.Lx)(getComputedStyle(e).width)+2*i;this.element.style.width=`${a}px`;const l=t.element.offsetTop-(0,o.$R)(e).bottom+1;this.element.style.height=`${l+2}px`,this.element.style.top=`-${l+2}px`,this.element.style.backgroundColor=r.backgroundColor;const h=(0,s.zm)(r.borderWidth,r.borderLeftWidth);this.element.style.right=n?`-${h}`:"",this.element.style.left=n?"":`-${h}`,this.element.style.zIndex=(0,s.zm)(r.zIndex,this.element.style.zIndex),this.element.style.width=n?`${a-d(e,this.element)+i}px`:`${a+c(e,this.element)+i}px`}}function d(e,t){return e.getBoundingClientRect().left-t.getBoundingClientRect().left}function c(e,t){return e.getBoundingClientRect().right-t.getBoundingClientRect().right}},1848:(e,t,i)=>{"use strict";i.d(t,{m:()=>n});var s=i(2709);class n extends s.u{constructor(e){super("div"),this.element.style.height="",this.element.style.width="",this.element.style.position="relative",void 0!==e&&(e instanceof s.u?this.addChild(e):this.element.appendChild(e))}}},4035:(e,t,i)=>{"use strict";i.d(t,{I:()=>n,w:()=>o});var s=i(1519);const n=new(i(8423).c_)("cssVhVarUpdate",{reportIfNoListeners:!1});function o(){var e;r();const t=new s.a(r,{bounceLimitMS:100,debounceType:1});null===(e=window.visualViewport)||void 0===e||e.addEventListener("resize",(()=>t.callFunc())),window.setInterval((()=>t.callFunc()),500)}function r(){var e,t;const i=document.documentElement.style.getPropertyValue("--vh"),s=.01*(null!==(e=null===(t=window.visualViewport)||void 0===t?void 0:t.height)&&void 0!==e?e:window.innerHeight)+"px";s!==i&&(document.documentElement.style.setProperty("--vh",s),n.fire())}},3955:(e,t,i)=>{"use strict";i.d(t,{$R:()=>d,EF:()=>r,JR:()=>p,Lx:()=>c,Mo:()=>k,Mx:()=>C,Q:()=>u,WV:()=>A,XJ:()=>g,YG:()=>S,ZM:()=>a,_W:()=>l,aN:()=>x,ce:()=>M,eH:()=>P,eh:()=>b,gK:()=>h,jl:()=>y,q_:()=>f,ss:()=>T}),i(4936);var s=i(6784),n=i(2709),o=i(8423);function r(e,t){const i=e.getBoundingClientRect(),s=t.getBoundingClientRect();return!(i.right<s.left||i.left>s.right||i.bottom<s.top||i.top>s.bottom)}function a(e,t){let i;i=e instanceof n.u?e.element:e;let s=t;t instanceof Function&&(s=t(e));for(const e of Object.keys(s))i.style[e]=t[e]}function l(e){(0,s.wu)("mouseenter",e,(()=>{e.style.textDecoration="underline"})),(0,s.wu)("mouseleave",e,(()=>{e.style.textDecoration=""}))}function h(e){const t="rgba(0, 0, 0, 0)";if(null===e)return t;const i=getComputedStyle(e).backgroundColor;return""===i||i===t||"transparent"===i?h(e.parentElement):i}function d(e){function t(e,t,i){return 0===e?0===t?void 0===i?0:i:t:e}const i=e.getBoundingClientRect(),s=document.body,n=document.documentElement,o=t(window.pageYOffset,n.scrollTop,s.scrollTop),r=t(window.pageXOffset,n.scrollLeft,s.scrollLeft),a=t(n.clientTop,s.clientTop),l=t(n.clientLeft,s.clientLeft),h=i.top+o-a,d=i.left+r-l;return new DOMRect(d,h,i.width,i.height)}function c(e){if(null===e)return 0;try{const t=parseFloat(e.substring(0,e.indexOf("px")));return isNaN(t)?0:t}catch(e){return 0}}function u(e){const t=getComputedStyle(e),i=c(t.paddingLeft)+c(t.paddingRight),s=c(t.borderLeftWidth)+c(t.borderRightWidth);return e.getBoundingClientRect().width-i-s}function p(e,t){const i=new o.c_("hover"),r=e instanceof n.u?e.element:e;return!0===(null==t?void 0:t.handleTouch)&&!0===(null==t?void 0:t.ignoreTouch)&&error("handleTouch and ignoreTouch cannot both be true"),(0,s.wu)("pointerenter",r,(e=>{!0===(null==t?void 0:t.ignoreTouch)?"mouse"===e.pointerType&&i.fire(!0):i.fire(!0)})),(0,s.wu)("pointerleave",r,(()=>{i.fire(!1)})),!0===(null==t?void 0:t.handleTouch)&&((0,s.wu)("click",r,(()=>{i.fire(!0)})),(0,s.wu)("touchstart",document,(()=>{i.fire(!1)})),(0,s.wu)("touchmove",document,(()=>{i.fire(!1)})),(0,s.wu)("touchend",document,(()=>{i.fire(!1)}))),i}let m;function g(){if(void 0!==m)return m;const e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);const t=e.offsetWidth;e.style.overflow="scroll";const i=document.createElement("div");i.style.width="100%",e.appendChild(i);const s=i.offsetWidth;return document.body.removeChild(e),m=t-s,m}const v=document.createElement("canvas");function f(e,t){const i=v.getContext("2d");return null!==i?(i.font=getComputedStyle(t).font,i.measureText(e).width):0}function y(e,t){const i=v.getContext("2d");return null!==i?(i.font=t,i.measureText(e).width):0}function b(e,t){return i=>{if("Tab"===i.key){let s;i.preventDefault(),s=i.shiftKey?t instanceof HTMLElement?t:t():e instanceof HTMLElement?e:e(),void 0!==s&&(s.focus(),i.stopPropagation())}}}let w;function C(){void 0===w&&(w=document.createElement("div"),a(w,{position:"fixed",top:"0px",left:"0px"}),document.body.appendChild(w));const e=w.getBoundingClientRect();return{top:e.top,left:e.left}}function S(e){const t=e.getBoundingClientRect();return"none"!==e.style.display&&Math.round(t.top)>=0&&Math.round(t.left)>=0&&Math.round(t.bottom)<=(window.innerHeight||document.documentElement.clientHeight)&&Math.round(t.right)<=(window.innerWidth||document.documentElement.clientWidth)}function x(){document.body.offsetWidth}function T(e){let t=e;for(;null!==t&&"a"!==t.tagName.toLowerCase();)t=t.parentElement;if(null===t)return;const i=t,s=i.getAttribute("href");return"#"!==s&&""!==s&&null!==s?i:void 0}function P(e,t){e.ctrlKey||e.metaKey||e.shiftKey||(e.preventDefault(),t(e))}function k(e,t){if(!t.contains(e))return!1;const i=t.scrollTop,s=i+t.offsetHeight,n=e.offsetTop,o=n+e.offsetHeight;return n<=s&&o>=i}function A(e,t,i){e.style.overflow="hidden",x(),e.style.overflowY=null!=t?t:"auto",e.style.overflowX=null!=i?i:"hidden"}function M(){const e=document.createElement("p");return a(e,{position:"absolute",display:"none",opacity:"0",borderRadius:"4px",backgroundColor:"rgba(0, 0, 0, .92)",padding:"0px 16px 0px 16px",lineHeight:"22px",textAlign:"center",fontSize:"14px",color:"#ffffff",width:"max-content",pointerEvents:"none",zIndex:2e3}),e}},6784:(e,t,i)=>{"use strict";i.d(t,{Pf:()=>d,Vo:()=>u,Xq:()=>h,ck:()=>c,wu:()=>l});var s=i(7623);const n=42,o={},r={};function a(e){return Number.isNaN(Number(e))?0:Number(e)}function l(e,t,i){let l,h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t===window)l=o[e]=a(o[e])+1;else if(t===document)l=r[e]=a(r[e])+1;else if(t instanceof HTMLElement){const i=`data-listener-count-${e}`;l=a(t.getAttribute(i))+1,t.setAttribute(i,`${l}`)}else l=1,debug(`EventListener attached to non-HTMLElement object (possibly frame document): ${t}`);if(l>n){let i;i=t===document?"document":t===window?"window":`${t.outerHTML.split(">")[0]}>`,warn("Too many event listeners on element",{event:e,element:i,listeners:l,maxListeners:n})}if(void 0!==window.addEventListener){const n=(0,s.sb)()?{capture:h,passive:d}:h;t.addEventListener(e,i,n)}else void 0!==window.attachEvent?t.attachEvent(`on${e}`,i):error(`Could not resolve addEventListenerPoly( ${e} ) to ${t}`)}function h(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];for(const o of e)l(o,t,i,s,n)}function d(e,t,i){let n,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t===window)n=o[e]=a(o[e])-1;else if(t===document)n=r[e]=a(r[e])-1;else if(t instanceof HTMLElement){const i=`data-listener-count-${e}`;n=a(t.getAttribute(i))-1,t.setAttribute(i,`${n}`)}else n=1,debug(`EventListener removed from non-HTMLElement object (possibly frame document): ${t}`);if(n<0&&warn(`event listener "${e}" removed without being added`,{listeners:n}),void 0!==window.removeEventListener){const n=(0,s.sb)()?{capture:l,passive:h}:l;t.removeEventListener(e,i,n)}else void 0!==window.detachEvent?t.detachEvent(`on${e}`,i):error(`Could not resolve removeEventListenerPoly( ${e} ) from ${t}`)}function c(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=r=>{i(r),d(e,t,o,s,n)};l(e,t,o,s,n)}function u(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];c(e,t,(()=>{l(e,t,i,s,n)}),s,n)}},2326:(e,t,i)=>{"use strict";i.d(t,{J:()=>n});var s=i(6440);function n(){(0,s.f)("AffLinkcodeCookieOnClick")&&void 0!==window.affiliateInteractionCallback&&window.affiliateInteractionCallback()}},213:(e,t,i)=>{"use strict";i.d(t,{J:()=>v,Q$:()=>m,SI:()=>y,mf:()=>g});var s=i(6624),n=i(9447),o=i(6784),r=i(2939),a=i(3955),l=i(1779),h=i(1191),d=i(2690);const c={backgroundColor:"#F47321",color:"#FFFFFF",border:"1px solid #CD5D26"};class u{constructor(){this.message=document.createElement("div"),this.container=document.createElement("div"),this.dialog=document.createElement("div"),this.title=document.createElement("div"),this.decline=document.createElement("button"),this.accept=document.createElement("button"),this.teardown=()=>{},this.queue=[],this.rotateDismissTeardownHandler=()=>{(0,o.Pf)("orientationchange",window,this.rotateDismissTeardownHandler),this.teardown()},(0,n.fZ)(this.container,"modalAlert"),this.container.style.display="none",this.container.style.position="fixed",this.container.style.overflow="auto",this.container.style.top="0",this.container.style.left="0",this.container.style.width="100%",this.container.style.height="100%",this.container.style.zIndex="2000",(0,n.fZ)(this.dialog,"dialog"),this.dialog.style.width="440px",this.dialog.style.minWidth="240px",this.dialog.style.position="relative",this.dialog.style.display="inline-block",this.dialog.style.borderRadius="10px",this.dialog.style.textAlign="left",this.dialog.style.overflow="hidden",this.dialog.style.zIndex="2001",this.dialog.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",this.title.style.display="block",this.title.style.fontSize="20px",this.title.style.paddingTop="20px",this.title.style.paddingLeft="20px",this.title.style.paddingRight="20px",this.title.style.paddingBottom="1px",this.title.style.fontWeight="bold",this.title.style.overflow="hidden",this.title.style.textOverflow="ellipsis",this.dialog.appendChild(this.title),this.message.style.display="inline-block",this.message.style.wordWrap="break-word",this.message.style.padding="20px",this.message.style.textAlign="left",this.dialog.appendChild(this.message);const e=document.createElement("div");(0,n.fZ)(e,"dialogForm"),(0,a.ZM)(e,{display:"flex",alignItems:"center",justifyContent:"end",borderTopWidth:"1px",borderTopStyle:"solid",textAlign:"center",height:"40px",gap:"10px"}),(0,n.fZ)(this.accept,"accept"),this.accept.style.minWidth="70px",this.accept.style.padding="3px",this.accept.style.marginRight="15px",this.accept.style.boxSizing="border-box",this.accept.innerText="OK",this.accept.style.cursor="pointer",this.accept.style.borderWidth="1px",this.accept.style.borderStyle="solid",this.accept.tabIndex=1,this.accept.onclick=e=>{e.stopPropagation(),void 0!==this.yesCallback&&this.yesCallback(),p.teardown()},(0,n.fZ)(this.decline,"decline"),this.decline.style.minWidth="70px",this.decline.style.padding="3px",this.decline.innerText="Cancel",this.decline.style.cursor="pointer",this.decline.tabIndex=2,this.decline.onclick=e=>{e.stopPropagation(),void 0!==this.noCallback?this.noCallback():void 0!==this.yesCallback&&this.yesCallback(),p.teardown()},e.appendChild(this.decline),e.appendChild(this.accept),this.dialog.appendChild(e),this.container.appendChild(this.dialog),(0,s.isRoomRoomlistSpaActive)()?s.UrlState.current.listenGlobal(s.ALL,(()=>{this.teardown()})):((0,o.wu)("popstate",window,(()=>{this.teardown()})),r.Gr.listen((()=>{this.teardown()})))}resize(){this.dialog.style.width=`${Math.min(440,document.documentElement.clientWidth-40)}px`,this.dialog.style.left=`${Math.max(0,(this.container.offsetWidth-this.dialog.offsetWidth)/2)}px`,this.dialog.style.top=`${Math.max(0,(this.container.offsetHeight-80-this.dialog.offsetHeight)/2)}px`}display(e,t,i,s){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.active)return void this.queue.push({msg:e,yesCallback:t,noCallback:i,config:s});this.message.innerText=e,this.handleConfig(s),this.container.style.display="block",this.yesCallback=t,void 0===i?p.decline.style.display="none":(this.noCallback=i,p.decline.style.display="");const r=new h.t,a=e=>{e.stopPropagation(),e.preventDefault(),r.execute(e)};r.addHandler({keyCode:13,requiresCtrlOrMeta:!1,handle:e=>{if(void 0!==i&&document.activeElement===p.decline)return i(),void this.teardown();t(),this.teardown()}}),n||r.addHandler({keyCode:27,requiresCtrlOrMeta:!1,handle:e=>{void 0!==i?i():t(),this.teardown()}}),void 0!==i&&r.addHandler({code:"Tab",requiresCtrlOrMeta:!1,handle:e=>{document.activeElement===p.accept?p.decline.focus():p.accept.focus()}}),this.active=!0;const c=()=>{this.resize()};(0,o.wu)("keydown",document,a,!0),(0,o.wu)("resize",window,c),(0,o.wu)("orientationchange",window,c),this.teardown=()=>{if(!this.active)return;d.$M.fire(!1);try{(0,o.Pf)("keydown",document,a,!0)}catch(e){debug("ModalAlert keydown listener was already removed")}try{(0,o.Pf)("resize",window,c)}catch(e){debug("ModalAlert resize listener was already removed")}this.container.style.display="none",this.active=!1,this.container.parentElement===document.body&&document.body.removeChild(this.container),this.yesCallback=void 0,this.noCallback=void 0;const e=this.queue.shift();void 0!==e&&this.display(e.msg,e.yesCallback,e.noCallback,e.config)};const u=(0,l.Gy)();void 0!==u&&Boolean(u)?u.appendChild(this.container):document.body.appendChild(this.container),this.resize(),d.$M.fire(!0)}handleConfig(e){void 0!==(null==e?void 0:e.title)?(this.title.style.display="block",this.title.innerText=e.title,!0===e.titleSmall&&(this.title.style.fontSize="16px")):this.title.style.display="none",!1===(null==e?void 0:e.allowDecline)&&(0,a.ZM)(this.decline,{display:"none"}),void 0!==(null==e?void 0:e.acceptText)?this.accept.innerText=e.acceptText:this.accept.innerText="OK",void 0!==(null==e?void 0:e.declineText)?this.decline.innerText=e.declineText:this.decline.innerText="Cancel"}}const p=new u;function m(e,t,i){void 0===t&&(t=()=>{}),p.display(e,t,void 0,i)}function g(e,t,i,s){var n,o;let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t=null!==(n=t)&&void 0!==n?n:()=>{},i=null!==(o=i)&&void 0!==o?o:()=>{},p.display(e,t,i,s,r)}function v(e,t,i){p.display(e,(()=>{void 0!==t&&t(),(0,o.Pf)("orientationchange",window,p.rotateDismissTeardownHandler)}),void 0,i),(0,o.wu)("orientationchange",window,p.rotateDismissTeardownHandler)}const f=new class extends u{constructor(){super()}displayForm(e,t,i,s,n){var o;let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.cancelActiveForm(),s=null!==(o=s)&&void 0!==o?o:"",super.display(s,t,i,n,r);const l=document.createElement("div");(0,a.ZM)(l,{minHeight:void 0!==n&&!0===n.separator?"15px":"0px"}),this.message.appendChild(l),this.form=e,this.message.appendChild(this.form),void 0===(null==n?void 0:n.acceptText)&&(this.accept.innerText="Apply"),!0===(null==n?void 0:n.orange)&&(0,a.ZM)(this.accept,c),this.accept.onclick=e=>{e.stopPropagation(),void 0!==this.yesCallback&&this.yesCallback(this.form),f.teardown()},this.decline.onclick=e=>{e.stopPropagation(),void 0!==this.noCallback&&this.noCallback(),f.teardown()}}cancelActiveForm(){this.active&&(void 0!==this.noCallback&&this.noCallback(),f.teardown())}};function y(e,t,i,s,n){var o;let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];i=null!==(o=i)&&void 0!==o?o:()=>{},f.displayForm(e,t,i,s,n,r)}},5216:(e,t,i)=>{"use strict";i.d(t,{$e:()=>p,Aw:()=>d,KF:()=>u,W9:()=>a,_Y:()=>o,fr:()=>r,ju:()=>m,vU:()=>c});var s=i(8861),n=i(9461);function o(e){if([".","?","#"].some((t=>e.startsWith(t))))return e;let t="";return null===e.match(/^[a-zA-Z]+:\/\//)&&(t=e.startsWith("/")?"":"/"),`${t}${e}`}class r extends Error{constructor(e){super(function(e){switch(e.readyState){case 0:return"request not sent";case 4:switch(e.status){case 0:return"network error";case 400:return"bad request";case 401:return"unauthorized";case 403:return"access denied";case 404:return"not found";case 429:return"request throttled";case 500:return"server error";default:return`unknown status ${e.status}`}default:return`unknown ready state ${e.readyState}`}}(e)),this.xhr=e,this.toString=()=>`XhrError: ${this.message}`,this.xhrErrorAttributes={status:e.status,reason:e.statusText,readyState:e.readyState}}}function a(e){return e>=200&&e<=299||1223===e}function l(e,t,i,s){var n,o;e.withCredentials=null===(n=null==s?void 0:s.withCredentials)||void 0===n||n,e.timeout=null!==(o=null==s?void 0:s.timeout)&&void 0!==o?o:6e4,e.onerror=()=>{i(new r(e))},e.onload=()=>{a(e.status)?t(e):i(new r(e))},!0!==(null==s?void 0:s.noRequestedWith)&&e.setRequestHeader("X-Requested-With","XMLHttpRequest")}function h(e,t){const i=Object.keys(t).map((e=>((e,t)=>`${e}=${encodeURIComponent(t)}`)(e,t[e]))).join("&");return o(""===i?e:`${e}?${i}`)}function d(e,t){return c(e,t)[1]}function c(e,t){return function(e,t,i){const s=new XMLHttpRequest;return[s,new Promise(((t,n)=>{s.open("GET",o(e)),l(s,t,n,i),s.send()}))]}(e,0,t)}function u(e,t,i){const s=function(e){if(e instanceof FormData)return e;const t=new FormData;for(const i of Object.keys(e))t.append(i,e[i]);return t}(t),n=g(s);return void 0===n?error("CSRF token is undefined"):s.set("csrfmiddlewaretoken",n),new Promise(((t,n)=>{const r=new XMLHttpRequest;r.open("POST",o(e),!0),l(r,t,n,i),r.send(s)}))}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const s=g();return new Promise(((n,o)=>{const a=new XMLHttpRequest;if(a.open("PUT",h(e,t),!0),l(a,n,o,i),void 0===s)return error("CSRF token is undefined"),void o(new r(a));a.setRequestHeader("X-CSRFToken",s),a.send()}))}function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const s=g();return new Promise(((n,o)=>{const a=new XMLHttpRequest;if(a.open("DELETE",h(e,t),!0),l(a,n,o,i),void 0===s)return error("CSRF token is undefined"),void o(new r(a));a.setRequestHeader("X-CSRFToken",s),a.send()}))}function g(e){const t=(0,s.oD)("csrftoken");if(void 0!==t)return t;if(void 0!==n.Bm.current.csrftoken)return n.Bm.current.csrftoken;let i;return void 0!==e&&e.has("csrfmiddlewaretoken")&&(i=e.get("csrfmiddlewaretoken")),i}},7322:(e,t,i)=>{"use strict";i.d(t,{Y6:()=>E,yc:()=>R,zZ:()=>k,un:()=>P,bt:()=>M});var s=i(4936),n=i(7623),o=i(7871),r=i(9461),a=i(6784),l=i(5216),h=i(2939),d=i(2709),c=i(3955),u=i(8423),p=i(6440);function m(e){const t={name:e.getString("name",!1),template:e.getString("template",!1)},i=e.getAny("layers");if(void 0!==i){const e=i;if(e instanceof Array&&0!==e.length){const i=[];for(const t of e)i.push(g(JSON.stringify(t)));t.layers=i}}const n=e.getObjectString("table",!1);if(0!==n.length){const e=function(e){const t=new s.N6(e),i={backgroundColor:t.getStringWithNumbers("background-color",!1),color:t.getStringWithNumbers("color",!1),textAlign:t.getStringWithNumbers("text-align",!1),fontStyle:t.getStringWithNumbers("font-style",!1),fontWeight:t.getStringWithNumbers("font-weight",!1)},n=t.getObjectString("row_1",!1);""!==n&&(i.rowOne=v(n));const o=t.getObjectString("row_2",!1);""!==o&&(i.rowTwo=v(o));const r=t.getObjectString("row_3",!1);return""!==r&&(i.rowThree=v(r)),i}(n);t.table=e}return function(e){const t=document.createElement("div");if(t.style.position="absolute",t.style.height=`${k}px`,t.style.width=`${P}px`,t.style.backgroundColor="transparent",t.style.overflow="hidden",t.style.font="1em 'UbuntuRegular', Arial, Helvetica, sans-serif",void 0!==e.layers)for(const i of e.layers)"text"===i.layerType?t.appendChild(y(i)):"image"===i.layerType&&(t.appendChild(b(i)),t.style.color="#000000");if(void 0!==e.table){const i=function(e){const t=document.createElement("div");t.style.height=`${k}px`,t.style.width=`${P}px`,t.style.backgroundColor=e.backgroundColor,t.style.color=e.color,t.style.fontStyle=e.fontStyle,t.style.fontWeight=e.fontWeight,t.style.textAlign=e.textAlign;for(const i of[e.rowOne,e.rowTwo,e.rowThree]){let e;e=void 0!==i?w(i):w(),t.appendChild(e)}return t}(e.table);t.appendChild(i)}return t}(t)}function g(e){const t=new s.N6(e);return{color:t.getStringWithNumbers("color",!1),filename:t.getStringWithNumbers("filename",!1),fontFamily:t.getStringWithNumbers("font-family",!1),fontSize:t.getStringWithNumbers("font-size",!1),fontStyle:t.getStringWithNumbers("font-style",!1),fontWeight:t.getStringWithNumbers("font-weight",!1),height:t.getStringWithNumbers("height",!1),imageUrl:t.getStringWithNumbers("image_url",!1),layerType:t.getStringWithNumbers("type",!1),left:t.getStringWithNumbers("left",!1),maxWidth:t.getStringWithNumbers("max-width",!1),opacity:t.getStringWithNumbers("opacity",!1),text:t.getStringWithNumbers("text",!1),textAlign:t.getStringWithNumbers("text-align",!1),top:t.getStringWithNumbers("top",!1),width:t.getStringWithNumbers("width",!1)}}function v(e){const t=new s.N6(e),i={backgroundColor:t.getStringWithNumbers("background-color",!1),color:t.getStringWithNumbers("color",!1),textAlign:t.getStringWithNumbers("text-align",!1),fontStyle:t.getStringWithNumbers("font-style",!1),fontWeight:t.getStringWithNumbers("font-weight",!1)},n=t.getObjectString("col_1",!1);""!==n&&(i.header=f(n));const o=t.getObjectString("col_2",!1);return""!==o&&(i.data=f(o)),i}function f(e){const t=new s.N6(e);return{backgroundColor:t.getStringWithNumbers("background-color",!1),color:t.getStringWithNumbers("color",!1),left:t.getStringWithNumbers("left",!1),textAlign:t.getStringWithNumbers("text-align",!1),fontStyle:t.getStringWithNumbers("font-style",!1),fontWeight:t.getStringWithNumbers("font-weight",!1),value:t.getStringWithNumbers("value",!1),width:t.getStringWithNumbers("width",!1)}}function y(e){const t=document.createElement("span");return t.style.position="absolute",t.style.whiteSpace="nowrap",t.style.overflow="hidden",t.style.textOverflow="ellipsis",t.style.lineHeight="normal",t.style.color=e.color,t.style.fontFamily=e.fontFamily,t.style.fontSize=e.fontSize,t.style.fontStyle=e.fontStyle,t.style.fontWeight=e.fontWeight,t.style.left=e.left,t.style.maxWidth=e.maxWidth,t.innerText=e.text,t.style.textAlign=e.textAlign,t.style.top=e.top,t.style.width=e.width,t}function b(e){const t=document.createElement("img");return t.style.position="absolute",t.alt="",t.style.height=e.height,t.src=e.imageUrl,t.style.left=e.left,t.style.top=e.top,t.style.width=e.width,t.style.opacity=e.opacity,t}function w(e){const t=document.createElement("div");if(t.style.height=k/3+"px",t.style.lineHeight=k/3+"px",t.style.width=`${P}px`,void 0!==e){if(t.style.backgroundColor=e.backgroundColor,t.style.color=e.color,t.style.fontStyle=e.fontStyle,t.style.fontWeight=e.fontWeight,t.style.textAlign=e.textAlign,void 0!==e.header){const i=C(e.header);t.appendChild(i)}if(void 0!==e.data){const i=C(e.data);t.appendChild(i)}}return t}function C(e){const t=document.createElement("div");return t.style.position="absolute",t.style.whiteSpace="nowrap",t.style.overflow="hidden",t.style.textOverflow="ellipsis",t.style.position="absolute",t.style.backgroundColor=e.backgroundColor,t.style.color=e.color,t.style.fontStyle=e.fontStyle,t.style.fontWeight=e.fontWeight,t.style.textAlign=e.textAlign,t.innerText=e.value,t.style.width=e.width,t.style.left=e.left,t}var S=i(9741),x=i(4947),T=i(3860);const P=270,k=69,A=new u.c_("panelUpdated"),M=(0,p.f)("MultiAppPanel");class R extends d.u{constructor(){super(),this.panelUpdated=A,this.hasContent=!0,this.bcpFallback=!1,this.element.style.width="320px",this.element.style.height=`${k}px`,this.element.style.position="relative",this.element.style.overflow="",h.X0.listen((e=>{this.roomUid=e.dossier.roomUid,this.getInitialPanel(!0),this.chatConnection=e.chatConnection,e.chatConnection.event.refreshPanel.listen((e=>{void 0===e||void 0===e.appId||void 0===e.appSystem?this.getInitialPanel(!1):this.refreshPanel(e.appId,e.appSystem)}))})),T.L.changeVideoMode.listen((e=>{e.currentMode!==e.previousMode&&"split"===e.currentMode&&this.getInitialPanel(!1)})),this.appPanelWrapper=document.createElement("div"),this.appPanelWrapper.style.height=`${k}px`,this.appPanelWrapper.style.overflow="hidden",this.appPanelWrapper.style.boxSizing="border-box",this.appPanel=new I,this.appPanelWrapper.appendChild(this.appPanel.element),this.element.appendChild(this.appPanelWrapper),(0,a.wu)("message",window,(e=>{switch(e.data){case"webc-bcp-fallback":if(e.origin!==this.appPanel.getWebcOrigin())return;this.bcpFallback=!0,this.chatConnection.event.refreshPanel.fire(void 0);break;case"request-auth-token":if(e.origin!==this.appPanel.getWebcOrigin())return;this.appPanel.sendAuthToken()}})),this.setupListeners()}getAppIndex(e){if(void 0===e)return-1;for(let t=0;t<this.panelList.length;t++)if(e===this.panelList[t].id)return t;return-1}getInitialPanel(e){(0,o.ld)(this.roomUid,this.bcpFallback).then((t=>{this.reset(t,e)})).catch((()=>{}))}reset(e,t){this.clear(),this.hasContent=!0;const i=(0,o.aL)(e);if(this.panelList=i.appList,this.panelList.length>0){var s;let n=this.getAppIndex(null===(s=this.currentApp)||void 0===s?void 0:s.id);-1===n&&(n=0),this.currentApp=this.panelList[n],void 0===i.error?this.appPanel=new I(e,t):(this.hasContent=!1,this.appPanel=new I)}else this.currentApp=void 0,this.hasContent=!1,this.appPanel=new I;this.appPanelWrapper.appendChild(this.appPanel.element),this.panelUpdated.fire(void 0)}extendPanel(){this.appPanel.element.style.position="absolute",this.appPanel.element.style.zIndex="1000",this.appPanel.element.style.height="337px"}shrinkPanel(){this.appPanel.element.style.position="static",this.appPanel.element.style.zIndex="auto",this.appPanel.element.style.height=`${k}px`}setupListeners(){(0,c.JR)(this.appPanelWrapper,{handleTouch:!0}).listen((e=>{e&&void 0!==this.currentApp?this.extendPanel():this.shrinkPanel()})),(0,n.OF)()&&window.setInterval((()=>{this.element.contains(document.activeElement)&&void 0!==this.currentApp?this.extendPanel():this.shrinkPanel()}),300)}previous(){var e;const t=this.getAppIndex(null===(e=this.currentApp)||void 0===e?void 0:e.id);t<1||(this.currentApp=this.panelList[t-1],this.refreshPanel(this.currentApp.id,this.currentApp.panelType))}next(){var e;const t=this.getAppIndex(null===(e=this.currentApp)||void 0===e?void 0:e.id);t!==this.panelList.length-1&&(this.currentApp=this.panelList[t+1],this.refreshPanel(this.currentApp.id,this.currentApp.panelType))}refreshPanel(e,t){(0,o.ld)(this.roomUid,this.bcpFallback,e,t).then((t=>{var i;const s=(0,o.aL)(t);this.panelList=s.appList,void 0===s.error||(null===(i=this.currentApp)||void 0===i?void 0:i.id)!==e?this.reset(t,!1):this.getInitialPanel(!1)})).catch((()=>{}))}removeDOMChildren(e){for(;null!==e.firstChild;)e.removeChild(e.firstChild)}clearAppPanel(){this.removeDOMChildren(this.appPanelWrapper)}clear(){this.clearAppPanel()}}class I extends d.u{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(),this.previewTime=5e3,this.element.style.position="relative",this.element.style.display="inline-block",this.element.style.width=`${P}px`,this.element.style.overflow="hidden",this.element.style.textShadow="none",this.element.style.fontSize="11px",this.element.style.lineHeight="1.7em",this.update(e,t)}update(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.cleanupPanel(),void 0===e)return this.panel=(0,S.o)(),void this.element.appendChild(this.panel);const i=(0,o.aL)(e);var s;void 0!==i.url?(this.element.style.width="320px",this.webcOrigin=null===(s=i.webcOrigin)||void 0===s?void 0:s.toLowerCase(),this.webcAuthToken=i.webcAuthToken,this.prepareIframePanel(i.url,t)):this.panel=this.createHTMLPanel(i.template,e),this.element.appendChild(this.panel)}getWebcOrigin(){return this.webcOrigin}sendAuthToken(){var e;void 0!==this.webcOrigin&&(null===(e=this.panel.contentWindow)||void 0===e||e.postMessage({type:"auth-token",value:this.webcAuthToken},this.webcOrigin))}prepareIframePanel(e,t){r.Bm.current.isBroadcast&&t?(this.preview=document.createElement("div"),this.preview.style.width="320px",this.preview.style.height="69px",this.preview.style.textAlign="center",this.preview.style.lineHeight="5em",this.preview.style.fontSize="14px",this.preview.style.fontWeight="bold",this.preview.style.boxShadow="inset 0 0 100px 10px rgba(0, 0, 0, 0.32)",this.preview.innerText=x.R.loadingPreview,this.element.appendChild(this.preview),this.panel=this.createIframePanel(""),this.panel.style.display="none",this.previewTimer=window.setTimeout((()=>{this.element.removeChild(this.preview),this.panel.src=e,this.panel.style.display="block"}),this.previewTime)):this.panel=this.createIframePanel(e)}createHTMLPanel(e,t){switch(e){case"image_template":return m(t);case"3_rows_11_21_31":case"3_rows_11_22_32":case"3_rows_12_21_31":case"3_rows_12_22_31":case"3_rows_of_labels":return(0,S.o)(t);default:return warn(`template of type (${e}): is not supported`),(0,S.o)()}}createIframePanel(e){const t=document.createElement("iframe");return t.id="appPanelFrame",t.src=e,t.style.border="none",t.style.padding="0",t.style.background="#FFFFFF",t.style.width="100%",t.style.height="100%",(0,c.JR)(t).listen((e=>{this.element.style.filter=e?"drop-shadow(0px 0px 16px rgba(0, 0, 0, 0.3))":""})),(0,n.OF)()&&window.setInterval((()=>{this.element.contains(document.activeElement)?this.element.style.filter="drop-shadow(0px 0px 16px rgba(0, 0, 0, 0.3))":this.element.style.filter=""}),300),t}cleanupPanel(){clearTimeout(this.previewTimer),this.removeAllDOMChildren()}}class E extends d.u{constructor(){super(),this.panelUpdated=new u.c_("panelUpdated"),this.hasContent=!1,this.element.style.display="inline-block",this.element.style.paddingLeft="5px",this.element.style.paddingTop="3px",this.element.style.paddingRight="5px",this.element.style.paddingBottom="3px",this.element.style.position="",this.element.style.width=`${P}px`,this.element.style.height=`${k}px`,this.element.style.textShadow="none",this.element.style.fontSize="11px",this.element.style.lineHeight="1.7em",this.element.style.overflow="hidden",h.X0.listen((e=>{this.updateAppPanel(e.chatConnection.room()),e.chatConnection.event.refreshPanel.listen((()=>{this.updateAppPanel(e.chatConnection.room())})),e.chatConnection.event.clearApp.listen((()=>{this.updateAppPanel(e.chatConnection.room())}))})),this.appPanelTable=(0,S.o)(),this.element.appendChild(this.appPanelTable)}updateAppPanel(e){(0,l.Aw)(`api/panel_context/${e}/`).then((e=>{this.cleanupPanel();const t=new s.N6(e.responseText);if("no-content"===t.getString("code",!1))return this.hasContent=!1,this.appPanelTable=(0,S.o)(),this.element.appendChild(this.appPanelTable),void this.panelUpdated.fire(void 0);this.hasContent=!0;const i=t.getString("template",!1);switch(i){case"image_template":this.appPanelTable=m(t);break;case"3_rows_11_21_31":case"3_rows_11_22_32":case"3_rows_12_21_31":case"3_rows_12_22_31":case"3_rows_of_labels":this.appPanelTable=(0,S.o)(t);break;default:this.hasContent=!1,this.appPanelTable=(0,S.o)(),warn(`template of type (${i}): is not supported`)}t.logUnusedDebugging("updateAppPanel"),this.element.appendChild(this.appPanelTable),this.panelUpdated.fire(void 0)})).catch((e=>{e.message.toLowerCase().includes("network error")||error("Error fetching app panel",e)}))}cleanupPanel(){this.element.children.length>0&&this.element.removeChild(this.appPanelTable)}}},3971:(e,t,i)=>{"use strict";i.d(t,{$:()=>o,_:()=>r});var s=i(7322),n=i(2939);const o=2e3;class r{constructor(e){this.config=e,this.appPanel=new s.Y6,this.appPanel.element.style.width=`${s.un}px`,this.appPanel.element.style.position="relative",this.hasContent=!1,this.canUpdatePanel=!1,n.X0.listen((e=>{this.hasContent=!1,this.canUpdatePanel=!1,this.appPanelLastId=void 0,window.setTimeout((()=>{this.canUpdatePanel=!0,this.hasContent&&this.updatePanel()}),o)})),this.appPanel.panelUpdated.listen((()=>{this.hasContent=!0,this.canUpdatePanel&&this.updatePanel()}))}updatePanel(){if(!this.appPanel.hasContent)return;if(void 0===this.appPanelLastId)return this.config.appendMessageDiv(this.appPanel.element),void(this.appPanelLastId=this.config.getLastMessageId());const e=this.appPanel.element.offsetTop-this.config.getMessagesScrollTop();(e<0||e>this.config.getMessagesOffsetHeight()-30)&&this.config.messagesSinceId(this.appPanelLastId)>20&&(this.config.removeMessageDiv(this.appPanel.element),this.config.appendMessageDiv(this.appPanel.element),this.appPanelLastId=this.config.getLastMessageId())}}},768:(e,t,i)=>{"use strict";i.d(t,{T:()=>r});var s=i(7623),n=i(6784),o=i(5389);class r{constructor(){this.soundMap=new Map,this.supported=!0,this.supported=(0,s.xe)()&&((0,s.o)()||(0,s.Hg)()),this.init(),(0,n.wu)("beforeunload",window,(e=>{this.close()})),o.g$.listen((e=>{if(e&&(0,s.OF)()){const e=(0,s.yb)();void 0!==e&&e<13?this.init():void 0!==this.context&&this.context.resume()}}))}init(){if(this.supported)if((0,s.o)()){info("Using audio context"),this.close(),this.ensureContextCreated(!1);const e=()=>{this.playEmptySound(),(0,n.Pf)("click",document,e),(0,n.Pf)("touchstart",document,e),(0,n.Pf)("touchend",document,e)};(0,n.wu)("click",document,e),(0,n.wu)("touchstart",document,e),(0,n.wu)("touchend",document,e)}else info("Using audio elements");else warn("Sounds are not supported.")}close(){void 0!==this.context&&("close"in this.context&&this.context.close(),this.context=void 0)}loadSound(e,t){if(this.soundMap.set(e,{ready:!1}),void 0!==this.context){const i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=()=>{i.status<200||i.status>=300?error("Error requesting sound",{soundName:e,status:i.status,statusText:i.statusText}):void 0!==this.context?this.context.decodeAudioData(i.response.slice(0),(t=>{debug(`Loaded sound ${e}`),this.soundMap.set(e,{ready:!0,buffer:t})}),(t=>{error("Error decoding sound",{soundName:e,message:t})})):this.supported&&error("audioHolder loadSound missing context")},i.onerror=()=>{error("Error requesting sound",{soundName:e,status:i.status,statusText:i.statusText})},i.send()}else(0,s.Hg)()&&this.soundMap.set(e,{ready:!0,audioElement:new Audio(t)})}loadTipSounds(){this.loadSound("HugeTip",`${STATIC_URL}sounds/classic/huge.mp3`),this.loadSound("LargeTip",`${STATIC_URL}sounds/classic/large.mp3`),this.loadSound("MediumTip",`${STATIC_URL}sounds/classic/medium.mp3`),this.loadSound("SmallTip",`${STATIC_URL}sounds/classic/small.mp3`),this.loadSound("TinyTip",`${STATIC_URL}sounds/classic/tiny.mp3`)}loadPrivateShowSounds(){this.loadSound("PrivateShow",`${STATIC_URL}sounds/show.mp3`)}playSound(e,t){if(!this.canPlaySound(e,t))return;const i=this.soundMap.get(e);if(void 0!==i)if(i.ready)if(void 0!==i.buffer){if(this.ensureContextCreated(),void 0===this.context)return void(this.supported&&error("audioHolder playSound missing context"));const s=this.context.createBufferSource();s.buffer=i.buffer;const n=this.context.createGain();s.connect(n),n.connect(this.context.destination),n.gain.value=t/3.5/100,debug(`play sound ${e} volume ${t/3.5} (video at ${t}) gain ${n.gain.value}`),s.start(0)}else if(void 0!==i.audioElement){i.audioElement.volume=t/100;const s=i.audioElement.play();void 0!==s&&s.catch((t=>{error(`Error playing sound ${e} (${t})`)}))}else error(`Missing sound buffer or element for ${e}`);else warn(`sound ${e} not ready yet (and may never will be ready)`)}ensureContextCreated(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.supported&&void 0===this.context&&(e&&warn("audioHolder context unexpectedly missing"),"webkitAudioContext"in window?this.context=new webkitAudioContext:this.context=new AudioContext)}canPlaySound(e,t){return this.supported?0===t?(debug(`Not playing sound ${e} at volume 0`),!1):t>100||t<0||isNaN(t)?(error(`setSoundVolume: invalid volume ${t}`),!1):!!this.soundMap.has(e)||(error(`Unknown sound: ${e}`),!1):(debug(`Not playing sound ${e} because sound is not supported`),!1)}playEmptySound(){if(void 0===this.context)return;const e=this.context.createBufferSource();e.buffer=this.context.createBuffer(1,1,22050),e.connect(this.context.destination),e.start(0)}}},6844:(e,t,i)=>{"use strict";i.d(t,{n:()=>h,ok:()=>r,rC:()=>l});var s=i(9461),n=i(6064),o=i(213);function r(){var e;return void 0===(null===(e=s.Bm.current)||void 0===e?void 0:e.loggedInUser)}let a;function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Login required",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;return!!r()&&(void 0!==a&&t?a():(0,o.mf)(e,(()=>{(0,n.DC)(null!=s?s:{})}),i),!0)}function h(e){a=e}},6657:(e,t,i)=>{"use strict";i.d(t,{c:()=>g});var s=i(9447),n=i(9461),o=i(6784),r=i(5216),a=i(2939),l=i(1519),h=i(3955),d=i(8423),c=i(4693),u=i(5173),p=i(74);const m=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Enter","Escape","Space","Tab"];class g extends u.Q{constructor(e){super(e),this.config=e,this.items=[],this.selectedIndex=-1,this.cacheTTL=-1,this.overlayClick.listen((()=>{this.isValidSelectionIndex()&&this.finalizeSelection(),this.hide()})),this.initEventListeners()}initEventListeners(){(0,o.wu)("input",this.config.inputElement.element,(()=>{this.handleInputChange()})),(0,o.wu)("keydown",this.config.inputElement.element,(e=>{this.handleKeydown(e)})),a.Gr.listen((()=>{this.hide()})).addTo(this.listenerGroup)}handleKeydown(e){this.visible&&(this.handleArrowUpDown(e),["Tab","ArrowRight","Space","Enter"].includes(e.code)&&(e.preventDefault(),e.stopPropagation(),this.hide(),n.Bm.current.isMobile&&"Enter"===e.code||this.finalizeSelection()),"Escape"!==e.code&&"ArrowLeft"!==e.code||(e.preventDefault(),this.hide(),this.deleteHighlightedSuffix()))}handleArrowUpDown(e){"ArrowUp"===e.code&&(e.preventDefault(),this.scrollList(!0)),"ArrowDown"===e.code&&(e.preventDefault(),this.scrollList(!1))}initData(){super.initData(),this.list=document.createElement("div"),this.visible=!1,this.disableCache=!1,this.isPrefixSearch=!0,this.listenerGroup=new d.gt,this.regex=this.buildRegex(),this.getDataDebouncer=new l.a((()=>this.getData()),{bounceLimitMS:this.getDataDebounceMS(),debounceType:1}),this.initDelay()}initUI(e){super.initUI(),(0,s.fZ)(this.element,"autocompleteModal"),this.element.style.visibility="hidden",this.element.style.width="auto",this.element.style.maxWidth="260px",this.element.style.height="auto",this.element.style.borderWidth="1px",this.element.style.borderStyle="solid",this.element.style.borderBottom="none",this.element.style.fontFamily="Helvetica, Arial, sans-serif",this.element.style.cursor="pointer",this.list.style.width="auto",this.list.style.maxHeight="180px",this.list.style.overflowY="scroll",this.element.appendChild(this.list)}buildRegex(){return new RegExp(`(?<preslug>(?:^|.*\\s+)${this.promptRegex()})(?<slug>${this.searchSlugRegex()})$`,"i")}dispose(){this.listenerGroup.removeAll()}initDelay(){this.delay=n.Aw.getState().userChatSettings.emoticonAutocompleteDelay,a.X0.listen((e=>{this.delay=e.dossier.userChatSettings.emoticonAutocompleteDelay})).addTo(this.listenerGroup),p.EZ.listen((e=>{this.delay=e.emoticonAutocompleteDelay})).addTo(this.listenerGroup)}repositionChildren(){const e=this.config.inputElement.caretXPos(!0)+this.config.leftOffset,t=this.config.inputElement.element.clientWidth-this.config.rightOffset;this.element.style.left=`${Math.max(4,Math.min(e,t))}px`}setItems(e){this.items=e,this.displayedResultsSearchSlug=this.searchSlug,this.updateListDOM()}getData(){const e=this.searchSlug;this.isGetDataCancelled()||(0,r.Aw)(this.getDataEndpoint(),this.xhrConfig).then((t=>{if(this.searchSlug!==e)return;const i=this.parseResponse(t.responseText);this.setItems(i),this.disableCache||this.cache.set(this.searchSlug,i)})).catch((e=>{error("Error autocomplete modal",e)}))}updateItems(){if(this.disableCache)this.getDataDebouncer.callFunc();else{const e=this.getCache().get(this.normalizedSearchSlug());void 0!==e?this.setItems(e):this.getDataDebouncer.callFunc()}}handleInputChange(){if(this.delay>=0&&this.config.inputElement.getAvailableLength()>this.maxOptionLength){const e=this.inputMatch();if(void 0!==e){if(this.searchSlug=e,void 0!==this.maxSearchSlugLength&&this.searchSlug.length>this.maxSearchSlugLength)return void warn(`Autocomplete search slug >${this.maxSearchSlugLength} chars. Not updating.`);this.clearSelectionStyle(),this.selectedIndex=-1,this.updateItems()}else this.hide()}}getCache(){return void 0===this.cache&&(this.cache=new c.Be(this.filterAfterSize,this.cacheTTL)),this.cache}normalizedSearchSlug(){return this.searchSlug}inputMatch(){const e=this.config.inputElement.getCurrentNodePreCaretText().match(this.regex);if(null!=e&&void 0!==e.groups)return e.groups.slug}isSpecialFunctionKey(e){return m.includes(e.code)}updateListDOM(){this.clearListDOM(),0===this.items.length?this.element.style.display="none":this.element.style.display="block";for(let e=0;e<this.items.length;e+=1)this.appendItem(this.items[e],e);const e=this.list.children.length<=0?0:this.list.children.item(this.list.children.length-1).offsetTop;this.list.scrollTop=e,this.visible||this.show()}clearListDOM(){for(;null!==this.list.firstChild;)this.list.removeChild(this.list.firstChild);this.selectedIndex=-1}scrollList(e){this.clearSelectionStyle();let t=this.isValidSelectionIndex()?this.selectedIndex+(e?-1:1):e?this.items.length-1:0;t<0?t=this.items.length-1:t>=this.items.length&&(t=0),this.pickItem(t,!0)}highlightSelectedIndex(e){this.isValidSelectionIndex()&&this.items.length>0&&(this.clearSelectionStyle(),(0,s.fZ)(this.items[this.selectedIndex].element,"selectedEmoticon"),this.items[this.selectedIndex].element.dataset.testid="selected-emoticon",e&&this.scrollToIndex(this.selectedIndex))}replacePreCaratInputText(e,t){const i=t?e.length-(this.isPrefixSearch?this.searchSlug.length:0):0,s=Math.max(i,0);try{this.config.inputElement.replaceCurrentNodePreCaretText(this.regex,`$<preslug>${e}`,s)}catch{this.hide()}}scrollToIndex(e){const t=this.list.clientHeight,i=this.list.firstChild.getBoundingClientRect().height;this.list.scrollTop=e*i-t/2}deleteHighlightedSuffix(){this.config.inputElement.deleteSelection()}finalizeSelection(){this.config.inputElement.setCaretToEndOfSelection(),this.config.inputElement.insertText(" ")}show(){this.delay>=0&&window.setTimeout((()=>{void 0!==this.inputMatch()&&(this.element.style.visibility="visible",0===(0,h.Lx)(this.element.style.width)&&(this.element.style.width="auto",this.element.style.width="-moz-available",this.element.style.width="-webkit-fill-available",this.element.style.width="fill-available"),this.element.style.height="auto",this.showOverlay(),this.repositionChildrenRecursive(),this.visible=!0)}),this.delay)}hide(){this.hideOverlay(),this.element.style.visibility="hidden",this.element.style.width="0",this.element.style.height="0",this.visible=!1,this.clearListDOM()}clearSelectionStyle(){for(const e of this.items)(0,s.SA)(e.element,"selectedEmoticon"),e.element.dataset.testid="autocomplete-item"}appendItem(e,t){const i=document.createElement("div");(0,s.fZ)(i,"modalItem"),i.style.padding="2px 8px",this.shouldIgnoreItem(e)&&(i.style.display="none"),i.onclick=e=>{this.pickItem(t,!1),e.preventDefault()},i.dataset.testid="autocomplete-item";const n=document.createElement("div");return n.dataset.testid="emoticon-title",(0,s.fZ)(n,"tag-text"),n.textContent=e.slug,n.title=e.slug,n.style.overflow="hidden",n.style.textOverflow="ellipsis",i.appendChild(n),this.list.appendChild(i),e.element=i,i}pickItem(e,t){void 0!==this.displayedResultsSearchSlug?(this.searchSlug!==this.displayedResultsSearchSlug&&(this.searchSlug=this.displayedResultsSearchSlug),this.selectedIndex=e,this.isValidSelectionIndex()&&this.items.length>0&&(this.highlightSelectedIndex(t),this.replacePreCaratInputText(this.items[this.selectedIndex].slug,!0))):error("displayedResultsSearchSlug unset while picking results")}shouldIgnoreItem(e){return!1}isVisible(){return this.visible}isValidSelectionIndex(){return this.selectedIndex>=0&&this.selectedIndex<this.items.length}isGetDataCancelled(){return-1!==this.selectedIndex}getDataDebounceMS(){return 200}}},6066:(e,t,i)=>{"use strict";i.d(t,{v:()=>r});var s=i(7623),n=i(6784),o=i(8466);class r{constructor(e){this.config=e,this.scrolling=!1;const t=e.autocompleteConfig;(0,n.wu)("touchstart",e.element,(()=>{this.scrolling=!1,t.inputElement.setCaretToEndOfSelection()})),e.overlayClick.listen((()=>{t.inputElement.setCaretToEndOfSelection()})),e.listenerGroup.add(o.R.listen((()=>{e.hide()}))),e.list.onscroll=()=>{this.scrolling=!0},!(0,s.OF)()&&e.hideOnSpace&&(0,n.wu)("beforeinput",t.inputElement.element,(t=>{" "===t.data&&e.hide()}))}customizeItem(e,t){e.ontouchend=e=>{this.scrolling||(this.config.pickItem(t,!1),e.preventDefault())}}onShow(){this.config.element.style.width=`${this.config.autocompleteConfig.inputElement.element.offsetWidth}px`}}},5581:(e,t,i)=>{"use strict";i.d(t,{EY:()=>a,Fk:()=>l,WO:()=>d,_W:()=>c,zB:()=>h});var s=i(4936),n=i(9461),o=i(5216),r=i(7407);const a=150;function l(e,t){var i;const o=new s.N6(e),a={infoSection:{username:t,fanClubCost:o.getNumber("fan_club_cost",!1),isInFanClub:o.getBoolean("fan_club_is_member"),hasFanClub:o.getBoolean("performer_has_fanclub"),fanClubJoinUrl:`${o.getString("fan_club_join_url")}?source=${null===(i=n.Bm.current)||void 0===i?void 0:i.PurchaseEventSources.SUPPORTER_SOURCE_JOIN_FAN_CLUB_BUTTON}`,location:o.getString("location"),interestedIn:o.getObjectString("interested_in"),realName:o.getString("real_name"),sex:(0,s.nx)(o.getString("sex")),subgender:(0,s.nx)(o.getString("subgender")),followersCount:o.getNumber("follower_count"),displayAge:o.getNumber("display_age",!1),bodyDecorations:o.getString("body_decorations"),displayBirthday:o.getString("display_birthday",!1),lastBroadcast:o.getStringOrUndefined("time_since_last_broadcast"),smokeDrink:o.getString("smoke_drink"),bodyType:o.getString("body_type"),languages:o.getStringOrUndefined("languages"),roomStatus:o.getString("room_status"),needsSupporterToPm:o.getBoolean("needs_supporter_to_pm")},aboutMe:o.getString("about_me"),wishList:o.getString("wish_list"),photoSets:(e=>{const t=[];for(const i of JSON.parse(e)){const e=new s.N6(JSON.stringify(i));t.push({id:e.getNumber("id"),name:e.getString("name"),coverUrl:e.getString("cover_url"),tokens:e.getNumber("tokens"),isVideo:e.getBoolean("is_video"),videoHasSound:e.getBoolean("video_has_sound"),userCanAccess:e.getBoolean("user_can_access"),fanClubOnly:e.getBoolean("fan_club_only"),fanClubUnlock:e.getBoolean("fan_club_unlock"),labelText:e.getString("label_text"),labelColor:e.getString("label_color"),pendingApproval:e.getBoolean("pending_approval",!1,!1),failedApproval:e.getBoolean("failed_approval",!1,!1),rejectionNotes:e.getString("rejection_notes",!1),videoIsReady:e.getBoolean("video_ready",!1,!1),videoErrorProcessing:e.getBoolean("video_error_processing",!1,!1),userHasPurchased:e.getBoolean("user_has_purchased")}),e.logUnusedDebugging("parseBioApiResponse.photoset")}return t})(o.getObjectString("photo_sets")),socialMedias:(e=>{const t=[];for(const i of JSON.parse(e)){const e=new s.N6(JSON.stringify(i));t.push({id:e.getNumber("id"),titleName:e.getString("title_name"),imageUrl:e.getString("image_url"),link:e.getString("link"),popup:e.getBoolean("popup_link"),tokens:e.getNumber("tokens"),purchased:e.getBoolean("purchased"),labelText:e.getString("label_text"),labelColor:e.getString("label_color")}),e.logUnusedDebugging("parseBioApiResponse.socials")}return t})(o.getObjectString("social_medias")),isBroadcasterOrStaff:o.getBoolean("is_broadcaster_or_staff"),gameSelection:(e=>{if(void 0!==e)return{description:e.description,gameUrl:e.game_url,image:e.image_64x64,name:e.name,uid:e.uid,viewers:e.viewers}})(o.getObjectOrUndefined("game_selection"))};return o.logUnusedDebugging("parseBioApiResponse.bioParsed"),(0,r.bT)("BioLoaded"),a}function h(e){return new Promise(((t,i)=>{(0,o.Aw)(`api/biocontext/${e}/`).then((i=>{t(l(i.responseText,e))})).catch((e=>{i(e)}))}))}function d(e,t){(0,r.bT)("PhotoSetClicked",{source:t,photoset_id:e.id,cost:e.tokens,is_video:e.isVideo})}function c(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=e.getElementsByTagName("*");t.style.position="relative",t.style.zIndex="0";for(const e of n)if(e instanceof HTMLElement&&(e.style.position.includes("fixed")&&(e.style.position="absolute"),i&&u(e),s&&"img"===e.tagName.toLowerCase())){const t=e.cloneNode();t.style.visibility="hidden",document.body.appendChild(t),t.onload=()=>{e.style.height=.5*t.offsetHeight+"px",e.style.width=.5*t.offsetWidth+"px",document.body.removeChild(t)},t.onerror=()=>{document.body.removeChild(t)}}}function u(e){null!==e.style.top&&parseInt(e.style.top,10)<0&&(e.style.top="0"),null!==e.style.marginTop&&parseInt(e.style.marginTop,10)<0&&(e.style.marginTop="0"),null!==e.style.left&&parseInt(e.style.left,10)<0&&(e.style.left="0"),null!==e.style.marginLeft&&parseInt(e.style.marginLeft,10)<0&&(e.style.marginLeft="0")}},1918:(e,t,i)=>{"use strict";i.d(t,{x:()=>C});var s=i(4936),n=i(7623),o=i(9447),r=i(9930),a=i(5330),l=i(369),h=i(9603),d=i(5216),c=i(5581),u=i(4354),p=i(2939),m=i(5020),g=i(3955),v=i(9268),f=i(74),y=i(4947),b=i(1372),w=i(5389);class C extends u.y{constructor(){super(),this.customSections=[],(0,o.fZ)(this.element,"BioContents"),this.element.dataset.testid="room-bio-tab-contents",this.element.style.width="100%",this.element.style.margin="0 0 14px",this.loadingMsg.style.padding="14px 14px 0",this.errorMsg.style.padding="14px 14px 0",p.BR.listen((e=>{this.loadRoom(e.dossier.room)})),p.X0.listen((e=>{this.loadRoom(e.dossier.room)})),window.refreshSocials=()=>{this.load()}}loadRoom(e){this.room=e,this.setResourceUrl(`api/biocontext/${this.room}/`),this.load()}show(){this.element.style.display="",this.element.style.height="",this.element.style.minHeight="325px",void 0!==this.adjustMargin&&this.adjustMargin(),void 0!==this.adjustWidth&&this.adjustWidth(),this.showingError&&this.load()}hide(){this.element.style.height="0",this.element.style.minHeight="0",this.element.style.margin="0"}checkBeforeSwitch(e){e()}parseData(e){return(0,c.Fk)(e,this.room)}createContent(e){this.createBioContents(e)}clearContent(){super.clearContent(),this.clearResizeListeners()}clearResizeListeners(){void 0!==this.adjustWidth&&l.oO.removeListener(this.adjustWidth),void 0!==this.adjustMargin&&l.oO.removeListener(this.adjustMargin)}createResizeListeners(){this.clearResizeListeners(),this.adjustWidth=(0,l.Rk)(this.labelRef,500,600,[{name:"width",min:117,max:150},{name:"min-width",min:117,max:150}]),this.adjustMargin=(0,l.Rk)(this.tableRef,500,530,[{name:"margin-right",min:0,max:14},{name:"padding-right",min:0,max:14}])}repositionChildren(){for(const e of this.customSections)(0,c._W)(e,this.bioRootWrapper)}createPhotoVideos(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.photoSets.filter((e=>e.isVideo)),s=e.photoSets.filter((e=>!e.isVideo)),n=e.infoSection.hasFanClub;if(i.length>0||t){const t=this.generatePhotoVideoSection(i,e.infoSection.username,e.isBroadcasterOrStaff,n,"video");this.bioRootElement.appendChild(t)}if(s.length>0||t){const t=this.generatePhotoVideoSection(s,e.infoSection.username,e.isBroadcasterOrStaff,n);this.bioRootElement.appendChild(t)}}createBioContents(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.bioRootWrapper=(0,b.tT)("div",{style:{paddingLeft:"14px",overflow:"hidden"}}),this.bioRootElement=(0,b.tT)("table",{style:{tableLayout:"fixed",width:"100%"},ref:e=>{this.tableRef=e}},(0,b.tT)("tr",{style:{height:"1px"}},(0,b.tT)("th",{style:{width:"150px",minWidth:"150px"},ref:e=>{this.labelRef=e}}),(0,b.tT)("th",null)),(0,b.tT)("tr",{style:{verticalAlign:"top"}},(0,b.tT)("th",{colSpan:2},(0,b.tT)("h1",{colorClass:[o.aG.defaultColor,"bioHeader"],style:{fontSize:`${S}.4px`,fontFamily:"UbuntuMedium, Arial, Helvetica, sans-serif",fontWeight:"normal",margin:"10px 0 20px",lineHeight:"20px",textAlign:"left"},ref:e=>{this.header=e},"data-testid":"bio-header"})))),this.bioRootWrapper.appendChild(this.bioRootElement),this.element.appendChild(this.bioRootWrapper),this.createResizeListeners();const i=e.infoSection;if(this.room===i.username){if(this.header.innerText=y.R.bioAndFreeWebCamText((0,s.nx)(this.room)),this.createSections(i),this.shouldShowSocialMediaSection(e.socialMedias.length)){const t=this.generateSocialMediaSection(e.socialMedias,e.infoSection.username);this.bioRootElement.appendChild(t)}if(this.shouldShowPicsSection(e.photoSets.length)&&this.createPhotoVideos(e,t),e.aboutMe.length>=1){const t=this.generateSectionWithUserHTML(e.aboutMe,y.R.aboutMeText);(0,r.r)()||(0,v.Nb)(t),this.bioRootElement.appendChild(t),this.afterCustomSectionCreated(t)}if(e.wishList.length>=1){const t=this.generateSectionWithUserHTML(e.wishList,y.R.wishListText);(0,r.r)()||(0,v.Nb)(t),this.bioRootElement.appendChild(t),this.afterCustomSectionCreated(t)}this.repositionChildren()}}createSections(e){if(""!==e.realName&&this.bioRootElement.appendChild(this.createSection(y.R.realNameText,e.realName,!1)),this.bioRootElement.appendChild(this.createFollowersSection(e.followersCount)),""!==e.displayBirthday&&this.bioRootElement.appendChild(this.createSection(y.R.birthdateText,e.displayBirthday,!1)),isNaN(e.displayAge)||this.bioRootElement.appendChild(this.createSection(y.R.ageText,e.displayAge.toString(),!1)),"A Couple"===e.sex?this.bioRootElement.appendChild(this.createSection(y.R.sexTextCouple,e.sex,!1)):"Trans"===e.sex&&e.subgender?this.bioRootElement.appendChild(this.createSection(y.R.sexText,`${e.sex} (${e.subgender})`,!1)):this.bioRootElement.appendChild(this.createSection(y.R.sexText,e.sex,!1)),""!==e.interestedIn){let t=e.interestedIn;if(t=t.slice(1,t.length-1),""!==t){for(;t.includes('"');)t=t.replace('"',"");t=t.split(",").join(", "),this.bioRootElement.appendChild(this.createSection(y.R.interstedInText,t,!1))}}""!==e.location&&this.bioRootElement.appendChild(this.createSection(y.R.locationText,e.location,!1)),void 0!==e.lastBroadcast&&""!==e.lastBroadcast&&this.bioRootElement.appendChild(this.createSection(y.R.lastBroadcastText,e.lastBroadcast,!1)),void 0!==e.languages&&""!==e.languages&&this.bioRootElement.appendChild(this.createSection(y.R.languagesText,e.languages,!1)),""!==e.bodyType&&this.bioRootElement.appendChild(this.createSection(y.R.bodyTypeText,e.bodyType,!1)),""!==e.smokeDrink&&this.bioRootElement.appendChild(this.createSection(y.R.smokeOrDrinkText,e.smokeDrink,!1)),""!==e.bodyDecorations&&this.bioRootElement.appendChild(this.createSection(y.R.bodyDecorationsText,e.bodyDecorations,!1))}createFollowersSection(e){return this.createSection(y.R.followersText,isNaN(e)?"0":e.toString(),!1)}shouldShowSocialMediaSection(e){return e>=1}shouldShowPicsSection(e){return e>=1}generateSocialMediaSection(e,t){const i=e=>{const t=(0,v.L4)();t.dataset.testid="social-media-item";const i=e.link;t.href=(0,d._Y)(i),t.style.position="relative",t.style.display="inline-block",t.style.marginBottom="17px",t.style.marginRight="5px",t.style.cursor="pointer",t.className="socialMediaUpload",t.title=e.titleName,(0,g._W)(t),e.popup?t.onclick=()=>((0,w.gr)(i,void 0,`resizable,dependent,scrollbars,height=700,width=700,top=${screen.height/2-600},left=${screen.width/2-800}`),!1):t.target="_blank";const s=document.createElement("img");if(s.dataset.testid="social-media-preview",(0,o.fZ)(s,"previewBorder"),s.src=e.imageUrl,s.width=x,s.height=T,s.style.borderWidth="1px",s.style.borderStyle="solid",s.style.display="block",s.style.borderRadius="3%",s.style.display="block",t.appendChild(s),""!==e.labelText){const i=document.createElement("span");i.dataset.testid="social-media-tokens-badge",(0,o.fZ)(i,"tokenText"),i.innerText=e.labelText,i.style.backgroundColor=e.labelColor,i.style.position="absolute",i.style.bottom="16px",i.style.right="0",i.style.margin="8px",i.style.fontSize="9px",i.style.borderRadius="2px",i.style.padding="1px 3px",i.style.lineHeight="12px",t.appendChild(i)}const n=document.createElement("div");return n.dataset.testid="social-media-title",(0,o.fZ)(n,"link"),n.innerText=e.titleName,n.style.fontSize=`${S}px`,n.style.left="0px",n.style.maxWidth="145px",n.style.whiteSpace="nowrap",n.style.textOverflow="ellipsis",n.style.overflow="hidden",n.style.lineHeight="16px",n.style.textDecoration="none",t.appendChild(n),t},s=[];let n=0;for(const t of e){if(8===n)break;s.push(i(t)),n+=1}const r=e.length>8;s.push(this.generateSocialMediaLinks(t,r));const a=this.createSection(y.R.socialMediaText,s);return(0,o.fZ)(a,"smContainer"),a}generateSocialMediaLinks(e,t){const i=document.createElement("div");if(i.style.marginBottom="20px",t){const t=(0,v.L4)(),s=`/socials/social_media/list_popup/${e}/`;(0,o.fZ)(t,"link"),t.href=(0,d._Y)(s),t.innerText=y.R.showMoreText,t.style.fontSize="14px",t.style.cursor="pointer",(0,g._W)(t),t.onclick=e=>{(0,w.gr)(s,void 0,`resizable,dependent,scrollbars,height=600,width=800,top=${screen.height/2},left=${screen.width/2}`),e.preventDefault()},i.appendChild(t)}return i}generatePhotoVideoSection(e,t,i,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"photo";const l=e=>{const r=(0,v.L4)();r.dataset.testid="photo-video-item",r.href=(0,d._Y)(`/photo_videos/photoset/detail/${t}/${e.id}`),r.target="_blank",r.style.position="relative",r.style.display="inline-block",r.style.marginBottom="17px",r.style.marginRight="5px",r.style.cursor="pointer",(0,g._W)(r),(0,n.lT)()||(r.title=e.name),r.onclick=t=>{(0,c.WO)(e,"BioTab"),this.handlePictureClick(t,e.id,r.href)};const l=document.createElement("img");l.dataset.testid="photo-video-preview",(0,o.fZ)(l,"previewBorder"),l.src=e.coverUrl,l.width=x,l.height=T,l.style.borderWidth="1px",l.style.borderStyle="solid",l.style.display="block",l.style.borderRadius="3%",l.style.display="block",r.appendChild(l);const u=(0,a.HC)(e,s);if(!e.userCanAccess||i&&u.labelType!==a.jC){const t=document.createElement("div");t.style.width=`${x+1}px`,t.style.height=`${T+1}px`,t.style.borderRadius="3%",t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.backgroundColor="rgba(0, 0, 0, .55)",r.appendChild(t);const i=document.createElement("img");i.dataset.testid="lock-icon";const s=18;if(i.src=`${STATIC_URL}lock.svg`,i.width=s,i.height=s,i.style.marginLeft=-s/2+"px",i.style.marginTop=-s/2+"px",i.style.position="absolute",i.style.left="50%",i.style.top="40%",i.style.padding="4px",i.style.border="none",r.appendChild(i),""!==e.labelText){const t=document.createElement("span");t.dataset.testid="token-badge",(0,o.fZ)(t,"tokenText"),t.innerText=e.labelText,t.style.backgroundColor=e.labelColor,t.style.position="absolute",t.style.bottom="16px",t.style.right="0",t.style.margin="8px",t.style.fontSize="9px",t.style.padding="1px 3px",t.style.lineHeight="12px",t.style.borderRadius="2px",r.appendChild(t)}}else if(e.userCanAccess&&e.userHasPurchased){const e=document.createElement("span");e.dataset.testid="purchased-badge",(0,o.fZ)(e,"purchasedBadge"),e.style.backgroundColor="#6d85b5",e.style.color="#fff",e.style.position="absolute",e.style.top="80px",e.style.right="8px",e.style.padding="1px 3px",e.style.lineHeight="12px",e.style.borderRadius="2px",e.style.fontSize="9px",e.textContent=y.R.purchasedCAPS,r.appendChild(e)}if(e.isVideo){const e=document.createElement("img");e.src=`${STATIC_URL}video.svg`,e.height=18,e.style.position="absolute",e.style.top="8px",e.style.right="8px",r.appendChild(e)}if(e.isVideo&&!e.videoHasSound&&!e.pendingApproval){const e=document.createElement("img");e.src=`${STATIC_URL}no-audio.svg`,e.height=18,e.style.position="absolute",e.style.top="8px",e.style.right="32px";const t=(0,h.q)({content:`${y.R.audioRemovedText}`,hasHTML:!1,width:175,divotPosition:m.Wi.Bottom,divotLeftOrTop:"90px"});t.style.textAlign="center";const i=document.createElement("span");t.appendChild(i),r.appendChild(t),e.onmouseenter=()=>{t.style.display="block",t.style.left="12px",t.style.top="-50px"},e.onmouseleave=()=>{t.style.display="none"},r.appendChild(e)}const p=document.createElement("div");return p.dataset.testid="title",(0,o.fZ)(p,"link"),p.innerText=e.name,p.style.fontSize=`${S}px`,p.style.left="0px",p.style.maxWidth="145px",p.style.whiteSpace="nowrap",p.style.textOverflow="ellipsis",p.style.overflow="hidden",p.style.lineHeight="16px",p.style.textDecoration="none",r.appendChild(p),r},u=[];let p=0;for(const t of e){if(8===p)break;u.push(l(t)),p+=1}const f=e.length>8;let b;f&&(b=e[0].id);const w=this.generatePicsLinks(t,f,r,b);w.style.marginBottom="20px",u.push(w);const C=this.createSection("video"===r?y.R.vidsText:y.R.picsText,u);return(0,o.fZ)(C,"psContainer"),C}handlePictureClick(e,t,i){f.mf.fire(t),e.preventDefault()}generatePicsLinks(e,t){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;const s=document.createElement("div");if(t){const t=(0,v.L4)();t.href=(0,d._Y)(`/photo_videos/photoset/list_popup/${e}/`),(0,o.fZ)(t,"link"),t.innerText=y.R.showMoreText,t.style.fontSize="14px",t.style.cursor="pointer",(0,g._W)(t),t.onclick=e=>{f.mf.fire(i),e.preventDefault()},s.appendChild(t)}return s}createSection(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=e.toLowerCase().replace(/[ \/]/g,"-").replace(/[()\/]/g,"").replace(/--/g,"");return(0,b.tT)("tr",{style:{fontSize:`${S}px`,fontWeight:"normal",lineHeight:"15px",verticalAlign:"top",textAlign:"left"}},(0,b.tT)("td",{colorClass:"label",style:{paddingBottom:"9px",fontFamily:"UbuntuMedium, Arial, Helvetica, sans-serif",height:"16px"}},(0,b.tT)("span",{"data-testid":`bio-tab-${s}-label`},e,":")),(0,b.tT)("td",{className:"contentText bioContentText",style:{fontSize:`${S}px`,lineHeight:"16px",fontFamily:"UbuntuRegular, Arial, Helvetica, sans-serif"},ref:e=>{if("string"==typeof t)if(i){const i=(0,b.tT)("div",{"data-testid":`bio-tab-${s}-value`});e.appendChild(i),i.innerHTML=t,0!==i.children.length&&(i.children[0].style.display="unset")}else e.innerText=t;else t.forEach((t=>{e.appendChild(t)}));i||(e.dataset.testid=`bio-tab-${s}-value`)}}))}generateSectionWithUserHTML(e,t){return this.createSection((0,s.nx)(t),e,!0)}afterCustomSectionCreated(e){this.customSections.push(e),(0,c._W)(e,this.bioRootWrapper)}}const S=14,x=150,T=100},7809:(e,t,i)=>{"use strict";i.d(t,{i:()=>d});var s=i(2758),n=i(9447),o=i(3955),r=i(2690),a=i(4947),l=i(1372);const h="broadcast_terms";class d extends r.zf{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};super({easyExit:!1}),(0,o.ZM)(this.element,{position:"fixed",overflow:"hidden",height:"auto",maxWidth:"1000px",minWidth:"450px",width:"90%",top:"50%",transform:"translateY(-50%)",left:"0px",right:"0px",margin:"auto",padding:"20px",borderWidth:"2px",borderStyle:"solid",borderRadius:"20px",zIndex:1e4}),(0,n.fZ)(this.element,"broadcastTermsModal"),this.overlay.style.background="",e?((0,n.fZ)(this.overlay,"blackOverlay"),this.overlayClickStayOpen=!0):((0,n.fZ)(this.overlay,"transparentOverlay"),this.overlayClick.listen(i)),this.element.appendChild(this.createHeader()),this.element.appendChild(this.createBody()),this.element.appendChild(this.createAcceptButton(t))}static areTermsAccepted(){return"1"===(0,s.y1)(h)}createHeader(){return(0,l.tT)("div",{colorClass:"header"},(0,l.tT)("h3",{style:{textAlign:"center"}},a.R.broadcastTermsHeader))}createBody(){return this.body=(0,l.tT)("div",{style:{height:"200px",overflow:"auto",padding:"0 15px 0 10px",borderWidth:"1px",borderStyle:"solid",margin:"0 auto",textAlign:"left"},colorClass:"body"},(0,l.tT)("p",null,a.R.broadcastTerms1),(0,l.tT)("ol",null,(0,l.tT)("li",null,a.R.broadcastTerms2),(0,l.tT)("li",null,a.R.broadcastTerms3),(0,l.tT)("li",null,a.R.broadcastTerms4),(0,l.tT)("li",null,a.R.broadcastTerms5),(0,l.tT)("li",{dangerouslySetInnerHTML:{__html:a.R.broadcastTerms6}}),(0,l.tT)("li",null,a.R.broadcastTerms7),(0,l.tT)("li",null,a.R.broadcastTerms8),(0,l.tT)("li",null,a.R.broadcastTerms9)),(0,l.tT)("p",{dangerouslySetInnerHTML:{__html:a.R.broadcastTerms10}})),this.body}createAcceptButton(e){return(0,l.tT)("div",{style:{textAlign:"center",color:"#222"}},(0,l.tT)("a",{style:{width:"200px",height:"30px",lineHeight:"30px",fontWeight:"bold",margin:"10px 5px 0px 5px",borderWidth:"1px",borderStyle:"solid",display:"inline-block",textAlign:"center",cursor:"pointer"},"data-testid":"agree-broadcast-terms-button",colorClass:"acceptLink",ref:e=>{this.acceptLink=e},onClick:t=>{t.stopPropagation(),this.hide(),(0,s.aR)(h,"1",{days:7}),e()}},a.R.termsAgree))}}},78:(e,t,i)=>{"use strict";i.d(t,{p:()=>M,_:()=>R});var s=i(7623),n=i(1673),o=i(9447),r=i(213),a=i(5216),l=i(2709),h=i(8423),d=i(34),c=i(1452),u=i(2146),p=i(4947),m=i(2945);function g(e){let t=0;for(const i of e)t+=i;return t/e.length}function v(e){return Math.sqrt(function(e){const t=g(e),i=[];for(const s of e)i.push(Math.abs(s-t));return Math.sqrt(g(i))}(e))}var f,y,b=i(3049),w=i(4941);!function(e){e[e.obsSD=0]="obsSD",e[e.obsHD=1]="obsHD",e[e.obsHDPlus=2]="obsHDPlus",e[e.obs4k=3]="obs4k"}(f||(f={})),function(e){e[e.none=0]="none",e[e.bad=1]="bad",e[e.warning=2]="warning",e[e.good=3]="good"}(y||(y={}));const C={9:"H.263",7:"H.264",12:"H.265",8:"VPX"},S={11:"Speex",12:"Opus",2:"MP3",10:"AAC",1:"AC3",9:"Vorbis"},x={480:800,576:1200,720:3e3,1080:5e3,1440:8e3,2160:12e3},T={480:900,576:3e3,720:5e3,1080:7500,1440:11e3,2160:18e3},P=(e,t)=>null==e?t:e;class k{constructor(){this.started=!1,this.closed=!1,this.fpsData=[],this.MAX_FPS_LENGTH=40,this.bitrateData=[],this.MAX_BITRATE_LENGTH=100,this.lastUpdate=0,this.lastWidth=0,this.lastHeight=0,this.streamTime=0,this.infoInterval=0,this.streamDataUpdate=new h.c_("streamDataUpdate",{listenersWarningThreshold:1}),this.pollingStatusUpdate=new h.c_("pollingStatusUpdate",{listenersWarningThreshold:1}),this.startPollingEvent=new h.c_("streamWatcherStartPolling",{listenersWarningThreshold:1}),this.closeEvent=new h.c_("streamWatcherClose",{listenersWarningThreshold:1})}processData(e){const t=P(e.fps,0),i=P(e.bitrate,0),s=P(e.region,""),n=P(e.host,""),o=P(e.streamType,"obs");this.streamTime=P(e.secondsOnline,0),this.lastWidth=P(e.videoWidth,0),this.lastHeight=P(e.videoHeight,0),this.lastHeight>0&&(this.lastRatio=this.lastWidth/this.lastHeight);const r=P(e.videoCodecString,P(C[P(e.videoCodec,"")],"Unknown")),a=P(e.audioCodecString,P(S[P(e.audioCodec,"")],"Unknown"));this.transcodeCount=P(e.transcodeCount,void 0),this.fpsData.push(t),this.bitrateData.push(i),this.fpsData.length>this.MAX_FPS_LENGTH&&this.fpsData.shift(),this.bitrateData.length>this.MAX_BITRATE_LENGTH&&this.bitrateData.shift(),this.fpsSeries.append((new Date).getTime(),t),this.bitrateSeries.append((new Date).getTime(),i),this.streamDataUpdate.fire({host:n,region:s,streamType:o,fps:Math.round(t),bitrate:Math.round(i),streamTime:(0,w.I4)(this.streamTime),videoWidth:this.lastWidth,videoHeight:this.lastHeight,videoCodec:r,audioCodec:a}),this.lastUpdate=(new Date).getTime()}statusMessage(){const e=[],t=[],i=[],s=e=>{const t=document.createElement("span");return t.innerText=e,t};let n,o,r=0,a=!1,l=y.none,h=y.none;if(this.lastHeight>0){for(const e in x)x.hasOwnProperty(e)&&this.lastHeight>=Number(e)&&(n=x[e],o=T[e]);this.lastHeight<480&&this.streamTime<120&&this.streamTime>2?t.push(s(p.R.lowStreamResolution)):this.lastHeight<720&&this.streamTime>2&&i.push((e=>{const t=document.createElement("span");return t.innerHTML=e,t})(p.R.streamNotHD)),void 0!==this.lastRatio&&this.lastRatio<1.7&&this.streamTime<120&&this.streamTime>2&&(t.push(s(p.R.streamNotWidescreen)),r+=1)}void 0!==this.transcodeCount&&this.streamTime>10&&this.transcodeCount<3&&e.push(s(p.R.errorHandlingStream));let d=0,c=30,u=30;this.fpsData.length>0&&(d=v(this.fpsData.slice(-100)),c=g(this.fpsData.slice(-10)),u=g(this.fpsData.slice(-5)));let m=n;if(u>45&&c>45&&(a=!0,m=o),void 0!==m&&this.streamTime>5){const n=v(this.bitrateData.slice(-100)),o=g(this.bitrateData.slice(-10)),h=g(this.bitrateData.slice(-5));o>.01&&o<.95*m&&h<.95*m?o<.7*m&&h<.7*m?a?e.push(s(p.R.bitrateMuchLowerThanHigh(m))):e.push(s(p.R.bitrateMuchLower(m))):a?t.push(s(p.R.bitrateLowerThanHigh(m))):t.push(s(p.R.bitrateLower(m))):n>o/8&&this.streamTime>50&&this.bitrateData.length>20?(r+=1,t.push(s(p.R.unstableBitrate))):o>1.5*m&&i.push(s(p.R.veryGoodBitrate)),l=h<.7*m?y.bad:h<.95*m?y.warning:y.none}else l=y.none;u>.01&&c<21&&u<21&&this.streamTime>5?c<15&&u<15?e.push(s(p.R.frameRateMuchLower)):t.push(s(p.R.frameRateLower)):u>45&&c>45?this.streamTime<120&&this.streamTime>2&&i.push(s(p.R.frameRateHigh)):u>62&&c>62?e.push(s(p.R.frameRateTooHigh)):d>6&&this.streamTime>30&&this.fpsData.length>20?(r+=1,t.push(s(p.R.fpsVeryUnstable))):d>3&&this.streamTime>30&&this.fpsData.length>20&&(r+=1,t.push(s(p.R.fpsUnstable))),this.streamTime>5&&this.fpsData.length>20&&(h=u<15?y.bad:u>63||u>33&&u<45||u<21?y.warning:y.none),this.lastUpdate>0&&(new Date).getTime()-this.lastUpdate>1e4&&t.push(s(p.R.noQualityInformation));let b,w=y.none,C="",S=[];e.length>0?(C=p.R.alert,S=e.slice(0,2),w=y.bad):t.length>0?(C=p.R.warning,S=t.slice(0,2),w=y.warning):i.length>0||this.streamTime>10?(C=p.R.yourStreamIsGood,S=i.length>0?i.slice(0,2):[s(p.R.noIssues)],w=y.good):w=y.none;let P="",k="";const A=t.length-r;this.lastHeight>=2160&&A<1&&0===e.length?(b=f.obs4k,P="4K",k="4K"):this.lastHeight>=1080&&A<1&&0===e.length?(b=f.obsHDPlus,P="HD+",k="Full High Definition"):this.lastHeight>=720&&A<1&&0===e.length?(b=f.obsHD,P="HD",k="High Definition"):(b=f.obsSD,P="SD",k="Standard Definition"),this.pollingStatusUpdate.fire({feedbackHeader:C,feedbackMessages:S,feedbackType:w,resolutionTitle:k,resolutionType:b,resolutionText:P,bitrateFeedback:l,fpsFeedback:h})}startPolling(){if(this.startPollingEvent.fire(void 0),this.started)return;this.started=!0;const e={millisPerPixel:90,maxValueScale:1.3,grid:{fillStyle:"rgba(209, 209, 209, 0.69)",strokeStyle:"rgba(141, 142, 126, 0.82)",sharpLines:!0,borderVisible:!0,millisPerLine:6e3,verticalSections:2},labels:{fillStyle:"rgba(35, 34, 34, 0.79)",fontSize:10,precision:0},minValue:0,responsive:!0};i.e(369).then(i.t.bind(i,5369,23)).then((t=>{let{SmoothieChart:i,TimeSeries:s}=t;this.fpsChart=new i(e),this.fpsSeries=new s,this.fpsChart.addTimeSeries(this.fpsSeries,{lineWidth:1.2,strokeStyle:"#033E58"}),this.fpsChart.streamTo(document.getElementById("fps_chart"),2e3),this.bitrateChart=new i(e),this.bitrateSeries=new s,this.bitrateChart.addTimeSeries(this.bitrateSeries,{lineWidth:1.2,strokeStyle:"#033E58"}),this.bitrateChart.streamTo(document.getElementById("bitrate_chart"),2e3)})),this.infoInterval=window.setInterval((()=>{this.statusMessage()}),1500)}isStarted(){return this.started}start(){this.started||(this.closed=!1,this.startPolling(),clearInterval(this.bitrateReporting),this.bitrateReporting=window.setInterval((()=>{(0,b.mR)("obs",this.bitrateData[this.bitrateData.length-1])}),6e4))}close(){!this.closed&&this.started&&(this.closed=!0,this.started=!1,this.closeEvent.fire(void 0),this.fpsChart.stop(),this.bitrateChart.stop(),clearInterval(this.infoInterval),clearInterval(this.bitrateReporting))}reset(){this.isStarted()&&this.close(),this.started=!1,this.closed=!1,this.fpsData=[],this.bitrateData=[],this.lastUpdate=0,this.transcodeCount=0,this.lastWidth=0,this.lastHeight=0,this.lastRatio=void 0,this.streamTime=0,this.infoInterval=0,this.start()}}class A{constructor(e){this.originWSEndpoint=e,this.streamWatcher=new k,this.closed=!1,this.lastInfo=(new Date).getTime(),this.streamName="",this.roomStatusUpdate=new h.c_("originWatcherRoomStatusUpdate"),this.alternativeStreamEvent=new h.c_("originWatcherAlternativeStream")}close(){this.closed||(this.closed=!0,void 0!==this.websocket&&this.websocket.readyState<2&&this.websocket.close(),this.streamWatcher.close())}start(){if(void 0!==this.origin&&void 0!==this.auth&&void 0!==this.username){if(void 0!==this.websocket){if(this.websocket.readyState<2)return;try{this.websocket.close()}catch{}}this.closed=!1,this.websocket=new WebSocket(`wss://${this.origin}${this.originWSEndpoint}`),this.websocket.onopen=e=>{void 0!==this.websocket&&this.websocket.send(JSON.stringify({method:"connect",username:this.username,password:this.auth}))},this.websocket.onmessage=e=>{const t=e.data;let i;try{i=JSON.parse(t)}catch(e){}if(void 0!==i)switch(i.method){case"auth_valid":break;case"stream_info":case"origin_info":this.lastInfo=(new Date).getTime(),this.handleInfo(i);break;default:console.warn("Unhandled",i)}},this.websocket.onerror=e=>{},this.websocket.onclose=e=>{this.closed||window.setTimeout((()=>{this.start()}),100)}}}isConnected(){return!this.closed&&void 0!==this.websocket&&(new Date).getTime()-this.lastInfo<5e3}handleInfo(e){let t=P(e.status,"offline");const i=P(e.roomPassword,"");"public"===t&&i.length>0&&(t="password protected");const s=P(e.streamType,"obs"),n=Boolean((0,m.JO)(window.location.search).graph);if(this.roomStatusUpdate.fire(t),"obs"!==s&&!n){let e="Unknown";"webrtc"===s&&(e="WebRTC"),this.alternativeStreamEvent.fire(e)}void 0===e.streamName||"obs"!==s&&!n?(this.streamWatcher.close(),"remoteHost"in e&&void 0!==e.remoteHost&&"remoteStatus"in e&&void 0!==e.remoteStatus&&e.remoteHost!==this.origin&&""!==e.remoteStatus&&"offline"!==e.remoteStatus&&this.update(e.remoteHost,e.username,e.originPassword)):e.streamName!==this.streamName?(this.streamWatcher.reset(),this.streamName=e.streamName):this.streamWatcher.processData(e)}getStreamWatcher(){return this.streamWatcher}update(e,t,i){this.origin=e,this.username=t,this.auth=i,this.close(),window.setTimeout((()=>{this.start()}),10)}getOrigin(){return this.origin}}class M extends l.u{constructor(e,t){super(),this.originWSEndpoint=e,this.roomNameStaffView=t,this.roomStatus="offline",this.obsInfo=this.createLink("Show RTMP/OBS broadcast information"),this.backToWebRTC=this.createLink("Use In-Browser Broadcaster"),this.originWatcher=new A(this.originWSEndpoint),this.obsRoomStatusBlock=document.createElement("div"),this.obsRoomStatusContainer=document.createElement("div"),this.obsRoomStatus=document.createElement("span"),this.obsExitAway=document.createElement("div"),this.obsStreamStatsBlock=document.createElement("div"),this.obsStreamStatsOther=document.createElement("div"),this.obsAlternativeStreamType=document.createElement("p"),this.obsStreamRegion=document.createElement("div"),this.obsStreamGraphFPS=document.createElement("div"),this.obsStreamGraphBitrate=document.createElement("div"),this.obsStreamGraphFPSDisp=document.createElement("span"),this.obsStreamGraphBitrateDisp=document.createElement("span"),this.obsDetailsBoxTimeDisp=document.createElement("span"),this.obsDetailsBoxResDisp=document.createElement("span"),this.obsDetailsBoxCodecVideo=document.createElement("span"),this.obsDetailsBoxCodecAudio=document.createElement("span"),this.statsLoadingMessage=document.createElement("div"),this.resolutionFloatBox=document.createElement("div"),this.resolutionFloatBoxText=document.createElement("div"),this.obsStreamFeedbackBox=document.createElement("div"),this.obsFeedbackBoxHeader=document.createElement("h4"),this.obsFeedbackBoxMessages=document.createElement("div"),this.obsStreamRejected=document.createElement("div"),this.obsStreamRejectedReason=document.createElement("p"),this.obsControl=document.createElement("div"),this.obsStarted=new h.c_("obsStarted"),this.element.id="OBSOverlay",this.element.style.position="";const i=void 0!==t;this.createOBSVideo(),i||(this.hide(),this.createOtherStreamOptions()),this.originWatcher.alternativeStreamEvent.listen((e=>{this.obsStreamStatsOther.style.display="",this.updateAlternativeStreamType(e),this.obsStreamStatsBlock.style.display="none",this.statsLoadingMessage.style.display="none"})),this.originWatcher.getStreamWatcher().closeEvent.listen((()=>{this.obsStreamStatsBlock.style.display="none",this.statsLoadingMessage.style.display="none",this.styleGraph(this.obsStreamGraphFPS,y.none),this.styleGraph(this.obsStreamGraphBitrate,y.none),this.styleFeedbackBox(y.none),this.obsStreamGraphFPSDisp.innerText="",this.obsStreamGraphBitrateDisp.innerText="",this.resolutionFloatBox.title="",this.obsDetailsBoxCodecVideo.innerText="",this.obsDetailsBoxCodecAudio.innerText="",this.obsDetailsBoxTimeDisp.innerText="",this.obsDetailsBoxResDisp.innerText=""})),this.originWatcher.getStreamWatcher().startPollingEvent.listen((()=>{this.statsLoadingMessage.style.display="none",this.styleFeedbackBox(y.none),this.obsStreamStatsBlock.style.display=""})),this.originWatcher.getStreamWatcher().pollingStatusUpdate.listen((e=>{this.resolutionFloatBox.title=p.R.obsStreamClass(e.resolutionTitle),this.resolutionFloatBoxText.innerText=e.resolutionText,this.styleResolutionFloatBox(e.resolutionType),this.styleFeedbackBox(e.feedbackType),this.styleGraph(this.obsStreamGraphFPS,e.fpsFeedback),this.styleGraph(this.obsStreamGraphBitrate,e.bitrateFeedback),this.obsFeedbackBoxHeader.innerText=e.feedbackHeader,this.obsFeedbackBoxMessages.replaceChildren();let t=!0;for(const i of e.feedbackMessages)t||this.obsFeedbackBoxMessages.appendChild(document.createElement("br")),t=!1,this.obsFeedbackBoxMessages.appendChild(i)})),this.originWatcher.getStreamWatcher().streamDataUpdate.listen((e=>{this.obsStreamStatsBlock.style.display="",this.obsStreamRegion.innerText=p.R.obsConnectionDescription(e.host,e.region,e.streamType),this.obsStreamGraphFPSDisp.innerText=p.R.obsFPS(Math.round(e.fps)),this.obsStreamGraphBitrateDisp.innerText=p.R.obsBitrate(Math.round(e.bitrate)),this.obsDetailsBoxTimeDisp.innerText=`${e.streamTime}`,this.obsDetailsBoxResDisp.innerText=`${e.videoWidth}x${e.videoHeight}`,this.obsDetailsBoxCodecVideo.innerText=`${e.videoCodec}`,this.obsDetailsBoxCodecAudio.innerText=`${e.audioCodec}`})),this.originWatcher.roomStatusUpdate.listen((e=>{this.updateRoomStatus(e)}))}monitorRoomStatus(){void 0!==this.monitorTimeout&&clearTimeout(this.monitorTimeout);const e=`api/get_my_broadcast_status/${void 0!==this.roomNameStaffView?`${this.roomNameStaffView}/`:""}${"offline"===this.roomStatus?"?auth=1":""}`;(0,a.KF)(e,{}).then((e=>{const t=JSON.parse(e.responseText);this.originWatcher.isConnected()||this.updateRoomStatus(t.status);const i=t.errors;if(null!=i&&"offline"===t.status){this.obsStreamRejected.style.display="";let e="Your stream was recently rejected for the following reasons:<br />";void 0!==i.reasons&&i.reasons.forEach((t=>{switch(t){case"ratio":e=`${e}Having an incorrect ratio, please either broadcast at 4:3 or 16:9.<br />`;break;case"height":e=`${e}Having an invalid height of ${P(i.height,"Unknown")} pixels, the stream height must be between 240 and 2160 pixels.<br />`;break;case"codec_video":e=`${e}Having an invalid video codec of ${P(C[P(i.video_codec,"")],"Unknown")}, the stream must use the H.264 video codec baseline, main or high 4:2:0.<br />`;break;case"codec_audio":e=`${e}Having an invalid video codec of ${P(S[P(i.audio_codec,"")],"Unknown")} the stream must use the AAC audio codec.<br />`;break;case"high_res_fps":e=`${e}Having a high frame rate and resolution. Resolutions above 1080p are limited to 30fps.<br />`;break;case"video_fps":e=`${e}Having an invalid video fps of ${Math.round(P(i.video_fps,0))} the stream must be at least 24 fps.<br />`;break;default:e=`${e}An unknown reason.<br />`}})),this.obsStreamRejectedReason.innerHTML=e}const s=t.origin,n=t.username,o=t.originPassword,r=t.status;void 0!==s&&void 0!==n&&void 0!==o&&void 0!==r&&(!this.originWatcher.isConnected()||this.originWatcher.getOrigin()!==s&&"offline"!==r)&&this.originWatcher.update(s,n,o)})).catch(c.yZ),this.monitorTimeout=window.setTimeout((()=>{this.monitorRoomStatus()}),1e4)}createOBSVideo(){const e=document.createElement("div"),t=document.createElement("span"),i=document.createElement("div"),s=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div"),a=this.createDetailsBox(),l=this.createDetailsBox(),h=this.createDetailsBox(),c=document.createElement("div");e.appendChild(i),i.appendChild(this.obsRoomStatusBlock),this.obsRoomStatusContainer.dataset.testid="obs-room-status",this.obsRoomStatusContainer.appendChild(t),this.obsRoomStatusContainer.appendChild(this.obsRoomStatus),this.obsRoomStatusBlock.appendChild(this.obsRoomStatusContainer),this.obsRoomStatusBlock.appendChild(this.obsExitAway),i.appendChild(s),s.appendChild(this.obsStreamRejected),s.appendChild(this.statsLoadingMessage),s.appendChild(this.obsStreamStatsBlock),this.obsStreamStatsBlock.appendChild(n),n.appendChild(this.obsStreamFeedbackBox),this.obsStreamStatsBlock.appendChild(r),r.appendChild(a),this.resolutionFloatBox.appendChild(this.resolutionFloatBoxText),r.appendChild(l),r.appendChild(h),this.obsStreamStatsBlock.appendChild(c),c.appendChild(this.obsStreamGraphFPS),c.appendChild(this.obsStreamGraphBitrate),this.obsStreamStatsBlock.appendChild(this.obsStreamRegion),s.appendChild(this.obsStreamStatsOther),this.element.appendChild(e),r.style.lineHeight="18px",(0,o.fZ)(t,"roomStatusLabel"),t.innerText=p.R.yourStreamIsCurrently,this.obsRoomStatusContainer.style.textAlign="center",this.obsRoomStatusContainer.style.display="none",this.obsRoomStatusContainer.style.fontSize="1.1em",this.obsRoomStatusContainer.style.paddingTop="20px",(0,o.fZ)(this.obsRoomStatus,"roomStatus"),this.obsRoomStatus.style.fontWeight="bolder",i.style.font="1.2em/1.4em 'UbuntuRegular', Arial, Helvetica, sans-serif",i.style.height="460px",this.obsStreamStatsBlock.style.display="none",this.obsRoomStatusBlock.style.height="145px",this.obsRoomStatusBlock.style.lineHeight="1em",this.obsRoomStatusBlock.style.textAlign="center",(0,o.fZ)(this.obsStreamRegion,"streamRegion"),this.obsStreamRegion.style.textAlign="left",this.obsStreamRegion.style.fontSize="9px",this.obsStreamRegion.style.paddingLeft="5px",s.style.fontWeight="normal",r.style.width="100%",r.style.padding="8px",r.style.height="55px",r.style.boxSizing="border-box",r.style.textAlign="center",c.style.width="100%",c.style.height="110px",c.style.padding="3px",c.style.boxSizing="border-box",c.style.marginTop="5px",this.obsStreamGraphFPS.style.cssFloat="left",this.obsStreamGraphFPS.style.width="240px",this.obsStreamGraphFPS.style.textAlign="center",(0,u.Ve)(this.obsStreamGraphFPS,"background 500ms ease-in-out"),this.obsStreamGraphBitrate.style.cssFloat="right",this.obsStreamGraphBitrate.style.width="240px",this.obsStreamGraphBitrate.style.textAlign="center",(0,u.Ve)(this.obsStreamGraphBitrate,"background 500ms ease-in-out"),this.obsExitAway.style.fontSize="0.9em",this.obsExitAway.style.lineHeight="1.4em",this.obsExitAway.style.maxWidth="90%",this.obsExitAway.style.margin="10px auto 0",this.obsExitAway.style.display="none",n.style.width="100%",n.style.padding="5px",n.style.boxSizing="border-box",this.obsStreamFeedbackBox.style.width="85%",this.obsStreamFeedbackBox.style.padding="5px",this.obsStreamFeedbackBox.style.textAlign="center",this.obsStreamFeedbackBox.style.fontSize="12px",this.obsStreamFeedbackBox.style.margin="4px auto 0",(0,o.fZ)(this.obsStreamRejected,"streamRejected"),this.obsStreamRejected.style.display="none",this.obsStreamRejected.style.width="85%",this.obsStreamRejected.style.padding="5px",this.obsStreamRejected.style.textAlign="center",this.obsStreamRejected.style.color="#ffffff",this.obsStreamRejected.style.fontSize="14px",this.obsStreamRejected.style.margin="15px auto 0",this.obsStreamRejected.style.borderWidth="1px",this.obsStreamRejected.style.borderStyle="solid",this.resolutionFloatBox.style.display="none",this.resolutionFloatBox.style.fontSize="16px",this.resolutionFloatBox.style.width="33px",this.resolutionFloatBox.style.height="23px",this.resolutionFloatBox.style.borderRadius="3px",this.resolutionFloatBox.style.position="absolute",this.resolutionFloatBox.style.right="2px",this.resolutionFloatBox.style.top="10px",this.resolutionFloatBox.style.fontWeight="bold",this.resolutionFloatBox.style.textAlign="center",this.resolutionFloatBoxText.style.padding="10% 0";const m=document.createElement("p");(0,o.fZ)(m,"obsAwayMessage"),m.innerText=p.R.obsAwayMessage,m.style.margin="3px";const g=this.createLink("Exit Away Mode");(0,o.fZ)(g,"exitAwayLink"),g.style.fontSize="1.6em",g.onclick=e=>{e.preventDefault(),(0,d.vZ)()},this.obsExitAway.appendChild(m),this.obsExitAway.appendChild(g);const v=document.createElement("h4");v.innerText=p.R.streamRejected,this.obsStreamRejected.appendChild(v),this.obsStreamRejected.appendChild(this.obsStreamRejectedReason);const f=document.createElement("p");(0,o.fZ)(f,"waitingMessage"),f.innerText=p.R.waitingforStreamStats,f.style.textAlign="center";const y=document.createElement("img");y.src=`${STATIC_URL}ellipsis.svg`,y.style.height="110px",y.style.width="auto",y.style.opacity="0.5",y.style.margin="0 auto",y.style.display="block",this.statsLoadingMessage.appendChild(f),this.statsLoadingMessage.appendChild(y),this.obsFeedbackBoxHeader.innerText=p.R.streamStatusUnknown,this.obsFeedbackBoxHeader.style.color="inherit",this.obsFeedbackBoxHeader.style.fontWeight="bold",this.obsFeedbackBoxHeader.style.fontSize="15px",this.obsFeedbackBoxHeader.style.margin="3px",this.obsStreamFeedbackBox.appendChild(this.obsFeedbackBoxHeader),this.obsStreamFeedbackBox.appendChild(this.obsFeedbackBoxMessages),this.obsStreamFeedbackBox.style.display="none",(0,o.fZ)(a,"resolutionText");const b=document.createElement("span");b.innerText=p.R.resolutionLabel,a.appendChild(b),a.appendChild(document.createElement("br")),this.obsDetailsBoxResDisp=document.createElement("span"),this.obsDetailsBoxResDisp.style.fontSize="0.8em",a.appendChild(this.obsDetailsBoxResDisp),a.appendChild(this.resolutionFloatBox);const w=document.createElement("span");w.innerText=p.R.streamTime,l.appendChild(w),l.appendChild(document.createElement("br")),this.obsDetailsBoxTimeDisp=document.createElement("span"),this.obsDetailsBoxTimeDisp.style.fontSize="0.8em",l.appendChild(this.obsDetailsBoxTimeDisp),(0,o.fZ)(h,"codecText");const C=document.createElement("span");C.innerText=p.R.codec,h.appendChild(C),h.appendChild(document.createElement("br")),this.obsDetailsBoxCodecVideo=document.createElement("span"),this.obsDetailsBoxCodecVideo.style.fontSize="10px",this.obsDetailsBoxCodecVideo.style.lineHeight="1",this.obsDetailsBoxCodecVideo.style.display="block",this.obsDetailsBoxCodecVideo.style.marginTop="2px",this.obsDetailsBoxCodecAudio=document.createElement("span"),this.obsDetailsBoxCodecAudio.style.fontSize="10px",this.obsDetailsBoxCodecAudio.style.lineHeight="1",this.obsDetailsBoxCodecAudio.style.display="block",this.obsDetailsBoxCodecAudio.style.marginTop="2px",h.appendChild(this.obsDetailsBoxCodecVideo),h.appendChild(this.obsDetailsBoxCodecAudio);const S=document.createElement("span");S.innerText=p.R.frameRate,this.obsStreamGraphFPSDisp.style.fontWeight="bold";const x=document.createElement("canvas");x.style.width="235px",x.style.height="80px",x.id="fps_chart",this.obsStreamGraphFPS.appendChild(S),this.obsStreamGraphFPS.appendChild(this.obsStreamGraphFPSDisp),this.obsStreamGraphFPS.appendChild(x);const T=document.createElement("span");T.innerText=p.R.bitrate,this.obsStreamGraphBitrateDisp.style.fontWeight="bold";const P=document.createElement("canvas");P.style.width="235px",P.style.height="80px",P.id="bitrate_chart",this.obsStreamGraphBitrate.appendChild(T),this.obsStreamGraphBitrate.appendChild(this.obsStreamGraphBitrateDisp),this.obsStreamGraphBitrate.appendChild(P),this.obsStreamStatsOther.appendChild(this.obsAlternativeStreamType),this.obsStreamStatsOther.style.display="none",this.obsAlternativeStreamType.style.textAlign="center",this.obsAlternativeStreamType.style.height="260px",this.obsAlternativeStreamType.style.marginTop="40px",this.updateAlternativeStreamType("Unknown")}updateAlternativeStreamType(e){this.obsAlternativeStreamType.innerText=p.R.obsAlternativeStreamType(e)}createDetailsBox(){const e=document.createElement("div");return e.style.width="33%",e.style.cssFloat="left",e.style.height="30px",e.style.lineHeight="18px",e.style.position="relative",e}styleResolutionFloatBox(e){switch(this.resolutionFloatBox.style.display="",e){case f.obsSD:this.resolutionFloatBox.style.backgroundColor="#e67e22",this.resolutionFloatBox.style.color="#fff";break;case f.obsHD:this.resolutionFloatBox.style.backgroundColor="#27ae60",this.resolutionFloatBox.style.color="#fff";break;case f.obsHDPlus:this.resolutionFloatBox.style.backgroundColor="#16a085",this.resolutionFloatBox.style.color="#fff";break;case f.obs4k:this.resolutionFloatBox.style.backgroundColor="#2980b9",this.resolutionFloatBox.style.color="#f1c40f"}}styleFeedbackBox(e){switch(this.obsStreamFeedbackBox.className="",this.obsStreamFeedbackBox.style.display="",this.obsStreamFeedbackBox.style.borderWidth="1px",this.obsStreamFeedbackBox.style.borderStyle="solid",e){case y.none:this.obsStreamFeedbackBox.style.display="none";break;case y.good:(0,o.fZ)(this.obsStreamFeedbackBox,"goodFeedback");break;case y.warning:(0,o.fZ)(this.obsStreamFeedbackBox,"warningFeedback");break;case y.bad:(0,o.fZ)(this.obsStreamFeedbackBox,"badFeedback")}}styleGraph(e,t){switch(t){case y.none:e.style.backgroundColor="";break;case y.good:e.style.backgroundColor="rgba(46, 204, 113, 0.49)";break;case y.warning:e.style.backgroundColor="rgba(230, 126, 34, 0.61)";break;case y.bad:e.style.backgroundColor="rgba(231, 76, 60, 0.58)"}}updateRoomStatus(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";-1!==["offline","public","private","group","away","hidden","password protected"].indexOf(e)?("offline"!==e?(this.obsControl.style.marginTop="0",this.obsStreamRejected.style.display="none",this.backToWebRTC.style.display="none","offline"===this.roomStatus&&(n.I1.fire(!0),this.obsStarted.fire(void 0))):(this.obsControl.style.marginTop="-12px",(0,s.YU)()&&!(0,s.BS)()&&(this.backToWebRTC.style.display=""),"offline"!==this.roomStatus&&(n.I1.fire(!1),clearTimeout(this.monitorTimeout),this.monitorTimeout=window.setTimeout((()=>{this.monitorRoomStatus()}),2e3))),this.roomStatus=e,this.obsRoomStatus.innerText=e,this.styleOBSRoomStatus(e)):this.roomStatus="unknown",this.obsExitAway.style.display="away"===e?"":"none"}styleOBSRoomStatus(e){switch(this.obsRoomStatusContainer.style.display="",this.obsStreamStatsOther.style.display="none",this.obsRoomStatusBlock.className="",e){case"offline":(0,o.fZ)(this.obsRoomStatusBlock,"offlineBlock");break;case"public":(0,o.fZ)(this.obsRoomStatusBlock,"publicBlock");break;case"private":(0,o.fZ)(this.obsRoomStatusBlock,"privateBlock");break;case"group":(0,o.fZ)(this.obsRoomStatusBlock,"groupBlock");break;case"away":(0,o.fZ)(this.obsRoomStatusBlock,"awayBlock");break;case"hidden":(0,o.fZ)(this.obsRoomStatusBlock,"hiddenBlock");break;case"password protected":(0,o.fZ)(this.obsRoomStatusBlock,"passwordProtectedBlock")}}createOtherStreamOptions(){this.element.appendChild(this.obsControl),this.obsControl.appendChild(this.backToWebRTC),this.obsControl.appendChild(this.obsInfo),this.obsControl.style.paddingTop="7px",this.obsControl.style.width="100%",this.obsControl.style.height="8%",this.obsControl.style.marginTop="-12px",this.obsControl.style.textAlign="center",this.backToWebRTC.style.paddingLeft="5px",this.obsInfo.style.display="block",this.backToWebRTC.onclick=()=>{this.webBroadcaster()}}webBroadcaster(){"private"===this.roomStatus||"group"===this.roomStatus?(0,r.mf)(`Warning! This will end your ${this.roomStatus} show.  Are you sure?`,(()=>{""===window.location.search?window.location.reload():window.location.search=""})):""===window.location.search?window.location.reload():window.location.search=""}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}createLink(e){const t=document.createElement("a");return(0,o.fZ)(t,o.aG.hrefColor),t.innerText=e,t.style.padding="0 10px",t.style.fontWeight="bold",t.style.font="1.1em/1.2em 'UbuntuRegular', Arial, Helvetica, sans-serif",t.style.cursor="pointer",t}getOBSInfoLink(){return this.obsInfo}isOffline(){return"offline"===this.roomStatus}}const R=new h.c_("showOBSOverlay")},4354:(e,t,i)=>{"use strict";i.d(t,{y:()=>a});var s=i(5216),n=i(2709),o=i(4947),r=i(2945);class a extends n.u{constructor(){super(),this.loadingMsg=document.createElement("div"),this.errorMsg=document.createElement("div"),this.showing=!1,this.showingError=!1,this.params={},this.pathname="",this.element.style.position="static",this.element.style.minHeight="325px",this.element.style.margin="14px",this.element.style.boxSizing="border-box",this.element.style.width="",this.element.style.height="",this.element.style.paddingLeft="8px",this.loadingMsg.innerText=`${o.R.loadingText}…`,this.loadingMsg.style.fontSize="1.2em",this.errorMsg.innerText="An error occurred trying to load this tab",this.errorMsg.style.fontSize="1.2em"}setResourceUrl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.pathname=e,this.params=t}clearContent(){this.removeAllDOMChildren()}load(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.showingError=!1,""===this.pathname)return this.clearContent(),void this.createContent({});e&&(this.clearContent(),this.element.appendChild(this.loadingMsg));const i=(0,r.Go)(this.params);this.fetchData(`${this.pathname}?${i}`).then((i=>{let s;try{s=this.parseData(i.responseText)}catch(e){return this.showErrorMessage(),void error("Error parsing response from resource",{path:this.pathname,reason:e.toString()})}e&&this.loadingMsg.parentElement===this.element&&this.element.removeChild(this.loadingMsg),this.clearContent(),this.createContent(s),void 0!==t&&t()})).catch((e=>{error("Fetch data error",{pathname:this.pathname,reason:e.toString()}),this.showErrorMessage()}))}fetchData(e){return(0,s.Aw)(e)}showErrorMessage(){this.clearContent(),this.showingError=!0,this.element.appendChild(this.errorMsg)}showLoadingMessage(){this.clearContent(),this.element.appendChild(this.loadingMsg)}show(e,t){this.showing=!0,this.element.style.display="",this.load(!0,t)}hide(){this.showing=!1,this.element.style.display="none"}checkBeforeSwitch(e){e()}}},1650:(e,t,i)=>{"use strict";i.d(t,{zc:()=>P,li:()=>k,J9:()=>T});var s=i(9447),n=i(7872),o=i(8746),r=i(6784),a=i(213),l=i(5216),h=i(5581),d=i(1918),c=i(3955),u=i(9268),p=i(4947),m=i(2945),g=i(5389),v=i(9523),f=i(816),y=i(6861),b=i(7882);class w extends o.O{constructor(e,t,i,s,n){super(e,t,{...i,styles:{field:new C,input:new C,select:new S,multipleSelect:new x}}),this.roomName=s,this.canUpload=n,this.element.style.marginLeft="50px";const o=this.getField("gender"),r=this.getField("subgender"),a=e=>{if(void 0!==r){const t=r.getWidget();e.value===b.YT.OldTrans||e.value===b.YT.Trans?t.style.display="inline":(t.style.display="none",t.value="")}};if(this.placeSubgenderField(),void 0!==o){const e=o.getWidget();a(e),o.setOnChange((()=>{e.value===b.YT.Couple?o.updateLabelText(p.R.sexTextCouple):o.updateLabelText(p.R.sexText),a(e)}))}this.addField(new f.ib({name:"pics_and_videos",labelText:p.R.picsAndVideosText,customElement:this.createPicsAndVideos()})),this.setSubmitText(p.R.updateBio),this.getSubmitButton().dataset.testid="update-bio-button",this.setTestIds()}setTestIds(){var e;const t={real_name:"bio-tab-real-name",gender:"bio-tab-gender",subgender:"bio-tab-subgender",location:"bio-tab-location",spoken_languages:"bio-tab-spoken-languages",body_type:"bio-tab-body-type",smoke_drink:"bio-tab-smoke-drink",body_decorations:"bio-tab-body-decorations",about_me:"bio-tab-about-me",wish_list:"bio-tab-wish-list"},i=this.getField("interested_in").getField().getElementsByClassName("checkboxFieldLabel");for(const e in t){const i=this.getField(e);void 0!==i&&(i.getWidget().dataset.testid=t[e])}for(const e of i){var s,n;e.children[0].dataset.testid=`bio-tab-interested-in-${null===(s=e.lastChild)||void 0===s||null===(s=s.nodeValue)||void 0===s?void 0:s.toLowerCase()}-container`,e.children[0].children[0].dataset.testid=`bio-tab-interested-in-${null===(n=e.lastChild)||void 0===n||null===(n=n.nodeValue)||void 0===n?void 0:n.toLowerCase()}`}null===(e=this.getField("spoken_languages_strict"))||void 0===e||e.getWidgetContainer().querySelectorAll(".checkboxFieldLabel").forEach((e=>{const t=e.children[0],i=t.children[0];t.dataset.testid=`bio-tab-spoken-languages-${i.value}-container`}))}placeSubgenderField(){const e=this.getField("gender"),t=this.getField("subgender");if(void 0!==e&&void 0!==t){const i=e.getField().querySelector("td"),s=t.getField().querySelector("td");null!==i&&null!==s&&s.childNodes.forEach((e=>i.appendChild(e)))}}createPicsAndVideos(){const e=document.createElement("div");e.style.paddingTop="9px";const t=document.createElement("a"),i=document.createElement("a"),s=document.createElement("a");if(t.innerText=p.R.uploadNewPics,t.href=(0,l._Y)("/photo_videos/photoset/create/"),t.onclick=e=>{e.preventDefault(),(0,g.gr)(t.href,"_blank",g.rR)},t.dataset.testid="upload-new-pics",i.innerText=p.R.uploadNewVideos,i.href=(0,l._Y)("/photo_videos/photoset/create/video/"),i.target="_blank",i.onclick=e=>{e.preventDefault(),(0,g.gr)(i.href,"_blank",g.rR)},i.dataset.testid="upload-new-videos",s.innerText=p.R.managePhotoSet,s.href=(0,l._Y)(`/photo_videos/photoset/list_popup/${this.roomName}/`),s.onclick=e=>{e.preventDefault(),(0,g.gr)(s.href,"_blank",g.rR)},s.dataset.testid="manage-photo-sets",this.canUpload)e.appendChild(t),e.appendChild(this.createSeparator()),e.appendChild(i);else{const t=document.createElement("span");t.style.fontSize="14px",t.style.color="black",t.innerHTML=p.R.mustBeAgeVerifiedToUploadContent(),e.appendChild(t)}return e.appendChild(this.createSeparator()),e.appendChild(s),e}createSeparator(){const e=document.createElement("span");return(0,s.fZ)(e,"separator"),e.style.fontSize="12px",e.innerText=" | ",e}}class C extends y.Dr{styleField(e){super.styleField(e),(0,s.SA)(e,"field"),(0,s.fZ)(e,"fieldInput")}}class S extends C{styleField(e){super.styleField(e),e.style.width=""}}class x extends C{styleField(e){(0,s.fZ)(e,"fieldInput")}}const T="RefreshBroadcastBioTabSocialMedia";var P;!function(e){e[e.VIEW_BIO=0]="VIEW_BIO",e[e.EDIT_BIO=1]="EDIT_BIO"}(P||(P={}));class k extends d.x{constructor(e,t,i){super(),this.isAgeVerified=t,this.canUpload=i,this.state=P.VIEW_BIO,this.editQueryChecked=!1,window[T]=()=>{this.load(!1)},this.element.id="tabs_content_container",(0,r.wu)("beforeunload",window,(e=>{var t;if(!0===(null===(t=this.editBroadcastForm)||void 0===t?void 0:t.formHasChanged()))return e.preventDefault(),p.R.warnOnClosingDirty}))}checkBeforeSwitch(e){var t;!0===(null===(t=this.editBroadcastForm)||void 0===t?void 0:t.formHasChanged())?(0,a.mf)(p.R.warnOnClosingDirty,(()=>{this.setState(P.VIEW_BIO),e()})):(this.setState(P.VIEW_BIO),e())}load(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;super.load(e,(()=>{void 0!==t&&t(),this.editQueryChecked||(this.editQueryChecked=!0,"bio"===(0,m.JO)(window.location.search).edit&&this.setState(P.EDIT_BIO))}))}show(){this.element.style.display="",this.element.style.margin="0 0 14px",this.showingError&&this.load(),this.repositionChildren()}hide(){this.element.style.display="none"}parseData(e){return this.state===P.VIEW_BIO?(0,h.Fk)(e,this.room):o.Z.parseData(e)}createContent(e){this.state===P.VIEW_BIO?this.createBioContents(e):this.state===P.EDIT_BIO&&this.createEditBio(e)}createEditBio(e){this.createPreHeaderContent(),this.editBroadcastForm=new w(e,"api/ts/accounts/editbio/",{onSubmitSuccess:e=>{if(v.ek.fire({gender:String(e.get("gender")),subgender:String(e.get("subgender"))}),null!==e.get("spoken_languages_strict")){const e=document.querySelector("a#edit-spoken-language + .dismiss_notice");null!==e&&(0,n.zD)(e)}this.setState(P.VIEW_BIO)}},this.room,this.canUpload),this.element.appendChild(this.editBroadcastForm.element),this.editBroadcastForm.focusFirstField()}createSeparator(){const e=document.createElement("span");return(0,s.fZ)(e,"separator"),e.style.fontSize="14px",e.innerText=" | ",e}generateSocialMediaSection(e,t){const i=super.generateSocialMediaSection(e,t);return this.isAgeVerified||i.querySelectorAll(".socialMediaUpload").forEach((e=>{e.style.opacity="0.6"})),i}generateSocialMediaLinks(e,t){const i=super.generateSocialMediaLinks(e,t);if(t&&i.appendChild(this.createSeparator()),this.isAgeVerified){const e=document.createElement("a");(0,s.fZ)(e,s.aG.hrefColor),e.href=(0,l._Y)("/socials/social_media/create/"),e.onclick=t=>{t.preventDefault(),(0,g.gr)(e.href,"_blank",g.rR)},e.innerText=p.R.addNewSocialMedia,e.style.fontSize="14px",e.dataset.testid="add-more",i.appendChild(e)}else{const e=document.createElement("span");e.style.fontSize="14px",e.innerHTML=p.R.mustBeAgeVerifiedToAddSocialMedia(),i.appendChild(e)}return i}generatePicsLinks(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"photo";const n=document.createElement("div");if(t){const t=(new u.QC).anchor,i=`/photo_videos/photoset/list_popup/${e}/`;(0,s.fZ)(t,s.aG.hrefColor),t.href=(0,l._Y)(i),t.innerText=p.R.showMoreText,t.style.fontSize="14px",t.style.cursor="pointer",(0,c._W)(t),t.onclick=e=>{e.preventDefault(),(0,g.gr)(t.href,"_blank",g.rR)},n.appendChild(t),n.appendChild(this.createSeparator())}const o=(e,t)=>{const n=document.createElement("a");return(0,s.fZ)(n,s.aG.hrefColor),n.href=(0,l._Y)(t),n.onclick=e=>{e.preventDefault(),(0,g.gr)(n.href,"_blank",g.rR)},n.innerText=e,n.style.fontSize="14px",n.dataset.testid=`upload-new-${i}`,n};if(this.canUpload)"photo"===i?n.appendChild(o(p.R.uploadNewPics,"/photo_videos/photoset/create/")):n.appendChild(o(p.R.uploadNewVideos,"/photo_videos/photoset/create/video/"));else{const e=document.createElement("span");e.style.fontSize="14px",e.innerHTML=p.R.mustBeAgeVerifiedToUploadContent(),n.appendChild(e)}return n}handlePictureClick(e,t,i){e.preventDefault(),(0,g.gr)(i,"_blank",g.rR)}createFollowersSection(e){const t=`<a href="${(0,l._Y)("/accounts/followers/")}" target="_blank">${isNaN(e)?"0":e.toString()}</a>`;return this.createSection(p.R.followersText,t,!0)}shouldShowSocialMediaSection(e){return!0}shouldShowPicsSection(e){return!0}createBioContents(e){this.createPreHeaderContent(),super.createBioContents(e,this.canUpload)}createPreHeaderContent(){if(this.state===P.VIEW_BIO){const e=document.createElement("a");this.element.appendChild(e),e.style.cursor="pointer",e.style.display="inline-block",e.style.margin="14px 14px 0",e.innerText=p.R.editYourBio,e.className="editbio",e.href="#",e.onclick=e=>{this.setState(P.EDIT_BIO)}}else if(this.state===P.EDIT_BIO){const e=document.createElement("a");this.element.appendChild(e),e.style.cursor="pointer",e.style.display="inline-block",e.style.margin="14px 14px 0",e.innerText=p.R.cancelText,e.href="#",e.onclick=e=>{this.setState(P.VIEW_BIO)}}}setState(e,t){if(e===this.state)return null==t?void 0:t.call(void 0);e===P.VIEW_BIO?(this.state=P.VIEW_BIO,this.editBroadcastForm=void 0,this.setResourceUrl(`api/biocontext/${this.room}/`),this.load(!1,t)):e===P.EDIT_BIO&&(this.state=P.EDIT_BIO,this.setResourceUrl("api/ts/accounts/editbio/"),this.load(!1,t))}fetchData(e){return this.state===P.VIEW_BIO||this.state===P.EDIT_BIO?(0,l.Aw)(e):super.fetchData(e)}}},2028:(e,t,i)=>{"use strict";i.d(t,{Nn:()=>c,W_:()=>a,s9:()=>d});var s=i(7623),n=i(7407),o=i(4947);const r=[[640,360],[960,540],[1280,720]];function a(e,t){return void 0===t&&(t=200),e.forEach((e=>{e.stop()})),new Promise((e=>{window.setTimeout((()=>{e()}),t)}))}function l(e){return"Invalid constraint"===e.message||"OverconstrainedError"===e.name||"NotReadableError"===e.name}function h(e,t,i){if((0,s.OF)()&&(0,s.nr)()&&960===t&&540===i)return;const n=t/i;return{id:`${t}x${i}`,camId:e,label:`${t} x ${i}`,width:t,height:i,ratio:n,isWidescreen:n>1.4,isHD:i>=720}}function d(e,t){return new Promise(((i,s)=>{let d="DevicePermsOnLoadGranted",c="DevicePermsOnLoadDenied",u="PermanentDevicePermsOnLoadDenied";const p=Date.now();window.setTimeout((()=>{d="DevicePermsRequestGranted",c="DevicePermsRequestDenied",u="PermanentDevicePermsRequestDenied"}),1e3),navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((c=>{a(c.getTracks(),t).then((()=>{navigator.mediaDevices.enumerateDevices().then((t=>{const c=Promise.all(t.map((t=>{if("videoinput"===t.kind){if(void 0!==e&&e)return(i=t.deviceId,new Promise(((e,t)=>{(function(e){return new Promise(((t,i)=>{navigator.mediaDevices.getUserMedia({audio:!1,video:{deviceId:{exact:e}}}).then((i=>{let s;i.getTracks().forEach((e=>{void 0===s&&void 0!==e.getCapabilities&&(s=e.getCapabilities())})),a(i.getTracks()).then((()=>{(0,n.bT)("DeviceCapabilities",{deviceId:e,capabilities:JSON.stringify(s),source:"mediaDevices"}),t(s)})).catch((()=>{}))})).catch((e=>{l(e)?t(void 0):i(e)}))}))})(i).then((t=>{let s,n,o=!1;void 0!==t&&void 0!==t.width&&void 0!==t.height&&(s=[t.width.max,t.height.max],void 0!==t.resizeMode&&(o=t.resizeMode.some((e=>"crop-and-scale"===e)))),n=o&&void 0!==s?r.map((e=>new Promise((t=>{const i=e[0],n=e[1];void 0!==s&&i<=s[0]&&n<=s[1]?t([i,n]):t(void 0)})))):r.map((e=>{const t=e[0],s=e[1],n={audio:!1,video:{deviceId:{exact:i},width:{exact:t},height:{exact:s}}};return new Promise(((e,i)=>{navigator.mediaDevices.getUserMedia(n).then((i=>{a(i.getTracks()).then((()=>{e([t,s])})).catch((()=>{}))})).catch((t=>{l(t)?e(void 0):i(t)}))}))}));const d=n.reduce(((e,t)=>e.then((e=>t.then((t=>(void 0!==t&&e.push(t),Promise.resolve(e)))).catch((()=>[]))))),Promise.resolve([]));Promise.resolve(d).then((t=>{void 0!==s&&r.some((e=>void 0!==s&&e[0]===s[0]&&e[1]===s[1]))&&t[t.length-1][0]!==s[0]&&t[t.length-1][1]!==s[1]&&t.push(s);const n=new Map;t.forEach((e=>{const t=h(i,e[0],e[1]);void 0!==t&&n.set(t.id,t)})),e(n)})).catch((()=>{}))})).catch((e=>{t(e)}))}))).then((e=>Promise.resolve({device:t,resolutions:e}))).catch((e=>Promise.reject(e)));const s=new Map;return r.forEach((e=>{const i=h(t.deviceId,e[0],e[1]);void 0!==i&&s.set(i.id,i)})),Promise.resolve({device:t,resolutions:s})}var i;return Promise.resolve({device:t})}))),m={mics:new Map,cams:new Map};c.then((e=>{let t=!0;if(e.forEach((e=>{const i=e.device;""!==i.label&&(t=!1),"audioinput"===i.kind?m.mics.set(i.deviceId,{id:i.deviceId,label:i.label}):"videoinput"===i.kind&&void 0!==e.resolutions&&e.resolutions.size>0&&m.cams.set(i.deviceId,{id:i.deviceId,label:i.label,resolutions:e.resolutions})})),t){const e=o.R.permanentPermsMessage;return(0,n.bT)(u,{time_elapsed_ms:Date.now()-p}),void s(new Error(e))}(0,n.bT)(d,{time_elapsed_ms:Date.now()-p}),i(m)})).catch((e=>{s(e)}))})).catch((()=>{}))})).catch((()=>{}))})).catch((e=>{(0,n.bT)(c,{time_elapsed_ms:Date.now()-p}),s(e)}))}))}function c(){return navigator.mediaDevices.enumerateDevices().then((e=>{let t=!1,i=!1;return e.forEach((e=>{""!==e.label&&("audioinput"===e.kind&&(t=!0),"videoinput"===e.kind&&(i=!0))})),t&&i}))}},2922:(e,t,i)=>{"use strict";i.d(t,{w:()=>n});var s=i(5216);const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{};(0,s.Aw)("api/ts/accounts/broadcaster_suspension/").then((t=>{JSON.parse(t.responseText).is_suspended?window.location.reload():e()})).catch((e=>{error(e.message)}))}},4941:(e,t,i)=>{"use strict";i.d(t,{I4:()=>n,jM:()=>d,tR:()=>c});var s=i(4947);function n(e){const t=e=>e>1?"s":"",i=Math.floor(e/3600),s=Math.floor((e%=3600)/60),n=e%60;return i>0?s>0?`${i} hour${t(i)}, ${s} minute${t(s)}`:`${i} hour${t(i)}`:s>0?n>0?`${s} minute${t(s)}, ${n} second${t(n)}`:`${s} minute${t(s)}`:n>0?`${n} second${t(n)}`:"less than a second"}const o=[{name:"year",seconds:31536e3,translation:s.R.years,ago:s.R.yearsAgo,fromNow:s.R.yearsFromNow},{name:"month",seconds:2592e3,translation:s.R.months,ago:s.R.monthsAgo,fromNow:s.R.monthsFromNow},{name:"week",seconds:604800,translation:s.R.weeks,ago:s.R.weeksAgo,fromNow:s.R.weeksFromNow},{name:"day",seconds:86400,translation:s.R.days,ago:s.R.daysAgo,fromNow:s.R.daysFromNow},{name:"hour",seconds:3600,translation:s.R.hours,ago:s.R.hoursAgo,fromNow:s.R.hoursFromNow},{name:"minute",seconds:60,translation:s.R.minutes,ago:s.R.minutesAgo,fromNow:s.R.minutesFromNow},{name:"second",seconds:1,translation:s.R.seconds,ago:s.R.secondsAgo,fromNow:s.R.secondsFromNow}],r=o.findIndex((e=>"hour"===e.name)),a=o.findIndex((e=>"minute"===e.name)),l=function(e){return 1===e?"":arguments.length>1&&void 0!==arguments[1]?arguments[1]:"s"},h=e=>e?"from now":"ago";function d(e,t){const i=t.getTime()-e.getTime();if(0===i)return s.R.now;const n=Math.floor(Math.abs(i)/1e3),r=i>0;if(n<60)return`${n} second${l(n)} ${h(r)}`;let a,d=0,c=0,u="";for(a=0;a<o.length;a+=1)if(d=Math.floor(n/o[a].seconds),c=o[a].seconds,0!==d){u=`${d} ${o[a].name}${l(d)}`;break}if(n>86400&&a+1<o.length){const e=o[a+1],t=Math.floor((n-c*d)/e.seconds);0!==t&&(u=`${u}, ${t} ${e.name}${l(t)}`)}return u=`${u} ${h(r)}`,u}function c(e,t){if(void 0===t||0===t)return e?s.R.never:"";const i=new Date(1e3*t);return e?function(e){const t=((new Date).getTime()-e.getTime())/1e3;for(let e=0;e<=o.length;e+=1){const i=o[e];if(t>=i.seconds)return i.ago(Math.floor(t/i.seconds))}return s.R.now}(i):function(e){const t=((new Date).getTime()-e.getTime())/1e3,i=e=>{let i=t/o[e].seconds;var s;i=e===r?(s=i,Math.floor(10*s)/10):Math.floor(i);const n=e===r||e===a;return o[e].translation(i,n)};for(let e=0;e<=a;e+=1)if(t>=o[e].seconds)return i(e);return i(a)}(i)}},9523:(e,t,i)=>{"use strict";i.d(t,{Go:()=>r,eN:()=>n,ek:()=>a,pf:()=>l,ww:()=>o});var s=i(8423);const n=new s.c_("privateSettingsClicked"),o=new s.c_("spokenLanguageEditLinkClicked"),r=new s.c_("broadcastSettingsSaved"),a=new s.c_("genderSettingsSaved"),l=new s.c_("optInFlagDisplaySettingsSaved")},4548:(e,t,i)=>{"use strict";i.d(t,{Y9:()=>x,ni:()=>P,Ay:()=>T,vN:()=>k});var s=i(7623),n=i(3956),o=i(5216),r=i(2028),a=i(7407);const l=[];for(let e=0;e<256;++e)l[e]=(e+256).toString(16).substr(1);var h=i(213),d=i(8423),c=i(6440),u=i(9135),p=i(3049),m=i(4947),g=i(78),v=i(2239),f=i(2945);const y=["H264","VP8","VP9"];class b{constructor(e){this.sdpStr=e,this.sdp=(0,v.qg)(e);const t=(0,f.JO)(window.location.search)["video-bitrate"];if(void 0!==t){const e=parseInt(t);this.forceVideoBitrate(e),this.videoBitrateOverriden=!0}const i=(0,f.JO)(window.location.search)["video-codecs"];if(void 0!==i){const e=i.split(",");let t;const s=(0,f.JO)(window.location.search)["video-profiles"];e.length>0&&void 0!==s&&(t=s.split(",")),this.forceVideoCodecs(e,t),this.videoCodecsOverriden=!0}}write(){return(0,v.M9)(this.sdp)}forceVideoBitrate(e){if(!this.videoBitrateOverriden){const t=this.videoBitrate(e);return this.sdp.media.forEach((e=>{"video"===e.type&&this.addBitrates(t,e,y)})),t}}forceVideoCodecs(e,t){this.videoCodecsOverriden||this.sdp.media.forEach((i=>{"video"===i.type&&this.filterCodecs(e,i,y,t)}))}videoBitrate(e){let t=1500;return void 0!==e&&(e<=360?t=800:e>540&&(t=3e3)),t}addBitrates(e,t,i){const s=this.findCodecs(i,t),n=[];return s.forEach((t=>{n.push({payload:t,config:`x-google-min-bitrate=${e}`}),n.push({payload:t,config:`x-google-max-bitrate=${e}`})})),t.fmtp=t.fmtp.concat(n),e}filterCodecs(e,t,i,s){const n=this.findCodecs(i,t),o=this.findCodecs(e,t,s);t.rtp.filter((e=>n.some((t=>t===e.payload))&&!o.some((t=>t===e.payload)))).map((e=>e.payload)).forEach((e=>{this.removeCodec(e,t)}))}findCodecs(e,t,i){let s,n=t.rtp.filter((t=>{const i=e.some((e=>e.toUpperCase()===t.codec.toUpperCase()));return i&&"VP8"===t.codec.toUpperCase()&&(s=t.payload),i})).map((e=>e.payload));if(void 0!==i){const e=["profile-level-id=","profile-id="],o=t.fmtp.filter((t=>{if(n.some((e=>e===t.payload))){let s=!1;return t.config.split(";").forEach((t=>{e.forEach((e=>{if(t.startsWith(e)){const n=t.split(e)[1].toUpperCase();i.some((e=>e.toUpperCase()===n))&&(s=!0)}}))})),s}return!1})).map((e=>e.payload));void 0!==s&&n.some((e=>e===s))&&o.unshift(s),n=o}return n}removeCodec(e,t){const i="apt=";if(void 0===t.payloads)return;let s=t.payloads.split(" ");s=s.filter((t=>parseInt(t)!==e)),t.payloads=s.join(" "),t.rtp=t.rtp.filter((t=>t.payload!==e));const n=t.rtcpFb;void 0!==n&&(t.rtcpFb=n.filter((t=>t.payload!==e))),t.fmtp=t.fmtp.filter((t=>t.payload!==e)),t.fmtp.filter((t=>{const s=t.config;if(s.startsWith(i)){const t=s.split(i)[1];if(parseInt(t)===e)return!0}return!1})).map((e=>e.payload)).forEach((e=>{this.removeCodec(e,t)}))}}var w=i(2922);function C(e){let t;return t=void 0,void 0===e||"number"==typeof e?t=e:"exact"in e&&"number"==typeof e.exact?t=e.exact:"ideal"in e&&"number"==typeof e.ideal&&(t=e.ideal),t}class S extends Error{constructor(e){super(e),this.fatal=!0}}class x{constructor(e,t,i){this.lastMessage=0,this.lastStreamInfoMessage=0,this.bitrateNRSent=!1,this.webRTCInfoSent=!1,this.streamInfo={applicationName:"live-origin",streamName:"stream",sessionId:"[empty]"},this.dossier=e,this.video=t,this.source=i,this.uuid=function(){const e=new Uint8Array(16);return window.crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128,function(e){let t=0;const i=l;return[i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]]].join("")}(e)}(),this.lastStreamInfoMessage=Date.now(),this.started=!1,this.browserAndPlatformInfo=(0,s.Ni)()}setup(e){return this.constraints=e,new Promise(((t,i)=>{if("object"!=typeof navigator||"object"!=typeof navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return void i(new Error("Your browser doesn't support broadcasting. Recent versions of Safari, Firefox, or Chrome are recommended."));let s="DevicePermsOnLoadDenied";window.setTimeout((()=>{s="DevicePermsRequestDenied"}),500),navigator.mediaDevices.getUserMedia(e).then((s=>{this.stream=s;const n=s.getVideoTracks();0!==n.length&&void 0!==n[0]?(this.streamSettings=n[0].getSettings(),void 0!==this.streamSettings.width&&void 0!==this.streamSettings.height&&function(e,t,i){if(!function(e){return"video"in e&&void 0!==typeof e.video}(i))return;const s=function(e){let t,i;t=void 0,i=void 0;const s=e.video;return void 0!==s&&(t=C(s.width),i=C(s.height)),{width:t,height:i}}(i);if(void 0!==s.width&&s.width!==e||void 0!==s.height&&s.height!==t){const n={WebRTCHandlerError:"Stream resolution different from constraint resolution"};void 0!==s.width&&(n.WebRTCHandlerConstraintWidth=JSON.stringify(i.video.width),n.WebRTCHandlerStreamWidth=e),void 0!==s.height&&(n.WebRTCHandlerConstraintHeight=JSON.stringify(i.video.height),n.WebRTCHandlerStreamHeight=t),n.raw_constraints=JSON.stringify(i),(0,a.bT)("WebRTCHandlerSetup",n)}}(this.streamSettings.width,this.streamSettings.height,e),debug(`Got stream with constraints: ${JSON.stringify(e)}`),debug(`Using video device: ${n[0].label}`),this.video.srcObject=s,t(s)):i(new Error("We can't find any cameras, please ensure you have given permission to use your camera."))})).catch((e=>{let t=e.message;"ConstraintNotSatisfiedError"===e.name?t=m.R.resolutionNotSupported:"OverconstrainedError"===e.name?t=m.R.minResolutionNotSupported:"PermissionDeniedError"===e.name||"NotAllowedError"===e.name?t=m.R.needCamAndMicPermission:""!==t&&null!==t||(t=m.R.unknownDeviceError),(0,a.bT)(s);const n=new Error(t);n.name=e.name,i(n)}))}))}start(){return new Promise(((e,t)=>{this.started=!0;let i=!1;if(void 0===this.stream)return this.close(),void t(new S("Unable to get video from camera. Try refreshing the page and make sure you allow video/audio if any prompts come up."));try{if(void 0===this.updateStatusInterval&&(this.closed=!1,this.updateStatusInterval=window.setInterval((()=>{this.updateStatus()}),1e3)),this.createPeerConnection(),void 0===this.peerConnection)return void t(new Error("Unable to connect to peer"));this.peerConnection.oniceconnectionstatechange=s=>{void 0!==this.peerConnection?(debug(`oniceconnectionstatechange (${this.peerConnection.iceConnectionState})`,s),i||("connected"!==this.peerConnection.iceConnectionState&&"completed"!==this.peerConnection.iceConnectionState||(i=!0,(0,a.bT)("WebRTCHandlerConnected",{WebRTCHandlerSource:this.source}),P.fire(this.uuid),clearInterval(this.bitratePolling),this.bitratePolling=window.setInterval((()=>{void 0!==this.streamData.bitrate&&(0,p.mR)("webrtc",this.streamData.bitrate)}),6e4),e()),"failed"===this.peerConnection.iceConnectionState&&(i=!0,t(new Error("WebRTC failed"))))):debug("oniceconnectionstatechange for closed peer",s)},this.connectOrigin(this.dossier,t)}catch(e){t(e)}}))}stop(e){const t=!0===e;return new Promise((e=>{const i=()=>{t||(this.started=!1,k.fire(this.uuid)),e(this.uuid)};if(clearInterval(this.bitratePolling),t||this.close(),void 0!==this.websocket){if(this.websocket.readyState!==WebSocket.CLOSING&&this.websocket.readyState!==WebSocket.CLOSED)try{this.websocket.close()}catch(e){error("could not close websocket connection",{reason:e.toString()})}this.websocket=void 0}if(void 0!==this.peerConnection){try{this.peerConnection.close()}catch(e){error("could not close peer connection",{reason:e.toString()})}this.peerConnection=void 0}this.lastMessage=Date.now(),t||void 0===this.stream?i():(0,r.W_)(this.stream.getTracks()).then((()=>{this.stream=void 0,i()})).catch((()=>{}))}))}setMute(e){void 0!==this.stream?this.stream.getAudioTracks().length>0&&(this.stream.getAudioTracks()[0].enabled=!e):error("no stream")}reset(){return new Promise(((e,t)=>{const i=this.started;this.stop().then((()=>{void 0!==this.constraints?this.setup(this.constraints).then((s=>{i?this.start().then((()=>{e()})).catch((e=>{t(e)})):e()})).catch((e=>{t(e)})):e()})).catch((e=>{t(e)}))}))}close(){this.closed=!0,void 0!==this.updateStatusInterval&&(clearInterval(this.updateStatusInterval),this.updateStatusInterval=void 0)}updateStatus(){if(!0===this.closed)return void this.stop();const e=Date.now();if(this.lastStreamInfoMessage<e-1e4){if(this.lastStreamInfoMessage=e,!this.shouldUpdateOrigin())return void this.stop();(0,a.bT)("WebRTCHandlerRestart"),this.stop(!0).then((()=>{const e=`api/switch_origin/?current_origin=${this.dossier.originHost}`;(0,o.Aw)(e).then((e=>{this.dossier.originHost=e.responseText,this.start().catch((e=>{error("Could not restart stream",{reason:e.message})}))})).catch((e=>{error("Could not get new origin",{reason:e.message})}))})).catch((()=>{}))}let t=this.streamData;void 0===this.websocket&&(t={method:"stream_info",status:"connecting"}),void 0!==t&&T.fire({uuid:this.uuid,data:t})}shouldUpdateOrigin(){return void 0===(0,n.fL)()}createPeerConnection(){void 0!==this.stream?(void 0!==this.peerConnection&&(error("peerConnection already open"),this.peerConnection.close(),this.peerConnection=void 0),this.peerConnection=new RTCPeerConnection({iceServers:[]}),this.peerConnection.onicecandidate=e=>{debug("onicecandidate",e)},this.stream.getAudioTracks().length>0&&this.peerConnection.addTrack(this.stream.getAudioTracks()[0],this.stream),this.peerConnection.addTrack(this.stream.getVideoTracks()[0],this.stream),this.peerConnection.createOffer().then((e=>{this.updateSDP(e.sdp)})).catch((()=>{}))):error("no stream")}connectOrigin(e,t){void 0!==this.websocket&&(error("WebSocket already open"),this.websocket.close(),this.websocket=void 0);const i=new WebSocket(`wss://${e.originHost}${e.originWSEndpoint}`);i.binaryType="arraybuffer",i.onopen=()=>{this.websocket=i,i.send(JSON.stringify({method:"connect",username:e.room,password:e.originPassword}))},i.onerror=e=>{error("webrtc websocket error",{error:e}),t(new Error(`WebSocket error: ${JSON.stringify(e)}`))},i.onclose=()=>{this.websocket=void 0},i.onmessage=e=>{let i;try{i=JSON.parse(e.data)}catch(e){return}switch(i.method){case"auth_valid":this.createOffer(t);break;case"stream_info":this.streamData=i,this.webRTCInfoSent||(this.webRTCInfoSent=!0,this.sendInitialWebRTCInfo()),this.lastStreamInfoMessage=Date.now();break;case"already_publishing":this.lastMessage=Date.now(),(0,h.Q$)("You have started publishing from a new location, shutting down stream",(()=>{u.H.fire(""),g._.fire("")})),this.stop();break;case"shutdown":this.lastMessage<Date.now()-1e3&&(0,h.Q$)("Error Publishing Stream",(()=>{u.H.fire(""),(0,w.w)((()=>{}))})),this.stop();break;case"origin_info":break;default:"sendOffer"===i.command?this.processSdp(i,t):warn("Unhandled",i)}}}correctedWidthAndHeight(){const{width:e,height:t}=this.streamSettings,i=Number(e)<Number(t),n=(0,s.yb)();return"mobile"===this.source&&i||void 0!==n&&n>=16?{width:t,height:e}:{width:e,height:t}}createOffer(e){void 0!==this.websocket?void 0!==this.stream?(this.websocket.send(JSON.stringify({method:"publish",frameRate:this.streamSettings.frameRate,source:this.source,browserAndPlatform:JSON.stringify(this.browserAndPlatformInfo),...this.correctedWidthAndHeight()})),void 0!==this.peerConnection?this.peerConnection.createOffer().then((t=>{void 0!==this.peerConnection?(debug(`Got description ${t}`),t.sdp=this.updateSDP(t.sdp),debug(`gotDescription: ${JSON.stringify({sdp:t})} ${this.peerConnection}`),this.peerConnection.setLocalDescription(t).then((()=>{void 0!==this.websocket?this.websocket.send(JSON.stringify({direction:"publish",command:"sendOffer",streamInfo:this.streamInfo,sdp:t})):e(new Error("ws undefined"))})).catch((t=>{e(t)}))):error("peerConnection not open")})).catch((t=>{e(t)})):error("peerConnection not open")):e(new Error("stream undefined")):e(new Error("ws undefined"))}processSdp(e,t){if(void 0===this.peerConnection)return void error("peerConnection not open");const i=e.sdp;null!=i&&(debug("sdp: ",i),this.peerConnection.setRemoteDescription(i).catch((e=>{t(e)})));const s=e.iceCandidates;if(void 0!==s)for(const e of s)debug("iceCandidates: ",e),this.peerConnection.addIceCandidate(new RTCIceCandidate(e)).catch((e=>{t(e)}))}updateSDP(e){if(void 0===e)return error("sdpStr undefined"),"";debug("Original SDP",e);const t=new b(e);if((0,s.OF)()?t.forceVideoCodecs(["H264"],["42e01f"]):t.forceVideoCodecs(["H264","VP8"],["42e01f"]),!(0,c.f)("VDPFixedBitrate")){const e=t.forceVideoBitrate(this.streamSettings.height);void 0!==e&&(this.bitrateNRSent||((0,a.bT)("WebRTCHandlerSDPUpdate",{WebRTCHandlerVideoBitrate:e}),this.bitrateNRSent=!0))}return e=t.write(),debug("Updated SDP",e),e}static isWebRTCNotYetSupported(){return(0,s.H9)()}static isWebRTCNeverSupported(){return(0,s._6)()}static canUseWebRTC(){return!x.isWebRTCNotYetSupported()&&!x.isWebRTCNeverSupported()}sendInitialWebRTCInfo(){let e="";void 0!==this.streamData.region&&(e=this.streamData.region),(0,o.KF)("api/ts/chat/webrtc-start/",{room:this.dossier.room,stream_type:"webrtc",origin_host:this.dossier.originHost,origin_region:e,webrtc_browser_info:JSON.stringify(this.browserAndPlatformInfo)})}}const T=new d.c_("streamStatusUpdate"),P=new d.c_("streamStart"),k=new d.c_("streamStop")},1134:(e,t,i)=>{"use strict";i.d(t,{T:()=>o});var s=i(3955);const n=["smcBadge","followerBadge","notesBadge"];class o{static registerGenerator(e,t){o.badgeGenerators.has(e)?error("Generator already registered for badge",e):o.badgeGenerators.set(e,t)}static createBadges(e){const t=document.createElement("span");return(0,s.ZM)(t,{display:"inline-block",verticalAlign:"middle",marginTop:"-.5em",marginBottom:"-.5em",marginRight:"1px",overflow:"visible"}),n.forEach((i=>{const s=o.badgeGenerators.get(i);if(void 0!==s){const n=s(e);n.classList.add(`${i}_${e}`),n.dataset.testid=`${i}`,t.appendChild(n)}})),t}static getBadgeElements(e,t){return Array.from(document.body.querySelectorAll(`.${e}_${t}`))}}o.badgeGenerators=new Map},9453:(e,t,i)=>{"use strict";i.d(t,{TL:()=>h,Ye:()=>l});var s=i(9461),n=i(1519),o=i(7407);let r=!0;const a=new n.a((()=>{void 0===s.Bm.current.loggedInUser&&(0,o.bT)("AnonChatInputFocused")}),{bounceLimitMS:1500,debounceType:0}),l=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0===r&&(a.callFunc(),!0!==e&&(r=!1))},h=()=>{r=!0}},5746:(e,t,i)=>{"use strict";i.d(t,{V:()=>v,n:()=>g});var s=i(4936),n=i(3417),o=i(9447),r=i(2394),a=i(6784),l=i(213),h=i(5216),d=i(6844),c=i(2709),u=i(8423),p=i(3959),m=i(4947);class g extends c.u{constructor(e,t,i){super(),this.username=e,this.message=t,this.chatConnection=i,this.formFocusableElements=[],this.endScreenFocusableElements=[],this.isOnEndScreen=!1,this.closeChatReportRequest=new u.c_("closeChatReportRequest"),this.reportSent=new u.c_("reportSent"),this.ignoreReportedUser=new u.c_("ignoreReportedUser"),this.trapFocus=e=>{e.stopPropagation(),27!==e.keyCode?9===e.keyCode&&(e.preventDefault(),this.isOnEndScreen?this.focusNextElement(this.endScreenFocusableElements,e.shiftKey):this.focusNextElement(this.formFocusableElements,e.shiftKey)):this.onChatReportClosed(!1)},(0,o.fZ)(this.element,"chatReport"),this.element.style.position="static",this.element.style.fontFamily="UbuntuBold, Arial, Helvetica, sans-serif",this.element.style.fontSize="11px",this.form=document.createElement("form"),this.element.dataset.testid="report-modal";const s=document.createElement("div"),n=document.createElement("div");this.commentInput=document.createElement("textarea"),this.form.appendChild(s),this.form.style.width="100%",(0,o.fZ)(s,"headerDiv"),s.style.margin="6px",s.style.fontSize="13px",s.style.overflow="hidden",s.style.textOverflow="ellipsis",s.innerText=`${m.R.report} ${this.username}`;const r=this.categories();for(const e in r){const t=document.createElement("label"),i=document.createElement("input"),s=document.createElement("span");t.style.display="flex",t.style.margin="6px 8px",t.style.alignItems="center",i.type="radio",i.style.margin="0 4px 0 2px",i.name="chatReport",i.value=e,s.innerText=r[e],s.style.flex="1",t.appendChild(i),t.appendChild(s),this.form.appendChild(t),t.onclick=()=>{this.activeRadioInput=i},this.formFocusableElements.push(i)}n.style.margin="6px 8px",this.commentInput.draggable=!1,this.commentInput.style.resize="none",this.commentInput.style.boxSizing="border-box",this.commentInput.style.height="40px",this.commentInput.style.width="100%",this.commentInput.style.borderWidth="1px",this.commentInput.style.borderStyle="solid",this.commentInput.maxLength=255,this.commentInput.oninput=()=>{this.commentInput.value=this.commentInput.value.slice(0,255)},n.appendChild(this.commentInput),this.form.appendChild(n),this.formFocusableElements.push(this.commentInput),this.buttonContainer=document.createElement("div"),this.buttonContainer.style.margin="0 0 8px",this.buttonContainer.style.cssFloat="right",this.buttonContainer.style.fontFamily="UbuntuMedium, Arial, Helvetica, sans-serif";const h=document.createElement("button");(0,o.fZ)(h,"submitButton"),h.type="submit",h.innerText=m.R.reportCAPS,h.style.fontSize="11px",h.style.padding="4px 6px 4px 6px",h.style.marginRight="8px",h.style.borderRadius="4px",h.style.boxSizing="border-box",h.style.cursor="pointer",h.style.display="inline-block",h.dataset.testid="submit-report-button";const d=document.createElement("span");(0,o.fZ)(d,"cancelSpan"),d.innerText=m.R.cancelCAPS,d.style.fontSize="11px",d.style.padding="4px 6px 4px 6px",d.style.marginRight="8px",d.style.borderRadius="4px",d.style.boxSizing="border-box",d.style.cursor="pointer",d.style.display="inline-block",d.dataset.testid="cancel-report-button",this.buttonContainer.appendChild(d),this.buttonContainer.appendChild(h),this.form.appendChild(this.buttonContainer),this.formFocusableElements.push(d),this.formFocusableElements.push(h),this.createFinishReportScreen(),(0,a.wu)("submit",this.form,(e=>{e.preventDefault(),this.commentInput.blur(),void 0!==this.activeRadioInput?"other"!==this.activeRadioInput.value||""!==this.commentInput.value.trim()?(this.sendReport().then((e=>{e.success?this.setEndScreenText(m.R.userHasBeenReported(this.username)):this.setEndScreenText(m.R.unableToReport)})).catch((e=>{403===e.xhr.status?this.setEndScreenText(m.R.tooManyReports):this.setEndScreenText(m.R.unableToReport)})),this.onSendReport(),this.showEndReportScreen()):(0,l.Q$)(m.R.reportAbuseDescriptionRequired,(()=>this.focusCommentBox())):(0,l.Q$)(m.R.selectReason,(()=>this.focusForm()))})),(0,a.wu)("click",d,(e=>{e.preventDefault(),this.onChatReportClosed(!1)})),this.element.appendChild(this.form),this.element.appendChild(this.finishReportScreenDiv),(0,a.wu)("keydown",this.element,this.trapFocus)}categories(){return void 0===this.message?(error("ChatReport error: expected categories override"),{}):(0,p.d)(this.message)&&this.message.mediaList.length>0?{inappropriate:m.R.reportMessageInappropriate,rude:m.R.reportMessageRudeToBcaster,spam:m.R.reportMessageSpam,photo:m.R.reportMessageOffensiveMedia,other:m.R.reportMessageOther}:{inappropriate:m.R.reportMessageInappropriate,rude:m.R.reportMessageRudeToBcaster,spam:m.R.reportMessageSpam,other:m.R.reportMessageOther}}additionalFinishReportLinks(){return[]}showEndReportScreen(){const e=this.element.offsetWidth,t=this.element.offsetHeight;this.form.style.display="none",this.finishReportScreenDiv.style.display="block",this.finishReportScreenDiv.style.width=`${e}px`,this.finishReportScreenDiv.style.height=`${t}px`;const i=this.finishReportContainer.offsetHeight;this.finishReportContainer.style.padding=t/2-i/2+"px 0 0",this.isOnEndScreen=!0}static parseAbuseReportResult(e){const t=new s.N6(e);return{success:"success"===t.getStringOrUndefined("result"),html:t.getStringOrUndefined("html")}}reportEndpoint(){return void 0===this.message?(error("ChatReport error: expected reportEndpoint override"),""):`chatmessages/report/${this.message.messageID}/`}sendReport(){return new Promise(((e,t)=>{const i=void 0===this.activeRadioInput?"":this.activeRadioInput.value,s=this.commentInput.value;(0,h.KF)(this.reportEndpoint(),{spammer:this.username,category:i,additional_comments:s}).then((t=>{e(g.parseAbuseReportResult(t.responseText))})).catch((e=>{t(e)}))}))}resetForm(){this.form.reset()}createFinishReportScreen(){this.finishReportScreenDiv=document.createElement("div"),this.finishReportContainer=document.createElement("div"),this.userReportedMessage=document.createElement("div"),this.ignoreUserLink=document.createElement("button");const e=this.additionalFinishReportLinks(),t=document.createElement("button");this.endScreenFocusableElements.push(this.ignoreUserLink);for(const t of e)this.endScreenFocusableElements.push(t);this.endScreenFocusableElements.push(t),this.userReportedMessage.innerText=m.R.sending,this.userReportedMessage.style.margin="0 0 8px 0",this.userReportedMessage.style.textAlign="center",(0,o.fZ)(this.ignoreUserLink,"ignoreUserLink"),(0,o.fZ)(t,"closeReportLink"),this.ignoreUserLink.style.textAlign="center",this.ignoreUserLink.style.fontSize="13px",this.ignoreUserLink.style.display="block",this.ignoreUserLink.style.margin="0 auto 8px",this.ignoreUserLink.style.background="none",this.ignoreUserLink.style.border="none",this.ignoreUserLink.style.cursor="pointer",this.ignoreUserLink.dataset.testid="ignore-user-link",this.updateIgnoreText((0,n.pi)(this.username));for(const t of e)t.style.textAlign="center",t.style.fontSize="13px",t.style.display="block",t.style.margin="0 auto 8px",t.style.background="none",t.style.border="none",t.style.cursor="pointer";t.innerText=m.R.close,t.style.textAlign="center",t.style.fontSize="13px",t.style.display="block",t.style.margin="0 auto 8px",t.style.background="none",t.style.border="none",t.style.cursor="pointer",t.dataset.testid="close-report-link",this.underlineOnHover(t),this.finishReportScreenDiv.style.display="none",this.finishReportContainer.style.fontSize="13px",this.finishReportContainer.style.fontFamily="Arial, Helvetica, sans-serif",this.finishReportContainer.appendChild(this.userReportedMessage),this.shouldShowIgnore()&&this.finishReportContainer.appendChild(this.ignoreUserLink);for(const t of e)this.finishReportContainer.appendChild(t);this.finishReportContainer.appendChild(t),this.finishReportScreenDiv.appendChild(this.finishReportContainer),(0,a.wu)("click",t,(e=>{e.preventDefault(),this.onChatReportClosed(!0)}))}setEndScreenText(e){this.userReportedMessage.innerText=e}disableIgnoreTextInteraction(){this.ignoreUserLink.disabled=!0,this.ignoreUserLink.style.cursor="default",this.ignoreUserLink.style.textDecoration="none",this.ignoreUserLink.onmouseenter=()=>{},this.ignoreUserLink.onmouseleave=()=>{},this.ignoreUserLink.onclick=()=>{},(0,o.fZ)(this.ignoreUserLink,"disabled");const e=this.endScreenFocusableElements.indexOf(this.ignoreUserLink);-1!==e&&this.endScreenFocusableElements.splice(e,1),this.ignoreUserLink.blur()}focusNextElement(e,t){if(!(document.activeElement instanceof HTMLElement))return void this.focusForm();const i=e.indexOf(document.activeElement);if(-1===i)return void this.focusForm();let s;t?(s=i-1,s<0&&(s+=e.length)):s=(i+1)%e.length,e[s].focus()}updateIgnoreText(e){e?(this.ignoreUserLink.innerText=m.R.userIsIgnored(this.username),this.disableIgnoreTextInteraction()):(this.ignoreUserLink.innerText=m.R.ignoreUser(this.username),(0,o.SA)(this.ignoreUserLink,"disabled"),this.underlineOnHover(this.ignoreUserLink),this.ignoreUserLink.disabled=!1,this.ignoreUserLink.onclick=()=>{(0,d.rC)()?this.ignoreUserLink.innerText=m.R.loginForIgnore:(this.onIgnoreUser(),this.ignoreUserLink.innerText=m.R.userIsIgnored(this.username),this.ignoreReportedUser.fire(void 0)),this.disableIgnoreTextInteraction()})}focusCommentBox(){this.commentInput.focus()}focusForm(){this.isOnEndScreen?this.endScreenFocusableElements[0].focus():this.formFocusableElements[0].focus()}tearDown(){}underlineOnHover(e){e.onmouseenter=()=>{e.style.textDecoration="underline"},e.onmouseleave=()=>{e.style.textDecoration="none"}}shouldShowIgnore(){return void 0!==this.chatConnection&&this.chatConnection.username()!==this.chatConnection.room()}onIgnoreUser(){void 0!==this.chatConnection&&this.chatConnection.ignore(this.username)}onSendReport(){this.reportSent.fire(void 0)}onChatReportClosed(e){this.closeChatReportRequest.fire(e)}}class v extends g{constructor(e,t,i){super(e,t),this.ignoreFunc=i,this.element.style.minWidth="188px",this.element.style.maxWidth="268px",(0,a.wu)("pointerdown",this.commentInput,(e=>(0,r.O)(e)))}categories(){return{inappropriate:m.R.inappropriateMessage,rude:m.R.rudeMessage,spam:m.R.spamMessage,other:m.R.reportMessageOther}}shouldShowIgnore(){return!0}onIgnoreUser(){this.ignoreFunc()}}},1413:(e,t,i)=>{"use strict";i.d(t,{J:()=>$,V:()=>W});var s=i(6624),n=i(4936),o=i(2201),r=i(9461),a=i(5914),l=i(7477),h=i(6064),d=i(369),c=i(213),u=i(5216),p=i(768),m=i(6844),g=i(1131),v=i(2939),f=i(2709),y=i(8423),b=i(1779),w=i(6716),C=i(7407),S=i(1452),x=i(5424),T=i(3456),P=i(7623),k=i(1474),A=i(9447),M=i(1679),R=i(6784),I=i(5020),E=i(3955),L=i(8936),D=i(5173),B=i(8785),U=i(4947),_=i(3860),F=i(9311);class N extends D.Q{constructor(e,t,i){super(),this.tipSource=e,this.topSectionWrapper=t,this.sendTipButtonSpan=i,this.roomType=B.CJ.Public,this.tokenBalance=0,this.isTokenAmountAlreadyTooHigh=!1,this.isHighTipAmountWarningActive=!1,this.divotOffsetLeft=96,this.tipSent=new y.c_("tipSent"),this.closed=new y.c_("tipClosed"),this.isVisible=!1,this.element.id="SplitModeTipCallout",this.element.dataset.testid="send-tip-callout",(0,A.fZ)(this.element,A.aG.defaultColor),this.element.style.display="none",this.element.style.position="absolute",this.element.style.width="390px",this.element.style.height="auto",this.element.style.top="0",this.element.style.borderWidth="2px",this.element.style.borderStyle="solid",this.element.style.borderRadius="4px",this.element.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",this.element.style.fontSize="12px",this.element.style.overflow="visible";const s=()=>{this.sendTipButton.hasFocus()&&!this.sendTipButton.focusPrev()?this.tipMessageTextarea.focus():document.activeElement===this.tipMessageTextarea?void 0!==this.tipOptionsSelect?this.tipOptionsSelect.focus():this.tipAmountInput.focus():document.activeElement===this.tipOptionsSelect?this.tipAmountInput.focus():this.sendTipButton.hasFocus()||this.sendTipButton.focusPrev()},n=()=>{this.sendTipButton.hasFocus()&&!this.sendTipButton.focusNext()?this.tipAmountInput.focus():document.activeElement===this.tipAmountInput?void 0!==this.tipOptionsSelect?this.tipOptionsSelect.focus():this.tipMessageTextarea.focus():document.activeElement===this.tipOptionsSelect?this.tipMessageTextarea.focus():this.sendTipButton.hasFocus()||this.sendTipButton.focusNext()},o=e=>{this.sendTipButton.hasFocus()&&(e?this.sendTipButton.focusNextMenuItem():this.sendTipButton.focusPrevMenuItem())};(0,R.wu)("keydown",this.element,(e=>{"Escape"===e.code?this.hide():"Tab"===e.code?(e.shiftKey?s():n(),e.preventDefault()):"ArrowDown"===e.code?(e.preventDefault(),o(!0)):"ArrowUp"===e.code&&(e.preventDefault(),o(!1))})),this.bottomDivot=(0,I.Uv)("","","74px"),(0,A.fZ)(this.bottomDivot,"bottomDivot"),this.element.appendChild(this.bottomDivot),this.topDivot=(0,I.Wj)("","","74px"),(0,A.fZ)(this.topDivot,"topDivot"),this.element.appendChild(this.topDivot),this.leftDivot=(0,I.Wr)("","","30px"),(0,A.fZ)(this.leftDivot,"leftDivot"),this.element.appendChild(this.leftDivot),this.overlay.style.bottom="";const a=document.createElement("div");(0,A.fZ)(a,"titleBar"),a.innerText=U.R.sendTipText,a.style.fontSize="15px",a.style.fontFamily="UbuntuBold, Helvetica, Arial, sans-serif",a.style.padding="6px",this.element.appendChild(a);const l=document.createElement("div");l.style.display="inline-block",l.style.width="100%";const h=document.createElement("span");h.innerText=U.R.currentBalanceText,h.style.fontWeight="bold",h.style.display="inline-block",h.style.padding="6px",l.appendChild(h),this.tokenBalanceSpan=document.createElement("span"),this.tokenBalanceSpan.dataset.testid="token-balance",(0,A.fZ)(this.tokenBalanceSpan,"tokenBalance"),this.tokenBalanceSpan.style.display="inline-block",this.tokenBalanceSpan.style.fontWeight="bold",this.tokenBalanceSpan.style.padding="6px 6px 6px 0",l.appendChild(this.tokenBalanceSpan);const d=document.createElement("a");(0,A.fZ)(d,"purchaseTokens"),d.innerText=U.R.purchaseTokensText,d.href=(0,u._Y)(`${M.bv}?source=${r.Bm.current.PurchaseEventSources.TOKEN_SOURCE_TIP_CALLOUT}`),d.style.display="inline-block",d.style.fontSize="11px",d.style.marginLeft="12px",d.style.cssFloat="right",d.style.padding="6px",d.dataset.testid="purchase-tokens",d.onclick=()=>((0,M.di)({source:r.Bm.current.PurchaseEventSources.TOKEN_SOURCE_TIP_CALLOUT,target:d}),!1),l.appendChild(d),this.element.appendChild(l),this.lowScoreWarning=document.createElement("div"),(0,A.fZ)(this.lowScoreWarning,"warning"),this.lowScoreWarning.style.display="none",this.lowScoreWarning.style.fontWeight="bold",this.lowScoreWarning.style.padding="6px",this.lowScoreWarning.style.textAlign="center",this.lowScoreWarning.style.position="absolute",this.lowScoreWarning.style.left="50%";const p=document.createElement("div");p.innerText=U.R.satisfactionWarningText,this.lowScoreWarning.appendChild(p);const m=document.createElement("div");m.innerText=U.R.tipWarningText,this.lowScoreWarning.appendChild(m),this.element.appendChild(this.lowScoreWarning),this.sendTipForm=document.createElement("form");const g=document.createElement("label"),f=document.createElement("span");f.innerText=U.R.tipAmountText,f.style.display="inline-block",f.style.padding="6px",g.appendChild(f),this.tipAmountInput=(0,M.Gz)(),this.tipAmountInput.style.width="5em",this.tipAmountInput.style.display="inline-block",this.tipAmountInput.style.padding="4px",this.tipAmountInput.style.borderWidth="1px",this.tipAmountInput.style.borderStyle="solid",this.tipAmountInput.style.borderRadius="4px",this.tipAmountInput.onclick=()=>{this.focusTipAmount()},(0,R.wu)("input",this.tipAmountInput,(()=>{this.tipAmountChange()})),g.appendChild(this.tipAmountInput),this.sendTipForm.appendChild(g),this.tipMessageLabel=document.createElement("div"),this.tipMessageLabel.innerText=U.R.defaultTipMessageLabel,this.tipMessageLabel.style.padding="6px 6px 0 6px",this.sendTipForm.appendChild(this.tipMessageLabel),this.tipMessageDiv=document.createElement("div"),this.tipMessageTextarea=document.createElement("textarea"),this.tipMessageTextarea.dataset.testid="tip-message-textarea",(0,A.fZ)(this.tipMessageTextarea,"tipMessageInput"),this.tipMessageTextarea.maxLength=255,this.tipMessageTextarea.style.width="100%",this.tipMessageTextarea.style.height="40px",this.tipMessageTextarea.style.resize="none",this.tipMessageTextarea.style.margin=`${k.xj}px`,this.tipMessageTextarea.style.padding="4px",this.tipMessageTextarea.style.borderWidth="1px",this.tipMessageTextarea.style.borderStyle="solid",this.tipMessageTextarea.style.borderRadius="4px",this.tipMessageTextarea.style.boxSizing="border-box",this.tipMessageDiv.appendChild(this.tipMessageTextarea),this.sendTipForm.appendChild(this.tipMessageDiv),this.tipMessageLabel.onclick=()=>{this.tipMessageTextarea.select()},this.invalidTipAmountDiv=document.createElement("div"),(0,A.fZ)(this.invalidTipAmountDiv,"warning"),this.invalidTipAmountDiv.innerText=U.R.tipAmountInvalid,this.invalidTipAmountDiv.style.display="none",this.invalidTipAmountDiv.style.paddingLeft="5px",this.invalidTipAmountDiv.dataset.testid="invalid-tip",g.appendChild(this.invalidTipAmountDiv);const b=document.createElement("div");b.style.textAlign="right",b.style.position="relative",b.style.display="flex",b.style.flexWrap="wrap-reverse",this.ctrlSNotice=document.createElement("div"),this.ctrlSNotice.innerText=U.R.toggleWindowMessage,this.ctrlSNotice.style.position="relative",this.ctrlSNotice.style.display="none",this.ctrlSNotice.style.fontSize="10px",this.ctrlSNotice.style.lineHeight="1.3em",this.ctrlSNotice.style.padding="10px",this.ctrlSNotice.style.textAlign="left",this.ctrlSNotice.style.top="6px",this.ctrlSNotice.style.left="0px",b.appendChild(this.ctrlSNotice),this.sendTipButton=new F.i,this.addChild(this.sendTipButton,b),this.sendTipForm.appendChild(b),this.element.appendChild(this.sendTipForm),v.X0.listen((e=>{this.hasLowSatisfactionScore=e.dossier.hasLowSatisfactionScore,this.isAgeVerified=e.dossier.isAgeVerified,this.roomName=e.chatConnection.room(),e.chatConnection.event.statusChange.listen((e=>{this.roomType="privatewatching"===e.currentStatus?B.CJ.Private:B.CJ.Public}))})),k.D.listen((e=>{this.updateTokenBalance(e.tokens)})),this.repositionChildren(),(0,R.wu)("submit",this.sendTipForm,(e=>{if(e.preventDefault(),!(0,M.sI)(this.tipAmountInput.value))return void(0,c.Q$)(U.R.tipAmountInvalid);if(!this.isVisible||!this.sendTipButton.isEnabled())return;const t=parseInt(this.tipAmountInput.value);if(t>this.tokenBalance)return void(0,M.qr)(U.R.notEnoughTokensMessage,r.Bm.current.PurchaseEventSources.TOKEN_SOURCE_LOW_TOKEN_BALANCE,this.roomType);if((0,C.bT)("SendTipClicked",{amount:t,location:"PMTab"}),t>100&&!this.isHighTipAmountWarningActive)return this.sendTipButton.promptUser(U.R.tipConfirmationMessage(t)),this.isHighTipAmountWarningActive=!0,void this.repositionChildren();this.tipAmountInput.blur();let i=this.tipMessageTextarea.value;void 0!==this.tipOptionsSelect&&(i=""===this.tipMessageTextarea.value?this.tipOptionsSelect.value:`${this.tipOptionsSelect.value} | ${this.tipMessageTextarea.value}`),(0,k.ae)({roomName:this.roomName,tipAmount:this.tipAmountInput.value,message:i,source:this.tipSource,tipRoomType:this.roomType,tipType:this.sendTipButton.getTipType(),videoMode:_.L.getVideoMode()}).then((e=>{e.success?(0,C.bT)("SendTipSuccess",{amount:t,location:"PMTab"}):void 0!==e.error?!0===e.showPurchaseLink?(0,M.qr)(`${e.error}`,r.Bm.current.PurchaseEventSources.TOKEN_SOURCE_LOW_TOKEN_BALANCE,this.roomType):(0,c.Q$)(e.error):error("unknown send tip error"),this.removeHighTipAmountWarning(),this.tipMessageTextarea.value="",void 0!==e.tipsInPast24Hours&&k.ew.fire({tokens:e.tipsInPast24Hours,roomName:this.roomName}),this.tipSent.fire({amount:t,success:e.success})})).catch((e=>{error(`Error sending tip. status: ${e}`),(0,c.Q$)(U.R.errorSendingTip),this.tipSent.fire({amount:t,success:!1})})),this.hide()})),this.overlayClick.listen((()=>{this.hide()})),this.closed.listen((()=>{this.sendTipButton.hideMenu()})),(0,R.wu)("popstate",window,(()=>{this.hide()}))}showElement(){super.showElement(),this.isVisible=!0}repositionChildren(){this.tipMessageDiv.style.width=`${Math.max(0,this.element.clientWidth-2*k.xj)}px`;const e=(0,E.$R)(this.sendTipButtonSpan);if(this.bottomDivot.style.display="none",this.topDivot.style.display="none",this.leftDivot.style.display="none","fixed"===this.topSectionWrapper.style.position)this.leftDivot.style.display="block",this.element.style.top=e.top-30+"px",this.element.style.left=`${e.right+12}px`;else{const t=e.left-70;let i=Math.max(0,t+this.element.offsetWidth-(0,L.DK)()+4);t-i<0&&(i+=t-i),this.element.style.left=t-i+"px",(0,P.Xb)()||this.element.offsetHeight+e.bottom+20>(0,L.mJ)()+document.documentElement.scrollTop?(this.bottomDivot.style.display="block",this.bottomDivot.style.left=`${this.divotOffsetLeft+i}px`,this.element.style.top=e.top-this.element.offsetHeight-11+"px"):(this.topDivot.style.display="block",this.topDivot.style.left=`${this.divotOffsetLeft+i}px`,this.element.style.top=`${e.bottom+14}px`)}this.overlay.style.height=`${document.documentElement.offsetHeight}px`}tipAmountChange(){(0,M.Pt)(this.tipAmountInput),(0,M.sI)(this.tipAmountInput.value)?(this.sendTipButton.enable(),this.invalidTipAmountDiv.style.display="none",this.tokenBalance>0&&parseInt(this.tipAmountInput.value)>this.tokenBalance?this.isTokenAmountAlreadyTooHigh||((0,C.bT)("TokenAmountTooHigh"),this.isTokenAmountAlreadyTooHigh=!0):this.isTokenAmountAlreadyTooHigh=!1):(this.sendTipButton.disable(),this.invalidTipAmountDiv.style.display="inline-block"),this.isHighTipAmountWarningActive&&this.removeHighTipAmountWarning()}removeHighTipAmountWarning(){this.sendTipButton.cancelPrompt(),this.isHighTipAmountWarningActive=!1}tippingAllowed(){return this.isAgeVerified?!((0,m.rC)('You must be logged in to tip. Click "OK" to login.')||r.Bm.current.isNoninteractiveUser&&((0,c.Q$)(U.R.internalStaffTip),1)):((0,c.Q$)("This broadcaster doesn't accept tips."),!1)}show(e){this.tippingAllowed()&&(void 0!==e.amount&&(this.tipAmountInput.value=e.amount.toString(),this.tipAmountChange()),void 0!==e.message?this.tipMessageTextarea.value=e.message:this.tipMessageTextarea.value="",this.hasLowSatisfactionScore?this.lowScoreWarning.style.display="block":this.lowScoreWarning.style.display="none",void 0!==e.usedCtrlS&&e.usedCtrlS?this.ctrlSNotice.style.display="none":this.ctrlSNotice.style.display="block",(0,M.lc)(this.tipSource,this.sendTipButton),this.showElement(),this.showOverlay(),this.repositionChildren(),this.focusTipAmount(),this.tokenBalanceSpan.innerText=`${U.R.loadingTextLower}...`,(0,k.kb)(this.roomName).then((e=>{if(this.tipAmountInput.max=e.tokenBalance.toString(),void 0!==e.tipOptions){this.tipMessageLabel.innerText=e.tipOptions.label,void 0!==this.tipOptionsSelect&&this.tipMessageDiv.removeChild(this.tipOptionsSelect),this.tipOptionsSelect=document.createElement("select"),(0,A.fZ)(this.tipOptionsSelect,"tipOptionsSelect"),this.tipOptionsSelect.style.width="100%",this.tipOptionsSelect.style.fontSize=".8125em",this.tipOptionsSelect.style.margin=`${k.xj}px`,this.tipOptionsSelect.style.borderWidth="1px",this.tipOptionsSelect.style.borderStyle="solid",this.tipOptionsSelect.style.boxSizing="border-box",this.tipMessageDiv.insertBefore(this.tipOptionsSelect,this.tipMessageTextarea);let t=document.createElement("option");t.innerText=`-- ${U.R.selectOneLabel} --`,t.value="",this.tipOptionsSelect.appendChild(t);for(const i of e.tipOptions.options)t=document.createElement("option"),t.innerText=i.label,t.value=i.label,this.tipOptionsSelect.appendChild(t)}else void 0!==this.tipOptionsSelect&&(this.tipMessageLabel.innerText=U.R.defaultTipMessageLabel,this.tipMessageTextarea.value="",this.tipMessageDiv.removeChild(this.tipOptionsSelect),this.tipOptionsSelect=void 0)})).catch((e=>{error(`Error getting token balance. status: ${e}`),this.tokenBalanceSpan.innerText=U.R.unknownText})))}hide(){super.hide(),this.tipAmountInput.blur(),this.isVisible=!1,this.closed.fire(void 0)}setTipButtonSpan(e){this.sendTipButtonSpan=e}focusTipAmount(){document.activeElement!==this.tipAmountInput&&(this.tipAmountInput.focus(),this.tipAmountInput.setSelectionRange(0,9999))}updateTokenBalance(e){this.tokenBalance=e,this.tokenBalanceSpan.innerText=`${e} ${U.R.tokenOrTokensText(e,!1)}`}}var O=i(74),H=i(5389);const W=new y.c_("dossierLoaded",{listenersWarningThreshold:()=>10+y.hI});class $ extends f.u{constructor(e,t){super(),this.audioHolder=new p.T,this.lastLoadRoomId=0,this.listenerGroup=new y.gt,this.loadedRoom={room:"",roomTitle:""}}handleHistory(e){}handleRoomStatusOffline(e){}handleSetWidescreen(e){}handlePlaySound(e){}handleRoomInitiallyOffline(){}handleRoomInitiallyOnline(){}handleRoomStatusPasswordProtected(e){var t;null===(t=this.cleanupLastRoomCallback)||void 0===t||t.call(this),a.U.forceUpdateAuthorization(),this.resetLoadedRoom()}handleUpdateChatSettings(e,t){e.updateEnterLeaveSettings(t.roomEntryFor,t.roomLeaveFor)}handleRoomAccessDenied(e,t){(0,c.Q$)(`Access Denied for room: ${e}\n\n${t.getString("detail")}`)}handleRoomUnauthorized(e){null!==window.top&&(window.top.location.href=(0,u._Y)(`/auth/login/?next=${window.location.pathname}${window.location.search}`))}handleRoomPasswordRequired(e){}handleRoomDossierErrorDefault(e,t){error(e,t)}handleRoomLoaded(e){}handleRoomStatusChangeNotification(e){}handleResize(){}setupAudio(){O.EZ.listen((e=>{this.tipVolume=e.tipVolume}))}setupTipCallout(e,t,i){this.tipCallout=this.addChild(new N(e,t,i)),O.i5.listen((e=>{this.tipCallout.isVisible?this.tipCallout.hide():this.tipCallout.show(e)})),this.tipCallout.tipSent.listen((()=>{this.tipCallout.hide()}))}setupLoginOverlay(){O.pL.listen((e=>{(0,h.DC)({fromFeature:e})})),(0,m.n)((()=>{O.pL.fire(!0)}))}setupResizeHandlers(){d.oO.listen((()=>{this.repositionChildrenRecursive(),this.handleResize()})),window.onorientationchange=()=>{(0,b.Eh)(),this.repositionChildrenRecursive()}}setupLoadRoom(e){this.loadRoom(e,!0),w.VZ.listen((e=>{(0,H.Iw)()>172800?window.location.pathname=`/${e}/`:this.loadRoom(e,!0)})),v.X0.listen((e=>{this.handleRoomLoaded(e)}))}createChatConnection(e){this.chatConnection=new g.Z(e,!0);const t=new l.bq(e.roomUid),i=t.onAuthFail.once((()=>{(0,o.m)(e.room).then((t=>{const i=new n.N6(t.responseText);this.handleRoomAccessCode(e.room,i)||((0,c.Q$)(U.R.roomLoadError),error("Error loading room",{error:t.responseText}))})).catch(S.yZ)}));i.addTo(this.listenerGroup),t.onSubscribeChange.once((()=>{i.removeListener()})).addTo(this.listenerGroup)}loadRoom(e,t){if(this.isRoomLoaded(e))return;this.loadedRoom={room:e,roomTitle:""},this.lastLoadRoomId+=1;const i=this.lastLoadRoomId;this.getRoomDossierPromise(e).then((e=>{i===this.lastLoadRoomId&&this.onRoomDossierLoad(e,t)})).catch((t=>{this.onRoomDossierError(t,e)}))}getRoomDossierPromise(e){return(0,x.Bc)(e)}onRoomDossierLoad(e,t){void 0!==this.cleanupLastRoomCallback&&this.cleanupLastRoomCallback(),(0,C.RN)(e.room),this.loadedRoom.roomTitle=e.roomTitle,r.Aw.setState(e),W.fire(e),this.createChatConnection(e),this.tipVolume=e.userChatSettings.tipVolume,this.audioHolder.loadTipSounds(),this.chatConnection.event.playSound.listen((e=>{this.handlePlaySound(e)})),this.handleSetWidescreen(e.isWidescreen);const i={dossier:e,chatConnection:this.chatConnection};let n,o;this.player.playerComponent.handleRoomLoaded(i),this.cleanupLastRoomCallback=()=>{clearInterval(n),window.clearTimeout(o),this.chatConnection.disconnect(),this.player.playerComponent.stop(),this.listenerGroup.removeAll(),v.Gr.fire(void 0),this.cleanupLastRoomCallback=void 0},t&&!(0,s.isRoomRoomlistSpaActive)()&&this.handleHistory(e),this.isRoomInitiallyOffline(i.dossier)?this.handleRoomInitiallyOffline():this.handleRoomInitiallyOnline(),v.X0.fire(i),this.listenerGroup.add(this.chatConnection.event.statusChange.listen((e=>{const t=["privatewatching","privatespying"],i=t.includes(e.currentStatus),s=t.includes(e.previousStatus);switch(("notconnected"===e.previousStatus||i||s)&&(clearInterval(n),n=window.setInterval((()=>{this.chatConnection.updateRoomCount(i)}),1e3*(i?5:90)),o=window.setTimeout((()=>{this.chatConnection.updateRoomCount(i||s)}),2e3)),e.currentStatus){case"passwordprotected":this.handleRoomStatusPasswordProtected(this.chatConnection);break;case"offline":this.handleRoomStatusOffline(this.chatConnection)}this.handleRoomStatusChangeNotification(e)}))),this.listenerGroup.add(O.EZ.listen((e=>{this.handleUpdateChatSettings(this.chatConnection,e)}))),this.repositionChildrenRecursive()}isRoomInitiallyOffline(e){return"offline"===e.roomStatus}onRoomDossierError(e,t){if(e instanceof u.fr&&""!==e.xhr.responseText){if("application/json"!==e.xhr.getResponseHeader("Content-Type"))return void this.handleRoomDossierErrorDefault("Error reading room dossier error",{room:t,error:e.xhr.responseText});const i=new n.N6(e.xhr.responseText);this.handleRoomAccessCode(t,i)||this.handleRoomDossierErrorDefault("Error parsing room dossier error",{room:t,error:e.xhr.responseText})}else this.handleRoomDossierErrorDefault("Error occurred while processing room dossier",{room:t,error:e})}handleRoomAccessCode(e,t){switch(t.getStringOrUndefined("code",!1)){case o.N.AccessDenied:return this.handleRoomAccessDenied(e,t),!0;case o.N.Unauthorized:return this.handleRoomUnauthorized(e),!0;case o.N.PasswordProtected:return this.handleRoomPasswordRequired(e),!0;case o.N.Ok:return!0}return!1}isRoomLoaded(e){const t=e===this.loadedRoom.room,i=!this.chatConnection||this.chatConnection.room()===e;return t&&i}setupPrivateShowRequestOverlay(){this.privateShowRequestModal=this.addChild(new T.nE),O.Ne.listen((e=>{"split"===_.L.getVideoMode()&&(void 0===e?this.privateShowRequestModal.showPending(this.chatConnection):this.privateShowRequestModal.show(e))})).addTo(this.listenerGroup),O.ef.listen((()=>{this.privateShowRequestModal.hide()})).addTo(this.listenerGroup)}resetLoadedRoom(){this.loadedRoom={room:"",roomTitle:""}}}},1516:(e,t,i)=>{"use strict";i.d(t,{m:()=>D,s:()=>L});var s=i(7623),n=i(8861),o=i(9447),r=i(9937),a=i(1224),l=i(9603),h=i(6784),d=i(213),c=i(5216),u=i(6844),p=i(7347),m=i(2939),g=i(2709),v=i(5020),f=i(3955),y=i(8423),b=i(9060),w=i(9586),C=i(7407),S=i(5424),x=i(3320),T=i(4660),P=i(3417),k=i(2690),A=i(4947);class M extends k.zf{constructor(){super(),m.X0.listen((e=>this.chatConnection=e.chatConnection)),this.element.id="RemoveIgnoredUsersModal",this.element.style.position="fixed",this.element.style.width="450px",this.element.style.height="",this.element.style.borderRadius="6px",this.element.style.padding="10px",this.element.style.fontSize="12px",this.element.style.left="50%",this.element.style.top="50%",this.element.style.transform="translate(-50%, -50%)",(0,o.fZ)(this.overlay,"overlay"),this.overlay.style.background="",this.overlay.style.opacity="0.4";const e=this.createCloseButton(`${STATIC_URL}close.svg`);(0,o.fZ)(e,"lightCloseButton"),e.style.opacity="0.5",this.element.appendChild(e);const t=this.createCloseButton(`${STATIC_URL}close-gray.svg`);(0,o.fZ)(t,"darkCloseButton"),this.element.appendChild(t);const i=document.createElement("div");(0,o.fZ)(i,"header"),i.innerText=A.R.removeIgnoredUsers,i.style.fontSize="15px",i.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",i.style.textAlign="center",this.element.appendChild(i),this.helpText=document.createElement("div"),(0,o.fZ)(this.helpText,o.aG.textColor),this.helpText.innerText="",this.helpText.style.margin="10px 0",this.helpText.style.textAlign="center",this.element.appendChild(this.helpText),this.element.appendChild(this.createIgnoreWrapper()),this.element.appendChild(this.createUnignoreWrapper());const s=document.createElement("div");s.style.textAlign="right";const n=document.createElement("span");(0,o.fZ)(n,"saveButton"),n.innerText=A.R.saveCAPS,n.style.display="inline-block",(0,o.fZ)(n,"gradient"),n.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",n.style.fontSize="14px",n.style.padding="5px 15px 5px 15px",n.style.marginTop="10px",n.style.borderRadius="4px",n.style.cursor="pointer",n.onclick=()=>{this.saveButtonHandler()},s.appendChild(n),this.element.appendChild(s),this.overlayClick.listen((()=>{this.hide()}))}createSelectLabel(e){const t=document.createElement("div");return(0,o.fZ)(t,"bluetxt"),t.textContent=e,t.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",t.style.fontWeight="bold",t}createMultipleSelect(){const e=document.createElement("select");return(0,o.fZ)(e,"select"),e.multiple=!0,e}createCloseButton(e){const t=document.createElement("img");return t.src=e,t.style.position="absolute",t.style.width="14px",t.style.height="14px",t.style.top="10px",t.style.right="10px",t.style.cursor="pointer",t.onclick=()=>{this.hide()},t.onmouseenter=()=>{t.style.opacity="1"},t.onmouseleave=()=>{t.style.opacity="0.5"},t}}class R extends M{constructor(){super(),this.helpText.innerText=A.R.clickToUnignoreText}initData(){this.marginBetweenIgnoreUnignorePx=10}initAndShow(){for(;null!==this.ignoredUsersSelect.firstChild;)this.ignoredUsersSelect.removeChild(this.ignoredUsersSelect.firstChild);for(;null!==this.unignoredUsersSelect.firstChild;)this.unignoredUsersSelect.removeChild(this.unignoredUsersSelect.firstChild);const e=(0,P.V6)(!0);for(const t of e){const e=document.createElement("option");e.innerText=t,e.value=t,this.ignoredUsersSelect.appendChild(e)}super.show()}createIgnoreWrapper(){const e=document.createElement("div");e.style.display="inline-block",e.style.marginRight=`${this.marginBetweenIgnoreUnignorePx}px`,e.style.width=`calc(50% - ${this.marginBetweenIgnoreUnignorePx/2}px)`;const t=this.createSelectLabel(A.R.ignoredUsers);return e.appendChild(t),this.ignoredUsersSelect=this.createMultipleSelect(),this.ignoredUsersSelect.style.borderWidth="1px",this.ignoredUsersSelect.style.borderStyle="solid",this.ignoredUsersSelect.style.borderRadius="4px",this.ignoredUsersSelect.style.marginTop="4px",this.ignoredUsersSelect.style.width="100%",this.ignoredUsersSelect.style.height="200px",this.ignoredUsersSelect.style.padding="2px",this.ignoredUsersSelect.style.overflow="auto",this.ignoredUsersSelect.onchange=()=>{const e=this.ignoredUsersSelect.selectedOptions.length,t=[...this.ignoredUsersSelect.selectedOptions];for(let i=0;i<e;i+=1){const e=t[i];e.selected=!1,this.unignoredUsersSelect.appendChild(e)}},e.appendChild(this.ignoredUsersSelect),e}createUnignoreWrapper(){const e=document.createElement("div");e.style.display="inline-block",e.style.width=`calc(50% - ${this.marginBetweenIgnoreUnignorePx/2}px)`;const t=this.createSelectLabel(A.R.unignoredUsers);return e.appendChild(t),this.unignoredUsersSelect=this.createMultipleSelect(),this.unignoredUsersSelect.style.borderWidth="1px",this.unignoredUsersSelect.style.borderStyle="solid",this.unignoredUsersSelect.style.borderRadius="4px",this.unignoredUsersSelect.style.marginTop="4px",this.unignoredUsersSelect.style.width="100%",this.unignoredUsersSelect.style.height="200px",this.unignoredUsersSelect.style.padding="2px",this.unignoredUsersSelect.style.overflow="auto",this.unignoredUsersSelect.onchange=()=>{const e=this.unignoredUsersSelect.selectedOptions.length,t=[...this.unignoredUsersSelect.selectedOptions];for(let i=0;i<e;i+=1){const e=t[i];e.selected=!1,this.ignoredUsersSelect.appendChild(e)}},e.appendChild(this.unignoredUsersSelect),e}saveButtonHandler(){for(const e of this.unignoredUsersSelect.options)this.chatConnection.unignore(e.value);this.hide()}}class I extends M{constructor(){super(),this.element.style.width="400px",this.helpText.innerText=A.R.clickToUnignoreMobileText}initAndShow(){for(;null!==this.unignoredUsersSelect.firstChild;)this.unignoredUsersSelect.removeChild(this.unignoredUsersSelect.firstChild);const e=(0,P.V6)(!0);for(const t of e){const e=document.createElement("option");e.innerText=t,e.value=t,this.unignoredUsersSelect.appendChild(e)}super.show()}createIgnoreWrapper(){return document.createElement("div")}createUnignoreWrapper(){const e=document.createElement("div");e.style.display="inline-block";const t=this.createSelectLabel(A.R.unignoredUsers);return e.appendChild(t),this.unignoredUsersSelect=this.createMultipleSelect(),this.unignoredUsersSelect.style.width="200px",(0,s.H9)()&&(this.unignoredUsersSelect.style.height="200px"),e.appendChild(this.unignoredUsersSelect),e}saveButtonHandler(){for(const e of this.unignoredUsersSelect.selectedOptions)this.chatConnection.unignore(e.value);this.hide()}}var E=i(74);const L=new y.c_("getChatMode");class D extends g.u{constructor(){super(...arguments),this.chatSettingsSavedRequest=new y.c_("chatSettingsSavedRequest")}initData(){this.isModerator=!1,this.isSupporter=!1,this.notificationsSettings=document.createElement("div"),this.notificationsSettings.dataset.testid="notifications-settings",this.otherSettings=document.createElement("div"),this.otherSettings.dataset.testid="other-settings",this.form=document.createElement("form"),this.usersSettings=document.createElement("div"),this.usersSettings.dataset.testid="users-settings",this.chatColorInput=document.createElement("input"),this.chatColorInput.dataset.testid="chat-color-input",this.chatColorSwatch=document.createElement("span"),this.chatColorSwatch.dataset.testid="chat-color-swatch",this.fontFamilySelect=document.createElement("select"),this.fontFamilySelect.dataset.testid="font-family-select",this.fontSizeSelect=document.createElement("select"),this.fontSizeSelect.dataset.testid="font-size-select",this.emoticonAutocompleteDelaySelect=document.createElement("select"),this.emoticonAutocompleteDelaySelect.dataset.testid="emoticon-autocomplete-delay-select",this.showEmoticonsCheckbox=new r.l(!1,(()=>this.saveSettings())),this.showEmoticonsCheckbox.element.dataset.testid="show-emoticons-checkbox",this.highestTokenColorSelect=document.createElement("select"),this.highestTokenColorSelect.dataset.testid="highest-token-color-select",this.notifyEntryForSelect=document.createElement("select"),this.notifyEntryForSelect.dataset.testid="notify-entry-for-select",this.notifyLeaveForSelect=document.createElement("select"),this.notifyLeaveForSelect.dataset.testid="notify-leave-for-select",this.tipVolumeValueLabel=document.createElement("label"),this.tipVolumeValueLabel.dataset.testid="tip-volume-value-label",this.tipVolumeSlider=new x.A({handleDiameter:16,handleColor:"rgb(246, 115, 0)",emptyBarColor:"#cccccc",filledBarColor:"rgb(246, 115, 0)"}),this.tipVolumeSlider.element.dataset.testid="tip-volume-slider",this.collapseNoticesCheckbox=new r.l(!1,(()=>this.saveSettings())),this.collapseNoticesCheckbox.element.dataset.testid="collapse-notices-checkbox",this.manageIgnoredUsersLink=document.createElement("label"),this.manageIgnoredUsersLink.dataset.testid="manage-ignored-users-link"}initUI(){this.element.style.width="100%",this.element.style.overflow="auto",this.element.style.boxSizing="border-box",this.element.style.padding="11px",this.element.style.fontSize="12px",this.element.style.position="static",this.form.style.marginBottom="40px",this.form.style.maxWidth="400px",this.element.appendChild(this.form);const e=document.createElement("div");e.dataset.testid="font-settings";const t=document.createElement("div");t.dataset.testid="emoticons-settings",this.form.appendChild(e),this.form.appendChild(t),this.form.appendChild(this.usersSettings),this.form.appendChild(this.notificationsSettings),this.form.appendChild(this.otherSettings),this.getStyles().styleContainer(e),this.getStyles().styleContainer(t),this.getStyles().styleContainer(this.usersSettings),this.getStyles().styleContainer(this.notificationsSettings),this.getStyles().styleContainer(this.otherSettings);const i=this.createHeader(A.R.fontSettings);i.style.marginTop="0",e.appendChild(i),e.appendChild(this.createColorPicker()),e.appendChild(this.createFontFamilyPicker()),e.appendChild(this.createFontSizePicker()),t.appendChild(this.createHeader(A.R.emoticonsSettings)),t.appendChild(this.createShowEmoticonsPicker()),t.appendChild(this.createEmoticonAutocompleteDelayPicker()),this.usersSettings.appendChild(this.createHeader(A.R.usersSettings)),this.createUserSettings(),this.createNotificationSettings(),this.otherSettings.appendChild(this.createHeader(A.R.otherSettings)),this.createOtherSettings(),(0,w.H)(this.element),E.EZ.listen((e=>{this.updateChatSettings(e)})),m.X0.listen((e=>{this.handleRoomLoaded(e),e.chatConnection.event.modStatusChange.listen((e=>{this.isModerator=e,this.updateNotificationsSettingsVisibility()}))}))}hideModals(){void 0!==this.colorPickerModal&&this.colorPickerModal.hide(),void 0!==this.removeIgnoredUserUI&&this.removeIgnoredUserUI.hide()}updateChatColor(e){this.chatColorInput.value=e;const t=""!==e?e:"#000000";this.chatColorSwatch.style.color=t,this.chatColorSwatch.style.backgroundColor=t}openColorSwatch(e){if(!this.isBroadcaster()){if((0,u.rC)(A.R.mustBeLoggedInForChatColor))return void e.preventDefault();if(!this.isSupporter)return(0,d.Q$)(A.R.mustBeSupporterForChatColor),void e.preventDefault()}void 0===this.colorPickerModal&&(this.colorPickerModal=this.addChild(this.createColorPickerModal())),this.colorPickerModal.show(""!==this.chatColorInput.value?this.chatColorInput.value:"#000000")}onColorPicked(e){this.updateChatColor(e),this.saveSettings()}onColorHovered(e){this.updateChatColor(e)}createColorPickerModal(){return new T.J(this.chatColorSwatch,(e=>this.onColorPicked(e)),(e=>this.onColorHovered(e)))}createLabelWithTooltip(e,t){const i=document.createElement("span");(0,o.fZ)(i,"tooltip-info-icon");const s=(0,l.q)({content:t,hasHTML:!1,divotPosition:v.Wi.Bottom});s.style.position="fixed",s.style.display="block";const n=document.createElement("div");return n.style.display="inline-block",n.appendChild(e),n.appendChild(i),(0,f.JR)(i,{handleTouch:!0}).listen((e=>{var t;e?n.appendChild(s):null===(t=s.parentElement)||void 0===t||t.removeChild(s);const o=i.getBoundingClientRect(),r=(0,f.Mx)();s.style.top=-r.top+o.top-s.offsetHeight-o.height/5-5+"px",s.style.left=`${-r.left+o.left+(o.width-22)}px`})),n}createRow(e,t,i,s,n){const o=document.createElement("div");if(this.getStyles().styleRowWrapper(o),void 0!==n?o.appendChild(this.createLabelWithTooltip(e,n)):o.appendChild(e),o.appendChild(i),void 0!==s&&i instanceof HTMLSelectElement)for(const e of s){const t=document.createElement("option");t.innerText=e.label.toString(),t.value=e.value.toString(),i.appendChild(t)}return this.getStyles().styleLabel(e,t),this.getStyles().styleInput(i),o.onclick=e=>{(0,u.rC)(A.R.mustBeLoggedInForChatSettings)?e.preventDefault():e.target!==i&&i.focus()},i.onmousedown=e=>{(0,u.rC)(A.R.mustBeLoggedInForChatSettings)&&e.preventDefault()},(0,h.wu)("change",i,(e=>{this.saveSettings()})),o}createColorPicker(){const e=document.createElement("label"),t=this.createRow(e,A.R.chatColor,this.chatColorSwatch);return t.dataset.testid="chat-settings-color-picker",t.appendChild(this.chatColorInput),this.styleWrapperCustom(t),this.styleLabelCustom(e),this.styleColorSwatch(this.chatColorSwatch),this.chatColorSwatch.onmousedown=e=>this.openColorSwatch(e),t.onclick=e=>this.openColorSwatch(e),this.chatColorInput.type="hidden",t}createFontFamilyPicker(){const e=document.createElement("label"),t=this.createRow(e,A.R.font,this.fontFamilySelect,this.getFontOptions());t.dataset.testid="chat-settings-font-family-picker";const i=e=>{if(!this.isBroadcaster()){if((0,u.rC)(A.R.mustBeLoggedInForFontFamily))return void e.preventDefault();if(!this.isSupporter)return e.preventDefault(),this.fontFamilySelect.blur(),void(0,d.Q$)(A.R.mustBeSupporterForFontFamily)}};return this.fontFamilySelect.onmousedown=e=>i(e),(0,h.wu)("click",t,(e=>{i(e)})),t}createFontSizePicker(){const e=[];for(let t=9;t<=20;t+=1)e.push({label:`${t}pt`,value:`${t}pt`});const t=document.createElement("label");return this.createRow(t,A.R.fontSize,this.fontSizeSelect,e)}createShowEmoticonsPicker(){const e=document.createElement("label"),t=this.createRow(e,A.R.showEmoticons,this.showEmoticonsCheckbox.element);return this.styleWrapperCustom(t),this.styleLabelCustom(e),this.styleCheckbox(this.showEmoticonsCheckbox.element),(0,h.wu)("click",t,(e=>{e.preventDefault(),e.stopPropagation(),this.showEmoticonsCheckbox.focus(),this.showEmoticonsCheckbox.setChecked(!this.showEmoticonsCheckbox.isChecked())}),!0),t}createEmoticonAutocompleteDelayPicker(){const e=document.createElement("label");return this.createRow(e,A.R.emoticonAutoCompleteDelay,this.emoticonAutocompleteDelaySelect,this.getEmoticonAutocompleteDelayOptions())}createHighestTokenColorPicker(){const e=document.createElement("label");return this.createRow(e,A.R.highestTokenColor,this.highestTokenColorSelect,this.getHighestTokenColorOptions(),A.R.highestTokenColorTooltip)}createNotifyEntryPicker(){const e=document.createElement("label");return this.createRow(e,A.R.notifyEntryFor,this.notifyEntryForSelect,this.getNotifyEntryLeaveOptions())}createNotifyLeavePicker(){const e=document.createElement("label");return this.createRow(e,A.R.notifyLeaveFor,this.notifyLeaveForSelect,this.getNotifyEntryLeaveOptions())}createTipVolumePicker(){let e="";L.listen((t=>{e=t}));const t=this.createRow(this.tipVolumeValueLabel,A.R.tipVolume,this.tipVolumeSlider.element);return this.styleSlider(this.tipVolumeSlider),this.handleSliderMove(this.tipVolumeSlider.getValue()),this.tipVolumeSlider.valueChangeStart.listen((e=>{this.handleSliderMove(e)})),this.tipVolumeSlider.valueChanged.listen((e=>this.handleSliderMove(e))),this.tipVolumeSlider.valueChangeEnd.listen((t=>{this.handleSliderMove(t),(0,C.bT)("TipVolumeChanged",{tipvol:t,chatmode:e}),this.saveSettingsOrCookie()})),t.onclick=()=>{},this.tipVolumeSlider.element.onmousedown=()=>{},t}handleSliderMove(e){this.tipVolumeValueLabel.innerText=`${A.R.tipVolume} (${Math.round(e)}%)`}createCollapseNoticesPicker(){const e=document.createElement("label"),t=this.createRow(e,A.R.collapseNotices,this.collapseNoticesCheckbox.element);return this.styleWrapperCustom(t),this.styleLabelCustom(e),this.styleCheckbox(this.collapseNoticesCheckbox.element),(0,h.wu)("click",t,(e=>{e.preventDefault(),e.stopPropagation(),this.collapseNoticesCheckbox.focus(),this.collapseNoticesCheckbox.setChecked(!this.collapseNoticesCheckbox.isChecked())}),!0),this.collapseNoticesCheckbox.setOnChange((()=>{(0,C.bT)("CollapseNoticesToggled",{state:this.collapseNoticesCheckbox.isChecked()?"on":"off"}),this.saveSettings()})),t}createManageIgnoredUsersPicker(){const e=this.createSettingsLink(this.manageIgnoredUsersLink,A.R.viewEditIgnoredUsers);return e.appendChild(this.manageIgnoredUsersLink),this.manageIgnoredUsersLink.onclick=()=>{(0,u.rC)(A.R.mustBeLoggedInForIgnoredUsers)||(void 0===this.removeIgnoredUserUI&&this.createManageIgnoredUsersUI(),void 0!==this.removeIgnoredUserUI&&this.removeIgnoredUserUI.initAndShow())},e}createSettingsLink(e,t){const i=document.createElement("div");return this.getStyles().styleRowWrapper(i),(0,o.fZ)(e,"link"),e.innerText=t,e.style.marginTop="16px",e.style.cursor="pointer",e.onmouseenter=()=>{e.style.textDecoration="underline"},e.onmouseleave=()=>{e.style.textDecoration="none"},i}createManageIgnoredUsersUI(){void 0===this.removeIgnoredUserUI&&(this.removeIgnoredUserUI=(0,s.Xb)()?new I:new R)}createHeader(e){const t=document.createElement("div");return this.getStyles().styleHeader(t,e),t}saveSettingsOrCookie(){const e=Math.round(this.tipVolumeSlider.getValue());(0,u.ok)()?((0,n.uC)("tipvol",`${e}`,{days:60},"/",(0,b.DV)()),this.userChatSettings.tipVolume=e,E.EZ.fire(this.userChatSettings)):this.saveSettings()}saveSettings(){(0,u.rC)(A.R.mustBeLoggedInForChatSettings)?E.EZ.fire(this.userChatSettings):(this.chatColorInput.value!==this.userChatSettings.fontColor&&(this.isBroadcaster()||this.isSupporter)&&(0,c.KF)(this.getSaveColorEndpoint(),{color:this.chatColorInput.value}).catch((e=>{this.chatColorInput.value=this.userChatSettings.fontColor,error("Error saving user chat color",e)})),(0,c.KF)(this.getSaveEndpoint(),this.getFormData()).then((e=>{this.chatSettingsSavedRequest.fire(void 0),this.setUserChatSettings(),E.EZ.fire(this.userChatSettings)})).catch((e=>{error("Error saving user chat settings",e)})))}setUserChatSettings(){this.hasModeratorPrivileges()&&(this.userChatSettings.roomEntryFor=(0,S.OC)(this.notifyEntryForSelect.value),this.userChatSettings.roomLeaveFor=(0,S.OC)(this.notifyLeaveForSelect.value)),this.userChatSettings.fontColor=this.chatColorInput.value,this.userChatSettings.fontFamily=decodeURIComponent(this.fontFamilySelect.value),this.userChatSettings.fontSize=this.fontSizeSelect.value,this.userChatSettings.showEmoticons=this.showEmoticonsCheckbox.isChecked(),this.userChatSettings.emoticonAutocompleteDelay=parseInt(this.emoticonAutocompleteDelaySelect.value),this.userChatSettings.highestTokenColor=this.highestTokenColorSelect.value,this.userChatSettings.tipVolume=Math.round(this.tipVolumeSlider.getValue()),this.userChatSettings.collapseNotices=this.collapseNoticesCheckbox.isChecked()}getFormData(){const e={color:this.chatColorInput.value,font_family:decodeURIComponent(this.fontFamilySelect.value),font_size:this.fontSizeSelect.value,show_emoticons:`${this.showEmoticonsCheckbox.isChecked()}`,emoticon_autocomplete_delay:this.emoticonAutocompleteDelaySelect.value,highest_token_color:this.highestTokenColorSelect.value,tip_volume:`${Math.round(this.tipVolumeSlider.getValue())}`,collapse_notices:`${this.collapseNoticesCheckbox.isChecked()}`};return this.hasModeratorPrivileges()&&(e.enter_notify=this.notifyEntryForSelect.value,e.leave_notify=this.notifyLeaveForSelect.value),e}getSaveColorEndpoint(){return"choose_viewer_chat_color/"}getSaveEndpoint(){return`api/viewerchatsettings/${this.roomName}/`}hasModeratorPrivileges(){return this.isModerator}styleWrapperCustom(e){}styleLabelCustom(e){}styleColorSwatch(e){(0,o.fZ)(this.chatColorSwatch,"colorSwatch"),this.chatColorSwatch.style.width="20px",this.chatColorSwatch.style.height="20px",this.chatColorSwatch.style.border=`1px solid ${a.m.defaultColor}`,this.chatColorSwatch.style.cursor="pointer",this.chatColorSwatch.style.verticalAlign="middle"}styleCheckbox(e){e.style.display="block",e.style.marginBottom="10px"}styleSlider(e){this.tipVolumeSlider.element.style.display="inline-block",this.tipVolumeSlider.element.style.border="none",this.tipVolumeSlider.element.style.verticalAlign="top",this.tipVolumeSlider.element.style.height="16px",this.tipVolumeSlider.element.style.width="100%"}repositionChildren(){this.tipVolumeSlider.handleResize()}getTipVolumeSlider(){return this.tipVolumeSlider}getStyles(){return p.U}createUserSettings(){this.usersSettings.appendChild(this.createHighestTokenColorPicker())}createNotificationSettings(){this.notificationsSettings.appendChild(this.createHeader(A.R.notificationsSettings)),this.notificationsSettings.appendChild(this.createNotifyEntryPicker()),this.notificationsSettings.appendChild(this.createNotifyLeavePicker())}createOtherSettings(){this.otherSettings.appendChild(this.createTipVolumePicker()),this.otherSettings.appendChild(this.createCollapseNoticesPicker()),this.otherSettings.appendChild(this.createManageIgnoredUsersPicker())}updateChatSettings(e){this.userChatSettings=e,this.updateChatColor(this.userChatSettings.fontColor),this.fontFamilySelect.value=this.userChatSettings.fontFamily,this.fontSizeSelect.value=this.userChatSettings.fontSize,this.showEmoticonsCheckbox.setCheckedDirectly(this.userChatSettings.showEmoticons),this.emoticonAutocompleteDelaySelect.value=this.userChatSettings.emoticonAutocompleteDelay.toString(),this.highestTokenColorSelect.value=this.userChatSettings.highestTokenColor,this.notifyEntryForSelect.value=B(this.userChatSettings.roomEntryFor),this.notifyLeaveForSelect.value=B(this.userChatSettings.roomLeaveFor),this.tipVolumeSlider.setValue(this.userChatSettings.tipVolume),this.handleSliderMove(this.userChatSettings.tipVolume),(0,C.U4)(this.userChatSettings.tipVolume),this.collapseNoticesCheckbox.setCheckedDirectly(this.userChatSettings.collapseNotices)}isBroadcaster(){return!1}handleRoomLoaded(e){this.updateChatSettings(e.dossier.userChatSettings),this.roomName=e.dossier.room,this.isModerator=e.dossier.isModerator,this.isSupporter=e.dossier.isSupporter,this.updateNotificationsSettingsVisibility()}updateNotificationsSettingsVisibility(){this.hasModeratorPrivileges()?this.notificationsSettings.style.display="block":this.notificationsSettings.style.display="none"}getFontOptions(){return[{label:"Default",value:"default"},{label:"Arial",value:"Arial, Helvetica"},{label:"Bookman Old Style",value:"Bookman Old Style"},{label:"Comic Sans",value:'"Comic Sans MS", cursive'},{label:"Courier",value:'"Courier New"'},{label:"Lucida",value:"Lucida"},{label:"Palantino",value:"Palantino"},{label:"Tahoma",value:"Tahoma, Geneva"},{label:"Times New Roman",value:'"Times New Roman"'}]}getEmoticonAutocompleteDelayOptions(){return[{label:A.R.emoticonAutocompleteDelayOff,value:"-1"},{label:A.R.emoticonAutocompleteNoDelay(),value:"0"},{label:A.R.emoticonAutocompleteShortDelay(),value:"500"},{label:A.R.emoticonAutocompleteMediumDelay(),value:"1000"},{label:A.R.emoticonAutocompleteLongDelay(),value:"1500"}]}getHighestTokenColorOptions(){return[{label:A.R.highestTokenColorDarkPurple(),value:"darkpurple"},{label:A.R.highestTokenColorLightPurple(),value:"lightpurple"},{label:A.R.highestTokenColorDarkBlue(),value:"darkblue"},{label:A.R.highestTokenColorLightBlue(),value:"lightblue"}]}getNotifyEntryLeaveOptions(){return[{label:A.R.notifyEntryLeaveAllUsers,value:"orga"},{label:A.R.notifyEntryLeaveModsFansUsersTokens,value:"orgb"},{label:A.R.notifyEntryLeaveModsFans,value:"org"},{label:A.R.notifyEntryLeaveNoUsers,value:"none"}]}}function B(e){switch(e){case S.XL.AllUsers:return"orga";case S.XL.ModsFansAndTokens:return"orgb";case S.XL.ModsAndFans:return"org";case S.XL.None:return"none";default:return error(`Invalid enter/leave setting: ${e}`),"orgb"}}},7347:(e,t,i)=>{"use strict";i.d(t,{U:()=>o});var s=i(9447),n=i(3955);class o{static styleContainer(e){}static styleHeader(e,t){e.innerText=t,(0,n.ZM)(e,{fontWeight:"bold",fontSize:"12px",margin:"14px 0 8px",backgroundColor:""})}static styleRowWrapper(e){(0,n.ZM)(e,{margin:"4px 0 7px 4px"})}static styleLabel(e,t){e.innerText=t,(0,n.ZM)(e,{fontSize:"12px",display:"inline-block",marginBottom:"5px"})}static styleInput(e){(0,s.fZ)(e,"chat-settings-input"),(0,n.ZM)(e,{display:"block",fontSize:"12px",marginTop:"0",borderWidth:"1px",borderStyle:"solid"}),e instanceof HTMLSelectElement&&((0,s.fZ)(e,"chat-settings-select"),(0,n.ZM)(e,{height:"24px",width:"100%"}))}}},3333:(e,t,i)=>{"use strict";i.d(t,{NX:()=>l,eF:()=>a,uJ:()=>r});var s=i(6784),n=i(8423),o=i(7407);const r="dismissibleSettingsLink",a=new n.c_("goToSettingsTab");function l(e){(0,s.wu)("click",e,(e=>{e.preventDefault(),(0,o.bT)("DismissibleSettingsLinkClicked"),a.fire()}))}},3502:(e,t,i)=>{"use strict";i.d(t,{d:()=>a});var s=i(8598),n=i(213),o=i(4947),r=i(1372);function a(e,t,i,a,l){const h=(0,r.tT)("div",{className:`undo-ban-options-${t.silenced}`,style:{boxSizing:"border-box",padding:"2px 5px 3px 25px",fontWeight:"bold"}}),d=(0,r.tT)("a",{href:"#",className:"msg-link",onClick:function(e){null==e||e.preventDefault(),u(),(0,s.$)(i,t.isBan?"remove_ban":"remove_silence",a.dossier.room,(()=>{l(t.isBan?o.R.banRemovedMessage:o.R.silenceRemovedMessage)}),(()=>{l(t.isBan?o.R.banRemoveErrorMessage:o.R.silenceRemoveErrorMessage)}))}},o.R.inlineUndoText),c=(0,r.tT)("a",{href:"#",style:{color:"inherit"},onClick:u},"(",o.R.dismissLower,")");function u(i){var s;null==i||i.preventDefault(),null===(s=h.parentElement)||void 0===s||s.removeChild(h);const n=e.element.getElementsByClassName(`undo-ban-options-${t.silenced}`);Array.from(n).forEach((e=>{var t;null===(t=e.parentElement)||void 0===t||t.removeChild(e)}))}if(h.appendChild(d),d.dataset.testid="undo-button",c.dataset.testid="dismiss-button",!t.isBan&&a.dossier.userName===a.dossier.room){function p(e){null==e||e.preventDefault(),(0,n.mf)(o.R.banUserConfirm(t.silenced),(()=>{u(),(0,s.$)(i,"convert_to_ban",a.dossier.room,(()=>{}),(()=>{l(o.R.banConvertErrorMessage)}))}))}const m=(0,r.tT)("a",{href:"#",style:{color:"red"},onClick:p},o.R.inlineBanText);m.dataset.testid="ban-button",h.appendChild(document.createTextNode(" ".repeat(5))),h.appendChild(m)}return h.appendChild(document.createTextNode(" ".repeat(5))),h.appendChild(c),u(),h}},8122:(e,t,i)=>{"use strict";function s(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");const i=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),i&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function n(e){return Math.min(1,Math.max(0,e))}function o(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function r(e){return e<=1?100*e+"%":e}function a(e){return 1===e.length?`0${e}`:String(e)}function l(e,t,i){e=s(e,255),t=s(t,255),i=s(i,255);const n=Math.max(e,t,i),o=Math.min(e,t,i);let r=0,a=0;const l=(n+o)/2;if(n===o)a=0,r=0;else{const s=n-o;switch(a=l>.5?s/(2-n-o):s/(n+o),n){case e:r=(t-i)/s+(t<i?6:0);break;case t:r=(i-e)/s+2;break;case i:r=(e-t)/s+4}r/=6}return{h:r,s:a,l}}function h(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*i*(t-e):i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function d(e,t,i){e=s(e,255),t=s(t,255),i=s(i,255);const n=Math.max(e,t,i),o=Math.min(e,t,i);let r=0;const a=n,l=n-o,h=0===n?0:l/n;if(n===o)r=0;else{switch(n){case e:r=(t-i)/l+(t<i?6:0);break;case t:r=(i-e)/l+2;break;case i:r=(e-t)/l+4}r/=6}return{h:r,s:h,v:a}}function c(e,t,i,s){const n=[a(Math.round(e).toString(16)),a(Math.round(t).toString(16)),a(Math.round(i).toString(16))];return s&&n[0].startsWith(n[0].charAt(1))&&n[1].startsWith(n[1].charAt(1))&&n[2].startsWith(n[2].charAt(1))?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function u(e){return p(e)/255}function p(e){return parseInt(e,16)}i.d(t,{sY:()=>N,hd:()=>H,at:()=>U});const m={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};const g="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",v=`[\\s|\\(]+(${g})[,|\\s]+(${g})[,|\\s]+(${g})\\s*\\)?`,f=`[\\s|\\(]+(${g})[,|\\s]+(${g})[,|\\s]+(${g})[,|\\s]+(${g})\\s*\\)?`,y={CSS_UNIT:new RegExp(g),rgb:new RegExp(`rgb${v}`),rgba:new RegExp(`rgba${f}`),hsl:new RegExp(`hsl${v}`),hsla:new RegExp(`hsla${f}`),hsv:new RegExp(`hsv${v}`),hsva:new RegExp(`hsva${f}`),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function b(e){return Boolean(y.CSS_UNIT.exec(String(e)))}function w(e){return!isNaN(Number(e))}class C{static setColorSpace(e){C.globalSpace=e}get colorSpace(){return 1===C.globalSpace?this.HSL:0===C.globalSpace?this.CIELAB:this.YPbPr}get lightness(){return this.colorSpace.lightness}matchHue(e){const t=C.get(e).toHsl().h,i=this.toHsl();return i.h=t,C.get(i)}constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.lighten=e=>this.colorSpace.lighten(e),this.darken=e=>this.colorSpace.darken(e),this.setLightness=e=>this.colorSpace.setLightness(e),this.matchLightness=e=>this.colorSpace.matchLightness(e),t instanceof C)return t.clone();"number"==typeof t&&(t=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(t)),this.originalInput=t;const n=function(e){var t;let i={r:0,g:0,b:0},n=1,a=null,l=null,d=null,c=!1,g=!1;var v,f,C,S,x,T;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;let t=!1;if(e in Object.keys(m))e=m[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};let i=y.rgb.exec(e);return null!==i?{r:i[1],g:i[2],b:i[3]}:(i=y.rgba.exec(e),null!==i?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=y.hsl.exec(e),null!==i?{h:i[1],s:i[2],l:i[3]}:(i=y.hsla.exec(e),null!==i?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=y.hsv.exec(e),null!==i?{h:i[1],s:i[2],v:i[3]}:(i=y.hsva.exec(e),null!==i?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=y.hex8.exec(e),null!==i?{r:p(i[1]),g:p(i[2]),b:p(i[3]),a:u(i[4]),format:t?"name":"hex8"}:(i=y.hex6.exec(e),null!==i?{r:p(i[1]),g:p(i[2]),b:p(i[3]),format:t?"name":"hex"}:(i=y.hex4.exec(e),null!==i?{r:p(i[1]+i[1]),g:p(i[2]+i[2]),b:p(i[3]+i[3]),a:u(i[4]+i[4]),format:t?"name":"hex8"}:(i=y.hex3.exec(e),null!==i&&{r:p(i[1]+i[1]),g:p(i[2]+i[2]),b:p(i[3]+i[3]),format:t?"name":"hex"})))))))))}(e)),"object"==typeof e&&(b(e.r)&&b(e.g)&&b(e.b)?(S=e.r,x=e.g,T=e.b,i={r:255*s(S,255),g:255*s(x,255),b:255*s(T,255)},c=!0,g="%"===String(e.r).substr(-1)?"prgb":"rgb"):w(e.y)&&w(e.pb)&&w(e.pr)?(v=e.y,f=e.pb,C=e.pr,i={r:Math.round(v+1.402*C),g:Math.round(v-.344*f-.714*C),b:Math.round(v+1.772*f)},c=!0,g="ypbpr"):b(e.h)&&b(e.s)&&b(e.v)?(a=r(e.s),l=r(e.v),i=function(e,t,i){e=6*s(e,360),t=s(t,100),i=s(i,100);const n=Math.floor(e),o=e-n,r=i*(1-t),a=i*(1-o*t),l=i*(1-(1-o)*t),h=n%6;return{r:255*[i,a,r,r,l,i][h],g:255*[l,i,i,a,r,r][h],b:255*[r,r,l,i,i,a][h]}}(e.h,a,l),c=!0,g="hsv"):b(e.h)&&b(e.s)&&b(e.l)?(a=r(e.s),d=r(e.l),i=function(e,t,i){let n,o,r;if(e=s(e,360),t=s(t,100),i=s(i,100),0===t)o=i,r=i,n=i;else{const s=i<.5?i*(1+t):i+t-i*t,a=2*i-s;n=h(a,s,e+1/3),o=h(a,s,e),r=h(a,s,e-1/3)}return{r:255*n,g:255*o,b:255*r}}(e.h,a,d),c=!0,g="hsl"):w(e.l)&&w(e.a)&&w(e.b)&&(i=function(e,t,i){let s,n,o,r=(e+16)/116,a=t/500+r,l=r-i/200;return a=.95047*(a*a*a>.008856?a*a*a:(a-16/116)/7.787),r=1*(r*r*r>.008856?r*r*r:(r-16/116)/7.787),l=1.08883*(l*l*l>.008856?l*l*l:(l-16/116)/7.787),s=3.2406*a+-1.5372*r+-.4986*l,n=-.9689*a+1.8758*r+.0415*l,o=.0557*a+-.204*r+1.057*l,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:12.92*o,{r:255*Math.max(0,Math.min(1,s)),g:255*Math.max(0,Math.min(1,n)),b:255*Math.max(0,Math.min(1,o))}}(e.l,e.a,e.b),c=!0,g="lab"),Object.prototype.hasOwnProperty.call(e,"a")&&(n=e.a)),n=o(n),{ok:c,format:null!==(t=e.format)&&void 0!==t?t:g,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a:n}}(t);this.originalInput=t,this.r=n.r,this.g=n.g,this.b=n.b,this.a=n.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(e=i.format)&&void 0!==e?e:n.format,this.gradientType=i.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=n.ok,this.initHSL(),this.initCIELAB(),this.initYPbPr()}initHSL(){const e=this;this.HSL={lighten:t=>{const i=e.toHsl();return i.l+=t/100,i.l=n(i.l),C.get(i)},darken:t=>e.HSL.lighten(-t),setLightness:t=>{const i=e.toHsl();return i.l=t,C.get(i)},matchLightness:t=>{const i=C.get(t).HSL.lightness,s=e.toHsl();return s.l=i,C.get(s)},get lightness(){return e.toHsl().l}}}initCIELAB(){const e=this;this.CIELAB={lighten:t=>{const i=e.toCieLab();return i.l+=t/100,i.l=n(i.l),C.get(i)},darken:t=>e.CIELAB.lighten(-t),setLightness:t=>{const i=e.toCieLab();return i.l=t,C.get(i)},matchLightness:t=>{const i=C.get(t).CIELAB.lightness,s=e.toCieLab();return s.l=i,C.get(s)},get lightness(){return e.toCieLab().l}}}initYPbPr(){const e=this;this.YPbPr={lighten:t=>{const i=e.toYPbPr();return i.y+=t/100*255,i.y=n(i.y),C.get(i)},darken:t=>e.YPbPr.lighten(-t),setLightness:t=>{const i=e.toYPbPr();return i.y=t,C.get(i)},matchLightness:t=>{const i=C.get(t).YPbPr.lightness,s=e.toYPbPr();return s.y=i,C.get(s)},get lightness(){return e.toYPbPr().y}}}static get(){return new C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}isDark(){return this.getBrightness()<128}isLight(){return!this.isDark()}getBrightness(){const e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3}getLuminance(){const e=this.toRgb(),t=e.r/255,i=e.g/255,s=e.b/255;return.2126*S(t)+.7152*S(i)+.0722*S(s)}getAlpha(){return this.a}setAlpha(e){return this.a=o(e),this.roundA=Math.round(100*this.a)/100,this}toHsv(){const e=d(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}}toCieLab(){const e=function(e,t,i){let s,n,o;return t/=255,i/=255,s=(.4124*(e=(e/=255)>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.1805*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92))/.95047,n=(.2126*e+.7152*t+.0722*i)/1,o=(.0193*e+.1192*t+.9505*i)/1.08883,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,n=n>.008856?Math.pow(n,1/3):7.787*n+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,{l:116*n-16,a:500*(s-n),b:200*(n-o)}}(this.r,this.g,this.b);return{l:e.l,a:e.a,b:e.b}}toHsvString(){const e=d(this.r,this.g,this.b),t=Math.round(360*e.h),i=Math.round(100*e.s),s=Math.round(100*e.v);return 1===this.a?`hsv(${t}, ${i}%, ${s}%)`:`hsva(${t}, ${i}%, ${s}%, ${this.roundA})`}toHsl(){const e=l(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}}toHslString(){const e=l(this.r,this.g,this.b),t=Math.round(360*e.h),i=Math.round(100*e.s),s=Math.round(100*e.l);return 1===this.a?`hsl(${t}, ${i}%, ${s}%)`:`hsla(${t}, ${i}%, ${s}%, ${this.roundA})`}toHex(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return c(this.r,this.g,this.b,e)}toHexString(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return`#${this.toHex(e)}`}toHex8(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e,t,i,s,n){const o=[a(Math.round(e).toString(16)),a(Math.round(t).toString(16)),a(Math.round(i).toString(16)),a((r=s,Math.round(255*parseFloat(r)).toString(16)))];var r;return n&&o[0].startsWith(o[0].charAt(1))&&o[1].startsWith(o[1].charAt(1))&&o[2].startsWith(o[2].charAt(1))&&o[3].startsWith(o[3].charAt(1))?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this.r,this.g,this.b,this.a,e)}toHex8String(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return`#${this.toHex8(e)}`}toRgb(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}}toYPbPr(){return{y:.299*(e=this.r)+.587*(t=this.g)+.114*(i=this.b),pb:-.169*e-.331*t+.5*i,pr:.5*e-.419*t-.081*i};var e,t,i}toRgbString(){const e=Math.round(this.r),t=Math.round(this.g),i=Math.round(this.b);return 1===this.a?`rgb(${e}, ${t}, ${i})`:`rgba(${e}, ${t}, ${i}, ${this.roundA})`}toPercentageRgb(){const e=e=>`${Math.round(100*s(e,255))}%`;return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}}toPercentageRgbString(){const e=e=>Math.round(100*s(e,255));return 1===this.a?`rgb(${e(this.r)}%, ${e(this.g)}%, ${e(this.b)}%)`:`rgba(${e(this.r)}%, ${e(this.g)}%, ${e(this.b)}%, ${this.roundA})`}toName(){if(0===this.a)return"transparent";if(this.a<1)return!1;const e=`#${c(this.r,this.g,this.b,!1)}`;for(const[t,i]of Object.entries(m))if(e===i)return t;return!1}toString(e){var t,i;const s=Boolean(e);e=null!==(t=e)&&void 0!==t?t:this.format;let n=!1;const o=this.a<1&&this.a>=0;return s||!o||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),null!==(i=n)&&void 0!==i?i:this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()}toNumber(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)}clone(){return C.get(this.toString())}brighten(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const t=this.toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(-e/100*255))),t.g=Math.max(0,Math.min(255,t.g-Math.round(-e/100*255))),t.b=Math.max(0,Math.min(255,t.b-Math.round(-e/100*255))),C.get(t)}tint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.mix("#FFFFFF",e)}shade(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.mix("#000000",e)}desaturate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const t=this.toHsl();return t.s-=e/100,t.s=n(t.s),C.get(t)}saturate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const t=this.toHsl();return t.s+=e/100,t.s=n(t.s),C.get(t)}greyscale(){return this.desaturate(100)}spin(e){const t=this.toHsl(),i=(t.h+e)%360;return t.h=i<0?360+i:i,C.get(t)}mix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;const i=this.toRgb(),s=C.get(e).toRgb(),n=t/100,o={r:(s.r-i.r)*n+i.r,g:(s.g-i.g)*n+i.g,b:(s.b-i.b)*n+i.b,a:(s.a-i.a)*n+i.a};return C.get(o)}analogous(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;const i=this.toHsl(),s=360/t,n=[this];for(i.h=(i.h-(s*e>>1)+720)%360;--e;)i.h=(i.h+s)%360,n.push(C.get(i));return n}complement(){const e=this.toHsl();return e.h=(e.h+180)%360,C.get(e)}monochromatic(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;const t=this.toHsv(),{h:i}=t,{s}=t;let{v:n}=t;const o=[],r=1/e;for(;e-- >0;)o.push(C.get({h:i,s,v:n})),n=(n+r)%1;return o}splitcomplement(){const e=this.toHsl(),{h:t}=e;return[this,C.get({h:(t+72)%360,s:e.s,l:e.l}),C.get({h:(t+216)%360,s:e.s,l:e.l})]}onBackground(e){const t=this.toRgb(),i=C.get(e).toRgb();return C.get({r:i.r+(t.r-i.r)*t.a,g:i.g+(t.g-i.g)*t.a,b:i.b+(t.b-i.b)*t.a})}triad(){return this.polyad(3)}tetrad(){return this.polyad(4)}polyad(e){const t=this.toHsl(),{h:i}=t,s=[this],n=360/e;for(let o=1;o<e;o++)s.push(C.get({h:(i+o*n)%360,s:t.s,l:t.l}));return s}equals(e){return this.toRgbString()===C.get(e).toRgbString()}get isCurrentModeBg(){return document.body.classList.contains("darkmode")?this.isDarkModeBg:this.isLightModeBg}static get currentModeBg(){return document.body.classList.contains("darkmode")?C.darkModeBg:C.lightModeBg}get isCurrentModeFg(){return document.body.classList.contains("darkmode")?this.isDarkModeFg:this.isLightModeFg}static get currentModeFg(){return document.body.classList.contains("darkmode")?C.darkModeFg:C.lightModeFg}get isLightModeBg(){return this.equals(C.lightModeBg)}static get lightModeBg(){return C.get("#FFFFFF")}get isLightModeFg(){return this.equals(C.lightModeFg)}static get lightModeFg(){return C.get("#494949")}get isDarkModeBg(){return this.equals(C.darkModeBg)}static get darkModeBg(){return C.get("#202C39")}get isDarkModeFg(){return this.equals(C.darkModeFg)}static get darkModeFg(){return C.get("#FFFFFF")}toRgbArray(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.a<1||e?[this.r,this.g,this.b,this.a]:[this.r,this.g,this.b]}get isBlack(){return this.equals("#000000")}static get black(){return C.get("#000000")}get isWhite(){return this.equals("#FFFFFF")}static get white(){return C.get("#FFFFFF")}get isTransparent(){return 0===this.getAlpha()}static get transparent(){return C.get("transparent")}isLessLuminousThan(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.getLuminance()-x(e);return t?i<=0:i<0}isMoreLuminousThan(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.getLuminance()-x(e);return t?i>=0:i>0}get rgbRange(){const e=this.toRgbArray();return Math.max(...e)-Math.min(...e)}}function S(e){return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function x(e){return"number"==typeof e?e:C.get(e).getLuminance()}C.globalSpace=1;var T=i(6716);const P=/\s*,\s*/,k=/(?:[+-]?\d*\.?\d+)(?:%|[a-z]+)?/,A=D(["(?:",/#(?:[a-f0-9]{6}|[a-f0-9]{3})/,"|","(?:rgb|hsl)",/\(\s*(?:\d{1,3}\s*,\s*){2}\d{1,3}\s*\)/,"|","(?:rgba|hsla)",/\(\s*(?:\d{1,3}\s*,\s*){2}\d{1,3}\s*,\s*\d*\.?\d+\)/,"|",/[_a-z-][_a-z0-9-]*/,")"],""),M=D([A,"(?:\\s+",k,"(?:\\s+",k,")?)?"],""),R=D(["(?:",M,P,")*",M],""),I=["(?:(",D(["(?:(",/(?:[+-]?\d*\.?\d+)(?:deg|grad|rad|turn)/,")|",/to\s+((?:(?:left|right|top|bottom)(?:\s+(?:top|bottom|left|right))?))/,")"],""),")",P,")?(",R,")"],E=["\\s*(",A,")","(?:\\s+","(",k,"))?","(?:",P,"\\s*)?"];class L{constructor(e,t,i){this.stops=[],this.line=i[1];const s=t.exec(e);if(null===s)return;this.angle=s[1];const n=D(E,"gi");let o=n.exec(s[4]);for(;null!==o;){var r;this.stops.push({color:C.get(o[1]),position:null!==(r=o[2])&&void 0!==r?r:""}),o=n.exec(s[4])}}static parse(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(0===e.trim().length||!e.trim().toLowerCase().startsWith("linear-gradient"))return;const t=D(I,"gi"),i=t.exec(e);return null!==i?new L(e,t,i):void 0}isBlack(){return this.stops.every((e=>e.color.equals("black")))}isWhite(){return this.stops.every((e=>e.color.equals("white")))}toString(){const e=[];void 0!==this.angle&&e.push(this.angle);for(const t of this.stops)e.push(`${t.color.toRgbString()} ${t.position}`.trim());return`linear-gradient(${e.join(", ")})`}darkest(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"white";const t=C.get(e);let i=C.get("white"),s=i.getLuminance();for(const e of this.stops){const n=e.color.onBackground(t),o=n.getLuminance();o<s&&(s=o,i=n)}return i}lightest(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"white";const t=C.get(e);let i=C.get("white"),s=i.getLuminance();for(const e of this.stops){const n=e.color.onBackground(t),o=n.getLuminance();o>s&&(s=o,i=n)}return i}}function D(e,t){return new RegExp(e.reduce(((e,t)=>e+("string"==typeof t?t:t.source)),""),t)}T.gh.listen((e=>{const t=document.querySelectorAll(".dm-adjust"),i="darkmode"===e;for(const e of t)U(e,i)}));const B="#202C39";function U(e,t){if("photo"===e.getAttribute("type"))return;const i=e.firstElementChild;if(null!==i){var s,n,o;const e=i.classList.contains("roomNotice");if(e&&!(null!==(s=i.textContent)&&void 0!==s?s:"").startsWith("Notice:"))return;const r=t?null!==(n=i.getAttribute("dm-adjust-bg"))&&void 0!==n?n:B:null!==(o=i.getAttribute("dm-init-bg"))&&void 0!==o?o:"white";r.startsWith("linear-gradent")?i.style.backgroundImage=r:i.style.background=r;const a=t?i.getAttribute("dm-adjust-fg"):i.getAttribute("dm-init-fg"),l=e?i:i.querySelector("span.msg-text");null!==a&&null!==l&&(l.style.color=a)}}C.setColorSpace(2);const _=C.darkModeBg.lightness,F=C.darkModeFg.lightness;class N{constructor(e){this.background=e.bg,this.foreground=e.fg,this.calc()}calc(){var e;const t=L.parse(this.background),i=C.get(null!==(e=this.foreground)&&void 0!==e?e:C.darkModeFg).setAlpha(1);if(this.fgDark=i.setLightness(F).setAlpha(1).toRgbString(),void 0!==t)t.stops.forEach((e=>{e.color=e.color.onBackground(C.darkModeBg).setLightness(_)})),this.bgDark=t.toString();else{const e=C.get(this.background);if(!e.isValid||e.isWhite||e.isTransparent||e.isBlack)return void(this.bgDark=B);this.bgDark=e.setLightness(_).toRgbString()}}static parseNotice(e){return new N({fg:e.foreground,bg:e.background})}static parseMessage(e){return new N({fg:e.textColor,bg:e.backgroundColor})}}function O(e){e.style.textShadow="1px 1px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000"}function H(e,t,i){var s,n;t=(null!==(s=t)&&void 0!==s?s:"").trim(),i=(null!==(n=i)&&void 0!==n?n:"").trim();const o=e.firstElementChild;let r=o,a=e;if(o.classList.contains("roomNotice")){if(a=o,!function(e){return!!e.innerText&&e.innerText.startsWith("Notice:")}(r))return}else r=e.querySelector(".msg-text");const l=C.get(t);if(l.rgbRange<10?r.style.color="#D3D3D3":r.style.color=l.setLightness(F).setAlpha(1).toRgbString(),i.length>0){const e=L.parse(i);if(void 0!==e)e.stops.forEach((e=>{const t=e.color.getAlpha();e.color.rgbRange<10?e.color=C.transparent:e.color=e.color.setLightness(_).setAlpha(t)})),a.style.background=e.toString();else{let e=C.get(i);if(e.rgbRange<10)a.style.removeProperty("background"),O(r);else{const t=e.getAlpha();e=e.setLightness(_).setAlpha(t),a.style.background=e.toRgbString(),t<1&&O(r)}}}else O(r)}},1131:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Y});var s=i(8638),n=i(4936),o=i(2758),r=i(3417),a=i(1474),l=i(3956),h=i(9461),d=i(7254),c=i(5914),u=i(897),p=i(213),m=i(5216),g=i(6844),v=i(2939),f=i(1519),y=i(8423),b=i(6440),w=i(3959),C=i(1284),S=i(7407),x=i(1282),T=i(34),P=i(1452),k=i(5424),A=i(4947),M=i(2945),R=i(4110),I=i(8863),E=i(7209),L=i(2042),D=i(2823);class B extends D.K{constructor(){super({})}getKey(){return`${this.getId()}`}initData(e){}}class U extends B{getId(){return"GlobalPushServiceBackendChangeTopic"}parseData(e){var t,i;return{...super.parseData(e),backends:null!==(t=null===(i=e.getList("backends"))||void 0===i?void 0:i.map((e=>e.getString("backend"))))&&void 0!==t?t:[]}}}var _=i(8650),F=i(8300),N=i(7477),O=i(819),H=i(1021),W=i(8255),$=i(7437),V=i(9332);class z{constructor(e){this.chatConn=e,this.topics=new Map,this.historyLimit=10,this.finished=!1,this.initial=!0,this.listeners=new y.gt,this.historyCallback=[],this.handledMessages=[]}setupHistory(){if(!c.U.isEnabledForVerify())return;this.tipHistory(),this.purchaseHistory(),this.messageHistory(),this.shortcodeHistory();const e=c.U.primaryClientFailure.listen((e=>{this.informHistoryFailure(e)}),!1);this.listeners.add(e),this.fetchHistoryIfReady()}dispose(){this.listeners.removeAll()}push(e){this.historyCallback.length>this.historyLimit&&this.historyCallback.pop(),this.historyCallback.push(e)}fireBuffer(){this.historyCallback.forEach((e=>{c.U.isEnabledForUI()&&e()})),this.historyCallback=[]}fetchHistory(){const e={};return Array.from(this.topics.entries()).forEach((t=>{let[i,s]=t;e[i]=s.authData})),(0,m.KF)("push_service/room_history/",{topics:JSON.stringify(e)}).then((e=>{const t=JSON.parse(e.responseText);let i=0;t.forEach((e=>{for(const[t,s]of Object.entries(e)){const e=this.topics.get(t);if(void 0===e||i>=this.historyLimit)return;(0,D.v)(s);const o=new n.N6(s),r=this.addHistoryMessage(e.topicKey,o.getString("tid"));if(c.U.addExternalMessage(e.topicKey,o.getString("tid"))||r)return;i+=1,e.callback(o)}}))})).catch(P.yZ)}tipHistory(){const{roomUid:e,viewerUid:t,privateShowId:i}=h.Aw.getState(),s=e=>t=>{const i=e.parseData(t);i.toUsername===this.chatConn.room()&&(0,$.YY)(this.chatConn,i,!0)},n=[];t===e?n.push(new u.aT(t)):n.push(new N.uB(e)),""!==i&&n.push(new F.hw(e,i)),n.forEach((e=>{this.topics.set(e.getAuthKey(),{callback:s(e),authData:e.getAuthData(),topicKey:e.getKey()});const t=e.onSubscribeChange.listen((t=>{t.subscribed?this.fetchHistoryIfReady():this.informHistoryFailure(`${e.getId()} topic failed`)}));this.listeners.add(t)}))}purchaseHistory(){const e=h.Aw.getState().roomUid;[new N.KU(e),new N.H1(e)].forEach((e=>{this.topics.set(e.getAuthKey(),{callback:t=>{const i=e.parseData(t);(0,$.J1)(this.chatConn,i)},authData:e.getAuthData(),topicKey:e.getKey()});const t=e.onSubscribeChange.listen((t=>{t.subscribed?this.fetchHistoryIfReady():this.informHistoryFailure(`${e.getId()} topic failed`)}));this.listeners.add(t)}))}messageHistory(){const{roomUid:e,privateShowId:t}=h.Aw.getState();if(""===e)return;const i=""!==t?new F.fn(e,t):new N.Mt(e);this.topics.set(i.getAuthKey(),{callback:e=>{const t=i.parseData(e);(0,$.Ds)(this.chatConn,t)},authData:i.getAuthData(),topicKey:i.getKey()}),i.onSubscribeChange.listen((e=>{e.subscribed?this.fetchHistoryIfReady():this.informHistoryFailure(`${i.getId()} topic failed`)})).addTo(this.listeners)}shortcodeHistory(){const{roomUid:e}=h.Aw.getState(),t=[];""!==e&&t.push(new N.iS(e)),t.forEach((e=>{this.topics.set(e.getAuthKey(),{callback:t=>{const i=e.parseData(t);this.chatConn.event.roomShortcode.fire(i)},authData:e.getAuthData(),topicKey:e.getKey()});const t=e.onSubscribeChange.listen((t=>{t.subscribed?this.fetchHistoryIfReady():this.informHistoryFailure(`${e.getId()} topic failed`)}));this.listeners.add(t)}))}fetchHistoryIfReady(){if(!this.finished&&c.U.isEnabledForUI()){for(const e of this.topics.values())if(!c.U.isListeningFor(e.topicKey))return;this.finished=!0,this.fetchHistory().then((()=>{(0,$.rM)(this.chatConn,h.Aw.getState().roomTitle),this.initial&&(this.chatConn.changeStatus(this.chatConn.statusAfterConnected),this.initial=!1)})).catch((()=>{}))}}addHistoryMessage(e,t){const i=`${e}:${t}`;return!!this.handledMessages.includes(i)||(this.handledMessages.push(i),!1)}reset(){this.finished=!1}informHistoryFailure(e){if(!this.finished){const t=[];for(const e of this.topics.values())c.U.isListeningFor(e.topicKey)||t.push(e.topicKey);t.length>0&&(this.finished=!0,(0,S.bT)("PushServiceHistoryFailure",{reason:e,unconnectedTopics:t.toString(),unconnectedTopicsCount:t.length}),this.fetchHistory().then((()=>{})).catch((()=>{})))}}}class G{constructor(e,t){var i,s;this.dossier=e,this.chatConn=t,this.listeners={global:new y.gt,room:new y.gt,user:new y.gt,color:new y.gt,fanclub:new y.gt,privileged:new y.gt,private:new y.gt,enterLeave:new y.gt,roomUser:new y.gt},this.isInHiddenShow=!1,this.history=new z(this.chatConn),this.connectionFailedCount=0,this.lastOnlineStatus="notconnected",this.hiddenMessage="",this.receivedMessageBuffer=[],this.messageTimeouts=new Map;let n=!0;const o=(new Date).getTime();let r=0;c.U.connectionChange.listen((e=>{if(["connecting","closing","initialized"].includes(e.current))return;"connected"===e.current&&(r+=1);const t={state:e.current,previousState:e.previous,push_connection_type:c.U.getConnectionType(),wowza_state:this.chatConn.wowzaHandler.readyState(),connection_id:c.U.presenceId,first_connection:n,time_since_start:(new Date).getTime()-o,client:e.client,connectionCount:r,connectionFailedCount:this.connectionFailedCount,reason:JSON.stringify(e.reason)};if((0,S.bT)("PushServiceConnection",t),n=!1,!0===e.primary&&c.U.isEnabledForUI())switch(e.current){case"closed":case"failed":this.chatConn.event.roomNotice.fire({messages:[[(0,V.H5)(A.R.chatDisconnected)]],showInPrivateMessage:!0});break;case"suspended":case"disconnected":this.connectionFailedCount+=1,this.chatConn.event.roomNotice.fire({messages:[[(0,V.H5)(A.R.tryingToReconnect)]],showInPrivateMessage:!0,countsForUnread:!1});break;default:this.connectionFailedCount=0}}),!1).addTo(this.listeners.global);const a=null!==(i=this.dossier.viewerUid)&&void 0!==i?i:"",l=null!==(s=this.dossier.roomUid)&&void 0!==s?s:"";this.isBroadcaster=""!==l&&a===l;const{privateShowId:d,isModerator:u,isInFanClub:p,userColors:m}=h.Aw.getState();this.setupBackendSwapListener(),this.joinRoomPresence(l,a),this.setupVideoQualityTopic(l),this.setupVideoLatencyTopic(l),this.setupUserListeners(a),this.setupRoomListeners(l),this.setupRoomEnterLeaveListener(l,u||this.isBroadcaster),this.setupRoomUserListeners(l,a),this.setupPrivilegedListeners(l,u||this.isBroadcaster),this.setupFanClubListeners(l,p),this.setupColorGroupListeners(l,m),this.setupGameListener(l),""!==d&&this.setupPrivateRoomListeners(l,d),window.setTimeout((()=>{this.history.setupHistory()}),500),h.Aw.onUpdate.listen((e=>{const t=h.Aw.getState();t.privateShowId!==e.privateShowId&&this.setupPrivateRoomListeners(l,t.privateShowId),t.isModerator!==e.isModerator&&(this.setupPrivilegedListeners(l,t.isModerator||this.isBroadcaster),this.setupRoomEnterLeaveListener(l,t.isModerator||this.isBroadcaster)),t.isInFanClub!==e.isInFanClub&&this.setupFanClubListeners(l,t.isInFanClub),this.setupColorGroupListeners(l,t.userColors,e.userColors)}),!1).addTo(this.listeners.global)}sendMessage(e,t){const{roomUid:i,privateShowId:s,userName:o}=h.Aw.getState();if(e!==this.chatConn.room()||""===i)return Promise.reject({error:"room error",sendMessageRoom:e,handlerRoom:this.chatConn.room(),roomUid:i});if(h.Bm.current.isNoninteractiveUser)return Promise.reject({error:"internal staff",sendMessageRoom:e,handlerRoom:this.chatConn.room(),roomUid:i});const r={room:e,message:JSON.stringify({m:t})};return this.chatConn.inPrivateRoom()&&""!==s&&(r.private_show_id=s),""!==o&&(r.username=o),c.U.isEnabledForUI()&&this.chatConn.wowzaHandler.ensureConnected(),(0,m.KF)("push_service/publish_chat_message_live/",r).then((e=>{var s;let o=null!==(s=e.getResponseHeader("x-banned"))&&void 0!==s?s:e.getResponseHeader("x-denied");const a=new n.N6(e.responseText);if(null!==o)o=decodeURIComponent(o),this.shouldHandleMessage()&&this.chatConn.event.roomNotice.fire({messages:[[(0,V.H5)(o)]],showInPrivateMessage:!0});else{const t=a.getObject("message");(0,D.v)(t);const s=void 0===r.private_show_id?new N.Mt(i):new F.fn(i,r.private_show_id),o=s.parseData(new n.N6(t));if(o.isSpam="True"===e.getResponseHeader("x-spam"),c.U.isEnabledForUI()&&void 0!==o.tid&&!c.U.addExternalMessage(s.getKey(),o.tid))this.history.addHistoryMessage(s.getKey(),o.tid),(0,$.Ds)(this.chatConn,o),this.messageTimeouts.set(o.tid,window.setTimeout((()=>{var e;this.checkReceivedBuffer(null!==(e=o.tid)&&void 0!==e?e:"")||(0,S.bT)("PushServiceMessageTimeout",{topic_key:s.getKey(),topic_id:s.getId(),tid:o.tid,isSpam:o.isSpam,message:o.message})}),1e4));else if(c.U.isEnabledForUI()){var l;this.checkReceivedBuffer(null!==(l=o.tid)&&void 0!==l?l:"")}}return{m:t,f:"",c:"",tid:a.getString("tid"),sig:a.getString("sig")}}))}checkReceivedBuffer(e){const t=this.receivedMessageBuffer.indexOf(null!=e?e:"");return-1!==t&&(this.receivedMessageBuffer.splice(t,1),!0)}setupUserListeners(e){(0,g.ok)()||""===e||(new u.Tg(e).onMessage.listen((e=>{h.Aw.setState({userColors:e})})).addTo(this.listeners.user),new u.LS(e).onMessage.listen((e=>{this.shouldHandleMessage()&&(0,$.DK)(e.message)})).addTo(this.listeners.user),this.isBroadcaster&&this.setupBroadcasterPrivateListener(e))}setupVideoQualityTopic(e){""!==e&&new N.yv(e).onMessage.listen((e=>{const t=h.Aw.getState(),{tid:i,...s}=e;var n,o;(0,L.k)(t.quality,s)||(h.Aw.setState({...t,quality:s}),null!==(n=null===(o=h.Aw.getState().quality)||void 0===o?void 0:o.stopped)&&void 0!==n&&n&&(0,H.YW)({eventName:"streamEnd"}))})).addTo(this.listeners.room)}setupVideoLatencyTopic(e){""!==e&&new N.pr(e).onMessage.listen((e=>{var t,i,s,n,o,r,a,l;const d=h.Aw.getState(),{tid:c,...u}=e;u.localTimeTranscoderInput=null!==(t=u.localTimeTranscoderInput)&&void 0!==t?t:null===(i=d.latency)||void 0===i?void 0:i.localTimeTranscoderInput,u.streamTimeTranscoderInput=null!==(s=u.streamTimeTranscoderInput)&&void 0!==s?s:null===(n=d.latency)||void 0===n?void 0:n.streamTimeTranscoderInput,u.localTimeSegmentStart=null!==(o=u.localTimeSegmentStart)&&void 0!==o?o:null===(r=d.latency)||void 0===r?void 0:r.localTimeSegmentStart,u.streamTimeSegmentStart=null!==(a=u.streamTimeSegmentStart)&&void 0!==a?a:null===(l=d.latency)||void 0===l?void 0:l.streamTimeSegmentStart,(0,L.k)(d.latency,u)||h.Aw.setState({...d,latency:u})})).addTo(this.listeners.room)}setupRoomListeners(e){""!==e&&c.U.isEnabledForVerify()&&(this.setupRoomPublicListeners(e),new N.ug(e).onMessage.listen((e=>{this.chatConn.username()===e.username&&h.Aw.setState({isModerator:!0}),this.shouldHandleMessage()&&(0,$.gh)(this.chatConn,e)})).addTo(this.listeners.room),new N.sL(this.dossier.roomUid).onMessage.listen((e=>{this.chatConn.username()===e.username&&h.Aw.setState({isModerator:!1}),this.shouldHandleMessage()&&(0,$.rN)(this.chatConn,e)})).addTo(this.listeners.room),new N.bq(e).onMessage.listen((e=>{const t=h.Aw.getState().roomStatus;let i=e.status;if("offline"!==t&&(this.lastOnlineStatus=t),"hidden"===e.status){if(this.isBroadcaster)return void("away"===t&&((0,$.K_)(this.chatConn),h.Aw.setState({roomStatus:"public"})));this.isInHiddenShow||(this.hiddenShowStarted=new Date),this.shouldHandleMessage()&&(""!==e.message&&(this.hiddenMessage=e.message),"hiddenwatching"===this.lastOnlineStatus?((0,$.KM)(this.chatConn,this.lastOnlineStatus,this.hiddenMessage),i=this.lastOnlineStatus):(0,$.KM)(this.chatConn,e.status,this.hiddenMessage))}else if("privatenotwatching"===e.status){if(this.isBroadcaster&&"offline"!==t||["privaterequesting","privatewatching","privatenotwatching"].includes(t))return;if(this.shouldHandleMessage()){const s=(0,b.f)("PremPrivShow")&&void 0!==e.substatus&&e.substatus===W.Co.Premium;"offline"===t?this.isBroadcaster?this.chatConn.changeStatus("privatewatching"):"privatespying"===this.lastOnlineStatus?(this.chatConn.changeStatus(this.lastOnlineStatus),i=this.lastOnlineStatus):(""!==h.Aw.getState().privateShowId?this.chatConn.changeStatus("privaterequesting"):this.chatConn.changeStatus("public"),(0,$.Md)(this.chatConn,s)):(0,$.Md)(this.chatConn,s)}}else if("away"===e.status&&this.shouldHandleMessage()){if("privatewatching"===t?(h.Aw.setState({privateShowId:"",roomStatus:"away"}),(0,$.VW)(this.chatConn,e.substatus===W.Co.Premium)):"privatenotwatching"===t||"privatespying"===t?(0,$.VW)(this.chatConn,e.substatus===W.Co.Premium):this.chatConn.changeStatus(e.status),!this.passwordCheck())return}else if("public"===e.status&&this.shouldHandleMessage())"away"===t?(0,$.K_)(this.chatConn):"hidden"===t||"hiddenwatching"===t?(0,$.KM)(this.chatConn,e.status,e.message):this.chatConn.changeStatus(e.status);else{if("passwordprotected"===e.status)return;"offline"===e.status&&this.shouldHandleMessage()?("privaterequesting"===t&&((0,$.VW)(this.chatConn,e.substatus===W.Co.Premium),this.chatConn.leavePrivateOrSpyShow().catch(P.yZ)),this.chatConn.changeStatus(e.status)):this.shouldHandleMessage()&&this.chatConn.changeStatus(e.status)}h.Aw.setState({roomStatus:i})})).addTo(this.listeners.room),new N.Fh(e).onMessage.listen((e=>{this.shouldHandleMessage()&&(0,$.rM)(this.chatConn,e.title)})).addTo(this.listeners.room),new N.IJ(e).onMessage.listen((e=>{this.shouldHandleMessage()&&(0,$.II)(this.chatConn,e)})).addTo(this.listeners.room),new N.HW(e).onMessage.listen((e=>{this.shouldHandleMessage()&&(e.fromUser=this.chatConn.room(),this.chatConn.username()===e.username?(0,$.hp)(this.chatConn,A.R.kickedFromRoomMessage,h.Aw.getState().exploringHashTag):(0,$.vL)(this.chatConn,e))})).addTo(this.listeners.room),new N.Q4(e).onMessage.listen((e=>{if(this.shouldHandleMessage()&&"refresh_panel"===e.target){const t=()=>{this.chatConn.event.refreshPanel.fire({appId:e.appId,appSystem:e.appSystem})};h.Bm.current.throttleTopicPublish?window.setTimeout((()=>{t()}),1e3):t()}})).addTo(this.listeners.room),new N.Io(e).onMessage.listen((e=>{const t={allowPrivateShow:e.allowPrivateShow,privatePrice:e.privatePrice,spyPrice:e.spyPrice,privateMinMinutes:e.privateMinMinutes,allowShowRecordings:e.allowShowRecordings,hasFanClub:e.hasFanClub,activePassword:e.activePassword,fanClubSpyPrice:e.fanClubSpyPrice,premiumPrivatePrice:e.premiumPrivatePrice,premiumPrivateMinMinutes:e.premiumPrivateMinMinutes};h.Aw.setState(t),!this.chatConn.inPrivateRoom()||this.isBroadcaster?this.shouldHandleMessage()&&(0,$.$G)(this.chatConn,e):this.chatConn.event.settingsUpdate.fire(e)})).addTo(this.listeners.room),new N.BP(e).onMessage.listen((e=>{this.chatConn.event.roomNotice.fire({messages:[[(0,V.JH)(e.purchaser),(0,V.H5)(` promoted the room for ${e.durationMins} minutes`)]],colorClass:"userPromotion",foreground:"#272F35",background:"#ECF3FD",weight:"bold",showInPrivateMessage:!1}),E.J.fire(void 0)})).addTo(this.listeners.room))}setupRoomPublicListeners(e){new N.Mt(e).onMessage.listen((e=>{if(e.fromUser.username===this.chatConn.username()&&void 0!==e.tid){if(this.updateColors(e.fromUser),this.messageTimeouts.has(e.tid))return window.clearTimeout(this.messageTimeouts.get(e.tid)),void this.messageTimeouts.delete(e.tid);this.receivedMessageBuffer.push(e.tid)}if(this.chatConn.inPrivateRoom())return e.ts=void 0,void this.history.push((()=>(0,$.Ds)(this.chatConn,e)));const t=`RoomMessageTopic:${h.Aw.getState().roomUid}`;void 0!==e.tid&&this.history.addHistoryMessage(t,e.tid),this.shouldHandleMessage()&&(0,$.Ds)(this.chatConn,e)})).addTo(this.listeners.room),new N.H1(e).onMessage.listen((e=>{const t=h.Aw.getState();if(e.fromUser.username===t.userName&&h.Aw.setState({isInFanClub:!0}),this.chatConn.inPrivateRoom())return e.ts=void 0,void this.history.push((()=>(0,$.J1)(this.chatConn,e)));this.shouldHandleMessage()&&(0,$.J1)(this.chatConn,e)})).addTo(this.listeners.room),new N.KU(e).onMessage.listen((e=>{if(this.chatConn.inPrivateRoom())return e.ts=void 0,void this.history.push((()=>(0,$.J1)(this.chatConn,e)));this.shouldHandleMessage()&&(0,$.J1)(this.chatConn,e)})).addTo(this.listeners.room),new N.Tp(e).onMessage.listen((e=>{this.chatConn.inPrivateRoom()?e.ts=void 0:this.shouldHandleMessage()&&this.chatConn.event.roomNotice.fire(e)})).addTo(this.listeners.room),new N.uB(e).onMessage.listen((e=>{if(!this.isBroadcaster){if(e.fromUser.username===this.chatConn.username()&&this.updateColors(e.fromUser),this.chatConn.inPrivateRoom())return e.ts=void 0,void this.history.push((()=>(0,$.YY)(this.chatConn,e,!0)));this.shouldHandleMessage()&&(0,$.YY)(this.chatConn,e)}})).addTo(this.listeners.room),new N.iS(e).onMessage.listen((e=>{if(this.chatConn.inPrivateRoom())return e.ts=void 0,void this.history.push((()=>this.chatConn.event.roomShortcode.fire(e)));this.chatConn.event.roomShortcode.fire(e)})).addTo(this.listeners.room),new N.iX(e).onMessage.listen((e=>{const t=h.Aw.getState().roomPasswordHash,i=h.Aw.getState().lastSubmittedPasswordHash,s=""!==e.passwordHash,n=t!==e.passwordHash,o=i===t,r=i===e.passwordHash,a=this.isBroadcaster||s&&r||!s&&o;if(n)if(h.Aw.setState({roomPasswordHash:e.passwordHash}),this.chatConn.inPrivateRoom())a&&this.history.push((()=>(0,$.GR)(this.chatConn,s,r)));else if(this.shouldHandleMessage()){if("privatespying"===h.Aw.getState().roomStatus&&!a)return;(0,$.GR)(this.chatConn,s,r)}})).addTo(this.listeners.room)}setupBroadcasterPrivateListener(e){""!==e&&this.isBroadcaster&&new u.mt(e).onMessage.listen((e=>{this.privateStatusHandler(e)})).addTo(this.listeners.user)}privateStatusHandler(e){let t,i=!1;switch((0,b.f)("PremPrivShow")&&(i=e.isPremium),e.status){case"started":if("privatenotwatching".includes(this.chatConn.status))break;["privatewatching","privaterequesting"].includes(this.chatConn.status)?h.Aw.setState({privateShowId:e.privateShowId,roomStatus:"privatewatching"}):h.Aw.setState({roomStatus:"privatenotwatching"}),this.isBroadcaster&&(0,S.bT)("BroadcasterPrivateStarted",{is_premium:i}),t=$.Md;break;case"declined":h.Aw.setState({roomStatus:"public"}),t=$.VW;break;case"stopped":if(this.isBroadcaster&&["away","privatewatching"].includes(this.chatConn.status)){let t=i?A.R.premiumPrivateShowFinishedMessage:A.R.privateShowFinishedMessage;var s;void 0!==e.earlyCancelTokens&&e.earlyCancelTokens>0&&(t+=A.R.privateShowEarlyCancelMessage(null!==(s=e.requester)&&void 0!==s?s:this.chatConn.getPrivateShowUser(),e.earlyCancelTokens)),this.chatConn.event.roomNotice.fire({messages:[[(0,V.H5)(t)]],foreground:"#222",background:"#ff8b45",weight:"bold",showInPrivateMessage:!0,toUser:e.requester}),(0,S.bT)("BroadcasterPrivateEnded",{reason:e.reason,is_premium:i})}h.Aw.setState({roomStatus:"away",privateShowId:""}),t=$.VW;break;case"error":h.Aw.setState({roomStatus:"public",privateShowId:""}),t=$.VW;break;case"spy_leave":h.Aw.setState({roomStatus:"public",privateShowId:""}),t=e=>{e.changeStatus("privatenotwatching"),this.passwordCheck()};break;default:this.isBroadcaster||warn("Invalid private show status on viewer",e,"PUSH_")}this.shouldHandleMessage()&&void 0!==t&&t(this.chatConn,i,e.reason,e.requester)}passwordCheck(){const e=h.Aw.getState().roomPasswordHash,t=h.Aw.getState().lastSubmittedPasswordHash===e;return!(""!==e&&!t&&!this.isBroadcaster)||((0,$.GR)(this.chatConn,!0,!1),t)}setupRoomUserListeners(e,t){(0,g.ok)()||""===e||""===t||(new N.EJ(e,t).onMessage.listen((e=>{this.chatConn.inPrivateRoom()||this.shouldHandleMessage()&&this.chatConn.event.roomNotice.fire(e)})).addTo(this.listeners.roomUser),new N.n1(e,t).onMessage.listen((e=>{this.isBroadcaster||this.privateStatusHandler(e)})).addTo(this.listeners.roomUser),new N.rr(e,t).onMessage.listen((e=>{if("approved"===e.status){this.isInHiddenShow=!0;const e=void 0===this.hiddenShowStarted||(new Date).getTime()-this.hiddenShowStarted.getTime()<2e3;this.shouldHandleMessage()&&(0,$.Ge)(this.chatConn,e),window.setTimeout((()=>{h.Aw.setState({roomStatus:"hiddenwatching"})}),e?2e3:0)}else"denied"===e.status&&(this.isInHiddenShow=!1,h.Aw.setState({roomStatus:"hidden"}),this.shouldHandleMessage()&&this.chatConn.changeStatus("hidden"))})).addTo(this.listeners.roomUser))}setupPrivateRoomListeners(e,t){var i;if(""!==e){var s,n,o;if(""===t)return this.listeners.private.removeAll(),null===(s=this.privatePresence)||void 0===s||s.leavePresence(),this.joinRoomPresence(e,null!==(n=this.dossier.viewerUid)&&void 0!==n?n:""),this.setupRoomUserListeners(e,null!==(o=this.dossier.viewerUid)&&void 0!==o?o:""),void this.history.fireBuffer();this.listeners.roomUser.removeAll(),null===(i=this.roomPresence)||void 0===i||i.leavePresence(),this.privatePresence=new F.QD(e,t),this.privatePresence.enterPresence(),new F.fn(e,t).onMessage.listen((e=>{if(e.fromUser.username===this.chatConn.username()&&void 0!==e.tid){if(this.messageTimeouts.has(e.tid))return window.clearTimeout(this.messageTimeouts.get(e.tid)),void this.messageTimeouts.delete(e.tid);this.receivedMessageBuffer.push(e.tid)}this.shouldHandleMessage()&&(0,$.Ds)(this.chatConn,{...e,isPrivateShowMessage:!0})})).addTo(this.listeners.private),new F.ZW(e,t).onMessage.listen((e=>{this.shouldHandleMessage()&&(0,$.PJ)(this.chatConn,e),c.U.isEnabledForUserList()&&this.chatConn.event.roomCountUpdate.fire(e.viewers),c.U.setVerifierRoomCount(e.viewers)})).addTo(this.listeners.private),new F.hw(e,t).onMessage.listen((e=>{!this.isBroadcaster&&this.shouldHandleMessage()&&(0,$.YY)(this.chatConn,e),e.fromUser.username===this.chatConn.username()&&this.updateColors(e.fromUser)})).addTo(this.listeners.private)}}setupPrivilegedListeners(e,t){""!==e&&(t?(new N.t1(e).onMessage.listen((()=>{})).addTo(this.listeners.privileged),new N.eB(e).onMessage.listen((e=>{this.chatConn.inPrivateRoom()||(this.shouldHandleMessage()&&(0,$.PJ)(this.chatConn,e),c.U.isEnabledForUserList()&&this.chatConn.event.roomCountUpdate.fire(e.viewers),c.U.setVerifierRoomCount(e.viewers))})).addTo(this.listeners.privileged),new N.fH(e).onMessage.listen((e=>{this.chatConn.inPrivateRoom()||(this.shouldHandleMessage()&&(0,$.PJ)(this.chatConn,e),c.U.isEnabledForUserList()&&this.chatConn.event.roomCountUpdate.fire(e.viewers),c.U.setVerifierRoomCount(e.viewers))})).addTo(this.listeners.privileged),new _.UT(e).onMessage.listen((e=>{!this.isBroadcaster&&this.shouldHandleMessage()&&this.chatConn.event.roomNotice.fire(e)})).addTo(this.listeners.privileged),this.isBroadcaster&&(new N.WQ(e).onMessage.listen((e=>{this.shouldHandleMessage()&&(0,$.lg)(this.chatConn,e)})).addTo(this.listeners.privileged),new u.O$(e).onMessage.listen((e=>{this.shouldHandleMessage()&&"app_tab_refresh"===e.target&&this.chatConn.event.appTabRefresh.fire(void 0)})).addTo(this.listeners.privileged),new u.aT(e).onMessage.listen((e=>{if(e.toUsername===this.chatConn.username())return this.chatConn.inPrivateRoom()&&"public"===e.roomType?(e.ts=void 0,void this.history.push((()=>(0,$.YY)(this.chatConn,e,!0)))):void(this.shouldHandleMessage()&&(0,$.YY)(this.chatConn,e))})).addTo(this.listeners.privileged),new u.mt(e).onMessage.listen((e=>{let t=!1,i=h.Aw.getState().privatePrice;if((0,b.f)("PremPrivShow")&&(t=e.isPremium,i=t?h.Aw.getState().premiumPrivatePrice:i),"requested"===e.status&&(h.Aw.setState({roomStatus:"privaterequesting"}),this.shouldHandleMessage())){var s;const n={userRequesting:null!==(s=e.requester)&&void 0!==s?s:this.chatConn.getPrivateShowUser(),tokensPerMinute:i,isPremium:t,delayFiringEvent:e.delayFiringEvent};(0,$._y)(this.chatConn,n)}})),new u.O_(e).onMessage.listen((e=>{(0,O.nQ)(e)})).addTo(this.listeners.privileged))):this.listeners.privileged.removeAll())}setupFanClubListeners(e,t){""!==e&&(t?new _.qN(e).onMessage.listen((e=>{this.shouldHandleMessage()&&this.chatConn.event.roomNotice.fire(e)})).addTo(this.listeners.fanclub):this.listeners.fanclub.removeAll())}setupColorGroupListeners(e,t,i){if(""===e||void 0===t)return;const s=e=>{this.chatConn.inPrivateRoom()||this.shouldHandleMessage()&&this.chatConn.event.roomNotice.fire(e)};!t.hasTokens||void 0!==i&&i.hasTokens||new _.TP(e).onMessage.listen(s).addTo(this.listeners.color),!t.tippedRecently||void 0!==i&&i.tippedRecently||new _.JS(e).onMessage.listen(s).addTo(this.listeners.color),!t.tippedAlotRecently||void 0!==i&&i.tippedAlotRecently||new _.bu(e).onMessage.listen(s).addTo(this.listeners.color),!t.tippedTonsRecently||void 0!==i&&i.tippedTonsRecently||new _.ZT(e).onMessage.listen(s).addTo(this.listeners.color)}setupGameListener(e){""!==e&&new N.dq(e).onMessage.listen((e=>{I.F.selectionChange.fire(e.game)})).addTo(this.listeners.room)}setupRoomEnterLeaveListener(e,t){this.listeners.enterLeave.removeAll(),new N.C9(e).onMessage.listen((e=>{if(!t){if(this.chatConn.inPrivateRoom())return;this.shouldHandleMessage()&&(0,$.PJ)(this.chatConn,e),c.U.isEnabledForUserList()&&this.chatConn.event.roomCountUpdate.fire(e.viewers),c.U.setVerifierRoomCount(e.viewers)}})).addTo(this.listeners.enterLeave)}joinRoomPresence(e,t){""!==e&&((0,g.ok)()?new N.Uv(e).onSubscribeChange.listen((()=>{})).addTo(this.listeners.room):""!==t&&(void 0===this.roomPresence&&(this.roomPresence=new N.vE(e,t)),this.roomPresence.enterPresence()))}shouldHandleMessage(){return c.U.isEnabledForUI()}setupBackendSwapListener(){(new U).onMessage.listen((e=>{c.U.changeChatHandler(e.backends),this.chatConn.wowzaHandler.ensureConnected()})).addTo(this.listeners.global)}updateColors(e){const t={hasTokens:e.hasTokens,tippedRecently:e.tippedRecently,tippedAlotRecently:e.tippedALotRecently,tippedTonsRecently:e.tippedTonsRecently};h.Aw.setState({userColors:t})}cleanup(){var e,t;null===(e=this.roomPresence)||void 0===e||e.leavePresence(),null===(t=this.privatePresence)||void 0===t||t.leavePresence(),Object.values(this.listeners).forEach((e=>e.removeAll())),this.history.dispose(),this.messageTimeouts.forEach((e=>window.clearTimeout(e))),this.messageTimeouts.clear(),this.receivedMessageBuffer=[]}}var q,j=i(7623),Z=i(6784);class K{constructor(){this.failures=0}millisecondsForRetry(){return this.failures+=1,Math.min(1e4,1e3*this.failures)}reset(){this.failures=0}}i(438);class J{constructor(e,t){this.roomDossier=e,this.chatConn=t,this._websocket=void 0,this.reconnectLimiter=new K,this.remakeWebsocket(),(0,j.OF)()&&(this.handlePagehide=()=>{this.disconnect()},(0,Z.wu)("pagehide",window,this.handlePagehide))}remakeWebsocket(){}readyState(){if(void 0===this._websocket)return"websocket undefined";switch(this._websocket.readyState){case WebSocket.CLOSED:return"closed";case WebSocket.OPEN:return"open";case WebSocket.CLOSING:return"closing";case WebSocket.CONNECTING:return"connecting";default:return"unknown"}}ensureConnected(){var e;void 0!==this._websocket&&this.websocket().readyState===WebSocket.CONNECTING||this.isWebsocketReady()||(debug("restoring websocket"),null===(e=this._websocket)||void 0===e||e.close(),this.remakeWebsocket())}websocket(){return this._websocket}isWebsocketReady(){return void 0!==this._websocket&&this._websocket.readyState===WebSocket.OPEN}setConnectedAndAuthed(){this.reconnectLimiter.reset(),function(e){if(-1!==["onAuthResponse","onPrivateMsg"].indexOf(e.method))return!0;if("onNotify"===e.method&&"push_backends"===new n.N6(e.args[0]).getString("type"))return!0;return!c.U.isEnabledForUI()}({method:"onTitleChange",callback:0,args:[]})&&(0,$.rM)(this.chatConn,this.roomDossier.roomTitle)}disconnect(){void 0!==this._websocket&&(this._websocket.onclose=()=>{},this._websocket.onerror=()=>{},this._websocket.close(),this._websocket=void 0),void 0!==this.handlePagehide&&(0,Z.Pf)("pagehide",window,this.handlePagehide)}sendRawMessage(e){debug(["sending ",e]),this.websocket().send(e)}sendMessage(e){}retryMessage(e,t,i){this.isWebsocketReady()?this.sendRawMessage(JSON.stringify({method:e,data:t})):i<5?window.setTimeout((()=>{this.retryMessage(e,t,i+1)}),1e3):(0,S.bT)("WowzaMsgRetryFailed",{method:e,push_active:c.U.isEnabledForUI()})}}class Y{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.d=e,this.previousStatus="offline",this.status="offline",this.isModerator=!1,this.appDebuggingEnabled=!1,this.privateMinEnd=0,this.privateShowRequestingUser="",this.premiumShowActive=!1,this.premiumRequested=!1,this.isBroadcasting=!1,this.isNewConnection=!1,this.exploringHashTag="",this.sourceName="un",this.roomCountPresenceThrottle=new f.a((()=>{this.roomCountPresence().catch(P.yZ)}),{debounceType:2,bounceLimitMS:9e4}),this.event={messageSent:new y.c_("messageSent"),roomMessage:new y.c_("roomMessage"),roomNotice:new y.c_("roomNotice"),roomShortcode:new y.c_("roomShortcode"),statusChange:new y.c_("statusChange",{listenersWarningThreshold:20}),hiddenMessageChange:new y.c_("hiddenMessageChange"),refreshPanel:new y.c_("refreshPanel"),titleChange:new y.c_("titleChange"),clearApp:new y.c_("clearApp"),removeMessages:new y.c_("removeMessages"),settingsUpdate:new y.c_("settingsUpdate"),roomCountUpdate:new y.c_("roomCountUpdate"),modStatusChange:new y.c_("modStatusChange"),tokenBalanceUpdate:a.D,privateShowRequest:new y.c_("privateShowRequest"),playSound:new y.c_("playSound"),appTabRefresh:new y.c_("appTabRefresh"),appDebugLog:new y.c_("appDebugLog"),tipAlert:new y.c_("tipAlert"),leftRoom:new y.c_("leftRoom"),connectionLost:new y.c_("connectionLost"),onBanSilence:new y.c_("onBanSilence")},this.isNewConnection=!1,this.isBroadcasting=this.username()===this.room(),(0,g.ok)()||(0,r.vu)(),this.isModerator=e.isModerator,this.updateEnterLeaveSettings(e.userChatSettings.roomEntryFor,e.userChatSettings.roomLeaveFor),this.isBroadcasting?this.statusAfterConnected="public":this.statusAfterConnected=e.roomStatus,this.privatePrice=e.privatePrice,this.spyPrice=e.spyPrice,(0,b.f)("FanClubSpying")&&(this.fanClubSpyPrice=e.fanClubSpyPrice),this.premiumShowActive=e.premiumShowActive,this.premiumPrivatePrice=e.premiumPrivatePrice,this.exploringHashTag=this.d.exploringHashTag,this.sourceName=this.d.sourceName,this.wowzaHandler=new J(this.d,this),t&&(this.pushServiceHandler=new G(this.d,this)),"privatewatching"===this.statusAfterConnected&&this.loadLastPrivateInfo(),this.changeStatus("notconnected"),this.listenForIgnores()}appsRunning(){return this.d.appsRunning}disconnect(){var e;this.wowzaHandler.disconnect(),null===(e=this.pushServiceHandler)||void 0===e||e.cleanup()}changeStatus(e){e!==this.status&&(debug(`Status changing from ${this.status} to ${e}`),this.previousStatus=this.status,this.status=e,this.isBroadcasting&&"notconnected"===this.previousStatus&&"public"===this.status&&(0,T.BO)(),this.event.statusChange.fire({previousStatus:this.previousStatus,currentStatus:this.status}))}updateEnterLeaveSettings(e,t){this.isModerator||this.isBroadcasting?(this.roomEntryFor=e,this.roomLeaveFor=t):(this.roomEntryFor=k.XL.ModsAndFans,this.roomLeaveFor=k.XL.ModsAndFans)}isAppDebuggingEnabled(){return this.appDebuggingEnabled}toggleAppDebugging(){this.appDebuggingEnabled=!this.appDebuggingEnabled,R.q_.fire(this.appDebuggingEnabled)}viewerInPrivateChat(){switch(this.status){case"privatewatching":return!0;case"privaterequesting":case"privatenotwatching":case"passwordprotected":case"public":case"away":case"hidden":case"hiddenwatching":case"offline":case"privatespying":case"notconnected":return!1;default:return warn(`unexpected status: ${this.status}`),!1}}sendShortcode(e){if(e.shortcodes.map((e=>e.code.toLowerCase())).includes(d.AJ.Help))return void this.event.roomNotice.fire({messages:[[(0,V.H5)((0,d.CM)(this.room(),this.isBroadcasting))]],showInPrivateMessage:!0});if(h.Bm.current.isNoninteractiveUser)return void(0,p.Q$)(A.R.internalStaffMessage);const t=e.shortcodes.map((e=>{const t={code:e.code};return void 0!==e.msg&&(t.msg=e.msg),void 0!==e.amt&&(t.amt=e.amt),t})),i={room:this.room(),shortcodes:JSON.stringify(t),message:JSON.stringify({m:e.message})};(0,m.KF)("push_service/publish_chat_message_live/",i).then((e=>{var t;let i=null!==(t=e.getResponseHeader("x-banned"))&&void 0!==t?t:e.getResponseHeader("x-denied");null!==i&&(i=decodeURIComponent(i),c.U.isEnabledForUI()&&this.event.roomNotice.fire({messages:[[(0,V.H5)(i)]],showInPrivateMessage:!0}))})).catch((e=>{this.event.roomNotice.fire({messages:[[(0,V.H5)(A.R.shortcodeGeneralError)]],showInPrivateMessage:!0})}))}sendRoomMessage(e){if(h.Bm.current.isNoninteractiveUser)return void(0,p.Q$)(A.R.internalStaffMessage);this.event.messageSent.fire(void 0),(0,S.bT)("SendRoomMessage");const t=e=>{this.wowzaHandler.sendMessage(this.viewerInPrivateChat()?"messagePrivateRoom":"messageRoom",{room:this.d.room,msg:JSON.stringify({m:e,f:"",c:"",tid:""})})};if(void 0===this.pushServiceHandler)return warn("push service send handler not active",{},"PUSH_"),void t(e);const i=this.viewerInPrivateChat();this.pushServiceHandler.sendMessage(this.d.room,e).then((e=>{this.wowzaHandler.sendMessage(i?"messagePrivateRoom":"messageRoom",{room:this.d.room,msg:JSON.stringify(e)})})).catch((i=>{error("Publishing live message",i,"PUSH_"),t(e)}))}updateRoomCount(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];c.U.isEnabledForUserList()||this.wowzaHandler.sendMessage("updateRoomCount",{room_uid:this.d.roomUid,model_name:this.room(),private_room:this.inPrivateRoom()}),e?this.roomCountPresence():this.roomCountPresenceThrottle.callFunc()}roomCountPresence(){if(h.Bm.current.isNoninteractiveUser)return Promise.resolve();const e=h.Aw.getState().privateShowId,t={presence_id:c.U.presenceId};""!==e&&this.inPrivateRoom()&&(t.private_show_id=e);const i=`push_service/room_user_count/${this.room()}/?${(0,M.Go)(t)}`;return(0,m.Aw)(i).then((e=>{if(c.U.isEnabledForUserList()){const t=new n.N6(e.responseText).getNumber("count");this.event.roomCountUpdate.fire(t),c.U.setVerifierRoomCount(t)}})).catch((e=>{warn("roomUserCount",e,"PUSH_")}))}kickUser(e){this.wowzaHandler.sendMessage("kickUser",{user:e,room:this.room()})}requestPrivateShow(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new Promise(((a,l)=>{"public"===this.status?(this.premiumRequested=o,this.wowzaHandler.ensureConnected(),(0,m.KF)(`tipping/private_show_request/${this.room()}/`,{chat_username:this.username(),price:`${e}`,private_show_minimum_minutes:`${t}`,recordings_allowed:`${i}`,premium_show:`${o}`,delay_firing_event:`${r}`}).then((e=>{const t=new n.N6(e.responseText);if(!t.getBoolean("success"))return void l(this.parseShowRequestError(t));this.changeStatus("privaterequesting"),h.Aw.setState({roomStatus:"privaterequesting"});const i=o?A.R.premiumPrivateShowRequestMessage:A.R.privateShowRequestMessage;this.event.roomNotice.fire({messages:[[(0,V.H5)(i)]],foreground:"#222",background:"#ff8b45",weight:"bold",showInPrivateMessage:!0}),a()})).catch((e=>{l(e)}))):l({errorType:T.Df.statusNotAllowed,message:s.i._({id:"dJTyRI",message:"The room must be Public to request a private show."})})}))}requestSpyShow(){return new Promise(((e,t)=>{if("privatenotwatching"===this.status)this.wowzaHandler.ensureConnected(),(0,m.KF)(`tipping/spy_on_private_show_request/${this.room()}/`,{chat_username:this.username()}).then((i=>{const s=new n.N6(i.responseText);s.getBoolean("success")?(this.changeStatus("privatespying"),h.Aw.setState({roomStatus:"privatespying"}),this.event.roomNotice.fire({messages:[[(0,V.H5)("You are spying on the private show")]],foreground:"#222",background:"#ff8b45",weight:"bold",showInPrivateMessage:!0}),e()):t(this.parseShowRequestError(s))})).catch((e=>{t(e)}));else{let e;e="away"===this.status?s.i._({id:"Jf5BNF",message:"You cannot request a spy show when the broadcaster is away."}):s.i._({id:"0AvpsA",message:"The room must currently be in a private show to request a spy show."}),t({errorType:T.Df.statusNotAllowed,message:e})}}))}parseShowRequestError(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=!0===e.getBooleanOrUndefined("low_tokens")?T.Df.lowTokens:T.Df.default;let n=e.getString("message",!1);return""===n&&(n=t?s.i._({id:"D0Tcx6",message:"There was an error joining the spy show"}):s.i._({id:"vK9JNn",message:"There was an error requesting your private show"})),{errorType:i,message:n}}setPrivateShowInfo(e,t){this.privatePrice=e,this.privateMinEnd=Date.now()+60*t*1e3,(0,x.C6)(this.room(),e,this.privateMinEnd)}setPremiumShow(e){this.premiumShowActive=e}leavePrivateOrSpyShow(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(((t,i)=>{const s=`tipping/private_show_cancel/${this.room()}/`;let o={};e&&(o={understands_minimum_charge:!0});const r=this.status;(0,m.KF)(s,o).then((e=>{const s=new n.N6(e.responseText),o=s.getBoolean("success"),a=s.getNumber("remaining_seconds"),l=s.getStringWithNumbers("private_show_minimum_minutes"),d=s.getNumberOrUndefined("tokens_per_minute"),c=Math.ceil(null!=d?d:this.privatePrice*((this.privateMinEnd-Date.now())/6e4));switch(s.logUnusedDebugging("parseCancelResult"),r){case"privatewatching":if(!o)return void i(0===a?{allowCancel:!1,message:A.R.privateShowRequestCancelErrorMessage}:{allowCancel:!0,message:"privateCancelEarly",earlyDetails:{minimumMinutes:l,tokensPerMinute:null!=d?d:this.privatePrice,secondsRemaining:a,tokensRemaining:c}});break;case"privatespying":if(!o)return void i({allowCancel:!1,message:A.R.unableToCancelSpyShow});this.changeStatus("privatenotwatching"),h.Aw.setState({roomStatus:"privatenotwatching"});break;case"privaterequesting":if(!o)return void i({allowCancel:!1,message:A.R.unableToCancelPrivateRequest});break;default:if(warn(`unable to leave private show from status: ${r}`),!o)return void i({allowCancel:!1,message:A.R.unableToLeavePrivateShow(r)})}t()})).catch(i)}))}joinRoom(){this.wowzaHandler.sendMessage("joinRoom",{room:this.room(),exploringHashTag:this.exploringHashTag,source_name:this.sourceName}),this.exploringHashTag="",this.sourceName="df"}leaveRoom(){this.wowzaHandler.sendMessage("leaveRoom",{room:this.room()})}joinPrivateRoom(){window.setTimeout((()=>{this.wowzaHandler.sendMessage("joinPrivateRoom",{room:this.room()})}),500)}leavePrivateRoom(){this.wowzaHandler.sendMessage("leavePrivateRoom",{room:this.room()})}inPrivateRoom(){return"privatewatching"===this.status}inPrivateOrSpy(){return["privatewatching","privatespying"].includes(this.status)}setPrivateShowRequestingUser(e){this.privateShowRequestingUser=e}getPrivateShowUser(){return this.inPrivateRoom()?this.privateShowRequestingUser:""}room(){return this.d.room}age(){return this.d.age}username(){return this.d.userName}ignore(e){if((0,g.ok)())return this.event.roomNotice.fire({messages:[[(0,V.H5)(A.R.loginToUseFeature)]],showInPrivateMessage:!0}),new Promise((()=>!1));if(this.d.room===this.username())return error("Error: cannot ignore users in this room"),new Promise((()=>!1));const t=`${this.username()}-hitMaxIgnore`,i=(0,r.V6)().size>=r.zS;return new Promise((s=>{const n=()=>{i&&(0,o.aR)(t,"1",{days:30});const n=(0,r.V6)();(0,r.Bq)(e).then((t=>{if(t){const e=(0,r.V6)();for(const t of n)e.has(t)||this.event.roomNotice.fire({messages:[[(0,V.H5)(A.R.removedOldestIgnore(t))]],showInPrivateMessage:!0})}else this.event.roomNotice.fire({messages:[[(0,V.H5)(A.R.errorIgnoringUser(e))]],showInPrivateMessage:!0});s(t)})).catch(P.yZ)};void 0===(0,o.y1)(t)&&i?(0,p.mf)(A.R.reachedMaxIgnore,n):n()}))}unignore(e){return(0,r.Kw)(e).then((t=>(t||this.event.roomNotice.fire({messages:[[(0,V.H5)(A.R.errorUnignoringUser(e))]],showInPrivateMessage:!0}),t)))}isIgnored(e){return(0,r.pi)(e)}listenForIgnores(){var e;const t=null===(e=h.Bm.current.loggedInUser)||void 0===e?void 0:e.userUid;if(void 0!==t){const e=new u.T_(t).onMessage.listen((e=>{if(e.isIgnored){const t=A.R.ignoringUser(e.username);this.event.roomNotice.fire({messages:[[(0,V.H5)(t)]],showInPrivateMessage:!0})}else{const t=A.R.noLongerIgnoring(e.username);this.event.roomNotice.fire({messages:[[(0,V.H5)(t)]],showInPrivateMessage:!0})}}));v.Gr.once((()=>e.removeListener()),!1)}}static updateUserInfoFromHashtag(e){switch(e.exploringHashTag){case"promotion":e.exploringHashTag="",e.sourceName="pr";break;case"onlineannouncement":e.exploringHashTag="",e.sourceName="fn"}}roomEntry(e){if(Y.updateUserInfoFromHashtag(e),this.shouldShowJoinLeaveMessage(this.roomEntryFor,e)){const t=this.isBroadcasting?e.exploringHashTag:"",i=[(0,V.H5)((0,C.W2)(this.room(),e)),(0,V.JH)(e),(0,V.H5)(` ${A.R.roomJoinedMessage}`)];""!==t?(i.push((0,V.H5)(" (from ")),i.push((0,V.yP)(t,[t])),i.push((0,V.H5)(")"))):this.isBroadcasting&&"pr"===e.sourceName?i.push((0,V.H5)(" via promotion")):this.isBroadcasting&&"fn"===e.sourceName&&i.push((0,V.H5)(" via online announcement")),i.push((0,V.H5)(".")),this.event.roomNotice.fire({messages:[i],showInPrivateMessage:e.username===this.username(),dataNick:e.username})}}roomLeave(e){if(this.shouldShowJoinLeaveMessage(this.roomLeaveFor,e)){let t=` ${A.R.roomLeftMessage}`;e.isBroadcaster&&!Y.noFollowMessageInStatus.has(this.status)&&(t+=` ${A.R.roomFollowToGetNotified}`),this.event.roomNotice.fire({messages:[[(0,V.H5)((0,C.W2)(this.room(),e)),(0,V.JH)(e),(0,V.H5)(t)]],showInPrivateMessage:e.username===this.username(),dataNick:e.username,noticeType:w.k.RoomLeave})}}shouldShowJoinLeaveMessage(e,t){if(t.username===this.username())return!1;if(t.username===(0,l.fL)())return!0;if(this.inPrivateRoom())return!1;if((0,r.pi)(t.username))return!1;switch(e){case k.XL.None:return!1;case k.XL.ModsAndFans:if(t.username===this.room()||t.isMod||t.inFanclub)return!0;break;case k.XL.ModsFansAndTokens:if(t.username===this.room()||t.isMod||t.inFanclub||t.hasTokens&&(this.isBroadcasting||this.isModerator))return!0;break;case k.XL.AllUsers:if(t.username===this.room()||t.isMod||t.inFanclub||this.isBroadcasting||this.isModerator)return!0;break;default:return error("Invalid EnterLeaveSetting"),!1}return!1}loadLastPrivateInfo(){const e=(0,x.nQ)(this.room());if(""!==e){const t=new n.N6(e);this.privatePrice=t.getNumber("price"),this.privateMinEnd=t.getNumber("end")}}hasAnyMessageOrNoticeBeenAdded(){return this.event.roomNotice.historyLength()>0||this.event.roomMessage.historyLength()>0}}(q=Y).privateViewStatuses=["privatewatching","privatenotwatching","privatespying"],q.noFollowMessageInStatus=new Set(q.privateViewStatuses)},438:(e,t,i)=>{"use strict";i.d(t,{CA:()=>d,IT:()=>g,Lf:()=>y,N4:()=>m,Rh:()=>l,U3:()=>b,Y6:()=>u,YE:()=>c,by:()=>h,ew:()=>p,rI:()=>v,tV:()=>f}),i(4936);var s=i(9461),n=i(7321),o=i(6440),r=i(3959),a=i(9332);function l(e){return{...h(e),gender:e.getStringOrUndefined("gender",!1)}}function h(e){const t=e.getStrings(["from_username","user","username"]);1!==t.size&&error('getStrings(["from_username", "user", "username"]): length is not 1',{data:t,message:e.stringMessage});const i=t.values().next().value;return{username:i,isBroadcaster:i===s.Aw.getState().room,inFanclub:e.getBoolean("in_fanclub"),isFollowing:e.getBooleanOrUndefined("is_following"),hasTokens:e.getBoolean("has_tokens"),isMod:e.getBoolean("is_mod"),tippedRecently:e.getBoolean("tipped_recently"),tippedALotRecently:e.getBoolean("tipped_alot_recently"),tippedTonsRecently:e.getBoolean("tipped_tons_recently"),exploringHashTag:e.getString("exploringHashTag",!1),sourceName:(0,n.Ys)(e.getString("source_name",!1)),gender:e.getStringOrUndefined("gender")}}function d(e,t){!0!==t.getAny("X-Successful")&&error("X-Successful not true?");const i={fromUser:l(t),message:t.getString("m"),font:t.getStringOrUndefined("f",!1),textColor:t.getStringOrUndefined("c",!1),messageID:t.getString("i",!1),backgroundColor:t.getStringOrUndefined("background",!1),tid:t.getString("tid",!1)};return i.fromUser.username!==e&&error("Parsing username match failed"),i}function c(e){return{fromUser:l(e.getParsedSubMap("from_user")),message:e.getString("message"),font:e.getStringOrUndefined("font_family",!1),textColor:e.getStringOrUndefined("font_color",!1),messageID:e.getString("id",!1),backgroundColor:e.getStringOrUndefined("background",!1),tid:e.getString("tid",!1)}}function u(e){return{fromUser:l(e.getParsedSubMap("from_user")),message:e.getString("m"),textColor:e.getStringOrUndefined("c",!1),messageID:e.getString("i",!1),otherUsername:e.getString("other_user"),font:e.getString("f"),mediaList:p(e.getObjectOrUndefined("media")),tid:e.getString("tid",!1),createdAt:new Date(1e3*e.getNumber("created_at")),isPrivate:!0}}function p(e){const t=[];if(void 0===e)return t;for(const i of e)t.push({mediaId:i.media_id,thumbnailUrl:i.media_thumbnail_url,url:i.media_url,opened:i.opened,fromUserUID:i.user_uid});return t}function m(e){return{fromUser:l(e),message:e.getString("message"),amount:e.getNumber("amount"),isAnonymousTip:e.getBoolean("is_anonymous_tip"),toUsername:e.getStringOrUndefined("to_username"),tid:e.getString("tid")}}function g(e){const t={allowPrivateShow:e.getBoolean("allow_privates"),privatePrice:e.getNumber("private_price"),spyPrice:e.getNumber("spy_price"),privateMinMinutes:e.getNumber("private_min_minutes"),allowShowRecordings:e.getBoolean("allow_show_recordings"),activePassword:e.getBoolean("active_password"),tid:e.getString("tid")};return e.logUnusedDebugging("parseSettingsUpdate"),t}function v(e){var t;const i=e.getAny("messages"),s=[];if("string"==typeof i)s.push([(0,a.H5)(`Notice: ${i}`)]);else if(i instanceof Array)for(const e of i)s.push([(0,a.H5)(`Notice: ${e}`)]);else error("handleAppNotice error: Invalid message type",{data:i});const{foreground:n,background:l}=function(){const t=document.body.classList.contains("darkmode"),i=(0,o.f)("SendNoticeDarkModeOpts")&&t;let s=e.getStringOrUndefined("foreground"),n=e.getStringOrUndefined("background");if(i){const t=e.getStringOrUndefined("darkmode_foreground"),i=e.getStringOrUndefined("darkmode_background");void 0!==t&&""!==t&&(s=t),void 0!==i&&""!==i&&(n=i)}return{foreground:s,background:n}}(),h=e.getStringOrUndefined("weight"),d=null!==(t=e.getList("shortcodes"))&&void 0!==t?t:[];return{foreground:n,background:l,weight:""===h?void 0:h,messages:s,showInPrivateMessage:e.getBoolean("showInPrivateMessage",!1,!1),shortcodes:b(d),noticeType:r.k.App,tid:e.getString("tid")}}function f(e){const t=e.getString("type");let i,s;if("log"===t)s=e.getString("message");else if("apperrorlog"===t){const t=e.getAny("message");if(i=[],i.push([(0,a.H5)("App Error: ")]),"string"==typeof t)i.push([(0,a.H5)(t)]);else if(t instanceof Array)for(const e of t)i.push([(0,a.H5)(e)]);else error("parseAppLog error: Invalid message type",{data:t})}else error(`parseAppLog error: Unknown app log type: ${t}`);return{type:t,errorMessages:i,debugMessage:s,tid:e.getString("tid")}}function y(e){return{text:e.getString("text"),notificationType:e.getString("notification_type"),url:e.getString("url"),timestamp:e.getNumber("timestamp"),timeSince:e.getString("time_since"),seen:e.getBoolean("seen",!1,!1)}}function b(e){const t=[];for(const o of e){var i,s,n;t.push({code:o.getString("code"),msg:null!==(i=o.getStringOrUndefined("msg"))&&void 0!==i?i:"",amt:null!==(s=o.getNumberOrUndefined("amt"))&&void 0!==s?s:0,signupLink:null!==(n=o.getStringOrUndefined("signup_link"))&&void 0!==n?n:""})}return t}},7437:(e,t,i)=>{"use strict";i.d(t,{lg:()=>_,K_:()=>B,Ge:()=>H,KM:()=>O,vL:()=>M,GR:()=>k,hp:()=>P,V8:()=>C,Md:()=>E,VW:()=>D,_y:()=>I,gh:()=>x,J1:()=>F,rN:()=>T,PJ:()=>S,Ds:()=>w,$G:()=>N,II:()=>A,YY:()=>U,rM:()=>b,DK:()=>$});var s=i(8638),n=i(3417);class o{static get(e){return void 0===window.ReactAPIRegistry?(error("ReactAPIRegistry is undefined - React code is likely not loaded",{argument:e}),function(){return Promise.reject()}):void 0===window.ReactAPIRegistry[e]?(error(`ReactAPIRegistry does not contain API function ${e} - React code may not be up to date`,{argument:e}),function(){return Promise.reject()}):window.ReactAPIRegistry[e]}}var r=i(1885),a=i(9461),l=i(213),h=i(6440),d=i(819);class c{constructor(e){this.stringParts=[],this.hashtagParts=[];const t=e.match(/#[a-zA-Z0-9\-_]{2,50}/g);if(null!==t)for(const e of t)this.hashtagParts.push(e.substr(1));this.stringParts=e.split(/#[a-zA-Z0-9\-_]{2,50}/g)}}var u=i(1452),p=i(3456),m=i(74),g=i(4947),v=i(4110),f=i(9332);function y(e){return""===e.fromUser.username?(0,f.H5)(g.R.aUser):(0,f.JH)(e.fromUser)}function b(e,t,i){if(""===t)return;const s=[],n=g.R.subjectChangeMessage(t),r=new c(n),l=i=>{for(let e=0;e<r.stringParts.length;e+=1){const t=(0,f.H5)(r.stringParts[e]);t.parseEmoticon=!1,s.push(t),e<r.hashtagParts.length&&s.push((0,f.yP)(r.hashtagParts[e],i))}e.event.roomNotice.fire({messages:[s],colorClass:"titleChange",countsForUnread:e.hasAnyMessageOrNoticeBeenAdded(),foreground:"#DC5500",weight:"bold",showInPrivateMessage:!1}),e.event.titleChange.fire(t)};var h,d;void 0===i?(h=t,d=a.Bm.current.languageCode,o.get("getApprovedTagsFromTitle")(h,d)).then(l).catch((()=>{l([])})):l(i)}function w(e,t){(0,n.pi)(t.fromUser.username)||e.event.roomMessage.fire(t)}function C(e,t,i){if((0,n.pi)(e.fromUser.username))return;const s=void 0===i?t:i;a.Bm.current.mergePmDm?(r.J9.fire(e),r.H4.fire({...e,room:s})):""!==t&&s===t?r.J9.fire(e):""===s&&r.H4.fire({...e,room:s})}function S(e,t){"enter"!==t.action||void 0!==t.connections&&1!==t.connections?"leave"!==t.action||void 0!==t.connections&&0!==t.connections||e.roomLeave(t.user):e.roomEntry(t.user)}function x(e,t){t.username===e.username()&&(e.event.modStatusChange.fire(!0),e.isModerator=!0);const i=(0,f.H5)(g.R.moderatorPromoteMessage(t.fromUser,t.username));e.event.roomNotice.fire({messages:[[i]],showInPrivateMessage:[t.fromUser,t.username].includes(e.username())}),v.xw.fire({isMod:!0,username:t.username})}function T(e,t){t.username===e.username()&&(e.event.modStatusChange.fire(!1),e.isModerator=!1);const i=(0,f.H5)(g.R.moderatorRevokeMessage(t.fromUser,t.username));e.event.roomNotice.fire({messages:[[i]],showInPrivateMessage:[t.fromUser,t.username].includes(e.username())}),v.xw.fire({isMod:!1,username:t.username})}function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.R.kickedFromRoomMessage,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e.event.roomNotice.fire({messages:[[(0,f.H5)(t)]],showInPrivateMessage:!0}),e.changeStatus("notconnected"),(0,d.qK)(e,i)}function k(e){arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?e.event.roomNotice.fire({messages:[[(0,f.H5)(g.R.passwordRemovedMessage)]],showInPrivateMessage:!0}):arguments.length>2&&void 0!==arguments[2]&&arguments[2]||e.isBroadcasting?e.event.roomNotice.fire({messages:[[(0,f.H5)(g.R.passwordSetMessage)]],showInPrivateMessage:!0}):(e.event.roomNotice.fire({messages:[[(0,f.H5)(g.R.chatDisconnectedMessage)]],showInPrivateMessage:!0}),e.changeStatus("passwordprotected"))}function A(e,t){e.event.removeMessages.fire({username:t.username}),(e.username()===t.fromUser||e.username()===t.username||e.username()===e.room()||e.isModerator)&&e.event.roomNotice.fire({messages:[[(0,f.H5)(g.R.silenceMessage(t.username,t.fromUser))]],showInPrivateMessage:[t.fromUser,t.username].includes(e.username())}),e.event.onBanSilence.fire({silenced:t.username,silencer:t.fromUser,isBan:!1})}function M(e,t){e.event.removeMessages.fire({username:t.username}),"privatenotwatching"===e.status||"privatespying"===e.status||e.username()!==t.fromUser&&!e.isModerator||e.event.roomNotice.fire({messages:[[(0,f.H5)(g.R.userKickedAndMessagesRemovedMessage(t.username))]],showInPrivateMessage:t.username===e.username()}),e.event.onBanSilence.fire({silenced:t.username,silencer:t.fromUser,isBan:!0})}let R;function I(e,t){if(e.setPrivateShowRequestingUser(t.userRequesting),t.delayFiringEvent?R=window.setTimeout((()=>{e.event.privateShowRequest.fire(t),R=void 0}),3e3):e.event.privateShowRequest.fire(t),e.isBroadcasting){switch(e.status){case"public":case"away":break;default:warn(`unexpected status: ${e.status}`)}e.changeStatus("privaterequesting")}}function E(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=a.Aw.getState();let s=i.privatePrice,n=i.privateMinMinutes;switch(e.premiumRequested=!1,(0,h.f)("PremPrivShow")&&(e.setPremiumShow(t),a.Aw.setState({premiumShowActive:t}),t&&(s=i.premiumPrivatePrice,n=i.premiumPrivateMinMinutes)),e.status){case"public":e.changeStatus("privatenotwatching");break;case"privaterequesting":e.leaveRoom(),e.joinPrivateRoom(),e.setPrivateShowInfo(s,n),e.changeStatus("privatewatching");break;default:warn(`private show approve unexpected status: ${e.status}`)}let o=(0,f.H5)(g.R.privateShowStartedMessage);if(t&&(o=(0,f.H5)(g.R.premiumPrivateShowStartedMessage)),"privatewatching"===e.status)e.event.roomNotice.fire({messages:[[o]],foreground:"#222",background:"#ff8b45",weight:"bold",showInPrivateMessage:!0,toUser:e.privateShowRequestingUser}),e.isBroadcasting&&!a.Bm.current.isMobile&&e.event.roomNotice.fire({messages:[[(0,f.H5)(g.R.privateShowC2cTip)]],showInPrivateMessage:!0,toUser:e.privateShowRequestingUser});else{let i=[o];t||(i=i.concat([(0,f.H5)(" ("),{partType:3},(0,f.H5)(")")])),e.event.roomNotice.fire({messages:[i],foreground:"#222",background:"#ff8b45",weight:"bold",showInPrivateMessage:!0,toUser:e.privateShowRequestingUser})}m.ef.fire(void 0)}var L;function D(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const o=()=>{if((0,h.f)("PremPrivShow")&&(e.setPremiumShow(!1),a.Aw.setState({premiumShowActive:!1})),e.changeStatus("away"),!e.isBroadcasting){const i=t?g.R.premiumPrivateShowFinishedMessage:g.R.privateShowFinishedMessage;e.event.roomNotice.fire({messages:[[(0,f.H5)(i)]],foreground:"#222",background:"#ff8b45",weight:"bold",showInPrivateMessage:!0})}};switch(e.status){case"privaterequesting":if(e.changeStatus("public"),void 0!==R)clearTimeout(R),R=void 0;else{const o=function(e,t,i,n){let o=t?s.i._({id:"0fESgq",message:"Premium private show request has been cancelled."}):s.i._({id:"IHc3WY",message:"Private show request has been cancelled."});if(e)switch(i){case L.broadcasterDecline:o=t?s.i._({id:"P5Jz0I",message:"Premium private show request has been declined."}):s.i._({id:"2Dheub",message:"Private show request has been declined."});break;case L.userCancel:o=void 0!==n?t?s.i._({id:"hk1ZVK",message:"{requestor} has cancelled their premium private show request.",values:{requestor:n}}):s.i._({id:"znD7fv",message:"{requestor} has cancelled their private show request.",values:{requestor:n}}):t?s.i._({id:"1g+/VU",message:"User has cancelled their premium private show request."}):s.i._({id:"nU4ht/",message:"User has cancelled their private show request."})}else switch(i){case L.broadcasterDecline:o=t?s.i._({id:"oQfnqW",message:"Broadcaster has declined your premium private show request."}):s.i._({id:"LImCxQ",message:"Broadcaster has declined your private show request."});case L.userCancel:}return o}(e.isBroadcasting,t,i,n);e.event.roomNotice.fire({messages:[[(0,f.H5)(o)]],foreground:"#222",background:"#ff8b45",weight:"bold",showInPrivateMessage:!0})}break;case"away":case"hidden":case"public":case"offline":case"hiddenwatching":break;case"privatewatching":e.leavePrivateRoom(),e.joinRoom(),o();break;case"privatespying":case"privatenotwatching":o();break;default:warn(`privateShowCancel wrong room status: ${e.status}`)}m.ef.fire(void 0)}function B(e){switch(e.status){case"away":case"public":case"privaterequesting":e.event.roomNotice.fire({messages:[[(0,f.H5)(g.R.returnFromAwayModeMessage)]],foreground:"#222",background:"#ff8b45",weight:"bold",showInPrivateMessage:!0}),e.changeStatus("public");break;default:error(`unexpected state: ${e.status}`)}}function U(e,t){var i;arguments.length>2&&void 0!==arguments[2]&&arguments[2]||e.event.playSound.fire((i=t.amount)>=1e3?"HugeTip":i>=500?"LargeTip":i>=100?"MediumTip":i>=15?"SmallTip":"TinyTip"),e.event.tipAlert.fire(t);const s=[y(t),(0,f.H5)(` tipped ${t.amount} ${t.amount>1?"tokens":"token"}`)];t.isAnonymousTip&&s.push((0,f.H5)(" anonymously")),e.isBroadcasting&&""!==t.message&&s.push((0,f.H5)(` -- ${t.message}`)),e.event.roomNotice.fire({messages:[s],background:"#ff3",foreground:"#000",weight:"bold",showInPrivateMessage:t.fromUser.username===e.username()||e.isBroadcasting,dataNick:t.fromUser.username,ts:t.ts})}function _(e,t){if("log"===t.type&&void 0!==t.debugMessage)e.event.appDebugLog.fire(t.debugMessage);else if("apperrorlog"===t.type&&void 0!==t.errorMessages){const i={messages:t.errorMessages,showInPrivateMessage:!1};e.event.roomNotice.fire(i)}else error("handleAppDebugError invalid type",t)}function F(e,t){const i=[];"RECORDING_SAVED"===t.message&&(t.message=g.R.privateShowRecordingSavedMessage);for(const e of t.message.split(new RegExp(`\\b${t.fromUser.username}\\b`,"gi")))""===e||i.push((0,f.H5)(e)),i.push((0,f.JH)(t.fromUser));i.pop(),e.event.roomNotice.fire({messages:[i],background:"#33ff33",foreground:"#000",weight:"bold",showInPrivateMessage:t.fromUser.username===e.username(),ts:t.ts})}function N(e,t){if(e.event.settingsUpdate.fire(t),t.allowPrivateShow){if(e.privatePrice!==t.privatePrice){e.privatePrice=t.privatePrice;const i=(0,f.H5)(g.R.privateShowPriceChangeMessage(e.room(),t.privatePrice));e.event.roomNotice.fire({messages:[[i]],showInPrivateMessage:!0}),(0,p.Sz)()&&m.Sj.fire(void 0)}if(e.spyPrice!==t.spyPrice&&0!==t.spyPrice){e.spyPrice=t.spyPrice;const i=(0,f.H5)(g.R.spyShowPriceChangeMessage(e.room(),t.spyPrice));e.event.roomNotice.fire({messages:[[i]],showInPrivateMessage:!0})}if((0,h.f)("FanClubSpying")&&e.fanClubSpyPrice!==t.fanClubSpyPrice&&0!==t.spyPrice){e.fanClubSpyPrice=t.fanClubSpyPrice;const i=(0,f.H5)(g.R.fanClubSpyPriceChangeMessage(e.room(),t.fanClubSpyPrice));e.event.roomNotice.fire({messages:[[i]],showInPrivateMessage:!0})}if((0,h.f)("PremPrivShow")&&e.premiumPrivatePrice!==t.premiumPrivatePrice&&(e.premiumPrivatePrice=t.premiumPrivatePrice,0!==t.spyPrice)){const i=(0,f.H5)(g.R.premiumPrivateShowPriceChangeMessage(e.room(),t.premiumPrivatePrice));e.event.roomNotice.fire({messages:[[i]],showInPrivateMessage:!0})}}}function O(e,t,i){if(!e.isBroadcasting){switch(e.event.hiddenMessageChange.fire(i),e.status){case"privaterequesting":e.leavePrivateOrSpyShow().catch(u.yZ);break;case"public":case"hidden":case"hiddenwatching":case"offline":break;case"away":e.event.roomNotice.fire({messages:[[(0,f.H5)(g.R.returnFromAwayModeMessage)]],foreground:"#222",background:"#ff8b45",weight:"bold",showInPrivateMessage:!0});break;default:error(`handleHiddenShowStatusChange unexpected status: ${e.status}`)}"public"===t?window.setTimeout((()=>{e.changeStatus("public")}),3e3):e.changeStatus(t)}}function H(e,t){t?window.setTimeout((()=>{e.changeStatus("hiddenwatching")}),2e3):e.changeStatus("hiddenwatching")}!function(e){e.broadcasterDecline="broadcaster_decline",e.userCancel="user_cancel",e.declined="declined"}(L||(L={}));let W=!1;function $(e){W||(W=!0,(0,l.Q$)(e,(()=>{W=!1})))}},9332:(e,t,i)=>{"use strict";function s(e){return{partType:1,message:e}}function n(e){return{partType:0,user:e}}function o(e,t){return-1!==t.indexOf(e.toLowerCase())?{partType:2,message:e}:s(`#${e}`)}i.d(t,{H5:()=>s,JH:()=>n,yP:()=>o})},2382:(e,t,i)=>{"use strict";i.d(t,{Ob:()=>l,ko:()=>r,lK:()=>n,oH:()=>a,qv:()=>o});const s={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"};function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{red:200,green:200,blue:200},i=e.toLowerCase();if(i=function(e){if(/^[a-z]+$/.test(e)){const t=s[e];if(void 0!==t)return t}return e}(i),o(i))return function(e){4===e.length&&(e=`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`);const t=Number(`0x${e.substring(1)}`);return{red:t>>16&255,green:t>>8&255,blue:255&t}}(i);if(0===i.indexOf("rgb")){let i=e.match(/\d+(\.\d+)?%?/g);if(null===i||i.length<3||i.length>4)return t;i=[i[0],i[1],i[2]];const s=[];for(let e=0;e<3;e+=1)-1!==i[e].indexOf("%")?s[e]=Math.round(2.55*parseFloat(i[e])):s[e]=Number(i[e]),s[e]<0?s[e]=0:s[e]>255&&(s[e]=255);return{red:s[0],green:s[1],blue:s[2]}}return debug(`Cannot parse color: "${e}"`),t}function o(e){return/^#([a-fA-F0-9]{3}){1,2}$/.test(e)}function r(e,t,i){const s=i*t,n=s*(1-Math.abs(e/60%2-1)),o=i-s,r=Math.round(255*(s+o)),a=Math.round(255*(n+o)),l=Math.round(255*o);return e<=60?{red:r,green:a,blue:l}:e<=120?{red:a,green:r,blue:l}:e<=180?{red:l,green:r,blue:a}:e<240?{red:l,green:a,blue:r}:e<=300?{red:a,green:l,blue:r}:{red:r,green:l,blue:a}}function a(e){const t=n(e),i=t.red/255,s=t.green/255,o=t.blue/255,r=Math.max(i,s,o),a=r-Math.min(i,s,o);let l,h;return l=0===a?0:r===i?(s-o)/a*60:r===s?60*((o-i)/a+2):60*((i-s)/a+4),l<0&&(l+=360),h=0===r?0:a/r,{hue:Math.round(l),saturation:Number(h.toFixed(3)),value:Number(r.toFixed(3))}}function l(e){return(e.red>255||e.green>255||e.blue>255||e.red<0||e.green<0||e.blue<0)&&error(`Invalid rgb color value: r: ${e.red}, g: ${e.green}, b: ${e.blue}`),`000000${(e.red<<16|e.green<<8|e.blue).toString(16)}`.slice(-6)}},2939:(e,t,i)=>{"use strict";i.d(t,{BR:()=>l,Gr:()=>o,Ps:()=>a,X0:()=>n,Zm:()=>r,t7:()=>h});var s=i(8423);const n=new s.c_("roomLoaded",{listenersWarningThreshold:()=>100+3*s.hI,maxHistorySize:1}),o=new s.c_("roomCleanup"),r=new s.c_("userViewedPm"),a=new s.c_("tipSent"),l=new s.c_("context"),h=new s.c_("context")},7197:(e,t,i)=>{"use strict";i.d(t,{e:()=>p});var s=i(3910),n=i(9461),o=i(4140),r=i(1284),a=i(4580),l=i(9815),h=i(1448),d=i(4947),c=i(1372),u=i(4110);class p extends l.q{constructor(e){super(),this.chatConn=e}initListeners(){super.initListeners(),s.oB.listen((e=>{e.isOpen&&this.dontNotify.add(e.username)})).addTo(this.listenerGroup)}shouldNotify(e){const t=this.chatConn.inPrivateRoom()&&(e===this.chatConn.getPrivateShowUser()||e===this.chatConn.room());return super.shouldNotify(e)&&!t}createChatLinkMessage(e){const t={marginLeft:".5em"},i=this.createDmChatLink(e),s=this.createPmChatLink(e),a=n.Bm.current.isMobile&&e!==this.chatConn.room(),l=(0,c.tT)("span",null,(0,c.tT)("span",{style:t},"(",i,")"),!a&&(0,c.tT)("span",{style:t},"(",s,")"));return(0,o.yX)(l,(0,r.Uq)("#aaaaaa")),(0,h.r_)(d.R.newConversationMessageNotice(e),l)}createDmChatLink(e){return this.createChatLink(d.R.newConversationDmClick,(()=>{s.$o.fire(e),n.Bm.current.isMobile&&a.bW.fire(!0)}))}createPmChatLink(e){if(n.Bm.current.isMobile){const e=()=>{a.qb.fire("private")};return this.createChatLink(d.R.newConversationPmClickMobile,e)}{const t=t=>{t.target instanceof HTMLAnchorElement&&u.E3.fire({username:e,focus:!0,showSupporterAlert:!1})};return(0,c.tT)("span",{onClick:t,dangerouslySetInnerHTML:{__html:d.R.newConversationPmClickHTML}})}}createChatLink(e,t){return(0,c.tT)("a",{style:{cursor:"pointer"},colorClass:["msg-link","underline-link"],onClick:t},e)}}},2032:(e,t,i)=>{"use strict";function s(e,t){t.style.left=`${e.left}px`,t.style.top=`${e.top}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`}function n(e){return{left:e.offsetLeft,top:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight}}function o(e,t,i){const s={...e};return s.top=e.top+t,s.height=e.height-t,s.top<0?(s.height+=s.top,s.top=0):s.height<i&&(s.top-=i-s.height,s.height=i),s}function r(e,t,i,s){const n={...e};return n.height=e.height+t,n.top+n.height>s?n.height=s-n.top:n.height<i&&(n.height=i),n}function a(e,t,i){const s={...e};return s.left=e.left+t,s.width=e.width-t,s.left<0?(s.width+=s.left,s.left=0):s.width<i&&(s.left-=i-s.width,s.width=i),s}function l(e,t,i,s){const n={...e};return n.width=e.width+t,n.left+n.width>s?n.width=s-n.left:n.width<i&&(n.width=i),n}i.d(t,{GD:()=>r,U5:()=>a,ly:()=>s,qX:()=>o,w_:()=>n,xn:()=>l})},6669:(e,t,i)=>{"use strict";i.d(t,{Z2:()=>g,op:()=>f,wi:()=>v});var s=i(7623),n=i(5276),o=i(9447),r=i(6784),a=i(1519),l=i(2709),h=i(3955),d=i(9605),c=i(8423),u=i(5412),p=i(7407),m=i(2146);const g=new c.c_("focusingInputFromKeypress",{listenersWarningThreshold:()=>10+c.hI});class v extends l.u{constructor(e,t){super(),this.submitInput=e,this.maxLength=t,this.savedCaret={nodeIdx:-1,nodeOffset:-1},this.recordUndoTimeout=-1,this.undoStack=[{inputContent:"",inputNodes:[],savedCaret:this.savedCaret}],this.undoPointer=0,this.ctrlMetaKeydownsIE=new Set,this.disableRequestUndo=!1,this.restoringBrowserUndo=!1,this.elementIsFocused=!1,this.listeners=new c.gt,this.maxLength=t,this.element.classList.add("customInput"),this.element.classList.add("noScrollbar"),this.element.style.position="relative",this.element.style.outline="none",this.element.style.border="none",this.element.style.boxSizing="border-box",this.element.style.fontSize="12px",this.element.style.whiteSpace="nowrap",this.element.style.overflowY="hidden",this.element.style.overflowX="scroll",this.element.contentEditable="true",(0,m.PF)(this.element,"text");const i=new a.a((()=>{this.doUndo(!0)}),{bounceLimitMS:10,debounceType:0}),n=new a.a((()=>{this.doRedo(!0)}),{bounceLimitMS:10,debounceType:0}),o=new a.a((()=>{this.onPossibleEmoji()}),{bounceLimitMS:10,debounceType:1});let l=!1,h=!1;(0,r.wu)("input",this.element,(e=>{var t;const r="\n"===(null===(t=e.data)||void 0===t?void 0:t.charAt(e.data.length-1));if(!h&&r)return e.preventDefault(),void this.submit();l||this.restoringBrowserUndo||(l=!0,"historyUndo"===e.inputType?i.callFunc():"historyRedo"===e.inputType?n.callFunc():((0,s.AD)()||o.callFunc(),this.requestRecordUndo(!0)),this.updatePlaceholderVisibility(),this.saveCaretPos(),l=!1)})),(0,s.lT)()&&window.setInterval((()=>{document.activeElement===this.element&&this.onPossibleEmoji()}),200),(0,r.wu)("paste",this.element,(e=>{if(e.preventDefault(),null!==e.clipboardData){let t;t=null!==window.clipboardData&&void 0!==window.clipboardData?window.clipboardData.getData("Text"):e.clipboardData.getData("text/plain"),this.insertText(t)}})),(0,r.wu)("click",this.element,(e=>{if(null!==e.target&&e.target!==this.element){const t=window.getSelection();if(null!==t){const i=document.createRange(),s=e.target;e.offsetX<s.offsetWidth/2?i.setStartBefore(s):i.setStartAfter(s),i.collapse(!0),t.removeAllRanges(),t.addRange(i)}}this.saveCaretPos()})),(0,r.wu)("keydown",this.element,(e=>{h="Unidentified"!==e.key,"Enter"===e.key?(e.preventDefault(),this.submit()):this.willKeyEventViolateMaxLength(e)?e.preventDefault():(e.ctrlKey||e.metaKey)&&(-1!==["u","b","i"].indexOf(e.key)?e.preventDefault():"z"!==e.key||e.shiftKey?("z"===e.key&&e.shiftKey||"y"===e.key)&&(this.doRedo(),e.preventDefault()):(this.doUndo(),e.preventDefault()),this.ctrlMetaKeydownsIE.add(e.key)),this.updatePlaceholderVisibility()})),(0,r.wu)("keyup",this.element,(e=>{(0,s.lT)()&&(0,u.x)(e.which)&&(!this.ctrlMetaKeydownsIE.has(e.key)||e.repeat)?this.onInputChanged():-1===["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].indexOf(e.key)&&-1===["MetaLeft","MetaRight"].indexOf(e.code)||this.saveCaretPos(),this.ctrlMetaKeydownsIE.delete(e.key)})),(0,r.wu)("focus",this.element,(()=>{var e;this.elementIsFocused=!0,void 0!==this.placeholder&&(null===(e=this.placeholder.parentElement)||void 0===e||e.removeChild(this.placeholder))})),(0,r.wu)("blur",this.element,(()=>{this.elementIsFocused=!1,void 0!==this.placeholder&&""===this.getText()&&this.element.appendChild(this.placeholder),this.updatePlaceholderVisibility(),this.ctrlMetaKeydownsIE.clear()})),g.listen((e=>{this.willKeyEventViolateMaxLength(e)&&e.preventDefault()})).addTo(this.listeners)}setText(e){this.disableRequestUndo=!0,this.clearText(),this.insertText(e),this.element.scrollLeft=this.element.scrollWidth,this.disableRequestUndo=!1}insertText(e){if(""===e)return;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.setCaretToEnd(),this.focus(!0),this.forceRequestedRecordUndo(),this.areAnyContentsSelected()){const e=window.getSelection();null!==e&&e.rangeCount>0&&e.getRangeAt(0).deleteContents()}if(e=(e=e.replace(/\r?\n|\r/g," ")).replace(/ /g," "),""===(e=v.truncateString(e,this.getAvailableLength())))return;const t=this.createDivForText(e),i=window.getSelection();if(null!==i&&i.rangeCount>0){const e=i.getRangeAt(0),s=[...t.childNodes].reverse(),n=s[0];for(const t of s)e.insertNode(t);e.setStartAfter(n),e.collapse(!0),i.removeAllRanges(),i.addRange(e)}this.onInputChanged(),this.updatePlaceholderVisibility(),this.scrollToSavedCaret()}createDivForText(e){const t=document.createElement("div");if(t.textContent=e,!(0,s.AD)()){const e={unselectable:"on"};n.A.parse(t,{attributes:t=>e})}return t}appendText(e){this.insertText(e,!0)}clearText(){if(""===this.getText())return;this.forceRequestedRecordUndo();const e=window.getSelection();if(null!==e){const t=document.createRange();t.selectNodeContents(this.element),e.removeAllRanges(),e.addRange(t),t.deleteContents(),t.collapse(!0)}this.onInputChanged()}getText(){let e="",t=!1;for(const i of this.element.childNodes)if(i instanceof HTMLImageElement)e+=i.alt,t=!0;else{if(i===this.placeholder)continue;null!==i.textContent&&(!t||":"!==i.textContent[0]&&"@"!==i.textContent[0]||(e+=" "),e+=i.textContent,t=!1)}return e.replace(/\s/g," ")}getAvailableLength(){return this.maxLength-this.getText().length}setCaretToEnd(){const e=window.getSelection();if(null!==e){const t=document.createRange();t.selectNodeContents(this.element),t.collapse(!1),e.removeAllRanges(),e.addRange(t),this.saveCaretPos()}}setCaretToEndOfSelection(){const e=window.getSelection();if(null!==e&&e.rangeCount>0){const t=e.getRangeAt(e.rangeCount-1);t.collapse(!1),e.removeAllRanges(),e.addRange(t)}else this.focus(!0)}setCurrentNodeText(e){document.activeElement!==this.element&&this.restoreCaretPos();const t=this.getNodeAtCaret(),i=window.getSelection();if(null!==i){t.textContent=e;const s=document.createRange();s.selectNodeContents(t),s.collapse(!1),i.removeAllRanges(),i.addRange(s)}}getCurrentNodeText(){const e=this.getNodeAtCaret();return null!==e.textContent?e.textContent.replace(/\s/g," "):""}selectCurrentNodeTail(e){const t=this.getNodeAtCaret(),i=window.getSelection();if(null!==i&&i.rangeCount>0){const s=document.createRange();s.selectNodeContents(t),s.setStart(t,e),this.scrollToSavedCaret(),i.removeAllRanges(),i.addRange(s)}}deleteSelection(){const e=window.getSelection();if(null!==e&&e.rangeCount>0){const t=e.getRangeAt(0);t.startContainer!==this.element&&this.element.contains(t.startContainer)&&(this.requestRecordUndo(!1),t.deleteContents(),this.onInputChanged())}}focus(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];document.activeElement!==this.element&&document.body.contains(this.element)&&(t&&!(0,h.YG)(this.element)&&(this.element.scrollIntoView(!1),window.scrollBy(0,12)),this.element.focus(),e?this.restoreCaretPos():this.setCaretToEnd(),this.scrollToSavedCaret())}blur(){this.element.blur()}disable(){this.blur(),this.element.contentEditable="false"}enable(){this.element.contentEditable="true"}setPlaceholder(e,t){void 0===this.placeholder?(this.placeholder=document.createElement("span"),this.placeholder.textContent=e,this.placeholder.style.pointerEvents="none",this.placeholder.contentEditable="false",void 0!==t&&(0,o.fZ)(this.placeholder,t),this.element.appendChild(this.placeholder)):this.placeholder.textContent=e}submit(){if(this.submitInput()){if(!(0,s.AD)()){const e=this.element.innerHTML,t=/<img[^>]+alt="?([^"\s]+)"?\s*/g;let i=t.exec(e);for(;null!==i;)(0,p.bT)("emojiSent",{value:i[1]}),i=t.exec(e)}this.clearText(),this.blur()}}onPossibleEmoji(){const e=window.getSelection();if(null!==e&&e.rangeCount>0){const t=this.getNodeAtCaret();if(null!==t.textContent&&n.A.test(t.textContent)){const i=t.textContent,s=document.createRange();s.selectNodeContents(t),e.removeAllRanges(),e.addRange(s),s.deleteContents(),this.insertText(i);const n=this.getNodeAtCaret();""!==n.textContent&&(s.setStartBefore(n),s.collapse(!0),e.removeAllRanges(),e.addRange(s),this.saveCaretPos())}}}areAnyContentsSelected(){const e=window.getSelection();if(null!==e&&e.rangeCount>0&&document.activeElement===this.element){const t=e.getRangeAt(0);if(t.startContainer!==t.endContainer||t.startOffset!==t.endOffset)return!0}return!1}willKeyEventViolateMaxLength(e){return!(this.getAvailableLength()>0)&&(!e.ctrlKey&&!e.metaKey&&(0,u.x)(e.which)&&-1===["Backspace","Delete"].indexOf(e.key)&&!this.areAnyContentsSelected())}onInputChanged(){this.saveCaretPos(),this.requestRecordUndo(!0)}requestRecordUndo(e){window.clearTimeout(this.recordUndoTimeout),this.recordUndoTimeout=-1,this.disableRequestUndo||(e?this.recordUndoTimeout=window.setTimeout((()=>{this.recordUndo(),this.recordUndoTimeout=-1}),300):this.recordUndo())}forceRequestedRecordUndo(){-1!==this.recordUndoTimeout&&(window.clearTimeout(this.recordUndoTimeout),this.recordUndoTimeout=-1,this.recordUndo())}recordUndo(){this.saveCaretPos();const e=this.getText();this.undoStack.splice(this.undoPointer+1,this.undoStack.length),this.undoStack[this.undoStack.length-1].inputContent===e&&this.undoStack.pop();const t=[...this.element.childNodes].map((e=>e.cloneNode(!0)));this.undoStack.push({inputContent:e,inputNodes:t,savedCaret:this.savedCaret}),this.undoStack.length>20&&this.undoStack.shift(),this.undoPointer=this.undoStack.length-1,this.keepBrowserUndoAvailable(!1)}doUndo(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(0,p.bT)(e?"BrowserTriggeredUndo":"HotkeyTriggeredUndo"),this.undoPointer!==this.undoStack.length-1||e||this.requestRecordUndo(!1),this.undoPointer>0&&(this.undoPointer-=1,this.applyUndoData(this.undoStack[this.undoPointer]),this.keepBrowserUndoAvailable(!0))}doRedo(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(0,p.bT)(e?"BrowserTriggeredRedo":"HotkeyTriggeredRedo"),this.undoPointer<this.undoStack.length-1&&(this.undoPointer+=1,this.applyUndoData(this.undoStack[this.undoPointer]),this.keepBrowserUndoAvailable(this.undoPointer<this.undoStack.length-1))}applyUndoData(e){this.element.innerHTML="",e.inputNodes.forEach((e=>{this.element.appendChild(e.cloneNode())})),this.savedCaret=e.savedCaret,this.restoreCaretPos(),this.scrollToSavedCaret()}keepBrowserUndoAvailable(e){if(!this.elementIsFocused||document.queryCommandSupported("insertText"))return;this.restoringBrowserUndo=!0;const t=()=>{document.execCommand("insertText",!1,"~"),document.execCommand("delete",!1)},i=window.getSelection();if(null!==i&&i.rangeCount>0){const e=i.getRangeAt(0);i.removeAllRanges(),t(),i.addRange(e)}else t();this.restoringBrowserUndo=!1}getNodeAtCaret(){return this.saveCaretPos(),0===this.element.childNodes.length?this.element:-1===this.savedCaret.nodeIdx?this.element.childNodes[0]:this.element.childNodes[this.savedCaret.nodeIdx]}caretLeftOffset(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.getCaretRange(e).getBoundingClientRect().left}caretXPos(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.caretLeftOffset(e)-this.element.getBoundingClientRect().left}caretAtEndOfInput(){const e=this.getCurrentNodeText().length;return!(e>0&&this.savedCaret.nodeOffset!==e)&&![...this.element.childNodes].slice(this.savedCaret.nodeIdx+1).some((e=>{var t,i;return"IMG"===e.nodeName||(null!==(t=null===(i=e.textContent)||void 0===i?void 0:i.length)&&void 0!==t?t:0)>0}))}getCaretWordStartRange(e){var t,i;const s=e.startContainer;if(0===(null!==(t=null==s||null===(i=s.textContent)||void 0===i?void 0:i.length)&&void 0!==t?t:0))return e;if(null!==window.getSelection()){for(;e.startOffset>0;){const t=e.toString();if(/^\s/.test(t)){e.setStart(s,e.startOffset+1);break}e.setStart(s,e.startOffset-1)}return e}return document.createRange()}getCaretRange(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=document.createRange();if(0===this.element.childNodes.length)return t.setStart(this.element,0),t;const i=this.element.childNodes[this.savedCaret.nodeIdx];return-1===this.savedCaret.nodeIdx?t.setStartBefore(this.element.childNodes[0]):""===i.textContent?t.setStartAfter(i):t.setStart(i,this.savedCaret.nodeOffset),e?this.getCaretWordStartRange(t):t}saveCaretPos(){const e=window.getSelection();if(null!==e&&e.rangeCount>0&&document.activeElement===this.element){const t=e.getRangeAt(0).cloneRange();let i;if(t.collapse(!1),i=t.startContainer===this.element?t.startOffset-1:Array.from(this.element.childNodes).indexOf(t.startContainer),-1===i)this.savedCaret={nodeIdx:-1,nodeOffset:-1};else if(""===this.element.childNodes[i].textContent)this.savedCaret={nodeIdx:i,nodeOffset:-1};else{const e=this.element.childNodes[i].textContent,s=t.startContainer===this.element?e.length:t.startOffset;this.savedCaret={nodeIdx:i,nodeOffset:s}}}}restoreCaretPos(){if(0===this.element.childNodes.length||this.savedCaret.nodeIdx>=this.element.childNodes.length)return;const e=window.getSelection();if(null!==e){const t=this.getCaretRange();t.collapse(!0),e.removeAllRanges(),e.addRange(t)}}scrollToSavedCaret(){let e=0;if(-1!==this.savedCaret.nodeIdx){const t=this.element.childNodes[this.savedCaret.nodeIdx],i=document.createRange();i.setStart(this.element,0),i.setEndAfter(t),e=i.getBoundingClientRect().width}e+=3,this.element.scrollLeft=Math.max(this.element.scrollLeft,e-this.element.offsetWidth)}static truncateString(e,t){if(e.length<=t)return e;let i=-1,s=0;for(const o of e){if(s+o.length>t)break;n.A.test(o)&&(i=s),s+=o.length}if(-1!==i){const s=(0,d.yd)(e.substr(i,e.length));if(void 0!==s&&i+s.emojiChars.length>t)return e.substr(0,i)}return e.substr(0,s)}updatePlaceholderVisibility(){""!==this.getText()?this.element.classList.remove("inputFieldChatPlaceholder"):this.element.classList.add("inputFieldChatPlaceholder")}dispose(){this.listeners.removeAll()}getCurrentNodePreCaretText(){return this.getCurrentNodeText().substring(0,this.savedCaret.nodeOffset)}getCurrentNodePostCaretText(){return this.getCurrentNodeText().substring(this.savedCaret.nodeOffset)}replaceCurrentNodePreCaretText(e,t,i){const s=this.getCurrentNodePreCaretText().replace(e,t);i<0&&(error("CustomInput replaceCurrentNodePreCaretText with highlightLength < 0"),i=0),this.setCurrentNodeText(s+this.getCurrentNodePostCaretText()),this.setCurrentNodeSelection(s.length-i,s.length)}setCurrentNodeSelection(e,t){const i=this.getNodeAtCaret(),s=window.getSelection();if(null!==s&&s.rangeCount>0){const o=document.createRange();o.selectNodeContents(i);try{o.setStart(i,e),o.setEnd(i,t),s.removeAllRanges(),s.addRange(o),this.saveCaretPos(),this.scrollToSavedCaret()}catch(s){var n;throw error("setCurrentNodeSelectionError",{error:s,nodeContent:i.textContent,inputContent:this.getText(),nodeLen:null===(n=i.textContent)||void 0===n?void 0:n.length,start:e,end:t}),s}}}}class f extends l.u{constructor(e){super(),this.inputElement=e,this.element=e}caretLeftOffset(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=this.inputElement.value.substring(0,null!==(e=null===(t=this.getCurrentSelection())||void 0===t?void 0:t.start)&&void 0!==e?e:0);if(i){for(;s.length>0&&!/^\s/.test(s);)s=s.slice(0,-1);s=this.inputElement.value.substring(0,s.length+1)}return(0,h.q_)(s,this.inputElement)}caretXPos(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.caretLeftOffset(e)+this.element.getBoundingClientRect().left}getAvailableLength(){return this.inputElement.maxLength-this.inputElement.value.length}appendText(e){this.inputElement.value=`${this.inputElement.value}${e}`}setCaretToEnd(){this.setCaretPosition(this.inputElement.value.length)}setCaretToEndOfSelection(){const e=this.getCurrentSelection();void 0!==e&&this.setCaretPosition(e.end)}getCaretPosition(){var e;return null===(e=this.getCurrentSelection())||void 0===e?void 0:e.end}setCaretPosition(e){this.selectRange(e,e)}getCurrentSelection(){return void 0!==this.pendingSelection?this.pendingSelection:null===this.inputElement.selectionStart||null===this.inputElement.selectionEnd?void 0:{start:this.inputElement.selectionStart,end:this.inputElement.selectionEnd}}getCurrentNodePreCaretText(){var e;return this.inputElement.value.substring(0,null!==(e=this.getCaretPosition())&&void 0!==e?e:0).replace(/\s/g," ")}scrollToEndOfSelection(){var e,t;const i=this.inputElement.value.substring(0,null!==(e=null===(t=this.getCurrentSelection())||void 0===t?void 0:t.end)&&void 0!==e?e:0),s=(0,h.q_)(i,this.inputElement);this.element.scrollLeft=Math.max(this.element.scrollLeft,s-(0,h.Q)(this.element)+4)}getCurrentNodeText(){return this.inputElement.value.replace(/\s/g," ")}getCurrentNodePostCaretText(){var e;return this.inputElement.value.substring(null!==(e=this.getCaretPosition())&&void 0!==e?e:this.inputElement.value.length).replace(/\s/g," ")}replaceCurrentNodePreCaretText(e,t,i){const s=this.getCurrentNodePreCaretText().replace(e,t);i<0&&(error("InputAsCustomInput replaceCurrentNodePreCaretText with highlightLength < 0"),i=0),this.inputElement.value=s+this.getCurrentNodePostCaretText(),this.selectRange(s.length-i,s.length)}insertText(e){this.replaceCurrentNodePreCaretText(/$/,e,0)}selectRange(e,t){this.inputElement.focus(),this.pendingSelection={start:e,end:t},window.setTimeout((()=>{this.inputElement.setSelectionRange(e,t),this.scrollToEndOfSelection(),this.pendingSelection=void 0}),0)}deleteSelection(){const e=this.getCurrentSelection();if(void 0!==e){const t=this.inputElement.value.substring(0,e.start),i=this.inputElement.value.substring(e.end);this.inputElement.value=t+i,this.setCaretPosition(t.length)}}focus(){this.inputElement.focus()}blur(){this.inputElement.blur()}}},1519:(e,t,i)=>{"use strict";i.d(t,{a:()=>s,v:()=>n});class s{constructor(e,t){this.func=e,this.config=t,this.recentlyLetPassthrough=!1,this.callImmediate=!1}callFunc(){if(1===this.config.debounceType)return clearTimeout(this.debounceTimeout),void(this.debounceTimeout=window.setTimeout(this.func,this.config.bounceLimitMS));const e=()=>{this.callImmediate&&2===this.config.debounceType?(this.callImmediate=!1,this.func(),window.setTimeout(e,this.config.bounceLimitMS)):this.recentlyLetPassthrough=!1};this.recentlyLetPassthrough?this.callImmediate=!0:(this.recentlyLetPassthrough=!0,this.func(),window.setTimeout(e,this.config.bounceLimitMS))}}class n extends s{constructor(e){super((()=>{this.isStart=!0,e(!1)}),{bounceLimitMS:300,debounceType:1}),this.fn=e,this.isStart=!0}callFunc(){this.isStart&&(this.isStart=!1,this.fn(!0)),super.callFunc()}}},9259:(e,t,i)=>{"use strict";i.r(t),i.d(t,{debug:()=>a,error:()=>n,info:()=>r,warn:()=>o});var s=i(7193);const n=s.z3,o=s.R8,r=s.pq,a=s.Yz;window.onerror=(e,t,i,s,o)=>{let r;try{r=JSON.stringify(o)}catch(e){r=`${o}`}const a=[`"Message: " ${e}`,`"URL: "  ${t}`,`"Line: " ${i}`,`"Column: " ${s}`,`"Error object: " ${r}`].join("\n");return n(a,{},"UNCAUGHT_"),!1}},106:(e,t,i)=>{"use strict";i.d(t,{J:()=>n});var s=i(2509);class n{constructor(){this.drawPile=new s.C,this.discardPile=new s.C}addToTop(e){this.currentElem!==e&&(this.discardPile.remove(e),this.drawPile.addToTop(e))}nextElem(){const e=this.drawPile.popFromTop();return void 0!==this.currentElem&&this.discardPile.addToTop(this.currentElem),this.currentElem=e,e}prevElem(){const e=this.discardPile.popFromTop();return void 0!==this.currentElem&&this.drawPile.addToTop(this.currentElem),this.currentElem=e,e}refillFromDiscard(){for(;;){const e=this.discardPile.popFromBottom();if(void 0===e)break;this.drawPile.addToBottom(e)}void 0!==this.currentElem&&(this.drawPile.addToBottom(this.currentElem),this.currentElem=void 0)}emptyDrawIntoDiscard(){for(;;){const e=this.drawPile.popFromBottom();if(void 0===e)break;this.discardPile.addToBottom(e)}void 0!==this.currentElem&&(this.discardPile.addToBottom(this.currentElem),this.currentElem=void 0)}remove(e){this.discardPile.remove(e),this.drawPile.remove(e),this.currentElem===e&&(this.currentElem=void 0)}makeCurrent(e){this.currentElem!==e&&(this.addToTop(e),this.nextElem())}}},2709:(e,t,i)=>{"use strict";i.d(t,{u:()=>n});var s=i(8423);class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1?arguments[1]:void 0;this._children=[],this.hasInitUI=!1,this.didRepositionEvent=new s.c_("didReposition",{reportIfNoListeners:!1}),this.element="string"==typeof e?this.createBaseElement(e,t):e,this.initData(t),this.initUI(t),this.element.setAttribute("ts",`${this.constructor.name}`)}createBaseElement(e,t){const i=document.createElement(e);return i.style.height="100%",i.style.width="100%",i.style.position="absolute",i.style.overflow="hidden",i.style["-webkit-tap-highlight-color"]="transparent",i}initData(e){}initUI(e){}lazyInitUI(){this.hasInitUI=!0}repositionChildren(){}repositionChildrenRecursive(){this.repositionChildren();for(const e of this.children())e.repositionChildrenRecursive();this.didRepositionEvent.fire(void 0)}afterDOMConstructed(){}afterDOMConstructedIncludingChildren(){this.afterDOMConstructed();for(const e of this.children())e.afterDOMConstructedIncludingChildren()}addChild(e,t){return this.attachChild(e),void 0===t&&(t=this.element),e.hasInitUI||e.lazyInitUI(),t.appendChild(e.element),e}prependChild(e,t){return this.attachChild(e,0),void 0===t&&(t=this.element),t.insertBefore(e.element,this.element.firstChild),e}addChildBeforeIndex(e,t,i){if(t>this._children.length||t<0)return error("tried to add item before an index that does not exist"),e;if(void 0===i&&(i=this.element),e.hasInitUI||e.lazyInitUI(),t===this._children.length)this.attachChild(e),i.appendChild(e.element);else{const s=this._children[t].element;this.attachChild(e,t),i.insertBefore(e.element,s)}return e}attachChild(e,t){void 0!==e.parent&&e.parent!==this&&e.parent.removeChild(e),void 0===t?this._children.push(e):this._children.splice(t,0,e),e.parent=this}addChildBefore(e,t){void 0!==e.parent&&e.parent!==this&&e.parent.removeChild(e);const i=void 0===t?-1:this._children.indexOf(t);return i<0?this.element.appendChild(e.element):this.element.insertBefore(e.element,this._children[i].element),this._children.splice(i,0,e),e.parent=this,e}removeChild(e){const t=this._children.indexOf(e);if(-1!==t){this._children.splice(t,1),e.parent===this&&(e.parent=void 0),this.cleanupChildDOM(e);for(const t of e.children())t.afterRemovedFromParent();e.afterRemovedFromParent()}else error("tried removing component that doesn't exist")}cleanupChildDOM(e){const t=e.element.parentNode;null!==t?t.removeChild(e.element):error("couldn't find parent element to use for node removal")}removeAllChildren(){for(const e of this.children())e.parent===this&&(e.parent=void 0),this.cleanupChildDOM(e),e.afterRemovedFromParent();this._children=[]}removeAllDOMChildren(){for(;null!==this.element.firstChild;)this.element.removeChild(this.element.firstChild)}children(){return this._children}siblings(){return void 0===this.parent?[]:this.parent._children.filter((e=>e!==this))}afterRemovedFromParent(){}showElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"block";this.element.style.display=void 0===this.originalDisplayStyle?e:this.originalDisplayStyle}showOrHideElement(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";e?this.showElement(t):this.hideElement()}hideElement(){"none"!==this.element.style.display&&(""!==this.element.style.display&&(this.originalDisplayStyle=this.element.style.display),this.element.style.display="none")}isShown(){return"none"!==this.element.style.display}toggleShowHide(){this.isShown()?this.hideElement():this.showElement()}previousSibling(){if(void 0!==this.parent)return this.findPreviousSibling(this.parent.children())}nextSibling(){if(void 0!==this.parent)return this.findPreviousSibling(this.parent.children().slice().reverse())}lastChild(){return this.children().length>0?this.children()[this.children().length-1]:void 0}findPreviousSibling(e){let t;for(const i of e){if(i===this)break;t=i}return t}}},82:(e,t,i)=>{"use strict";i.d(t,{b:()=>o});var s=i(1372),n=i(2709);class o extends n.u{constructor(e){super(void 0,e)}initData(e){super.initData(e)}createBaseElement(e,t){return this.state=this.initState(t),this.createElement(t)}createElement(e){return super.createBaseElement("div",e)}render(){return this.element}setState(e){for(const t in e)e.hasOwnProperty(t)&&(this.state[t]=e[t]);this.updateState()}updateState(){(0,s.zN)(this.element).forEach((e=>{e instanceof Function?e():e!==this&&e.updateState()}))}initState(e){return{}}}},5020:(e,t,i)=>{"use strict";i.d(t,{Hq:()=>h,Uv:()=>r,Wi:()=>s,Wj:()=>o,Wr:()=>a});var s,n=i(9447);function o(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;const o=document.createElement("div");o.style.position="absolute",o.style.height="0",o.style.width="0",o.style.top="-8px",void 0!==i&&(o.style.left=i);const r=document.createElement("div");(0,n.fZ)(r,"divotBorder"),r.style.borderLeft="8px solid transparent",r.style.borderRight="8px solid transparent",r.style.borderBottomWidth="8px",r.style.borderBottomStyle="solid",""!==e&&(r.style.borderBottomColor=`${e}`),o.appendChild(r);const a=8-s,l=document.createElement("div");return(0,n.fZ)(l,"divotBackground"),l.style.position="absolute",l.style.top=`${s}px`,l.style.left=`${s}px`,l.style.borderLeft=`${a}px solid transparent`,l.style.borderRight=`${a}px solid transparent`,l.style.borderBottomWidth=`${a}px`,l.style.borderBottomStyle="solid",""!==t&&(l.style.borderBottomColor=`${t}`),r.appendChild(l),o}function r(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;const o=document.createElement("div");o.style.position="absolute",o.style.height="0",o.style.width="0",o.style.bottom="0",void 0!==i&&(o.style.left=i);const r=document.createElement("div");(0,n.fZ)(r,"divotBorder"),r.style.borderLeft="8px solid transparent",r.style.borderRight="8px solid transparent",r.style.borderTopWidth="8px",r.style.borderTopStyle="solid",""!==e&&(r.style.borderTopColor=`${e}`),o.appendChild(r);const a=8-s,l=document.createElement("div");return(0,n.fZ)(l,"divotBackground"),l.style.position="absolute",l.style.top="0",l.style.left=`${s}px`,l.style.borderLeft=`${a}px solid transparent`,l.style.borderRight=`${a}px solid transparent`,l.style.borderTopWidth=`${a}px`,l.style.borderTopStyle="solid",""!==t&&(l.style.borderTopColor=`${t}`),r.appendChild(l),o}function a(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;const o=document.createElement("div");o.style.position="absolute",o.style.height="0",o.style.width="0",o.style.left="-8px",void 0!==i&&(o.style.top=i);const r=document.createElement("div");(0,n.fZ)(r,"divotBorder"),r.style.borderTop="8px solid transparent",r.style.borderBottom="8px solid transparent",r.style.borderRightWidth="8px",r.style.borderRightStyle="solid",""!==e&&(r.style.borderRightColor=`${e}`),o.appendChild(r);const a=8-s,l=document.createElement("div");return(0,n.fZ)(l,"divotBackground"),l.style.position="absolute",l.style.top=`${s}px`,l.style.left=`${s}px`,l.style.borderTop=`${a}px solid transparent`,l.style.borderBottom=`${a}px solid transparent`,l.style.borderRightWidth=`${a}px`,l.style.borderRightStyle="solid",""!==t&&(l.style.borderRightColor=`${t}`),r.appendChild(l),o}function l(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;const o=document.createElement("div");o.style.position="absolute",o.style.height="0",o.style.width="0",o.style.right="0",void 0!==i&&(o.style.top=i);const r=document.createElement("div");(0,n.fZ)(r,"divotBorder"),r.style.borderTop="8px solid transparent",r.style.borderBottom="8px solid transparent",r.style.borderLeftWidth="8px",r.style.borderLeftStyle="solid",""!==e&&(r.style.borderLeftColor=`${e}`),o.appendChild(r);const a=8-s,l=document.createElement("div");return(0,n.fZ)(l,"divotBackground"),l.style.position="absolute",l.style.top=`${s}px`,l.style.right=`-${a}px`,l.style.borderTop=`${a}px solid transparent`,l.style.borderBottom=`${a}px solid transparent`,l.style.borderLeftWidth=`${a}px`,l.style.borderLeftStyle="solid",""!==t&&(l.style.borderLeftColor=`${t}`),r.appendChild(l),o}function h(e,t){let i,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,d="";switch(e){case s.Top:i=o,d="divotTop";break;case s.Bottom:i=r,d="divotBottom";break;case s.Left:i=a,d="divotLeft";break;case s.Right:i=l,d="divotRight";break;default:i=void 0}if(void 0!==i){const e=i("","",t,h);return(0,n.fZ)(e,d),(0,n.fZ)(e,"divot"),e}}!function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.Left=2]="Left",e[e.Right=3]="Right"}(s||(s={}))},1243:(e,t,i)=>{"use strict";i.d(t,{k:()=>r});var s=i(3910),n=i(2939),o=i(9815);class r extends o.q{constructor(){super()}initListeners(){s.oB.listen((e=>{e.isOpen&&this.dontNotify.add(e.username)})),n.Gr.listen((()=>{this.dontNotify.clear()}))}}},7668:(e,t,i)=>{"use strict";i.d(t,{P:()=>o,S:()=>r});var s=i(7623),n=i(6784);const o={enabled:!1,move:(e,t)=>{},end:()=>{}};function r(e,t){a(e,t,(e=>{const t=e;return{valid:!0,x:t.clientX,y:t.clientY}}),"mousedown","mousemove","mouseup"),a(e,t,(e=>{const t=e;if(1===t.touches.length){const e=t.touches.item(0);if(null!==e)return{valid:!0,x:e.clientX,y:e.clientY}}return{valid:!1,x:0,y:0}}),"touchstart","touchmove","touchend")}function a(e,t,i,o,r,a){(0,n.wu)(o,e,(e=>{const o=i(e);if(!o.valid)return;const l=t(e,o.x,o.y);if(!l.enabled)return;l.move(o.x,o.y),e.preventDefault();const h=e=>{const t=i(e);t.valid&&l.move(t.x,t.y)},d=e=>{e.preventDefault(),void 0!==e.buttons&&(e=>(0,s.Cc)()?0===e.buttons:1===e.buttons)(e)||void 0!==e.touches&&1===e.touches.length?h(e):c(e,!1)};(0,n.wu)(r,document,d,!0);const c=function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&h(e),(0,n.Pf)(r,document,d,!0),(0,n.Pf)(a,document,c,!0),l.end()};(0,n.wu)(a,document,c,!0)}))}},6144:(e,t,i)=>{"use strict";i.d(t,{G:()=>o,v:()=>n});var s=i(2997);class n extends s.ij{constructor(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(null!=t?t:{},e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),this.toggleElement=e}}class o extends n{constructor(e){super(e)}initUI(){super.initUI(),this.element.style.display="block"}showElement(){const e=this.element.parentElement;return null!==e&&(e.classList.toggle("pushmenu-animate",!0),this.toggleEvent.fire(new s.XY(!0)),!0)}hideElement(){const e=this.element.parentElement;return null!==e&&(e.classList.toggle("pushmenu-animate",!1),this.toggleEvent.fire(new s.XY(!1)),!0)}isShown(){const e=this.element.parentElement;return null!==e&&e.classList.contains("pushmenu-animate")}}},2997:(e,t,i)=>{"use strict";i.d(t,{Ke:()=>l,XY:()=>c,ij:()=>a});var s=i(7623),n=i(6784),o=i(82),r=i(8423);class a extends o.b{constructor(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(e),this.toggleElement=t,this.toggleEvent=new r.c_("dropDownToggled",{reportIfNoListeners:!1}),void 0!==t&&((0,n.wu)("click",t,(e=>{e.metaKey||e.ctrlKey||this.toggleOverlay(e)}),!1),(0,n.wu)("keydown",t,(e=>{32!==e.keyCode&&"Space"!==e.code||(e.preventDefault(),this.toggleOverlay(e))})),t.classList.add("dropdown-anchor")),this.autoHide(i)}initUI(e){super.initUI(e),this.element.style.overflow="visible",this.element.style.position="absolute",this.element.style.top="0",this.element.style.left="0",this.element.style.right="auto",this.element.style.bottom="auto",this.element.style.width="",this.element.style.height="",this.element.style.display="none",this.element.style.zIndex="4",this.element.classList.add("dropdown")}showElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"block",t=arguments.length>1?arguments[1]:void 0;return!this.isShown()&&(this.element.style.display=e,this.toggleEvent.fire(new c(!0,t)),this.isShown())}hideElement(e){return!(void 0!==e&&e.composedPath().some((e=>e instanceof Element&&this.element.contains(e)&&e.matches(".dropdown-anchor")))||!this.isShown()||(this.element.style.display="none",this.toggleEvent.fire(new c(!1,e)),this.isShown()))}toggleOverlay(e){return this.isShown()?!this.hideElement(e):this.showElement(void 0,e)}autoHide(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.documentClickListener=l.listen((t=>{!(this.isShown()&&t.target instanceof Element)||e&&this.element.contains(t.target)||void 0!==this.toggleElement&&this.toggleElement.contains(t.target)||this.hideElement(t)}))}dispose(){this.documentClickListener.removeListener()}}const l=new r.c_("documentClick");let h,d=!1;(0,n.wu)("touchmove",document,(()=>{d=!0})),(0,n.wu)("touchstart",document,(()=>{d=!1})),(0,n.wu)("click",document,(e=>{l.fire(e),void 0!==h&&(clearTimeout(h),h=void 0)})),((0,s.J0)()||(0,s.aq)())&&(0,n.wu)("touchend",document,(e=>{d||(h=window.setTimeout((()=>{h=void 0,l.fire(e)}),200))}),!1);class c{constructor(e,t){this.isShowing=e,this.event=t}}},9605:(e,t,i)=>{"use strict";i.d(t,{FH:()=>g,GH:()=>c,IC:()=>p,I_:()=>v,jS:()=>m,mj:()=>f,yd:()=>u});var s=i(4936),n=i(5276),o=i(5216);let r,a=[];const l=18,h="emojiRecents",d="|";function c(e){const t=e.match(/[^\uD800-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDFFF]/g);return null!==t?t:[]}function u(e){if(!n.A.test(e))return;let t=-1,i="",s="",o=0;for(const r of c(e))-1===t&&n.A.test(r)?(t=o,i=r,s=r):-1!==t&&(s=`${s}${r}`,n.A.test(r)&&p(n.A.parse(s))&&(i=s)),o+=r.length;return-1!==t?{emojiStart:t,emojiChars:i}:void 0}function p(e){const t=e.match(/<img/g);return null!==t&&1===t.length}function m(e){for(let t=0;t<a.length;t+=1)a[t].name===e.name&&a.splice(t,1);a.length===l&&a.pop(),a.unshift(e);const t=a.map((e=>JSON.stringify({value:e.value,name:e.name}))).join(d);return window.localStorage.setItem(h,t),a}function g(){const e=new Promise((e=>{const t=window.localStorage.getItem(h);e(null!==t?t.split(d).map((e=>{const t=JSON.parse(e);return{value:t.value,name:t.name}})):[])})),t=(0,o.Aw)("api/ts/emoticons/search_emojis/");r=Promise.all([e,t]).then((e=>{let[t,i]=e;return a=t,[a,new s.N6(i.responseText)]}))}function v(e){return void 0===r&&g(),void 0!==r?r.then((t=>{let[i,s]=t;if("recent"===e)return i;if("smileys-people"===e){const e=s.getAny("smileys-emotion"),t=s.getAny("people-body");return y(e.concat(t))}return y(s.getAny(e))})):Promise.reject()}function f(e){return(0,o.Aw)(`api/ts/emoticons/search_emojis/?keywords=${encodeURIComponent(e)}`).then((e=>{const t=new s.N6(e.responseText);return["smileys-emotion","people-body","animals-nature","food-drink","activities","travel-places","objects","symbols","flags"].map((e=>t.getAny(e))).filter((e=>void 0!==e)).map((e=>y(e))).reduce(((e,t)=>e.concat(t)))})).catch((()=>[]))}function y(e){return e.map((e=>({value:e.character,name:e.name})))}},481:(e,t,i)=>{"use strict";i.d(t,{Q:()=>f,s:()=>v});var s=i(4936),n=i(9447),o=i(6657),r=i(6066),a=i(2939),l=i(1244),h=i(8423),d=i(9060),c=i(8466),u=i(9586),p=i(3860);let m;const g=new h.c_("hideEmoticons",{listenersWarningThreshold:()=>10+h.hI});p.L.changeVideoMode.listen((()=>{g.fire(void 0)}));class v extends o.c{constructor(){super(...arguments),this.maxOptionLength=36}initData(){super.initData(),this.previewWrapper=document.createElement("div"),this.previewImage=document.createElement("img"),this.viewReportLink=document.createElement("div"),this.xhrConfig={withCredentials:!1,noRequestedWith:!0}}initUI(){(0,n.fZ)(this.previewWrapper,"previewWrapper"),this.previewWrapper.style.display="none",this.previewWrapper.style.width="260px",this.previewWrapper.style.height="110px",this.previewWrapper.style.lineHeight="110px",this.previewWrapper.style.borderBottomWidth="1px",this.previewWrapper.style.borderBottomStyle="solid",this.previewWrapper.style.textAlign="center",this.previewWrapper.onclick=()=>{void 0!==this.selectedIndex&&this.showPreview(this.items[this.selectedIndex])},this.previewWrapper.dataset.testid="emoticon-preview",this.element.appendChild(this.previewWrapper),super.initUI(),this.previewImage.src=`${STATIC_URL}loading.png`,this.previewImage.style.maxWidth="240px",this.previewImage.style.maxHeight="80px",this.previewImage.style.verticalAlign="middle",this.previewImage.style.padding="10px 10px 16px 10px",this.previewWrapper.appendChild(this.previewImage),(0,n.fZ)(this.viewReportLink,n.aG.hrefColor),this.viewReportLink.innerText="VIEW / REPORT EMOTICON",this.viewReportLink.style.fontSize="10px",this.viewReportLink.style.position="relative",this.viewReportLink.style.bottom="8px",this.viewReportLink.style.lineHeight="0",this.viewReportLink.onmouseenter=()=>{this.viewReportLink.style.textDecoration="underline"},this.viewReportLink.onmouseleave=()=>{this.viewReportLink.style.textDecoration="none"},this.viewReportLink.dataset.testid="view-report-link",this.previewWrapper.appendChild(this.viewReportLink),a.X0.listen((e=>{m=e.dossier.ignoredEmoticons})).addTo(this.listenerGroup),g.listen((()=>{void 0!==this.overlay&&this.hide()})).addTo(this.listenerGroup)}promptRegex(){return":"}searchSlugRegex(){return"[\\w-]+"}getDataEndpoint(){return(0,d.Jv)()?`/api/ts/emoticons/autocomplete/?slug=${this.searchSlug}`:`https://emote.highwebmedia.com/autocomplete?slug=${this.searchSlug}&_=${Date.now()}`}clearListDOM(){super.clearListDOM(),this.previewWrapper.style.display="none"}highlightSelectedIndex(e){super.highlightSelectedIndex(e),void 0!==this.selectedIndex&&(this.previewImage.src=`${STATIC_URL}loading.png`,this.previewImage.src=this.items[this.selectedIndex].url,this.previewWrapper.style.display="block")}parseResponse(e){const t=new s.N6(e),i=(t.getString("slug"),t.getObject("emoticons"));let n=[];for(const e of i)n.push({slug:e.slug,url:e.url,element:y,score:e.score});return n=n.map((e=>{const t=void 0===e.score?0:e.score;return e.slug===this.searchSlug?e.score=t+1e5:0===e.slug.indexOf(this.searchSlug)&&(e.score=t+9e3),e})),n=n.sort(((e,t)=>(void 0===e.score?0:e.score)-(void 0===t.score?0:t.score))),t.logUnusedDebugging("parseEmoticonAutocompleteResponse"),n}shouldIgnoreItem(e){return m.indexOf(e.slug)>=0}showPreview(e){l.pp.fire(e)}}class f extends v{constructor(e){super({inputElement:e,leftOffset:0,rightOffset:0}),this.mobileMixin=new r.v({autocompleteConfig:this.config,element:this.element,list:this.list,overlayClick:this.overlayClick,listenerGroup:this.listenerGroup,isVisible:()=>this.visible,hide:()=>this.hide(),pickItem:(e,t)=>this.pickItem(e,t),hideOnSpace:!0}),c.R.listen((()=>{l.JA.fire(void 0)})).addTo(this.listenerGroup)}initUI(){super.initUI(),this.element.style.border="",this.element.style.fontSize="14px",this.element.style.lineHeight="26px",this.element.style.boxShadow="0px 0px 8px rgba(0, 0, 0, 0.32)",this.element.style.marginLeft="7px",this.element.style.boxSizing="content-box",this.previewWrapper.style.width="",this.list.style.width="",(0,u.H)(this.list)}repositionChildren(){}showPreview(e){super.showPreview(e),this.config.inputElement.blur(),l.jC.once((()=>{this.isVisible()&&(this.config.inputElement.focus(),this.previewImage.src=this.previewImage.src)}),!1)}appendItem(e,t){const i=super.appendItem(e,t);return this.mobileMixin.customizeItem(i,t),i}isSpecialFunctionKey(e){const t=this.config.inputElement.getCurrentNodePreCaretText().match(/\s$/);return super.isSpecialFunctionKey(e)||this.visible&&null!==t}show(){this.mobileMixin.onShow(),super.show()}}const y=document.createElement("div")},1244:(e,t,i)=>{"use strict";i.d(t,{Gj:()=>m,JA:()=>c,Yn:()=>p,jC:()=>u,pp:()=>d});var s=i(9447),n=i(6784),o=i(5216),r=i(2939),a=i(8423),l=i(2690);let h=[];r.X0.listen((e=>{h=e.dossier.ignoredEmoticons}));const d=new a.c_("openEmoticonPreview"),c=new a.c_("closeEmoticonPreview"),u=new a.c_("emoticonPreviewClosed");class p extends l.zf{constructor(){super(),(0,s.fZ)(this.element,"emoticonPreviewModal"),this.element.style.position="fixed",this.element.style.width="auto",this.element.style.height="auto",this.element.style.left="50%",this.element.style.top="50%",this.element.style.transform="translate(-50%, -50%)",this.element.style.borderRadius="6px",this.element.style.padding="10px",this.element.style.fontSize="12px",this.element.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",this.element.style.zIndex="1005",this.element.style.textAlign="center",this.element.style.boxShadow="0 0 18px rgba(0, 0, 0, 0.4)",this.overlay.style.backgroundColor="#000000",this.overlay.style.opacity="0.4",this.overlay.style.zIndex="1005",this.element.dataset.testid="emoticon-modal";const e=document.createElement("div");(0,s.fZ)(e,"closeButton"),e.style.display="inline-block",e.style.position="absolute",e.style.width="10px",e.style.height="10px",e.style.top="9px",e.style.right="9px",e.style.cursor="pointer",e.style.opacity="1",e.onclick=()=>{this.hide()},e.onmouseenter=()=>{e.style.opacity="1"},e.onmouseleave=()=>{e.style.opacity="0.5"},e.dataset.testid="close-button",this.element.appendChild(e),this.previewImage=document.createElement("img"),this.previewImage.style.verticalAlign="middle",this.previewImage.style.padding="10px",this.previewImage.style.maxHeight="75vh",this.previewImage.style.maxWidth="75vw",(0,n.wu)("load",this.previewImage,(()=>{this.previewImage.style.visibility="visible",this.repositionChildren()})),this.previewImage.dataset.testid="preview-image",this.element.appendChild(this.previewImage),this.reportLink=document.createElement("div"),(0,s.fZ)(this.reportLink,s.aG.hrefColor),this.reportLink.innerText="REPORT EMOTICON",this.reportLink.style.cursor="pointer",this.reportLink.onclick=()=>{this.reportLink.style.display="none",this.reportWrapper.style.display="block",this.repositionChildren()},this.reportLink.onmouseenter=()=>{this.reportLink.style.textDecoration="underline"},this.reportLink.onmouseleave=()=>{this.reportLink.style.textDecoration="none"},this.reportLink.dataset.testid="report-link",this.element.appendChild(this.reportLink),this.reportWrapper=document.createElement("div"),this.reportWrapper.style.display="none",this.element.appendChild(this.reportWrapper);const t=document.createElement("span");t.innerText="Choose a category:",t.style.marginRight="6px",t.dataset.testid="category-label",this.reportWrapper.appendChild(t);const i=document.createElement("select");(0,s.fZ)(i,"categorySelect"),i.style.borderRadius="4px",i.style.marginBottom="2px";for(const e of g){const t=document.createElement("option");t.innerText=e.label,t.value=e.value,t.dataset.testid=e.value.replace("_","-"),i.appendChild(t)}i.dataset.testid="category-select",this.reportWrapper.appendChild(i);const r=document.createElement("span");r.style.display="inline-block";const a=document.createElement("span");(0,s.fZ)(a,"cancelButton"),a.innerText="CANCEL",a.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",a.style.fontSize="12px",a.style.padding="2px 6px",a.style.borderRadius="4px",a.style.boxSizing="border-box",a.style.cursor="pointer",a.style.display="inline-block",a.style.marginLeft="6px",a.onclick=()=>{this.reportLink.style.display="block",this.reportWrapper.style.display="none",this.repositionChildren()},a.dataset.testid="cancel-button",r.appendChild(a);const l=document.createElement("span");(0,s.fZ)(l,"reportButton"),l.innerText="REPORT",l.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",l.style.fontSize="12px",l.style.padding="2px 6px",l.style.borderRadius="4px",l.style.boxSizing="border-box",l.style.cursor="pointer",l.style.display="inline-block",l.style.marginLeft="6px",l.onclick=()=>{const e=`emoticon_report_abuse/${this.emoticon.slug}/`;(0,o.KF)(e,{category:i.value}).then((e=>{h.push(this.emoticon.slug),this.reportWrapper.style.display="none",this.undoWrapper.style.display="block",this.repositionChildren()})).catch((e=>{error("Error reporting emoticon",e)}))},l.dataset.testid="report-button",r.appendChild(l),this.reportWrapper.appendChild(r),this.undoWrapper=document.createElement("div"),this.undoWrapper.style.display="none",this.element.appendChild(this.undoWrapper);const d=document.createElement("span");d.innerText="EMOTICON REPORTED - ",d.dataset.testid="emoticon-reported-label",this.undoWrapper.appendChild(d);const u=document.createElement("span");(0,s.fZ)(u,s.aG.hrefColor),u.innerText="UNDO",u.style.cursor="pointer",u.onclick=()=>{const e=`emoticon_report_abuse/${this.emoticon.slug}/`;(0,o.KF)(e,{category:i.value}).then((e=>{const t=h.indexOf(this.emoticon.slug,0);t>=0&&h.splice(t,1),this.undoWrapper.style.display="none",this.reportLink.style.display="block",this.repositionChildren()})).catch((e=>{error("Error reporting emoticon",e)}))},u.onmouseenter=()=>{u.style.textDecoration="underline"},u.onmouseleave=()=>{u.style.textDecoration="none"},u.dataset.testid="undo-link",this.undoWrapper.appendChild(u),this.overlayClick.listen((()=>{this.hide()})),c.listen((()=>{this.hide()}))}initAndShow(e){this.emoticon=e,this.previewImage.style.visibility="hidden",this.previewImage.src=this.emoticon.url,this.reportLink.style.display="none",this.reportWrapper.style.display="none",this.undoWrapper.style.display="none",h.indexOf(e.slug)>=0?this.undoWrapper.style.display="block":this.reportLink.style.display="block",super.show(),this.removeDocumentFocus(),this.repositionChildren()}hide(){super.hide(),u.fire(void 0)}show(){super.show(),this.element.style.visibility="",this.repositionChildren()}removeDocumentFocus(){null!==document.activeElement&&document.activeElement.blur()}}class m extends p{constructor(){super(),this.previewImage.style.maxWidth="calc(100vw - 64px)",this.reportWrapper.style.width="300px",this.reportWrapper.style.margin="auto"}}const g=[{label:"Just ignore this emoticon",value:"ignore"},{label:"Offensive",value:"offensive"},{label:"Disgusting",value:"disgusting"},{label:"Fake Tip",value:"fake_tip"},{label:"Advertising",value:"advertising"}]},8423:(e,t,i)=>{"use strict";i.d(t,{Rj:()=>a,c_:()=>h,gt:()=>d,hI:()=>o,jU:()=>r});var s=i(2709);class n{constructor(){this.reportIfNoListeners=!0,this.maxHistorySize=10,this.listenersWarningThreshold=50}}let o=0;function r(){o+=1}function a(){o-=1}class l{constructor(e,t){this.router=e,this.listener=t}removeListener(){this.router.removeListener(this.listener)}addTo(e){e.add(this)}}class h{constructor(e,t){this.eventName=e,this.listeners=[],this.history=[],this.counter=0,this.listenersMap=new Map,this.options=Object.assign(new n,t),this.idFieldName=`_eventRouter${this.eventName}Id`}listen(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.listeners.push(e),t)for(const t of this.history)e(t);else i&&this.history.length>0&&e(this.history[this.history.length-1]);return this.warnTooManyListeners(),void 0!==this.options.onListenerAdded&&this.options.onListenerAdded(this.listeners.length),new l(this,e)}warnTooManyListeners(){const e=this.getListenersWarningThreshold();-1!==e&&this.size()>e&&warn("EventRouter has too many listeners",{event:this.eventName,listeners:this.size(),"max-listeners":e})}addListener(e,t){if(!t.hasOwnProperty(this.idFieldName)){this.counter+=1;const e=this.counter;Object.defineProperty(t,this.idFieldName,{get:()=>e})}const i=t[this.idFieldName];this.listenersMap.set(i,[t,e]),window.setTimeout((()=>{if(!h.isElementConnected(t)){const e=(t instanceof s.u?t.element:t).outerHTML;warn(`addListener for EventRouter "${this.eventName}" is called on a listeningSource which is not attached to the DOM.\n                    This can result in the listener not being registered. Make sure the element is attached in the same thread as calling addListener.`,{listeningSource:e})}})),void 0!==this.listenersCleanUpTimeout&&window.clearTimeout(this.listenersCleanUpTimeout),this.listenersCleanUpTimeout=window.setTimeout((()=>{this.cleanUpRemovedElements(),this.warnTooManyListeners()}),100)}cleanUpRemovedElements(){const e=Math.max(1,Math.floor(this.getListenersWarningThreshold()/2));if(this.listenersMap.size>e)for(const e of this.listenersMap.values())h.isElementConnected(e[0])||this.listenersMap.delete(e[0][this.idFieldName])}static isElementConnected(e){return e instanceof HTMLElement&&e.isConnected||e instanceof s.u&&e.element.isConnected}once(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=t=>{e(t),this.removeListener(i)};return this.listen(i,!1,t)}fire(e){this.history.push(e)>this.options.maxHistorySize&&this.history.shift(),0===this.listeners.length&&0===this.listenersMap.size&&this.options.reportIfNoListeners&&debug(`No listeners for event: ${this.eventName}`);for(const t of[...this.listeners])this.callListener(t,e);for(const t of this.listenersMap.values()){const i=t[0],s=t[1];h.isElementConnected(i)?this.callListener(s,e):window.setTimeout((()=>{h.isElementConnected(i)?this.callListener(s,e):this.listenersMap.delete(i[this.idFieldName])}))}}callListener(e,t){try{e(t)}catch(t){error("Event listener error",{reason:t.toString(),event_name:this.eventName,event_listeners:this.size(),listener:e,error_stack:t.stack})}}size(){return this.listeners.length+this.listenersMap.size}removeListener(e){const t=this.listeners.indexOf(e);t>=0&&this.listeners.splice(t,1),void 0!==this.options.onListenerRemoved&&this.options.onListenerRemoved(this.listeners.length)}listenerCount(){return this.listeners.length}historyLength(){return this.history.length}getListenersWarningThreshold(){return"number"==typeof this.options.listenersWarningThreshold?this.options.listenersWarningThreshold:this.options.listenersWarningThreshold()}}class d{constructor(){this.boundListeners=[]}add(e){this.boundListeners.push(e)}removeAll(){for(const e of this.boundListeners)e.removeListener();this.boundListeners=[]}}},8451:(e,t,i)=>{"use strict";i.d(t,{$Z:()=>h,Ci:()=>a,HK:()=>c,IM:()=>o,LV:()=>r,T6:()=>l});var s=i(9461),n=i(6784);function o(e){return"ArrowUp"===e.key||38===e.keyCode}function r(e){return"ArrowDown"===e.key||40===e.keyCode}function a(e){return"Enter"===e.key||13===e.keyCode}function l(e){return void 0===e.which||"number"==typeof e.which&&e.which>0&&!e.ctrlKey&&!e.metaKey&&!e.altKey}function h(e){var t;return 1===(null===(t=e.key.match(/^[a-zA-Z0-9]$/))||void 0===t?void 0:t.length)}function d(e){null==e||e.preventDefault(),null==e||e.stopImmediatePropagation()}function c(e){var t;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2?arguments[2]:void 0;const r=s.Bm.current.isMobile?6e3:3e3;o=null!==(t=o)&&void 0!==t?t:r;let a=!1;const l=()=>{a||((0,n.Pf)("click",e,d,!0),(0,n.Pf)("pageshow",window,l),c(e,i,o),a=!0)};return(0,n.ck)("click",e,(t=>{i&&(t.ctrlKey||t.metaKey||t.shiftKey)?c(e,i,o):((0,n.wu)("click",e,d,!0),o>0&&window.setTimeout(l,o),(0,n.wu)("pageshow",window,l))})),e}},6440:(e,t,i)=>{"use strict";function s(e){return new RegExp(`\\b${e}\\b`).test(window.active_feature_flags)}function n(e){return new RegExp(`\\b${e}\\b`).test(window.active_perform_toggles)}i.d(t,{e:()=>n,f:()=>s})},9060:(e,t,i)=>{"use strict";i.d(t,{$o:()=>A,BP:()=>m,DV:()=>p,GZ:()=>C,Gy:()=>f,Jv:()=>u,Lx:()=>S,P$:()=>T,QC:()=>v,VY:()=>b,fm:()=>P,fv:()=>y,m_:()=>x,nV:()=>c,rT:()=>g,vG:()=>w});var s=i(6624),n=i(4936),o=i(8861),r=i(9461),a=i(6784),l=i(1519),h=i(6440),d=i(7407);const c=()=>(0,h.f)("LinguiBasic"),u=()=>(0,h.f)("PGEmoticonsAC"),p=()=>{const e=(0,o.oD)("language_subdomain_continuity");return(0,h.f)("LanguageSubdomain")||"1"===e},m=()=>(0,h.f)("PSRequestPMTabRedirect"),g=()=>(0,s.isFilterInPathActive)(),v=()=>(0,h.f)("ScrollDownNotice"),f=()=>(0,h.e)("PvtSpyBdgs"),y=()=>(0,h.f)("RcmFlwRm"),b=()=>(0,h.f)("ReactUserList2"),w=()=>(0,s.isSpyPriceFiltersActive)(),C=()=>(0,h.f)("ChatScrollData"),S=()=>(0,h.f)("ReduceChatHistory"),x=()=>(0,h.f)("MoveReportButton"),T=()=>(0,h.f)("ReactDm"),P=()=>new n.yk(["SbjSrch","SbjSrchSrt"],"RlSbjSrch").activeSide,k=[100,200,300,400,500,600,700,800,900,1e3];function A(e,t){if(!C())return;let i,s;const n=new l.a((()=>{void 0!==i&&void 0!==s&&(k.filter((e=>e<=t.children.length)).filter((e=>{const n=t.children[t.children.length-e];return s<=n.offsetTop&&n.offsetTop<i})).forEach((e=>{const t=r.Aw.getState();(0,d.bT)("ChatScrolledPast",{n:e,is_mod:t.isModerator,is_broadcaster:t.userName===t.room})})),i=void 0,s=void 0)}),{bounceLimitMS:100,debounceType:1});let o,h=!1;(0,a.wu)("scroll",e,(()=>{const t=e.scrollTop;var r,a;void 0===o&&(o=t),h=t<o,h&&(i=null!==(r=i)&&void 0!==r?r:o,s=Math.min(null!==(a=s)&&void 0!==a?a:t,t),n.callFunc()),o=t}))}},2396:(e,t,i)=>{"use strict";i.d(t,{b:()=>r});var s=i(4936),n=i(5216);let o;function r(e){const t=void 0===o||""===o?e:o;return new Promise(((i,o)=>{(0,n.Aw)(`api/ts/accounts/usermenu/${e}/${t}/`).then((e=>{i(function(e){const t=new s.N6(e),i=t.getBoolean("online"),n=t.getString("username"),o=t.getNumber("display_age",!1),r=t.getString("gender"),a=t.getString("image_url"),l=t.getBoolean("can_silence"),h=t.getNumberOrUndefined("silence_id"),d=t.getBoolean("can_access"),c=t.getBoolean("needs_supporter_to_pm");return t.logUnusedDebugging("fetchUserMenuData.parseMenuDataRes"),{username:n,displayAge:o,gender:r,imageUrl:a,online:i,canSilence:l,canAccess:d,needsSupporterToPm:c,silenceId:h}}(e.responseText))})).catch((e=>{o(e)}))}))}i(2939).X0.listen((e=>{o=e.chatConnection.room()}))},4693:(e,t,i)=>{"use strict";i.d(t,{Be:()=>s,wT:()=>o,zt:()=>n});class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.filterAfterSize=e,this.cacheTTL=t,this.cache=new Map}getShortenedPrefix(e){return void 0===this.filterAfterSize||e.length>this.filterAfterSize?e.substring(0,this.filterAfterSize):e}get(e){const t=this.getShortenedPrefix(e),i=this.cache.get(t);return t===e?i:null==i?void 0:i.filter((t=>t.slug.startsWith(e)))}set(e,t){(void 0===this.filterAfterSize||e.length<=this.filterAfterSize)&&(this.cache.set(e,t),-1!==this.cacheTTL&&window.setTimeout((()=>this.cache.delete(e)),this.cacheTTL))}}class n extends s{get(e){const t=this.getShortenedPrefix(e),i=this.cache.get(t);return t===e?i:null==i?void 0:i.filter((t=>t.slug.toLowerCase().startsWith(e)))}}class o extends s{get(e){const t=this.getShortenedPrefix(e),i=this.cache.get(t);return t===e?i:null==i?void 0:i.filter((t=>t.slug.includes(e)))}}},7463:(e,t,i)=>{"use strict";i.d(t,{O3:()=>g,PT:()=>d,QH:()=>f,Tf:()=>c,iD:()=>u,im:()=>h,j4:()=>v,wF:()=>y});var s=i(4936),n=i(5216),o=i(6844),r=i(8423),a=i(5424),l=i(4947);const h=new r.c_("followingEvent"),d=["follow_new","follow_text","follow_photo"];function c(e,t,i){return(0,n.KF)(`api/ts/follow/notifications/${e}`,{notification_frequency:t}).then((()=>(i.fire({roomName:e,following:!0,followNotificationFrequency:t}),!0))).catch((t=>(error("Unable to update follow notification settings",{room:e,reason:t.toString()}),!1)))}function u(){return(0,n.Aw)("api/ts/follow/email_notifications/").then((e=>{const t=new s.N6(e.responseText);return{activated:t.getBoolean("activated"),email:void 0!==t.getStringOrUndefined("email")?t.getStringOrUndefined("email"):"",validated:t.getBoolean("validated")}})).catch((e=>(error("Error checking if follow email notifications are turned on",e),!1)))}const p="email_field";function m(e,t,i){const o=void 0!==i?i.email:void 0,r=void 0!==i?i.validated:void 0;return new Promise(((i,a)=>{const h={activate:`${e}`};void 0!==t&&""!==t&&(h[p]=t),(0,n.KF)("api/ts/follow/email_notifications/",h).then((()=>{i(`${!(void 0!==t&&""!==t&&o===t&&void 0!==r&&r)&&void 0!==t}`)})).catch((e=>{a(function(e){const t=new s.N6(e.xhr.responseText).getString("error");if(t.indexOf(p)>-1){const e=new s.N6(t).getList(p);if(void 0!==e&&e.length>0)return e[0].getString("message")}return l.R.emailSubmitErrorMessage}(e))}))}))}function g(e,t){return void 0!==t&&""!==t?u().then((i=>t===i.email&&e===i.activated?new Promise(((e,s)=>{i.validated||(0,n.KF)("emailvalidation/resend/",{}).then((()=>{e("true")})).catch((()=>{s(`Error resending verification email to ${t}`)})),e("false")})):m(e,t,i))).catch((()=>m(e,t))):m(e)}function v(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"FollowStar";if(void 0!==t&&!t||!(0,o.rC)(l.R.loginToFollow,void 0,void 0,{fromFeature:!0}))return(0,n.KF)(`follow/follow/${e}/`,{location:i}).then((t=>{const i=new s.N6(t.responseText);return h.fire({roomName:e,following:!0,followNotificationFrequency:(0,a.QZ)(i.getString("notification_frequency")),onlineCount:i.getNumberOrUndefined("online_count"),totalCount:i.getNumberOrUndefined("total_count")}),!0})).catch((t=>(error("Unable to follow",{roomName:e,reason:t.toString()}),!1)))}function f(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"FollowStar";if(void 0!==t&&!t||!(0,o.rC)(l.R.loginToFollow,void 0,void 0,{fromFeature:!0}))return(0,n.KF)(`follow/unfollow/${e}/`,{location:i}).then((t=>{const i=new s.N6(t.responseText);return h.fire({roomName:e,following:!1,followNotificationFrequency:"none",onlineCount:i.getNumberOrUndefined("online_count"),totalCount:i.getNumberOrUndefined("total_count")}),!0})).catch((t=>(error("Unable to unfollow",{roomName:e,reason:t.toString()}),!1)))}function y(e){return(0,n.Aw)(`follow/follow_allowed/${e}/`).then((e=>new s.N6(e.responseText).getBoolean("can_follow"))).catch((e=>(error("Error checking if user following is allowed",e),!1)))}},2119:(e,t,i)=>{"use strict";i.d(t,{M:()=>m});var s=i(9461),n=i(7477),o=i(897),r=i(8039),a=i(9394),l=i(9603),h=i(1134),d=i(2939),c=i(5020),u=i(3955),p=i(4947);class m{constructor(){if(this.followers=new Set,s.Bm.current.isBroadcast){var e,t;const i=null!==(e=null===(t=s.Bm.current.loggedInUser)||void 0===t?void 0:t.userUid)&&void 0!==e?e:"";new o.Jf(i).onMessage.listen((e=>{var t;e.followerUsername!==(null===(t=s.Bm.current.loggedInUser)||void 0===t?void 0:t.username)&&(e.isFollowing?this.addFollower(e.followerUsername):this.removeFollower(e.followerUsername))})),d.X0.listen((e=>{window.setTimeout((()=>{r.SJ.getInstance().fetchRoomUsers().then((e=>{e.roomUsers.forEach((e=>{!0===e.isFollowing&&this.addFollower(e.username)}))})).catch(void 0)}),5e3),e.chatConnection.event.roomMessage.listen((e=>{!0===e.fromUser.isFollowing&&this.addFollower(e.fromUser.username)})),e.chatConnection.event.tipAlert.listen((e=>{!0===e.fromUser.isFollowing&&this.addFollower(e.fromUser.username)})),new n.eB(e.dossier.roomUid).onMessage.listen((e=>{!0===e.user.isFollowing&&this.addFollower(e.user.username)}))})),h.T.registerGenerator("followerBadge",(e=>this.createChatBadge(e)))}}static getOrCreateInstance(){return void 0===m.singletonInstance&&(m.singletonInstance=new m),m.singletonInstance}hasFollower(e){return this.followers.has(e)}addFollower(e){this.followers.has(e)||(this.followers.add(e),this.updateChatBadges(e))}removeFollower(e){this.followers.delete(e),this.updateChatBadges(e)}shouldShowBadge(e){return this.followers.has(e)&&e!==s.Aw.getState().room}createChatBadge(e){const t=document.createElement("span");(0,u.ZM)(t,{position:"relative",display:this.shouldShowBadge(e)?"":"none",marginRight:".1em"});const i=(0,a.H)(),s=(0,l.q)({content:p.R.followsYou,hasHTML:!1,divotPosition:c.Wi.Bottom,divotLeftOrTop:"8px"});return s.style.padding="6px",s.style.fontFamily="UbuntuLight, Helvetica, Arial, sans-serif",s.style.lineHeight="normal",s.style.position="fixed",s.style.display="block",(0,u.JR)(i).listen((e=>{var t;e?document.body.appendChild(s):null===(t=s.parentElement)||void 0===t||t.removeChild(s);const n=i.getBoundingClientRect(),o=(0,u.Mx)();s.style.top=-o.top+n.top-s.offsetHeight-n.height/5-5+"px",s.style.left=-o.left+n.left+n.width/2-18+"px"})),t.appendChild(i),t}updateChatBadges(e){const t=this.shouldShowBadge(e);h.T.getBadgeElements("followerBadge",e).forEach((e=>{e.style.display=t?"":"none"}))}}},3062:(e,t,i)=>{"use strict";i.d(t,{a:()=>h,R:()=>c});var s=i(6784),n=i(5216),o=i(1519);function r(e){e.row.style.display="none"}function a(e,t,i,s){if(void 0!==e)if(t)!function(e,t,i){(0,n.Aw)(t.concat(`?username=${encodeURIComponent(i)}`)).then((t=>{const i=JSON.parse(t.responseText);!0===i.success?function(e,t){e.availableButton.innerText=t.usernames[0],e.availableButton.style.display="inline-block",function(e){e.available.appendChild(e.availableButton),e.available.style.display="block"}(e),e.row.style.display="table-row"}(e,i):r(e)})).catch((()=>{}))}(e,i,s);else{if(function(e){return"none"===e.row.style.display}(e))return;r(e)}}var l=i(7407);class h{constructor(e){this.form=e,this.checkpoints=[],this.submitting=!1,c(e,!1).hasValidationErrors()||this.saveCheckpoint(),(0,s.wu)("submit",e,(()=>{this.submitting=!0}))}saveCheckpoint(){this.checkpoints.push(this.serializeForm())}isDirty(){return 0===this.checkpoints.length||this.serializeForm()!==this.checkpoints[this.checkpoints.length-1]}isSubmit(){return this.submitting}warnOnClosingDirty(e){(0,s.wu)("beforeunload",window,(t=>{if(this.isDirty()&&!this.isSubmit())return t.preventDefault(),t.returnValue=!1,e}))}serializeForm(){return c(this.form,!1).serialize()}}function d(e){const t={name:"",errorName:"",elementType:"",isMultiSelect:!1,isCheckbox:!1,isHidden:!1,isDisabled:!1,grace:!0,isDateWidget:!1,isRecaptcha:!1,dateWidgetLabel:"",isRecaptchaSet:!1,htmlElement:e,init:function(){t.elementType=String(e.tagName.toLowerCase());const i=t.getName();t.name=null!==i?i:"",t.errorName=t.name,"captcha"===e.getAttribute("data-type")?(t.isRecaptcha=!0,function(e,t){const i=String(t.getAttribute("data-callback"));"null"!==i&&(window[i]=function(){e.isRecaptchaSet=!0,e.clearError()})}(t,e)):function(e){const t=String(e.getAttribute("id")).split("_"),i=t[t.length-1],s=["day","month","year"];let n=!1;if(s.indexOf(i)>-1){t.pop();const e=t.join("_");n=!0;for(const t of s){const i=`${e}_${t}`;null===document.querySelector(`#${i}`)&&(n=!1)}}return n}(e)&&(t.isDateWidget=!0,t.errorName=function(e){const t=String(e.getAttribute("id")).split("_");return t.shift(),t.pop(),t.join("_")}(e));const s=String(e.getAttribute("type"));"checkbox"===s?t.isCheckbox=!0:"hidden"===s?t.isHidden=!0:"select"===t.elementType&&"select-multiple"===e.type&&(t.isMultiSelect=!0),t.isDisabled=null!==e.getAttribute("disabled"),t.hasError()&&(t.grace=!1)},getName:function(){return"captcha"===e.getAttribute("data-type")?function(e){const t=String(e.getAttribute("id")).split("_");return t.shift(),t.join("_")}(e):e.getAttribute("name")},showSpinner:function(){if(t.isHidden||t.isRecaptcha)return;const e=document.querySelector(`#${t.errorName}_spinner`);null!==e&&e.classList.remove("formvalidate_hidden")},hideSpinner:function(){const e=document.querySelector(`#${t.errorName}_spinner`);null!==e&&e.classList.add("formvalidate_hidden")},getId:function(){return String(e.getAttribute("id"))},getSubmitValue:function(){const i=e;return t.isCheckbox?i.checked?null!==i.getAttribute("value")?i.getAttribute("value"):"on":"":i.value},change:function(){t.grace=!1},hasError:function(){if(t.isHidden)return!1;const e=document.querySelector(`.${t.errorName}_error`);return null!==e&&"none"!==e.style.display},showError:function(e,i){if(!t.isHidden&&(i&&(t.grace=!1),!t.grace)){document.querySelector(`.${t.errorName}_error .error_msg`).appendChild(document.createTextNode(e));const i=document.querySelector(`.${t.errorName}_error`);"tr"===String(i.tagName.toLowerCase())?i.style.display="table-row":i.style.display="block"}},clearError:function(){if(t.isHidden)return;const e=document.querySelector(`.${t.errorName}_error .error_msg`);for(;null!==e.firstChild;)e.removeChild(e.firstChild);document.querySelector(`.${t.errorName}_error`).style.display="none";const i=document.querySelector(`.${t.errorName}_label`);null!==i&&i.classList.remove("formvalidate_error")}};return t.init(),t}function c(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i="1"===e.getAttribute("data-formvalidate-disable-on-submit")?[...e.querySelectorAll("button:not([type=button]),input[type=submit]")]:[],r={fields:[],formElement:e,usernameAssist:{fields:void 0},isValid:!0,isSubmitting:!1,isValidating:!1,validateUrl:"",usernameAssistUrl:"",fieldsIndex:{},lastAllData:{},queueValidation:!1,isPreSubmitValidationComplete:!1,preSubmitValidationHandlers:[],template:"",errored_inputs:[],init:function(){var n;if(r.validateUrl=String(e.getAttribute("data-formvalidate")).substring(1),r.usernameAssistUrl=String(e.getAttribute("data-usernameAssist")).substring(1),r.template=null!==(n=e.getAttribute("data-template"))&&void 0!==n?n:"",t){(0,s.wu)("submit",e,(e=>{r.isSubmitting?e.preventDefault():(r.isSubmitting=!0,r.isValid&&!r.isValidating?r.preSubmitValidation(e):(r.isPreSubmitValidationComplete=!1,i.map((e=>e.disabled=!0)),r.validate(!0).then((()=>{r.isValid?r.preSubmitValidation(e):(r.isSubmitting=!1,i.map((e=>e.disabled=!1)))})).catch((()=>{r.isSubmitting=!1,i.map((e=>e.disabled=!1))})),e.preventDefault()))}));const t=Boolean(e.getAttribute("data-formvalidate-eagerness"))?Number(e.getAttribute("data-formvalidate-eagerness")):2;let n;"1"===e.getAttribute("data-formvalidate-debounce")&&(n=new o.a((()=>{r.validate()}),{bounceLimitMS:1e3,debounceType:2}));for(const i of e.querySelectorAll("input[type=text], input[type=checkbox], input[type=password], input[type=email], select")){const e=Boolean(i.getAttribute("data-formvalidate-eagerness"))?Number(i.getAttribute("data-formvalidate-eagerness")):t;e>=1&&(0,s.wu)("change",i,(e=>{const t=e.target;r.fields[r.fieldsIndex[String(t.getAttribute("id"))]].change(),r.validate()})),e>=2&&(0,s.wu)("input",i,(e=>{const t=e.target;r.fields[r.fieldsIndex[String(t.getAttribute("id"))]].change(),void 0!==n?n.callFunc():r.validate()}))}(()=>{if(r.template.indexOf("register")>-1)for(const t of e.querySelectorAll("input[type=submit], button[type=submit]"))(0,s.wu)("click",t,(e=>{!r.isValid&&r.errored_inputs.length>0&&r.template.indexOf("register")>-1&&(0,l.bT)("SignupFailed",{template:r.template,inputs:r.errored_inputs.toString()})}))})()}let a=0;for(const t of e.querySelectorAll("input[type=text], input[type=checkbox], input[type=hidden], input[type=password], input[type=email], select, .g-recaptcha")){const e=d(t);r.fields.push(e),r.fieldsIndex[e.getId()]=a,a+=1,r.lastAllData[e.name]=e.getSubmitValue()}!function(e){if(void 0===e.usernameAssistUrl)return;const t=e.fields.find((e=>"username"===e.name)),i=document.getElementById("username_assist_row"),s=document.getElementById("username_assist_available");var n;t&&i&&s&&(e.usernameAssist.fields={usernameField:t,row:i,available:s,availableButton:document.createElement("button")},(n=e.usernameAssist.fields.availableButton).style.display="none",n.style.cursor="pointer",n.style.background="transparent",n.style.border="none",n.style.padding="2px",n.style.color="#0a5a83",e.usernameAssist.fields.availableButton.type="button",e.usernameAssist.fields.availableButton.addEventListener("click",(t=>{var i;t.preventDefault(),void 0!==e.usernameAssist.fields&&(i=e.usernameAssist.fields.availableButton,void 0!==e.usernameAssist.fields&&(e.usernameAssist.fields.usernameField.htmlElement.value=i.innerText,e.validate(!1)))})))}(r)},serialize:function(){return r.fields.map((e=>{if(""!==e.name&&!e.isDisabled){if(e.isMultiSelect)return Array.from(e.htmlElement.options).filter((e=>e.selected)).map((t=>`${encodeURIComponent(e.name)}=${encodeURIComponent(t.value)}`)).join("&");if(!e.isCheckbox&&"radio"!==e.elementType||e.htmlElement.checked){const t=e.getSubmitValue();return`${encodeURIComponent(e.name)}=${encodeURIComponent(t)}`}}})).filter((e=>void 0!==e)).join("&").replace(/%20/g,"+")},validate:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(r.isValidating&&!e)return r.queueValidation=!0,Promise.resolve();r.isValidating=!0;const t={},i={};let s=!1,o=!1;for(const n of r.fields)i[n.name]=n.getSubmitValue(),n.isCheckbox&&""===n.getSubmitValue()||(t[n.name]=n.getSubmitValue()),(i[n.name]!==r.lastAllData[n.name]||e)&&("username"===n.name&&(o=!0),n.showSpinner(),s=!0);return s?(r.lastAllData=Object.assign({},i),(0,n.KF)(r.validateUrl,t).then((t=>{const s=JSON.parse(t.responseText);r.isValid=s.valid,r.errored_inputs=[];for(const t of r.fields)t.isRecaptcha&&!t.isRecaptchaSet?(t.clearError(),t.showError("Captcha has to be completed",e)):void 0!==s.errors[t.errorName]?(t.clearError(),t.showError(s.errors[t.errorName],e),r.errored_inputs.includes(t.errorName)||r.errored_inputs.push(t.errorName),"username"===t.name&&(""===i[t.name].trim()?a(r.usernameAssist.fields,!1,r.usernameAssistUrl,i[t.name]):o&&!1===t.grace&&a(r.usernameAssist.fields,!0,r.usernameAssistUrl,i[t.name]))):(t.clearError(),"username"===t.name&&a(r.usernameAssist.fields,!1,r.usernameAssistUrl,i[t.name])),t.hideSpinner();if(r.clearGlobalErrors(),void 0!==s.errors.__all__){for(const e of s.errors.__all__)r.addGlobalError(e);r.showGlobalErrors()}r.isValidating=!1,r.queueValidation&&(r.queueValidation=!1,r.validate())})).catch((e=>{if(info(`error: ${e}`),r.isValidating=!1,!r.queueValidation)throw e;r.queueValidation=!1,r.validate()}))):(r.isValidating=!1,r.queueValidation&&(r.queueValidation=!1,r.validate()),Promise.resolve())},preSubmitValidation:t=>(i.map((e=>e.disabled=!0)),r.isPreSubmitValidationComplete||0===r.preSubmitValidationHandlers.length?(window.setTimeout((()=>{i.map((e=>e.disabled=!1))}),700),Promise.resolve()):(t.preventDefault(),Promise.all(r.preSubmitValidationHandlers.map((e=>e()))).then((t=>{r.isSubmitting=!1,window.setTimeout((()=>{i.map((e=>e.disabled=!1))}),10),t.reduce(((e,t)=>e&&t),!0)&&(r.isPreSubmitValidationComplete=!0,(()=>{const t=document.createElement("button");t.style.display="none",e.appendChild(t),window.setTimeout((()=>{t.click(),e.removeChild(t)}),0)})())})).catch((t=>{throw error(`Can't complete preSubmitValidation in form ${e.action}`,t),r.isSubmitting=!1,i.map((e=>e.disabled=!1)),t})))),addGlobalError:function(e){const t=document.querySelector("#error_notice > .errorlist"),i=document.createElement("li");i.appendChild(document.createTextNode(e)),t.appendChild(i)},clearGlobalErrors:function(){const e=document.querySelector("#error_notice");if(null!==e){e.classList.add("formvalidate_hidden");const t=document.querySelector("#error_notice > .errorlist");if(null!==t)for(;null!==t.firstChild;)t.removeChild(t.firstChild)}},showGlobalErrors:function(){const e=document.querySelector("#error_notice");null!==e&&e.classList.remove("formvalidate_hidden")},hasValidationErrors:function(){let t=!1;for(const e of r.fields)t=t||e.hasError();const i=0!==Array.from(e.getElementsByClassName("errorlist")).filter((e=>""!==e.innerHTML.trim())).length;return t||i},addPreSubmitValidator(e){r.preSubmitValidationHandlers.push(e);let t=!1;return()=>{t||(r.preSubmitValidationHandlers.splice(r.preSubmitValidationHandlers.indexOf(e),1),t=!0)}}};return r.init(),r}},7269:(e,t,i)=>{"use strict";i.d(t,{n:()=>p});var s=i(3062),n=i(5216),o=i(7407),r=i(2945);const a=void 0!==window.performance&&void 0!==performance.now;class l extends Error{constructor(){super(...arguments),this.isValidationError=!0}}class h extends Error{constructor(){super(...arguments),this.isFormInvalidError=!0}}const d=(e,t)=>{const{formElement:i}=t,s=t.addPreSubmitValidator((()=>{if("function"!=typeof window.injectReCaptchaV3Token)return error("window.injectReCaptchaV3Token is not a function: ",typeof window.injectReCaptchaV3Token),Promise.resolve(!0);const n=a?performance.now():0;return window.injectReCaptchaV3Token(e).then((e=>{if(t.isValid)return u(e,i);throw new h})).then((e=>{if(""===e){const e=document.createElement("input");e.type="hidden",e.name="sign_recaptcha_failed",e.value="1",i.appendChild(e)}else{const t=document.createElement("input");t.type="hidden",t.name="signed_recaptcha",t.value=e,i.appendChild(t)}return(0,o.bT)("ReCAPTCHA3_frontend",{result:"success",timing_milliseconds:a?performance.now()-n:void 0}),!0})).catch((t=>!t.isFormInvalidError&&((0,o.bT)("ReCAPTCHA3_frontend",{result:JSON.stringify(t),timing_milliseconds:a?performance.now()-n:void 0}),c(e,i).then((e=>!e||(s(),!1))))))}))},c=(e,t)=>"function"!=typeof window.bindNoReCaptchaField?(error("window.bindNoReCaptchaField is not a function: ",typeof window.bindNoReCaptchaField),Promise.resolve(!1)):null===e.parentNode?(error("replaceWithNoReCaptcha: captcha element hasn't a parent"),Promise.resolve(!1)):(0,n.Aw)("accounts/ajax_norecaptcha_html/").then((i=>{const s=document.createElement("div");if(null===e.parentNode||"function"!=typeof window.bindNoReCaptchaField)return!1;e.parentNode.insertBefore(s,e),s.outerHTML=i.responseText;const o=t.querySelector(".g-recaptcha");if(null===o)return error("replaceWithNoReCaptcha: html doesn't contain norecaptcha"),!1;window.bindNoReCaptchaField(o);const a=document.createElement("a");a.href=(0,n._Y)(t.action);const l=(0,r.JO)(a.search);l["force-nocaptcha"]="1";const h="/"===a.pathname[0]?"":"/";return t.action=(0,n._Y)(`${h}${a.pathname}?${(0,r.Go)(l)}`),!0})),u=(e,t)=>{const i=t.querySelector("[data-formvalidate-sign-url]");if(null===i)return Promise.resolve("");const s=i.getAttribute("data-formvalidate-sign-url"),o=t.querySelector("[name=csrfmiddlewaretoken]");return"string"!=typeof s||null===o?Promise.resolve(""):(0,n.KF)(s,{recaptcha3:e,field_to_sign:i.value,csrfmiddlewaretoken:o.value}).then((e=>{const t=JSON.parse(e.responseText);if(!0!==t.valid)throw new l(t.errors);return t.signed_value})).catch((e=>{if(e.isValidationError)throw e;return error("Can't sign recaptcha: ",e),""}))};function p(){for(const e of document.querySelectorAll("form[data-formvalidate]")){const t=(0,s.R)(e),i=e.querySelector("[name='prove_you_are_human']");null!==i&&d(i,t)}}},1779:(e,t,i)=>{"use strict";i.d(t,{CK:()=>c,Eh:()=>p,Gy:()=>g,T1:()=>m,_c:()=>b,aS:()=>y,bR:()=>f,et:()=>w,lh:()=>u});var s=i(7623),n=i(6784),o=i(8423);const r={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5},a=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror"],l=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],h=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"];let d;"fullscreenEnabled"in document?d=Object.keys(r):a[0]in document?d=a:l[0]in document?d=l:h[0]in document&&(d=h);const c=500;function u(e){void 0!==d?e[d[r.requestFullscreen]]():"webkitEnterFullScreen"in e&&e.webkitEnterFullScreen()}function p(){void 0!==d&&((0,s.J0)()?window.setTimeout((()=>{[...document.getElementsByTagName("video")].forEach((e=>{!0===e.webkitDisplayingFullscreen&&e.webkitExitFullscreen()}))}),0):y()&&document[d[r.exitFullscreen]].bind(document)())}function m(){return void 0!==d&&Boolean(document[d[r.fullscreenEnabled]])}function g(){if(void 0!==d)return document[d[r.fullscreenElement]]}function v(){return void 0===d?"":d[r.fullscreenchange]}function f(){return void 0===d?"":`${d[r.fullscreenerror]}`.toLowerCase()}function y(){return Boolean(g())}const b=new o.c_("fullscreenChange",{listenersWarningThreshold:()=>50+o.hI,maxHistorySize:0});function w(){""!==v()&&(0,n.wu)(v(),document,(()=>b.fire()))}},1675:(e,t,i)=>{"use strict";i.d(t,{Qx:()=>k,eB:()=>A,$m:()=>P});var s=i(9447),n=i(6784),o=i(2709),r=i(2032),a=i(1519),l=i(7668);class h extends o.u{constructor(e){super(),this.element.style.height="0",this.element.style.width="0",this.element.style.overflow="visible",this.element.style.position="fixed",this.element.style.top="0",this.element.style.left="0",this.componentToOverlay=e.componentToOverlay,this.listener=()=>{this.repositionChildrenRecursive()},this.componentToOverlay.didRepositionEvent.listen(this.listener),this.addChild(new c(this,e)),this.addChild(new u(this,e)),this.addChild(new p(this,e)),this.addChild(new m(this,e)),this.addChild(new g(this,e)),this.addChild(new v(this,e)),this.addChild(new f(this,e)),this.addChild(new y(this,e))}repositionChildren(){}prepareToRemove(){this.componentToOverlay.didRepositionEvent.removeListener(this.listener)}}class d extends o.u{constructor(e,t,i){super(),this.holder=e,this.options=t,this.cursor=i,this.thickness=8,this.element.style.height=`${this.thickness}px`,this.element.style.width=`${this.thickness}px`,this.element.style.cursor=this.cursor,(0,l.S)(this.element,((e,i,s)=>{e.stopPropagation(),void 0!==t.onStart&&t.onStart();const n=i,o=s,l=Object.freeze((0,r.w_)(t.componentToOverlay.element)),h=new a.a((()=>{t.componentToOverlay.repositionChildrenRecursive()}),{bounceLimitMS:10});return{enabled:!0,move:(e,i)=>{(0,r.ly)(this.moveEdges(l,{x:e-n,y:i-o}),t.componentToOverlay.element),h.callFunc()},end:()=>{void 0!==t.onStop&&t.onStop()}}}))}}class c extends d{constructor(e,t){super(e,t,"ns-resize")}repositionChildren(){const e=this.options.componentToOverlay.element.getBoundingClientRect();this.element.style.top=e.top-this.thickness/2+"px",this.element.style.left=`${e.left}px`,this.element.style.width=e.right-e.left+"px"}moveEdges(e,t){return(0,r.qX)(e,t.y,this.options.minHeight)}}class u extends d{constructor(e,t){super(e,t,"ns-resize")}repositionChildren(){const e=this.options.componentToOverlay.element.getBoundingClientRect();this.element.style.top=e.top+e.height-this.thickness/2+"px",this.element.style.left=`${e.left}px`,this.element.style.width=`${e.width}px`}moveEdges(e,t){return(0,r.GD)(e,t.y,this.options.minHeight,this.options.maxHeight())}}class p extends d{constructor(e,t){super(e,t,"ew-resize")}repositionChildren(){const e=this.options.componentToOverlay.element.getBoundingClientRect();this.element.style.top=`${e.top}px`,this.element.style.left=e.left-this.thickness/2+"px",this.element.style.height=e.bottom-e.top+"px"}moveEdges(e,t){return(0,r.U5)(e,t.x,this.options.minWidth)}}class m extends d{constructor(e,t){super(e,t,"ew-resize")}repositionChildren(){const e=this.options.componentToOverlay.element.getBoundingClientRect();this.element.style.top=`${e.top}px`,this.element.style.left=e.right-this.thickness/2+"px",this.element.style.height=e.bottom-e.top+"px"}moveEdges(e,t){return(0,r.xn)(e,t.x,this.options.minWidth,this.options.maxWidth())}}class g extends d{constructor(e,t){super(e,t,"nwse-resize")}repositionChildren(){const e=this.options.componentToOverlay.element.getBoundingClientRect();this.element.style.top=e.top-this.thickness+this.thickness/2+"px",this.element.style.left=e.left-this.thickness+this.thickness/2+"px"}moveEdges(e,t){const i=(0,r.qX)(e,t.y,this.options.minHeight),s=(0,r.U5)(e,t.x,this.options.minWidth);return{top:i.top,height:i.height,left:s.left,width:s.width}}}class v extends d{constructor(e,t){super(e,t,"nesw-resize")}repositionChildren(){const e=this.options.componentToOverlay.element.getBoundingClientRect();this.element.style.top=e.top-this.thickness+this.thickness/2+"px",this.element.style.left=e.right-this.thickness/2+"px"}moveEdges(e,t){const i=(0,r.qX)(e,t.y,this.options.minHeight),s=(0,r.xn)(e,t.x,this.options.minWidth,this.options.maxWidth());return{top:i.top,height:i.height,left:s.left,width:s.width}}}class f extends d{constructor(e,t){super(e,t,"nesw-resize")}repositionChildren(){const e=this.options.componentToOverlay.element.getBoundingClientRect();this.element.style.top=e.bottom-this.thickness/2+"px",this.element.style.left=e.left-this.thickness+this.thickness/2+"px"}moveEdges(e,t){const i=(0,r.GD)(e,t.y,this.options.minHeight,this.options.maxHeight()),s=(0,r.U5)(e,t.x,this.options.minWidth);return{top:i.top,height:i.height,left:s.left,width:s.width}}}class y extends d{constructor(e,t){super(e,t,"nwse-resize")}repositionChildren(){const e=this.options.componentToOverlay.element.getBoundingClientRect();this.element.style.top=e.bottom-this.thickness/2+"px",this.element.style.left=e.right-this.thickness/2+"px"}moveEdges(e,t){const i=(0,r.GD)(e,t.y,this.options.minHeight,this.options.maxHeight()),s=(0,r.xn)(e,t.x,this.options.minWidth,this.options.maxWidth());return{top:i.top,height:i.height,left:s.left,width:s.width}}}var b=i(8423),w=i(7407),C=i(7623),S=i(3955),x=i(8936);class T{constructor(e,t,i){this.draggableCanvasWindow=e,this.config=i,this.bounds={leftBound:NaN,topBound:NaN,bottomBound:NaN,rightBound:NaN,width:NaN,height:NaN},this.localStorageKey=`window__${t}`,this.bounds=this.getBoundsFromStorage(),isNaN(this.bounds.width)&&(this.bounds.width=this.config.defaultWidth),isNaN(this.bounds.height)&&(this.bounds.height=this.config.defaultHeight),this.setDefaultHorizontalBounds(),this.setDefaultVerticalBounds()}setDefaultVerticalBounds(){isNaN(this.bounds.topBound)&&isNaN(this.bounds.bottomBound)&&(this.config.defaultAnchors.indexOf(3)>=0?this.bounds.bottomBound=(0,S.XJ)():this.config.defaultAnchors.indexOf(4)>=0?this.bounds.topBound=Math.max(0,window.innerHeight/2-this.config.defaultHeight/2):this.bounds.topBound=0)}setDefaultHorizontalBounds(){isNaN(this.bounds.leftBound)&&isNaN(this.bounds.rightBound)&&(this.config.defaultAnchors.indexOf(1)>=0?this.bounds.rightBound=(0,S.XJ)():this.config.defaultAnchors.indexOf(4)>=0?this.bounds.leftBound=Math.max(0,(0,x.DK)()/2-this.config.defaultWidth/2):this.bounds.leftBound=0)}getBoundsFromStorage(){let e={leftBound:NaN,topBound:NaN,bottomBound:NaN,rightBound:NaN,width:NaN,height:NaN};if((0,C.Pf)()){const t=window.localStorage.getItem(this.localStorageKey);null!==t&&(e=JSON.parse(t),Object.keys(e).forEach((t=>{null===e[t]&&(e[t]=NaN)})),isNaN(e.width)&&(e.width=this.config.defaultWidth),isNaN(e.height)&&(e.height=this.config.defaultHeight))}return e}save(){this.detect(),(0,C.Pf)()&&window.localStorage.setItem(this.localStorageKey,JSON.stringify(this.bounds))}detect(){const e=this.draggableCanvasWindow.element.parentElement;if(null===e)return void error("no parent element");const t=this.draggableCanvasWindow.element.offsetLeft,i=this.draggableCanvasWindow.element.offsetTop,s=e.clientHeight-(this.draggableCanvasWindow.element.offsetHeight+i),n=e.clientWidth-(this.draggableCanvasWindow.element.offsetWidth+t);this.bounds.height=this.draggableCanvasWindow.element.offsetHeight,this.bounds.width=this.draggableCanvasWindow.element.offsetWidth,t<=n?(this.bounds.leftBound=t,this.bounds.rightBound=NaN):(this.bounds.leftBound=NaN,this.bounds.rightBound=n),i<=s?(this.bounds.topBound=i,this.bounds.bottomBound=NaN):(this.bounds.topBound=NaN,this.bounds.bottomBound=s)}apply(){const e=this.draggableCanvasWindow.element.parentElement;if(null===e)return void error("no parent element");if(0===e.clientHeight)return;void 0!==this.config.autoSize&&this.config.autoSize?(this.draggableCanvasWindow.innerDiv.style.position="relative",this.draggableCanvasWindow.element.style.width="auto",this.draggableCanvasWindow.element.style.height="auto",this.bounds.height=this.draggableCanvasWindow.element.offsetHeight,this.bounds.width=this.draggableCanvasWindow.element.offsetWidth):this.config.resizeable?((()=>{this.bounds.width=Math.min(this.bounds.width,e.clientWidth),this.bounds.height=Math.min(this.bounds.height,e.clientHeight),this.bounds.width=Math.max(this.bounds.width,this.config.minWidth),this.bounds.height=Math.max(this.bounds.height,this.config.minHeight)})(),this.draggableCanvasWindow.element.style.width=`${this.bounds.width}px`,this.draggableCanvasWindow.element.style.height=`${this.bounds.height}px`):(this.bounds.width=this.config.defaultWidth,this.bounds.height=this.config.defaultHeight+this.draggableCanvasWindow.getTitleBarHeight(),this.draggableCanvasWindow.element.style.width=`${this.bounds.width}px`,this.draggableCanvasWindow.element.style.height=`${this.bounds.height}px`),this.sanityCheckBounds()?info(`unexpected bounds: top:${this.bounds.topBound} bottom:${this.bounds.bottomBound} left:${this.bounds.leftBound} right: ${this.bounds.rightBound}`):(this.setVerticalPosition(e.clientHeight),this.setHorizontalPosition(e.clientWidth))}sanityCheckBounds(){const e=!isNaN(this.bounds.topBound)&&!isNaN(this.bounds.bottomBound)||isNaN(this.bounds.topBound)&&isNaN(this.bounds.bottomBound),t=!isNaN(this.bounds.leftBound)&&!isNaN(this.bounds.rightBound)||isNaN(this.bounds.leftBound)&&isNaN(this.bounds.rightBound);return e||t}setVerticalPosition(e){isNaN(this.bounds.topBound)?isNaN(this.bounds.bottomBound)||((this.bounds.bottomBound+this.bounds.height>e||this.bounds.bottomBound<0)&&(info("set bottomBound to container height - bounds height to make fit"),this.bounds.bottomBound=Math.max(0,e-this.bounds.height)),this.draggableCanvasWindow.element.style.top=e-this.bounds.height-this.bounds.bottomBound+"px"):((this.bounds.topBound+this.bounds.height>e||this.bounds.topBound<0)&&(info("set topBound to container height - bounds height to make fit"),this.bounds.topBound=Math.max(0,e-this.bounds.height)),this.draggableCanvasWindow.element.style.top=`${this.bounds.topBound}px`)}setHorizontalPosition(e){isNaN(this.bounds.leftBound)?isNaN(this.bounds.rightBound)||((this.bounds.rightBound+this.bounds.width>e||this.bounds.rightBound<0)&&(info("set rightBound to 0 to make fit"),this.bounds.rightBound=0),this.draggableCanvasWindow.element.style.left=e-this.bounds.width-this.bounds.rightBound+"px"):((this.bounds.leftBound+this.bounds.width>e||this.bounds.leftBound<0)&&(info("set leftBound to 0 to make fit"),this.bounds.leftBound=0),this.draggableCanvasWindow.element.style.left=`${this.bounds.leftBound}px`)}}const P=2;class k extends o.u{constructor(e,t,i){super(),this.draggableCanvas=e,this.content=t,this.config=i,this.isDraggingOrResizing=!1,this.draggingOrResizingChanged=new b.c_("draggingOrResizingChanged"),this.isOpen=!1,(0,s.fZ)(this.element,"draggableCanvasWindow"),this.element.style.overflow="visible",this.innerDiv=document.createElement("div"),(0,s.fZ)(this.innerDiv,"innerDiv"),this.innerDiv.style.height="100%",this.innerDiv.style.width="100%",this.innerDiv.style.position="absolute",this.innerDiv.style.overflow="visible",this.innerDiv.style.boxSizing="border-box",this.innerDiv.style.borderWidth=`${P}px`,this.innerDiv.style.borderStyle="solid",this.innerDiv.style.borderRadius="4px",this.closable=void 0!==i.title;const o=this.closeButton=document.createElement("div");(0,s.fZ)(this.closeButton,"closeButton"),this.closeButton.id=`${this.config.windowKey}-close-btn`.toLowerCase(),this.closeButton.dataset.paction="TheaterChat",this.closeButton.dataset.pactionName="ChatTab_Close",this.closeButton.style.position="absolute",this.closeButton.style.right="4px",this.closeButton.style.height="10px",this.closeButton.style.width="10px",this.closeButton.style.cursor="pointer",this.closeButton.style.borderWidth="1px",this.closeButton.style.borderStyle="solid",this.closeButton.style.borderRadius="2px",(0,n.wu)("mouseenter",this.closeButton,(()=>{o.style.backgroundImage=`url(${STATIC_URL}grey-close.svg)`,o.style.backgroundSize="10px"})),(0,n.wu)("mouseleave",this.closeButton,(()=>{o.style.backgroundImage=""})),void 0!==i.title?(this.titleBarDiv=document.createElement("div"),(0,s.fZ)(this.titleBarDiv,"titleBar"),this.titleBarDiv.style.position="relative",this.titleBarDiv.style.fontSize="13px",this.titleBarDiv.style.fontWeight="bold",this.titleBarDiv.style.padding="3px 3px 3px 5px",this.titleBarDiv.style.borderRadius="4px 4px 0 0",this.titleBarDiv.style.minHeight="10px",this.titleBarDivInner=document.createElement("div"),this.titleBarDivInner.style.height="100%",this.titleBarDivInner.style.whiteSpace="nowrap",this.titleBarDivInner.style.overflow="hidden",this.titleBarDivInner.style.textOverflow="ellipsis",this.titleBarDiv.appendChild(this.titleBarDivInner),this.titleSpan=document.createElement("span"),this.titleSpan.innerText=i.title,this.titleBarDivInner.appendChild(this.titleSpan),this.onClose=i.onClose,this.titleBarDiv.appendChild(this.closeButton),this.innerDiv.appendChild(this.titleBarDiv),(0,n.wu)("click",this.closeButton,(e=>{e.stopPropagation(),this.draggableCanvas.removeChild(this)}))):(this.closeButton.style.top="8px",this.closeButton.style.zIndex="1",this.element.appendChild(this.closeButton),(0,n.wu)("click",this.closeButton,(e=>{e.stopPropagation(),this.element.style.display="none",this.isOpen=!1}))),this.addChild(this.content,this.innerDiv),this.positioner=new T(this,this.config.windowKey,this.config),this.stopDraggingOrResizing=()=>{this.positioner.save(),this.repositionChildrenRecursive()},void 0===i.handles&&(i.handles=void 0!==this.titleBarDivInner?[this.titleBarDivInner]:[this.element]),A(this.element,{dragStart:()=>{this.focusThisWindow(),this.setDraggingOrResizing(!0)},dragStop:()=>{this.setDraggingOrResizing(!1),this.stopDraggingOrResizing(),(0,w.bT)("MoveDraggableWindow",{window:this.getWindowKey(),left:this.element.offsetLeft,top:this.element.offsetTop,windowWidth:window.innerWidth,windowHeight:window.innerHeight})},canStart:()=>!this.isDraggingOrResizing},i.handles),!0===i.resizeable&&this.makeResizeable(),this.element.appendChild(this.innerDiv)}focusThisWindow(){this.draggableCanvas.setFocusedWindow(this)}setTitle(e){void 0!==this.titleSpan&&(this.titleSpan.innerText=e)}makeResizeable(){void 0===this.resizeHandles&&(this.resizeHandles=this.addChild(new h({minWidth:this.config.minWidth,minHeight:this.config.minHeight,maxWidth:()=>this.draggableCanvas.element.clientWidth,maxHeight:()=>this.draggableCanvas.element.clientHeight,componentToOverlay:this,onStart:()=>{this.focusThisWindow(),this.setDraggingOrResizing(!0)},onStop:()=>{this.setDraggingOrResizing(!1),this.stopDraggingOrResizing(),(0,w.bT)("ResizeDraggableWindow",{window:this.getWindowKey(),width:this.element.clientWidth,height:this.element.clientHeight,windowWidth:window.innerWidth,windowHeight:window.innerHeight})}})),this.resizeHandles.repositionChildrenRecursive())}resize(e,t){this.config.defaultHeight=e,this.config.defaultWidth=t,this.repositionChildren()}setDraggingOrResizing(e){this.isDraggingOrResizing=e,this.draggingOrResizingChanged.fire(e)}repositionChildren(){void 0!==this.config.autoSize&&this.config.autoSize?this.content.element.style.height="auto":this.content.element.style.height=this.element.clientHeight-this.getTitleBarHeight()-2*P+"px",void 0!==this.titleBarDiv&&(void 0===this.closeButton?error("expected close button to be defined"):void 0===this.titleBarDivInner?error("expected title bar div inner to be defined"):(this.titleBarDivInner.style.maxWidth=this.titleBarDiv.clientWidth-this.closeButton.offsetWidth-5-8+"px",this.closeButton.style.top=(this.titleBarDiv.offsetHeight-this.closeButton.offsetHeight)/2+"px"))}getWindowKey(){return this.config.windowKey}getTitleBarHeight(){return void 0===this.titleBarDiv?0:this.titleBarDiv.offsetHeight}gainedFocus(){this.innerDiv.style.opacity="1",void 0!==this.config.onGainedFocus&&this.config.onGainedFocus()}lostFocus(){this.innerDiv.style.opacity=void 0!==this.config.blurOpacity?this.config.blurOpacity:"1"}blur(){this.draggableCanvas.focusedWindow===this&&this.draggableCanvas.setFocusedWindow(void 0)}handleKeyEvent(e){return void 0!==this.config.onKey&&this.config.onKey(e)}}function A(e,t,i){for(const s of i)s.style.cursor="move",(0,l.S)(s,((i,s,n)=>{if(void 0!==t.canStart&&!1===t.canStart())return l.P;const o=e.offsetLeft,r=e.offsetTop,a=e.offsetHeight,h=e.offsetWidth;if(null===e.parentElement)return error("draggable without parent element"),l.P;const d=e.parentElement.clientHeight,c=e.parentElement.clientWidth,u=s,p=n;let m=u,g=p;return void 0!==t.dragStart&&t.dragStart(),{enabled:!0,move:(t,i)=>{m=t,g=i,(()=>{let t=r+(g-p),i=o+(m-u);t<0?t=0:t+a>d&&(t=d-a),i<0?i=0:i+h>c&&(i=c-h),e.style.top=`${t}px`,e.style.left=`${i}px`})()},end:()=>{void 0!==t.dragStop&&t.dragStop()}}}))}},3654:(e,t,i)=>{"use strict";i.d(t,{CM:()=>_,Qp:()=>I,U$:()=>E,YC:()=>F,j7:()=>R,j8:()=>L,mh:()=>N,r_:()=>H,xm:()=>T});var s=i(7623),n=i(5276),o=i(9447),r=i(9930),a=i(9419),l=i(9461),h=i(5216),d=i(8122),c=i(2382),u=i(2939),p=i(1779),m=i(6094),g=i(1284),v=i(7407),f=i(34),y=i(2359),b=i(7569),w=i(4947),C=i(9681),S=i(4140),x=i(6716);const T=2;let P,k;function A(e){const t=(0,c.lK)(e),i=new m.P(t.red,t.green,t.blue),s=i.brightness();return i.raiseToMin(255-s/3),`rgb(${i.red}, ${i.green}, ${i.blue})`}function M(e,t){return new C.L(e,t)}function R(e){const t=N(e.fromUser.username);t.style.fontSize="";const i=document.createElement("div");i.style.borderRadius="4px",i.style.padding=`0 ${T}px`,t.appendChild(i);const o=M(e.fromUser,e);o.element.style.paddingRight="4px",i.appendChild(o.element);const r=(0,y.e4)(e.message);return r.style.color=void 0!==e.textColor?e.textColor:"#FFFFFF",void 0!==e.font&&(o.element.style.fontFamily=e.font,r.style.fontFamily=e.font),r.classList.add("msg-text"),r.dataset.testid="chat-message-text",o.element.dataset.paction="TheaterChat",o.element.dataset.pactionName="Username",o.element.dataset.testid="chat-message-username",i.appendChild(r),(0,s.lT)()?window.setTimeout((()=>{n.A.parse(i,{className:"emojiChat"})}),0):(0,s.AD)()||n.A.parse(i,{className:"emojiChat"}),(0,d.hd)(i,e.textColor,e.backgroundColor),I(t),(0,g.V_)(e,t),t}function I(e){const t=e.querySelectorAll(".username-mention"),i=[],s=a.k.getInstance(),n=s.users();for(const e of t){const t=e.innerText.replace("@","").toLowerCase(),s=n.find((e=>e.username===t));if(void 0!==s){var o,r;const t=M(s).createMentionLabel((null===(o=l.Bm.current.loggedInUser)||void 0===o?void 0:o.username)===s.username);null===(r=e.parentElement)||void 0===r||r.replaceChild(t,e)}else i.push(t)}s.addInvalidUsers(i)}function E(e,t,i){for(const s of t){const t=document.createElement("div");for(const e of s)switch(e.partType){case 1:t.appendChild(O(e,i));break;case 0:t.appendChild(M(e.user,void 0).element);break;case 2:t.appendChild(U(e.message));break;case 3:t.appendChild(B(w.R.spyPrivateShowLower,(()=>{"privatespying"!==k.status&&(0,f.lh)(k)})));break;default:error(`Unknown roomNotice type: ${e.partType}`,e)}e.appendChild(t)}return e}function L(e){const t=N(e.fromUser.username);t.style.fontSize="";const i=document.createElement("div");i.style.borderRadius="4px",i.style.padding=`0 ${T}px`,t.appendChild(i);const s=M(e.fromUser,e);s.element.style.paddingRight="4px",i.appendChild(s.element);const n=document.createElement("div");n.classList.add("msg-text"),n.style.display="inline-block";const o=(0,y.BP)(e,D,x.f6);void 0!==e.font&&(s.element.style.fontFamily=e.font,o.style.fontFamily=e.font),n.appendChild(o);const r=document.createElement("div");return r.style.display="inline-block",r.appendChild(n),i.appendChild(r),(0,d.hd)(i,e.textColor,e.backgroundColor),I(t),(0,g.V_)(e,t),t}function D(e,t,i){const s=B(e,i);return void 0!==t&&""!==t&&(s.href=(0,h._Y)(t),s.target="_blank"),s}function B(e,t){const i=document.createElement("a");return(0,o.fZ)(i,"msg-link"),i.style.textDecoration="underline",i.innerText=e,i.onclick=t,i.style.cursor="pointer",i}function U(e){var t;const i=document.createElement("a");return i.href=(0,h._Y)(`/tag/${e}/${null!==(t=P)&&void 0!==t?t:""}`),(0,o.fZ)(i,"msg-link"),i.style.textDecoration="none",i.innerText=`#${e}`,(0,r.r)()&&(i.onclick=e=>{(0,p.aS)()&&(0,p.Eh)(),r.XS.fire(e)}),i}function _(e){const t=N();return t.innerText=e,(0,S.yX)(t,A("#aaaaaa")),t}function F(e,t){function i(e){const t=document.createElement("span");return t.innerText=e,t}const s=N();(0,S.yX)(s,A("#aaaaaa"));const n=t?w.R.pmSupporterNoticeAgeVerified:w.R.pmSupporterNotice;s.appendChild(i(n)),s.appendChild(document.createElement("br")),s.appendChild(i(`${w.R.pmSupporterSignUp} `));const o=B(w.R.pmSupporterMembership,(()=>{}));return o.href=(0,h._Y)(`/supporter/upgrade/?source=${l.Bm.current.PurchaseEventSources.SUPPORTER_SOURCE_PM_UPSELL}`),o.target="_blank",o.dataset.testid="supporter-upsell-link",o.onclick=()=>{(0,v.bT)("SupporterPageOpened",{source:"chat"})},s.appendChild(o),s.appendChild(i(` ${w.R.pmSupporterSendPm(e)}.`)),s}function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=document.createElement("div");return t.dataset.testid="chat-message",t.style.fontFamily="Tahoma,Arial,Helvetica,sans-serif",t.style.boxSizing="border-box",t.style.paddingTop="3px",t.style.paddingBottom="3px",t.style.paddingLeft="5px",t.style.paddingRight="5px",t.style.overflowWrap="break-word",t.style.wordWrap="break-word",e.length>0&&t.setAttribute("data-nick",e),t}function O(e,t){let i=document.createElement("span");return void 0!==e.message&&t&&b.fM.isShortcodeSyntax(e.message)?i=(0,y.P7)(e,t,D,x.f6):!1!==e.parseEmoticon?i=(0,y.e4)(e.message):i.innerText=e.message,i.style.color=void 0!==e.foreground?e.foreground:"",i.style.background=void 0!==e.background?e.background:"",i.style.fontWeight=void 0!==e.weight?e.weight:"",i}function H(e,t){const i=N(e);return i.innerText=e,i.appendChild(t),(0,S.yX)(i,A("#aaaaaa")),i.classList.add("roomNotice"),i}u.X0.listen((e=>{P=e.dossier.roomGender,k=e.chatConnection}))},4140:(e,t,i)=>{"use strict";function s(e,t){e.setAttribute("data-pureChatColor",t),e.style.setProperty("--pureChatColor",t),e.classList.add("pureChatColor")}function n(e){const t=e=>{const t=e.getAttribute("data-pureChatColor");null!==t&&(e.style.color=t)};if(e.classList.contains("pureChatColor"))t(e);else for(const i of e.getElementsByClassName("pureChatColor"))i instanceof HTMLElement&&t(i)}i.d(t,{c6:()=>n,mY:()=>l,yX:()=>s});const o=20,r=new Map,a="pureHidden";function l(e){e.forEach((e=>{e.classList.remove(a),function(e){window.clearTimeout(r.get(e)),r.set(e,window.setTimeout((()=>{e.classList.add(a),r.delete(e)}),1e3*o))}(e)}))}},6716:(e,t,i)=>{"use strict";i.d(t,{F_:()=>h,Iw:()=>n,VZ:()=>a,eY:()=>l,f6:()=>r,gh:()=>c,p3:()=>o,sb:()=>u,y6:()=>d});var s=i(8423);const n=new s.c_("bioClicked"),o=new s.c_("userListRequest"),r=new s.c_("openTipCalloutRequest"),a=new s.c_("loadRoomRequest"),l=new s.c_("reportAbuseRequest"),h=new s.c_("privateWindowRequest"),d=new s.c_("chatWindowRequest"),c=new s.c_("colorModeChangeRequest"),u=new s.c_("roomChangeColorModeUpdateRequest")},7882:(e,t,i)=>{"use strict";i.d(t,{Bg:()=>s.Bg,CM:()=>s.CM,IL:()=>s.IL,P_:()=>s.P_,YT:()=>s.YT,hf:()=>s.hf,jM:()=>o,tg:()=>n.getVerboseGenderPath});var s=i(1048),n=i(6624);function o(e){const t=s.IL.get(e);return void 0!==t?t:"followed"===e?"o":(error(`Unknown user category ${e}`),"")}},5412:(e,t,i)=>{"use strict";i.d(t,{x:()=>n});const s={enter:13,esc:27,modifierKeys:{ctrl:17,shift:16,alt:18,leftMeta:91,rightMeta:93,caps:20,tab:9},arrowKeys:{left:37,up:38,right:39,down:40}};function n(e){return void 0!==e&&e!==s.enter&&e!==s.esc&&!Object.values(s.modifierKeys).includes(e)&&!Object.values(s.arrowKeys).includes(e)}},1191:(e,t,i)=>{"use strict";i.d(t,{t:()=>s});class s{constructor(){this.handlers=[]}addHandler(e){this.handlers.push(e)}execute(e){for(const t of this.handlers)if(!t.requiresCtrlOrMeta||e.ctrlKey||e.metaKey){if(void 0!==t.code&&e.code===t.code)return t.handle(e),!0;if(void 0!==t.key&&e.key===t.key)return t.handle(e),!0;if(e.which===t.keyCode&&(!t.requiresCtrlOrMeta||e.ctrlKey||e.metaKey))return t.handle(e),!0}return!1}}},9741:(e,t,i)=>{"use strict";i.d(t,{a:()=>a,o:()=>r});var s=i(9447),n=i(7322);function o(e,t){const i=document.createElement("div");i.innerText=t,i.style.overflow="hidden",i.style.maxHeight="21px",e.appendChild(i)}function r(e){return void 0===e?a():a({name:e.getString("name",!1),template:e.getString("template",!1),firstRowLabel:e.getStringWithNumbers("row1_label",!1),secondRowLabel:e.getStringWithNumbers("row2_label",!1),thirdRowLabel:e.getStringWithNumbers("row3_label",!1),firstRowValue:e.getStringWithNumbers("row1_value",!1),secondRowValue:e.getStringWithNumbers("row2_value",!1),thirdRowValue:e.getStringWithNumbers("row3_value",!1)})}function a(e){const t=document.createElement("tr"),i=document.createElement("tr"),r=document.createElement("tr");if(void 0!==e){const n=e.template,a=[],l=[];if(""!==e.firstRowLabel){const i=document.createElement("th");i.style.padding="2px",o(i,e.firstRowLabel),a.push(i),t.appendChild(i);const s=document.createElement("td");o(s,e.firstRowValue),t.appendChild(s),l.push(s),s.style.width="50%",s.style.paddingLeft="10px"}else{const i=document.createElement("td");o(i,e.firstRowValue),i.colSpan=2,l.push(i),t.appendChild(i),i.style.textAlign="center"}if(""!==e.secondRowLabel){const t=document.createElement("th");t.style.padding="2px",t.style.fontWeight="bold",o(t,e.secondRowLabel),a.push(t),i.appendChild(t);const s=document.createElement("td");o(s,e.secondRowValue),l.push(s),i.appendChild(s),s.style.width="50%",s.style.paddingLeft="10px"}else{const t=document.createElement("td");o(t,e.secondRowValue),t.colSpan=2,l.push(t),i.appendChild(t),t.style.textAlign="center"}if(""!==e.thirdRowLabel){const t=document.createElement("th");t.style.padding="2px",o(t,e.thirdRowLabel),a.push(t),r.appendChild(t);const i=document.createElement("td");o(i,e.thirdRowValue),l.push(i),r.appendChild(i),i.style.width="50%",i.style.paddingLeft="10px"}else{const t=document.createElement("td");o(t,e.thirdRowValue),t.colSpan=2,l.push(t),r.appendChild(t),t.style.textAlign="center"}for(const e of a)e.style.overflow="hidden",e.style.display="block",e.style.cssFloat="right";"3_rows_of_labels"===n?((0,s.fZ)(a[0],"threeRowsOfLabels"),a[0].style.display="block",a[0].style.margin="0px auto",a[0].style.height="16px",a[0].style.fontWeight="bold"):"3_rows_11_21_31"!==n&&"3_rows_11_22_32"!==n||((0,s.fZ)(l[0],"threeRows-11-21-31"),l[0].style.fontWeight="bold")}else{const e=document.createElement("td");t.appendChild(e.cloneNode()),i.appendChild(e.cloneNode()),r.appendChild(e.cloneNode())}(0,s.fZ)(t,"rowOne"),t.style.height="33.3333%",(0,s.fZ)(i,"rowTwo"),i.style.height="33.3333%",(0,s.fZ)(r,"rowThree"),r.style.height="33.3333%";const a=document.createElement("table");return a.id="AppPanelTable",a.style.fontSize="11px",a.style.lineHeight="1.7em",a.style.width=`${n.un}px`,a.style.height=`${n.zZ}px`,a.style.borderCollapse="collapse",a.style.margin="0 auto",a.style.tableLayout="fixed",a.appendChild(t),a.appendChild(i),a.appendChild(r),a}},819:(e,t,i)=>{"use strict";i.d(t,{ir:()=>b,nQ:()=>y,p$:()=>m,qK:()=>g});var s=i(4936),n=i(8861),o=i(213),r=i(5216),a=i(6844),l=i(9060),h=i(4947),d=i(5389);let c;const u=["total_viewers","image_url","password_warning"];let p=[];function m(e,t){clearTimeout(c),(0,a.ok)()&&function(e){const t=e.age();if(void 0!==t){const e=[];w.forEach(((i,s)=>{i[0]<=t&&i[1]>t&&e.push(s)}));let s={};try{var i;s=JSON.parse(null!==(i=(0,n.oD)("ag"))&&void 0!==i?i:"{}")}catch(e){}e.forEach((e=>{var t;s[e]=(null!==(t=s[e])&&void 0!==t?t:0)+1})),(0,n.uC)("ag",JSON.stringify(s),{days:30},"/",(0,l.DV)())}}(e);const i=v(e,t);c=window.setTimeout((()=>{f(i),m(e,t)}),55e3)}function g(e,t){f(v(e,t))}function v(e,t){let i=`contest/log/${e.room()}/`;if(""!==t){const e=new s.N6(t).getString("hashtag");i=`${i}?hashtag=${encodeURIComponent(e)}`}return i}function f(e){(0,r.Aw)(e).then((e=>{const t=new s.N6(e.responseText),i=t.getBoolean("can_access"),n=t.getBoolean("is_banned"),o=t.getList("warnings");for(const e of u)t.ignore(e);i||window.location.reload(),n&&(0,d.EO)(),void 0!==o&&o.forEach((e=>{y({text:e.getString("text"),warningId:e.getNumber("id"),response:e.getBoolean("allow_response")})})),t.logUnusedDebugging("logPresence")})).catch((e=>{error("log_presence failed",e)}))}function y(e){e.response?window.location.href=(0,r._Y)(`/accounts/site_message/?next=${window.location.href}`):!1===p.includes(e.warningId)&&((0,o.mf)(e.text,(()=>{window.open((0,r._Y)(`/accounts/site_message/?next=${window.location.href}&question=true`),"_blank")}),(()=>{(0,r.KF)("/accounts/site_message/",{}).catch((e=>{error(`post error accessing site messages: ${e}`)})),p=p.filter((t=>t!==e.warningId))}),{acceptText:h.R.broadcasterWarningQuestion,declineText:h.R.broadcasterWarningAknowledge,title:h.R.broadcasterWarningMessage,titleSmall:!0},!0),p.push(e.warningId))}function b(){clearTimeout(c)}const w=new Map([["teen-cams",[18,20]],["18to21-cams",[18,22]],["20to30-cams",[20,31]],["30to50-cams",[30,51]],["mature-cams",[50,20]]])},6094:(e,t,i)=>{"use strict";i.d(t,{P:()=>s});class s{constructor(e,t,i){this.red=e,this.green=t,this.blue=i,this.redWeight=10,this.greenWeight=10,this.blueWeight=10}raiseToMin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=.05;for(e=Math.min(255,e);e>this.brightness()&&(!t||255!==this.red&&255!==this.green&&255!==this.blue);)this.red=Math.min(this.red+Math.max(1,i*this.red),255),this.green=Math.min(this.green+Math.max(1,i*this.green),255),this.blue=Math.min(this.blue+Math.max(1,i*this.blue),255);this.red=Math.round(this.red),this.green=Math.round(this.green),this.blue=Math.round(this.blue)}totalWeights(){return this.redWeight+this.greenWeight+this.blueWeight}redMultiplier(){return this.redWeight/this.totalWeights()}greenMultiplier(){return this.greenWeight/this.totalWeights()}blueMultiplier(){return this.blueWeight/this.totalWeights()}brightness(){return Math.round(this.redMultiplier()*this.red+this.greenMultiplier()*this.green+this.blueMultiplier()*this.blue)}}},3959:(e,t,i)=>{"use strict";var s;function n(e){return!0===e.isPrivate}i.d(t,{d:()=>n,k:()=>s}),function(e){e.App="App",e.RoomLeave="RoomLeave"}(s||(s={}))},1284:(e,t,i)=>{"use strict";i.d(t,{LQ:()=>f,NZ:()=>b,Sy:()=>u,Uq:()=>g,V_:()=>y,W2:()=>m,mh:()=>p});var s=i(7871),n=i(9447),o=i(718),r=i(5216),a=i(2382),l=i(4140),h=i(6094),d=i(2091),c=i(4947);function u(){const e=document.createElement("div");return e.style.width="100%",e.style.display="inline-block",e.style.padding="0px",e.style.position="relative",e.style.boxSizing="border-box",e.style.borderRadius="4px",e.style.marginRight="4px",e}function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=document.createElement("div");return t.dataset.testid="chat-message",t.style.fontFamily="Tahoma,Arial,Helvetica,sans-serif",t.style.boxSizing="border-box",t.style.width="100%",t.style.paddingTop="3px",t.style.paddingBottom="3px",t.style.paddingLeft="5px",t.style.paddingRight="5px",t.style.overflowX="hidden",e.length>0&&t.setAttribute("data-nick",e),t}function m(e,t){return t.username===e?`${c.R.broadcaster} `:t.isMod?`${c.R.moderator} `:t.inFanclub?`${c.R.fanclubMember} `:`${c.R.user} `}function g(e){const t=(0,a.lK)(e),i=new h.P(t.red,t.green,t.blue),s=i.brightness();return i.raiseToMin(255-s/3),`rgb(${i.red}, ${i.green}, ${i.blue})`}function v(){const e=document.createElement("span");return e.innerText=", ",e}async function f(e,t,i,a){let h=p();(0,l.yX)(h,g("#aaaaaa"));const d=document.createElement("span");d.innerText=c.R.appsRunningMessage(e),h.appendChild(d);for(let e=0;e<i.length;e+=1){let t;"mobile"===a?(t=document.createElement("div"),t.style.display="inline",t.style.position="relative",t.innerText=i[e].app_name):(t=document.createElement("a"),t.dataset.testid="app-link",t.href=(0,r._Y)(i[e].app_location),t.target="_blank",t.innerText=i[e].app_name,(0,n.fZ)(t,"msg-link"),t.onmouseenter=()=>{t.style.textDecoration="underline"},t.onmouseleave=()=>{t.style.textDecoration="none"}),h.appendChild(t),e<i.length-1&&h.appendChild(v())}let u;try{if(u=await function(e,t){return new Promise(((i,a)=>{(0,s.Ac)(e).then((e=>{const s=document.createElement("span");if(0===e.items.length)return void i(s);const a=document.createElement("span");s.appendChild(a);let l=0;for(const i of e.items){let a;l+=1,"mobile"===t?(a=document.createElement("div"),a.style.display="inline",a.style.position="relative",a.innerText=i.name):(a=document.createElement("a"),a.href=(0,r._Y)(`/v2apps?slot=${i.slot}&app_path=${(0,o.BK)(i)}`),a.target="_blank",a.innerText=i.name,(0,n.fZ)(a,"msg-link"),a.onmouseenter=()=>{a.style.textDecoration="underline"},a.onmouseleave=()=>{a.style.textDecoration="none"}),s.appendChild(a),l<e.items.length&&s.appendChild(v())}i(s)})).catch((e=>{a(e)}))}))}(t,a),""===u.innerText&&0===i.length)return Promise.resolve(document.createElement("div"));if(""===u.innerText)return Promise.resolve(h);i.length>0&&h.appendChild(v()),h.appendChild(u)}catch(e){0===i.length&&(h=document.createElement("div"))}return Promise.resolve(h)}function y(e,t){const i=e;void 0!==e.ts?t.dataset.ts=e.ts.toString():void 0!==i.createdAt&&(t.dataset.ts=i.createdAt.getTime().toString())}function b(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=e.dataset.ts;if(void 0===s||""===s)return void t.appendChild(e);const n=t.children;let o=t.children.length;const r=n.length<(0,d.wR)(i)?0:n.length-(0,d.wR)(i);for(let e=n.length-1;e>=r;e-=1){const t=n[e].getAttribute("data-ts");if(null!==t&&""!==t){if(Number.parseInt(t)<=Number.parseInt(s))break;o=e}}o>=t.children.length?t.appendChild(e):t.insertBefore(e,n[o])}},9135:(e,t,i)=>{"use strict";i.d(t,{H:()=>c,t:()=>d});var s=i(7623),n=i(6784),o=i(2709),r=i(8423),a=i(3124),l=i(4947);const h=window.Accelerometer;class d extends o.u{constructor(){super(),this.element.style.textAlign="center",this.element.style.paddingTop="40px",this.element.style.backgroundColor="rgba(255, 255, 255, 0.5)",this.element.style.width="100%",this.element.style.height="100%";const e=this.element.appendChild(document.createElement("img"));if(e.src=`${STATIC_URL_MOBILE}rotate.svg`,e.style.width="500px",e.style.objectFit="contain",e.style.maxWidth="40%",e.style.maxHeight="40%",e.style.padding="15px",e.style.animationName="spin-default",e.style.animationDuration="2s",e.style.animationIterationCount="infinite",document.head.appendChild(document.createElement("style")).innerText="@keyframes spin-default { 0% { transform: rotate(0deg); } 100% { transform: rotate(180deg); } }",this.text=this.element.appendChild(document.createElement("div")),this.text.style.fontWeight="bold",this.text.style.fontSize="1.5em",this.text.style.padding="15px",(0,n.wu)("fullscreenchange",document,(e=>{this.onFullScreen()})),(0,s.OF)()||void 0===window.Accelerometer)this.update(),a.DQ.listen((()=>{this.update()}));else{this.image=e;const t=screen.orientation.type,i=new h({frequency:2});(0,n.wu)("reading",i,(()=>{this.updateAndroid(i.x,i.y,i.z,t)})),i.start()}c.listen((()=>{if((0,a.FW)()&&null===document.fullscreenElement)try{void 0!==document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()}catch(e){warn(e)}}))}onFullScreen(){if(debug("On Full Screen"),(0,a.FW)()&&void 0!==screen.orientation){debug("Trying to lock landscape");try{screen.orientation.lock("landscape")}catch(e){warn(e)}}this.update()}update(){(0,a.FW)()&&!(0,a.K$)()||"true"===new URLSearchParams(window.location.search).get("ignorerotation")||!(0,a.FW)()?this.element.style.display="none":(this.element.style.display="",this.text.innerText=l.R.incorrectPortrait)}updateAndroid(e,t,i,s){null===document.fullscreenElement?(this.image.style.display="none",this.element.style.display="",this.text.innerText=l.R.missingFullscreen+l.R.androidBroadcast):("portrait-primary"===s||"portrait-secondary"===s)&&e<4.5&&(t>2||t<-2)||Math.abs(t)>6.5&&i<8.5?(this.image.style.display="",this.element.style.display="",this.text.innerText=l.R.incorrectPortrait):this.element.style.display="none"}}const c=new r.c_("tryFullScreen")},9739:(e,t,i)=>{"use strict";i.d(t,{W:()=>f});var s=i(7623),n=i(9461),o=i(213),r=i(2709),a=i(8423),l=i(7463),h=i(90),d=i(4947),c=i(1372),u=i(9447),p=i(1224),m=i(634),g=i(6784);class v extends m.x4{lazyInitUI(){(0,u.fZ)(this.element,"notificationsModal"),this.element.style.width="",this.element.style.height="",this.overlay.style.opacity="0.5",this.overlay.style.background="#000000";const e=function(){const e=document.createElement("div");return e.style.position="relative",e.style.height="",e.style.width="264px",e.style.backgroundColor="#e0e0e0",e.style.padding="6px 12px",e.style.borderRadius="3px",e.style.marginLeft="0px",e.style.marginTop="11px",e.style.fontSize="12.012px",e.style.color=p.m.defaultColor,e.style.overflow="",e.style.lineHeight="16.8px",e}(),t=(0,m.zG)(),i=(0,m.tj)(),s=(0,m.xT)((()=>{this.onConfirmClick(),this.close()})),n=(0,m.HY)((()=>{this.onDenyClick(),this.close()}));e.appendChild(t),e.appendChild(i),e.appendChild(s),e.appendChild(n),this.element.appendChild(e);const o=()=>{this.resize()};(0,g.wu)("resize",window,o),this.closed.once((()=>{try{(0,g.Pf)("resize",window,o)}catch(e){debug("NotificationsModal resize listener was already removed")}})),super.lazyInitUI()}afterDOMConstructedIncludingChildren(){super.afterDOMConstructedIncludingChildren(),this.resize()}resize(){this.element.style.left=`${Math.max(0,(window.innerWidth-this.element.offsetWidth)/2)}px`,this.element.style.top=`${Math.max(0,(window.innerHeight-this.element.offsetHeight)/2)}px`}}class f extends r.u{constructor(){super()}initData(){this.followStateChanged=new a.c_("followStateChanged"),this.isFollowingUpdate=new h.P(!1,((e,t)=>this.setIsFollowing(e,t)),(()=>{const e=this.isFollowing?d.R.errorUnfollowingUser(this.roomName):d.R.errorFollowingUser(this.roomName);(0,o.Q$)(e)}))}initUI(){this.followButton=(0,c.tT)(y,{onClick:()=>{this.handleFollowAndUnfollow()}}),this.unfollowButton=(0,c.tT)(b,{onClick:()=>{this.onUnfollowClick()}}),this.element=(0,c.tT)("div",{colorClass:"FollowButton",style:{cssFloat:"left"}},this.followButton,this.unfollowButton),l.im.listen((e=>{e.roomName===this.roomName&&this.updateContext(this.roomName,e.following)}))}onUnfollowClick(){(0,o.mf)(d.R.unfollowInfo,(()=>{this.handleFollowAndUnfollow()}),void 0,{title:`${d.R.unfollowText} ${this.roomName}?`,acceptText:`${d.R.yes}, ${d.R.unfollowLower}`,declineText:`${d.R.no}, ${d.R.cancelLower}`})}updateFollowButtonDisplay(e){this.followButton.style.display=this.isFollowing?"none":"flex",this.unfollowButton.style.display=this.isFollowing?"flex":"none",this.followStateChanged.fire({isFollowing:this.isFollowing,isPending:e})}updateContext(e,t){this.roomName=e,this.isFollowing=t,this.updateFollowButtonDisplay()}showBrowserNotification(){if(void 0!==n.Bm.current.loggedInUser){const e=window.isBrowserNotificationSupported,t=window.isSubscribedToBrowserNotifications;if(void 0!==e&&!0===e()&&void 0!==t&&(0,s.Pf)()){const e=new v;e.canRequestPermission()&&t(!1,(()=>{this.addChild(e,document.body),e.closed.once((()=>{this.removeChild(e)}))}))}}}handleFollowAndUnfollow(){const e=void 0===n.Bm.current.loggedInUser;this.isFollowing||this.showBrowserNotification();const t=(this.isFollowing?l.QH:l.j4)(this.roomName,e,"FollowButton");void 0!==t&&this.isFollowingUpdate.dispatch(!this.isFollowing,t)}setIsFollowing(e,t){this.isFollowing=e,this.updateFollowButtonDisplay(t)}}const y=e=>(0,c.tT)("div",{colorClass:"follow",style:{display:"none",borderWidth:"1px",borderStyle:"solid",boxSizing:"border-box",borderRadius:"4px",marginRight:"4px",padding:"0 8px",justifyContent:"center",alignItems:"center"},onClick:e.onClick},(0,c.tT)("span",{className:"icon_not_following no_hover",style:{position:"relative",padding:"2px 3px 1px 0px",marginLeft:"-6px",height:"29px",width:"29px",backgroundSize:"28px 28px",display:"inline-block",verticalAlign:"middle"}}),(0,c.tT)("span",{style:{display:"inline-block",verticalAlign:"middle"}},d.R.followText)),b=e=>(0,c.tT)("div",{colorClass:"unfollow",style:{display:"none",borderWidth:"1px",borderStyle:"solid",boxSizing:"border-box",borderRadius:"4px",marginRight:"4px",justifyContent:"center",alignItems:"center"},onClick:e.onClick},(0,c.tT)("span",{className:"icon_following no_hover",style:{position:"relative",padding:"2px 4px 1px 4px",height:"29px",width:"29px",backgroundSize:"28px 28px"}}))},5256:(e,t,i)=>{"use strict";i.d(t,{f:()=>s,z:()=>n});class s{constructor(e){this.individualConstraints={top:0,bottom:0,left:0,right:0,transitionTime:0},this.boundingConstraints={top:0,bottom:0,left:0,right:0,transitionTime:0},this.onUpdate=()=>{},this.onAttach=()=>{},this.ID=e}top(){return this.boundingConstraints.top}bottom(){return this.boundingConstraints.bottom}left(){return this.boundingConstraints.left}right(){return this.boundingConstraints.right}transitionTime(){return this.boundingConstraints.transitionTime}setConstraints(e){void 0===this.handler?this.onAttach=()=>{this.updateConstraints(e)}:this.updateConstraints(e),this.individualConstraints=e}updateConstraints(e){void 0!==this.handler&&this.handler.updateConstraints({ID:this.ID,...e})}setOnUpdate(e){this.onUpdate=e}getIndividualConstraints(){return this.individualConstraints}attach(e){this.handler=e,this.onAttach()}detach(){this.handler=void 0}update(e){this.boundingConstraints=e,this.onUpdate()}}class n{constructor(){this.constraintsMap=new Map,this.listeners=[]}addListener(e){this.listeners.push(e),e.attach(this),this.updateConstraints({ID:e.ID,...e.getIndividualConstraints()})}removeListener(e){const t=this.listeners.indexOf(e);t>=0&&(this.listeners.splice(t,1),this.constraintsMap.delete(e.ID),e.detach(),this.notifyListeners())}updateConstraints(e){this.constraintsMap.set(e.ID,e),this.notifyListeners()}calculateTotalConstraints(){const e={top:0,bottom:0,left:0,right:0,transitionTime:0};for(const t of this.constraintsMap.values())for(const i of Object.keys(e))e[i]+=t[i];return e}notifyListeners(){const e=this.calculateTotalConstraints();for(const t of this.listeners){const i=this.constraintsMap.get(t.ID);if(void 0===i){error("A LayoutConstraintHandler's listener does not exist in its constraints map");continue}const s={...e};for(const[e,t]of Object.entries(i))s[e]-=t;t.update(s)}}}},4926:(e,t,i)=>{"use strict";i.d(t,{CM:()=>E,Fr:()=>w,St:()=>P,U$:()=>T,YC:()=>L,j7:()=>x,j8:()=>A,r_:()=>D});var s=i(7623),n=i(5276),o=i(9447),r=i(9419),a=i(9461),l=i(5216),h=i(2939),d=i(4140),c=i(1284),u=i(7407),p=i(34),m=i(2359),g=i(8785),v=i(7569),f=i(4947),y=i(4580),b=i(2944);const w=2;let C,S;function x(e){const t=(0,c.mh)(e.fromUser.username),i=(0,c.Sy)();i.style.padding=`0px ${w}px`,void 0!==e.backgroundColor&&(i.style.background=e.backgroundColor),t.appendChild(i);const o=(0,b.t)(e.fromUser,e);o.dataset.testid="chat-message-username",o.style.paddingRight="4px",(0,d.yX)(o,(0,g.W1)(e.fromUser)),i.appendChild(o);const r=(0,m.e4)(e.message);r.dataset.testid="chat-message-text";const a=void 0!==e.textColor?e.textColor:"#000000";return r.style.color=a,void 0!==e.font&&(o.style.fontFamily=e.font,r.style.fontFamily=e.font),(0,d.yX)(r,(0,c.Uq)(a)),P(r),i.appendChild(r),(0,s.AD)()||n.A.parse(t,{className:"emojiChat"}),(0,c.V_)(e,t),t}function T(e,t,i){for(const s of t){const t=document.createElement("div");for(const e of s)switch(e.partType){case 1:t.appendChild(k(e,i));break;case 0:t.appendChild((0,b.t)(e.user));break;case 2:t.appendChild(I(e.message));break;case 3:t.appendChild(R(f.R.spyPrivateShowLower,(()=>{"privatespying"!==S.status&&(0,p.lh)(S,void 0,{onResolve:()=>{y.qb.fire("private")}})})));break;default:error(`Unknown roomNotice type: ${e.partType}`,e)}e.appendChild(t)}return e}function P(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.querySelectorAll(".username-mention"),s=[],n=r.k.getInstance(),l=n.users();for(const e of i){const i=e.innerText.replace("@","").toLowerCase(),n=l.find((e=>e.username===i));if(void 0!==n){var h,d;const i=(0,b.t)(n,void 0,!1,!0,t);(null===(h=a.Bm.current.loggedInUser)||void 0===h?void 0:h.username)===n.username&&(i.style.padding="2px 4px",i.style.borderRadius="4px",(0,o.fZ)(i,"mentionHl")),null===(d=e.parentElement)||void 0===d||d.replaceChild(i,e),i.insertAdjacentText("afterend"," ")}else s.push(i)}n.addInvalidUsers(s)}function k(e,t){if(void 0!==e.message&&t&&v.fM.isShortcodeSyntax(e.message))return(0,m.P7)(e,t,M,y.f6);if(!1!==e.parseEmoticon)return(0,m.e4)(e.message);const i=document.createElement("span");return i.innerText=e.message,i}function A(e){const t=(0,c.mh)(e.fromUser.username),i=(0,c.Sy)();i.style.padding=`0px ${w}px`,void 0!==e.backgroundColor&&(i.style.background=e.backgroundColor),t.appendChild(i);const s=(0,b.t)(e.fromUser,e);s.style.paddingRight="4px",(0,d.yX)(s,(0,g.W1)(e.fromUser)),i.appendChild(s);const n=(0,m.BP)(e,M,y.f6);return void 0!==e.font&&(s.style.fontFamily=e.font,n.style.fontFamily=e.font),n.style.textShadow="rgb(51, 51, 51) 0.2px 0.2px 0px",i.appendChild(n),P(n),(0,c.V_)(e,t),t}function M(e,t,i){const s=R(e,i);return s.dataset.messagetype="shortcode",void 0!==t&&""!==t&&(s.href=(0,l._Y)(t),s.target="_blank"),s}function R(e,t){const i=document.createElement("a");return i.style.color="#0a5a83",i.style.textDecoration="underline",i.innerText=e,i.onclick=t,i}function I(e){var t;const i=document.createElement("a");return i.href=(0,l._Y)(`/tag/${e}/${null!==(t=C)&&void 0!==t?t:""}`),(0,o.fZ)(i,"msg-link"),i.style.textDecoration="none",i.innerText=`#${e}`,i}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const i=(0,c.mh)();return t&&(i.dataset.testid=t),i.innerText=e,i.style.color="#000000",(0,d.yX)(i,(0,c.Uq)("#aaaaaa")),i}function L(e,t){function i(e){const t=document.createElement("span");return t.innerText=e,t}const s=(0,c.mh)();(0,d.yX)(s,(0,c.Uq)("#aaaaaa"));const n=t?f.R.pmSupporterNoticeAgeVerified:f.R.pmSupporterNotice;s.appendChild(i(n)),s.appendChild(document.createElement("br")),s.appendChild(i(`${f.R.pmSupporterSignUp} `));const r=R(f.R.pmSupporterMembership,(()=>{}));return r.style.color="",(0,o.fZ)(r,"msg-link"),r.href=(0,l._Y)(`/supporter/upgrade/?source=${a.Bm.current.PurchaseEventSources.SUPPORTER_SOURCE_PM_UPSELL}`),r.target="_blank",r.onclick=()=>{(0,u.bT)("SupporterPageOpened",{source:"chat"})},s.appendChild(r),s.appendChild(i(` ${f.R.pmSupporterSendPm(e)}.`)),s}function D(e,t){const i=(0,c.mh)(e);return i.innerText=e,i.appendChild(t),i.style.color="#000000",(0,d.yX)(i,(0,c.Uq)("#aaaaaa")),i}h.X0.listen((e=>{C=e.dossier.roomGender,S=e.chatConnection}))},7925:(e,t,i)=>{"use strict";i.d(t,{BG:()=>h,Dd:()=>r,GF:()=>c,Ko:()=>o,Lb:()=>d,Wr:()=>l,Ys:()=>a,lG:()=>n});var s=i(8423);const n=new s.c_("MobileVideoControls:tap"),o=new s.c_("MobilePureChat:tap"),r=new s.c_("MobilePureChat:drag"),a=new s.c_("MobilePureChat:dragEnd"),l=new s.c_("MobileFullscreenSendChat"),h=new s.c_("MobilePlayer:changeSize"),d=new s.c_("mobileConversationLinkFullscreenToggle"),c=new s.c_("repositionChatContentsOnInputFocus")},6471:(e,t,i)=>{"use strict";i.d(t,{E:()=>w});var s=i(4936),n=i(20),o=i(9447),r=i(4364),a=i(9461),l=i(1224),h=i(6784),d=i(6844),c=i(2939),u=i(2709),p=i(3955),m=i(7407),g=i(3118),v=i(8785),f=i(4947),y=i(1372),b=i(4110);class w extends u.u{constructor(e){super("div",e)}initData(e){this.openConversationEvent=e.openConversationEvent,this.room="",this.startedTimeUpdates=!1,this.onItemRemoved=e.onItemRemoved,this.isDropdown=e.isDropdown,this.searchBar=e.searchBar,(0,d.ok)()||(this.conversationListData=r.yT.getInstance())}initUI(e){(0,p.ZM)(this.element,{position:"relative",overflowX:"hidden",overflowY:"scroll"}),this.isDropdown?(this.emptyListMessage=(0,y.tT)(T,null),this.element.appendChild(this.emptyListMessage)):b.E3.listen((e=>{var t;const i=null===(t=this.conversationListData)||void 0===t?void 0:t.getConversation(e.username);void 0!==i&&this.updateList(i)})),c.X0.listen((e=>{var t;this.room=e.chatConnection.room(),this.isDropdown?this.updateUserColors():(this.clearItems(),(null===(t=a.Bm.current.loggedInUser)||void 0===t?void 0:t.username)!==this.room&&this.addBroadcasterToTop())})),r.yT.conversationDataChanged.listen((()=>{(0,d.ok)()||void 0!==this.conversationListData||(this.conversationListData=r.yT.getInstance())})),r.yT.conversationItemAdded.listen((e=>{this.isDropdown&&""!==e.room||!this.isDropdown&&""===e.room||this.updateList(e)})),r.yT.conversationRead.listen((e=>{let{username:t,isDm:i}=e;i===this.isDropdown&&this.markItemRead(t)})),this.startTimeContainerUpdates(),void 0!==this.searchBar&&this.initSearchBarListeners(this.searchBar)}initSearchBarListeners(e){(0,h.wu)("touchstart",window,(t=>{const i=e.getInput();document.activeElement===i&&t.target!==i&&i.blur()})),this.openConversationEvent.listen((()=>{this.filterConversations("")})),e.events.inputChange.listen((e=>{e.isValid?this.filterConversations(e.prefix):this.clearItems()}))}filterConversations(e){if(void 0!==this.conversationListData){this.clearItems();const t=t=>0===e.length||t.otherUser.username.startsWith(e);(this.isDropdown?this.conversationListData.getDms():this.conversationListData.getPms()).filter(t).reverse().forEach((e=>{this.updateList(e)}))}}updateList(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];void 0!==this.emptyListMessage&&this.element.contains(this.emptyListMessage)&&this.element.removeChild(this.emptyListMessage);let i=this.findItem(e.otherUser.username);void 0!==i?(i.updateItem(e),r.cV.isHiding(e.otherUser.username)&&this.addChild(i)):(i=new C({conversationListItem:e,onClick:()=>{this.openConversationEvent.fire(e.otherUser.username)},onCloseButtonClick:()=>{this.removeItem(e.otherUser.username)},isDropdown:this.isDropdown}),this.addChild(i),(0,m.bT)("PmListItemAdded",{rendered_pm_count:this.getAllItems().length,other_user:e.otherUser.username})),r.cV.remove(e.otherUser.username),t&&this.moveToTop(i)}updateUserColors(){var e;this.isDropdown&&(null===(e=this.conversationListData)||void 0===e||e.getDms().forEach((e=>{const t=this.findItem(e.otherUser.username);void 0!==t&&t.updateColors(e.otherUser)})))}moveToTop(e){this.isDropdown?null!==this.element.firstChild?this.element.insertBefore(e.element,this.element.firstChild):this.element.appendChild(e.element):null!==this.element.firstChild&&null!==this.element.firstChild.nextSibling?this.element.insertBefore(e.element,this.element.firstChild.nextSibling):this.element.appendChild(e.element)}findItem(e){return this.getAllItems().find((t=>t.getItemInfo().otherUser.username===e))}markItemRead(e){const t=this.findItem(e);void 0!==t&&t.setReadStyle()}addBroadcasterToTop(){var e,t;const i=null!==(e=null===(t=this.conversationListData)||void 0===t?void 0:t.getConversation(this.room))&&void 0!==e?e:(0,n.bi)(this.room);let s=this.findItem(this.room);void 0===s&&(s=new C({conversationListItem:i,onClick:()=>{this.openConversationEvent.fire(this.room)},onCloseButtonClick:()=>{this.removeItem(i.otherUser.username)},isDropdown:this.isDropdown})),this.getAllItems().length>0?this.addChildBefore(s,this.getAllItems()[0]):this.addChild(s)}getAllItems(){return super.children()}getNumUnread(){return this.getAllItems().filter((e=>e.getItemInfo().numUnread>0)).length}removeItem(e){const t=this.findItem(e);void 0!==t&&this.element.contains(t.element)&&(this.removeChild(t),r.cV.hide(e),this.onItemRemoved(t.getItemInfo().otherUser.username),(0,m.bT)("PmListItemRemoved",{rendered_pm_count:this.getAllItems().length,other_user:e}))}clearItems(){this.removeAllChildren()}startTimeContainerUpdates(){this.startedTimeUpdates||(this.startedTimeUpdates=!0,window.setInterval((()=>{for(const e of this.getAllItems())e.setTimestamp()}),1e4))}}class C extends u.u{constructor(e){super("div",e)}initData(e){this.conversationListItem=e.conversationListItem}initUI(e){this.replyIcon=(0,y.tT)(S,null),this.closeButton=(0,y.tT)("img",{src:`${STATIC_URL_MOBILE}close.svg`,style:{width:"18px",height:"18px",display:"inline-block"},onClick:e.onCloseButtonClick}),this.avatarBubble=(0,y.tT)(x,{name:e.conversationListItem.otherUser.username,userColorClass:(0,v.Kb)(e.conversationListItem.otherUser)}),this.element=(0,y.tT)("div",{className:"MobileConversationListItem",style:{width:"100%",height:"90px",boxSizing:"border-box",padding:"20px",fontSize:"12px",display:"flex",alignItems:"center",fontFamily:"Tahoma, Arial, Helvetica, sans-serif"},"data-testid":"conversation-list-item"},(0,y.tT)("div",{style:{display:"flex",flex:1,alignItems:"center"},onClick:e.onClick},this.avatarBubble,(0,y.tT)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",width:"100%",height:"100%"}},(0,y.tT)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"}},(0,y.tT)("div",{style:{display:"flex",verticalAlign:"bottom",flex:1,width:0,marginRight:"10px"}},(0,y.tT)("span",{style:{display:"block",fontWeight:"bold",marginBottom:"5px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},className:(0,v.Kb)(e.conversationListItem.otherUser),ref:e=>{this.usernameLabel=e},"data-testid":"conversation-list-username"},e.conversationListItem.otherUser.username),(0,y.tT)("span",{style:{whiteSpace:"pre"},ref:e=>{this.numUnreadContainer=e},"data-testid":"unread-message-count"})),(0,y.tT)("span",{className:"MobileConversationListItem__timestamp",ref:e=>{this.timestampElement=e},"data-testid":"message-timestamp"})),(0,y.tT)("span",{style:{display:"flex"}},this.replyIcon,(0,y.tT)("span",{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",flex:"1",width:"0px"},ref:e=>{this.msgElement=e},"data-testid":"message-preview"})))),!e.isDropdown&&(0,y.tT)("div",{style:{width:"18px",height:"18px",marginLeft:"20px"}},!e.conversationListItem.otherUser.isBroadcaster&&this.closeButton)),this.updateItem(e.conversationListItem)}updateItem(e){this.conversationListItem=e,this.setReplyIcon(),this.setMessage(),this.setTimestamp(),this.conversationListItem.numUnread>0?this.setUnreadStyle():this.setReadStyle()}updateColors(e){const t=(0,v.Kb)(e);this.usernameLabel.className=t,this.avatarBubble.firstChild instanceof HTMLElement&&(this.avatarBubble.firstChild.className=t)}getItemInfo(){return this.conversationListItem}setReplyIcon(){const e=this.isReply()&&!this.isEmptyMessage();this.replyIcon.style.display=e?"block":"none"}setMessage(){null!==this.msgElement.firstChild&&this.msgElement.removeChild(this.msgElement.firstChild),""!==this.conversationListItem.message?this.msgElement.appendChild(this.renderConversationEmoticons(this.conversationListItem.message)):this.conversationListItem.hasMedia&&this.msgElement.appendChild((0,y.tT)("span",null,f.R.imageAttached))}setTimestamp(){if(!this.isEmptyMessage()){const e=this.conversationListItem.time,t=void 0===e?"":(0,s.lI)(new Date(e));this.timestampElement.innerText=`${t}`}}renderConversationEmoticons(e){const t=new g.j(e),i=(0,y.tT)("span",null),s=t.stringParts()[0];i.innerText=s.split("\n")[0];for(let e=1;e<t.stringParts().length;e+=1){const s=(0,y.tT)("span",null);if(s.innerText=`:${t.emoticons()[e-1].name}`,i.appendChild(s),""!==t.stringParts()[e]){const s=(0,y.tT)("span",null);s.innerText=t.stringParts()[e],i.appendChild(s)}}return i}isReply(){return this.conversationListItem.otherUser.username!==this.conversationListItem.fromUsername}isEmptyMessage(){return""===this.conversationListItem.message&&!this.conversationListItem.hasMedia}setReadStyle(){(0,o.SA)(this.element,"MobileConversationListItem--unread"),this.numUnreadContainer.innerText=""}setUnreadStyle(){(0,o.fZ)(this.element,"MobileConversationListItem--unread"),this.numUnreadContainer.innerText=` (${this.conversationListItem.numUnread})`}}const S=()=>(0,y.tT)("img",{src:`${STATIC_URL_MOBILE}reply-icon.svg`}),x=e=>(0,y.tT)("div",{className:"avatarBubble",style:{position:"relative",...e.style}},(0,y.tT)("div",{className:e.userColorClass,style:{width:"45px",height:"45px",borderRadius:"50%",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",fontFamily:"UbuntuLight, Tahoma, Arial, Helvetica, sans-serif",fontSize:"20px",margin:"auto 10px auto auto",verticalAlign:"middle"}},e.name.charAt(0).toLocaleUpperCase())),T=()=>(0,y.tT)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",lineHeight:"20px",padding:"50px",boxSizing:"border-box",fontSize:"12px",fontFamily:"UbuntuRegular, Helvetica, Arial, sans-serif"}},(0,y.tT)("img",{src:`${STATIC_URL_MOBILE}empty-chat-state.svg`,style:{margin:"13px",width:"30px"},alt:"empty-chat-state"}),(0,y.tT)("span",{style:{fontFamily:"UbuntuBold, Arial, Helvetica, sans-serif",fontSize:"14px"}},f.R.sendDirectMessage),(0,y.tT)("span",null,f.R.conversationCautionMessage(l.m.siteName)))},8466:(e,t,i)=>{"use strict";i.d(t,{R:()=>I,X:()=>E});var s=i(7623),n=i(9447),o=i(6428),r=i(5052),a=i(442),l=i(6784),h=i(2939),d=i(1519),c=i(2709),u=i(3955),p=i(8423),m=i(9060),g=i(1779),v=i(4140),f=i(1284),y=i(9898),b=i(2434),w=i(2146),C=i(2091),S=i(1448),x=i(74),T=i(5256),P=i(4926),k=i(7925),A=i(9586),M=i(8936),R=i(3124);const I=new p.c_("mobilePureChatChange");class E extends c.u{constructor(e){super(),this.chatComponentToMirror=e,this.pendingTimeouts=[],this.isVisible=!1,this.desiredPortraitHeight=this.deviceLength()/4,this.desiredLandscapeWidth=this.deviceLength()/4,this.portraitHeight=this.deviceLength()/4,this.landscapeWidth=this.deviceLength()/4,this.areEphemeralsVisible=!1,this.backgroundDelay=0,this.heightDuration=0,this.widthDuration=0,this.layoutConstraints=new T.f(this.constructor.name),this.inputFocusOffset=0,this.scrollToBottomDebouncer=new d.a((()=>this.scrollToBottom()),{bounceLimitMS:0,debounceType:0}),(0,n.fZ)(this.element,"hasDarkBackground"),this.element.style.position="absolute",this.element.style.height="",this.element.style.fontSize="10px",this.element.style.textShadow="1px 0 1px #000, -1px 0 1px #000, 0 -1px 1px #000, 0 1px 1px #000",this.element.style.bottom="56px",this.element.style.overflow="visible",this.element.style.overflowWrap="break-word";const t=document.createElement("div");t.style.position="relative",t.style.overflow="hidden",t.style.height="100%",this.element.appendChild(t),this.innerDiv=document.createElement("div"),(0,A.H)(this.innerDiv),this.innerDiv.style.position="",this.innerDiv.style.bottom="0",this.innerDiv.style["-webkit-text-size-adjust"]="none",(0,m.QC)()&&(this.innerDiv.style.overflowY="auto"),this.innerDiv.style.overflowX="hidden",this.innerDiv.style.height="100%",t.appendChild(this.innerDiv),this.createResizeDragDiv(),this.element.appendChild(this.resizeDragDiv),this.listenerGroup=new p.gt,(0,m.QC)()&&(this.scrollDownButton=new a.w({scrollToBottom:()=>this.scrollToBottom(),bottomStyle:"4px"}),t.appendChild(this.scrollDownButton.element),this.newMessageNotice=new r.W({getUnreadCount:()=>{var e;return null===(e=this.scrollDownButton)||void 0===e?void 0:e.getUnreadCount()},isConversationShowing:()=>this.isVisible,isScrolledUp:()=>this.isScrolledUp(),setParentScrollTop:e=>this.setScrollTop(e),scrollParentDiv:this.innerDiv})),this.initNoticeDeclutterer(),(0,l.wu)("scroll",this.innerDiv,(e=>{var t,i,s;this.isScrolledUp()?null===(t=this.scrollDownButton)||void 0===t||t.showElement():(null===(i=this.scrollDownButton)||void 0===i||i.hideElement(),null===(s=this.scrollDownButton)||void 0===s||s.clearUnread())})),(0,m.GZ)()&&(0,m.$o)(this.innerDiv,this.innerDiv),e.addMessageHTMLEvent.listen((e=>{this.addMessage(e.makeByCloning())})).addTo(this.listenerGroup),e.addNoticeEvent.listen((e=>{this.addNotice(e)})).addTo(this.listenerGroup),e.addPhotoMessageEvent.listen((e=>{this.addRoomPhotoMessage(e)})).addTo(this.listenerGroup),e.removeMessagesForUserEvent.listen((e=>{this.handleRemoveMessages(e)})).addTo(this.listenerGroup),h.Gr.listen((()=>{this.clear(),this.roomNoticeDeclutterer.onRoomCleanup()})).addTo(this.listenerGroup),h.X0.listen((e=>{this.element.style.fontSize=e.dossier.userChatSettings.fontSize,this.setLineHeight(),o.$u.once((()=>{(0,P.St)(this.innerDiv,!0)})).addTo(this.listenerGroup)})).addTo(this.listenerGroup),x.EZ.listen((e=>{this.element.style.fontSize=e.fontSize,this.setLineHeight()})).addTo(this.listenerGroup);const i=new d.a((()=>{this.showMessages()}),{bounceLimitMS:7500,debounceType:2});let s,c,u;this.element.ontouchstart=e=>{i.callFunc()},this.innerDiv.ontouchstart=()=>{i.callFunc()},this.innerDiv.ontouchmove=()=>{i.callFunc()},this.innerDiv.onclick=e=>{this.toggleEphemeralsVisibility(),"shortcode"!==e.target.dataset.messagetype&&k.Ko.fire(this.areEphemeralsVisible)},this.resizeDragDiv.ontouchstart=e=>{1!==e.touches.length&&e.preventDefault(),u=this.areEphemeralsVisible,s=e.touches[0].clientX,c=e.touches[0].clientY,(0,R.K$)()?(this.heightDuration=0,this.updateTransitions()):(this.widthDuration=0,this.updateTransitions())},this.resizeDragDiv.ontouchmove=e=>{if(e.preventDefault(),e.touches.length<1||e.touches.length>2)return;const t=e.touches[0].clientX,n=e.touches[0].clientY;(0,R.K$)()?this.setPortraitHeight(this.portraitHeight+(c-n)):this.setLandscapeWidth(this.landscapeWidth+(s-t)),s=t,c=n,i.callFunc(),this.showEphemerals(),k.Dd.fire(void 0)},this.resizeDragDiv.ontouchend=e=>{e.touches.length>0||(u||this.hideEphemerals(160),k.Ys.fire(void 0))},this.resizeDragDiv.onclick=()=>{this.toggleEphemeralsVisibility(),k.Ko.fire(this.areEphemeralsVisible)},k.lG.listen((()=>{this.areEphemeralsVisible&&this.toggleEphemeralsVisibility()})).addTo(this.listenerGroup),k.Wr.listen((()=>{this.isChatHidden()&&this.unhideChat(),this.scrollToBottom()})).addTo(this.listenerGroup),this.layoutConstraints.setOnUpdate((()=>{this.repositionChildren()})),R.DQ.listen((()=>{var e;this.backgroundDelay=0,this.heightDuration=0,this.widthDuration=0,this.updateTransitions(),(0,m.QC)()&&(null===(e=this.newMessageNotice)||void 0===e||e.remove()),(0,g.aS)()?window.setTimeout((()=>{this.scrollToBottom()}),200):this.scrollToBottom()})).addTo(this.listenerGroup),this.element.style.display="none",this.repositionChildren()}initNoticeDeclutterer(){this.roomNoticeDeclutterer=new b.z({appendNotice:(e,t)=>this.addMessage(e.element,t),appendSentinelDiv:e=>this.element.appendChild(e)})}dispose(){this.listenerGroup.removeAll(),this.roomNoticeDeclutterer.dispose()}clear(){for(const e of this.pendingTimeouts)clearTimeout(e);for(this.pendingTimeouts=[];null!==this.innerDiv.firstChild;)this.innerDiv.removeChild(this.innerDiv.firstChild)}setLineHeight(){this.innerDiv.style.lineHeight=`${Number(this.element.style.fontSize.slice(0,-2))+7}pt`}addTimeout(e,t){const i=window.setTimeout((()=>{const t=this.pendingTimeouts.indexOf(i);t>=0&&this.pendingTimeouts.splice(t,1),e()}),t);this.pendingTimeouts.push(i)}showBackground(){this.backgroundDelay=0,this.updateTransitions(),this.element.style.background="rgba(255, 255, 255, 0.25)"}hideBackground(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.backgroundDelay=e,this.updateTransitions(),this.element.style.background="transparent"}addMessage(e){var t;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=this.innerDiv.scrollTop;(0,v.c6)(e);const n=e.querySelector("a");if(null!==n&&n.classList.contains("mobileChatLink")){const e=n.getAttribute("data-conversation-type");(0,l.wu)("click",n,(()=>{k.Lb.fire(e)}))}e.style.fontSize="",e.style.lineHeight="",e.style.display="inline-block",e.style.verticalAlign="bottom",e.style.overflowWrap="break-word";const o=this.isScrolledUp();var r,a;if(!i||!o&&this.isVisible||null===(r=this.scrollDownButton)||void 0===r||r.incUnread(),!0===(null===(t=this.newMessageNotice)||void 0===t?void 0:t.shouldAppendNewMessageNotice(i,!1))&&((0,f.NZ)(this.newMessageNotice.element,this.innerDiv),this.resetMessageHideTimeout(this.newMessageNotice.element)),(0,f.NZ)(e,this.innerDiv),this.resetMessageHideTimeout(e),(0,m.Lx)()){let e=this.innerDiv.childElementCount-(0,C.wR)();for(;e>0;e-=1){const e=this.innerDiv.firstElementChild;null!==e&&this.innerDiv.removeChild(e)}}o?null===(a=this.newMessageNotice)||void 0===a||a.maybeScrollJump(s):this.scrollToBottom()}addRoomPhotoMessage(e){const t=(0,S.bB)(e);void 0!==t&&this.addMessage(t,!1)}addNotice(e){const t=new y._y({roomNoticeData:e,isChatScrolledToBottom:()=>!this.isScrolledUp(),scrollChatToBottom:()=>this.debouncedScrollToBottom(),getChatScrollTop:()=>this.getScrollTop(),setChatScrollTop:e=>this.setScrollTop(e)});this.roomNoticeDeclutterer.addRoomNotice(t)}isScrolledUp(){return this.innerDiv.scrollTop<=this.innerDiv.scrollHeight-(this.innerDiv.offsetHeight+20)}scrollToBottom(){var e;(0,s.OF)()&&(0,u.WV)(this.innerDiv),this.repositionChildren(),this.innerDiv.scrollTop=this.innerDiv.scrollHeight,null===(e=this.scrollDownButton)||void 0===e||e.hideElement()}debouncedScrollToBottom(){this.scrollToBottomDebouncer.callFunc()}getScrollTop(){return this.innerDiv.scrollTop}setScrollTop(e){this.innerDiv.scrollTo({top:e})}showMessages(){for(const e of this.pendingTimeouts)clearTimeout(e);for(const e of this.innerDiv.children)this.resetMessageHideTimeout(e,!0)}resetMessageHideTimeout(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,w.Ve)(e,`opacity ${t?400:0}ms`),e.style.opacity="1",this.addTimeout((()=>{this.hideMessage(e)}),15e3)}hideMessage(e){this.isScrolledUp()?this.addTimeout((()=>{this.hideMessage(e)}),15e3):((0,w.Ve)(e,"opacity 1000ms"),e.style.opacity="0")}setVisible(e){var t;if(this.isVisible===e)return;this.isVisible=e,this.heightDuration=0,this.widthDuration=0,this.updateTransitions(),null===(t=this.newMessageNotice)||void 0===t||t.remove(),window.setTimeout((()=>{this.scrollToBottom()}),Math.max(this.heightDuration,this.widthDuration)+100);const i={top:0,bottom:0,left:0,right:0,transitionTime:0};this.isVisible&&(this.showEphemerals(),this.showMessages(),i.bottom=this.calculateTotalChatHeight(),i.right=this.calculateTotalChatWidth()),this.layoutConstraints.setConstraints(i),I.fire(e)}calculateTotalChatHeight(){return Math.round(this.portraitHeight+56+30+4)}calculateTotalChatWidth(){return Math.round(this.landscapeWidth+20)}deviceLength(){return(0,R.K$)()?(0,M.mJ)():(0,M.DK)()}setPortraitHeight(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.desiredPortraitHeight=e;const i=!this.isScrolledUp(),s=this.portraitHeight,n=this.deviceLength()-56-30-4-Math.max(30,this.layoutConstraints.top());e=Math.min(e,n),e=Math.max(e,0),e=Math.round(e),this.portraitHeight=e,(0,g.aS)()?this.element.style.height=`min(calc(var(--vh, 1vh) * 100 - 136px), ${this.portraitHeight}px)`:this.element.style.height=`${this.portraitHeight}px`,0===e?this.hideCloseChatDiv():this.showCloseChatDiv(),e!==s&&(i||0===s?this.scrollToBottom():this.innerDiv.scrollTop+=s-e,this.layoutConstraints.setConstraints({top:0,bottom:this.isVisible?this.calculateTotalChatHeight():0,left:0,right:this.isVisible?this.calculateTotalChatWidth():0,transitionTime:t}))}setLandscapeWidth(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.desiredLandscapeWidth=e;const i=!this.isScrolledUp(),s=this.landscapeWidth,n=this.deviceLength()-30-20-Math.max(50,this.layoutConstraints.left());e=Math.min(e,n),e=Math.max(e,0),e=Math.round(e),this.landscapeWidth=e,this.element.style.width=`${this.landscapeWidth}px`,0===e?this.hideCloseChatDiv():window.innerHeight<150?(this.hideCloseChatDiv(),window.innerHeight<75&&this.hideEphemerals()):this.showCloseChatDiv(),e!==s&&((i||0===s)&&this.scrollToBottom(),this.layoutConstraints.setConstraints({top:0,bottom:this.isVisible?this.calculateTotalChatHeight():0,left:0,right:this.isVisible?this.calculateTotalChatWidth():0,transitionTime:t}))}hideCloseChatDiv(){this.closeChatContainer.style.display="none",(0,R.K$)()?(this.resizeIndicatorDiv.style.height="21px",this.resizeIndicatorDiv.style.width=(0,M.DK)()-2+"px"):(this.resizeIndicatorDiv.style.height="100%",this.resizeIndicatorDiv.style.width="21px")}showCloseChatDiv(){if((0,R.K$)())this.resizeIndicatorDiv.style.height="21px",this.resizeIndicatorDiv.style.width=(0,M.DK)()-21-4+"px";else{const e=this.resizeDragDiv.getBoundingClientRect();this.resizeIndicatorDiv.style.height=e.height-21-2+"px",this.resizeIndicatorDiv.style.width="21px"}this.closeChatContainer.style.display="inline-block"}createResizeDragDiv(){if(this.resizeDragDiv=document.createElement("div"),this.controlsContainerDiv=document.createElement("div"),this.resizeIndicatorDiv=document.createElement("div"),this.resizeIndicatorImg=document.createElement("img"),this.closeChatContainer=document.createElement("div"),this.closeChatDiv=document.createElement("div"),this.closeChatImg=document.createElement("img"),this.resizeDragDiv.appendChild(this.controlsContainerDiv),this.controlsContainerDiv.appendChild(this.resizeIndicatorDiv),this.controlsContainerDiv.appendChild(this.closeChatContainer),this.closeChatContainer.appendChild(this.closeChatDiv),this.resizeIndicatorDiv.appendChild(this.resizeIndicatorImg),this.closeChatDiv.appendChild(this.closeChatImg),this.resizeDragDiv.style.position="absolute",this.resizeDragDiv.style.bottom="0",this.controlsContainerDiv.style.verticalAlign="middle",this.controlsContainerDiv.style.width="100%",this.controlsContainerDiv.style.position="absolute",this.resizeIndicatorDiv.style.display="inline-block",this.resizeIndicatorDiv.style.position="absolute",this.resizeIndicatorDiv.style.left="0",this.resizeIndicatorDiv.style.padding="4px",this.resizeIndicatorDiv.style.borderRadius="4px",this.resizeIndicatorDiv.style.opacity="1",this.resizeIndicatorDiv.style.boxSizing="border-box",this.resizeIndicatorDiv.style.background="rgba(0, 0, 0, 0.3)",this.resizeIndicatorDiv.classList.add("resizeIndicatorDiv"),this.closeChatContainer.style.padding="30px",this.closeChatContainer.style.display="inline-block",this.closeChatContainer.style.position="absolute",this.closeChatContainer.style.margin="0",this.closeChatContainer.style.boxSizing="border-box",this.closeChatContainer.style.fontSize="9pt",this.closeChatContainer.style.lineHeight="14px",this.closeChatContainer.style.top="-19.5px",this.closeChatContainer.style.right="-18.5px",this.closeChatDiv.style.display="inline-block",this.closeChatDiv.style.position="absolute",this.closeChatDiv.style.margin="0",this.closeChatDiv.style.height="21px",this.closeChatDiv.style.width="21px",this.closeChatDiv.style.padding="4px",this.closeChatDiv.style.borderRadius="4px",this.closeChatDiv.style.boxSizing="border-box",this.closeChatDiv.style.textAlign="center",this.closeChatDiv.style.top="19.5px",this.closeChatDiv.style.left="19.5px",this.closeChatDiv.style.background="rgba(0, 0, 0, 0.3)",this.resizeIndicatorImg.src=`${STATIC_URL_MOBILE}3-bar.svg`,this.resizeIndicatorImg.style.position="absolute",this.resizeIndicatorImg.style.height="13px",this.resizeIndicatorImg.style.width="7px",this.closeChatImg.src=`${STATIC_URL_MOBILE}close-button.svg`,this.closeChatImg.style.height="9px",this.closeChatImg.style.width="9px",this.closeChatImg.style.padding="0",this.closeChatImg.style.margin="0",this.closeChatImg.classList.add("closeChatFullscreen"),(0,R.K$)())this.resizeIndicatorDiv.style.width=(0,M.DK)()-21-4+"px",this.resizeIndicatorDiv.style.height="21px",this.stylePortrait();else{this.resizeIndicatorDiv.style.width="21px";const e=this.resizeDragDiv.getBoundingClientRect();this.resizeIndicatorDiv.style.height=e.height-21+"px",this.styleLandscape()}this.closeChatContainer.onclick=e=>{if(this.areEphemeralsVisible){if(e.stopPropagation(),(0,R.K$)()){let e=Math.max(180,1.15*this.portraitHeight);e=Math.min(380,e),this.heightDuration=e,this.updateTransitions(),this.setPortraitHeight(0,e)}else{let e=Math.max(200,1.5*this.landscapeWidth);e=Math.min(450,e),this.widthDuration=e,this.updateTransitions(),this.setLandscapeWidth(0,e)}this.showEphemerals(),k.Dd.fire(void 0)}},this.resizeIndicatorDiv.onclick=e=>{this.areEphemeralsVisible&&this.isChatHidden()&&(e.stopPropagation(),this.unhideChat())}}unhideChat(){const e=180;(0,R.K$)()?(this.heightDuration=e,this.updateTransitions(),this.setPortraitHeight(150,e)):(this.widthDuration=e,this.updateTransitions(),this.setLandscapeWidth(150,e))}isChatHidden(){return(0,R.K$)()&&this.portraitHeight<5||!(0,R.K$)()&&this.landscapeWidth<5}stylePortrait(){this.element.style.width="100%",this.element.style.top="",this.element.style.bottom=`${56+this.layoutConstraints.bottom()+this.inputFocusOffset}px`,this.element.style.right="",this.resizeDragDiv.style.height="50px",this.resizeDragDiv.style.width="100%",this.resizeDragDiv.style.left="0",this.resizeDragDiv.style.top="-30px",this.controlsContainerDiv.style.height="21px",this.controlsContainerDiv.style.width="100%",this.controlsContainerDiv.style.top="4px",this.controlsContainerDiv.style.left="0",this.resizeIndicatorDiv.style.marginLeft="1px",this.resizeIndicatorImg.style.left=((0,M.DK)()-7-2)/2+"px",this.resizeIndicatorImg.style.bottom="4px",this.resizeIndicatorImg.style.transform="rotate(90deg)",this.closeChatDiv.style.right="0",this.closeChatDiv.style.marginRight="1px",this.closeChatContainer.style.right="-18.5px"}styleLandscape(){let e;this.element.style.height="",this.element.style.top="30px",this.element.style.bottom=`${56+this.layoutConstraints.bottom()}px`,this.element.style.right="10px",this.resizeDragDiv.style.width="50px",this.resizeDragDiv.style.height="",this.resizeDragDiv.style.left="-30px",this.resizeDragDiv.style.top="0",this.controlsContainerDiv.style.height="100%",this.controlsContainerDiv.style.width="21px",this.controlsContainerDiv.style.top="0",this.controlsContainerDiv.style.left="4px",e=window.innerHeight>200?this.element.getBoundingClientRect().height:this.resizeIndicatorDiv.getBoundingClientRect().height,this.resizeIndicatorDiv.style.bottom="0",this.resizeIndicatorDiv.style.marginLeft="0",this.resizeIndicatorImg.style.left="7px",this.resizeIndicatorImg.style.bottom=(e-13)/2+"px",this.resizeIndicatorImg.style.transform="rotate(0deg)",this.closeChatDiv.style.right="",this.closeChatDiv.style.marginRight="0",this.closeChatContainer.style.right="-19.5px"}handleRemoveMessages(e){const t=[];for(const i of this.innerDiv.childNodes){const s=i;s.getAttribute("data-nick")===e&&t.push(s)}for(const e of t)this.innerDiv.removeChild(e)}toggleEphemeralsVisibility(){this.areEphemeralsVisible?this.hideEphemerals():this.showEphemerals()}showEphemerals(){(0,w.Ve)(this.resizeDragDiv,"opacity 175ms"),this.resizeDragDiv.style.opacity="0.9",this.areEphemeralsVisible=!0,this.showBackground(),clearTimeout(this.opacityTimer),this.opacityTimer=window.setTimeout((()=>{this.hideEphemerals()}),3500)}hideEphemerals(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,w.Ve)(this.resizeDragDiv,`opacity 175ms ${e}ms`),this.areEphemeralsVisible=!1,this.resizeDragDiv.style.opacity="0",this.hideBackground(e),clearTimeout(this.opacityTimer)}updateTransitions(){const e=`background-color 175ms ${this.backgroundDelay}ms`,t=`height ${this.heightDuration}ms`,i=`width ${this.widthDuration}ms`;(0,w.Ve)(this.element,[e,t,i].join(","))}isMirroringComponent(e){return this.chatComponentToMirror===e}repositionChildren(){this.element.style.display=this.isVisible?"block":"none",(0,R.K$)()?(this.setPortraitHeight(this.desiredPortraitHeight),this.stylePortrait()):(this.setLandscapeWidth(this.desiredLandscapeWidth),this.styleLandscape())}}},8096:(e,t,i)=>{"use strict";i.d(t,{Hy:()=>as,Ic:()=>os,Jo:()=>ns});var s=i(4936),n=i(7623),o=i(2201),r=i(1474),a=i(4054),l=i(9461),h=i(5914),d=i(7477),c=i(1224),u=i(6784),p=i(213),m=i(5216),g=i(768),v=i(6844),f=i(1131),y=i(1413),b=i(1516),w=i(2939),C=i(1519),S=i(2709),x=i(8423),T=i(7407),P=i(580),k=i(1452),A=i(5424),M=i(2146),R=i(74),I=i(4947),E=i(2945),L=i(3158),D=i(5389),B=i(9447),U=i(9510),_=i(9757),F=i(6428),N=i(7964),O=i(5052),H=i(442),W=i(6669),$=i(3955),V=i(481),z=i(9060),G=i(1779),q=i(1284),j=i(7258),Z=i(7569),K=i(2091),J=i(4110),Y=i(34),Q=i(1372),X=i(4580);const ee={borderWidth:"1px",borderStyle:"solid",borderRadius:"4px",display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"10px",padding:"0 12px",textAlign:"center",minHeight:"48px",boxSizing:"border-box",font:"inherit",width:"inherit"},te=e=>{var t;return(0,Q.tT)("button",{style:{...ee,...e.style},colorClass:void 0!==e.colorClass?["buttonBase",e.colorClass]:"buttonBase",onClick:e.onClick},null!==(t=e.body)&&void 0!==t?t:"")},ie=e=>{var t;const i=(0,Q.tT)("a",{style:{...ee,...e.style},colorClass:void 0!==e.colorClass?["buttonBase",e.colorClass]:"buttonBase",onClick:e.onClick},null!==(t=e.body)&&void 0!==t?t:"");return void 0!==e.href&&(i.href=(0,m._Y)(e.href)),void 0!==e.target&&(i.target=e.target),i};class se extends S.u{constructor(e,t){super(e,t)}setButtonText(e){this.element.innerText=e}setButtonBody(e){this.removeAllDOMChildren(),this.element.appendChild((0,Q.tT)(Q.FK,null,e))}setOnClick(e){this.element.onclick=e}showElement(){super.showElement("flex")}}class ne extends se{constructor(e){super("button",e)}initUI(e){this.element=(0,Q.tT)(te,{style:null==e?void 0:e.style,colorClass:null==e?void 0:e.colorClass,body:null==e?void 0:e.body,onClick:null==e?void 0:e.onClick})}enable(){this.element.disabled=!1}disable(){this.element.disabled=!0}}class oe extends se{constructor(e){super("a",e)}initUI(e){this.element=(0,Q.tT)(ie,{style:null==e?void 0:e.style,colorClass:null==e?void 0:e.colorClass,body:null==e?void 0:e.body,onClick:null==e?void 0:e.onClick,href:null==e?void 0:e.href,target:null==e?void 0:e.target})}}const re=new class{constructor(){this.privateShowButtons=[],this.fanclubButtons=[],this.supporterButtons=[];const e=new x.gt;w.X0.listen((t=>{t.chatConnection.event.statusChange.listen((()=>{this.updateContext(t)})).addTo(e),t.chatConnection.event.settingsUpdate.listen((()=>{this.updateContext(t)})).addTo(e)})),w.Gr.listen((()=>{e.removeAll()}))}addButton(e){e instanceof le?this.privateShowButtons.push(e):e instanceof ae?this.fanclubButtons.push(e):e instanceof de&&this.supporterButtons.push(e),void 0!==this.context&&this.updateContext(this.context)}updateContext(e){this.context=e,this.fanclubButtons.forEach((t=>{t.updateState(e)})),this.supporterButtons.forEach((t=>{t.updateState(e)})),this.updatePrivateButtonsState()}updatePrivateButtonsState(){if(this.privateShowButtons.forEach((e=>{e.hideElement()})),void 0===this.context||!this.canShowPrivateButton())return;const e=()=>{this.privateShowButtons.forEach((e=>{void 0!==this.context&&e.updateState(this.context.chatConnection)}))},t={previousStatus:this.context.chatConnection.previousStatus,currentStatus:this.context.chatConnection.status};(0,A.fs)(this.context,t)?e():(0,A._b)(this.context,t).then(e).catch(k.yZ)}canShowPrivateButton(){if(void 0===this.context)return!1;const{allowPrivateShow:e,isAgeVerified:t}=l.Aw.getState(),i=["privatewatching","privatespying"].includes(this.context.chatConnection.status);return(e||i)&&t}};class ae extends oe{constructor(){super(),re.addButton(this)}initData(){this.hasFanclub=!1}initUI(){super.initUI(),(0,B.fZ)(this.element,"fanclubButton"),(0,$.ZM)(this.element,{flex:1}),this.hideElement()}updateState(e){if(l.Bm.current.isNoninteractiveUser)return;const{hasFanClub:t,isInFanClub:i}=l.Aw.getState();var s;this.hasFanclub=t,this.hasFanclub&&(this.element.href=(0,m._Y)(`/fanclub/join/${e.chatConnection.room()}/?source=${null===(s=l.Bm.current)||void 0===s?void 0:s.PurchaseEventSources.SUPPORTER_SOURCE_JOIN_FAN_CLUB_BUTTON}`)),this.hasFanclub?this.showElement():this.hideElement(),i?this.setButtonText(I.R.fanClubMember):this.setButtonText(I.R.joinFanClub)}getHasFanclub(){return this.hasFanclub}}class le extends ne{constructor(e){super(e),re.addButton(this)}initData(e){this.useConciseText=!0===(null==e?void 0:e.useConciseText)}initUI(e){super.initUI(e),this.hideElement(),(0,B.fZ)(this.element,"privateShowButton")}updateState(e){this.showElement();const t=e.status;switch(t){case"privaterequesting":this.setCancelText(),this.setOnClick((()=>{this.leavePrivateOrSpy(e,t)}));break;case"privatenotwatching":const i=l.Aw.getState().spyPrice;if(e.premiumShowActive||i<=0){this.hideElement();break}this.setSpyRequestText(),this.setOnClick((()=>{(0,T.bT)("SpyClicked"),this.requestSpy(e,t)}));break;case"privatewatching":case"privatespying":this.setLeaveText(),this.setOnClick((i=>{i.preventDefault(),this.leavePrivateOrSpy(e,t)}));break;case"offline":case"away":case"hidden":case"notconnected":case"hiddenwatching":this.hideElement();break;case"public":this.setPrivateRequestText(),this.setOnClick((()=>{(0,T.bT)("PrivateClicked"),this.requestPrivate(e)}));break;default:warn(`Unexpected status for updatePrivateState: ${t}`)}}requestPrivate(e){(0,Y.UK)(e,!0,{onResolve:()=>{X.qb.fire("private")}})}requestSpy(e,t){(0,Y.lh)(e,!0,{onResolve:()=>{X.qb.fire("private")}})}leavePrivateOrSpy(e,t){(0,T.bT)("LeavePrivateOrSpyShow");const i=e.privateMinEnd<Date.now();(0,Y.yx)(e,i,{},(()=>{this.updateState(e)}))}setCancelText(){this.setButtonText(this.useConciseText?I.R.cancelRequest:I.R.privateShowCancelRequestLabel)}setSpyRequestText(){this.setButtonText(this.useConciseText?I.R.spyOnPrivate:I.R.privateShowSpyLabel)}setLeaveText(){this.setButtonText(this.useConciseText?I.R.leavePrivate:I.R.privateShowLeaveLabel)}setPrivateRequestText(){this.setButtonText(this.useConciseText?I.R.requestPrivate:I.R.privateShowRequestLabel)}}class he extends le{constructor(e){super({...e,style:{width:"120px",minWidth:"120px",height:"40px",marginBottom:"",minHeight:""}})}initData(e){super.initData(e)}updateState(e){this.enable(),super.updateState(e)}requestPrivate(e){(0,Y.UK)(e,!1,void 0,!0)}requestSpy(e){this.disable(),this.setConnectingText(),(0,Y.lh)(e,!1,{onError:()=>{this.updateState(e)},onResolve:()=>{X.qb.fire("private")},onFinally:()=>{this.enable()}})}leavePrivateOrSpy(e){this.disable(),this.setEndingText();const t=e.inPrivateOrSpy()&&e.privateMinEnd<Date.now();(0,Y.yx)(e,t,{onError:()=>{this.updateState(e)},onFinally:()=>{this.enable()}},(()=>{this.updateState(e)}))}setCancelText(){this.setButtonText(I.R.cancelText)}setSpyRequestText(){this.setButtonText(I.R.spyNow)}setLeaveText(){this.setButtonText(I.R.leave)}setPrivateRequestText(){this.setButtonText(I.R.request)}setConnectingText(){this.setButtonText(`${I.R.connecting}...`)}setEndingText(){this.setButtonText(`${I.R.ending}...`)}}class de extends oe{constructor(){super(),re.addButton(this)}initUI(){this.element=(0,Q.tT)(ie,{style:{flex:1},colorClass:"upgradeButton",href:`/supporter/upgrade/?source=${l.Bm.current.PurchaseEventSources.SUPPORTER_SOURCE_MOBILE_TOKENS_TAB}`,target:"_blank",body:I.R.upgradeToSupporterLabel})}updateState(e){e.dossier.isSupporter?this.hideElement():this.showElement()}}class ce extends ne{constructor(e){super(e)}initUI(e){super.initUI();const t=(0,Q.tT)("span",{style:{display:"flex",alignItems:"center"},"data-testid":"send-tip-button"},!0!==e.hideIcon&&(0,Q.tT)("span",{style:{display:"inline-block",width:"20px",height:"20px",marginRight:"8px"},colorClass:"tipIcon"}),e.tipButtonText);this.element=(0,Q.tT)(te,{style:{...e.style,marginBottom:0},colorClass:"sendTipButton",body:t,onClick:()=>{(0,T.bT)("TipWindowOpened"),(0,v.rC)(I.R.loginToTip)||X.f6.fire({})}})}}var ue=i(4926),pe=i(7925),me=i(8466),ge=i(9586),ve=i(8936),fe=i(3124);class ye extends S.u{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.outgoingHandlers=e,this.isConversationShowing=t,this.isPmChatContents=i,this.addMessageHTMLEvent=new x.c_("addMessageHtml",{reportIfNoListeners:!1}),this.addNoticeEvent=new x.c_("addNoticeEvent",{reportIfNoListeners:!1}),this.addPhotoMessageEvent=new x.c_("addPhotoMessageEvent",{reportIfNoListeners:!1}),this.removeMessagesForUserEvent=new x.c_("removeMessageHtml",{reportIfNoListeners:!1}),this.scrolledToBottom=new x.c_("scrolledToBottom"),this.messageList=function(){const e=document.createElement("div");return(0,B.fZ)(e,"msgList"),(0,M.PF)(e,"text"),e.dataset.testid="message-list",e.style.width="100%",e.style.cursor="text",e.style.paddingBottom="4px",e}(),this.noticeList=function(){const e=document.createElement("div");return(0,B.fZ)(e,"noticeList"),(0,M.PF)(e,"text"),e.style.width="100%",e.style.cursor="text",e.style.paddingBottom="4px",e}(),this.messageListWrapper=function(){const e=document.createElement("div");return e.dataset.testid="message-list-wrapper",e.style.width="100%",e.className="mobile-msg-list-wrapper",e.style.boxSizing="border-box",(0,z.QC)()&&(e.style.overflowY="auto"),e.style.overflowX="hidden",(0,ge.H)(e),e}(),this.isWatchingPrivate=!1,this.inputFieldHasFocus=!1,this.messageCounter=0,this.listenerGroup=new x.gt,this.autocompleteModalCollection=[],this.scrollToBottomDebouncer=new C.a((()=>this.scrollToBottom()),{bounceLimitMS:0,debounceType:0}),this.toBottom=()=>{this.scrollToBottom()},(0,B.fZ)(this.element,"ChatContents"),(0,$.ZM)(this.element,{position:"unset",wordWrap:"break-word"}),this.messageListWrapper.appendChild(this.noticeList),this.messageListWrapper.appendChild(this.messageList),this.element.appendChild(this.messageListWrapper),(0,z.QC)()&&(this.scrollDownButton=new H.w({scrollToBottom:()=>this.scrollToBottom(),bottomStyle:()=>`${this.totalInputHeight()+4}px`}),this.addChild(this.scrollDownButton),this.newMessageNotice=new O.W({getUnreadCount:()=>{var e;return null===(e=this.scrollDownButton)||void 0===e?void 0:e.getUnreadCount()},isConversationShowing:()=>this.isConversationShowing(),isScrolledUp:()=>this.isScrolledUp(),setParentScrollTop:e=>this.setScrollTop(e),scrollParentDiv:this.messageListWrapper}),me.R.listen((()=>{var e;null===(e=this.newMessageNotice)||void 0===e||e.remove(),this.scrollToBottom()})).addTo(this.listenerGroup),fe.DQ.listen((()=>{var e;null===(e=this.newMessageNotice)||void 0===e||e.remove()})).addTo(this.listenerGroup)),this.initInputUI(),this.initPrivateOverlay(),this.initEmoticonModal(),this.initUserMentionModal(),this.initShortcodeModal(),this.initCssClasses(),(0,u.wu)("submit",this.inputForm,(e=>{e.preventDefault(),this.customInputField.submit()})),(0,u.wu)("mousedown",this.customInputField.element,(()=>{(0,N.QQ)(this)})),(0,u.wu)("focus",this.customInputField.element,(e=>{this.inputFieldHasFocus=!0,X.Gt.fire(void 0),ns()&&(this.inputDiv.style.bottom="50px",void 0!==this.userMentionAutocompleteModal&&(this.userMentionAutocompleteModal.element.style.bottom="111px"))})),(0,u.wu)("blur",this.customInputField.element,(e=>{(0,n.H8)()&&(0,n.OF)()&&this.customInputField.element.blur(),this.autocompleteModalCollection.some((e=>e.isVisible()))&&e.cancelable?e.preventDefault():(this.inputFieldHasFocus=!1,X.P4.fire(void 0),ns()&&(this.inputDiv.style.bottom="0",void 0!==this.userMentionAutocompleteModal&&(this.userMentionAutocompleteModal.element.style.bottom="61px")))}));let s=!1,o=!1;const r=new C.a((()=>{s=!1}),{bounceLimitMS:50,debounceType:1});(0,u.wu)("scroll",this.messageListWrapper,(e=>{s||(s=!0,o=this.isScrolledUp()),r.callFunc();const t=this.messageListWrapper.scrollTop;var i,n;this.isPmChatContents&&t<=1&&o&&J.ME.fire(),this.isScrolledUp()?null===(i=this.scrollDownButton)||void 0===i||i.showElement():(null===(n=this.scrollDownButton)||void 0===n||n.hideElement(),this.isConversationShowing()&&this.clearScrollButtonUnread()),!this.isScrolledUp()&&o&&(this.scrolledToBottom.fire(),o=!1)})),(0,z.GZ)()&&!this.isPmChatContents&&(0,z.$o)(this.messageListWrapper,this.messageList),(0,u.wu)("keyup",this.element,(e=>{"Enter"===e.key&&this.customInputField.blur()})),w.X0.once((e=>{this.currentRoomContext=e,this.messageListWrapper.style.fontSize=e.dossier.userChatSettings.fontSize,this.setLineHeight(),this.listenerGroup.add(F.$u.listen((()=>{(0,ue.St)(this.messageList)})))})),R.EZ.listen((e=>{this.messageListWrapper.style.fontSize=e.fontSize,this.setLineHeight()})).addTo(this.listenerGroup),w.Gr.listen((()=>{var e;this.autocompleteModalCollection.forEach((e=>e.dispose())),this.customInputField.clearText(),null===(e=this.scrollDownButton)||void 0===e||e.hideElement(),(0,N.Tj)()})).addTo(this.listenerGroup),X.nD.listen((e=>{this.inputDiv.style.position=e?"absolute":"fixed",this.inputDiv.style.bottom="0"})).addTo(this.listenerGroup),U.xf.listen((()=>{this.updateInputButtonHighlight()})).addTo(this.listenerGroup),U.TL.listen((e=>{this.sendButton.update({highlight:this.hasNonEmptyMessageDraft()})})).addTo(this.listenerGroup),pe.GF.listen((e=>{let{isInputFocused:t,playerTop:i}=e;this.repositionChatOnInputFocus(t,i)})).addTo(this.listenerGroup)}hasNonEmptyMessageDraft(){return this.customInputField.getText().trim().length>0||this.hasMediaFiles()}initInputUI(){this.inputForm=function(){const e=document.createElement("form");return(0,$.ZM)(e,{height:"100%",display:"flex",alignItems:"center",boxSizing:"border-box",flex:1,overflow:"hidden",position:"relative"}),e}(),this.inputDiv=function(){const e=document.createElement("div");return(0,B.fZ)(e,"inputDiv"),(0,$.ZM)(e,{height:"64px",boxSizing:"border-box",position:"absolute",bottom:"0",cursor:"text",borderTopWidth:"1px",borderTopStyle:"solid",zIndex:1,display:"flex",alignItems:"center",padding:"8px"}),e}();const e=this.isPmChatContents?K.mU:K.hk;this.customInputField=function(e,t){const i=new W.wi(e,t);return i.element.dataset.testid="chat-input",(0,$.ZM)(i,{boxSizing:"border-box",lineHeight:"24px",minHeight:"24px",fontSize:"16px",fontFamily:"Tahoma, Arial, Helvetica, sans-serif",WebkitUserSelect:"text",height:""}),i}((()=>this.sendMessageFromInput()),e),this.inputPlaceholder=function(){const e=document.createElement("span");return(0,B.fZ)(e,"placeholder"),e.innerText=I.R.sendAMessage,(0,$.ZM)(e,{position:"absolute",top:"50%",transform:"translateY(-50%)",pointerEvents:"none",width:"100%",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}),e}(),this.sendButtonRoot=document.createElement("span");const t=_.c.get("SendButton");this.sendButton=new t({onClick:()=>{this.isUploadInProgress()||((0,T.bT)("MobileSendButtonClicked",{input:this.customInputField.getText()}),this.customInputField.submit(),this.customInputField.blur())},isPm:this.isPmChatContents,variant:"MobileSplitMode",hidden:!0,highlight:!1},this.sendButtonRoot),G._c.listen((()=>{this.inputForm.style.display="none",window.setTimeout((()=>this.showInputForm()),0)})).addTo(this.listenerGroup),this.constructInputUI()}createMediaDockButton(){const e=document.createElement("span");e.style.cursor="pointer",e.style.display="inline-block",e.style.height="26px",e.style.padding="0 10px 0 5px",e.dataset.paction="MobileChat",e.dataset.pactionName="UploadPhoto",e.dataset.testid="send-image-button";const t=document.createElement("img");return t.src=`${STATIC_URL_ROOT}tsdefaultassets/mediaDock/uploadBackground-lighter.svg`,t.style.width="100%",t.style.height="100%",e.appendChild(t),(0,n.OF)()?(e.onpointerdown=e=>{var t;e.preventDefault(),e.stopPropagation(),(null===(t=document)||void 0===t?void 0:t.activeElement)instanceof HTMLElement&&document.activeElement.blur()},e.onpointerup=()=>{this.onMediaDockButtonClick()}):e.onclick=()=>{this.onMediaDockButtonClick()},e}constructInputUI(){(0,B.fZ)(this.inputForm,"inputForm"),(0,$.ZM)(this.inputForm,{display:"flex",borderWidth:"1px",borderStyle:"solid",borderRadius:"4px",paddingLeft:"8px"}),this.inputControlsWrapper=function(){const e=document.createElement("div");return e.dataset.testid="buy-box",(0,$.ZM)(e,{display:"flex",alignItems:"center",marginLeft:"6px"}),e}(),(0,$.ZM)(this.inputControlsWrapper,{margin:0,height:"100%"}),this.actionButtonsContainer=document.createElement("div"),this.actionButtonsContainer.dataset.testid="action-buttons-container",(0,$.ZM)(this.actionButtonsContainer,{height:"100%"}),this.inputControlsWrapper.appendChild(this.actionButtonsContainer);const e=new ce({style:{padding:"0px 16px",fontSize:"14px",minHeight:"",height:"100%",marginRight:0,marginLeft:"8px"},tipButtonText:I.R.sendTipButtonText});this.actionButtonsContainer.appendChild(e.element),this.inputForm.appendChild(this.inputPlaceholder),this.inputForm.appendChild(this.customInputField.element),this.inputForm.appendChild(this.sendButtonRoot),this.isPmChatContents&&(this.mediaDockButton=this.createMediaDockButton(),this.inputDiv.appendChild(this.mediaDockButton)),this.inputDiv.appendChild(this.inputForm),this.inputDiv.appendChild(this.inputControlsWrapper),this.element.appendChild(this.inputDiv),this.bindInputObserver(),this.sendButton.update({hidden:!1}),this.initToggleActionButtons()}totalInputHeight(){var e,t;return 64+(null!==(e=null===(t=this.mobileMediaDock)||void 0===t?void 0:t.element.offsetHeight)&&void 0!==e?e:0)}onMediaDockButtonClick(){if((0,T.bT)("PMPhotoButtonClicked"),!(0,v.rC)()){var e;if((0,N.QQ)(this))return;null===(e=this.mobileMediaDock)||void 0===e||e.showSelectDialog(),this.scrollToBottom()}}initMediaDock(e){this.mobileMediaDock=e,this.addMediaDockToDOM()}addMediaDockToDOM(){void 0!==this.mobileMediaDock&&this.element.insertBefore(this.mobileMediaDock.element,this.inputDiv)}initShortcodeModal(){this.isPmChatContents||(this.shortcodeAutocompleteModal=new j.J(this.customInputField,this.isPmChatContents),this.inputDiv.appendChild(this.shortcodeAutocompleteModal.element),this.shortcodeAutocompleteModal.afterDOMConstructedIncludingChildren(),this.autocompleteModalCollection.push(this.shortcodeAutocompleteModal))}initEmoticonModal(){this.emoticonAutocompleteModal=new V.Q(this.customInputField),this.inputDiv.appendChild(this.emoticonAutocompleteModal.element),this.emoticonAutocompleteModal.afterDOMConstructedIncludingChildren(),this.autocompleteModalCollection.push(this.emoticonAutocompleteModal)}initUserMentionModal(){this.isPmChatContents||(this.userMentionAutocompleteModal=this.addChild(new F.jE({inputElement:this.customInputField,leftOffset:10,rightOffset:167,inputDivHeight:64})))}initCssClasses(){this.isPmChatContents?(this.element.classList.add("MobileChatDivPm"),this.element.dataset.testid="pm-chat-base",this.customInputField.element.classList.add("mobileInputFieldPm"),this.emoticonAutocompleteModal.element.classList.add("mobileEmoticonAutocompleteModalPm")):(this.element.classList.add("MobileChatDivChat"),this.element.dataset.testid="chat-base",this.customInputField.element.classList.add("mobileInputFieldChat"),this.emoticonAutocompleteModal.element.classList.add("mobileEmoticonAutocompleteModalChat")),this.emoticonAutocompleteModal.element.dataset.testid="emoticon-autocomplete-modal"}toggleActionButtons(){this.inputFieldHasFocus?void 0!==this.actionButtonsContainer&&(this.actionButtonsContainer.style.display="none"):void 0!==this.actionButtonsContainer&&(this.actionButtonsContainer.style.display="flex")}initToggleActionButtons(){X.Gt.listen((()=>{this.toggleActionButtons()})).addTo(this.listenerGroup),X.P4.listen((()=>{window.setTimeout((()=>{this.toggleActionButtons()}),200)})).addTo(this.listenerGroup)}bindInputObserver(){new MutationObserver((e=>{e.forEach((()=>{this.updateInputButtonHighlight(),this.customInputField.getText().length>0?this.inputPlaceholder.style.display="none":this.inputPlaceholder.style.display="block"}))})).observe(this.customInputField.element,{characterData:!0,subtree:!0,childList:!0})}updateInputButtonHighlight(){const e=this.customInputField.getText();e.length>0?this.inputPlaceholder.style.display="none":this.inputPlaceholder.style.display="block";const t=(e.trim().length>0||this.hasMediaFiles())&&!this.isUploadInProgress();this.sendButton.update({highlight:t})}isUploadInProgress(){var e,t;return null!==(e=null===(t=this.mobileMediaDock)||void 0===t?void 0:t.isUploading())&&void 0!==e&&e}showInputForm(){this.inputForm.style.display="flex"}setLineHeight(){const e=Number(this.messageListWrapper.style.fontSize.slice(0,-2));this.messageListWrapper.style.lineHeight=`${e+7}pt`}shouldSendMessageFromInput(){return!((0,v.rC)(I.R.loggedInToSendAMessage)||this.isWatchingPrivate&&!this.isPmChatContents&&((0,p.Q$)(`${I.R.privateShowChatActive} ${I.R.goToPrivateTabToChat}`),1))}sendMessageFromInput(){return!!this.shouldSendMessageFromInput()&&(this.scrollToBottom(),this.hasNonEmptyMessageDraft()&&this.processMessage(this.customInputField.getText()),!0)}initPrivateOverlay(){this.isPmChatContents||(this.privateOverlay=document.createElement("div"),(0,B.fZ)(this.privateOverlay,"privateOverlay"),(0,$.ZM)(this.privateOverlay,{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:2,display:"none",justifyContent:"center",alignItems:"center",textAlign:"center",padding:"15px",boxSizing:"border-box"}),this.element.appendChild(this.privateOverlay))}showPrivateOverlay(e,t){this.isPmChatContents||void 0===this.privateOverlay||(this.isWatchingPrivate=!0,this.privateOverlay.innerText=`${I.R.privateShowChatActive} ${""!==e?I.R.tapToChatWithUser(e):I.R.tapToChatWithBroadcaster}`,this.privateOverlay.onclick=t,this.privateOverlay.style.display="flex")}hidePrivateOverlay(){this.isPmChatContents||void 0===this.privateOverlay||(this.isWatchingPrivate=!1,this.privateOverlay.style.display="none")}shortcodeErrorMsg(e,t){return this.isPmChatContents?I.R.shortcodeNotSupportedInPMs:""!==l.Aw.getState().privateShowId?I.R.shortcodeNotSupportedInPrivates:0===e.shortcodes.length?Z.fM.errorBehindShortcode(t):void 0}processMessage(e){const t=(0,Z.PR)(e);switch(t.messageType){case Z.gW.Shortcode:const i=t,s=this.shortcodeErrorMsg(i,e);void 0!==s?this.appendMessageDiv((0,ue.CM)(s)):this.outgoingHandlers.onShortcode&&this.outgoingHandlers.onShortcode(i);break;case Z.gW.ToggleDebugMode:this.outgoingHandlers.onToggleDebugMode();break;case Z.gW.TipRequest:this.customInputField.clearText();const n=t;this.outgoingHandlers.onTipRequest(n.messageData);break;default:this.outgoingHandlers.onChatMessage(e)}}repositionChatOnInputFocus(e,t){const i=visualViewport;if(null!==i)if(e){if(void 0===t)return void error("playerTop cannot be undefined when input is focused.");this.messageListWrapper.style.position="fixed",this.messageListWrapper.style.top="",this.messageListWrapper.style.bottom=`${t}px`,this.setMessageListWrapperHeight(i.height-t)}else this.messageListWrapper.style.position="",this.messageListWrapper.style.top="",this.messageListWrapper.style.bottom=""}repositionChildren(){this.inputFieldHasFocus&&!(0,fe.K$)()&&this.customInputField.blur(),this.inputDiv.style.width=`${(0,ve.DK)()}px`,this.emoticonAutocompleteModal.element.style.bottom=this.inputDiv.offsetHeight-8+"px",void 0!==this.shortcodeAutocompleteModal&&(this.shortcodeAutocompleteModal.element.style.bottom=this.inputDiv.offsetHeight-8+"px"),this.isScrolledUp()||this.scrollToBottom()}isScrolledUp(){return this.messageListWrapper.scrollTop<=this.messageListWrapper.scrollHeight-(this.messageListWrapper.offsetHeight+20)}scrollToBottom(){var e;const t=this.isScrolledUp();(0,n.OF)()&&(0,$.WV)(this.messageListWrapper),this.messageListWrapper.scrollTop=this.messageListWrapper.scrollHeight,null===(e=this.scrollDownButton)||void 0===e||e.hideElement(),t&&this.scrolledToBottom.fire()}debouncedScrollToBottom(){this.scrollToBottomDebouncer.callFunc()}getScrollTop(){return this.messageListWrapper.scrollTop}setScrollTop(e){this.messageListWrapper.scrollTo({top:e})}setMessageListWrapperHeight(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.isScrolledUp(),s=this.getScrollTop(),n=this.messageListWrapper.offsetHeight;if(this.messageListWrapper.style.height=`${e}px`,i){if(t){const e=this.messageListWrapper.offsetHeight-n;this.setScrollTop(s-e)}}else this.scrollToBottom()}cloneClickListeners(e,t){for(let i=0;i<e.children.length;i+=1)this.cloneClickListeners(e.children[i],t.children[i]);t.onclick=e.onclick}appendNoticeDiv(e){return e.style.fontSize="",this.noticeList.appendChild(e),e}appendMessageDiv(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.appendMessage(e,(()=>{this.addMessageHTMLEvent.fire({makeByCloning:()=>{const t=e.cloneNode(!0);return this.cloneClickListeners(e,t),t}})}),t,i)}appendNoticeMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.appendMessage(e.element,(()=>{this.addNoticeEvent.fire(e.roomNoticeData)}),t)}appendPhotoMessage(e,t){this.appendMessage(e,(()=>{this.addPhotoMessageEvent.fire(t)}),!1)}appendMessage(e,t){var i;let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=this.messageListWrapper.scrollTop,r=this.isScrolledUp();var a;if(r||e.querySelectorAll("img").forEach((e=>{const t=e.src;e.src="",e.onload=this.toBottom,e.src=t})),!s||!r&&this.isConversationShowing()||null===(a=this.scrollDownButton)||void 0===a||a.incUnread(),!0===(null===(i=this.newMessageNotice)||void 0===i?void 0:i.shouldAppendNewMessageNotice(s,n))&&(0,q.NZ)(this.newMessageNotice.element,this.messageList,this.isPmChatContents),e.style.fontSize="",e.style.lineHeight="",(0,q.NZ)(e,this.messageList,this.isPmChatContents),(0,z.GZ)()&&this.messageList.childElementCount%100==0&&!this.isPmChatContents){const e=l.Aw.getState();(0,T.bT)("ChatHistoryReached",{n:this.messageList.childElementCount,is_mod:e.isModerator,is_broadcaster:e.userName===e.room})}let h=this.messageList.childElementCount-(0,K.wR)(this.isPmChatContents);for(;h>0;h-=1){const e=this.messageList.firstElementChild;null!==e&&this.messageList.removeChild(e)}var d;return r?null===(d=this.newMessageNotice)||void 0===d||d.maybeScrollJump(o):this.scrollToBottom(),t(),this.messageCounter+=1,e}clearScrollButtonUnread(){var e;null===(e=this.scrollDownButton)||void 0===e||e.clearUnread()}removeMessageDiv(e){this.messageList.removeChild(e)}getLastMessageId(){return this.messageCounter}getEarliestMessageId(){return this.earliestMessageId}setEarliestMessageId(e){this.earliestMessageId=e}messagesSinceId(e){return this.messageCounter-e}hasMediaFiles(){return void 0!==this.mobileMediaDock&&!this.mobileMediaDock.isEmpty()}handleRemoveMessages(e){const t=[];for(const i of this.messageList.childNodes){const s=i;s.getAttribute("data-nick")===e&&t.push(s)}for(const e of t)this.messageList.removeChild(e);this.removeMessagesForUserEvent.fire(e)}clear(){for(this.messageCounter=0;null!==this.messageList.firstChild;)this.messageList.removeChild(this.messageList.firstChild)}dispose(){var e,t,i;this.emoticonAutocompleteModal.dispose(),this.listenerGroup.removeAll(),this.customInputField.dispose(),null===(e=this.userMentionAutocompleteModal)||void 0===e||e.dispose(),null===(t=this.mobileMediaDock)||void 0===t||t.dispose(),null===(i=this.shortcodeAutocompleteModal)||void 0===i||i.dispose()}}var be=i(7463),we=i(9739);class Ce extends we.W{constructor(){super()}initUI(){this.followButton=(0,Q.tT)(Se,{onClick:()=>{this.handleFollowAndUnfollow()}}),this.unfollowButton=(0,Q.tT)(xe,{onClick:()=>{this.onUnfollowClick()}}),this.element=(0,Q.tT)("div",{style:{display:"flex",alignItems:"center"}},this.followButton,this.unfollowButton),this.updateFollowButtonDisplay(),be.im.listen((e=>{e.roomName===this.roomName&&this.updateContext(this.roomName,e.following)}))}}const Se=e=>(0,Q.tT)("div",{className:"follow_star_btn",style:{display:"none",color:"#ffffff",boxSizing:"border-box",borderRadius:"4px",padding:0,height:"32px",justifyContent:"center",alignItems:"center"},onClick:e.onClick},(0,Q.tT)("span",{className:"icon_not_following no_hover",style:{position:"static",padding:"0 3px 0",height:"29px",width:"29px",backgroundSize:"28px 28px",display:"inline-block"},"data-testid":"follow-button"}),(0,Q.tT)("span",{className:"follow_txt",style:{display:"inline-block",fontSize:"14px",paddingRight:"8px"}},I.R.followText)),xe=e=>(0,Q.tT)("div",{style:{display:"none",backgroundColor:"#17202A",color:"#ffffff",boxSizing:"border-box",borderRadius:"4px",justifyContent:"center",alignItems:"center"},onClick:e.onClick},(0,Q.tT)("span",{className:"icon_following_new no_hover",style:{position:"relative",height:"20px",width:"20px",backgroundSize:"20px 20px"},"data-testid":"unfollow-button"}));var Te=i(8039);class Pe extends S.u{constructor(e,t,i,s){if(super(),this.width=(0,ve.$B)().width,this.transitionMS=300,this.visibilityDebouncer=new C.a((()=>{this.element.style.visibility="hidden"}),{bounceLimitMS:this.transitionMS,debounceType:1}),(0,$.ZM)(this.element,{backgroundColor:"#ffffff",top:"0",bottom:"0",zIndex:1,visibility:"visible",position:"relative"}),!0===i){(0,$.ZM)(this.element,{position:"absolute",visibility:"hidden",right:"-100%",width:"100%"});const e=document.createElement("div");new(_.c.get("MenuLabel"))({onClick:()=>{this.hide()},text:void 0!==s?s:I.R.backToRoomMenu,showChevron:!0,isBackLabel:!0},e),this.element.appendChild(e)}(0,M.Ve)(this.element,`right ${this.transitionMS}ms ease-in-out`),void 0!==t&&this.addChild(t)}show(){this.element.style.visibility="visible",this.element.style.right="0"}hide(){this.element.style.right="-100%","hidden"!==this.element.style.visibility&&this.visibilityDebouncer.callFunc()}}var ke=i(2944);const Ae=new x.c_("userCountUpdate");class Me extends Pe{constructor(){super((0,ve.DK)()-50,void 0,!0),this.userCount=0,this.isUserListOpen=!1,this.userList=[],this.wrapper=this.createBaseElement("div"),this.element.appendChild(this.wrapper),this.createLoadingDiv(),(0,$.ZM)(this.wrapper,{backgroundColor:"#ffffff",padding:"19px",boxSizing:"border-box",fontFamily:"UbuntuRegular, Arial, Helvetica, sans-serif",height:"calc(100% - 45px)",fontSize:"14px",overflowY:"scroll"}),w.X0.listen((e=>{this.chatConn=e.chatConnection,this.chatConn.event.statusChange.listen((e=>{const t="privatewatching"===e.previousStatus||"privatewatching"===e.currentStatus;("notconnected"===e.previousStatus||t)&&window.setTimeout((()=>{this.refreshUsers()}),2e3)})),this.chatConn.event.roomCountUpdate.listen((e=>{this.updateUserCount(e)}))}))}removeUserListChildren(){for(this.header=void 0;null!==this.wrapper.firstChild;)this.wrapper.removeChild(this.wrapper.firstChild)}createLoadingDiv(){const e=document.createElement("div");e.innerText="Loading...",e.style.margin="6px",this.wrapper.appendChild(e)}createHeadingDiv(){const e=document.createElement("div"),t=document.createElement("div");return(0,$.ZM)(e,{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"}),(0,$.ZM)(t,{fontSize:"16px"}),e.appendChild(t),e.appendChild(this.createRefreshUsersLink()),t.innerText=`${I.R.usersText} (${this.userCount})`,e}createRefreshUsersLink(){const e=document.createElement("div");return e.innerText=I.R.refreshUserListSentenceCase,(0,$.ZM)(e,{cursor:"pointer",color:"#306A91"}),e.onmouseenter=()=>{e.style.color="#000000"},e.onmouseleave=()=>{e.style.color="#999999"},e.onclick=e=>{this.removeUserListChildren(),this.createLoadingDiv(),this.refreshUsers()},e}refreshUsers(){void 0!==this.chatConn&&Te.SJ.getInstance().fetchRoomUsers().then((e=>{this.updateUserCount(e.totalCount),this.removeUserListChildren(),this.wrapper.appendChild(this.createHeadingDiv()),this.userList=e.roomUsers;for(const e of this.userList){const t=document.createElement("div");t.style.margin="0 0 10px",t.style.cursor="pointer",t.style.whiteSpace="nowrap",t.style.overflow="hidden",t.style.maxWidth="100%",t.style.textOverflow="ellipsis",t.appendChild((0,ke.t)(e,void 0,!0)),this.wrapper.appendChild(t)}const t=document.createElement("div");t.innerText=`+${e.anonCount} anonymous user${1===e.anonCount?"":"s"}`,(0,$.ZM)(t,{width:"100%",whiteSpace:"nowrap",color:"#A7A7A7",margin:"0 0 10px"}),this.wrapper.appendChild(t),this.repositionChildren()})).catch((e=>{error("Error retrieving mobile user list",e)}))}updateUserCount(e){if(this.userCount=e,void 0!==this.header){const e=this.header;this.header=this.createHeadingDiv(),this.wrapper.replaceChild(this.header,e)}Ae.fire(e)}getUserCount(){return this.userCount}isOpen(){return this.isUserListOpen}show(){super.show(),this.isUserListOpen=!0,this.refreshUsers()}hide(){super.hide(),this.isUserListOpen=!1}repositionChildren(){this.width=(0,ve.DK)()-50}}class Re extends S.u{constructor(){super()}initUI(){const e={whiteSpace:"nowrap",textOverflow:"ellipsis",textAlign:"right",overflow:"hidden",width:"100%"},t={fontFamily:"'UbuntuBold', Arial, Helvetica, sans-serif",color:"#FFF",fontWeight:700,fontSize:"14px",display:"block",...e},i={fontSize:"12px",color:"#A7A7A7",display:"inline-block",...e};this.followButton=new Ce,this.element=(0,Q.tT)("div",{style:{margin:"0 10px",display:"flex",boxSizing:"border-box",minWidth:"inherit"}},(0,Q.tT)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginRight:"8px",flex:1,minWidth:"inherit",textAlign:"right"}},(0,Q.tT)("span",{style:t,ref:e=>this.roomNameElement=e}),(0,Q.tT)("span",{style:i},(0,Q.tT)("span",{ref:e=>this.roomStatusElement=e}),(0,Q.tT)("span",{ref:e=>this.numViewersElement=e}))),this.followButton.element),Ae.listen((e=>{this.updateViewerCount(e)}))}updateContext(e,t,i){this.roomName=e,this.followButton.updateContext(this.roomName,t),this.updateRoomNameText(),this.updateStatus(i)}updateStatus(e){this.roomStatus=e,this.updateRoomStatusText()}updateViewerCount(e){this.numViewers=e,this.updateRoomStatusText()}updateRoomNameText(){this.roomNameElement.innerText=this.roomName}updateRoomStatusText(){let e=`${I.R.live} • `,t=!0;switch(this.roomStatus){case"offline":case"unknown":e=I.R.offline,t=!1;break;case"away":e=`${I.R.away} • `;break;case"notconnected":e=I.R.connecting,t=!1}this.roomStatusElement.innerText=e,this.numViewersElement.innerText=t?`${I.R.numViewerOrViewers(this.numViewers)}`:""}}var Ie=i(3333),Ee=i(7176),Le=i(2196);class De extends Le.N{constructor(){super(),(0,B.fZ)(this.element,"MobileDismissibleMessages"),(0,$.ZM)(this.element,{height:"",position:"fixed",top:"40px"})}render(e){const t=(0,Q.tT)(Ue,{onCloseButtonClick:()=>this.dismissMessage(t,e),message:e});this.element.appendChild(t)}dismissMessage(e,t){super.dismissMessage(e,t)}}const Be=e=>{const t=(0,Ee.fh)("12px");return(0,B.fZ)(t,"closeButton"),(0,$.ZM)(t,{marginRight:"15px"}),t.dataset.testid="dismissible-message-dismiss",t.onclick=e.onClick,t},Ue=e=>(0,Q.tT)("div",{colorClass:"messageContainer",style:{alignItems:"center",padding:"8px 15px",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif",fontSize:"14px",lineHeight:"16px"}},(0,Q.tT)(Be,{onClick:e.onCloseButtonClick}),(0,Q.tT)(_e,{message:e.message})),_e=e=>{const t=(0,Q.tT)("div",{colorClass:"message","data-testid":"dismissible-message-text",style:{flex:1,maxHeight:"15vh",overflowY:"scroll"},dangerouslySetInnerHTML:{__html:e.message.messageHtml}});for(const e of t.getElementsByTagName("a"))(0,B.fZ)(e,"link"),"javascript:;"!==e.href&&(e.target="_blank",e.rel="noopener noreferrer"),e.classList.contains(Ie.uJ)&&(0,Ie.NX)(e);for(const e of t.getElementsByTagName("img"))e.style.maxWidth="100%";return t};var Fe=i(338),Ne=i(3131),Oe=i(9321),He=i(1282),We=i(3933),$e=i(2609),Ve=i(5256);class ze extends $e.k{constructor(){super(),this.layoutConstraints=new Ve.f(this.constructor.name),this.androidKeyboardViewportHeight=0,(0,$.ZM)(this.element,{WebkitTextSizeAdjust:"none",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"}),this.layoutConstraints.setOnUpdate((()=>{const e=this.layoutConstraints.transitionTime();(0,M.Ve)(this.element,`top ${e}ms, width ${e}ms`),this.repositionChildren()}))}repositionChildren(){if(super.repositionChildren(),void 0===this.parent)return;const e=this.parent.element.getBoundingClientRect(),t=e.width-((0,fe.K$)()?0:this.layoutConstraints.right());if(this.element.style.width=`${t}px`,this.element.style.top="",this.element.style.bottom="",this.playerIsBottomPositioned)this.element.style.bottom=64+.5*(e.height-this.element.offsetHeight)+"px";else if((0,L.Q)()&&(0,fe.K$)())if((0,n.OF)()||!(0,G.aS)())this.element.style.bottom=`${this.layoutConstraints.bottom()}px`;else{0===this.androidKeyboardViewportHeight&&(this.androidKeyboardViewportHeight=visualViewport?visualViewport.height:screen.height-350);const e=44;this.element.style.top=this.androidKeyboardViewportHeight-this.layoutConstraints.bottom()-this.element.offsetHeight-e+"px"}else{const t=Math.max(0,this.layoutConstraints.bottom()-((0,ve.mJ)()-e.height)),i=e.height-((0,fe.K$)()?t:0);this.element.style.top=`${e.top+.5*(i-this.element.offsetHeight)}px`}(0,L.Q)()||(this.androidKeyboardViewportHeight=0),this.resizeRoomStatusText(e.width);let i=Math.min(50,(e.width-(0,ve.DK)()+100)/2);i=Math.max(0,i),this.element.style.padding=`4px ${i}px 12px`}setPlayerIsBottomPositioned(e){this.playerIsBottomPositioned=e,this.repositionChildren()}showElement(){super.showElement("flex")}resizeRoomStatusText(e){const t=()=>{this.header.style.fontSize="20px",this.header.style.marginBottom="20px",this.body.style.fontSize="12px"};if((0,fe.K$)()&&e<(0,ve.DK)()){const i=e/(0,ve.DK)()*100;i<=47?(this.header.style.fontSize="15px",this.header.style.marginBottom="0px",this.body.style.fontSize="8px"):i<=50?(this.header.style.fontSize="15px",this.header.style.marginBottom="0px",this.body.style.fontSize="10px"):i<=75?(this.header.style.fontSize="15px",this.header.style.marginBottom="12px",this.body.style.fontSize="10px"):t()}else t()}handleStatusChange(e,t){super.handleStatusChange(e,t);const i={top:0,bottom:0,left:0,right:0,transitionTime:0};"none"!==this.element.style.display&&(i.top=this.element.offsetHeight,i.left=200),this.layoutConstraints.setConstraints(i)}hideConnectingStatus(){super.hideConnectingStatus(),"none"===this.element.style.display&&this.layoutConstraints.setConstraints({top:0,bottom:0,left:0,right:0,transitionTime:0})}}var Ge=i(5431);class qe extends We.y{createPlayerOption(){const e=super.createPlayerOption();return e.techOrder=["chromecast","html5"],e.chromecast={requestTitleFn:e=>document.title,requestSubtitleFn:e=>""},e.plugins={chromecast:{receiverAppID:"96BDEA07"}},e}constructor(e){super(e)}}var je=i(5271),Ze=i(3939);class Ke extends Fe.N{constructor(e,t,i){super(e,new ze,{noHook:!0}),this.mobileDismissibleMessages=i,this.toggleFullscreen=new x.c_("MobilePlayer:toggleFullscreen"),this.sendMessageInputFieldHasFocus=!1,this.minPortraitLeft=0,this.isVideoHidden=!1,this.isFullscreen=!1,this.usingAirPlay=!1,this.usingChromecast=!1,this.element.style.position="absolute",this.element.style.top="0",this.element.style.width="auto",this.element.style.height="auto",this.element.style.overflow="hidden",this.element.style.setProperty("scrollBehavior","auto"),(0,n.OF)()&&(this.element.style.touchAction="none"),this.playerComponent.element.style.overflowX="hidden",this.headerMenu=document.querySelector("#static-header"),this.roomStatusNotifier.header.style.fontSize="20px",this.roomStatusNotifier.body.style.fontSize="12px",this.videoControls=new Ge.i(this,t,i),this.bindControlsEvents(),this.afterPlayerCreated(),this.addChild(this.videoControls),this.element.removeChild(this.watermark),this.addChild(this.roomStatusNotifier),this.toggleFullscreen.listen((()=>{this.repositionChildrenRecursive()})),void 0!==navigator.mediaSession&&(navigator.mediaSession.setActionHandler("play",null),navigator.mediaSession.setActionHandler("pause",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null)),this.setupAirPlayControls(),this.setupChromecast(),debug("Player type: "+typeof this.playerComponent)}stylePortraitFullscreen(){let e,t;this.roomStatusNotifier.setShowMoreRoomsLink(!0),void 0===this.playerScaled?(t=(0,ve.mJ)(),e=t/(this.isWidescreen?He.qL:He.Bu)):(t=this.playerScaled.height,e=this.playerScaled.width),this.playerComponent.element.style.height=`${t}px`,this.playerComponent.element.style.width=`${e}px`,this.applyPlayerHeight(t),this.element.style.width=`${(0,ve.DK)()}px`,this.toggleMenuBar(!0)}styleLandscape(){if(this.roomStatusNotifier.setShowMoreRoomsLink(!1),this.applyPlayerHeight((0,ve.mJ)()),this.element.style.height="100%",this.element.style.width="100%",this.playerComponent.element.style.width="100%",(0,n.OF)())this.playerComponent.element.style.height="100%";else{const e=document.activeElement.tagName.toLowerCase();"input"!==e&&"textarea"!==e&&(this.playerComponent.element.style.height=`${this.element.getBoundingClientRect().height}px`)}this.toggleMenuBar(!0)}stylePortraitNonFullscreen(){this.roomStatusNotifier.setShowMoreRoomsLink(!0);const[e,t]=this.getNoneFullscreenSize();this.playerComponent.element.style.height="100%",this.playerComponent.element.style.position="static",this.applyPlayerHeight(t),e>(0,ve.DK)()||this.usingAirPlay||this.usingChromecast?(this.element.style.width="100%",this.element.style.left="0"):(this.element.style.width=`${e}px`,this.element.style.left=.5*(0,ve.DK)()-.5*e+"px"),this.usingAirPlay||this.usingChromecast?(this.element.style.height="100px",this.playerComponent.element.style.height="100px",this.playerComponent.element.style.width="100%"):this.playerComponent.element.style.width=`${e}px`,this.toggleMenuBar(!1)}repositionChildren(){(0,fe.K$)()&&this.isFullscreen?this.stylePortraitFullscreen():(0,fe.K$)()&&!this.isFullscreen?(void 0!==this.desiredPortraitHeight&&this.setPortraitHeight(this.desiredPortraitHeight),this.stylePortraitNonFullscreen()):this.styleLandscape(),(0,fe.K$)()&&!this.isFullscreen||(this.isVideoHidden&&this.centerPlayer(),this.element.style.left="0")}applyPlayerHeight(e){this.element.style.height=`${e}px`}centerPlayer(){let e;e=this.isFullscreen||void 0===this.portraitHeight?void 0===this.fullscreenHeight?(0,ve.mJ)():this.fullscreenHeight:this.portraitHeight;const t=e/(this.isWidescreen?He.qL:He.Bu);this.element.scrollLeft=t/2-(0,ve.DK)()/2}getNoneFullscreenSize(){const e=(0,ve.DK)(),t=(0,ve.mJ)();let i,s;if(this.sendMessageInputFieldHasFocus&&(0,ve.d9)()>0)[i,s]=this.getDimensionsWithinBounds(e,t-64);else if((0,fe.K$)())if(void 0!==this.portraitHeight)s=Math.min(t-this.minPortraitLeft,this.portraitHeight),i=s/(this.isWidescreen?He.qL:He.Bu);else{const n=120;i=Math.min(e,(t-n)/(this.isWidescreen?He.qL:He.Bu)),s=i*(this.isWidescreen?He.qL:He.Bu)}else[i,s]=this.getDimensionsWithinBounds(e,t);return[Math.round(i),Math.round(s)]}getDimensionsWithinBounds(e,t){let i=t/(this.isWidescreen?He.qL:He.Bu),s=t;return i>e&&(i=e,s=i*(this.isWidescreen?He.qL:He.Bu)),[i,s]}setupAirPlayControls(){void 0!==window.WebKitPlaybackTargetAvailabilityEvent?(this.videoControls.showAirPlay(),(0,u.wu)("click",this.videoControls.airPlayImg,(()=>{const e=this.playerComponent.getVideoElement();void 0===e?this.videoControls.getPlayerIsHlsPlaceholder()||this.videoControls.forceHLS():e.webkitShowPlaybackTargetPicker()})),(0,u.wu)("webkitplaybacktargetavailabilitychanged",this.playerComponent.element,(e=>{if(this.videoControls.forceHLS(),void 0!==e.availability)switch(e.availability){case"available":this.videoControls.showAirPlay();break;case"not-available":this.videoControls.hideAirPlay()}}))):this.videoControls.hideAirPlay()}setupChromecastControls(){if(this.playerComponent instanceof We.y){const e=this.playerComponent.getVideoJs();if(void 0!==e&&void 0!==e.chromecastSessionManager){const t=e.chromecastSessionManager.getCastContext();(0,u.wu)("click",this.videoControls.chromecastImg,(()=>{void 0===this.playerComponent.getVideoElement()?this.videoControls.forceHLS():e.chromecastSessionManager.openCastMenu()})),t.addEventListener("caststatechanged",(e=>{if(void 0!==e.castState)switch(e.castState){case"NOT_CONNECTED":this.videoControls.showChromecast();break;case"NO_DEVICES_AVAILABLE":this.videoControls.hideChromecast()}})),"CONNECTED"===t.getCastState()||"CONNECTING"===t.getCastState()?(this.videoControls.showChromecast(),t.getCurrentSession().endSession(!0)):"NOT_CONNECTED"===t.getCastState()?this.videoControls.showChromecast():"NO_DEVICES_AVAILABLE"===t.getCastState()&&this.videoControls.hideChromecast()}else this.videoControls.hideChromecast()}}setupChromecast(){let e=0;const t=window.setInterval((()=>{if(e>=10&&clearInterval(t),this.playerComponent instanceof We.y){const e=this.playerComponent.getVideoJs();if(void 0!==e&&void 0!==e.chromecastSessionManager){this.setupChromecastControls();const e=this.playerComponent.getVideoElement();void 0!==e&&this.bindChromecastEventsToVideo(e),clearInterval(t)}}e+=1}),1e3)}createVideoJsPlayer(){return new qe(this.roomStatusNotifier)}afterPlayerCreated(){super.afterPlayerCreated();const e=this.playerComponent.getVideoElement();void 0!==e&&this.bindAirPlayEventsToVideo(e),this.videoControls.notifyPlayerIsJPEG(this.playerComponent instanceof Oe.O)}setUsingAirPlay(e){this.usingAirPlay=e,this.videoControls.notifyUsingAirPlayChange(e)}bindAirPlayEventsToVideo(e){void 0!==window.WebKitPlaybackTargetAvailabilityEvent&&(0,u.wu)("webkitcurrentplaybacktargetiswirelesschanged",e,(()=>{e.webkitCurrentPlaybackTargetIsWireless?((0,T.bT)("Video_CastStart",{CastType:"airplay"}),this.setUsingAirPlay(!0)):((0,T.bT)("Video_CastStop",{CastType:"airplay"}),this.setUsingAirPlay(!1)),Ne.T.fire(this.usingAirPlay),this.videoControls.updateCastingStyling(this.usingAirPlay?"AirPlay":""),this.repositionChildrenRecursive(),this.centerPlayer()}))}setUsingChromecast(e){this.usingChromecast=e,this.videoControls.notifyUsingChromecastChange(e)}bindChromecastEventsToVideo(e){if(this.playerComponent instanceof We.y){const e=this.playerComponent.getVideoJs();void 0!==e&&void 0!==e.chromecastSessionManager&&e.chromecastSessionManager.getCastContext().addEventListener("sessionstatechanged",(e=>{if(void 0!==e.sessionState)switch(e.sessionState){case"SESSION_STARTED":case"SESSION_RESUMED":(0,T.bT)("Video_CastStart",{CastType:"chromecast"}),this.setUsingChromecast(!0);break;case"SESSION_ENDED":(0,T.bT)("Video_CastStop",{CastType:"chromecast"}),this.setUsingChromecast(!1)}this.videoControls.updateCastingStyling(this.usingChromecast?"Chromecast":""),this.repositionChildrenRecursive(),this.centerPlayer()}))}}bindControlsEvents(){this.videoControls.setPlayerVisibilityEvent.listen((e=>{this.setHidden(e)})),this.videoControls.centerPlayerEvent.listen((()=>{this.centerPlayer()})),this.videoControls.requestFullscreenEvent.listen((()=>{(0,G.lh)(this.element)})),this.videoControls.setPlayerComponentVolumeMutedEvents.listen((e=>{this.playerComponent.setVolumeMuted(e.volume,e.isMuted)})),this.videoControls.forceHlsPlayerEvent.listen((e=>{let{roomContext:t,unmute:i}=e;this.forceHlsPlayer(t,null==i||i)})),this.videoControls.touchControls.scalePlayerEvent.listen((e=>{let{factor:t,pointX:i}=e;this.canUpdateMobilePlayer()&&(0,fe.K$)()&&this.isFullscreen&&this.scalePlayer(t,i)})),this.videoControls.touchControls.changeVideoHeightEvent.listen((e=>{if(this.canUpdateMobilePlayer()&&(0,fe.K$)())if(this.isFullscreen){const t=1+e.distance.y/(0,ve.mJ)()*Ze.L,i=(0,ve.DK)()/2;this.scalePlayer(t,i)}else this.setDesiredPortraitHeight(e.distance.y)})),this.videoControls.touchControls.scrollPlayerEvent.listen((e=>{this.canUpdateMobilePlayer()&&!this.isVideoHidden&&(void 0!==this.element.scrollBy?this.element.scrollBy(e,0):this.element.scrollLeft+=e)})),this.videoControls.touchControls.swipePlayerEvent.listen((e=>{const t=e.totalDistance>0;switch(e.state){case je.d.Cancelled:debug("Swipe Reset");break;case 2:debug("Handle Completed Swipe",{direction:t?"Left":"Right",totalDistance:e.totalDistance});break;default:t?this.handleLeftSwipe(e):this.handleRightSwipe(e)}})),this.videoControls.playerComponentReadjustForceHlsOverlayOrderEvent.listen((e=>{this.playerComponent.element.insertBefore(e,this.playerComponent.element.firstChild),this.playerComponent.element.insertBefore(e,this.playerComponent.element.firstChild)})),this.videoControls.showJpegPlayerComponentImage.listen((()=>{this.playerComponent instanceof Oe.O&&this.playerComponent.showPlayerImage()})),this.videoControls.toggleFullscreen.listen((e=>{this.isFullscreen=e,this.toggleFullscreen.fire(e)})),this.videoControls.requestHlsPlayerPlayIfPaused.listen((()=>{this.playerComponent instanceof P.vS&&this.playerComponent.videoElement.paused&&this.playerComponent.play()}))}bindVideoEvents(){var e,t;super.bindVideoEvents(),this.playerComponent.requestControlVisibility.listen((e=>{e?this.videoControls.show():this.videoControls.hide()})),null===(e=this.playerComponent.setControlVolume)||void 0===e||e.listen((e=>{let{volume:t,save:i}=e;i?this.videoControls.updateAndSaveVolume(t):this.videoControls.updateVolume(t)})),null===(t=this.playerComponent.setControlIsMuted)||void 0===t||t.listen((e=>{let{isMuted:t,save:i}=e;i?this.videoControls.updateAndSaveIsMuted(t):this.videoControls.updateIsMuted(t)}))}toggleMenuBar(e){this.headerMenu.style.display=e?"none":""}setIsWidescreen(e){this.isWidescreen=e}setPortraitHeight(e){let t=this.portraitHeight,i=Math.min((0,ve.mJ)()-this.getOtherComponentsCombinedHeights(),Math.max(100,e));i=Math.round(i),this.portraitHeight=i,t=void 0!==t?t:this.portraitHeight,t!==i&&(this.repositionChildrenRecursive(),this.element.scrollLeft+=i-t)}getOtherComponentsCombinedHeights(){var e,t,i,s;return(null!==(e=null===(t=document.getElementById("static-header"))||void 0===t?void 0:t.offsetHeight)&&void 0!==e?e:40)+(null!==(i=null===(s=document.getElementById("tab-room-header"))||void 0===s?void 0:s.offsetHeight)&&void 0!==i?i:42)+64+this.mobileDismissibleMessages.element.offsetHeight}setDesiredPortraitHeight(e){const t=this.element.offsetHeight+e;this.desiredPortraitHeight!==t&&(this.desiredPortraitHeight=t,this.repositionChildren())}scalePlayer(e,t){const i=this.playerComponent.element.offsetWidth;let s=e*i;const n=(0,ve.mJ)()/(this.isWidescreen?He.qL:He.Bu),o=(0,ve.DK)();s=Math.max(s,o),s=Math.min(s,n),s=Math.round(s);const r=this.element.scrollLeft,a=Math.round(s*(this.isWidescreen?He.qL:He.Bu));this.element.style.width=`${s}px`,this.fullscreenHeight=a,this.applyPlayerHeight(a),this.playerComponent.element.style.width=`${s}px`,this.playerScaled={width:s,height:a},this.repositionChildrenRecursive();const l=s/i-1,h=(t+this.element.scrollLeft)*l;this.element.scrollLeft=r+h}limitPortraitHeight(e){this.minPortraitLeft=e,this.repositionChildrenRecursive()}setMessageInputFieldHasFocus(e){this.sendMessageInputFieldHasFocus=e,e&&this.videoControls.hideControls()}setHidden(e){this.isVideoHidden=e,this.repositionChildren()}canUpdateMobilePlayer(){return!this.usingAirPlay&&!this.usingChromecast&&!this.videoControls.isAnyInputFocused()}handleLeftSwipe(e){debug("Handle Left Swipe In Progress")}handleRightSwipe(e){debug("Handle Right Swipe In Progress")}}var Je=i(5169);class Ye extends S.u{constructor(e){super("ul",e)}initData(e){this.activeTab="chat"}initUI(e){const t={fontSize:"10px",fontFamily:"UbuntuBold, Arial, Helvetica, sans-serif"};this.numChatUnreadContainer=(0,Q.tT)("span",{colorClass:"numUnread",style:t}),this.numPmsUnreadContainer=(0,Q.tT)("span",{colorClass:"numUnread",style:t}),this.chatUnreadBubble=(0,Q.tT)(Xe,{unreadContainer:this.numChatUnreadContainer}),this.pmUnreadBubble=(0,Q.tT)(Xe,{unreadContainer:this.numPmsUnreadContainer}),this.headerTabs=e.tabList.getList().map((e=>({tabName:e.getTabName(),element:(0,Q.tT)(Qe,{tab:e,onClick:()=>{X.qb.fire(e.getTabName())},chatUnreadBubble:this.chatUnreadBubble,pmUnreadBubble:this.pmUnreadBubble})}))),this.element=(0,Q.tT)("ul",{id:"tab-room-header",style:{borderBottomWidth:"1px",borderBottomStyle:"solid",boxSizing:"border-box",width:"100%",height:"43px",margin:0,padding:0,overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",display:"flex"},colorClass:"Header",className:"noScrollbar"},this.headerTabs.map((e=>e.element))),e.tabList.getChatTab().getChatWindow().numUnreadChanged.listen((e=>{this.setChatUnreadBubble(e)})),e.tabList.getPrivateTab().numUnreadChanged.listen((e=>{this.setPmsUnreadBubble(e)})),this.setActiveTabStyles(this.activeTab),X.qb.listen((e=>{const t=this.headerTabs.find((t=>t.tabName===e));if(void 0===t)return void this.setActiveTab(Je.S.currentTab);const i=t.element.offsetLeft<this.element.offsetWidth/2;this.element.scrollLeft=i?0:t.element.offsetLeft,this.setActiveTab(e)}))}setChatUnreadBubble(e){e>0?(this.chatUnreadBubble.style.display="flex",e>=99?(this.numChatUnreadContainer.style.fontSize="9px",this.numChatUnreadContainer.innerText="99+"):(this.numChatUnreadContainer.style.fontSize="10px",this.numChatUnreadContainer.innerText=`${e}`)):this.chatUnreadBubble.style.display="none"}setPmsUnreadBubble(e){e>0?(this.pmUnreadBubble.style.display="flex",e>=99?(this.numPmsUnreadContainer.style.fontSize="9px",this.numPmsUnreadContainer.innerText="99+"):(this.numPmsUnreadContainer.style.fontSize="10px",this.numPmsUnreadContainer.innerText=`${e}`)):this.pmUnreadBubble.style.display="none"}setActiveTab(e){this.setInactiveTabStyles(this.activeTab),this.activeTab=e,this.setActiveTabStyles(this.activeTab)}setActiveTabStyles(e){const t=this.headerTabs.find((t=>t.tabName===e));void 0!==t&&((0,B.SA)(t.element,"inactiveTab"),(0,B.fZ)(t.element,"activeTab"),(0,$.ZM)(t.element,{borderBottomStyle:"solid",borderBottomWidth:"3px"}))}setInactiveTabStyles(e){const t=this.headerTabs.find((t=>t.tabName===e));if(void 0===t)return;const i="roomMenu"===e;(0,B.SA)(t.element,"activeTab"),(0,B.fZ)(t.element,"inactiveTab"),i&&(0,B.fZ)(t.element,"roomMenu"),(0,$.ZM)(t.element,{borderBottom:"none"})}}const Qe=e=>{const t="chat"===e.tab.getTabName(),i="tokens"===e.tab.getTabName(),s="roomMenu"===e.tab.getTabName(),n="private"===e.tab.getTabName(),o={listStyleType:"none",display:"inline-block",height:"100%",lineHeight:"42px",fontFamily:"'UbuntuBold', Arial, Helvetica, sans-serif",fontSize:"14px",boxSizing:"border-box",textAlign:"center",position:"relative",flex:1,letterSpacing:s?"1px":""},r={position:"relative",display:"flex",alignItems:"center",justifyContent:"center"};let a;if(t)a=(0,Q.tT)("span",{style:r,"data-testid":"chat-tab-default"},e.tab.getTabLabel(),e.chatUnreadBubble);else if(i)a=(0,Q.tT)("span",{"data-testid":"tokens-tab"},(0,Q.tT)("span",{style:{display:"inline-block",width:"16px",height:"16px",marginRight:"4px",position:"relative",top:"4px"},colorClass:"tipIcon"}),e.tab.getTabLabel());else if(s)a=(0,Q.tT)("span",{style:{transform:"rotate(90deg)",display:"inline-block"},"data-testid":"additional-menu-options"},e.tab.getTabLabel());else if(n)a=(0,Q.tT)("span",{style:r,"data-testid":"pm-tab-default"},e.tab.getTabLabel(),e.pmUnreadBubble);else{let t="";switch(e.tab.getTabName()){case"moreRooms":t="more-rooms-tab";break;case"bio":t="bio-tab";break;default:t=""}a=(0,Q.tT)("span",{"data-testid":t},e.tab.getTabLabel())}return(0,Q.tT)("li",{style:o,colorClass:["inactiveTab","smallPadding",s?"roomMenu":""],onClick:e.onClick},a)},Xe=e=>(0,Q.tT)("span",{style:{width:"8px",height:"8px",borderRadius:"50%",display:"none",justifyContent:"center",alignItems:"center",padding:"6px",marginLeft:"4px"},colorClass:"bubble"},e.unreadContainer);class et extends S.u{constructor(e){super("div",e)}initData(e){this.tabName=e.tabName,this.tabLabel=e.tabLabel,this.pageActionName=e.pageActionName}initUI(e){this.element=(0,Q.tT)("div",{style:{width:"100%",height:"100%",flex:"none",backgroundColor:"#FFF",boxSizing:"border-box"}})}getTabName(){return this.tabName}getTabLabel(){return this.tabLabel}getPageActionName(){return this.pageActionName}}var tt=i(3910),it=i(5330),st=i(5581);class nt extends S.u{constructor(){super(),this.offline=!1,w.X0.listen((e=>{this.username=e.dossier.room,"bio"===Je.S.currentTab&&this.load(),this.offline="offline"===e.dossier.roomStatus})),X.qb.listen((e=>{"bio"===e&&this.load()})),w.Gr.listen((()=>{this.removeAllDOMChildren(),this.loadingState=0}))}initUI(){(0,$.ZM)(this.element,{padding:"19px",boxSizing:"border-box",overflowY:"scroll"}),(0,B.fZ)(this.element,"BioContent")}load(){if(this.isLoadingOrLoaded())return;this.removeAllDOMChildren();const e=(0,Q.tT)(ot,null);this.element.appendChild(e),this.loadingState=1,(0,st.zB)(this.username).then((e=>{this.element.appendChild((0,Q.tT)(lt,{content:e,offline:this.offline})),this.loadingState=2})).catch((e=>{error("Bio Content error",e),this.element.appendChild((0,Q.tT)(rt,null)),this.loadingState=0})).finally((()=>{this.element.removeChild(e)}))}isLoadingOrLoaded(){return 1===this.loadingState||2===this.loadingState}}const ot=()=>(0,Q.tT)("div",null,`${I.R.loadingText}...`),rt=()=>(0,Q.tT)("div",null,I.R.bioUnavailableText),at=e=>{const t={fontFamily:"'UbuntuBold', Arial, Helvetica, sans-serif",display:"inline-block",fontWeight:"bold",...e.style};return(0,Q.tT)("span",{className:"BioContent__sectionTitle",style:t},e.text)},lt=e=>{var t;const{gameSelection:i,infoSection:s,socialMedias:n,photoSets:o,aboutMe:r,wishList:a,isBroadcasterOrStaff:h}=e.content,d=s.username,c=e.offline&&d!==(null===(t=l.Bm.current.loggedInUser)||void 0===t?void 0:t.username),u=s.hasFanClub;return(0,Q.tT)("div",{style:{fontSize:"14px"},"data-testid":"mobile-bio-tab-contents"},(0,Q.tT)("h2",{className:"BioContent__header",style:{fontFamily:"'UbuntuBold', Arial, Helvetica, sans-serif",margin:0,fontSize:"16px",marginBottom:"12px"}},I.R.bioAndFreeWebCamText(d)),c&&(0,Q.tT)(ht,{username:d}),null!=i&&(0,Q.tT)(dt,{gameSelection:i,username:d}),(0,Q.tT)(ct,{info:s}),n.length>0&&(0,Q.tT)(pt,{socialMedias:n,username:d}),o.length>0&&(0,Q.tT)(gt,{photosets:o,username:d,isBroadcasterOrStaff:h,hasFanClub:u}),""!==r&&(0,Q.tT)(ft,{htmlString:r,sectionTitle:I.R.aboutMeText}),""!==a&&(0,Q.tT)(ft,{htmlString:a,sectionTitle:I.R.wishListText}))},ht=e=>(0,Q.tT)("button",{className:"BioContent__sendDmButton",style:{width:"100%",fontFamily:"UbuntuMedium, Arial, Helvetica, sans-serif",fontSize:"16px",padding:"12px",textAlign:"center",borderRadius:"4px",boxSizing:"border-box",margin:"0px 0 16px 0",display:"inline-block"},onClick:()=>{(0,v.rC)(I.R.loggedInToDm)||(X.bW.fire(!0),tt.$o.fire(e.username))},"data-testid":"send-dm"},I.R.dmMenuTitle),dt=e=>{var t;return(0,Q.tT)("div",{className:"BioContent__gameInfoBar",style:{borderRadius:"3px",boxShadow:"0 3px 6px 0 rgba(90, 90, 90, 0.2), 0 6px 20px 0 rgba(90, 90, 90, 0.19)",margin:"4px 0 12px 0",padding:"4px",position:"relative"}},(0,Q.tT)("div",{style:{display:"inline-block",paddingRight:"4px"}},(0,Q.tT)("img",{style:{width:"42px",height:"42px",borderRadius:"5px",objectFit:"cover",overflow:"hidden"},src:e.gameSelection.image})),(0,Q.tT)("div",{className:"BioContent__gameName",style:{bottom:0,display:"inline-block",height:"100%",overflow:"ellipsis",paddingLeft:"4px",position:"absolute",top:0}},(0,Q.tT)("div",{style:{display:"inline-block",marginTop:"-0.5em",position:"relative",top:"50%",transform:"translateY(-50%)",verticalAlign:"middle"}},`${null!==(t=e.username)&&void 0!==t?t:"User"} is playing `,(0,Q.tT)("a",{href:e.gameSelection.gameUrl,target:"_blank",rel:"noopener"},e.gameSelection.name))))},ct=e=>{const{realName:t,followersCount:i,displayBirthday:s,displayAge:n,bodyType:o,bodyDecorations:r,sex:a,subgender:h,interestedIn:d,location:c,lastBroadcast:u,languages:p,smokeDrink:m,hasFanClub:g,isInFanClub:v,fanClubJoinUrl:f}=e.info,y=""!==d?JSON.parse(d).join(", "):"",b={width:"100%",fontFamily:"UbuntuMedium, Arial, Helvetica, sans-serif",fontSize:"16px",padding:"12px",textAlign:"center",borderRadius:"4px",boxSizing:"border-box",margin:"12px 0 16px 0",display:"inline-block"},w=l.Bm.current.isNoninteractiveUser,C=e=>(0,Q.tT)("a",{className:"BioContent__joinFanClubLink",style:b,href:f,rel:"noopener"},e.text);return(0,Q.tT)("ul",{style:{listStyleType:"none",padding:0,margin:0}},(0,Q.tT)(ut,{title:I.R.realNameText,info:t}),!isNaN(i)&&(0,Q.tT)(ut,{title:I.R.followersText,info:i}),(0,Q.tT)((()=>""===a?a:"A Couple"===a?(0,Q.tT)(ut,{title:I.R.sexTextCouple,info:a}):"Trans"===a&&""!==h?(0,Q.tT)(ut,{title:I.R.sexText,info:`${a} (${h})`}):(0,Q.tT)(ut,{title:I.R.sexText,info:a})),null),(0,Q.tT)(ut,{title:I.R.birthdayText,info:s}),!isNaN(n)&&(0,Q.tT)(ut,{title:I.R.ageText,info:n}),(0,Q.tT)(ut,{title:I.R.bodyTypeText,info:o}),(0,Q.tT)(ut,{title:I.R.bodyDecorationsText,info:r}),(0,Q.tT)(ut,{title:I.R.interstedInText,info:y}),(0,Q.tT)(ut,{title:I.R.locationText,info:c}),(0,Q.tT)(ut,{title:I.R.lastBroadcastText,info:u}),(0,Q.tT)(ut,{title:I.R.languagesText,info:p}),(0,Q.tT)(ut,{title:I.R.smokeDrinkText,info:m}),!w&&g&&!v&&(0,Q.tT)(C,{text:I.R.joinFanClub}),g&&v&&(0,Q.tT)(C,{text:I.R.inFanClub}))},ut=e=>""===e.info||void 0===e.info?"":(0,Q.tT)("li",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"}},(0,Q.tT)(at,{text:`${e.title}:`,style:{width:"50%"}}),(0,Q.tT)("span",{style:{textAlign:"right",width:"50%",overflowWrap:"break-word",wordWrap:"break-word",hyphens:"auto"}},e.info)),pt=e=>(0,Q.tT)("div",{style:{position:"relative",paddingTop:"5px",paddingBottom:"25px"}},(0,Q.tT)(at,{text:`${I.R.socialMediaText}:`}),(0,Q.tT)("div",{style:{textAlign:"center"}},e.socialMedias.slice(0,8).map((t=>(0,Q.tT)(mt,{socialMedia:t,username:e.username}))),e.socialMedias.length>8&&(0,Q.tT)("a",{className:"BioContent__showMoreLink",style:{display:"block",paddingTop:"10px",textDecoration:"none"},href:`/socials/social_media/list_popup/${e.username}/`,target:`${e.username} social media`},I.R.showMoreText))),mt=e=>{const t={textDecoration:"none",marginLeft:"5px",marginRight:"5px",marginTop:"10px",position:"relative",display:"inline-block",height:"100px",borderRadius:"3%",maxWidth:"150px",width:(0,ve.DK)()/2-40+"px"},i={backgroundColor:e.socialMedia.labelColor,position:"absolute",top:"80px",right:"8px",fontSize:"9px",borderRadius:"2px",padding:"1px 3px",lineHeight:"12px"},s=(0,Q.tT)("div",{className:"BioContent__mediaTitle",style:{maxWidth:"145px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},"data-testid":"social-media-title"},e.socialMedia.titleName);let n="";return""!==e.socialMedia.labelText&&(n=(0,Q.tT)("span",{className:"BioContent__labelText",style:i,"data-testid":"social-media-tokens-badge"},e.socialMedia.labelText)),(0,Q.tT)("a",{style:t,href:(0,m._Y)(e.socialMedia.link),target:"_self","data-testid":"social-media-item",title:e.socialMedia.titleName,onMouseEnter:()=>s.style.textDecoration="underline",onMouseLeave:()=>s.style.textDecoration="none"},(0,Q.tT)("img",{className:"BioContent__thumbnailImage",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"3%"},src:e.socialMedia.imageUrl,"data-testid":"social-media-preview"}),n,s)},gt=e=>(0,Q.tT)("div",{style:{position:"relative",paddingTop:"5px",paddingBottom:"25px"}},(0,Q.tT)(at,{text:`${I.R.photosAndVideosText}:`,style:{padding:"5px 10px 5px 0"}}),(0,Q.tT)("div",{style:{textAlign:"center"}},e.photosets.slice(0,8).map((t=>(0,Q.tT)(vt,{photoset:t,username:e.username,isBroadcasterOrStaff:e.isBroadcasterOrStaff,hasFanClub:e.hasFanClub}))),e.photosets.length>8&&(0,Q.tT)("a",{className:"BioContent__showMoreLink",style:{display:"block",paddingTop:"10px",textDecoration:"none"},href:`/photo_videos/photoset/list_popup/${e.username}/`,target:`${e.username}_photosets`},I.R.showMoreText))),vt=e=>{const t=(0,ve.DK)()/2-40,i={textDecoration:"none",margin:"10px 5px 10px 5px",position:"relative",display:"inline-block",height:"100px",maxWidth:"150px",width:`${t}px`},s={width:`${t}px`,maxWidth:"150px",height:"100px",padding:"1px",borderRadius:"3%",position:"absolute",left:"0px",top:"0px",backgroundColor:"rgba(0, 0, 0, .55)"},n={backgroundColor:e.photoset.labelColor,position:"absolute",bottom:"0",right:"0",margin:"8px",fontSize:"9px",padding:"1px 3px",lineHeight:"12px",borderRadius:"2px"},o=(0,Q.tT)("div",{className:"BioContent__mediaTitle",style:{maxWidth:"145px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},"data-testid":"title"},e.photoset.name),r=(0,Q.tT)(Q.FK,null,(0,Q.tT)("div",{style:s}),(0,Q.tT)("img",{"data-testid":"lock-icon",style:{marginLeft:"-9px",marginTop:"-9px",position:"absolute",left:"50%",top:"40%",padding:"4px",border:"none"},src:`${STATIC_URL}lock.svg`}),""!==e.photoset.labelText&&(0,Q.tT)("span",{style:n,className:"BioContent__labelText"},e.photoset.labelText)),a=(0,Q.tT)("span",{style:{position:"absolute",top:"80px",right:"8px",padding:"1px 3px",lineHeight:"12px",borderRadius:"2px",fontSize:"9px"},className:"BioContent__purchasedBadge","data-testid":"token-badge"},I.R.purchasedCAPS),l=(0,Q.tT)("img",{style:{height:"18px",position:"absolute",top:"8px",right:"32px"},src:`${STATIC_URL}no-audio.svg`}),h=(0,Q.tT)("img",{style:{height:"18px",position:"absolute",top:"8px",right:"8px"},src:`${STATIC_URL}video.svg`}),d=(0,it.HC)(e.photoset,e.hasFanClub);return(0,Q.tT)("a",{style:i,href:(0,m._Y)(`/photo_videos/photoset/detail/${e.username}/${e.photoset.id}`),target:"_blank",title:e.photoset.name,"data-testid":"photo-video-preview",onMouseEnter:()=>o.style.textDecoration="underline",onMouseLeave:()=>o.style.textDecoration="none",onClick:t=>{(0,st.WO)(e.photoset,"BioTab")}},(0,Q.tT)("img",{className:"BioContent__thumbnailImage",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"3%",display:"block"},src:e.photoset.coverUrl,"data-testid":"photo-video-preview-image"}),(!e.photoset.userCanAccess||e.isBroadcasterOrStaff&&d.labelType!==it.jC)&&r,e.photoset.userCanAccess&&e.photoset.userHasPurchased&&a,e.photoset.isVideo&&!e.photoset.videoHasSound&&!e.photoset.pendingApproval&&l,e.photoset.isVideo&&h,o)},ft=e=>{const t=(0,Q.tT)("div",null);return t.innerHTML=e.htmlString,(0,st._W)(t,t,!0,!0),(0,Q.tT)("div",null,(0,Q.tT)(at,{text:`${e.sectionTitle}:`}),(0,Q.tT)("div",{style:{width:"100%",overflow:"scroll"},onTouchStart:e=>{const t=t=>{const i=t;i.scrollWidth>i.clientWidth&&e.stopPropagation()};null!==e.target&&t(e.target),null!==e.currentTarget&&t(e.currentTarget)}},(0,Q.tT)("div",{style:{maxWidth:"800px",display:"inline-block"}},t)))};class yt extends et{constructor(){super({tabName:"bio",tabLabel:I.R.bioText,pageActionName:"BioOpened"})}initUI(){super.initUI(),this.bioContent=new nt,this.addChild(this.bioContent)}}var bt=i(8598),wt=i(20),Ct=i(478),St=i(1885),xt=i(9419),Tt=i(3971),Pt=i(3502),kt=i(7197),At=i(1243),Mt=i(9898),Rt=i(2434),It=i(8785),Et=i(4364),Lt=i(5728),Dt=i(106),Bt=i(1448);const Ut=new x.c_("otherUserInitiatedPm");class _t extends S.u{constructor(e){super("div",e),this.mediaDockHeight=0,this.sendPrivateMessageFailCallback=e=>{const t=this.orderedPMSessionKeys.currentElem,i=this.pmSessions.get(t);(0,wt.SU)()&&e.showDmLink?i.chatContents.appendMessageDiv((0,Bt.dD)(e.errorMessage,e.username)):i.chatContents.appendMessageDiv((0,ue.CM)(e.errorMessage))}}initData(e){this.newPMSessionEvent=new x.c_("newPMSession"),this.closePMSessionEvent=new x.c_("closePMSession"),this.numUnreadChanged=new x.c_("numUnreadChanged"),this.pmSessions=new Map,this.orderedPMSessionKeys=new Dt.J,this.numUnread=0,this.leavePmWindow=e.leavePmWindow}initUI(e){(0,B.fZ)(this.element,"MobilePmWindow"),(0,$.ZM)(this.element,{position:"unset",display:"flex",flexDirection:"column"}),this.backButtonContainer=this.createBackButton({onBackClick:this.leavePmWindow,onSendDmClick:()=>{var e;if((0,v.rC)(I.R.loggedInToDm))return;const t=null===(e=this.currentlyDisplayedPmSession())||void 0===e?void 0:e.user;void 0!==t&&(X.bW.fire(!0),tt.$o.fire(t))}}),this.element.appendChild(this.backButtonContainer),w.X0.listen((e=>{this.chatConnection=e.chatConnection,e.dossier.userName!==e.dossier.room&&J.E3.fire({username:e.dossier.room,focus:!1,showSupporterAlert:e.dossier.needsSupporterToPm}),e.chatConnection.event.roomNotice.listen((e=>{e.showInPrivateMessage&&this.possiblyAppendMessageDiv(new Mt._y({roomNoticeData:e,neverCollapse:!0}).element)})),e.chatConnection.event.removeMessages.listen((e=>{this.closePMSession(e.username,!0)})),this.adjustBackButtonSize(e.dossier.userChatSettings.fontSize)})),J.ME.listen((()=>{const e=this.orderedPMSessionKeys.currentElem,t=this.pmSessions.get(e);!1===t.isAllHistoryLoaded&&this.loadHistoryMessages(t).catch(k.yZ)})),U.TL.listen((e=>{this.mediaDockHeight=e?(0,U.$x)()+10:0,this.repositionChildren();const t=this.currentlyDisplayedPmSession();void 0!==t&&t.chatContents.scrollToBottom()})),R.EZ.listen((e=>{this.adjustBackButtonSize(e.fontSize)})),J.E3.listen((e=>{this.hideCurrentPMSession(),void 0===this.pmSessions.get(e.username)&&this.initializePmSession(e.username,!1,e.showSupporterAlert),e.focus&&(X.qb.fire("private"),this.definePMLinkOnClick(e.username))})),St.J9.listen((e=>{this.newPrivateMessage(e);const t=this.currentlyDisplayedPmSession();void 0!==t&&(this.addPageActions(t,e),e.otherUsername===t.user&&!t.chatContents.isScrolledUp()&&t.isActive()&&St.Si.fire(t.user))})),Et.yT.conversationRead.listen((e=>{let{username:t,isDm:i}=e;if(!i){const e=this.pmSessions.get(t);void 0!==e&&this.markSessionRead(e)}})),w.Gr.listen((()=>{this.clear(),this.resetNumUnread()}))}addPageActions(e,t){var i;let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=(null===(i=l.Bm.current.loggedInUser)||void 0===i?void 0:i.username)===t.fromUser.username,o=e.user===t.fromUser.username;e.isActive()&&!s&&!n&&o&&(0,T.bT)("PMReceivedOpen",{message_id:t.messageID})}loadHistoryMessages(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.isAllHistoryLoaded||e.isLoadingHistory)return Promise.reject();const i=e.chatContents.messageList.clientHeight,s=t?"0":e.chatContents.getEarliestMessageId();return this.setIsLoadingHistory(e,!0),(0,wt.O2)(e.user,this.chatConnection.room(),s).then((t=>{var s,n;const o=t.messages;o.length<wt.j&&(e.isAllHistoryLoaded=!0);const r=null!==(s=null===(n=Et.yT.getInstance().getConversation(e.user))||void 0===n?void 0:n.numUnread)&&void 0!==s?s:-1;o.forEach(((e,t)=>{e.isFirstHistoryUnread=t===o.length-r,this.newPrivateMessage(e,!0)})),o.length>0&&e.chatContents.setEarliestMessageId(o[0].messageID);const a=e.chatContents.messageList.clientHeight;e.chatContents.messageListWrapper.scrollTop=a-i})).catch((e=>{error(e)})).finally((()=>{this.setIsLoadingHistory(e,!1)}))}setIsLoadingHistory(e,t){e.isLoadingHistory=t,t?e.loadHistoryMessagesDOM.showLoading():e.loadHistoryMessagesDOM.hideLoading()}repositionChildren(){super.repositionChildren();const e=this.currentlyDisplayedPmSession();if(void 0===e)return;const t=this.element.offsetHeight-64-this.backButtonContainer.offsetHeight-this.mediaDockHeight;e.chatContents.setMessageListWrapperHeight(t)}initializePmSession(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=this.pmSessions.get(e);if(void 0===n){(0,x.jU)();const s=new ye({onTipRequest:e=>{X.f6.fire(e)},onToggleDebugMode:()=>{this.chatConnection.toggleAppDebugging()},onChatMessage:t=>{this.orderedPMSessionKeys.addToTop(e),(0,wt.F_)({message:t,username:e,source:"mobilePM",roomName:this.chatConnection.room(),media:this.mobileMediaDock.mobileMediaList()}).catch((e=>{this.sendPrivateMessageFailCallback(e)})),this.mobileMediaDock.isEmpty()||(this.mobileMediaDock.clear(),this.mediaDockHeight=0,this.repositionChildren()),St.Si.fire(e)}},(()=>this.isConversationShowing(e)),!0);if(n={chatContents:s,numUnread:0,user:e,loadHistoryMessagesDOM:new Lt.b3,isInitialHistoryLoaded:!1,isNewSessionNotified:!1,isAllHistoryLoaded:!1,isLoadingHistory:!1,isActive:()=>"none"!==s.element.style.display},s.scrolledToBottom.listen((()=>{this.currentlyDisplayedPmSession()===n&&St.Si.fire(e)})),this.mobileMediaDock=new U.Xt(s),s.initMediaDock(this.mobileMediaDock),this.mobileMediaDock.setRoom(this.chatConnection.room()),this.newPMSessionEvent.fire(n),this.pmSessions.set(e,n),n.chatContents.appendNoticeDiv((0,ue.CM)(I.R.privateConversationWithText(e))),n.chatContents.appendNoticeDiv((0,ue.CM)(I.R.conversationCautionMessage(c.m.siteName))),!t&&i){var o,r;const t=null!==(o=null===(r=l.Bm.current.loggedInUser)||void 0===r?void 0:r.isAgeVerified)&&void 0!==o&&o;n.chatContents.appendMessageDiv((0,ue.YC)(e,t))}else n.chatContents.appendNoticeDiv(n.loadHistoryMessagesDOM.getElement());n.chatContents.element.style.display="none",this.addChild(n.chatContents)}return s||!t||n.isNewSessionNotified||(n.isNewSessionNotified=!0,Ut.fire({username:e,PMChatLink:new Ct.Ni({onClick:()=>{J.E3.fire({username:e,focus:!0,showSupporterAlert:!1})},conversationType:wt.Cr.PM})})),this.repositionChildren(),n}isConversationShowing(e){const t=this.getSession(e);return void 0!==t&&t.isActive()}definePMLinkOnClick(e){this.hideCurrentPMSession(),this.orderedPMSessionKeys.makeCurrent(e),this.showCurrentPMSession()}newPrivateMessage(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.chatConnection.isBroadcasting)return;this.appendMessageDiv((0,ue.j7)(e),e,t,!1);const i=(0,Bt.bB)(e);void 0!==i&&this.appendMessageDiv(i,e,t,!0),this.maybeIncrementUnreadForPm(e,t)}maybeIncrementUnreadForPm(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.fromUser.username===(null===(t=l.Bm.current.loggedInUser)||void 0===t?void 0:t.username)||i||!0===e.isPrivateShowMessage&&"chat"===Je.S.currentTab)return;const s=this.pmSessions.get(e.otherUsername);!s||this.orderedPMSessionKeys.currentElem===e.otherUsername&&s.isActive()||(s.numUnread+=1,this.incrementUnread())}incrementUnread(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e<=0||(this.numUnread+=e,this.numUnreadChanged.fire(this.numUnread))}decrementUnread(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e<=0||(this.numUnread-=e,this.numUnreadChanged.fire(this.numUnread))}resetNumUnread(){this.numUnread=0,this.numUnreadChanged.fire(this.numUnread)}markSessionRead(e){e.numUnread>0&&(this.decrementUnread(e.numUnread),e.numUnread=0),w.Zm.fire(e.user),St.Si.fire(e.user)}afterListItemRemoved(e){const t=this.pmSessions.get(e);void 0!==t&&(this.decrementUnread(t.numUnread),t.numUnread=0)}appendMessageDiv(e,t,i,s){var n;this.orderedPMSessionKeys.addToTop(t.otherUsername);const o=this.initializePmSession(t.otherUsername,t.fromUser.username!==this.chatConnection.username(),!1,i);i&&!1===o.isInitialHistoryLoaded&&(o.isInitialHistoryLoaded=!0);const r=(null===(n=l.Bm.current.loggedInUser)||void 0===n?void 0:n.username)===t.fromUser.username;o.isInitialHistoryLoaded&&o.chatContents.appendMessageDiv(e,!i&&!s&&!r,t.isFirstHistoryUnread)}possiblyAppendMessageDiv(e){const t=this.currentlyDisplayedPmSession();void 0!==t&&t.isActive()&&t.chatContents.appendMessageDiv(e)}getNumSessions(){return this.pmSessions.size}currentlyDisplayedPmSession(){if(void 0!==this.orderedPMSessionKeys.currentElem)return this.pmSessions.get(this.orderedPMSessionKeys.currentElem)}showNextPMSession(){return this.hideCurrentPMSession(),void 0!==this.orderedPMSessionKeys.nextElem()&&(this.showCurrentPMSession(),!0)}closePMSession(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.pmSessions.get(e);if(void 0===i)return;this.closePMSessionEvent.fire(i);const s=this.orderedPMSessionKeys.currentElem===e;this.orderedPMSessionKeys.remove(e),this.removeChild(i.chatContents),i.chatContents.dispose(),this.pmSessions.delete(e),s&&t&&(this.showNextPMSession()||this.leavePmWindow()),this.decrementUnread(i.numUnread),(0,x.Rj)()}showCurrentPMSession(){if(void 0===this.orderedPMSessionKeys.currentElem)return void error("no currentpmsession");const e=this.orderedPMSessionKeys.currentElem,t=this.pmSessions.get(e);void 0!==t?(t.isInitialHistoryLoaded||this.loadHistoryMessages(t,!0).then((()=>{void 0!==t&&this.markSessionRead(t),t.isInitialHistoryLoaded=!0})).catch(k.yZ),t.chatContents.showElement(),this.sendDmButton.textContent=I.R.sendDmToUser(t.user),this.repositionChildrenRecursive(),t.chatContents.scrollToBottom(),t.isInitialHistoryLoaded&&this.markSessionRead(t)):error("PmWindow.showCurrentPMSession - no pm session")}hideCurrentPMSession(){const e=this.currentlyDisplayedPmSession();void 0!==e&&(e.chatContents.element.style.display="none")}getSession(e){return this.pmSessions.get(e)}getOrCreateSession(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(""!==e)return null!==(t=this.pmSessions.get(e))&&void 0!==t?t:this.initializePmSession(e,i,s,n);error("Trying to create PM session for invalid username")}clear(){for(const e of this.pmSessions.keys())this.closePMSession(e)}adjustBackButtonSize(e){this.backButtonContainer.style.fontSize=e}createBackButton(e){const t=document.createElement("div");(0,B.fZ)(t,"MobilePmWindow__backButtonContainer"),(0,$.ZM)(t,{padding:"12px",fontSize:"9pt",fontFamily:"Tahoma, Arial, Helvetica, sans-serif",boxSizing:"border-box",display:"flex",gap:"16px"});const i=document.createElement("span");return(0,B.fZ)(i,"MobilePmWindow__backButton"),(0,$.ZM)(i,{display:"inline-block",flex:1}),i.onclick=e.onBackClick,i.innerText=I.R.back,t.appendChild(i),this.sendDmButton=document.createElement("span"),(0,B.fZ)(this.sendDmButton,"MobilePmWindow__sendDmButton"),(0,$.ZM)(this.sendDmButton,{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),this.sendDmButton.onclick=e.onSendDmClick,t.appendChild(this.sendDmButton),t}}const Ft=e=>{const t=new he;return(0,Q.tT)("div",{colorClass:"PrivateContainer",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px"},"data-testid":"private-spy-notice"},e.privateShowInfo.element,t.element)};var Nt=i(8638),Ot=i(6440);class Ht extends S.u{constructor(){super(),this.premiumPrivateActive=!1,this.premiumRequested=!1;const e=new x.gt;w.X0.listen((t=>{const{allowPrivateShow:i,privatePrice:s,spyPrice:n,privateMinMinutes:o,allowShowRecordings:r,roomStatus:a,isAgeVerified:l,hasFanClub:h,activePassword:d,premiumPrivatePrice:c,premiumPrivateMinMinutes:u,fanClubSpyPrice:p}=t.dossier;this.updateData({allowPrivateShow:i,privatePrice:s,spyPrice:n,privateMinMinutes:o,allowShowRecordings:r,hasFanClub:h,activePassword:d,premiumPrivatePrice:c,premiumPrivateMinMinutes:u,fanClubSpyPrice:p},a,l),this.premiumPrivateActive=t.chatConnection.premiumShowActive,t.chatConnection.event.settingsUpdate.listen((e=>{"privaterequesting"===this.currentStatus&&this.privateShowSettingsChanged(e)?this.pendingSettingsUpdate=e:this.updateData(e,this.currentStatus,this.isAgeVerified)})).addTo(e),t.chatConnection.event.statusChange.listen((e=>{let{previousStatus:i,currentStatus:s}=e,n=this.roomSettings;i!==s&&("privatewatching"===i?this.privateContext=void 0:"privatespying"===i?this.spyContext=void 0:"privaterequesting"===i&&void 0!==this.pendingSettingsUpdate&&(n=this.pendingSettingsUpdate,this.pendingSettingsUpdate=void 0),"privaterequesting"===s&&(0,Ot.f)("PremPrivShow")&&(this.premiumRequested=t.chatConnection.premiumRequested)),this.premiumPrivateActive=t.chatConnection.premiumShowActive,this.updateData(n,s,this.isAgeVerified)})).addTo(e)})),w.Gr.listen((()=>{e.removeAll(),this.privateContext=void 0,this.spyContext=void 0}))}initData(){this.roomSettings={allowPrivateShow:!1,privateMinMinutes:0,privatePrice:0,spyPrice:0,allowShowRecordings:!1,hasFanClub:!1,activePassword:!1,premiumPrivatePrice:0,premiumPrivateMinMinutes:0,fanClubSpyPrice:0},this.currentStatus="offline",this.isAgeVerified=!1,this.privateContext=void 0,this.spyContext=void 0}initUI(){this.element=(0,Q.tT)("div",{colorClass:"PrivateShowInfo",style:{fontSize:"12px",lineHeight:"16px"}}),this.render()}updateData(e,t,i){this.roomSettings=e,this.currentStatus=t,this.isAgeVerified=i,this.render()}privateShowSettingsChanged(e){return!(!(0,Ot.f)("PremPrivShow")||this.roomSettings.premiumPrivatePrice===e.premiumPrivatePrice&&this.roomSettings.premiumPrivateMinMinutes===e.premiumPrivateMinMinutes)||this.roomSettings.allowPrivateShow!==e.allowPrivateShow||this.roomSettings.allowShowRecordings!==e.allowShowRecordings||this.roomSettings.privateMinMinutes!==e.privateMinMinutes||this.roomSettings.privatePrice!==e.privatePrice}render(){const e="privatewatching"===this.currentStatus,t="privatespying"===this.currentStatus,i=l.Aw.getState().isInFanClub;if(!(e||t||this.roomSettings.allowPrivateShow&&this.isAgeVerified))return this.renderElementContents((0,Q.tT)(Gt,null)),this.element;var s;if("privatenotwatching"===this.currentStatus)this.renderElementContents((0,Q.tT)(qt,{spyPrice:this.roomSettings.spyPrice,roomStatus:this.currentStatus,premiumPrivateActive:this.premiumPrivateActive,isInFanClub:i,fanSpyPrice:null!==(s=this.roomSettings.fanClubSpyPrice)&&void 0!==s?s:this.roomSettings.spyPrice,onIndicatorLoad:()=>this.didRepositionEvent.fire(void 0)}));else if(e){const e=e=>{this.renderElementContents((0,Q.tT)(zt,{privatePrice:e.privatePrice,privateMinMinutes:e.privateMinMinutes,allowShowRecordings:e.allowShowRecordings,roomStatus:this.currentStatus,onIndicatorLoad:()=>this.didRepositionEvent.fire(void 0)}))};void 0!==this.privateContext?e(this.privateContext):(0,Y.S1)(l.Aw.getState().room).then((t=>{this.privateContext=t,e(this.privateContext)})).catch((()=>{e(this.roomSettings)}))}else if(t){const e=e=>{this.renderElementContents((0,Q.tT)(qt,{spyPrice:e.spyPrice,roomStatus:this.currentStatus,premiumPrivateActive:this.premiumPrivateActive,isInFanClub:i,fanSpyPrice:e.spyPrice,onIndicatorLoad:()=>this.didRepositionEvent.fire(void 0)}))};void 0!==this.spyContext?e(this.spyContext):(0,Y.DZ)(l.Aw.getState().room).then((t=>{this.spyContext=t,e(this.spyContext)})).catch((()=>{e(this.roomSettings)}))}else{const e=this.premiumRequested?this.roomSettings.premiumPrivatePrice:this.roomSettings.privatePrice,t=this.premiumRequested?this.roomSettings.premiumPrivateMinMinutes:this.roomSettings.privateMinMinutes;this.renderElementContents((0,Q.tT)(zt,{privatePrice:e,privateMinMinutes:t,allowShowRecordings:this.roomSettings.allowShowRecordings,roomStatus:this.currentStatus,onIndicatorLoad:()=>this.didRepositionEvent.fire(void 0)}))}return this.element}renderElementContents(e){this.removeAllDOMChildren(),this.element.appendChild(e),this.didRepositionEvent.fire(void 0)}}const Wt=e=>{const t={lineHeight:"24px",display:"block",...e.styles};return(0,Q.tT)("span",{colorClass:"title",style:t},e.text)},$t=e=>{const t={display:"flex",alignItems:"center"},i={marginRight:"8px"},s="privaterequesting"===e.roomStatus,n="privatewatching"===e.roomStatus,o="privatespying"===e.roomStatus;return s?(0,Q.tT)("div",{style:t},(0,Q.tT)("img",{src:`${STATIC_URL_MOBILE}waiting-indicator.svg`,style:i,onLoad:e.onLoad}),(0,Q.tT)("span",{colorClass:"waitingText"},`${I.R.waitingToConnect}...`)):n||o?(0,Q.tT)("div",{style:t},(0,Q.tT)("img",{src:`${STATIC_URL_MOBILE}connected-indicator.svg`,style:i,onLoad:e.onLoad}),(0,Q.tT)("span",{colorClass:"connectedText"},n?I.R.started:I.R.spyingNow)):(0,Q.tT)("div",{style:{display:"none"}})},Vt=e=>(0,Q.tT)("div",{style:{display:"flex",alignItems:"center",marginBottom:"4px"}},(0,Q.tT)(Wt,{text:e.titleText,styles:{marginRight:"8px"}}),(0,Q.tT)($t,{roomStatus:e.roomStatus,onLoad:e.onIndicatorLoad})),zt=e=>(0,Q.tT)("div",{style:{marginRight:"4px"}},(0,Q.tT)(Vt,{titleText:I.R.privateShowText,roomStatus:e.roomStatus,onIndicatorLoad:e.onIndicatorLoad}),(0,Q.tT)("div",null,(0,Q.tT)("span",null,`${I.R.priceTokensPerMinuteMessage(e.privatePrice,!0)}, `),(0,Q.tT)("span",null,`${I.R.privateShowMinimumMinuteMessage(e.privateMinMinutes,!0)}.`)),e.allowShowRecordings?(0,Q.tT)("span",null,I.R.youWillReceiveRecording):(0,Q.tT)("span",null,I.R.broadcasterDisabledRecordings)),Gt=()=>(0,Q.tT)("div",null,(0,Q.tT)(Wt,{text:I.R.privateShowText}),(0,Q.tT)("span",null,I.R.privatesNotAvailable)),qt=e=>{const t=e.premiumPrivateActive?I.R.premiumInProgressMessage:I.R.privateShowSpyLabel,i=e.spyPrice<=0&&"privatespying"!==e.roomStatus;let s=(0,Ot.f)("LinguiBasic")?Nt.i._({id:"hLP8CN",message:"Spy Show cost"}):I.R.spyShowCost,n=(0,Ot.f)("LinguiBasic")?`${e.spyPrice} tokens/min`:I.R.priceTokensPerMinuteMessage(e.spyPrice,!0);return e.isInFanClub&&(s=Nt.i._({id:"u8Yda8",message:"Fan Spy Show cost"}),n=0===e.fanSpyPrice?Nt.i._({id:"WIGxF/",message:"Spying is free for fan club members."}):(0,Ot.f)("LinguiBasic")?`${e.fanSpyPrice} tokens/min`:I.R.priceTokensPerMinuteMessage(e.fanSpyPrice,!0)),(0,Q.tT)("div",null,(0,Q.tT)(Vt,{titleText:t,roomStatus:e.roomStatus,onIndicatorLoad:e.onIndicatorLoad}),!e.premiumPrivateActive&&!i&&(0,Q.tT)("span",null,`${s}: ${n}`),!e.premiumPrivateActive&&i&&(0,Q.tT)("span",null,I.R.privateShowSpyDisabled),e.premiumPrivateActive&&(0,Q.tT)("span",null,I.R.premiumShowDesc))};class jt extends S.u{constructor(){super(),this.initNoticeDeclutterer();const e=new x.gt;if(w.X0.listen((t=>{this.chatConnection=t.chatConnection,this.chatContents.appendMessageDiv((0,ue.CM)(I.R.viewerWelcomeWarning),!1),this.chatContents.appendMessageDiv((0,ue.CM)(I.R.mobileWelcomeMessage),!1),(0,q.LQ)(t.dossier.room,t.dossier.roomUid,t.dossier.appsRunning,"mobile").then((e=>{this.chatContents.appendMessageDiv(e,!1)})).catch(k.yZ),t.chatConnection.event.roomShortcode.listen((e=>{const t=(0,ue.j8)(e);this.chatContents.appendMessageDiv(t)})).addTo(e),t.chatConnection.event.roomMessage.listen((e=>{xt.k.getInstance().addRecentUser(e.fromUser),this.chatContents.appendMessageDiv((0,ue.j7)(e)),this.incrementUnread()})).addTo(e),t.chatConnection.event.roomNotice.listen((e=>{this.newRoomNotice(e)})).addTo(e),t.chatConnection.event.removeMessages.listen((e=>{this.chatContents.handleRemoveMessages(e.username)})).addTo(e),t.chatConnection.event.appDebugLog.listen((e=>{t.chatConnection.isAppDebuggingEnabled()&&this.chatContents.appendMessageDiv((0,ue.CM)(`DEBUG: ${e}`))})).addTo(e),this.togglePrivateOverlay(),this.togglePrivateContainer(),t.chatConnection.event.statusChange.listen((()=>{this.togglePrivateOverlay(),this.togglePrivateContainer()})).addTo(e),t.chatConnection.event.onBanSilence.listen((e=>{this.handleBanSilence(e,t)})).addTo(e),this.conversationNotifier=new kt.e(this.chatConnection),l.Bm.current.mergePmDm&&St.H4.listen((e=>{var t;if(!0===(null===(t=this.conversationNotifier)||void 0===t?void 0:t.shouldNotify(e.fromUser.username))){const t=this.conversationNotifier.createChatLinkMessage(e.fromUser.username);this.chatContents.appendMessageDiv(t),this.conversationNotifier.preventNotifications(e.otherUsername)}})).addTo(e)})),this.privateShowInfo.didRepositionEvent.listen((()=>{this.repositionChildren(!0)})),new Tt._({appendMessageDiv:e=>this.chatContents.appendMessageDiv(e),removeMessageDiv:e=>{this.chatContents.removeMessageDiv(e)},getLastMessageId:()=>this.chatContents.getLastMessageId(),messagesSinceId:e=>this.chatContents.messagesSinceId(e),getMessagesScrollTop:()=>this.chatContents.messageListWrapper.scrollTop,getMessagesOffsetHeight:()=>this.chatContents.element.offsetHeight}),J.Ch.listen((e=>{this.chatContents.customInputField.appendText(` @${e} `),"chat"!==Je.S.currentTab&&X.qb.fire("chat")})),J.q_.listen((e=>{e?this.chatContents.appendMessageDiv((0,ue.CM)("Debug mode enabled. Type /debug again to disable.")):this.chatContents.appendMessageDiv((0,ue.CM)("Debug mode disabled."))})),!l.Bm.current.mergePmDm){const e=new At.k;(0,wt.SU)()&&St.H4.listen((t=>{if(e.shouldNotify(t.fromUser.username)){const i=I.R.newDirectMessageNotice(t.otherUsername),s=new Ct.Ni({onClick:()=>{(0,fe.K$)()&&X.bW.fire(!0),tt.$o.fire(t.otherUsername)},conversationType:wt.Cr.DM}),n=(0,ue.r_)(i,s.openConversationElement);this.chatContents.appendMessageDiv(n),e.preventNotifications(t.otherUsername)}}))}l.Bm.current.mergePmDm||Ut.listen((e=>{var t;!0===(null===(t=this.conversationNotifier)||void 0===t?void 0:t.shouldNotify(e.username))&&(this.newPmChatLink(e),this.conversationNotifier.preventNotifications(e.username))})),X.qb.listen((e=>{"chat"===Je.S.currentTab&&"chat"!==e&&this.chatContents.clearScrollButtonUnread(),"chat"===e&&(this.resetNumUnread(),this.maybeMarkPrivateShowPmsRead(e))})),me.R.listen((e=>{e&&(this.resetNumUnread(),this.maybeMarkPrivateShowPmsRead(void 0,e))})),w.Gr.listen((()=>{var t;this.chatContents.clear(),this.resetNumUnread(),e.removeAll(),null===(t=this.conversationNotifier)||void 0===t||t.dispose(),this.roomNoticeDeclutterer.onRoomCleanup()}))}initData(){this.numUnreadChanged=new x.c_("numUnreadChanged"),this.numUnread=0}initUI(){this.privateShowInfo=new Ht,this.privateContainer=(0,Q.tT)(Ft,{privateShowInfo:this.privateShowInfo}),this.element.appendChild(this.privateContainer);const e={onTipRequest:e=>{X.f6.fire(e)},onToggleDebugMode:()=>{this.chatConnection.toggleAppDebugging()},onChatMessage:e=>{if(this.chatConnection.inPrivateRoom()){const t={message:e,username:this.chatConnection.isBroadcasting?this.chatConnection.getPrivateShowUser():this.chatConnection.room(),media:void 0,source:"roomviewPM",roomName:this.chatConnection.room()};(0,wt.F_)(t).catch((e=>{this.chatContents.appendMessageDiv((0,ue.CM)(e.errorMessage))}))}else this.chatConnection.sendRoomMessage(e)},onShortcode:e=>{this.chatConnection.sendShortcode(e)}};this.chatContents=this.addChild(new ye(e,(()=>this.isConversationShowing())))}isConversationShowing(){return"chat"===Je.S.currentTab||""!==l.Aw.getState().privateShowId}initNoticeDeclutterer(){this.roomNoticeDeclutterer=new Rt.z({appendNotice:(e,t)=>this.chatContents.appendNoticeMessage(e,t),appendSentinelDiv:e=>this.chatContents.element.appendChild(e)})}newPmChatLink(e){const t=I.R.mobileNewPrivateMessageNotice(e.username),i=(0,ue.r_)(t,e.PMChatLink.openConversationElement);this.chatContents.appendMessageDiv(i)}newRoomNotice(e){const t=new Mt._y({roomNoticeData:e,isChatScrolledToBottom:()=>!this.chatContents.isScrolledUp(),scrollChatToBottom:()=>this.chatContents.debouncedScrollToBottom(),getChatScrollTop:()=>this.chatContents.getScrollTop(),setChatScrollTop:e=>this.chatContents.setScrollTop(e)});this.roomNoticeDeclutterer.addRoomNotice(t)}incrementUnread(){this.isConversationShowing()||(this.numUnread+=1,this.numUnreadChanged.fire(this.numUnread))}resetNumUnread(){this.numUnread=0,this.numUnreadChanged.fire(this.numUnread)}maybeMarkPrivateShowPmsRead(){("chat"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Je.S.currentTab)||arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&this.chatConnection.inPrivateRoom()&&St.Si.fire((0,It.b5)()?this.chatConnection.getPrivateShowUser():this.chatConnection.room())}togglePrivateOverlay(){if(this.chatConnection.inPrivateRoom()){const e=()=>{J.E3.fire({username:this.chatConnection.getPrivateShowUser(),focus:!0,showSupporterAlert:!1})};this.chatConnection.isBroadcasting&&e(),this.chatContents.showPrivateOverlay(this.chatConnection.getPrivateShowUser(),(()=>{this.chatConnection.isBroadcasting?e():X.qb.fire("private")}))}else this.chatContents.hidePrivateOverlay()}togglePrivateContainer(){["privatenotwatching","privatespying"].includes(this.chatConnection.status)?this.privateContainer.style.display="flex":this.privateContainer.style.display="none",this.repositionChildren(!0)}async handleBanSilence(e,t){if(t.dossier.userName===t.dossier.room||e.silencer===t.dossier.userName){const i=await(0,bt.t)({bannedUser:e.silenced,createdBy:e.silencer,isSilence:!e.isBan,roomUser:t.dossier.room}),s=e=>{this.showLogMsg(e)},n=(0,Pt.d)(this.chatContents,e,i,t,s);this.chatContents.appendMessageDiv(n)}}showLogMsg(e){this.chatContents.appendMessageDiv((0,ue.CM)(e))}repositionChildren(e){const t=this.element.offsetHeight-64-this.privateContainer.offsetHeight;this.chatContents.setMessageListWrapperHeight(t,e)}getPrivateContainerHeight(){return this.privateContainer.offsetHeight}}class Zt extends et{constructor(){super({tabName:"chat",tabLabel:I.R.chatCapitalized,pageActionName:"ChatOpened"})}initUI(){super.initUI(),this.chatWindow=new jt,this.addChild(this.chatWindow)}getChatContents(){return this.chatWindow.chatContents}getChatWindow(){return this.chatWindow}}var Kt,Jt=i(82),Yt=i(6009),Qt=i(7321),Xt=i(5088);class ei extends Jt.b{constructor(e){super(e),this.roomIterator=new Yt.t(10),this.visible=!1,this.disableRemovalOnScroll=e.disableRemovalOnScroll,this.loadingDiv=this.createLoadingDiv(),Xt.M2&&(0,u.wu)("pageshow",window,(e=>{e.persisted&&Qt.HA.getInstance().safariReloadAllImages()}))}initData(e){if(super.initData(e),this.selectedGenders=[],(0,n.Pf)()){const e=window.localStorage.getItem(ei.localStorageGenderKey);null!==e&&(this.selectedGenders=JSON.parse(e))}this.genderCheckboxes=[],this.isLoadingRooms=!1}createElement(e){return(0,Q.tT)("div",{style:{fontSize:"12px",overflowY:"scroll"}})}appendRoomsToDiv(e){this.handleLoadingDivRemoval(),this.moreRoomsList.appendRooms(e)}handleLoadingDivRemoval(){this.moreRoomsList.element.contains(this.loadingDiv)&&this.moreRoomsList.element.removeChild(this.loadingDiv)}appendLoadingDiv(){this.isLoadingRooms=!0,this.moreRoomsList.element.appendChild(this.loadingDiv)}handleGenderChange(){this.updateSelectedGendersFromCheckboxes(),(0,T.bT)("ChangeRoomListGender",{selectedGenders:this.selectedGenders.toString()}),(0,n.Pf)()&&(0===this.selectedGenders.length?window.localStorage.removeItem(ei.localStorageGenderKey):window.localStorage.setItem(ei.localStorageGenderKey,JSON.stringify(this.selectedGenders))),this.resetAndLoad()}children(){return this.moreRoomsList.rooms}resetAndLoad(){for(const e of this.children())e.stopStreaming();this.appendLoadingDiv(),this.repositionChildren(),this.loadFromNewIterator()}loadFromNewIterator(){this.roomIterator.setGenders(this.selectedGenders),this.appendLoadingDiv(),this.moreRoomsList.setState({roomInfoList:[]}),this.roomIterator.next().then((e=>{this.moreRoomsList.setState({roomInfoList:e}),this.repositionChildrenRecursive(),this.handleLoadingDivRemoval(),this.isLoadingRooms=!1})).catch((e=>{this.isLoadingRooms=!1,error("getNewIterator",e)}))}loadFromCurrentIterator(){this.isLoadingRooms||(this.appendLoadingDiv(),this.roomIterator.next().then((e=>{this.insertLoadedRooms(e)})).catch((e=>{this.isLoadingRooms=!1,error("loadMoreRooms",e)})))}insertLoadedRooms(e){e.length>0?(this.finishInsertLoadedRooms(e),this.isLoadingRooms=!1,this.repositionChildrenRecursive(),this.loadMoreRoomsIfNearBottom(),this.latestEmptyFetch=void 0):(this.isLoadingRooms=!1,this.handleLoadingDivRemoval(),this.latestEmptyFetch=performance.now())}finishInsertLoadedRooms(e){this.removeRoomsScrolledPastTop(),this.appendRoomsToDiv(e)}removeRoomsScrolledPastTop(){if(void 0!==this.getScrolledElement()&&!this.disableRemovalOnScroll){const e=[];if(this.getScrolledElement().scrollTop>this.calculateScrollRemovalThreshold(15))for(const t of this.moreRoomsList.rooms){if(!(t.element.offsetTop<this.calculateScrollRemovalThreshold(10)))break;e.push(t.getRoomName())}const t=this.moreRoomsList.getRoomInfoList().filter((t=>!e.includes(t.room))),i=this.moreRoomsList.getRoomInfoList().length-t.length;if(i>0){const e=this.moreRoomsList.element.scrollTop;this.moreRoomsList.spliceRooms(0,i),this.moreRoomsList.element.scrollTop=e-this.calculateScrollRemovalThreshold(i,!1),this.visible&&this.loadMoreRoomsIfNearBottom()}}}loadMoreRoomsIfNearBottom(){if(void 0!==this.latestEmptyFetch){if(performance.now()-this.latestEmptyFetch<3e3)return;this.latestEmptyFetch=void 0}this.getScrolledElement().scrollTop+this.getScrolledElement().offsetHeight+this.calculateScrollRemovalThreshold(5)>=this.getScrolledElement().scrollHeight&&this.loadFromCurrentIterator()}}(Kt=ei).genderOptions=[["Female",I.R.womenText],["Male",I.R.menText],["Couple",I.R.couplesText],["Trans",I.R.transText]],Kt.localStorageGenderKey="genders";var ti=i(8374);class ii extends ti.y{constructor(){super({roomListSource:"mr",animate:!0,showLocation:!0,rooms:()=>this.state.roomInfoList}),this.roomIndex=0}createElement(){return(0,Q.tT)("ul",{className:"list",style:ii.ulStyle})}updateState(){super.updateState(),this.roomIndex=this.rooms.length}getRoomInfoList(){return this.state.roomInfoList}appendRooms(e){this.state.roomInfoList.push(...e);for(const t of e)super.appendRoomCard(this.roomIndex+=1,t)}spliceRooms(e,t){this.state.roomInfoList.splice(e,t);const i=this.rooms.splice(e,t);for(const e of i)this.removeChild(e)}}ii.ulStyle={overflowY:"visible",fontSize:"12px",height:"auto",listStyle:"none",margin:0,padding:0};var si=i(7882),ni=i(7596),oi=i(4801),ri=i(836),ai=i(5079);class li extends ai.kb{constructor(e){super(e)}initData(e){super.initData(e),this.roomName=e.roomInfo.room}afterRemovedFromParent(){this.stopStreaming(),super.afterRemovedFromParent()}stopStreaming(){(0,Qt.Hy)(this.roomName,!0)}startStreaming(){(0,Qt.DL)(this.roomName,this.img,!0,!0)}}var hi=i(8451);class di extends li{initData(e){super.initData(e),this.roomInfo=e.roomInfo,this.roomIndex=e.roomIndex}createElement(e){return this.img=(0,Q.tT)(ui,{showLocation:void 0!==e.roomInfo.location,imgUrl:e.roomInfo.img}),(0,hi.HK)((0,Q.tT)("li",{style:{position:"relative",width:"auto",height:"auto",overflow:"hidden",display:"block",marginBottom:"4px",borderRadius:"8px",borderWidth:"1px",borderStyle:"solid"},colorClass:"MobileMoreRoomsCard","data-testid":"room-card",onClick:e=>this.fireRoomClick(e)}))}initUI(e){super.initUI(e),this.followStar=new ni.d({slug:e.roomInfo.room,isFollowing:e.roomInfo.isFollowing}),(0,$.ZM)(this.followStar.element,{width:"",height:""}),this.element.appendChild((0,Q.tT)(ci,{roomInfo:this.roomInfo,roomIndex:this.roomIndex,roomImage:this.img,followStar:this.followStar}))}setImageStreamer(){}stopStreaming(){(0,Qt.Hy)(this.roomName,!1)}startStreaming(){(0,Qt.DL)(this.roomName,this.img,!0,!1)}getLocation(){return this.roomInfo.location}}const ci=e=>{const{room:t,label:i,sourceInfo:s}=e.roomInfo,n=(0,ri.p5)(s),o=n?(0,ri.$F)(s,i):i,r=(0,Q.tT)(gi,{roomLabel:o});return(0,Q.tT)("a",{href:(0,m._Y)(`/${t}/`),"data-testid":"room-card","data-room-nav":"true",onClick:e=>e.preventDefault()},e.roomImage,(0,Q.tT)(mi,{roomInfo:e.roomInfo}),e.followStar.element,n&&r)},ui=e=>(0,Q.tT)("img",{src:e.imgUrl,colorClass:"roomImage",className:"moreRooms",style:{width:"100%",height:"calc(100% - 33px)",cursor:"pointer",display:"block",objectFit:"fill"},"data-room-nav":"true"}),pi=e=>(0,Q.tT)("div",{style:void 0!==e.style?e.style:{position:"absolute",width:"100%",textAlign:"center",bottom:"12px",fontSize:"15px"},"data-room":e.roomName,"data-room-nav":"true","data-testid":"room-card-username"},e.roomName),mi=e=>{const{room:t,displayAge:i,gender:s,countryCode:n,countryName:o}=e.roomInfo,r={display:"flex",alignItems:"center",justifyContent:void 0!==i?"space-between":"flex-end",width:""};return(0,Q.tT)("div",{style:{display:"flex",justifyContent:"space-between",padding:"7px 8px",position:"absolute",bottom:0,boxSizing:"border-box",width:"100%",fontSize:"16px",fontFamily:"'UbuntuBold', Arial, Helvetica, sans-serif",maxHeight:"33px"},colorClass:"roomInfo"},(0,Q.tT)(pi,{style:{maxWidth:"calc(100% - 45px)",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},roomName:t}),(0,Q.tT)("div",{style:r},void 0!==i&&(0,Q.tT)("span",{colorClass:"age","data-testid":"room-card-age"},i),(0,Q.tT)("img",{style:{verticalAlign:"middle",cursor:"pointer",width:"16px",height:"16px"},"data-testid":"room-card-gender",src:(0,It.e0)(s)}),n&&(0,Q.tT)("span",{"data-testid":"room-card-thumbnail-flag"},(0,Q.tT)(oi.T,{component:"FlagIcon",componentProps:{countryCode:n,countryName:o,style:{cursor:"pointer",borderRadius:"4px",paddingLeft:"4px"},"data-testid":"mobile-room-card-country"}}))))},gi=e=>(0,Q.tT)("div",{style:{position:"absolute",width:"100%",textAlign:"center",top:"12px",color:"#FFF",fontSize:"12px",textShadow:"1px 1px 1px #000, -1px -1px 1px #000, 1px -1px 1px #000, -1px 1px 1px #000",pointerEvents:"none"},className:"thumbnail_label_recommender"},(0,ri.Iq)(e.roomLabel));class vi extends ii{createRoomCard(e){return new di(e)}createElement(){return(0,Q.tT)("ul",{className:"MobileMoreRoomsList"})}}class fi extends ei{constructor(e){super(e),this.streamVisibleRoomsDebouncer=new C.a((()=>{this.streamVisibleRooms()}),{bounceLimitMS:200}),this.hasInitialLoaded=!1,be.im.listen((e=>{const t=this.children().find((t=>t.getRoomName()===e.roomName));void 0!==t&&t.updateFollowStar(e.following)}))}updateSelectedGendersFromCheckboxes(){this.selectedGenders=[];for(const e of this.genderCheckboxes)e.checked&&this.selectedGenders.push((0,si.jM)(e.name))}initUI(){super.initUI(),this.element.appendChild(this.moreRoomsList.element)}initData(e){super.initData(e),this.moreRoomsList=new vi}createElement(e){return(0,Q.tT)("div",{style:{height:"100%",overflow:"hidden"}})}getScrolledElement(){return this.moreRoomsList.element}createLoadingDiv(){return(0,Q.tT)(yi,null)}roomWidth(){return((0,ve.DK)()-4-12)/2}roomHeight(){return this.roomWidth()*(111/180)+33}repositionChildren(){super.repositionChildren();const e=this.roomWidth();for(const t of this.children())t.element.style.width=`${e}px`,t.element.style.height=`${this.roomHeight()}px`;this.visible&&this.loadMoreRoomsIfNearBottom()}handleScroll(){this.removeRoomsScrolledPastTop(),this.loadMoreRoomsIfNearBottom(),this.streamVisibleRoomsDebouncer.callFunc()}listVisible(){this.visible=!0,this.hasInitialLoaded||(this.resetAndLoad(),this.hasInitialLoaded=!0)}listHidden(){this.visible=!1;for(const e of this.children())e.stopStreaming()}streamVisibleRooms(){if(this.visible){this.repositionChildren();for(const e of this.children()){const t=e.element.offsetTop-this.moreRoomsList.element.scrollTop,i=Math.min(0,t),s=this.moreRoomsList.element.scrollTop+this.moreRoomsList.element.offsetHeight-(e.element.offsetTop+e.element.offsetHeight),n=Math.min(0,s),o=Math.max(0,e.element.offsetHeight+n+i)/e.element.offsetHeight;e.stopStreaming(),o>=.6&&e.startStreaming()}}}buildGenderCheckbox(e){const t=()=>{i.blur()},i=(0,Q.tT)("input",{type:"checkbox",style:{height:"34px",verticalAlign:"middle"},name:e.toLowerCase(),"data-testid":`${e.toLocaleLowerCase()}-checkbox`,onMouseUp:t,onTouchEnd:t,onChange:()=>{this.handleGenderChange()}});i.checked=this.selectedGenders.indexOf((0,si.jM)(e.toLowerCase()))>-1;const s=(0,Q.tT)("span",{style:{display:"inline-block",width:"44px",height:"37px",margin:"0 16px 0 8px",textAlign:"center"}},i,(0,Q.tT)("img",{src:(0,It.e0)(e),style:{verticalAlign:"middle",cursor:"pointer",width:"16px",height:"16px"},onClick:()=>{i.checked=!i.checked,this.handleGenderChange()}}));return this.genderCheckboxes.push(i),s}calculateScrollRemovalThreshold(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e*(this.roomHeight()+4+2)+(t?2:0)}}const yi=()=>{const e={background:`url("${STATIC_URL_ROOT}images/loading_spinner.svg")`,backgroundSize:"cover",width:"30px",height:"31px",animationName:"spin",animationDuration:"2s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationDelay:"0.01s"};return(0,Q.tT)("div",{style:{display:"flex",flex:1,width:"100%",justifyContent:"center",alignItems:"center"}},(0,Q.tT)("div",{style:e}))};class bi extends Pe{constructor(e){super(270,void 0),this.player=e,this.scrollTopReference=0,this.roomList=new fi({disableRemovalOnScroll:!0}),this.genderSelection=document.createElement("div"),this.genderSelection.className="genderSelectionDiv",this.roomList.getScrolledElement().appendChild(this.genderSelection);for(const e of["Female","Male","Couple","Trans"])this.genderSelection.appendChild(this.roomList.buildGenderCheckbox(e));this.addChild(this.roomList),this.roomList.getScrolledElement().onscroll=()=>{this.roomList.handleScroll(),this.lastScrollTop=this.roomList.getScrolledElement().scrollTop,this.showHideGenderSelection()},X.VZ.listen((()=>{this.lastScrollTop=this.roomList.getScrolledElement().scrollTop}))}show(){this.roomList.listVisible()}hide(){this.roomList.listHidden()}repositionChildren(){this.lastScrollTop===this.roomList.getScrolledElement().scrollTop&&(this.roomList.getScrolledElement().scrollTop=this.roomList.getScrolledElement().scrollTop-this.lastTopPanelHeight+this.roomList.getScrolledElement().offsetTop),this.lastPlayerHeight<this.player.element.offsetHeight?this.roomList.getScrolledElement().scrollTop+=this.player.element.offsetHeight-this.lastPlayerHeight:this.lastPlayerHeight>this.player.element.offsetHeight&&(this.roomList.getScrolledElement().scrollTop-=this.lastPlayerHeight-this.player.element.offsetHeight),this.lastPlayerHeight=this.player.element.offsetHeight,this.lastTopPanelHeight=this.roomList.getScrolledElement().offsetTop;let e=0;const t=document.getElementById("tab-room-header");null!==t&&(e=t.offsetHeight);const i=document.getElementById("static-header"),s=null!==i?i.offsetHeight:0;this.roomList.element.style.height=(0,ve.mJ)()-this.player.element.offsetHeight-e-s+"px"}showHideGenderSelection(){this.lastScrollTop<=120?this.showGenderSelection():this.lastScrollTop-this.scrollTopReference>=120?(this.scrollTopReference=this.lastScrollTop,this.hideGenderSelection()):this.scrollTopReference-this.lastScrollTop>=120&&(this.scrollTopReference=this.lastScrollTop,this.showGenderSelection())}showGenderSelection(){this.genderSelection.classList.remove("collapsed")}hideGenderSelection(){this.genderSelection.classList.add("collapsed")}}class wi extends et{constructor(e){super({tabName:"moreRooms",tabLabel:I.R.moreRoomsText,pageActionName:"MoreRoomsOpened",player:e})}initData(e){super.initData(e),this.player=e.player}initUI(){super.initUI(),this.moreRooms=new bi(this.player),this.addChild(this.moreRooms),X.qb.listen((e=>{e===this.getTabName()?this.moreRooms.show():this.moreRooms.hide()}))}}var Ci=i(6471);class Si extends S.u{constructor(){super(),w.X0.listen((()=>{this.showPmList()})),St.BM.listen((e=>{this.showPmWindow(),this.pmWindow.definePMLinkOnClick(e)})),J.E3.listen((e=>{e.focus&&this.showPmWindow()})),X.qb.listen((()=>{this.showPmList()}))}initUI(){this.element.classList.add("data-hj-suppress"),this.pmWindow=new _t({leavePmWindow:()=>{this.showPmList()}}),this.pmList=new Ci.E({onItemRemoved:e=>{this.pmWindow.afterListItemRemoved(e)},isDropdown:!1,openConversationEvent:St.BM}),this.addChild(this.pmList),this.addChild(this.pmWindow),this.showPmList()}showPmList(){this.pmList.showElement(),this.pmWindow.hideCurrentPMSession(),this.pmWindow.element.style.visibility="hidden"}showPmWindow(){this.pmList.hideElement(),this.pmWindow.element.style.visibility="visible"}getPmWindow(){return this.pmWindow}}class xi extends et{constructor(){var e,t;super({tabName:"private",tabLabel:I.R.privateText,pageActionName:"PrivateOpened"}),this.mediaDockHeight=0;const i=new x.gt,s=null!==(e=null===(t=l.Bm.current.loggedInUser)||void 0===t?void 0:t.isAgeVerified)&&void 0!==e&&e;w.X0.listen((e=>{this.chatConnection=e.chatConnection,this.room=e.chatConnection.room();const t=e.chatConnection.isBroadcasting;this.toggleBroadcasterContents(t),t||(this.mobileMediaDock.setRoom(this.room),this.chatHeading.innerText=I.R.privateConversationWithText(this.room),this.chatContents.appendNoticeDiv(this.chatHeading),(0,$.ZM)(this.chatHeading,{fontSize:"14px"}),this.chatContents.appendNoticeDiv(this.loadHistoryMessagesDOM.getElement()),this.chatContents.appendMessageDiv((0,ue.CM)(I.R.conversationCautionMessage(c.m.siteName)),!1),e.dossier.needsSupporterToPm&&this.chatContents.appendMessageDiv((0,ue.YC)(this.room,s),!1),this.loadHistoryMessages(!0),e.chatConnection.event.roomNotice.listen((e=>{e.showInPrivateMessage&&this.chatContents.appendMessageDiv(new Mt._y({roomNoticeData:e,neverCollapse:!0}).element)})).addTo(i))})),J.ME.listen((()=>{!1===this.isAllHistoryLoaded&&this.loadHistoryMessages()})),U.TL.listen((e=>{this.mediaDockHeight=e?(0,U.$x)()+10:0,this.repositionChildren(),this.chatContents.scrollToBottom()})),St.J9.listen((e=>{this.onConversationMessage(e)})),Et.yT.conversationDataChanged.listen((()=>{this.updateUnreadCount()})),Et.yT.unreadConversationsCountUpdate.listen((()=>this.updateUnreadCount())),this.pmManager.getPmWindow().numUnreadChanged.listen((e=>{var t;!0===(null===(t=this.chatConnection)||void 0===t?void 0:t.isBroadcasting)&&this.numUnreadChanged.fire(e)})),X.qb.listen((e=>{"private"===Je.S.currentTab&&"private"!==e&&this.chatContents.clearScrollButtonUnread(),e===this.getTabName()&&this.maybeMarkRead(e)})),this.chatContents.scrolledToBottom.listen((()=>{this.maybeMarkRead()})),this.privateShowInfo.didRepositionEvent.listen((()=>{this.repositionChildren(!0)})),w.Gr.listen((()=>{this.chatContents.clear(),this.resetHistoryData(),i.removeAll()}))}initData(e){super.initData(e),this.resetHistoryData(),this.room="",this.loadHistoryMessagesDOM=new Lt.b3,this.numUnreadChanged=new x.c_("numUnreadChanged");const t={onTipRequest:e=>{X.f6.fire(e)},onToggleDebugMode:()=>{var e;null===(e=this.chatConnection)||void 0===e||e.toggleAppDebugging()},onChatMessage:e=>{const t={message:e,username:this.room,source:"mobilePM",roomName:this.room};t.media=this.mobileMediaDock.mobileMediaList(),(0,wt.F_)(t).catch((e=>{this.chatContents.appendMessageDiv((0,ue.CM)(e.errorMessage))})),this.mobileMediaDock.isEmpty()||(this.mobileMediaDock.clear(),this.mediaDockHeight=0,this.repositionChildren())}};this.chatContents=new ye(t,(()=>this.isConversationShowing()),!0),this.mobileMediaDock=new U.Xt(this.chatContents),this.chatContents.initMediaDock(this.mobileMediaDock)}initUI(){super.initUI(),(0,B.fZ)(this.element,"PrivateTab"),(0,$.ZM)(this.element,{display:"flex",flexDirection:"column",position:"relative"}),(0,$.ZM)(this.chatContents.element,{flex:1}),this.chatHeading=(0,Q.tT)("div",{colorClass:"chatHeading",style:{fontSize:"14px",padding:"4px 5px 0 5px",display:"block",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif"}}),this.privateShowInfo=new Ht,this.privateContainer=(0,Q.tT)(Ft,{privateShowInfo:this.privateShowInfo}),this.element.appendChild(this.privateContainer),this.addChild(this.chatContents),this.pmManager=new Si,this.pmManager.hideElement(),this.addChild(this.pmManager)}isConversationShowing(){var e;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Je.S.currentTab)===this.getTabName()&&!0!==(null===(e=this.chatConnection)||void 0===e?void 0:e.isBroadcasting)}toggleBroadcasterContents(){arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?(this.privateContainer.style.display="flex",this.chatContents.showElement(),this.pmManager.hideElement()):(this.privateContainer.style.display="none",this.chatContents.hideElement(),this.pmManager.showElement())}onConversationMessage(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.fromUser.username;(e.otherUsername===this.room||i===this.room)&&(this.appendBroadcasterMessageDiv(e,t),this.firePMChatLink(t),this.maybeMarkRead())}appendBroadcasterMessageDiv(e,t){var i;if(!this.isInitialHistoryLoaded)return void this.loadHistoryMessages(!0);const s=(null===(i=l.Bm.current.loggedInUser)||void 0===i?void 0:i.username)===e.fromUser.username;this.chatContents.appendMessageDiv((0,ue.j7)(e),!t&&!s);const n=(0,Bt.bB)(e);void 0!==n&&this.chatContents.appendPhotoMessage(n,e)}firePMChatLink(e){e||Ut.fire({username:this.room,PMChatLink:new Ct.Ni({onClick:()=>{X.qb.fire("private")},conversationType:wt.Cr.PM})})}updateUnreadCount(){var e,t,i;if(!0===(null===(e=this.chatConnection)||void 0===e?void 0:e.isBroadcasting))return;const s=null!==(t=null===(i=Et.yT.getInstance().getConversation(this.room))||void 0===i?void 0:i.numUnread)&&void 0!==t?t:0;this.numUnreadChanged.fire(s)}maybeMarkRead(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Je.S.currentTab;this.isConversationShowing(e)&&!this.chatContents.isScrolledUp()&&(w.Zm.fire(this.room),St.Si.fire(this.room))}loadHistoryMessages(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isAllHistoryLoaded||this.isLoadingHistory)return;const t=this.chatContents.messageList.clientHeight,i=e?"0":this.chatContents.getEarliestMessageId();this.setIsLoadingHistory(!0),(0,wt.O2)(this.room,this.room,i).then((i=>{const s=i.messages;e&&!this.isInitialHistoryLoaded&&(this.isInitialHistoryLoaded=!0,this.chatContents.clearScrollButtonUnread()),s.length<wt.j&&(this.isAllHistoryLoaded=!0),s.forEach((e=>{this.onConversationMessage(e,!0)})),s.length>0&&this.chatContents.setEarliestMessageId(s[0].messageID);const n=this.chatContents.messageList.clientHeight;this.chatContents.messageListWrapper.scrollTop=n-t})).catch((e=>{error(e)})).finally((()=>{this.setIsLoadingHistory(!1),this.maybeMarkRead()}))}setIsLoadingHistory(e){this.isLoadingHistory=e,e?this.loadHistoryMessagesDOM.showLoading():this.loadHistoryMessagesDOM.hideLoading()}resetHistoryData(){this.isLoadingHistory=!1,this.isInitialHistoryLoaded=!1,this.isAllHistoryLoaded=!1}repositionChildren(e){const t=this.element.offsetHeight-64-this.privateContainer.offsetHeight-this.mediaDockHeight;this.chatContents.setMessageListWrapperHeight(t,e)}getChatContents(){var e;if(!0===(null===(e=this.chatConnection)||void 0===e?void 0:e.isBroadcasting)){var t,i,s;const e=this.chatConnection.getPrivateShowUser(),n=null===(t=this.pmManager.getPmWindow().getSession(e))||void 0===t?void 0:t.chatContents,o=null===(i=this.pmManager.getPmWindow().currentlyDisplayedPmSession())||void 0===i?void 0:i.chatContents;return null!==(s=null!=n?n:o)&&void 0!==s?s:this.chatContents}return this.chatContents}getPrivateShowChatContents(){var e;if(void 0!==this.chatConnection&&this.chatConnection.inPrivateRoom()){if(!0===(null===(e=this.chatConnection)||void 0===e?void 0:e.isBroadcasting)){var t;const e=this.chatConnection.getPrivateShowUser();return null===(t=this.pmManager.getPmWindow().getOrCreateSession(e))||void 0===t?void 0:t.chatContents}return this.chatContents}}getPrivateContainerHeight(){return this.privateContainer.offsetHeight}}var Ti=i(7347);const Pi="rgb(239, 239, 239)",ki="rgb(255, 255, 255)";class Ai extends Ti.U{static styleContainer(e){(0,$.ZM)(e,{fontSize:"16px"})}static styleHeader(e,t){super.styleHeader(e,t),(0,$.ZM)(e,{fontSize:"16px",padding:"12px",margin:"0",borderBottom:`1px solid ${Pi}`,backgroundColor:"rgb(250, 250, 250)",boxSizing:"border-box"})}static styleRowWrapper(e){super.styleRowWrapper(e),(0,$.ZM)(e,{fontSize:"16px",backgroundColor:`${ki}`,padding:"12px 18px",margin:"0",borderBottom:`1px solid ${Pi}`,overflow:"hidden",boxSizing:"border-box"})}static styleLabel(e,t){super.styleLabel(e,t),(0,$.ZM)(e,{color:"rgb(51, 51, 51)",fontSize:"16px",padding:"0",margin:"0"})}static styleInput(e){super.styleInput(e),(0,$.ZM)(e,{color:"rgb(115, 115, 115)",fontSize:"16px",cssFloat:"right",WebkitAppearance:"none",border:"none",maxWidth:"45%",padding:"0",margin:"0"}),e instanceof HTMLSelectElement&&(0,$.ZM)(e,{height:"",backgroundColor:`${ki}`,backgroundImage:`url(${STATIC_URL_MOBILE}chevron_right_light.svg)`,backgroundRepeat:"no-repeat",backgroundPosition:"right bottom",backgroundSize:"18px 18px",padding:"0 20px 0 0",textAlign:"right",textAlignLast:"right",opacity:"0",position:"absolute",width:"100%",maxWidth:"100%"})}static styleSelectOverlay(e){(0,$.ZM)(e,{color:"rgb(115, 115, 115)",fontSize:"16px",height:"",backgroundColor:`${ki}`,backgroundImage:`url(${STATIC_URL_MOBILE}chevron_right_light.svg)`,backgroundRepeat:"no-repeat",backgroundPosition:"right bottom",backgroundSize:"18px 18px",padding:"0 20px 0 0",margin:"0",whiteSpace:"nowrap",pointerEvents:"none",zIndex:2})}}var Mi=i(2382),Ri=i(4660);class Ii extends Ri.J{constructor(e,t,i){super(e,t,i),this.hue=180,this.saturation=1,this.value=1,this.parentHasTouchScrolling=!1,this.element.style.position="fixed",this.element.style.top="15%",this.element.style.boxShadow="0 20px 30px -3px rgba(0, 0, 0, 0.4), 0 8px 12px -2px rgba(0, 0, 0, 0.2)",this.element.style.backgroundColor="white",this.element.style.padding="12px",this.element.style.borderRadius="8px",this.element.style.left="10%",this.element.style.right="10%",this.hexInput.style.fontSize="16px",this.hexInput.style.backgroundColor="#f1f3f4",this.hexInput.style.color="rgb(88, 91, 94)",this.hexInput.style.padding="6px 4px",this.hexInput.style.border="none",this.hexInput.style.width="calc(100% - 33px)",this.hexInput.style.boxSizing="border-box",(0,u.wu)("input",this.hexInput,(()=>{const e=this.hexInput.value;(0,Mi.qv)(e)&&this.updateColorSelectors(e,!1)})),this.createSaveAndCancel()}createColorCanvas(){this.palette=document.createElement("div"),this.paletteSelector=document.createElement("div");const e=document.createElement("div");this.bar=document.createElement("div"),this.barSelector=document.createElement("div"),this.preview=document.createElement("div"),this.element.appendChild(this.palette),this.palette.appendChild(this.paletteSelector),this.element.appendChild(e),e.appendChild(this.bar),this.element.appendChild(this.preview),this.bar.appendChild(this.barSelector),this.preview.style.height="25px",this.preview.style.width="25px",this.preview.style.borderRadius="100%",this.preview.style.border="1px solid black",this.preview.style.cssFloat="left",this.preview.style.marginRight="6px",this.palette.style.width="100%",this.palette.style.height="200px",this.palette.style.position="relative",this.bar.style.background="linear-gradient(90deg,red,#ff0,#0f0,#0ff,#00f,#f0f,red)",e.style.padding="2px 0",this.bar.style.position="relative",this.bar.style.width="100%",this.bar.style.height="16px",this.bar.style.borderRadius="6px",this.bar.style.margin="24px 0",this.bar.style.padding="0 4px",this.bar.style.boxSizing="border-box",this.styleSelector(this.paletteSelector),this.styleSelector(this.barSelector),this.barSelector.style.boxShadow="0 0 4px rgba(0, 0, 0, 0.8)";const t=e=>{e.stopPropagation(),e.preventDefault();const t=e.touches[0].clientX-this.bar.getBoundingClientRect().left;this.setBarSelectorPosition(t)};e.ontouchstart=e=>{t(e)},e.ontouchmove=e=>{t(e)};const i=e=>{e.stopPropagation(),e.preventDefault();const t=e.touches[0].clientX-this.palette.getBoundingClientRect().left,i=e.touches[0].clientY-this.palette.getBoundingClientRect().top;this.setPaletteSelectorPosition(t,i)};this.palette.ontouchstart=e=>{i(e)},this.palette.ontouchmove=e=>{i(e)}}styleSelector(e){e.style.position="absolute",e.style.height="16px",e.style.width="16px",e.style.border="2px solid #fff",e.style.borderRadius="100%",e.style["-webkit-user-select"]="none",e.style.top="-2px"}setBarSelectorPosition(e){let t=Math.min(e,this.bar.offsetWidth);t=Math.max(0,t),this.hue=t/this.bar.offsetWidth*360,this.barSelector.style.left=t-this.barSelector.offsetWidth/2+"px",this.updateColors(!0)}setBarSelectorPercentage(e){let t=Math.min(1,e);t=Math.max(0,t),this.barSelector.style.left=t*this.bar.offsetWidth-this.barSelector.offsetWidth/2+"px"}setPaletteSelectorPosition(e,t){let i=Math.min(e,this.palette.offsetWidth);i=Math.max(0,i),this.saturation=i/this.palette.offsetWidth;let s=Math.min(t,this.palette.offsetHeight);s=Math.max(0,s),this.value=1-s/this.palette.offsetHeight,this.paletteSelector.style.left=i-this.paletteSelector.offsetWidth/2+"px",this.paletteSelector.style.top=s-this.paletteSelector.offsetWidth/2+"px",this.updateColors(!0)}setPaletteSelectorPercentage(e,t){this.paletteSelector.style.left=e*this.palette.offsetWidth-this.paletteSelector.offsetWidth/2+"px",this.paletteSelector.style.top=t*this.palette.offsetHeight-this.paletteSelector.offsetHeight/2+"px"}repositionChildren(){this.palette.style.height=(0,ve.mJ)()/3+"px",this.setPaletteSelectorPercentage(this.saturation,1-this.value),(0,fe.K$)()||this.hide()}colorPicked(e){super.colorPicked(e),this.preview.style.backgroundColor=`${e}`}createSaveAndCancel(){const e=this.createButton(I.R.saveCAPS),t=this.createButton(I.R.cancelCAPS);e.style.backgroundColor="rgb(255, 112, 2)",t.style.backgroundColor="transparent",t.style.color="#1C6B92",t.style.marginRight="4px",e.onclick=()=>{this.colorPicked(this.hexInput.value),this.hide()},t.onclick=()=>{this.hide()},this.element.appendChild(e),this.element.appendChild(t)}updateColors(e){const t=(0,Mi.ko)(this.hue,1,1);this.palette.style.background=`linear-gradient(to top, rgb(0, 0, 0), transparent), linear-gradient(to left, rgb(${t.red}, ${t.green}, ${t.blue}), rgb(255, 255, 255))`,this.barSelector.style.backgroundColor=`rgb(${t.red}, ${t.green}, ${t.blue})`;const i=(0,Mi.ko)(this.hue,this.saturation,this.value);this.preview.style.backgroundColor=`rgb(${i.red}, ${i.green}, ${i.blue})`,this.paletteSelector.style.backgroundColor=`rgb(${i.red}, ${i.green}, ${i.blue})`,e&&(this.hexInput.value=`#${(0,Mi.Ob)(i).toLocaleUpperCase()}`)}createButton(e){const t=document.createElement("button");return t.textContent=e,t.style.borderRadius="4px",t.style.fontSize="16px",t.style.color="white",t.style.textAlign="center",t.style.cursor="pointer",t.style.border="none",t.style.padding="6px 16px",t.style.margin="12px 0 4px 0",t.style.display="inline-block",t.style.cssFloat="right",t}updateColorSelectors(e,t){const i=(0,Mi.oH)(e);this.hue=i.hue,this.saturation=i.saturation,this.value=i.value,this.setBarSelectorPercentage(this.hue/360),this.setPaletteSelectorPercentage(this.saturation,1-this.value),this.updateColors(t)}show(e){this.initialColor=e,this.styleForShow(),this.updateColorSelectors(e,!0),void 0!==this.parent&&"touch"===this.parent.element.style["-webkit-overflow-scrolling"]&&(this.parent.element.style["-webkit-overflow-scrolling"]="",this.parentHasTouchScrolling=!0)}hide(){super.hide(),void 0!==this.parent&&this.parentHasTouchScrolling&&(this.parent.element.style["-webkit-overflow-scrolling"]="touch",this.parentHasTouchScrolling=!1)}}class Ei extends b.m{initData(){super.initData(),this.selectOverlays=new Map,this.showManageIgnoredUsers=new x.c_("ShowManageIgnoredUsers"),this.isAgeVerified=!1}initUI(){super.initUI(),this.element.style.padding="0px",this.element.style.margin="0px",this.element.style.fontSize="16px",this.getStyles().styleLabel(this.manageIgnoredUsersLink,I.R.viewEditIgnoredUsers),(0,$.ZM)(this.form,{maxWidth:"100%"}),this.manageIgnoredUsersLink.onclick=()=>{(0,v.rC)('You must be logged in to edit ignored users. Click "OK" to login.')||this.showManageIgnoredUsers.fire(void 0)}}handleRoomLoaded(e){super.handleRoomLoaded(e),this.isAgeVerified=e.dossier.isAgeVerified}getStyles(){return Ai}getEmoticonAutocompleteDelayOptions(){return[{label:I.R.emoticonAutocompleteDelayOff,value:"-1"},{label:I.R.emoticonAutocompleteNoDelay(!1),value:"0"},{label:I.R.emoticonAutocompleteShortDelay(!1),value:"500"},{label:I.R.emoticonAutocompleteMediumDelay(!1),value:"1000"},{label:I.R.emoticonAutocompleteLongDelay(!1),value:"1500"}]}getHighestTokenColorOptions(){return[{label:I.R.highestTokenColorDarkPurple(!1),value:"darkpurple"},{label:I.R.highestTokenColorLightPurple(!1),value:"lightpurple"},{label:I.R.highestTokenColorDarkBlue(!1),value:"darkblue"},{label:I.R.highestTokenColorLightBlue(!1),value:"lightblue"}]}getSaveEndpoint(){return this.isBroadcaster()?"api/broadcasterchatsettings/":super.getSaveEndpoint()}getSaveColorEndpoint(){return this.isBroadcaster()?"choose_broadcaster_chat_color/":super.getSaveColorEndpoint()}getFormData(){return super.getFormData()}isBroadcaster(){var e;return(null===(e=l.Bm.current.loggedInUser)||void 0===e?void 0:e.username)===this.roomName&&this.isAgeVerified}styleWrapperCustom(e){super.styleWrapperCustom(e),e.style.padding="0"}styleLabelCustom(e){super.styleLabelCustom(e),e.style.padding="12px 18px"}styleCheckbox(e){super.styleCheckbox(e),e.style.margin="6px 18px 6px 0",e.style.cssFloat="right"}styleSlider(e){super.styleSlider(e),e.element.style.marginTop="2px"}styleColorSwatch(e){super.styleColorSwatch(e),e.style.margin="11px 21px 11px 0px"}createRow(e,t,i,s,n){const o=super.createRow(e,t,i,s,n);return void 0!==s&&i instanceof HTMLSelectElement&&(this.createSelectOverlay(o,i,e),(0,u.wu)("change",i,(()=>{this.updateSelectOverlay(i)}))),o}createColorPickerModal(){return new Ii(this.chatColorSwatch,(e=>this.onColorPicked(e)),(e=>this.onColorHovered(e)))}createLabelWithTooltip(e,t){const i=super.createLabelWithTooltip(e,t);return i.style.flex="1",i}createSelectOverlay(e,t,i){if(t instanceof HTMLSelectElement){const s=document.createElement("span");this.selectOverlays.set(t,s),e.appendChild(s),this.styleSelectOverlay(e,s,i),this.updateSelectOverlay(t),e.appendChild(s),t.onfocus=()=>{s.style.outline="-webkit-focus-ring-color auto 1px"},t.onblur=()=>{s.style.outline="none"}}}styleSelectOverlay(e,t,i){e.style.display="flex",e.style.justifyContent="space-between",e.style.position="relative",this.getStyles().styleSelectOverlay(t),i.style.flexShrink="0",i.style.marginRight="12px",t.style.overflow="hidden",t.style.textOverflow="ellipsis"}updateChatSettings(e){super.updateChatSettings(e),this.selectOverlays.forEach(((e,t)=>this.updateSelectOverlay(t)))}updateSelectOverlay(e){const t=this.selectOverlays.get(e);void 0!==t&&(t.textContent=e.options[e.selectedIndex].text)}}class Li extends Pe{constructor(){super(Math.min((0,ve.DK)()-50,400),void 0,!0),this.chatSettings=new Ei,(0,$.ZM)(this.chatSettings.element,{height:"calc(100% - 45px)",overflowY:"scroll"}),this.addChild(this.chatSettings),this.element.style.backgroundColor="rgb(250, 250, 250)";const e=document.createElement("div");let t;e.innerText=I.R.chatSettingsSavedText,e.style.position="absolute",e.style.top="2px",e.style.right="2px",e.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",e.style.color="#000000",e.style.backgroundColor="#d8deea",e.style.border="1px solid #acacac",e.style.borderRadius="4px",e.style.padding="4px 6px",e.style.visibility="hidden",this.element.appendChild(e),this.chatSettings.chatSettingsSavedRequest.listen((()=>{clearTimeout(t),(0,M.Ve)(e,"250ms"),e.style.visibility="visible",t=window.setTimeout((()=>{(0,M.Ve)(e,"1000ms"),e.style.visibility="hidden"}),2500)}))}show(){super.show(),this.chatSettings.getTipVolumeSlider().handleResize()}repositionChildren(){this.width=Math.min((0,ve.DK)()-50,400)}}var Di=i(3417),Bi=i(90);class Ui extends Pe{constructor(){super(Math.min((0,ve.DK)()-50,400),void 0,!0,I.R.backToChatSettings),this.ignoredUsersContainer=document.createElement("div"),this.ignoredUsersList=document.createElement("div"),this.element.appendChild(this.ignoredUsersContainer),this.ignoredUsersContainer.appendChild(this.ignoredUsersList),(0,$.ZM)(this.ignoredUsersContainer,{height:"calc(100% - 45px)",overflowY:"scroll"}),Ai.styleContainer(this.ignoredUsersContainer),w.X0.listen((e=>{this.chatConnection=e.chatConnection,this.createIgnoredUsersList()}))}show(){super.show(),this.createIgnoredUsersList()}createIgnoredUsersList(){if(this.clearIgnoredUsersList(),void 0!==l.Bm.current.loggedInUser)if(void 0===this.chatConnection)this.ignoredUsersList.appendChild(this.createSpecialMessage(I.R.loadingText));else{const e=(0,Di.V6)(!0);if(0===e.size)this.ignoredUsersList.appendChild(this.createSpecialMessage(I.R.noOneIgnored));else for(const t of e)this.createIgnoredUserRow(t)}}createSpecialMessage(e){const t=document.createElement("div");return Ai.styleRowWrapper(t),t.innerText=e,t.style.borderBottom="none",t}clearIgnoredUsersList(){for(;null!==this.ignoredUsersList.firstChild;)this.ignoredUsersList.removeChild(this.ignoredUsersList.firstChild)}createIgnoredUserRow(e){const t=document.createElement("div"),i=document.createElement("label"),s=document.createElement("img");this.ignoredUsersList.appendChild(t),t.appendChild(i),t.appendChild(s),Ai.styleRowWrapper(t),Ai.styleLabel(i,e),Ai.styleInput(s),s.src=`${STATIC_URL_MOBILE}remove.svg`,s.style.height="18px";let n=!1;const o=new Bi.P(!1,((e,i)=>{if(i)t.style.opacity="0.4";else if(e){const e=100;(0,M.Ve)(t,`opacity ${e}ms`),t.style.opacity="0",window.setTimeout((()=>{this.ignoredUsersList.removeChild(t)}),e)}}),(()=>{t.style.opacity="1.0",n=!1}));s.onclick=()=>{void 0!==this.chatConnection&&(n||(n=!0,o.dispatch(!0,this.chatConnection.unignore(e))))}}}S.u;const _i={underage:I.R.reportAbuseCatUnderage,advertising:I.R.reportAbuseCatAdvertising,abusive:I.R.reportAbuseCatAbusive,intoxicated:I.R.reportAbuseCatIntoxicated,"large toy":I.R.reportAbuseCatLarge,"offline payments":I.R.reportAbuseCatOffline,"public broadcast":I.R.reportAbuseCatPublic,"service uniform":I.R.reportAbuseCatUniform,sleeping:I.R.reportAbuseCatSleeping,gender:I.R.reportAbuseCatGender,other:I.R.reportAbuseCatOther};class Fi extends S.u{constructor(){super(),this.closeEvent=new x.c_("reset"),this.formContainer=document.createElement("div"),this.blankOption=document.createElement("option"),this.submittedMsg=document.createElement("div"),this.categoryRequiredMsg=document.createElement("div"),this.commentsRequiredMsg=document.createElement("div"),this.categorySelect=document.createElement("select"),this.textBox=document.createElement("textarea"),this.reportAbuseForm=document.createElement("form"),this.hideTimeout=0,(0,$.ZM)(this.element,{display:"block",color:"#6C6C78",fontSize:"14px",height:"calc(100% - 45px)",boxSizing:"border-box",position:"absolute",padding:"19px"}),(0,ge.H)(this.element),this.element.appendChild(this.formContainer),this.reportAbuseForm.method="post",this.reportAbuseForm.dataset.testid="report-abuse-form",this.formContainer.appendChild(this.reportAbuseForm);const e=document.createElement("div");e.style.paddingBottom="10px",e.style.width="100%",e.style.display="inline-block",e.style.maxWidth="100%",this.reportAbuseForm.appendChild(e),this.categorySelect.style.border="1px solid #A4A4A4",this.categorySelect.style.fontSize="16px",this.categorySelect.style.width="99%",this.categorySelect.style.fontFamily="UbuntuRegular, Arial, Helvetica, sans-serif",this.categorySelect.dataset.testid="report-abuse-category",e.appendChild(this.categorySelect),this.blankOption.value="",this.blankOption.disabled=!0,this.blankOption.selected=!0,this.blankOption.textContent=I.R.chooseCategoryText,this.categorySelect.appendChild(this.blankOption);for(const e in _i){const t=document.createElement("option");t.value=e,t.innerText=_i[e],this.categorySelect.appendChild(t)}this.categoryRequiredMsg.style.display="none",this.categoryRequiredMsg.style.color="#EA3323";const t=document.createElement("span");t.textContent=I.R.reportAbuseCategoryRequired,t.style.fontSize="14px",this.categoryRequiredMsg.appendChild(t),e.appendChild(this.categoryRequiredMsg);const i=document.createElement("p");i.style.fontWeight="bold",i.style.margin="0.5em 0px 0.2em",i.innerText=I.R.reportAbuseAdditionalComments,e.appendChild(i),this.textBox.draggable=!1,this.textBox.maxLength=2048,this.textBox.style.boxSizing="border-box",this.textBox.style.width="100%",this.textBox.style.fontSize="16px",this.textBox.style.padding="3px",this.textBox.style.border="1px solid #A4A4A4",this.textBox.style.height="55px",this.textBox.style.fontFamily="UbuntuRegular, Arial, Helvetica, sans-serif",this.textBox.dataset.testid="report-abuse-comments",(0,ge.H)(this.textBox),e.appendChild(this.textBox),this.commentsRequiredMsg.style.color="#EA3323",this.commentsRequiredMsg.style.display="none";const s=document.createElement("span");s.textContent=I.R.reportAbuseDescriptionRequired,s.style.fontSize="14px",this.commentsRequiredMsg.appendChild(s),e.appendChild(this.commentsRequiredMsg);const n=document.createElement("div");n.style.paddingTop="10px";const o=document.createElement("a");o.textContent=I.R.reportCAPS,o.style.cssFloat="right",o.style.display="block",o.style.width="auto",o.style.padding="6px 16px",o.style.fontSize="16px",o.style.color="#FFF",o.style.backgroundColor="#EA3323",o.dataset.testid="report-abuse-submit",n.appendChild(o),o.onclick=e=>{this.sendReport()};const r=document.createElement("a");r.textContent=I.R.cancelText,r.style.cssFloat="right",r.style.display="block",r.style.width="auto",r.style.padding="6px 16px",r.style.fontSize="16px",r.style.color="#1C6B92",r.style.marginRight="8px",r.dataset.testid="report-abuse-cancel",n.appendChild(r),r.onclick=e=>{this.closeEvent.fire(!0)},e.appendChild(n);const a=document.createElement("div");a.style.clear="both",e.appendChild(a);const l=document.createElement("div");l.style.fontSize="12px",l.style.marginTop="20px",l.innerText=`${I.R.reportAbuseTextTerms} `;const h=document.createElement("a");h.href=(0,m._Y)("/terms/#room-reports"),h.innerText="Terms",h.dataset.testid="report-abuse-terms-link",l.appendChild(h),e.appendChild(l),this.submittedMsg.style.display="none",this.submittedMsg.style.height="80px",this.submittedMsg.style.lineHeight="80px",this.submittedMsg.style.textAlign="center",this.submittedMsg.style.fontWeight="bold",this.submittedMsg.innerText=I.R.commentSubmittedMessage,this.element.appendChild(this.submittedMsg),w.X0.listen((e=>{this.room=e.dossier.room})),this.categorySelect.onchange=()=>{this.categoryRequiredMsg.style.display="none",this.commentsRequiredMsg.style.display="none"},this.textBox.onchange=()=>{""!==this.textBox.value&&(this.commentsRequiredMsg.style.display="none")},this.element.onclick=e=>{e.stopPropagation()}}sendReport(){""!==this.categorySelect.value?"other"!==this.categorySelect.value||!1!==/[a-z]{2}/i.test(this.textBox.value)?(0,m.KF)(`abuse/report/${this.room}/`,{category:this.categorySelect.value,additional_comments:this.textBox.value}).then((e=>{this.formContainer.style.display="none",this.commentsRequiredMsg.style.display="none",this.showSubmitted(I.R.commentSubmittedMessage),this.reportAbuseForm.reset(),this.delayClose(1e4)})).catch((e=>{this.formContainer.style.display="none",this.showSubmitted(e.xhr.responseText),this.delayClose(1e4)})):this.commentsRequiredMsg.style.display="block":this.categoryRequiredMsg.style.display="block"}reset(){this.formContainer.style.display="block",this.commentsRequiredMsg.style.display="none",this.submittedMsg.style.display="none",this.categorySelect.value="",this.blankOption.setAttribute("selected","selected"),this.reportAbuseForm.reset()}showSubmitted(e){this.submittedMsg.innerText=e,this.submittedMsg.style.display="block"}delayClose(e){clearTimeout(this.hideTimeout),this.hideTimeout=window.setTimeout((()=>{clearTimeout(this.hideTimeout),this.closeEvent.fire(!0)}),e)}}var Ni=i(369),Oi=i(8006);class Hi extends Oi.v{constructor(){super(),this.enabled=!1,this.commentTriggerEvent=new x.c_("satisfactionCommentShow"),this.hideCommentEvent=new x.c_("satisfactionCommentHide"),this.label=document.createElement("span"),this.satisfiedText=I.R.satisfiedText,this.hideSatisfiedText=!1,this.element.id="satisfactionScore",this.element.style.height="",this.element.style.width="",this.element.style.position="static",this.element.style.display="block",this.element.style.cursor="pointer",this.innerDiv.style.backgroundColor="",this.innerDiv.style.textShadow="",this.innerDiv.style.color="#6C6C78",this.innerDiv.style.textDecoration="none",this.element.onclick=()=>{this.divClicked()},this.percent.style.fontWeight="bold",(0,B.fZ)(this.label,"satisfactionLabel"),this.label.textContent=this.satisfiedText,this.label.style.margin="0",this.label.style.verticalAlign="top",this.label.style.display="none",this.innerDiv.prepend(this.label),(0,Ni.BL)(620).listen((e=>{this.hideSatisfiedText=e,this.label.textContent=this.getSatisfiedLabelText()})),this.thumbsUp.style.marginRight="20px",this.thumbsUpActive.style.marginRight="20px",this.thumbsDown.style.marginLeft="20px",this.thumbsDownActive.style.marginLeft="20px",this.disableVoting()}onVoteError(){super.onVoteError(),this.hideCommentEvent.fire(void 0),(0,p.Q$)(I.R.errorVotingForUser(this.roomName))}styleThumb(e,t){super.styleThumb(e,t),e.height=18,e.width=18,e.style.height="18px",e.style.width="18px"}enableVoteMsg(){return I.R.afterTipVoteSatMobileText(this.roomName,Oi.U)}triggerComment(e){this.commentTriggerEvent.fire(e)}stopProp(e){this.enabled&&e.stopPropagation()}enableVoting(){this.element.style.color="#333333",this.label.style.color="#0471A1",this.enabled=!0,super.enableVoting()}disableVoting(){this.element.style.color="#6C6C78",this.label.style.color="",this.enabled=!1,super.disableVoting()}divClicked(){this.enabled||(0,p.Q$)(I.R.allowToVoteMessage(this.roomName,Oi.U))}setVoteState(e,t){super.setVoteState(e,t),t?(this.element.style.pointerEvents="none",this.element.style.opacity="0.7"):(this.element.style.pointerEvents="",this.element.style.opacity="1")}getSatisfiedLabelText(e){return void 0!==e&&e.dossier.hideSatisfactionScore&&void 0!==e.dossier.staffInfo?this.hideSatisfiedText?"":I.R.hiddenStaffOnlyTextCAPS:this.hideSatisfiedText?"":I.R.satisfiedText}}class Wi extends S.u{constructor(){super(),this.hideEvent=new x.c_("satisfactionCommentHide"),this.message=document.createElement("div"),this.commentSection=document.createElement("div"),this.label=document.createElement("p"),this.textBox=document.createElement("textarea"),this.textLimit=document.createElement("span"),this.buttonBar=document.createElement("div"),this.submittedMsg=document.createElement("p"),this.roomName="",this.submitted=!1,(0,$.ZM)(this.element,{display:"none",position:"static",color:"#6C6C78",fontSize:"14px",height:"calc(100% - 45px)",padding:"19px",boxSizing:"border-box",overflowY:"scroll"}),this.element.onclick=e=>{e.stopPropagation()},this.message.style.fontSize="14px",this.element.appendChild(this.message),this.label.style.fontWeight="bold",this.label.style.margin="0.5em 0px 0.2em",this.label.style.display="none",this.label.innerText=I.R.optionalCommentNote,this.textBox.maxLength=155,this.textBox.style.boxSizing="border-box",this.textBox.style.width="100%",this.textBox.style.fontSize="16px",this.textBox.style.padding="3px",this.textBox.style.border="1px solid #A4A4A4",this.textBox.style.height="55px",this.textBox.style.display="none",this.textBox.style.fontFamily="UbuntuRegular, Arial, Helvetica, sans-serif",this.textBox.value="",this.textLimit.style.display="none",this.textLimit.style.float="right",this.updateTextLimit(),this.textBox.oninput=()=>{this.updateTextLimit()},this.buttonBar.style.paddingTop="25px",this.buttonBar.style.display="none";const e=document.createElement("a");e.textContent=I.R.submitCAPS,e.style.cssFloat="right",e.style.display="block",e.style.width="auto",e.style.padding="6px 16px",e.style.fontSize="16px",e.style.color="#FFF",e.style.backgroundColor="#FF7002",e.onclick=()=>{this.submitComment(this.textBox.value)},this.buttonBar.appendChild(e);const t=document.createElement("a");t.textContent=I.R.cancelText,t.style.cssFloat="right",t.style.display="block",t.style.width="auto",t.style.padding="6px 12px",t.style.fontSize="16px",t.style.color="#1C6B92",t.style.marginRight="8px",t.onclick=()=>{this.reset(),this.hide()},this.buttonBar.appendChild(t),this.submittedMsg.textContent=I.R.commentSubmittedMessage,this.submittedMsg.style.display="none",this.submittedMsg.style.height="80px",this.submittedMsg.style.lineHeight="80px",this.submittedMsg.style.textAlign="center",this.submittedMsg.style.fontWeight="bold",this.commentSection.appendChild(this.label),this.commentSection.appendChild(this.textBox),this.commentSection.appendChild(this.textLimit),this.commentSection.appendChild(this.buttonBar),this.commentSection.appendChild(this.submittedMsg),this.element.appendChild(this.commentSection),w.X0.listen((e=>{this.setRoom(e.dossier.room)}))}setRoom(e){this.roomName=e,this.message.innerText=I.R.confidentalVoteMessage(e)}show(){this.element.style.display="block",null!==this.textBox.parentNode&&this.textBox.focus(),this.submitted&&this.delayHide(5e3)}reset(){this.submitted=!1,this.textBox.value="",this.updateTextLimit(),this.submittedMsg.style.display="none",this.label.style.display="block",this.textBox.style.display="block",this.textLimit.style.display="block",this.buttonBar.style.display="block"}updateTextLimit(){this.textLimit.innerText=`${this.textBox.value.length}/${this.textBox.maxLength}`}submitComment(e){this.label.style.display="none",this.textBox.style.display="none",this.textLimit.style.display="none",this.buttonBar.style.display="none",this.submittedMsg.textContent=I.R.submittingText,this.submittedMsg.style.display="block",this.submitted=!0,(0,m.KF)(`tipping/add_comment/${this.roomName}/`,{comment:e}).then((()=>{this.submittedMsg.textContent=I.R.commentSubmittedMessage,this.delayHide(5e3)})).catch((e=>{error("Error rating model",e),this.submittedMsg.textContent=I.R.errorSubmitting,this.delayHide(5e3)}))}delayHide(e){clearTimeout(this.hideTimeout),this.hideTimeout=window.setTimeout((()=>{this.hide()}),e)}hide(){clearTimeout(this.hideTimeout),this.element.style.display="none",this.hideEvent.fire(void 0),this.reset()}}class $i extends et{constructor(e){super({tabName:"roomMenu",tabLabel:"•••",pageActionName:"RoomTabOpened",player:e})}initUI(e){super.initUI(e),(0,$.ZM)(this.element,{position:"relative"}),this.roomMenu=this.addChild(new Vi({player:e.player}))}getRoomMenu(){return this.roomMenu}}class Vi extends S.u{constructor(e){super("div",e)}initData(e){this.room="",this.userList=new Me,this.satisfactionComment=new Wi,this.satisfactionCommentMenuComponent=new Pe((0,ve.DK)(),this.satisfactionComment,!0),this.reportAbuse=new Fi,this.reportAbuseMenuComponent=new Pe((0,ve.DK)(),this.reportAbuse,!0),this.chatSettingsComponent=new Li,this.manageIgnoredUsers=new Ui}initUI(){this.element=(0,Q.tT)("div",{style:{width:"100%",height:"100%",overflowY:"scroll"}},this.createSendDmMenuItem(),this.createUserListMenuItem(),this.createSatisfactionScoreMenuItem(),this.createReportAbuseMenuItem(),this.createChatSettingsMenuItem(),this.createManageIgnoredUsersMenuItem()),this.element.style["-webkit-overflow-scrolling"]="",this.element.dataset.testid="additional-options-container",this.chatSettingsComponent.chatSettings.showManageIgnoredUsers.listen((()=>{this.manageIgnoredUsers.show()})),w.X0.listen((e=>{this.room=e.dossier.room,this.sendDmLabel.update({text:I.R.sendDmToUser(this.room)})})),w.Gr.listen((()=>{var e;null===(e=this.activeMenuComponent)||void 0===e||e.hide(),this.satisfactionComment.hideElement(),this.satisfactionComment.reset(),this.reportAbuse.reset()})),X.qb.listen((e=>{"roomMenu"!==e&&this.closeActiveComponent()}))}getUserList(){return this.userList}getReportAbuseForm(){return this.reportAbuse}getReportAbuse(){return this.reportAbuseMenuComponent}getChatSettings(){return this.chatSettingsComponent}openMenuComponent(e){this.closeActiveComponent(),this.activeMenuComponent=e,e.show()}openMenuComponentByName(e){0===e?this.openMenuComponent(this.userList):3===e?this.openMenuComponent(this.chatSettingsComponent):2===e?this.openMenuComponent(this.reportAbuseMenuComponent):1===e&&this.openMenuComponent(this.satisfactionCommentMenuComponent)}closeMenuComponent(e){e===this.chatSettingsComponent&&this.manageIgnoredUsers.hide(),this.activeMenuComponent=void 0,e.hide()}closeActiveComponent(){void 0!==this.activeMenuComponent&&this.closeMenuComponent(this.activeMenuComponent)}createSendDmMenuItem(){const e=document.createElement("div"),t=_.c.get("MenuLabel");return this.sendDmLabel=new t({text:I.R.sendDmToUser(this.room),style:{whiteSpace:"nowrap"},onClick:()=>{(0,v.rC)(I.R.loggedInToDm)||(X.bW.fire(!0),tt.$o.fire(this.room))}},e),e}createUserListMenuItem(){const e=document.createElement("div"),t=new(_.c.get("MenuLabel"))({text:I.R.usersText,onClick:()=>{(0,T.bT)("UserlistOpened"),this.openMenuComponent(this.userList)},showChevron:!0},e);return Ae.listen((e=>{t.update({text:`${I.R.usersText} (${e})`})})),(0,Q.tT)("div",null,e,this.userList.element)}createSatisfactionScoreMenuItem(){const e=document.createElement("div");(0,B.fZ)(e,"MenuLabel-container");const t=document.createElement("div");new(_.c.get("MenuLabel"))({text:I.R.satisfiedText,style:{borderBottom:"none",paddingLeft:"0"}},t);const i=new Hi;return i.commentTriggerEvent.listen((e=>{e&&this.satisfactionComment.reset(),this.satisfactionComment.showElement(),this.openMenuComponent(this.satisfactionCommentMenuComponent)})),i.hideCommentEvent.listen((()=>{this.closeMenuComponent(this.satisfactionCommentMenuComponent)})),this.satisfactionComment.hideEvent.listen((()=>{this.closeMenuComponent(this.satisfactionCommentMenuComponent)})),e.appendChild(t),e.appendChild(i.element),(0,Q.tT)("div",null,e,this.satisfactionCommentMenuComponent.element)}createReportAbuseMenuItem(){const e=document.createElement("div");return new(_.c.get("MenuLabel"))({text:I.R.reportAbuseText,style:{color:"#C41721"},onClick:()=>{this.openMenuComponent(this.reportAbuseMenuComponent)},showChevron:!0},e),this.reportAbuse.closeEvent.listen((e=>{e&&this.reportAbuse.reset(),this.closeMenuComponent(this.reportAbuseMenuComponent)})),(0,Q.tT)("div",null,e,this.reportAbuseMenuComponent.element)}createChatSettingsMenuItem(){const e=document.createElement("div");return new(_.c.get("MenuLabel"))({text:I.R.chatSettings,onClick:()=>{(0,T.bT)("SettingsOpened"),this.openMenuComponent(this.chatSettingsComponent)},showChevron:!0},e),(0,Q.tT)("div",null,e,this.chatSettingsComponent.element)}createManageIgnoredUsersMenuItem(){return(0,Q.tT)("div",null,this.manageIgnoredUsers.element)}}var zi=i(1679),Gi=i(7322);class qi extends et{constructor(){super({tabName:"tokens",tabLabel:I.R.tokensCC,pageActionName:"TipTabOpened"})}initUI(){super.initUI(),(0,B.fZ)(this.element,"TokensTab"),(0,$.ZM)(this.element,{position:"relative",display:"flex",flexDirection:"column"}),this.appPanel=new Gi.Y6,this.privateShowButton=new le,this.fanclubButton=new ae,this.supporterButton=new de,this.tokenBalanceText=(0,Q.tT)("span",{colorClass:"tokenBalance"}),this.tipButtonText=(0,Q.tT)("span",null,I.R.tipUser("")),this.element.appendChild((0,Q.tT)(Q.FK,null,(0,Q.tT)(ji,{appPanel:this.appPanel,privateShowButton:this.privateShowButton,fanclubButton:this.fanclubButton,supporterButton:this.supporterButton}),(0,Q.tT)(Ki,{tokenBalanceText:this.tokenBalanceText,tipButtonText:this.tipButtonText}))),w.X0.listen((e=>{this.updateTokenBalance(e.dossier.tokenBalance),this.tipButtonText.innerText=I.R.tipUser(e.dossier.room),e.chatConnection.event.statusChange.listen((e=>{const t=l.Bm.current.PurchaseEventSources.TOKEN_SOURCE_MOBILE_TOKENS_TAB_TOKEN_BAR;this.element.querySelector("#tokenPurchaseLink").onclick=()=>(0,zi.di)({source:t,roomType:"privatewatching"===e.currentStatus?It.CJ.Private:It.CJ.Public})})),this.repositionChildren()})),this.appPanel.panelUpdated.listen((()=>{this.appPanel.hasContent?this.appPanel.showElement():this.appPanel.hideElement()})),r.D.listen((e=>{this.updateTokenBalance(e.tokens)}))}updateTokenBalance(e){this.tokenBalanceText.innerText=`${e.toLocaleString()} ${I.R.tokenOrTokensText(e,!1)}`}repositionChildren(){(0,$.ZM)(this.fanclubButton.element,{marginRight:this.supporterButton.isShown()?"10px":""})}}const ji=e=>((0,$.ZM)(e.appPanel.element,{padding:"16px 0 0"}),(0,Q.tT)("div",{style:{flex:1,overflowY:"scroll"}},(0,Q.tT)("div",{style:{width:"100%",display:"flex",justifyContent:"center",position:"relative"}},e.appPanel.element),(0,Q.tT)(Zi,{privateShowButton:e.privateShowButton,fanclubButton:e.fanclubButton,supporterButton:e.supporterButton}))),Zi=e=>(0,Q.tT)("div",{style:{padding:"16px",fontSize:"14px",width:"100%",boxSizing:"border-box"}},e.privateShowButton.element,(0,Q.tT)("div",{style:{display:"flex"}},e.fanclubButton.element,e.supporterButton.element)),Ki=e=>{const t=l.Bm.current.PurchaseEventSources.TOKEN_SOURCE_MOBILE_TOKENS_TAB_TOKEN_BAR;return(0,Q.tT)("div",{style:{width:"100%",borderTop:"1px solid #EFEFEF",padding:"16px 18px 12px 18px",display:"flex",flexDirection:"column",boxSizing:"border-box",fontSize:"14px"}},(0,Q.tT)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px"}},(0,Q.tT)("div",{style:{fontFamily:"UbuntuBold, Helvetica, Arial, sans-serif"}},(0,Q.tT)("span",{colorClass:"youHave"},`${I.R.tokensLabel} `),e.tokenBalanceText),(0,Q.tT)("a",{id:"tokenPurchaseLink",onClick:()=>()=>(0,zi.di)({source:t,roomType:It.CJ.Public})},I.R.buyMoreTokens)),new ce({tipButtonText:e.tipButtonText}).element)};class Ji{constructor(e){this.player=e,this.chatTab=new Zt,this.privateTab=new xi,this.tokensTab=new qi,this.bioTab=new yt,this.moreRoomsTab=new wi(this.player),this.roomMenuTab=new $i(this.player),this.tabList=[this.chatTab,this.privateTab,this.tokensTab,this.bioTab,this.moreRoomsTab,this.roomMenuTab]}getList(){return this.tabList}length(){return this.tabList.length}getTabByIndex(e){if(!(e<0||e>=this.length()))return this.tabList[e]}getIndexByTabName(e){const t=this.tabList.findIndex((t=>t.getTabName()===e));return t>-1?t:void 0}getChatTab(){return this.chatTab}getPrivateTab(){return this.privateTab}getTokensTab(){return this.tokensTab}getBioTab(){return this.bioTab}getMoreRoomsTab(){return this.moreRoomsTab}getRoomMenuTab(){return this.roomMenuTab}}var Yi=i(7789);class Qi extends S.u{constructor(e){super("div",e),this.closeUcmClickHandler=e=>{e.target instanceof Node&&void 0!==this.userPanel.element&&!this.userPanel.element.contains(e.target)&&this.closeUserPanel()}}initData(e){this.player=e.player,this.mobileDismissibleMessages=e.mobileDismissibleMessages,this.tabList=new Ji(this.player),this.userPanel=new Yi.o}initUI(){const e={width:"100%",height:"100%",top:(0,ve.DK)()*He.Bu+"px",position:"absolute",boxSizing:"border-box"};this.element=(0,Q.tT)("div",{style:e}),this.header=new Ye({tabList:this.tabList}),this.addChild(this.header),this.roomTabs=new Je.S({tabList:this.tabList}),this.addChild(this.roomTabs),this.player.didRepositionEvent.listen((()=>{this.repositionChildrenRecursive()})),this.initListenersForUserPanel()}initListenersForUserPanel(){X.vT.listen((e=>{this.closeUserPanel(),this.openUserPanel(e)})),X.Gt.listen((()=>{this.closeUserPanel()})),X.qb.listen((()=>{this.closeUserPanel()}))}openUserPanel(e){this.userPanel.updateContents(e.username,e.message);const t=e.attachTo;null!==t.parentElement?t.parentElement.insertBefore(this.userPanel.element,t.nextSibling):error("Error inserting userPanel.div: panelRequest.attachTo.parentElement is null"),this.scrollMessageList(e),this.scrollUserList(e),document.addEventListener("click",this.closeUcmClickHandler)}closeUserPanel(){this.userPanel.hide(),document.removeEventListener("click",this.closeUcmClickHandler)}scrollMessageList(e){if(!["chat","private"].includes(Je.S.currentTab))return;const t=this.tabList.getChatTab().getChatWindow().chatContents.messageListWrapper,i=this.tabList.getPrivateTab().getChatContents().messageListWrapper,s="chat"===Je.S.currentTab?t:i,n=e.attachTo.parentElement;if(null!==n&&void 0!==s){const e="private"===Je.S.currentTab?this.tabList.getPrivateTab().getPrivateContainerHeight():this.tabList.getChatTab().getChatWindow().getPrivateContainerHeight(),t=n.offsetTop+n.offsetHeight-(s.offsetHeight+s.scrollTop)-(e+(0,$.Lx)(this.userPanel.element.style.marginBottom));t>0&&(s.scrollTop+=t)}}scrollUserList(e){const t=this.userPanel.element.offsetParent,i=e.attachTo;if(null===this.userPanel||!(t instanceof HTMLElement)||"roomMenu"!==Je.S.currentTab)return;const s=i.offsetHeight+(0,$.Lx)(i.style.marginBottom),n=this.userPanel.element.offsetHeight+(0,$.Lx)(this.userPanel.element.style.marginBottom),o=i.offsetTop-(t.offsetHeight+t.scrollTop)+s+n;o>0&&(t.scrollTop+=o)}getChatTabChatContents(){return this.tabList.getChatTab().getChatContents()}getPrivateTabChatContents(){return this.tabList.getPrivateTab().getChatContents()}getPrivateShowChatContents(){return this.tabList.getPrivateTab().getPrivateShowChatContents()}getAllChatContents(){const e=this.getPrivateShowChatContents();return[this.getChatTabChatContents(),this.getPrivateTabChatContents(),...void 0!==e?[e]:[]]}repositionChildren(){var e;!(0,fe.K$)()||this.player.isFullscreen?this.hideElement():(this.player.isFullscreen||(this.showElement(),null===(e=this.player.videoControls.mobilePureChat)||void 0===e||e.setVisible(!1)),this.repositionContainer(),this.repositionRoomTabs())}repositionContainer(){var e,t;const i=null!==(e=null===(t=document.getElementById("static-header"))||void 0===t?void 0:t.offsetHeight)&&void 0!==e?e:40,s=this.player.element.offsetHeight,n=this.mobileDismissibleMessages.element.offsetHeight,o=(0,ve.$B)().height-i-s-n;this.element.style.height=`${o}px`,this.element.style.top=`${s}px`}repositionRoomTabs(){const e=this.header.element.offsetHeight;this.roomTabs.element.style.height=`calc(100% - ${e}px)`}}var Xi=i(6283);class es extends Xi.q{constructor(){super(),this.chatResizeCount=0,this.videoResize={videoResizeCount:0,videoRepositionCount:0},this.actionName="SessionMetricsMobile",this.onChatResize=()=>{this.chatResizeCount+=1,this.saveToStorage()},this.onPlayerResize=e=>{let{changeType:t}=e;"landscapeFullscreen"!==this.currentMode&&(0===t?(this.videoResize.videoResizeCount+=1,this.recordResize()):1===t&&(this.videoResize.videoRepositionCount+=1),this.saveToStorage())},this.loadFromStorage(),this.currentMode=this.getMode(),pe.Ys.listen(this.onChatResize),pe.BG.listen(this.onPlayerResize)}setupModeChangeListener(){var e;fe.DQ.listen(this.onModeChange),null===(e=this.player)||void 0===e||e.toggleFullscreen.listen(this.onModeChange)}bindPlayer(e){this.player=e}playerDimensions(){void 0!==this.player&&(this.playerHeight=this.player.element.offsetHeight,this.playerWidth=this.player.element.offsetWidth,this.oldChat=screen.availHeight-this.playerHeight)}getCurrentMode(){return this.currentMode}resetMetrics(){super.resetMetrics(),this.chatResizeCount=0,this.videoResize={videoResizeCount:0,videoRepositionCount:0},Boolean(window.sessionStorage)&&window.sessionStorage.removeItem(this.actionName)}getPageActionAttributes(){return{...super.getPageActionAttributes(),videoResizeCount:this.videoResize.videoResizeCount,videoRepositionCount:this.videoResize.videoRepositionCount,chatResizeCount:this.chatResizeCount}}getMode(){return(0,fe.K$)()?void 0!==this.player?this.player.isFullscreen?"portraitFullscreen":"portraitClassic":(0,G.aS)()?"portraitFullscreen":"portraitClassic":"landscapeFullscreen"}loadFromStorage(){if(!Boolean(window.sessionStorage))return;const e=window.sessionStorage.getItem(this.actionName);if(null===e)return;const t=JSON.parse(e);this.videoResize.videoResizeCount=t.videoResizeCount,this.videoResize.videoRepositionCount=t.videoRepositionCount,this.chatResizeCount=t.chatResizeCount}saveToStorage(){Boolean(window.sessionStorage)&&window.sessionStorage.setItem(this.actionName,JSON.stringify({videoResizeCount:this.videoResize.videoResizeCount,videoRepositionCount:this.videoResize.videoRepositionCount,chatResizeCount:this.chatResizeCount}))}recordResize(){if(void 0!==this.player){const e=screen.availHeight-this.player.element.offsetHeight;(0,T.bT)("VideoResized",{video_height_old:this.playerHeight,video_height_new:this.player.element.offsetHeight,video_width_old:this.playerWidth,video_width_new:this.player.element.offsetWidth,chat_height_old:this.oldChat,chat_height_new:e,chat_width_old:screen.availWidth,chat_width_new:screen.availWidth}),this.playerHeight=this.player.element.offsetHeight,this.playerWidth=this.player.element.offsetWidth,this.oldChat=e}}}class ts extends zi.p5{styleButtonMenuItem(e){e.dt.style.fontWeight="bold"}createCommonButton(){const e=super.createCommonButton();return(0,B.fZ)(e,"mobile"),e.style.fontFamily="UbuntuRegular, Arial, Helvetica, sans-serif",e.style.verticalAlign="text-top",e.style.lineHeight="16px",e}}class is extends S.u{constructor(e){var t,i,s;super(),this.tipSource=e,this.tokenBalance=0,this.isHighTipAmountWarningActive=!1,this.visibleViewportHeight=null!==(t=null===(i=window.visualViewport)||void 0===i?void 0:i.height)&&void 0!==t?t:window.innerHeight,this.roomType=It.CJ.Public,this.tipSent=w.Ps,this.closed=new x.c_("tipClosed"),this.isSamsungBrowser=navigator.userAgent.indexOf("SamsungBrowser")>-1,this.element.style.display="none",this.element.style.overflow="visible",this.element.style.zIndex="1003",this.element.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.element.style.height="100%",this.element.style.bottom="0",this.element.style.alignItems="center",this.element.style.justifyContent="center",this.element.style.position="fixed",this.element.dataset.testid="send-tip-callout",this.overlay=document.createElement("div"),this.overlay.style.position="fixed",this.overlay.style.top="0",this.overlay.style.left="0",this.overlay.style.right="0",this.overlay.style.bottom="0",this.overlay.onclick=()=>{this.tipSent.fire({})},this.element.appendChild(this.overlay);const n=document.createElement("div");this.element.appendChild(n),this.closeWindowDiv=document.createElement("div"),this.closeWindowDiv.innerText=`${I.R.closeWindow} (${I.R.cancelLower})`,this.closeWindowDiv.style.color="#ffffff",this.closeWindowDiv.style.fontSize="14px",this.closeWindowDiv.style.fontWeight="bold",this.closeWindowDiv.style.textDecoration="underline",this.closeWindowDiv.style.position="relative",this.closeWindowDiv.style.paddingBottom="6px",this.closeWindowDiv.style.cursor="pointer",this.closeWindowDiv.style.width="100%",this.closeWindowDiv.style.textAlign="right",this.closeWindowDiv.style.cursor="pointer",this.closeWindowDiv.dataset.testid="close-tip",this.closeWindowDiv.onclick=()=>{this.tipSent.fire({})},n.appendChild(this.closeWindowDiv),this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.overflow="visible",this.content.style.backgroundColor="#ffffff",this.content.style.height="auto",this.content.style.borderRadius="6px",this.content.style.border="1px solid #000000",(0,u.wu)("click",this.content,(e=>{e.stopPropagation()}));const o=document.createElement("div"),a=document.createElement("span");a.innerText=I.R.currentBalanceText,a.style.display="inline-block",a.style.fontSize="13px",a.style.padding="6px",o.appendChild(a),this.tokenBalanceSpan=document.createElement("span"),this.tokenBalanceSpan.style.display="inline-block",this.tokenBalanceSpan.style.color="#53843a",this.tokenBalanceSpan.style.fontSize="13px",this.tokenBalanceSpan.style.padding="6px 6px 6px 0",this.tokenBalanceSpan.dataset.testid="token-balance",o.appendChild(this.tokenBalanceSpan);const h=document.createElement("a");h.innerText=I.R.purchaseTokensText,h.style.display="inline-block",h.style.color="#f47321",h.style.fontSize="13px",h.style.marginLeft="12px",h.style.padding="6px",h.dataset.testid="purchase-tokens",h.onclick=()=>{const e=l.Bm.current.PurchaseEventSources.TOKEN_SOURCE_TIP_CALLOUT;(0,zi.di)({source:e,roomType:this.roomType}),this.tipSent.fire({})},o.appendChild(h),this.content.appendChild(o),this.lowScoreWarning=document.createElement("div"),this.lowScoreWarning.dataset.testid="low-score-warning",this.lowScoreWarning.style.display="none",this.lowScoreWarning.style.color="#ff0000",this.lowScoreWarning.style.fontSize="13px",this.lowScoreWarning.style.fontWeight="bold",this.lowScoreWarning.style.padding="6px",this.lowScoreWarning.style.textAlign="center";const d=document.createElement("div");d.innerText=I.R.satisfactionWarningText,this.lowScoreWarning.appendChild(d);const c=document.createElement("div");c.innerText=I.R.tipWarningText,this.lowScoreWarning.appendChild(c),this.content.appendChild(this.lowScoreWarning),this.sendTipForm=document.createElement("form"),this.sendTipForm.dataset.testid="send-tip-form";const m=document.createElement("div");(0,$.ZM)(m,{display:"flex",alignItems:"center",marginTop:"12px",marginBottom:"6px"});const g=document.createElement("span");g.innerText=I.R.tipAmountText,g.style.display="inline-block",g.style.fontSize="13px",g.style.padding="6px",m.appendChild(g),this.tipAmountInput=(0,zi.Gz)(),this.tipAmountInput.dataset.testid="tip-amount-input",(0,B.fZ)(this.tipAmountInput,"inputAmt"),this.tipAmountInput.onclick=()=>{this.tipAmountInput.setSelectionRange(0,this.tipAmountInput.value.length)},this.tipAmountInput.onmouseup=e=>{e.preventDefault()},this.tipAmountInput.onfocus=()=>{this.tipAmountInput.setSelectionRange(0,this.tipAmountInput.value.length)},this.tipAmountInput.onblur=()=>{""===this.tipAmountInput.value&&(this.tipAmountInput.value="0")},(0,u.wu)("input",this.tipAmountInput,(()=>{this.tipAmountChange()})),m.appendChild(this.tipAmountInput),this.invalidTipAmountSpan=document.createElement("span"),this.invalidTipAmountSpan.innerText=I.R.tipAmountInvalid,this.invalidTipAmountSpan.style.fontSize="12px",this.invalidTipAmountSpan.style.color="#ff0000",this.invalidTipAmountSpan.style.display="none",this.invalidTipAmountSpan.style.marginLeft="5px",this.invalidTipAmountSpan.style.marginRight="5px",this.invalidTipAmountSpan.dataset.testid="invalid-tip",m.appendChild(this.invalidTipAmountSpan),this.sendTipForm.appendChild(m),this.tipMessageLabel=document.createElement("div"),this.tipMessageLabel.innerText=I.R.defaultTipMessageLabel,this.tipMessageLabel.style.fontSize="13px",this.tipMessageLabel.style.padding="6px 6px 0 6px",this.sendTipForm.appendChild(this.tipMessageLabel),this.tipMessageDiv=document.createElement("div"),this.tipMessageTextarea=document.createElement("textarea"),this.tipMessageTextarea.maxLength=255,this.tipMessageTextarea.style.width="100%",this.tipMessageTextarea.style.resize="none",this.tipMessageTextarea.style.fontSize="1em",this.tipMessageTextarea.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",this.tipMessageTextarea.style.margin=`${r.xj}px`,this.tipMessageTextarea.style.padding="4px",this.tipMessageTextarea.style.border="1px solid #4b4c4b",this.tipMessageTextarea.style.borderRadius="4px",this.tipMessageTextarea.style.boxSizing="border-box",this.tipMessageTextarea.classList.add("tipMessageTextarea"),this.tipMessageTextarea.dataset.testid="tip-message-textarea",this.tipMessageDiv.appendChild(this.tipMessageTextarea),this.sendTipForm.appendChild(this.tipMessageDiv);const v=document.createElement("div");v.style.textAlign="right",v.style.position="relative",this.sendTipButton=new ts,this.sendTipButton.element.style.cssFloat="",this.addChild(this.sendTipButton,v),this.sendTipForm.appendChild(v),this.content.appendChild(this.sendTipForm),n.appendChild(this.content),this.closed.listen((()=>{this.sendTipButton.hideMenu()})),null===(s=window.visualViewport)||void 0===s||s.addEventListener("resize",(()=>{var e,t;this.visibleViewportHeight=null!==(e=null===(t=window.visualViewport)||void 0===t?void 0:t.height)&&void 0!==e?e:window.innerHeight,this.repositionChildren()})),w.X0.listen((e=>{this.hasLowSatisfactionScore=e.dossier.hasLowSatisfactionScore,this.roomName=e.chatConnection.room(),e.chatConnection.event.statusChange.listen((e=>{this.roomType="privatewatching"===e.currentStatus?It.CJ.Private:It.CJ.Public,h.onclick=()=>{const e=l.Bm.current.PurchaseEventSources.TOKEN_SOURCE_TIP_CALLOUT;(0,zi.di)({source:e,roomType:this.roomType}),this.tipSent.fire({})}}))})),this.repositionChildren(),(0,u.wu)("submit",this.sendTipForm,(e=>{if(e.preventDefault(),!(0,zi.sI)(this.tipAmountInput.value))return void(0,p.Q$)(I.R.tipAmountInvalid);if(!this.sendTipButton.isEnabled())return;const t=parseInt(this.tipAmountInput.value);if(t>this.tokenBalance)return void(0,zi.qr)(I.R.notEnoughTokensMessage,l.Bm.current.PurchaseEventSources.TOKEN_SOURCE_LOW_TOKEN_BALANCE,this.roomType);if((0,T.bT)("SendTipClicked",{amount:t}),t>100&&!this.isHighTipAmountWarningActive)return this.sendTipButton.promptUser(I.R.tipConfirmationMessage(t)),this.isHighTipAmountWarningActive=!0,void this.repositionChildren();let i=this.tipMessageTextarea.value;void 0!==this.tipOptionsSelect&&(i=""===this.tipMessageTextarea.value?this.tipOptionsSelect.value:`${this.tipOptionsSelect.value} | ${this.tipMessageTextarea.value}`);const s=this.sendTipButton.getTipType();(0,r.ae)({roomName:this.roomName,tipAmount:this.tipAmountInput.value,message:i,source:this.tipSource,tipRoomType:this.roomType,tipType:s,videoMode:"mobile"}).then((e=>{e.success?(0,T.bT)("SendTipSuccess",{amount:t}):void 0!==e.error?(0,zi.qr)(`${e.error}`,l.Bm.current.PurchaseEventSources.TOKEN_SOURCE_LOW_TOKEN_BALANCE,this.roomType):error("unknown send tip error"),this.removeHighTipAmountWarning(),this.tipMessageTextarea.value="",void 0!==e.tipsInPast24Hours&&r.ew.fire({tokens:e.tipsInPast24Hours,roomName:this.roomName}),this.tipSent.fire({amount:t,success:e.success})})).catch((e=>{this.tipSent.fire({amount:t,success:!1}),error(`Error sending tip (${e})`)})),this.hide()})),(0,u.wu)("popstate",window,(e=>{this.isShown()&&this.hide()}))}repositionChildren(){(0,fe.K$)()?((0,n.OF)()||this.isSamsungBrowser?this.element.style.height="100%":(this.element.style.height=`${this.visibleViewportHeight}px`,this.element.style.top="0",this.element.style.bottom=""),this.content.style.width=`${Math.min(.9*(0,ve.DK)(),500)}px`,this.tipMessageDiv.style.width=this.content.clientWidth-2*r.xj+"px"):this.hide()}removeHighTipAmountWarning(){this.sendTipButton.cancelPrompt(),this.isHighTipAmountWarningActive=!1}tipAmountChange(){(0,zi.Pt)(this.tipAmountInput),(0,zi.sI)(this.tipAmountInput.value)?(this.sendTipButton.enable(),this.invalidTipAmountSpan.style.display="none"):(this.sendTipButton.disable(),this.invalidTipAmountSpan.style.display="inline-block"),this.isHighTipAmountWarningActive&&this.removeHighTipAmountWarning()}show(e){void 0!==e.amount&&(this.tipAmountInput.value=e.amount.toString(),this.tipAmountChange()),void 0!==e.message?this.tipMessageTextarea.value=e.message:this.tipMessageTextarea.value="",this.hasLowSatisfactionScore?this.lowScoreWarning.style.display="block":this.lowScoreWarning.style.display="none",this.tokenBalanceSpan.innerText=`${I.R.loadingTextLower}...`,this.showElement(),this.tipAmountInput.focus(),(0,zi.lc)(this.tipSource,this.sendTipButton),(0,r.kb)(this.roomName).then((e=>{if(this.updateTokenBalance(e.tokenBalance),this.tipAmountInput.max=e.tokenBalance.toString(),void 0!==e.tipOptions){this.tipMessageLabel.innerText=e.tipOptions.label,void 0!==this.tipOptionsSelect&&this.tipMessageDiv.removeChild(this.tipOptionsSelect),this.tipOptionsSelect=document.createElement("select"),this.tipOptionsSelect.style.width="100%",this.tipOptionsSelect.style.fontSize="1em",this.tipOptionsSelect.style.margin=`${r.xj}px`,this.tipOptionsSelect.style.border="1px solid #4b4c4b",this.tipOptionsSelect.style.boxSizing="border-box",this.tipMessageDiv.insertBefore(this.tipOptionsSelect,this.tipMessageTextarea);let t=document.createElement("option");t.innerText=`-- ${I.R.selectOneLabel} --`,t.value="",this.tipOptionsSelect.appendChild(t);for(const i of e.tipOptions.options)t=document.createElement("option"),t.innerText=i.label,t.value=i.label,this.tipOptionsSelect.appendChild(t)}else void 0!==this.tipOptionsSelect&&(this.tipMessageLabel.innerText=I.R.defaultTipMessageLabel,this.tipMessageTextarea.value="",this.tipMessageDiv.removeChild(this.tipOptionsSelect),this.tipOptionsSelect=void 0);this.repositionChildren()})).catch((e=>{error(`Error getting token balance (${e})`),this.tokenBalanceSpan.innerText=I.R.unknownText}))}showElement(){super.showElement("flex")}hide(){this.element.style.display="none",this.closed.fire(void 0)}updateTokenBalance(e){this.tokenBalance=e,this.tokenBalanceSpan.innerText=`${e} ${I.R.tokenOrTokensText(e,!1)}`}}function ss(e,t){document.title=I.R.mobileDocumentTitle(e,c.m.siteName,t)}function ns(){const e=(0,n.ru)();return 15===(null==e?void 0:e.major)&&0===e.minor&&(0,n.nr)()}function os(){const e=document.querySelector(".push-overlay");return null!==e&&"none"!==e.style.display&&""!==e.style.display}let rs=!1;class as extends S.u{constructor(e,t){super(),this.audioHolder=new g.T,this.sessionMetrics=new es,this.listenerGroup=new x.gt,this.siteHeaderHeight=0,this.isFullscreen=!1,this.isLoadFromBFCacheAfterSigningOut=!1,this.loading=Date.now(),this.currentRoom=e,void 0!==window.ResizeObserver&&(this.resizeObserver=new ResizeObserver((()=>this.repositionChildrenRecursive()))),document.body.style.overflow="hidden",this.mainContainer=document.getElementById("main"),this.initDismissibleMessages(),this.mainContainer.appendChild(this.element),(0,n.OF)()&&(this.hideAddressBarInLandscape(1),document.body.style.overflow="auto"),(0,T.NP)(this.sessionMetrics.getCurrentMode()),this.siteHeader=document.querySelector("#static-header");const i=document.querySelector("#static-header .right-nav");this.pushMenuOverlay=document.querySelector(".push-overlay"),this.pushMenu=document.querySelector(".pushmenu"),this.siteHeaderHeight=this.siteHeader.offsetHeight,this.headerRoomInfo=new Re,i.appendChild(this.headerRoomInfo.element),this.pushMenuContainer=document.querySelector("#pushmenu-container"),X.nD.listen((e=>{e&&(0,T.bT)("SiteMenuOpened")})),r.D.listen((e=>{const t=document.getElementById("token-balance");null!=t&&(t.innerText=`${e.tokens} Tokens`)})),this.element.style.height="100%",this.element.style.width="100%",this.element.style.minHeight="100%",this.element.style.minWidth="100%",this.element.style.position="fixed",this.element.style.zIndex="1000",(0,M.PF)(this.element,"none"),(0,T.RN)(e),this.player=new Ke(t,this,this.mobileDismissibleMessages),this.player.playerComponent instanceof P.vS&&this.player.playerComponent.setPageLoaded(this.loading),this.prependChild(this.player),this.sessionMetrics.bindPlayer(this.player),this.portraitContents=this.addChild(new Qi({player:this.player,mobileDismissibleMessages:this.mobileDismissibleMessages})),this.player.videoControls.executeInitialFullscreenState();const s=this.portraitContents.getChatTabChatContents();this.chatTabPureChat=new me.X(s),this.privateTabPureChat=new me.X(this.portraitContents.getPrivateTabChatContents()),this.player.toggleFullscreen.listen((e=>{this.isFullscreen=e,this.repositionChildrenRecursive(),this.scrollAllChatContentsToBottom(),this.sessionMetrics.recordResize()})),this.tipCallout=this.addChild(new is("mobile")),X.f6.listen((e=>{l.Bm.current.isNoninteractiveUser?(0,p.Q$)(I.R.internalStaffTip):!this.player.isFullscreen&&(0,fe.K$)()?(this.player.limitPortraitHeight(280),this.repositionChildrenRecursive(),this.tipCallout.show(e)):this.player.videoControls.showTipForm(e)})),this.tipCallout.tipSent.listen((e=>{this.tipCallout.hide(),!0===e.success&&"tokens"===Je.S.currentTab&&X.qb.fire("chat")})),this.tipCallout.closed.listen((()=>{this.player.limitPortraitHeight(0)})),this.sessionMetrics.bindTipCallout(this.tipCallout),this.loadRoom(e,!0),this.repositionChildrenRecursive(),this.afterDOMConstructedIncludingChildren();const o=new C.a((()=>{this.repositionChildrenRecursive(),this.scrollAllChatContentsToBottom()}),{bounceLimitMS:20,debounceType:1});fe.DQ.listen((()=>{(0,n.OF)()&&((0,fe.K$)()&&this.hideAddressBarInLandscape(1.1),window.scrollTo(0,this.mainContainer.scrollHeight)),o.callFunc(),this.player.centerPlayer(),window.setTimeout((()=>{o.callFunc()}),500)}));let a=window.innerWidth;if(window.onresize=()=>{document.documentElement.scrollTop<0&&(document.documentElement.scrollTop=0);const e=window.innerWidth!==a;!e&&(0,n.OF)()&&!e||(a=window.innerWidth,this.player.centerPlayer())},X.Gt.listen((()=>{this.player.setMessageInputFieldHasFocus(!0)})),X.P4.listen((()=>{this.player.setMessageInputFieldHasFocus(!1)})),this.initPlayerMovementOnInputFocus(),document.documentElement.clientHeight>=window.outerHeight){const e=()=>{const t=document.createElement("input");t.style.fontSize="16px",document.body.appendChild(t),t.focus(),t.blur(),document.body.removeChild(t),(0,u.Pf)("mousedown",this.element,e),(0,u.Pf)("touchmove",this.element,e)};(0,u.wu)("mousedown",this.element,e),(0,u.wu)("touchmove",this.element,e)}this.preventCertainTouchActions(),(0,u.wu)("popstate",window,(e=>{void 0!==e.state&&null!==e.state?this.loadRoom(e.state,!1):rs&&!(0,n.H9)()&&history.back()})),(0,u.wu)("pageshow",window,(e=>{e.persisted&&this.currentChatConnection.room()!==this.currentRoom&&this.loadRoom(this.currentRoom,!1);const t=document.referrer;e.persisted&&t.includes("login")&&(this.isLoadFromBFCacheAfterSigningOut=!0,this.loadRoom(this.currentRoom,!1))})),X.VZ.listen((e=>{this.loadRoom(e,!0)})),w.X0.listen((e=>{ss(e.dossier.room,e.dossier.roomTitle),this.repositionChildrenRecursive(),rs||(rs=!0),this.headerRoomInfo.updateContext(e.dossier.room,e.dossier.following,e.dossier.roomStatus),this.headerRoomInfo.updateViewerCount(e.dossier.numViewers),"offline"===e.dossier.roomStatus?X.qb.fire("bio"):X.qb.fire("chat"),this.sessionMetrics.playerDimensions()})),this.player.playerComponent.showControls(),b.s.fire("mobile")}initDismissibleMessages(){var e;this.mobileDismissibleMessages=new De,this.mainContainer.appendChild(this.mobileDismissibleMessages.element),null===(e=this.resizeObserver)||void 0===e||e.observe(this.mobileDismissibleMessages.element)}initPlayerMovementOnInputFocus(){var e;null===(e=visualViewport)||void 0===e||e.addEventListener("resize",(()=>{if((0,L.Q)()&&!this.player.isFullscreen&&(0,fe.K$)()&&!this.tipCallout.isShown()){const e=63,t=ns(),i=t?e+50:e,s=t?-50:0;this.player.element.style.position="fixed",this.player.element.style.top="",this.player.element.style.bottom=`${i}px`,this.player.element.style.zIndex="1",this.player.videoControls.hideElement(),this.portraitContents.element.style.top=`${s}px`,this.portraitContents.element.style.height="100%",pe.GF.fire({isInputFocused:!0,playerTop:i+this.player.element.clientHeight}),this.player.roomStatusNotifier.setPlayerIsBottomPositioned(!0)}else this.player.element.style.position="absolute",this.player.element.style.top="0",this.player.element.style.bottom="",this.player.element.style.zIndex="",this.portraitContents.element.style.top="",this.player.videoControls.showElement(),pe.GF.fire({isInputFocused:!1}),this.repositionChildrenRecursive(),this.player.roomStatusNotifier.setPlayerIsBottomPositioned(!1);this.scrollAllChatContentsToBottom()}))}getMobilePlayer(){return this.player}hideAddressBarInLandscape(e){var t,i;const s=e*(null!==(t=null===(i=window.visualViewport)||void 0===i?void 0:i.height)&&void 0!==t?t:window.innerHeight);this.mainContainer.style.height=`${s}px`}scrollAllChatContentsToBottom(){this.portraitContents.getAllChatContents().forEach((e=>e.scrollToBottom()))}passwordPrompt(e,t){if((0,v.rC)(I.R.loginForPasswordPrompt((0,s.VE)(e)),!1,D.EO,{requiredForPage:!0}))return;const i=()=>{e===this.currentRoom&&window.location.reload()},n=prompt(I.R.passwordRequiredForRoom(e));null!==n?(0,m.KF)(`roomlogin/${e}/`,{password:n}).then((i=>{"success"===new s.N6(i.responseText).getStringOrUndefined("result")?this.loadRoom(e,t):(0,p.Q$)(I.R.incorrectPassword,(()=>{this.passwordPrompt(e,t)}))})).catch((t=>{error("Unable to login to room",{room:e,error:t}),i()})):i()}createChatConnection(e){const t=new f.Z(e,!0),i=new d.bq(e.roomUid),n=i.onAuthFail.once((()=>{(0,o.m)(e.room).then((t=>{const i=new s.N6(t.responseText),n=i.getString("code",!1),o=i.getString("detail",!1);this.handleRoomAccessCode(e.room,n,o)||((0,p.Q$)(I.R.roomLoadError),error("Error loading room",{error:t.responseText}))})).catch(k.yZ)}));return n.addTo(this.listenerGroup),i.onSubscribeChange.once((()=>{n.removeListener()})).addTo(this.listenerGroup),t}loadRoom(e,t){let i;i=rs||!0===l.Bm.current.isLoadedFromCache?(0,A.Bc)(e):(0,A.sH)(e,window.initialRoomDossier),i.then((i=>{let s,o;y.V.fire(i),void 0!==this.cleanupLastRoomCallback&&this.cleanupLastRoomCallback(),this.currentRoom=e,(0,T.RN)(e),l.Aw.setState(i),this.currentChatConnection=this.createChatConnection(i),this.sessionMetrics.bindChatConnection(this.currentChatConnection),ss(i.room,i.roomTitle),this.currentChatConnection.event.titleChange.listen((e=>{ss(i.room,e)})).addTo(this.listenerGroup),R.EZ.listen((e=>{this.currentChatConnection.updateEnterLeaveSettings(e.roomEntryFor,e.roomLeaveFor)})).addTo(this.listenerGroup),this.audioHolder.loadTipSounds(),this.currentChatConnection.event.playSound.listen((e=>{if(!(0,D.gA)())return;let t=this.player.playerComponent.getVolume();this.player.playerComponent instanceof P.vS&&(t=this.player.playerComponent.getMuted()?0:this.player.playerComponent.getVolume()),isNaN(t)?error("playerComponent.getVolume() is NaN.",{},"VIDEO_"):this.audioHolder.playSound(e,i.userChatSettings.tipVolume*t/100)})).addTo(this.listenerGroup),this.player.setIsWidescreen(i.isWidescreen),this.cleanupLastRoomCallback=()=>{clearInterval(s),window.clearTimeout(o),this.currentChatConnection.disconnect(),this.player.playerComponent.stop(),this.listenerGroup.removeAll(),w.Gr.fire(void 0),this.cleanupLastRoomCallback=void 0};const r={dossier:i,chatConnection:this.currentChatConnection};this.player.playerComponent.handleRoomLoaded(r),this.player.playerComponent.playbackStart.listen((()=>{(0,a.r)(i,this.player.playerComponent)})).addTo(this.listenerGroup),t&&function(e){if((0,n.lj)())if("mobile"===window.location.pathname.replace(/\//g,"")){const t=(0,E.JO)(window.location.search);t.b=e.room;const i=(0,E.Go)(t);window.history.pushState(e.room,e.roomTitle,(0,m._Y)(`./?${i}`))}else{const t=(0,E.JO)(window.location.search),i=(0,E.Go)(t);let s="";""!==i&&(s=`?${i}`),window.history.pushState(e.room,e.roomTitle,(0,m._Y)(`/${e.room}/${s}`))}}(i),w.X0.fire(r),this.currentChatConnection.event.statusChange.listen((e=>{var t;this.headerRoomInfo.updateStatus(e.currentStatus);const i="offline"===e.currentStatus,n=["privatewatching","privatespying"],r=n.includes(e.currentStatus),a=n.includes(e.previousStatus);switch(i||"notconnected"!==e.previousStatus&&!r&&!a||(clearInterval(s),s=window.setInterval((()=>{this.currentChatConnection.updateRoomCount(r)}),1e3*(r?5:90)),o=window.setTimeout((()=>{this.currentChatConnection.updateRoomCount(r||a)}),2e3)),e.currentStatus){case"passwordprotected":null===(t=this.cleanupLastRoomCallback)||void 0===t||t.call(this),h.U.forceUpdateAuthorization(),this.passwordPrompt(this.currentChatConnection.room(),!1);break;case"offline":this.player.playerComponent.stop()}if(this.currentChatConnection.inPrivateRoom()){const e=this.portraitContents.getPrivateShowChatContents();if(void 0===e)return;var l;this.privateTabPureChat.isMirroringComponent(e)||(null===(l=this.privateTabPureChat)||void 0===l||l.dispose(),this.privateTabPureChat=new me.X(e)),this.player.videoControls.setPureChat(this.privateTabPureChat)}else this.player.videoControls.setPureChat(this.chatTabPureChat)})).addTo(this.listenerGroup)})).catch((t=>{let i="",n="",o="";if("string"==typeof t){const e=t.match(/(?:[^\s,":{}]+|"[^"]*")+/g);if(null!==e){const t=e.map((e=>e.replace(/"/g,"")));let s=t.indexOf("code");-1!==s&&(i=t[s+1]),s=t.indexOf("detail"),-1!==s&&(n=t[s+1])}o=t}else if(void 0!==t.xhr&&void 0!==t.xhr.responseText&&""!==t.xhr.responseText){if("application/json"!==t.xhr.getResponseHeader("Content-Type"))return void error("Error reading room dossier error",{room:e,error:t.xhr.responseText});const r=new s.N6(t.xhr.responseText);i=r.getString("code",!1),n=r.getString("detail",!1),o=t.xhr.responseText}else t instanceof TypeError&&(i="access-denied");this.handleRoomAccessCode(e,i,n)||error("Error parsing room dossier error",{room:e,error:o})}))}handleRoomAccessCode(e,t,i){switch(t){case o.N.AccessDenied:return(0,p.Q$)(`Access Denied for room: ${e}\n\n${i}`,(()=>{rs||(0,D.EO)()})),!0;case o.N.Unauthorized:return this.isLoadFromBFCacheAfterSigningOut&&(this.isLoadFromBFCacheAfterSigningOut=!1),window.location.href=(0,m._Y)(`/auth/login/?next=${window.location.pathname}${window.location.search}`),!0;case o.N.PasswordProtected:return this.isLoadFromBFCacheAfterSigningOut?(this.isLoadFromBFCacheAfterSigningOut=!1,window.location.href=(0,m._Y)(`/auth/login/?next=${window.location.pathname}`),!0):(this.passwordPrompt(e,!0),!0);case o.N.Ok:return!0}return!1}preventCertainTouchActions(){const e=()=>{const e=document.getElementById("entrance_terms");return null!==e&&"none"!==e.style.display};let t,i=!1;(0,u.wu)("touchstart",window,(s=>{if(e())return;const n=s.touches.length>1;n&&!i&&((0,T.bT)("PinchZoomStarted"),i=!0),n&&(0,ge.u)()&&s.cancelable&&s.preventDefault(),t=s})),(0,u.wu)("touchmove",window,(i=>{var s,n;if(e()||os())return;const o=i.touches[0].pageY;o!==(null!==(s=null===(n=t)||void 0===n?void 0:n.touches[0].pageY)&&void 0!==s?s:o)&&(0,ge.u)()&&i.cancelable&&i.preventDefault()})),(0,u.wu)("touchend",window,(s=>{e()||(t=void 0,i=!1)}))}adjustDimensions(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||!(0,fe.K$)())this.element.style.top="0px",this.element.style.height="100%",this.element.style.minHeight="100%",this.hidePushMenu(),this.mobileDismissibleMessages.hideElement();else{this.mobileDismissibleMessages.showElement();const e=this.mobileDismissibleMessages.element.offsetHeight,t=this.siteHeaderHeight+e;this.element.style.top=`${t}px`,this.element.style.height=`calc(100% - ${t}px)`,this.element.style.minHeight=`calc(100% - ${t}px)`}}repositionChildren(){super.repositionChildren(),this.adjustDimensions(this.isFullscreen)}hidePushMenu(){X.nD.fire(!1),this.pushMenuOverlay.style.display="none",this.pushMenu.classList.remove("pushmenu-animate"),this.siteHeader.classList.remove("push-page-content"),this.pushMenuContainer.style.display="none"}}},5431:(e,t,i)=>{"use strict";i.d(t,{i:()=>G});var s=i(7623),n=i(20),o=i(1474),r=i(9447),a=i(7964),l=i(9461),h=i(1679),d=i(6784),c=i(213),u=i(6844),p=i(9332),m=i(2939),g=i(6669),v=i(2709),f=i(3955),y=i(8423),b=i(1779),w=i(7407),C=i(9321),S=i(1282),x=i(34),T=i(8255),P=i(2609),k=i(8785),A=i(2146),M=i(7569),R=i(2091),I=i(4947),E=i(2945),L=i(4110),D=i(3158),B=i(5256),U=i(7925),_=i(8096);function F(){if((0,s.OF)())return!1;if(/UCBrowser|Firefox|SamsungBrowser/.test(navigator.userAgent))return!1;if(/Chrome\//.test(navigator.userAgent)){const e=navigator.userAgent.split("Chrome/")[1].split(".")[0];if(parseInt(e)<72)return!1}return!0}var N=i(4580),O=i(3939),H=i(8936),W=i(3124);const $=I.R.mobileTipMessageLabelLandscape,V=I.R.mobileTipMessageLabelPortrait,z="videoControls";class G extends v.u{constructor(e,t,i){var u;super(),this.mobileDismissibleMessages=i,this.setPlayerVisibilityEvent=new y.c_("setPlayerVisibilityEvent"),this.centerPlayerEvent=new y.c_("centerPlayerEvent"),this.requestFullscreenEvent=new y.c_("requestFullscreenEvent"),this.setPlayerComponentVolumeMutedEvents=new y.c_("setPlayerComponentVolumeMutedEvents"),this.forceHlsPlayerEvent=new y.c_("forceHlsPlayerEvent"),this.playerComponentReadjustForceHlsOverlayOrderEvent=new y.c_("playerComponentReadjustForceHlsOverlayOrderEvent"),this.showJpegPlayerComponentImage=new y.c_("showJpegPlayerComponentImage"),this.toggleFullscreen=new y.c_("toggleFullscreen"),this.requestHlsPlayerPlayIfPaused=new y.c_("requestHlsPlayerPlayIfPaused"),this.state={volume:100,isMuted:!0},this.tokenBalance=0,this.isVisible=!0,this.isTipFormActive=!1,this.isClickingAButton=!1,this.roomType=k.CJ.Public,this.layoutHandler=new B.z,this.layoutConstraints=new B.f(this.constructor.name),this.airPlayIconConstraint=0,this.autofillAccessoryConstraint=0,this.forceHlsTriggered=!1,this.forceHlsPlayButtonCreated=!1,this.hlsWaitingForInteraction=!1,this.userUnmuted=!1,this.wasInPortrait=(0,W.K$)(),this.headerHeight=0,this.initialFullscreen=!1,this.mobileRoot=t,this.playerIsFullscreen=e.isFullscreen,this.playerUsingAirPlay=e.usingAirPlay,this.playerUsingChromecast=e.usingChromecast,e.playerComponent instanceof C.O?(this.playerIsJPEG=!0,this.playerIsHlsPlaceholder=e.playerComponent.getIsHlsPlaceholder()):(this.playerIsJPEG=!1,this.playerIsHlsPlaceholder=!1),this.playerElement=e.element;const p=(0,E.JO)(window.location.search).disable_sound;(void 0!==p&&"true"===p.toLowerCase()||"1"===p)&&(this.state.isMuted=!0);const g=document.querySelector("#static-header");null!==g&&(this.headerHeight=g.offsetHeight),(0,r.fZ)(this.element,"MobileVideoControls"),this.element.style.position="fixed",this.element.style.width="inherit",this.element.style.top="0px",this.element.style.display="flex",this.element.style.flexDirection="column",this.element.style.alignItems="center",this.element.style.justifyContent="space-between",this.element.style.zIndex=""+(P.k.Z_INDEX-1),this.playerOverlay=document.createElement("div"),this.playerOverlay.style.position="absolute",this.playerOverlay.style.width="100%",this.playerOverlay.style.height="100%",this.playerOverlay.dataset.testid="player-overlay",this.element.appendChild(this.playerOverlay),this.initControls(),this.constructUI(),this.touchControls=new O.G(this.playerOverlay,this.playerElement),this.bindTouchControlsEvent(),m.X0.listen((e=>{this.currentRoomContext=e,this.chatConnection=e.chatConnection,this.roomName=e.chatConnection.room(),e.chatConnection.event.statusChange.listen((e=>{this.updatePlayerHiddenStatus(e.currentStatus),this.showHideHlsPlayButton(e.currentStatus),this.roomType="privatewatching"===e.currentStatus?k.CJ.Private:k.CJ.Public,this.tokenBalanceLink.onclick=()=>{const e=l.Bm.current.PurchaseEventSources.TOKEN_SOURCE_TIP_CALLOUT;(0,h.di)({source:e,roomType:this.roomType})}})),this.playerIsJPEG&&this.playerIsHlsPlaceholder&&!this.forceHlsPlayButtonCreated&&(this.forceHlsPlayButtonCreated=!0,this.createForceHlsPlayButton(),this.showHideHlsPlayButton(e.dossier.roomStatus)),this.updatePlayerHiddenStatus(e.dossier.roomStatus),this.userUnmuted||this.state.isMuted||(this.userUnmuted=!0),this.updateVolumeImage(),this.playerIsJPEG||this.updatePlayerVolume(),this.updateTokenBalance(isNaN(e.dossier.tokenBalance)?0:e.dossier.tokenBalance)})),L.nw.listen((()=>{this.setFullscreen(!1)})),m.Gr.listen((()=>{(0,a.Tj)()})),L.kw.listen((()=>{this.mute()})),o.D.listen((e=>{isNaN(e.tokens)||this.updateTokenBalance(e.tokens)})),U.Ko.listen((e=>{if(this.isAnyInputFocused())this.closeActiveInput(),this.showControls(),this.isTipFormActive&&this.hideTipForm();else{if(e===this.isVisible)return void this.showControls();this.isVisible?this.isTipFormActive?this.hideTipForm():this.hideControls():this.showControls()}})),U.Dd.listen((()=>{this.isVisible&&this.showControls()})),U.Lb.listen((e=>{this.setFullscreen(!1),(0,W.K$)()||(0,c.J)(e===n.Cr.PM?I.R.rotateForPMs:I.R.rotateForDMs)})),x.Lz.listen((()=>{this.forceHlsOverlayFunc()}),!1),N.nD.listen((e=>{e?this.hideControls():this.repositionChildren()})),(0,d.wu)("scroll",window,(()=>{this.updateTokenBalancePosition()})),W.DQ.listen((()=>{this.wasInPortrait===(0,W.K$)()?window.setTimeout((()=>{this.onOrientationChange()}),0):this.onOrientationChange(),window.setTimeout((()=>{this.smallestPortraitHeight=void 0,this.smallestLandscapeWidth=void 0}),10)})),(0,d.wu)("resize",window,(()=>{void 0!==this.mobilePureChat&&this.mobilePureChat.scrollToBottom()})),null===(u=window.visualViewport)||void 0===u||u.addEventListener("resize",(()=>{var e,t;window.visualViewport&&(0,s.m0)()&&(0,D.Q)()&&(this.smallestPortraitHeight=Math.min(null!==(e=this.smallestPortraitHeight)&&void 0!==e?e:window.visualViewport.height,window.visualViewport.height),this.smallestLandscapeWidth=Math.min(null!==(t=this.smallestLandscapeWidth)&&void 0!==t?t:window.visualViewport.width,window.visualViewport.width))})),b._c.listen((()=>{(0,b.aS)()!==this.playerIsFullscreen&&(this.setFullscreen(this.playerIsFullscreen,!0),(this.playerUsingAirPlay||this.playerUsingChromecast)&&this.canResizePlayerInFullscreen()&&void 0!==this.mobilePureChat&&this.mobilePureChat.setPortraitHeight((0,H.mJ)()-100))})),this.showControls(),this.repositionChildren();const v=document.createElement("style");if(v.innerHTML="\n            .mobileFullscreenInput::-webkit-input-placeholder {\n                color: black;\n                opacity: 0.65;\n            }\n            .mobileFullscreenInput:-ms-input-placeholder {\n                color: black;\n                opacity: 0.65;\n            }\n            .mobileFullscreenInput:-moz-placeholder {\n                color: black;\n                opacity: 0.65;\n            }\n            .mobileFullscreenInput::-moz-placeholder {\n                color: black;\n                opacity: 0.65;\n            }\n        ",document.head.appendChild(v),this.layoutHandler.addListener(e.roomStatusNotifier.layoutConstraints),this.layoutHandler.addListener(this.layoutConstraints),(0,s.Pf)()){const t=window.localStorage.getItem(z);if(null!==t){const i=JSON.parse(t);this.state.isMuted=!e.playerComponent.supportsAutoplayWithAudio||i.isMuted,this.initialFullscreen=i.isFullscreen}else this.state.isMuted=!e.playerComponent.supportsAutoplayWithAudio}}initControls(){this.createVolumeImg(),this.createCenterControlsDiv(),this.createChatForm(),this.createTipForm(),this.createSendButton(),this.createTokenBalance(),this.createFullscreenImg(),this.createResizeDragLabel(),this.airPlayImg=this.createCastingImage("airplay.svg"),this.chromecastImg=this.createCastingImage("chromecast.svg"),this.createTopBar(),this.createBottomBar()}constructUI(){this.element.appendChild(this.topBar),this.element.appendChild(this.bottomBar),this.centerControlsDiv.appendChild(this.chatForm),this.centerControlsDiv.appendChild(this.tipForm),this.centerControlsDiv.appendChild(this.sendButton)}createTopBar(){this.topBar=document.createElement("div"),this.topBar.style.width="100%",this.topBar.style.display="flex",this.topBar.style.alignItems="center",this.topBar.style.padding="6px",this.topBar.style.boxSizing="border-box",this.topBar.appendChild(this.airPlayImg),this.topBar.appendChild(this.chromecastImg),this.topBar.appendChild(this.tokenBalanceWrapper)}createBottomBar(){this.bottomBar=document.createElement("div"),this.bottomBar.classList.add("bottomBar"),this.bottomBar.style.width="100%",this.bottomBar.style.display="flex",this.bottomBar.style.alignItems="center",this.bottomBar.style.justifyContent="center",this.bottomBar.style.boxSizing="border-box",this.bottomBar.appendChild(this.volumeImgWrapper),this.bottomBar.appendChild(this.resizeDragLabel),this.bottomBar.appendChild(this.centerControlsDiv),this.bottomBar.appendChild(this.fullscreenImgWrapper)}onOrientationChange(){this.show(),(0,W.K$)()?this.setPlaceholder(this.tipMessageInput,V):this.setPlaceholder(this.tipMessageInput,$),!this.playerIsFullscreen&&this.isTipFormActive&&this.hideTipForm(),(0,a.Tj)(),this.closeActiveInput(),void 0!==this.mobilePureChat&&(this.mobilePureChat.setVisible(this.playerIsFullscreen||!(0,W.K$)()),this.mobilePureChat.scrollToBottom()),this.wasInPortrait=(0,W.K$)()}updatePlayerHiddenStatus(e){switch(e){case"offline":case"notconnected":case"away":case"privatenotwatching":case"hidden":case"passwordprotected":this.setPlayerVisibilityEvent.fire(!0);break;default:this.setPlayerVisibilityEvent.fire(!1)}}createVolumeImg(){this.volumeImgWrapper=document.createElement("div"),this.volumeImgWrapper.style.position="relative",this.volumeImgWrapper.style.display="inline-block",this.volumeImg=document.createElement("img"),this.volumeImg.style.height="42px",this.volumeImg.style.width="42px",this.volumeImg.style.boxSizing="border-box",this.volumeImg.style.padding="0",this.volumeImg.style.cursor="pointer",this.volumeImg.style.border="none",this.volumeImg.style.background="none",this.volumeImg.style.zIndex="1",this.volumeImg.style.marginRight="10px",this.volumeImgWrapper.appendChild(this.volumeImg);const e=this.volumeImgWrapper,t=document.createElement("div");(0,f.ZM)(t,{position:"absolute",top:"-6px",bottom:"-6px",left:"-6px",right:"0"}),this.volumeImgWrapper.appendChild(t),(0,d.wu)("click",e,(()=>{this.isVisible?(this.showControls(),this.playerIsJPEG?this.hlsWaitingForInteraction?this.forceHlsOverlayFunc(!0):this.forceHLS():((0,w.bT)("ToggleMute",{newState:!this.state.isMuted}),this.state.isMuted?this.unmute():this.mute())):this.showControls()}))}createCenterControlsDiv(){this.centerControlsDiv=document.createElement("div"),this.centerControlsDiv.style.opacity="0",this.centerControlsDiv.style.display="none",this.centerControlsDiv.style.zIndex="1",this.centerControlsDiv.style.height="42px",this.centerControlsDiv.style.gridTemplateColumns="1fr auto",this.centerControlsDiv.style.columnGap="10px",this.centerControlsDiv.style.flex="1",(0,A.Ve)(this.centerControlsDiv,"opacity 250ms")}createChatForm(){this.chatForm=document.createElement("form"),this.chatInput=new g.wi((()=>this.safeSubmit()),R.hk),this.chatExitButton=document.createElement("button"),this.chatExitImg=document.createElement("img"),this.chatExitButton.appendChild(this.chatExitImg),this.styleForm(this.chatForm),this.chatInput.element.classList.add("mobileFullscreenInput"),this.chatInput.element.style.textOverflow="",this.chatInput.element.style.verticalAlign="bottom",this.chatInput.element.style.webkitUserSelect="text",this.chatInput.setPlaceholder(I.R.mobileChatLabel,"placeholder"),this.chatInput.element.dataset.testid="chat-input",this.styleInput(this.chatForm),this.chatForm.style.overflow="hidden",this.chatForm.style.alignItems="center",this.showChatForm(),this.chatInput.element.style.flex="1",this.chatInput.element.style.height="",this.chatInput.element.style.textOverflow="ellipsis",this.chatInput.element.style.overflow="hidden",this.chatInput.element.style.lineHeight="26px",this.chatInput.element.style.fontSize="16px",this.chatInput.element.style.fontWeight="bold",this.chatInput.element.style.fontFamily="UbuntuRegular, Arial, Helvetica, sans-serif",this.chatForm.appendChild(this.chatInput.element),this.chatForm.appendChild(this.chatExitButton),this.chatExitButton.type="button",this.chatExitButton.style.width="36px",this.chatExitButton.style.height="36px",this.chatExitButton.style.padding="0",this.chatExitButton.style.margin="0",this.chatExitButton.style.border="none",this.chatExitButton.style.borderRadius="18px",this.chatExitButton.style.outline="none",this.chatExitButton.style.backgroundColor="transparent",this.chatExitButton.style.opacity="1",this.chatExitButton.style.display="none",this.chatExitImg.src=`${STATIC_URL_MOBILE}exit-chat.svg`,this.chatExitImg.style.width="50%",this.chatExitImg.style.height=200/7+"%",this.chatExitImg.style.opacity="1",this.chatExitImg.style.display="none",this.chatExitButton.onmousedown=e=>{e.preventDefault(),this.isClickingAButton=!0},this.chatExitButton.onmouseup=e=>{e.preventDefault(),this.isClickingAButton=!1},this.chatExitButton.onclick=e=>{e.preventDefault(),this.chatInput.blur(),this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc(!1)},(0,d.wu)("mousedown",this.chatInput.element,(()=>{(0,a.QQ)(this)||this.isVisible&&((0,A.Ve)(this.centerControlsDiv,"none"),this.centerControlsDiv.style.opacity="1")})),(0,d.wu)("focus",this.chatInput.element,(()=>{this.showControls(),this.inputScrollIntoViewFix(),this.inputFix(!0),this.repositionChildren()})),(0,d.wu)("blur",this.chatInput.element,(()=>{(0,A.Ve)(this.centerControlsDiv,"opacity 250ms"),this.isClickingAButton||(this.showControls(),this.closeKeyboardFix(),this.inputFix(!1),this.repositionChildren())})),this.chatForm.onsubmit=e=>{e.preventDefault(),this.chatInput.submit()}}inputFix(e){(0,_.Jo)()&&(0,W.K$)()&&(e?((0,f.ZM)(this.centerControlsDiv,{bottom:"50px"}),void 0!==this.mobilePureChat&&(this.mobilePureChat.inputFocusOffset=50,(0,f.ZM)(this.mobilePureChat.element,{bottom:`${65+this.centerControlsDiv.offsetHeight}px`}))):((0,f.ZM)(this.centerControlsDiv,{bottom:"0"}),void 0!==this.mobilePureChat&&(this.mobilePureChat.inputFocusOffset=0),this.repositionChildrenRecursive()))}inputScrollIntoViewFix(){(0,s.OF)()&&!(0,W.K$)()&&(document.documentElement.scrollTop=(0,H.mJ)()),q()&&(this.autofillAccessoryConstraint=50,this.updateConstraints())}closeKeyboardFix(){q()&&(this.autofillAccessoryConstraint=0,this.updateConstraints())}safeSubmit(){return!(0,u.rC)(I.R.loggedInToSendAMessage)&&this.cleanAndSendMessage(this.chatInput.getText())}cleanAndSendMessage(e){if(""===e.trim())return!1;const t=(0,M.PR)(e);switch(t.messageType){case M.gW.TipRequest:this.chatInput.clearText();const i=t;this.showTipForm(i.messageData);break;case M.gW.ToggleDebugMode:if(void 0===this.chatConnection)return(0,c.Q$)("Unable to enable debug mode"),!1;this.chatConnection.toggleAppDebugging();break;case M.gW.Shortcode:if(void 0===this.chatConnection)return(0,c.Q$)("Unable to send shortcode"),!1;const s=t,o=this.shortcodeErrorMsg(s,e);if(void 0!==o)return this.chatConnection.event.roomNotice.fire({messages:[[(0,p.H5)(o)]],showInPrivateMessage:!0}),!1;this.chatConnection.sendShortcode(s);break;default:if(void 0===this.chatConnection)return(0,c.Q$)("Unable to send message"),!1;if(this.chatConnection.inPrivateRoom()){const t={message:e,username:this.chatConnection.isBroadcasting?this.chatConnection.getPrivateShowUser():this.chatConnection.room(),source:"mobilePM",roomName:this.chatConnection.room()};(0,n.F_)(t).catch((e=>{(0,c.Q$)(e.errorMessage)}))}else this.chatConnection.sendRoomMessage(e);U.Wr.fire(void 0)}return!0}shortcodeErrorMsg(e,t){var i;return!0===(null===(i=this.chatConnection)||void 0===i?void 0:i.inPrivateRoom())?I.R.shortcodeNotSupportedInPrivates:0===e.shortcodes.length?M.fM.errorBehindShortcode(t):void 0}createSendButton(){this.sendButton=document.createElement("button"),this.sendButton.classList.add("sendButton"),this.sendButton.innerText=I.R.sendTipButtonCAPS,this.sendButton.dataset.testid="send-tip-button",this.sendButton.style.outline="none",this.sendButton.style.border="none",this.sendButton.style.height="42px",this.sendButton.style.fontSize="16px",this.sendButton.style.fontFamily="UbuntuBold, Arial, Helvetica, sans-serif",this.sendButton.style.color="rgb(240,240,240)",this.sendButton.style.background="rgba(21, 107, 149, 0.75)",this.sendButton.style.padding="5px 8px",this.sendButton.style.borderRadius="6px",this.sendButton.style.boxSizing="border-box",this.sendButton.style.cursor="pointer",this.sendButton.style.display="inline-block",this.sendButton.style.textAlign="center",this.sendButton.onmousedown=e=>{e.preventDefault(),this.isClickingAButton=!0},this.sendButton.onmouseup=e=>{e.preventDefault(),this.isClickingAButton=!1},this.sendButton.onclick=()=>{const e=this.isChatInputFocused()?"message":"tip";(0,u.rC)(`You must be logged in to send a ${e}. Click "OK" to login.`)?this.closeActiveInput():(this.isTipFormActive?this.submitTipForm():this.isChatInputFocused()?this.chatInput.submit():this.showTipForm(),this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc(!1))}}createTipForm(){this.tipForm=document.createElement("form"),this.tipMessageInput=document.createElement("input"),this.tipMessageInput.dataset.testid="tip-message-textarea",this.tipAmountContainer=document.createElement("div");const e=document.createElement("label"),t=document.createElement("div");this.tipAmountInput=(0,h.Gz)("");const i=document.createElement("button");this.tipForm.appendChild(this.tipMessageInput),this.tipForm.appendChild(this.tipAmountContainer),this.tipForm.appendChild(i),this.tipAmountContainer.appendChild(e),this.tipAmountContainer.appendChild(t),t.appendChild(this.tipAmountInput),this.styleForm(this.tipForm),this.styleInput(this.tipMessageInput),this.styleInput(this.tipAmountContainer),this.styleInput(this.tipAmountInput),(0,W.K$)()?this.setPlaceholder(this.tipMessageInput,V):this.setPlaceholder(this.tipMessageInput,$),this.tipForm.classList.add("tipForm"),this.tipForm.style.columnGap="10px",this.tipForm.style.display="none",this.tipMessageInput.classList.add("mobileFullscreenInput"),this.tipMessageInput.style.minWidth="0",this.tipAmountContainer.style.display="flex",this.tipAmountContainer.style.padding="4px 5px",e.innerText=`${I.R.amountText} `,e.style.opacity="0.7",e.style.lineHeight="34px",t.style.overflow="hidden",t.style.padding="0",t.style.flex="1",this.tipAmountInput.style.background="white",this.tipAmountInput.style.height="34px",this.tipAmountInput.style.lineHeight="34px",this.tipAmountInput.style.textAlign="center",this.tipAmountInput.style.margin="0",this.tipAmountInput.style.padding="0 6px",this.tipAmountInput.style.opacity="0.9",this.tipAmountInput.style.width="100%",this.tipAmountInput.style.color="black",(0,d.wu)("input",this.tipAmountInput,(()=>{(0,h.Pt)(this.tipAmountInput),this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc(!1)})),i.style.visibility="hidden",i.style.width="0",i.style.height="0",i.style.position="absolute",i.type="submit",this.tipMessageInput.onfocus=()=>{this.inputScrollIntoViewFix(),this.inputFix(!0)},this.tipAmountInput.onfocus=()=>{this.inputScrollIntoViewFix(),this.inputFix(!0),(0,s.OF)()?(0,_.Jo)()?window.setTimeout((()=>{this.tipAmountInput.setSelectionRange(0,this.tipAmountInput.value.length)}),0):this.tipAmountInput.setSelectionRange(0,this.tipAmountInput.value.length):this.tipAmountInput.select()},this.tipAmountInput.onblur=()=>{""===this.tipAmountInput.value&&(this.tipAmountInput.value="0"),this.closeKeyboardFix(),this.inputFix(!1)},this.tipAmountInput.onkeydown=e=>{e.metaKey||"Unidentified"===e.key||"Backspace"===e.key||"Enter"===e.key||"0123456789".includes(e.key)||e.preventDefault()},this.tipMessageInput.onblur=()=>{this.closeKeyboardFix(),this.inputFix(!1)},this.tipForm.onsubmit=e=>{e.preventDefault(),this.submitTipForm()}}notifyPlayerChangeSize(){const e=Math.abs(this.playerScroll-this.playerElement.scrollLeft),t=Math.abs(this.playerHeight-this.playerElement.offsetHeight);if(e<10&&t<10)return;let i=S.Bu;void 0!==this.currentRoomContext&&!0===this.currentRoomContext.dossier.isWidescreen&&(i=S.qL),e*i>t?U.BG.fire({changeType:1}):U.BG.fire({changeType:0})}submitTipForm(){if(this.closeActiveInput(),!(0,h.sI)(this.tipAmountInput.value))return void(0,c.Q$)(I.R.tipAmountInvalid);const e=parseInt(this.tipAmountInput.value);e>this.tokenBalance?(0,h.qr)(I.R.notEnoughTokensMessage,l.Bm.current.PurchaseEventSources.TOKEN_SOURCE_LOW_TOKEN_BALANCE,this.roomType):((0,w.bT)("SendTipClicked",{amount:e,source:"mobile_fullscreen"}),e>100?(0,c.mf)(I.R.tipConfirmationMessage(e),(()=>this.mySendTip(e))):this.mySendTip(e))}mySendTip(e){this.sendButton.disabled=!0,(0,o.ae)({roomName:this.roomName,tipAmount:this.tipAmountInput.value,message:`${this.tipMessageInput.value}`,source:"mobile",tipRoomType:this.roomType,tipType:"public",videoMode:"mobile"}).then((t=>{this.sendButton.disabled=!1,t.success?(0,w.bT)("SendTipSuccess",{amount:e,source:"mobile_fullscreen"}):void 0!==t.error?(0,c.Q$)(t.error):error("unknown send tip error"),this.tipMessageInput.value="",this.hideTipForm(),m.Ps.fire({amount:e,success:t.success}),void 0!==t.tipsInPast24Hours&&o.ew.fire({tokens:t.tipsInPast24Hours,roomName:this.roomName})})).catch((t=>{m.Ps.fire({amount:e,success:!1}),this.sendButton.disabled=!1,(0,c.Q$)("Unable to send tip"),error(`Error sending tip (${t})`)}))}styleForm(e){e.style.height="100%",e.style.boxSizing="border-box"}styleInput(e){e.style.textOverflow="ellipsis",e.style.whiteSpace="nowrap",e.style.overflow="hidden",e.style.height="42px",e.style.lineHeight="26px",e.style.fontSize="16px",e.style.fontWeight="bold",e.style.fontFamily="UbuntuRegular, Arial, Helvetica, sans-serif",e.style.border="none",e.style.outline="none",e instanceof HTMLInputElement&&(e.autocomplete="off"),e.style.color="rgb(15,15,15)",e.style.background="rgba(255, 255, 255, 0.5)",e.style.padding="8px 10px",e.style.borderRadius="6px",e.style.boxSizing="border-box",e.style.cursor="pointer",e.style.display="inline-block",e.style.textAlign="left"}createTokenBalance(){this.tokenBalanceWrapper=document.createElement("div"),this.tokenBalanceLink=document.createElement("a");const e=document.createElement("span");this.tokenBalanceAmount=document.createElement("span"),this.tokenBalanceWrapper.appendChild(this.tokenBalanceLink),this.tokenBalanceLink.appendChild(e),this.tokenBalanceLink.appendChild(this.tokenBalanceAmount),this.tokenBalanceWrapper.style.zIndex="2",this.tokenBalanceLink.target="_blank",this.tokenBalanceLink.style.display="none",this.tokenBalanceLink.style.textDecoration="none",this.tokenBalanceLink.style.fontWeight="bold",this.tokenBalanceLink.style.borderRadius="8px",this.tokenBalanceLink.style.padding="6px 12px",this.tokenBalanceLink.style.background="rgba(255, 255, 255, 0.6)",this.tokenBalanceLink.onclick=()=>{const e=l.Bm.current.PurchaseEventSources.TOKEN_SOURCE_MOBILE_VIDEO_CONTROLS;(0,h.di)({source:e,roomType:this.roomType})},e.textContent=`${I.R.balanceText} `,e.style.color="rgb(50, 50, 50)",this.tokenBalanceAmount.textContent="0 Tokens",this.tokenBalanceAmount.style.color="rgb(15, 15, 15)",this.tokenBalanceAmount.dataset.testid="mobile-token-balance"}createFullscreenImg(){this.fullscreenImgWrapper=document.createElement("div"),this.fullscreenImgWrapper.dataset.testid="mobile-fullscreen-button",this.fullscreenImgWrapper.style.position="relative",this.fullscreenImgWrapper.style.display="inline-block",this.fullscreenImg=document.createElement("img"),this.fullscreenImg.src=`${STATIC_URL_MOBILE}expand-1.svg`,this.fullscreenImg.style.height="42px",this.fullscreenImg.style.width="42px",this.fullscreenImg.style.boxSizing="border-box",this.fullscreenImg.style.padding="0",this.fullscreenImg.style.cursor="pointer",this.fullscreenImg.style.border="none",this.fullscreenImg.style.background="none",this.fullscreenImg.style.zIndex="1",this.fullscreenImg.style.borderRadius="21px",this.fullscreenImg.style.marginLeft="10px",this.fullscreenImgWrapper.appendChild(this.fullscreenImg);const e=this.fullscreenImgWrapper,t=document.createElement("div");(0,f.ZM)(t,{position:"absolute",top:"-6px",bottom:"-6px",left:"0",right:"-6px"}),this.fullscreenImgWrapper.appendChild(t),(0,d.wu)("click",e,(()=>{this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc(!1),this.isVisible?(this.showControls(),this.setFullscreen(!this.playerIsFullscreen)):this.showControls()}))}createResizeDragLabel(){this.resizeDragLabel=document.createElement("div"),this.resizeDragLabel.innerText=I.R.dragToResize,this.resizeDragLabel.style.backgroundColor="rgba(0,0,0,0.3)",this.resizeDragLabel.style.color="rgba(255,255,255,0.6)",this.resizeDragLabel.style.borderRadius="6px",this.resizeDragLabel.style.padding="5px",this.resizeDragLabel.style.textAlign="center",this.resizeDragLabel.style.pointerEvents="none",this.resizeDragLabel.style.textOverflow="ellipsis",this.resizeDragLabel.style.whiteSpace="nowrap",this.resizeDragLabel.style.overflow="hidden",this.resizeDragLabel.style.flex="1"}repositionChildren(){!(0,W.K$)()||this.playerIsFullscreen||this.playerUsingAirPlay||this.playerUsingChromecast?this.resizeDragLabel.style.display="none":this.resizeDragLabel.style.display="",this.updateIcons(),this.updateCenterControls(),this.updateSendButton(),this.updateChatExitButton(),window.setTimeout((()=>{this.updateChatInput()}),0),this.updateTokenBalancePosition(),this.adjustDimensions()}adjustDimensions(){const e=this.playerElement.getBoundingClientRect();if(this.element.style.width="inherit",this.isFullVideo()){var t;(0,b.aS)()?(this.element.style.height="calc(var(--vh, 1vh) * 100)",(0,s.m0)()&&window.visualViewport&&((0,W.K$)()?(0,D.Q)()&&(this.element.style.height=`${null!==(t=this.smallestPortraitHeight)&&void 0!==t?t:window.visualViewport.height}px`):(0,D.Q)()&&void 0!==this.smallestLandscapeWidth?this.element.style.width=`${this.smallestLandscapeWidth}px`:this.element.style.width=`${window.visualViewport.width}px`)):this.element.style.height="100%",this.element.style.top="0"}else{this.element.style.height=`${e.height}px`;const t=this.mobileDismissibleMessages.element.offsetHeight;this.element.style.top=`${this.headerHeight+t}px`}}updateIcons(){this.shouldHideIcons()?(this.fullscreenImgWrapper.style.display="none",this.volumeImgWrapper.style.display="none"):(this.fullscreenImgWrapper.style.display="inline",this.volumeImgWrapper.style.display="inline"),F()||(0,W.K$)()||(this.fullscreenImgWrapper.style.display="none")}updateCenterControls(){this.isFullVideo()?this.showCenterControls():this.hideCenterControls()}showCenterControls(){this.isVisible&&(this.centerControlsDiv.style.opacity="1",this.centerControlsDiv.style.pointerEvents="auto",this.centerControlsDiv.style.display="grid")}hideCenterControls(){this.centerControlsDiv.style.opacity="0",this.centerControlsDiv.style.pointerEvents="none",this.isFullVideo()||(this.centerControlsDiv.style.display="none")}updateChatExitButton(){this.isChatInputFocused()?(this.chatExitImg.style.display="inline-block",this.chatExitButton.style.display="block"):(this.chatExitImg.style.display="none",this.chatExitButton.style.display="none")}updateChatInput(){this.isChatInputFocused()?(this.chatInput.element.style.textOverflow="",this.chatInput.element.scrollLeft=this.chatInput.element.scrollWidth,this.chatInput.setCaretToEnd()):(this.chatInput.element.style.textOverflow="ellipsis",this.chatInput.element.scrollLeft=0)}isAnyInputFocused(){return this.isChatInputFocused()||this.isTipInputFocused()}closeActiveInput(){this.chatInput.element===document.activeElement?this.chatInput.blur():this.tipAmountInput===document.activeElement?this.tipAmountInput.blur():this.tipMessageInput===document.activeElement&&this.tipMessageInput.blur()}isChatInputFocused(){return this.chatInput.element===document.activeElement}isTipInputFocused(){return this.tipAmountInput===document.activeElement||this.tipMessageInput===document.activeElement}shouldHideIcons(){return this.isChatInputFocused()||this.isTipFormActive}showTipForm(e){this.isVisible||((0,A.Ve)(this.centerControlsDiv,"none"),this.showControls()),this.isTipFormActive=!0,this.tokenBalanceLink.style.display="block",this.chatForm.style.display="none",this.tipForm.style.display="grid",void 0!==e&&(void 0!==e.amount&&(this.tipAmountInput.value=e.amount.toString(),(0,h.Pt)(this.tipAmountInput)),void 0!==e.message&&(this.tipMessageInput.value=e.message)),this.tipAmountInput.focus(),this.repositionChildren()}hideTipForm(){this.isTipFormActive=!1,this.tokenBalanceLink.style.display="none",this.tipForm.style.display="none",this.showChatForm(),this.repositionChildren()}showChatForm(){this.chatForm.style.display="flex"}setFullscreen(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.playerIsFullscreen!==e&&(this.playerIsFullscreen=e,this.toggleFullscreen.fire(e),e?this.fullscreenImg.src=`${STATIC_URL_MOBILE}contract-1.svg`:(this.fullscreenImg.src=`${STATIC_URL_MOBILE}expand-1.svg`,this.isTipFormActive&&this.hideTipForm()),(0,a.Tj)(),void 0!==this.mobilePureChat&&((0,W.K$)()?this.mobilePureChat.setVisible(e):this.mobilePureChat.setVisible(!0)),this.centerPlayerEvent.fire(void 0),this.updateCenterControls(),this.repositionChildren(),this.saveSettings(),t||this.maybeUseFullscreenAPI(e))}maybeUseFullscreenAPI(e){F()&&(e?this.requestFullscreenEvent.fire(void 0):(0,b.Eh)())}updateSendButton(){this.isChatInputFocused()?(this.sendButton.innerText=I.R.sendCAPS,this.sendButton.dataset.testid="send-button"):(this.sendButton.innerText=I.R.sendTipButtonCAPS,this.sendButton.dataset.testid="send-tip-button")}updateVolumeImage(){this.state.isMuted||0===this.state.volume?this.volumeImg.src=`${STATIC_URL_MOBILE}muted.svg`:this.volumeImg.src=`${STATIC_URL_MOBILE}unmuted.svg`,(0,w.yC)(100,this.state.isMuted)}updatePlayerVolume(){this.userUnmuted||this.state.isMuted||(this.userUnmuted=!0,(0,w.bT)("UserUnmuted",{chatMode:"mobile"})),this.setPlayerComponentVolumeMutedEvents.fire({...this.state})}saveSettings(){if((0,s.Pf)()){const e={isMuted:this.state.isMuted,isFullscreen:this.playerIsFullscreen,volume:this.state.volume};window.localStorage.setItem(z,JSON.stringify(e))}}update(){this.updatePlayerVolume()}mute(){this.updateIsMuted(!0),this.update()}unmute(){this.updateIsMuted(!1),this.update()}updateTokenBalance(e){this.tokenBalance=e,this.tokenBalanceAmount.innerText=`${e} Tokens`}updateTokenBalancePosition(){const e=(0,f.YG)(this.airPlayImg)||(0,f.YG)(this.chromecastImg),t=this.airPlayImg.offsetWidth||this.chromecastImg.offsetWidth,i=t&&e?t:0;this.tokenBalanceWrapper.style.left=`${15+i}px`,this.isTipInputFocused()?(this.tokenBalanceWrapper.style.position="absolute",this.updateTokenBalanceTopProperty()):this.tokenBalanceWrapper.style.position="static"}updateTokenBalanceTopProperty(){const e=this.centerControlsDiv.offsetHeight,t=this.tokenBalanceLink.offsetHeight,i=(0,H.mJ)()-e-t-15;this.tokenBalanceWrapper.style.top=`${Math.min((0,H.d9)()+15,i)}px`}setPlaceholder(e,t){e.setAttribute("placeholder",t)}isFullVideo(){return this.playerIsFullscreen||!(0,W.K$)()}updateCastingStyling(e){"AirPlay"===e?this.airPlayImg.src=`${STATIC_URL_MOBILE}airplay-active.svg`:"Chromecast"===e?this.chromecastImg.src=`${STATIC_URL_MOBILE}chromecast-active.svg`:(this.airPlayImg.src=`${STATIC_URL_MOBILE}airplay.svg`,this.chromecastImg.src=`${STATIC_URL_MOBILE}chromecast.svg`),this.showControls()}createCastingImage(e){const t=document.createElement("img");return t.style.display="none",t.src=`${STATIC_URL_MOBILE+e}`,t.style.height="42px",t.style.width="42px",t.style.cursor="pointer",t.style.marginRight="6px",t.style.zIndex="1",(0,d.wu)("click",t,(()=>{this.showControls()})),t}showAirPlay(){this.airPlayImg.style.display="",this.airPlayIconConstraint=48,this.updateConstraints()}hideAirPlay(){this.airPlayImg.style.display="none",this.airPlayIconConstraint=0,this.updateConstraints()}showChromecast(){this.chromecastImg.style.display="",this.airPlayIconConstraint=48,this.updateConstraints()}hideChromecast(){this.chromecastImg.style.display="none",this.airPlayIconConstraint=0,this.updateConstraints()}updateConstraints(){this.layoutConstraints.setConstraints({top:this.airPlayIconConstraint,bottom:this.autofillAccessoryConstraint,left:this.airPlayIconConstraint,right:0,transitionTime:0})}showElement(){super.showElement("flex")}show(){this.showElement(),this.showControls()}hide(){this.hideElement()}showControls(){this.isVisible||(this.isFullVideo()||this.playerUsingAirPlay||this.playerUsingChromecast?this.resizeDragLabel.style.display="none":this.resizeDragLabel.style.display="",(0,A.Ve)(this.airPlayImg,"opacity none"),(0,A.Ve)(this.chromecastImg,"opacity none"),(0,A.Ve)(this.volumeImgWrapper,"opacity none"),(0,A.Ve)(this.fullscreenImgWrapper,"opacity none"),(0,A.Ve)(this.resizeDragLabel,"opacity none"),this.airPlayImg.style.opacity="1",this.chromecastImg.style.opacity="1",this.volumeImgWrapper.style.opacity="1",this.fullscreenImgWrapper.style.opacity="1",this.resizeDragLabel.style.opacity="1",this.isVisible=!0),this.updateCenterControls(),clearTimeout(this.opacityTimer),this.opacityTimer=window.setTimeout((()=>{this.hideControls()}),3500)}hideControls(){!this.isVisible||this.isChatInputFocused()||this.isTipFormActive||this.playerUsingAirPlay||this.playerUsingChromecast||((0,A.Ve)(this.airPlayImg,"opacity 250ms"),(0,A.Ve)(this.chromecastImg,"opacity 250ms"),(0,A.Ve)(this.volumeImgWrapper,"opacity 250ms"),(0,A.Ve)(this.fullscreenImgWrapper,"opacity 250ms"),(0,A.Ve)(this.resizeDragLabel,"opacity 250ms"),this.airPlayImg.style.opacity="0",this.chromecastImg.style.opacity="0",this.volumeImgWrapper.style.opacity="0",this.fullscreenImgWrapper.style.opacity="0",this.resizeDragLabel.style.opacity="0",this.hideCenterControls(),this.isVisible=!1)}updateVolume(e){this.state.volume=e,this.updateVolumeImage()}updateIsMuted(e){this.state.isMuted=e,this.updateVolumeImage()}updateAndSaveVolume(e){this.updateVolume(e),this.saveSettings()}updateAndSaveIsMuted(e){this.updateIsMuted(e),this.saveSettings()}getControlBarHeight(){return 0}setPureChat(e){e!==this.mobilePureChat&&(void 0!==this.mobilePureChat&&(this.layoutHandler.removeListener(this.mobilePureChat.layoutConstraints),this.removeChild(this.mobilePureChat)),this.mobilePureChat=e,this.addChild(this.mobilePureChat),this.mobilePureChat.setVisible(this.playerIsFullscreen||!(0,W.K$)()),this.layoutHandler.addListener(this.mobilePureChat.layoutConstraints))}forceHLS(){void 0!==this.currentRoomContext?((0,w.bT)("ForceHLS"),this.forceHlsPlayerEvent.fire({roomContext:this.currentRoomContext}),this.unmute(),N.Io.fire(void 0)):error("unexpected switch to hls",{},"VIDEO_")}showHideHlsPlayButton(e){void 0!==this.playButtonContainer&&void 0!==this.forceHlsOverlay&&((0,T.x_)(e)?(this.playButtonContainer.style.display="flex",this.forceHlsOverlay.style.display=""):(this.playButtonContainer.style.display="none",this.forceHlsOverlay.style.display="none"))}forceHlsOverlayFunc(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.hlsWaitingForInteraction&&void 0!==this.currentRoomContext&&!this.forceHlsTriggered&&(void 0!==this.forceHlsOverlay&&null!==this.forceHlsOverlay.parentElement&&(this.forceHlsOverlay.parentElement.removeChild(this.forceHlsOverlay),this.forceHlsOverlay=void 0),void 0!==this.playButtonContainer&&null!==this.playButtonContainer.parentElement&&(this.playButtonContainer.parentElement.removeChild(this.playButtonContainer),this.playButtonContainer=void 0),this.forceHlsTriggered=!0,this.hlsWaitingForInteraction=!1,(0,w.bT)("ForceHLS"),this.forceHlsPlayerEvent.fire({roomContext:this.currentRoomContext,unmute:e}),this.element.style.zIndex=""+(P.k.Z_INDEX-1))}createHlsPlayOverlay(){this.forceHlsOverlay=document.createElement("div"),this.element.style.zIndex="100",this.forceHlsOverlay.style.width="100%",this.forceHlsOverlay.style.height="100%",this.forceHlsOverlay.style.position="absolute",this.forceHlsOverlay.style.top="0",this.forceHlsOverlay.style.left="0",this.forceHlsOverlay.style.zIndex="99",(0,d.wu)("click",this.forceHlsOverlay,(()=>{this.forceHlsOverlayFunc()})),(0,d.wu)("click",this.element,(()=>{this.forceHlsOverlayFunc()})),this.playerComponentReadjustForceHlsOverlayOrderEvent.fire(this.forceHlsOverlay)}createForceHlsPlayButton(){if(this.playerIsJPEG){this.hlsWaitingForInteraction=!0,this.playButtonContainer=document.createElement("div");const e=document.createElement("img");e.src=`${STATIC_URL}play-inactive.svg`,e.style.width="30px",e.style.height="30px",e.style.cursor="pointer",this.playButtonContainer.style.cursor="pointer",this.playButtonContainer.style.width="70px",this.playButtonContainer.style.height="70px",this.playButtonContainer.style.borderRadius="50%",this.playButtonContainer.style.backgroundColor="rgba(0,0,0,0.25)",this.playButtonContainer.style.display="flex",this.playButtonContainer.style.alignItems="center",this.playButtonContainer.style.justifyContent="center",this.playButtonContainer.appendChild(e),this.element.insertBefore(this.playButtonContainer,this.bottomBar),this.showJpegPlayerComponentImage.fire(void 0),this.createHlsPlayOverlay(),this.repositionChildren()}}notifyPlayerIsJPEG(e){this.playerIsJPEG=e}notifyPlayerIsHlsPlaceholder(e){this.playerIsHlsPlaceholder=e}getPlayerIsHlsPlaceholder(){return this.playerIsHlsPlaceholder}notifyUsingAirPlayChange(e){this.playerUsingAirPlay=e}notifyUsingChromecastChange(e){this.playerUsingChromecast=e}canResizePlayerInFullscreen(){return!this.isAnyInputFocused()&&(0,W.K$)()&&this.isFullVideo()}bindTouchControlsEvent(){this.touchControls.touchMoveEvent.listen((e=>{switch(e.state){case 0:this.playerScroll=this.playerElement.scrollLeft,this.playerHeight=this.playerElement.offsetHeight;break;case 1:this.showControls();break;case 3:const t=this.isVisible;t||e.event.preventDefault(),t?this.isTipFormActive?this.hideTipForm():this.hideControls():this.showControls(),U.lG.fire(void 0),this.closeActiveInput(),this.requestHlsPlayerPlayIfPaused.fire(void 0);break;case 2:this.notifyPlayerChangeSize()}}))}executeInitialFullscreenState(){this.initialFullscreen&&this.setFullscreen(!0,!0)}getMobileRoot(){return this.mobileRoot}}const q=()=>{if((0,s.J0)()&&/CriOS\//.test(navigator.userAgent)){const e=navigator.userAgent.split("CriOS/")[1].split(".")[0];if(parseInt(e)>=75)return!0}return!1}},5169:(e,t,i)=>{"use strict";i.d(t,{S:()=>m});var s=i(6784),n=i(3333),o=i(2709),r=i(7407),a=i(2146),l=i(1372),h=i(4110),d=i(9586),c=i(5257),u=i(4580),p=i(8936);class m extends o.u{constructor(e){super("div",e)}initData(e){this.tabList=e.tabList,this.isTouching=!1,this.isSwipingTabs=!1,this.isScrollingVertically=!1,this.isPinching=!1,this.prevTranslate=0,this.currTranslate=0,this.startX=0,this.startY=0,this.tabWidth=(0,p.$B)().width,this.currIndex=0,m.currentTab="chat"}initUI(){this.element=(0,l.tT)("div",{style:{width:"100%",height:"100%",backgroundColor:"#FFFFFF",display:"flex",position:"absolute"}}),this.tabList.getList().forEach((e=>{this.addChild(e)})),this.initSwipeListeners(),u.qb.listen((e=>{this.setActiveTab(e)})),h.nw.listen((()=>{u.qb.fire("moreRooms")})),n.eF.listen((()=>{u.qb.fire("roomMenu"),this.tabList.getRoomMenuTab().getRoomMenu().openMenuComponentByName(3)}))}initSwipeListeners(){this.tabList.getList().forEach((e=>{(0,s.wu)("touchstart",e.element,(e=>{this.handleTouchStart(e)})),(0,s.wu)("touchmove",e.element,(e=>{this.handleTouchMove(e)})),(0,s.wu)("touchend",e.element,(e=>{this.handleTouchEnd(e)}))}))}handleTouchStart(e){const t=e.touches[0].pageX<20||e.touches[0].pageX>this.tabWidth-20;this.isPinching=e.touches.length>=2,t||(0,d.u)()||this.isPinching||((0,a.Ve)(this.element,"left 0.1s ease-out"),this.isTouching=!0,this.startX=e.touches[0].pageX,this.startY=e.touches[0].pageY)}handleTouchMove(e){const t=e.touches[0].pageX-this.startX,i=t<0,s=0===this.currIndex,n=this.currIndex===this.tabList.length()-1,o=s&&!i||n&&i;if(!this.isTouching||o||this.isPinching)return;const r=e.touches[0].pageX,a=e.touches[0].pageY;(0,c.UK)(this.startX,this.startY,r,a)&&!this.isSwipingTabs&&(this.isScrollingVertically=!0),this.isScrollingVertically||(e.preventDefault(),this.isSwipingTabs=!0,this.currTranslate=this.prevTranslate+t,this.element.style.left=`${this.currTranslate}px`)}handleTouchEnd(e){if(!this.isTouching)return;window.setTimeout((()=>{(0,a.dI)(this.element)}),100),this.isTouching=!1,this.isSwipingTabs=!1,this.isScrollingVertically=!1,this.isPinching=!1;const t=this.currTranslate-this.prevTranslate,i=this.tabWidth/4,s=t<=-i,n=t>=i,o=this.currIndex+1<this.tabList.length(),r=this.currIndex>0;if(s&&o){var l;const e=null===(l=this.tabList.getTabByIndex(this.currIndex+1))||void 0===l?void 0:l.getTabName();u.qb.fire(null!=e?e:m.currentTab)}else if(n&&r){var h;const e=null===(h=this.tabList.getTabByIndex(this.currIndex-1))||void 0===h?void 0:h.getTabName();u.qb.fire(null!=e?e:m.currentTab)}else this.currTranslate-=t,this.element.style.left=`${this.currTranslate}px`,this.prevTranslate=this.currTranslate}setActiveTab(e){const t=this.tabList.getIndexByTabName(e);if(void 0!==t){var i;m.currentTab=e,this.currIndex=t;const s=null===(i=this.tabList.getTabByIndex(t))||void 0===i?void 0:i.getPageActionName();void 0!==s&&(0,r.bT)(s)}this.repositionTabs()}repositionTabs(){this.tabWidth=(0,p.DK)(),this.currTranslate=this.currIndex*-this.tabWidth,this.element.style.left=`${this.currTranslate}px`,this.prevTranslate=this.currTranslate}repositionChildren(){this.repositionTabs()}}},9586:(e,t,i)=>{"use strict";i.d(t,{H:()=>o,u:()=>n});var s=i(6784);function n(){return document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLElement&&"true"===document.activeElement.contentEditable}const o=e=>{e.style.overflowY="scroll",(0,s.wu)("touchstart",e,(t=>{0===e.scrollTop&&(e.scrollTop=1)})),(0,s.wu)("touchmove",e,(t=>{n()&&(t.stopPropagation(),!(e.scrollHeight>e.clientHeight)&&t.cancelable&&t.preventDefault())})),(0,s.wu)("scroll",e,(()=>{if(0===e.scrollTop)e.scrollTop=1;else if(e.scrollTop===e.scrollHeight-e.offsetHeight){const t=e.scrollHeight-e.offsetHeight-1;e.scrollTop=Math.max(t,1)}}))}},5257:(e,t,i)=>{"use strict";i.d(t,{UK:()=>r,lg:()=>l,xj:()=>a});var s=i(6784),n=i(8423),o=i(8936);const r=(e,t,i,s)=>{const n=Math.abs(e-i);return Math.abs(t-s)>n};class a extends n.c_{constructor(e,t){super("TouchEvent",t),this.element=e;const i={x:0,y:0},n={x:0,y:0};let o,r;const a={x:0,y:0};let l,h,d,c;(0,s.wu)("touchstart",this.element,(e=>{i.x=e.touches[0].clientX,i.y=e.touches[0].clientY,a.x=e.touches[0].clientX,a.y=e.touches[0].clientY,o=Date.now(),l=0,h=1!==e.touches.length,d=!0,c=!1})),(0,s.wu)("touchmove",this.element,(e=>{if(1===e.touches.length&&!h){n.x=e.touches[0].clientX,n.y=e.touches[0].clientY;const h=i.x-n.x,u=n.y-i.y;let p=1;l+=Math.abs(h)+Math.abs(u),t=l,s=Math.abs(n.y-a.y),r=s>=.7*t||s>110?1:0,d=l<=10,d||(c||(c=!0,p=0),this.fire({direction:r,distance:{x:h,y:u},state:p,elapsedTime:Date.now()-o,totalDistance:{x:a.x-n.x,y:n.y-a.y},startingPoint:a,event:e})),i.x=n.x,i.y=n.y}var t,s})),(0,s.wu)("touchend",this.element,(e=>{if(1===e.changedTouches.length&&!h){n.x=e.changedTouches[0].clientX,n.y=e.changedTouches[0].clientY;const t=d?3:2;this.fire({direction:r,distance:{x:i.x-n.x,y:n.y-i.y},state:t,elapsedTime:Date.now()-o,totalDistance:{x:a.x-n.x,y:n.y-a.y},startingPoint:a,event:e})}}))}}class l extends n.c_{constructor(e,t){let i;super("PinchEvent",t),this.element=e;let n,r=0;const a={x:0,y:0},l=(e,t,s,r)=>{const l=Math.sqrt((e-s)*(e-s)+(t-r)*(t-r));n=a,a.x=(e+s)/2,a.y=(t+r)/2;let h=0;return 0!==i&&(h=(l-i)/(0,o.DK)()),i=l,h};(0,s.wu)("touchstart",this.element,(e=>{i=0,r=0,2===e.touches.length&&(a.x=(e.touches[0].clientX+e.touches[1].clientX)/2,a.y=(e.touches[0].clientY+e.touches[1].clientY)/2,this.fire({state:0,previousCenterPoint:a,centerPoint:a,zoomPercentage:r}))})),(0,s.wu)("touchmove",this.element,(e=>{if(2===e.touches.length){const t=e.touches[0].clientX,i=e.touches[0].clientY,s=e.touches[1].clientX,o=e.touches[1].clientY;r=l(t,i,s,o),this.fire({state:1,previousCenterPoint:n,centerPoint:a,zoomPercentage:r})}})),(0,s.wu)("touchend",this.element,(e=>{if(2===e.changedTouches.length){const t=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY,s=e.changedTouches[1].clientX,o=e.changedTouches[1].clientY;r=l(t,i,s,o),this.fire({state:2,previousCenterPoint:n,centerPoint:a,zoomPercentage:r})}}))}}},4580:(e,t,i)=>{"use strict";i.d(t,{Gt:()=>l,Io:()=>n,P4:()=>h,VZ:()=>r,bW:()=>u,f6:()=>o,nD:()=>d,qb:()=>c,vT:()=>a});var s=i(8423);const n=new s.c_("switchedToHLS"),o=new s.c_("openTipCalloutRequest"),r=new s.c_("loadRoomRequest"),a=new s.c_("userPanelRequest"),l=new s.c_("sendMessageInputFocus"),h=new s.c_("sendMessageInputBlur"),d=new s.c_("siteHeaderMenuOpened"),c=new s.c_("userSwitchedTab"),u=new s.c_("toggleDms")},7789:(e,t,i)=>{"use strict";i.d(t,{T:()=>I,o:()=>R});var s=i(3417),n=i(20),o=i(9447),r=i(3910),a=i(9461),l=i(213),h=i(5216),d=i(6844),c=i(2939),u=i(2396),p=i(2690),m=i(7407),g=i(90),v=i(5173),f=i(8785),y=i(4947),b=i(4110),w=i(5746),C=i(8936),S=i(3124);class x extends w.n{constructor(e,t,i){super(e,t,i),this.element.style.height="auto",this.element.style.width="auto",this.element.style.maxWidth="90%",this.element.style.background="white",this.element.style.borderRadius="4px",this.element.style.margin="auto",this.element.style.position="absolute",this.element.style.boxShadow="0 10px 20px rgba(0, 0, 0, 0.2), 0 6px 6px rgba(0, 0, 0, 0.25)",this.commentInput.style.fontSize="16px"}repositionChildren(){if(super.repositionChildren(),(0,S.K$)()&&(0,C.DK)()<768)this.element.style.width="90%";else{const e=Math.min(screen.width,screen.height);this.element.style.width=.9*e+"px"}this.element.style.top=((0,C.mJ)()-this.element.offsetHeight)/2+"px",this.element.style.left=((0,C.DK)()-this.element.offsetWidth)/2+"px"}onIgnoreUser(){}}var T=i(4580);let P,k,A;c.X0.listen((e=>{P=e.dossier.room,k=e.dossier.userName,A=e.chatConnection}));const M="#156b95";class R extends v.Q{constructor(){var e;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super(),this.isChatReportShowing=!1,this.reportModal=new p.zf({onShow:()=>{this.onReportModalShown()},onHide:()=>{this.onReportModalHidden()},easyExit:!0}),this.isIgnored=!1,k=null===(e=a.Bm.current.loggedInUser)||void 0===e?void 0:e.username,this.userPanelContent=document.createElement("div"),this.element.appendChild(this.userPanelContent),this.element.style.position="relative",this.element.style.width="auto",this.element.style.height="auto",this.element.style.minHeight="40px",this.element.style.padding="4px",this.element.style.border="1px solid #cccccc",this.element.style.borderRadius="6px",this.element.style.marginBottom="16px",this.element.style.fontWeight="normal",(0,o.fZ)(this.element,"userPanel"),(0,o.fZ)(this.element,o.aG.bgColor),this.roomImage=document.createElement("img"),this.roomImage.style.width="47px",this.roomImage.style.height="40px",this.roomImage.style.marginRight="16px",this.roomImage.style.verticalAlign="middle",this.roomImage.style.borderRadius="4px",this.roomImage.style.display="none",this.userPanelContent.appendChild(this.roomImage),this.genderIcon=document.createElement("img"),this.genderIcon.style.position="relative",this.genderIcon.style.top="3px",this.genderIcon.style.height="16px",this.genderIcon.style.padding="6px 16px 0 0",this.genderIcon.style.display="none",this.userPanelContent.appendChild(this.genderIcon),this.displayAge=document.createElement("span"),this.displayAge.innerText="--",this.displayAge.style.verticalAlign="middle",this.displayAge.style.marginRight="16px",this.displayAge.style.display="none",this.userPanelContent.appendChild(this.displayAge),this.profileLink=E(y.R.viewProfile),this.profileLink.onclick=()=>{T.VZ.fire(this.username)},t&&this.userPanelContent.appendChild(this.profileLink),this.sendPMLink=E(y.R.pmMenuTitle),this.sendPMLink.onclick=()=>{(0,d.rC)(y.R.loggedInToPm)||b.E3.fire({username:this.username,focus:!0,showSupporterAlert:this.needsSupporterToPm})},this.userPanelContent.appendChild(this.sendPMLink),(0,n.SU)()&&(this.sendDMLink=E(y.R.dmMenuTitle),this.sendDMLink.onclick=()=>{(0,d.rC)(y.R.loggedInToDm)||(T.bW.fire(!0),r.$o.fire(this.username))},this.userPanelContent.appendChild(this.sendDMLink)),this.mentionLink=E(y.R.mention),this.mentionLink.style.display="inline-block",this.mentionLink.onclick=()=>{b.Ch.fire(this.username)},this.userPanelContent.appendChild(this.mentionLink),this.ignoreLink=E(y.R.ignore),this.ignoreUpdate=new g.P(!1,((e,t)=>this.setIsIgnored(e,t)),(()=>{const e=this.isIgnored?y.R.errorUnignoringUser(this.username):y.R.errorIgnoringUser(this.username);(0,l.Q$)(e)})),this.ignoreLink.onclick=()=>{this.onIgnoreUnignoreClick()},this.userPanelContent.appendChild(this.ignoreLink),this.reportModal.element.style.backgroundColor="rgba(0, 0, 0, 0.3)",this.reportModal.element.style.position="fixed",this.reportLink=E(y.R.report),this.reportLink.onclick=()=>{this.isChatReportShowing?this.reportModal.hide():((0,m.bT)("ReportChatUser",{username:this.username}),this.reportModal.show())},this.reportModal.overlayClick.listen((()=>{this.reportModal.hide()})),this.userPanelContent.appendChild(this.reportLink)}onIgnoreUnignoreClick(){(0,d.rC)(`${y.R.loginForIgnoreClickOkToLogin}`)||this.ignoreUpdate.dispatch(!this.isIgnored,(e=>this.isIgnored?A.unignore(e):A.ignore(e))(this.username))}setIsIgnored(e,t){this.isIgnored=e,this.ignoreLink.innerText=e?y.R.unignore:y.R.ignore,t?(this.ignoreLink.style.pointerEvents="none",this.ignoreLink.style.color="#6c757d"):(this.ignoreLink.style.pointerEvents="",this.ignoreLink.style.color=M),void 0!==this.chatReport&&this.chatReport.updateIgnoreText(this.isIgnored)}updateContents(e,t){this.username=e,this.profileLink.style.display=e===P?"none":"inline-block",A.username()===P?this.ignoreLink.style.display="none":(this.ignoreLink.style.display="inline-block",this.sendPMLink.style.display="none"),k===this.username?(this.ignoreLink.style.display="none",this.reportLink.style.display="none",this.mentionLink.style.display="none",this.sendPMLink.style.display="none",void 0!==this.sendDMLink&&(this.sendDMLink.style.display="none")):(void 0===t?this.reportLink.style.display="none":(this.reportLink.style.display="inline-block",this.createChatReport(t)),this.mentionLink.style.display="inline-block",P===k&&(this.sendPMLink.style.display="inline-block"),void 0!==this.sendDMLink&&(this.sendDMLink.style.display="inline-block")),this.roomImage.style.display="none",this.genderIcon.style.display="none",this.displayAge.style.display="none",void 0!==this.silenceLink&&(this.userPanelContent.removeChild(this.silenceLink),this.silenceLink=void 0),(0,u.b)(this.username).then((e=>{this.needsSupporterToPm=e.needsSupporterToPm,e.canAccess&&(this.genderIcon.src=(0,f.e0)(e.gender),this.displayAge.innerText=isNaN(e.displayAge)?"":`${e.displayAge}`,this.roomImage.src=e.imageUrl,e.online&&(this.roomImage.style.display="inline"),this.genderIcon.style.display="inline",this.displayAge.style.display="inline"),this.ignoreUpdate.dispatch(A.isIgnored(this.username),Promise.resolve(!0)),this.setSilenceLink(e)})).catch((e=>{error("Could not process user menu request",e)}))}createChatReport(e){void 0!==this.chatReport&&this.reportModal.removeChild(this.chatReport),this.chatReport=new x(this.username,e,A),this.reportModal.addChild(this.chatReport),this.chatReport.element.style.display="none",this.chatReport.closeChatReportRequest.listen((e=>{this.reportModal.hide(),e&&(this.overlayClick.fire(void 0),void 0!==this.chatReport&&this.chatReport.tearDown())})),this.chatReport.ignoreReportedUser.listen((()=>{this.ignoreUpdate.dispatch(!0,A.ignore(this.username))}))}setSilenceLink(e){e.canSilence&&(void 0!==e.silenceId?(this.silenceLink=E(y.R.removeSilenceMessage),this.silenceLink.onclick=()=>{(0,h.KF)("edit_room_ban/",{banid:String(e.silenceId),action:"remove_silence",room_username:P}).catch((t=>{error(t),(0,l.Q$)(`Error removing silence from user ${e.username}`)})),this.hide()}):(this.silenceLink=E(y.R.silenceText),this.silenceLink.onclick=()=>{(0,l.mf)(`Silence ${e.username}?`,(()=>{(0,m.bT)("SilenceUser",{username:e.username}),(0,h.KF)(`roomsilence/${e.username}/${P}/`,{}).then((()=>{})).catch((t=>{error(`Unable to silence user (${t})`,{room:P,username:e.username}),(0,l.Q$)(`Error silencing user ${e.username}`)}))})),this.hide()}),this.silenceLink.style.display="inline-block",this.userPanelContent.appendChild(this.silenceLink))}onReportModalShown(){this.reportLink.style.textDecoration="underline",this.reportModal.element.style.top="0",void 0!==this.chatReport&&(this.chatReport.element.style.display="",this.chatReport.repositionChildren()),this.isChatReportShowing=!0}onReportModalHidden(){this.isChatReportShowing=!1,this.reportLink.style.textDecoration="none",this.reportModal.element.style.top="",void 0!==this.chatReport&&(this.chatReport.element.style.display="none",this.chatReport.resetForm())}hide(){this.hideOverlay(),this.element.remove()}}class I extends R{constructor(){super(!0),this.profileLink.onclick=()=>{void 0!==A?T.VZ.fire(this.username):window.location.pathname=`/${this.username}/`,T.bW.fire(!1)}}onIgnoreUnignoreClick(){(0,d.rC)(`${y.R.loginForIgnoreClickOkToLogin}`)||this.ignoreUpdate.dispatch(!this.isIgnored,(()=>this.isIgnored?(0,s.Kw)(this.username).then((()=>!0)):(0,s.Bq)(this.username).then((()=>!0)))())}updateContents(e,t){this.username=e,this.element.style.top="",this.profileLink.style.display="inline-block",this.mentionLink.style.display="none",void 0!==this.sendPMLink&&(this.sendPMLink.style.display="none"),void 0!==this.sendDMLink&&(this.sendDMLink.style.display="none"),k===this.username?(this.ignoreLink.style.display="none",this.reportLink.style.display="none"):(this.ignoreLink.style.display="inline-block",void 0===t?this.reportLink.style.display="none":(this.reportLink.style.display="inline-block",this.createChatReport(t))),this.roomImage.style.display="none",this.genderIcon.style.display="none",this.displayAge.style.display="none",(0,u.b)(this.username).then((e=>{this.needsSupporterToPm=e.needsSupporterToPm,e.canAccess&&(this.genderIcon.src=(0,f.e0)(e.gender),this.displayAge.innerText=isNaN(e.displayAge)?"":`${e.displayAge}`,this.roomImage.src=e.imageUrl,e.online&&(this.roomImage.style.display="inline"),this.genderIcon.style.display="inline",this.displayAge.style.display="inline"),this.ignoreUpdate.dispatch((0,s.pi)(this.username),Promise.resolve(!0))})).catch((e=>{error("Could not process user menu request",e)}))}createChatReport(e){void 0!==this.chatReport&&this.reportModal.removeChild(this.chatReport),this.chatReport=new x(this.username,e,void 0),this.reportModal.addChild(this.chatReport),this.chatReport.element.style.display="none",this.chatReport.closeChatReportRequest.listen((e=>{this.reportModal.hide(),e&&(this.overlayClick.fire(void 0),void 0!==this.chatReport&&this.chatReport.tearDown())}))}}function E(e){const t=document.createElement("span");return t.innerText=e,t.style.verticalAlign="middle",t.style.textDecoration="none",t.style.cursor="pointer",t.style.color=M,t.style.padding="0 16px 6px 0",t}},2944:(e,t,i)=>{"use strict";i.d(t,{t:()=>h});var s=i(9447),n=i(6784),o=i(3955),r=i(7407),a=i(8785),l=i(4580);function h(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const c=document.createElement("span");if((0,s.fZ)(c,(0,a.Kb)(e)),c.style.fontWeight="bold",c.classList.add("username"),c.innerText=h?`@${e.username}`:e.username,c.style.maxWidth="100%",c.style.whiteSpace="nowrap",c.style.overflowX="hidden",c.style.textOverflow="ellipsis",c.style.display="inline-block",c.style.verticalAlign="bottom",c.style.margin="0",i){const t=document.createElement("img");t.src=(0,a.e0)(e.gender),(0,o.ZM)(t,{height:"16px",verticalAlign:"middle",margin:"0 10px 0 0"}),(0,o.ZM)(c,{fontWeight:"normal"}),c.insertBefore(t,c.firstChild)}return d||(c.onmouseenter=()=>{c.style.textDecoration="underline",c.style.cursor="pointer"},c.onmouseleave=()=>{c.style.textDecoration="none",c.style.cursor="default"},(0,n.wu)("click",c,(i=>{let s=c.parentElement;for(;null!==s&&"DIV"!==s.tagName;)s=s.parentElement;null===s?error("Username span has no parent"):((0,r.bT)("OpenUserPanel",{username:e.username}),i.stopPropagation(),l.vT.fire({username:e.username,message:t,attachTo:s}))}))),c}},5271:(e,t,i)=>{"use strict";var s;i.d(t,{d:()=>s}),function(e){e[e.Cancelled=4]="Cancelled"}(s||(s={}))},3939:(e,t,i)=>{"use strict";i.d(t,{G:()=>h,L:()=>l});var s=i(8423),n=i(5257),o=i(5271),r=i(8936);const a=1/3,l=1.6;class h{constructor(e,t){this.overlayElement=e,this.playerElement=t,this.touchMoveEvent=new n.xj(this.overlayElement),this.pinchEvent=new n.lg(this.overlayElement),this.scalePlayerEvent=new s.c_("scalePlayerEvent"),this.scrollPlayerEvent=new s.c_("scrollPlayerEvent"),this.swipePlayerEvent=new s.c_("swipePlayerEvent"),this.changeVideoHeightEvent=new s.c_("changeVideoHeightEvent"),this.horizontalSwipeInProgress=!0,this.isSwipingEnabled=!1,this.pinchEvent.listen((e=>{const t=e.previousCenterPoint.x-e.centerPoint.x;this.scalePlayerEvent.fire({factor:1+1.25*e.zoomPercentage,pointX:e.centerPoint.x}),this.scrollPlayerEvent.fire(t)})),this.touchMoveEvent.listen((e=>{if(0===e.state&&(this.initialSwipeCheckDone=!1,this.horizontalSwipeInProgress=!1,this.swipeCheck(e)),this.horizontalSwipeInProgress){const t=2!==e.state||this.isCompletedSwipe(e.totalDistance.x,e.elapsedTime)?e.state:o.d.Cancelled;this.swipePlayerEvent.fire({state:t,totalDistance:e.totalDistance.x,elapsedTime:e.elapsedTime})}else{const t=e.distance.x;this.handlePlayerResize(e),this.scrollPlayerEvent.fire(t)}}))}isSwipeAllowed(e){const t=this.playerElement.scrollLeft<=0,i=e<=0,s=Math.ceil(this.playerElement.scrollLeft)+this.playerElement.offsetWidth>=this.playerElement.scrollWidth,n=e>=0;return this.isSwipingEnabled&&(t&&i||s&&n)}isCompletedSwipe(e,t){return Math.abs(e)>=(0,r.DK)()*a||(t=>t<=200&&Math.abs(e)>=.2*(0,r.DK)())(t)}handlePlayerResize(e){this.changeVideoHeightEvent.fire({startingPoint:e.startingPoint,distance:e.distance})}swipeCheck(e){this.initialSwipeCheckDone||(this.horizontalSwipeInProgress=this.isSwipeAllowed(e.totalDistance.x)&&0===e.direction,this.initialSwipeCheckDone=!0)}}},8936:(e,t,i)=>{"use strict";i.d(t,{$B:()=>l,DK:()=>a,d9:()=>h,mJ:()=>r,z1:()=>c});var s,n=i(7623),o=i(3124);const r=()=>document.documentElement.clientHeight!==window.outerHeight||(0,n.OF)()?Math.max(window.innerHeight,document.documentElement.clientHeight):window.innerHeight,a=()=>document.documentElement.clientWidth,l=()=>(e=>{const t=a(),i=r();return e?{width:t,height:i}:{width:i,height:t}})((0,o.K$)()),h=()=>window.pageYOffset,d=null===(s=window.visualViewport)||void 0===s?void 0:s.scale,c=()=>!(0,n.OF)()&&null!=d&&window.visualViewport?Math.round(10*d)!==Math.round(10*window.visualViewport.scale):document.documentElement.clientWidth!==window.innerWidth},3124:(e,t,i)=>{"use strict";i.d(t,{DQ:()=>h,FW:()=>r,K$:()=>n,Vk:()=>a,pu:()=>l}),i(7623);var s=i(8423);function n(){if(!r())return!0;const e=function(){const e=void 0!==screen.orientation?screen.orientation.type:void 0;if(void 0!==e){if(e.startsWith("portrait"))return!0;if(e.startsWith("landscape"))return!1}}();if(void 0!==e)return e;switch(window.orientation){case 0:case 180:case-180:return!0;case 90:case-90:case 270:return!1}return window.innerWidth===Math.min(screen.width,screen.height)||window.innerWidth<=window.innerHeight}const o=Object.prototype.hasOwnProperty.call(window,"onorientationchange");function r(){return o}function a(){return"orientation"in screen&&"onchange"in screen.orientation}function l(){return r()||a()}const h=new s.c_("screenOrientationChanged")},2690:(e,t,i)=>{"use strict";i.d(t,{$M:()=>u,KD:()=>c,zf:()=>p});var s=i(6624),n=i(6784),o=i(2939),r=i(2709),a=i(8423),l=i(1779);const h=new a.c_("modalReposition");(0,n.wu)("resize",window,(()=>{h.fire(void 0)})),(0,n.wu)("orientationchange",window,(()=>{h.fire(void 0)}));const d=new a.c_("modalEscape");(0,n.wu)("keydown",document,(e=>{27===e.keyCode&&d.fire(e)}));const c=new a.c_("modalExit");(0,s.isRoomRoomlistSpaActive)()?s.UrlState.current.listenGlobal(s.ALL,(()=>{c.fire(void 0)})):((0,n.wu)("popstate",window,(()=>{c.fire(void 0)})),o.Gr.listen((()=>{c.fire(void 0)})));const u=new a.c_("modalOpened");class p extends r.u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{easyExit:!0};super(),this.options=e,this.overlayClick=new a.c_("overlayClick"),this.listenerGroup=new a.gt,this.isListeningForChange=!1,this.hideOverlay=!1,this.overlayClickStayOpen=!1,this.preventChatFocus=!1,this.overlay=document.createElement("div"),this.overlay.style.position="fixed",this.overlay.style.display="none",this.overlay.style.left="0",this.overlay.style.top="0",this.overlay.style.right="0",this.overlay.style.bottom="0",this.overlay.style.zIndex="1100",this.overlay.style.background="rgb(0,0,0,0)",this.overlay.onclick=e=>{e.stopPropagation(),this.overlayClick.fire(void 0),this.overlayClickStayOpen||this.hide()},this.element.style.zIndex="1101",this.element.onclick=e=>{e.stopPropagation()},this.repositionCallback=()=>{this.isListeningForChange&&this.repositionChildrenRecursive()},this.fullscreenChangeCallback=()=>{this.isListeningForChange&&this.show()}}show(){const e=(0,l.Gy)();(0,l.aS)()&&void 0!==e?(e.appendChild(this.overlay),e.appendChild(this.element)):(document.body.appendChild(this.overlay),document.body.appendChild(this.element)),this.isListeningForChange||(h.listen(this.repositionCallback,!1).addTo(this.listenerGroup),l._c.listen(this.fullscreenChangeCallback,!1).addTo(this.listenerGroup),c.listen((()=>{this.hide(!0)}),!1).addTo(this.listenerGroup),this.options.easyExit&&d.listen((e=>{e.preventDefault(),this.hide()}),!1).addTo(this.listenerGroup),this.preventChatFocus&&u.fire(!0),void 0!==this.options.onShow&&this.options.onShow(),this.isListeningForChange=!0),this.hideOverlay||(this.overlay.style.display="block")}hide(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.overlay.style.display="none",document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element),null!==this.overlay.parentElement&&this.overlay.parentElement.removeChild(this.overlay),this.isListeningForChange&&(this.listenerGroup.removeAll(),this.preventChatFocus&&u.fire(!1),void 0!==this.options.onHide&&this.options.onHide(e),this.isListeningForChange=!1)}}},6009:(e,t,i)=>{"use strict";i.d(t,{t:()=>h});var s=i(4936),n=i(5079),o=i(5216),r=i(2939),a=i(7882),l=i(1452);class h{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.limit=e,this.seenItems=new Set,this.offset=0,this.next=(0,l.FM)((async()=>{const e=await this.getMoreRooms(),t=new s.N6(e.responseText),i=JSON.parse(t.getObjectString("rooms")).map((e=>(0,n.ak)(new s.N6(e))));return this.offset+=i.length,i.filter((e=>!this.seenItems.has(e.room))).filter((e=>(this.seenItems.add(e.room),!0)))}),[]),this.offset=0,this.listener=r.X0.listen((e=>{this.currentRoomGender=(0,a.jM)(e.dossier.roomGender),this.currentRoomName=e.chatConnection.room(),this.seenItems.add(this.currentRoomName)}),!1,!0)}setGenders(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.genders=e,this.offset=0,this.seenItems=new Set}getMoreRooms(){const e=new URLSearchParams(window.location.search);return e.set("genders",this.gendersParam().join(",")),e.set("room",this.currentRoomName),e.set("limit",`${this.limit}`),e.set("offset",`${this.offset}`),(0,o.Aw)(`api/ts/roomlist/more-rooms/?${e.toString()}`)}gendersParam(){return this.genders.length>0?this.genders:void 0===this.currentRoomGender?window.default_gender.split(""):[this.currentRoomGender]}dispose(){this.listener.removeListener()}}},7407:(e,t,i)=>{"use strict";i.d(t,{Ht:()=>d,NP:()=>x,PF:()=>c,PN:()=>v,RN:()=>g,Rs:()=>u,S_:()=>m,U4:()=>C,bT:()=>p,iA:()=>w,yC:()=>S});var s=i(4936),n=i(7623),o=i(6784),r=i(5216);let a,l,h;function d(e,t){var i;const s={};s["attributes.room_user"]=null!==(i=a)&&void 0!==i?i:"",void 0!==h&&(s["attributes.currentMode"]=h);for(const t in e)s[`attributes.${t}`]=e[t];if(void 0!==t&&t&&(0,n.vM)()){const e=window.performance.now();s["attributes.timeSinceLoad"]=e/1e3,s["attributes.timeSinceLoadMS"]=e}return void 0!==l&&(s["attributes.player"]=l),void 0!==window.history.length&&(s.history_length=window.history.length),s}function c(){return s.a.newRelicEnabled()}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};-1!==w()&&(e.PlayerVol=w()),-1!==b()&&(e.TipVol=b())}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;u(t);const n=d(t,i);s.a.addPageAction(e,n)}function m(e,t){s.a.setCustomAttribute(e,t)}function g(e){a=e}function v(e){l=e}let f=-1,y=-1;function b(){return 0===y?0:f}function w(){return y}function C(e){f=e}function S(e,t){y=t?0:e}function x(e){"videoonly"!==e&&(h=e)}(0,o.wu)("load",window,(function e(){(0,o.Pf)("load",window,e);for(const e of document.getElementsByTagName("script"))null!==e.src.match(/^https:\/\/js-agent\.newrelic\.com\/.*/)&&(0,o.wu)("error",e,(()=>{error("Ad blocker stopped analytics collection"),(0,r.KF)("api/adblocker/",{})}))}))},3587:(e,t,i)=>{"use strict";i.d(t,{T:()=>c});var s=i(4936),n=i(9461),o=i(6784),r=i(5216),a=i(6844),l=i(1134),h=i(7176),d=i(4947);class c{constructor(){this.usersWithNotes=new Set,(0,a.ok)()||n.Bm.current.isMobile||(this.getUsernames(!1),(0,o.wu)("focus",window,(()=>{this.getUsernames()})),l.T.registerGenerator("notesBadge",(e=>this.createChatBadge(e))))}getUsernames(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,r.Aw)("api/notes/usernames/").then((t=>{const i=new s.N6(t.responseText),n=JSON.parse(i.getObjectString("usernames"));e?(this.usersWithNotes.forEach((e=>n.includes(e)||this.removeUser(e))),n.forEach((e=>this.usersWithNotes.has(e)||this.addUser(e)))):(this.usersWithNotes.clear(),n.forEach((e=>{this.usersWithNotes.add(e)})))})).catch((e=>{error("Could not retrieve list of users for which currentUser has notes on")}))}static getOrCreateInstance(){return void 0===c.singletonInstance&&(c.singletonInstance=new c),c.singletonInstance}addUser(e){this.usersWithNotes.add(e),this.updateChatBadges(e)}removeUser(e){this.usersWithNotes.has(e)&&(this.usersWithNotes.delete(e),this.updateChatBadges(e))}createChatBadge(e){const t=document.createElement("span");t.style.display=this.usersWithNotes.has(e)?"":"none",t.style.marginRight=".1em",t.title=d.R.notes;const i=(0,h.Am)();return t.appendChild(i),t}updateChatBadges(e){const t=this.usersWithNotes.has(e);l.T.getBadgeElements("notesBadge",e).forEach((e=>{e.style.display=t?"inline-block":"none"}))}}},90:(e,t,i)=>{"use strict";i.d(t,{P:()=>s});class s{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};this.ID=0,this.lastValidID=0,this.initialState=e,this.currentState=e,this.lastValidState=e,this.onUpdate=t,this.onRevert=i}setInitialState(e){this.initialState=e,0===this.ID&&(this.currentState=e,this.onUpdate(this.currentState,!1))}dispatch(e,t){this.ID+=1,this.currentState=e,this.onUpdate(this.currentState,!0),t.then((e=>{e?this.commit(this.ID):this.revert(this.ID)})).catch((()=>{this.revert(this.ID)}))}commit(e){e>this.lastValidID&&(this.lastValidID=e,this.lastValidState=this.currentState,this.onUpdate(this.currentState,e<this.ID))}revert(e){0===this.lastValidID?(this.currentState=this.initialState,this.onUpdate(this.currentState,!1),this.onRevert()):e>this.lastValidID&&(this.currentState=this.lastValidState,this.onUpdate(this.currentState,e<this.ID),this.onRevert())}}},2509:(e,t,i)=>{"use strict";i.d(t,{C:()=>s});class s{constructor(){this.backingArray=[]}addToTop(e){this.remove(e),this.backingArray.unshift(e)}addToBottom(e){this.remove(e),this.backingArray.push(e)}toArray(){return[].concat(this.backingArray)}remove(e){const t=this.backingArray.indexOf(e);-1!==t&&this.backingArray.splice(t,1)}popFromTop(){return this.backingArray.shift()}popFromBottom(){return this.backingArray.pop()}}},5173:(e,t,i)=>{"use strict";i.d(t,{Q:()=>o});var s=i(2709),n=i(8423);class o extends s.u{constructor(e){super("div",e),this.overlayClick=new n.c_("overlayClick")}initUI(e){super.initUI(e),this.overlay=document.createElement("div"),this.overlay.style.position="fixed",this.overlay.style.display="none",this.overlay.style.left="0",this.overlay.style.top="0",this.overlay.style.right="0",this.overlay.style.bottom="0",this.overlay.style.zIndex="1000",this.overlay.style.cursor="auto",this.overlay.onclick=e=>{e.stopPropagation(),this.hideOverlay(),this.overlayClick.fire(void 0)},this.element.style.zIndex="1001",this.element.onclick=e=>{e.stopPropagation()}}lazyInitUI(){super.lazyInitUI(),window.setTimeout((()=>{this.afterDOMConstructedIncludingChildren()}),0)}afterDOMConstructedIncludingChildren(){super.afterDOMConstructedIncludingChildren(),null!==this.element.parentElement&&this.element.parentElement.insertBefore(this.overlay,this.element)}showOverlay(){this.overlay.style.display="block"}hideOverlay(){this.overlay.style.display="none"}hide(){this.hideElement(),this.hideOverlay()}afterRemovedFromParent(){super.afterRemovedFromParent(),null!==this.overlay.parentElement&&this.overlay.parentElement.removeChild(this.overlay)}}},7537:(e,t,i)=>{"use strict";i.d(t,{o:()=>l});var s=i(6784),n=i(82),o=i(8423),r=i(2690),a=i(1372);class l extends n.b{constructor(e){super(e),this.easyExit=!0,this.isListeningForChange=!1,this.tabbableElements=[],this.listenerGroup=new o.gt,this.keyboardNav=this.keyboardNav.bind(this)}initUI(){this.overlay=(0,a.tT)("div",{className:"overlayModalOverlay",onClick:e=>{e.stopPropagation(),this.easyExit&&this.hide()}}),this.element.classList.add("overlayModalElement"),this.element.onclick=e=>{e.stopPropagation()},(0,s.wu)("popstate",window,(()=>{this.hide()}))}show(){this.isListeningForChange||(r.KD.listen((()=>{this.hide()}),!1).addTo(this.listenerGroup),this.isListeningForChange=!0),document.body.appendChild(this.overlay),this.overlay.appendChild(this.element),r.$M.fire(!0),document.addEventListener("keydown",this.keyboardNav)}hide(){var e;this.isListeningForChange&&(this.listenerGroup.removeAll(),this.isListeningForChange=!1),null===(e=this.overlay.parentElement)||void 0===e||e.removeChild(this.overlay),r.$M.fire(!1),document.removeEventListener("keydown",this.keyboardNav)}defineTabbableElements(e){this.tabbableElements=e,this.tabbableElements.forEach((e=>{e.tabIndex=0,e.onkeydown=t=>{t.preventDefault(),"Enter"!==t.key&&" "!==t.key||e.click()}}))}keyboardNav(e){if("Escape"===e.key&&this.easyExit)this.hide();else if("Tab"===e.key&&null!==document.activeElement&&this.tabbableElements.length>0){e.preventDefault();const t=this.tabbableElements.indexOf(document.activeElement)+(e.shiftKey?-1:1),i=t<0?this.tabbableElements.length-1:t;this.tabbableElements[i%this.tabbableElements.length].focus()}}}},3118:(e,t,i)=>{"use strict";i.d(t,{j:()=>n});const s={height:0,name:"",imgUrl:"",width:0,abuseUrl:""};class n{constructor(e){this._parseResult=function(e){const t="%%%[emoticon ",i="]%%%";let n=[];const r=[],a=[];if(e.indexOf(t)<0)return{stringParts:[e],emoticons:[]};for(let l=0;l<e.length;l+=1)if("%"===e[l])if(e.slice(l,l+13)===t){const t=l+e.slice(l,e.length).indexOf(i);if(e.slice(t,t+4)===i){a.push(n.join("")),n=[];const i=o(e.slice(l,t+4));void 0!==i?r.push(i):(error(`Cannot parse emoticon: ${i}`),r.push(s)),l=t+4-1}}else n.push(e[l]);else n.push(e[l]);return a.push(n.join("")),{stringParts:a,emoticons:r}}(e)}stringParts(){return this._parseResult.stringParts}emoticons(){return this._parseResult.emoticons}}function o(e){const t=(e=e.replace("%%%[emoticon ","").replace("]%%%","")).split(/\|/);if(6===t.length){const e={name:t[0],thumbUrl:t[1],width:a(t[2])?Number(t[2]):80,height:a(t[3])?Number(t[3]):80,imgUrl:t[4],abuseUrl:t[5]};return void 0!==e.thumbUrl&&r(e.thumbUrl)?e:void 0}if(5===t.length){const e={name:t[0],imgUrl:t[1],width:a(t[2])?Number(t[2]):80,height:a(t[3])?Number(t[3]):80,abuseUrl:t[4]};return r(e.imgUrl)?e:void 0}}function r(e){return null!==e.match(/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/g)||(error("Invalid emoticon URL"),!1)}function a(e){return!isNaN(parseInt(e,10))||(error("Invalid dimension argument"),!1)}},338:(e,t,i)=>{"use strict";i.d(t,{N:()=>C,S:()=>S});var s=i(7623),n=i(9461),o=i(1224),r=i(2416),a=i(6784),l=i(213),h=i(2709),d=i(3955),c=i(8423),u=i(7407),p=i(2945),m=i(3860),g=i(3131),v=i(580),f=i(9321),y=i(1282),b=i(3933),w=i(1021);class C extends h.u{constructor(e,t,i){super(),this.roomStatusNotifier=t,this.videoOfflineChange=new c.c_("videoOfflineChange");const s=this.choosePlayer(e);this.createPlayer(s,i),this.watermark=document.createElement("img"),this.watermark.src=(0,r.f)(),this.watermark.className="cbLogo",this.adjustWatermarkStyle({position:"absolute",width:"90px",height:"27px",top:"8px",right:"8px",userSelect:"none",msUserSelect:"none",pointerEvents:"none",visibility:o.m.shouldHideWaterMark?"hidden":"initial"}),this.watermark.setAttribute("draggable","false"),this.element.appendChild(this.watermark),m.L.changeVideoMode.listen((e=>{this.playerComponent.showControls()})),this.qualityMessage=document.createElement("div"),this.qualityMessage.innerText="Broadcaster's stream is experiencing network issues",(0,d.ZM)(this.qualityMessage,{display:"none",color:"#0000ff",position:"absolute",fontSize:"1.0em",fontWeight:"bold",top:"8px",left:"8px",userSelect:"none",pointerEvents:"none",msUserSelect:"none"}),this.qualityMessage.setAttribute("draggable","false"),this.element.appendChild(this.qualityMessage)}bindVideoEvents(){var e,t;null===(e=this.playerComponent.requestJPEG)||void 0===e||e.listen((e=>{this.forceJPEGPushPlayer(e)})),this.playerComponent.videoOfflineChange.listen((e=>{this.videoOfflineChange.fire(e),this.roomStatusNotifier.setVideoOffline(e)})),!0===(null===(t=n.Bm.current.loggedInUser)||void 0===t?void 0:t.isStaff)&&!0===n.Bm.current.qualityMessage&&n.Aw.onUpdate.listen((()=>{const{quality:e}=n.Aw.getState();this.qualityMessage.style.display="okay"===(null==e?void 0:e.quality)||"bad"===(null==e?void 0:e.quality)||"stop"===(null==e?void 0:e.quality)?"":"none",this.qualityMessage.style.color="bad"===(null==e?void 0:e.quality)?"#ff0000":"0000ff",this.qualityMessage.innerText="stop"===(null==e?void 0:e.quality)?"Broadcaster's stream has stopped.":"Broadcaster's stream is experiencing network issues"}))}adjustWatermarkStyle(e){(0,d.ZM)(this.watermark,e)}stylePlayerComponent(){}chooseHLSPlayer(){return(0,s.OF)()?"hlsnative":"videojs"}chooseNoAutoplayHlsSubstitute(){return"jpegToHls"}choosePlayer(e){let t=(0,p.JO)(window.location.search).player;return void 0!==t?("hls"===t&&(t=this.chooseHLSPlayer()),t):(0,s.Ap)()?e?this.chooseHLSPlayer():this.chooseNoAutoplayHlsSubstitute():(w.nH.jpegFallback(),"jpeg")}createVideoJsPlayer(){return new b.y(this.roomStatusNotifier)}createPlayer(e,t){var i;let s;switch(e){case"videojs":s=this.createVideoJsPlayer();break;case"hlsnative":s=new g.S(this.roomStatusNotifier);break;case"jpeg":s=new f.O(this.roomStatusNotifier);break;case"jpegToHls":s=new f.O(this.roomStatusNotifier,!0);break;default:return error(`received unexpected player name: ${e}`),void(0,l.Q$)(`unknown player: ${e}`)}const n=!(null!==(i=null==t?void 0:t.noHook)&&void 0!==i&&i);this.playerComponent=this.prependChild(s),s.setContainerElement(this.element),n&&this.afterPlayerCreated()}afterPlayerCreated(){let e;e=this.playerComponent instanceof b.y?"videojs":this.playerComponent instanceof g.S?"hlsnative":this.playerComponent instanceof f.O?this.playerComponent.isHlsPlaceholder?"jpegToHls":"jpeg":"unknown player type",(0,u.PN)(e),this.bindVideoEvents(),this.stylePlayerComponent()}removePlayer(){this.playerComponent.stop(),this.playerComponent.onForceRemoved(),this.removeChild(this.playerComponent)}forceHlsPlayer(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.vC.RandomEdge;const s=this.playerComponent.getSource();let n;this.removePlayer(),n="hlsnative"===this.chooseHLSPlayer()?new g.S(this.roomStatusNotifier):this.createVideoJsPlayer();const o=e=>{n.setMuted(!t),(0,a.Pf)("loadeddata",n.videoElement,o)};switch((0,a.wu)("loadeddata",n.videoElement,o),n.handleRoomLoaded(e),i){case v.vC.NewEdge:n.setSource(s),n.refreshStreamOnNewEdge(e);break;case v.vC.SameEdge:n.setSource(s),n.refreshStreamOnSameEdge(e);break;case v.vC.RandomEdge:default:n.refreshStream(e)}t?(n.setVolume(100),n.setMuted(!1)):n.setMuted(!0),this.playerComponent=this.prependChild(n),this.afterPlayerCreated(),this.repositionChildren()}forceJPEGPushPlayer(e){this.removePlayer(),this.createPlayer("jpeg"),this.playerComponent.handleRoomLoaded(e)}}function S(e,t,i){let s=t/(i?y.qL:y.Bu),n=t;return s>e&&(s=e,n=s*(i?y.qL:y.Bu)),[s,n]}},3131:(e,t,i)=>{"use strict";i.d(t,{S:()=>y,T:()=>f});var s=i(7507),n=i.n(s),o=i(1246),r=i.n(o),a=i(7623),l=i(6784),h=i(1516),d=i(8423),c=i(1779),u=i(7407),p=i(4947),m=i(3860),g=i(5389),v=i(580);const f=new d.c_("HlsNativePlayer:AirPlayChange");class y extends v.vS{constructor(e){super(e,"HlsNativePlayer"),this.lastTimeUpdate=0,this.userUnmuted=!1,this.prevIsMuted=!0,this.showingNativeControls=!1,this.playerType="Native",this.playableHlsPlayer=this.videoElement,this.element.appendChild(this.videoElement),this.videoMetrics.bindAllHTMLMedia(this.videoElement,this.element),f.listen((e=>{this.isCasting=e})),h.s.listen((e=>{this.chatMode=e})),this.videoElement.onclick=e=>{this.play(),debug(["click",e])},this.videoElement.onpause=e=>{debug(["pause",e])},this.videoElement.onplay=e=>{(0,u.bT)("VideoOnloadMuteStatus",{muted:this.videoElement.muted,chatMode:this.chatMode}),this.videoElement.muted?this.prevIsMuted=!0:this.userUnmuted=!0,debug(["play",e])},this.videoElement.oncanplay=e=>{debug(["canplay",e]),this.isStreamReconnecting&&this.removeReconnecting()},this.videoElement.oncanplaythrough=e=>{debug(["canplaythrough",e]);const t=(0,a.yb)();(void 0===t||t<15)&&this.play()},this.videoElement.onseeking=e=>{debug(["seeking",e])},this.videoElement.onerror=e=>{if(void 0!==this.videoAnalytics){let t="HlsNative Error";"string"==typeof e&&(t=e),this.videoAnalytics.reportPlaybackError(t,n().Constants.ErrorSeverity.FATAL)}null===this.videoElement.error||2!==this.videoElement.error.code&&4!==this.videoElement.error.code||(clearTimeout(this.refreshTimeout),this.refreshTimeout=window.setTimeout((()=>{this.refreshStreamOnSameEdge(this.context)}),2e3)),error(e,{},"VIDEO_")},this.videoElement.onvolumechange=e=>{const t=this.videoElement.volume;let i=this.videoElement.muted;0===t&&(i=!0),i||this.userUnmuted||0!==(0,u.iA)()||(this.userUnmuted=!0,(0,u.bT)("UserUnmuted",{chatMode:this.chatMode})),this.prevIsMuted!==i&&this.showingNativeControls&&(0,u.bT)("ToggleMute",{newState:i}),this.setControlIsMuted.fire({isMuted:i,save:!0}),this.setControlVolume.fire({volume:100*t,save:!0}),void 0===this.unmuteContainer||i||(this.element.removeChild(this.unmuteContainer),this.unmuteContainer=void 0),this.prevIsMuted=i},this.videoElement.onstalled=e=>{(0,g.gA)()&&!this.isInPictureInPicture&&(this.videoElement.pause(),window.setTimeout((()=>{this.play()}),10))},(0,l.wu)("enterpictureinpicture",this.videoElement,(()=>{debug("enterpictureinpicture"),v.CY.fire({active:!0})})),(0,l.wu)("leavepictureinpicture",this.videoElement,(()=>{debug("leavepictureinpicture"),v.CY.fire({active:!1,videoPaused:this.videoElement.paused})}));let t=this.videoElement.webkitPresentationMode;(0,l.wu)("webkitpresentationmodechanged",this.videoElement,(()=>{const e=this.videoElement.webkitPresentationMode;-1!==["inline","fullscreen"].indexOf(t)&&"picture-in-picture"===e?(debug("enterpictureinpicture"),v.CY.fire({active:!0})):"picture-in-picture"===t&&-1!==["inline","fullscreen"].indexOf(e)&&(debug("leavepictureinpicture"),v.CY.fire({active:!1,videoPaused:this.videoElement.paused})),"fullscreen"===e&&m.L.setFireVideoMode("noninteractive-fullscreen"),"fullscreen"===t&&m.L.setFireVideoMode(m.L.getPreviousNonFullscreenVideoMode()),t=e})),10===(0,a.yb)()&&this.createiOSUnmute()}loadHlsStream(e,t){this.setTooMuchWaitingTimeout(e),null===this.videoElement.onplaying&&(this.videoElement.onplaying=t=>{this.setTooMuchWaitingTimeout(e)}),null===this.videoElement.ontimeupdate&&(this.videoElement.ontimeupdate=t=>{const i=this.videoElement.currentTime;i-this.lastTimeUpdate>5&&(this.lastTimeUpdate=i,this.setTooMuchWaitingTimeout(e,(()=>{this.lastTimeUpdate=0})),this.tryingTimeoutRefresh=!1)}),""!==t?(this.videoElement.src=t,this.roomStatusNotifier.hide()):this.videoElement.removeAttribute("src"),this.videoElement.load(),this.videoElement.style.display="inline";const i=(0,a.yb)();(!("oncanplaythrough"in window)||void 0!==i&&i>=15)&&this.play(),""===t&&(this.stop(),this.stopTooMuchWaitingTimeout())}setVolume(e){this.videoElement.volume=e/100}getVolume(){return this.videoElement.muted||!this.isStreamReconnecting&&this.videoElement.paused?0:100*this.videoElement.volume}setMuted(e){this.videoElement.muted=e,this.setControlIsMuted.fire({isMuted:e,save:!0}),e?this.videoElement.setAttribute("muted",""):this.videoElement.removeAttribute("muted")}stop(){this.lastTimeUpdate=0,this.videoElement.style.display="none",this.videoElement.pause(),this.videoElement.removeAttribute("src"),this.videoElement.load(),super.stop()}showNativeControls(){super.showNativeControls(),this.showingNativeControls||(this.showingNativeControls=!0,this.videoElement.setAttribute("controls",""),void 0!==this.unmuteContainer&&(this.unmuteContainer.style.display="block"))}hideNativeControls(){this.showingNativeControls&&(this.showingNativeControls=!1,this.videoElement.removeAttribute("controls"),void 0!==this.unmuteContainer&&(this.unmuteContainer.style.display="none"))}showCustomControls(){super.showCustomControls(),this.hideNativeControls()}setQualityLevel(e){}setVolumeMuted(e,t){this.videoElement.volume=e/100,0===e||t?(this.videoElement.muted=!0,this.videoElement.setAttribute("muted","")):(this.videoElement.muted=!1,this.videoElement.removeAttribute("muted"))}getControlBarHeight(){return 0}enterFullScreenMode(){(0,c.lh)(this.videoElement),this.showNativeControls()}toggleFullscreen(){this.enterFullScreenMode()}getVideoElement(){return this.videoElement}createiOSUnmute(){this.unmuteContainer=document.createElement("span"),this.unmuteContainer.style.position="absolute",this.unmuteContainer.style.top="6px",this.unmuteContainer.style.right="6px",this.unmuteContainer.style.opacity="0.8",this.unmuteContainer.style.float="right",this.unmuteContainer.style.backgroundColor="rgba(255, 255, 255, 0.8)",this.unmuteContainer.style.borderRadius="6px",this.unmuteContainer.style.height="36px",this.unmuteContainer.style.padding="3px",this.unmuteContainer.style.cursor="pointer";const e=document.createElement("span");e.textContent=p.R.tapToUnmute,e.style.color="#0c6a93",e.style.fontSize="14px",e.style.padding="6px",e.style.position="relative",e.style.top="2px",e.style.textShadow="0 0 1px #0c6a93";const t=document.createElement("img");t.src=`${STATIC_URL_ROOT}images/volume-mute.svg`,t.style.width="36px",t.style.height="36px",t.style.display="inline",t.style.verticalAlign="middle",this.unmuteContainer.appendChild(e),this.unmuteContainer.appendChild(t),this.element.appendChild(this.unmuteContainer),this.unmuteContainer.onclick=()=>{this.setMuted(!1),void 0!==this.unmuteContainer&&(this.element.removeChild(this.unmuteContainer),this.unmuteContainer=void 0)},window.setTimeout((()=>{e.style.display="none"}),5e3)}setupConvivaPlayer(){void 0!==this.videoAnalytics&&this.videoAnalytics.setPlayer(this.videoElement,{[n().Constants.CONVIVA_MODULE]:r()})}}},580:(e,t,i)=>{"use strict";i.d(t,{CY:()=>R,Mc:()=>M,W:()=>I,vC:()=>E,vS:()=>L});var s=i(352),n=i(7507),o=i.n(n),r=i(6624),a=i(7623),l=i(9461),h=i(5914),d=i(1224),c=i(6784),u=i(5216),p=i(2709),m=i(8423),g=i(6440),v=i(6716),f=i(4580),y=i(7407),b=i(1452),w=i(8255),C=i(2945),S=i(4110),x=i(3860),T=i(5389),P=i(1282),k=i(3049),A=i(1021);const M=20,R=new m.c_("pictureInPictureChange"),I=new m.c_("LLHLSFallback");var E;!function(e){e[e.RandomEdge=0]="RandomEdge",e[e.NewEdge=1]="NewEdge",e[e.SameEdge=2]="SameEdge"}(E||(E={}));class L extends p.u{constructor(e,t){super(),this.roomStatusNotifier=e,this.newRelicName=t,this.requestJPEG=new m.c_("requestJPEG"),this.requestControlVisibility=new m.c_("requestControlVisibility"),this.setControlVolume=new m.c_("setControlVolume"),this.setControlIsMuted=new m.c_("setControlIsMuted"),this.supportsAutoplayWithAudio=!0,this.videoElement=document.createElement("video"),this.isStreamReconnecting=!1,this.connectingOverlay=document.createElement("div"),this.connectingTimeouts=[],this.possibleQualityLevelsChanged=new m.c_("possibleQualityLevelsChanged"),this.videoOfflineChange=new m.c_("videoOfflineChange"),this.playbackStart=new m.c_("playbackStart"),this.showJpeg=!0,this.videoOffline=!1,this.isInPictureInPicture=!1,this.tryingTimeoutRefresh=!1,this.startTime=0,this.loading=0,this.pageLoaded=0,this.metaLoaded=0,this.dataLoaded=0,this.loadStart=0,this.minutesSincePlay=0,this.startTimesSent=!1,this.lastDropped=0,this.lastFrames=0,this.sessionFrames=0,this.sessionDropped=0,this.roomCount=0,this.hiddenTotal=0,this.hiddenDropped=0,this.isDisabled=!1,this.enableLLHLS=!1,this.listeners=new m.gt,this.allowLLHLS=!1,this.waitingCounter=0,this.unloadSent=!1,this.updateLLHLSButton=new m.c_("updateLLHLSButton"),this.firstLoad=!0,this.isCasting=!1,this.apiFailures=0,this.visibilityChange=e=>{if(e){if(void 0!==this.leaveFrames){const e=this.videoElement.getVideoPlaybackQuality();this.hiddenTotal+=e.totalVideoFrames-this.leaveFrames.totalVideoFrames,this.hiddenDropped+=e.droppedVideoFrames-this.leaveFrames.droppedVideoFrames}void 0!==this.videoAnalytics&&o().Analytics.reportAppForegrounded()}else this.leaveFrames=this.videoElement.getVideoPlaybackQuality(),void 0!==this.videoAnalytics&&o().Analytics.reportAppBackgrounded();if((0,a.Xb)()&&!this.isCasting){clearTimeout(this.onlinePollingTimeout),this.onlinePollingTimeout=void 0,this.setAutoplay(e);const t=()=>{this.getHlsUrlAndRoomStatus(this.context,!1,!0).then((e=>{this.apiFailures=0,void 0!==this.videoAnalytics&&this.videoAnalytics.reportPlaybackMetric(o().Constants.Playback.SEEK_ENDED),e.status!==this.roomStatus?(this.context.chatConnection.changeStatus(e.status),l.Aw.setState({roomStatus:e.status})):this.refreshStreamOnSameEdge(this.context)})).catch((()=>{this.apiFailures>1?(this.apiFailures=0,error("Attempting to fallback to JPEG player."),this.setControlIsMuted.fire({isMuted:!0,save:!1}),this.requestJPEG.fire(this.context)):(this.apiFailures+=1,window.setTimeout((()=>{t()}),500))}))};e?t():this.videoElement.pause()}},this.element.style.position="static",this.element.style.background=`#333333 url(${STATIC_URL}cam_notice_background.jpg) center center / cover`,this.element.className="videoPlayerDiv",this.element.dataset.testid="video-container",this.videoElement.setAttribute("webkit-playsinline",""),this.videoElement.setAttribute("playsinline",""),this.videoElement.style.margin="0",this.videoElement.style.padding="0",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.objectFit="contain",this.videoElement.style.backgroundColor="rgba(0, 0, 0, 0.0)",this.videoElement.dataset.testid="video",this.videoElement.id="chat-player",this.setAutoplay(!0),this.element.appendChild(this.videoElement),window.videoElement=this.videoElement,this.connectingOverlay.style.backgroundColor="#000000",this.connectingOverlay.style.opacity="0.6",this.connectingOverlay.style.position="absolute",this.connectingOverlay.style.width="inherit",this.connectingOverlay.style.height="inherit",this.videoMetrics=new A._9(t),this.videoMetrics.bindAll(),R.listen((e=>{this.isInPictureInPicture=e.active})).addTo(this.listeners),v.VZ.listen((()=>{this.endSession()})).addTo(this.listeners),f.VZ.listen((()=>{this.endSession()})).addTo(this.listeners),this.videoElement.onloadstart=()=>{0!==this.loading&&(this.loadStart=Date.now()-this.loading),this.startConviva()},this.videoElement.onloadeddata=()=>{0!==this.loading&&(this.dataLoaded=Date.now()-this.loading)},this.videoElement.onloadedmetadata=()=>{0!==this.loading&&(this.metaLoaded=Date.now()-this.loading)},this.videoElement.onplaying=e=>{if(!1===this.startTimesSent){this.roomCount+=1;let e=0,t=0;0!==this.loading&&(e=Date.now()-this.loading),0!==this.pageLoaded&&(t=Date.now()-this.pageLoaded),this.videoMetrics.sendStartTimes(e,t,this.dataLoaded,this.metaLoaded,this.loadStart,this.roomStatus,this.roomCount,this.videoElement.height),this.startQualityTracking(),this.startTimesSent=!0,void 0!==this.waitingStart&&(this.waitingCounter+=Date.now()-this.waitingStart,this.waitingStart=void 0)}(0,a.nr)()&&(this.videoElement.style.objectFit="contain"),this.updateStreamToggle()},void 0===(0,C.JO)(window.location.search)["disable-player-fallback"]&&(this.videoElement.onwaiting=()=>{var e;if(this.enableLLHLS&&!(0,P.zb)()&&"bad"!==(null===(e=l.Aw.getState().quality)||void 0===e?void 0:e.quality)){if(this.waitingCounter>15e3)return void this.forceHlsFallback("Buffering");this.waitingStart=Date.now()}},window.setInterval((()=>{this.waitingCounter=0}),6e4));const i=()=>{this.showControls(),this.play();const e=()=>{this.play()};(0,c.wu)("pause",this.videoElement,e),window.setTimeout((()=>{(0,c.Pf)("pause",this.videoElement,e)}),600)};(0,c.wu)("webkitendfullscreen",this.videoElement,i),(0,c.wu)("leavepictureinpicture",this.videoElement,i),(0,c.wu)("beforeunload",window,this.stopConviva.bind(this)),T.g$.listen(this.visibilityChange).addTo(this.listeners),(0,c.wu)("pagehide",window,this.sendUnloadEvent.bind(this)),(0,c.wu)("beforeunload",window,this.sendUnloadEvent.bind(this)),(0,c.wu)("pageshow",window,this.maybeSendUnloadEvent.bind(this)),(0,c.wu)("popstate",window,this.maybeSendUnloadEvent.bind(this)),I.listen((e=>{this.forceHlsFallback(e)})).addTo(this.listeners)}setEnableLLHLS(e){this.enableLLHLS=e,this.videoMetrics.setEnableLLHLS(e)}async getHlsUrlAndRoomStatus(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.dossier.hlsSource===this.lastSeenHlsUrl||""===e.dossier.hlsSource||i||t){let s="";if(void 0!==this.currentSrc&&""!==this.currentSrc)try{s=new URL(this.currentSrc).hostname}catch(e){error("Unable to parse current edge",{error:e,url:this.currentSrc})}const n=await(0,u.KF)("get_edge_hls_url_ajax/",{room_slug:e.dossier.room,bandwidth:"high",current_edge:i?s:"",exclude_edge:t?s:""}),o=JSON.parse(n.responseText);if(o.success)return this.lastSeenHlsUrl=o.url,{url:this.fullyParseURL(o.url),status:(0,w.PZ)(o.room_status)};throw n.responseText}{this.lastSeenHlsUrl=e.dossier.hlsSource;let t=e.chatConnection.status;return this.videoOffline&&(t="offline"),{url:this.fullyParseURL(e.dossier.hlsSource),status:t}}}parseHlsUrl(e){const t=(0,C.JO)(window.location.search)["init-edgemm"];if(void 0!==t&&void 0===window._hasUsedEdgeQueryParam&&""!==e)return window._hasUsedEdgeQueryParam=!0,e.replace(/(^https:\/\/)(.+?)(\/.+)/,`https://${t}.live.mmcdn.com$3`);const i=(0,C.JO)(window.location.search);return void 0!==i.edgemm?e.replace(/(^https:\/\/)(.+?)(\/.+)/,`https://${i.edgemm}.live.mmcdn.com$3`):void 0!==i.edge?e.replace(/(^https:\/\/)(.+?)(\/.+)/,`https://edge${i.edge}.stream.highwebmedia.com$3`):e}refreshStream(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.stop(),this.isDisabled?this.stopQuality():(async()=>{if(this.stopQuality(),this.waitingCounter=0,this.waitingStart=void 0,this.pageLoaded=Date.now(),e.dossier.room!==this.room)return void debug("Trying to refresh old room context");let s,n;this.sessionFrames+=this.lastFrames,this.sessionDropped+=this.lastDropped,this.lastFrames=0,this.lastDropped=0,this.hiddenTotal=0,this.hiddenDropped=0,this.leaveFrames=void 0;try{const o=await this.getHlsUrlAndRoomStatus(e,t,i);s=o.url,n=o.status}catch(e){return void error("Unable to refresh HLS stream",{error:e})}"offline"===this.roomStatus&&n!==this.roomStatus&&(this.isStreamReconnecting=!0),this.videoOffline="offline"===n,this.videoOfflineChange.fire(this.videoOffline),"notconnected"===this.roomStatus||"offline"!==n?"privatenotwatching"===this.roomStatus&&this.roomStatus===n&&h.U.isEnabledForUI()||(this.roomStatus=n,this.updateConviva(s,e.dossier.room),this.loadHlsStream(e,s)):this.setOfflinePollingTimeout(e)})().catch(b.yZ)}refreshStreamOnNewEdge(e){this.refreshStream(e,!0,!1)}refreshStreamOnSameEdge(e){this.refreshStream(e,!1,!0)}async tryVideoStart(){const e=this.playableHlsPlayer.play();if(void 0===e)return{api:"old",success:!this.videoElement.paused};try{return await e,{api:"new",success:!0}}catch(e){return{api:"new",success:!1,error:e}}}async playInternal(){const e=await this.tryVideoStart();if(e.success)return void this.playbackStart.fire(void 0);"old"===e.api&&(0,y.bT)("NoPromiseAutoplayPolicy"),S.kw.fire(void 0),this.setMuted(!0);const t=await this.tryVideoStart();t.success?this.playbackStart.fire(void 0):"new"===t.api&&(this.isStreamReconnecting||(warn("Unable to play twice in a row",{err:t.error},"VIDEO_"),(0,a.Pb)()&&(error("Attempting to fallback to JPEG player."),void 0!==this.videoAnalytics&&((0,s.trackCustomEvent)({name:"JpegFallback",data:{roomName:this.room,broadcasterID:this.roomUid}}),this.videoAnalytics.reportPlaybackError("JpegFallback",o().Constants.ErrorSeverity.FATAL)),this.stopQuality(),this.stopConviva(),this.setControlIsMuted.fire({isMuted:!0,save:!1}),this.requestJPEG.fire(this.context))),this.handleNeverPlayed())}play(){this.shouldPreventPlay()?this.stopTooMuchWaitingTimeout():this.playInternal().catch(b.yZ)}stop(){this.roomStatusNotifier.displaysForStatus(this.roomStatus)&&(this.removeReconnecting(),this.clearPlayerTimeouts()),this.isStreamReconnecting&&this.clearPlayerTimeouts(),this.stopTooMuchWaitingTimeout()}stopVideoAndMetrics(){this.endSession(),this.videoMetrics.endSession(),this.firstLoad=!1,this.stop(),this.stopConviva()}clearPlayerTimeouts(){for(const e of this.connectingTimeouts)clearTimeout(e);clearTimeout(this.offlinePollingTimeout),this.offlinePollingTimeout=void 0,clearTimeout(this.onlinePollingTimeout),this.onlinePollingTimeout=void 0}setVolume(e){this.videoElement.volume=e/100}getVolume(){return this.videoElement.muted||!this.isStreamReconnecting&&this.videoElement.paused?0:100*this.videoElement.volume}getMuted(){return 0===this.videoElement.volume||this.videoElement.muted}showNativeControls(){this.requestControlVisibility.fire(!1)}showCustomControls(){this.requestControlVisibility.fire(!0)}showControls(){(0,k.cX)()?this.showCustomControls():this.showNativeControls()}hideControls(){this.requestControlVisibility.fire(!1),this.hideNativeControls()}setVolumeMuted(e,t){}enterFullScreenMode(){}getControlBarHeight(){return 0}handleNeverPlayed(){this.stopTooMuchWaitingTimeout()}handleRoomLoaded(e){this.videoOffline=!1,this.showJpeg=!l.Bm.current.isTestbed,this.videoElement.poster=this.showJpeg?`${d.m.jpegStreamUrl}stream?room=${e.dossier.room}&f=${Math.random()}`:"",this.context=e,this.room=e.dossier.room,this.roomUid=e.dossier.roomUid,this.userlistColor=e.dossier.userlistColor,this.roomStatusNotifier.displaysForStatus(e.dossier.roomStatus)||this.videoOffline||!(0,k.kt)()||this.handleConviva(),void 0===this.currentSrc&&(this.currentSrc=e.dossier.hlsSource),this.loading=Date.now(),e.chatConnection.event.statusChange.listen((t=>{if(this.roomStatus=t.currentStatus,this.updateStreamToggle(),this.videoMetrics.setStatus(this.roomStatus),this.roomStatusNotifier.displaysForStatus(t.currentStatus)||this.videoOffline)this.stopVideoAndMetrics(),this.videoOffline?this.setOfflinePollingTimeout(e):(clearTimeout(this.onlinePollingTimeout),this.onlinePollingTimeout=void 0,this.setOnlinePollingTimeout(e));else{switch(clearTimeout(this.onlinePollingTimeout),this.onlinePollingTimeout=void 0,t.previousStatus){case"notconnected":case"privaterequesting":break;default:"notconnected"===t.currentStatus?(this.setReconnecting(e.dossier.room),window.setTimeout((()=>{this.firstLoad?(this.firstLoad=!1,this.refreshStream(e)):this.refreshStreamOnSameEdge(e)}),0)):(this.connectingTimeouts.push(window.setTimeout((()=>{this.setReconnecting(e.dossier.room)}),0)),this.connectingTimeouts.push(window.setTimeout((()=>{this.refreshStreamOnSameEdge(e)}),3e3)))}(0,k.kt)()&&void 0===this.videoAnalytics&&this.handleConviva()}})).addTo(this.listeners)}setReconnecting(e){const t=this.showJpeg?`${d.m.jpegStreamUrl}stream?room=${e}&f=${Math.random()}`:"";this.element.style.background=`#333333 url(${t}) center center / cover`,this.roomStatusNotifier.showConnectingStatus(),this.element.insertBefore(this.connectingOverlay,this.element.firstChild),this.isStreamReconnecting=!0}removeReconnecting(){this.isStreamReconnecting=!1,this.roomStatusNotifier.hideConnectingStatus(),this.connectingOverlay.parentElement===this.element&&this.element.removeChild(this.connectingOverlay),this.element.style.background=`#333333 url(${STATIC_URL}cam_notice_background.jpg) center center / cover`}setOnlinePollingTimeout(e){void 0===this.onlinePollingTimeout&&(this.onlinePollingTimeout=window.setTimeout((async()=>{"offline"===(await this.getHlsUrlAndRoomStatus(e,!1,!0)).status?(this.videoOffline=!0,clearTimeout(this.onlinePollingTimeout),this.onlinePollingTimeout=void 0,this.setOfflinePollingTimeout(e),this.videoOfflineChange.fire(this.videoOffline)):(clearTimeout(this.onlinePollingTimeout),this.onlinePollingTimeout=void 0,this.setOnlinePollingTimeout(e))}),1e4))}setOfflinePollingTimeout(e){void 0===this.offlinePollingTimeout&&(this.offlinePollingTimeout=window.setTimeout((()=>{this.offlinePollingTimeout=void 0,this.refreshStreamOnSameEdge(e)}),1e4))}setTooMuchWaitingTimeout(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};this.stopTooMuchWaitingTimeout(),void 0===(0,C.JO)(window.location.search)["disable-player-fallback"]&&(this.tooMuchWaitingTimeout=window.setTimeout((()=>{if(this.tryingTimeoutRefresh){if(this.removeReconnecting(),this.stopQuality(),void 0!==this.videoAnalytics){const e=this.enableLLHLS?"LLHLS Fallback":"HLS Fallback";this.videoAnalytics.reportPlaybackError(e,o().Constants.ErrorSeverity.FATAL),(0,s.trackCustomEvent)({name:e,data:{roomName:this.room,broadcasterID:this.roomUid}})}this.stopConviva(),this.enableLLHLS&&this.allowLLHLS?this.forceHlsFallback("Subsequent Timeout"):(error("Attempting to fallback to JPEG player."),this.setControlIsMuted.fire({isMuted:!0,save:!1}),this.requestJPEG.fire(this.context))}else!(0,T.gA)()||this.isInPictureInPicture?this.setTooMuchWaitingTimeout(e,t):(info("Video seems to be stuck, refreshing"),this.tryingTimeoutRefresh=!0,this.refreshStreamOnSameEdge(e),t())}),1e3*M/2))}stopTooMuchWaitingTimeout(){void 0!==this.tooMuchWaitingTimeout&&(clearTimeout(this.tooMuchWaitingTimeout),this.tooMuchWaitingTimeout=void 0)}getVideoElement(){return this.videoElement}onForceRemoved(){this.endSession(),this.listeners.removeAll(),this.cleanupEventListeners(),this.videoMetrics.playerForceRemoved(),this.videoElement.remove()}setPageLoaded(e){this.pageLoaded=e}stopQuality(){clearInterval(this.updateQuality)}startQualityTracking(){this.stopQuality(),window.setTimeout((()=>{this.sendQuality(!1),this.updateQuality=window.setInterval((()=>{this.sendQuality(!1)}),6e4)}),15e3)}sendQuality(e){if(e||!document.hidden&&!["away","privatenotwatching","hidden","offline"].includes(this.roomStatus)){let t=0,i=0,s=0,n=0,o=0,r=0;if(!(0,a.OF)()){const e=this.videoElement.getVideoPlaybackQuality();i=e.droppedVideoFrames-this.hiddenDropped,t=e.totalVideoFrames-this.hiddenTotal,o=i-this.lastDropped,r=t-this.lastFrames,n=-1,r>0&&(n=o/r*100),t=this.sessionFrames+t,i=this.sessionDropped+i,s=-1,t>0&&(s=i/t*100),this.lastFrames=t,this.lastDropped=i}let l=this.minutesSincePlay;e&&(l=-1);const h=this.videoElement.videoHeight*this.videoElement.videoWidth;this.videoMetrics.sendQuality(s,n,t,r,h,this.videoElement.videoHeight,l,this.roomStatus)}this.minutesSincePlay+=1}initConviva(){let e="11bbd19872403a8c17a3c4a24fe2b5501f6831b9";l.Bm.current.isInternal&&(e="224075d7f3c1654ccd30d05396d7b47e49dd6da3"),o().Analytics.init(e,null,{});const t={};t[o().Constants.DeviceMetadata.CATEGORY]=o().Constants.DeviceCategory.WEB,t[o().Constants.DeviceMetadata.TYPE]=(0,a.Xb)()?o().Constants.DeviceType.MOBILE:o().Constants.DeviceType.DESKTOP,o().Analytics.setDeviceMetadata(t),this.videoAnalytics=o().Analytics.buildVideoAnalytics()}startConviva(){let e="anon",t="false";if(void 0!==l.Bm.current.loggedInUser?(e=l.Bm.current.loggedInUser.userUid,t="true"):e=`${e}_${this.videoMetrics.getSessionID()}`,void 0!==this.videoAnalytics){const i={[o().Constants.ASSET_NAME]:this.room,[o().Constants.IS_LIVE]:o().Constants.StreamType.LIVE,[o().Constants.VIEWER_ID]:e,[o().Constants.PLAYER_NAME]:this.playerType,"c3.app.version":"v24.12.3.0",userColor:this.userlistColor,loggedIn:t},s=document.location.href.match(/^https?:\/\/([^/]+).*$/);i.domain=null!==s?s[1]:"",this.videoAnalytics.reportPlaybackRequested(i)}}handleConviva(){this.stopConviva(),this.initConviva(),this.setupConvivaPlayer()}updateConviva(e,t){const i=e.match(/^https:\/\/edge(.+)\.live/),s=e.match(/(live-.+)\/amlst/);this.host=new URL(e).hostname,this.edge=null!==i?i[1]:"",this.playlistResource=null!==s?s[1]:"",void 0!==this.videoAnalytics&&this.videoAnalytics.setContentInfo({[o().Constants.ASSET_NAME]:t,[o().Constants.STREAM_URL]:e,[o().Constants.DEFAULT_RESOURCE]:this.host,broadcasterID:this.roomUid,edgeName:this.edge,playlistResource:this.playlistResource,streamType:this.enableLLHLS?"llhls":"hls",videoMode:x.L.getVideoMode()}),this.videoMetrics.updateResourceInfo(this.host,this.edge,this.playlistResource)}stopConviva(){if(void 0!==this.videoAnalytics)try{this.videoAnalytics.reportPlaybackEnded(),this.videoAnalytics.release(),o().Analytics.release(),this.videoAnalytics=void 0}catch(e){error("Error stopping conviva",{error:e})}}disable(e){this.isDisabled=e}forceHlsFallback(e){(0,P.Vk)(!0),this.setEnableLLHLS(!1),error("Attempting to fallback to HLS stream.");const t=this.currentSrc.match(/^https:\/\/edge(.+)\.live/);this.videoMetrics.LLHLSFallback(this.currentSrc,t,this.playerType,e),this.handleConviva(),this.endSession(),this.videoMetrics.endSession(),this.refreshStreamOnNewEdge(this.context),(0,a.nr)()&&(this.videoElement.style.objectFit="fill")}forceStream(e){if(e!==this.enableLLHLS){if(this.disableToggle())return;(0,P.rC)(e);const t=this.currentSrc.match(/^https:\/\/edge(.+)\.live/);(0,y.bT)("StreamTypeChange",{source:this.currentSrc,streamType:e?"llhls":"hls",edge:null!==t?t[1]:"",playerType:this.playerType}),(0,k.kt)()&&(0,s.trackCustomEvent)({name:"StreamTypeChange",data:{roomName:this.room,source:this.currentSrc,streamType:e?"llhls":"hls",edge:null!==t?t[1]:"",playerType:this.playerType}});const i=(0,C.JO)(window.location.search)["force-llhls"];this.setEnableLLHLS(e||void 0!==i),this.enableLLHLS&&(0,P.Vk)(!1),this.handleConviva(),this.endSession(),this.videoMetrics.endSession(),this.refreshStreamOnSameEdge(this.context),(0,a.nr)()&&(this.videoElement.style.objectFit="fill")}}getTrueURL(e){if(e=this.replaceSuffix(e),this.allowLLHLS){const t=/live-.+amlst/;let i="";this.shouldDisallowLLHLS()||"hls"===(0,P.uq)()||(0,P.zb)()?(this.setEnableLLHLS(!1),i=void 0!==l.Bm.current.loggedInUser?"live-fhls":"live-c-fhls"):(this.setEnableLLHLS(!0),i=void 0!==l.Bm.current.loggedInUser?"live-llhls":"live-c-llhls"),e=e.replace(t,`${i}/amlst`)}return e}replaceSuffix(e){return this.allowLLHLS&&e.includes("playlist.m3u8")?e=e.replace("playlist.m3u8","playlist_sfm4s.m3u8"):e.includes("playlist_sfm4s.m3u8")&&(e=e.replace("playlist_sfm4s.m3u8","playlist.m3u8")),e}setEdgeLLHLS(e){if(e.includes("mmcdn")&&void 0===(0,C.JO)(window.location.search)["force-llhls"]){const t=/^https:\/\/edge(.+)\.live/,i=e.match(t),s=(0,C.JO)(window.location.search)["llhls-capable-edge"];if(void 0!==s&&null!==i&&i[0].includes(s))return void(this.allowLLHLS=!0);if(null!==i&&void 0!==i[1]){const e=i[1].split("-")[0];if(20===Number(e))return void(this.allowLLHLS=!0)}this.allowLLHLS=!1,this.setEnableLLHLS(!1)}else this.allowLLHLS=!0}fullyParseURL(e){let t=this.parseHlsUrl(e);return this.isLLHLSForced(),(0,k.Ce)()&&(this.setEdgeLLHLS(t),t=this.getTrueURL(t)),this.updateStreamToggle(),t&&(this.currentSrc=t),this.videoMetrics.sendStreamType(this.enableLLHLS?"llhls":"hls",this.currentSrc),t}shouldDisallowLLHLS(){return void 0===(0,C.JO)(window.location.search)["force-llhls"]&&("Native"===this.playerType&&!(0,g.f)("VDPEnblNativeLLHLS")||"videoonly"===x.L.getVideoMode()||(0,a.Xb)()&&!(0,g.f)("VDPEnblMobileLLHLS"))}isLLHLSForced(){void 0!==(0,C.JO)(window.location.search)["force-llhls"]&&(this.allowLLHLS=!0,this.setEnableLLHLS(!0))}disableToggle(){return["hidden","privatenotwatching","notconnected","offline","away"].includes(this.roomStatus)}getSource(){return this.currentSrc}setSource(e){this.currentSrc=e}sendUnloadEvent(){!this.unloadSent&&this.startTimesSent&&(this.sendQuality(!0),this.unloadSent=!0)}maybeSendUnloadEvent(e){if(null!=e){const t="popstate"===e.type&&(void 0!==e.state&&null!==e.state&&"room"===e.state.type||r.UrlState.current.state.pageType===r.PageType.ROOM),i="pageshow"===e.type&&e.persisted;(t||i)&&this.endSession()}}cleanupEventListeners(){(0,c.Pf)("beforeunload",window,this.stopConviva.bind(this)),(0,c.Pf)("pagehide",window,this.sendUnloadEvent.bind(this)),(0,c.Pf)("beforeunload",window,this.sendUnloadEvent.bind(this)),(0,c.Pf)("pageshow",window,this.maybeSendUnloadEvent.bind(this)),(0,c.Pf)("popstate",window,this.maybeSendUnloadEvent.bind(this))}updateStreamToggle(){this.updateLLHLSButton.fire({allowed:this.allowLLHLS&&!this.shouldDisallowLLHLS()&&!this.disableToggle(),enabled:this.enableLLHLS})}resetRetryCounter(){}endSession(){this.stopQuality(),this.sendUnloadEvent(),this.videoMetrics.endSession(),this.resetRetryCounter(),this.sessionDropped=0,this.sessionFrames=0,this.minutesSincePlay=0,this.startTimesSent=!1,this.unloadSent=!1,this.lastFrames=0,this.lastDropped=0,this.hiddenDropped=0,this.hiddenTotal=0,this.apiFailures=0,this.loading=Date.now()}shouldPreventPlay(){return(0,a.Xb)()&&document.hidden&&!this.isCasting}setContainerElement(e){}setAutoplay(e){e?this.videoElement.setAttribute("autoplay","autoplay"):this.videoElement.removeAttribute("autoplay")}}},9321:(e,t,i)=>{"use strict";i.d(t,{O:()=>v});var s=i(6624),n=i(4936),o=i(7623),r=i(9461),a=i(1224),l=i(5216),h=i(2709),d=i(8423),c=i(1779),u=i(1452),p=i(8255),m=i(3860),g=i(1021);class v extends h.u{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.roomStatusNotifier=e,this.isHlsPlaceholder=t,this.requestControlVisibility=new d.c_("requestControlVisibility"),this.supportsAutoplayWithAudio=!1,this.possibleQualityLevelsChanged=new d.c_("possibleQualityLevelsChanged"),this.updateLLHLSButton=new d.c_("updateLLHLSButton"),this.videoOfflineChange=new d.c_("videoOfflineChange"),this.playbackStart=new d.c_("playbackStart"),this.lastFrameTime=0,this.loading=!1,this.muted=!0,this.stopped=!0,this.url="",this.lastTime=0,this.listenerGroup=new d.gt,this.isDisabled=!1,this.videoMetrics=new g.nH(this.isHlsPlaceholder?"JpegToHlsPlayer":"JpegPushPlayer"),this.videoMetrics.bindAll(),this.element.style.background=`#333333 url(${STATIC_URL}cam_notice_background.jpg) center center / cover`,this.element.className="videoPlayerDiv",this.element.style.position="static",this.element.dataset.testid="video-container",this.playerImage=document.createElement("img"),this.playerImage.style.width="100%",this.playerImage.style.height="100%",this.playerImage.style.objectFit="contain",this.playerImage.style.backgroundColor="black",this.playerImage.dataset.testid="video",this.playerImage.id="chat-player",this.playerImage.onload=()=>{this.playerImage.style.display="inline",this.loading=!1},this.playerImage.onerror=()=>{this.playerImage.style.display="none",this.lastTime-=100,this.loading=!1},this.element.appendChild(this.playerImage),(0,o.H9)()||(this.requestAnimationFrame=(0,o.xv)(),this.requestAnimationCallback(0))}updateAjaxUrl(){if(this.lastTime=Date.now(),void 0!==this.roomName)return(0,l.KF)("get_edge_hls_url_ajax/",{room_slug:this.roomName,jpeg:"1"}).then((e=>{const t=new n.N6(e.responseText),i=t.getBoolean("success");if("offline"===(0,p.JG)(t))return this.videoOfflineChange.fire(!0),void this.stop();this.videoOfflineChange.fire(!1),t.ignore("url"),t.ignore("hidden_message"),i?(this.url=t.getString("cbjpeg_url",!1),t.logUnusedDebugging("parseJpegStream")):error("Unable to refresh JPEG stream",{error:e.responseText},"VIDEO_")})).catch((e=>{error("Unable to refresh JPEG stream",{error:e},"VIDEO_")}))}requestAnimationCallback(e){this.isHlsPlaceholder||(Date.now()-this.lastTime>5e3&&this.updateAjaxUrl(),this.stopped||""===this.url||(0,o.H9)()?this.playerImage.style.visibility="hidden":(0===this.lastFrameTime||e-this.lastFrameTime>140)&&!this.loading&&(this.loading=!0,this.lastFrameTime=e,this.playerImage.src=`${this.url}&f=${Math.random()}`,"visible"!==this.playerImage.style.visibility&&(this.playbackStart.fire(void 0),this.playerImage.style.visibility="visible")),this.requestAnimationFrame.call(window,(e=>{this.requestAnimationCallback(e)})))}handleRoomLoaded(e){var t;this.stopped=!1,this.listenerGroup.removeAll(),e.chatConnection.event.statusChange.listen((e=>{this.roomStatusNotifier.displaysForStatus(e.currentStatus)||this.videoOffline?this.stop():(e.currentStatus,this.stopped=!1)})).addTo(this.listenerGroup),this.roomName=e.dossier.room,this.url=r.Bm.current.isTestbed?"":`${a.m.jpegStreamUrl}stream?room=${this.roomName}`,r.Aw.getState().activePassword?null===(t=this.updateAjaxUrl())||void 0===t||t.then((()=>{this.updateImage()})).catch(u.yZ):this.updateImage()}updateImage(){this.requestControlVisibility.fire(!0),this.isHlsPlaceholder&&(this.playerImage.src=`${this.url}&f=${Math.random()}`,this.showPlayerImage())}setVolume(e){this.volume=e}getVolume(){return this.muted?0:this.volume}setMuted(e){this.muted=e}stop(){this.playerImage.style.visibility="hidden",this.stopped=!0}showPlayerImage(){this.playerImage.style.visibility="visible"}setQualityLevel(){}showControls(){this.requestControlVisibility.fire(!0)}hideControls(){this.requestControlVisibility.fire(!1)}getControlBarHeight(){return 0}enterFullScreenMode(){m.L.setFireVideoMode("noninteractive-fullscreen");let e=this.element;void 0!==this.containerElement&&(e=this.containerElement),(0,c.lh)(e)}setVolumeMuted(e,t){}afterRemovedFromParent(){this.stop(),this.listenerGroup.removeAll()}getVideoElement(){}getIsHlsPlaceholder(){return this.isHlsPlaceholder}onForceRemoved(){this.videoMetrics.playerForceRemoved()}disable(e){this.isDisabled=e}forceHlsFallback(){}forceStream(){}getSource(){return this.url}setSource(e){}setContainerElement(e){this.containerElement=e}stopVideoAndMetrics(){(0,s.isRoomRoomlistSpaActive)()&&this.stop()}}},1282:(e,t,i)=>{"use strict";i.d(t,{Bu:()=>o,C6:()=>w,Ln:()=>u,Vk:()=>v,Y9:()=>p,dv:()=>y,nQ:()=>C,pD:()=>b,qL:()=>r,rC:()=>m,uq:()=>g,zb:()=>f});var s=i(7623),n=i(2758);const o=.75,r=.5625,a="defaultVideoQuality",l="defaultLLHLSSetting",h="llhlsFallback",d="convivaSession";function c(e){return`privateShow_${e}`}function u(e,t){if((0,s.Pf)())for(const i of e)i.value===t&&window.localStorage.setItem(a,i.label)}function p(){let e="auto";if((0,s.Pf)()){const t=window.localStorage.getItem(a);null!==t&&(e=t)}return e}function m(e){(0,n.aR)(l,e?"llhls":"hls",{days:60})}function g(){var e;return null!==(e=(0,n.y1)(l))&&void 0!==e?e:""}function v(e){(0,n.nw)(h,e?"true":"false",{hours:1})}function f(){return"true"===(0,n.TS)(h)}function y(){var e;return null!==(e=window.sessionStorage.getItem(d))&&void 0!==e?e:""}function b(e){window.sessionStorage.setItem(d,e)}function w(e,t,i){const s=c(e),n={price:t,end:i};window.localStorage.setItem(s,JSON.stringify(n))}function C(e){const t=c(e),i=window.localStorage.getItem(t);return null!==i?i:""}},3049:(e,t,i)=>{"use strict";i.d(t,{Ce:()=>c,cX:()=>h,kt:()=>d,mR:()=>u});var s=i(9461),n=i(6440),o=i(7407),r=i(2945),a=i(3860),l=i(1282);function h(){if(!0===s.Bm.current.isMobile)return!0;const e=a.L.getVideoMode();return!["videoonly","noninteractive-fullscreen"].includes(e)}function d(){if(void 0!==(0,r.JO)(window.location.search).conviva)return!0;let e=(0,l.dv)();return""===e&&(e=s.Bm.current.contextID,(0,l.pD)(e)),"0"===e.charAt(e.length-1)&&!s.Bm.current.noAnalytics&&(0,n.f)("VDPEnblConviva")}function c(){return(0,n.f)("VDPLLHLS")||void 0!==(0,r.JO)(window.location.search)["force-llhls"]}function u(e,t){(0,o.bT)("BroadcastBitrate",{streamType:e,bitrate:t})}},3933:(e,t,i)=>{"use strict";i.d(t,{y:()=>A});var s=i(352),n=i(7507),o=i.n(n),r=i(6461),a=i.n(r),l=i(7623),h=i(9461),d=i(213),c=i(1516),u=i(3955),p=i(6440),m=i(1779),g=i(7407),v=i(3306),f=i(8331),y=i(4947),b=i(2945),w=i(3860),C=i(5389),S=i(580),x=i(1282),T=i(3049);const P=window.videojs,k=window.Hls;class A extends S.vS{createPlayerOption(){return{techOrder:["html5"],autoplay:!0,html5:{hlsjsConfig:{capLevelToPlayerSize:void 0===h.Bm.current.loggedInUser,debug:!1,liveSyncDuration:3,liveSyncDurationCount:void 0,liveDurationInfinity:1/0,liveMaxLatencyDuration:7,liveMaxLatencyDurationCount:void 0,liveBackBufferLength:30,autoStartLoad:!1},nativeAudioTracks:!1},controlBar:{playToggle:!1,progressControl:!1,remainingTimeDisplay:!1,durationDisplay:!1,currentTimeDisplay:!1,timeDivider:!1,pictureInPictureToggle:!1},errorDisplay:!1}}constructor(e){super(e,"VideoJsPlayer"),this.lastTimeUpdate=0,this.isMuted=!0,this.neverPlayed=!1,this.userUnmuted=!1,this.chromecastOverlay=document.createElement("div"),this.currentBitrate=0,this.shouldExitToIFS=!0,this.isFullWindow=!1,this.handledEmptyChunklistsCnt=0,this.videoElement.className="video-js vjs-default-skin",P.log.level("error"),this.playerType="VideoJS",this.setupLLHLSButton(),this.chromecastOverlay.style.position="absolute",this.chromecastOverlay.style.backgroundColor="#000000",this.chromecastOverlay.style.width="inherit",this.chromecastOverlay.style.height="inherit";const t=this.createPlayerOption();this.element.onclick=()=>{this.neverPlayed&&((0,T.cX)()?this.showCustomControls():this.showNativeControls(),this.neverPlayed=!1)},(0,p.f)("VDPEnblTabSwitch")&&C.g$.listen((e=>{e&&this.enableLLHLS&&(this.videoElement.currentTime+=60)}));const i=P(this.videoElement,t);i.qualityPickerPlugin(),this.videoJs=i,this.playerId=this.videoElement.id,void 0!==i&&(this.videoMetrics.bindAllHTMLMedia(i,this.element),void 0!==P.Html5Hlsjs&&P.Html5Hlsjs.addHook("beforeinitialize",((e,t)=>{e===i&&this.videoMetrics.bindAllHlsJs(t),t.on(k.Events.MANIFEST_LOADED,((e,i)=>{const s=(0,x.Y9)(),n=Number((0,b.JO)(window.location.search).quality);if(void 0!==n&&!isNaN(n)&&void 0!==i.levels&&n<=i.levels.length-1&&n>=0)t.startLevel=n,t.loadLevel=n;else if(void 0!==i.levels&&"auto"!==s){let e=-1,n=i.levels[0];for(const t of i.levels)void 0!==t.height&&t.height<=parseInt(s,10)&&(e=i.levels.indexOf(t)),n=t;void 0!==this.videoAnalytics&&void 0!==n.height&&this.videoAnalytics.setContentInfo({maxQuality:n.height.toString()}),t.startLevel=e}})),t.on(k.Events.MANIFEST_LOADED,(()=>{t.startLoad()})),t.on(k.Events.LEVEL_SWITCHED,(()=>{if(void 0!==this.setLevels&&this.setLevels[this.setLevels.length-1].toggled&&(0,x.Ln)(this.setLevels,t.currentLevel),-1!==t.currentLevel){const e=t.levels[t.currentLevel];this.currentBitrate=e.bitrate/1e3,(0,T.kt)()&&(0,s.trackCustomEvent)({name:"qualitySwitched",data:{roomName:this.room,height:e.height,bitrate:this.currentBitrate,level:t.currentLevel,broadcasterID:this.roomUid}})}})),this.hls=t,this.setLLHLSConfig(),this.listenForEmptyChunklist(t)})),this.playableHlsPlayer=i,this.setupChromecastStateChange(),i.on("volumechange",(()=>{this.setVolume(this.getVolume(!1))})),i.on("canplay",(()=>{this.play(),this.isStreamReconnecting&&this.removeReconnecting()})),i.on("canplaythrough",(()=>{this.play()})),i.on("enterpictureinpicture",(()=>{debug("enterpictureinpicture"),S.CY.fire({active:!0})})),i.on("leavepictureinpicture",(()=>{debug("leavepictureinpicture"),window.setTimeout((()=>{S.CY.fire({active:!1,videoPaused:i.paused()})}),0)})),i.on("touchstart",(e=>{var t;document.getElementsByClassName("vjs-volume-panel")[0].classList.add("vjs-hover"),(i.controlBar.el().contains(e.target)||i.isFullscreen())&&!0!==(null===(t=this.fullscreenDropdownBtn)||void 0===t?void 0:t.contains(e.target))||e.target.click()})),this.addFullscreenListeners()),(0,T.cX)()?this.showCustomControls():this.showNativeControls(),window.videoJsPlayer=i,c.s.listen((e=>{this.chatMode=e})).addTo(this.listeners),void 0!==i.controlBar&&(i.controlBar.setAttribute("data-paction","VideoJSControls"),this.addFullscreenDropdown())}listenForEmptyChunklist(e){const t=XMLHttpRequest,i=t=>{const i=t.target;if(i.responseURL.includes("chunklist")&&200===i.status&&0===i.responseText.length&&void 0!==e){if(void 0!==this.currentEmptyChunklistsTimeout)return;this.handledEmptyChunklistsCnt<5&&(this.handledEmptyChunklistsCnt+=1,this.currentEmptyChunklistsTimeout=window.setTimeout((()=>{this.refreshStreamOnSameEdge(this.context),this.currentEmptyChunklistsTimeout=void 0}),500))}};window.XMLHttpRequest=function(){const e=new t;return e.addEventListener("loadend",i),e}}setupChromecastStateChange(){let e=0;const t=window.setInterval((()=>{e>=10&&clearInterval(t),void 0!==this.videoJs&&void 0!==this.videoJs.chromecastSessionManager&&(this.videoJs.chromecastSessionManager.getCastContext().addEventListener("sessionstatechanged",(e=>{if(void 0!==e.sessionState)switch(e.sessionState){case"SESSION_STARTED":case"SESSION_RESUMED":(0,l.Xb)()&&this.stopConviva(),this.removeTech(),this.removeEventListeners(),this.stop(),window.setTimeout((()=>{this.isCasting=!0,this.refreshStream(this.context),this.setVolume(this.getVolume(!1)),this.addChromecastMsgListener(),void 0!==this.videoJs&&void 0!==this.videoJs.tech()._ui&&(this.videoJs.tech()._ui._findTitleEl().style.visibility="hidden")}),1e3),this.roomStatusNotifier.hide(),this.addChromecastOverlay();break;case"SESSION_ENDED":const e=window.setInterval((()=>{null!==document.getElementById(this.playerId)&&void 0!==this.videoJs&&(this.videoJs.muted(this.isMuted),this.videoJs.volume(this.getVolume(!1)),window.clearInterval(e))}),100);window.setTimeout((()=>{window.clearInterval(e),(0,T.kt)()&&(0,l.Xb)()&&this.handleConviva(),void 0!==this.videoJs&&(this.videoJs.muted(this.isMuted),this.videoJs.volume(this.getVolume(!1))),this.isCasting=!1,this.refreshStream(this.context),this.addTech(),this.addEventListeners()}),2500),this.removeChromecastOverlay(),this.roomStatusNotifier.show()}})),clearInterval(t)),e+=1}),1e3)}resetRetryCounter(){void 0!==this.currentEmptyChunklistsTimeout&&(clearTimeout(this.currentEmptyChunklistsTimeout),this.currentEmptyChunklistsTimeout=void 0),this.handledEmptyChunklistsCnt=0}loadHlsStream(e,t){""!==t?(this.roomStatusNotifier.hide(),this.isCasting?(this.addChromecastOverlay(),this.roomStatusNotifier.hide(),this.stopTooMuchWaitingTimeout()):this.setTooMuchWaitingTimeout(e),void 0!==this.videoJs?(this.addLLHLSButton(),this.isCasting?this.videoJs.tech().setSource({src:t,type:"application/x-mpegURL"}):this.isCasting||(this.videoJs.on("playing",(()=>{this.setTooMuchWaitingTimeout(e)})),this.videoJs.on("waiting",(()=>{this.setTooMuchWaitingTimeout(e)})),this.videoJs.on("timeupdate",(t=>{if(void 0!==this.videoJs){const t=this.videoJs.currentTime();t-this.lastTimeUpdate>5&&(this.lastTimeUpdate=t,this.setTooMuchWaitingTimeout(e,(()=>{this.lastTimeUpdate=0})),this.tryingTimeoutRefresh=!1)}})),this.videoJs.off("error"),this.videoJs.on("error",(t=>{if(void 0!==this.videoJs){const i=this.videoJs.error();if(null!==i&&(2===i.code||4===i.code)){if(this.isStreamReconnecting||this.refreshStreamOnSameEdge(e),void 0!==this.videoAnalytics){let e="";const t=i.message.split("-").at(-1);void 0!==t&&(e=t.trim()),this.videoAnalytics.reportPlaybackError(e,o().Constants.ErrorSeverity.FATAL)}error(i.message,t,"VIDEO_")}}else error("Videojs error type undefined",t,"VIDEO_")})),this.videoJs.src({src:t,type:"application/x-mpegURL"}),this.videoJs.qualityPickerPlugin(),this.videoJs.show(),this.videoJs.muted(this.isMuted),this.videoElement.style.display="inline"),this.playableHlsPlayer=this.videoJs,this.addTech()):(0,d.Q$)("something went wrong")):this.stop()}addFullscreenListeners(){void 0!==this.videoJs&&(this.videoJs.on("enterFullWindow",(()=>{this.showNativeControls(),this.showElement(),this.isFullWindow=!0,w.L.setFireVideoMode("noninteractive-fullscreen")})),this.videoJs.on("exitFullWindow",(()=>{this.isFullWindow=!1,this.shouldExitToIFS||(0,m.Eh)(),m._c.fire(),this.shouldExitToIFS=!0})),m._c.listen((()=>{void 0!==this.videoJs&&!(0,m.aS)()&&this.isFullWindow&&this.videoJs.exitFullWindow()})))}addFullscreenDropdown(){if(void 0===this.videoJs)return;const e=this.videoJs.controlBar.addChild("button",{controlText:"Toggle Interactive Fullscreen",className:"vjs-fullscreen-dropdown"});this.fullscreenDropdownBtn=e.el();const t=document.createElement("img");t.src=`${f.N0}ellipsis-vertical.svg`,t.title=y.R.switchFullscreenModeLabel,(0,u.ZM)(t,{height:"16px",userSelect:"none"}),(0,u.ZM)(this.fullscreenDropdownBtn,{cursor:"pointer"}),this.fullscreenDropdownBtn.appendChild(t);const i=new v.n({toggleElement:this.fullscreenDropdownBtn,enterNativeFn:()=>{},enterInteractiveFn:()=>this.exitFullScreenMode()});(0,u.ZM)(i.element,{right:"20px"}),i.nativeOption.classList.add("active"),this.fullscreenDropdownBtn.appendChild(i.element);const s=this.videoJs.controlBar.getChild("fullscreenToggle");void 0!==s&&(s.handleClick=()=>{this.shouldExitToIFS=!1,this.exitFullScreenMode()})}removeFullscreenDropdown(){var e;void 0!==this.fullscreenDropdownBtn&&(null===(e=this.fullscreenDropdownBtn.parentNode)||void 0===e||e.removeChild(this.fullscreenDropdownBtn),this.fullscreenDropdownBtn=void 0)}addChromecastMsgListener(){if(this.isCasting&&void 0!==this.videoJs&&void 0!==this.videoJs.chromecastSessionManager){const e=this.videoJs.chromecastSessionManager.getCastContext().getCurrentSession();if(void 0!==e){let t=0;e.addMessageListener("urn:x-cast:com.highwebmedia.cast.media",((e,i)=>{this.isCasting&&i.includes("PAUSED")?(clearTimeout(t),t=window.setTimeout((()=>{this.refreshStream(this.context)}),2500)):this.isCasting&&i.includes("BUFFERING")?(clearTimeout(t),t=window.setTimeout((()=>{this.refreshStream(this.context)}),7500)):!this.isCasting||i.includes("PLAYING")?clearTimeout(t):this.isCasting&&i.includes("MEDIA_ERROR")&&this.refreshStreamOnNewEdge(this.context)}))}}}setVolume(e){if(void 0!==this.videoJs){const t=this.isMuted;this.isMuted=0===e||this.videoJs.muted(),!t||this.isMuted||this.userUnmuted||(this.userUnmuted=!0,(0,g.bT)("UserUnmuted",{chatMode:this.chatMode})),t!==this.isMuted&&(0,g.bT)("ToggleMute",{newState:this.isMuted}),this.setControlVolume.fire({volume:e,save:!0}),this.setControlIsMuted.fire({isMuted:this.isMuted,save:!0})}}setMuted(e){!this.isMuted||e||this.userUnmuted||(this.userUnmuted=!0,(0,g.bT)("UserUnmuted",{chatMode:this.chatMode})),e!==this.isMuted&&(0,g.bT)("ToggleMute",{newState:e}),this.isMuted=e,this.setControlIsMuted.fire({isMuted:e,save:!0}),void 0!==this.videoJs&&this.videoJs.muted(e)}setVolumeMuted(e,t){this.isMuted=t,void 0!==this.videoJs&&(this.videoJs.volume(e/100),this.videoJs.muted(t))}getVolume(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return void 0!==this.videoJs?e&&this.videoJs.muted()?0:100*this.videoJs.volume():0}getMuted(){return void 0===this.videoJs||this.videoJs.muted()}stop(){if(this.lastTimeUpdate=0,this.isCasting||void 0===this.videoJs){if(this.isCasting&&void 0!==this.videoJs)return this.videoJs.pause(),this.videoJs.src(),void this.videoJs.hide()}else this.videoJs.off("timeupdate"),this.videoJs.off("waiting"),this.videoJs.off("playing"),this.videoJs.pause(),this.removeTech(),this.videoJs.src(),this.videoJs.hide(),this.videoJs.muted(this.isMuted);super.stop()}addChromecastOverlay(){this.chromecastOverlay!==this.element.firstChild&&this.element.insertBefore(this.chromecastOverlay,this.element.firstChild)}removeChromecastOverlay(){this.chromecastOverlay.parentElement===this.element&&this.element.removeChild(this.chromecastOverlay)}addTech(){this.isCasting||void 0!==this.tech||void 0===this.videoJs||(this.tech=this.videoJs.tech(),this.tech.on("loadedqualitydataTS",((e,t)=>{(0,g.bT)("VideoOnloadMuteStatus",{muted:this.isMuted,chatMode:this.chatMode}),this.isMuted||(this.userUnmuted=!0);const i=t.qualityData.video,s=[];let n="auto";for(const e of i)s.push({label:e.label,toggled:e.selected,value:e.id}),!0===e.selected&&(n=e.label);const o=document.getElementsByClassName("vjs-menu-item vjs-selected");for(const e of o)e.getElementsByClassName("vjs-menu-item-text")[0].innerHTML!==n&&(e.classList.remove("vjs-selected"),e.ariaChecked="false",e.getElementsByClassName("vjs-control-text")[0].innerHTML="");this.setLevels=s,this.possibleQualityLevelsChanged.fire(s),this.extractLevelSelectionForMetrics(s),void 0===t.qualitySwitchCallback&&(0,g.bT)(`clickMenuLink:QualitySelect-${s.filter((e=>e.toggled))[0].label}`)})))}removeEventListeners(){this.isCasting||void 0===this.videoJs||(this.videoJs.off("canplay"),this.videoJs.off("canplaythrough"))}addEventListeners(){this.isCasting||void 0===this.videoJs||(this.videoJs.on("canplay",(()=>{this.play(),this.isStreamReconnecting&&this.removeReconnecting()})),this.videoJs.on("canplaythrough",(()=>{this.play()})))}removeTech(){this.isCasting||void 0===this.tech||(this.tech.off("loadedqualitydataTS"),void 0!==this.tech.hlsProvider&&this.tech.hlsProvider.dispose(),this.tech.reset(),this.tech=void 0)}setQualityLevel(e){void 0!==this.videoJs&&this.videoJs.selectQualityButton(e)}handleNeverPlayed(){super.handleNeverPlayed(),this.requestControlVisibility.fire(!0),this.neverPlayed=!0}showNativeControls(){super.showNativeControls(),void 0!==this.videoJs&&this.videoJs.controls(!0)}lockShowingControls(){void 0!==this.videoJs&&(this.showNativeControls(),this.videoJs.controlBar.lockShowing())}unlockShowingControls(){void 0!==this.videoJs&&this.videoJs.controlBar.unlockShowing()}showCustomControls(){super.showCustomControls(),this.hideNativeControls()}hideNativeControls(){void 0!==this.videoJs&&this.videoJs.controls(!1)}repositionFullscreenDropdown(){var e;void 0!==this.fullscreenDropdownBtn&&(null===(e=this.fullscreenDropdownBtn.parentNode)||void 0===e||e.appendChild(this.fullscreenDropdownBtn))}enterFullScreenMode(){void 0!==this.videoJs&&((0,m.aS)()?this.videoJs.enterFullWindow():this.videoJs.requestFullscreen(),this.showNativeControls(),this.repositionFullscreenDropdown())}exitFullScreenMode(){void 0!==this.videoJs&&(this.isFullWindow?this.videoJs.exitFullWindow():this.videoJs.exitFullscreen())}getControlBarHeight(){return 0}getVideoElement(){return this.videoElement}getVideoJs(){return this.videoJs}extractLevelSelectionForMetrics(e){for(const t of e)t.toggled&&this.videoMetrics.setQualityLevel(t.label)}setupConvivaPlayer(){void 0!==this.videoAnalytics&&void 0!==this.videoJs&&(this.videoAnalytics.setPlayer(this.videoJs,{[o().Constants.CONVIVA_MODULE]:a()}),this.videoAnalytics.setCallback((()=>{void 0!==this.videoAnalytics&&this.videoAnalytics.reportPlaybackMetric(o().Constants.Playback.BITRATE,this.currentBitrate)})))}setupLLHLSButton(){const e=P.getComponent("Button"),t=e=>{this.forceStream(e)};P.registerComponent("ModeButton",class extends e{constructor(e,t){super(e,t),this.controlText("Toggle Low Latency Mode"),!0===t.llhls?(this.addClass("vjs-llhls-enabled"),this.contentEl().textContent="LL-HLS"):this.contentEl().textContent="HLS"}buildCSSClass(){return`vjs-mode-button ${super.buildCSSClass()}`}handleClick(){this.hasClass("vjs-llhls-enabled")?(this.removeClass("vjs-llhls-enabled"),this.contentEl().textContent="HLS",t(!1)):(this.addClass("vjs-llhls-enabled"),this.contentEl().textContent="LL-HLS",t(!0))}})}addLLHLSButton(){var e;null===(e=this.videoJs)||void 0===e||null===(e=e.controlBar.getChild("modeButton"))||void 0===e||e.dispose(),void 0===this.videoJs||!this.allowLLHLS||this.shouldDisallowLLHLS()||this.disableToggle()||this.videoJs.controlBar.addChild("modeButton",{llhls:this.enableLLHLS},this.videoJs.controlBar.children().length-3)}setLLHLSConfig(){void 0!==this.hls&&(this.enableLLHLS&&this.allowLLHLS?(0,p.f)("VDPLargeBuffer")?(this.hls.config.liveSyncDuration=.8,this.hls.config.liveMaxLatencyDuration=7):(this.hls.config.liveSyncDuration=1.6,this.hls.config.liveMaxLatencyDuration=2.4):(this.hls.config.liveSyncDuration=3,this.hls.config.liveMaxLatencyDuration=7))}updateStreamToggle(){this.addLLHLSButton(),super.updateStreamToggle()}setAutoplay(e){super.setAutoplay(e),void 0!==this.videoJs&&this.videoJs.autoplay(e)}}},1021:(e,t,i)=>{"use strict";i.d(t,{GE:()=>P,_9:()=>A,nH:()=>k,YW:()=>w});var s=i(352),n=i(4936),o=i(7623),r=i(9757),a=i(9461),l=i(6784),h=i(5216),d=i(2939),c=i(8423),u=i(6440),p=i(7407),m=i(5424),g=i(2945),v=i(580);class f{constructor(){this.pendingMessages=[],this.qualityUpdatesKey="qualityUpdates",this.saveTimeSecondsKey="saveTimeSeconds",this.messagesKey="messages","undefined"!=typeof sessionStorage&&this.loadFromSessionStorage(),this.intervalId=window.setInterval((()=>this.sendMessages()),5e3)}addMessage(e){this.pendingMessages.push(e)}stop(){clearInterval(this.intervalId),"undefined"==typeof sessionStorage?this.sendMessages():this.saveToSessionStorage()}sendMessages(){if(this.pendingMessages.length>0){const e={[this.qualityUpdatesKey]:JSON.stringify(this.pendingMessages)};this.pendingMessages=[],(0,h.KF)("api/ts/chat/send-player-quality/",e)}}saveToSessionStorage(){this.pendingMessages.length>0&&(sessionStorage.setItem(this.qualityUpdatesKey,JSON.stringify({[this.saveTimeSecondsKey]:(new Date).getTime()/1e3,[this.messagesKey]:this.pendingMessages})),this.pendingMessages=[])}loadFromSessionStorage(){const e=sessionStorage.getItem(this.qualityUpdatesKey);if(sessionStorage.removeItem(this.qualityUpdatesKey),null==e)this.pendingMessages=[];else{const t=JSON.parse(e);(new Date).getTime()/1e3-t[this.saveTimeSecondsKey]<=60&&(this.pendingMessages=t[this.messagesKey])}}sendImmediate(e){this.pendingMessages.push(e),this.sendMessages()}}var y=i(3049);const b=window.Hls;function w(){C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function C(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=T.getInstance().browserId;if(void 0!==t){if("a"!==t.charAt(t.length-1)&&!1===a.Bm.current.sample_metrics_off)return;if("playerError"===e.eventName&&!0===e.stopped)return;if(!0===e.badFrames){const t={};for(const i in e)t[`attributes.${i}`]=e[i];(0,h.KF)("api/ts/chat/send-quality/",t)}else(0,p.bT)("VideoMetric",e,!0)}}function S(){return(new Date).getTime()}function x(){return(0,o.vM)()?window.performance.now():S()}class T{constructor(){const e=window.browserId;if(void 0!==e)return void(this.browserId=e);let t=a.Aw.getState();""===t.room&&window.initialRoomDossier&&(t=(0,m.Ec)(new n.N6(window.initialRoomDossier))),this.browserId=t.browserId,(0,p.RN)(t.room)}get value(){return void 0===this.__value&&(this.__value=this.generate()),this.__value}clear(){this.__value=void 0}generate(){return`${this.browserId}:${S()}`}static getInstance(){return void 0===T.instance&&(T.instance=new T),T.instance}}class P{constructor(){(0,o.vM)()&&(this.start=x())}send(e,t,i){if((0,o.vM)()&&void 0!==this.start){const s=x()-this.start-t,n=this.start=x(),o={eventName:"autoPlayDuration",autoPlayDuration:n/1e3,autoPlayDurationMS:n,autoPlayDurationNoDelay:s/1e3,autoPlayDurationNoDelayMS:s,autoPlayable:e};0!==t&&(o.autoPlayHiddenDelay=t/1e3,o.autoPlayHiddenDelayMS=t),null!=i&&(o.autoPlayError=JSON.stringify(i)),C(o)}}}class k{constructor(e){var t=this;this.windowUnloadSent=!1,this.roomListening=!1,this.roomDuration=0,this.roomsVisited=0,this.listeners=new c.gt,this.nonPlayingTime=0,this.timeBetweenUpdates=0,this.hiddenTime=0,this.qualityTracker=0,this.viewerRegion="",this.playbackStoppedEvents={abort:0,pause:0,ended:0,waiting:0,seeking:0,suspend:0,stalled:0},this.enableLLHLS=!1,this.sendMetric=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e={playerType:t.playerName,roomDuration:t.roomDuration,roomsVisited:t.roomsVisited,roomStatus:t.roomStatus,videoSessionID:T.getInstance().value,region:t.viewerRegion,isiPad:(0,o.J0)(),hidden:document.hidden,...e},void 0!==t.quality&&(e={fpsquality:t.quality.quality,rate:t.quality.rate,stopped:t.quality.stopped,...e}),delete e.tid,!0===e.unload&&t.sendBackendMetric(e),void 0!==new URLSearchParams(window.location.search).get("conviva-mirror")&&a.Bm.current.isTestbed&&(0,y.kt)()&&(0,s.trackCustomEvent)({name:e.eventName,data:e}),C(e)},this.sendPlayerCreatedMetric=()=>{const e={eventName:"playerCreated"},t=(0,g.JO)(window.location.search).player;void 0!==t&&(e.playerOverride=t),this.sendMetric(e),this.createdTime=x()},this.onRoomLoaded=e=>{this.roomLoadedTime=x(),T.getInstance().browserId=e.dossier.browserId,this.roomName=e.dossier.room},this.onRoomUnloaded=()=>{this.windowUnloadSent||(this.sendUnloadMetrics(),T.getInstance().clear())},this.onWindowUnloaded=()=>{this.windowUnloadSent||(this.sendUnloadMetrics(),void 0!==this.qualityNotifier&&this.qualityNotifier.stop(),this.windowUnloadSent=!0,this.removeListeners())},this.playbackStopped=e=>{void 0!==e&&e.type in this.playbackStoppedEvents&&(this.playbackStoppedEvents[e.type]+=1),void 0!==this.playingStoppedTime||document.hidden||(this.playingStoppedTime=x())},this.playbackStarted=()=>{void 0!==this.playingStoppedTime&&(this.nonPlayingTime+=x()-this.playingStoppedTime,this.playingStoppedTime=void 0)},this.parseQualityUpdate=()=>{const e=a.Aw.getState();if(this.viewerRegion=e.edgeRegion,void 0!==e.quality){if(void 0!==this.quality&&e.quality.quality!==this.quality.quality){const t=x();switch(void 0!==this.qualityChange&&void 0!==this.broadcastQuality&&(this.qualityTracker+=this.broadcastQuality*(t-this.qualityChange)),e.quality.quality){case"bad":this.broadcastQuality=-1;break;case"okay":this.broadcastQuality=0;break;default:this.broadcastQuality=1}this.qualityChange=t}this.quality=e.quality}},((0,u.f)("VDPEnblBEQualNR")||void 0!==(0,g.JO)(window.location.search).quality)&&(this.qualityNotifier=new f),this.playerName=e,this.sendPlayerCreatedMetric()}setEnableLLHLS(e){this.enableLLHLS=e}bindAll(){this.removeListeners(),d.X0.listen(this.onRoomLoaded).addTo(this.listeners),d.Gr.listen(this.onRoomUnloaded).addTo(this.listeners),a.Aw.onUpdate.listen(this.parseQualityUpdate).addTo(this.listeners),(0,l.wu)("pagehide",window,this.onWindowUnloaded),(0,l.wu)("beforeunload",window,this.onWindowUnloaded),(0,l.wu)("unload",window,this.onWindowUnloaded),this.roomListening=!0}static jpegFallback(){C({eventName:"jpegFallback",hlsNativeSupported:(0,o.rm)(),hlsJsSupported:b.isSupported()})}sendBackendMetric(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(void 0!==this.qualityNotifier){(0,p.Rs)(e);const t=(0,p.Ht)(e,!0);this.qualityNotifier.sendImmediate(t)}}sendUnloadMetrics(){if(void 0!==this.roomLoadedTime&&(0,o.vM)())return this.roomUnloadedTime=x(),this.roomUnloadedTime-this.roomLoadedTime}removeListeners(){this.roomListening&&((0,l.Pf)("pagehide",window,this.onWindowUnloaded),(0,l.Pf)("beforeunload",window,this.onWindowUnloaded),(0,l.Pf)("unload",window,this.onWindowUnloaded),this.listeners.removeAll(),this.roomListening=!1)}playerForceRemoved(){this.onWindowUnloaded()}getSessionID(){return T.getInstance().value}}class A extends k{constructor(e){var t;super(e),t=this,this.htmlMediaListening=!1,this.htmlMediaPlayingSent=!1,this.htmlMediaPlayingIsAjax=!1,this.hlsJsListening=!1,this.lastError={},this.averagePDTLatencyTotal=0,this.averagePDTLatencySamplesCount=0,this.averageE2ELatencyTotal=0,this.averageE2ELatencySamplesCount=0,this.avShiftSamplesCount=0,this.avShiftTotal=0,this.overlayValues={fps:"unknown",bitrate:0,latency:"unknown ",framesLost:"0.00",resolution:"unknown",streamType:"unknown",avShift:"unknown",startTime:0},this.initialTypeSent=!1,this.resolutionTracker=0,this.host="",this.edge="",this.playlistResource="",this.startTime=0,this.slowChunkSequential=0,this.visibilityChange=()=>{document.hidden?(this.tabHidden=x(),this.parseTimeUpdate()):void 0!==this.tabHidden&&(this.hiddenTime+=x()-this.tabHidden,this.tabHidden=void 0)},this.sendHTMLMediaPlayingMetric=()=>{if(this.htmlMediaPlayingSent)return;const e={eventName:"videoPlaying",isAjax:!1,bitrate:this.hlsCurrentBitrate},t=this.currentProgramDateTime();void 0!==t&&this.sendHLSMetric({eventName:"broadcastDelay",broadcastDelayMS:t,broadcastDelay:t/1e3});const i=x();if(void 0===this.htmlMediaLoadStartTime)warn("Playing metric has triggered but htmlMediaLoadStartTime is undefined...skipping");else{const t=i-this.htmlMediaLoadStartTime;e.timeSinceMediaLoadStart=t/1e3,e.timeSinceMediaLoadStartMS=t}if(void 0!==this.hlsMediaAttachingTime){const t=i-this.hlsMediaAttachingTime;e.timeSinceMediaAttaching=t/1e3,e.timeSinceMediaAttachingMS=t}if(this.htmlMediaPlayingIsAjax){if(void 0===this.roomLoadedTime)return void warn("Playing metric is for AJAX reload but roomLoadedTime is undefined...skipping");let t=i-this.roomLoadedTime;e.timeSinceLoadAjax=t/1e3,e.timeSinceLoadAjaxMS=t,e.isAjax=!0,void 0===this.roomUnloadedTime?warn("Playing metric is for AJAX reload but roomUnloadedTime is undefined"):(t=i-this.roomUnloadedTime,e.timeSinceUnloadAjax=t/1e3,e.timeSinceUnloadAjaxMS=t)}else{const t=i-this.createdTime;e.timeSincePlayerCreated=t/1e3,e.timeSincePlayerCreatedMS=t}this.sendHLSMetric(e),this.htmlMediaPlayingSent=!0,this.htmlMediaPlayingIsAjax=!0},this.sendHTMLMediaErrorMetric=()=>{let e,t;this.playerElement instanceof HTMLMediaElement?(e=this.playerElement.error,t=this.playerElement):(e=this.playerElement.error_,t=this.playerElement.tech().el()),null!=e&&this.sendHLSMetric({eventName:"playerError",errorCode:e.code,errorMessage:e.message,errorSource:"HTMLMediaElement",errorReadyState:t.readyState,errorNetworkState:t.networkState,bitrate:this.hlsCurrentBitrate})},this.onHTMLMediaEvent=e=>{if(this.htmlMediaListening){if("playing"===e.type)return this.playbackStarted(),this.sendHTMLMediaPlayingMetric(),void this.setResolution(void 0);if("loadstart"!==e.type)if("error"!==e.type)if("stalled"!==e.type)warn("Received unknown HTMLMediaElement event: ",e);else{this.playbackStopped(e);const t=e.target;if(null!=t){const e={eventName:"playerStalled",stalledReadyState:t.readyState,stalledNetworkState:t.networkState,bitrate:this.hlsCurrentBitrate};this.sendHLSMetric(e)}}else this.sendHTMLMediaErrorMetric();else this.htmlMediaLoadStartTime=x()}},this.bindAllHlsJs=e=>{this.removeHLSListeners(),this.hls=e,this.hls.on(b.Events.ERROR,this.onHlsJsEvent),this.hls.on(b.Events.FRAG_CHANGED,this.onHlsJsEvent),this.hls.on(b.Events.FRAG_PARSED,this.onHlsJsEvent),(0,o.vM)()&&(this.hls.on(b.Events.LEVEL_SWITCHING,this.onHlsJsEvent),this.hls.on(b.Events.LEVEL_SWITCHED,this.onHlsJsEvent),this.hls.on(b.Events.MEDIA_ATTACHING,this.onHlsJsEvent)),this.hlsJsListening=!0},this.addHlsJsLevel=e=>{const t=e.level;if(void 0!==t){for(const t of["bitrate","height","width"]){var i;if(isNaN(e[t]))return void warn(`Level ${t} is not a number: ${null===(i=e[t])||void 0===i?void 0:i.toString()}...skipping`)}this.hlsJsLevels.set(t,e),this.hlsJsSwitchingTimes.unshift({level:t,ts:x()})}else warn("Received HlsObj.Events.LEVEL_SWITCHING without a level: ",e)},this.setMaxHlsLevel=e=>{if(void 0===e.level)return void warn("Received Hls.Events.LEVEL_SWITCHED without a level: ",e);const t=this.hlsJsLevels.get(e.level);if(void 0!==t){for(const t of this.hlsJsSwitchingTimes)if(t.level===e.level){const e=(i=t.ts,x()-i);this.hlsJsSwitchedTimes.push(e);break}var i;this.adjustAverageHeight(t.height),(void 0===this.hlsJsMaxLevel||t.bitrate>this.hlsJsMaxLevel.bitrate)&&(this.hlsJsMaxLevel=t),this.hlsCurrentBitrate=t.bitrate,this.overlayValues={...this.overlayValues,bitrate:t.bitrate/1e3,resolution:`${t.height}x${t.width}`}}else warn("Received unknown Hls.Events.LEVEL_SWITCHED level: ",e)},this.adjustAverageHeight=e=>{const t=x();if(void 0!==this.currentHeight&&void 0!==this.resolutionSwitched){const e=t-this.resolutionSwitched;this.resolutionTracker+=e*this.currentHeight}this.resolutionSwitched=t,this.currentHeight=e},this.getCurrentPlayerTime=()=>this.playerElement instanceof HTMLMediaElement?this.playerElement.currentTime:this.playerElement.currentTime(),this.getPlayerOffsetFromSegmentStart=()=>{if(void 0===this.hlsLastFrag)return;const e=this.getCurrentPlayerTime();if(void 0===e)return;const t=e-this.hlsLastFrag.start;return t<0?void 0:1e3*t},this.getLastFragmentTimecode=()=>{if(void 0===this.hlsLastFrag)return;const e=this.hlsLastFrag.sn;return this.hlsFragIndexToFirstTimecode.has(e)?this.hlsFragIndexToFirstTimecode.get(e):void 0},this.getStreamingModeFromMetadata=()=>{const e=this.findLastCue();if(null!=e&&null!=e.value&&"PTS,container"===e.value.info&&null!=e.value.data){const t=e.value.data.split(",")[1];if("mpegts"===t)return"hls";if("cmaf"===t)return this.enableLLHLS?"ll-hls":"fallback hls"}},this.getStreamingMode=()=>void 0===this.extXPartInChunklist?this.getStreamingModeFromMetadata():this.extXPartInChunklist?void 0===this.chunkDownloaded?void 0:this.chunkDownloaded?"ll-hls":"fallback hls":"hls",this.findLastCue=()=>{let e;e=this.playerElement instanceof HTMLMediaElement?this.playerElement:this.playerElement.tech().el();for(const t of e.textTracks)if(null!=t.cues&&t.cues.length>0)return t.cues[t.cues.length-1]},this.getPTSPlayedNowFromTimedMetadata=()=>{const e=this.findLastCue();if(null!=e&&null!=e.value&&"PTS,container"===e.value.info&&null!=e.value.data){const t=e.value.data.split(","),i=Number(t[0]),s=1e3*e.startTime,n=this.getCurrentPlayerTime();if(null!=n)return i+1e3*n-s}},this.getPTSPlayedNowFromHlsJs=()=>{const e=this.getPlayerOffsetFromSegmentStart();if(void 0===e)return;const t=this.getLastFragmentTimecode();return void 0!==t?t+e:void 0},this.getPTSPlayedNow=()=>{const e=this.getPTSPlayedNowFromHlsJs();return void 0!==e?e:this.getPTSPlayedNowFromTimedMetadata()},this.getEndToEndLatency=()=>{var e,t;if(void 0!==(null===(e=a.Aw.getState().latency)||void 0===e?void 0:e.localTimeTranscoderInput)&&void 0!==(null===(t=a.Aw.getState().latency)||void 0===t?void 0:t.streamTimeTranscoderInput)){var i,s,n,o;const e=(null!==(i=null===(s=a.Aw.getState().latency)||void 0===s?void 0:s.localTimeTranscoderInput)&&void 0!==i?i:0)-(null!==(n=null===(o=a.Aw.getState().latency)||void 0===o?void 0:o.streamTimeTranscoderInput)&&void 0!==n?n:0),t=this.getPTSPlayedNow();if(void 0===t)return;const r=S()-e-t;if(r>=0&&r<=3e4)return r}},this.currentProgramDateTime=()=>{if(void 0===this.hlsLastFrag)return;let e;if(e=this.playerElement instanceof HTMLMediaElement?this.playerElement.currentTime:this.playerElement.currentTime(),void 0===e)return;let t=e-this.hlsLastFrag.start;if(t<0)return;if(t*=1e3,null===this.hlsLastFrag.programDateTime)return;const i=S()-this.hlsLastFrag.programDateTime-t;return i<0||i>3e5?void 0:i},this.updateLatencyMetrics=()=>{const e=this.currentProgramDateTime();void 0!==e&&((void 0===this.maxPDTLatency||e>this.maxPDTLatency)&&(this.maxPDTLatency=e),this.averagePDTLatencyTotal+=e,this.averagePDTLatencySamplesCount+=1,this.averagePDTLatency=this.averagePDTLatencyTotal/this.averagePDTLatencySamplesCount);const t=this.getEndToEndLatency();void 0!==t&&((void 0===this.maxE2ELatency||t>this.maxE2ELatency)&&(this.maxE2ELatency=t),this.averageE2ELatencyTotal+=t,this.averageE2ELatencySamplesCount+=1,this.averageE2ELatency=this.averageE2ELatencyTotal/this.averageE2ELatencySamplesCount)},this.calculateAvShift=(e,t,i,s)=>{let n;if(i){const i=this.videoSegmentsPlaytime.find((t=>t.segmentIndex===e));void 0!==i?(n=t-i.playTime-(s-i.pts),this.videoSegmentsPlaytime=this.videoSegmentsPlaytime.filter((t=>t.segmentIndex<=e)),this.audioSegmentsPlaytime=this.audioSegmentsPlaytime.filter((t=>t.segmentIndex<=e))):this.audioSegmentsPlaytime.push({segmentIndex:e,playTime:t,pts:s})}else{const i=this.audioSegmentsPlaytime.find((t=>t.segmentIndex===e));void 0!==i?(n=i.playTime-t-(i.pts-s),this.videoSegmentsPlaytime=this.videoSegmentsPlaytime.filter((t=>t.SegmentIndex<=e)),this.audioSegmentsPlaytime=this.audioSegmentsPlaytime.filter((t=>t.SegmentIndex<=e))):this.videoSegmentsPlaytime.push({segmentIndex:e,playTime:t,pts:s})}void 0!==n&&(this.avShift=n,(void 0===this.maxAbsAvShift||Math.abs(n)>this.maxAbsAvShift)&&(this.maxAbsAvShift=Math.abs(n)),this.avShiftTotal+=Math.abs(n),this.avShiftSamplesCount+=1,this.averageAvShift=this.avShiftTotal/this.avShiftSamplesCount)},this.handleParsedFragment=e=>{if(void 0!==e.part&&null!==e.part){const s=String(e.part.relurl);var t;if(s.endsWith(".0_m3u8.cmfa"))this.calculateAvShift(e.frag.sn,e.frag.start,!0,null===(t=e.frag.elementaryStreams.audio)||void 0===t?void 0:t.startPTS);else if(s.endsWith(".0_m3u8.cmfv")){var i;this.calculateAvShift(e.frag.sn,e.frag.start,!1,null===(i=e.frag.elementaryStreams.video)||void 0===i?void 0:i.startPTS)}}},this.handleErrorEvent=e=>{const t=this.playerElement instanceof HTMLMediaElement?this.playerElement:this.playerElement.tech().el(),i={eventName:"playerError",errorCode:e.type,errorMessage:e.details,errorSource:"hls.js",errorReadyState:t.readyState,errorNetworkState:t.networkState,bitrate:this.hlsCurrentBitrate,quality:this.hlsCurrentQualityLevel};(this.lastError!==i||void 0!==this.lastTime&&Date.now()-this.lastTime>1e3)&&(this.sendHLSMetric(i),this.lastError=i,this.lastTime=Date.now())},this.onHlsJsEvent=(e,t)=>{this.hlsJsListening&&(e!==b.Events.LEVEL_SWITCHING?e!==b.Events.LEVEL_SWITCHED?e!==b.Events.FRAG_CHANGED?e!==b.Events.FRAG_PARSED?e!==b.Events.MEDIA_ATTACHING?e!==b.Events.ERROR?warn("Received unknown Hls.Event: ",e):this.handleErrorEvent(t):this.hlsMediaAttachingTime=x():this.handleParsedFragment(t):this.hlsLastFrag=t.frag:this.setMaxHlsLevel(t):this.addHlsJsLevel(t))},this.parseTimeUpdate=()=>{const e=x();if(void 0!==this.lastTimeUpdate&&!document.hidden){const t=e-this.lastTimeUpdate;t>500&&(this.timeBetweenUpdates+=t)}document.hidden?this.lastTimeUpdate=void 0:this.lastTimeUpdate=e},this.removeHLSListeners=()=>{this.hlsJsListening&&void 0!==this.hls&&(this.hls.off(b.Events.ERROR,this.onHlsJsEvent),this.hls.off(b.Events.FRAG_CHANGED,this.onHlsJsEvent),(0,o.vM)()&&(this.hls.off(b.Events.LEVEL_SWITCHING,this.onHlsJsEvent),this.hls.off(b.Events.LEVEL_SWITCHED,this.onHlsJsEvent)),this.hlsJsListening=!1)},this.removeHTMLMediaListeners=()=>{if(!this.htmlMediaListening)return;let e;e=this.playerElement instanceof HTMLMediaElement?this.playerElement:this.playerElement.tech().el(),(0,o.vM)()&&((0,l.Pf)("playing",e,this.onHTMLMediaEvent),(0,l.Pf)("loadstart",e,this.onHTMLMediaEvent)),(0,l.Pf)("error",e,this.onHTMLMediaEvent),(0,l.Pf)("stalled",e,this.onHTMLMediaEvent),(0,l.Pf)("abort",e,this.playbackStopped),(0,l.Pf)("pause",e,this.playbackStopped),(0,l.Pf)("ended",e,this.playbackStopped),(0,l.Pf)("waiting",e,this.playbackStopped),(0,l.Pf)("seeking",e,this.playbackStopped),(0,l.Pf)("suspend",e,this.playbackStopped),(0,l.Pf)("seeked",e,this.playbackStarted),(0,l.Pf)("timeupdate",e,this.parseTimeUpdate),(0,l.Pf)("visibilitychange",document,this.visibilityChange),this.htmlMediaListening=!1},this.reset=()=>{this.htmlMediaPlayingSent=!1,this.hlsJsLevels=new Map,this.hlsFragIndexToFirstTimecode=new Map,this.audioSegmentsPlaytime=new Array,this.videoSegmentsPlaytime=new Array,this.hlsCurrentBitrate=void 0,this.hlsJsSwitchingTimes=[],this.hlsJsSwitchedTimes=[],this.hlsJsMaxLevel=void 0,this.hlsLastFrag=void 0,this.htmlMediaLoadStartTime=void 0,this.hlsMediaAttachingTime=void 0,this.roomDuration=0,this.roomsVisited=0,this.extXPartInChunklist=void 0,this.chunkDownloaded=void 0,this.avShiftSamplesCount=0,this.avShiftTotal=0,this.lastTimeUpdate=void 0,this.nonPlayingTime=0,this.timeBetweenUpdates=0,this.playingStoppedTime=void 0,this.hiddenTime=0,this.resolutionSwitched=void 0,this.resolutionTracker=0,document.hidden?this.tabHidden=x():this.tabHidden=void 0,this.createdTime=x(),this.qualityTracker=0,this.qualityChange=void 0,this.quality=void 0,this.broadcastQuality=0,this.viewerRegion="",this.averagePDTLatencyTotal=0,this.averagePDTLatencySamplesCount=0,this.startLatencySampling(),this.startTime=0,this.playbackStoppedEvents={abort:0,pause:0,ended:0,waiting:0,seeking:0,suspend:0,stalled:0},this.chunkInterval=0,this.chunkIntervalCount=0,this.slowChunkSequential=0,this.totalChunkTimes=0,this.totalChunkCount=0},this.reportLatencyToConviva=e=>{-1===e&&(0,y.kt)()&&(0,s.trackCustomEvent)({name:"LatencyUpdate",data:{roomName:this.roomName,broadcasterID:a.Aw.getState().roomUid,E2ELatency:this.averageE2ELatency,PDTLatency:this.averagePDTLatency,streamingMode:this.getStreamingMode()}})},this.sendHLSMetric=function(){let e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0!==t.hls&&(e=t.hls.latency),t.sendMetric({averagePDTLatency:t.averagePDTLatency,maxPDTLatency:t.maxPDTLatency,hlsLatency:e,averageEndToEndLatency:t.averageE2ELatency,maxEndToEndLatency:t.maxE2ELatency,streamingMode:t.getStreamingMode(),selectedMode:t.selectedStreamType,averageAvShift:t.averageAvShift,maxAbsAvShift:t.maxAbsAvShift,host:t.host,edge:t.edge,playlistResource:t.playlistResource,...i})},this.reset(),this.listenForChunklist(),this.lastTimeUpdate=x()}listenForNewTextTrack(){let e;e=this.playerElement instanceof HTMLMediaElement?this.playerElement:this.playerElement.tech().el(),e.textTracks.addEventListener("addtrack",(e=>{const t=e.track;null!=t&&(t.mode="hidden")}))}startLatencySampling(){this.stopLatencySampling(),this.sampleLatency=window.setInterval((()=>{this.updateLatencyMetrics()}),2e3)}stopLatencySampling(){clearInterval(this.sampleLatency)}bindAllHTMLMedia(e,t){let i;if(this.removeHTMLMediaListeners(),this.playerElement=e,this.lastTime=Date.now(),i=this.playerElement instanceof HTMLMediaElement?this.playerElement:this.playerElement.tech().el(),(0,o.vM)()&&((0,l.wu)("playing",i,this.onHTMLMediaEvent),(0,l.wu)("loadstart",i,this.onHTMLMediaEvent)),(0,l.wu)("error",i,this.onHTMLMediaEvent),(0,l.wu)("stalled",i,this.onHTMLMediaEvent),(0,l.wu)("abort",i,this.playbackStopped),(0,l.wu)("pause",i,this.playbackStopped),(0,l.wu)("ended",i,this.playbackStopped),(0,l.wu)("waiting",i,this.playbackStopped),(0,l.wu)("seeking",i,this.playbackStopped),(0,l.wu)("suspend",i,this.playbackStopped),(0,l.wu)("seeked",i,this.playbackStarted),(0,l.wu)("timeupdate",i,this.parseTimeUpdate),(0,l.wu)("visibilitychange",document,this.visibilityChange),this.htmlMediaListening=!0,void 0!==(0,g.JO)(window.location.search).details){const e=document.createElement("div"),i=r.c.get("VideoOverlay");this.videoOverlay=new i(this.overlayValues,e),t.appendChild(e),this.setQuality(),a.Aw.onUpdate.listen((()=>{this.setQuality()})).addTo(this.listeners),window.setInterval((()=>{if(void 0!==this.videoOverlay){var e;let t=this.getEndToEndLatency();void 0===t&&(t=0);let i=this.avShift;void 0===i&&(i=0),this.overlayValues.startTime=this.startTime,this.overlayValues.streamType=null!==(e=this.getStreamingMode())&&void 0!==e?e:"unknown",this.overlayValues.latency=(t/1e3).toFixed(2),this.overlayValues.avShift=i.toFixed(2),this.videoOverlay.update(this.overlayValues)}}),2e3)}window.setInterval((()=>{this.chunkIntervalCount>5&&this.chunkInterval/this.chunkIntervalCount>500&&this.enableLLHLS?v.W.fire("Average Slow Chunks"):(this.chunkInterval=0,this.chunkIntervalCount=0)}),1e4),this.listenForNewTextTrack()}sendStreamType(e,t){const i=t.match(/^https:\/\/edge(.+)\.live/);if(this.selectedStreamType=e,this.edge=i?i[1]:"",!this.initialTypeSent){const i={eventName:"initialStreamType",streamType:e,source:t,edge:this.edge};this.sendHLSMetric(i),this.initialTypeSent=!0,(0,y.kt)()&&(0,s.trackCustomEvent)({name:"InitialStreamType",data:{streamType:e,roomName:this.roomName,broadcasterID:a.Aw.getState().roomUid,currentSorce:t}})}}setQualityLevel(e){this.hlsCurrentQualityLevel=e}sendUnloadMetrics(){const e=super.sendUnloadMetrics();if(void 0!==e&&e>5e3){void 0!==this.hlsJsMaxLevel&&this.sendHLSMetric({room_user:this.roomName,eventName:"levelMax",levelMaxName:this.hlsJsMaxLevel.name,levelMaxBitrate:this.hlsJsMaxLevel.bitrate,levelMaxAudioCodec:this.hlsJsMaxLevel.audioCodec,levelMaxVideoCodec:this.hlsJsMaxLevel.videoCodec,levelMaxHeight:this.hlsJsMaxLevel.height,levelMaxWidth:this.hlsJsMaxLevel.width,bitrate:this.hlsCurrentBitrate});const e=this.hlsJsSwitchedTimes.reduce(((e,t)=>e+t),0)/this.hlsJsSwitchedTimes.length;isNaN(e)||this.sendHLSMetric({room_user:this.roomName,eventName:"levelSwitchAvg",levelSwitchAvg:e/1e3,levelSwitchAvgMS:e,levelSwitchCount:this.hlsJsSwitchedTimes.length})}return e}removeListeners(){super.removeListeners(),this.listeners.removeAll(),this.removeHLSListeners(),this.removeHTMLMediaListeners()}sendStartTimes(e,t,i,s,n,o,r,a){this.roomStatus=o,this.roomsVisited=r,this.roomDuration=0,this.startTime=e,void 0===this.currentHeight&&this.adjustAverageHeight(a);const l={eventName:"playerTimes",room_user:this.roomName,startTime:e/1e3,pageStartTime:t/1e3,dataLoadTime:i/1e3,metaLoadTime:s/1e3,startLoadTime:n/1e3};this.sendHLSMetric(l)}sendQuality(e,t,i,s,n,r,a,l){this.roomDuration=-1!==a?a:this.roomDuration;const h=x();let d=0;for(const e of Object.entries(this.playbackStoppedEvents))d+=e[1];let c=this.nonPlayingTime;void 0!==this.playingStoppedTime&&(c+=h-this.playingStoppedTime,this.playingStoppedTime=h),void 0!==this.tabHidden&&(this.hiddenTime+=h-this.tabHidden,this.tabHidden=h);const u=h-this.createdTime,p=u-this.hiddenTime;this.adjustAverageHeight(r),this.parseTimeUpdate(),this.parseQualityUpdate();let m={};m={eventName:"playerQuality",room_user:this.roomName,resolution:n,videoHeight:r,playingRatio:1-c/p,timeUpdateRatio:1-this.timeBetweenUpdates/p,averageHeight:Math.round(this.resolutionTracker/u),averageQuality:this.qualityTracker/u,totalTime:u/1e3,unhiddenTime:p/1e3,hiddenTime:this.hiddenTime/1e3,nonPlayingTime:this.nonPlayingTime/1e3,averageStopDuration:this.nonPlayingTime/d,averageChunkDownloadTime:this.totalChunkCount>0?this.totalChunkTimes/this.totalChunkCount:0},(0,o.OF)()||(m={...m,droppedFrames:e,totalFrames:i,segmentDropped:t,segmentFrames:s,badFrames:t>30}),-1===a&&(m={...m,unload:!0,...this.playbackStoppedEvents}),this.overlayValues.framesLost=e>0?(100*e).toFixed(2):"0.00",this.sendHLSMetric(m),this.reportLatencyToConviva(a)}setStatus(e){this.roomStatus=e}LLHLSFallback(e,t,i,s){this.sendHLSMetric({eventName:"llhlsFallback",source:e,reason:s,edge:null!==t?t[1]:"",playerType:i,sequentialSlowChunks:this.slowChunkSequential,calculationChunks:this.chunkIntervalCount})}listenForChunklist(){let e=-1;const t=(e,t)=>{this.hlsFragIndexToFirstTimecode.set(e,t),this.hlsFragIndexToFirstTimecode.forEach(((t,i)=>{i<e-15&&this.hlsFragIndexToFirstTimecode.delete(i)}))},i=(e,t)=>{if(0!==e[t]||0!==e[t+1]||1!==e[t+2])return;const i=e[t+3],s=!!(128&e[t+7]);return i<224||i>239||!s?void 0:(((e[t+9]>>>1&7)<<30)+((e[t+10]<<7)+(e[t+11]>>>1)<<15)+((e[t+12]<<7)+(e[t+13]>>>1)))/90},s=i=>{const s=-1===e?9e4:e,n=i.responseURL.split("_");this.chunkDownloaded=n[n.length-2].includes(".");const o=n[n.length-2].split(".");if(1===o.length||2===o.length&&"0"===o[1]){let e;try{e=new Uint8Array(i.response).slice(0,2e3)}catch(e){return}let n=(e=>{for(let t=0;t<e.length-15;++t)if(116===e[t]&&102===e[t+1]&&100===e[t+2]&&116===e[t+3]){let i=0;for(let s=0;s<8;++s)i=256*i+e[t+8+s];return i}})(e);if(void 0!==n){n/=s/1e3;const e=Number(o[0]);t(e,n)}}},n=e=>{this.extXPartInChunklist=e.includes("#EXT-X-PART")},o=n=>{n.responseURL.includes("media")&&n.responseURL.endsWith("_m3u8.cmfv")?s(n):n.responseURL.includes("header")&&n.responseURL.endsWith("_m3u8.cmfv")?(t=>{const i=new Uint8Array(t.response).slice(0,2e3);for(let t=0;-1===e&&t<i.length-19;++t)if(109===i[t]&&100===i[t+1]&&104===i[t+2]&&100===i[t+3]){e=0;for(let s=0;s<4;++s)e=256*e+i[t+16+s]}})(n):n.responseURL.includes("media")&&n.responseURL.endsWith(".ts")&&(e=>{const s=e.responseURL.lastIndexOf("_"),n=e.responseURL.lastIndexOf("."),o=Number(e.responseURL.substring(s+1,n));let r,a;try{r=new Uint8Array(e.response).slice(0,2e3)}catch(e){}if(void 0!==r)for(let e=0;void 0===a&&188*(e+1)<r.length;++e){let s=188*e;const n=!!(64&r[s+1]),l=r[s+2]+((31&r[s+1])<<8),h=!!(32&r[s+3]),d=!!(16&r[s+3]);!n||l<32||l>8186||!d||(s+=4,h&&(s+=r[s]+1),a=i(r,s),void 0!==a&&t(o,a))}})(n)},r=e=>{const t=e.target;if(t.responseURL.includes("media")&&t.responseURL.includes("_m3u8.cmf")&&h(t),t.responseURL.includes("chunklist")&&!t.responseURL.includes("_ao_")){const e=t.responseText;n(e)}else null===t.response||Boolean(t.response.detached)||o(t)},a=e=>{const t=e.target;null===t.response||Boolean(t.response.detached)||o(t)},l=e=>{e.target._customStartTime=x()},h=e=>{const t=e._customStartTime;if(void 0!==t&&this.enableLLHLS){const e=x()-t;this.totalChunkTimes+=e,this.totalChunkCount+=1,this.chunkInterval+=e,this.chunkIntervalCount+=1,e>500?(this.slowChunkSequential+=1,this.slowChunkSequential>=5&&v.W.fire("Sequential Slow Chunks")):this.slowChunkSequential=0}},d=XMLHttpRequest;window.XMLHttpRequest=function(){const e=new d;return e.addEventListener("loadstart",l),e.addEventListener("load",r),e.addEventListener("progress",a),e}}setQuality(){const e=a.Aw.getState().quality;void 0!==e&&(this.overlayValues.fps=e.quality)}setResolution(e){void 0!==e?this.overlayValues.resolution=e:this.playerElement instanceof HTMLVideoElement&&(this.overlayValues.resolution=`${this.playerElement.videoHeight}x${this.playerElement.videoWidth}`)}endSession(){this.sendUnloadMetrics(),this.reset()}updateResourceInfo(e,t,i){this.host=e,this.edge=t,this.playlistResource=i}}},9815:(e,t,i)=>{"use strict";i.d(t,{q:()=>r});var s=i(9461),n=i(2939),o=i(8423);class r{constructor(){this.dontNotify=new Set,this.listenerGroup=new o.gt,this.initListeners()}initListeners(){n.Zm.listen((e=>{this.dontNotify.add(e)})).addTo(this.listenerGroup),n.Gr.listen((()=>{this.dontNotify.clear()})).addTo(this.listenerGroup)}shouldNotify(e){var t;return!this.dontNotify.has(e)&&e!==(null===(t=s.Bm.current.loggedInUser)||void 0===t?void 0:t.username)}preventNotifications(e){this.dontNotify.add(e)}dispose(){this.listenerGroup.removeAll()}}},34:(e,t,i)=>{"use strict";i.d(t,{BO:()=>U,DZ:()=>F,Df:()=>A,Lz:()=>P,S1:()=>_,UK:()=>R,lh:()=>I,sT:()=>B,vZ:()=>N,yx:()=>D});var s=i(352),n=i(6624),o=i(4936),r=i(4801),a=i(9461),l=i(1679),h=i(213),d=i(5216),c=i(6844),u=i(2939),p=i(8423),m=i(6440),g=i(1779),v=i(6716),f=i(2690),y=i(7407),b=i(3049),w=i(1452),C=i(3456),S=i(74),x=i(4947),T=i(3860);const P=new p.c_("privateJoinInitiated");class k{static get inProgress(){return this._inProgress}static set inProgress(e){var t;this.instance=null!==(t=this.instance)&&void 0!==t?t:new k,this._inProgress=e}constructor(){u.Gr.listen((()=>{k.inProgress=!1}),!1)}}var A;function M(e){null!=e&&e.onError&&(null==e||e.onError()),null!=e&&e.onFinally&&e.onFinally()}function R(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(a.Bm.current.isNoninteractiveUser)return(0,h.Q$)(x.R.internalStaffPrivate),void M(i);P.fire(),(0,c.rC)(x.R.loginForPrivateShow)?M(i):((0,y.bT)("RequestPrivateShow"),function(e){const t=`tipping/private_show_tokens_per_minute/${e}/`;return new Promise(((e,i)=>{(0,d.Aw)(t).then((t=>{const i=new o.N6(t.responseText);e({minimumMinutes:i.getStringWithNumbers("private_show_minimum_minutes"),price:i.getNumber("price"),recordingsAllowed:i.getBoolean("recordings_allowed"),allowed:i.getBoolean("allowed",!0,!1),premiumMinimumMinutes:i.getStringWithNumbers("premium_minimum_minutes",!1),premiumPrice:i.getNumberOrUndefined("premium_price")}),i.logUnusedDebugging("parseTokensPerMinute")})).catch((e=>{i(e)}))}))}(e.room()).then((o=>{if(k.inProgress||"public"!==e.status)return;if(k.inProgress=!0,!o.allowed)return(0,h.Q$)(x.R.featureNotEnabled),void(k.inProgress=!1);let d=!1;const c=()=>{(0,b.kt)()&&(0,s.trackCustomEvent)({name:"PrivateShowRequest",data:{roomName:e.room()}});let t=o.price,n=o.minimumMinutes;(0,m.f)("PremPrivShow")&&d&&void 0!==o.premiumPrice&&void 0!==o.premiumMinimumMinutes&&(t=o.premiumPrice,n=o.premiumMinimumMinutes),e.requestPrivateShow(t,n,o.recordingsAllowed,d,l).then(null==i?void 0:i.onResolve).catch((t=>{void 0!==(null==i?void 0:i.onError)&&i.onError(),E(t)?L(t):"privatewatching"!==e.status&&((0,h.Q$)(x.R.errorRequestingPrivateShow),error("Error entering private show",t)),(0,C.Sz)()&&S.ef.fire(void 0)})).finally((()=>{null!=i&&i.onFinally&&(null==i||i.onFinally()),k.inProgress=!1})),(0,y.bT)("StartPrivateShow",{is_premium:d})};if((0,C.Sz)()&&"split"===T.L.getVideoMode()&&!a.Bm.current.isMobile)S.Ne.fire({requirements:o,makeRequest:c,stopRequest:()=>{k.inProgress=!1},showConfirmation:t,chatConnection:e});else if((0,m.f)("PremPrivShow")){const t=e=>{d=e};!function(e,t,i,s){let o;void 0!==e.premiumPrice&&e.premiumPrice>0&&void 0!==e.premiumMinimumMinutes||(e.premiumPrice=0);const a=()=>{var e;l.element.remove(),f.$M.fire(!1),k.inProgress=!1,null===(e=o)||void 0===e||e.removeListener()},l=new r.T({component:"PremiumPrivateRequest",componentProps:{tokensPerMinute:e.price,minimumMinutes:e.minimumMinutes,premiumTokensPerMinute:e.premiumPrice,premiumMinimumMinutes:e.premiumMinimumMinutes,allowRecording:e.recordingsAllowed,model:t,toggleCallback:s,requestCallback:i,closeCallback:()=>{a()}}});if("fullscreen"===T.L.getVideoMode()){const e=document.getElementById("TheaterModePlayer");null!==e&&e.appendChild(l.element)}else document.body.appendChild(l.element);f.$M.fire(!0),(0,n.isRoomRoomlistSpaActive)()?n.UrlState.current.listen(n.ALL,(()=>{a()}),l.element):o=v.VZ.listen((()=>{a()}),!1)}(o,e.room(),c,t)}else if(t){const t=x.R.privateShowConfirmMessage(e.room(),o.price,o.minimumMinutes,o.recordingsAllowed);(0,h.mf)(t,c,(()=>{k.inProgress=!1}))}else c()})).catch(w.yZ))}function I(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;if(a.Bm.current.isNoninteractiveUser)return(0,h.Q$)(x.R.internalStaffPrivate),void M(i);if(P.fire(),(0,c.rC)(x.R.loginForPrivateShowSpy))return void M(i);(0,y.bT)("RequestSpyShow");const s=(s,o)=>{if(0===s)return void(0,h.Q$)(x.R.privateShowSpyDisabled);if(k.inProgress)return;k.inProgress=!0;const l=()=>{(0,y.bT)("StartSpyShow"),e.requestSpyShow().then(null==i?void 0:i.onResolve).catch((t=>{void 0!==(null==i?void 0:i.onError)&&i.onError(),E(t)?L(t):"privatespying"!==e.status&&((0,h.Q$)(x.R.errorRequestingSpyShow),error("Error entering spy show",t))})).finally((()=>{null!=i&&i.onFinally&&(null==i||i.onFinally()),k.inProgress=!1}))},c=()=>{null!=i&&i.onError&&i.onError(),k.inProgress=!1};(0,m.f)("FanClubSpying")&&void 0!==o?((t,i,s,o)=>{let l;const h=()=>{var e;u.element.remove(),f.$M.fire(!1),null===(e=l)||void 0===e||e.removeListener(),o()},c=a.Aw.getState().isInFanClub,u=new r.T({component:"SpyRequest",componentProps:{standardPrice:t,fanPrice:i,isFan:c,requestCallback:s,closeCallback:()=>{h()},joinCallback:()=>{var t;window.open((0,d._Y)(`/fanclub/join/${e.room()}/?source=${null===(t=a.Bm.current)||void 0===t?void 0:t.PurchaseEventSources.SUPPORTER_SOURCE_JOIN_FAN_CLUB_BUTTON}`),"_blank")}}}),p=(0,g.Gy)();if("fullscreen"===T.L.getVideoMode()){const e=document.getElementById("TheaterModePlayer");null!==e&&e.appendChild(u.element)}else p?p.appendChild(u.element):document.body.appendChild(u.element);f.$M.fire(!0),(0,n.isRoomRoomlistSpaActive)()?n.UrlState.current.listen(n.ALL,(()=>{h()}),u.element):l=v.VZ.listen((()=>{h()}),!1)})(s,o,l,c):t?(0,h.mf)(x.R.privateShowSpyConfirmMessage(s),l,c):l()};(0,m.f)("FanClubSpying")?function(e){const t=`tipping/spy_on_private_show_token_cost/${e}/`;return new Promise(((e,i)=>{(0,d.Aw)(t).then((t=>{var i;const s=new o.N6(t.responseText);e({standardPrice:s.getNumber("standard_price"),fanClubPrice:null!==(i=s.getNumberOrUndefined("fan_club_price"))&&void 0!==i?i:s.getNumber("standard_price")})})).catch((e=>{i(e)}))}))}(e.room()).then((e=>{let{standardPrice:t,fanClubPrice:i}=e;s(t,i)})).catch((e=>{"string"==typeof e&&error(e)})):function(e){const t=`tipping/spy_on_private_show_tokens_per_minute/${e}/`;return new Promise(((e,i)=>{(0,d.Aw)(t).then((t=>{const s=Number(t.responseText);isNaN(s)?i(`isNaN on ${s}`):e({price:s})})).catch((e=>{i(e)}))}))}(e.room()).then((e=>{let{price:t}=e;s(t)})).catch((e=>{"string"==typeof e&&error(e)}))}function E(e){return void 0!==e.errorType&&void 0!==e.message}function L(e){switch(e.errorType){case A.lowTokens:(0,l.qr)(e.message,a.Bm.current.PurchaseEventSources.TOKEN_SOURCE_LOW_TOKEN_BALANCE);break;case A.statusNotAllowed:case A.default:default:(0,h.Q$)(e.message)}}function D(e){let t=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;const s=()=>{(0,y.bT)("LeavePrivateShowEarly",{is_premium:e.premiumShowActive}),e.leavePrivateOrSpyShow(!0).then(null==t?void 0:t.onResolve).catch((e=>{(0,h.Q$)(e.message)})).finally(null==t?void 0:t.onFinally)},n=()=>{(0,y.bT)("LeavePrivateOrSpyShow",{is_premium:e.premiumShowActive}),e.leavePrivateOrSpyShow(!1).then(null==t?void 0:t.onResolve).catch((e=>{void 0!==(null==t?void 0:t.onError)&&t.onError(),e.allowCancel&&void 0!==e.earlyDetails?function(e,t){const i=new r.T({component:"PrivateCancelEarlyOverlay",componentProps:{...e.earlyDetails,leaveCallback:t,closeCallback:()=>{i.element.remove(),f.$M.fire(!1)}}});if("fullscreen"===T.L.getVideoMode()){const e=document.getElementById("TheaterModePlayer");null!==e&&e.appendChild(i.element)}else document.body.appendChild(i.element);f.$M.fire(!0)}(e,s):(0,h.Q$)(e.message)})).finally(null==t?void 0:t.onFinally),S.ef.fire(void 0)};if(arguments.length>1&&void 0!==arguments[1]&&!arguments[1])n();else{let t=x.R.privateShowLeaveWarning;(0,m.f)("PremPrivShow")&&"privaterequesting"===e.status&&(t=x.R.privateRequestCancelConfirmation),(0,h.mf)(t,n,i)}}function B(){(0,d.KF)("tipping/private_show_approve/",{foo:"bar"}).then((()=>{debug("Approved private show")})).catch(w.yZ)}function U(){(0,d.KF)("tipping/private_show_decline/",{foo:"bar"}).then((()=>{debug("Declined private show")})).catch(w.yZ)}function _(e){return new Promise(((t,i)=>{(0,d.Aw)(`tipping/private_show_context/${e}/`).then((e=>{const i=new o.N6(e.responseText);t({allowPrivateShow:!0,privatePrice:i.getNumber("tokens_per_minute"),spyPrice:i.getNumber("spy_tokens_per_minute"),privateMinMinutes:i.getNumber("private_show_minimum_minutes"),allowShowRecordings:i.getBoolean("allow_recording")})})).catch((e=>i(e)))}))}function F(e){return new Promise(((t,i)=>{(0,d.Aw)(`tipping/spy_show_context/${e}/`).then((e=>{const i=new o.N6(e.responseText);t({spyPrice:i.getNumber("spy_tokens_per_minute")})})).catch((e=>i(e)))}))}function N(){(0,d.KF)("tipping/return_from_away/",{foo:"bar"}).then((()=>{debug("Return from away")})).catch(w.yZ)}k._inProgress=!1,function(e){e.statusNotAllowed="status_not_allowed",e.lowTokens="low_tokens",e.default="default"}(A||(A={}))},1452:(e,t,i)=>{"use strict";function s(e){return e.map((e=>Promise.resolve(e).then((e=>({status:"fulfilled",value:e}))).catch((e=>({status:"rejected",reason:e})))))}i.d(t,{FM:()=>r,h5:()=>o,rO:()=>s,yZ:()=>n});const n=()=>{},o=e=>{error(e)};function r(e,t){let i=!1;return()=>new Promise(((s,n)=>{if(!i)return i=!0,e().finally((()=>{i=!1})).then((e=>{s(e)})).catch((e=>{n(e)}));s(t)}))}},3004:(e,t,i)=>{"use strict";i.d(t,{De:()=>f,G6:()=>m,TI:()=>u,bP:()=>p,fT:()=>v,ii:()=>d,k6:()=>h,uy:()=>g});var s=i(6784),n=i(5216),o=i(2939),r=i(3955);const a="room",l="next",h="/accounts/register/",d="/auth/login/",c="account-redirect";function u(e){const t=new URLSearchParams(window.location.search),i=t.get(l);if(null!==i)return{nextParam:i};const s=void 0!==e.room?e.room:!0===e.ignoreExistingRoom?void 0:t.get(a);return null!=s?{roomParam:s}:[h,d].includes(window.location.pathname)||CHATURBATE_URL_PREFIX===window.location.pathname&&""===window.location.search?{}:{nextParam:p()}}function p(){return`${window.location.pathname}${window.location.search}`}function m(e,t){const i=new URL(e,window.location.origin);return i.searchParams.delete(a),i.searchParams.delete(l),void 0!==t.nextParam?i.searchParams.set(l,t.nextParam):void 0!==t.roomParam&&i.searchParams.set(a,t.roomParam),`${i.pathname}${i.search}`}function g(){let e;o.X0.listen((t=>{e=t.dossier.room})),(0,s.Xq)(["mousedown","touchstart"],window.document,(t=>{const i=(0,r.ss)(t.target);if(void 0!==i&&i.hasAttribute(c)){let t={};new URL(i.href,window.location.origin).pathname===(0,n._Y)(h)&&(t={room:e});const s=u(t);i.href=(0,n._Y)(m(i.href,s))}}))}function v(e){e.setAttribute(c,"")}function f(e,t){void 0===t&&(t=`${window.location.pathname}${window.location.search}`);const i=e.querySelector(`input[name=${l}]`);null!==i&&(i.value=t)}},2359:(e,t,i)=>{"use strict";i.d(t,{BP:()=>A,If:()=>C,P7:()=>D,e4:()=>P});var s=i(4936),n=i(9447),o=i(9461),r=i(7254),a=i(213),l=i(5216),h=i(6844),d=i(2939),c=i(1244),u=i(7463),p=i(9739),m=i(7407),g=i(1452),v=i(7569),f=i(74),y=i(4947);const b={partType:1,height:0,name:"",imgUrl:"",width:0,abuseUrl:""};let w;function C(){d.X0.listen((e=>{w={showEmoticons:e.dossier.userChatSettings.showEmoticons,ignoredEmoticons:e.dossier.ignoredEmoticons}})),(void 0===o.Bm.current.loggedInUser?(w={showEmoticons:!0,ignoredEmoticons:[]},Promise.resolve()):new Promise(((e,t)=>{(0,l.Aw)("api/ts/chat/message-render-options/").then((t=>{w=function(e){const t=new s.N6(e);return{showEmoticons:t.getBoolean("show_emoticons"),ignoredEmoticons:t.getStringList("ignored_emoticons")}}(t.responseText),e()})).catch((e=>{error(e),t(e)}))}))).finally((()=>{f.EZ.listen((e=>{void 0!==w&&(w.showEmoticons=e.showEmoticons)}))})).catch(g.yZ)}const S="%%%[",x="]%%%",T=/((^|\s)@\w+)/;function P(e){const t=document.createElement("span");return M(e).forEach((e=>{switch(e.partType){case 2:case 0:const i=e.s;""!==i&&t.appendChild(E(i));break;case 1:""!==e.name?t.appendChild(I(e)):t.appendChild(E(""))}})),t}function k(e,t,i){const s=document.createElement("span");return M(e.message,e.shortcodes).forEach((n=>{switch(n.partType){case 0:const d=n.s;""!==d&&s.appendChild(E(d));break;case 1:""!==n.name?s.appendChild(I(n)):s.appendChild(E(""));break;case 2:const c=n;void 0!==c.code?s.appendChild(function(e,t,i,s){const{userName:n,room:d,hasFanClub:c}=o.Aw.getState();let f,b,w;switch(e.code){case r.AJ.Fanclub:f=c?()=>{}:()=>{(0,a.Q$)(y.R.noFanClub)},b=y.R.shortcodeFanclubMessage(d),w=e.signupLink;break;case r.AJ.Supporter:f=()=>{},b=y.R.becomeSupporter,w="/supporter/upgrade/";break;case r.AJ.Follow:f=()=>{(0,u.j4)(d),void 0!==o.Bm.current.loggedInUser&&(0,l.Aw)(`follow/is_following/${d}/`).then((e=>{const t=JSON.parse(e.responseText).following,i=new p.W;!t&&o.Bm.current.isMobile&&i.showBrowserNotification()})).catch(g.yZ)},b=y.R.shortcodeFollowMessage(d),w=void 0;break;case r.AJ.Signup:f=()=>{},b=y.R.joinCB,w=e.signupLink;break;case r.AJ.Tip:f=()=>{(0,h.rC)(y.R.loginToTip)||s.fire({message:e.msg,amount:e.amt})},b=void 0!==e.msg&&null!==e.msg?e.msg:"",w=void 0;break;default:return error(`Unknown shortcode: ${e.code}`),document.createElement("div")}const C=i(b,w,f);C.title=v.fM.getShortcodeTitle(e),C.dataset.testid="shortcode-link";const S="fromUser"in t&&void 0!==t.fromUser,x={shortcode:e.code,from_user:S?t.fromUser.username:"",room:d,user_clicked:n,tip:void 0!==e.amt&&e.code===r.AJ.Tip?e.amt:0,message:t.message,from_notice:!S};return C.addEventListener("click",(()=>{(0,m.bT)("ShortcodeLinkClicked",x)})),C}(c,e,t,i)):s.appendChild(E(""))}})),s}function A(e,t,i){const s=k(e,t,i);return s.dataset.testid="shortcodeMessage",s}function M(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=[];const s=[];if(e.indexOf(S)<0&&!v.fM.hasShortcodes(e))return[L(e)];for(let o=0;o<e.length;o+=1)if(o+v.fM.shortcodePrefix.length<e.length&&v.fM.isShortcodePrefix(e.slice(o,o+v.fM.shortcodePrefix.length))){const r=o+e.slice(o,e.length).indexOf(v.fM.shortcodeSuffix);if(-1===r){i.push(e[o]);continue}const a=e.slice(o,r+v.fM.shortcodeSuffix.length),l=v.fM.getShortcodeForPart(a,t);if(void 0===l){i.push(e[o]);continue}0!==i.length&&s.push(L(i.join(""))),i=[],s.push({partType:2,s:a,code:(n=l).code,amt:n.amt,msg:n.msg,signupLink:n.signupLink}),o+=a.length-1}else if("%"===e[o])if(e.slice(o,o+S.length)===S){const t=o+e.slice(o,e.length).indexOf(x);if(e.slice(t,t+x.length)===x){0!==i.length&&s.push(L(i.join(""))),i=[];const n=R(e.slice(o,t+x.length));s.push(n),o=t+x.length-1}}else i.push(e[o]);else i.push(e[o]);var n;return 0!==i.length&&s.push(L(i.join(""))),s}function R(e){if(e.slice(S.length).startsWith("emoticon")){const t=function(e){const t=(e=e.replace("%%%[emoticon ","").replace("]%%%","")).split(/\|/);if(6===t.length){const e={partType:1,name:t[0],thumbUrl:t[1],width:U(t[2])?Number(t[2]):80,height:U(t[3])?Number(t[3]):80,imgUrl:t[4],abuseUrl:t[5]};return void 0!==e.thumbUrl&&B(e.thumbUrl)?e:void 0}if(5===t.length){const e={partType:1,name:t[0],imgUrl:t[1],width:U(t[2])?Number(t[2]):80,height:U(t[3])?Number(t[3]):80,abuseUrl:t[4]};return B(e.imgUrl)?e:void 0}}(e);return void 0!==t?t:(error(`Cannot parse emoticon: ${t}`),b)}return L(e)}function I(e){if(function(e){return void 0===w?(error("messageRenderOptions accessed before being set"),!1):w.showEmoticons&&!w.ignoredEmoticons.includes(e.name)}(e)){const t=document.createElement("img");t.dataset.testid="emoticonImg",t.className="emoticonImage";const i=e.thumbUrl;return t.src=void 0!==i?i:e.imgUrl,t.title=`:${e.name}`,t.style.cursor="pointer",t.onclick=()=>{const t={slug:e.name,url:e.imgUrl};c.pp.fire(t)},o.Bm.current.isMobile&&(e.width=.5*e.width,e.height=.5*e.height),t.height=e.height,t.width=e.width,t.style.verticalAlign="top",t}{const t=document.createElement("span");return t.dataset.testid="emoticonText",(0,n.fZ)(t,n.aG.hrefColor),(0,n.fZ)(t,"msg-link"),t.innerText=`:${e.name}`,t.style.cursor="pointer",t.onclick=()=>{const t={slug:e.name,url:e.imgUrl};c.pp.fire(t)},t}}function E(e){const t=document.createElement("span");return T.test(e)?e.split(T).forEach((e=>{const i=/^\s/.test(e);if("@"===e.trim().charAt(0)){const s=document.createElement("span");s.innerText=e.trimStart(),s.className="username-mention",i&&t.appendChild(document.createTextNode(" ")),t.appendChild(s)}else e.trim().length>0&&t.appendChild(document.createTextNode(e))})):t.innerText=e,t}function L(e){return{partType:0,s:e}}function D(e,t,i,s){return function(e,t,i){const s=k(e,t,i);return s.dataset.testid="shortcode-notice",s}({message:e.message||"",shortcodes:t},i,s)}function B(e){return null!==e.match(/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/g)||(error("Invalid emoticon URL"),!1)}function U(e){return!isNaN(parseInt(e,10))||(error("Invalid dimension argument"),!1)}},5424:(e,t,i)=>{"use strict";i.d(t,{Bc:()=>y,Ec:()=>v,OC:()=>d,QZ:()=>h,XL:()=>s,_b:()=>w,fs:()=>b,sH:()=>f,sp:()=>c});var s,n=i(4936),o=i(7321),r=i(213),a=i(5216),l=i(8255);function h(e){switch(e){case"all":return"all";case"none":return"none";default:return"smart"}}function d(e){switch(e){case"orga":return s.AllUsers;case"orgb":default:return s.ModsFansAndTokens;case"org":return s.ModsAndFans;case"none":return s.None}}function c(e){const t=e;return[0,300,-1].includes(t)?t:(error("roomDossier - invalid C2C notification limit"),300)}let u;function p(e){const t=[],i=e;if(""!==i)try{JSON.parse(i).forEach((e=>{t.push({app_name:e[0],app_location:e[1]})}))}catch(e){error(`Error parsing apps ${e.toString()}`)}return t}function m(e){const t=[];for(const i of e)t.push({idOrName:i.id,messageHtml:i.message_html});return t}function g(e){if(void 0!==e)return{quality:e.getString("quality"),rate:e.getNumber("rate"),stopped:e.getBoolean("stopped")}}function v(e){var t,i,s;const n=e.getMap("chat_settings"),r=e.getMap("satisfaction_score"),a={host:e.getString("wschat_host"),room:e.getString("broadcaster_username"),roomUid:e.getString("room_uid"),viewerUid:e.getStringOrUndefined("viewer_uid"),roomPasswordHash:e.getString("room_pass"),lastSubmittedPasswordHash:e.getString("last_pass",!1),chatRules:e.getString("chat_rules"),roomTitle:e.getString("room_title"),roomStatus:(0,l.JG)(e),isSupporter:e.getBoolean("is_supporter"),needsSupporterToPm:e.getBoolean("needs_supporter_to_pm"),roomGender:e.getString("broadcaster_gender"),userName:e.getString("viewer_username"),chatUserName:e.getString("chat_username"),edgeAuth:encodeURI(e.getString("edge_auth")),viewerPassword:e.getString("chat_password"),viewerGender:e.getString("viewer_gender"),exploringHashTag:e.getString("exploring_hashtag"),sourceName:(0,o.Ys)(e.getString("source_name",!1)),hlsSource:e.getString("hls_source"),isWidescreen:e.getBoolean("is_widescreen"),appsRunning:p(e.getString("apps_running")),allowPrivateShow:e.getBoolean("allow_private_shows"),privatePrice:e.getNumber("private_show_price"),privateMinMinutes:e.getNumber("private_min_minutes"),allowShowRecordings:e.getBoolean("allow_show_recordings"),allowAnonymousTipping:e.getBoolean("allow_anonymous_tipping"),spyPrice:e.getNumber("spy_private_show_price"),fanClubSpyPrice:e.getNumberOrUndefined("fan_club_spy_private_show_price"),premiumPrivatePrice:null!==(t=e.getNumberOrUndefined("premium_private_price"))&&void 0!==t?t:0,premiumPrivateMinMinutes:null!==(i=e.getNumberOrUndefined("premium_private_min_minutes"))&&void 0!==i?i:0,premiumShowActive:null!==(s=e.getBooleanOrUndefined("premium_show_running"))&&void 0!==s&&s,privateShowId:e.getStringWithNumbers("private_show_id"),hasLowSatisfactionScore:e.getBoolean("low_satisfaction_score"),isAgeVerified:e.getBoolean("is_age_verified"),age:e.getNumberOrUndefined("age"),hiddenMessage:e.getString("hidden_message"),following:e.getBoolean("following"),followNotificationFrequency:h(e.getString("follow_notification_frequency",!1)),isModerator:e.getBoolean("is_moderator"),broadcasterIsOnNewChat:e.getBoolean("broadcaster_on_new_chat"),tokenBalance:e.getNumber("token_balance"),serverName:e.getString("server_name"),numFollowed:e.getNumber("num_followed"),numFollowedOnline:e.getNumber("num_followed_online"),hasStudio:e.getBoolean("has_studio"),isMobile:e.getBoolean("is_mobile"),ignoredEmoticons:e.getObject("ignored_emoticons"),hideSatisfactionScore:e.getBoolean("hide_satisfaction_score"),tipsInPast24Hours:e.getNumber("tips_in_past_24_hours"),lastVoteInPast24Hours:e.getNumberOrUndefined("last_vote_in_past_24_hours"),lastVoteInPast90DaysDown:e.getBoolean("last_vote_in_past_90_days_down"),dismissibleMessages:m(e.getObject("dismissible_messages")),showMobileSiteBannerLink:e.getBoolean("show_mobile_site_banner_link"),numViewers:e.getNumber("num_viewers"),isInFanClub:e.getBoolean("fan_club_is_member"),hasFanClub:e.getBoolean("performer_has_fanclub"),paidTokensFanClub:e.getBoolean("fan_club_paid_with_tokens"),satisfactionScore:{upVotes:r.getNumber("up_votes",!1),downVotes:r.getNumber("down_votes",!1),percent:r.getNumber("percent",!1)},tfaEnabled:e.getBoolean("tfa_enabled"),userChatSettings:{fontColor:n.getString("font_color"),fontFamily:n.getString("font_family"),fontSize:n.getString("font_size"),showEmoticons:n.getBoolean("show_emoticons"),emoticonAutocompleteDelay:n.getNumber("emoticon_autocomplete_delay"),highestTokenColor:n.getString("highest_token_color"),sortUsersKey:n.getString("sort_users_key"),modExpiration:n.getNumber("mod_expire"),roomEntryFor:d(n.getString("room_entry_for")),roomLeaveFor:d(n.getString("room_leave_for")),c2cNotificationLimit:c(n.getNumber("c2c_notify_limit")),silenceBroadcasters:n.getString("silence_broadcasters"),ignoredUsers:n.getString("ignored_users"),allowedChat:n.getString("allowed_chat"),tipVolume:n.getNumber("tip_volume"),collapseNotices:n.getBoolean("collapse_notices")},aspAuthUrl:e.getString("asp_auth_url"),browserId:e.getString("browser_id"),quality:g(e.getParsedSubMapOrUndefined("quality",!0)),latency:{localTimeTranscoderInput:void 0,streamTimeTranscoderInput:void 0,localTimeSegmentStart:void 0,streamTimeSegmentStart:void 0},edgeRegion:e.getString("edge_region"),userlistColor:e.getString("userlist_color"),activePassword:e.getBoolean("active_password"),summaryCardImage:e.getStringOrUndefined("summary_card_image")},u=e.getStringOrUndefined("staff_links");void 0!==u&&(a.staffInfo={staffLinks:JSON.parse(u),autoLoadAdminInfo:e.getBoolean("auto_load_admin_info"),previousUsernames:e.getStringOrUndefined("previous_usernames"),deletionAdminNotice:e.getStringOrUndefined("deletion_admin_notice")});const v=e.getParsedSubMapOrUndefined("user_colors",!0);return void 0!==v&&(a.userColors=function(e){if(void 0!==e)return{hasTokens:e.getBoolean("has_tokens"),tippedRecently:e.getBoolean("tipped_recently"),tippedAlotRecently:e.getBoolean("tipped_alot_recently"),tippedTonsRecently:e.getBoolean("tipped_tons_recently")}}(v)),e.logUnusedDebugging("getRoomDossier"),a}function f(e,t){const i=new n.N6(t);return new Promise(((e,s)=>{i.getNumber("status",!1)>=400?s(`Bad response from server: ${t}`):e(v(i))}))}function y(e){return void 0!==u&&(u.abort(),u=void 0),new Promise(((t,i)=>{const s=(0,a.vU)(`api/chatvideocontext/${e}/`);u=s[0],s[1].then((e=>{t(f(0,e.responseText))})).catch((e=>{if(404===e.xhr.status)return(0,r.Q$)("HTTP 404 - Page Not Found\n\nIt's probably just a broken link, or perhaps a cancelled broadcaster."),void e.xhr.abort();i(e)}))}))}function b(e,t){let i=!0;return"public"!==t.previousStatus&&"privaterequesting"===e.chatConnection.status&&"privaterequesting"===t.currentStatus&&(i=!1),i}function w(e,t){return y(e.chatConnection.room()).then((i=>{e.dossier=i,e.chatConnection.status=i.roomStatus,t.currentStatus=i.roomStatus}))}!function(e){e[e.AllUsers=0]="AllUsers",e[e.ModsFansAndTokens=1]="ModsFansAndTokens",e[e.ModsAndFans=2]="ModsAndFans",e[e.None=3]="None"}(s||(s={}))},5088:(e,t,i)=>{"use strict";i.d(t,{M2:()=>l,QR:()=>c});var s=i(6624),n=i(7623),o=i(1224),r=i(6784),a=i(8423);const l=(0,n.nr)()&&!(0,n.Xb)(),h=new a.c_("roomStartStreaming");let d;l&&(d=new a.c_("safariPageShow",{listenersWarningThreshold:800}),(0,r.wu)("pageshow",window,(e=>{e.persisted&&void 0!==d&&d.fire()})));class c{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.roomName=e,this.img=t,this._streaming=!1,this._imgLoaded=!1,this.lastFrameTime=0,this.fadeOutStopTime=0,this.forceNoAnimate=(0,s.isPremium)(),this.options={startStreaming:!1,loadInitialImage:!0,fadeOutTimeoutMs:2e3,streamingFadeoutTimeoutMs:0,useWideImages:!0,...i},this.STATIC_BASE_URL=`${o.m.jpegStreamUrl}${this.options.useWideImages?"riw":"ri"}/${this.roomName}.jpg`,this.ANIMATING_BASE_URL=`${o.m.jpegStreamUrl}${this.options.useWideImages?"minifwap":"minifap"}/${this.roomName}.jpg`,this.setStreamRate(),this.options.startStreaming?this.startStreaming():this.options.loadInitialImage&&this.loadImage(0).catch((e=>{warn("Error loading image",{imageSrc:e})})),void 0!==d&&d.addListener((()=>{this.safariReloadImage()}),this.img)}safariReloadImage(){this._imgLoaded||(this._stopAnimating(),this.loadImage(0).catch((e=>{warn("Error loading image",{imageSrc:e})})))}_stopAnimating(){this.stopStreaming(),this.fadeOutStopTime=0}getStreaming(){return this._streaming}getFadingOut(){return!this._streaming&&(new Date).getTime()<=this.fadeOutStopTime}getAnimating(){return!this.forceNoAnimate&&(this.getStreaming()||this.getFadingOut())}setStreaming(e){const t=0===this.options.streamingFadeoutTimeoutMs;e?this.fadeOutStopTime=t?0:(new Date).getTime()+this.options.streamingFadeoutTimeoutMs:0===this.fadeOutStopTime&&(this.fadeOutStopTime=(new Date).getTime()+this.options.fadeOutTimeoutMs),this._streaming=t&&e}setStreamRate(){const e=navigator.userAgent.match(/Puffin\/(\d)/);null!==e&&parseInt(e[1])<8?this.streamRate=1500:this.streamRate=140}loadImage(e){if(0===this.lastFrameTime&&(this.lastFrameTime=e),!(0===e||e-this.lastFrameTime>this.streamRate))return Promise.resolve();let t;return this.lastFrameTime=e,t=this.getAnimating()?`${this.ANIMATING_BASE_URL}?f=${Math.random()}`:`${this.STATIC_BASE_URL}?${Math.floor((new Date).getTime()/3e4)}`,new Promise(((e,i)=>{const s=new Image;s.onload=()=>{this.img.onload=()=>{this._imgLoaded=!0},this._imgLoaded=!1,this.img.src=s.src,e()},s.onerror=()=>{i(t)},s.src=t}))}startStreaming(){if((0,n.H9)()||this.forceNoAnimate)return;h.fire(this.roomName);const e=this.getAnimating();if(this.setStreaming(!0),e)return;const t=e=>{this.getAnimating()&&this.loadImage(e).then((()=>{requestAnimationFrame((e=>{t(e)}))})).catch((()=>{t(0)}))};t(0)}stopStreaming(){this.setStreaming(!1)}stopAnimating(){this.setStreaming(!1),this.fadeOutStopTime=0}}},9898:(e,t,i)=>{"use strict";i.d(t,{_y:()=>P,CU:()=>T,Q5:()=>x});var s=i(7623),n=i(5276),o=i(9447),r=i(9461),a=i(1372),l=i(6784),h=i(8122),d=i(1519),c=i(2709),u=i(3955),p=i(3654),m=i(4140),g=i(3959),v=i(1284),f=i(4926),y=i(7407),b=i(1452),w=i(1448),C=i(3860);class S extends c.u{constructor(e){super("div",e),this.userExpandedNotice=!1,this.element=this.createBaseMessageDiv(this.roomNoticeData.dataNick),void 0!==this.roomNoticeData.ts&&(this.element.dataset.ts=this.roomNoticeData.ts.toString()),this.element.style.display="flex",this.combinedNotice=this.buildCombinedNotice(),this.contentsDiv=(0,a.tT)("div",{"data-testid":"room-notice"},(0,a.tT)("div",{ref:e=>this.combinedNoticeViewport=e,style:{overflow:"hidden",flexBasis:"0",flexShrink:0,flexGrow:1},"data-testid":"room-notice-viewport"},this.combinedNotice),this.buildAdditionalContents()),this.styleContentsDiv(),this.element.appendChild(this.contentsDiv),this.postConstruction(),this.collapseEnabled()&&(this.collapseHeight().catch(b.yZ),this.element.querySelectorAll("img").forEach((e=>{(0,l.wu)("load",e,(()=>this.recalculateCollapse()))})))}initData(e){this.roomNoticeData=e.roomNoticeData,this.isChatScrolledToBottom=e.isChatScrolledToBottom,this.scrollChatToBottom=e.scrollChatToBottom,this.getChatScrollTop=e.getChatScrollTop,this.setChatScrollTop=e.setChatScrollTop,this.neverCollapse=e.neverCollapse,this.maxCollapsedHeightEm=7.1,this.maxCollapsedHeightLeewayEm=1.5,this.scrollSpeed=20,this.fullNoticeHasDisplayed=!1,this.scrollStartDebouncer=new d.a((()=>this.startAnimatedScroll()),{bounceLimitMS:1e3,debounceType:1})}recalculateCollapse(){var e;const t=!0===(null===(e=this.isChatScrolledToBottom)||void 0===e?void 0:e.call(this)),i=this.collapseEnabled()&&!this.userExpandedNotice&&this.needsCollapsing();var s;this.setCollapseStyles(i),this.updateCollapseTogglingStyles(),this.updateCollapsedScrolling(),t&&(null===(s=this.scrollChatToBottom)||void 0===s||s.call(this),window.setTimeout((()=>{var e;null===(e=this.scrollChatToBottom)||void 0===e||e.call(this)}),0))}mayCollapse(){return this.roomNoticeData.noticeType===g.k.App&&!0!==this.neverCollapse}collapseEnabled(){return this.mayCollapse()&&r.Aw.getState().userChatSettings.collapseNotices}isRoomSubjectNotice(){var e,t;return null!==(e=null===(t=this.roomNoticeData.colorClass)||void 0===t?void 0:t.includes("titleChange"))&&void 0!==e&&e}countsForUnread(){var e;return null===(e=this.roomNoticeData.countsForUnread)||void 0===e||e}styleContentsDiv(){this.contentsDiv.style.display="flex",this.contentsDiv.style.width="100%",void 0!==this.roomNoticeData.background&&(this.contentsDiv.style.background=this.roomNoticeData.background,this.contentsDiv.style.textShadow="none"),this.contentsDiv.style.fontWeight=void 0!==this.roomNoticeData.weight?this.roomNoticeData.weight:"normal",(0,o.fZ)(this.contentsDiv,"roomNotice"),"#ff3"===this.roomNoticeData.background&&(0,o.fZ)(this.contentsDiv,"isTip"),void 0!==this.roomNoticeData.colorClass&&(0,o.fZ)(this.contentsDiv,this.roomNoticeData.colorClass),this.contentsDiv.style.borderRadius="4px"}buildAdditionalContents(){if(!this.mayCollapse())return;const e={display:"none",padding:"0 0 4px 4px",cursor:"pointer"},t=(0,a.tT)("svg",{width:"1.2em",height:"1.2em",viewBox:"0 -1 14 9",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{backgroundColor:"rgba(201, 201, 201, 0.4)",padding:"3px",borderRadius:"50%"}},(0,a.tT)("path",{d:"M1.74355 1.29511C2.11737 0.939948 2.70361 0.938914 3.07868 1.29276L6.31378 4.34474C6.69906 4.70821 7.30094 4.70821 7.68622 4.34474L10.9213 1.29276C11.2964 0.938915 11.8826 0.939948 12.2565 1.29511V1.29511C12.6604 1.67886 12.6592 2.32304 12.254 2.70536L7.68622 7.01455C7.30094 7.37802 6.69906 7.37802 6.31378 7.01455L1.74604 2.70536C1.34078 2.32304 1.33965 1.67886 1.74355 1.29511V1.29511Z",fill:"#033E58"}),(0,a.tT)("path",{d:"M6.65689 3.98104L3.42179 0.92906C2.85358 0.393012 1.96547 0.394579 1.39916 0.932628C0.787271 1.51397 0.788992 2.48987 1.40293 3.06905L5.97067 7.37825C6.54859 7.92346 7.45141 7.92346 8.02933 7.37825L12.5971 3.06905C13.211 2.48987 13.2127 1.51397 12.6008 0.932628C12.0345 0.394579 11.1464 0.393013 10.5782 0.92906L7.34311 3.98104C7.15047 4.16278 6.84953 4.16278 6.65689 3.98104Z",stroke:"#EFEFEF","stroke-opacity":"0.25"}));t.style.cssFloat="right";const i=(0,a.tT)("svg",{width:"1.2em",height:"1.2em",viewBox:"0 1 14 9",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{backgroundColor:"rgba(201, 201, 201, 0.4)",padding:"3px",borderRadius:"50%"}},(0,a.tT)("path",{d:"M12.2565 7.36681C11.8826 7.72198 11.2964 7.72301 10.9213 7.36917L7.68622 4.31719C7.30094 3.95371 6.69906 3.95371 6.31378 4.31719L3.07868 7.36917C2.70361 7.72301 2.11737 7.72198 1.74355 7.36681V7.36681C1.33965 6.98307 1.34078 6.33889 1.74604 5.95657L6.31378 1.64738C6.69906 1.2839 7.30094 1.2839 7.68622 1.64738L12.254 5.95657C12.6592 6.33889 12.6604 6.98307 12.2565 7.36681V7.36681Z",fill:"#033E58"}),(0,a.tT)("path",{d:"M7.34311 4.68089L10.5782 7.73287C11.1464 8.26891 12.0345 8.26735 12.6008 7.7293C13.2127 7.14795 13.211 6.17206 12.5971 5.59287L8.02933 1.28368C7.45141 0.738468 6.54859 0.738468 5.97067 1.28368L1.40293 5.59287C0.788992 6.17206 0.787271 7.14795 1.39916 7.7293C1.96547 8.26735 2.85358 8.26891 3.42179 7.73287L6.65689 4.68089C6.84953 4.49915 7.15047 4.49915 7.34311 4.68089Z",stroke:"#EFEFEF","stroke-opacity":"0.25"}));return i.style.cssFloat="right",this.expandArrowDiv=(0,a.tT)("div",{style:e,onClick:()=>this.userToggleCollapse()},(0,a.tT)("div",{style:{overflow:"hidden"}},t)),this.collapseArrowDiv=(0,a.tT)("div",{style:e,onClick:()=>this.userToggleCollapse()},(0,a.tT)("div",{style:{overflow:"hidden"}},i)),this.emHeightDummyDiv=(0,a.tT)("div",{style:{position:"absolute",opacity:"0",height:"1em"}}),(0,a.tT)("div",{style:{WebkitAlignSelf:"flex-end",flexGrow:0,flexShrink:1,overflow:"hidden"}},this.expandArrowDiv,this.collapseArrowDiv,this.emHeightDummyDiv)}postConstruction(){(0,s.AD)()||n.A.parse(this.element,{className:"emojiChat"}),(0,l.wu)("click",this.contentsDiv,(e=>{this.isClickableSubcomponent(e.target)||this.isCollapseTogglable()&&this.isCollapsed()&&this.userToggleCollapse()})),(0,l.wu)("animationend",this.combinedNotice,(e=>{"slide"===e.animationName&&this.inActiveVideoMode()&&(this.fullNoticeHasDisplayed=!0)}))}userToggleCollapse(){(0,y.bT)("NoticeToggled",{action:this.isCollapsed()?"expanding":"collapsing"}),this.isCollapsed()?(this.userExpandedNotice=!0,this.expandHeight()):(this.userExpandedNotice=!1,this.collapseHeight(!0).catch(b.yZ))}getEmPx(){if(void 0===this.emHeightDummyDiv)return error("SplitRoomNotice getting emHeight with no em div"),S.fallbackEmHeight;const e=this.emHeightDummyDiv.getBoundingClientRect().height;return 0===e?S.fallbackEmHeight:(S.fallbackEmHeight=e,e)}getCollapsedHeightPx(){return this.maxCollapsedHeightEm*this.getEmPx()+4}needsCollapsing(){return this.combinedNotice.scrollHeight>(this.maxCollapsedHeightEm+this.maxCollapsedHeightLeewayEm)*this.getEmPx()}isCollapseTogglable(){return this.collapseEnabled()&&this.needsCollapsing()}isCollapsed(){return this.combinedNoticeViewport.classList.contains("collapsed")}async collapseHeight(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.collapseEnabled())return;const t=!0===this.isChatScrolledToBottom();if(e){const e=this.getChatScrollTop(),t=this.contentsDiv.getBoundingClientRect().height-this.getCollapsedHeightPx();this.setChatScrollTop(e-t)}this.setCollapseStyles(!0),this.updateCollapsedScrolling(),await this.confirmCollapse(),this.updateCollapseTogglingStyles(),this.updateCollapsedScrolling(),t&&this.scrollChatToBottom()}confirmCollapse(){return new Promise((e=>{window.setTimeout((()=>{this.needsCollapsing()||this.setCollapseStyles(!1),e()}),0)}))}expandHeight(){var e,t,i;const s=!0===(null===(e=this.isChatScrolledToBottom)||void 0===e?void 0:e.call(this)),n=null!==(t=null===(i=this.getChatScrollTop)||void 0===i?void 0:i.call(this))&&void 0!==t?t:0;if(this.setCollapseStyles(!1),this.updateCollapseTogglingStyles(),this.updateCollapsedScrolling(),s){var o;null===(o=this.scrollChatToBottom)||void 0===o||o.call(this),window.setTimeout((()=>{var e;null===(e=this.scrollChatToBottom)||void 0===e||e.call(this)}),0)}else{var r;const e=this.contentsDiv.getBoundingClientRect().height-this.getCollapsedHeightPx();null===(r=this.setChatScrollTop)||void 0===r||r.call(this,n+e)}}updateCollapseTogglingStyles(){void 0!==this.collapseArrowDiv&&void 0!==this.expandArrowDiv?(this.collapseArrowDiv.style.display="none",this.expandArrowDiv.style.display="none",this.contentsDiv.style.cursor="",this.isCollapseTogglable()&&(this.isCollapsed()?(this.expandArrowDiv.style.display="",this.contentsDiv.style.cursor="pointer"):this.collapseArrowDiv.style.display="")):error("SplitRoomNotice setting toggling styles with no arrows")}setCollapseStyles(e){e?(this.combinedNoticeViewport.style.maxHeight=`${this.maxCollapsedHeightEm}em`,this.combinedNoticeViewport.classList.add("collapsed")):(this.combinedNoticeViewport.style.maxHeight="999999999px",this.combinedNoticeViewport.classList.remove("collapsed"),this.inActiveVideoMode()&&(this.fullNoticeHasDisplayed=!0))}updateCollapsedScrolling(){this.isCollapsed()?this.fullNoticeHasDisplayed?this.setScrollToEnd():(this.removeAnimatedScroll(),this.scrollStartDebouncer.callFunc()):this.removeAnimatedScroll()}startAnimatedScroll(){if(!this.isCollapsed())return;const e=this.combinedNoticeViewport.getBoundingClientRect().height,t=(this.combinedNotice.getBoundingClientRect().height-e)/this.scrollSpeed;this.combinedNotice.style.setProperty("--scroll-time-s",`${t}`),this.combinedNotice.style.setProperty("--notice-viewport-height-px",`${e}`),this.removeAnimatedScroll(),(0,u.aN)(),this.combinedNotice.classList.add("animated-scroll")}removeAnimatedScroll(){this.combinedNotice.classList.remove("animated-scroll")}setScrollToEnd(){this.removeAnimatedScroll();const e=this.combinedNoticeViewport.getBoundingClientRect().height;this.combinedNotice.style.setProperty("--notice-viewport-height-px",`${e}`),this.combinedNotice.classList.add("scroll-to-end")}isClickableSubcomponent(e){if(e instanceof Element){const t=(e instanceof HTMLElement||e instanceof SVGElement)&&null!==e.onclick,i=e.closest("*[data-listener-count-click]")!==this.contentsDiv,s=null!==e.closest("a");if(t||i||s)return!0}return!1}}S.fallbackEmHeight=12;class x extends S{createBaseMessageDiv(e){const t=(0,w.mh)(e);return t.style.width=`calc(100% + ${w.QT}px)`,t}styleContentsDiv(){super.styleContentsDiv(),void 0!==this.roomNoticeData.background&&(this.contentsDiv.style.marginTop="1px","#ff8b45"===this.roomNoticeData.background&&(0,o.fZ)(this.contentsDiv,"bright-background")),this.contentsDiv.style.position="relative",this.contentsDiv.style.left=`-${w.QT}px`,this.contentsDiv.style.color=void 0!==this.roomNoticeData.foreground?this.roomNoticeData.foreground:"",this.contentsDiv.style.padding=`2px ${w.QT}px`}buildCombinedNotice(){const e=document.createElement("div");return(0,w.U$)(e,this.roomNoticeData.messages,this.roomNoticeData.shortcodes),e}postConstruction(){super.postConstruction(),(0,w.F1)(this.element,this.contentsDiv,h.sY.parseNotice(this.roomNoticeData)),(0,p.Qp)(this.element),(0,h.at)(this.element,document.body.classList.contains("darkmode"))}inActiveVideoMode(){return"split"===C.L.getVideoMode()}}class T extends S{createBaseMessageDiv(e){const t=(0,p.mh)(e);return t.style.padding="1px 5px",t}styleContentsDiv(){super.styleContentsDiv(),void 0!==this.roomNoticeData.background&&(this.contentsDiv.style.color="#000000"),void 0!==this.roomNoticeData.foreground&&(this.contentsDiv.style.color=this.roomNoticeData.foreground),this.contentsDiv.style.padding=`2px  ${p.xm}px`}buildCombinedNotice(){const e=document.createElement("div");return(0,p.U$)(e,this.roomNoticeData.messages,this.roomNoticeData.shortcodes),e}postConstruction(){super.postConstruction(),(0,h.hd)(this.element,this.roomNoticeData.foreground,this.roomNoticeData.background),(0,p.Qp)(this.element)}inActiveVideoMode(){return"split"!==C.L.getVideoMode()}}class P extends S{createBaseMessageDiv(e){return(0,v.mh)(e)}styleContentsDiv(){if(super.styleContentsDiv(),void 0===this.roomNoticeData.background){const e=(0,v.Uq)(void 0!==this.roomNoticeData.foreground?this.roomNoticeData.foreground:"#aaaaaa");(0,m.yX)(this.contentsDiv,e)}this.contentsDiv.style.padding=`2px ${f.Fr}px`,this.contentsDiv.style.color=void 0!==this.roomNoticeData.foreground?this.roomNoticeData.foreground:"#000000"}buildCombinedNotice(){const e=document.createElement("div");return(0,f.U$)(e,this.roomNoticeData.messages,this.roomNoticeData.shortcodes),e}postConstruction(){super.postConstruction(),(0,f.St)(this.element)}inActiveVideoMode(){return!0}}},2434:(e,t,i)=>{"use strict";i.d(t,{z:()=>l});var s=i(1519),n=i(8423),o=i(74),r=i(1372),a=i(3860);class l{constructor(e){this.props=e,this.heightRestrictedNotices=[],this.listenerGroup=new n.gt,this.onNoticeResizeObserved=()=>{document.body.contains(this.resizeSentinel)&&this.recalculateHeightRestrictionsDebouncer.callFunc()},this.recalculateNoticeHeightRestrictions=()=>{this.heightRestrictedNotices=this.heightRestrictedNotices.filter((e=>document.body.contains(e.element)));for(const e of this.heightRestrictedNotices)e.recalculateCollapse()},this.resizeSentinel=(0,r.tT)("div",{className:"notice_resize_sentinel",style:{height:"0",overflow:"hidden",opacity:"0"}},"my long string".repeat(100)),e.appendSentinelDiv(this.resizeSentinel),this.recalculateHeightRestrictionsDebouncer=new s.a(this.recalculateNoticeHeightRestrictions,{debounceType:1,bounceLimitMS:20}),void 0!==window.ResizeObserver&&(this.noticeResizeObserver=new ResizeObserver(this.onNoticeResizeObserved),this.noticeResizeObserver.observe(this.resizeSentinel)),this.subjectChangeDebouncer=new s.a((()=>{void 0!==this.latestSubjectChangeNotice&&(this.appendNotice(this.latestSubjectChangeNotice),this.latestSubjectChangeNotice=void 0)}),{debounceType:2,bounceLimitMS:1e4}),o.EZ.listen(this.recalculateNoticeHeightRestrictions).addTo(this.listenerGroup),a.L.changeVideoMode.listen((()=>this.recalculateHeightRestrictionsDebouncer.callFunc())).addTo(this.listenerGroup)}addRoomNotice(e){e.isRoomSubjectNotice()?this.addRoomSubjectNotice(e):this.appendNotice(e)}onRoomCleanup(){this.heightRestrictedNotices=[]}dispose(){var e;this.listenerGroup.removeAll(),null===(e=this.noticeResizeObserver)||void 0===e||e.disconnect(),this.resizeSentinel.remove()}addRoomSubjectNotice(e){this.latestSubjectChangeNotice=e,this.subjectChangeDebouncer.callFunc()}appendNotice(e){this.props.appendNotice(e,e.countsForUnread()),e.mayCollapse()&&this.heightRestrictedNotices.unshift(e)}}},8255:(e,t,i)=>{"use strict";var s;function n(e){return o(e.getString("room_status"))}function o(e){switch(e){case"away":return"away";case"private":return"privatenotwatching";case"private_watching":return"privatewatching";case"private_spying":return"privatespying";case"private_requesting":return"privaterequesting";case"public":return"public";case"hidden":return"hidden";case"hidden_watching":return"hiddenwatching";case"offline":return"offline";case"password protected":return"passwordprotected";default:return error(`unknown room status -- ${e}`),"unknown"}}function r(e){return["public","privaterequesting","privatewatching","privatespying","hiddenwatching"].includes(e)}i.d(t,{Co:()=>s,JG:()=>n,PZ:()=>o,x_:()=>r}),function(e){e.Standard="standard",e.Premium="premium"}(s||(s={}))},2609:(e,t,i)=>{"use strict";i.d(t,{k:()=>p});var s=i(9461),n=i(2939),o=i(2709),r=i(8423),a=i(6440),l=i(4580),h=i(34),d=i(4947),c=i(4110);function u(e,t){const i=document.createElement("div");return i.innerText=e,i.style.color="#72C0FF",i.style.cursor="pointer",i.style.paddingTop="5px",i.onmouseenter=()=>{i.style.textDecoration="underline"},i.onmouseleave=()=>{i.style.textDecoration="none"},i.style.pointerEvents="auto",i.onclick=e=>{t(e)},i}class p extends o.u{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super(),this.positionFixed=e,this.moreRoomsLink=u(d.R.moreRoomsText,(e=>{c.nw.fire(void 0),e.stopPropagation()})),this.showTextHandlers=new Map,this.joinShowLink=u("",(()=>{})),this.shouldShowMoreRoomsLink=!0,this.hiddenMessage="",this.connectingStatusText=d.R.connecting,this.isConnecting=!1,this.displayChanged=new r.c_("displayChanged"),this.userInRoom=!1,this.element.style.display="none",this.element.style.position=this.positionFixed?"fixed":"absolute",this.element.style.height="auto",this.element.style.width="auto",this.element.style.boxSizing="border-box",this.element.style.padding="0 50px",this.element.style.left="0",this.element.style.textAlign="center",this.element.style.pointerEvents="none",this.element.style.zIndex=`${p.Z_INDEX}`,this.element.dataset.testid="video-overlay-text",this.header=document.createElement("div"),this.header.style.fontSize="32px",this.header.style.lineHeight="32px",this.header.style.color="#72c0ff",this.header.style.marginBottom="20px",this.element.appendChild(this.header),this.body=document.createElement("div"),this.body.style.fontSize="16px",this.body.style.color="#ffffff",this.text=document.createElement("span"),this.body.appendChild(this.text),this.moreRoomsLink.style.display="none",this.body.appendChild(this.moreRoomsLink),this.joinShowLink.style.display="none",this.body.appendChild(this.joinShowLink),this.spyDisabledText=document.createElement("span"),this.spyDisabledText.innerText=d.R.privateShowSpyDisabled,this.spyDisabledText.style.display="none",this.spyDisabledText.style.paddingTop="5px",this.body.appendChild(this.spyDisabledText),this.element.appendChild(this.body),this.showTextHandlers.set("away",(e=>{this.header.innerText=d.R.performerIsAwayText,this.text.innerText=d.R.roomAwayMessage,this.joinShowLink.style.display="none",this.spyDisabledText.style.display="none",this.updateMoreRoomsLinkDisplay(!0)})),this.showTextHandlers.set("privatenotwatching",(e=>{this.header.innerText=d.R.privateShowInProgressText,this.text.innerText=d.R.roomPrivateNotWatchingMessage,this.joinShowLink.innerText=d.R.spyOnThisPrivateShowCAPS,this.joinShowLink.style.display=this.isSpyEnabled&&this.userInRoom&&"notconnected"!==e.status?"block":"none",this.spyDisabledText.style.display=this.isSpyEnabled?"none":"block",this.joinShowLink.onclick=()=>{(0,h.lh)(e,void 0,{onResolve:()=>{s.Bm.current.isMobile&&l.qb.fire("private")}})},this.updateMoreRoomsLinkDisplay(!0)})),this.showTextHandlers.set("hidden",(e=>{this.header.innerText=d.R.camIsHidden,this.text.innerText=this.hiddenMessage,this.joinShowLink.style.display="none",this.spyDisabledText.style.display="none",this.updateMoreRoomsLinkDisplay(!1)})),this.showTextHandlers.set("offline",(e=>{this.header.innerText=d.R.offline,this.text.innerText=d.R.roomOfflineSubheader,this.joinShowLink.style.display="none",this.spyDisabledText.style.display="none",this.updateMoreRoomsLinkDisplay(!0)})),this.showTextHandlers.set("passwordprotected",(e=>{this.header.innerText=d.R.passwordRequired,this.text.innerText=d.R.roomPasswordProtectedMessage,this.joinShowLink.style.display="none",this.spyDisabledText.style.display="none",this.updateMoreRoomsLinkDisplay(!0)}));const t=new r.gt;n.X0.listen((e=>{this.currentChatConnection=e.chatConnection,this.setDisabledText(e,!0,e.dossier.spyPrice),e.chatConnection.event.statusChange.listen((t=>{this.setDisabledText(e,!0,e.dossier.spyPrice),this.handleStatusChange(e.chatConnection,t.currentStatus)})).addTo(t),e.chatConnection.event.hiddenMessageChange.listen((e=>{this.hiddenMessage=e})).addTo(t),e.chatConnection.event.settingsUpdate.listen((t=>{this.setDisabledText(e,t.allowPrivateShow,t.spyPrice),this.joinShowLink.style.display=this.isSpyEnabled&&this.userInRoom&&"privatenotwatching"===e.chatConnection.status?"block":"none",this.spyDisabledText.style.display=this.isSpyEnabled?"none":"block"})).addTo(t),e.chatConnection.event.roomCountUpdate.listen((()=>{this.userInRoom=!0,this.joinShowLink.style.display=this.isSpyEnabled&&this.userInRoom&&"privatenotwatching"===e.chatConnection.status?"block":"none"})).addTo(t),l.Io.listen((()=>{this.handleStatusChange(e.chatConnection,e.dossier.roomStatus)})).addTo(t),this.hiddenMessage=e.dossier.hiddenMessage,this.handleStatusChange(e.chatConnection,e.dossier.roomStatus)})),n.Gr.listen((()=>{t.removeAll(),this.hiddenMessage="",this.videoOffline=!1,this.userInRoom=!1}))}hide(){this.hideElement(),this.displayChanged.fire()}show(){this.showElement(),this.displayChanged.fire()}setVideoOffline(e){this.videoOffline=e,void 0!==this.currentChatConnection&&this.handleStatusChange(this.currentChatConnection,this.currentChatConnection.status)}displaysForStatus(e){return void 0!==this.showTextHandlers.get(e)}setDisabledText(e,t,i){(0,a.f)("PremPrivShow")&&e.chatConnection.premiumShowActive?(this.spyDisabledText.innerText=d.R.premiumShowDesc,this.isSpyEnabled=!1):(this.spyDisabledText.innerText=d.R.privateShowSpyDisabled,this.isSpyEnabled=i>0&&t)}repositionChildren(){if(void 0!==this.parent){const e=this.parent.element.getBoundingClientRect(),t=document.documentElement.clientWidth,i=document.documentElement.clientHeight;e.width<=t?(this.element.style.width=`${e.width}px`,this.positionFixed&&(this.element.style.left=`${e.left}px`)):(this.element.style.width=`${t}px`,this.element.style.left="0"),e.height<=i?"fixed"===this.parent.element.style.position?this.element.style.top=e.top+.5*e.height-.5*this.element.offsetHeight+"px":this.element.style.top=.5*e.height-.5*this.element.offsetHeight+"px":this.element.style.top=.5*i-.5*this.element.offsetHeight+"px",this.element.style.maxHeight=`${e.height}px`}}handleStatusChange(e,t){this.videoOffline&&(t="offline");const i=this.showTextHandlers.get(t);if(void 0!==i)return i(e),this.show(),void this.repositionChildrenRecursive();switch(this.isConnecting||(this.moreRoomsLink.style.display="none",this.hide()),t){case"public":case"privaterequesting":case"privatewatching":case"privatespying":case"notconnected":case"hiddenwatching":break;default:warn(`unexpected status: ${t}`)}}updateMoreRoomsLinkDisplay(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.isConnecting&&!this.videoOffline;e&&!t&&this.shouldShowMoreRoomsLink?this.moreRoomsLink.style.display="block":this.moreRoomsLink.style.display="none"}setShowMoreRoomsLink(e){this.shouldShowMoreRoomsLink=e,this.updateMoreRoomsLinkDisplay()}showConnectingStatus(){this.header.innerText=this.connectingStatusText,this.text.innerText=d.R.connectingToBroadcastMessage,this.show(),this.joinShowLink.style.display="none",this.spyDisabledText.style.display="none",this.moreRoomsLink.style.display="none",this.isConnecting=!0}isConnectingStatusShowing(){return this.header.innerText===this.connectingStatusText}hideConnectingStatus(){this.isConnecting&&(this.isConnectingStatusShowing()&&(this.header.innerText="",this.text.innerText="",this.hide()),this.isConnecting=!1)}}p.Z_INDEX=1},8785:(e,t,i)=>{"use strict";i.d(t,{CJ:()=>s,DG:()=>l,Kb:()=>r,LD:()=>h,P8:()=>u,W1:()=>a,b5:()=>c,e0:()=>d});var s,n=i(9461),o=i(4947);function r(e){return e.isBroadcaster?"broadcaster":e.isMod?"mod":e.inFanclub?"inFanclub":e.tippedTonsRecently?"tippedTonsRecently":e.tippedALotRecently?"tippedALotRecently":e.tippedRecently?"tippedRecently":e.hasTokens?"hasTokens":"defaultUser"}function a(e){return e.isBroadcaster?"#ff6200":e.isMod?"#DC0000":e.inFanclub?"#00ff00":e.tippedTonsRecently?"#ad62e1":e.tippedALotRecently?"#d4a0ff":e.tippedRecently?"#8a98ff":e.hasTokens?"#84c6dc":"#b3b3b3"}function l(e){return e.isBroadcaster?o.R.isBroadcaster:e.isMod?o.R.isMod:e.inFanclub?o.R.inFanClub:e.tippedTonsRecently?o.R.tippedTonsRecently:e.tippedALotRecently?o.R.tippedALotRecently:e.tippedRecently?o.R.tippedRecently:e.hasTokens?o.R.hasTokens:void 0}function h(e){if(!e.isMod&&!e.isBroadcaster&&!e.inFanclub)return e.tippedTonsRecently?o.R.tippedTonsRecentlyDef:e.tippedALotRecently?o.R.tippedALotRecentlyDef:e.tippedRecently?o.R.tippedRecentlyDef:e.hasTokens?o.R.hasTokensDef:void 0}function d(e){e=e.toLowerCase();const t=`${STATIC_URL}gendericons/`;return["m","male"].indexOf(e)>-1?`${t}male.svg`:["f","female"].indexOf(e)>-1?`${t}female.svg`:["t","s","trans"].indexOf(e)>-1?`${t}trans.svg`:["c","couple"].indexOf(e)>-1?`${t}couple.svg`:(error("Could not set menu gender icon. Defaulting to male."),`${t}male.svg`)}function c(){var e;return(null===(e=n.Bm.current.loggedInUser)||void 0===e?void 0:e.username)===n.Aw.getState().room}function u(){return n.Aw.getState().room}!function(e){e.Public="public",e.Private="private",e.DM="sitewidePMs"}(s||(s={}))},2146:(e,t,i)=>{"use strict";function s(e,t){e.style.webkitTransition=t,e.style.transition=t,void 0!==e.style.setProperty&&e.style.setProperty("moz-transition",t)}function n(e){e.style.webkitTransition="",e.style.transition="",void 0!==e.style.removeProperty&&e.style.removeProperty("moz-transition")}function o(e,t){e.style.userSelect=t,e.style.webkitUserSelect=t,e.style.msUserSelect=t,void 0!==e.style.setProperty&&e.style.setProperty("moz-user-select",t)}i.d(t,{PF:()=>o,Ve:()=>s,dI:()=>n})},8006:(e,t,i)=>{"use strict";i.d(t,{U:()=>m,v:()=>g});var s=i(4936),n=i(1474),o=i(9447),r=i(213),a=i(5216),l=i(9332),h=i(2939),d=i(2709),c=i(7407),u=i(90),p=i(4947);const m=25;class g extends d.u{constructor(){super(),this.innerDiv=document.createElement("div"),this.votesSection=document.createElement("div"),this.upContainer=document.createElement("div"),this.downContainer=document.createElement("div"),this.upVotes=document.createElement("span"),this.downVotes=document.createElement("span"),this.thumbsUp=document.createElement("img"),this.thumbsDown=document.createElement("img"),this.thumbsUpActive=document.createElement("img"),this.thumbsDownActive=document.createElement("img"),this.percent=document.createElement("span"),this.roomName="",this.tipsInPast24Hours=0,this.voteInLast90DaysDown=!1,this.voteUpdate=new u.P({hasVoted:!1,voteDirection:void 0},((e,t)=>this.setVoteState(e,t)),(()=>this.onVoteError())),this.listeningForTipUpdates=!1,this.votesSection.style.display="inline-block",this.votesSection.style.verticalAlign="top",this.upContainer.style.display="inline-block",this.upContainer.style.cursor="pointer",this.upContainer.style.verticalAlign="top",this.upVotes.style.margin="0 3px",this.upVotes.style.verticalAlign="top",this.upVotes.dataset.testid="up-votes-count",this.upContainer.appendChild(this.upVotes),this.createThumbsUp(),this.thumbsUp.dataset.testid="thumbs-up-button",this.thumbsUpActive.dataset.testid="thumbs-up-active-button",this.upContainer.appendChild(this.thumbsUp),this.upContainer.appendChild(this.thumbsUpActive),this.votesSection.appendChild(this.upContainer),this.percent.style.margin="0 3px",this.percent.style.verticalAlign="top",this.percent.onclick=()=>(0,c.bT)("SatisfiedClicked"),this.percent.dataset.testid="percent-score",this.votesSection.appendChild(this.percent),this.downContainer.style.display="inline-block",this.downContainer.style.cursor="pointer",this.downContainer.style.verticalAlign="top",this.createThumbsDown(),this.downContainer.appendChild(this.thumbsDown),this.downContainer.appendChild(this.thumbsDownActive),this.downVotes.style.margin="0 3px",this.downVotes.style.verticalAlign="top",this.downVotes.dataset.testid="down-votes-count",this.thumbsDown.dataset.testid="thumbs-down-button",this.thumbsDownActive.dataset.testid="thumbs-down-active-button",this.downContainer.appendChild(this.downVotes),this.votesSection.appendChild(this.downContainer),this.innerDiv.appendChild(this.votesSection),this.element.appendChild(this.innerDiv),this.voteUpdate.setInitialState({hasVoted:!1,voteDirection:void 0}),h.X0.listen((e=>{this.chatConn=e.chatConnection,this.roomName=e.dossier.room,this.tipsInPast24Hours=e.dossier.tipsInPast24Hours,e.dossier.hideSatisfactionScore&&void 0===e.dossier.staffInfo?(this.upVotes.style.display="none",this.percent.style.display="none",this.downVotes.style.display="none"):(this.upVotes.innerText=`${e.dossier.satisfactionScore.upVotes}`,this.percent.innerText=`${e.dossier.satisfactionScore.percent}%`,this.downVotes.innerText=`${e.dossier.satisfactionScore.downVotes}`,this.upVotes.style.display="inline",this.percent.style.display="inline",this.downVotes.style.display="inline",this.percent.className="",e.dossier.satisfactionScore.percent>85?(0,o.fZ)(this.percent,"highPercent"):e.dossier.satisfactionScore.percent>65?(0,o.fZ)(this.percent,"mediumPercent"):(0,o.fZ)(this.percent,"lowPercent")),0===e.dossier.lastVoteInPast24Hours?this.voteUpdate.dispatch({hasVoted:!0,voteDirection:"down"},Promise.resolve(!0)):10===e.dossier.lastVoteInPast24Hours?this.voteUpdate.dispatch({hasVoted:!0,voteDirection:"up"},Promise.resolve(!0)):this.voteUpdate.dispatch({hasVoted:!1,voteDirection:void 0},Promise.resolve(!0)),this.voteInLast90DaysDown=e.dossier.lastVoteInPast90DaysDown,this.tipsInPast24Hours>=m?this.enableVoting():this.disableVoting(),this.listeningForTipUpdates||this.listenForTipUpdates()}))}onVoteError(){}enableVoteMsg(){return p.R.afterTipVoteSatisfactionText(this.roomName,m)}styleThumb(e,t){e.src=t,e.height=15,e.width=15,e.style.height="15px",e.style.width="15px",e.style.verticalAlign="top",e.style.margin="0 3px",e.style.opacity="0.8"}createThumbsUp(){this.styleThumb(this.thumbsUp,`${STATIC_URL}thumbs-up-inactive.svg`),this.styleThumb(this.thumbsUpActive,`${STATIC_URL}thumbs-up-active.svg`),this.upContainer.onclick=e=>{if((0,c.bT)("SatisfiedClicked"),this.stopProp(e),this.tipsInPast24Hours>=m&&(!1===this.hasVoted||"down"===this.voteDirection)){this.triggerComment(!0);const e=(0,a.KF)(`tipping/rate_model/${this.roomName}/`,{rating:"10"}).then((()=>(this.chatConn.event.roomNotice.fire({messages:[[(0,l.H5)(p.R.votedUpText(this.roomName))]],showInPrivateMessage:!0}),!0))).catch((e=>(error("Error rating model",e),!1)));this.voteUpdate.dispatch({hasVoted:!0,voteDirection:"up"},e)}else"up"===this.voteDirection&&this.triggerComment(!1)}}createThumbsDown(){this.styleThumb(this.thumbsDown,`${STATIC_URL}thumbs-down-inactive.svg`),this.styleThumb(this.thumbsDownActive,`${STATIC_URL}thumbs-down-active.svg`),this.downContainer.onclick=e=>{(0,c.bT)("SatisfiedClicked"),this.stopProp(e),this.tipsInPast24Hours>=m&&(!1===this.hasVoted||"up"===this.voteDirection)?(0,r.mf)(p.R.sureVoteDownText(this.roomName),(()=>{this.triggerComment(!0);const e=(0,a.KF)(`tipping/rate_model/${this.roomName}/`,{rating:"0"}).then((()=>{let e=p.R.votedDownText(this.roomName);return this.voteInLast90DaysDown&&(e=p.R.votedDownTextRepeat(this.roomName)),this.chatConn.event.roomNotice.fire({messages:[[(0,l.H5)(e)]],showInPrivateMessage:!0}),!0})).catch((e=>(error("Error rating model",e),!1)));this.voteUpdate.dispatch({hasVoted:!0,voteDirection:"down"},e)})):"down"===this.voteDirection&&this.triggerComment(!1)}}stopProp(e){e.stopPropagation()}enableVoting(){this.thumbsUp.style.opacity="1",this.thumbsDown.style.opacity="1",this.thumbsUp.style.cursor="pointer",this.thumbsDown.style.cursor="pointer"}disableVoting(){this.thumbsUp.style.opacity="0.65",this.thumbsDown.style.opacity="0.65",this.thumbsUp.style.cursor="",this.thumbsDown.style.cursor=""}setUpvoted(){this.hasVoted=!0,this.voteDirection="up",this.thumbsDownActive.style.display="none",this.thumbsDown.style.display="",this.thumbsUpActive.style.display="",this.thumbsUp.style.display="none"}setDownvoted(){this.hasVoted=!0,this.voteDirection="down",this.thumbsDownActive.style.display="",this.thumbsDown.style.display="none",this.thumbsUpActive.style.display="none",this.thumbsUp.style.display=""}setNotvoted(){this.hasVoted=!1,this.voteDirection=void 0,this.thumbsDownActive.style.display="none",this.thumbsDown.style.display="",this.thumbsUpActive.style.display="none",this.thumbsUp.style.display=""}setVoteState(e,t){void 0===e.voteDirection||!1===e.hasVoted?this.setNotvoted():"up"===e.voteDirection?this.setUpvoted():"down"===e.voteDirection&&this.setDownvoted()}listenForTipUpdates(){this.listeningForTipUpdates=!0,n.ew.listen((e=>{this.chatConn.room()===e.roomName&&(e.tokens>=m&&(this.enableVoting(),this.tipsInPast24Hours<m&&this.chatConn.event.roomNotice.fire({messages:[[(0,l.H5)(this.enableVoteMsg())]],showInPrivateMessage:!0})),this.tipsInPast24Hours=e.tokens)})),n.D.listen((e=>{-1!==["privatewatching","privatespying"].indexOf(this.chatConn.status)&&(0,a.Aw)(`tipping/tips_in_last_24/${this.roomName}/`).then((e=>{const t=new s.N6(e.responseText).getNumber("tipped_performer_last_24hrs");n.ew.fire({tokens:t,roomName:this.chatConn.room()})})).catch((()=>{}))}))}}},3957:(e,t,i)=>{"use strict";i.d(t,{Nt:()=>D,PL:()=>s,TR:()=>U,aw:()=>I,eN:()=>A});var s,n=i(4936),o=i(7623),r=i(8861),a=i(1673),l=i(9757),h=i(5411),d=i(1280),c=i(9461),u=i(664),p=i(6784),m=i(5216),g=i(2939),v=i(2709),f=i(5169),y=i(4580),b=i(3124),w=i(7407),C=i(1452),S=i(4947),x=i(1372),T=i(2945);!function(e){e.InTrouble="0",e.Unhappy="1",e.Indifferent="2",e.Smirk="3",e.InLove="4"}(s||(s={}));const P="feedback/sentiment/nps_group/submit/",k="feedback/sentiment/smc/submit/",A="feedback/sentiment/broadcaster/submit/",M="/feedback/sentiment/app_survey/submit/",R=10;var I;!function(e){e[e.SMC=0]="SMC",e[e.Broadcaster=1]="Broadcaster",e[e.NPS_GROUP=2]="NPS_GROUP",e[e.BroadcasterApp=3]="BroadcasterApp"}(I||(I={}));const E=new Map([[I.NPS_GROUP,{forceParam:"force_npsSentimentGroup",contextParam:"show_nps_sentiment_survey_group",endpoint:P,delay:15e3}],[I.SMC,{forceParam:"force_smcSurvey",contextParam:"show_smc_sentiment_survey",endpoint:k,delay:3e5}],[I.Broadcaster,{forceParam:"force_bcastSurvey",contextParam:"show_broadcaster_sentiment_survey",endpoint:A,delay:5e3}],[I.BroadcasterApp,{forceParam:"force_appUsageSurvey",skipBackend:!0,contextParam:"show_app_usage_survey",endpoint:M,delay:2e3}]]);function L(e,t,i){let s;switch(t){case I.NPS_GROUP:s=new N(i,e);break;case I.SMC:s=new _(i);break;case I.BroadcasterApp:s=new F(i,e);break;case I.Broadcaster:const{endpoint:n}=E.get(t);return(0,m.KF)(n,{}).catch(C.yZ),void d.f.show()}document.body.appendChild(s.element),s.show()}function D(e,t){var i,s;const o=null!==(i=null===(s=window.location.pathname.match(/\/([^\/]+)\/?$/))||void 0===s?void 0:s[1])&&void 0!==i?i:"",{forceParam:r,contextParam:a,endpoint:l,delay:h,skipBackend:d}=E.get(t),u=(0,T.JO)(window.location.search)[r];if("1"===u)return void L(e,t,o);if(Boolean(d))return void window.setTimeout((()=>L(e,t,o)),h);const p=["unknown","offline","notconnected","passwordprotected","hidden"];let v;g.X0.listen((e=>{v=e.chatConnection})),window.setTimeout((()=>{if(void 0===v||-1!==p.indexOf(v.status)&&t!==I.Broadcaster)return;const i=v.room();if("2"===u)return void L(e,t,i);let s=l;t===I.NPS_GROUP&&(s=`${P}?source=${c.Bm.current.showNpsSentimentSurveyGroup}`),(0,m.Aw)(s).then((s=>{new n.N6(s.responseText).getBoolean(a)&&L(e,t,i)})).catch(C.yZ)}),h)}let B;function U(){const{forceParam:e}=E.get(I.Broadcaster);"1"===(0,T.JO)(window.location.search)[e]&&D(!1,I.Broadcaster),a.WK.listen((e=>{e?B=Date.now():void 0!==B&&(Date.now()-B)/6e4>=R&&D(!1,I.Broadcaster)}))}class _ extends v.u{constructor(e){super(),this.room=e,this.element=this.createWrapperElement({position:"fixed",width:"288px",bottom:"8px",right:"20px",borderRadius:"4px",overflow:"hidden",zIndex:1004},{borderRadius:"4px",borderStyle:"solid",borderWidth:"4px 1px 1px 1px",paddingLeft:"16px",height:"110px"},{position:"absolute",width:"14px",height:"14px",top:"14px",right:"14px",padding:"2px",cursor:"pointer",zIndex:1},{margin:"-4px -17px"},{position:"relative",width:"288px",height:"4px"}),this.survey=this.createSurvey(),this.closedAction="FeedbackSMCSentimentClosed",this.popupAction="FeedbackSMCSentimentPopup",this.describedAction="FeedbackSMCSentimentDescribed",this.source="smc_sentiment_survey",this.submitEndpoint=k,this.cancelEndpoint="feedback/sentiment/smc/cancel/",this.initialDuration=25,this.confirmationDuration=15}createWrapperElement(e,t,i,s,n){return(0,x.tT)("div",{style:e,colorClass:"cornerSurveyWrapper"},(0,x.tT)("div",{style:t,colorClass:"cornerSurveyContainer",ref:e=>{this.contentContainer=e}},(0,x.tT)("img",{style:i,src:`${STATIC_URL}popup_survey/close.svg`,onClick:()=>{this.close(),(0,w.bT)(this.closedAction)}}),(0,x.tT)("div",{style:s,colorClass:"timerContainer",ref:e=>{this.timerParent=e}},(0,x.tT)("div",{style:n,colorClass:"timer",ref:e=>{this.timer=e}}))))}show(){this.contentContainer.appendChild(this.survey),this.setTimer(this.initialDuration,!0),(0,w.bT)(this.popupAction)}close(){this.contentContainer.contains(this.survey)&&(0,m.KF)(this.cancelEndpoint,{}).catch(C.yZ),null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element)}submit(e){this.selectedSentiment=e;const t={rating:e,room_user:this.room,url:window.location.href};(0,m.KF)(this.submitEndpoint,t).catch(C.yZ),this.contentContainer.removeChild(this.survey),this.contentContainer.appendChild(this.createConfirmation()),this.setTimer(this.confirmationDuration,!1)}createSurvey(){return this.createSurveyElement({position:"relative",paddingTop:"16px",fontSize:"14px",width:"245px"},{position:"relative",padding:"16px 0px 11px 0px"})}createSurveyElement(e,t){return(0,x.tT)("div",{colorClass:"survey"},(0,x.tT)("div",{style:e,colorClass:"title"},S.R.howIsSmcDoingToday),(0,x.tT)("div",{style:t},this.createEmoteDiv(s.InTrouble),this.createEmoteDiv(s.Unhappy),this.createEmoteDiv(s.Indifferent),this.createEmoteDiv(s.Smirk),this.createEmoteDiv(s.InLove)))}createEmoteDiv(e){return this.createEmoteDivElement({position:"relative",display:"inline-block",width:"40px",height:"40px",boxSizing:"border-box",marginRight:"8px",borderRadius:"4px",borderStyle:"solid",borderWidth:"1px",cursor:"pointer"},{position:"relative",width:"24px",height:"24px",top:"7px",left:"7px"},e)}createEmoteDivElement(e,t,i){return(0,x.tT)("div",{style:e,colorClass:"emoteContainer",onClick:()=>{this.submit(i)}},(0,x.tT)("div",{style:t},(0,u.S)(i)))}createConfirmation(){return this.createConfirmationElement({position:"relative",paddingTop:"16px",fontSize:"12px"},{display:"block",paddingBottom:"12px",fontSize:"12px"})}createConfirmationElement(e,t){return(0,x.tT)("div",{colorClass:"confirmation"},(0,x.tT)("div",{style:e,colorClass:"title"},S.R.yourFeedbackHasBeenSent),(0,x.tT)("a",{href:"#",style:t,colorClass:"feedbackLink",onClick:()=>{this.close(),h.E.fire({source:this.source,sentiment:this.selectedSentiment}),(0,w.bT)(this.describedAction)}},S.R.describeYourIssues))}setTimer(e,t){this.timer.classList.remove("timerBar25s"),this.timer.classList.remove("timerBar15s"),this.timer.classList.remove("timerBar7s"),this.timer.classList.add(`timerBar${e}s`),t?this.element.classList.add("pauseOnHover"):this.element.classList.remove("pauseOnHover"),this.timerParent.removeChild(this.timer),this.timer=this.timer.cloneNode(),this.timerParent.appendChild(this.timer),(0,o.lT)()||(0,o._6)()?window.setTimeout((()=>{this.close()}),1e3*e+200):(0,p.wu)("animationend",this.timer,(()=>{window.setTimeout((()=>{this.close()}),200)}))}}class F extends v.u{constructor(e,t){super(),this.room=e,this.isMobile=t,this.popupAction="FeedbackAppUsageSurveyShown",this.source="app_usage_survey",this.cancelEndpoint="feedback/sentiment/app_survey/cancel/",this.submitEndpoint=M,this.element=this.createWrapperElement(this.isMobile),this.survey=document.createElement("div"),new(l.c.get("Survey"))({onSubmit:(e,t)=>this.submit(e,t),closeModal:e=>this.close(e),type:this.source},this.survey)}createWrapperElement(e){return(0,x.tT)("div",{colorClass:"surveyWrapper",className:e?"surveyMobile":"",ref:e=>{this.contentContainer=e}})}show(){this.contentContainer.appendChild(this.survey),(0,w.bT)(this.popupAction,{source:this.source,room_user:this.room})}close(e){const{skipAction:t,hasData:i}=e;t||(0,m.KF)(this.cancelEndpoint,{room_user:this.room,hasData:null!=i&&i?"yes":"no"}).catch(C.yZ),null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element)}submit(e,t){const i=new FormData;e.forEach((e=>{i.append("responses",e)})),t.forEach((e=>{i.append("prompts",e)})),i.append("source",this.source),i.append("url",document.location.href),i.append("csrfmiddlewaretoken",(0,r.I7)("csrftoken"));const s=new FormData;s.append("room_user",this.room),s.append("url",document.location.href),s.append("source",this.source),(0,m.KF)(this.submitEndpoint,s).catch(C.yZ),(0,m.KF)("/feedback/submit/",i).catch(C.yZ)}}class N extends v.u{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.room=e,this.closedAction="FeedbackNPSClosed",this.popupAction="FeedbackNPSPopup",this.source=c.Bm.current.showNpsSentimentSurveyGroup,this.cancelEndpoint="feedback/sentiment/nps_group/cancel/",this.submitEndpoint=P;const i=e=>t&&["bio","moreRooms","roomMenu"].includes(e);this.element=this.createWrapperElement(t),i(f.S.currentTab)&&(this.element.style.bottom="5px"),this.survey=document.createElement("div"),new(l.c.get("NPSSentimentSurvey"))({onSubmit:(e,t)=>this.submit(e,t),closeModal:()=>this.close()},this.survey),t&&(b.DQ.listen((()=>{(0,b.K$)()?this.showElement():this.hideElement()})),y.qb.listen((e=>{i(e)?this.element.style.bottom="5px":this.element.style.bottom="74px"})),y.f6.listen((()=>{if(this.isOpen){const e=document.querySelector(".inputAmt.tipAmountInput");e&&window.setTimeout((()=>e.blur()),50)}})))}createWrapperElement(e){return(0,x.tT)("div",{colorClass:"npsSurveyWrapper",className:e?"npsMobile":"",ref:e=>{this.contentContainer=e}})}show(){if(this.isOpen=!0,this.contentContainer.appendChild(this.survey),(0,w.bT)(this.popupAction,{source:this.source}),this.contentContainer.contains(this.survey)){const e={source:this.source};(0,m.KF)(this.cancelEndpoint,e).catch(C.yZ)}}close(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isOpen=!1,e||(0,w.bT)(this.closedAction,{source:this.source}),null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element)}submit(e,t){const i=new FormData;i.append("rating",e[0]),e.forEach((e=>{i.append("responses",e)})),t.forEach((e=>{i.append("prompts",e)})),i.append("source",this.source),i.append("url",document.location.href),i.append("csrfmiddlewaretoken",(0,r.I7)("csrftoken"));const s=new FormData;s.append("rating",e[0]),s.append("room_user",this.room),s.append("url",document.location.href),s.append("source",this.source),(0,m.KF)(this.submitEndpoint,s).catch(C.yZ),(0,m.KF)("/feedback/submit/",i).catch(C.yZ),this.close(!0)}}},7258:(e,t,i)=>{"use strict";i.d(t,{J:()=>m,V:()=>p});var s=i(4936),n=i(7623),o=i(9461),r=i(7254),a=i(6784),l=i(6657),h=i(6066),d=i(2939),c=i(4693),u=i(9586);class p extends l.c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(e),this.config=e,this.isPM=t,this.cacheTTL=3e5,this.maxSearchSlugLength=100,this.filterAfterSize=1,this.maxOptionLength=50,this.element.dataset.testid="shortcodeAutocompleteModal",this.list.dataset.testid="shortcodeAutocompleteList",this.listenerGroup.add(d.X0.listen((e=>{this.room=e.dossier.room})))}handleKeydown(e){if(this.isPM)error("Shortcodes are not implemented for PMs"),e.preventDefault(),e.stopPropagation();else if(this.visible){var t,i;"ArrowUp"===e.code&&(e.preventDefault(),this.scrollList(!0)),"ArrowDown"===e.code&&(e.preventDefault(),this.scrollList(!1));const s=null!==(t=null===(i=window.getSelection())||void 0===i?void 0:i.toString())&&void 0!==t?t:"",n="Space"===e.code&&this.items.some((e=>e.slug.includes(`${this.searchSlug} `)));(""===s||n?["ArrowRight","Enter","Tab"]:["ArrowRight","Enter","Space","Tab"]).includes(e.code)&&(e.preventDefault(),e.stopPropagation(),this.hide(),o.Bm.current.isMobile&&"Enter"===e.code||this.finalizeSelection()),"Escape"!==e.code&&"ArrowLeft"!==e.code||(e.preventDefault(),this.hide(),this.deleteHighlightedSuffix()),"Space"===e.code&&s.includes(" ")&&(e.preventDefault(),e.stopPropagation(),this.finalizeSelection(),this.hide())}}initData(){super.initData()}initUI(){super.initUI(),this.list.style.width=""}promptRegex(){return"\\[cb"}searchSlugRegex(){return'[:][\\w\\s\\d="!]*]?'}getDataEndpoint(){return`chatmessages/shortcode_autocomplete/?slug=${this.searchSlug}`}show(){super.show()}getCache(){return void 0===this.cache&&(this.cache=new c.zt(this.filterAfterSize,this.cacheTTL)),this.cache}normalizedSearchSlug(){return this.searchSlug.toLowerCase()}parseResponse(e){var t;const i=new s.N6(e),n=null!==(t=i.getList("shortcodes"))&&void 0!==t?t:[],a=[];for(const e of n){var l;const t=e.getString("slug"),i=e.getString("sc");if(""===t)continue;const s=(null===(l=o.Bm.current.loggedInUser)||void 0===l?void 0:l.username)===this.room;(i!==r.AJ.Tip||s)&&a.push({slug:t,element:g})}return i.logUnusedDebugging("parseShortcodegAutocompleteResponse"),a}updateListDOM(){super.updateListDOM(),this.repositionChildren()}isSpecialFunctionKey(e){return["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Enter","Escape","Tab"].includes(e.code)}}class m extends p{constructor(e){super({inputElement:e,leftOffset:0,rightOffset:0},arguments.length>1&&void 0!==arguments[1]&&arguments[1]),this.mobileMixin=new h.v({autocompleteConfig:this.config,element:this.element,list:this.list,overlayClick:this.overlayClick,listenerGroup:this.listenerGroup,isVisible:()=>this.visible,hide:()=>this.hide(),pickItem:(e,t)=>this.pickItem(e,t),hideOnSpace:!1}),(0,n.OF)()||(0,a.wu)("keydown",this.config.inputElement.element,(e=>{this.visible&&this.config.inputElement.setCaretToEndOfSelection()}))}initUI(){super.initUI(),this.element.style.border="",this.element.style.fontSize="14px",this.element.style.lineHeight="26px",this.element.style.boxShadow="0px 0px 8px rgba(0, 0, 0, 0.32)",this.element.style.marginLeft="7px",this.element.style.boxSizing="content-box",this.list.style.width="",(0,u.H)(this.list)}repositionChildren(){}appendItem(e,t){const i=super.appendItem(e,t);return this.mobileMixin.customizeItem(i,t),i}show(){this.mobileMixin.onShow(),super.show()}}const g=document.createElement("div")},3320:(e,t,i)=>{"use strict";i.d(t,{A:()=>l});var s=i(9447),n=i(6784),o=i(1519),r=i(2709),a=i(8423);class l extends r.u{constructor(e){super(),this.config=e,this.value=0,this.valueChanged=new a.c_("valueChanged"),this.valueChangeStart=new a.c_("valueChangeStart"),this.valueChangeEnd=new a.c_("valueChangeEnd"),(0,s.fZ)(this.element,"slider"),this.element.style.position="relative",this.element.style.overflow="visible",this.element.style.cursor="pointer",void 0!==e.barWidth?this.element.style.width=`${e.barWidth+e.handleDiameter}px`:this.element.style.width="90%",this.element.style.height=`${e.handleDiameter}px`,this.barHeight=void 0!==e.barHeight?e.barHeight:2*Math.round(.25*e.handleDiameter/2),void 0!==e.barImage?(this.emptyBar=document.createElement("img"),this.emptyBar.src=e.barImage,this.emptyBar.style.width="100%",this.emptyBar.style.height="100%",this.element.appendChild(this.emptyBar)):(this.emptyBar=document.createElement("div"),this.emptyBar.style.position="absolute",this.emptyBar.style.boxSizing="border-box",void 0!==e.emptyBarColor?this.emptyBar.style.backgroundColor=e.emptyBarColor:(this.emptyBar.style.backgroundColor="#333333",this.emptyBar.style.backgroundColor="rgba(255, 255, 255, 0.2)"),this.emptyBar.style.top=.5*(e.handleDiameter-this.barHeight)+"px",this.emptyBar.style.height=`${this.barHeight}px`,this.emptyBar.style.width="100%",this.element.appendChild(this.emptyBar)),void 0!==e.barImage?(this.filledBar=document.createElement("div"),this.filledBar.style.visibility="none"):(this.filledBar=document.createElement("div"),this.filledBar.style.position="absolute",this.filledBar.style.boxSizing="border-box",this.filledBar.style.backgroundColor=void 0!==e.filledBarColor?e.filledBarColor:"#ffffff",this.filledBar.style.top=.5*(e.handleDiameter-this.barHeight)+"px",this.filledBar.style.height=`${this.barHeight}px`,this.element.appendChild(this.filledBar)),void 0!==e.handleImage?(this.handle=document.createElement("img"),this.handle.style.position="absolute",this.handle.style.top="0",this.handle.src=e.handleImage,this.handle.style.height=`${e.handleDiameter}px`,this.handle.style.width=`${e.handleDiameter}px`,this.handle.style.cursor="grab",this.handle.style.left="0px",this.element.appendChild(this.handle)):(this.handle=document.createElement("div"),this.handle.style.position="absolute",this.handle.style.top="0",this.handle.style.backgroundColor=void 0!==e.handleColor?e.handleColor:"#ffffff",this.handle.style.borderRadius="50%",this.handle.style.height=`${e.handleDiameter}px`,this.handle.style.height=`${e.handleDiameter}px`,this.handle.style.width=`${e.handleDiameter}px`,this.handle.style.cursor="grab",this.element.appendChild(this.handle)),this.valueUpdater=new o.a((()=>{this.valueChanged.fire(this.value)}),{bounceLimitMS:100,debounceType:2}),this.setupListeners((e=>{this.handleMoveEvent(e,e.clientX)}),"mousedown","mousemove","mouseup"),this.setupListeners((e=>{if(1===e.touches.length){const t=e.touches.item(0);null!==t&&this.handleMoveEvent(e,t.clientX)}}),"touchstart","touchmove","touchend"),(0,n.wu)("mousedown",this.element,(e=>{this.handleMoveEvent(e,e.clientX),this.handle.dispatchEvent(function(e,t){try{return new MouseEvent(e,t)}catch{const i=document.createEvent("MouseEvent");return i.initMouseEvent(e,void 0!==t.bubbles&&t.bubbles,void 0!==t.cancelable&&t.cancelable,window,0,void 0!==t.screenX?t.screenX:0,void 0!==t.screenY?t.screenY:0,void 0!==t.clientX?t.clientX:0,void 0!==t.clientY?t.clientY:0,void 0!==t.ctrlKey&&t.ctrlKey,void 0!==t.altKey&&t.altKey,void 0!==t.shiftKey&&t.shiftKey,void 0!==t.metaKey&&t.metaKey,void 0!==t.button?t.button:0,void 0!==t.relatedTarget?t.relatedTarget:null),i}}(e.type,e))}))}setupListeners(e,t,i,s){(0,n.wu)(t,this.handle,(t=>{this.valueChangeStart.fire(this.value),this.handle.style.cursor="",document.body.style.cursor="grabbing",t.preventDefault(),t.stopPropagation(),(0,n.wu)(i,document,e,!0);const o=t=>{this.valueChangeEnd.fire(this.value),this.handle.style.cursor="grab",document.body.style.cursor="",t.preventDefault(),(0,n.Pf)(i,document,e,!0),(0,n.Pf)(s,document,o,!0)};(0,n.wu)(s,document,o,!0)}))}handleMoveEvent(e,t){const i=this.element.getBoundingClientRect().left;if(void 0!==this.config.barWidth){const e=Math.max(.5*this.config.handleDiameter,Math.min(this.config.barWidth+.5*this.config.handleDiameter,t-i));this.setValue((e-.5*this.config.handleDiameter)*(100/this.config.barWidth))}else{const e=Math.max(.5*this.config.handleDiameter,Math.min(this.element.offsetWidth+.5*this.config.handleDiameter,t-i));this.setValue((e-.5*this.config.handleDiameter)*(100/this.element.offsetWidth))}this.valueUpdater.callFunc(),e.stopPropagation()}getValue(){return this.value}setValue(e){void 0!==this.config.barWidth?(this.handle.style.left=e*this.config.barWidth/100+"px",this.filledBar.style.width=e*this.config.barWidth/100+"px"):(this.handle.style.left=`calc(${e}% - ${this.config.handleDiameter*e/100}px)`,this.filledBar.style.width=`${e}%`),this.value=e}hideHandle(){this.handle.style.display="none"}showHandle(){this.handle.style.display="block"}handleResize(){void 0===this.config.barWidth&&(this.handle.style.left=`calc(${this.value}% - ${this.config.handleDiameter*this.value/100}px)`,this.filledBar.style.width=`${this.value}%`)}}},7569:(e,t,i)=>{"use strict";i.d(t,{PR:()=>d,fM:()=>u,gW:()=>n});var s,n,o=i(20),r=i(9461),a=i(7254),l=i(4947);!function(e){e[e.ChatMessage=0]="ChatMessage",e[e.TipRequest=1]="TipRequest",e[e.ToggleDebugMode=2]="ToggleDebugMode",e[e.Shortcode=3]="Shortcode",e[e.Invalid=0]="Invalid"}(n||(n={}));const h={"/tip":function(e){const t={};if(e.length>0){const i=Number(e[0]);isNaN(i)?t.message=e.join(" "):(e.shift(),t.amount=i,e.length>0&&(t.message=e.join(" ")))}return{messageData:t,messageType:n.TipRequest}},"/debug":function(){return{messageType:n.ToggleDebugMode}}};function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("/"===e.trim().charAt(0)){const t=function(e){const t=e.match(/(\S+)/g);if(null!==t){const e=t.shift();if(Boolean(Object.prototype.hasOwnProperty.call(h,e)))return h[e](t)}return{messageType:n.Invalid}}(e);if(t.messageType!==n.Invalid)return t}else if(u.isShortcodeSyntax(e,t))return u.parseShortcodeMessage(e);return{messageType:n.ChatMessage,messageData:e}}function c(e){const t=new RegExp(/^(\d{1,4})$/),i=new RegExp(/^(\d{1}[\.,]\d{3})$/),s=new RegExp(/^[\.,]\d{1,2}$/),n=t.test(e)||i.test(e);return!s.test(e)&&n}class u{static getCode(e){const t=e.match(u.codeRegex);if(null!==t)switch(t[1].toLowerCase()){case a.AJ.Signup:return a.AJ.Signup;case a.AJ.Follow:return a.AJ.Follow;case a.AJ.Fanclub:return a.AJ.Fanclub;case a.AJ.Supporter:return a.AJ.Supporter;case a.AJ.Tip:return a.AJ.Tip;case a.AJ.Help:return a.AJ.Help;default:return}}static getShortcodeTitle(e){var t,i;const s=e.code,n=null===(t=e.msg)||void 0===t?void 0:t.trim(),o=null===(i=e.amt)||void 0===i?void 0:i.toString();return s===a.AJ.Tip&&void 0!==o&&void 0!==n?`[cb:${s} amount=${o} message="${n}"]`:`[cb:${s}]`}static isShortcodePrefix(e){return e.toLowerCase()===u.shortcodePrefix}static hasShortcodes(e){return null!==e.match(u.shortcodeRegex)}static isShortcodeSyntax(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return!o.Xw.includes(t)&&null!==e.match(this.shortcodeRegex)}static isValidTipShortcodeSyntax(e){const t=new RegExp(/\[cb:tip amount=([\d,.]*) message=(("[^\]"“”]+")|(""|“”)|(“[^\]"“”]+”))\]/i),i=new RegExp(/\[cb:tip message=(("[^\]"“”]+")|(""|“”)|(“[^\]"“”]+”)) amount=([\d,.]*)\]/i);return t.test(e)||i.test(e)}static pullRoomMetadata(){const e=r.Aw.getState(),{hasFanClub:t,room:i,userName:s}=e;return{hasFanClub:t,isBroadcaster:s===i}}static isValidShortcode(e){return null!==e.match(u.shortcodeStrictRegexA)||null!==e.match(u.shortcodeStrictRegexB)}static isValidTipShortcode(e){if(!u.isValidTipShortcodeSyntax(e))return!1;const t=e.match(u.amountRegex);if(null!==t&&!c(t[0].split("=")[1]))return!1;const i=e.match(u.messageStrictRegex);return null===i||!i[0].split("=")[1].match(u.urlRegex)}static isValidShortcodeForRoom(e){const{hasFanClub:t,isBroadcaster:i}=u.pullRoomMetadata();if(!u.isValidShortcode(e))return!1;const s=u.getCode(e);switch(s){case a.AJ.Tip:return u.isValidTipShortcode(e)&&i;case a.AJ.Fanclub:return/(\[cb:fanclub\])/i.test(e)&&t;case a.AJ.Follow:case a.AJ.Supporter:case a.AJ.Signup:case a.AJ.Help:return new RegExp(`\\[cb:${s}\\]`,"i").test(e);default:return!1}}static isValidShortcodeMessage(e){var t;const i=e.match(u.shortcodeRegex);return null!==(t=null==i?void 0:i.every((e=>u.isValidShortcodeForRoom(e))))&&void 0!==t&&t}static getShortcodeForPart(e,t){const i=u.getCode(e);if(void 0!==i)switch(i){case a.AJ.Tip:if(!u.isValidTipShortcodeSyntax(e))break;return t.find((t=>{if(t.code!==a.AJ.Tip)return!1;const i=t.amt===u.getAmountWithoutSeparators(e),s=t.msg===u.getMessageContents(e);return i&&s}));default:return t.find((e=>e.code===i))}}static getAmountWithoutSeparators(e){const t=e.match(u.amountRegex);if(null!==t){const e=t[0].split("=")[1];if(c(e))return Number(e.replace(/\./gi,"").replace(/,/gi,""))}return 0}static getMessageContents(e){var t;const i=e.match(u.messageStrictRegex);return null!==i&&void 0!==(null===(t=i.groups)||void 0===t?void 0:t.message)?i.groups.message.trim():""}static parseShortcodeMessage(e){const t=[];if(!u.isValidShortcodeMessage(e))return{messageType:n.Shortcode,shortcodes:[],message:e};const i=e.match(u.shortcodeRegex);if(null!==i)for(const e of i){const i=u.getCode(e);if(void 0!==i)if(i===a.AJ.Tip){const i=e.match(u.amountRegex),s=e.match(u.messageStrictRegex);let n="";if(s&&s.groups&&(n=s.groups.message),null!==i&&null!==s){const e=i[0].split("=")[1].replace(/\./gi,"").replace(/,/gi,"");t.push({code:a.AJ.Tip,amt:Number(e),msg:n})}}else t.push({code:i})}return t.length>5?{messageType:n.Shortcode,shortcodes:[],message:e}:(e=e.replace(this.shortcodeNormalizeRegex,(e=>e.toLowerCase())),{messageType:n.Shortcode,shortcodes:t,message:e.trim()})}static errorBehindShortcode(e){const{hasFanClub:t,isBroadcaster:i}=u.pullRoomMetadata(),s=e.match(u.shortcodeRegex);if(null!==s){if(s.length>5)return l.R.tooManyShortcodes;for(const n of s){if(!t&&new RegExp(/\[cb:fanclub\]/i).test(e))return l.R.noFanClub;if(u.getCode(n)===a.AJ.Tip){const e=u.errorBehindTipShortcode(n,i);if(void 0!==e)return e}}}return l.R.shortcodeEnteredError(e)}static hasTipArguments(e){let t="",i=!1;for(const s of e)"'"!==s&&"‘"!==s&&"’"!==s&&'"'!==s&&"“"!==s&&"”"!==s?i||(t+=s):i=!i;return new RegExp(/amount=/).test(t)&&new RegExp(/message=/).test(t)}static hasErrorInMessageArg(e){return!u.messageStrictRegex.test(e)||u.messageRegexSingleQuote.test(e)||u.messageInvalidQuotesRegex.test(e)}static errorBehindTipShortcode(e,t){if(!t)return l.R.tipNotBroadcaster;if(!u.hasTipArguments(e)||!u.amountAnyRegex.test(e)||!u.messageAnyRegex.test(e))return l.R.tipShortcodeArgsMissing;const i=e.match(u.amountAnyRegex);return null===i||c(i[0].split("=")[1])?u.hasErrorInMessageArg(e)?l.R.tipShortcodeMessageInDoubleQuotes:null!==e.match(u.urlRegex)?l.R.shortcodeURLNotAllowedInTip:void 0:l.R.inValidTipAmount}}(s=u).shortcodePrefix="[cb:",s.shortcodeSuffix="]",s.shortcodeRegex=/(\[cb:(?:[^\]]){0,100}\])/gi,s.nonGlobalShortcodeRegex=/(\[cb:(?:[^\]]){0,100}\])/i,s.shortcodeStrictRegexA=/\[cb:([a-z]+)((\s[a-z]+?=[\d,\.]*){0,1})((\s[a-z]+?=("|“)([^\]"“”]*?)("|”))){0,1}\]/gi,s.shortcodeStrictRegexB=/\[cb:([a-z]+)((\s[a-z]+?=("|“)([^\]"“”]*?)("|”))){0,1}((\s[a-z]+?=[\d,\.]*){0,1})\]/gi,s.shortcodeNormalizeRegex=/\[cb:(follow|signup|fanclub|supporter|help)\]/gi,s.amountAnyRegex=/amount=[^\s\]]+/i,s.messageAnyRegex=/message=[^\s\]]+/i,s.urlRegex=/\b(?:https?:\/\/)?(?:www\.)?[^\/\s]+\.[a-zA-Z]{2,}\b/gi,s.messageRegexSingleQuote=/(message=)(?:['|‘|’](?:[^\]"“”]+)['|‘|’]|['|‘|’](?:[^\]"“”]+)["|“|”]|["|“|”](?:[^\]"“”]+)['|‘|’])/i,s.messageInvalidQuotesRegex=/(message=)(?:"[^\]"“”]*[“”])|(?:“[^\]"“”]*["“])/i,s.amountRegex=/amount=([,.\d]*)/i,s.messageStrictRegex=/(message=)("|“)(?<message>[^\]"“”]*)("|”)/i,s.codeRegex=/\[cb:([^\s\]]+)(?:[^\]]*)\]/i},7176:(e,t,i)=>{"use strict";i.d(t,{Am:()=>n,DU:()=>r,Kj:()=>a,fh:()=>o,sx:()=>l});var s=i(1372);function n(){return(0,s.tT)("div",{style:{display:"inline-block"},colorClass:["noteIconSvg"]},(0,s.tT)("svg",{style:{height:"1.2em",width:"1.2em"},viewBox:"0 0 12 12",xmlns:"https://www.w3.org/2000/svg"},(0,s.tT)("path",{d:"M5.5 2.00002H2C1.73478 2.00002 1.48043 2.10537 1.29289 2.29291C1.10536 2.48044 1 2.7348 1 3.00002V10C1 10.2652 1.10536 10.5196 1.29289 10.7071C1.48043 10.8947 1.73478 11 2 11H9C9.26522 11 9.51957 10.8947 9.70711 10.7071C9.89464 10.5196 10 10.2652 10 10V6.50002","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),(0,s.tT)("path",{d:"M9.25 1.24985C9.44891 1.05094 9.7187 0.939194 10 0.939194C10.2813 0.939194 10.5511 1.05094 10.75 1.24985C10.9489 1.44877 11.0607 1.71855 11.0607 1.99985C11.0607 2.28116 10.9489 2.55094 10.75 2.74985L6 7.49985L4 7.99985L4.5 5.99985L9.25 1.24985Z","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})))}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"16px";return(0,s.tT)("a",{className:"closeBtnContainer",style:{height:e,borderRadius:"5px",color:"inherit",display:"inline-block",cursor:"pointer"}},(0,s.tT)("svg",{style:{width:e,height:e},width:"12",height:"12",viewBox:"0 0 12 12"},(0,s.tT)("path",{d:"M7.15006 6.08867C7.13842 6.07705 7.12919 6.06326 7.12288 6.04807C7.11658 6.03289 7.11334 6.01661 7.11334 6.00017C7.11334 5.98372 7.11658 5.96744 7.12288 5.95226C7.12919 5.93707 7.13842 5.92328 7.15006 5.91167L11.7816 1.28067C11.9222 1.13984 12.0011 0.94891 12.001 0.749887C12.0008 0.550864 11.9216 0.360048 11.7808 0.219417C11.64 0.0787862 11.4491 -0.000140462 11.25 1.87661e-07C11.051 0.000140838 10.8602 0.0793373 10.7196 0.220167L6.08856 4.84917C6.07695 4.86081 6.06316 4.87004 6.04797 4.87634C6.03278 4.88265 6.0165 4.88589 6.00006 4.88589C5.98362 4.88589 5.96734 4.88265 5.95215 4.87634C5.93697 4.87004 5.92317 4.86081 5.91156 4.84917L1.28056 0.220167C1.21093 0.150501 1.12826 0.0952322 1.03726 0.0575166C0.946271 0.0198009 0.84874 0.000376944 0.75024 0.00035373C0.551311 0.000306846 0.360511 0.0792862 0.219814 0.219917C0.0791162 0.360548 4.6905e-05 0.551311 2.08617e-08 0.75024C-4.68632e-05 0.94917 0.0789325 1.13997 0.219564 1.28067L4.85006 5.91167C4.8617 5.92328 4.87094 5.93707 4.87724 5.95226C4.88354 5.96744 4.88679 5.98372 4.88679 6.00017C4.88679 6.01661 4.88354 6.03289 4.87724 6.04807C4.87094 6.06326 4.8617 6.07705 4.85006 6.08867L0.219564 10.7202C0.14993 10.7898 0.0947003 10.8725 0.0570276 10.9635C0.0193548 11.0546 -2.31938e-05 11.1521 2.08617e-08 11.2506C4.6905e-05 11.4495 0.0791162 11.6403 0.219814 11.7809C0.28948 11.8505 0.372179 11.9058 0.46319 11.9435C0.554201 11.9811 0.651741 12.0005 0.75024 12.0005C0.94917 12.0004 1.13993 11.9214 1.28056 11.7807L5.91156 7.14917C5.92317 7.13753 5.93697 7.12829 5.95215 7.12199C5.96734 7.11569 5.98362 7.11244 6.00006 7.11244C6.0165 7.11244 6.03278 7.11569 6.04797 7.12199C6.06316 7.12829 6.07695 7.13753 6.08856 7.14917L10.7196 11.7807C10.8602 11.9214 11.051 12.0004 11.2499 12.0005C11.4488 12.0005 11.6396 11.9215 11.7803 11.7809C11.921 11.6403 12.0001 11.4495 12.0001 11.2506C12.0002 11.0517 11.9212 10.8609 11.7806 10.7202L7.15006 6.08867Z"})))}function r(){return(0,s.tT)("div",{style:{display:"inline-block"}},(0,s.tT)("svg",{style:{height:"1em"},width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},(0,s.tT)("path",{d:"M3.482 7.91071C3.45013 7.89982 3.4223 7.87953 3.40219 7.85252C3.38208 7.8255 3.37062 7.79303 3.36933 7.75937C3.36827 7.72563 3.37736 7.69233 3.39542 7.66381C3.41349 7.63528 3.4397 7.61284 3.47067 7.59937C3.92472 7.40632 4.29812 7.06231 4.52765 6.62556C4.75718 6.18882 4.82875 5.68617 4.73025 5.20272C4.63174 4.71927 4.3692 4.2847 3.98708 3.97259C3.60495 3.66048 3.12672 3.48999 2.63333 3.48999C2.13995 3.48999 1.66171 3.66048 1.27959 3.97259C0.897467 4.2847 0.63493 4.71927 0.536421 5.20272C0.437912 5.68617 0.509482 6.18882 0.739017 6.62556C0.968551 7.06231 1.34195 7.40632 1.796 7.59937C1.82712 7.61253 1.85351 7.63484 1.87166 7.66334C1.88982 7.69184 1.89888 7.72518 1.89765 7.75895C1.89642 7.79271 1.88496 7.82531 1.86478 7.85241C1.8446 7.87952 1.81666 7.89985 1.78467 7.91071C1.26465 8.08858 0.813146 8.4244 0.4932 8.87127C0.173253 9.31815 0.000829249 9.85377 0 10.4034L0 12.3787C0 12.4661 0.0346975 12.5498 0.0964595 12.6116C0.158221 12.6733 0.241989 12.708 0.329333 12.708H0.916667C0.95808 12.7081 0.997978 12.7236 1.02847 12.7516C1.05896 12.7797 1.07783 12.8181 1.08133 12.8594L1.318 15.6987C1.32486 15.7809 1.36241 15.8576 1.42317 15.9134C1.48394 15.9692 1.56348 16.0002 1.646 16H3.62133C3.70374 16 3.78311 15.969 3.84374 15.9132C3.90436 15.8574 3.94181 15.7808 3.94867 15.6987L4.186 12.8594C4.18935 12.8182 4.20807 12.7797 4.23846 12.7517C4.26884 12.7237 4.30866 12.7081 4.35 12.708H4.938C4.98122 12.708 5.02401 12.6995 5.06393 12.683C5.10385 12.6664 5.14011 12.6421 5.17064 12.6115C5.20117 12.5809 5.22536 12.5446 5.24184 12.5047C5.25832 12.4647 5.26675 12.4219 5.26667 12.3787V10.4034C5.26604 9.85372 5.09369 9.31801 4.77372 8.8711C4.45374 8.42418 4.00213 8.08841 3.482 7.91071Z"}),(0,s.tT)("path",{d:"M14.2154 7.91071C14.1834 7.89985 14.1555 7.87952 14.1353 7.85241C14.1151 7.82531 14.1036 7.79271 14.1024 7.75895C14.1012 7.72518 14.1102 7.69184 14.1284 7.66334C14.1466 7.63484 14.1729 7.61253 14.2041 7.59937C14.6581 7.40632 15.0315 7.06231 15.261 6.62556C15.4906 6.18882 15.5622 5.68617 15.4636 5.20272C15.3651 4.71927 15.1026 4.2847 14.7205 3.97259C14.3384 3.66048 13.8601 3.48999 13.3667 3.48999C12.8733 3.48999 12.3951 3.66048 12.013 3.97259C11.6309 4.2847 11.3683 4.71927 11.2698 5.20272C11.1713 5.68617 11.2429 6.18882 11.4724 6.62556C11.7019 7.06231 12.0753 7.40632 12.5294 7.59937C12.5605 7.61259 12.5868 7.63496 12.6049 7.6635C12.623 7.69204 12.632 7.72541 12.6307 7.75918C12.6294 7.79295 12.6179 7.82553 12.5977 7.85259C12.5774 7.87965 12.5494 7.89992 12.5174 7.91071C11.9974 8.08861 11.546 8.42445 11.2262 8.87134C10.9064 9.31822 10.7341 9.85383 10.7334 10.4034V12.3787C10.7333 12.4219 10.7417 12.4647 10.7582 12.5047C10.7747 12.5446 10.7989 12.5809 10.8294 12.6115C10.86 12.6421 10.8962 12.6664 10.9361 12.683C10.9761 12.6995 11.0188 12.708 11.0621 12.708H11.6501C11.6914 12.7081 11.7312 12.7237 11.7616 12.7517C11.792 12.7797 11.8107 12.8182 11.8141 12.8594L12.0514 15.6987C12.0583 15.7808 12.0957 15.8574 12.1563 15.9132C12.217 15.969 12.2963 16 12.3787 16H14.3541C14.4366 16.0002 14.5161 15.9692 14.5769 15.9134C14.6377 15.8576 14.6752 15.7809 14.6821 15.6987L14.9187 12.8594C14.9222 12.8181 14.9411 12.7797 14.9716 12.7516C15.0021 12.7236 15.042 12.7081 15.0834 12.708H15.6707C15.7581 12.708 15.8418 12.6733 15.9036 12.6116C15.9654 12.5498 16.0001 12.4661 16.0001 12.3787V10.4034C15.9992 9.85377 15.8268 9.31815 15.5069 8.87127C15.1869 8.4244 14.7354 8.08858 14.2154 7.91071Z"}),(0,s.tT)("path",{d:"M8.78198 3.75737C8.75083 3.74636 8.72367 3.7263 8.70399 3.69976C8.68431 3.67323 8.67299 3.64142 8.67148 3.60842C8.66998 3.57541 8.67836 3.54271 8.69555 3.51449C8.71274 3.48628 8.73796 3.46384 8.76798 3.45004C9.14122 3.27559 9.4438 2.97908 9.62578 2.60945C9.80775 2.23983 9.85823 1.8192 9.76889 1.41701C9.67954 1.01482 9.4557 0.655134 9.13434 0.39733C8.81298 0.139525 8.4133 -0.000976562 8.00131 -0.000976562C7.58932 -0.000976562 7.18965 0.139525 6.86828 0.39733C6.54692 0.655134 6.32309 1.01482 6.23374 1.41701C6.14439 1.8192 6.19487 2.23983 6.37685 2.60945C6.55882 2.97908 6.86141 3.27559 7.23465 3.45004C7.26467 3.46384 7.28988 3.48628 7.30707 3.51449C7.32426 3.54271 7.33264 3.57541 7.33114 3.60842C7.32964 3.64142 7.31832 3.67323 7.29863 3.69976C7.27895 3.7263 7.2518 3.74636 7.22065 3.75737C6.7746 3.91826 6.38891 4.21259 6.116 4.60036C5.8431 4.98813 5.69621 5.45053 5.69531 5.9247V6.91337C5.69635 7.00039 5.73138 7.08356 5.79292 7.1451C5.85446 7.20663 5.93762 7.24166 6.02465 7.2427H6.57065C6.61112 7.24247 6.65024 7.25728 6.68042 7.28426C6.7106 7.31123 6.72968 7.34845 6.73398 7.3887L7.01398 9.91337C7.023 9.99387 7.06137 10.0682 7.12176 10.1222C7.18214 10.1762 7.26031 10.206 7.34131 10.206H8.65865C8.73958 10.206 8.81766 10.1762 8.87794 10.1222C8.93821 10.0682 8.97645 9.99381 8.98531 9.91337L9.26598 7.3887C9.27057 7.34846 9.28984 7.31131 9.32009 7.28438C9.35035 7.25744 9.38947 7.24261 9.42998 7.2427H9.97531C10.0627 7.2427 10.1464 7.208 10.2082 7.14624C10.2699 7.08448 10.3046 7.00071 10.3046 6.91337V5.92404C10.304 5.45025 10.1575 4.98815 9.8851 4.60051C9.61268 4.21287 9.22753 3.91849 8.78198 3.75737Z"})))}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,s.tT)("div",{style:{display:"inline-block",paddingTop:`${e}px`,fill:"currentColor"}},(0,s.tT)("svg",{style:{height:"1.2em"},width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},(0,s.tT)("path",{d:"M14.9474 6.50932L14.1034 6.20998C13.9826 6.16702 13.8721 6.09916 13.7791 6.01078C13.6862 5.92241 13.6128 5.8155 13.5638 5.69697C13.5148 5.57845 13.4912 5.45094 13.4946 5.32272C13.498 5.19451 13.5282 5.06843 13.5834 4.95265L13.9674 4.14398C14.1075 3.84868 14.1528 3.51727 14.0971 3.19521C14.0414 2.87315 13.8874 2.57621 13.6563 2.3451C13.4252 2.11398 13.1283 1.96002 12.8062 1.90432C12.4842 1.84862 12.1528 1.89391 11.8574 2.03398L11.0488 2.41865C10.9329 2.47361 10.8069 2.50365 10.6787 2.50683C10.5505 2.51002 10.4231 2.48628 10.3046 2.43715C10.1862 2.38802 10.0794 2.31458 9.99111 2.2216C9.90283 2.12861 9.83504 2.01814 9.79211 1.89732L9.49211 1.05398C9.38235 0.746123 9.18003 0.479756 8.91292 0.291408C8.6458 0.103059 8.32696 0.00195313 8.00011 0.00195312C7.67327 0.00195312 7.35443 0.103059 7.08731 0.291408C6.82019 0.479756 6.61788 0.746123 6.50811 1.05398L6.20811 1.89798C6.16512 2.01875 6.09728 2.12915 6.00897 2.22206C5.92066 2.31498 5.81384 2.38834 5.69541 2.4374C5.57699 2.48647 5.44959 2.51015 5.32144 2.50692C5.19329 2.50369 5.06725 2.47362 4.95145 2.41865L4.14278 2.03398C3.84747 1.89391 3.51607 1.84862 3.19401 1.90432C2.87195 1.96002 2.575 2.11398 2.34389 2.3451C2.11278 2.57621 1.95882 2.87315 1.90312 3.19521C1.84742 3.51727 1.89271 3.84868 2.03278 4.14398L2.41678 4.95265C2.47188 5.06844 2.50207 5.19451 2.5054 5.3227C2.50873 5.45089 2.48513 5.57835 2.43613 5.69685C2.38712 5.81535 2.31379 5.92224 2.22089 6.01063C2.12799 6.09902 2.01757 6.16693 1.89678 6.20998L1.05278 6.50998C0.744848 6.61958 0.478381 6.8218 0.289952 7.08887C0.101523 7.35595 0.000366211 7.6748 0.000366211 8.00165C0.000366211 8.32851 0.101523 8.64735 0.289952 8.91443C0.478381 9.1815 0.744848 9.38372 1.05278 9.49332L1.89678 9.79332C2.01755 9.83629 2.12795 9.90414 2.22085 9.99246C2.31375 10.0808 2.38708 10.1876 2.43609 10.3061C2.4851 10.4245 2.50871 10.5519 2.50538 10.6801C2.50206 10.8082 2.47187 10.9342 2.41678 11.05L2.03278 11.8587C1.89271 12.154 1.84742 12.4854 1.90312 12.8074C1.95882 13.1295 2.11278 13.4264 2.34389 13.6575C2.575 13.8887 2.87195 14.0426 3.19401 14.0983C3.51607 14.154 3.84747 14.1087 4.14278 13.9687L4.95145 13.5847C5.06722 13.5295 5.19329 13.4992 5.3215 13.4959C5.44971 13.4926 5.57718 13.5162 5.69566 13.5653C5.81415 13.6144 5.92099 13.6878 6.00927 13.7809C6.09755 13.8739 6.1653 13.9844 6.20811 14.1053L6.50811 14.9487C6.61788 15.2565 6.82019 15.5229 7.08731 15.7112C7.35443 15.8996 7.67327 16.0007 8.00011 16.0007C8.32696 16.0007 8.6458 15.8996 8.91292 15.7112C9.18003 15.5229 9.38235 15.2565 9.49211 14.9487L9.79211 14.1047C9.83509 13.9839 9.90293 13.8735 9.99126 13.7806C10.0796 13.6877 10.1864 13.6144 10.3049 13.5653C10.4233 13.5163 10.5507 13.4927 10.6789 13.496C10.807 13.4994 10.933 13.5296 11.0488 13.5847L11.8574 13.9687C12.1528 14.1087 12.4842 14.154 12.8062 14.0983C13.1283 14.0426 13.4252 13.8887 13.6563 13.6575C13.8874 13.4264 14.0414 13.1295 14.0971 12.8074C14.1528 12.4854 14.1075 12.154 13.9674 11.8587L13.5834 11.05C13.5284 10.9342 13.4982 10.8082 13.4948 10.6801C13.4915 10.5519 13.5151 10.4245 13.5641 10.3061C13.6131 10.1876 13.6865 10.0808 13.7794 9.99246C13.8723 9.90414 13.9827 9.83629 14.1034 9.79332L14.9474 9.49265C15.2554 9.38305 15.5218 9.18084 15.7103 8.91376C15.8987 8.64669 15.9999 8.32784 15.9999 8.00098C15.9999 7.67413 15.8987 7.35528 15.7103 7.08821C15.5218 6.82113 15.2554 6.61892 14.9474 6.50932ZM8.00011 11.1907C7.37045 11.1815 6.75667 10.9917 6.2318 10.6437C5.70693 10.2958 5.29306 9.80438 5.03945 9.22798C4.71516 8.44275 4.71553 7.56095 5.04046 6.77598C5.3654 5.99102 5.98838 5.36695 6.77278 5.04065C7.55892 4.72626 8.43681 4.73154 9.21911 5.05537C10.0014 5.3792 10.6262 5.99594 10.9601 6.77398C11.2844 7.55922 11.284 8.44102 10.9591 9.22598C10.6342 10.011 10.0112 10.635 9.22678 10.9613C8.83799 11.1212 8.42042 11.1993 8.00011 11.1907Z"})))}function l(e,t){const i=(0,s.tT)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-testid":"reply-icon"},(0,s.tT)("path",{d:"M9.41624 6.5001C8.36101 5.49058 6.91921 5.42139 6.31151 5.44408C6.2877 5.44511 6.26454 5.43559 6.2474 5.41774C6.23026 5.39989 6.22063 5.37525 6.22074 5.34955V4.37708C6.22037 4.2304 6.1414 4.09718 6.01813 4.0353C5.89485 3.97341 5.74953 3.99404 5.64528 4.08821L3.01893 6.49519C2.93812 6.56704 2.89133 6.67411 2.89136 6.78708C2.89077 6.89782 2.93585 7.00312 3.01437 7.07444L5.64739 9.58388C5.75212 9.677 5.89728 9.69652 6.02 9.63396C6.14272 9.57141 6.22092 9.43803 6.22074 9.29161V8.14408C6.22076 8.09924 6.25009 8.06064 6.29083 8.05182C6.95951 7.90058 9.14183 7.61398 10.2721 9.90072C10.3101 9.97676 10.3911 10.0153 10.4688 9.99434C10.5465 9.97338 10.6011 9.89827 10.6015 9.81187C10.6015 8.36716 10.2027 7.25328 9.41624 6.5001Z"}));return(0,s.tT)("div",{colorClass:e,style:t},i)}},2091:(e,t,i)=>{"use strict";i.d(t,{$h:()=>N,Pm:()=>O,Zw:()=>G,__:()=>q,gI:()=>z,hk:()=>H,mU:()=>W,wR:()=>$,zh:()=>V});var s=i(7623),n=i(5276),o=i(9447),r=i(5728),a=i(9757),l=i(9419),h=i(6428),d=i(7964),c=i(9461),u=i(9505),p=i(5052),m=i(369),g=i(442),v=i(6784),f=i(6844),y=i(9453),b=i(2939),w=i(6669),C=i(1519),S=i(2709),x=i(3955),T=i(481),P=i(8423),k=i(9060),A=i(3654),M=i(1284),R=i(7407),I=i(2146),E=i(7258),L=i(7569),D=i(4947),B=i(4110),U=i(3860),_=i(1448),F=i(74);const N=28,O=6,H=1024,W=4096,$=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=c.Aw.getState(),i=t.userName===t.room;return!(0,k.Lx)()||t.isModerator||i||e?1e3:200};function V(){const e=document.createElement("form");return(0,o.fZ)(e,"chat-input-form"),e.style.display="inline-block",e.style.boxSizing="border-box",e.style.display="flex",e.style.alignItems="center",e}function z(){const e=document.createElement("div");return(0,o.fZ)(e,"inputDiv"),e.style.height=`${N}px`,e.style.boxSizing="border-box",e.style.margin="0 5px 5px 5px",e.style.position="relative",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.fontSize="12px",e.style.display="grid",e.style.gridTemplateColumns="minmax(25px, 1fr) auto",e.style.columnGap=`${O}px`,e.style.padding=`0 ${O}px`,e.style.borderRadius="4px 4px 0 0",e}function G(e,t,i){const s=new w.wi(e,t);return(0,o.fZ)(s.element,"chat-input-field"),(0,x.ZM)(s.element,{height:N-2*O+"px",fontFamily:"Helvetica, Arial, sans-serif",lineHeight:"15px"}),s.element.classList.add("inputFieldChatPlaceholder"),s.element.dataset.testid="chat-input",void 0!==i&&s.element.classList.add(i),s.element.setAttribute("data-placeholder",D.R.sendAMessageDesktop),(0,v.Xq)(["focus","touchstart"],s.element,(()=>(0,y.Ye)())),(0,v.wu)("blur",s.element,y.TL),s}class q extends S.u{constructor(e,t,i,s){super(),this.outgoingHandlers=e,this.inPrivateRoom=t,this.isConversationShowing=i,this.pmOtherUser=s,this.addMessageHTMLEvent=new P.c_("addMessageHtml",{reportIfNoListeners:!1}),this.removeMessagesForUserEvent=new P.c_("removeMessageHtml",{reportIfNoListeners:!1}),this.scrolledToBottom=new P.c_("scrolledToBottom"),this.messageList=function(){const e=document.createElement("div");return e.className="msg-list-fvm",(0,o.fZ)(e,"message-list"),e.style.width="100%",(0,I.PF)(e,"text"),e.style.cursor="text",e.style.paddingBottom="4px",e}(),this.noticeList=function(){const e=document.createElement("div");return e.style.width="100%",e.className="notice-list-fvm",(0,I.PF)(e,"text"),e.style.cursor="text",e}(),this.messageListWrapper=function(){const e=document.createElement("div");return e.className="msg-list-wrapper-split",e.style.boxSizing="border-box",(0,k.QC)()?(e.style.overflowY="auto",e.style.overflowX="hidden"):e.style.overflow="auto",e.style.margin="0 auto 0",e.style.width="100%",e.style.padding="5px",e.style.flex="1",e}(),this.listenerGroup=new P.gt,this.isPmChatContents=void 0!==this.pmOtherUser,this.scrollToBottomDebouncer=new C.a((()=>this.scrollToBottom()),{bounceLimitMS:0,debounceType:0}),this.toBottom=()=>{this.scrollToBottom()},this.element.classList.add("ChatTabContents"),this.element.style.position="static",this.element.style.boxSizing="border-box",this.element.style.fontSize="12px",this.element.style.overflow="",this.element.style.display="flex",this.element.style.flexDirection="column",this.element.classList.add(this.isPmChatContents?"TheatermodeChatDivPm":"TheatermodeChatDivChat"),this.messageListWrapper.appendChild(this.noticeList),this.messageListWrapper.appendChild(this.messageList),this.isPmChatContents&&(this.pmControlBar=new r.sV(!1,s),this.element.appendChild(this.pmControlBar.element)),this.element.appendChild(this.messageListWrapper),(0,k.QC)()&&(this.scrollDownButton=new g.w({scrollToBottom:()=>this.scrollToBottom(),bottomStyle:()=>`${this.totalInputHeight()+9}px`}),this.addChild(this.scrollDownButton),this.newMessageNotice=new p.W({getUnreadCount:()=>{var e;return null===(e=this.scrollDownButton)||void 0===e?void 0:e.getUnreadCount()},isConversationShowing:()=>this.isConversationShowing(),isScrolledUp:()=>this.isScrolledUp(),setParentScrollTop:e=>this.setScrollTop(e),scrollParentDiv:this.messageListWrapper}),U.L.changeVideoMode.listen((()=>{var e;null===(e=this.newMessageNotice)||void 0===e||e.remove(),this.scrollToBottom()})).addTo(this.listenerGroup)),this.buildChatInput(),this.wasScrolledUp=!1;const n=new C.a((()=>{const e=this.messageListWrapper.scrollTop;this.isPmChatContents&&0===e&&this.isScrolledUp()&&B.ME.fire(),m.x0||(!this.isScrolledUp()&&this.wasScrolledUp&&this.scrolledToBottom.fire(),this.wasScrolledUp=this.isScrolledUp())}),{bounceLimitMS:50,debounceType:1});(0,v.wu)("scroll",this.messageListWrapper,(()=>{n.callFunc(),this.undebouncedOnScrollChange()})),(0,k.GZ)()&&!this.isPmChatContents&&(0,k.$o)(this.messageListWrapper,this.messageList),this.listenerGroup.add(b.X0.listen((e=>{this.currentRoomContext=e,this.element.style.fontSize=e.dossier.userChatSettings.fontSize,this.setLineHeight()}))),b.Gr.listen((()=>{var e;this.customInputField.clearText(),null===(e=this.scrollDownButton)||void 0===e||e.hideElement(),(0,d.Tj)()})).addTo(this.listenerGroup),F.EZ.listen((e=>{this.element.style.fontSize=e.fontSize,this.setLineHeight()})).addTo(this.listenerGroup),this.emoticonAutocompleteModal=new T.s({inputElement:this.customInputField,leftOffset:8,rightOffset:207}),this.inputDiv.appendChild(this.emoticonAutocompleteModal.element),this.emoticonAutocompleteModal.afterDOMConstructedIncludingChildren(),this.isPmChatContents||(this.userMentionAutocompleteModal=new h.ti({inputElement:this.customInputField,leftOffset:8,rightOffset:207}),this.inputDiv.appendChild(this.userMentionAutocompleteModal.element),this.userMentionAutocompleteModal.afterDOMConstructedIncludingChildren(),h.$u.listen((()=>{(0,A.Qp)(this.messageList)})).addTo(this.listenerGroup),this.shortcodeAutocompleteModal=new E.V({inputElement:this.customInputField,leftOffset:8,rightOffset:207},this.isPmChatContents),this.inputDiv.appendChild(this.shortcodeAutocompleteModal.element),this.shortcodeAutocompleteModal.afterDOMConstructedIncludingChildren()),this.emoticonAutocompleteModal.element.classList.add(this.isPmChatContents?"theatermodeEmoticonAutocompleteModalPm":"theatermodeEmoticonAutocompleteModalChat"),this.emoticonAutocompleteModal.element.dataset.testid="emoticon-autocomplete-modal"}buildChatInput(){const e=this.isPmChatContents?W:H;this.inputDiv=z(),this.inputForm=V(),this.customInputField=G((()=>this.sendMessageFromInput()),e,this.isPmChatContents?"theatermodeInputFieldPm":"theatermodeInputFieldChat"),this.buildButtonHolder(),this.inputForm.appendChild(this.customInputField.element),this.inputDiv.appendChild(this.inputForm),this.inputDiv.appendChild(this.buttonHolder.element),this.element.appendChild(this.inputDiv),this.addInputListeners()}buildButtonHolder(){this.buttonHolder=new u.J({columnGap:`${O}px`}),this.isPmChatContents&&(this.mediaDockButton=function(e){const t=document.createElement("span");t.style.cursor="pointer",t.style.height="1.2em",t.style.minWidth="1.2em",t.dataset.paction="Chat",t.dataset.pactionName="UploadPhoto",t.dataset.testid="send-image-button",t.onclick=e;const i=document.createElement("img");return i.src=`${STATIC_URL}mediaDock/uploadBackground.svg`,i.style.width="100%",i.style.height="100%",t.appendChild(i),t}((()=>{this.onMediaDockButtonClick()})),this.buttonHolder.addButton(this.mediaDockButton,u.z.Icon)),this.emojiButton=function(e){const t=document.createElement("span");return t.textContent="😁",t.style.cursor="pointer",t.style.fontSize="1em",t.style.lineHeight="1em",t.classList.add(e?"theatermodeEmojiButtonPm":"theatermodeEmojiButtonChat"),(0,s.AD)()||(n.A.parse(t,{className:"emojiButton"}),t.style.fontSize="15px",t.style.lineHeight="15px"),t.dataset.paction="Chat",t.dataset.pactionName="EmojiClick",t.dataset.testid="emoji-button",t}(this.isPmChatContents),this.buttonHolder.addButton(this.emojiButton,u.z.Icon);const e=document.createElement("span");new(a.c.get("SendButton"))({onClick:()=>{this.customInputField.submit()},isPm:this.isPmChatContents,variant:"SplitMode"},e),this.buttonHolder.addButton(e,u.z.Text)}onMediaDockButtonClick(){if((0,R.bT)("PMPhotoButtonClicked"),!(0,f.rC)()){var e;if((0,d.QQ)(this))return;null===(e=this.libraryMediaDock)||void 0===e||e.toggle(),this.scrollToBottom()}}addInputListeners(){(0,v.wu)("mousedown",this.inputDiv,(e=>{(0,d.QQ)(this)||e.target!==this.inputDiv&&e.target!==this.inputForm||(this.customInputField.focus(),e.preventDefault())})),(0,v.wu)("focus",this.customInputField.element,(e=>{(0,d.QQ)(this)&&e.preventDefault()})),(0,v.wu)("click",this.emojiButton,(e=>{(0,d.QQ)(this)||((0,y.Ye)(),B.n2.fire(this.emojiButton))})),(0,v.wu)("submit",this.inputForm,(e=>{e.preventDefault(),this.customInputField.submit()}))}setLineHeight(){this.messageListWrapper.style.lineHeight=`${Number(this.element.style.fontSize.slice(0,-2))+7}pt`}totalInputHeight(){var e,t,i,s;return N+(null!==(e=null===(t=this.libraryMediaDock)||void 0===t?void 0:t.element.offsetHeight)&&void 0!==e?e:0)+(null!==(i=null===(s=this.selectedMediaDock)||void 0===s?void 0:s.element.offsetHeight)&&void 0!==i?i:0)}dispose(){var e,t,i,s;this.listenerGroup.removeAll(),this.emoticonAutocompleteModal.dispose(),null===(e=this.userMentionAutocompleteModal)||void 0===e||e.dispose(),null===(t=this.libraryMediaDock)||void 0===t||t.dispose(),this.customInputField.dispose(),null===(i=this.pmControlBar)||void 0===i||i.dispose(),null===(s=this.shortcodeAutocompleteModal)||void 0===s||s.dispose()}shouldSendMessageFromInput(){var e,t;return!(0,f.rC)(D.R.loggedInToSendAMessage)&&!this.emoticonAutocompleteModal.isVisible()&&!0!==(null===(e=this.userMentionAutocompleteModal)||void 0===e?void 0:e.isVisible())&&!0!==(null===(t=this.shortcodeAutocompleteModal)||void 0===t?void 0:t.isVisible())&&!(0,d.QQ)(this)}sendMessageFromInput(){if(!this.shouldSendMessageFromInput())return!1;const e=this.customInputField.getText(),t=void 0!==this.selectedMediaDock&&!this.selectedMediaDock.isEmpty();return this.scrollToBottom(),(""!==e.trim()||t)&&this.processMessage(e),this.recordUserAction(e),!0}shortcodeErrorMsg(e,t){return this.isPmChatContents?D.R.shortcodeNotSupportedInPMs:this.inPrivateRoom()?D.R.shortcodeNotSupportedInPrivates:0===e.shortcodes.length?L.fM.errorBehindShortcode(t):void 0}processMessage(e){const t=(0,L.PR)(e);switch(t.messageType){case L.gW.Shortcode:const i=t,s=this.shortcodeErrorMsg(i,e);void 0!==s?this.appendMessageDiv((0,_.CM)(s)):this.outgoingHandlers.onShortcode&&this.outgoingHandlers.onShortcode(i);break;case L.gW.ToggleDebugMode:this.outgoingHandlers.onToggleDebugMode();break;case L.gW.TipRequest:this.customInputField.clearText();const n=t;this.outgoingHandlers.onTipRequest(n.messageData);break;default:this.outgoingHandlers.onChatMessage(e)}}recordUserAction(e){const t=e.match(/@[a-zA-Z0-9_]+/gm),i=l.k.getInstance();if(null!==t)for(const e of t)i.userInList(e.replace("@",""))&&(0,R.bT)("UserMentionMessage");this.customInputField.blur()}repositionChildren(){var e,t;null!==(e=null===(t=this.selectedMediaDock)||void 0===t?void 0:t.isShown())&&void 0!==e&&e?this.inputDiv.style.borderRadius="0":this.inputDiv.style.borderRadius="4px 4px 0 0",this.emoticonAutocompleteModal.element.style.bottom=this.inputDiv.offsetHeight-2+"px",void 0!==this.shortcodeAutocompleteModal&&(this.shortcodeAutocompleteModal.element.style.bottom=this.inputDiv.offsetHeight-2+"px"),void 0!==this.userMentionAutocompleteModal&&(this.userMentionAutocompleteModal.element.style.bottom=this.inputDiv.offsetHeight-2+"px"),this.wasScrolledUp||this.scrollToBottom()}initMediaDocks(e){this.libraryMediaDock=e,this.selectedMediaDock=e.sibling,this.addMediaDocksToDOM()}addMediaDocksToDOM(){void 0!==this.libraryMediaDock&&this.addChild(this.libraryMediaDock),void 0!==this.selectedMediaDock&&((0,x.ZM)(this.selectedMediaDock,{margin:"0 5px"}),this.element.insertBefore(this.selectedMediaDock.element,this.inputDiv))}isScrolledUp(){return this.messageListWrapper.scrollTop<=this.messageListWrapper.scrollHeight-(this.messageListWrapper.offsetHeight+20)}scrollToBottom(){var e;const t=this.isScrolledUp();(0,s.OF)()&&(0,x.WV)(this.messageListWrapper),this.messageListWrapper.scrollTop=this.messageListWrapper.scrollHeight,null===(e=this.scrollDownButton)||void 0===e||e.hideElement(),t&&this.scrolledToBottom.fire()}debouncedScrollToBottom(){this.scrollToBottomDebouncer.callFunc()}getScrollTop(){return this.messageListWrapper.scrollTop}setScrollTop(e){this.messageListWrapper.scrollTo({top:e})}undebouncedOnScrollChange(){var e,t;this.isScrolledUp()?null===(e=this.scrollDownButton)||void 0===e||e.showElement():(null===(t=this.scrollDownButton)||void 0===t||t.hideElement(),this.clearScrollButtonUnread())}appendNoticeDiv(e){return this.noticeList.appendChild(e),e}appendMessageDiv(e){var t;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this.messageListWrapper.scrollTop,o=this.isScrolledUp();var r;if(o||e.querySelectorAll("img").forEach((e=>{const t=e.src;e.src="",e.onload=this.toBottom,e.src=t})),!i||!o&&this.isConversationShowing()||null===(r=this.scrollDownButton)||void 0===r||r.incUnread(),!0===(null===(t=this.newMessageNotice)||void 0===t?void 0:t.shouldAppendNewMessageNotice(i,s))&&(0,M.NZ)(this.newMessageNotice.element,this.messageList,this.isPmChatContents),(0,M.NZ)(e,this.messageList,this.isPmChatContents),(0,k.GZ)()&&this.messageList.childElementCount%100==0&&!this.isPmChatContents){const e=c.Aw.getState();(0,R.bT)("ChatHistoryReached",{n:this.messageList.childElementCount,is_mod:e.isModerator,is_broadcaster:e.userName===e.room})}let a=this.messageList.childElementCount-$(this.isPmChatContents);for(;a>0;a-=1){const e=this.messageList.firstElementChild;null!==e&&this.messageList.removeChild(e)}var l;return o?null===(l=this.newMessageNotice)||void 0===l||l.maybeScrollJump(n):this.scrollToBottom(),this.addMessageHTMLEvent.fire({makeByCloning:()=>e.cloneNode(!0)}),e}clearScrollButtonUnread(){var e;null===(e=this.scrollDownButton)||void 0===e||e.clearUnread()}showElement(){super.showElement("flex")}getEarliestMessageId(){return this.earliestMessageId}setEarliestMessageId(e){this.earliestMessageId=e}clear(){for(;null!==this.messageList.firstChild;)this.messageList.removeChild(this.messageList.firstChild)}focusCurrentChatInput(){this.customInputField.focus()}blurCurrentChatInput(){this.customInputField.blur()}removeMessagesForUser(e){this.removeMessagesForUserEvent.fire(e)}isInputFocused(){return document.activeElement===this.customInputField.element}getInputText(){return this.customInputField.getText()}setInputText(e){this.customInputField.setText(e)}appendInputText(e){this.customInputField.appendText(e)}}},4660:(e,t,i)=>{"use strict";i.d(t,{J:()=>l});var s=i(6784),n=i(2382),o=i(8423),r=i(5173),a=i(2146);class l extends r.Q{constructor(e,t,i){super(),this.onColorPicked=t,this.onColorHovered=i,this.hexInput=document.createElement("input"),this.pickerImgLoaded=!1,this.pickerImgLoadedEvent=new o.c_("pickerImgLoaded"),this.swatchElement=e,this.element.dataset.testid="color-picker-modal",this.element.style.visibility="hidden",this.element.style.width="auto",this.element.style.height="auto",this.element.style.opacity="0",(0,a.Ve)(this.element,"opacity 250ms"),(0,s.wu)("keydown",this.element,(e=>{"Escape"===e.key&&this.hide()})),this.overlayClick.listen((()=>{this.hide()})),this.createColorCanvas(),this.createHexInput()}createColorCanvas(){const e=document.createElement("canvas");e.style.cursor="crosshair",e.style.border="1px solid #000001",this.element.appendChild(e);const t=document.createElement("img");var i;i=t,`${STATIC_URL}colorPicker.png?v=1`.startsWith("/")||i.setAttribute("crossorigin","anonymous"),t.src=`${STATIC_URL}colorPicker.png?v=1`,t.onload=()=>{e.width=t.width,e.height=t.height,e.onclick=()=>{this.initialColor=this.hexInput.value,this.colorPicked(this.hexInput.value),this.hide()},e.onmousemove=t=>{const i=e.getContext("2d");if(null!==i&&t.offsetX>0&&t.offsetY>0&&t.offsetX<e.clientWidth&&t.offsetY<e.clientHeight){const e=i.getImageData(t.offsetX,t.offsetY,1,1).data,s={red:e[0],green:e[1],blue:e[2]};this.hexInput.value=`#${(0,n.Ob)(s)}`}else this.hexInput.value=this.initialColor;this.colorHovered(this.hexInput.value)},e.onmouseleave=()=>{this.hexInput.value=this.initialColor,this.colorHovered(this.hexInput.value)};const i=e.getContext("2d");null!==i&&i.drawImage(t,0,0,t.width,t.height),this.hexInput.style.width=e.width-8+"px",this.pickerImgLoaded=!0,this.pickerImgLoadedEvent.fire(void 0)}}createHexInput(){this.hexInput.dataset.testid="color-hex-input",this.hexInput.type="text",this.hexInput.style.display="block",this.hexInput.style.border="1px solid #000000",this.hexInput.style.padding="2px 4px",this.hexInput.style.position="relative",this.hexInput.style.top="-3px",this.hexInput.style.fontSize="12px",this.hexInput.oninput=()=>{this.colorHovered(this.hexInput.value)},(0,s.wu)("keydown",this.hexInput,(e=>{"Enter"===e.key&&(this.colorPicked(this.hexInput.value),this.hide())})),this.element.appendChild(this.hexInput)}colorPicked(e){e=this.validateHexStrings(e),this.onColorPicked(e)}colorHovered(e){e=this.validateHexStrings(e),this.onColorHovered(e)}validateHexStrings(e){let t=e.replace(/^#/,"");return t=t.length>5?t.slice(0,6):t.slice(0,3),`#${t}`}repositionChildren(){this.element.style.left=`${this.swatchElement.offsetLeft}px`,this.element.style.top=`${this.swatchElement.offsetTop+this.swatchElement.offsetHeight+2}px`}show(e){this.initialColor=e,this.pickerImgLoaded?this.styleForShow():this.pickerImgLoadedEvent.once((()=>this.styleForShow()))}styleForShow(){this.hexInput.value=this.initialColor,this.element.style.opacity="1",this.element.style.visibility="",this.showOverlay(),this.repositionChildrenRecursive()}hide(){this.hideOverlay(),this.element.style.opacity="0",window.setTimeout((()=>{this.element.style.visibility="hidden"}),250)}}},8269:(e,t,i)=>{"use strict";i.d(t,{M$:()=>d,Or:()=>l,rS:()=>a,rW:()=>h});var s=i(9930),n=i(8423),o=i(2945),r=i(9268);const a="discover-join-overlay";class l extends r.fS{constructor(){super({onHide:()=>{(0,s.Cb)(),d.fire(void 0)}})}}function h(e){for(const t of e.querySelectorAll("a:not(.nooverlay):not([href='#'])"))null!==t.getAttribute("data-room-nav")&&void 0!==(0,o.JO)(window.location.search).join_overlay&&t.setAttribute(a,""),new r.QC(t)}const d=new n.c_("removeDiscoverJoinOverlayAnchors")},2196:(e,t,i)=>{"use strict";i.d(t,{N:()=>c});var s=i(2758),n=i(9447),o=i(6784),r=i(3333),a=i(2939),l=i(2709),h=i(4947);const d=e=>`dism_msg${e}`;class c extends l.u{constructor(){super(),this.messagesDisplaying=[],this.element.style.position="static",this.element.style.overflow="",a.X0.listen((e=>{for(const t of e.dossier.dismissibleMessages)this.messagesDisplaying.indexOf(t.idOrName)<0&&!this.getDismissedCache(t)&&(this.messagesDisplaying.push(t.idOrName),this.render(t))}))}render(e){const t=document.createElement("div");(0,n.fZ)(t,"dismissibleMessage"),(0,n.fZ)(t,n.aG.dismissibleMessageColor),t.innerHTML=e.messageHtml,t.style.fontSize="12px",t.style.padding="3px",t.style.margin="5px 0",t.style.borderRadius="2px",t.style.lineHeight="16px",t.dataset.testid="dismissible-message-text";const i=document.createElement("a");(0,n.fZ)(i,n.aG.hrefColor),i.textContent=h.R.dismissMessage,i.style.cursor="pointer",i.dataset.testid="dismissible-message-dismiss";const s=document.createElement("span");s.textContent=" (";const a=document.createElement("span");a.textContent=")",t.appendChild(s),t.appendChild(i),t.appendChild(a),this.element.appendChild(t);const l=t.getElementsByTagName("a");for(const e of l)(0,n.fZ)(e,n.aG.hrefColor),e.onmouseenter=()=>{e.style.textDecoration="underline"},e.onmouseleave=()=>{e.style.textDecoration=""},e.classList.contains(r.uJ)&&(0,r.NX)(e);(0,o.wu)("click",i,(()=>{this.dismissMessage(t,e)}))}getDismissedCache(e){return"1"===(0,s.y1)(d(e.idOrName))}dismissMessage(e,t){this.element.removeChild(e),this.messagesDisplaying.splice(this.messagesDisplaying.indexOf(t.idOrName),1),(0,s.aR)(d(t.idOrName),"1",{days:60})}}},9439:(e,t,i)=>{"use strict";i.d(t,{AU:()=>b,LE:()=>y,RB:()=>C,Vx:()=>w,jb:()=>f});var s=i(7964),n=i(6064),o=i(6784),r=i(2326),a=i(6844),l=i(6669),h=i(6716),d=i(5412),c=i(1191),u=i(2690),p=i(3741),m=i(3860),g=i(74);let v=!0;function f(e){v=e}function y(){return v}function b(e){return Boolean(e.form)||null!==e.closest("form")}function w(){return void 0!==document.activeElement&&null!==document.activeElement&&["input","textarea"].includes(document.activeElement.tagName.toLowerCase())&&!(0,n.QZ)()}function C(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;const v=new c.t,f=()=>e.chatWindow.chatTabContainer.getCurrentTab().isInputFocused()||t.getCurrentTab().isInputFocused();let C=0;u.$M.listen((e=>{e?C+=1:C-=1})),v.addHandler({keyCode:9,requiresCtrlOrMeta:!1,handle:i=>{if(!(!f()&&w()&&e.focusedWindow!==e.tipWindow||(0,n.QZ)()||(0,n.QZ)())){e.setFocusedWindow(e.chatWindow);const s=e=>{i.shiftKey?e.cycleToPrevWindow():e.cycleToNextWindow()};"split"===m.L.getVideoMode()?(s(e.chatWindow.chatTabContainer),s(t)):(s(t),s(e.chatWindow.chatTabContainer)),i.preventDefault(),i.stopPropagation()}}}),v.addHandler({keyCode:13,requiresCtrlOrMeta:!1,handle:t=>{f()?(0,a.rC)()&&t.preventDefault():e.setFocusedWindow(e.chatWindow)}}),v.addHandler({keyCode:27,requiresCtrlOrMeta:!1,handle:t=>{t.preventDefault(),void 0!==e.focusedWindow&&e.focusedWindow.closable&&e.removeChild(e.focusedWindow),e.setFocusedWindow(void 0)}}),v.addHandler({keyCode:76,requiresCtrlOrMeta:!0,handle:i=>{"split"!==m.L.getVideoMode()&&e.focusedWindow!==e.chatWindow||("split"!==m.L.getVideoMode()||t.pmTab.tabHasFocus())&&(i.stopPropagation(),i.preventDefault(),(0,r.J)(),e.chatWindow.chatTabContainer.closeCurrentPMSession(),t.closeCurrentPMSession())}}),v.addHandler({keyCode:83,requiresCtrlOrMeta:!0,handle:t=>{t.stopPropagation(),t.preventDefault(),(0,r.J)(),"split"===m.L.getVideoMode()||"hidden"===e.element.style.visibility?g.i5.fire({usedCtrlS:!0}):h.f6.fire({usedCtrlS:!0})}});const S=[32,34,33];(0,o.wu)("keydown",document,(o=>{(e=>!y()||27!==e.keyCode&&!e.ctrlKey&&!e.metaKey&&(!(null===e.target||!b(e.target)||f())||!!((0,n.QZ)()||-1!==S.indexOf(e.keyCode)||0!==C||(0,s.tI)()||(0,p.$)())||!f()&&w()))(o)||void 0!==e.focusedWindow&&e.focusedWindow.handleKeyEvent(o)||i()&&!v.execute(o)&&(o.ctrlKey||o.metaKey||!(0,d.x)(o.which)||("split"!==m.L.getVideoMode()&&e.setFocusedWindow(e.chatWindow),l.Z2.fire(o),("split"===m.L.getVideoMode()?t:e.chatWindow.chatTabContainer).getCurrentTab().focusCurrentChatInput()))}),!0)}},3306:(e,t,i)=>{"use strict";i.d(t,{n:()=>h});var s=i(3955),n=i(6144),o=i(2997),r=i(2146),a=i(4947),l=i(1372);class h extends n.v{constructor(e){super(e.toggleElement,!0,e)}initUI(e){const t={padding:"8px 16px",cursor:"pointer"},i=()=>{this.hideElement(),e.enterNativeFn()},n=()=>{this.hideElement(),e.enterInteractiveFn()};(0,s.ZM)(this.element,{display:"block",visibility:"hidden",opacity:"0",inset:"",height:"max-content",width:"max-content",padding:"8px 0px",borderRadius:"8px",bottom:"100%",right:"10px",textShadow:"none",textAlign:"left",color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.75)",fontFamily:'"UbuntuRegular", sans-serif',fontSize:"13px",fontStyle:"normal",lineHeight:"16px"}),this.element.classList.add("fullscreen-dropdown"),this.nativeOption=(0,l.tT)("div",{style:t,onClick:()=>i()},a.R.nativeFullscreenLabel),this.interactiveOption=(0,l.tT)("div",{style:t,onClick:()=>n()},a.R.interactiveFullscreenLabel),this.element.appendChild(this.nativeOption),this.element.appendChild(this.interactiveOption)}toggleOverlay(e){var t;return!1===(null===(t=this.toggleElement)||void 0===t?void 0:t.classList.contains("disabled"))&&(void 0!==e&&e.composedPath().some((e=>e instanceof Element&&this.element.contains(e)))?this.isShown():this.isShown()?!this.hideElement(e):this.showElement(void 0,e))}isShown(){return"hidden"!==this.element.style.visibility}showElement(){let e=arguments.length>1?arguments[1]:void 0;return!this.isShown()&&((0,r.Ve)(this.element,"100ms"),void 0!==this.toggleElement&&(this.element.style.bottom=`${this.toggleElement.offsetHeight}px`),this.element.style.visibility="visible",this.element.style.opacity="1",this.toggleEvent.fire(new o.XY(!0,e)),this.isShown())}hideElement(e){return!(void 0!==e&&e.composedPath().some((e=>e instanceof Element&&this.element.contains(e)))||(this.element.style.opacity="0",this.element.style.visibility="hidden",this.toggleEvent.fire(new o.XY(!1,e)),this.isShown()))}}},9268:(e,t,i)=>{"use strict";i.d(t,{CG:()=>v,L4:()=>P,Nb:()=>x,QC:()=>S,Vz:()=>T,WG:()=>b,fS:()=>f,zG:()=>y});var s=i(9930),n=i(6064),o=i(6784),r=i(5216),a=i(8423),l=i(6440),h=i(2690),d=i(7407),c=i(3004),u=i(4947),p=i(2945),m=i(5389);const g="/accounts/register_iframe/",v=new a.c_("showJoinOverlay");class f extends h.zf{constructor(e){if(super({...e,easyExit:!0,onHide:t=>{var i;null===(i=e.onHide)||void 0===i||i.call(e,t),document.body.style.overflow="",document.body.classList.remove("blurred-login-overlay-shown")}}),this.element.style.display="none",this.element.style.position="absolute",this.element.style.width="560px",this.element.style.height="auto",this.element.style.backgroundColor="#ffffff",this.element.style.border="2px solid #cccccc",this.element.style.borderRadius="20px",this.element.style.padding="10px",this.element.style.top="45px",this.element.style.fontSize="12px",this.element.style.fontFamily="UbuntuRegular', Arial, Helvetica, sans-serif",this.overlay.style.background="",this.overlay.classList.add("blurred-login-overlay"),this.element.appendChild(this.createLoadingSpinner()),this.iframe=document.createElement("iframe"),this.iframe.id="join_iframe",this.iframe.frameBorder="0",this.iframe.marginWidth="0",this.iframe.marginHeight="0",this.iframe.style.width="560px",this.iframe.style.height="650px",this.iframe.src=`${g}?next=${encodeURIComponent(window.location.pathname)}`,(0,l.f)("AffLinkcodeCookieOnClick")){const e=window.location.search.includes("tour="),t=window.location.search.includes("campaign=");e&&t&&(this.iframe.src=`${g}${window.location.search}`,window.location.search.includes("next=")||(this.iframe.src+=`&next=${encodeURIComponent(window.location.pathname)}`))}this.element.appendChild(this.iframe);const t=document.createElement("hr");t.style.margin="15px 0 10px 0",t.style.border="0",t.style.color="#e4e4e4",t.style.backgroundColor="#e4e4e4",t.style.height="1px",this.element.appendChild(t);const i=document.createElement("span"),s=document.createElement("img");s.src=`${STATIC_URL}arrow_back.gif`,s.style.marginRight="4px",s.style.verticalAlign="bottom",i.appendChild(s),this.registerLaterLink=document.createElement("a"),this.registerLaterLink.innerText=u.R.registerLaterText,this.registerLaterLink.className="nooverlay",i.appendChild(this.registerLaterLink),this.element.appendChild(i);const a=document.createElement("span");a.style.cssFloat="right";const h=document.createElement("img");h.src=`${STATIC_URL}key.gif`,h.style.marginRight="4px",h.style.verticalAlign="bottom",a.appendChild(h);const d=document.createElement("span");d.innerText=u.R.alreadyRegisteredText,d.style.color="#7f7f7f",d.style.position="relative",d.style.top="-1px",d.style.marginRight="2px",a.appendChild(d);const p=document.createElement("a");p.href=(0,r._Y)(c.ii),p.innerText=u.R.loginHereText,p.className="nooverlay",p.style.color="#0a5a83",p.style.position="relative",p.style.top="-1px",p.onmouseenter=()=>{p.style.textDecoration="underline"},p.onmouseleave=()=>{p.style.textDecoration="none"},a.appendChild(p),this.element.appendChild(a),this.overlayClick.listen((()=>{this.hide()})),n.Fd.listen((()=>{this.hide()})),(0,o.wu)("focus",window,(()=>{(0,r.Aw)("accounts/ajax_check_session_authenticated").then((e=>{JSON.parse(e.responseText).authenticated&&(this.hide(),w.fire(void 0))})).catch((()=>{}))}))}initAndShow(e){this.registerLaterLink.href=(0,r._Y)(e.initialHref),this.registerLaterLink.onclick=e.initialOnClick,(0,o.wu)("click",this.registerLaterLink,(()=>{this.hide(),y.fire(void 0)})),super.show(),this.element.style.display="block",this.overlay.style.display="flex",this.overlay.style.alignItems="center",this.overlay.style.justifyContent="center",document.body.style.overflow="hidden",document.body.classList.add("blurred-login-overlay-shown"),this.overlay.appendChild(this.element),this.overlay.style.overflow="auto",this.iframe.onload=()=>{const t=this.iframe.contentDocument;if(this.iframe.contentDocument&&(0,o.wu)("keydown",this.iframe.contentDocument.body,(e=>{"Escape"===e.key&&this.hide()})),null!==t){const i=t.getElementById("husername");null!==i&&i.focus();const s=t.querySelector("a.next");s.href=(0,r._Y)(e.initialHref),s.onclick=e.initialOnClick,(0,o.wu)("click",s,(()=>{this.hide(),y.fire(void 0)})),t.querySelectorAll("a.medium_popup_link").forEach((e=>{e.onclick=t=>{t.preventDefault(),(0,m.gr)(e.href,"_blank",m.NL)}}))}},(0,d.bT)("RegisterIframe_Shown")}createLoadingSpinner(){const e=document.createElement("div");return e.style.animationName="spin",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.width="30px",e.style.height="31px",e.style.margin="-15px 0 0 -15px",e.style.background=`url("${STATIC_URL}images/loading_spinner.svg")`,e.style.backgroundSize="cover",e.style.animationName="spin",e.style.webkitAnimationName="spin",e.style.animationDuration="2s",e.style.webkitAnimationDuration="2s",e.style.animationTimingFunction="linear",e.style.webkitAnimationTimingFunction="linear",e.style.animationIterationCount="infinite",e.style.webkitAnimationIterationCount="infinite",e.style.zIndex="-1",e}}const y=new a.c_("registerLaterLinkClicked"),b=new a.c_("commandeerJoinOverlayAnchors",{listenersWarningThreshold:-1,maxHistorySize:1}),w=new a.c_("restoreJoinOverlayAnchors",{listenersWarningThreshold:-1,maxHistorySize:1});let C=!1;class S{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createElement("a");if(this.anchor=e,void 0!==(0,p.JO)(window.location.search).join_overlay){const e=()=>{C=!0,this.commandeer()};C?window.setTimeout((()=>{this.commandeer()}),0):b.addListener(e,this.anchor);const t=()=>{C=!1,this.restore(),b.removeListener(e),window.setTimeout((()=>{w.removeListener(t)}),0)};w.addListener(t,this.anchor)}}commandeer(){this.initialOnClick=this.anchor.onclick,this.initialHref=(0,r._Y)(this.anchor.href),this.anchor.href=(0,r._Y)(c.k6),this.anchor.onclick=e=>{e.preventDefault(),v.fire(this),w.fire(void 0)}}restore(){this.anchor.onclick=this.initialOnClick,this.anchor.href=(0,r._Y)(this.initialHref),this.initialOnClick=null}}function x(e){for(const t of e.querySelectorAll("a:not(.nooverlay):not([href='#'])"))new S(t)}function T(){const e=document.getElementById("header");null!==e&&x(e);const t=document.getElementById("footer-holder");null!==t&&x(t);const i=document.getElementById("hashtag_ticker");null!==i&&x(i);const s=document.getElementsByClassName("sub-nav");0!==s.length&&x(s[0])}function P(){return(0,s.r)()?document.createElement("a"):(new S).anchor}},1448:(e,t,i)=>{"use strict";i.d(t,{CM:()=>_,F1:()=>I,QT:()=>P,U$:()=>E,YC:()=>F,bB:()=>R,dD:()=>$,j7:()=>M,j8:()=>L,mh:()=>N,r_:()=>W,rc:()=>O});var s=i(7623),n=i(5276),o=i(9447),r=i(3910),a=i(7660),l=i(9930),h=i(9461),d=i(5216),c=i(8122),u=i(2939),p=i(3955),m=i(3654),g=i(4140),v=i(1284),f=i(4580),y=i(7407),b=i(34),w=i(2359),C=i(7569),S=i(4947),x=i(9681),T=i(74);const P=4;let k;function A(e,t){return new x.L(e,t)}function M(e){const t=N(e.fromUser.username),i=(0,v.Sy)();i.style.padding=`0px ${P}px`,i.style.left=`-${P}px`,i.style.width=`calc(100% + ${P}px)`,void 0!==e.backgroundColor&&(i.style.background=e.backgroundColor),I(t,i,c.sY.parseMessage(e)),t.appendChild(i);const r=A(e.fromUser,e);r.element.dataset.paction="Chat",r.element.dataset.pactionName="Username",r.element.style.paddingRight="4px",r.element.dataset.testid="chat-message-username",i.appendChild(r.element);const a=(0,w.e4)(e.message);return(0,o.fZ)(a,"msg-text"),a.classList.add("split-mode"),a.dataset.testid="chat-message-text",void 0!==e.textColor&&(a.style.color=e.textColor),void 0!==e.font&&(r.element.style.fontFamily=e.font,a.style.fontFamily=e.font),i.appendChild(a),(0,s.lT)()?window.setTimeout((()=>{n.A.parse(t,{className:"emojiChat"})}),0):(0,s.AD)()||n.A.parse(t,{className:"emojiChat"}),(0,m.Qp)(t),(0,v.V_)(e,t),t}function R(e){if(0===e.mediaList.length)return;const t=N(e.fromUser.username),i=(0,v.Sy)();t.appendChild(i);const s=new a._({messageId:e.messageID,outgoing:e.fromUser.username!==e.otherUsername,mediaList:e.mediaList});return s.element.style.marginTop="6px",i.appendChild(s.element),t.setAttribute("type","photo"),t.dataset.testid="chat-image",(0,v.V_)(e,t),t}function I(e,t,i){const s=void 0!==i.bgDark,n=void 0!==i.fgDark;var o,r;return!(!s&&!n)&&(e.classList.add("dm-adjust"),s&&(t.setAttribute("dm-adjust-bg",i.bgDark),t.setAttribute("dm-init-bg",null!==(o=i.background)&&void 0!==o?o:"")),n&&(t.setAttribute("dm-adjust-fg",i.fgDark),t.setAttribute("dm-init-fg",null!==(r=i.foreground)&&void 0!==r?r:"")),!0)}function E(e,t,i){for(const s of t){const t=document.createElement("div");for(const e of s)switch(e.partType){case 1:t.appendChild(H(e,i));break;case 0:t.appendChild(A(e.user).element);break;case 2:t.appendChild(U(e.message));break;case 3:t.appendChild(B("spy private show",(()=>{"privatespying"!==k.status&&(0,b.lh)(k)})));break;case 4:t.appendChild(B("start private show",(()=>{"privaterequesting"===k.status&&(0,b.sT)()})));break;default:error(`Unknown roomNotice type for: ${JSON.stringify(e)}`)}e.appendChild(t)}return e}function L(e){const t=N(),i=(0,v.Sy)();i.classList.add("msg-text"),i.style.padding=`0px ${P}px`,i.style.left=`-${P}px`,i.style.width=`calc(100% + ${P}px)`,void 0!==e.backgroundColor&&(i.style.background=e.backgroundColor),I(t,i,c.sY.parseMessage(e));const s=A(e.fromUser,e);s.element.dataset.paction="Chat",s.element.dataset.pactionName="Username",s.element.dataset.testid="chat-message-username",s.element.style.paddingRight="4px",i.appendChild(s.element);const n=(0,w.BP)(e,D,T.i5);return n.dataset.testid="chat-message-text",void 0!==e.font&&(s.element.style.fontFamily=e.font,n.style.fontFamily=e.font),i.appendChild(n),t.appendChild(i),(0,c.at)(t,document.body.classList.contains("darkmode")),(0,m.Qp)(t),(0,v.V_)(e,t),t}function D(e,t,i){const s=B(e,i);return s.dataset.testid="shortcode-link",void 0!==t&&""!==t&&(s.href=(0,d._Y)(t),s.target="_blank"),s}function B(e,t){const i=document.createElement("a");return(0,o.fZ)(i,"msg-link"),i.style.textDecoration="underline",i.innerText=e,i.onclick=t,i.style.cursor="pointer",i}function U(e){var t;const i=document.createElement("a");return i.href=(0,d._Y)(`/tag/${e}/${null!==(t=h.Aw.getState().roomGender)&&void 0!==t?t:""}`),(0,o.fZ)(i,o.aG.camSubjectTagColor),i.style.textDecoration="none",i.innerText=`#${e}`,(0,l.r)()&&(i.onclick=e=>{l.XS.fire(e)}),i}function _(e){const t=N();return t.innerText=e,t}function F(e,t){function i(e){const t=document.createElement("span");return t.innerText=e,t}const s=N(),n=t?S.R.pmSupporterNoticeAgeVerified:S.R.pmSupporterNotice;s.appendChild(i(n)),s.appendChild(document.createElement("br")),s.appendChild(i(`${S.R.pmSupporterSignUp} `));const r=B(S.R.pmSupporterMembership,(()=>{}));return r.href=(0,d._Y)(`/supporter/upgrade/?source=${h.Bm.current.PurchaseEventSources.SUPPORTER_SOURCE_PM_UPSELL}`),r.target="_blank",r.dataset.testid="supporter-upsell-link",(0,o.fZ)(r,"msg-link"),r.onclick=()=>{(0,y.bT)("SupporterPageOpened",{source:"chat"})},s.appendChild(r),s.appendChild(i(` ${S.R.pmSupporterSendPm(e)}.`)),s}function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=document.createElement("div");return t.dataset.testid="chat-message",t.classList.add("msg-text"),t.style.fontFamily="Tahoma,Arial,Helvetica,sans-serif",t.style.boxSizing="border-box",t.style.paddingTop="2px",t.style.paddingBottom="3px",t.style.paddingLeft="5px",t.style.paddingRight="5px",t.style.overflowWrap="break-word",t.style.wordWrap="break-word",t.style.wordBreak="break-word",e.length>0&&t.setAttribute("data-nick",e),t}function O(){const e=N();(0,p.ZM)(e,{display:"flex",whiteSpace:"nowrap",alignItems:"center",paddingTop:"0",paddingBottom:"0",lineHeight:".9em"});const t=document.createElement("div");(0,p.ZM)(t,{display:"inline-block",borderBottom:"1px solid",width:"100%"}),(0,o.fZ)(t,o.aG.brandColor),e.appendChild(t);const i=document.createElement("div");return i.textContent=S.R.newCapitalized,i.dataset.testid="new-line-text",(0,p.ZM)(i,{display:"inline-block",marginLeft:"12px"}),(0,o.fZ)(i,o.aG.brandColor),e.appendChild(i),e}function H(e,t){return void 0!==e.message&&t&&C.fM.isShortcodeSyntax(e.message)?(0,w.P7)(e,t,D,T.i5):function(e){let t=document.createElement("span");return!1!==e.parseEmoticon?t=(0,w.e4)(e.message):t.innerText=e.message,t.style.color=void 0!==e.foreground?e.foreground:"",t.style.backgroundColor=void 0!==e.background?e.background:"",t.style.fontWeight=void 0!==e.weight?e.weight:"",t}(e)}function W(e,t){const i=N();return i.innerText=e,i.appendChild(t),(0,g.yX)(i,(0,v.Uq)("#aaaaaa")),i.classList.add("roomNotice"),i}function $(e,t){const i=N(t);i.textContent=`${e} `;const s=document.createElement("span");return(0,o.fZ)(s,o.aG.hrefColor),s.textContent=S.R.sendDirectMessageNew,s.style.cursor="pointer",s.onclick=()=>{f.bW.fire(!0),r.$o.fire(t)},s.dataset.testid="send-dm-link",i.appendChild(s),i}u.X0.listen((e=>{k=e.chatConnection}))},3456:(e,t,i)=>{"use strict";i.d(t,{Sz:()=>m,nE:()=>g});var s=i(4936),n=i(7623),o=i(1224),r=i(6784),a=i(3955),l=i(6440),h=i(3124),d=i(5173),c=i(34),u=i(4947),p=i(1372);const m=()=>(0,l.f)("SplitModePrivateShowUX");class g extends d.Q{constructor(){super(),this.requestPending=!1,this.element.dataset.testid="private-show-request-modal",this.element.style.position="absolute",this.element.style.display="none",this.element.style.top="0",this.element.style.left="0",this.overlayClick.listen((()=>{this.hide()})),(0,r.wu)("keydown",document,(e=>{if("Escape"===e.key){if(this.requestPending)return;this.hide()}}))}initUI(e){super.initUI(e),this.privateShowDescription=this.setupPrivateShowBody(),this.confirmationButtonText=(0,p.tT)("p",null,u.R.request),this.confirmationButton=(0,p.tT)("div",{className:"actionButton","data-testid":"private-show-request-action-btn"},this.confirmationButtonText),this.closeIcon=(0,p.tT)("div",{"data-testid":"private-show-request-close-btn",height:"16",width:"16",onClick:()=>this.hide(),className:"closeIcon"});const t=(0,p.tT)("div",{className:"tooltip"},(0,p.tT)("h1",{className:"header","data-testid":"private-show-header",style:o.m.isWhiteLabel?{color:o.m.h1Color}:{}},u.R.privateShowText),this.setUpPrivateShowRateUI(),this.privateShowDescription,this.confirmationButton);this.subwrapper=(0,p.tT)("div",{className:"subwrapper"},(0,p.tT)("div",{className:"privateShowRequestInner"},this.closeIcon,t)),this.wrapper=(0,p.tT)("div",{className:"wrapper"},this.subwrapper),this.element=(0,p.tT)("div",{style:{fontFamily:"Ubuntu, Helvetica, Arial, sans-serif"}},this.wrapper)}setUpPrivateShowRateUI(){return this.showRate=(0,p.tT)("span",null),this.minimumShowTime=(0,p.tT)("span",null),(0,p.tT)("div",{className:"rateContainer"},(0,p.tT)("div",{className:"bluePill"},(0,p.tT)("div",{className:"clockIcon","data-testid":"private-show-rate"}),this.showRate),(0,p.tT)("div",{className:"bluePill","data-testid":"min-show-time"},this.minimumShowTime))}setupPrivateShowBody(){return this.videoRecordingAllowed=(0,p.tT)("div",{className:"itemDescription","data-testid":"video-recording-allowed"},(0,p.tT)("img",{src:`${STATIC_URL_ROOT}tsdefaultassets/ic_videocollection.svg`,height:"12",width:"12"}),(0,p.tT)("p",{style:o.m.isWhiteLabel?{color:o.m.textColor}:{}},u.R.recordedVideo)),(0,p.tT)("div",{className:"privateShowBodyDescriptionWrapper"},(0,p.tT)("hr",{className:"separator"}),(0,p.tT)("div",{className:"privateShowBodyDescription"},(0,p.tT)("div",{className:"itemDescription","data-testid":"private-time-broadcaster"},(0,p.tT)("img",{src:`${STATIC_URL_ROOT}tsdefaultassets/ic_privatetime.svg`,height:"12",width:"12"}),(0,p.tT)("p",{style:o.m.isWhiteLabel?{color:o.m.textColor}:{}},u.R.privateTimeWithBroadcaster)),this.videoRecordingAllowed))}showPending(e){this.requestPending=!0,this.privateShowDescription.style.display="none",this.closeIcon.style.display="none",this.showElement(),this.repositionChildren(),this.hideOverlay(),this.requestPending=!0,this.confirmationButtonText.textContent=u.R.cancelRequest,this.confirmationButton.style.marginTop="10px",this.confirmationButton.onclick=()=>{(0,c.yx)(e,!1),this.hide(),this.requestPending=!1}}show(e){const{chatConnection:t,requirements:i}=e;this.requestPending=!1,this.showRate.textContent=u.R.priceTokensPerMinuteMessage(i.price,!0),this.minimumShowTime.textContent=(0,s.VE)(u.R.privateShowMinimumMinuteMessageV2(parseInt(i.minimumMinutes))),this.privateShowDescription.style.display="block",this.closeIcon.style.display="block",this.videoRecordingAllowed.style.display=i.recordingsAllowed?"flex":"none",this.confirmationButton.style.marginTop="0px",this.confirmationButtonText.textContent=u.R.request,this.stopRequestCallback=e.stopRequest;const n=()=>{this.privateShowDescription.style.display="none",this.closeIcon.style.display="none",e.makeRequest(),this.hideOverlay(),this.requestPending=!0,this.confirmationButtonText.textContent=u.R.cancelRequest,this.confirmationButton.style.marginTop="10px",this.confirmationButton.onclick=()=>{(0,c.yx)(t,!1),this.hide(),this.requestPending=!1}};e.showConfirmation?this.confirmationButton.onclick=()=>{n()}:n(),this.showElement(),this.showOverlay(),this.repositionChildren(),this.wrapper.style.height=`${this.subwrapper.clientHeight}px`}hide(){super.hide(),void 0!==this.stopRequestCallback&&this.stopRequestCallback()}repositionChildren(){const e=document.getElementById("sendTipButton"),t=document.getElementById("ChatTabContainer");if(e&&t){const i=(0,a.$R)(e);if(this.element.style.top=i.top-90+"px",this.element.style.left=`${i.right+15}px`,this.element.style.zIndex="1001",this.isShown()){const e=this.subwrapper.getBoundingClientRect(),s=100;(0,h.K$)()&&((0,n.hj)()||(0,n.J0)())?i.x+e.width>t.getBoundingClientRect().x&&(this.element.style.top=`${i.top+i.height+10}px`,this.element.style.left=i.left-2.2*s+"px"):(i.x+e.width+s>window.innerWidth||i.x<0)&&(this.element.style.left=i.left-s/2+"px")}}}}},9311:(e,t,i)=>{"use strict";i.d(t,{i:()=>n});var s=i(1679);class n extends s.p5{createCommonButton(){const e=super.createCommonButton();return e.dataset.testid="send-tip-button",e.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",e}}},6283:(e,t,i)=>{"use strict";i.d(t,{q:()=>d});var s=i(1885),n=i(6784),o=i(6844),r=i(2939),a=i(1519),l=i(7407),h=i(3860);class d{constructor(){this.messageCount=0,this.messageSuccessCount=0,this.tipSuccessCount=0,this.tipSuccessTotal=0,this.tipFailCount=0,this.tipFailTotal=0,this.chatConnection=void 0,this.tipCallout=void 0,this.actionName="SessionMetrics",this.sendMetrics=()=>{this.careAboutMetrics()&&((0,l.bT)(this.actionName,this.getPageActionAttributes()),this.resetMetrics())},this.onModeChange=()=>{(0,l.NP)(this.getMode()),(0,l.bT)("ChangeVideoMode",{videoMode:this.getMode()}),this.careAboutMetrics()&&this.modeChangeDebounce.callFunc()},this.onTipSent=e=>{void 0!==e.amount&&(!0===e.success?(this.tipSuccessCount+=1,this.tipSuccessTotal+=e.amount):(this.tipFailCount+=1,e.amount>0&&(this.tipFailTotal+=e.amount)))},this.onMessageSent=()=>{this.messageCount+=1},this.onMessageReceived=e=>{void 0!==this.chatConnection&&e.fromUser.username===this.chatConnection.username()&&this.messageSuccessCount<this.messageCount&&(this.messageSuccessCount+=1)},this.saveRefreshMeta=()=>{if(this.careAboutMetrics()){const e={href:window.location.href,unloadTimestamp:(new Date).getTime()};try{window.sessionStorage.setItem("refreshMeta",JSON.stringify(e))}catch{return}}},this.resetMetrics(),this.loadTimestamp=(new Date).getTime(),this.pageRefreshed=this.wasRefresh(),this.currentMode=h.L.getVideoMode(),(0,l.NP)(this.currentMode),this.modeChangeDebounce=new a.a((()=>{const e=this.getMode();this.currentMode!==e&&(this.newMode=e,this.sendMetrics(),this.currentMode=e)}),{bounceLimitMS:100,debounceType:1}),r.X0.once((()=>{this.setupModeChangeListener()})),r.Gr.listen(this.sendMetrics),(0,n.wu)("beforeunload",window,this.sendMetrics),(0,n.wu)("beforeunload",window,this.saveRefreshMeta)}setupModeChangeListener(){h.L.changeVideoMode.listen(this.onModeChange)}bindChatConnection(e){e!==this.chatConnection&&(void 0!==this.chatConnection&&(this.chatConnection.event.messageSent.removeListener(this.onMessageSent),this.chatConnection.event.roomMessage.removeListener(this.onMessageReceived),s.J9.removeListener(this.onMessageReceived)),this.chatConnection=e,this.chatConnection.event.messageSent.listen(this.onMessageSent),this.chatConnection.event.roomMessage.listen(this.onMessageReceived),s.J9.listen(this.onMessageReceived))}bindTipCallout(e){return e!==this.tipCallout&&(void 0!==this.tipCallout&&this.tipCallout.tipSent.removeListener(this.onTipSent),this.tipCallout=e,this.tipCallout.tipSent.listen(this.onTipSent,!1),!0)}careAboutMetrics(){return void 0!==this.chatConnection&&!(0,o.ok)()}resetMetrics(){this.messageCount=0,this.messageSuccessCount=0,this.tipSuccessCount=0,this.tipSuccessTotal=0,this.tipFailCount=0,this.tipFailTotal=0,this.newMode=void 0,this.pageRefreshed=!1}getPageActionAttributes(){return{messageSuccessCount:this.messageSuccessCount,messageFailCount:this.messageCount-this.messageSuccessCount,tipSuccessCount:this.tipSuccessCount,tipSuccessTotal:this.tipSuccessTotal,tipFailCount:this.tipFailCount,tipFailTotal:this.tipFailTotal,refreshCount:void 0===this.pageRefreshed?void 0:Number(this.pageRefreshed),modeChange:Boolean(this.newMode),newMode:this.newMode,currentMode:this.currentMode}}getMode(){return h.L.getVideoMode()}getNavigationType(){if(void 0!==window.performance){let e=[];if(void 0!==window.performance.getEntriesByType&&(e=window.performance.getEntriesByType("navigation")),!(e.length>0))return window.performance.navigation.type;switch(e[0].type){case"navigate":return 0;case"reload":return 1;case"back_forward":return 2;case"prerender":return 3;default:return 255}}}getRefreshMeta(){try{var e;const t=null===(e=window.sessionStorage)||void 0===e?void 0:e.getItem("refreshMeta");return null!==t?JSON.parse(t):void 0}catch{return}}wasRefresh(){const e=this.getNavigationType();if(1===e)return!0;if(0===e||void 0===e){const e=this.getRefreshMeta();if(void 0===e)return;return e.href===window.location.href&&e.unloadTimestamp>this.loadTimestamp-1e4}return!1}}},8331:(e,t,i)=>{"use strict";i.d(t,{fM:()=>V,o9:()=>H,n1:()=>O,N0:()=>W});var s=i(8638),n=i(6624),o=i(7623),r=i(9447),a=i(3956),l=i(9461),h=i(369),d=i(1848),c=i(6784),u=i(213),p=i(2939),m=i(2709),g=i(3955),v=i(8423),f=i(6440),y=i(1779),b=i(6716),w=i(8936),C=i(7407),S=i(9321),x=i(34),T=i(8255),P=i(2146),k=i(3320),A=i(4947),M=i(2945),R=i(4110),I=i(3860),E=i(3306),L=i(1372);const D=new v.c_("hideAllTheaterControlsTooltips");class B extends m.u{constructor(e){super("div",e),this.disabled=!1,this.tooltipDisabled=!1}initUI(e){var t;this.element=(0,L.tT)("div",{style:{display:"inline-flex",position:"relative",alignItems:"center",justifyContent:"center",padding:"",minWidth:"32px",userSelect:"none"},className:"hover-btn drop-shadow-container","aria-label":e.tooltipText},(0,L.tT)("img",{ref:e=>this.icon=e,src:e.iconPath,draggable:!1,alt:e.tooltipText})),this.initHoverListeners(),this.hideElement(),this.showElement(),null!==(t=e.noTooltip)&&void 0!==t&&t||this.addTooltip()}initData(e){this.hideCallback=e.hideCallback,this.disableCallback=e.disableCallback,this.tooltipText=e.tooltipText}initHoverListeners(){(0,g.JR)(this.element,{ignoreTouch:!0}).listen((e=>{e?(0,r.fZ)(this.element,"hovering"):(0,r.SA)(this.element,"hovering")}))}isHovering(){return this.element.classList.contains("hovering")}getTooltipText(){return this.tooltipText}setTooltipText(e){var t;void 0===this.tooltip&&this.addTooltip(),this.tooltipText=e,null===(t=this.tooltip)||void 0===t||t.refreshTooltip.fire(),this.updateAriaLabelAndAlt(e)}clearTooltipText(){var e;this.tooltipText=void 0,null===(e=this.tooltip)||void 0===e||e.refreshTooltip.fire()}getTooltipTextOverride(){return this.tooltipTextOverride}setTooltipTextOverride(e){var t;void 0===this.tooltip&&this.addTooltip(),this.tooltipTextOverride=e,null===(t=this.tooltip)||void 0===t||t.refreshTooltip.fire()}clearTooltipTextOverride(){var e;this.tooltipTextOverride=void 0,null===(e=this.tooltip)||void 0===e||e.refreshTooltip.fire()}updateIcon(e){this.icon.src=e}changeIconAnimation(e){void 0!==this.animationClass&&this.icon.classList.remove(this.animationClass),this.animationClass=e,this.icon.classList.add("animated-icon"),this.icon.classList.add(e)}addTooltip(){void 0===this.tooltip&&(this.tooltip=new _({triggerElement:this}),this.addChild(this.tooltip))}removeTooltip(){void 0!==this.tooltip&&(this.removeChild(this.tooltip),this.tooltip=void 0,this.clearTooltipTextOverride())}disable(){var e;this.disabled=!0,(0,r.fZ)(this.element,"disabled"),this.element.ariaDisabled="true",null===(e=this.disableCallback)||void 0===e||e.call(this)}enable(){this.disabled=!1,(0,r.SA)(this.element,"disabled"),this.element.removeAttribute("aria-disabled")}isDisabled(){return this.disabled}disableTooltip(){this.tooltipDisabled=!0}enableTooltip(){this.tooltipDisabled=!1}isTooltipDisabled(){return this.tooltipDisabled}hideElement(){var e;super.hideElement(),null===(e=this.hideCallback)||void 0===e||e.call(this)}hideVisibility(){var e;this.element.style.visibility="hidden",null===(e=this.hideCallback)||void 0===e||e.call(this)}showVisibility(){this.element.style.visibility=""}updateAriaLabelAndAlt(e){this.element.ariaLabel=e,this.icon.alt=e}}class U extends B{constructor(e){super(e)}initUI(e){var t;this.element=(0,L.tT)("div",{style:{display:"inline-flex",position:"relative",alignItems:"center",userSelect:"none",justifyContent:"center"},className:"hover-btn drop-shadow-container","aria-label":e.labelText},(0,L.tT)("img",{ref:e=>this.icon=e,src:e.iconPath,draggable:!1,alt:e.labelText}),(0,L.tT)("span",{ref:e=>this.textSpan=e,style:{color:"#ffffff",fontSize:"13px",padding:"5px",display:"inline-block",textAlign:"right"}},(0,L.tT)("p",{ref:e=>this.textP=e,style:{display:"inline"}},e.labelText))),this.initHoverListeners(),this.hideElement(),this.showElement(),null!==(t=e.noTooltip)&&void 0!==t&&t||this.addTooltip()}getLabelText(){var e;return null!==(e=this.textP.textContent)&&void 0!==e?e:""}setTooltipTextFromLabel(){this.setTooltipText(this.getLabelText())}updateTextLabel(e){this.textP.textContent=e,this.repositionChildren(),this.updateAriaLabelAndAlt(e)}hideTextLabel(){this.element.style.width="32px",this.textSpan.style.display="none"}showTextLabel(){this.element.style.width="",this.textSpan.style.display="inline-block"}repositionChildren(){if(null===this.textP.textContent)return;this.textSpan.style.textAlign="left",this.textSpan.style.width="";const e=this.textSpan.offsetWidth-10+1,t=(0,g.q_)(this.textP.textContent,this.textP);this.textSpan.style.width=t>2*e?Math.ceil(t)/2+10+1+"px":t>e?`${e}px`:"",this.textSpan.style.width=`${this.textP.offsetWidth+1}px`}}class _ extends m.u{constructor(e){super("div",e),this.triggeredByTouch=!1}initData(e){super.initData(e),this.triggerElement=e.triggerElement,this.refreshTooltip=new v.c_("refreshTooltip")}initUI(e){(0,c.wu)("pointerenter",e.triggerElement.element,(t=>{if(e.triggerElement.isTooltipDisabled())return;if(!e.triggerElement.isDisabled()&&"mouse"!==t.pointerType)return;this.triggeredByTouch="mouse"!==t.pointerType;const i=this.getTooltipText();void 0!==i&&this.showTooltip(i)})),(0,c.wu)("pointerleave",e.triggerElement.element,(e=>{"mouse"===e.pointerType&&this.hideTooltip()})),(0,c.wu)("touchstart",document,(t=>{e.triggerElement.element.contains(t.target)||this.hideTooltip()})),(0,c.wu)("touchmove",document,(t=>{e.triggerElement.element.contains(t.target)||this.hideTooltip()})),(0,c.wu)("touchend",document,(t=>{e.triggerElement.element.contains(t.target)||this.hideTooltip()})),D.listen((()=>{this.hideTooltip()}),!1),this.refreshTooltip.listen((()=>this.refreshTooltipFn()),!1),this.element=(0,L.tT)("div",{style:{position:"absolute",display:"block",visibility:"hidden",opacity:"0",bottom:"calc(100% + 5px)",left:"50%",transform:"translateX(-50%)",borderRadius:"4px",backgroundColor:"rgba(0, 0, 0, .92)",padding:"8px 16px",textAlign:"center",fontSize:"13px",color:"#ffffff",width:"max-content",maxWidth:"150px",transition:"inherit",pointerEvents:"none"},className:"no-drop-shadow video-controls-tooltip"},(0,L.tT)("p",{ref:e=>this.textP=e,style:{display:"inline"}})),this.recalculateWidth()}getTooltipText(){let e;return"tooltipTextOverride"in this.triggerElement&&(e=this.triggerElement.getTooltipTextOverride()),void 0===e&&(e=this.triggerElement.getTooltipText()),e}showTooltip(e){this.textP.textContent=e,this.recalculateWidth(),this.repositionTooltipX(),this.element.style.visibility="",this.element.style.opacity="1"}hideTooltip(){this.element.style.opacity="0",this.element.style.visibility="hidden"}refreshTooltipFn(){if("hidden"===this.element.style.visibility&&!this.triggerElement.isHovering())return;const e=this.triggeredByTouch&&!this.triggerElement.isDisabled(),t=this.getTooltipText();void 0===t||e?this.hideTooltip():this.showTooltip(t)}repositionTooltipX(){var e;this.element.style.left="50%",this.element.style.transform="translateX(-50%)";const t=this.element.getBoundingClientRect(),i=null===(e=document.getElementById("TheaterModePlayer"))||void 0===e?void 0:e.getBoundingClientRect();void 0!==i&&i.right<t.right+5?this.element.style.left=this.element.offsetLeft-(t.right-i.right+5)+"px":void 0!==i&&i.left>t.left-5&&(this.element.style.left=`${this.element.offsetLeft+(i.left-t.left+5)}px`)}showElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"block";super.showElement(e),this.repositionTooltipX()}recalculateWidth(){null!==this.textP.textContent&&(0,g.q_)(this.textP.textContent,this.textP)>149?(this.element.style.width="150px",this.element.style.width=`${this.textP.offsetWidth+1}px`):this.element.style.width="max-content"}}var F=i(74),N=i(3058);const O=40;let H=!1;const W=`${STATIC_URL}theaterVideoControlsIcons/`,$="videoControls";class V extends m.u{updatePlayerData(e){var t,i;this.playerElement=e.element,this.playerSupportsAutoplayWithAudio=e.playerComponent.supportsAutoplayWithAudio,e.playerComponent instanceof S.O?(this.playerIsJPEG=!0,this.playerIsHlsPlaceholder=e.playerComponent.getIsHlsPlaceholder()):(this.playerIsJPEG=!1,this.playerIsHlsPlaceholder=!1),this.isEmbed=e.isEmbed(),this.isEmbed&&(null===(t=(i=e.playerComponent).removeFullscreenDropdown)||void 0===t||t.call(i))}constructor(e,t){var i;super(),this.player=e,this.forceHlsPlayerEvent=new v.c_("forceHlsPlayerEvent"),this.setPlayerComponentMutedEvents=new v.c_("setPlayerComponentMutedEvents"),this.setPlayerComponentVolumeMutedEvents=new v.c_("setPlayerComponentVolumeMutedEvents"),this.playerComponentEnterFullScreenModeEvent=new v.c_("playerComponentEnterFullScreenModeEvent"),this.playerComponentReadjustForceHlsOverlayOrderEvent=new v.c_("playerComponentReadjustForceHlsOverlayOrderEvent"),this.playerComponentReadjustPlayButtonContainerEvent=new v.c_("playerComponentReadjustPlayButtonContainerEvent"),this.showJpegPlayerComponentImage=new v.c_("showJpegPlayerComponentImage"),this.requestQualityModalVisibilityChange=new v.c_("requestVideoQualityButtonVisibilityChange"),this.videoOfflineChange=new v.c_("videoOfflineChange"),this.state={volume:60,isMuted:!0},this.isOffline=!1,this.isAgeVerified=!1,this.isFullscreenAvailable=!1,this.visible=!1,this.locked=!1,this.subMenusShown={videoQualityMenu:!1,switchFullscreenMenu:!1},this.isHoveringButton=!1,this.forceHlsTriggered=!1,this.forceHlsPlayButtonCreated=!1,this.hlsWaitingForInteraction=!1,this.privateAllowed=!1,this.updatePlayerData(e),(0,n.isRoomRoomlistSpaActive)()&&(this.isBroadcaster=(null===(i=l.Bm.current.loggedInUser)||void 0===i?void 0:i.username)===n.UrlState.current.state.room,n.UrlState.current.listen(["room"],(e=>{var t;this.isBroadcaster=(null===(t=l.Bm.current.loggedInUser)||void 0===t?void 0:t.username)===e.room}),this.element));const a=(0,M.JO)(window.location.search).disable_sound;if(void 0!==a&&"true"===a.toLowerCase()||"1"===a)this.state.volume=0,this.state.isMuted=!0;else if((0,o.Pf)()){const e=window.localStorage.getItem($);if(null!==e){const t=JSON.parse(e);this.state={volume:t.volume,isMuted:!this.playerSupportsAutoplayWithAudio||t.isMuted}}else this.state.isMuted=!this.playerSupportsAutoplayWithAudio}(0,C.yC)(this.state.volume,this.state.isMuted),this.browserUserAgent=window.navigator.userAgent,this.element.classList.add("theater-video-controls"),this.element.style.overflow="",this.element.style.bottom="0",this.element.style.left="0",(0,r.fZ)(this.element,"dark-gradient-bg"),(0,g.ZM)(this.element,{zIndex:3,display:"flex",alignItems:"stretch",justifyContent:"space-between"}),this.hideElement(),this.element.style.height=`${O}px`,this.initButtons(t),p.X0.listen((e=>{(0,n.isRoomRoomlistSpaActive)()||e.dossier.viewerUid===e.dossier.roomUid&&(this.isBroadcaster=!0),e.dossier.isAgeVerified?(this.privateAllowed=e.dossier.allowPrivateShow,this.showHidePrivateButton(e.chatConnection.status),e.chatConnection.event.statusChange.listen((t=>{this.showHidePrivateButton(t.currentStatus),(0,f.f)("PremPrivShow")&&"privatenotwatching"===t.currentStatus&&e.chatConnection.premiumShowActive&&this.privateIconTextButton.setTooltipTextOverride(s.i._({id:"0eoV8M",message:"Premium private shows cannot be spied on."})),"privatespying"===t.currentStatus&&b.F_.fire(void 0),this.showHideHlsPlayButton(t.currentStatus),(0,T.x_)(t.currentStatus)||("noninteractive-fullscreen"===I.L.getVideoMode()&&(this.updateFullScreenButton(),(0,y.Eh)()),this.videoQualityIconButton.icon.src="",this.maybeHideVideoQualityIconVisibility()),this.isOffline="offline"===t.currentStatus,this.updateIconsOnOfflineChange()})),e.chatConnection.event.settingsUpdate.listen((t=>{this.privateAllowed=t.allowPrivateShow&&e.dossier.isAgeVerified,this.showHidePrivateButton(e.chatConnection.status)}))):(this.privateAllowed=!1,this.showHidePrivateButton(e.chatConnection.status)),this.currentRoomContext=e,this.playerIsHlsPlaceholder&&!this.forceHlsPlayButtonCreated&&(this.forceHlsPlayButtonCreated=!0,this.createForceHlsPlayButton(),this.showHideHlsPlayButton(e.dossier.roomStatus)),this.isAgeVerified=e.dossier.isAgeVerified,this.isOffline="offline"===e.dossier.roomStatus,this.updateVolumeImage(),this.playerIsJPEG||this.updateVolumeInternal(),this.updateIcons(),this.showControls()})),this.player.videoOfflineChange.listen((e=>{this.isOffline=e})),this.player.roomStatusNotifier.displayChanged.listen((()=>{this.updateFullScreenButton()})),I.L.changeVideoMode.listen((()=>{"noninteractive-fullscreen"===I.L.getVideoMode()?this.hide():(this.show(),this.updateIcons()),D.fire()})),h.oO.listen((e=>{this.visible&&e||this.showControls()})),R.kw.listen((()=>{this.mute()})),x.Lz.listen((()=>{this.forceHlsOverlayFunc()}),!1),y._c.listen((()=>{(0,y.aS)()&&(0,y.Gy)()===this.fullscreenDiv&&I.L.setFireVideoMode("fullscreen")})),(0,c.wu)("touchstart",this.playerElement,(()=>{"split"===I.L.getVideoMode()&&this.showControls()})),(0,c.wu)("touchstart",this.element,(()=>{this.showControls()})),this.hide()}initButtons(e){this.leftControls=new d.m,(0,g.ZM)(this.leftControls,{position:"relative",display:"flex",flexGrow:0,flexShrink:0,alignItems:"stretch",justifyContent:"flex-start",minHeight:"100%",overflow:"visible",paddingLeft:"14px",paddingRight:"11px"}),this.addChild(this.leftControls),this.createVolumeIcon(),this.leftControls.addChild(this.volumeIconButton),this.createVolumeSlider(),this.leftControls.addChild(this.volumeSlider),this.createVideoQualityIconButton(e),this.leftControls.addChild(this.videoQualityIconButton),this.middleControls=new d.m,this.middleControls.element.dataset.paction="TheaterOverlayTabs",this.middleControls.element.classList.add("theater-overlay"),(0,g.ZM)(this.middleControls,{position:"relative",display:"flex",flexGrow:1,flexShrink:0,alignItems:"stretch",justifyContent:"center",minHeight:"100%",overflow:"visible"}),this.addChild(this.middleControls),this.createPrivateButton(),this.middleControls.addChild(this.privateIconTextButton),this.createShowMyCamButton(),(0,a.BG)(this.showMyCamIconTextButton)&&this.middleControls.addChild(this.showMyCamIconTextButton),this.createSendTipButton(),this.middleControls.addChild(this.sendTipIconTextButton),this.createChatButton(),this.middleControls.addChild(this.chatIconTextButton),this.createUserListButton(),this.middleControls.addChild(this.userListIconTextButton),this.createMoreRoomsButton(),this.middleControls.addChild(this.moreRoomsIconTextButton),this.rightControls=new d.m,(0,g.ZM)(this.rightControls,{position:"relative",display:"flex",flexGrow:0,columnGap:"0px",paddingRight:"14px",flexShrink:1,alignItems:"stretch",justifyContent:"flex-end",minHeight:"100%",overflow:"visible"}),this.addChild(this.rightControls),this.createTheaterModeIconButton(),this.rightControls.addChild(this.theaterModeIconButton),this.createFullscreenIconButton(),this.rightControls.addChild(this.fullscreenIconButton),this.isEmbed||(this.createSwitchFSModeIconButton(),this.rightControls.element.appendChild(this.switchFSModeIconButton.element),this.rightControls.element.appendChild(this.switchFSModeDropdown.element),this.initButtonHoverListeners())}createVideoQualityIconButton(e){this.videoQualityIconButton=new B({iconPath:"",tooltipText:A.R.videoQualityLabel,hideCallback:()=>{this.requestQualityModalVisibilityChange.fire(!1)}}),this.videoQualityIconButton.element.dataset.testid="video-quality-btn",(0,g.ZM)(this.videoQualityIconButton,{margin:"0 6px"}),(0,g.ZM)(this.videoQualityIconButton.icon,{width:"32px"}),this.isAutoQuality=!0,(0,c.wu)("click",this.videoQualityIconButton.element,(()=>{"hidden"===e.element.style.visibility?this.requestQualityModalVisibilityChange.fire(!0):this.requestQualityModalVisibilityChange.fire(!1)})),e.notifyVisibilityChanged.listen((e=>{var t,i;e?(null===(t=this.videoQualityIconButton.tooltip)||void 0===t||t.hideElement(),this.videoQualityIconButton.element.style.opacity="1",this.subMenusShown.videoQualityMenu=!0,this.lockShowingControls()):(null===(i=this.videoQualityIconButton.tooltip)||void 0===i||i.showElement(),this.videoQualityIconButton.element.style.opacity="",this.subMenusShown.videoQualityMenu=!1,this.shouldUnlockControls()&&this.unlockShowingControls())}))}createVolumeSlider(){this.volumeSlider=new z({handleDiameter:12,barWidth:50}),(0,g.ZM)(this.volumeSlider,{position:"relative",display:"inline-flex",marginBlock:"auto",marginLeft:"6px",marginRight:"6px"}),this.volumeSlider.tooltipText=A.R.volumeLabel;const e=new _({triggerElement:this.volumeSlider});(0,g.ZM)(e,{bottom:`calc(100% + ${(O-12)/2+5}px)`}),this.volumeSlider.addChild(e),this.volumeSlider.element.ariaLabel=A.R.volumeSliderLabel,this.volumeSlider.element.classList.add("hover-btn"),this.volumeSlider.element.classList.add("drop-shadow-container"),this.volumeSlider.element.dataset.testid="volume-slider";const t=e=>{e!==this.state.volume&&(this.state.volume=e,this.state.isMuted=0===this.state.volume,this.updatePlayerVolume(),this.updateVolumeImage(),this.saveSettings())};this.volumeSlider.valueChangeStart.listen((e=>{this.playerIsJPEG&&void 0!==this.currentRoomContext&&this.requestHLS(this.currentRoomContext),this.setPlayerComponentMutedEvents.fire(!1),t(e)})),this.volumeSlider.valueChanged.listen(t),this.volumeSlider.valueChangeEnd.listen((e=>{t(e),0===this.state.volume&&this.setPlayerComponentMutedEvents.fire(!0),(0,C.bT)("ChangeVolume",{volume:e}),this.saveSettings()})),(0,o.J0)()&&this.volumeSlider.hideElement()}createVolumeIcon(){this.volumeIconButton=new B({iconPath:"",tooltipText:A.R.volumeLabel}),this.volumeIconButton.element.dataset.testid="volume-button",(0,c.wu)("click",this.volumeIconButton.element,(()=>{if(!this.playerIsJPEG||this.browserUserAgent.indexOf("MSIE 10.0")>-1||this.browserUserAgent.indexOf("MSIE 9.0")>-1)(0,C.bT)("ToggleMute",{newState:!this.state.isMuted}),(0,C.bT)("ChangeVolume",{volume:this.state.volume}),this.state.isMuted?this.unmute():this.mute(),this.showControls();else{if(void 0===this.currentRoomContext)return void error("unexpected switch to hls",{},"VIDEO_");this.requestHLS(this.currentRoomContext)}}))}createPrivateButton(){this.privateIconTextButton=new U({iconPath:`${W}private-show.svg`,labelText:A.R.privateText}),this.privateIconTextButton.element.dataset.testid="private-show-btn",this.privateIconTextButton.setTooltipTextOverride(A.R.waitingToConnect),this.privateIconTextButton.disable(),(0,c.wu)("click",this.privateIconTextButton.element,(()=>{this.privateIconTextButton.isDisabled()||((0,f.f)("PremPrivShow")&&void 0!==this.currentRoomContext&&!["privatespying","privatewatching"].includes(this.currentRoomContext.chatConnection.status)?"privaterequesting"===this.currentRoomContext.chatConnection.status?(0,x.yx)(this.currentRoomContext.chatConnection):(0,x.UK)(this.currentRoomContext.chatConnection,!0,{onResolve:()=>{var e,t;void 0!==(null===(e=this.draggableCanvas)||void 0===e?void 0:e.privateWindow)&&!1!==(null===(t=this.draggableCanvas.privateWindow)||void 0===t?void 0:t.isOpen)||b.F_.fire(void 0)}}):b.F_.fire(void 0))}))}createShowMyCamButton(){this.showMyCamIconTextButton=new U({iconPath:`${W}cam-to-cam.svg`,labelText:A.R.showMyCamShow,noTooltip:!0}),this.showMyCamIconTextButton.element.dataset.testid="cam-to-cam-button"}createSendTipButton(){this.sendTipIconTextButton=new U({iconPath:`${W}tip-icon.svg`,labelText:A.R.sendTipButtonText,noTooltip:!0}),this.sendTipIconTextButton.element.id="send-tip",(0,c.wu)("click",this.sendTipIconTextButton.element,(()=>{b.f6.fire({})}))}createChatButton(){this.chatIconTextButton=new U({iconPath:`${W}chat.svg`,labelText:A.R.chatCapitalized,noTooltip:!0}),this.chatIconTextButton.element.id="chat-btn",this.chatIconTextButton.element.style.display="none",(0,c.wu)("click",this.chatIconTextButton.element,(()=>{b.y6.fire(void 0)}))}createUserListButton(){this.userListIconTextButton=new U({iconPath:`${W}users.svg`,labelText:A.R.usersText,noTooltip:!0}),N.K.listen((e=>{this.userListIconTextButton.updateTextLabel(`${A.R.usersText} (${e})`),H&&this.userListIconTextButton.setTooltipTextFromLabel()})),this.userListIconTextButton.element.id="user-list",this.userListIconTextButton.element.dataset.pactionName="Users",(0,c.wu)("click",this.userListIconTextButton.element,(()=>{b.p3.fire(void 0)}))}createMoreRoomsButton(){this.moreRoomsIconTextButton=new U({iconPath:`${W}more-rooms.svg`,labelText:A.R.moreRoomsText,noTooltip:!0}),this.moreRoomsIconTextButton.element.id="more-rooms",(0,c.wu)("click",this.moreRoomsIconTextButton.element,(()=>{this.moreRoomsIconTextButton.isDisabled()||R.nw.fire(void 0)}))}createTheaterModeIconButton(){this.theaterModeIconButton=new B({iconPath:`${W}theater-mode.svg`,tooltipText:A.R.theaterModeLabel}),this.theaterModeIconButton.changeIconAnimation("scale-wide"),this.theaterModeIconButton.element.id="theater-mode-icon",(0,c.wu)("click",this.theaterModeIconButton.element,(()=>{D.fire();let e="split";"split"===I.L.getVideoMode()&&(e="theater"),I.L.setFireVideoMode(e),this.updateIcons()}))}createFullscreenIconButton(){this.isFullscreenAvailable=(0,y.T1)()||(0,o.OF)(),(0,c.wu)((0,y.bR)(),document,(()=>{(0,y.aS)()||(this.isFullscreenAvailable=!1,this.updateFullScreenButton(),(0,u.Q$)("Full screen is unavailable."))})),this.fullscreenIconButton=new B({iconPath:`${W}fullscreen.svg`,tooltipText:A.R.fullScreenLabel}),this.fullscreenIconButton.changeIconAnimation("scale-big"),this.fullscreenIconButton.element.id="full-screen-icon",this.updateFullScreenButton(),(0,c.wu)("click",this.fullscreenIconButton.element,(()=>{D.fire(),this.toggleFullscreen()})),(0,c.wu)("dblclick",this.player.playerComponent.element,(()=>{this.isFullscreenAvailable&&["split","theater","fullscreen"].includes(I.L.getVideoMode())&&(D.fire(),this.toggleFullscreen())}))}createSwitchFSModeIconButton(){const e=()=>{var e,t;!0===(null===(e=this.switchFSModeDropdown)||void 0===e?void 0:e.isShown())&&(null===(t=this.switchFSModeDropdown)||void 0===t||t.hideElement())};this.switchFSModeIconButton=new B({iconPath:`${W}ellipsis-vertical.svg`,tooltipText:A.R.switchFullscreenModeLabel,hideCallback:e,disableCallback:e}),this.switchFSModeIconButton.element.id="fullscreen-dropdown",this.createSwitchFSModeDropdown(),this.switchFSModeDropdown.toggleEvent.listen((e=>{var t,i;void 0!==this.switchFSModeIconButton&&(e.isShowing?(null===(t=this.switchFSModeIconButton.tooltip)||void 0===t||t.hideElement(),this.switchFSModeIconButton.element.style.opacity="1",this.subMenusShown.switchFullscreenMenu=!0,this.lockShowingControls()):(null===(i=this.switchFSModeIconButton.tooltip)||void 0===i||i.showElement(),this.switchFSModeIconButton.element.style.opacity="",this.subMenusShown.switchFullscreenMenu=!1,this.shouldUnlockControls()&&this.unlockShowingControls()))}))}createSwitchFSModeDropdown(){this.switchFSModeDropdown=new E.n({toggleElement:this.switchFSModeIconButton.element,enterNativeFn:()=>this.requestNativeFullscreen(),enterInteractiveFn:()=>{}})}shouldUnlockControls(){return!this.isHoveringButton&&Object.values(this.subMenusShown).every((e=>!e))}initButtonHoverListeners(){const e=e=>{e?(this.isHoveringButton=!0,this.lockShowingControls()):(this.isHoveringButton=!1,this.shouldUnlockControls()&&this.unlockShowingControls())};(0,g.JR)(this.volumeIconButton,{ignoreTouch:!0}).listen(e),(0,g.JR)(this.volumeSlider,{ignoreTouch:!0}).listen(e),(0,g.JR)(this.videoQualityIconButton,{ignoreTouch:!0}).listen(e),(0,g.JR)(this.privateIconTextButton,{ignoreTouch:!0}).listen(e),(0,g.JR)(this.showMyCamIconTextButton,{ignoreTouch:!0}).listen(e),(0,g.JR)(this.sendTipIconTextButton,{ignoreTouch:!0}).listen(e),(0,g.JR)(this.chatIconTextButton,{ignoreTouch:!0}).listen(e),(0,g.JR)(this.userListIconTextButton,{ignoreTouch:!0}).listen(e),(0,g.JR)(this.moreRoomsIconTextButton,{ignoreTouch:!0}).listen(e),(0,g.JR)(this.theaterModeIconButton,{ignoreTouch:!0}).listen(e),(0,g.JR)(this.fullscreenIconButton,{ignoreTouch:!0}).listen(e),void 0!==this.switchFSModeIconButton&&(0,g.JR)(this.switchFSModeIconButton).listen(e)}showHidePrivateButton(e){var t;if(this.isBroadcaster||!this.privateAllowed&&!["privaterequesting","privatespying","privatewatching"].includes(e))this.privateIconTextButton.hideElement();else if("split"!==I.L.getVideoMode())switch(this.privateIconTextButton.showElement(),e){case"notconnected":if(this.player.roomStatusNotifier.isShown()&&!this.player.roomStatusNotifier.isConnectingStatusShowing())return void this.privateIconTextButton.clearTooltipTextOverride();this.privateIconTextButton.disable(),this.privateIconTextButton.setTooltipTextOverride(A.R.waitingToConnect);break;case"privatenotwatching":this.privateIconTextButton.showElement(),this.privateIconTextButton.disable(),!0===(null===(t=this.currentRoomContext)||void 0===t?void 0:t.chatConnection.premiumShowActive)?this.privateIconTextButton.setTooltipTextOverride(s.i._({id:"0eoV8M",message:"Premium private shows cannot be spied on."})):this.privateIconTextButton.clearTooltipTextOverride();break;case"unknown":case"offline":case"away":case"hidden":case"hiddenwatching":case"passwordprotected":this.privateIconTextButton.showElement(),this.privateIconTextButton.disable(),this.privateIconTextButton.clearTooltipTextOverride();break;default:this.privateIconTextButton.showElement(),this.privateIconTextButton.enable(),this.privateIconTextButton.clearTooltipTextOverride()}else this.privateIconTextButton.hideElement()}updateIcons(){var e;this.isAgeVerified?this.sendTipIconTextButton.showElement():this.sendTipIconTextButton.hideElement(),this.moreRoomsIconTextButton.showElement(),this.userListIconTextButton.showElement(),this.theaterModeIconButton.showElement(),null===(e=this.switchFSModeIconButton)||void 0===e||e.showElement(),this.videoQualityIconButton.showVisibility(),this.chatIconTextButton.showElement(),this.showMyCamIconTextButton.showElement(),void 0!==this.currentRoomContext&&this.showHidePrivateButton(this.currentRoomContext.chatConnection.status),this.updateIconsByMode(),this.maybeHideVideoQualityIconVisibility(),this.updateFullScreenButton(),this.showControls()}updateIconsByMode(){var e,t,i;switch(this.updateVideoModeButtonAppearance(),I.L.getVideoMode()){case"split":this.sendTipIconTextButton.hideElement(),this.userListIconTextButton.hideElement(),this.chatIconTextButton.hideElement(),this.privateIconTextButton.hideElement(),this.showMyCamIconTextButton.hideElement(),this.moreRoomsIconTextButton.hideElement(),null===(e=this.switchFSModeIconButton)||void 0===e||e.hideElement(),this.isEmbed&&this.theaterModeIconButton.hideElement();break;case"videoonly":this.videoQualityIconButton.hideVisibility(),this.sendTipIconTextButton.hideElement(),this.userListIconTextButton.hideElement(),this.chatIconTextButton.hideElement(),this.privateIconTextButton.hideElement(),this.showMyCamIconTextButton.hideElement(),this.moreRoomsIconTextButton.hideElement(),this.theaterModeIconButton.hideElement(),null===(t=this.switchFSModeIconButton)||void 0===t||t.hideElement();break;case"theater":null===(i=this.switchFSModeIconButton)||void 0===i||i.hideElement();break;case"fullscreen":this.theaterModeIconButton.hideElement(),void 0!==this.switchFSModeDropdown&&(0,r.fZ)(this.switchFSModeDropdown.interactiveOption,"active");break;case"noninteractive-fullscreen":void 0!==this.switchFSModeDropdown&&(0,r.fZ)(this.switchFSModeDropdown.nativeOption,"active");break;default:error(`Unexpected VideoMode: ${I.L.getVideoMode()}`,{},"VIDEO_")}}updateIconsOnOfflineChange(){this.isOffline?this.moreRoomsIconTextButton.disable():this.moreRoomsIconTextButton.enable()}recalculateControlsFlexBasis(){(0,g.ZM)(this.rightControls,{flexBasis:this.leftControls.element.offsetWidth-14+"px"}),!H&&["theater","fullscreen"].includes(I.L.getVideoMode())?(0,g.ZM)(this.middleControls,{flexBasis:"625px"}):(0,g.ZM)(this.middleControls,{flexBasis:""})}updateVolumeImage(){const e=this.volumeSlider.getValue();0===e||this.state.isMuted?(this.volumeIconButton.updateIcon(`${W}volume-mute.svg`),this.volumeIconButton.setTooltipText(A.R.unmuteCapitalized),this.volumeIconButton.element.id="volume-mute"):e<33?(this.volumeIconButton.updateIcon(`${W}volume-low.svg`),this.volumeIconButton.setTooltipText(A.R.muteLabel),this.volumeIconButton.element.id="volume-low"):e<66?(this.volumeIconButton.updateIcon(`${W}volume-medium.svg`),this.volumeIconButton.setTooltipText(A.R.muteLabel),this.volumeIconButton.element.id="volume-medium"):(this.volumeIconButton.updateIcon(`${W}volume-high.svg`),this.volumeIconButton.setTooltipText(A.R.muteLabel),this.volumeIconButton.element.id="volume-high")}updatePlayerVolume(){this.setPlayerComponentVolumeMutedEvents.fire({...this.state})}saveSettings(){if((0,o.Pf)()){const e={volume:this.state.volume,isMuted:this.state.isMuted};window.localStorage.setItem($,JSON.stringify(e))}(0,C.yC)(this.state.volume,this.state.isMuted)}update(){this.updateVolumeInternal(),this.saveSettings()}updateVolumeInternal(){this.volumeSlider.setValue(this.state.isMuted?0:this.state.volume),this.updatePlayerVolume(),this.updateVolumeImage()}mute(){this.updateIsMuted(!0),this.update()}unmute(){this.updateIsMuted(!1),0===this.state.volume&&(this.state.volume=60),this.update()}toggleMuted(){this.state.isMuted?this.unmute():this.mute()}toggle(){this.visible?this.hideControls():this.showControls()}showControls(){this.visible=!0,this.maybeShowCompactControls(),this.recalculateControlsFlexBasis(),(0,P.Ve)(this.element,"100ms"),this.element.style.opacity="1",this.element.style.visibility="",void 0!==this.hideDebounceTimer&&clearTimeout(this.hideDebounceTimer),void 0!==this.opacityTimer&&clearTimeout(this.opacityTimer),this.locked||this.startHideTimeout()}startHideTimeout(){this.hideDebounceTimer=window.setTimeout((()=>{this.hideDebounceTimer=void 0,this.opacityTimer=window.setTimeout((()=>{this.opacityTimer=void 0,this.hideControls()}),2900)}),100)}lockShowingControls(){this.locked=!0,this.showControls()}unlockShowingControls(){const e=this.locked;this.locked=!1,e&&this.startHideTimeout()}shouldShowCompactControls(){const e=I.L.getVideoMode();return"theater"===e&&(0,w.DK)()<940||"fullscreen"===e&&(0,w.DK)()<920}maybeShowCompactControls(){H=this.shouldShowCompactControls(),H?(this.privateIconTextButton.setTooltipTextFromLabel(),this.privateIconTextButton.hideTextLabel(),this.showMyCamIconTextButton.setTooltipTextFromLabel(),this.showMyCamIconTextButton.hideTextLabel(),this.sendTipIconTextButton.setTooltipTextFromLabel(),this.sendTipIconTextButton.hideTextLabel(),this.chatIconTextButton.setTooltipTextFromLabel(),this.chatIconTextButton.hideTextLabel(),this.userListIconTextButton.setTooltipTextFromLabel(),this.userListIconTextButton.hideTextLabel(),this.moreRoomsIconTextButton.setTooltipTextFromLabel(),this.moreRoomsIconTextButton.hideTextLabel(),(0,g.ZM)(this.middleControls,{columnGap:"6px"})):(this.privateIconTextButton.clearTooltipText(),this.privateIconTextButton.showTextLabel(),this.showMyCamIconTextButton.clearTooltipText(),this.showMyCamIconTextButton.showTextLabel(),this.sendTipIconTextButton.clearTooltipText(),this.sendTipIconTextButton.showTextLabel(),this.chatIconTextButton.clearTooltipText(),this.chatIconTextButton.showTextLabel(),this.userListIconTextButton.clearTooltipText(),this.userListIconTextButton.showTextLabel(),this.moreRoomsIconTextButton.clearTooltipText(),this.moreRoomsIconTextButton.showTextLabel(),(0,g.ZM)(this.middleControls,{columnGap:"24px"}))}hideControls(){this.hlsWaitingForInteraction||void 0!==this.hideDebounceTimer||this.locked||(this.visible=!1,(0,P.Ve)(this.element,"500ms"),this.requestQualityModalVisibilityChange.fire(!1),this.element.style.opacity="0",this.element.style.visibility="hidden")}show(){this.showElement(),this.showControls()}hide(){this.locked||this.hideElement()}updateVolume(e){this.state.volume=e,this.volumeSlider.setValue(this.state.isMuted?0:this.state.volume),this.updateVolumeImage()}updateIsMuted(e){this.state.isMuted=e,this.volumeSlider.setValue(this.state.isMuted?0:this.state.volume),this.updateVolumeImage()}updateAndSaveVolume(e){this.updateVolume(e),this.saveSettings()}updateAndSaveIsMuted(e){this.updateIsMuted(e),this.saveSettings()}toggleFullscreen(){this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc(),(0,y.aS)()?(0,y.Eh)():(0,o.OF)()||this.isEmbed?this.isFullscreenAvailable&&this.requestNativeFullscreen():this.toggleInteractiveFullScreen(),this.updateIcons()}requestNativeFullscreen(){this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc(),this.isFullscreenAvailable&&((0,o.OF)()?window.setTimeout((()=>{this.playerComponentEnterFullScreenModeEvent.fire(void 0)}),250):(this.hide(),this.playerComponentEnterFullScreenModeEvent.fire(void 0)))}toggleInteractiveFullScreen(){"fullscreen"===I.L.getVideoMode()?(0,y.Eh)():(0,y.lh)(this.fullscreenDiv)}updateFullScreenButton(){var e;const t=I.L.getVideoMode(),i="videoonly"===t,s="fullscreen"===t,n=this.player.roomStatusNotifier.isShown(),o=this.isFullscreenAvailable&&(!i||s),r=o&&!n,a=this.isEmbed?r:o,l="chat-player"===(null===(e=(0,y.Gy)())||void 0===e?void 0:e.id);var h;a?(this.fullscreenIconButton.showElement(),void 0!==this.switchFSModeIconButton&&s?(this.switchFSModeIconButton.showElement(),n?(this.switchFSModeIconButton.disable(),this.switchFSModeIconButton.disableTooltip()):(this.switchFSModeIconButton.enable(),this.switchFSModeIconButton.enableTooltip())):null===(h=this.switchFSModeIconButton)||void 0===h||h.hideElement()):(this.fullscreenIconButton.hideElement(),(0,y.aS)()&&l&&(0,y.Eh)())}updateVideoModeButtonAppearance(){const e=I.L.getVideoMode();"split"===e||"theater"===e?(this.fullscreenIconButton.updateIcon(`${W}fullscreen.svg`),this.fullscreenIconButton.setTooltipText(A.R.fullScreenLabel),this.fullscreenIconButton.changeIconAnimation("scale-big"),"split"===e?(this.theaterModeIconButton.setTooltipText(A.R.theaterModeLabel),this.theaterModeIconButton.changeIconAnimation("scale-wide")):(this.theaterModeIconButton.setTooltipText(A.R.defaultViewLabel),this.theaterModeIconButton.changeIconAnimation("scale-thin"))):(this.fullscreenIconButton.updateIcon(`${W}exit-fullscreen.svg`),this.fullscreenIconButton.setTooltipText(A.R.exitFullScreenLabel),this.fullscreenIconButton.changeIconAnimation("scale-small"))}forceHlsOverlayFunc(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.hlsWaitingForInteraction&&void 0!==this.currentRoomContext&&(void 0!==this.forceHlsOverlay&&null!==this.forceHlsOverlay.parentElement&&(this.forceHlsOverlay.parentElement.removeChild(this.forceHlsOverlay),this.forceHlsOverlay=void 0),void 0!==this.playButtonContainer&&null!==this.playButtonContainer.parentElement&&(this.playButtonContainer.parentElement.removeChild(this.playButtonContainer),this.playButtonContainer=void 0),this.hlsWaitingForInteraction=!1,this.hideControls(),this.hide(),this.videoQualityIconButton.hideVisibility(),!this.forceHlsTriggered&&e&&(this.forceHlsTriggered=!0,(0,C.bT)("ForceHLS"),this.forceHlsPlayerEvent.fire({roomContext:this.currentRoomContext,unmute:!1}),F.Io.fire(void 0)))}maybeForceHls(){this.playerIsJPEG&&this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc()}createHlsPlayOverlay(){this.forceHlsOverlay=document.createElement("div"),this.forceHlsOverlay.style.width="100%",this.forceHlsOverlay.style.height="100%",this.forceHlsOverlay.style.position="absolute",this.forceHlsOverlay.style.top="0",this.forceHlsOverlay.style.left="0",this.forceHlsOverlay.style.cursor="pointer",(0,c.wu)("click",this.forceHlsOverlay,(()=>{this.forceHlsOverlayFunc()})),(0,c.wu)("click",this.element,(()=>{this.forceHlsOverlayFunc()})),this.playerComponentReadjustForceHlsOverlayOrderEvent.fire(this.forceHlsOverlay)}showHideHlsPlayButton(e){void 0!==this.playButtonContainer&&void 0!==this.forceHlsOverlay&&((0,T.x_)(e)?(this.playButtonContainer.style.display="",this.forceHlsOverlay.style.display=""):(this.playButtonContainer.style.display="none",this.forceHlsOverlay.style.display="none"))}createForceHlsPlayButton(){if(this.playerIsJPEG){this.hlsWaitingForInteraction=!0,this.playButtonContainer=document.createElement("div");const e=this.playerElement.getBoundingClientRect(),t=document.createElement("img");t.src=`${STATIC_URL}play-inactive.svg`,t.style.width="60px",t.style.height="60px",t.style.position="relative",t.style.top="40px",t.style.left="45px",t.style.cursor="pointer",(0,c.wu)("click",t,(()=>{this.forceHlsOverlayFunc()})),this.playButtonContainer.style.position="absolute",this.playButtonContainer.style.top=e.height/2-70+"px",this.playButtonContainer.style.left=e.width/2-70+"px",this.playButtonContainer.style.cursor="pointer",this.playButtonContainer.style.width="140px",this.playButtonContainer.style.height="140px",this.playButtonContainer.style.borderRadius="50%",this.playButtonContainer.style.backgroundColor="rgba(0,0,0,0.25)",this.playButtonContainer.appendChild(t),this.playerComponentReadjustPlayButtonContainerEvent.fire(this.playButtonContainer),this.showJpegPlayerComponentImage.fire(void 0),this.createHlsPlayOverlay(),this.repositionChildren()}}onForceJPEG(){this.videoQualityIconButton.hideVisibility(),"noninteractive-fullscreen"===I.L.getVideoMode()&&(0,y.aS)()&&((0,y.Eh)(),y._c.fire()),this.showElement(),this.updateIcons(),this.show()}repositionChildren(){if(void 0!==this.playButtonContainer){const e=this.playerElement.getBoundingClientRect();this.playButtonContainer.style.top=e.height/2-70+"px",this.playButtonContainer.style.left=e.width/2-70+"px"}}notifySupportsAutoplayWithAudio(e){this.playerSupportsAutoplayWithAudio=e}notifyIsJPEG(e){this.playerIsJPEG=e,e&&this.videoQualityIconButton.hideVisibility()}notifyIsHlsPlaceholder(e){this.playerIsHlsPlaceholder=e}notifyVideoOfflineChange(e){this.videoOfflineChange.fire(e)}notifyQualityLevelChanged(e){this.updateVideoQualityIcon(e)}updateVideoQualityIcon(e){var t;if(this.isAutoQuality="auto"===e,this.isAutoQuality)this.videoQualityIconButton.updateIcon(`${W}quality-gear-auto.svg`);else switch((null!==(t=e.match(/\d+p/))&&void 0!==t?t:[""])[0]){case"240p":this.videoQualityIconButton.updateIcon(`${W}quality-gear-240p.svg`);break;case"360p":this.videoQualityIconButton.updateIcon(`${W}quality-gear-360p.svg`);break;case"480p":this.videoQualityIconButton.updateIcon(`${W}quality-gear-480p.svg`);break;case"540p":this.videoQualityIconButton.updateIcon(`${W}quality-gear-540p.svg`);break;case"720p":this.videoQualityIconButton.updateIcon(`${W}quality-gear-720p.svg`);break;case"1080p":this.videoQualityIconButton.updateIcon(`${W}quality-gear-hd.svg`);break;case"1440p":this.videoQualityIconButton.updateIcon(`${W}quality-gear-1440p.svg`);break;case"2160p":this.videoQualityIconButton.updateIcon(`${W}quality-gear-4k.svg`)}}maybeHideVideoQualityIconVisibility(){((0,o.J0)()||this.playerIsJPEG||""===this.videoQualityIconButton.icon.getAttribute("src"))&&this.videoQualityIconButton.hideVisibility()}setVideoQualityButtonVisibility(e){e?this.videoQualityIconButton.showVisibility():this.videoQualityIconButton.hideVisibility()}getQualityButtonLeft(){return this.videoQualityIconButton.element.offsetLeft}checkIfElementIsInVolumeControls(e){for(const t of this.volumeSlider.element.children)if(e===t)return!0;return e===this.volumeIconButton.element||e===this.volumeSlider.element||e===this.volumeSlider.handle}getRoomContext(){return this.currentRoomContext}requestHLS(e){this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc(!1),(0,C.bT)("ForceHLS"),this.forceHlsPlayerEvent.fire({roomContext:e}),this.unmute(),F.Io.fire(void 0)}addDraggableCanvas(e){this.draggableCanvas=e}}class z extends k.A{constructor(){super(...arguments),this.tooltipDisabled=!1}initUI(e){super.initUI(e),(0,g.JR)(this.element,{ignoreTouch:!0}).listen((e=>{e?(0,r.fZ)(this.element,"hovering"):(0,r.SA)(this.element,"hovering")}))}getTooltipText(){return this.tooltipText}getTooltipTextOverride(){return this.tooltipTextOverride}isTooltipDisabled(){return this.tooltipDisabled}isDisabled(){return!1}isHovering(){return this.element.classList.contains("hovering")}}},74:(e,t,i)=>{"use strict";i.d(t,{EZ:()=>a,Io:()=>n,Ne:()=>h,Sj:()=>c,ef:()=>d,i5:()=>o,mf:()=>l,pL:()=>r});var s=i(8423);const n=new s.c_("switchedToHLS"),o=new s.c_("openDefaultTipCalloutRequest"),r=new s.c_("loginOverlayRequest"),a=new s.c_("userChatSettingsUpdate",{listenersWarningThreshold:()=>50+2*s.hI}),l=new s.c_("openPhotoVideoTabRequest"),h=new s.c_("privateShowSplitModeRequest"),d=new s.c_("privateShowRequestOverlayDismiss"),c=new s.c_("resetPrivateShowLink")},3058:(e,t,i)=>{"use strict";i.d(t,{K:()=>w,R:()=>C});var s=i(9447),n=i(9757),o=i(8039),r=i(9505),a=i(2331),l=i(6784),h=i(213),d=i(2939),c=i(3955),u=i(8423),p=i(9060),m=i(7407),g=i(1452),v=i(7176),f=i(4947),y=i(9681),b=i(2091);const w=new u.c_("userCountUpdate");class C extends a.YI{constructor(){super(),this.userCount=0,this.settingInput=!1,this.activeReactUserList=(0,p.VY)(),this.element.id="UserListTab",this.element.style.overflow="visible",this.element.style.fontFamily="Tahoma, Helvetica, Arial, sans-serif",this.element.style.boxSizing="border-box",this.element.style.position="relative",this.element.dataset.pactionName="Users";const e=document.createElement("div");if((0,c.ZM)(e,{display:"flex",flexDirection:"column",width:"100%",height:"100%"}),this.element.appendChild(e),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.overflow="auto",this.wrapper.style.padding="6px",this.wrapper.style.boxSizing="border-box",this.wrapper.style.flex="1",e.appendChild(this.wrapper),this.activeReactUserList){const e=n.c.get("UserListContent");this.userListContentComponent=new e({roomUsers:[],createContextMenu:(e,t)=>{(0,m.bT)("OpenUserContextMenu",{username:e.username}),y.L.createUserContextMenu(e,t)},refreshFunc:()=>{this.refresh()},anonCount:0},this.wrapper)}else this.createAnonUsersDiv(),this.createLoadingDiv();this.inputDiv=(0,b.gI)();const t=(0,b.zh)();this.inputField=(0,b.Zw)((()=>!1),Math.max(b.hk,b.mU));const i=()=>{void 0===this.parent||this.settingInput||this.parent.changeToFirstTab()};(0,l.wu)("click",this.inputField.element,i),(0,l.wu)("focus",this.inputField.element,i),this.buttonHolder=new r.J;const s=document.createElement("span");new(n.c.get("SendButton"))({onClick:i,isPm:!1,variant:"SplitMode"},s),this.buttonHolder.addButton(s,r.z.Text),t.appendChild(this.inputField.element),this.inputDiv.appendChild(t),this.inputDiv.appendChild(this.buttonHolder.element),e.appendChild(this.inputDiv),d.X0.listen((e=>{this.chatConn=e.chatConnection,this.chatConn.event.statusChange.listen((e=>{("privatewatching"===e.previousStatus||"privatewatching"===e.currentStatus)&&window.setTimeout((()=>{this.refresh()}),2e3)})),this.chatConn.event.roomCountUpdate.listen((e=>{this.userCount=e,w.fire(this.userCount)})),this.clear(e.dossier.numViewers)})),(0,o.It)()&&o.tb.listen((e=>{this.isCurrentTab()||this.displayList(e),this.updateUserCount(e.anonCount,e.totalCount)}))}removeUserListChildren(){for(;null!==this.wrapper.firstChild;)this.wrapper.removeChild(this.wrapper.firstChild)}createAnonUsersDiv(){this.anonUsersDiv=document.createElement("div"),(0,s.fZ)(this.anonUsersDiv,s.aG.defaultTooltipColor),(0,c.ZM)(this.anonUsersDiv,{width:"100%",margin:"2px 0",whiteSpace:"nowrap",cssFloat:"left",padding:"4px 0"})}createLoadingDiv(){this.loadingDiv=document.createElement("div"),(0,s.fZ)(this.loadingDiv,s.aG.defaultColor),this.loadingDiv.innerText=`${f.R.loadingUserListText}...`,this.loadingDiv.style.margin="8px 0",this.wrapper.style.fontSize="12px",this.wrapper.appendChild(this.loadingDiv)}createRefreshUsersLink(){this.refreshDiv=document.createElement("div"),this.refreshDiv.style.margin="6px",this.refreshDiv.style.cssFloat="right";const e=document.createElement("span");e.innerText=f.R.refreshUserListText,e.style.cursor="pointer",(0,s.fZ)(e,"refreshUsersLink"),e.onmouseenter=()=>{e.style.textDecoration="underline"},e.onmouseleave=()=>{e.style.textDecoration="none"},(0,l.wu)("click",e,(e=>{this.refreshUserList(),e.preventDefault()})),this.refreshDiv.appendChild(e),this.wrapper.appendChild(this.refreshDiv)}refreshUserList(){this.activeReactUserList||(this.removeUserListChildren(),this.createLoadingDiv(),this.refresh())}clear(e){this.userCount=e,w.fire(this.userCount),this.activeReactUserList?this.userListContentComponent.update({roomUsers:[],idShowLoading:Math.random()}):(this.removeUserListChildren(),this.createLoadingDiv()),this.repositionChildren()}refresh(){if(void 0===this.chatConn)return;const e=o.SJ.getInstance();(0,o.It)()?(e.refetch().catch(g.yZ),this.displayList(e.getRoomUsersInfo())):e.fetchRoomUsers().then((e=>{this.latestRoomUsersInfo=e,this.displayList(e)})).catch((e=>{error("Error retrieving user list",e),(0,h.Q$)(f.R.errorRefreshingUserList),void 0!==this.latestRoomUsersInfo&&this.displayList(this.latestRoomUsersInfo)}))}displayList(e){if(this.activeReactUserList)this.userListContentComponent.update({roomUsers:e.roomUsers,idShowUsers:Math.random()});else{this.removeUserListChildren(),this.createRefreshUsersLink();for(const t of e.roomUsers){const e=document.createElement("div");(0,c.ZM)(e,{width:"auto",maxWidth:"100%",margin:"2px 0"}),e.appendChild(this.createUsernameLabel(t).element),this.wrapper.appendChild(e)}this.wrapper.appendChild(this.anonUsersDiv)}this.updateUserCount(e.anonCount,e.totalCount),this.repositionChildren()}updateUserCount(e,t){this.userCount=t,w.fire(t),this.activeReactUserList?this.userListContentComponent.update({anonCount:e}):this.anonUsersDiv.innerText=f.R.anonUsersCount(e)}createUsernameLabel(e){return new y.L(e,void 0,!0)}getTabHandleContent(){void 0===this.tabHandleIcon&&(this.tabHandleIcon=(0,v.DU)(),this.tabHandleIcon.style.height="1em",this.tabHandleIcon.style.paddingTop="1px");const e=document.createTextNode(f.R.userListCountCAPS(this.userCount)),t=document.createElement("span");return t.dataset.pactionName="USERS",t.style.verticalAlign="top",t.appendChild(e),[t]}getTabId(){return"users-tab-default"}focusCurrentChatInput(){this.inputField.focus()}blurCurrentChatInput(){this.inputField.blur()}isInputFocused(){return document.activeElement===this.inputField.element}scrollToBottom(){this.wrapper.scrollTop=this.wrapper.scrollHeight-this.wrapper.offsetHeight}getChatInputField(){}tabHandleClicked(e){super.tabHandleClicked(e),(0,m.bT)("FocusTab",{location:"userlist"}),this.refresh()}}},4947:(e,t,i)=>{"use strict";i.d(t,{R:()=>a});var s=i(4936),n=i(9461),o=i(5216),r=i(7882);const a={numberOfRoomsMatchesYourFilters:(e,t)=>(0,s.GW)((0,s.WI)("%(matched)s of the %(total)s live room matched your filters","%(matched)s of the %(total)s live rooms matched your filters",e),{total:e,matched:t},!0),numberOfPrivateRoomsMatchesYourFilters:(e,t)=>(0,s.GW)((0,s.WI)("%(matched)s of the %(total)s private room matched your filters","%(matched)s of the %(total)s private rooms matched your filters",e),{total:e,matched:t},!0),numberOfHiddenRoomsMatchesYourFilters:(e,t)=>(0,s.GW)((0,s.WI)("%(matched)s of the %(total)s community controlled room matched your filters","%(matched)s of the %(total)s community controlled rooms matched your filters",e),{total:e,matched:t},!0),numberOfFollowedRoomsMatchesYourFilters:(e,t)=>(0,s.GW)((0,s.WI)("%(matched)s of the %(total)s online followed room matched your filters","%(matched)s of the %(total)s online followed rooms matched your filters",e),{total:e,matched:t},!0),noRoomsMatchesYourFilters:e=>(0,s.GW)((0,s.WI)("None of the %(total)s live rooms matched your filters","None of the %(total)s live rooms matched your filters",e),{total:e},!0),noPrivateRoomsMatchesYourFilters:e=>(0,s.GW)((0,s.WI)("None of the %(total)s private rooms matched your filters","None of the %(total)s private rooms matched your filters",e),{total:e},!0),noFollowedRoomsMatchesYourFilters:e=>(0,s.GW)((0,s.WI)("None of the %(total)s online followed rooms matched your filters","None of the %(total)s online followed rooms matched your filters",e),{total:e},!0),noHiddenRoomsMatchesYourFilters:e=>(0,s.GW)((0,s.WI)("None of the %(total)s community controlled rooms matched your filters","None of the %(total)s community controlled rooms matched your filters",e),{total:e},!0),mobileDocumentTitle:(e,t,i)=>(0,s.GW)((0,s.AP)("%(username)s at %(sitename)s: %(subject)s"),{username:(0,s.VE)(e),sitename:t,subject:i},!0),documentTitle:(e,t)=>(0,s.GW)((0,s.AP)("%(username)s's Room @ %(sitename)s - Chat in a Live Adult Video Chat Room Now"),{username:(0,s.VE)(e),sitename:t},!0),tokenOrTokensText:(e,t)=>t?(0,s.WI)("Token","Tokens",e):(0,s.WI)("token","tokens",e),tokenOrTokensTextCAPS:e=>(0,s.WI)("TOKEN","TOKENS",e),tipConfirmationMessage:e=>(0,s.GW)((0,s.AP)("Confirm tip of %(tokens)s tokens"),{tokens:e.toLocaleString()},!0),subjectChangeMessage:e=>(0,s.GW)((0,s.AP)('room subject changed to "%(subject)s"'),{subject:e},!0),roomTitleMessage:e=>(0,s.GW)((0,s.AP)("%(username_title)s's Cam"),{username_title:(0,s.VE)(e)},!0),moderatorPromoteMessage:(e,t)=>(0,s.GW)((0,s.AP)("%(from)s has granted moderator privileges to %(to)s."),{from:e,to:t},!0),moderatorRevokeMessage:(e,t)=>(0,s.GW)((0,s.AP)("%(from)s has revoked moderator privileges from %(to)s."),{from:e,to:t},!0),moderatorPromoteError:e=>(0,s.GW)((0,s.AP)("Error granting moderator privileges to %(user)s."),{user:e},!0),moderatorRevokeError:e=>(0,s.GW)((0,s.AP)("Error revoking moderator privileges for %(user)s."),{user:e},!0),joinFanClubText:e=>(0,s.GW)((0,s.AP)("Join %(modelname)s's Fan Club"),{modelname:(0,s.nx)(e)},!0),joinFanClubWithTokensText:(e,t,i)=>{const n=a.joinFanClubText(e),o=(0,s.GW)((0,s.AP)("with %(tokens)s tokens for %(months)s months"),{tokens:t,months:i},!0);return n.concat(" ").concat(o)},joinFanClubTextCAPS:e=>(0,s.GW)((0,s.AP)("JOIN %(modelname)s's FAN CLUB"),{modelname:e},!0),joinFanClubPage:e=>(0,s.GW)((0,s.AP)('You will be taken to Join Fan Club Page for %(modelname)s.  Click "OK" to proceed.'),{modelname:(0,s.nx)(e)},!0),roomPicsText:e=>(0,s.GW)((0,s.AP)("%(modelname)s's Pics"),{modelname:(0,s.nx)(e)},!0),roomVidsText:e=>(0,s.GW)((0,s.AP)("%(modelname)s's Videos"),{modelname:(0,s.nx)(e)},!0),purchaseVideoText:e=>(0,s.GW)((0,s.WI)("You are about to purchase this video for %(tokens)s token","You are about to purchase this video for %(tokens)s tokens",e),{tokens:e},!0),purchasePhotosText:(e,t)=>(0,s.GW)((0,s.AP)("You are about to purchase this photo set (%(numphotos)s %(imagestext)s) for %(tokens)s %(tokenstext)s"),{numphotos:e,imagestext:(0,s.WI)("image","images",e),tokens:t,tokenstext:(0,s.WI)("token","tokens",t)},!0),unlockPhotosText:e=>(0,s.GW)((0,s.WI)("Unlock this photo set (%(numphotos)s image)","Unlock this photo set (%(numphotos)s images)",e),{numphotos:e},!0),unlockVideoText:e=>(0,s.GW)((0,s.AP)("Unlock this video (%(duration)s)"),{duration:e},!0),fanClubDisabledText:e=>(0,s.GW)((0,s.AP)("%(modelname)s has disabled their fan club."),{modelname:(0,s.nx)(e)},!0),silenceMessage:(e,t)=>(0,s.GW)((0,s.AP)("User %(username)s was silenced by %(silencer)s and their messages have been removed"),{username:e,silencer:t},!0),userKickedAndMessagesRemovedMessage:e=>(0,s.GW)((0,s.AP)("User %(username)s was kicked out of the room and their messages have been removed"),{username:e},!0),privateShowPriceChangeMessage:(e,t)=>(0,s.GW)((0,s.AP)("%(username)s changed Private Show price to %(price)s tokens per minute"),{username:e,price:t},!0),premiumPrivateShowPriceChangeMessage:(e,t)=>0===t?(0,s.GW)((0,s.AP)("%(username)s has disabled Premium Private Shows"),{username:e},!0):(0,s.GW)((0,s.AP)("%(username)s changed Premium Private Show price to %(price)s tokens per minute"),{username:e,price:t},!0),spyShowPriceChangeMessage:(e,t)=>(0,s.GW)((0,s.AP)("%(username)s changed Spy on Private Show price to %(price)s tokens per minute"),{username:e,price:t},!0),fanClubSpyPriceChangeMessage:(e,t)=>void 0===t?(0,s.GW)((0,s.AP)("%(username)s has disabled the Fan Club discount to Spy on Private Shows"),{username:e},!0):(0,s.GW)((0,s.AP)("%(username)s changed Fan Club Spy on Private Show price to %(price)s tokens per minute"),{username:e,price:t},!0),priceTokensPerMinuteMessage:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(0,s.GW)((0,s.AP)("%(price)s tokens/min"),{price:e},!0):(0,s.GW)((0,s.AP)("%(price)s tokens per minute"),{price:e},!0)},privateShowMinimumMinuteMessage:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(0,s.GW)((0,s.AP)("minimum %(minMinutes)s min(s)"),{minMinutes:e},!0):(0,s.GW)((0,s.AP)("minimum %(minMinutes)s minute(s)"),{minMinutes:e},!0)},privateShowMinimumMinuteMessageV2:e=>(0,s.GW)((0,s.AP)("Minimum %(minMinutes)s minute(s)"),{minMinutes:e},!0),privateShowConfirmMessage:(e,t,i,n)=>{let o=(0,s.GW)((0,s.AP)("Enter private chat with %(username)s?\n%(price)s tokens per minute, minimum %(minMinutes)s minute(s)\n\n"),{username:e,price:t,minMinutes:i},!0);return o+=n?(0,s.AP)("This broadcaster allows private show recordings, so you will receive a recorded video of this show in your collection."):(0,s.AP)("This broadcaster does not allow private show recordings, so you will not receive a recorded video of this show in your collection."),o},privateShowSpyConfirmMessage:e=>(0,s.GW)((0,s.AP)("Spy on private show for (%(price)s tokens per minute)"),{price:e},!0),appsRunningMessage:e=>(0,s.GW)((0,s.AP)("Broadcaster %(username)s is running these apps: "),{username:e},!0),usersRunningAppMessage:e=>(0,s.GW)((0,s.AP)("Showing users running %(appName)s"),{appName:e},!0),devportalMessage:e=>(0,s.GW)((0,s.AP)('Create or update v2 Apps in the new <a href="%(link)s" target="_blank" rel="noopener noreferrer" data-test="dev-portal-link">Developer Portal</a>.'),{link:(0,o._Y)(e)},!0),integerMinError:e=>(0,s.GW)((0,s.AP)("This field is less than the minimum of %(minimum)s"),{minimum:e},!0),integerMaxError:e=>(0,s.GW)((0,s.AP)("This field is greater than the maximum of %(maximum)s"),{maximum:e},!0),allowToVoteMessage:(e,t)=>(0,s.GW)((0,s.AP)("After tipping %(min_tokens_to_vote)s tokens in a day, you'll be able to vote regarding your satisfaction with %(room)s."),{min_tokens_to_vote:t,room:(0,s.nx)(e)},!0),confidentalVoteMessage:e=>(0,s.GW)((0,s.AP)("Your confidential vote regarding %(room)s has been recorded. You may change your vote at any time today. Thank you for your feedback."),{room:(0,s.nx)(e)},!0),shareCamText:e=>(0,s.GW)((0,s.AP)("Share %(username)s's Cam"),{username:e},!0),embedCamText:e=>(0,s.GW)((0,s.AP)("Embed %(username)s's Cam on Your Webpage"),{username:e},!0),conversationCautionMessage:e=>(0,s.GW)((0,s.AP)("Caution: The %(siteName)s Team will NEVER contact you via chat or ask for your password."),{siteName:e},!0),afterTipVoteSatisfactionText:(e,t)=>(0,s.GW)((0,s.AP)("Note: For tipping at least %(tokens)s tokens today, you can now vote what you think about %(room)s. Your vote is confidential. See below for the satisfaction feedback controls."),{tokens:t,room:(0,s.nx)(e)},!0),afterTipVoteSatMobileText:(e,t)=>(0,s.GW)((0,s.AP)("Note: For tipping at least %(tokens)s tokens today, you can now vote what you think about %(room)s. Your vote is confidential. Open the menu for the satisfaction feedback controls."),{tokens:t,room:(0,s.nx)(e)},!0),votedUpText:e=>(0,s.GW)((0,s.AP)("Note: Your confidential vote of thumbs up for %(room)s has been recorded. You may change your vote at any time today. Thank you for your feedback."),{room:(0,s.nx)(e)},!0),votedDownText:e=>(0,s.GW)((0,s.AP)("Note: Your confidential vote of thumbs down for %(room)s has been recorded. You may vote once every 90 days, and you may change your vote at any time today.  Thank you for your feedback."),{room:(0,s.nx)(e)},!0),votedDownTextRepeat:e=>(0,s.GW)((0,s.AP)("Note: Your confidential vote of thumbs down for %(room)s has been refreshed and will expire in 90 days. You may change your vote at any time today. Thank you for your feedback."),{room:(0,s.nx)(e)},!0),sureVoteDownText:e=>(0,s.GW)((0,s.AP)("Are you sure you want to rate %(room)s thumbs down?"),{room:(0,s.nx)(e)},!0),noSimilarRooms:e=>(0,s.GW)((0,s.AP)("Sorry, we don't have any rooms similar to %(room)s yet."),{room:e},!0),pmSupporterSendPm:e=>(0,s.GW)((0,s.AP)("to send a pm to %(pmUser)s"),{pmUser:e},!0),userPromotionCurrentPriceText:e=>{const t=a.userPromotionCurrentPriceLabel,i=a.tokenOrTokensText(e,!1);return"".concat(t).concat(": ").concat(String(e)).concat(" ").concat(i)},userIsIgnored:e=>(0,s.GW)((0,s.AP)("%(username)s is ignored"),{username:e},!0),ignoreUser:e=>(0,s.GW)((0,s.AP)("Ignore %(username)s"),{username:e},!0),ignoringUser:e=>(0,s.GW)((0,s.AP)("Ignoring %(username)s"),{username:e},!0),noLongerIgnoring:e=>(0,s.GW)((0,s.AP)("No longer ignoring %(username)s"),{username:e},!0),removedOldestIgnore:e=>(0,s.GW)((0,s.AP)("Ignore limit reached. Removed oldest user from list: %(username)s"),{username:e},!0),userHasBeenReported:e=>(0,s.GW)((0,s.AP)("%(username)s has been reported"),{username:e},!0),createdByUsername:e=>(0,s.GW)((0,s.AP)("by %(username)s"),{username:e},!0),errorIgnoringUser:e=>(0,s.GW)((0,s.AP)("Error ignoring user %(username)s. Please try again in a few seconds."),{username:e},!0),errorUnignoringUser:e=>(0,s.GW)((0,s.AP)("Error unignoring user %(username)s. Please try again in a few seconds."),{username:e},!0),errorFollowingUser:e=>(0,s.GW)((0,s.AP)("Error following user %(username)s. Please try again."),{username:e},!0),errorUnfollowingUser:e=>(0,s.GW)((0,s.AP)("Error unfollowing user %(username)s. Please try again."),{username:e},!0),errorVotingForUser:e=>(0,s.GW)((0,s.AP)("Error voting for user %(username)s. Please try again."),{username:e},!0),transferTokensToCashWithValue:e=>(0,s.GW)((0,s.AP)("Transfer tokens to %(cashAmount)s cash."),{cashAmount:e},!0),transferTokensToAdvertisingWithValue:e=>(0,s.GW)((0,s.AP)("Transfer tokens to %(cashAmount)s advertising credit."),{cashAmount:e},!0),overSpendingLimitResolved:e=>(0,s.GW)((0,s.AP)("Attempted to purchase %(tokens)s tokens but spending limit exceeded. This has been resolved by an administrator."),{tokens:e},!0),overSpendingLimitUnresolved:(e,t)=>(0,s.GW)((0,s.AP)("Attempted to purchase %(tokens)s tokens but spending limit exceeded. Email %(supportEmail)s ASAP to resolve."),{tokens:e,supportEmail:t},!0),purchasePhotoSet:(e,t)=>(0,s.GW)((0,s.AP)("Purchase Photo/Video (%(setName)s) from <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank'>%(username)s</a>"),{setName:e,username:t,link:(0,o._Y)(`/${t}`)},!0),sellPhotoSet:(e,t)=>(0,s.GW)((0,s.AP)("Sell Photo/Video (%(setName)s) to <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank'>%(username)s</a>"),{setName:e,username:t,link:(0,o._Y)(`/${t}`)},!0),purchaseSocialMediaFrom:(e,t)=>(0,s.GW)((0,s.AP)("Purchase social media (%(name)s) from <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank'>%(username)s</a>"),{name:e,username:t,link:(0,o._Y)(`/${t}`)},!0),sellSocialMediaTo:(e,t)=>(0,s.GW)((0,s.AP)("Sell Social media (%(name)s) to <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank'>%(username)s</a>"),{name:e,username:t,link:(0,o._Y)(`/${t}`)},!0),broadcasterWelcomeMessage:e=>(0,s.GW)((0,s.AP)("Your cam is visible to %(listVisibleTo)s. Edit this in settings & privacy."),{listVisibleTo:e},!0),privateShowRequestNotice:e=>(0,s.GW)((0,s.AP)("%(username)s wants to start a private show."),{username:e},!0),premiumPrivateShowRequestNotice:e=>(0,s.GW)((0,s.AP)("%(username)s wants to start a premium private show. This will prevent spying."),{username:e},!0),privateShowEarningsMessage:e=>(0,s.GW)((0,s.AP)("This private show will earn you %(tokens)s tokens per minute, based on your settings."),{tokens:e},!0),tokensPerMinute:e=>(0,s.GW)((0,s.AP)("%(tokens)s Per Minute"),{tokens:e},!0),banUserConfirm:e=>(0,s.GW)((0,s.AP)("Ban %(username)s?"),{username:e},!0),banUserError:e=>(0,s.GW)((0,s.AP)("Error banning user %(username)s"),{username:e},!0),banUserSuccess:e=>(0,s.GW)((0,s.AP)("User %(username)s banned from your room"),{username:e},!0),userHasTippedMe:e=>(0,s.GW)((0,s.AP)("%(username)s has tipped me"),{username:e},!0),tokensInPastHour:e=>(0,s.GW)((0,s.AP)("%(tokens)s in the past hour"),{tokens:e},!0),tokensInPastDay:e=>(0,s.GW)((0,s.AP)("%(tokens)s in the past day"),{tokens:e},!0),tokensInPastTwoWeeks:e=>(0,s.GW)((0,s.AP)("%(tokens)s in the past 2 weeks"),{tokens:e},!0),activeMembershipsMessage:e=>(0,s.GW)((0,s.WI)("You have %(numMemberships)s Active Membership","You have %(numMemberships)s Active Memberships",e),{numMemberships:e},!0),monthlyCost:e=>(0,s.GW)((0,s.AP)("$%(cost)s monthly"),{cost:e},!0),automaticallySilencedUsersMessage:e=>(0,s.GW)((0,s.WI)("We have automatically silenced %(numSilenced)s user possibly linked to a user you have previously silenced;","We have automatically silenced %(numSilenced)s users possibly linked to a user you have previously silenced;",e),{numSilenced:e},!0),automaticallyBannedUsersMessage:e=>(0,s.GW)((0,s.WI)("We have automatically banned %(numSilenced)s user possibly linked to a user you have previously banned;","We have automatically banned %(numSilenced)s users possibly linked to a user you have previously banned;",e),{numSilenced:e},!0),currentFanClubMembersTitle:e=>(0,s.GW)((0,s.WI)("%(numMembers)s Current Fan Club Member","%(numMembers)s Current Fan Club Members",e),{numMembers:e},!0),broadcastNotificationTopBarFollowerTextPluralOld:e=>(0,s.GW)((0,s.AP)("You have %(numFollowers)s followers"),{numFollowers:e},!0),userPromotionToolbarInProgressText:e=>(0,s.GW)((0,s.AP)("Promoted for %(relativeTime)s"),{relativeTime:e},!0),idAboutToExpire:e=>(0,s.GW)((0,s.AP)("An ID on your account is set to expire on %(expire)s. Please submit new ID for verification in order to continue earning tokens on uploaded content or while broadcasting with minimal disruption."),{expire:e},!0),guestIdAboutToExpire:e=>(0,s.GW)((0,s.AP)("Your Guest %(username)s has an ID expiring soon on their account. Please let your Guest know they'll need to submit an updated ID on their personal account to keep the ability to be a Guest on your account."),{username:e},!0),paxumTempNotice:()=>(0,s.GW)((0,s.AP)('Due to new requirements necessary for Paxum payouts, we need some additional information for you to continue to receive payments. <a href="%(link)s">Please visit this page to update your info</a>.'),{link:(0,o._Y)("/affiliates/payoutinfo_paxum_temp/")},!0),userPromotionReportText:e=>(0,s.GW)((0,s.AP)("Your promotion is complete - %(viewCount)s people saw your room on the homepage and Discover page."),{viewCount:e},!0),showMyCamStart:e=>(0,s.GW)((0,s.AP)("Start Cam To Cam with %(username)s"),{username:e},!0),showMyCamPreviewInfo1:e=>(0,s.GW)((0,s.AP)("Your cam will only be visible to %(username)s."),{username:e},!0),showMyCamCurrentlySharing:e=>(0,s.GW)((0,s.AP)("You are currently showing your cam to %(room)s. If your cam has ended, please wait up to 1 minute to be able to broadcast again."),{room:e},!0),showMyCamCooldownAlert:e=>(0,s.GW)((0,s.AP)("Please allow up to %(sec)s seconds before sharing your cam again."),{sec:e},!0),privateConversationWithText:e=>(0,s.GW)((0,s.AP)("Private conversation with %(username)s"),{username:e},!0),fanclubCancelConfirmMessage:e=>(0,s.GW)((0,s.AP)("Are you sure you wish to leave %(username)s's Fan Club? You will remain a member until your currently paid month expires."),{username:e},!0),loginForPasswordPrompt:e=>(0,s.GW)((0,s.AP)("%(room)s's room now requires a password. Please log in for a password prompt."),{room:e},!0),passwordRequiredForRoom:e=>(0,s.GW)((0,s.AP)("Password required for room %(room)s"),{room:e},!0),authSectionInfo:e=>(0,s.GW)((0,s.AP)("Use the <a class='hrefColor' data-testid='events-api-json-feed' target='_blank' rel='noopener' href='%(eventsUrl)s'>Events API JSON feed</a> to see your room's chat messages and events.  For more information, see the <a class='hrefColor' target='_blank' rel='noopener' style='font-size: 12px;' data-testid='events-api-documentation' href='%(documentationUrl)s'>documentation</a>."),{eventsUrl:(0,o._Y)(e),documentationUrl:(0,o._Y)("/apps/api/docs/index.html")},!0),authSectionInfo2:e=>(0,s.GW)((0,s.AP)("Scan this QR code with a third party app to let it read public events in your Chaturbate room.<br/><br/>You may also provide the <a class='hrefColor' data-testid='events-api-json-feed' target='_blank' rel='noopener' href='%(eventsUrl)s'>Events API JSON Feed URL</a> directly to the third party app.<br/><br/>See the <a class='hrefColor' target='_blank' rel='noopener' style='font-size: 12px;' data-testid='events-api-documentation' href='%(documentationUrl)s'>Events API documentation</a> for more information."),{eventsUrl:(0,o._Y)(e),documentationUrl:(0,o._Y)("/apps/api/docs/index.html")},!0),gamesText:(e,t)=>(0,s.GW)((0,s.AP)("Approved games can now be live streamed on %(siteName)s. Let us know which approved game you are playing below. If a game you would like to broadcast on %(siteName)s is not on the approved list, encourage the game developer to submit their game to the <a href='%(gamesUrl)s' target='_blank'>Multimedia Games site</a>."),{siteName:e,gamesUrl:(0,o._Y)(t)},!0),usedByText:e=>(0,s.GW)((0,s.AP)("Currently used by: %(app)s"),{app:e},!0),replaceAppConfirm:e=>(0,s.GW)((0,s.AP)("This slot is currently used by %(app)s.\nDo you want to replace it?"),{app:e},!0),noSearchResults:e=>(0,s.GW)((0,s.AP)("No search results for '%(text)s'"),{text:e},!0),noSearchResultsMatch:e=>(0,s.GW)((0,s.AP)("No search results for '%(keyword)s' match your preferences, please update your search/filter options."),{keyword:e},!0),searchResultsFor:e=>(0,s.GW)((0,s.AP)('Search results for "%(keyword)s"'),{keyword:e},!0),feedbackSentimentLabel:e=>(0,s.GW)((0,s.AP)("Overall, how was your %(siteName)s experience today?"),{siteName:e},!0),feedbackBroadcasterLabel:e=>(0,s.GW)((0,s.AP)("How was your %(siteName)s broadcast experience today?"),{siteName:e},!0),upgradeToSupporter:e=>(0,s.GW)((0,s.AP)('<a class="hrefColor" href="%(link)s">Upgrade to supporter</a> for no ads, private messaging, and more!'),{link:(0,o._Y)(e)},!0),supporterToUseFeature:e=>(0,s.GW)((0,s.AP)('<a href="%(link)s">Upgrade</a> to supporter to use this feature.'),{link:(0,o._Y)("/supporter/upgrade/?source=".concat(e))},!0),obsBroadcastWarning:e=>(0,s.GW)((0,s.AP)("WARNING: Your broadcast is live on %(siteName)s when you are streaming from RTMP/OBS, regardless of if you are in your room."),{siteName:e},!0),selectGameSectionText:(e,t)=>(0,s.GW)((0,s.AP)('If a game you would like to broadcast on %(siteName)s is not on the approved list, encourage the game developer to submit their game to the <a href="%(gamesUrl)s" target="_new">Multimedia Games Site </a>.'),{siteName:e,gamesUrl:(0,o._Y)(t)},!0),downloadOBSSectionText:e=>(0,s.GW)((0,s.AP)('You can use <a href="%(obsLink)s" data-testid="obs-download-link" target="_blank">Open Broadcaster Software</a> (OBS) to stream games and overlay with it your webcam feed. You\'ll need your <a class="streamKeyLink" data-testid="stream-key-link" href="%(obsLink)s" target="_blank">%(siteName)s stream key</a> to connect OBS to your stream. See a quick <a href="%(supportLink)s" data-testid="tutorial-link" target="_blank">tutorial</a> if you need help.'),{siteName:e,obsLink:(0,o._Y)("https://obsproject.com/"),supportLink:(0,o._Y)("https://support.chaturbate.com/hc/en-us/articles/360037971952-How-do-I-set-up-OBS-/")},!0),authorizeGameSectionText:e=>(0,s.GW)((0,s.AP)('After you go live, click <a class="closePopoutLink" data-testid="start-game-button" href="#" target="_blank">here</a> to add the gaming tag to your stream. This step is required to stream licensed games on %(siteName)s.'),{siteName:e},!0),mobileNewPrivateMessageNotice:e=>(0,s.GW)((0,s.AP)("New private message from %(username)s"),{username:e},!0),newPrivateMessageNotice:e=>(0,s.GW)((0,s.AP)("New private message from %(username)s"),{username:e},!0),newDirectMessageNotice:e=>(0,s.GW)((0,s.AP)("New direct message from %(username)s"),{username:e},!0),newConversationMessageNotice:e=>(0,s.GW)((0,s.AP)("New message from %(username)s"),{username:e},!0),sendDmToUser:e=>(0,s.GW)((0,s.AP)("Send DM to %(username)s"),{username:e},!0),tipUser:e=>(0,s.GW)((0,s.AP)("Tip %(user)s"),{user:e},!0),sendTipToUser:e=>(0,s.GW)((0,s.AP)("Send Tip to %(user)s"),{user:(0,s.VE)(e)},!0),numViewerOrViewers:e=>(0,s.GW)((0,s.WI)("%(viewerCount)s viewer","%(viewerCount)s viewers",e),{viewerCount:e},!0),obsStreamClass:e=>(0,s.GW)((0,s.AP)("Your stream is classed as %(resolutionTitle)s"),{resolutionTitle:e},!0),obsConnectionDescription:(e,t,i)=>(0,s.GW)((0,s.AP)("Connected to %(host)s in region %(region)s - Using %(streamType)s"),{host:e,region:t,streamType:i},!0),obsFPS:e=>(0,s.GW)((0,s.AP)("%(fps)s fps"),{fps:e},!0),obsBitrate:e=>(0,s.GW)((0,s.AP)("%(bitrate)s bitrate"),{bitrate:e},!0),obsAlternativeStreamType:e=>(0,s.GW)((0,s.AP)("Currently broadcasting with %(streamType)s from another browser."),{streamType:e},!0),obsSupport:e=>(0,s.GW)((0,s.AP)("Visit <a class='hrefColor' href='https://support.chaturbate.com/hc/en-us/articles/360037971952-How-do-I-set-up-OBS-' target='_blank'>our support page</a> to get started with OBS on %(siteName)s"),{siteName:e},!0),signInWithSocialAuth:e=>(0,s.GW)((0,s.AP)("Sign In with %(name)s"),{name:e},!0),createdAt:e=>(0,s.GW)((0,s.AP)("Created at %(date)s"),{date:e},!0),expiresOn:e=>(0,s.GW)((0,s.AP)("Expires on %(date)s"),{date:e},!0),followCountLong:(e,t)=>(0,s.GW)((0,s.AP)("%(online)s Online / %(total)s Following"),{online:e,total:t},!0),unableToLeavePrivateShow:e=>(0,s.GW)((0,s.AP)("Unable to leave private show from status: %(prevStatus)s"),{prevStatus:e},!0),sentTipDmNotice:e=>(0,s.GW)((0,s.WI)("You tipped %(num)s token.","You tipped %(num)s tokens.",e),{num:e},!0),receivedTipDmNotice:(e,t)=>(0,s.GW)((0,s.WI)("%(otherUser)s tipped you %(num)s token.","%(otherUser)s tipped you %(num)s tokens.",t),{otherUser:e,num:t},!0),receivedTipDmNoticeWithMessage:(e,t,i)=>(0,s.GW)((0,s.WI)("%(otherUser)s tipped you %(num)s token. -- %(message)s","%(otherUser)s tipped you %(num)s tokens. -- %(message)s",t),{otherUser:e,num:t,message:i},!0),anonUsersCount:e=>(0,s.GW)((0,s.WI)("+%(anonCount)s anonymous user","+%(anonCount)s anonymous users",e),{anonCount:e},!0),directMessagesPageTitle:(e,t)=>(0,s.GW)((0,s.AP)("Direct Messages (%(currentUsername)s) - %(otherUsername)s"),{currentUsername:e,otherUsername:t},!0),todayAtTime:e=>(0,s.GW)((0,s.AP)("Today at %(time)s"),{time:e},!0),yesterdayAtTime:e=>(0,s.GW)((0,s.AP)("Yesterday at %(time)s"),{time:e},!0),shortcodeEnteredError:e=>(0,s.GW)((0,s.AP)("Invalid shortcode message entered: %(message)s"),{message:e},!0),shortcodeFollowMessage:e=>(0,s.GW)((0,s.AP)("Follow %(username)s"),{username:e},!0),shortcodeFanclubMessage:e=>(0,s.GW)((0,s.AP)("Join %(username)s's Fan Club"),{username:e},!0),shortcodeHelpSignup:()=>(0,s.GW)((0,s.AP)("Generates a clickable link with the text \"%(signupMsg)s\". Upon clicking the link, it opens the signup page using the broadcaster user's affiliate tracking tags. The shortcode is designed to always return the signup link with the broadcaster's campaign/affiliate code, regardless of who in the broadcaster's room types in that shortcode."),{signupMsg:a.joinCB},!0),shortcodeHelpSupporter:()=>(0,s.GW)((0,s.AP)('Generates a clickable link with the text "%(supporterMsg)s". Upon clicking this link, the user is directed to the supporter page to upgrade their membership.'),{supporterMsg:a.becomeSupporter},!0),shortcodeHelpFanclub:e=>(0,s.GW)((0,s.AP)("Generates a clickable link with the text \"%(fanclubMsg)s\". When the link is clicked, it opens the broadcaster's Fan Club page. If the user doesn't have a Fan Club set up, an error dialog will be displayed to explain this."),{fanclubMsg:a.shortcodeFanclubMessage(e)},!0),shortcodeHelpFollow:e=>(0,s.GW)((0,s.AP)('Generates a clickable link with the text "%(followMsg)s". When a user clicks on this link, it triggers the user to follow the room. If the user is already following the room, the shortcode is designed to do nothing.'),{followMsg:a.shortcodeFollowMessage(e)},!0),shortcodeHelpTip:()=>(0,s.GW)((0,s.AP)('Generates a clickable link with the text representing the specified amount, such as "50 tokens." Upon clicking the link, it opens a tipping dialog with the given amount and message (in this case, "%(tipExample)s") prepopulated in the dialog. This shortcode is allowed only for broadcasters and apps.'),{tipExample:a.shortcodeHelpTipExample},!0),roomlistPageTitleHashtag:(e,t)=>(0,s.GW)((0,s.AP)("%(tagName)s Cams @ %(siteName)s -  Free Adult Webcams & Live Sex"),{tagName:e,siteName:t},!0),roomlistPageTitleFemale:e=>(0,s.GW)((0,s.AP)("Free Chat with Girls - Live Cam Girls, Free Webcam Girls at %(siteName)s"),{siteName:e},!0),roomlistPageTitleMale:e=>(0,s.GW)((0,s.AP)("Free Chat with Men - Live Gay Cams, Free Gay Webcams at %(siteName)s"),{siteName:e},!0),roomlistPageTitleCouple:e=>(0,s.GW)((0,s.AP)("Free Chat with Couples - Live Cam Couples, Free Webcam Couples at %(siteName)s"),{siteName:e},!0),roomlistPageTitleTrans:e=>(0,s.GW)((0,s.AP)("Free Chat with Trans - Live Cam Trans, Free Webcam Trans at %(siteName)s"),{siteName:e},!0),roomlistPageTitleDefault:e=>(0,s.GW)((0,s.AP)("%(siteName)s - Free Adult Webcams, Live Sex, Free Sex Chat, Exhibitionist & Pornstar Free Cams"),{siteName:e},!0),roomlistPageTitlePremium:e=>(0,s.GW)((0,s.AP)("Private & Spy Cams @ %(siteName)s - Adult Webcams & Live Sex"),{siteName:e},!0),metaTitlePremium:e=>(0,s.GW)((0,s.AP)("Premium Private Cam Shows at %(siteName)s"),{siteName:e},!0),metaTitleFemale:e=>(0,s.GW)((0,s.AP)("Free Chat with Cam Girls at %(siteName)s!"),{siteName:e},!0),metaTitleMale:e=>(0,s.GW)((0,s.AP)("Free Chat with Cam Guys at %(siteName)s!"),{siteName:e},!0),metaTitleCouples:e=>(0,s.GW)((0,s.AP)("Free Chat with Cam Couples at %(siteName)s!"),{siteName:e},!0),metaTitleTrans:e=>(0,s.GW)((0,s.AP)("Free Trans Cams and Chat at %(siteName)s!"),{siteName:e},!0),metaTitleHashtag:(e,t)=>(0,s.GW)((0,s.AP)("%(siteName)s - %(hashtag)s Live Webcams"),{siteName:e,hashtag:t},!0),metaTitleDefault:e=>(0,s.GW)((0,s.AP)("%(siteName)s - Free Adult Live Webcams!"),{siteName:e},!0),metaContentCardDescriptionHashtag:e=>(0,s.GW)((0,s.AP)("Enjoy free %(hashtag)s webcams and live chat broadcasts from amateurs. No registration required!"),{hashtag:e},!0),metaDescriptionFemale:e=>(0,s.GW)((0,s.AP)("Chat with live cams girls on %(domain)s! NSFW - Uncensored chat & adult webcams"),{domain:e},!0),metaDescriptionMale:e=>(0,s.GW)((0,s.AP)("Talk with gay guys and men instantly on %(domain)s! NSFW - Uncensored chat & gay webcams"),{domain:e},!0),metaDescriptionCouples:e=>(0,s.GW)((0,s.AP)("Watch live couples chatting on %(domain)s! NSFW - Uncensored chat & adult webcams"),{domain:e},!0),metaDescriptionTrans:e=>(0,s.GW)((0,s.AP)("Enjoy wild live trans webcams on %(domain)s! NSFW - Uncensored chat & trans webcams"),{domain:e},!0),metaKeywordsHashtag:e=>(0,s.GW)((0,s.AP)("%(hashtag)s cams, %(hashtag)s sex, %(hashtag)s xxx, %(hashtag)s porn, %(hashtag)s webcams"),{hashtag:e},!0),rssLinkTitle:(e,t)=>(0,s.GW)((0,s.AP)("%(camCategory)s Cams RSS Feed for %(siteName)s"),{camCategory:e,siteName:t},!0),genderSymbolToIconTitle:e=>{var t;const i=new Map([[r.YT.All,""],[r.YT.Male,a.maleText],[r.YT.Female,a.femaleText],[r.YT.Couple,a.coupleText],[r.YT.Trans,a.transText],[r.YT.OldTrans,a.transText]]),s=(0,r.P_)(e);return null!==(t=i.get(s))&&void 0!==t?t:""},errorLoadingDms:e=>(0,s.GW)((0,s.AP)("Error loading DM conversation with %(username)s"),{username:e},!0),v1AppsAndBotsFooterText:()=>(0,s.GW)((0,s.AP)("Create or update v1 Apps & Bots on the <a href='%(link)s' target='_blank' rel='noopener noreferrer'>v1 Apps & Bots page</a>."),{link:(0,o._Y)("/apps/")},!0),ieSupportNotification:()=>(0,s.GW)((0,s.AP)('We noticed you\'re using a web browser that we don\'t support. Upgrade to a recent version of <br> <a href="%(chromeLink)s">Chrome</a>, <a href="%(firefoxLink)s">Firefox</a>, or <a href="%(safariLink)s">Safari</a>'),{chromeLink:(0,o._Y)("https://www.google.com/chrome/"),firefoxLink:(0,o._Y)("https://www.mozilla.org/firefox/"),safariLink:(0,o._Y)("https://support.apple.com/downloads/safari/")},!0),addTFANotification:()=>(0,s.GW)((0,s.AP)('Add an extra layer of protection to your account by setting up 2-Step Verification at the <a href="%(link)s">Security Center</a>'),{link:(0,o._Y)("/security/")},!0),camAndMicPermissionSupportInfo:()=>(0,s.GW)((0,s.AP)("Visit our <a class='hrefColor' id='camAndMicInfoLink' target='_blank' href='%(link)s'>support page</a> for help enabling your devices."),{link:(0,o._Y)("https://support.chaturbate.com/hc/en-us/articles/360040862791/")},!0),enableAgeVerificationToReceiveTokens:()=>(0,s.GW)((0,s.AP)('You must <a class="hrefColor" target="_blank" href="%(link)s"> submit age verification </a> to enable the ability to receive tokens while broadcasting.'),{link:(0,o._Y)("/accounts/age_verification/")},!0),mustBeAgeVerifiedToAddSocialMedia:()=>(0,s.GW)((0,s.AP)('You must be <a href="%(link)s">age verified</a> to add new social media'),{link:(0,o._Y)("/accounts/age_verification/")},!0),mustBeAgeVerifiedToUploadContent:()=>(0,s.GW)((0,s.AP)('You must purchase tokens or be <a href="%(link)s">age verified</a> to add new photos and videos'),{link:(0,o._Y)("/accounts/age_verification/")},!0),errorUploadMediaLimit:e=>(0,s.GW)((0,s.WI)("Too many files selected. Only %(limit)s file may be uploaded at a time.","Too many files selected. Only %(limit)s files may be uploaded at a time.",e),{limit:e},!0),inactiveGuestNotice:()=>(0,s.GW)((0,s.AP)('One of your linked Guests has become inactive. <a href="%(link)s">Review your Guests</a> now.'),{link:(0,o._Y)("/accounts/age_verification/")},!0),visitMobileSiteOrFeedback:()=>(0,s.GW)((0,s.AP)('Visit the <a href="%(link)s" style="color: #0a5a83;">mobile site</a>  again, or give us some <a style="color: #0a5a83;">feedback</a> on why you left'),{link:(0,o._Y)(n.Bm.current.removeMobileSubdomain?"/?mobile_site=1":"https://m.chaturbate.com")},!0),ageVerifiedBody2:()=>(0,s.GW)((0,s.AP)('To age verify another person on your account, submit their ID at the <a href="%(link)s" target="_blank" style="white-space: nowrap;">Independent Broadcaster Verification</a> page'),{link:(0,o._Y)("/identity/")},!0),roomFilteredByHashtag:e=>(0,s.GW)((0,s.AP)("Rooms filtered by #%(hashtag)s "),{hashtag:e},!0),categoryDescriptionPrivate:e=>(0,s.GW)((0,s.AP)("Spy on private shows to experience the most exclusive shows on %(siteName)s. You won't get to interact, but it's much cheaper than buying a private show yourself."),{siteName:e},!0),seconds:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(0,s.GW)((0,s.AP)("%(seconds)s sec"),{seconds:e},!0):(0,s.GW)((0,s.WI)("%(seconds)s second","%(seconds)s seconds",e),{seconds:e},!0)},secondsAgo:e=>(0,s.GW)((0,s.WI)("%(seconds)s second ago","%(seconds)s seconds ago",e),{seconds:e},!0),secondsFromNow:e=>(0,s.GW)((0,s.WI)("%(seconds)s second from now","%(seconds)s seconds from now",e),{seconds:e},!0),minutes:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(0,s.GW)((0,s.WI)("%(minutes)s min","%(minutes)s mins",e),{minutes:e},!0):(0,s.GW)((0,s.WI)("%(minutes)s minute","%(minutes)s minutes",e),{minutes:e},!0)},minutesAgo:e=>(0,s.GW)((0,s.WI)("%(minutes)s minute ago","%(minutes)s minutes ago",e),{minutes:e},!0),minutesFromNow:e=>(0,s.GW)((0,s.WI)("%(minutes)s minute from now","%(minutes)s minutes from now",e),{minutes:e},!0),hours:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){const t=e.toFixed(1);return(0,s.GW)((0,s.WI)("%(hours)s hr","%(hours)s hrs",e),{hours:t},!0)}return(0,s.GW)((0,s.WI)("%(hours)s hour ago","%(hours)s hours ago",e),{hours:e},!0)},hoursAgo:e=>(0,s.GW)((0,s.WI)("%(hours)s hour ago","%(hours)s hours ago",e),{hours:e},!0),hoursFromNow:e=>(0,s.GW)((0,s.WI)("%(hours)s hour from now","%(hours)s hours from now",e),{hours:e},!0),days:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(0,s.GW)((0,s.WI)("%(days)s d","%(days)s d",e),{days:e},!0):(0,s.GW)((0,s.WI)("%(days)s day","%(days)s days",e),{days:e},!0)},daysAgo:e=>(0,s.GW)((0,s.WI)("%(days)s day ago","%(days)s days ago",e),{days:e},!0),daysFromNow:e=>(0,s.GW)((0,s.WI)("%(days)s day from now","%(days)s days from now",e),{days:e},!0),weeks:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(0,s.GW)((0,s.WI)("%(weeks)s wk","%(weeks)s wks",e),{weeks:e},!0):(0,s.GW)((0,s.WI)("%(weeks)s week","%(weeks)s weeks",e),{weeks:e},!0)},weeksAgo:e=>(0,s.GW)((0,s.WI)("%(weeks)s week ago","%(weeks)s weeks ago",e),{weeks:e},!0),weeksFromNow:e=>(0,s.GW)((0,s.WI)("%(weeks)s week from now","%(weeks)s weeks from now",e),{weeks:e},!0),months:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(0,s.GW)((0,s.WI)("%(months)s mo","%(months)s mos",e),{months:e},!0):(0,s.GW)((0,s.WI)("%(months)s month","%(months)s months",e),{months:e},!0)},monthsAgo:e=>(0,s.GW)((0,s.WI)("%(months)s month ago","%(months)s months ago",e),{months:e},!0),monthsFromNow:e=>(0,s.GW)((0,s.WI)("%(months)s month from now","%(months)s months from now",e),{months:e},!0),years:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(0,s.GW)((0,s.WI)("%(years)s yr","%(years)s yrs",e),{years:e},!0):(0,s.GW)((0,s.WI)("%(years)s year","%(years)s years",e),{years:e},!0)},yearsAgo:e=>(0,s.GW)((0,s.WI)("%(years)s year ago","%(years)s years ago",e),{years:e},!0),yearsFromNow:e=>(0,s.GW)((0,s.WI)("%(years)s year from now","%(years)s years from now",e),{years:e},!0),ageRangeTo:(e,t)=>{const i=String(null!=e?e:""),n=String(null!=t?t:"");return(0,s.GW)((0,s.AP)("%(fromAge)s to %(toAge)s"),{fromAge:i,toAge:n},!0)},tipSentAction:e=>(0,s.GW)((0,s.AP)("Outbound Tip: <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank'>%(username)s</a>"),{username:e,link:(0,o._Y)(`/${e}`)},!0),tipReceivedAction:e=>(0,s.GW)((0,s.AP)("Tip From: <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank'>%(username)s</a>"),{username:e,link:(0,o._Y)(`/${e}`)},!0),promotedRoomAction:e=>(0,s.GW)((0,s.AP)("Promoted Room: <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank'>%(username)s</a>"),{username:e,link:(0,o._Y)(`/${e}`)},!0),groupShowAction:e=>(0,s.GW)((0,s.AP)("Group Show: <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank'>%(username)s</a>"),{username:e,link:(0,o._Y)(`/${e}`)},!0),spyShowAction:e=>(0,s.GW)((0,s.AP)("Spy Show: <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank'>%(username)s</a>"),{username:e,link:(0,o._Y)(`/${e}`)},!0),fanClubShowAction:e=>(0,s.GW)((0,s.AP)("Fan Club Membership: <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank' data-room=\"%(username)s\">%(username)s</a>"),{username:e,link:(0,o._Y)(`/${e}`)},!0),privateShowAction:e=>(0,s.GW)((0,s.AP)("Private Show: <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank'>%(username)s</a>"),{username:e,link:(0,o._Y)(`/${e}`)},!0),premiumPrivateShowAction:e=>(0,s.GW)((0,s.AP)("Premium Private Show: <a class='hrefColor' href=\"%(link)s\" rel='noopener' target='_blank'>%(username)s</a>"),{username:e,link:(0,o._Y)(`/${e}`)},!0),adminAdjustmentAction:e=>(0,s.GW)((0,s.AP)("Admin Adjustment: %(note)s"),{note:e},!0),bioAndFreeWebCamText:e=>(0,s.GW)((0,s.AP)("%(username)s's Bio and Free Webcam"),{username:e},!0),bitrateMuchLowerThanHigh:e=>(0,s.GW)((0,s.AP)("Your bitrate is much lower than the recommended minimum of %(lowBitrate)skbps for this resolution at a high frame rate. You may need to switch to a standard frame rate."),{lowBitrate:e},!0),bitrateMuchLower:e=>(0,s.GW)((0,s.AP)("Your bitrate is much lower than the recommended minimum of %(lowBitrate)skbps for this resolution."),{lowBitrate:e},!0),bitrateLowerThanHigh:e=>(0,s.GW)((0,s.AP)("Your bitrate is lower than the recommended minimum of %(lowBitrate)skbps for this resolution at a high frame rate. You may need to switch to a standard frame rate."),{lowBitrate:e},!0),bitrateLower:e=>(0,s.GW)((0,s.AP)("Your bitrate is lower than the recommended minimum of %(lowBitrate)skbps for this resolution."),{lowBitrate:e},!0),promotionConfirmPriceText:e=>(0,s.GW)((0,s.WI)("Current Price: %(tokens)s token","Current Price: %(tokens)s tokens",e),{tokens:e},!0),tapToChatWithUser:e=>(0,s.GW)((0,s.AP)("Tap here to chat with %(username)s."),{username:e},!0),privateShowEarlyCancelMessage:(e,t)=>(0,s.GW)((0,s.AP)(" %(username)s has paid %(tokens)s tokens to end the private show early."),{username:e,tokens:t},!0),nNewMessages:e=>(0,s.GW)((0,s.WI)("%(count)s new message","%(count)s new messages",e),{count:e},!0),emoticonAutocompleteNoDelay:function(){return arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?(0,s.AP)("0s"):(0,s.AP)("No Delay - 0s")},emoticonAutocompleteShortDelay:function(){return arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?(0,s.AP)("0.5s"):(0,s.AP)("Short - 0.5s")},emoticonAutocompleteMediumDelay:function(){return arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?(0,s.AP)("1s"):(0,s.AP)("Medium - 1s")},emoticonAutocompleteLongDelay:function(){return arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?(0,s.AP)("1.5s"):(0,s.AP)("Long - 1.5s")},highestTokenColorDarkPurple:function(){return arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?(0,s.AP)("Dark Purple"):(0,s.AP)("Dark Purple (Tipped 1000 recently)")},highestTokenColorLightPurple:function(){return arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?(0,s.AP)("Light Purple"):(0,s.AP)("Light Purple (Tipped 250 recently)")},highestTokenColorDarkBlue:function(){return arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?(0,s.AP)("Dark Blue"):(0,s.AP)("Dark Blue (Tipped 50 recently)")},highestTokenColorLightBlue:function(){return arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?(0,s.AP)("Light Blue"):(0,s.AP)("Light Blue (Owns or purchased tokens)")},tokensBadge:e=>(0,s.GW)((0,s.AP)("%(tokens)s TKS"),{tokens:e},!0),userListCountCAPS:e=>(0,s.GW)((0,s.AP)("USERS (%(userCount)s)"),{userCount:e},!0),improvedMobileSite:e=>(0,s.GW)((0,s.AP)("We've improved %(siteName)s's mobile site by adding these feature(s):"),{siteName:e},!0),PmCAPS:(0,s.AP)("PM"),sendDmCAPS:(0,s.AP)("SEND DM"),pmMenuTitle:(0,s.AP)("Send PM"),dmMenuTitle:(0,s.AP)("Send DM"),pmSupporterNotice:(0,s.AP)("You must be a supporter, fan club member, or moderator to send this private message."),pmSupporterNoticeAgeVerified:(0,s.AP)("You must be a supporter, fan club member, moderator, or have received a tip today from this user to send this private message."),dmSupporterNotice:(0,s.AP)("You must be a supporter, fan club member, or moderator to send this direct message."),dmSupporterNoticeAgeVerified:(0,s.AP)("You must be a supporter, fan club member, moderator, or have received a tip in the past week from this user to send this direct message."),pmSupporterSignUp:(0,s.AP)("Sign up for a"),pmSupporterMembership:(0,s.AP)("Supporter Membership"),newPrivateMessageClickPrompt:(0,s.AP)(" (<a class='msg-link underline-link' style='cursor:pointer'>open conversation</a> or press TAB to cycle through)"),newConversationPmClickHTML:(0,s.AP)("<a class='msg-link underline-link' style='cursor:pointer'>open in PMs</a> or press TAB to cycle through"),newConversationPmClickMobile:(0,s.AP)("open in PMs"),newConversationDmClick:(0,s.AP)("open in DMs"),openConversationLower:(0,s.AP)("open conversation"),joinChaturbateCommunity:(0,s.AP)("Join Chaturbate's community."),roomSignupPopupText:(0,s.AP)("Chat live, follow broadcasters, access private shows, or earn money!"),roomSignupPopupSignupText:(0,s.AP)("Sign Up Free"),chatColor:(0,s.AP)("Chat Color"),font:(0,s.AP)("Font"),fontSize:(0,s.AP)("Font Size"),showEmoticons:(0,s.AP)("Show Emoticons"),emoticonAutoCompleteDelay:(0,s.AP)("Autocomplete Delay"),sortUsers:(0,s.AP)("Sort Users"),highestTokenColor:(0,s.AP)("Highest Token Color"),chatAllowedBy:(0,s.AP)("Chat Allowed By"),moderatorsExpireAfter:(0,s.AP)("Moderators Expire After"),silenceOtherBroadcasters:(0,s.AP)("Silence Other Age-Verified Broadcasters"),yesAlways:(0,s.AP)("Yes, Always"),preventC2CRedisplay:(0,s.AP)("Cam to Cam Notification Rate Limit"),noLimit:(0,s.AP)("No Limit"),fiveMinutes:(0,s.AP)("Once per User Every 5 Minutes"),forever:(0,s.AP)("Once per User Until You View Their Cam"),tipVolume:(0,s.AP)("Tip Volume"),collapseNotices:(0,s.AP)("Collapse Notices"),viewEditIgnoredUsers:(0,s.AP)("View/Edit Ignored Users"),tagLine:(0,s.AP)("THE ACT OF MASTURBATING WHILE CHATTING ONLINE"),tagsCAPS:(0,s.AP)("TAGS"),myCollectionText:(0,s.AP)("My Collection"),loginVerbText:(0,s.AP)("Log in"),signUpText:(0,s.AP)("Sign Up"),signUpLower:(0,s.AP)("Sign up"),defaultTipMessageLabel:(0,s.AP)("Include an optional message:"),TipOptionalMessageLabel:(0,s.AP)("Optional message:"),sendTipButtonText:(0,s.AP)("Send Tip"),sendTipButtonCAPS:(0,s.AP)("SEND TIP"),sendTipText:(0,s.AP)("Send a tip"),publicTippingText:(0,s.AP)("Public Tipping"),publicTippingDesc:(0,s.AP)("Username is visible to all users."),anonTippingText:(0,s.AP)("Anonymous Tipping"),anonTippingDesc:(0,s.AP)("Username only visible to broadcaster."),anonButtonText:(0,s.AP)("Send Anonymous Tip"),sending:(0,s.AP)("Sending..."),anonTipDisabledModalCont:(0,s.AP)("Click OK to continue to supporter signup."),mobileTipMessageLabelLandscape:(0,s.AP)("Include optional message"),mobileTipMessageLabelPortrait:(0,s.AP)("Tip note..."),mobileChatLabel:(0,s.AP)("Tap to chat..."),broadcasterDoesNotAcceptTips:(0,s.AP)("This broadcaster doesn't accept tips."),purchaseTokensText:(0,s.AP)("Purchase Tokens"),myProfileTextLc:(0,s.AP)("My Profile"),viewProfile:(0,s.AP)("View Profile"),liveChatSupportTextLc:(0,s.AP)("Live Chat Support"),logOutTextLc:(0,s.AP)("Log Out"),logoutModalText:(0,s.AP)("Are you sure you want to log out?"),switchAccountModalText:(0,s.AP)("Are you sure you want to switch accounts?"),sendFeedbackTextLc:(0,s.AP)("Send Feedback"),statusText:(0,s.AP)("Status"),tokensLabel:(0,s.AP)("You have:"),getMoreTokensLabel:(0,s.AP)("Get more tokens"),chatDisconnectedMessage:(0,s.AP)("Chat disconnected. The broadcaster has set a new password on this room."),passwordSetMessage:(0,s.AP)("This room is now password protected."),passwordRemovedMessage:(0,s.AP)("This room is no longer password protected."),privateText:(0,s.AP)("Private"),premiumShowDesc:(0,s.AP)("Premium private shows cannot be spied on."),premiumShowDisabled:(0,s.AP)("Premium private shows are disabled because spying is disabled."),privateShowStartLabel:(0,s.AP)("Start Private Show"),privateShowSpyLabel:(0,s.AP)("Spy on Private Show"),disabledShowSpyWarning:(0,s.AP)("Spying is unavailable."),premiumInProgressMessage:(0,s.AP)("Premium private show in progress."),privateShowStartedMessage:(0,s.AP)("Private show has started."),premiumPrivateShowStartedMessage:(0,s.AP)("Premium private show has started. Spying is not allowed."),privateShowFinishedMessage:(0,s.AP)("Private show has finished."),premiumPrivateShowFinishedMessage:(0,s.AP)("Premium private show has finished."),privateShowRequestLabel:(0,s.AP)("Request Private Show"),privateShowCancelRequestLabel:(0,s.AP)("Cancel Private Show Request"),privateShowRequestCancelMessage:(0,s.AP)("Cancel Private Request"),privateShowRequestCancelErrorMessage:(0,s.AP)("Cannot cancel private show. Please try again in a few seconds."),privateShowLeaveLabel:(0,s.AP)("Leave Private Show"),privateShowLeaveWarning:(0,s.AP)("Are you sure you want to leave the private show?"),privateRequestCancelConfirmation:(0,s.AP)("Are you sure you want to cancel your private show request?"),privateShowRequestMessage:(0,s.AP)("Private show request has been sent. Waiting on broadcaster to approve."),premiumPrivateShowRequestMessage:(0,s.AP)("Premium private show request has been sent. Waiting on broadcaster to approve."),privateShowRecordingSavedMessage:(0,s.AP)("A recording of this private show has been saved in the buyer's collection!"),requestPrivate:(0,s.AP)("Request Private"),cancelRequest:(0,s.AP)("Cancel Request"),leavePrivate:(0,s.AP)("Leave Private"),spyOnPrivate:(0,s.AP)("Spy on Private"),returnFromAwayModeMessage:(0,s.AP)("Broadcaster has returned from away mode."),rejoinedRoomKickedMessage:(0,s.AP)("You were disconnected because you have joined this room again."),kickedFromRoomMessage:(0,s.AP)("The broadcaster has kicked you from the room."),kickedMessage:(0,s.AP)("You were kicked from the room."),signUpToChatText:(0,s.AP)("signup to chat"),aboutMeText:(0,s.AP)("About Me"),wishListText:(0,s.AP)("Wish List"),purchasedCAPS:(0,s.AP)("PURCHASED"),orCAPS:(0,s.AP)("OR"),photosAndVideosText:(0,s.AP)("Photos and Videos"),realNameText:(0,s.AP)("Real Name"),followersText:(0,s.AP)("Followers"),sexText:(0,s.AP)("I Am"),sexTextCouple:(0,s.AP)("We are"),birthdayText:(0,s.AP)("Birthday"),birthdateText:(0,s.AP)("Birth Date"),ageText:(0,s.AP)("Age"),dateText:(0,s.AP)("Date"),actionText:(0,s.AP)("Action"),bodyTypeText:(0,s.AP)("Body Type"),bodyDecorationsText:(0,s.AP)("Body Decorations"),interstedInText:(0,s.AP)("Interested In"),locationText:(0,s.AP)("Location"),languagesText:(0,s.AP)("Language(s)"),lastBroadcastText:(0,s.AP)("Last Broadcast"),langaugesSpokenText:(0,s.AP)("Languages"),smokeDrinkText:(0,s.AP)("Smoke Drink"),smokeOrDrinkText:(0,s.AP)("Smoke / Drink"),bioUnavailableText:(0,s.AP)("User has no available BIO"),errorSubmitting:(0,s.AP)("Unable to submit"),submittingText:(0,s.AP)("Submitting..."),loadingText:(0,s.AP)("Loading"),loadingTextLower:(0,s.AP)("loading"),chatSettings:(0,s.AP)("Chat Settings"),chatSettingsTabHandleText:(0,s.AP)("SETTINGS"),chatSettingsSavedText:(0,s.AP)("Chat settings saved"),chatCAPS:(0,s.AP)("CHAT"),sendCAPS:(0,s.AP)("SEND"),tipCAPS:(0,s.AP)("TIP"),usersText:(0,s.AP)("Users"),aUser:(0,s.AP)("a user"),reportAbuseText:(0,s.AP)("Report Room"),reportAbuseTextTerms:(0,s.AP)("Your room report will be reviewed as soon as practicable."),moreRoomsText:(0,s.AP)("More Rooms"),spyPrivateShowLower:(0,s.AP)("spy private show"),unfollowText:(0,s.AP)("Unfollow"),unfollowLower:(0,s.AP)("unfollow"),followText:(0,s.AP)("Follow"),notifyMe:(0,s.AP)("Notify me"),notifyOptionAlways:(0,s.AP)("Always"),notifyOptionAuto:(0,s.AP)("Auto"),never:(0,s.AP)("Never"),refreshRoomsText:(0,s.AP)("Refresh Rooms"),womenText:(0,s.AP)("Women"),womenLower:(0,s.AP)("women"),femaleText:(0,s.AP)("Female"),menText:(0,s.AP)("Men"),menLower:(0,s.AP)("men"),maleText:(0,s.AP)("Male"),transText:(0,s.AP)("Trans"),couplesText:(0,s.AP)("Couples"),couplesLower:(0,s.AP)("couples"),coupleText:(0,s.AP)("Couple"),saveCAPS:(0,s.AP)("SAVE"),recentlyUsedEmojis:(0,s.AP)("Recently used"),smileysPeopleEmojis:(0,s.AP)("Smileys & People"),animalsNatureEmojis:(0,s.AP)("Animals & Nature"),foodDrinkEmojis:(0,s.AP)("Food & Drink"),activitiesEmojis:(0,s.AP)("Activities"),travelPlacesEmojis:(0,s.AP)("Travel & Places"),objectsEmojis:(0,s.AP)("Objects"),symbolsEmojis:(0,s.AP)("Symbols"),flagsEmojis:(0,s.AP)("Flags"),uploadEmoticonsText:(0,s.AP)("Upload"),tone:(0,s.AP)("Tone"),currentBalanceText:(0,s.AP)("Your current balance:"),balanceText:(0,s.AP)("Balance:"),tokenBalanceText:(0,s.AP)("Token Balance"),currentHaveText:(0,s.AP)("You currently have: "),satisfactionWarningText:(0,s.AP)("WARNING: This room has a low satisfaction rating."),tipWarningText:(0,s.AP)("TIP AT YOUR OWN RISK!"),tipAmountText:(0,s.AP)("Enter tip amount:"),tipAmountInvalid:(0,s.AP)("Invalid tip amount!"),amountText:(0,s.AP)("Amount:"),toggleWindowMessage:(0,s.AP)("Toggle this window with Ctrl+S"),leaveOpenCheckBoxLabel:(0,s.AP)("Leave open after tipping"),selectOneLabel:(0,s.AP)("Select One"),selectReason:(0,s.AP)("Please select a reason"),loadingUserListText:(0,s.AP)("Loading user list"),refreshUserListText:(0,s.AP)("refresh userlist"),refreshUserListSentenceCase:(0,s.AP)("Refresh userlist"),errorRefreshingUserList:(0,s.AP)("Error refreshing user list. Please try again later."),sendAMessage:(0,s.AP)("Send a message"),sendAMessageDesktop:(0,s.AP)("Send a message..."),sendPrivateMessageText:(0,s.AP)("Send private message"),sendDirectMessageText:(0,s.AP)("Send direct message"),loggedInToSendAMessage:(0,s.AP)('You must be logged in to send a message. Click "OK" to login.'),loggedInToPm:(0,s.AP)('You must be logged in to send a private message. Click "OK" to login.'),loggedInToDm:(0,s.AP)('You must be logged in to send a direct message. Click "OK" to login.'),mentionUserText:(0,s.AP)("Mention this user"),mention:(0,s.AP)("Mention"),showMoreText:(0,s.AP)("Show More"),picsAndVideosText:(0,s.AP)("Pics & Videos"),picsText:(0,s.AP)("Pictures"),vidsText:(0,s.AP)("Videos"),socialMediaText:(0,s.AP)("Social Media"),appsAndBots:(0,s.AP)("Apps & Bots"),appsTabDescription:(0,s.AP)("Add features like <strong>Tip Menus</strong>, <strong>Ticket Shows</strong>, and <strong>Top Tippers</strong> to your room with apps!"),v2AppsDescription:(0,s.AP)("v2 Apps can keep track of your top visitors and tippers across multiple broadcasts."),newCapitalized:(0,s.AP)("New"),apps:(0,s.AP)("Apps"),games:(0,s.AP)("Games"),dismissMessage:(0,s.AP)("dismiss this message"),hashtagWarning:(0,s.AP)("Only 5 #hashtags will be applied"),dismissLower:(0,s.AP)("dismiss"),registerLaterText:(0,s.AP)("Register later"),alreadyRegisteredText:(0,s.AP)("Already have an account?"),loginHereText:(0,s.AP)("Login here"),usernameText:(0,s.AP)("Username"),passwordText:(0,s.AP)("Password"),keepLoggedInText:(0,s.AP)("Keep me logged in"),forgotPassword:(0,s.AP)("Forgot password?"),incorrectPassword:(0,s.AP)("Incorrect password"),satisfactionVoting:(0,s.AP)("Satisfaction Voting"),orText:(0,s.AP)("Or "),orLower:(0,s.AP)("or"),followerBrowserNotifications:(0,s.AP)("Follower browser notifications"),allowBrowserNotificationsMessage:(0,s.AP)("Would you like to receive browser notifications when a broadcaster you follow comes online?"),followSubscribeFailedMessage:(0,s.AP)("Subscription failure. Please try again from the Settings & Privacy page on your profile."),yesText:(0,s.AP)("Yes"),notNowText:(0,s.AP)("Not now"),roomRequiresPasswordText:(0,s.AP)("This room requires a password."),loginToRoom:(0,s.AP)("Login to room"),moderators:(0,s.AP)("Moderators"),removeModerators:(0,s.AP)("Remove Moderators"),nonModerators:(0,s.AP)("Non-Moderators"),removeIgnoredUsers:(0,s.AP)("Remove Ignored Users"),unignoreThisUserText:(0,s.AP)("Unignore this user"),unignoredUsers:(0,s.AP)("Unignored Users"),unignore:(0,s.AP)("Unignore"),ignore:(0,s.AP)("Ignore"),ignoreThisUserText:(0,s.AP)("Ignore this user"),reportThisMessageText:(0,s.AP)("Report this message"),ignoredUsers:(0,s.AP)("Ignored Users"),clickToUnignoreText:(0,s.AP)("Click on a user to unignore them."),clickToUnignoreMobileText:(0,s.AP)("Select a user from the list to unignore them."),clickToUnmodText:(0,s.AP)("Click on a user to revoke their moderator status."),loginForIgnore:(0,s.AP)("You must be logged in to ignore a user"),loginForIgnoreClickOkToLogin:(0,s.AP)('You must be logged in to ignore a user. Click "OK" to login.'),reachedMaxIgnore:(0,s.AP)("You have reached the maximum number of ignored users. Ignoring a new user when at the limit will remove your oldest ignore. Click OK to continue"),roomOfflineMessage:(0,s.AP)("Room is currently offline"),instantNotificationMessage:(0,s.AP)("Follow broadcasters to receive instant notifications when they come online."),unfollow:(0,s.AP)("UNFOLLOW"),follow:(0,s.AP)("FOLLOW"),shareText:(0,s.AP)("Share"),bioText:(0,s.AP)("Bio"),contestStatsText:(0,s.AP)("Contest Stats"),settingsAndPrivacy:(0,s.AP)("Settings & Privacy"),settingsSaved:(0,s.AP)("Settings saved"),settingsNotSaved:(0,s.AP)("Please fix the errors to save the unsaved settings."),tokenStats:(0,s.AP)("Token Stats"),broadcasterStats:(0,s.AP)("Broadcaster Stats"),memberships:(0,s.AP)("Memberships"),submitYourFeedbackText:(0,s.AP)("Submit feedback to broadcaster"),optionalCommentNote:(0,s.AP)("Optional comment for broadcaster:"),commentSubmittedMessage:(0,s.AP)("Submitted"),satisfiedText:(0,s.AP)("Satisfied?"),scanCamsText:(0,s.AP)("SCAN CAMS"),nextCamText:(0,s.AP)("NEXT CAM"),scanNextText:(0,s.AP)("SCAN / NEXT"),scanText:(0,s.AP)("SCAN"),skipCamText:(0,s.AP)("SKIP CAM"),exitScanningText:(0,s.AP)("EXIT SCANNING"),tokenLinkCodesText:(0,s.AP)("Token Link codes"),earnTokensForRegisteredUsers:(0,s.AP)("Earn up to 10 tokens for every registered user and 500 tokens for users who broadcast (broadcasters must earn $20.00 before they qualify)."),linkCodeMessage:(0,s.AP)("Please send to chaturbate using one of the link codes below."),embedCBTopCamText:(0,s.AP)("Embed Chaturbate's Top Cam on Your Webpage"),affiliateProgramStatsText:(0,s.AP)("the affiliate program stats"),affiliateStatsDetails:(0,s.AP)("See details about tokens earned in "),silenceText:(0,s.AP)("Silence"),silenceDurationMessage:(0,s.AP)("Silence for 6 hours"),removeSilenceMessage:(0,s.AP)("Remove Silence"),videoQualityLabel:(0,s.AP)("Video Quality"),volumeLabel:(0,s.AP)("Volume"),volumeSliderLabel:(0,s.AP)("Volume Slider"),theaterModeLabel:(0,s.AP)("Theater Mode"),fullScreenLabel:(0,s.AP)("Fullscreen"),interactiveFullscreenLabel:(0,s.AP)("Interactive Fullscreen"),nativeFullscreenLabel:(0,s.AP)("Native Fullscreen"),switchFullscreenModeLabel:(0,s.AP)("Switch Fullscreen Mode"),exitFullScreenLabel:(0,s.AP)("Exit Fullscreen"),defaultViewLabel:(0,s.AP)("Default View"),unknownText:(0,s.AP)("unknown"),showAllText:(0,s.AP)("Show All"),anonFollowMore:(0,s.AP)(" to follow your favorite broadcasters and see when they are live."),userFollowMore:(0,s.AP)("Follow your favorite broadcasters to see when they are live."),cannotPromoteRoom:(0,s.AP)("You cannot promote this room."),userPromotionToolbarOpenBodyButton:(0,s.AP)("Promote your room"),userPromotionNotEnoughTokensText:(0,s.AP)("Not enough tokens."),userPromotionPurchaseTokensText:(0,s.AP)("Purchase more tokens"),userPromotionIneligibleText:(0,s.AP)("User promotion currently unavailable."),userPromotionPurchaserIneligibleText:(0,s.AP)("You are ineligible to promote the room."),userPromotionBadSettingsText:(0,s.AP)("User promotion currently unavailable - please check your settings."),userPromotionMustBeLoggedInAlert:(0,s.AP)("You must be logged in to promote the room."),userPromotionMustBeOnlineAlert:(0,s.AP)("User promotion currently unavailable - user must be broadcasting."),userPromotionBodyHeadline:(0,s.AP)("Get More Viewers"),userPromotionBodyDescription:(0,s.AP)("Add your room to a rotating promoted spot on the homepage for 5 minutes."),userPromotionDetails:(0,s.AP)("details"),userPromotionSubmit:(0,s.AP)("Promote now"),userPromotionCurrentPriceLabel:(0,s.AP)("Current price"),userPromotionSettingUp:(0,s.AP)("Setting up user promotion..."),userPromotionEnding:(0,s.AP)("Promotion ending..."),userPromotionPriceUnknownException:(0,s.AP)("Unknown error occurred while retrieving promotion purchase price. Please try again."),userPromotionSubmitUnknownException:(0,s.AP)("Unknown error occurred while purchasing user promotion. Please try again."),userPromotionLoadingNewPriceText:(0,s.AP)("Loading new pricing..."),broadcastNotificationTopBarOpenBodyButton:(0,s.AP)("Announce you're online"),broadcastNotificationTopBarCooldownText:(0,s.AP)("Announce again in "),broadcastNotificationTopBarFollowerTextSingularOld:(0,s.AP)("You have 1 follower"),broadcastNotificationImageContainerHeadline:(0,s.AP)("Send email and browser notifications to your followers."),broadcastNotificationUploadLink:(0,s.AP)("Add a photo"),broadcastNotificationUploadLinkReplace:(0,s.AP)("Update photo"),broadcastNotificationImageHint1:(0,s.AP)("Must be non-nude"),broadcastNotificationImageHint2:(0,s.AP)("Recommended size: 1280 x 720 px"),broadcastNotificationImageHint3:(0,s.AP)("Shown in notification and featured emails"),broadcastNotificationButtonSendNotification:(0,s.AP)("Send notifications"),broadcastNotificationButtonSendNotificationInProgress:(0,s.AP)("In Progress"),broadcastNotificationTooltip:(0,s.AP)("New photos must be approved. If not approved in 15 minutes, email notifications will be sent without a photo."),broadcastNotificationConfirmSendWithoutImage:(0,s.AP)("Are you sure you want to notify your followers without an image?"),broadcastNotificationUseApprovedFormat:(0,s.AP)("Please use a JPEG, PNG, HEIC, or HEIF image."),broadcastNotificationImageTooLarge:(0,s.AP)("Image must not be larger than 10 megabytes."),broadcastNotificationAlreadySent:(0,s.AP)("A notification has already been sent."),broadcastNotificationErrorProcessing:(0,s.AP)("Something went wrong processing your image. Please try again."),broadcastNotificationErrorAfterSubmit:(0,s.AP)("Something went wrong after submit. Please try again."),broadcastNotificationErrorDuringSubmit:(0,s.AP)("Something went wrong during submit. Please try again."),broadcastNotificationTooSmallDimensions:(0,s.AP)("Image must be at least 200px wide and 200px tall."),broadcastNotificationTooWide:(0,s.AP)("Image is too wide."),broadcastNotificationTooTall:(0,s.AP)("Image is too tall."),broadcastNotificationRemoveWhileInProgress:(0,s.AP)("Please wait until all pending notifications have been sent."),broadcastNotificationRemoveApprovedPhoto:(0,s.AP)("Remove approved photo?"),broadcastNotificationBadBrowserNotice:(0,s.AP)("Sorry, this feature is not supported in your browser. Please upgrade to a modern browser like Chrome or Firefox."),close:(0,s.AP)("Close"),closeWindow:(0,s.AP)("Close Window"),cancelText:(0,s.AP)("Cancel"),cancelLower:(0,s.AP)("cancel"),cancelCAPS:(0,s.AP)("CANCEL"),submitCAPS:(0,s.AP)("SUBMIT"),submitText:(0,s.AP)("Submit"),leave:(0,s.AP)("Leave"),request:(0,s.AP)("Request"),ending:(0,s.AP)("Ending"),started:(0,s.AP)("Started"),warnOnClosingDirty:(0,s.AP)("You have unsaved changes, are you sure you want to leave this page?"),chooseCategoryText:(0,s.AP)("Choose a category"),reportAbuse:(0,s.AP)("Report Room"),reportAbuseCatUnderage:(0,s.AP)("Broadcaster is underage"),reportAbuseCatAdvertising:(0,s.AP)("Broadcaster is advertising"),reportAbuseCatAbusive:(0,s.AP)("Broadcaster is abusive"),reportAbuseCatIntoxicated:(0,s.AP)("Broadcaster is intoxicated"),reportAbuseCatLarge:(0,s.AP)("Using a toy that is too large"),reportAbuseCatOffline:(0,s.AP)("Asking for offline payments"),reportAbuseCatPublic:(0,s.AP)("Broadcasting in public"),reportAbuseCatUniform:(0,s.AP)("Broadcasting in service uniform"),reportAbuseCatSleeping:(0,s.AP)("Broadcaster is sleeping"),reportAbuseCatGender:(0,s.AP)("Broadcaster is wrong gender"),reportAbuseCatOther:(0,s.AP)("Other"),reportAbuseCategoryRequired:(0,s.AP)("Please choose a category"),reportAbuseAdditionalComments:(0,s.AP)("Additional comments:"),reportAbuseDescriptionRequired:(0,s.AP)("Please add a description"),reportMessageInappropriate:(0,s.AP)("Message is inappropriate"),reportMessageRudeToBcaster:(0,s.AP)("Message is rude towards the broadcaster"),reportMessageSpam:(0,s.AP)("Message is spam"),reportMessageOffensiveMedia:(0,s.AP)("Media is offensive"),reportMessageOther:(0,s.AP)("Other (please describe):"),report:(0,s.AP)("Report"),reportCAPS:(0,s.AP)("REPORT"),unableToReport:(0,s.AP)("Unable to send report."),tooManyReports:(0,s.AP)("Too many reports sent. Try slowing down."),errorRequestingPrivateShow:(0,s.AP)("There was an error requesting your private show. Please try again."),errorRequestingSpyShow:(0,s.AP)("There was an error requesting your spy show. Please try again."),unableToCancelSpyShow:(0,s.AP)("Unable to cancel spy show"),unableToCancelPrivateRequest:(0,s.AP)("Unable to cancel private request"),privateShows:(0,s.AP)("Private Shows"),areYouSure:(0,s.AP)("Are you sure?"),broadcasterAllowsRecordingsText:(0,s.AP)("This broadcaster allows private show recordings, so you will receive a recorded video of this show in your collection."),performerIsAwayText:(0,s.AP)("Performer Is Away"),privateShowLeaveLabelCAPS:(0,s.AP)("LEAVE PRIVATE SHOW"),privateShowRequestCancelMessageCAPS:(0,s.AP)("CANCEL PRIVATE REQUEST"),privateShowStartLabelCAPS:(0,s.AP)("START PRIVATE SHOW"),privateShowSpyLeaveLabelCaps:(0,s.AP)("LEAVE SPY SHOW"),privateShowText:(0,s.AP)("Private Show"),privateShowInProgressText:(0,s.AP)("Private Show in Progress"),featureNotEnabled:(0,s.AP)("This feature is not currently enabled on your device."),loginForPrivateShow:(0,s.AP)('You must be logged in to enter a private show. Click "OK" to login.'),loginForPrivateShowSpy:(0,s.AP)('You must be logged in to spy on a private show. Click "OK" to login.'),privateShowSpyDisabled:(0,s.AP)("Spy has been disabled by the broadcaster."),youWillReceiveRecording:(0,s.AP)("You will receive a recorded video of this show in your collection."),broadcasterDisabledRecordings:(0,s.AP)("This broadcaster has disabled private show recordings."),privatesNotAvailable:(0,s.AP)("Private shows are not available for this broadcaster."),privateShowChatActive:(0,s.AP)("Private Show chat is active."),tapToChatWithBroadcaster:(0,s.AP)("Tap here to chat with the broadcaster."),goToPrivateTabToChat:(0,s.AP)("Go to the Private Tab to chat with the broadcaster."),moreRoomsLikeThisText:(0,s.AP)("More Rooms Like This"),trendingRoomsInstead:(0,s.AP)("Here are some trending rooms instead:"),promotedCAPS:(0,s.AP)("PROMOTED"),recommendedCAPS:(0,s.AP)("RECOMMENDED"),offlineCAPS:(0,s.AP)("OFFLINE"),exhibitionistCAPS:(0,s.AP)("EXHIBITIONIST"),newCAPS:(0,s.AP)("NEW"),inPrivateCAPS:(0,s.AP)("IN PRIVATE"),gamingCAPS:(0,s.AP)("GAMING"),hiddenStaffOnlyTextCAPS:(0,s.AP)("HIDDEN - STAFF ONLY"),viewOnTwitterText:(0,s.AP)("View on X"),showTipsAndMessages:(0,s.AP)("Show tips and messages"),seeMore:(0,s.AP)("See more"),howCanWeImproveText:(0,s.AP)("How Can We Improve?"),updatesText:(0,s.AP)("Updates"),noPicsVideos:(0,s.AP)("This user has not added any photos or videos yet."),morePics:(0,s.AP)("More Pics"),moreVideos:(0,s.AP)("More Videos"),fanTextCAPS:(0,s.AP)("FAN"),clubTextCAPS:(0,s.AP)("CLUB"),tokensCC:(0,s.AP)("Tokens"),uploadedText:(0,s.AP)("Uploaded"),purchasedPhotoSet:(0,s.AP)("If you already purchased this photo set, try reloading the page to view it."),purchasedVideo:(0,s.AP)("If you already purchased this video, try reloading the page to view it."),orSimple:(0,s.AP)("or"),hiResImage:(0,s.AP)("View Hi-Res Image"),loggedInToViewHiRes:(0,s.AP)('You must be logged in to view hi-res images.  Click "OK" to login.'),pressPurchaseTokens:(0,s.AP)('Press "Purchase Tokens" to get more.'),deactivateText:(0,s.AP)("Deactivate"),audioRemovedText:(0,s.AP)("Audio muted to remove music"),failedCAPS:(0,s.AP)("FAILED"),pendingCAPS:(0,s.AP)("PENDING"),approvalCAPS:(0,s.AP)("APPROVAL"),videoCAPS:(0,s.AP)("VIDEO"),processingCAPS:(0,s.AP)("PROCESSING"),errorCAPS:(0,s.AP)("ERROR"),failedApprovalText:(0,s.AP)("Failed Approval"),removeOffendingItemsText:(0,s.AP)("Please delete or edit offending items."),openInNewWindowText:(0,s.AP)("Open in new window"),ipadFailedToSetup:(0,s.AP)("iPad has failed to setup the broadcast. Please try again."),poorBroadcast:(0,s.AP)("Please check your internet connection or close other applications"),noCameraFound:(0,s.AP)("No camera found."),camAndMicPermissionPrompt:(0,s.AP)('We need permission to use your camera and microphone in order to proceed. When prompted by the browser, please click "Allow."'),camAndMicPermissionPromptFF:(0,s.AP)('We need permission to use your camera and microphone in order to proceed. When prompted by the browser, please check "Remember this decision" and click "Allow."'),camAndMicPermissionDenied:(0,s.AP)("Permissions to use your camera and microphone are currently denied."),needCamAndMicPermission:(0,s.AP)("We need permission to use your camera and microphone in order to proceed."),permanentPermsMessage:(0,s.AP)('We need permanent permission to use your camera and microphone. Remember to check "Remember this decision" when granting permission.'),requestDevicePermissions:(0,s.AP)("Request Device Permissions"),resolutionNotSupported:(0,s.AP)("The resolution is not supported by your device."),minResolutionNotSupported:(0,s.AP)("Your device does not support the minimum resolution."),unknownDeviceError:(0,s.AP)("Your device does not support the minimum resolution."),noOtherTabsOpen:(0,s.AP)("Make sure there are no other broadcast tabs open."),lowFPS:(0,s.AP)("Low FPS"),wantToLeaveConfirmation:(0,s.AP)("Are you sure you want to leave?"),wentToAway:(0,s.AP)('This private show has ended. To give you\ntime to prepare, you are now shown as "Away" to\nthose in your room. To return and be visible on\ncam, click "Exit Away Mode" below.'),exitAwayMode:(0,s.AP)("Exit Away Mode"),couldNotGetDevices:(0,s.AP)("Could not get devices"),turnDeviceLandscape:(0,s.AP)("Turn your device into landscape mode."),cameraLabel:(0,s.AP)("Camera"),resolutionLabel:(0,s.AP)("Resolution"),microphoneLabel:(0,s.AP)("Microphone"),inputLevelLabel:(0,s.AP)("Input Level"),muteLabel:(0,s.AP)("Mute"),noMicrophone:(0,s.AP)("None (Silent)"),startBroadcasting:(0,s.AP)("Start Broadcasting"),stopBroadcasting:(0,s.AP)("Stop Broadcasting"),youAreAway:(0,s.AP)("You Are Away"),highQualityStream:(0,s.AP)("For high quality streams we strongly recommend"),useOBS:(0,s.AP)("Use external software (OBS)"),pleaseWaitConnecting:(0,s.AP)("Please wait. Connecting in"),couldNotStartBroadcast:(0,s.AP)("Could not start broadcast"),welcomeBack:(0,s.AP)("Welcome back"),couldNotSetupPreview:(0,s.AP)("Could not setup preview. Please make any possible adjustments and reload the page"),couldNotSetupBroadcast:(0,s.AP)("Could not setup broadcast"),showMyCamPreviewTitle:(0,s.AP)("My Cam Preview"),showMyCamShow:(0,s.AP)("Cam To Cam"),showMyCamStop:(0,s.AP)("Stop Cam To Cam"),showMyCamLoginRequired:(0,s.AP)("You must be logged in to share your cam"),showMyCamAlreadyBroadcasting:(0,s.AP)("Unable to share cam: You are already broadcasting from another window or tab"),showMyCamPreviewInfo2:(0,s.AP)("The cam icon will turn orange when the broadcaster is viewing you."),showMyCamBroadcastError:(0,s.AP)("Error sharing cam"),showMyCamBroadcastTimeoutError:(0,s.AP)("Error sharing cam: Timed out trying to connect"),showMyCamCouldNotView:(0,s.AP)("Error viewing cam"),showMyCamMustBeConnected:(0,s.AP)("Unable to share cam: Make sure you are connected to chat and the broadcast is playing"),showMyCamMayNotShareIsPrivate:(0,s.AP)("Unable to share cam: Broadcaster is in a private show"),showMyCamMayNotShareUpsell:(0,s.AP)("Sharing your cam is only available to users who have purchased tokens. Click OK to purchase tokens now."),showMyCamSharingPrefix:(0,s.AP)("Viewer "),showMyCamStartedSharing:(0,s.AP)(" started sharing their cam"),showMyCamStartedViewing:(0,s.AP)(" started viewing your cam"),showMyCamStoppedViewing:(0,s.AP)(" stopped viewing your cam"),showMyCamIsViewing:(0,s.AP)("is currently viewing your cam"),showMyCamNotViewing:(0,s.AP)("is not currently viewing your cam"),showMyCamMuted:(0,s.AP)("Muted"),showMyCamCloseCam:(0,s.AP)("Close Cam"),showMyCamPopoutCam:(0,s.AP)("Pop Out Cam"),showMyCamReportCam:(0,s.AP)("Report Cam"),showMyCamReportPublic:(0,s.AP)("User is broadcasting in public"),showMyCamReportRude:(0,s.AP)("User is rude/abusive"),showMyCamReportIntoxicated:(0,s.AP)("User is intoxicated"),showMyCamReportSleeping:(0,s.AP)("User is sleeping"),showMyCamReportSpamming:(0,s.AP)("User is spamming"),showMyCamReportUnderage:(0,s.AP)("User is underage"),showMyCamMyCam:(0,s.AP)("My Cam"),showMyCamView:(0,s.AP)("View Cam"),showMyCamStopView:(0,s.AP)("Stop Viewing Cam"),showMyCamTooManyCams:(0,s.AP)("Unable to view cam: A maximum of five cams can be viewed at once"),showMyCamCamOffline:(0,s.AP)("Unable to view cam: This viewer is no longer sharing their cam"),showMyCamConnectionClosed:(0,s.AP)("(connection closed)"),broadcaster:(0,s.AP)("Broadcaster"),moderator:(0,s.AP)("Moderator"),fanclubMember:(0,s.AP)("Fan club member"),user:(0,s.AP)("User"),roomJoinedMessage:(0,s.AP)("has joined the room"),roomLeftMessage:(0,s.AP)("has left the room."),roomFollowToGetNotified:(0,s.AP)("Follow to be notified when online."),feedbackCommentsLabel:(0,s.AP)("Describe your issue or share your ideas:"),feedbackNotice:(0,s.AP)("Some account and system information may be sent to %SITE_NAME%. We will use the information you give us to help address technical issues to improve our services, subject to our Privacy Policy and Terms of Service."),feedbackSubmit:(0,s.AP)("Send feedback"),feedbackAddScreenshot:(0,s.AP)("Add screenshot"),feedbackAddScreenshotInfoScrollDown:(0,s.AP)("Scroll down to capture lower on the page"),feedbackAddScreenshotInfoScrollUp:(0,s.AP)("Scroll up to capture higher on the page"),feedbackCanvasToggle:(0,s.AP)("Click to highlight or hide info"),feedbackHighlightInfo:(0,s.AP)("Highlight issues with orange or hide sensitive info with black. Hit the ESC key to finish."),feedbackHighlightControl:(0,s.AP)("Highlight issue"),feedbackHideControl:(0,s.AP)("Hide sensitive info"),feedbackPermissionDenied:(0,s.AP)("Permission to capture screen not granted"),feedbackUnknownCaptureError:(0,s.AP)("Could not capture screen"),feedbackResize:(0,s.AP)("Please take screenshot again after resizing"),feedbackSubmitted:(0,s.AP)("Your feedback has been sent! Thank you for your feedback."),feedbackUnknownError:(0,s.AP)("Something went wrong. Please try again later."),feedbackRateLimitError:(0,s.AP)("Please wait before submitting more feedback."),feedbackBannedUser:(0,s.AP)("Unable to submit feedback. Please contact support."),doneText:(0,s.AP)("Done"),denyPrivate:(0,s.AP)("Deny Private"),acceptPrivate:(0,s.AP)("Accept Private"),returnToPublicChat:(0,s.AP)("Return to Public Chat"),privateShowEnded:(0,s.AP)("Your private show has ended."),cameraRemainHidden:(0,s.AP)("Your camera will remain hidden until you re-enter public chat."),aboutToStopPrivateShow:(0,s.AP)("You're about to stop the private show. Do you want to continue?"),errorBroadcasting:(0,s.AP)("Error broadcasting"),fontSettings:(0,s.AP)("Font Settings"),emoticonsSettings:(0,s.AP)("Emoticons Settings"),emoticonAutocompleteDelayOff:(0,s.AP)("Turn Off Autocomplete"),notifyEntryLeaveAllUsers:(0,s.AP)("All Registered Users"),notifyEntryLeaveModsFansUsersTokens:(0,s.AP)("Mods, Fans, and Users With Tokens"),notifyEntryLeaveModsFans:(0,s.AP)("Mods and Fans"),notifyEntryLeaveNoUsers:(0,s.AP)("No Users"),usersSettings:(0,s.AP)("Users Settings"),notificationsSettings:(0,s.AP)("Notifications Settings"),otherSettings:(0,s.AP)("Other Settings"),noOneIgnored:(0,s.AP)("You have no users ignored."),backToChatSettings:(0,s.AP)("Back to Chat Settings"),notifyEntryFor:(0,s.AP)("Notify on Entry For"),notifyLeaveFor:(0,s.AP)("Notify on Leave For"),noNewUpdates:(0,s.AP)("No new updates"),videoBeingProcessed:(0,s.AP)("The video is currently being processed.  It may take several minutes depending on the size of the video."),videoProcessingError:(0,s.AP)("The video is damaged or its format is not supported."),videoReupload:(0,s.AP)("Please delete this video and reupload again."),mustBeSupporterFeature:(0,s.AP)("You must be a supporter to use this feature."),loginToFollow:(0,s.AP)('You must be logged in to Follow. Click "OK" to login.'),loginToUseFeature:(0,s.AP)("Log in or sign up to use this feature"),loginToTip:(0,s.AP)('You must be logged in to send a tip. Click "OK" to login.'),loginToContinue:(0,s.AP)("Log in to continue"),dontHaveAccount:(0,s.AP)("Don't have an account?"),dontHaveAccountYet:(0,s.AP)("Don't have an account yet?"),tippedTonsRecently:(0,s.AP)("Tipped Tons"),tippedTonsRecentlyDef:(0,s.AP)("1000+ tokens in the past 2 weeks"),tippedALotRecently:(0,s.AP)("Tipped Lots"),tippedALotRecentlyDef:(0,s.AP)("250+ tokens in the past 2 weeks"),tippedRecently:(0,s.AP)("Tipped Recently"),tippedRecentlyDef:(0,s.AP)("50+ tokens in the past 2 weeks"),hasTokens:(0,s.AP)("Purchased Tokens"),hasTokensDef:(0,s.AP)("Has bought tokens"),inFanClub:(0,s.AP)("Fan Club Member"),isMod:(0,s.AP)("Moderator"),isBroadcaster:(0,s.AP)("Broadcaster"),upgradeToSupporterLabel:(0,s.AP)("Upgrade to Supporter"),promotedRoom:(0,s.AP)("Promoted room"),transferTokensToCash:(0,s.AP)("Transfer tokens to cash"),transferTokensToAdvertising:(0,s.AP)("Transfer tokens to advertising credit"),referredMember:(0,s.AP)("Referred Member"),email:(0,s.AP)("email"),emailLabel:(0,s.AP)("Email"),spyNow:(0,s.AP)("Spy Now"),spyShowCost:(0,s.AP)("Spy Show cost"),spyingNow:(0,s.AP)("Spying now"),broadcasterWelcomeWarning:(0,s.AP)("Broadcaster Rules: Tokens are the only form of payment allowed. You may promote your personal website as long as it does not offer video chat. Do not ask users to chat with you elsewhere."),viewerWelcomeWarning:(0,s.AP)("Rules: No spamming. Do not insist the cam hosts to do as you please. Do not announce other rooms or websites that would conflict with this room. Avoid any argumentative and/or rude posts related to the cam viewing. Do not attempt to post your e-mail address in the public chat."),useExternalEncoder:(0,s.AP)("Use External Encoder to Broadcast"),broadcastWithOBS:(0,s.AP)("Broadcast yourself using Open Broadcaster Software (OBS)"),accept:(0,s.AP)("Accept"),decline:(0,s.AP)("Decline"),userTokenRate:(0,s.AP)("User(s) Token Rate"),privateShowStats:(0,s.AP)("Private Show Stats"),exitPrivateShow:(0,s.AP)("Exit Private Show"),useAppsAndBots:(0,s.AP)("Enhance your room with Apps & Bots in the tab below."),disabled:(0,s.AP)("Disabled"),allowed:(0,s.AP)("Allowed"),privates:(0,s.AP)("Privates"),free:(0,s.AP)("Free"),broadcastGuideTitle:(0,s.AP)("Broadcaster's Guide"),myBroadcast:(0,s.AP)("My Broadcast"),passwordProtectedWarning:(0,s.AP)("Your room is password protected. Users may not enter your room unless they know your password. To remove your password, edit your settings & privacy."),kickBan:(0,s.AP)("Kick/Ban"),removeModeratorStatus:(0,s.AP)("Remove Moderator Status"),promoteToModerator:(0,s.AP)("Promote to Moderator"),removeModeratorLoginError:(0,s.AP)('You must be logged in to remove a moderator. Click "OK" to login.'),promoteModeratorLoginError:(0,s.AP)('You must be logged in to promote a user to moderator. Click "OK" to login.'),obsShareWarning:(0,s.AP)("WARNING: Never show or share your broadcast token with anyone!"),yourBroadcastToken:(0,s.AP)("Your broadcast token"),broadcastingInformation:(0,s.AP)("RTMP/OBS Broadcasting Information"),clickToViewOBSSetupGuide:(0,s.AP)("Click here to view our OBS Setup Guide"),importantInformation:(0,s.AP)("Important Information"),doNotUpscale:(0,s.AP)("Do not upscale your source input (e.g. using a 1080p camera to a 1440p stream)."),ensureMinimumBitrate:(0,s.AP)("Ensure you use the minimum video bitrate specified in this table for a given resolution"),copyrightContentWarning:(0,s.AP)("You may only have copyrighted content -- including music, movies, and video games -- in your stream if you are the rights holder or have the permission of all rights holders."),recommendedSettingsTable:(0,s.AP)("Recommended Settings Table"),generateNewOBSTokenConfirm:(0,s.AP)("Generate a new broadcast token? \n(This will invalidate your prior RTMP / OBS token and disconnect your current broadcast)"),thisIsSatisfactionScore:(0,s.AP)('This is your satisfaction score. You can hide this by setting "Show my satisfaction score" to "No" in the Settings & Privacy tab.'),dataUpdatedOncePerDay:(0,s.AP)("This data is updated once per day and is based on votes in the past 90 days."),clickScoreToSeeHistory:(0,s.AP)("Click on your score (%) to view your rating history."),fetchingHistory:(0,s.AP)("Fetching rating history"),noHistoryToShow:(0,s.AP)("No history to show"),activeApp:(0,s.AP)("Active App"),activeGame:(0,s.AP)("Active Game"),bot1:(0,s.AP)("Bot #1"),bot2:(0,s.AP)("Bot #2"),bot3:(0,s.AP)("Bot #3"),bot4:(0,s.AP)("Bot #4"),bot5:(0,s.AP)("Bot #5"),noneSelected:(0,s.AP)("None Selected"),chooseAnApp:(0,s.AP)("Choose an App"),chooseABot:(0,s.AP)("Choose a Bot"),chooseAGame:(0,s.AP)("Choose a Game"),endGame:(0,s.AP)("End Game"),stopStreamingGame:(0,s.AP)("Stop streaming game"),areYouAPublisher:(0,s.AP)("Are you a publisher?"),addYourGameLink:(0,s.AP)("Add your game."),restart:(0,s.AP)("Restart"),addNewSocialMedia:(0,s.AP)("Add new social media"),uploadNewPics:(0,s.AP)("Upload new pics"),uploadNewVideos:(0,s.AP)("Upload new videos"),editYourBio:(0,s.AP)("Edit Your Bio"),currentContestStatistics:(0,s.AP)("Current Contest Statistics for"),payoutInformation:(0,s.AP)("Payout Information"),refreshStats:(0,s.AP)("Refresh Stats"),seeContestDetails:(0,s.AP)("See contest details"),managePhotoSet:(0,s.AP)("Manage photo sets"),updateBio:(0,s.AP)("Update Bio"),january:(0,s.AP)("January"),february:(0,s.AP)("February"),march:(0,s.AP)("March"),april:(0,s.AP)("April"),may:(0,s.AP)("May"),june:(0,s.AP)("June"),july:(0,s.AP)("July"),august:(0,s.AP)("August"),september:(0,s.AP)("September"),october:(0,s.AP)("October"),november:(0,s.AP)("November"),december:(0,s.AP)("December"),expiredFanClubMemberships:(0,s.AP)("Expired Fan Club Memberships"),expiredSocialMediaSubscriptions:(0,s.AP)("Expired Social Media Subscriptions"),noActiveMemberships:(0,s.AP)("You Have No Active Memberships"),expires:(0,s.AP)("Expires"),expired:(0,s.AP)("Expired"),extendThreeMonths:(0,s.AP)("Extend by 3 months"),renews:(0,s.AP)("Renews"),renew:(0,s.AP)("renew"),cantRenew:(0,s.AP)("can't renew"),cantExtend:(0,s.AP)("can't extend"),noEmailOnFile:(0,s.AP)("No email address on file"),blockedCountries:(0,s.AP)("Blocked countries"),ableToView:(0,s.AP)("Able to view"),blockedRegions:(0,s.AP)("Blocked regions"),security:(0,s.AP)("Security"),statistics:(0,s.AP)("Statistics"),updateSettings:(0,s.AP)("Update Settings"),updateYourPassword:(0,s.AP)("Update your password"),viewSecurityCenter:(0,s.AP)("View the security center and adjust Two-Step Verification settings"),authorizeThirdPartyStats:(0,s.AP)("Authorize your 3rd party stats"),addEmailAddress:(0,s.AP)("Add an email address"),changeEmailAddress:(0,s.AP)("Change email address"),emailVerified:(0,s.AP)("E-mail Verified"),resendVerificationEmail:(0,s.AP)("Resend verification email"),verificationEmailSent:(0,s.AP)("Verification Email Sent"),emailIsUnverifiedForNotificationsAndNewsletter:(0,s.AP)("Email is Unverified. Verify to receive follower notifications and newsletters."),detailedIncomeStats:(0,s.AP)("Detailed Income Stats"),paymentInformationForm:(0,s.AP)("Payment Information Form"),requiredForPayments:(0,s.AP)("required for payments"),broadcasterVerificationForm:(0,s.AP)("Broadcaster Verification Form"),downloadTransactionHistory:(0,s.AP)("Download Transaction History"),pleaseWaitForFileToGenerate:(0,s.AP)("Please wait for the file to be generated"),download30Days:(0,s.AP)("Download your last 30 days of transactions?\nProcessing may take up to 20 seconds."),yourAccountsActivity:(0,s.AP)("Your Account's Activity"),periodEarnings:(0,s.AP)("Period Earnings"),latestCashOuts:(0,s.AP)("Latest cashouts"),tokensAutoCashedAtMidnight:(0,s.AP)("tokens are automatically cashed out at midnight"),verifyToEnableTokens:(0,s.AP)("Please verify your identity to enable tokens on your account"),transferTokens:(0,s.AP)("Transfer Tokens"),transferTokensDateInfo:(0,s.AP)("Tokens transferred on the 1st-15th of the month will be sent by the 22nd. Tokens transferred on the 16th-31st will be sent by the 7th."),silencedTableTitle:(0,s.AP)("Silenced Users"),silencedUsersInfo:(0,s.AP)("Listed are users currently silenced from your room. Silences expire after 6 hours by default. You can convert a silence to a ban."),bannedTableTitle:(0,s.AP)("Banned Users"),bannedUsersInfo:(0,s.AP)("Listed are users currently banned from your room. Bans expire after 1 month by default. You can convert a ban to a permanent ban."),usernameToBan:(0,s.AP)("Please enter a username to ban"),cannotBanSelf:(0,s.AP)("You cannot ban yourself"),errorOccurred:(0,s.AP)("An error occurred, please try again"),pageLoadError:(0,s.AP)("Error loading page. Please try again."),roomLoadError:(0,s.AP)("Error loading room. Please try again."),banned:(0,s.AP)("Banned"),silenced:(0,s.AP)("Silenced"),actions:(0,s.AP)("Actions"),remove:(0,s.AP)("Remove"),makePermanent:(0,s.AP)("Make Permanent"),convertToBan:(0,s.AP)("Convert to Ban"),clickToClearHiddenBansAndSilences:(0,s.AP)("Click here to clear hidden silences and bans"),addBan:(0,s.AP)("Add ban"),enterUsernameToBan:(0,s.AP)("Enter user to ban"),viewEditBansAndSilences:(0,s.AP)("View/Edit Bans and Silences"),viewEditModerators:(0,s.AP)("View/Edit Moderators"),viewFanClubMembers:(0,s.AP)("View Fan Club Members"),viewEditRegionBlockExemptions:(0,s.AP)("View/Edit Region Block Exemptions"),viewEditBannedTerms:(0,s.AP)("View/Edit Banned Terms"),alphabetically:(0,s.AP)("Alphabetically"),allUsers:(0,s.AP)("All Users"),usersWhoTippedToday:(0,s.AP)("Users who tipped me today"),usersWhoHaveTipped:(0,s.AP)("Users who have tipped me"),usersWhoHaveTokens:(0,s.AP)("Users who have tokens"),oneDay:(0,s.AP)("1 Day"),twoDays:(0,s.AP)("2 Days"),oneWeek:(0,s.AP)("1 Week"),twoWeeks:(0,s.AP)("2 Weeks"),oneMonth:(0,s.AP)("1 Month"),twoMonths:(0,s.AP)("2 Months"),sixMonths:(0,s.AP)("6 Months"),no:(0,s.AP)("No"),yes:(0,s.AP)("Yes"),yesIfBroadcasting:(0,s.AP)("Yes, only if they're broadcasting now"),ageVerificationRequired:(0,s.AP)("Age Verification Required"),onlyAgeVerifiedCanChangeSetting:(0,s.AP)("Only age verified broadcasters can change this setting"),currentFanClubMembersInfo:(0,s.AP)("Listed are your current fan club members, the date they last joined, and the total number of months they've been your fan (Expiring memberships have a short grace period to renew before removed from your fanclub.)"),allFanClubMembersInfo:(0,s.AP)("Listed are all of your fan club members past and present and how long they were a member for. Current members are <strong>highlighted</strong>."),addUsername:(0,s.AP)("Add user"),add:(0,s.AP)("Add"),regionBlockExemptions:(0,s.AP)("Region Block Exemptions"),regionBlockExemptionsInfo:(0,s.AP)("Users on this list will be exempt from region blocks"),enterUsernameToExemptRegionBlock:(0,s.AP)("Enter user to exempt"),uniqueRegisteredViewers:(0,s.AP)("Unique Registered Viewers"),yourPoints:(0,s.AP)("Your Points"),yourRank:(0,s.AP)("Your Rank"),joinFanClub:(0,s.AP)("Join Fan Club"),member:(0,s.AP)("Member"),fanClubMember:(0,s.AP)("Fan Club Member"),lastJoined:(0,s.AP)("Last Joined"),totalMonthsAMember:(0,s.AP)("Total Months a Member"),darkMode:(0,s.AP)("Dark Mode"),searchBarPlaceholder:(0,s.AP)("Search #tags or broadcasters"),searchBarPlaceholderSbjSrch:(0,s.AP)("Search subjects, #tags, or broadcasters"),broadcastingNow:(0,s.AP)("Broadcasting right now"),recentlyOnline:(0,s.AP)("Recently online"),previouslySearched:(0,s.AP)("Previously searched"),tapToUnmute:(0,s.AP)("TAP TO UNMUTE"),confirmOK:(0,s.AP)("OK"),homepageInBioViolation:(0,s.AP)("Please note that the 'Room subject' of your broadcast and the 'Location' field of your bio may not be used for promotion of social media or other websites. Thank you for your understanding."),noteText:(0,s.AP)("Note"),loadingPlaceholderText:(0,s.AP)("Loading..."),unsavedText:(0,s.AP)("(unsaved)"),back:(0,s.AP)("Back"),loadingMoreMessages:(0,s.AP)("Loading More Messages"),sendPrivateMessage:(0,s.AP)("Send a private message"),sendDirectMessage:(0,s.AP)("Send a direct message"),sendDirectMessageNew:(0,s.AP)("Send a direct message"),searchUsers:(0,s.AP)("Search users"),unopenedCAPS:(0,s.AP)("UNOPENED"),now:(0,s.AP)("now"),leavePrivateShowWarningText:(0,s.AP)("To avoid ending the private show, a new tab will open. Click OK to continue."),acceptRules:(0,s.AP)("Accept Rules"),chatCapitalized:(0,s.AP)("Chat"),unmuteCapitalized:(0,s.AP)("Unmute"),directMessageLabel:(0,s.AP)("Direct Messages"),fanclubCancelErrorMessage:(0,s.AP)("There was an error cancelling your Fan Club."),supporterCancelConfirmMessage:(0,s.AP)("Are you sure you wish to remove your supporter status? You will remain a supporter until your currently paid month expires."),supporterCancelErrorMessage:(0,s.AP)("There was an error cancelling your supporter membership."),eventsApiSettingsHeader:(0,s.AP)("Events API"),banRemovedMessage:(0,s.AP)("Ban removed"),silenceRemovedMessage:(0,s.AP)("Silence removed"),banRemoveErrorMessage:(0,s.AP)("Error removing ban, please try again"),banConvertErrorMessage:(0,s.AP)("Error converting to ban, please try again"),silenceRemoveErrorMessage:(0,s.AP)("Error removing silence –– it may have already been removed"),inlineUndoText:(0,s.AP)("Undo"),inlineBanText:(0,s.AP)("Ban"),transViewers:(0,s.AP)("trans viewers"),and:(0,s.AP)("and"),howIsSmcDoingToday:(0,s.AP)("How is Cam To Cam doing today?"),yourFeedbackHasBeenSent:(0,s.AP)("Your feedback has been sent!"),describeYourIssues:(0,s.AP)("Describe your issues or share your ideas."),unfollowInfo:(0,s.AP)("You will no longer receive notifications or see them in your following tab."),allApps:(0,s.AP)("All Apps"),aspDescription:(0,s.AP)("Customize your chat room experience with Apps"),orderBy:(0,s.AP)("Order By:"),searchForApps:(0,s.AP)("Search for Apps"),appsLoadingError:(0,s.AP)("Failed to load Apps"),appsLoadingErrorV2:(0,s.AP)("Failed to load v2 Apps"),topEarning:(0,s.AP)("Top Earning"),featuredApps:(0,s.AP)("Featured Apps"),recentlyUpdated:(0,s.AP)("Recently Updated"),recentlyUsed:(0,s.AP)("Recently Used"),version:(0,s.AP)("version"),installed:(0,s.AP)("Installed"),videoPanelLabel:(0,s.AP)("Broadcast panel"),uninstall:(0,s.AP)("Uninstall"),transformMessagesLabel:(0,s.AP)("Transform messages"),tipOptionsLabel:(0,s.AP)("Tip options"),exclusiveAppPermissionText:(0,s.AP)("Only one app can have this permission."),addApp:(0,s.AP)("Add app"),upgradeAndApply:(0,s.AP)("Upgrade & Apply"),upgradeAndRestart:(0,s.AP)("Upgrade & Restart"),apply:(0,s.AP)("Apply"),applyLower:(0,s.AP)("apply"),running:(0,s.AP)("Running"),stopped:(0,s.AP)("Stopped"),crashed:(0,s.AP)("Crashed"),stop:(0,s.AP)("Stop"),upgrade:(0,s.AP)("Upgrade"),settings:(0,s.AP)("Settings"),sourceCode:(0,s.AP)("Source code"),noDescription:(0,s.AP)("No Description"),noAppSettingsText:(0,s.AP)("This app does not have any settings."),fieldRequiredText:(0,s.AP)("This field is required"),stringMinError:(0,s.AP)("This field is too short"),stringMaxError:(0,s.AP)("This field is too long"),invalidInputText:(0,s.AP)("Invalid input"),selectAnOption:(0,s.AP)("Select an option"),permissions:(0,s.AP)("Permissions"),allPermissionsText:(0,s.AP)("All permissions granted"),noPermissionsText:(0,s.AP)("No permissions granted"),somePermissionsText:(0,s.AP)("Some permissions granted"),permissionModalText:(0,s.AP)("The app you are adding is requesting the following permissions."),activeAppOverrideText:(0,s.AP)('⚠️ App running in "Active App" is overriding this permission.'),aspPermissionOverrideText:(0,s.AP)('⚠️ Apps running in "Active App" slot can override this permission.'),appLimitError:(0,s.AP)("You have reached the maximum number of apps."),appNotAgeVerified:(0,s.AP)("Only age verified broadcasters may install apps."),becomeAgeVerified:(0,s.AP)("Verify Age"),appNotAvailable:(0,s.AP)("App is not available."),refresh:(0,s.AP)("Refresh"),userAddedToExemptList:(0,s.AP)("User has been added to your exemption list."),anErrorOccurred:(0,s.AP)("An error occurred."),confirmPhotoDelete:(0,s.AP)("Do you really want to delete this image? This cannot be undone."),errorDeletingMedia:(0,s.AP)("There was an error deleting your media."),errorUploadingMedia:(0,s.AP)("There was an error uploading your media."),invalidFileErrorUploadingMedia:(0,s.AP)("This file type is not supported or the file is corrupted."),fileSizeErrorUploadingMedia:(0,s.AP)("This file is too large. Images must be at most 50MB"),legalBlockErrorUploadingMedia:(0,s.AP)("Unfortunately, local law restricts this function."),errorLoadingMedia:(0,s.AP)("Could not load media. It may have been deleted."),selectGameHeaderText:(0,s.AP)("Select your game from the list of approved games below."),installGameHeaderText:(0,s.AP)("Install and start the game"),installGameSectionText:(0,s.AP)("Download and and run the game."),downloadOBSHeaderText:(0,s.AP)("Download OBS and set it up"),authorizeGameHeaderText:(0,s.AP)("Authorize this game"),privateShowC2cTip:(0,s.AP)("Pro tip: Viewers who use Cam To Cam tip 50% more on average than viewers who don't. Encouraging your viewers to share their cam can build a more intimate connection and potentially earn you more tokens!"),notifyWhenBroadcastersOnlineMessage:(0,s.AP)("Notify me when broadcasters I follow come online with"),popularCAPS:(0,s.AP)("POPULAR"),browserNotificationLabel:(0,s.AP)("Browser notification"),browserNotificationEnabled:(0,s.AP)("Browser notification enabled"),saveNotificationSettings:(0,s.AP)("Save notification settings"),emailAddressText:(0,s.AP)("Email address"),preferencesSavedText:(0,s.AP)("Your preferences have been saved."),checkYourEmailToVerifyText:(0,s.AP)("Check your email inbox to verify your email!"),emailSavedAndVerifyText:(0,s.AP)('Your email address has been updated on your account. Check your email inbox to <span style="font-family: UbuntuBold, Arial, Helvetica, sans-serif;">verify your email</span>!'),emailSendErrorMessage:(0,s.AP)("Error sending verification email, please try again."),emailSubmitErrorMessage:(0,s.AP)("Error submitting email, please try again."),browserSubmitErrorMessage:(0,s.AP)("Error saving browser notification."),browserSubmitErrorMessagePt2:(0,s.AP)("Please try again from the Settings & Privacy page on your profile."),errorSendingMessage:(0,s.AP)("Unable to send message"),buyMoreTokens:(0,s.AP)("Buy more tokens"),removedForViolation:(0,s.AP)("Image removed for violating site rules"),imageAttached:(0,s.AP)("Image attached"),subgenderSelectionConfirm:(0,s.AP)("Submit and Start Broadcasting"),subgenderSelectionHeader:(0,s.AP)("We launched new gender categories in order to allow the Chaturbate community to better identify their gender identity."),subgenderSelectionPrompt:(0,s.AP)("Please choose an option below, selecting which one expresses you best:"),subgenderFemme:(0,s.AP)("Trans Femme"),subgenderMasc:(0,s.AP)("Trans Masc"),subgenderNonbinary:(0,s.AP)("Non-Binary"),haveYouNoticedAnyBugs:(0,s.AP)("Did you notice any bugs today? Please describe them in as much detail as possible."),away:(0,s.AP)("Away"),offline:(0,s.AP)("Offline"),live:(0,s.AP)("Live"),yourStreamIsCurrently:(0,s.AP)("Your stream is currently "),obsAwayMessage:(0,s.AP)('This private show has ended. To give you time to prepare, you are now shown as "Away" to those in your room. To return and be visible on cam, click "Exit Away Mode" below.'),streamRejected:(0,s.AP)("Stream Rejected"),waitingforStreamStats:(0,s.AP)("Waiting for stream stats"),streamStatusUnknown:(0,s.AP)("Stream Status Unknown"),streamTime:(0,s.AP)("Stream time"),codec:(0,s.AP)("Codec"),frameRate:(0,s.AP)("Frame Rate: "),bitrate:(0,s.AP)("Bitrate: "),alsoSupportOtherEncoders:(0,s.AP)("We also support other encoders such as XSplit, Wirecast, etc."),obsDescription:(0,s.AP)(" (OBS) is an open source streaming software which provides broadcasters control to configure stream settings and customizable plugins so they can enhance their stream."),tryAddingHashtags:(0,s.AP)("Try adding #hashtags to your room subject to attract more viewers."),viewRTMPInfo:(0,s.AP)("View RTMP/OBS broadcast information and stream key"),waitingForStream:(0,s.AP)("Waiting for stream to start"),startInBrowserBroadcaster:(0,s.AP)("Start the in-Browser Broadcaster"),outdatedBrowser:(0,s.AP)("Your browser is outdated and cannot use in browser broadcast. Please update to use the latest Chaturbate features. We recommend Chrome, Firefox, or Edge."),ctrlLToClose:(0,s.AP)("(Ctrl+L to close)"),welcomeMessage:(0,s.AP)("To go to next room, press Ctrl+/. To send a tip, press Ctrl+S or type \"/tip 25\". To disable emoticons or adjust autocomplete settings, click the 'Gear' tab above."),mobileWelcomeMessage:(0,s.AP)('To send a tip, click SEND TIP or type "/tip 25".'),backToRoomMenu:(0,s.AP)("Back to Room Menu"),bannedTerms:(0,s.AP)("Banned Terms"),bannedTermsInfo:(0,s.AP)("Viewers will not be able to send messages containing these terms. All characters are allowed, including spaces."),addTerm:(0,s.AP)("Add term"),term:(0,s.AP)("Term"),banAsSubstring:(0,s.AP)("Ban as Substring"),banAsSubstringExplanation:(0,s.AP)('Ban the term if it appears anywhere in a message, even as part of other words. For example, if the term is "hello" then this will also ban "xhellox". Otherwise, if disabled, only messages like "x hello x" will be banned.'),enterTermToBan:(0,s.AP)("Enter term to ban"),pleaseEnterTermToBan:(0,s.AP)("Please enter a term to ban"),errorBanningTerm:(0,s.AP)("There was an error banning this term. Please try again later"),errorUpdatingTerm:(0,s.AP)("There was an error updating this term. Please try again later"),errorRemovingTerm:(0,s.AP)("There was an error removing this term. Please try again later"),followsYou:(0,s.AP)("Follows you"),sharingCam:(0,s.AP)("Sharing their cam"),notes:(0,s.AP)("Notes"),broadcastDate:(0,s.AP)("Broadcast Date"),broadcastWeekday:(0,s.AP)("Broadcast Weekday"),broadcastLength:(0,s.AP)("Broadcast Length"),maxViewers:(0,s.AP)("Max Viewers"),tokensTotal:(0,s.AP)("Tokens Total"),avgTokensPerMin:(0,s.AP)("Average Tokens Per Minute"),avgTokensPerUser:(0,s.AP)("Average Tokens Per User"),chatMessagesTotal:(0,s.AP)("Chat Messages Total"),avgMessagesPerUser:(0,s.AP)("Average Messages Per User"),featuredCAPS:(0,s.AP)("FEATURED"),allGendersCAPS:(0,s.AP)("ALL GENDERS"),notShowingFromRegions:(0,s.AP)("Not showing broadcasters from"),noRoomsAvailableFiltered:(0,s.AP)("No rooms match your preferences, please update your search/filter options."),dragToResize:(0,s.AP)("Drag to resize"),userInRoom:(0,s.AP)("User is in the room"),userNotInRoom:(0,s.AP)("User has left the room"),userNotInPrivate:(0,s.AP)("User is not in the private show"),dmCloseTab:(0,s.AP)("Close tab"),dmCloseTabShortcut:(0,s.AP)("Ctrl+L to close window"),reportThisUserText:(0,s.AP)("Report this user"),inappropriateMessage:(0,s.AP)("Inappropriate message"),rudeMessage:(0,s.AP)("Rude message"),spamMessage:(0,s.AP)("Spam message"),getMoreLabel:(0,s.AP)("Get More"),invalidAmount:(0,s.AP)("Invalid amount"),hashtag:(0,s.AP)("Hashtag"),viewers:(0,s.AP)("Viewers"),rooms:(0,s.AP)("Rooms"),incorrectOrientation:(0,s.AP)("Your stream may appear upside down or sideways to viewers. Turn your device."),incorrectPortrait:(0,s.AP)("Your broadcast may appear upside down or sideways to viewers. Turn your device into landscape mode."),missingFullscreen:(0,s.AP)("Fullscreen is required for broadcasting. "),fullscreenStop:(0,s.AP)("Screen is no longer fullscreen so stream has been stopped."),androidBroadcast:(0,s.AP)("Starting a broadcast will enter fullscreen."),mobileBroadcastError:(0,s.AP)("Must be in proper landscape to broadcast, rotate 90 or 180 degrees and try again"),allTagsCAPS:(0,s.AP)("ALL TAGS"),dismissCapitalized:(0,s.AP)("Dismiss"),becomeSupporter:(0,s.AP)("Become a supporter"),joinCB:(0,s.AP)("Join Chaturbate"),popoutInNewWindow:(0,s.AP)("Popout in new window"),connecting:(0,s.AP)("Connecting"),waitingToConnect:(0,s.AP)("Waiting to connect"),connectingToBroadcastMessage:(0,s.AP)("Please wait while we connect you to this webcam broadcast."),roomAwayMessage:(0,s.AP)("You may continue chatting while you wait for the broadcaster to return."),roomPrivateNotWatchingMessage:(0,s.AP)("You may continue chatting while you wait for the broadcaster to return from the private show."),spyOnThisPrivateShowCAPS:(0,s.AP)("SPY ON THIS PRIVATE SHOW"),camIsHidden:(0,s.AP)("Cam is Hidden"),roomOfflineSubheader:(0,s.AP)("The member you are trying to view is currently offline. Please wait or choose another member to view."),passwordRequired:(0,s.AP)("Password Required"),roomPasswordProtectedMessage:(0,s.AP)("The broadcaster has set a password which is required for viewing. If you know the password, refresh this page to enter it."),errorLoadingConversationHistory:(0,s.AP)("Error loading conversation history. Close and reopen this DM to reload"),ageVerifiedHeader:(0,s.AP)("Age Verified Broadcasters"),ageVerifiedBodyHeader:(0,s.AP)("Your account is age verified!"),ageVerifiedGuests:(0,s.AP)("Additionally the following guests are approved to appear on your account:"),ageVerifiedBody:(0,s.AP)("Only the age verified persons below can appear through your account. If you would like to broadcast with someone that is not displayed below, they must upload their government-issued identification prior to appearing on your account."),camCategoryNorthAmerica:(0,s.AP)("North American Cams"),camCategorySouthAmerica:(0,s.AP)("South American Cams"),camCategoryAsia:(0,s.AP)("Asian Cams"),camCategoryEuroRussia:(0,s.AP)("Euro Russian Cams"),camCategoryOtherRegion:(0,s.AP)("Other Region Cams"),camCategoryTeen:(0,s.AP)("Teen Cams (18+)"),camCategory18to20:(0,s.AP)("18 to 20 Cams"),camCategory18to21:(0,s.AP)("18 to 21 Cams"),camCategory20to30:(0,s.AP)("20 to 30 Cams"),camCategory30to50:(0,s.AP)("30 to 50 Cams"),camCategory21to35:(0,s.AP)("21 to 35 Cams"),camCategoryMature:(0,s.AP)("Mature Cams (50+)"),camCategoryExhib:(0,s.AP)("Exhibitionist Cams"),camCategoryPrivate:(0,s.AP)("Private Shows"),camCategoryHidden:(0,s.AP)("Community Controlled Shows"),camCategoryNewCams:(0,s.AP)("New Cams"),camCategoryGaming:(0,s.AP)("Gaming Cams"),camCategory6TkPerMin:(0,s.AP)("6 Tokens per Minute"),camCategory12TkPerMin:(0,s.AP)("12 Tokens per Minute"),camCategory18TkPerMin:(0,s.AP)("18 Tokens per Minute"),camCategory30TkPerMin:(0,s.AP)("30+ Tokens per Minute"),camCategory60TkPerMin:(0,s.AP)("60+ Tokens per Minute"),camCategory12to18TkPerMin:(0,s.AP)("12 to 18 Tokens per Minute"),camCategory30to42TkPerMin:(0,s.AP)("30 to 42 Tokens per Minute"),camCategory60to72TkPerMin:(0,s.AP)("60 to 72 Tokens per Minute"),camCategory90TkPerMin:(0,s.AP)("90+ Tokens per Minute"),categoryDescriptionHidden:(0,s.AP)("Community controlled cams are using an app which has the ability to hide and show the cam based on viewers feedback."),firefoxWarning:(0,s.AP)("Firefox is not recommended for browser broadcasting. For a better experience, please use Chrome or an external encoder."),noFanClub:(0,s.AP)("Broadcaster does not currently have a fan club."),inValidTipAmount:(0,s.AP)("Please input a tip amount between 1 and 9999"),shortcodeNotSupportedInDMs:(0,s.AP)("Shortcodes are not supported in DMs."),shortcodeNotSupportedInPMs:(0,s.AP)("Shortcodes are not supported in PMs."),shortcodeNotSupportedInPrivates:(0,s.AP)("Shortcodes are not supported in private shows."),shortcodeGeneralError:(0,s.AP)("Error sending shortcode. Please try again."),tipNotBroadcaster:(0,s.AP)("Only broadcasters & apps can publish tip shortcodes"),tooManyShortcodes:(0,s.AP)("Max shortcodes allowed per message is 5"),shortcode:(0,s.AP)("Shortcode"),shortcodeHelp:(0,s.AP)("Shortcodes are specific codes that can be typed into a chat room to automatically create clickable links with predefined actions. These shortcodes can act as a shortcut for users to perform various functions like joining a specific page or becoming a supporter. Broadcasters can also use shortcodes to suggest a tip."),shortcodeHelpHelp:(0,s.AP)("Generates information about the shortcode system and each of the shortcodes."),shortcodeURLNotAllowedInTip:(0,s.AP)("URLs are not allowed in tip shortcodes"),shortcodeHelpTipExample:(0,s.AP)("Tip if you enjoyed!"),loggedInForFeature:(0,s.AP)("You must be logged in to use this feature"),loggedInForFeatureClickOkToLogin:(0,s.AP)('You must be logged in to use this feature. Click "OK" to login.'),errorSendingTip:(0,s.AP)("Error sending tip"),visibleRegionsTag:(0,s.AP)("Visible Regions"),northAmericaTitle:(0,s.AP)("North America"),southAmericaTitle:(0,s.AP)("South America"),asiaTitle:(0,s.AP)("Asia"),europeRussiaTitle:(0,s.AP)("Europe/Russia"),otherTitle:(0,s.AP)("Other"),refresh30Seconds:(0,s.AP)("30 Seconds"),refresh45Seconds:(0,s.AP)("45 Seconds"),refresh60Seconds:(0,s.AP)("60 Seconds"),refresh90Seconds:(0,s.AP)("90 Seconds"),refreshDisable:(0,s.AP)("Disable"),refreshThumbnailsEvery:(0,s.AP)("Refresh thumbnails every"),showLocations:(0,s.AP)("Show locations"),previewRooms:(0,s.AP)("Preview rooms"),moreTags:(0,s.AP)("(more tags)"),removeFilter:(0,s.AP)("(remove filter)"),filters:(0,s.AP)("Filters"),options:(0,s.AP)("Options"),privateBrowsingMessage:(0,s.AP)("Broadcasting while private browsing is not supported for Firefox. Please disable private browsing and try again."),unableToReloadErrorMessage:(0,s.AP)("Something went wrong while loading the rooms. Please <a class='link'>refresh the page</a> to try again."),onlineRooms:(0,s.AP)("Online Rooms"),offlineRooms:(0,s.AP)("Offline Rooms"),metaContentCardDescriptionPremium:(0,s.AP)("Join a private or spy show for greater intimacy and voyeurism."),metaContentCardDescriptionFemale:(0,s.AP)("Enjoy uncensored adult chat & live webcams with amateur girls. No registration required!"),metaContentCardDescriptionMale:(0,s.AP)("Enjoy uncensored adult chat & live webcams with amateur guys. No registration required!"),metaContentCardDescriptionCouples:(0,s.AP)("Enjoy uncensored adult chat & live webcams with amateur couples. No registration required!"),metaContentCardDescriptionTrans:(0,s.AP)("Enjoy uncensored adult chat & live trans webcams with amateurs. No registration required!"),metaContentCardDescriptionDefault:(0,s.AP)("Enjoy free chat and live webcam broadcasts from amateurs around the world. No registration required!"),metaDescriptionDefault:(0,s.AP)("Watch Live Cams Now! No Registration Required - 100% Free Uncensored Adult Chat. Start chatting with amateurs, exhibitionists, pornstars w/ HD Video & Audio."),metaDescriptionPremium:(0,s.AP)("You can join a private show and for only a few tokens per minute. Chat in private shows and direct all the action!"),metaDescriptionSiteDefault:(0,s.AP)("Enjoy free webcams broadcasted live from amateurs around the world! - Join 100% Free"),metaKeywordsFemale:(0,s.AP)("free chat with girls, live cam girls, free webcam girls"),metaKeywordsMale:(0,s.AP)("free chat with men, live gay cams, free gay webcams"),metaKeywordsCouple:(0,s.AP)("free chat with couple, live cam couple, free webcam couple"),metaKeywordsTrans:(0,s.AP)("free chat with trans, live cam trans, free webcam trans"),metaKeywordsDefault:(0,s.AP)("free cams, free adult video chat, free sex webcams, live adult cams, adult webcams, free live porn"),metaKeywordsPremium:(0,s.AP)("private cams and spy cams"),metaKeywordsSiteDefault:(0,s.AP)("adult chat, adult cams, free chat, free cams, live cams"),premiumShowsCaps:(0,s.AP)("PREMIUM SHOWS"),featuredText:(0,s.AP)("Featured"),highestTokenColorTooltip:(0,s.AP)('If your "tipped recently" amount is higher than the selected value, your username will be displayed in the selected color.'),tipShortcodeMessageInDoubleQuotes:(0,s.AP)("The message content for tip shortcode must be enclosed in double quotes"),tipShortcodeArgsMissing:(0,s.AP)("Tip shortcode requires an amount and message"),loadingPreview:(0,s.AP)("Loading Preview"),obsGuideCodec:(0,s.AP)("Codec:"),obsGuideCodecBody:(0,s.AP)("H.264 Video, AAC Audio."),obsGuideAspect:(0,s.AP)("Aspect ratio:"),obsGuideAspectBody:(0,s.AP)("4:3 or 16:9 only."),obsGuideResolution:(0,s.AP)("Resolution:"),obsGuideResolutionBody:(0,s.AP)("From a height of 240 pixels up to 4k (2160 pixels)."),obsGuideFPS:(0,s.AP)("Frame Rate:"),obsGuideFPSBody:(0,s.AP)("24-30fps, or 48-60fps for high frame rate."),obsGuideBitrate:(0,s.AP)("Bitrate:"),obsGuideBitrateBody:(0,s.AP)("Up to 50 Mbps (50 000 Kbps) Video, 192 Kbps Audio - CBR Preferred."),obsGuideKeyFrame:(0,s.AP)("Key Frame Interval:"),obsGuideKeyFrameBody:(0,s.AP)("2 seconds."),obsGuideKeyProfile:(0,s.AP)("H.264 Profile:"),obsGuideKeyProfileBody:(0,s.AP)("Main or High preferred; baseline is acceptable."),obsGuideGenerate:(0,s.AP)("Generate New Token"),obsGuideGenerateFail:(0,s.AP)("Failed to reset token. Please try again."),internalStaffPrivate:(0,s.AP)("Cannot start or spy on private shows as staff while on internal site."),internalStaffMessage:(0,s.AP)("Cannot chat as staff while on internal site."),internalStaffFanClub:(0,s.AP)("Cannot join fanclubs as staff while on internal site."),internalStaffPurchase:(0,s.AP)("Cannot purchase as staff while on internal site."),internalStaffTip:(0,s.AP)("Cannot tip as staff while on internal site."),internalStaffC2C:(0,s.AP)("Cannot Cam to Cam as staff while on internal site."),internalStaffPromotion:(0,s.AP)("Cannot start promotion as staff while on internal site."),clear:(0,s.AP)("clear"),reset:(0,s.AP)("reset"),notFound:(0,s.AP)("Not found"),agesCAPS:(0,s.AP)("AGES"),hmpgFilterOpt6TksAbbrev:(0,s.AP)("6 tks"),hmpgFilterOpt12To18TksAbbrev:(0,s.AP)("12 - 18 tks"),hmpgFilterOpt30TksAbbrev:(0,s.AP)("30 - 42 tks"),hmpgFilterOpt60TksAbbrev:(0,s.AP)("60 - 72 tks"),hmpgFilterOpt90TksAbbrev:(0,s.AP)("90+ tks"),regionsCAPS:(0,s.AP)("REGIONS"),privateTksPerMinCAPS:(0,s.AP)("PRIVATE SHOW TOKENS PER MINUTE"),otherEncoderSupport:(0,s.AP)("See our support page for <a class='hrefColor' href='https://support.chaturbate.com/hc/en-us/articles/360037971972' target='_blank'>technical info</a>."),tagSearchPlaceholder:(0,s.AP)("Search #tags"),privateTimeWithBroadcaster:(0,s.AP)("Private time with broadcaster"),recordedVideo:(0,s.AP)("A recorded video of this show in your collection."),lowStreamResolution:(0,s.AP)("Your stream resolution is lower than the recommended minimum of 480 pixels, we suggest you increase your stream resolution."),streamNotHD:(0,s.AP)("Note: Your stream is <strong>not</strong> HD, a minimum height of 720 pixels is required."),streamNotWidescreen:(0,s.AP)("Your stream is not widescreen. We recommend all streams to be widescreen (16:9 ratio) with external encoders"),errorHandlingStream:(0,s.AP)("Error handling your stream, please restart it and contact support if this persists."),unstableBitrate:(0,s.AP)("Your bitrate is unstable which can indicate a poor connection."),veryGoodBitrate:(0,s.AP)("Your bitrate is very good!"),frameRateMuchLower:(0,s.AP)("Your frame rate is much lower than the recommended minimum of 24 fps"),frameRateLower:(0,s.AP)("Your frame rate is lower than the recommended minimum of 24 fps"),frameRateHigh:(0,s.AP)("You are broadcasting with a high frame rate. Please only use this if your camera is set to a high frame rate."),frameRateTooHigh:(0,s.AP)("Your frame rate is higher than the maximum of 60 fps. This will result in a poor stream output."),fpsVeryUnstable:(0,s.AP)("Your fps is very unstable. Your encoder may be overloaded."),fpsUnstable:(0,s.AP)("Your fps is unstable. Your encoder may be overloaded."),noQualityInformation:(0,s.AP)("Unable to get quality information, please contact support if this persists. Your stream is not affected."),alert:(0,s.AP)("Alert"),warning:(0,s.AP)("Warning"),yourStreamIsGood:(0,s.AP)("Your stream is good"),noIssues:(0,s.AP)("No issues to report"),enableLLHLS:(0,s.AP)("Enable LL-HLS"),promoteThisRoom:(0,s.AP)("Promote This Room"),notEnoughTokensMessage:(0,s.AP)("You do not have enough tokens."),promotionUnavailableOffline:(0,s.AP)("Broadcaster must be online and public in order to promote room."),promotionUnavailableTitle:(0,s.AP)("The promotion feature is currently unavailable"),promotionUnavailableDescription:(0,s.AP)("This room may already be enjoying high visibility or undergoing promotion. Check back later for a chance to add this room to the homepage."),promotionConfirmTitle:(0,s.AP)("Promote Room"),promotionConfirmDescription:(0,s.AP)("Boost this room's visibility by adding it to a rotating promoted spot on the homepage for 5 minutes."),promotionConfirmPromoteText:(0,s.AP)("Yes, promote room"),promotionIneligibleUserMessage:(0,s.AP)("Your account is unable to promote room. Please contact support."),roomSizeCAPS:(0,s.AP)("ROOM SIZE"),intimateRoomSizeCategory:(0,s.AP)("Intimate"),intimateRoomsLabel:(0,s.AP)("Intimate Rooms"),midSizeRoomSizeCategory:(0,s.AP)("Mid-Sized"),midSizeRoomsLabel:(0,s.AP)("Mid-Sized Rooms"),hiTrafficRoomSizeCategory:(0,s.AP)("High-Traffic"),hiTrafficRoomsLabel:(0,s.AP)("High-Traffic Rooms"),broadcasterWarningMessage:(0,s.AP)("A site administrator has sent you the following message:"),broadcasterWarningAknowledge:(0,s.AP)("I understand"),broadcasterWarningQuestion:(0,s.AP)("I have a question"),broadcastTermsHeader:(0,s.AP)("WARNING:  THIS SITE HAS A ZERO TOLERANCE POLICY ON UNDERAGE BROADCASTING."),broadcastTerms1:(0,s.AP)("The Chaturbate service is for use by adults only. By clicking the link below, you are affirming your representation and warranty to us that:"),broadcastTerms2:(0,s.AP)('You are at least 18 years old or the age of majority in your jurisdiction, whichever is older (the "Age of Majority");'),broadcastTerms3:(0,s.AP)("Anyone appearing on camera with you has also reached the Age of Majority;"),broadcastTerms4:(0,s.AP)("At no time will anyone who has not reached the Age of Majority be present while you are using the Chaturbate service;"),broadcastTerms5:(0,s.AP)("You will not permit anyone who has not reached the Age of Majority to use the Chaturbate service; and"),broadcastTerms6:(0,s.AP)('You will immediately report by email to <a href="mailto:support@chaturbate.com">support@chaturbate.com</a> any and all instances you become aware of wherein an individual has used the Chaturbate service without first reaching the Age of Majority.'),broadcastTerms7:(0,s.AP)("Obviously, you consent to and request your image being broadcast on the Chaturbate platform."),broadcastTerms8:(0,s.AP)("You agree that you will be governed by the Chaturbate Terms and by the Chaturbate Broadcaster Agreement."),broadcastTerms9:(0,s.AP)("You agree that only age verified broadcasters associated with this room may broadcast in this room."),broadcastTerms10:(0,s.AP)('If we suspect, in our sole discretion, that you are using the Chaturbate service without having complied in every respect with the foregoing statements, your account <span style="text-decoration: underline; font-weight: bold;">will</span> be terminated immediately, and we <span style="text-decoration: underline; font-weight: bold;">will</span> report your conduct to law enforcement.'),termsAgree:(0,s.AP)("I AGREE"),preferenceUpdateError:(0,s.AP)("An error occurred while updating your preferences. Please try again"),mustBeLoggedInForChatSettings:(0,s.AP)('You must be logged in to change chat settings. Click "OK" to login.'),mustBeSupporterForChatColor:(0,s.AP)("You must be a supporter to change chat color"),mustBeLoggedInForChatColor:(0,s.AP)('You must be logged in to change chat color. Click "OK" to login.'),mustBeSupporterForFontFamily:(0,s.AP)("You must be a supporter to change font family"),mustBeLoggedInForFontFamily:(0,s.AP)('You must be logged in to change font family. Click "OK" to login.'),mustBeLoggedInForIgnoredUsers:(0,s.AP)('You must be logged in to edit ignored users. Click "OK" to login.'),dropDownWhatsApp:(0,s.AP)("WhatsApp"),dropDownDiscord:(0,s.AP)("Discord"),whatsAppLabelText:(0,s.AP)("Your WhatsApp number with country code but without the + sign (e.g. 112345678900):"),whatsAppInvalidInput:(0,s.AP)("Please enter a valid WhatsApp number."),discordLabelText:(0,s.AP)("Your Discord Invite Link:"),discordInvalidInput:(0,s.AP)("Please enter a valid Discord link."),defaultInvalidInput:(0,s.AP)("Please enter valid social media username/channel."),defaultLabelText:(0,s.AP)("Your Social Media Username/Channel/Invite Link:"),scrollToBottom:(0,s.AP)("Scroll to bottom"),tenPlusNewMessages:(0,s.AP)("10+ new messages"),tryingToReconnect:(0,s.AP)("Trying to reconnect"),chatDisconnected:(0,s.AP)("Chat disconnected"),tooltipPrivateMinute:(0,s.AP)("Private price per min."),tooltipSpyMinute:(0,s.AP)("Spy price per min."),rotateForPMs:(0,s.AP)("Rotate device to view PMs"),rotateForDMs:(0,s.AP)("Rotate device to view DMs"),hiddenBansRequestProcessing:(0,s.AP)("Your request is processing. You can close and reopen this form to check on progress."),hiddenBansRequestError:(0,s.AP)("An error occurred removing hidden silences and bans"),recommendedForYou:(0,s.AP)("Recommended For You"),searchBar:(0,s.AP)("Search Bar"),loadMore:(0,s.AP)("Load more")}},1372:(e,t,i)=>{"use strict";i.d(t,{FK:()=>n,tT:()=>h,zN:()=>p});var s=i(6784);const n=()=>"FRAGMENT",o={style:(e,t)=>{Object.assign(e.style,t)},className:(e,t)=>{e.setAttribute("class",t)},class:(e,t)=>{e.setAttribute("class",t)},htmlFor:(e,t)=>{e.setAttribute("for",t)},colorClass:(e,t)=>{const i=t;Array.isArray(i)?i.forEach((t=>{""!==t&&e.classList.add(t)})):e.classList.add(i)},xlinkHref:(e,t)=>{e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t)},dangerouslySetInnerHTML:(e,t)=>{e.innerHTML=t.__html},bind:(e,t)=>{!function(e,t){c(e,(()=>{Object.keys(t).forEach((i=>{const s=t[i];if(!(s instanceof Function))return void warn(`Wrong binding for element ${e.outerHTML} key ${i} is not a function ${s}`);const n=t[i]();"display"===i?e.style.display=n:"text"===i?e.textContent=n:r(i,e,n)}))}))}(e,t)},ref:(e,t)=>{"function"==typeof t&&t(e)},display:(e,t)=>{e.style.display=t}};function r(e,t,i){const n=o[e];void 0!==n?n(t,i):0===e.indexOf("on")?function(e,t,i){let n=e.toLowerCase(),o=!1;e.indexOf("Capture",e.length-7)>-1&&(o=!0,n=n.slice(-7)),null===t[n]?(0,s.wu)(n.slice(2),t,i,o):warn(`Event declared for JSX element that does not exist on type ${t.tagName}: ${e}`)}(e,t,i):t.setAttribute(e,i)}function a(e,t){"function"==typeof e.ref&&e.ref(t,e)}function l(e){const t=document.createDocumentFragment();return e.forEach((function e(i){if(i instanceof HTMLElement||i instanceof SVGElement||i instanceof Comment||i instanceof DocumentFragment)t.appendChild(i),u(t,i);else if("string"==typeof i||"number"==typeof i){const e=document.createTextNode(`${i}`);t.appendChild(e)}else i instanceof Array?i.forEach(e):!1===i||null==i?debug(`Logic expression in Tsx fragment: ${i}`):warn(`Unexpected child in Tsx fragment: ${i}`)})),t}function h(e,t){for(var i=arguments.length,s=new Array(i>2?i-2:0),n=2;n<i;n++)s[n-2]=arguments[n];return"function"==typeof e?void 0===e.prototype||void 0===e.prototype.render?function(e,t,i){const s=Object.assign({},{},t,{children:i}),n=e(s);let o;return o="FRAGMENT"===n?l(i):n,a(s,o),o}(e,t,s):function(e,t,i){const s=Object.assign({},{},t,{children:i});let n=[];void 0!==s.unsafeArgs&&(n=s.unsafeArgs);const o=new e(s,...n),r=o.render();return function(e,t){"function"==typeof e.classRef&&e.classRef(t,e)}(s,o),a(s,r),void 0!==Object.getPrototypeOf(o).updateState&&c(r,o),r}(e,t,s):function(e,t,i){const s=function(e){const t=new RegExp(`^${e}$`,"i");return["path","svg","use","g"].some((e=>t.test(e)))}(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e),n=l(i);return s.appendChild(n),u(s,n),function(e,t){if(null!=t){const i=Object.keys(t),s=i.indexOf("colorClass");s>=0&&i.push(i.splice(s,1)[0]),i.forEach((i=>{r(i,e,t[i])}))}}(s,t),s}(e,t,s)}const d="__mm_bindings__";function c(e,t){d in e||(e[d]=[]),e[d].push(t)}function u(e,t){if(d in t)for(const i of t[d])c(e,i)}function p(e){var t;return null!==(t=e[d])&&void 0!==t?t:[]}},2945:(e,t,i)=>{"use strict";i.d(t,{Go:()=>l,JO:()=>h,KZ:()=>o,W2:()=>r});var s=i(4936),n=i(5216);function o(e){const t=a(e);if(t!==document.location.search&&"replaceState"in window.history){const e=null!==window.top?window.top:window,i=(0,s.zm)(t,e.location.pathname);window.history.replaceState("","",(0,n._Y)(i))}}function r(e,t){const i=a(e);i!==window.location.search&&"pushState"in window.history&&window.history.pushState(t,"",(0,n._Y)((0,s.zm)(i,window.location.pathname)))}function a(e){const t=new URLSearchParams(window.location.search);e.forEach(((e,i)=>{""===e?t.delete(i):t.set(i,e)}));const i=t.toString().replace(/%2C/g,",");return""===i?"":`?${i}`}function l(e){let t="";for(const i of Object.keys(e)){""!==t&&(t+="&");let s=e[i];void 0===s&&(s=""),t+=`${encodeURIComponent(i)}=${encodeURIComponent(s)}`}return t}function h(e){e.length>0&&"?"===e[0]&&(e=e.slice(1));const t={};for(const i of e.split("&"))if(i.includes("=")){const e=i.split("=");e[0].length>0&&(t[decodeURIComponent(e[0])]=e[1].length>0?decodeURIComponent(e[1]):void 0)}else i.length>0&&(t[decodeURIComponent(i)]=void 0);return t}},4110:(e,t,i)=>{"use strict";i.d(t,{Ch:()=>l,E3:()=>a,ME:()=>d,PV:()=>c,kw:()=>o,n2:()=>r,nw:()=>n,q_:()=>h,xw:()=>u});var s=i(8423);const n=new s.c_("roomListRequest"),o=new s.c_("playerForceMuted"),r=new s.c_("standardEmoticonRequest"),a=new s.c_("userInitiatedPm"),l=new s.c_("mentionUser"),h=new s.c_("appDebuggingToggled"),d=new s.c_("getMoreHistoryMessages"),c=new s.c_("repositionChatTabContent"),u=new s.c_("userModeratorStatusChanged")},3741:(e,t,i)=>{"use strict";i.d(t,{$:()=>D,Zm:()=>L,h1:()=>B,qH:()=>U});var s=i(20),n=i(9447),o=i(227),r=i(3910),a=i(9757),l=i(9461),h=i(369),d=i(9394),c=i(9603),u=i(6784),p=i(213),m=i(5216),g=i(6844),v=i(5746),f=i(2939),y=i(5020),b=i(3955),w=i(8423),C=i(2396),S=i(2119),x=i(1779),T=i(6716),P=i(7407),k=i(3587),A=i(5173),M=i(8785),R=i(74),I=i(4947),E=i(4110);function L(){const e=U.state;return 0===e||1===e}function D(){return L()||(0,o._I)()}function B(){U.setUserContextMenuState(3)}class U extends A.Q{static setUCMContainer(e){U.ucmContainer=e}constructor(e,t,i){var s;super(),this.user=e,this.message=i,this.ucmListenerGroup=new w.gt,this.tearDownListener=e=>{const t=e.ctrlKey||e.metaKey,i=9===e.keyCode,s=t&&83===e.keyCode,n=t&&191===e.keyCode,o=191===e.keyCode,r=t&&76===e.keyCode,a=27===e.keyCode;(i||s||n||r||a||o)&&this.hideOverlay()},this.hideOverlayListener=()=>{this.hideOverlay()},this.clickTargetEl=t,this.parentEl=null!==(s=U.ucmContainer)&&void 0!==s?s:t.offsetParent,this.createPlaceholder(),(0,u.wu)("keydown",document,this.tearDownListener),this.fullscreenChangeListener=x._c.listen(this.hideOverlayListener),(0,u.wu)("popstate",window,this.hideOverlayListener),R.pL.listen(this.hideOverlayListener,!1).addTo(this.ucmListenerGroup),T.VZ.listen(this.hideOverlayListener,!1).addTo(this.ucmListenerGroup);let n=window.innerWidth;h.oO.listen((()=>{window.innerWidth<n&&this.hideOverlayListener(),n=window.innerWidth})).addTo(this.ucmListenerGroup),this.parentEl.appendChild(this.element),this.afterDOMConstructedIncludingChildren(),this.overlayClick.listen((()=>{this.hideOverlay()})),super.showOverlay(),this.loadData()}getUsername(){return this.user.username}static setUserContextMenuState(e){U.state=e}createPlaceholder(){this.initializeMenu(),this.addHeader(),this.addUserLabels(),this.addRestMenu(),this.addHeaderLeftData(),this.addLinksData()}loadData(){U.setUserContextMenuState(0),this.position(!0),(0,C.b)(this.user.username).then((e=>{2!==U.state&&(this.fillData(e),this.position())})).catch((e=>{error("Could not process user menu request",{username:this.user.username,reason:e.toString()})}))}fillData(e){void 0===this.data&&(this.data=e,this.showSupporterAlert=this.data.needsSupporterToPm,this.addHeaderRightData(),this.addSilenceIfAllowed(),U.setUserContextMenuState(1))}initializeMenu(){U.setUserContextMenuState(0),this.element=document.createElement("div"),this.element.id="user-context-menu",this.element.dataset.testid="user-context-menu",this.menuContents=document.createElement("div"),this.modSection=document.createElement("div"),this.menuContents.style.backgroundColor="",this.element.appendChild(this.menuContents),this.element.style.textShadow="none",this.element.style.position="absolute",this.element.style.borderRadius="4px",this.element.style.borderStyle="solid",this.element.style.borderWidth="1px",this.element.style.top="0",this.element.style.fontWeight="normal",this.element.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",this.element.style.fontSize="12px",this.element.style.width="188px",this.element.style.cursor="default",this.element.style.visibility="visible",this.element.style.zIndex="1010",this.overlay.style.zIndex="1010",f.X0.listen((e=>{this.roomName=e.dossier.room,this.currentUsername=e.dossier.userName,this.chatConn=e.chatConnection})).addTo(this.ucmListenerGroup)}addLoadingStyle(e){(0,n.fZ)(e,"ucmPlaceholder")}removeLoadingStyle(e){(0,n.SA)(e,"ucmPlaceholder")}addHeader(){const e=document.createElement("div");(0,n.fZ)(e,"ucmHeader"),e.style.padding="9px 10px",e.style.fontWeight="bold",e.style.borderTopLeftRadius="4px",e.style.borderTopRightRadius="4px",this.name=document.createElement("div"),this.name.style.display="inline-block",this.name.style.maxWidth="100px",this.name.style.height="12px",this.name.style.marginRight="4px",e.appendChild(this.name);const t=S.M.getOrCreateInstance().hasFollower(this.user.username);if(l.Bm.current.isBroadcast&&t&&this.user.username!==l.Aw.getState().room){const t=(0,d.H)(),i=(0,c.q)({content:I.R.followsYou,hasHTML:!1,divotPosition:y.Wi.Bottom,divotLeftOrTop:"8px"});i.style.padding="6px",i.style.fontFamily="UbuntuLight, Helvetica, Arial, sans-serif",i.style.lineHeight="normal",i.style.position="fixed",i.style.display="block",i.style.width="max-content",i.style.zIndex="1011",(0,b.JR)(t).listen((e=>{var s;e?document.body.appendChild(i):null===(s=i.parentElement)||void 0===s||s.removeChild(i);const n=t.getBoundingClientRect(),o=(0,b.Mx)();i.style.top=-o.top+n.top-i.offsetHeight-n.height/5-5+"px",i.style.left=-o.left+n.left+n.width/2-18+"px"})),e.appendChild(t)}const i=document.createElement("div");i.style.display="inline-block",i.style.width="38px",i.style.height="12px",i.style.position="absolute",i.style.right="8px",this.age=document.createElement("span"),(0,n.fZ)(this.age,"ucmAgespan"),this.age.style.display="inline-block",this.age.style.width="15px",this.age.style.minHeight="14px",this.age.style.fontSize="12px",this.age.style.fontWeight="bold",this.age.style.marginRight="6px",this.age.style.verticalAlign="top",i.appendChild(this.age),this.addLoadingStyle(this.age),this.genderSpan=document.createElement("span"),this.genderSpan.style.display="inline-block",this.genderSpan.style.width="15px",this.genderSpan.style.height="14px",this.genderSpan.style.verticalAlign="top",this.genderIcon=document.createElement("img"),void 0!==this.user.gender?(this.genderIcon.src=(0,M.e0)(this.user.gender),this.genderIcon.style.display="inline-block",this.genderIcon.title=I.R.genderSymbolToIconTitle(this.user.gender)):(this.addLoadingStyle(this.genderSpan),this.genderIcon.style.display="none"),this.genderIcon.height=14,this.genderIcon.width=14,this.genderSpan.appendChild(this.genderIcon),i.appendChild(this.genderSpan),e.appendChild(i),this.menuContents.appendChild(e)}addHeaderLeftData(){const e=document.createElement("a");e.innerText=this.user.username,(0,n.fZ)(e,(0,M.Kb)(this.user)),e.dataset.testid="username",e.style.fontWeight="bold",e.href=(0,m._Y)(`/${this.user.username}/`),e.target="_blank",e.style.textDecoration="none",e.style.overflow="hidden",e.style.textOverflow="ellipsis",e.style.maxWidth="100px",e.style.display="inline-block",e.style.cursor="pointer",e.onmouseenter=()=>{e.style.textDecoration="underline"},e.onmouseleave=()=>{e.style.textDecoration="none"},(0,u.wu)("click",this.name,(e=>{(0,P.bT)("ViewProfile",{username:this.user.username}),e.stopPropagation(),this.hideOverlay()})),this.name.appendChild(e),this.overlay.style.background="rgba(0, 0, 0, 0.01)",this.element.style.visibility="visible"}addHeaderRightData(){var e;const t=document.createElement("div");if(t.style.width="188px",t.style.height="75px",t.style.overflow="hidden",t.style.borderRadius="4px 4px 0px 0px",!0===(null===(e=this.data)||void 0===e?void 0:e.online)){const e=document.createElement("img");(0,u.wu)("load",e,(()=>{const i=t.getBoundingClientRect(),s=e.getBoundingClientRect();i.height<s.height&&(e.style.position="relative",e.style.left="0px",e.style.top=(i.height-s.height)/2+"px")})),e.src=this.data.imageUrl,e.dataset.testid="gender-icon",e.style.width="100%",t.appendChild(e),this.adjustForImg(),this.element.insertBefore(t,this.element.firstChild)}this.removeLoadingStyle(this.age),this.removeLoadingStyle(this.genderSpan),this.data&&(this.genderIcon.src=(0,M.e0)(this.data.gender),this.genderIcon.style.display="inline-block",!0===this.data.canAccess&&(!isNaN(this.data.displayAge)&&this.data.displayAge>=18&&(this.age.innerText=this.data.displayAge.toString()),this.removeLoadingStyle(this.age)))}addUserLabels(){const e=(0,M.DG)(this.user),t=(0,M.LD)(this.user);if(void 0!==e){const i=document.createElement("div");(0,n.fZ)(i,"ucmUserLabel"),i.style.padding="9px 10px",i.style.borderTopWidth="1px",i.style.borderTopStyle="solid",this.menuContents.appendChild(i);const s=document.createElement("div");if(s.dataset.testid="user-label",s.style.width="74px",s.style.height="12px",s.style.width="100%",s.innerText=e,(0,n.fZ)(s,(0,M.Kb)(this.user)),s.style.fontWeight="bold",i.appendChild(s),void 0!==t){const e=document.createElement("div");(0,n.fZ)(e,"ucmSublabel"),e.style.height="10px",e.style.fontSize="10px",e.style.marginTop="4px",e.style["-webkit-text-size-adjust"]="none",e.innerText=t,i.appendChild(e)}}}addRestMenu(){this.addLinks(this.user),this.addModSection(),this.addNotes(this.user.username)}addNotes(e){if(void 0===this.currentUsername||this.currentUsername===e)return;const t=document.createElement("div"),i=a.c.get("UserNote");this.reactUserNote=new i({username:e,badgeManager:k.T.getOrCreateInstance(),isNotLoggedIn:g.rC,removeMenu:()=>{this.hideOverlay()}},t),this.menuContents.appendChild(t)}addLinks(e){this.menuLinks=document.createElement("div"),(0,n.fZ)(this.menuLinks,"ucmLinks"),this.menuLinks.style.padding="5px 0",this.menuLinks.style.fontSize="12px",this.menuLinks.style.borderTopWidth="1px",this.menuLinks.style.borderTopStyle="solid",this.menuContents.appendChild(this.menuLinks)}addModSection(){this.menuContents.appendChild(this.modSection),(0,n.fZ)(this.modSection,"ucmModSection"),this.modSection.style.borderTopWidth="1px",this.modSection.style.borderTopStyle="solid",this.modSection.style.padding="5px 0",this.modSection.style.display="none"}addLinksData(){if(this.currentUsername!==this.user.username){if(void 0===this.chatConn)return void error("ignoreText: Chatconnection should be defined");const e=this.createSendLink(this.user.username,!0);if(this.menuLinks.appendChild(e),(0,s.SU)()){const e=this.createSendLink(this.user.username,!1);this.menuLinks.appendChild(e)}const t=this.createMentionLink(this.user.username);if(this.menuLinks.appendChild(t),this.roomName!==this.currentUsername){const e=this.createIgnoreLink(this.user.username,this.chatConn);this.menuLinks.appendChild(e)}if(void 0!==this.message){const e=this.createReportLink(this.user.username,this.message);this.menuLinks.appendChild(e)}}else this.menuLinks.style.display="none"}addSilenceIfAllowed(){if(void 0!==this.data&&this.data.canSilence){const e=document.createElement("div"),t=this.createLink(),i=this.createLinkSpan(),s=this.data.username;i.style.paddingLeft="20px",t.appendChild(i),t.dataset.testid="silence-toggle",e.appendChild(t),void 0!==this.data.silenceId?i.innerText=I.R.removeSilenceMessage:i.innerText=I.R.silenceDurationMessage,i.title=i.innerText,t.onclick=()=>{void 0!==this.data&&void 0!==this.data.silenceId&&void 0!==this.roomName?(0,m.KF)("edit_room_ban/",{banid:String(this.data.silenceId),action:"remove_silence",room_username:this.roomName}).catch((e=>{error("remove_silence_ error",e),(0,p.Q$)(`Error removing silence from user ${s}`)})):(0,p.mf)(`Silence ${this.user.username}?`,(()=>{(0,P.bT)("SilenceUser",{username:this.user.username,to_user:this.user.username}),(0,m.KF)(`roomsilence/${this.user.username}/${this.roomName}/`,{}).catch((e=>{error("silence_user_error",e),(0,p.Q$)(`Error silencing user ${this.user.username}`)}))})),this.hideOverlay()},this.modSection.appendChild(e),this.modSection.style.display=""}}findBoundary(){if((0,x.aS)())return{boundV:(0,x.Gy)(),boundH:(0,x.Gy)()};const e=(e,t,i)=>{const s=window.getComputedStyle(e);return void 0===t&&"hidden"===s.overflowY&&(t=e),void 0===i&&"hidden"===s.overflowX&&(i=e),[t,i]};let t,i;for(let s=this.parentEl;void 0!==s&&"body"!==s.tagName.toLowerCase()&&([t,i]=e(s,t,i),void 0===t||void 0===i);s=null===s.parentElement?void 0:s.parentElement);return{boundV:t,boundH:i}}trapInBoundary(e,t){const i=void 0===e?document.documentElement:e,s=void 0===t?document.documentElement:t,n=i.getBoundingClientRect(),o=s.getBoundingClientRect(),r=this.element.getBoundingClientRect(),a=n.bottom-r.height-38,l=o.right-r.width,h=n.top,d=o.left,c=r.top,u=r.left;if(h>c){const e=h-c;this.element.style.top=`${this.element.offsetTop+e+4}px`}if(d>u){const e=d-u;this.element.style.left=`${this.element.offsetLeft+e+4}px`}if(a<c){const e=a-c;this.element.style.top=this.element.offsetTop+e-4+"px"}if(l<u){const e=l-u;this.element.style.left=this.element.offsetLeft+e-4+"px"}}alignNameWith(e){if(!document.body.contains(this.name))return;const t=this.name.getBoundingClientRect(),i=e.top-t.top,s=e.left-t.left,n=this.element.offsetTop+i,o=this.element.offsetLeft+s;this.element.style.top=`${n}px`,this.element.style.left=`${o}px`}shiftUpToSeeNotes(){if(void 0===this.currentUsername||this.currentUsername===this.user.username)return;const e=window.innerHeight-(this.element.getBoundingClientRect().top+this.element.offsetHeight+85);if(e<0){const t=parseInt(this.element.style.top.slice(0,-2));this.element.style.top=`${t+e}px`}}adjustForImg(){this.element.style.top=this.element.offsetTop-75+"px"}repositionToMatch(e){this.alignNameWith(e),this.shiftUpToSeeNotes()}position(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.repositionToMatch(this.clickTargetEl.getBoundingClientRect());const e=this.findBoundary();this.trapInBoundary(e.boundV,e.boundH)}hideOverlay(){var e,t;2!==U.state&&(super.hideOverlay(),void 0!==this.chatReport&&this.chatReport.tearDown(),(0,u.Pf)("keydown",document,this.tearDownListener),null===(e=this.fullscreenChangeListener)||void 0===e||e.removeListener(),this.fullscreenChangeListener=void 0,(0,u.Pf)("popstate",window,this.hideOverlayListener),this.ucmListenerGroup.removeAll(),this.parentEl.removeChild(this.element),this.afterRemovedFromParent(),U.setUserContextMenuState(2),null===(t=this.reactUserNote)||void 0===t||t.dispose())}createSendLink(e,t){const i=this.createLink(),s=document.createElement("div"),o=this.createLinkSpan();return(0,n.fZ)(i,"ucmPMLink"),i.dataset.testid=t?"send-pm":"send-dm",i.appendChild(s),i.appendChild(o),o.innerText=t?I.R.sendPrivateMessageText:I.R.sendDirectMessageText,o.title=o.innerText,(0,n.fZ)(s,t?"ucmSendPmIcon":"ucmSendDmIcon"),s.style.padding="0px 4px 0 0",s.style.verticalAlign="bottom",s.style.width="14px",s.style.height="14px",s.style.display="inline-block",s.style.marginRight="4px",(0,u.wu)("click",i,(i=>{this.hideOverlay(),(0,g.rC)(t?I.R.loggedInToPm:I.R.loggedInToDm)||(t?((0,P.bT)("StartPrivateMessage",{username:e,to_user:e,location:"PMTab"}),E.E3.fire({username:e,focus:!0,showSupporterAlert:this.showSupporterAlert})):((0,P.bT)("StartDirectMessage",{username:e,to_user:e}),r.$o.fire(e)),i.stopPropagation())})),i}createMentionLink(e){const t=this.createLink(),i=document.createElement("div"),s=this.createLinkSpan();return s.innerText=I.R.mentionUserText,s.title=s.innerText,(0,n.fZ)(i,"ucmMentionIcon"),i.style.width="14px",i.style.height="14px",i.style.padding="0px 4px 0 0px",i.style.verticalAlign="bottom",i.style.display="inline-block",i.style.marginRight="4px",t.id="ucm-mentionuser",t.dataset.testid="mention-user",t.appendChild(i),t.appendChild(s),(0,u.wu)("click",t,(()=>{E.Ch.fire(e),this.hideOverlay()})),t}createIgnoreLink(e,t){const i=this.createLink();i.dataset.testid="ignore-toggle";const s=document.createElement("div"),o=this.createLinkSpan();return(0,n.fZ)(i,"ucmIgnoreLink"),o.style.paddingLeft="0",o.innerText=t.isIgnored(e)?I.R.unignoreThisUserText:I.R.ignoreThisUserText,i.appendChild(s),o.title=o.innerText,i.appendChild(o),(0,n.fZ)(s,"ucmIgnoreIcon"),s.style.padding="0px 4px 0 0px",s.style.verticalAlign="bottom",s.style.width="14px",s.style.height="14px",s.style.display="inline-block",s.style.marginRight="4px",(0,u.wu)("click",i,(()=>{t.isIgnored(e)?t.unignore(e):t.ignore(e),this.hideOverlay()})),i}createReportLink(e,t){const i=this.createLink(),s=document.createElement("div"),o=this.createLinkSpan();return(0,n.fZ)(i,"ucmReportLink"),i.appendChild(s),i.appendChild(o),i.dataset.testid="report-room",(0,n.fZ)(s,"ucmReportIcon"),s.style.padding="0 4px 0 0",s.style.verticalAlign="middle",s.style.width="14px",s.style.height="14px",s.style.display="inline-block",s.style.marginRight="4px",o.innerText=I.R.reportThisMessageText,o.title=o.innerText,(0,u.wu)("click",i,(()=>{(0,P.bT)("ReportChatUser",{username:e,to_user:e}),this.element.removeChild(this.menuContents),this.chatReport=new v.n(e,t,this.chatConn),this.element.appendChild(this.chatReport.element),this.position(),this.chatReport.focusForm(),this.chatReport.closeChatReportRequest.listen((()=>{this.hideOverlay()}))})),i}createLink(){const e=document.createElement("div");return e.style.padding="3px 10px",e.style.whiteSpace="nowrap",e.style.overflow="hidden",e.style.textOverflow="ellipsis",e.style.fontWeight="normal",e.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",e.style.fontSize="12px",e.style["-webkit-text-size-adjust"]="none",(0,n.fZ)(e,"ucmLinkColor"),this.addLinkMouseover(e),e}createLinkSpan(){const e=document.createElement("span");return e.style.fontWeight="normal",e.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",e.style.fontSize="12px",e.style["-webkit-text-size-adjust"]="none",(0,n.fZ)(e,"ucmLinkColor"),e}addLinkMouseover(e){(0,n.fZ)(e,"ucmLinkHover"),e.onmouseenter=()=>{e.style.cursor="pointer"},e.onmouseleave=()=>{e.style.cursor="default"}}}U.state=2},9681:(e,t,i)=>{"use strict";i.d(t,{L:()=>b});var s=i(9447),n=i(6784),o=i(4054),r=i(213),a=i(5216),l=i(6844),h=i(2939),d=i(3955),c=i(7407),u=i(4947),p=i(4110),m=i(3741);class g extends m.qH{constructor(e,t,i){super(e,t,i)}addRestMenu(){if(super.addRestMenu(),this.currentUsername===this.user.username)return;this.modSection.style.display="",this.promoteModSection=document.createElement("div"),(0,s.fZ)(this.promoteModSection,"ucmPromoteModSection"),(0,d.ZM)(this.promoteModSection,{borderTopWidth:"1px",borderTopStyle:"solid",padding:"5px 0"}),this.hasTippedSection=document.createElement("div"),(0,s.fZ)(this.hasTippedSection,"ucmHasTippedSection"),(0,d.ZM)(this.hasTippedSection,{padding:"9px 10px",borderTopWidth:"1px",borderTopStyle:"solid"}),this.menuContents.insertBefore(this.promoteModSection,this.modSection.nextSibling),this.menuContents.appendChild(this.hasTippedSection);const e=this.createLink();e.dataset.testid="kick-ban-toggle";const t=this.createLinkSpan();t.style.paddingLeft="20px",this.modSection.appendChild(e),e.appendChild(t),t.innerText=u.R.kickBan,t.title=t.innerText,(0,n.wu)("click",e,(()=>{this.hideOverlay(),(0,l.rC)('You must be logged in to ban a user. Click "OK" to login.')||(0,r.mf)(u.R.banUserConfirm(this.user.username),(()=>{(0,c.bT)("BanUser",{username:this.user.username}),(0,a.KF)(`roomban/${this.user.username}/${this.roomName}/`,{}).catch((e=>{error("broadcast_ban_error",e),(0,r.Q$)(u.R.banUserError(this.user.username))}))}))}));const i=document.createElement("div"),o=document.createElement("img"),h=document.createElement("span");o.src=`${STATIC_URL}ico-tip.gif`,(0,d.ZM)(o,{width:"13px",height:"13px",padding:"2px 4px 0 1px"}),i.appendChild(o),i.appendChild(h),h.innerText=`${u.R.userHasTippedMe(this.user.username)}:`,(0,d.ZM)(h,{display:"inline-block",width:"100%",overflow:"hidden",textOverflow:"ellipsis"}),this.hasTippedSection.appendChild(i);const p=document.createElement("div"),m=document.createElement("div"),g=document.createElement("div");p.style.paddingLeft="20px",m.style.paddingLeft="20px",g.style.paddingLeft="20px";const v=document.createElement("span"),f=document.createElement("span"),y=document.createElement("span");p.appendChild(v),m.appendChild(f),g.appendChild(y),v.innerText=u.R.tokensInPastHour(0),v.dataset.testid="tipped-hour",f.innerText=u.R.tokensInPastDay(0),f.dataset.testid="tipped-day",y.innerText=u.R.tokensInPastTwoWeeks(0),y.dataset.testid="tipped-two-weeks",i.appendChild(p),i.appendChild(m),i.appendChild(g),void 0!==this.roomName&&void 0!==this.currentUsername&&(0,a.KF)("api/getchatusermenu/",{roomname:this.roomName,fromuser:this.currentUsername,touser:this.user.username}).then((e=>{this.promoteModSection.appendChild(this.createChangeModStatusLink(Boolean(e.getResponseHeader("X-Target_Is_Mod")),this.user)),v.innerText=u.R.tokensInPastHour(this.getTipHeaderValue(e.getResponseHeader("X-Tipped_Performer_Last_Hour"))),f.innerText=u.R.tokensInPastDay(this.getTipHeaderValue(e.getResponseHeader("X-Tipped_Performer_Last_24_Hours"))),y.innerText=u.R.tokensInPastTwoWeeks(this.getTipHeaderValue(e.getResponseHeader("X-Tipped_Performer_Last_Two_Weeks")))})).catch((e=>{error(e),(0,r.Q$)("Error fetching user menu")}))}addLinksData(){super.addLinksData();const e=this.createLink();e.style.display="none";const t=document.createElement("img");(0,d.ZM)(t,{padding:"0px 5px 0 2px",verticalAlign:"bottom"}),e.appendChild(t);const i=this.createLinkSpan();e.appendChild(i),h.X0.once((s=>{const r=o.p.getInstance();if(void 0!==r){const s=r.getContextMenuLinkInfo(this.user.username);""!==s.linkText&&(t.src=s.icon,i.textContent=s.linkText,(0,n.wu)("click",e,(()=>{s.action(),this.hideOverlay()})),e.style.display="")}})),e.dataset.testid="view-cam",this.menuLinks.prepend(e)}createChangeModStatusLink(e,t){const i=this.createLink(),s=this.createLinkSpan();let o,h,d;return s.style.paddingLeft="20px",i.dataset.testid="moderator-toggle",e?(s.innerText=u.R.removeModeratorStatus,o=u.R.removeModeratorLoginError,h=`removemoderator/${t.username}/${this.roomName}/`,d=u.R.moderatorRevokeError(t.username)):(s.innerText=u.R.promoteToModerator,o=u.R.promoteModeratorLoginError,h=`addmoderator/${t.username}/${this.roomName}/`,d=u.R.moderatorPromoteError(t.username)),s.title=s.innerText,(0,n.wu)("click",i,(()=>{this.hideOverlay(),(0,l.rC)(o)||(0,a.KF)(h,{}).then((()=>{p.xw.fire({isMod:!e,username:t.username})})).catch((e=>{error(e),(0,r.Q$)(d)}))})),i.appendChild(s),i}getTipHeaderValue(e){if(null===e)return 0;const t=Number(e);return t<0?0:t}}var v=i(1134),f=i(2709),y=i(8785);class b extends f.u{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(super(),this.user=e,(0,s.fZ)(this.element,(0,y.Kb)(e)),this.element.style.height="auto",this.element.style.width="auto",this.element.style.position="",this.element.style.display="inline-block",this.element.style.maxWidth="100%",this.element.style.textOverflow="ellipsis",this.element.style.whiteSpace="nowrap",this.element.style.fontWeight="bold",this.element.style.cursor="pointer",this.element.style.overflowX="hidden",this.element.style.verticalAlign="bottom",this.element.dataset.testid="username-label",this.badgeSpan=v.T.createBadges(e.username),this.element.appendChild(this.badgeSpan),this.usernameText=document.createElement("span"),this.usernameText.dataset.testid="username",this.usernameText.textContent=e.username,this.usernameText.title=u.R.usernameText,this.element.appendChild(this.usernameText),i){const t=document.createElement("img");t.style.display="inline-block",t.style.height="16px",t.style.margin="0 5px",t.style.verticalAlign="middle",t.src=(0,y.e0)(e.gender),t.title=u.R.genderSymbolToIconTitle(e.gender),t.dataset.testid="gender-icon",this.element.insertBefore(t,this.element.firstChild),this.element.style.whiteSpace="nowrap"}this.element.onmouseenter=()=>{this.element.style.textDecoration="underline"},this.element.onmouseleave=()=>{this.element.style.textDecoration="none"};const o=i=>{i.preventDefault(),null!==this.element.parentElement?((0,c.bT)("OpenUserContextMenu",{username:e.username}),b.createUserContextMenu(e,this.usernameText,t)):error("Username span has no parent")};(0,n.wu)("click",this.element,o),(0,n.wu)("contextmenu",this.element,o)}static createUserContextMenu(e,t,i){2===m.qH.state&&((0,y.b5)()?new g(e,t,i):new m.qH(e,t,i))}createMentionLabel(e){return this.usernameText.textContent=`@${this.user.username}`,this.badgeSpan.style.display="none",e&&((0,s.fZ)(this.element,"mentionHl"),this.element.style.padding="2px 4px",this.element.style.borderRadius="4px"),this.element}}},3860:(e,t,i)=>{"use strict";i.d(t,{L:()=>p});var s=i(4936),n=i(7623),o=i(8861),r=i(6844),a=i(1516),l=i(8423),h=i(1779),d=i(7407);const c="AflThtrMd5",u=new s.aj(c),p=new class{constructor(){this.storageKey="isTheaterMode",this.changeVideoMode=new l.c_("changeVideoMode",{listenersWarningThreshold:()=>20+l.hI}),this.hasFiredAflThtrMdEvents=!1;const e=this.getInitialVideoMode(),t="split"===e?"theater":"split";this.videoMode=e,this.lastVideoMode=t,this.lastNonFullscreenVideoMode=t,this.saveVideoModeStorage(),this.listenForFullscreen(),(0,d.NP)(this.videoMode),a.s.listen((e=>{this.isMobile="mobile"===e,this.isMobile&&((0,h.aS)()?(0,d.NP)("landscapeFullscreen"):(0,d.NP)("portraitClassic"))}))}listenForFullscreen(){h._c.listen((()=>{if((0,h.aS)()){var e;if("chat-player"!==(null===(e=(0,h.Gy)())||void 0===e?void 0:e.id))return;window.setTimeout((()=>{"fullscreen"!==this.videoMode&&p.setFireVideoMode("noninteractive-fullscreen")}),0)}else p.setFireVideoMode(this.lastNonFullscreenVideoMode)}))}setVideoModeInternal(e){return!!(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||e!==this.videoMode)&&(-1===["noninteractive-fullscreen","fullscreen","fullvideo"].indexOf(this.videoMode)&&(this.lastNonFullscreenVideoMode=this.videoMode),this.lastVideoMode=this.videoMode,this.videoMode=e,"noninteractive-fullscreen"===this.videoMode&&this.isMobile?(0,d.NP)("landscapeFullscreen"):(0,d.NP)(this.videoMode),this.saveVideoModeStorage(),!0)}setVideoMode(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setVideoModeInternal(e,t)}setFireVideoMode(e,t){var i,s;(this.setVideoModeInternal(e,null!==(i=null==t?void 0:t.update)&&void 0!==i&&i)||null!==(s=null==t?void 0:t.fire)&&void 0!==s&&s)&&this.changeVideoMode.fire({currentMode:this.videoMode,previousMode:this.lastVideoMode})}saveVideoModeStorage(){["split","theater"].includes(this.videoMode)&&(0,n.Pf)()&&window.localStorage.setItem(this.storageKey,JSON.stringify({isTheaterMode:"theater"===this.videoMode}))}getInitialVideoMode(){let e=u.active?"theater":"split";if((0,n.Pf)()){const t=window.localStorage.getItem(this.storageKey);if(null!==t){const i=JSON.parse(t).isTheaterMode;e=Boolean(i)?"theater":"split"}}return e}getVideoMode(){return this.videoMode}getPreviousNonFullscreenVideoMode(){return this.lastNonFullscreenVideoMode}fireAfflThtrMdEvents(){if(this.hasFiredAflThtrMdEvents)return void error("refiring AfflThtrMd events");this.hasFiredAflThtrMdEvents=!0;const e=window.location.toString().includes("fullvideo")?"fullvideo":"non-fullvideo",t=`${c}_in`,i=void 0!==(0,o.oD)(t);if(u.eligible)if(i){(0,o.Yj)(t),(0,d.bT)("AfflThtrMd",{group:u.active?"active":"inactive",page:e});const i=!u.active&&"fullvideo"===this.videoMode,s=u.active&&"theater"===this.videoMode;(i||s)&&u.record()}else(0,d.bT)("AfflThtrMd_mystery",{group:u.active?"active":"inactive",page:e});else window.location.search.includes("gLDS")&&window.location.search.includes("gQZJO")&&(0,d.bT)("AfflThtrMd_missing",{page:e,is_anon:(0,r.ok)(),came_from_in:i}),i&&(0,d.bT)("AfflThtrMd_odd_cookie",{page:e,is_anon:(0,r.ok)()})}}},3158:(e,t,i)=>{"use strict";i.d(t,{Q:()=>n,i:()=>o});var s=i(8936);function n(){var e,t;const i=document.activeElement instanceof HTMLInputElement||"true"===document.activeElement.contentEditable,n=Math.round(null!==(e=null===(t=visualViewport)||void 0===t?void 0:t.height)&&void 0!==e?e:(0,s.mJ)())<(0,s.mJ)();return i&&n}function o(e){return"textarea"===e.tagName.toLowerCase()||e.isContentEditable||e instanceof HTMLInputElement&&!["checkbox","radio","button","reset","submit","file"].includes(e.type.toLowerCase())}},5389:(e,t,i)=>{"use strict";i.d(t,{EO:()=>m,GZ:()=>C,Iw:()=>x,NL:()=>u,T8:()=>p,aH:()=>h,fp:()=>d,g$:()=>f,gA:()=>w,gr:()=>l,rR:()=>c});var s,n=i(6784),o=i(5216),r=i(8423),a=i(1779);function l(e,t,i,s){h(e,t,i)}function h(e,t,i,s){return new Promise((s=>{var n;(0,a.aS)()?((0,a.Eh)(),window.setTimeout((()=>{const n=window.open((0,o._Y)(e),t,i);null!==n&&window.setTimeout((()=>{n.focus()}),200),s(null!=n?n:void 0)}),a.CK)):s(null!==(n=window.open((0,o._Y)(e),t,i))&&void 0!==n?n:void 0)}))}const d="status=0,toolbar=1,menubar=0,directories=0,resizable=1,scrollbars=1,height=768,width=850,top=50,left=50",c="status=0,toolbar=0,menubar=0,directories=0,resizable=1,scrollbars=1,height=768,width=850",u="status=0,toolbar=0,menubar=0,directories=0,resizable=1,scrollbars=1,height=700,width=715";function p(e){window.onbeforeunload=function(){};const t=window.location.href.split("?");!0===e&&t.length>1?window.location.href=(0,o._Y)(t[0]):window.location.reload()}function m(){window.location.href=(0,o._Y)("/")}let g="",v="";"hidden"in document?(g="hidden",v="visibilitychange"):"msHidden"in document?(g="msHidden",v="msvisibilitychange"):"webkitHidden"in document&&(g="webkitHidden",v="webkitvisibilitychange");const f=new r.c_("documentVisibilityChange",{maxHistorySize:1});let y=""===g||!(null!==(s=document[g])&&void 0!==s&&s);const b=e=>{y!==e&&(y=e,f.fire(y))};if(""!==g&&""!==v){const e=()=>{b(!document[g])};(0,n.wu)(v,document,e);const t=()=>{(0,n.Pf)(v,document,e),(0,n.Pf)("pagehide",window,t),b(!1),(0,n.wu)("pagehide",window,(()=>{b(!1)})),(0,n.wu)("pageshow",window,(()=>{b(!0)}))};(0,n.wu)("pagehide",window,t)}else(0,n.wu)("blur",window,(()=>{b(!1)})),(0,n.wu)("focus",window,(()=>{b(!0)}));function w(){return y}function C(){try{return window.self!==window.top}catch(e){return!0}}const S=(new Date).getTime();function x(){return((new Date).getTime()-S)/1e3}},7649:(e,t,i)=>{"use strict";i.d(t,{y:()=>Et,h:()=>It});var s=i(352),n=i(3452),o=i(4476),r=i(4582),a=i(7623),l=i(8861),h=i(5276),d=i(6262),c=i(20),u=i(1474),p=i(6624),m=i(6784),g=i(2709),v=i(3955),f=i(9060),y=i(7882),b=i(3004),w=i(369),C=i(5216),S=i(82);class x extends S.b{constructor(e){super(e),e.gender!==y.YT.All?this.url=new URL("../",this.element.href):this.url=new URL(this.element.href)}createElement(e){return e.anchorElement}updateState(){super.updateState();let e=this.url.searchParams.toString();e=""===e?"":`?${e}`;const t=this.url.pathname===(0,C._Y)("/")?(0,y.tg)(this.state.gender):y.hf.get(this.state.gender),i=""===t?"":`${t}/`;this.element.href=(0,C._Y)(`${this.url.pathname}${i}${e}`)}}var T=i(9118),P=i(9930);class k extends g.u{constructor(e){super(e),this.genderedLinks=[];const t=e.querySelector(".nav");null!==t&&t instanceof HTMLElement&&(0,w.Rk)(t,500,800,[{name:"padding-left",min:10,max:65},{name:"padding-right",min:10,max:65}]);const i=document.querySelector(".footer-holder .footer-cb-address");null!==i&&i instanceof HTMLElement&&(0,w.Rk)(i,500,589,[{name:"margin-left",min:-55,max:0}],(e=>{0===e&&(i.style.marginLeft="")})),e.querySelectorAll(".footercon a").forEach((e=>{(0,m.wu)("click",e,(t=>{if((0,f.rT)()){if(p.UrlState.current.state.pageType===p.PageType.HOME||(0,p.isRoomRoomlistSpaActive)()&&p.UrlState.current.state.pageType===p.PageType.ROOM){const i=e.getAttribute("href");null!==i&&i.startsWith("/")&&(0,v.eH)(t,(()=>{t.preventDefault(),p.UrlState.current.navigateTo(new URL(e.href),this.isFilterPanelCategoryLink(i))}))}}else P.XS.fire(t)}))})),e.querySelectorAll("div[gendered-category] a").forEach((e=>{this.genderedLinks.push(new x({anchorElement:e,gender:(0,y.Bg)()}))})),(0,f.rT)()?p.UrlState.current.listen(["genders"],(e=>{var t,i;const s=null!==(t=(null!==(i=e.genders)&&void 0!==i?i:[])[0])&&void 0!==t?t:"";this.genderedLinks.forEach((e=>{e.setState({gender:s})})),A()}),this.element):P.wd.addListener((e=>{this.genderedLinks.forEach((t=>{t.setState({gender:e})})),A()}),this.element),T.d.pageNumberChanged.listen(A)}isFilterPanelCategoryLink(e){const t=p.UrlState.current.readStateFromURL(new URL(e,window.location.origin));return(0,p.homepageFiltersCurrentlyApplied)(t)}}function A(){document.querySelectorAll("#footer-holder form").forEach((e=>{(0,b.De)(e)}))}var M=i(8936),R=i(7407),I=i(9461),E=i(1224),L=i(4873);class D extends g.u{constructor(e){super(e),this.makeLogoResponsive(),this.addHeaderAdPageAction(),this.addMerchLinkPageAction(),this.makeTopNavResponsive(),this.makeUserInfoResponsive(),this.bindLinkUpdateHandling(),(0,f.rT)()&&(0,p.shouldShowHomepageFilters)()&&this.makeHeaderLinksSPA(e)}makeHeaderLinksSPA(e){const t=e.querySelector("#spy_tab a");null!==t&&(0,m.wu)("click",t,(e=>{e.preventDefault(),p.UrlState.current.navigateTo(t.href)}));const i=e.querySelector("#ChatRoomLink");null!==i&&(0,m.wu)("click",i,(e=>{e.preventDefault(),p.UrlState.current.navigateTo(i.href)}));const s=e.querySelector("#logoLink");null!==s&&(0,m.wu)("click",s,(e=>{e.preventDefault(),p.UrlState.current.navigateTo(s.href)}))}makeTopNavResponsive(){this.genderedLinks=[],this.initFirstTopSectionAnchor();const e=document.querySelector(".nav-bar");null!==e&&(0,w.Rk)(e,500,600,[{name:"padding-left",min:4,max:15}]);const t=document.getElementById("nav");if(null!==t){this.nav=new g.u(t);const e=(0,y.Bg)();Array.from(t.children).forEach((t=>{if(t instanceof HTMLLIElement){const i=new L.g2(t);this.nav.attachChild(i),i.element.style.display="block";const s=i.element.getElementsByTagName("a")[0];if(null!==s&&s instanceof HTMLAnchorElement){const t=getComputedStyle(s);s.style.color=t.color,s.style.font=t.font,s.style.fontFamily=t.fontFamily,s.style.fontWeight=t.fontWeight,s.style.fontSize=t.fontSize,s.hasAttribute("gendered-link")&&this.genderedLinks.push(new x({anchorElement:s,gender:e}))}s.onfocus=()=>{this.focusIntoDropdown(i)},s.onblur=e=>{this.blurOutOfDropdown(e)},i.onCollapseEvent.listen((e=>{i.element.style.padding=e?"8px 4px":""}))}}));const i=new L.Dw("li",!0);this.nav.addChild(i),(0,v._W)(i.element),(0,v.ZM)(i,{border:"1px solid transparent",borderRadius:"4px 4px 0 0",height:"30px",top:"6px",width:"39px",paddingTop:"3px",color:E.m.navigationFontColor}),i.dropDown.toggleEvent.listen((e=>{e.isShowing?i.element.style.border=`1px solid ${E.m.tabBorderColor}`:i.element.style.border="1px solid transparent"})),(0,v.ZM)(i.dropDown,{borderColor:`${E.m.tabBorderColor}`,padding:"8px 20px 8px 8px"}),i.dropDown.element.classList.add("header-dropdown"),this._headerCollapseDropDownTab=i,this.setCollapsibleDropdownSpacerWidth()}}focusIntoDropdown(e){(0,L.Dy)(e)&&(this._headerCollapseDropDownTab.dropDown.showElement(),this.setTabIndexForDropdown(200),window.setTimeout((()=>{e.element.getElementsByTagName("a")[0].focus()}),0))}blurOutOfDropdown(e){const t=e.target,i=e.relatedTarget;e.preventDefault(),t instanceof HTMLAnchorElement&&this._headerCollapseDropDownTab.isTargetOverflownAnchor(t)&&(i instanceof HTMLElement&&!this._headerCollapseDropDownTab.isTargetOverflownAnchor(i)||null===i)&&(this.setTabIndexForDropdown(0,!0),this._headerCollapseDropDownTab.dropDown.hideElement())}setTabIndexForDropdown(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this._headerCollapseDropDownTab.lastShownSibling();void 0!==i&&(i.element.getElementsByTagName("a")[0].tabIndex=t?0:e);for(const i of this._headerCollapseDropDownTab.dropDown.element.getElementsByTagName("a"))i.tabIndex=t?0:e+1;null!==this.firstTopSectionAnchor&&void 0!==this.firstTopSectionAnchor&&(this.firstTopSectionAnchor.tabIndex=t?0:e+2)}initFirstTopSectionAnchor(){const e=document.querySelector(".top-section");null!==e&&(this.firstTopSectionAnchor=e.getElementsByTagName("a")[0],void 0===this.firstTopSectionAnchor&&(this.firstTopSectionAnchor=e.getElementsByTagName("li")[0]))}setCollapsibleDropdownSpacerWidth(){if(void 0!==this.nav&&null!==this.nav.element.parentElement){let e=0;for(const t of this.nav.element.parentElement.children)t!==this.nav.element&&t instanceof HTMLElement&&(e+=t.offsetWidth);this._headerCollapseDropDownTab.setSpacerWidth(e)}}addHeaderAdPageAction(){const e=document.querySelector("#header .ad a");null!==e&&(e.dataset.testid="header-ad-anchor",e.onclick=()=>{var t;(0,R.bT)("BannerAdClicked",{content:"real_ads",ad_title:null!==(t=e.getAttribute("data-feature-show-title"))&&void 0!==t?t:void 0,location:I.Bm.current.pageLocation})})}addMerchLinkPageAction(){const e=document.querySelector("#merch");null!==e&&(e.onclick=()=>{(0,R.bT)("MerchLinkClicked")})}makeLogoResponsive(){const e=document.querySelector(".logo-zone");if(null!==e&&e instanceof HTMLElement){e.dataset.testid="header-logo";const t=document.querySelector(".logo-zone svg"),i=document.querySelector(".logo-zone strong:last-child");(0,w.Rk)(e,500,600,[{name:"padding-left",min:8,max:15},{name:"padding-top",min:12,max:6}]),null!==t&&t instanceof HTMLElement&&(0,w.Rk)(t,500,600,[{name:"width",min:145,max:198},{name:"height",min:45,max:61}]),null!==i&&i instanceof HTMLElement&&(i.dataset.testid="header-slogan-text",(0,w.Rk)(i,500,600,[{name:"font-size",min:8,max:10},{name:"padding-left",min:13,max:17}]));const s=document.querySelector(".logo-zone .logo");if(null!==s&&s instanceof HTMLElement){const e=s.clientWidth;e>500-(0,v.XJ)()&&w.oO.listen((()=>{e+s.offsetLeft>(0,M.DK)()?s.style.maxWidth=(0,M.DK)()-s.offsetLeft-1+"px":s.style.maxWidth=""}))}}}makeUserInfoResponsive(){const e=document.querySelector("#user_information");null!==e&&e instanceof HTMLElement&&(0,w.Rk)(e,500,600,[{name:"margin-right",min:4,max:15}])}bindLinkUpdateHandling(){(0,f.rT)()?p.UrlState.current.listen(["genders"],(e=>{var t,i;const s=null!==(t=(null!==(i=e.genders)&&void 0!==i?i:[])[0])&&void 0!==t?t:y.YT.All;this.genderedLinks.forEach((e=>{e.setState({gender:s})}))}),this.element):P.wd.addListener((e=>{this.genderedLinks.forEach((t=>{t.setState({gender:e})}))}),this.element)}}var B=i(3910),U=i(5411),_=i(1280),F=i(213),N=i(6844),O=i(6144),H=i(6716),W=i(9447),$=i(4364),V=i(9525),z=i(4564),G=i(9757),q=i(897),j=i(6064),Z=i(3885),K=i(6440),J=i(2146),Y=i(4947),Q=i(1372),X=i(6471),ee=i(3417),te=i(4500),ie=i(1585),se=i(1885),ne=i(4035),oe=i(1519),re=i(106),ae=i(4580);class le extends g.u{constructor(e){super("div",e),(0,ee.vu)()}initData(e){this.myUsername=e.myUsername,this.allDmWindowsMap=new Map,this.orderedDmSessionKeys=new re.J,this.isTouchingScreen=!1,this.onShow=e.onShow,this.onHide=e.onHide}initUI(e){this.element=(0,Q.tT)("div",{className:"MobileDmWindowManager",style:{width:"320px",height:"calc(var(--vh, 1vh) * 100)",position:"absolute",top:0,bottom:0,left:0,boxSizing:"border-box",display:"flex",flexDirection:"column"}},(0,Q.tT)(de,{onClick:()=>{this.handleBackButtonClick()}})),(0,J.Ve)(this.element,"transform 150ms ease"),this.bindMenuChangeEvents(),this.bindListeners(),this.bindWindowListeners(),this.initVirtualKeyboardHandling(),this.hideElement()}showElement(){(0,v.ZM)(this.element,{transform:"translateX(0)"}),this.onShow()}hideElement(){(0,v.ZM)(this.element,{transform:"translateX(-100%)"}),this.onHide();const e=this.orderedDmSessionKeys.currentElem;void 0!==e&&this.hideWindow(e)}bindListeners(){B.$o.listen((e=>{this.showElement(),void 0===this.allDmWindowsMap.get(e)&&this.createWindow(e),this.showWindow(e)})),B.x7.listen((e=>{let{username:t,deleteWindow:i}=e;const s=this.getCurrentOpenWindow();(null==s?void 0:s.username)===t&&this.removeShownWindow(),!0===i&&this.allDmWindowsMap.delete(t)})),se.H4.listen((e=>{const t=this.allDmWindowsMap.get(e.otherUsername);void 0!==t&&t.handleNewMessage(e)})),(0,ie.L)((e=>this.allDmWindowsMap.get(e)))}createWindow(e){if(!this.allDmWindowsMap.has(e)){const t=new te.wV({username:e,myUsername:this.myUsername,open:!0,markAsRead:!0,raiseWindowZIndexToTop:()=>{}});this.allDmWindowsMap.set(e,t),this.orderedDmSessionKeys.addToTop(e),this.addChild(t)}}removeShownWindow(){const e=this.getCurrentOpenWindow();void 0!==e&&(e.removeFromDOM(),this.orderedDmSessionKeys.remove(e.username),this.handleBackButtonClick())}showWindow(e){const t=this.getCurrentOpenWindow();void 0!==t&&t.openOrCollapseWindow(!1);const i=this.allDmWindowsMap.get(e);void 0!==i&&(this.orderedDmSessionKeys.makeCurrent(e),i.openOrCollapseWindow(!0))}getCurrentOpenWindow(){var e;const t=this.allDmWindowsMap.get(null!==(e=this.orderedDmSessionKeys.currentElem)&&void 0!==e?e:"");return!0===(null==t?void 0:t.isWindowOpen())?t:void 0}hideWindow(e){const t=this.allDmWindowsMap.get(e);void 0!==t&&t.openOrCollapseWindow(!1)}handleBackButtonClick(){this.hideElement()}bindMenuChangeEvents(){ae.nD.listen((e=>{e||this.hideElement()}))}blurInputIfFocused(){const e=this.getCurrentOpenWindow();!0===(null==e?void 0:e.isInputFocused())&&document.activeElement instanceof HTMLElement&&document.activeElement.blur()}bindWindowListeners(){var e;let t=window.innerWidth;const i=()=>{const e=this.getCurrentOpenWindow();window.innerWidth!==t&&(null==e||e.scrollToBottom(),t=window.innerWidth,window.setTimeout((()=>{null==e||e.scrollToBottom()}),300),this.blurInputIfFocused())};(0,m.wu)("resize",window,(()=>{if((0,a.OF)())(0,a.nr)()?i():window.setTimeout(i,125);else{const e=this.getCurrentOpenWindow();null==e||e.resizeTipCallout()}})),(0,m.wu)("touchstart",window,(()=>{this.isTouchingScreen=!0})),(0,m.wu)("touchend",window,(()=>{this.isTouchingScreen=!1})),null===(e=window.visualViewport)||void 0===e||e.addEventListener("scroll",(()=>{this.isTouchingScreen&&this.blurInputIfFocused()}))}initVirtualKeyboardHandling(){const e=new oe.a((()=>{var e;this.element.style.top=`${null===(e=window.visualViewport)||void 0===e?void 0:e.offsetTop}px`;const t=window.setInterval((()=>{var e;this.element.style.top=`${null===(e=window.visualViewport)||void 0===e?void 0:e.offsetTop}px`}),100);window.setTimeout((()=>{window.clearInterval(t)}),1e3)}),{bounceLimitMS:1e3,debounceType:2});ne.I.listen((()=>{e.callFunc()})),(0,m.wu)("scroll",document,(()=>{e.callFunc()}))}}class he extends g.u{constructor(e){super("div",e)}initData(e){this.dmListIconRoot=e.dmListIconRoot,this.userUpdatesBellRoot=e.userUpdatesBellRoot,this.hamburgerIcon=e.hamburgerIcon,this.isRefactorDMFlagActive=(0,K.f)("RefactorDm"),this.isRefactorDMFlagActive&&!(0,N.ok)()&&(this.conversationListData=$.yT.getInstance())}initUI(e){var t;const i={width:"320px",position:"fixed",top:0,bottom:0,left:0,boxSizing:"border-box",display:"flex",flexDirection:"column"},s={width:"320px",display:"none",position:"fixed",top:0,bottom:0,left:0},n=null===(t=I.Bm.current.loggedInUser)||void 0===t?void 0:t.username;if(void 0!==n){this.searchBar=new z.I({isFullVideoMode:!1,room:""}),this.dmList=new X.E({onItemRemoved:()=>{},openConversationEvent:B.$o,isDropdown:!0,searchBar:this.searchBar}),this.contentMask=(0,Q.tT)("div",{className:"MobileDmsMenu__contentMask",style:s});const e=new le({myUsername:n,onShow:()=>this.toggleMaskingContent(!0),onHide:()=>this.toggleMaskingContent(!1)});this.loadingSpinner=this.createLoadingSpinner(),this.messagingElement=document.createElement("div"),(0,f.P$)()?this.element=(0,Q.tT)("div",{style:i},this.messagingElement):this.element=(0,Q.tT)("div",{style:i},(0,Q.tT)(de,{onClick:()=>{this.handleBackButtonClick()}}),this.loadingSpinner,this.searchBar.element,this.dmList.element,this.contentMask,e.element),this.isRefactorDMFlagActive&&(this.showLoadingSpinner(),$.yT.initialDMFetchCompleteEvent.listen((()=>{this.hideLoadingSpinner()})))}else{const e={height:"45px",display:"flex",alignItems:"center",paddingLeft:"10px"},t={display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",flex:1},s={textDecoration:"none"},n=()=>{-1!==`${window.location.pathname}${window.location.search}`.indexOf(b.ii)||(0,j.DC)({fromFeature:!0});const e=document.querySelector(".push-overlay");this.hideElement(),e instanceof HTMLElement&&e.click()};this.element=(0,Q.tT)("div",{style:i},(0,Q.tT)("div",{className:"MobileDmsMenu__title",style:e},Y.R.directMessageLabel),(0,Q.tT)("div",{style:t},(0,Q.tT)("img",{style:{display:"inline-block",width:"50px",height:"50px"},src:`${STATIC_URL}pms/empty-chat-state.svg`}),(0,Q.tT)("span",{style:{margin:"25px 0",display:"inline-block"}},Y.R.sendDirectMessage),(0,Q.tT)("span",{className:"MobileDmsMenu__link",style:{...s,marginBottom:"50px"},onClick:n},Y.R.loginVerbText),(0,Q.tT)("span",null,Y.R.dontHaveAccount," ",(0,Q.tT)("a",{className:"MobileDmsMenu__link",href:b.k6,style:s,"account-redirect":!0},Y.R.signUpText))))}(0,W.fZ)(this.element,"MobileDmsMenu"),(0,J.Ve)(this.element,"transform 150ms ease"),this.bindIconClickEvent(),this.bindMenuChangeEvents(),this.bindNumUnreadEvents(),this.bindResizeEvents(),this.hideElement()}handleBackButtonClick(){this.hideElement()}createLoadingSpinner(){return(0,Z.N)({extraStyle:{position:"absolute",top:"90px",left:"140px",display:"none"}})}showLoadingSpinner(){this.dmList&&(this.dmList.element.style.display="none"),this.searchBar.element.style.display="none",this.loadingSpinner.style.display="block"}hideLoadingSpinner(){this.loadingSpinner.style.display="none",this.dmList&&(this.dmList.element.style.display="block"),this.searchBar.element.style.display="block"}showElement(){if((0,f.P$)()&&!(0,N.ok)()&&void 0===this.messagingComponent){const e=G.c.get("Messaging"),t={UserMessageTopic:q.y8,UserTokenUpdateTopic:q.nH};this.messagingComponent=new e({topics:t},this.messagingElement)}var e;this.isRefactorDMFlagActive&&!(0,f.P$)()&&this.conversationListData&&!this.conversationListData.isInitialDMFetchComplete()&&(null===(e=this.conversationListData)||void 0===e||e.getMessageThreads()),(0,R.bT)("DMListOpened",{source:"mobile"}),(0,v.ZM)(this.element,{transform:"translateX(0)"}),this.dmListIconRoot.classList.add("active")}hideElement(){(0,v.ZM)(this.element,{transform:"translateX(-100%)"}),this.dmListIconRoot.classList.remove("active")}toggleMaskingContent(e){this.contentMask.style.display=e?"block":"none"}isShown(){return"translateX(-100%)"!==this.element.style.transform}bindIconClickEvent(){this.dmListIconRoot.onclick=()=>{this.isShown()||this.showElement()}}bindMenuChangeEvents(){ae.bW.listen((e=>{e&&!this.isShown()?this.showElement():!e&&this.isShown()&&this.hideElement()})),ae.nD.listen((e=>{e||this.hideElement()}))}handleUnreadCountUpdate(e){var t,i,s,n;e>0?(this.dmListIconRoot.classList.add("has_unread"),null===(t=this.hamburgerIcon)||void 0===t||t.classList.add("has_unseen")):(this.dmListIconRoot.classList.remove("has_unread"),null!==(i=null===(s=this.userUpdatesBellRoot)||void 0===s?void 0:s.classList.contains("has_unseen"))&&void 0!==i&&i||null===(n=this.hamburgerIcon)||void 0===n||n.classList.remove("has_unseen"))}bindNumUnreadEvents(){this.isRefactorDMFlagActive?V.B.unreadDataUpdated.listen((e=>{let{unread:t}=e;this.handleUnreadCountUpdate(t)})):$.yT.unreadConversationsCountUpdate.listen((()=>{var e;void 0!==this.dmList&&this.handleUnreadCountUpdate(null===(e=this.dmList)||void 0===e?void 0:e.getNumUnread())}))}bindResizeEvents(){(0,a.OF)()||(0,m.wu)("resize",window,(()=>{const e=(0,M.mJ)();this.element.style.top=e<250?"":"0"}))}}const de=e=>(0,Q.tT)("span",{className:"BackButton",style:{height:"45px",display:"flex",alignItems:"center",paddingLeft:"10px"},onClick:e.onClick,"data-testid":"back-button"},Y.R.back);var ce=i(8096),ue=i(5389),pe=i(5412),me=i(1728),ge=i(637);class ve extends O.v{constructor(e){super(e.toggleElement,!0,e),this.convosOpenedWithoutClosingDropdown=0,(0,m.wu)("keydown",document,(e=>{var t;if(!this.isShown())return;const i=this.dmList.element.contains(document.activeElement),s=!0===(null===(t=B.qt.getInstance())||void 0===t?void 0:t.element.contains(document.activeElement));var n;"Tab"===e.key?(i||!this.element.contains(document.activeElement)?null===(n=this.popoutLink)||void 0===n||n.focus():this.dmList.focusSearchBar(),e.stopPropagation(),e.preventDefault()):"Escape"===e.key?this.hideElement():i||s||!["ArrowUp","ArrowDown"].includes(e.key)&&!(0,pe.x)(e.keyCode)||this.dmList.focusSearchBar()})),ge.D.showingEvent.listen((()=>this.hideElement())),B.$o.listen((()=>{this.isShown()&&(this.convosOpenedWithoutClosingDropdown+=1,(0,R.bT)("OpenedDmFromDropdown",{seq_convos_opened:this.convosOpenedWithoutClosingDropdown}))})),this.isRefactorDMFlagActive?V.B.unreadDataUpdated.listen((e=>{let{unread:t}=e;this.updateNumUnread(t)})):$.yT.unreadConversationsCountUpdate.listen((e=>{let{dmsCount:t}=e;this.updateNumUnread(t)}))}initUI(e){const t=(0,N.ok)(),i={fontFamily:"UbuntuRegular, Tahoma, Arial, Helvetica, sans-serif",fontSize:"14px",borderWidth:"1px",borderStyle:"solid",borderRadius:"4px 0 4px 4px",boxShadow:"0px 0px 16px rgba(0, 0, 0, 0.32)",height:t?"":"383px",maxHeight:`calc(var(--vh, 1vh) * 100 - ${te.sG.expandedHeight} - 44px)`,minHeight:"280px",padding:"1px",position:"absolute",right:"0",width:"304px",display:"none",flexDirection:"column"};this.isRefactorDMFlagActive=(0,K.f)("RefactorDm"),this.dmList=new me.U({isDms:!0,clearSearchOnSelect:(0,a.Xb)(),isFullVideoMode:!1,openConversationEvent:B.$o}),this.element=(0,Q.tT)("div",{style:i,colorClass:"dmListDropdownRoot","data-testid":"dm-list-dropdown"},(0,Q.tT)("div",{style:{padding:"10px 8px",borderBottomWidth:"1px",borderBottomStyle:"solid"},colorClass:"header"},(0,Q.tT)("span",null,Y.R.directMessageLabel),(0,Q.tT)("span",{style:{marginLeft:"4px"},ref:e=>this.numUnreadContainer=e}),!t&&(0,Q.tT)("button",{style:{display:"inline-block",position:"absolute",right:"8px",top:"12px",height:"13px",width:"13px",border:"none",cursor:"pointer"},title:Y.R.popoutInNewWindow,colorClass:"popoutIcon","data-testid":"popout-dm-icon",ref:e=>this.popoutLink=e,onClick:()=>{this.hideElement();const e=this.dmList.getLastConversation();var t;void 0===e||""!==e.message||e.hasMedia?ge.D.show():ge.D.show(null==e||null===(t=e.otherUser)||void 0===t?void 0:t.username)}})),t?(0,Q.tT)(fe,null):this.dmList.element)}initData(){this.isRefactorDMFlagActive=(0,K.f)("RefactorDm"),this.isRefactorDMFlagActive&&!(0,N.ok)()&&(this.conversationListData=$.yT.getInstance())}showElement(){return this.isRefactorDMFlagActive&&this.conversationListData&&!this.conversationListData.isInitialDMFetchComplete()&&this.dmList.getMessageThreads(),(0,R.bT)("DMListOpened",{source:"desktop"}),(0,W.fZ)(this.toggleElement,"active"),this.convosOpenedWithoutClosingDropdown=0,super.showElement("flex")}hideElement(e){var t;if(!(0,a.Xb)()&&(null==e?void 0:e.target)instanceof HTMLElement&&(!0===(null===(t=B.qt.getInstance())||void 0===t?void 0:t.element.contains(e.target))||!document.body.contains(e.target)))return!1;const i=super.hideElement(e);return i&&(0,W.SA)(this.toggleElement,"active"),i}updateNumUnread(e){const t=e>0;this.numUnreadContainer.innerText=t?`(${e})`:"",t?this.toggleElement.classList.add("has_unread"):this.toggleElement.classList.remove("has_unread")}}const fe=()=>{const e={cursor:"pointer",fontSize:"12px"},t=`${STATIC_URL}pms/empty-chat-state.svg`;return(0,Q.tT)("div",{style:{fontSize:"12px",marginTop:"0",padding:"44px 0 16px",position:"static",textAlign:"center",top:"50%",width:"100%"}},(0,Q.tT)("img",{src:t,alt:"empty-chat-state"}),(0,Q.tT)("div",{style:{fontSize:"14px",lineHeight:"18px",margin:"8px 0"},colorClass:"sendDmPrompt"},Y.R.sendDirectMessage),(0,Q.tT)("div",{style:{margin:"16px 0 44px"}},(0,Q.tT)("a",{style:e,colorClass:"link",onClick:e=>{e.preventDefault(),(0,j.DC)({fromFeature:!0})},"account-redirect":!0},Y.R.loginVerbText)),(0,Q.tT)("div",{colorClass:"signupPrompt"},Y.R.dontHaveAccount," ",(0,Q.tT)("a",{href:b.k6,style:e,colorClass:"link",onClick:()=>{(0,R.bT)("PMSignupClicked")},"account-redirect":!0},Y.R.signUpLower)))};var ye,be=i(2331),we=i(8423);class Ce{}(ye=Ce).dropDownToggle=new we.c_("dropDownToggle"),ye.updatesAreRead=new we.c_("updatesAreRead"),ye.updatesAreUnread=new we.c_("updatesAreUnread"),ye.tabItemsLoaded=new we.c_("tabItemsLoaded");var Se=i(4936);class xe{static getUserUpdates(e,t){if("/security/tfa/auth/"===window.location.pathname||"/security/tfa/auth/choose_device/"===window.location.pathname)return;const i=e.map((e=>`notification_type=${e}`)).join("&");(0,C.Aw)(`notifications/updates/?${i}`).then((e=>{const i=new Se.N6(e.responseText).getList("items");if(void 0!==i){const e=i.map((e=>({text:e.getString("text"),url:e.getString("url"),timestamp:e.getNumber("timestamp"),timeSince:e.getString("time_since"),seen:e.getBoolean("seen"),notificationType:e.getString("notification_type")})));t(e)}})).catch((()=>{}))}static recordLastSeen(e,t,i){(0,C.KF)(e,{timestamp:t.toString()}).then((()=>{i()})).catch((()=>{}))}static hasUnseen(e){(0,C.Aw)("notifications/has_unseen/").then((t=>{const i=JSON.parse(t.responseText);e(i.has_unseen)})).catch((()=>{}))}}class Te extends g.u{constructor(){super(),this.element.style.overflow="",this.element.style.position="static",this.element.style.overflowX="hidden",this.element.style.overflowY="auto",this.enableMomentumScrollingForIPad()}enableMomentumScrollingForIPad(){if(/iPad|iPhone|iPod/.test(navigator.platform)){this.element.style["-webkit-overflow-scrolling"]="touch";const e=()=>{this.element.style.overflowY="scroll",(0,m.Pf)("scroll",this.element,e)};(0,m.wu)("scroll",this.element,e)}}}class Pe extends g.u{constructor(e){super(),(0,W.fZ)(this.element,"twitterUpdateRow"),this.element.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",this.element.style.fontStyle="normal",this.element.style.fontWeight="normal",this.element.style.position="relative",this.element.style.height="",this.element.style.width="",this.element.style.margin="7px",this.element.style.padding="6px",this.setSeenColors(e.seen),this.element.style.borderWidth="1px",this.element.style.borderStyle="solid",this.element.style.borderRadius="4px",this.element.dataset.testid="notification-item",this.element.appendChild(this.createContentElement(e.text));const t="offline_tip"===e.notificationType&&I.Bm.current.isMobile;if(""!==e.timeSince){const t=function(e){const t=document.createElement("div");return(0,W.fZ)(t,"timeSince"),t.appendChild(document.createTextNode(e)),t.style.fontSize="9px",t.style.lineHeight="13px",t.style.cssFloat="left",t.dataset.testid="notification-time-since",t}(e.timeSince);this.element.appendChild(t)}if(""!==e.url&&!t){let t="twitter_feed";void 0!==e.notificationType&&(t=e.notificationType);const i=function(e,t){const i=document.createElement("a");i.href=(0,C._Y)(e),i.target="_blank";const s="twitter_feed"===t,n="offline_tip"===t,o=function(e){switch(e){case"twitter_feed":return Y.R.viewOnTwitterText;case"offline_tip":return Y.R.showTipsAndMessages}return Y.R.seeMore}(t);return i.appendChild(document.createTextNode(o)),(0,W.fZ)(i,"twitterLink"),i.style.fontSize="9px",i.style.lineHeight="13px",i.style.textAlign="right",i.style.cssFloat="right",i.dataset.testid="notification-link",s?i.onclick=()=>{(0,R.bT)("NewsfeedItemViewOnTwitter")}:n&&(i.onclick=()=>{(0,R.bT)("OfflineTipItemLinkClick")}),i}(e.url,t);this.element.appendChild(i)}}setSeenColors(e){e?(0,W.fZ)(this.element,"seen"):(0,W.SA)(this.element,"seen")}createContentElement(e){const t=this.buildContentFromText(e);return(0,W.fZ)(t,"contentSection"),t.style.fontSize="12px",t.style.lineHeight="14px",t.style.whiteSpace="pre-wrap",t.style.marginBottom="6px",t.style.wordWrap=t.style.wordBreak="break-word",t.style.overflow="hidden",t.dataset.testid="notification-content",t}buildContentFromText(e){const t=document.createElement("div");return t.innerHTML=e,this.makeLinksShorterAndAddStyle(t),t}makeLinksShorterAndAddStyle(e){Array.from(e.querySelectorAll("a")).forEach((e=>{(0,W.fZ)(e,"tweetLink"),e.target="_blank",e.style.outline="none",e.style.fontSize="12px",e.style.lineHeight="14px",null!==e.firstChild&&e.firstChild instanceof Text&&null!==e.firstChild.textContent&&(e.firstChild.textContent=e.firstChild.textContent.replace(/^http(s)?:\/\//,"").replace(/^www\./,"")),e.onclick=()=>{(0,R.bT)("NewsfeedItemLinkClick")}}))}}class ke extends Te{constructor(){super(),this.addChild(new Pe({text:`${Y.R.loadingTextLower}...`,seen:!0,timestamp:0,timeSince:"",url:""}))}setUpdateItems(e){this.removeAllChildren(),0===e.length&&this.addChild(new Pe({text:`${Y.R.noNewUpdates}`,seen:!0,timestamp:0,timeSince:"",url:""})),e.forEach((e=>{this.addChild(new Pe(e))}))}initUI(){this.element.style.maxHeight="307px",this.element.style["-webkit-transform"]="translateZ(0)"}}class Ae extends ke{initUI(){super.initUI(),this.element.style.maxHeight="",this.element.style.overflowY="scroll"}}class Me extends be.ZZ{constructor(e){super(),this.numUnread=0,this.isLoaded=!1,this.isDropDownVisible=!1,this.items=[],this.markAllAsSeenTimeout=void 0,this.updateTabOpenTime=0,this.highestUnreadTs=0,this.tabTitle=Y.R.updatesText,this.recordLastSeenUrl="notifications/record_last_seen/",this.notificationTypes=["twitter_feed","offline_tip"],this.openPageActionName="NewsfeedOpened",this.closePageActionName="NewsfeedClosed",this.contents=e?new Ae:new ke,this.addChild(this.contents),Ce.dropDownToggle.listen((e=>{this.isDropDownVisible=e,this.isShowing()||this.sendUpdatesClosedEvent()})),(0,m.wu)("beforeunload",window,(()=>this.sendUpdatesClosedEvent())),(0,m.wu)("unload",window,(()=>this.sendUpdatesClosedEvent()))}getNewsTopic(e){}getNewsSeenTopic(e){return new q.HD(e)}getOfflineTipTopic(e){if(void 0!==e)return new q.HJ(e)}getUpdateOfflineTipTopic(e){if(void 0!==e)return new q.cu(e)}hasUnread(){return this.numUnread>0}recordLastSeenNotification(e,t){(0,N.ok)()||xe.recordLastSeen(this.recordLastSeenUrl,e,(()=>{void 0!==t&&t()}))}sendUpdatesClosedEvent(){if(0!==this.updateTabOpenTime){const e={duration_seconds:((new Date).getTime()-this.updateTabOpenTime)/1e3};this.updateTabOpenTime=0,(0,R.bT)(this.closePageActionName,e)}}getTabHandleContent(){let e;return e=this.numUnread>99?`${this.tabTitle} (99+)`:this.numUnread>0?`${this.tabTitle} (${this.numUnread})`:this.tabTitle,[document.createTextNode(e)]}getTabId(){return"updates-tab"}showElement(){super.showElement(),this.repositionChildren()}setAsCurrentTab(){super.setAsCurrentTab(),(0,R.bT)(this.openPageActionName,{is_orange:this.hasUnread()}),this.updateTabOpenTime=(new Date).getTime(),this.loadFeed()}hideElement(){super.hideElement(),this.sendUpdatesClosedEvent()}isShowing(){return this.isDropDownVisible&&this.isCurrentTab()}get unreadItems(){return this.items.filter((e=>!e.seen))}loadFeed(){this.isLoaded?(this.contents.setUpdateItems(this.items),this.scheduleMarkAllAsSeen(),Ce.tabItemsLoaded.fire()):xe.getUserUpdates(this.notificationTypes,(e=>{var t,i,s,n;this.items=e,this.contents.setUpdateItems(e);const o=this.unreadItems;this.numUnread=o.length,this.highestUnreadTs=0,o.length>0&&(this.highestUnreadTs=Math.max(...o.map((e=>e.timestamp)))),this.refreshTabs(),this.isLoaded=!0,Ce.tabItemsLoaded.fire();const r=null===(t=I.Bm.current.loggedInUser)||void 0===t?void 0:t.userUid;void 0!==r&&this.getNewsSeenTopic(r).onMessage.listen((e=>{debug("news seen update",e),this.markAsSeen(e.timestamp),this.numUnread=this.unreadItems.length,Ce.updatesAreRead.fire(),this.refreshTabs()})),null===(i=this.getNewsTopic(r))||void 0===i||i.onMessage.listen((e=>{debug("news item",e);let t=0;this.items.length>0&&(t=Math.max(...this.items.map((e=>e.timestamp)))),t<e.timestamp&&(this.items.splice(0,0,e),this.numUnread=this.unreadItems.length,this.contents.setUpdateItems(this.items),e.seen||(this.highestUnreadTs=e.timestamp,Ce.updatesAreUnread.fire()),this.refreshTabs(),this.scheduleMarkAllAsSeen())})),null===(s=this.getOfflineTipTopic(r))||void 0===s||s.onMessage.listen((e=>{let t=0;this.items.length>0&&(t=Math.max(...this.items.map((e=>e.timestamp)))),t<e.timestamp&&(this.items.splice(0,0,e),this.numUnread=this.unreadItems.length,this.contents.setUpdateItems(this.items),e.seen||(this.highestUnreadTs=e.timestamp,Ce.updatesAreUnread.fire()),this.refreshTabs(),this.scheduleMarkAllAsSeen())})),null===(n=this.getUpdateOfflineTipTopic(r))||void 0===n||n.onMessage.listen((e=>{const t=e.fromUsername;let i=0;if(this.items.length>0&&(i=Math.max(...this.items.map((e=>e.timestamp)))),i<e.timestamp){const i=this.items;for(const[s,n]of i.entries())if(n.text.includes(t)){i.splice(s,1),i.splice(0,0,e);break}this.contents.setUpdateItems(this.items),this.refreshTabs(),this.scheduleMarkAllAsSeen()}}))}))}markAsSeen(e){this.items.forEach((t=>{t.timestamp<=e&&(t.seen=!0)}))}scheduleMarkAllAsSeen(){this.numUnread>0?(void 0!==this.markAllAsSeenTimeout&&clearTimeout(this.markAllAsSeenTimeout),this.isShowing()&&(this.markAsSeen(this.items[0].timestamp),this.markAllAsSeenTimeout=window.setTimeout((()=>{this.numUnread=0,this.highestUnreadTs=0,this.recordLastSeenNotification(this.items[0].timestamp,(()=>{Ce.updatesAreRead.fire()}))}),500))):Ce.updatesAreRead.fire()}}class Re extends be.Zz{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.isDropDownVisible=!1,this.tabsLoaded=0,this.element.id="UserUpdatesPanel",this.element.dataset.testid="user-updates-panel",(0,W.fZ)(this.element,"userUpdatesPanel"),this.tabHandlesRow.element.style.borderBottom="none",this.tabHandlesRow.element.style.padding="4px 0 0 6px",this.tabHandlesRow.element.style.marginBottom="4px",this.tabHandlesRow.element.style.boxSizing="border-box",this.window.style.position="static",this.tabHandleStyle={...this.tabHandleStyle,fontSize:"12px",padding:"5px 10px"},this.updatesTabs=[new Me(t)],this.updatesTabs.forEach((e=>{this.addTab(e)})),Ce.dropDownToggle.listen((e=>{e?(this.tabsLoaded=0,this.updatesTabs.forEach((e=>e.loadFeed())),this.tabsLoaded===this.updatesTabs.length&&this.switchToMostRecentUnreadTab()):this.currentTab=void 0})),Ce.tabItemsLoaded.listen((()=>{this.tabsLoaded+=1})),this.addFeedbackLink(),this.dropDownComponent=this.createDropDownComponent(e)}createDropDownComponent(e){return new De(this,e)}initAdditionalToggleElement(e){Ce.updatesAreUnread.listen((()=>{this.anyUpdatesTabUnread()&&(null==e||e.classList.add("has_unseen"))})),Ce.updatesAreRead.listen((()=>{var t,i;this.anyUpdatesTabUnread()||(null!==(t=null===(i=document.querySelector("#dmListIconRoot"))||void 0===i?void 0:i.classList.contains("has_unread"))&&void 0!==t&&t||(e.className=e.className.replace("has_unseen","")))}))}switchToMostRecentUnreadTab(){this.changeToTab(this.updatesTabs.reduce(((e,t)=>t.highestUnreadTs>e.highestUnreadTs?t:e)))}anyUpdatesTabUnread(){return this.updatesTabs.some((e=>e.hasUnread()))}addFeedbackLink(){this.addFooter(Ee(!1))}repositionChildren(){}initUI(){this.element.style.overflow="",this.element.style.position="static",this.element.style.borderWidth="1px",this.element.style.borderStyle="solid",this.element.style.borderTop="none",this.element.style.borderRadius="0 0 4px 4px"}}class Ie extends Re{constructor(e){super(e,!0);for(let e=1;e<this.element.children.length-1;e+=1)this.element.children[e].style.height="calc(100% - 60px)"}createDropDownComponent(e){return new Be(this,e)}addFeedbackLink(){this.addFooter(Ee(!0))}initUI(){super.initUI(),this.element.style.borderRight="0"}}function Ee(e){const t=document.createElement("A");return(0,W.fZ)(t,"feedbackLink"),t.innerText=Y.R.howCanWeImproveText,t.style.fontSize="11px",t.style.textAlign="center",t.style.width="100%",t.style.display="block",t.style.padding="5px 0",t.style.marginBottom="7px",t.dataset.testid="how-can-we-improve",e?(t.href=(0,C._Y)(E.c.userUpdatesFeedbackLink),t.target="_blank"):(t.href="#",t.onclick=()=>{U.E.fire({source:"site_updates"})}),t}function Le(e,t,i){i.listen((i=>{e.isDropDownVisible!==i.isShowing&&(e.isDropDownVisible=i.isShowing,Ce.dropDownToggle.fire(i.isShowing),t.classList.toggle("active",i.isShowing))})),Ce.updatesAreUnread.listen((()=>{e.anyUpdatesTabUnread()&&t.classList.add("has_unseen")})),Ce.updatesAreRead.listen((()=>{e.refreshTabs(),e.anyUpdatesTabUnread()||(t.className=t.className.replace("has_unseen",""))})),e.updatesTabs.forEach((e=>{e.loadFeed()}))}class De extends O.v{constructor(e,t){super(t),this.element.appendChild(e.element),Le(e,t,this.toggleEvent)}initUI(){super.initUI(),(0,v.ZM)(this.element,{maxHeight:"368px",height:"",width:"100%",zIndex:1001,backgroundColor:"transparent",fontFamily:"UbuntuBold, Helvetica, Arial, sans-serif",left:"-1px",top:"24px",right:"auto"})}}class Be extends O.G{constructor(e,t){super(t),this.element.appendChild(e.element),Le(e,t,this.toggleEvent)}initUI(){super.initUI(),this.element.style.maxHeight="",this.element.style.width="100%",this.element.style.zIndex="1001",this.element.style.backgroundColor="#FFFFFF",this.element.style.fontFamily="UbuntuBold, Helvetica, Arial, sans-serif",this.element.style.left="-1px",this.element.style.top="0",this.element.style.height="calc(100% - 46px)",this.element.style.top="46px",this.pushmenu=document.querySelector(".pushmenu.main-menu"),null!==this.pushmenu&&(0,m.wu)("touchmove",this.pushmenu,(()=>{this.isShown()&&this.hideElement()}))}showElement(){const e=super.showElement();return this.scrollTopPushmenu(),e}scrollTopPushmenu(){null!==this.pushmenu&&(this.pushmenu.scrollTop=0)}}class Ue extends O.v{constructor(e,t,i){if(super(e),this.username=t,this.darkModeEnabled=i,this.element.id="UserMenuDropDown",this.element.dataset.testid="user-menu-drop-down",(0,W.fZ)(this.element,"userMenuDropDown"),(0,W.fZ)(this.element,W.aG.userInfoDropdownBgColor),(0,v.ZM)(this.element,{display:"none",width:"100%",height:"auto",boxSizing:"border-box",top:"24px",left:"0px",zIndex:1001,borderRadius:"0 0 5px 5px",borderStyle:"solid",borderWidth:"1px",borderTop:"none",fontFamily:"UbuntuBold, Helvetica, Arial, sans-serif",padding:"5px 0",position:"absolute",right:"auto"}),E.m.isWhiteLabel||this.setupDarkmode(),""!==t){if(this.profileLink=this.createDropdownLink(Y.R.myProfileTextLc),this.profileLink.dataset.testid="profile-link",this.element.appendChild(this.profileLink),this.myCollectionLink=this.createDropdownLink(Y.R.myCollectionText),this.myCollectionLink.dataset.testid="my-collection-link",this.myCollectionLink.href=(0,C._Y)("/my_collection/"),this.element.appendChild(this.myCollectionLink),void 0!==window.live_chat_support){const e=this.createDropdownLink(Y.R.liveChatSupportTextLc);e.dataset.testid="live-chat-link",e.href=(0,C._Y)("/accounts/support_chat/"),e.onclick=e=>{e.preventDefault(),(0,ue.gr)("/accounts/support_chat/","support_chat","height=630,width=375,resizable=0,location=0")},this.element.appendChild(e)}const e=document.createElement("form");e.method="post",e.action=(0,C._Y)("/auth/logout/"),e.target="_top",e.style.display="none";const i=document.createElement("input");i.type="hidden",i.name="csrfmiddlewaretoken",i.value=(0,l.I7)("csrftoken"),e.appendChild(i),this.element.appendChild(e);const s=this.createDropdownLink(Y.R.sendFeedbackTextLc);s.dataset.testid="feedback-link",s.style.cursor="pointer",s.onclick=e=>{e.preventDefault(),this.hideElement(),U.E.fire({source:"user_menu"})},this.element.appendChild(s);const n=this.createDropdownLink(Y.R.logOutTextLc);n.dataset.testid="logout-link",n.href=(0,C._Y)("/auth/logout/"),n.onclick=t=>{t.preventDefault(),this.hideElement(),(0,F.mf)(Y.R.logoutModalText,(()=>{i.value=(0,l.I7)("csrftoken"),e.submit()}))},this.element.appendChild(n),void 0!==t&&this.setUsername(t)}else{const e=this.createDropdownLink(Y.R.loginVerbText);e.dataset.testid="login-link",e.classList.add("login-link"),e.classList.add("nooverlay"),e.href=(0,C._Y)(b.ii),(0,b.fT)(e),this.element.appendChild(e);const t=this.createDropdownLink(Y.R.signUpText);t.dataset.testid="signup-link",t.href=(0,C._Y)(`${b.k6}?src=header`),(0,b.fT)(t),this.element.appendChild(t);const i=this.createDropdownLink(Y.R.sendFeedbackTextLc);i.dataset.testid="feedback-link",i.style.cursor="pointer",i.href="#",i.onclick=e=>{e.preventDefault(),this.hideElement(),U.E.fire({source:"user_menu"})},this.element.appendChild(i)}}setupDarkmode(){if(void 0!==this.darkModeEnabled){this.isDarkMode=document.body.classList.contains("darkmode");const e=this.createDarkModeSwitch();this.element.insertBefore(e,this.element.firstChild),!document.body.classList.contains("isIpad")&&(0,a.J0)()&&document.body.classList.add("isIpad")}}createDarkModeSwitch(){const e=document.createElement("div"),t=document.createElement("span");return this.dmSwitchCircle=document.createElement("span"),this.dmSwitchCircle.dataset.testid="dark-mode-switch",e.innerText=Y.R.darkMode,t.appendChild(this.dmSwitchCircle),e.appendChild(t),(0,W.fZ)(this.dmSwitchCircle,"dmSwitchCircle"),(0,v.ZM)(this.dmSwitchCircle,{borderRadius:"50%",display:"inline-block",height:"16px",width:"16px",position:"relative",top:"2px",left:"3px"}),(0,v.ZM)(t,{borderRadius:"25px",display:"inline-block",height:"20px",marginLeft:"10px",position:"relative",verticalAlign:"bottom",width:"44px",cssFloat:"right",right:"6px",top:"-2px"}),(0,W.fZ)(t,"dmSwitch"),(0,J.PF)(e,"none"),(0,J.Ve)(this.dmSwitchCircle,"left 100ms"),(0,W.fZ)(e,W.aG.userInfoDropdownTextColor),(0,W.fZ)(e,W.aG.userInfoDropdownHighlightColor),e.style.fontSize="14px",e.style.fontWeight="normal",e.style.cursor="pointer",e.style.fontFamily="UbuntuMedium, Arial, Helvetica, sans-serif",e.style.padding="5px 0 5px 10px",e.onclick=()=>{this.setColorModeFn()},H.sb.listen((()=>{this.setColorModeFn()})),this.isDarkMode&&(this.dmSwitchCircle.style.left="25px"),e}setColorModeFn(){E.m.isWhiteLabel||(this.isDarkMode?(this.dmSwitchCircle.style.left="3px",this.isDarkMode=!1,(0,W.SA)(document.body,"darkmode"),(0,W.fZ)(document.body,"lightmode"),(0,l.uC)("theme_name","lightmode",{days:60},"/",(0,f.DV)())):(this.dmSwitchCircle.style.left="25px",this.isDarkMode=!0,(0,W.SA)(document.body,"lightmode"),(0,W.fZ)(document.body,"darkmode"),(0,l.uC)("theme_name","darkmode",{days:60},"/",(0,f.DV)())),this.updateMenuColors(),(0,R.bT)("colorModeChanged",{username:void 0===this.username?"__anon__":this.username,color_mode:this.isDarkMode?"darkmode":"lightmode"}),H.gh.fire(this.isDarkMode?"darkmode":"lightmode"),(0,N.ok)()||(0,C.KF)("api/ts/accounts/userpreferredtheme/",{theme:this.isDarkMode?"darkmode":"lightmode"}))}updateMenuColors(){E.m.isWhiteLabel&&(this.element.style.backgroundColor=E.m.userInfoDropdownBgColor,this.element.style.border=`1px solid ${E.m.tabBorderColor}`)}createDropdownLink(e){const t=document.createElement("a");return t.style.textDecoration="none",t.innerText=e,t.style.display="block",t.style.fontSize="14px",t.style.padding="5px 0 5px 10px",(0,W.fZ)(t,W.aG.userInfoDropdownTextColor),(0,W.fZ)(t,W.aG.userInfoDropdownHighlightColor),t.onclick=()=>{this.hideElement()},t}setUsername(e){void 0!==this.profileLink&&(this.profileLink.href=(0,C._Y)(`/p/${e}/?tab=bio`))}showElement(){return super.showElement()}hideElement(e){return super.hideElement()}}function _e(e,t){let i,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;return E.m.isWhiteLabel||null===e||null===t||(s?(i=new Ie(e),null!=n&&i.initAdditionalToggleElement(n)):i=new Re(e),t.appendChild(i.dropDownComponent.element),i.element.dataset.testid="user-updates-panel"),i}function Fe(e,t,i,s){null!==e&&null!==s&&s.appendChild(new he({dmListIconRoot:e,userUpdatesBellRoot:t,hamburgerIcon:i}).element)}function Ne(){const e=document.querySelector("#logout-conf"),t=document.querySelector("#user_logout_form");null===e||null===t||(0,N.ok)()||(0,m.wu)("click",e,(e=>{e.preventDefault(),(0,F.mf)(Y.R.logoutModalText,(()=>{t.submit()}))}))}const Oe=new we.c_("newFollowedOnline"),He=new we.c_("onlineFollowedStorage"),We=new we.c_("onlineFollowedStorage"),$e="onlineFollowedTab",Ve="followedDropdownClicked";function ze(){if(!(0,a.Pf)())return;const e=window.localStorage.getItem($e);return null!==e?JSON.parse(e):void 0}var Ge=i(2939),qe=i(5088),je=i(7321),Ze=i(520);class Ke extends S.b{createElement(e){return(0,Q.tT)("div",{className:"followRecommendedHeader",display:e.rooms.length>0?"block":"none"},(0,Q.tT)("div",{className:"recommendationsBorder"}),(0,Q.tT)("span",{className:"recommendedRoomsTitle"},Y.R.recommendedForYou))}}class Je extends S.b{createElement(e){return(0,Q.tT)("div",{className:"followRoomTable",display:e.rooms.length>0?"inline-block":"none"},e.rooms.map(((e,t,i)=>{if(t%2==0)return(0,Q.tT)("div",{key:t,display:"table-row"},(0,Q.tT)("div",{display:"table-cell"},e.card),t+1<i.length&&(0,Q.tT)("div",{display:"table-cell"},i[t+1].card))})))}}const Ye={fontSize:"13px",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif",width:"auto",height:"auto",position:"absolute",display:"none",overflow:"",cursor:"default",top:"0px",left:"0px",zIndex:5},Qe={cssFloat:"right"},Xe={margin:"5px 0"};class et extends Ze.s{constructor(e,t){super(e,!1),this.showFollowedCount=t,this.followedData=ot.getInstance(),this.topMargin=5}setDropDownStyleFromToggle(e){const t=getComputedStyle(this.element).borderBottomRightRadius;this.setBorderRadius(e,t)}createBaseElement(){const e=(0,f.fv)()?"followRecommendedContainer":"followedContainer";return(0,Q.tT)("div",{className:"followedDropdown","data-href":"skip"},(0,Q.tT)("div",{className:e,colorClass:[W.aG.tabActiveBgColor,"tabBorderNoHover"],ref:e=>{this.followedContainer=e}}))}initData(e){super.initData(null!=e?e:{}),(0,f.rT)()?p.UrlState.current.listen(["genders"],(e=>{var t,i;const s=null!==(t=(null!==(i=e.genders)&&void 0!==i?i:[])[0])&&void 0!==t?t:"";void 0!==this.moreAnchor&&(this.moreAnchor.href=(0,C._Y)(tt(s,this.followedData.getOnlineFollowed().online>0)))}),this.element):(this.gender=(0,y.Bg)(),P.wd.addListener((e=>{this.gender=e,void 0!==this.moreAnchor&&(this.moreAnchor.href=(0,C._Y)(tt(this.gender,this.followedData.getOnlineFollowed().online>0)))}),this.element))}initUI(e){super.initUI(e),(0,v.ZM)(this.element,Ye)}updateFollowedCount(){if(void 0===this.followedCount)return;const e=this.followedData.getOnlineFollowed();this.followedCount.textContent=Y.R.followCountLong(e.online,e.total)}navigateToFollowedPage(e){var t,i;(0,R.bT)("FollowedDropdownSeeAll"),(0,f.rT)()?(p.UrlState.current.state.pageType===p.PageType.HOME||(0,p.isRoomRoomlistSpaActive)()&&p.UrlState.current.state.pageType===p.PageType.ROOM)&&(e.preventDefault(),p.UrlState.current.navigateTo(tt(null!==(t=null===(i=p.UrlState.current.state.genders)||void 0===i?void 0:i[0])&&void 0!==t?t:y.YT.All,this.followedData.getOnlineFollowed().online>0))):P.XS.fire(e)}replaceRooms(){if(!this.isShown()){for(;null!==this.followedContainer.firstChild;)this.followedContainer.removeChild(this.followedContainer.firstChild);this.appendHeaders(),this.followedContainer.style.width="auto",this.appendRoomTables(),0===this.followedData.getCurrentShownRooms().length&&(this.appendNoneDiv(),(!(0,f.fv)()||ot.getInstance().getCurrentRecommendations().length<2)&&(this.followedContainer.style.width="265px"))}}appendHeaders(){if(!(0,N.ok)()){var e,t;const i=this.followedData.getOnlineFollowed(),s=this.followedData.getCurrentShownRooms().length>1,n=(0,f.rT)()?null!==(e=(null!==(t=p.UrlState.current.state.genders)&&void 0!==t?t:[])[0])&&void 0!==e?e:"":this.gender;if(this.followedContainer.appendChild(this.getRoomElement(n,i,s)),(0,f.fv)()){const e=new Ke({rooms:ot.getInstance().getCurrentRecommendations()});this.followedContainer.appendChild(e.element)}}}appendRoomTables(){if((0,f.fv)()){var e;const t=new Je({rooms:this.followedData.getCurrentShownRooms()});null===(e=this.followedContainer.firstElementChild)||void 0===e||e.insertAdjacentElement("afterend",t.element);const i=new Je({rooms:this.followedData.getCurrentRecommendations()});this.followedContainer.appendChild(i.element)}else{const e=(0,Q.tT)("div",{style:{display:"table"}});let t=(0,Q.tT)("div",null),i=0;this.followedData.getCurrentShownRooms().forEach((s=>{i%2==0&&(t=(0,Q.tT)("div",{style:{display:"table-row"}}),e.appendChild(t));const n=(0,Q.tT)("div",{style:{display:"table-cell"}});n.appendChild(s.card),t.appendChild(n),i+=1})),this.followedContainer.appendChild(e)}}appendNoneDiv(){const e=(0,Q.tT)("div",{colorClass:W.aG.textColor,style:{margin:"5px 3px 5px 3px",fontSize:"12px",fontFamily:"UbuntuRegular"}});if((0,N.ok)()){const t=e=>{const t=(0,Q.tT)("a",{href:e.href,style:{height:"auto",width:"auto",border:"none",borderRadius:"0px",textDecoration:"none",cursor:"pointer",cssFloat:"none",padding:"0px"},colorClass:[W.aG.tabActiveBgColor,W.aG.hrefColor],onMouseEnter:()=>{t.style.textDecoration="underline"},onMouseLeave:()=>{t.style.textDecoration="none"},onClick:void 0!==e.onClick?e.onClick:void 0,"account-redirect":!0,"data-testid":e.testid},e.children);return t};e.appendChild((0,Q.tT)(Q.FK,null,(0,Q.tT)(t,{href:(0,C._Y)(`${b.k6}?src=followed_tab`),testid:"following-sign-up-link"},Y.R.signUpText),(0,Q.tT)("span",null,` ${Y.R.orLower} `),(0,Q.tT)(t,{href:(0,C._Y)(b.ii),onClick:e=>{e.metaKey||e.ctrlKey||(e.preventDefault(),this.hideElement(),(0,j.DC)({}))},testid:"following-login-link"},Y.R.loginVerbText))),e.appendChild((0,Q.tT)("span",null,Y.R.anonFollowMore))}else e.appendChild((0,Q.tT)("span",null,Y.R.userFollowMore));var t;(0,f.fv)()?null===(t=this.followedContainer.firstElementChild)||void 0===t||t.insertAdjacentElement("afterend",e):this.followedContainer.appendChild(e)}getRoomElement(e,t,i){return(0,Q.tT)("div",{style:{margin:"5px 3px"}},(0,f.fv)()&&(0,Q.tT)("span",{className:"onlineRoomsTitle"},Y.R.onlineRooms),(0,Q.tT)("a",{href:tt(e,t.online>0),style:{height:"auto",width:"auto",border:"none",borderRadius:"0px",textDecoration:"none",cursor:"pointer",cssFloat:(0,f.fv)()?"right":"none",padding:"0px"},"data-testid":"following-show-all",colorClass:[W.aG.tabActiveBgColor,W.aG.hrefColor],ref:e=>{this.moreAnchor=e},onMouseEnter:()=>{this.moreAnchor.style.textDecoration="underline",(0,W.fZ)(this.moreAnchor,W.aG.tabActiveColor),(0,W.SA)(this.moreAnchor,W.aG.hrefColor)},onMouseLeave:()=>{this.moreAnchor.style.textDecoration="none",(0,W.fZ)(this.moreAnchor,W.aG.hrefColor),(0,W.SA)(this.moreAnchor,W.aG.tabActiveColor)},onClick:e=>this.navigateToFollowedPage(e)},Y.R.showAllText),this.showFollowedCount&&(0,Q.tT)("div",{style:i?Qe:Xe,className:"followedCount",ref:e=>{this.followedCount=e}},Y.R.followCountLong(t.online,t.total)))}updateThumbnails(){for(const e of this.followedData.getCurrentShownRooms())e.updateThumbnail();if((0,f.fv)())for(const e of this.followedData.getCurrentRecommendations())e.updateThumbnail()}showElement(){if(!super.showElement())return!1;this.updateThumbnails(),this.followedContainer.scrollTop=0,this.followedData.resetLastUnseen();const e=(0,v.$R)(this.element),t=Math.max((0,M.DK)(),(0,v.Lx)(document.body.style.minWidth));return e.right>t&&(this.element.style.width=this.element.offsetWidth-(e.right-t)-4+"px",this.followedContainer.style.overflowX="auto"),!0}hideElement(e){if(void 0!==e&&(e.metaKey||e.ctrlKey))return!1;if(!super.hideElement())return!1;for(const e of this.followedData.getCurrentShownRooms())e.unhighlight();return this.element.style.width="auto",this.followedContainer.style.overflowX="hidden",this.replaceRooms(),!0}reposition(){super.reposition(),this.connectedOverlay.element.style.display="none",this.setCollapsed()}setCollapsed(){const e=document.querySelector(".nav-bar");null!==e&&this.toggleElement.getBoundingClientRect().top>e.getBoundingClientRect().bottom?(this.element.classList.add("collapsed"),this.element.style.left="",this.element.style.right="",this.element.style.width="auto"):this.element.classList.remove("collapsed")}}function tt(e,t){return t?"/followed-cams/online/"+(e!==y.YT.All?`${y.hf.get(e)}/`:""):"/followed-cams/offline/"}class it{constructor(e,t,i){this.room=e,this.highlighted=t,this.username="",this.username=e.room;const s=""!==this.room.image?this.room.image:`${STATIC_URL_ROOT}images/no_thumbnail_1_wide.jpg`;this.a=(0,Q.tT)("a",{className:"roomElementAnchor",colorClass:[W.aG.tabInactiveColor,this.highlighted?"isHighlighted":"notHighlighted"],style:{width:"180px",height:"126px",borderRadius:"4px",border:"none",padding:"0px",margin:"0px",display:"block",cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",textDecoration:"none"},"data-room":this.username,href:(0,C._Y)(`/${this.username}/`),onClick:e=>{(0,R.bT)("FollowedDropdownVisit"),(0,f.rT)()&&(0,p.saveStickyFilters)(p.UrlState.current.state),(0,P.r)()&&(0,v.eH)(e,(()=>{H.VZ.fire(this.username)}))}},(0,Q.tT)("img",{alt:"",src:s,width:180,height:101,style:{borderRadius:"3px 3px 0px 0px"},className:"room_thumbnail","data-testid":"room-card-image",ref:e=>{this.img=e}}),(0,Q.tT)("span",{style:{padding:"5px"},"data-testid":"room-card-username"},this.username)),this.card=(0,Q.tT)("div",{className:"roomElement",style:{display:"inline-block",width:"180px",height:"126px",borderRadius:"4px",margin:"3px",cursor:"pointer"},"data-testid":"room-card"},this.a),(0,m.Xq)(["click","mousedown","touchstart"],this.a,(()=>{(0,je.sl)(this.username,"ft",i)}))}unhighlight(){this.highlighted=!1,(0,W.fZ)(this.a,"notHighlighted"),(0,W.SA)(this.a,"isHighlighted")}updateThumbnail(){var e;this.setImageStreamer(),""!==this.room.image&&(null===(e=this.imageStreamer)||void 0===e||e.loadImage(0).catch((e=>{warn("Error loading image",{imageSrc:e})})))}setImageStreamer(){""!==this.room.image&&void 0===this.imageStreamer&&(this.imageStreamer=new qe.QR(this.username,this.img),(0,m.wu)("mouseenter",this.card,(()=>{var e;(0,je.$r)()&&(null===(e=this.imageStreamer)||void 0===e||e.startStreaming())})),(0,m.wu)("mouseleave",this.card,(()=>{var e;(0,je.$r)()&&(null===(e=this.imageStreamer)||void 0===e||e.stopStreaming())})))}}var st,nt=i(5079);class ot{constructor(){this.first=!0,this.currentShownRooms=[],this.currentRecommendations=[],this.lastUnseen=[],this.seenRooms={},this.forceSeen={},this.onlineFollowed={online:0,total:0}}static getInstance(){return ot._instance}init(e){if(this.currentOptions=e,H.VZ.listen((()=>{this.currentOptions.dropdown.hideElement()})),Ge.X0.listen((e=>{this.currentOptions.dropdown.replaceRooms(),this.setSeen([e.dossier.room])})),w.oO.listen((()=>{this.currentOptions.dropdown.isShown()&&(this.disableResizeDebounce||this.currentOptions.dropdown.hideElement())})),this.currentOptions.dropdown.toggleEvent.listen((()=>{this.currentOptions.dropdown.isShown()&&this.disableResizeDebounceEvent()})),this.currentOptions.dropdown.replaceRooms(),!(0,N.ok)()){var t;(0,a.Pf)()&&(0,m.wu)("storage",window,(e=>{if(e.key===$e){const e=ze();void 0!==e&&He.fire(e)}if(e.key===Ve&&null!==e.newValue){const t=ze();void 0!==t&&(t.timestamp=JSON.parse(e.newValue).timestamp,t.flash=!1,t.unseenRooms=[],We.fire(t))}})),He.listen((e=>{this.updateViaStorageCallback(e,!1,this.currentOptions.username,this.currentOptions.updateViaStorageCallback)})),We.listen((e=>{this.updateViaStorageCallback(e,!1,void 0,this.currentOptions.followedDropdownClickedCallback)}));const e=0===window.location.pathname.indexOf("/followed-cams/",0)?void 0:ze();void 0!==e&&e.username===this.currentOptions.username&&Date.now()-e.timestamp<3e4?(this.notFirst(),this.updateViaStorageCallback(e,!0,this.currentOptions.username,this.currentOptions.updateViaStorageCallback),function(){if(!(0,a.Pf)())return;const e=window.localStorage.getItem($e);if(null===e)return;const t=JSON.parse(e);t.timestamp=Date.now(),window.localStorage.setItem($e,JSON.stringify(t))}(),this.getUpdatesFromCB(!0,this.currentOptions.username,this.currentOptions.updateFromCBCallback)):this.getUpdatesFromCB(!1,this.currentOptions.username,this.currentOptions.updateFromCBCallback);const i=e=>{clearInterval(this.updateInterval),this.updateInterval=window.setInterval((()=>{this.currentOptions.dropdown.isShown()||this.getUpdatesFromCB(!1,this.currentOptions.username,this.currentOptions.updateFromCBCallback)}),e)};i(2e4),window.setTimeout((()=>{i(6e4)}),6e5),window.setTimeout((()=>{i(12e5)}),18e5),window.setTimeout((()=>{clearInterval(this.updateInterval)}),216e5),Oe.listen((()=>{this.currentOptions.followedTab.flash()}));const s=I.Bm.current.loggedInUser,n=null!==(t=null==s?void 0:s.userUid)&&void 0!==t?t:"";new q.Jf(n).onMessage.listen((e=>{e.followerUsername===(null==s?void 0:s.username)&&this.updateFollowedTab(e.followedUsername)}))}}getSeenRooms(){return this.seenRooms}getlastUnseen(){return this.lastUnseen}getforceSeen(){return this.forceSeen}getOnlineFollowed(){return this.onlineFollowed}setOnlineFollowed(e){this.onlineFollowed=e}setSeenRoom(e){this.seenRooms[e]=!0}setForceSeen(e){this.forceSeen[e]=!0}getCurrentShownRooms(){return this.currentShownRooms}notFirst(){this.first=!1}resetLastUnseen(){this.lastUnseen=[]}setSeen(e){for(const t of e)this.setSeenRoom(t),this.setForceSeen(t)}setDropdownViewed(){!function(){if(!(0,a.Pf)())return;const e=window.localStorage.getItem($e);if(null===e)return;const t=JSON.parse(e);for(const e of t.unseenRooms)t.seenRooms[e.room]=!0;t.timestamp=Date.now(),t.flash=!1,t.unseenRooms=[],window.localStorage.setItem($e,JSON.stringify(t))}(),(0,a.Pf)()&&window.localStorage.setItem(Ve,JSON.stringify({timestamp:Date.now()}))}updateViaStorageCallback(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;e.timestamp<=this.lastUpdate||e.username!==i||(this.onlineFollowed=e.onlineFollowedList.onlineFollowed,this.seenRooms=e.seenRooms,this.lastUnseen=e.unseenRooms,this.update(e.onlineFollowedList,!0),void 0!==s&&s(e,t),this.lastUpdate=e.timestamp)}update(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i={},s=[],n=[];for(const t of e.roomList)void 0!==this.seenRooms[t.room]||this.first?n.push(t):s.push(t),this.seenRooms[t.room]=!0,i[t.room]=t;const o=s.length>0;this.lastUnseen=this.lastUnseen.reduce(((e,t)=>(void 0===i[t.room]||this.forceSeen[t.room]||e.push(i[t.room]),e)),[]);for(const e of s)this.lastUnseen.push(e);const r={};this.currentShownRooms=[];for(const e of this.lastUnseen)r[e.room]=!0,this.currentShownRooms.push(new it(e,!0,this.currentShownRooms.length+1));for(const e of n)void 0===r[e.room]&&this.currentShownRooms.push(new it(e,!1,this.currentShownRooms.length+1));this.currentOptions.dropdown.replaceRooms();const a=!this.first&&o;return a&&!t&&Oe.fire(void 0),this.first=!1,{flash:a,rooms:this.lastUnseen}}getUpdatesFromCB(){let e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Date.now()-this.lastUpdate<1e4||((0,C.Aw)("follow/api/online_followed_rooms/").then((e=>{if(200!==e.status)return Promise.reject();const t=new Se.N6(e.responseText);return t.valid?{onlineFollowed:{online:t.getNumber("online"),total:t.getNumber("total")},roomList:(i=t.getList("online_rooms"),void 0===i?[]:i.map((e=>({room:e.getString("room"),image:e.getString("image")}))))}:{onlineFollowed:{online:0,total:0},roomList:[]};var i})).then((i=>{this.lastUpdate=Date.now(),this.onlineFollowed=i.onlineFollowed;const s=this.update(i);t(s),function(e,t,i,s,n){if(!(0,a.Pf)())return;const o={username:e,onlineFollowedList:t,seenRooms:i,unseenRooms:n,flash:s,timestamp:Date.now()};window.localStorage.setItem($e,JSON.stringify(o))}(e,i,this.seenRooms,s.flash,s.rooms)})).catch((()=>{})),this.updateRecommendations())}getCurrentRecommendations(){return this.currentRecommendations}updateRecommendations(){(0,f.fv)()&&async function(){const e=new URLSearchParams(window.location.search);return e.delete("genders"),e.delete("regions"),(0,C.Aw)(`${p.FOLLOW_RECOMMENDATIONS_API_URL}?${e.toString()}`).then((e=>{var t;const i=null!==(t=new Se.N6(e.responseText).getList("rooms"))&&void 0!==t?t:[];return i.slice(0,6).map((e=>{const t=(0,nt.ak)(e),s={room:t.room,image:t.img};return new it(s,!1,i.length+1)}))})).catch((e=>(warn("Failed to fetch recommended follow rooms",e),[])))}().then((e=>{this.currentRecommendations=e,this.currentOptions.dropdown.replaceRooms()})).catch((()=>{}))}updateFollowedTab(e){this.setSeen([e]),this.getUpdatesFromCB(!0,this.currentOptions.username,this.currentOptions.updateFromCBCallback)}disableResizeDebounceEvent(){this.disableResizeDebounce=!0,window.setTimeout((()=>{this.disableResizeDebounce=!1}),300)}}(st=ot)._instance=new st;class rt{constructor(e,t){var i,s,n;this.toggleEl=e,this.orange=!1,this.followedData=ot.getInstance(),this.moveFollowCountTest=new Se.yk(["MvFlw2","MvFlw2Ntf","MvFlw2Onl"],"mv_flw_ct"),this.ratioText=null!==(i=this.toggleEl.querySelector(".followed_counts"))&&void 0!==i?i:void 0,["MvFlw2","MvFlw2Ntf"].includes(null!==(s=this.moveFollowCountTest.activeSide)&&void 0!==s?s:"")&&void 0!==this.ratioText&&(this.ratioText.remove(),this.ratioText=void 0),this.followingLink=null!==(n=document.getElementById("followed_anchor"))&&void 0!==n?n:void 0;const o={username:t,updateFromCBCallback:e=>{this.updateRatioText(!0),0===e.rooms.length&&(this.orange=!1,this.updateTabHighlight())},updateViaStorageCallback:(e,t)=>{this.updateRatioText(!1),this.orange=e.unseenRooms.length>0,this.updateTabHighlight(),e.flash&&!t&&this.flash()},followedDropdownClickedCallback:()=>{this.updateRatioText(!1),clearInterval(this.flashInterval),this.flashInterval=void 0,this.orange=!1,this.updateTabHighlight()},dropdown:new et(this.toggleEl,this.moveFollowCountTest.active),followedTab:this};this.dropdown=o.dropdown,this.dropdown.toggleEvent.listen((e=>{if(e.isShowing){clearInterval(this.getFlashingInterval()),this.setFlashingInterval(void 0),this.setOrange(!1),this.updateTabHighlight();const e=this.followedData.getOnlineFollowed().online;(0,R.bT)("FollowedDropdownOpened",{onlineBroadcasters:e}),this.followedData.setDropdownViewed()}})),(0,f.rT)()?p.UrlState.current.listen(["genders"],(e=>{var t,i;this.updateFollowingLink(null!==(t=(null!==(i=e.genders)&&void 0!==i?i:[])[0])&&void 0!==t?t:"",this.followedData.getOnlineFollowed().online>0)}),this.followingLink):P.wd.listen((e=>{this.updateFollowingLink(e,this.followedData.getOnlineFollowed().online>0)})),this.followedData.init(o),this.moveFollowCountTest.active||(this.followedData.setOnlineFollowed(function(e){const t=e.split(/[()/]+/);return 4!==t.length?{online:0,total:0}:{online:parseInt(t[1]),total:parseInt(t[2])}}(this.toggleEl.innerText)),this.updateRatioText(!0))}setOrangeStyle(e){if(e){(0,W.fZ)(this.toggleEl,"orange");const e=this.followedData.getlastUnseen().length;var t;e>0&&"MvFlw2Ntf"===this.moveFollowCountTest.activeSide&&((0,W.fZ)(this.toggleEl,"text"),null===(t=document.getElementById("followed_anchor"))||void 0===t||null===(t=t.style)||void 0===t||t.setProperty("--unseen-follow-count",`"${e}"`))}else(0,W.SA)(this.toggleEl,"orange"),(0,W.SA)(this.toggleEl,"text")}setOrange(e){this.orange=e}setFlashingInterval(e){this.flashInterval=e}getFlashingInterval(){return this.flashInterval}flash(){if(void 0!==this.flashInterval)return;let e=3,t=!0;this.flashInterval=window.setInterval((()=>{if(t){if(this.setOrangeStyle(!0),e-=1,0===e)return clearInterval(this.flashInterval),void(this.flashInterval=void 0)}else this.setOrangeStyle(!1);t=!t}),500)}updateRatioText(e){if(this.moveFollowCountTest.active&&this.dropdown.updateFollowedCount(),void 0===this.ratioText)return;const t=this.followedData.getOnlineFollowed();this.toggleEl.style.width="auto";const i=void 0===I.Bm.current.loggedInUser?"":`(${t.online})`;this.ratioText.textContent="MvFlw2Onl"===this.moveFollowCountTest.activeSide?i:`(${t.online}/${t.total})`,null!==this.toggleEl.offsetParent&&window.setTimeout((()=>{e||(this.toggleEl.style.width=`${this.toggleEl.offsetWidth+1}px`),this.dropdown.isShown()&&this.dropdown.reposition()})),this.updateFollowingLink((0,y.Bg)(),t.online>0)}updateTabHighlight(){this.orange&&!this.dropdown.isShown()?this.setOrangeStyle(!0):this.setOrangeStyle(!1)}updateFollowingLink(e,t){void 0!==this.followingLink&&(this.followingLink.href=tt(e,t))}}function at(e){if(void 0===e)return;const t=[];for(const i of JSON.parse(e))t.push({provider:i[0],name:i[1]});return t}function lt(e){var t;if(null!==e&&"/security/tfa/auth/"!==window.location.pathname&&"/security/tfa/auth/choose_device/"!==window.location.pathname)return{username:e.username,gender:e.gender,subgender:null!==(t=e.subgender)&&void 0!==t?t:void 0,isSupporter:e.is_supporter,isStaff:e.is_staff,tokenBalance:e.token_balance,userUid:e.user_uid,signedUsername:e.signed_username,isAgeVerified:e.is_age_verified,isBroadcasting:e.is_broadcasting,totalFollowed:e.total_followed,onlineFollowed:e.online_followed,canWegOneClick:e.can_weg_oneclick,canEpochOneClick:e.can_epoch_oneclick}}var ht=i(5914),dt=i(7537);class ct extends dt.o{constructor(e){super(e),this.easyExit=!1,this.defineTabbableElements([this.loginLink,this.dismissLink]),this.iframeForm.addEventListener("load",(()=>{var e;null===(e=this.iframeForm.contentDocument)||void 0===e||e.querySelectorAll("a.medium_popup_link").forEach((e=>{e.onclick=t=>{t.preventDefault(),(0,ue.gr)(e.href,"_blank",ue.NL)}})),this.loadingMessage.style.display="none",this.iframeForm.style.display="inline"})),this.iframeForm.addEventListener("orientationchange",(()=>{var e;null===(e=this.iframeForm.contentWindow)||void 0===e||e.location.reload()}))}createElement(e){return(0,Q.tT)("div",{id:"age-gate-signup"},(0,Q.tT)("div",{className:"left-half"},(0,Q.tT)("div",{className:"text-container"},(0,Q.tT)("img",{className:"verified-check",src:`${STATIC_URL_ROOT}images/circle-check-green.svg`}),(0,Q.tT)("h2",null,"You've been successfully verified."),(0,Q.tT)("p",null,"Sign up or log in so you don't have to do this again.")),(0,Q.tT)("div",{className:"link-row"},(0,Q.tT)("a",{href:"#",className:"login",ref:e=>{this.loginLink=e},onClick:e=>{e.preventDefault(),(0,j.DC)({})}},"Already have an account"),(0,Q.tT)("a",{href:"#",className:"age-gate-signup-dismiss nooverlay",onClick:e=>this.dismissLinkClicked(e),ref:e=>{this.dismissLink=e}},"Skip for now"))),(0,Q.tT)("div",{className:"right-half"},(0,Q.tT)("div",{className:"loading-msg",ref:e=>{this.loadingMessage=e}},"Loading..."),(0,Q.tT)("iframe",{src:"/accounts/register_iframe/?src=avsuccess",ref:e=>{this.iframeForm=e}})))}dismissLinkClicked(e){e.preventDefault(),(0,l.Yj)("AG_Key"),this.hide()}}const ut="AG_PAVSM";var pt=i(1679),mt=i(1244),gt=i(3587),vt=i(9268),ft=i(2945),yt=i(3124),bt=i(2359),wt=i(1779),Ct=i(3049),St=i(7872),xt=i(8638),Tt=i(7463),Pt=i(9111);const kt="pushmenu-animate",At="no-scroll",Mt="push-page-content";class Rt extends g.u{constructor(){super(...arguments),this.lastScrollTop=0}initUI(e){this.menuButton=e.menuButton,this.menuContent=new g.u(this.element.querySelector(".main-menu")),this.pushOverlay=new g.u(this.element.querySelector(".push-overlay")),this.desktopLink=this.element.querySelector("#mobile_desktop_link"),this.socialIconsContainer=this.element.querySelector("#mobile-social-media-icons"),this.followingLink=this.element.querySelector("#follow_page_link"),this.menuButton.addEventListener("click",this.onMenuOpen.bind(this)),this.pushOverlay.element.addEventListener("click",this.onMenuClosed.bind(this)),this.bindSubMenus(),this.bindHeaderOpenedEvents(),Ne(),this.bindDesktopLink(),this.bindSocialMediaIcons(),this.bindFollowCountUpdates(),this.bindRoomlistLinks()}onMenuOpen(){this.showElement(),this.pushOverlay.showElement(),document.querySelectorAll(".content, header").forEach((e=>{e.classList.add(Mt)})),this.setScroll(!0),window.setTimeout((()=>{this.menuContent.element.classList.add(kt)})),(0,R.bT)("MobileMenuClick",{"attributes.is_orange":this.menuButton.classList.contains("has_unseen")}),ae.nD.fire(!0)}onMenuClosed(){this.menuContent.element.classList.remove(kt),this.pushOverlay.element.style.opacity="0",document.querySelectorAll(".content, header").forEach((e=>{e.classList.remove(Mt)})),this.setScroll(!1),window.setTimeout((()=>{this.hideElement(),this.pushOverlay.element.style.opacity=""}),150),ae.nD.fire(!1)}setScroll(e){e?(this.lastScrollTop=window.scrollY,document.body.classList.add(At),document.body.style.top=`-${this.lastScrollTop}px`):(document.body.classList.remove(At),document.body.style.top="",window.scrollTo(0,this.lastScrollTop))}bindSubMenus(){const e=this.element.querySelector("#userUpdatesBellRoot");_e(e,this.element.querySelector("#userUpdatesMenuDropdownRoot"),!0,this.menuButton),I.Bm.current.isAgeGated||Fe(this.element.querySelector("#dmListIconRoot"),e,this.menuButton,this.element.querySelector("#dmListDropdownRoot"))}isPushMenuOpen(){return"block"===this.element.style.display}bindHeaderOpenedEvents(){ae.bW.listen((e=>{e&&!this.isPushMenuOpen()?this.onMenuOpen():!e&&this.isPushMenuOpen()&&this.onMenuClosed()}))}bindDesktopLink(){this.desktopLink.addEventListener("click",(()=>{(0,l.uC)("mobile_redirect","never",{hours:18},"/",!0),(0,l.uC)("mobile_redirect_source","user",{hours:18},"/",!0),(0,R.bT)("Mobile_DesktopLinkClicked")}))}bindSocialMediaIcons(){null!==this.socialIconsContainer&&this.socialIconsContainer.querySelectorAll("a").forEach((e=>{e.addEventListener("click",(()=>{(0,R.bT)("ClickSocialMediaLink",{"attributes.source":"mobile","attributes.clicked_socialmedia":e.dataset["social-type"]})}))}))}bindFollowCountUpdates(){if(null===this.followingLink)return;const e=this.followingLink.querySelector("#follow_count_total"),t=this.followingLink.querySelector("#follow_count_online");Tt.im.listen((i=>{var s,n;const o=null!==(s=i.totalCount)&&void 0!==s?s:0,r=null!==(n=i.onlineCount)&&void 0!==n?n:0;o>0?(this.followingLink.style.display="block",t.textContent=`${r}`,e.textContent=`${o}`):this.followingLink.style.display="none"}))}bindRoomlistLinks(){this.element.querySelectorAll(".pushmenu-link.ts-roomlist-link a").forEach((e=>{e.addEventListener("click",(e=>{(0,v.eH)(e,(()=>{e.preventDefault(),this.onMenuClosed();const t=new URL(e.target.href);if((0,p.isMobileSpaShown)()){const e=(0,Pt.b)();e!==p.SortOption.Popular?t.searchParams.set("sort",e):t.searchParams.delete("sort")}p.UrlState.current.navigateTo(t.toString())}))}))}))}}function It(e){window.TS=e}class Et{constructor(e){this.parseContext(e),I.Bm.current=this.context,this.initI18n(),this.setupTwemojiBase(),this.init(),this.listenForOrientationChanges(),this.addErrorAttributes()}parseContext(e){var t,i,s,n,o,r,l,h,d,c,u;if(this.context={current_logo:e.current_logo,isMobile:e.is_mobile,sample_metrics_off:e.sample_metrics_off,qualityMessage:e.quality_message,loggedInUser:lt(e.logged_in_user),isAgeGated:e.user_age_gated,animateThumbnails:e.animate_thumbnails,socialAuths:at(e.social_auths),isBroadcast:!1,darkModeEnabled:e.dark_mode_enabled,themeName:e.theme_name,maxPmAge:e.chat_settings.max_pm_age,dmsEnabled:null!==(t=e.sitewide_pms_enabled)&&void 0!==t&&t,contextID:e.entrypoint_context_id,csrftoken:e.csrftoken,isLoadedFromCache:void 0,showPaxumNotice:null!==(i=e.show_paxum_notice)&&void 0!==i&&i,realtimeUserlistEnabled:!0===e.realtime_userlist_enabled,isInternal:e.INTERNAL,isDevstage:e.DEVSTAGE,pageLocation:null!==(s=e.pageLocation)&&void 0!==s?s:"homepage",PurchaseEventSources:e.PurchaseEventSources,languageCode:e.language_code,showLocation:null===(n=Boolean(e.showLocation))||void 0===n||n,showNpsSentimentSurveyGroup:null!==(o=e.show_nps_sentiment_survey_group)&&void 0!==o&&o,showBroadcasterAppSurvey:null!==(r=e.show_app_usage_survey)&&void 0!==r&&r,regions:null!==(l=e.regions)&&void 0!==l?l:"",isTestbed:null!==(h=e.isTestbed)&&void 0!==h&&h,noImage:null!==(d=e.noImage)&&void 0!==d&&d,throttleTopicPublish:!0===e.push_throttle_topic_publish,isNoninteractiveUser:!1,mergePmDm:e.merge_pm_dm,noAnalytics:e.no_analytics,showMobileSiteBannerLink:null!==(c=e.show_mobile_site_banner_link)&&void 0!==c&&c,removeMobileSubdomain:e.remove_mobile_subdomain,twemojiBase:null!==(u=e.twemoji_base)&&void 0!==u?u:""},ht.U.initialize(e),(0,je.Cx)(this.context.animateThumbnails),this.setUserInteractive(),(0,a.Pf)()){const e=window.localStorage.getItem("contextID");window.localStorage.setItem("contextID",this.context.contextID),this.context.isLoadedFromCache=e===this.context.contextID}}init(){window.setTimeout((()=>{(0,ue.gA)()||location.reload(),ue.g$.listen((()=>{location.reload()}))}),1728e5),this.roomReload=je.HA.exportToJS(),this.addPageAction=R.bT,this.showLoginOverlay=j.DC,this.context.isMobile?this.initMobile():this.initDesktop(),this.setCustomAttributes(),(0,pt.yL)(),(0,bt.If)(),(0,ne.w)(),(0,wt.et)(),this.setupConvivaEcoSensor(),function(){if(window.location.pathname.startsWith("/accounts/"))return;if(I.Bm.current.isAgeGated||void 0!==I.Bm.current.loggedInUser||I.Bm.current.isMobile)return;const e=(0,l.pH)(ut);(0,l.Yj)(ut),void 0!==e&&[0,1].includes(e)?1===e&&new ct({}).show():(0,l.Yj)("AG_Key")}(),(0,St.GC)(),this.context.isAgeGated&&function(){const e=document.querySelector("#age_gate_home"),t=document.querySelector("#ag_signup");if(null===e||null===t)return;const i=t.querySelector(".loading-msg"),s=t.querySelector("iframe");(0,m.wu)("load",s,(()=>{var e;null===(e=s.contentDocument)||void 0===e||e.querySelectorAll("a.medium_popup_link").forEach((e=>{e.onclick=t=>{t.preventDefault(),(0,ue.gr)(e.href,"_blank",ue.NL)}})),i.style.display="none",s.style.display="inline"})),(0,m.wu)("orientationchange",s,(()=>{var e;null===(e=s.contentWindow)||void 0===e||e.location.reload()}));const n=e.querySelector("a.age-gate-verify");(0,m.wu)("click",n,(()=>{var i;e.style.display="none",t.style.display="block",""===s.src&&(s.src=null!==(i=s.dataset.src)&&void 0!==i?i:"")}))}()}initMobile(){this.bindMobilePushMenu(),this.bindAdvancedSearchOptions(!0),this.bindPurchaseTokenLinks(),this.bindTokenCountUpdater(),this.setupEmoticonPreviewModal(!0),(0,b.uy)(),this.updateFlashMessageDisplay(),void 0!==this.context.loggedInUser&&this.setupLogoutModal()}initDesktop(){this.bindUserInfoPanelDropdown(),this.bindUserUpdatesPanel(!1),this.bindPurchaseTokenLinks(),this.context.isAgeGated||(this.bindDmListDropdown(!1),this.bindFollowedTab(),this.handlePmChatWindows()),this.setupEmoticonPreviewModal(!1),this.bindHeader(),this.bindFooter(),this.bindTokenCountUpdater(),(0,b.uy)(),void 0===this.context.loggedInUser&&(window.location.pathname!==b.ii&&this.setupLoginOverlay(),void 0!==(0,ft.JO)(window.location.search).join_overlay&&window.location.pathname!==b.k6&&this.setupJoinOverlay()),void 0!==this.context.loggedInUser&&this.setupLogoutModal(),this.setupUserFeedbackForm(),this.watchForAdIntervention(),this.openFeedbackForm=e=>{U.E.fire({source:e})}}initI18n(){(0,xt.u)(this.context.languageCode)}initRoom(){gt.T.getOrCreateInstance(),this.setupReactGenderIcons()}setupReactGenderIcons(){if((0,f.VY)()){const e=document.createElement("div");e.style.height="0",e.style.width="0",document.body.appendChild(e),new(G.c.get("GenderIconDefs"))({},e)}}setCustomAttributes(){(0,R.S_)("history_length",history.length.toString());const e=window.matchMedia("(display-mode: standalone)").matches;(0,R.S_)("is_using_pwa",e.toString())}addErrorAttributes(){void 0!==this.context.loggedInUser?((0,R.S_)("username",this.context.loggedInUser.username),(0,R.S_)("enduser.id",this.context.loggedInUser.userUid)):((0,R.S_)("username","__anon__"),(0,R.S_)("enduser.id","0")),(0,R.S_)("enduser.session",this.context.contextID),(0,R.S_)("revision","eb9d05f1341a"),(0,R.S_)("git_tag","v24.12.3.0")}setupJoinOverlay(){(0,vt.Vz)(),vt.WG.fire(void 0),this.addJoinOverlayListener(new vt.fS({}))}addJoinOverlayListener(e){let t;vt.CG.listen((i=>{void 0===t&&(t=e),window.scrollTo(0,0),t.initAndShow(i)}))}setupUserFeedbackForm(){U.E.listen((e=>{_.I.show(e)}))}setupLoginOverlay(){for(const e of document.querySelectorAll("a.login-link"))e.onclick=e=>{(0,j.DC)({}),e.preventDefault()}}setupLogoutModal(){if(document.querySelectorAll("a.logout-link").length>0){const e=document.createElement("form");e.method="post",e.action=(0,C._Y)("/auth/logout/"),e.target="_top",e.style.display="none";const t=document.createElement("input");t.type="hidden",t.name="csrfmiddlewaretoken",t.value=(0,l.I7)("csrftoken"),e.appendChild(t),document.body.appendChild(e);for(const i of document.querySelectorAll("a.logout-link"))i.onclick=i=>{i.preventDefault();const s=this.context.isAgeGated?Y.R.switchAccountModalText:Y.R.logoutModalText;(0,F.mf)(s,(()=>{t.value=(0,l.I7)("csrftoken"),e.submit()}))}}}listenForOrientationChanges(){if(!(0,yt.pu)())return;const e=()=>{yt.DQ.fire()};(0,yt.Vk)()?screen.orientation.addEventListener("change",e):(0,yt.FW)()&&(0,m.wu)("orientationchange",window,e)}bindUserInfoPanelDropdown(){return function(e,t,i,s){let n;return null!==e&&null!==t&&(n=new Ue(t,i,s),e.appendChild(n.element),n.repositionChildrenRecursive()),n}(document.querySelector("#userInfoPanelMenuDropdownRoot"),document.getElementById("user_information_profile_container"),void 0!==this.context.loggedInUser?this.context.loggedInUser.username:"",this.context.darkModeEnabled)}bindMobilePushMenu(){if((0,p.isMobileSpaShown)()){const e=document.getElementById("pushmenu-container"),t=document.getElementById("mmnav");null!==e&&null!==t&&new Rt(e,{menuButton:t})}else this.bindUserUpdatesPanel(!0),this.context.isAgeGated||this.bindDmListDropdown(!0),function(){const e=document.querySelector(".nav_list"),t=document.querySelector(".push-overlay");null!==t&&null!==e&&((0,m.wu)("click",e,(()=>{ae.nD.fire(!0)})),(0,m.wu)("click",t,(()=>{ae.nD.fire(!1)})),ae.bW.listen((i=>{i&&!(0,ce.Ic)()?e.click():!i&&(0,ce.Ic)()&&t.click()})))}(),Ne()}bindUserUpdatesPanel(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _e(document.querySelector("#userUpdatesBellRoot"),document.querySelector("#userUpdatesMenuDropdownRoot"),e,document.querySelector("#mmnav"))}bindDmListDropdown(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=document.querySelector("#userUpdatesBellRoot"),i=document.querySelector("#dmListDropdownRoot"),s=document.querySelector("#dmListIconRoot"),n=document.querySelector("#mmnav");if(!e)return function(e,t){let i;return null!==e&&null!==t&&(i=new ve({toggleElement:e}),i.element.dataset.testid="dm-convo-list",t.appendChild(i.element)),i}(s,i);Fe(s,t,n,i)}bindPurchaseTokenLinks(){for(const e of document.querySelectorAll(".purchase_tokens a, a.purchase_tokens, a#purchase_tokens"))void 0!==this.context.loggedInUser?(0,pt.HH)(e):e.onclick=e=>{(0,j.DC)({}),e.preventDefault()}}watchForAdIntervention(){if(!window.hasOwnProperty("ReportingObserver"))return;const e=e=>{for(const t of e)"intervention"===t.type&&(0,R.bT)("AdIntervention",{report:JSON.stringify(t.body)})},t=new window.ReportingObserver(((t,i)=>{e(t)}),{buffered:!0});t.observe(),(0,m.wu)("beforeunload",window,(i=>{const s=t.takeRecords();e(s)}))}bindFollowedTab(){const e=document.getElementById("followed_anchor");null!==e&&e instanceof HTMLAnchorElement&&(e.onclick=e=>{e.ctrlKey||e.metaKey||e.preventDefault()},new rt(e,void 0!==this.context.loggedInUser?this.context.loggedInUser.username:""))}bindHeader(){const e=document.querySelector("#header");if(null!==e&&e instanceof HTMLElement)return new D(e)}bindFooter(){const e=document.querySelector(".footer-holder");if(null!==e&&e instanceof HTMLElement)return new k(e)}handlePmChatWindows(){const e=window.location.pathname.startsWith("/staff_tools"),t=document.getElementById("header");var i;null===t||null===t.offsetParent||e||(!0===(null===(i=this.context.loggedInUser)||void 0===i?void 0:i.isStaff)||void 0!==this.context.loggedInUser&&(0,c.SU)())&&(0,B.Z4)(this.context.loggedInUser.username)}setupEmoticonPreviewModal(){let e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];mt.pp.listen((i=>{void 0===e&&(e=t?new mt.Gj:new mt.Yn),e.initAndShow(i)}))}setupTwemojiBase(){h.A.base=this.context.twemojiBase}bindAdvancedSearchOptions(e){if(!(0,p.isMobileSpaShown)())return new d.ZB(e)}bindTokenCountUpdater(){var e;const t=null===(e=I.Bm.current.loggedInUser)||void 0===e?void 0:e.userUid;void 0!==t&&new q.nH(t).onMessage.listen((e=>{u.D.fire(e)})),u.D.listen((e=>{(0,pt.hw)(e.tokens)}))}updateFlashMessageDisplay(){const e=document.querySelector(".flash-message-container");null!==e&&0===e.querySelectorAll(".message p").length&&(e.style.display="none")}setUserInteractive(){var e;this.context.isInternal&&!0===(null===(e=this.context.loggedInUser)||void 0===e?void 0:e.isStaff)&&!this.context.isDevstage&&(this.context.isNoninteractiveUser=!0)}setupConvivaEcoSensor(){if((0,Ct.kt)()){let e="11bbd19872403a8c17a3c4a24fe2b5501f6831b9";I.Bm.current.isInternal&&(e="224075d7f3c1654ccd30d05396d7b47e49dd6da3"),(0,s.convivaAppTracker)({appId:"Multi Media Web",convivaCustomerKey:e,contexts:{performanceTiming:!0},plugins:[(0,r.PerformanceTimingPlugin)(),(0,o.ErrorTrackingPlugin)(),(0,n.LinkClickTrackingPlugin)()]}),I.Bm.current.loggedInUser?(0,s.setUserId)(I.Bm.current.loggedInUser.userUid):(0,s.setUserId)("anon"),(0,s.trackPageView)(),(0,n.enableLinkClickTracking)(),(0,n.enableButtonClickTracking)(),(0,o.enableErrorTracking)()}}}It(Et)},5132:(e,t,i)=>{"use strict";(0,i(7269).n)()},8638:(e,t,i)=>{"use strict";i.d(t,{i:()=>s,u:()=>n});const s=(0,i(2246).sK)({productionCompileEnabled:!0});function n(e){if(void 0===window.i18njs)throw new Error("window.linguijs is undefined");s.load(e,window.i18njs.messages),s.activate(e)}},4777:()=>{"use strict";window.PRODUCTION=!0,window.CHATURBATE_URL_PREFIX="/",window.STATIC_URL_ROOT="https://web.static.mmcdn.com/",window.STATIC_URL_MOBILE="https://web.static.mmcdn.com/mobileassets/",window.STATIC_URL="https://web.static.mmcdn.com/tsdefaultassets/"},2021:(e,t,i)=>{var s=i(9259);window.debug=s.debug,window.info=s.info,window.warn=s.warn,window.error=s.error},6624:e=>{"use strict";var t,i,s,n=Object.create,o=Object.defineProperty,r=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,l=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty,d=(e,t,i,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of a(t))!h.call(e,n)&&n!==i&&o(e,n,{get:()=>t[n],enumerable:!(s=r(t,n))||s.enumerable});return e},c=(e,t,i)=>(i=null!=e?n(l(e)):{},d(!t&&e&&e.__esModule?i:o(i,"default",{value:e,enumerable:!0}),e)),u=(t=e=>{var t,i,s;function n(e){switch(e){case t.All:case t.Male:case t.Female:case t.Couple:case t.Trans:return e;case t.OldTrans:case s.Transfemme:case s.Transmasc:case s.Nonbinary:return t.Trans;default:return t.All}}Object.defineProperty(e,"__esModule",{value:!0}),e.GenderNameToSymbolMap=e.GendersSymbolToNameMap=e.Subgender=e.Gender=void 0,e.parseSimpleGender=n,e.getCurrentGender=function(i){var s,o,r,a;let l=null!==(s=null==i?void 0:i.pathname)&&void 0!==s?s:window.location.pathname;l.endsWith("/")||(l+="/");let h=l.split("/");if(4===h.length&&"tag"===h[1]||3===h.length&&e.GenderNameToSymbolMap.has(h[1]))return t.All;let d=null!==(o=h[h.length-2])&&void 0!==o?o:"",c=d.endsWith("-cams")?d.slice(0,-5):d,u=null!==(r=e.GenderNameToSymbolMap.get(c))&&void 0!==r?r:n(c);if(u!==t.All)return u;let p=null!==(a=null==i?void 0:i.searchParams)&&void 0!==a?a:new URLSearchParams(window.location.search);for(let e of["gender","genders","g"]){let t=p.get(e);if(null!==t)return n(t.split(",")[0])}return t.All},(i=t||(e.Gender=t={})).All="",i.Male="m",i.Female="f",i.Couple="c",i.Trans="t",i.OldTrans="s",function(e){e.Transfemme="tf",e.Transmasc="tm",e.Nonbinary="tn"}(s||(e.Subgender=s={})),e.GendersSymbolToNameMap=new Map([[t.All,""],[t.Male,"male"],[t.Female,"female"],[t.Couple,"couple"],[t.Trans,"trans"],[t.OldTrans,"trans"]]),e.GenderNameToSymbolMap=new Map,e.GendersSymbolToNameMap.forEach(((t,i)=>e.GenderNameToSymbolMap.set(t,i))),e.GenderNameToSymbolMap.set("trans",t.Trans)},()=>(i||t((i={exports:{}}).exports),i.exports)),p={};((e,t)=>{for(var i in t)o(e,i,{get:t[i],enumerable:!0})})(p,{AGE_FILTER_KEY:()=>ae,AGE_URL_PARAM_REGEX:()=>ne,ALL:()=>Ae,ALL_NO_PAGE:()=>Me,AgeCategoryToFilterRange:()=>z,AllCamCategoriesToFilterKeys:()=>$,AllRegionValues:()=>ee,CamTypeCategoryToFilterKey:()=>O,CamTypeKeyToCategory:()=>W,DEFAULT_MAX_AGE:()=>re,DEFAULT_MIN_AGE:()=>oe,DEFAULT_PAGESIZE:()=>L,FILTER_PANEL_KEYS:()=>Ee,FILTER_PANEL_OPEN_CACHE_KEY:()=>we,FILTER_PANEL_SELECTED_PARAMS_CACHE_KEY:()=>ve,FILTER_PANEL_STATE_CACHE_KEY:()=>fe,FOLLOW_RECOMMENDATIONS_API_URL:()=>U,FOLLOW_RECOMMENDATIONS_PAGE_SIZE:()=>D,HOMEPAGE_KEYS:()=>Re,HOMEPAGE_KEYS_NO_PAGE:()=>Ie,HomepagePathFilterPaths:()=>te,KEYWORDS_LENGTH_LIMIT:()=>be,LegacyAgeCategoryToFilterRange:()=>G,MAX_PAGE_ALLOWED:()=>_,MINIMUM_SEARCH_LENGTH:()=>Ce,N_DAYS_HOMEPAGE_FILTERS_CACHE_EXP:()=>ye,NonCategoryPageCamTypesToFilterKey:()=>H,PRIVATE_PRICES_FILTER_KEY:()=>pe,PageType:()=>N,PrivatePriceCategoryToFilterValues:()=>J,PrivatePriceToTokenPricepoints:()=>Z,PrivatePrices:()=>q,QueryParams:()=>de,REGION_FILTER_KEY:()=>me,ROOMLIST_API_URL:()=>B,ROOM_SIZE_FILTER_KEY:()=>ce,Region:()=>Y,RegionCategoryToFilterValue:()=>Q,RegionKeyToCategory:()=>X,RoomSize:()=>le,SORT_SUPPORTED_KEYS:()=>Le,SPOKEN_LANGUAGE_FILTER_KEY:()=>Ke,ShowType:()=>F,SortOption:()=>he,SpyPriceToTokenPricepoints:()=>K,SpyShowPrices:()=>j,TAGS_FILTER_KEY:()=>ue,TAG_FILTER_KEY:()=>ge,UrlState:()=>wt,UrlStateBase:()=>De,applyStickyHomepageFiltersToState:()=>Et,cleanSearchKeyword:()=>ft,clearStickyFilters:()=>It,extractKeywords:()=>rt,getAPIParamsFromURLState:()=>Oe,getActiveKeys:()=>Be,getCachedFilterQueryParams:()=>it,getCachedHmpgFiltersUrl:()=>st,getCachedTagFiltersUrl:()=>Xe,getCamTypeFilter:()=>Ne,getCategorySlug:()=>ct,getCleanedPathname:()=>dt,getCurrentPage:()=>at,getCurrentSort:()=>lt,getFilterPanelOpenCached:()=>At,getFilterPanelPartialState:()=>Tt,getKeywordsFromCurrentURL:()=>ot,getNonReservedQueryParamValues:()=>Fe,getPageHashtag:()=>et,getPaginationAPIParams:()=>ht,getParamNextIn:()=>Ze,getParamsMinMaxAgeFilter:()=>$e,getParamsPrivatePriceFilters:()=>ze,getParamsRegionFilters:()=>Ve,getParamsRoomSizeFilter:()=>je,getParamsSpokenLanguagesFilter:()=>Je,getParamsSpyPriceFilters:()=>Ge,getParamsTags:()=>qe,getPrivateTokenPricepointsFromFilterValue:()=>He,getRegionCategoryFilter:()=>Ye,getSavedStickyFiltersState:()=>Mt,getSpyTokenPricepointsFromFilterValue:()=>We,getTagQueryParam:()=>Qe,getVerboseGenderPath:()=>vt,hashtagPathname:()=>tt,homepageFiltersCurrentlyApplied:()=>kt,isFilterInPathActive:()=>A,isFollowedCams:()=>ut,isHomepageTab:()=>gt,isLanguageFilterActive:()=>P,isMobileFilterPanelActive:()=>I,isMobileSpaActive:()=>R,isMobileSpaShown:()=>St,isOfflineFollowed:()=>pt,isPremium:()=>mt,isRoomRoomlistSpaActive:()=>k,isRoomSizeFilteringActive:()=>T,isSpyPriceFiltersActive:()=>M,isStateOnlyUsingSortSupportedKeys:()=>Ue,saveStickyFilters:()=>Rt,shouldShowHomepageFilters:()=>Pt,updateHmpgFiltUrlFromCache:()=>xt}),e.exports=(e=>d(o({},"__esModule",{value:!0}),e))(p);try{s=!0}catch(t){console.error("@multimediallc/logging failed to initialize, probably due to undefined process.env.NODE_ENV.",t),s=!0}var m=window.newrelic;function g(){s||void 0!==window.console&&void 0!==console.trace&&console.trace()}function v(e,t,i={}){try{if(void 0===m)return;let s={};if(s["attributes.level"]=e,"object"==typeof i)for(let e in i)if("xhrErrorAttributes"!==e)s[`attributes.${e}`]=i[e];else{let t=i[e];s["attributes.xhrError"]=!0,s["attributes.xhrState"]=t.readyState,s["attributes.xhrStatus"]=t.status,s["attributes.xhrReason"]=t.reason}else s["attributes.extra"]=i;m.noticeError(t,s)}catch(e){console.error(`New Relic Error in reportError: ${e}`)}}function f(e){return void 0===e?"":e}var y=window.newrelic;var b={},w=class{constructor(e){this.active=!1,this.eligible=!1,this.name=e;let t=window.experiments;if(void 0!==t){let i=new RegExp(`\\b${e}\\b`),s=t.active;this.active=void 0!==s&&i.test(s);let n=t.eligible;this.eligible=void 0!==n&&i.test(n)}}record(){this.eligible&&!b[this.name]&&(function(e,t={}){try{if(void 0===y)return void function(e,t){s||void 0!==window.console&&(void 0!==console.debug||s?console.debug(e,f(t)):console.log("DEBUG ",e,f(t)))}(`New Relic is disabled, not sending metric: ${e}`);0===Object.keys(t).length?y.addPageAction(e):y.addPageAction(e,t)}catch(e){!function(e,t,i=""){let n;void 0!==window.console&&(void 0!==console.error||s?console.error(i.concat("ERROR "),e,f(t)):console.log(i.concat("ERROR "),e,f(t)),g());try{n="object"==typeof e?JSON.stringify(e):String(e)}catch{n=`${e}`}v(i.concat("ERROR"),new Error(n),t)}(`New Relic Error in addPageAction: ${e}`)}}("ExperimentEntered",{experimentName:this.name,experimentGroup:this.active?"active":"inactive",experimentTreatment:this.active?this.name:"control"}),b[this.name]=!0)}};function C(e){return new RegExp(`\\b${e}\\b`).test(window.active_perform_toggles)}var S,x,T=()=>new w("RmSzHldt").active,P=()=>C("SpkLngFlt")||C("SpkLngFltAn"),k=()=>C("RmRmlstSpa"),A=()=>new RegExp("\\bFltInPath\\b").test(window.active_feature_flags),M=()=>A()&&C("SpyPrFlt"),R=()=>C("MblRmlstSpa")&&!0===window.isMobile,I=()=>C("MblFltPnl"),E=c(u()),L=90,D=15,B="api/ts/roomlist/room-list/",U="api/ts/roomlist/rec-follow-room-list/",_=1e4,F=((x=F||{}).NEW_CAMS="new_cams",x.GAMING="gaming",x.EXHIB="exhib",x.HIDDEN="hidden",x.PRIVATE="private",x.FOLLOW="follow",x.FOLLOW_OFFLINE="offline",x),N=((S=N||{}).HOME="home",S.TAGS="tags",S.DISCOVER="discover",S.ROOM="room",S),O=new Map([["exhibitionist-cams","exhib"],["new-cams","new_cams"],["gaming-cams","gaming"]]),H=new Map([["spy-on-cams","private"],["followed-cams","follow"],["hidden-cams","hidden"]]),W=new Map,$=new Map([...O,...H]);$.forEach(((e,t)=>W.set(e,t))),W.set("offline","followed-cams/offline");var V,z=new Map([["teen-cams",[18,20]],["18to21-cams",[18,22]],["20to30-cams",[20,31]],["30to50-cams",[30,51]],["mature-cams",[50,100]]]),G=new Map([["18to20-cams",[18,21]],["21to35-cams",[21,36]]]),q=((V=q||{}).Value6="6",V.Range12to18="12-18",V.Range30to42="30-42",V.Range60to72="60-72",V.Range90Plus="90",V),j=(e=>(e.Value6="6",e.Range12to18="12-18",e.Range30to42="30-42",e.Range54to66="54-66",e.Range90Plus="90",e))(j||{}),Z=new Map([["6",[6]],["12-18",[12,18]],["30-42",[30,42]],["60-72",[60,72]],["90",[90,120,150,180,240,360,480,720,960,1200,1440,1920]]]),K=new Map([["6",[6]],["12-18",[12,18]],["30-42",[30,42]],["54-66",[54,66]],["90",[90,120,150,180,240,360]]]),J=new Map([["6-tokens-per-minute-private-cams","6"],["12-18-tokens-per-minute-private-cams","12-18"],["30-42-tokens-per-minute-private-cams","30-42"],["60-72-tokens-per-minute-private-cams","60-72"],["90-tokens-per-minute-private-cams","90"]]),Y=(e=>(e.NorthAmerica="NA",e.SouthAmerica="SA",e.Asia="AS",e.EuropeRussia="ER",e.Other="O",e))(Y||{}),Q=new Map([["north-american-cams","NA"],["south-american-cams","SA"],["asian-cams","AS"],["euro-russian-cams","ER"],["other-region-cams","O"]]),X=new Map;Q.forEach(((e,t)=>X.set(e,t)));var ee=["NA","SA","AS","ER","O"],te=new Map([...E.GenderNameToSymbolMap].filter((e=>e[1]!==E.Gender.All)).map((([e,t])=>[`${e}-cams`,t])));["","top","accounts/welcome"].forEach((e=>te.set(e,E.Gender.All)));var ie,se,ne=/^\d{2}-(\d{2}|100)$/g,oe=18,re=100,ae="ages",le=((se=le||{}).SMALL="sm",se.MEDIUM="md",se.LARGE="lg",se),he=(e=>(e.Popular="",e.Viewers="rv",e.Random="rand",e))(he||{}),de=((ie=de||{}).regions="regions",ie.ages="ages",ie.private_prices="private_prices",ie.tags="tag",ie.room_size="room_size",ie.spoken_languages="spoken_languages",ie.spy_prices="spy_prices",ie.keywords="keywords",ie.gender="gender",ie.page="page",ie.pageb="pageb",ie.next_in="next_in",ie.sort="sort",ie),ce="room_size",ue="tag",pe="private_prices",me="regions",ge="tag",ve="hmpgFiltAllParams",fe="fltStateKey",ye={days:7},be=250,we="hpfltopen",Ce=2,Se=c(u()),xe=new Map([["en","English"],["id","Bahasa Indonesia"],["ms","Bahasa Melayu (Malay)"],["ca","Català (Catalan)"],["da","Dansk (Danish)"],["de","Deutsch (German)"],["es","Español (Spanish)"],["fr","Français (French)"],["it","Italiano (Italian)"],["hu","Magyar (Hungarian)"],["nl","Nederlands (Dutch)"],["no","Norsk (Norwegian)"],["pl","Polski (Polish)"],["pt","Português (Portuguese)"],["ro","Română (Romanian)"],["sk","Slovenčina (Slovak)"],["fi","Suomi (Finnish)"],["sv","Svenska (Swedish)"],["tl","Tagalog"],["vi","Tiếng Việt (Vietnamese)"],["tr","Türkçe (Turkish)"],["cs","Čeština (Czech)"],["el","Ελληνικά (Greek)"],["bg","Български (Bulgarian)"],["ru","Русский (Russian)"],["uk","Українська (Ukrainian)"],["ar","العربية (Arabic)"],["hi","मानक हिन्दी (Hindi)"],["th","ภาษาไทย (Thai)"],["zh","中文 (Chinese)"],["ja","日本語 (Japanese)"],["ko","한국어 (Korean)"]]),Te=(e,t)=>{try{let i=JSON.parse(e);return(e=>"object"==typeof e&&void 0!==e.expiration&&"number"==typeof e.expiration)(i)?i.expiration<(new Date).getTime()?void t():i:void t()}catch{return}};function Pe(e){var t;let i=window.localStorage.getItem(e);return null===i||null===(t=Te(i,(()=>window.localStorage.removeItem(e))))||void 0===t?void 0:t.value}var ke=c(u()),Ae=["genders","regions","tags","ageMin","ageMax","privatePrices","spyShowPrices","roomSize","spokenLanguages","apps","aspApp","keywords","showType","page","pageb","room","pageType","sort"],Me=Ae.filter((e=>"page"!==e&&"pageb"!==e)),Re=Ae.filter((e=>"room"!==e&&"pageType"!==e)),Ie=Re.filter((e=>"page"!==e&&"pageb"!==e)),Ee=new Set(["regions","ageMin","ageMax","privatePrices","spyShowPrices","spokenLanguages","tags","roomSize"]),Le=new Set(["sort","pageType","genders","page","pageb"]),De=class{constructor(){this.pathMap=function(){let e=new Map;e.set("tags",(()=>({pageType:"tags"}))),e.set("discover",(()=>({pageType:"discover"})));for(let[t,i]of Q.entries())e.set(`${t}`,(()=>({pageType:"home",regions:[i]})));for(let[t,i]of z.entries())e.set(`${t}`,(()=>({pageType:"home",ageMin:i[0],ageMax:i[1]})));for(let[t,i]of G.entries())e.set(`${t}`,(()=>({pageType:"home",ageMin:i[0],ageMax:i[1]})));for(let[t,i]of J.entries())e.set(`${t}`,(()=>({pageType:"home",privatePrices:[i]})));for(let[t,i]of $.entries())e.set(`${t}`,(()=>({pageType:"home",showType:i})));for(let[t,i]of te.entries())e.set(`${t}`,(()=>i!==ke.Gender.All?{pageType:"home",genders:[i]}:{pageType:"home"}));return e}()}readStateFromURL(e){let t=this.handlePath(e);t=this.handleQueryParams(t,e);let i=(0,ke.getCurrentGender)(e);return i!==ke.Gender.All&&"offline"!==t.showType&&(t.genders=[i]),t}handlePath(e){var t,i;let s={pageType:"home"},n=e.pathname.slice(1),o=n.split("/"),r=null!=(t=o[0])?t:"";if("followed-cams"===r)"offline"===o[1]?s.showType="offline":s.showType="follow";else if("tag"===r)s={pageType:"home",tags:[o[1].toLowerCase()]};else if("current_app_use"===r)s={pageType:"home",apps:[o[1]]};else if("app"===r)s={pageType:"home",aspApp:o[1]};else{let e=null!=(i=this.pathMap.get(r))?i:this.pathMap.get(n.replace(/\/$/,""));s=void 0!==e&&"function"==typeof e?{...e()}:{pageType:"room",room:r}}return s}handleQueryParams(e,t){if("room"===e.pageType)t.searchParams.has("next_in")&&(e.nextIn=Ze(t.searchParams));else{let i=at("page",t);i>1&&(e.page=i);let s=at("pageb",t);if(s>1&&(e.pageb=s),this.assignSortToState(e,t),"offline"!==e.showType){let i=t.searchParams.get("keywords");if(null!==i&&i.length>0)if(A()){let t=ft(i);""!==t&&(e.keywords=t)}else e.keywords=i;this.appendFilterPanelUrlParams(e,t)}}return e}assignSortToState(e,t){if(R()){let i=lt(t);""!==i&&(e.sort=i)}}appendFilterPanelUrlParams(e,t){var i,s,n,o;let r=qe(t);void 0!==r&&(e.tags=(null!=(i=e.tags)?i:[]).concat(null!=r?r:[]));let a=Ve(t);void 0!==a&&(e.regions=(null!=(s=e.regions)?s:[]).concat(a.split(",")));let l=$e(t);void 0!==l&&(l[0]!==oe&&(e.ageMin=l[0]),l[1]!==re&&(e.ageMax=l[1]));let h=ze(t);void 0!==h&&(e.privatePrices=(null!=(n=e.privatePrices)?n:[]).concat(h));let d=Ge(t);if(void 0!==d&&(e.spyShowPrices=(null!=(o=e.spyShowPrices)?o:[]).concat(d)),T()){let i=je(t);void 0!==i&&(e.roomSize=i)}if(P()){let i=Je(t);void 0!==i&&(e.spokenLanguages=i)}}},Be=e=>Object.entries(e).filter((([,e])=>Array.isArray(e)?e.length>0:void 0!==e)).map((([e])=>e)),Ue=e=>Be(e).every((e=>Le.has(e))),_e=["offset","limit","genders","regions","hashtags","from_age","to_age","private_prices","spy_show_prices","room_size","spoken_languages","apps","asp_app","keywords","exhib","new_cams","gaming","hidden","private","follow","sort","after"];function Fe(){let e=new URLSearchParams(window.location.search);return _e.forEach((t=>e.delete(t))),e.delete("g"),e.delete("page"),e.delete("pageb"),Object.fromEntries(e)}function Ne(){let e=ct();return $.get(e)}function Oe(e,t){let i=A()?ht(e.page):{...t,...ht(e.page)};return void 0!==e.keywords&&(i.keywords=e.keywords),void 0!==e.tags&&(i.hashtags=e.tags.join(",")),void 0!==e.ageMin&&(i.from_age=e.ageMin),void 0!==e.ageMax&&(i.to_age=e.ageMax),void 0!==e.genders&&(i.genders=e.genders.join(",")),void 0!==e.apps&&(i.apps=e.apps.join(",")),void 0!==e.aspApp&&(i.asp_app=e.aspApp),void 0!==e.privatePrices&&("private"!==e.showType||!M())&&(i.private_prices=He(e.privatePrices)),void 0!==e.spyShowPrices&&("private"===e.showType||!M())&&(i.spy_show_prices=We(e.spyShowPrices)),void 0!==e.regions&&(i.regions=e.regions.join(",")),void 0!==e.roomSize&&(i.room_size=e.roomSize),void 0!==e.spokenLanguages&&(i.spoken_languages=e.spokenLanguages),void 0!==e.showType&&(i[e.showType]=!0,"offline"===e.showType&&(i.follow=!0)),Ue(e)&&void 0!==e.sort&&""!==e.sort&&(i.sort=e.sort),i}function He(e){let t=[];for(let i of e){let e=Z.get(i);void 0!==e&&t.push(...e)}if(t.length>0)return t}function We(e){let t=[];for(let i of e){let e=K.get(i);void 0!==e&&t.push(...e)}if(t.length>0)return t}function $e(e){let t=void 0!==e?e.search:window.location.search,i=new URLSearchParams(t).get(ae);if(null!==i){let e=i.match(ne);if(null!==e){let t=e=>isNaN(e)||e<oe||e>re,i=e[0].split("-"),s=parseInt(i[0]),n=parseInt(i[1]);if(t(s)||t(n)||s===oe&&n===re)return;if(s<=n)return[s,n+1]}}}function Ve(e){let t=void 0!==e?e.search:window.location.search,i=new URLSearchParams(t).get(me);if(null!==i){let e=i.split(","),t=[];for(let i of e){if(!ee.includes(i))return;t.push(i)}if(t.length>0)return t.join(",")}}function ze(e){let t=void 0!==e?e.search:window.location.search,i=new URLSearchParams(t).get(pe),s=Object.values(q);if(null!==i){let e=i.split(",").filter((e=>s.includes(e))).map((e=>e));if(e.length>0)return e}}function Ge(e){let t=void 0!==e?e.search:window.location.search,i=new URLSearchParams(t).get("spy_prices"),s=Object.values(j);if(null!==i){let e=i.split(",").filter((e=>s.includes(e))).map((e=>e));if(e.length>0)return e}}function qe(e){let t=void 0!==e?e.search:window.location.search,i=new URLSearchParams(t).get(ue);return null===i||""===i?void 0:i.split(",")}function je(e){let t=void 0!==e?e.search:window.location.search,i=new URLSearchParams(t).get(ce);if(null!==i&&Object.values(le).includes(i))return i}function Ze(e){let t=e.get("next_in");if(null!==t){let e=parseInt(t);if(!isNaN(e)&&isFinite(e)&&e>0)return e}}var Ke="spoken_languages";function Je(e){var t,i;let s=null!=(t=null==e?void 0:e.search)?t:window.location.search,n=null==(i=new URLSearchParams(s).get(Ke))?void 0:i.split(",").filter((e=>xe.has(e)));return n&&n.length>0?n:void 0}function Ye(){let e=ct();return Q.get(e)}function Qe(e){let t=new URLSearchParams(void 0===e?window.location.search:e.search).get(ge);return null===t?void 0:t}function Xe(e){void 0===e&&(e=new URL(window.location.href));let t=Qe(e);if(void 0===t)return e;let i=tt(t,(0,Se.getCurrentGender)(e)),s=new URLSearchParams(e.search);return s.delete(ge),s.sort(),e.search=s.toString(),e.pathname=i,e}function et(e=!1){let t=dt().split("/");if("tag"!==t[0]){let t=Qe();return e&&t?t:void 0}return t[1].toLowerCase()}function tt(e,t){return e?t===Se.Gender.All?`/tag/${e}/`:`/tag/${e}/${Se.GendersSymbolToNameMap.get(t)}/`:""}function it(){let e;if(void 0!==window.sessionStorage&&null!==window.sessionStorage.getItem(ve)?e=window.sessionStorage.getItem(ve):void 0!==window.localStorage&&null!==window.localStorage.getItem(ve)&&(e=Pe(ve)),""!==e&&null!=e)return e}function st(e){void 0===e&&(e=new URL(window.location.href));let t=it();if(void 0===t)return e;let i=new URLSearchParams(e.search),s=new URLSearchParams(t);for(let[e,t]of s)i.set(e,t);return i.sort(),e.search=i.toString(),Xe(e)}var nt=/[^a-zA-Z0-9_\-]+/g;function ot(){return new URLSearchParams(window.location.search).get("keywords")}function rt(e){var t;void 0===e&&(e=null!=(t=ot())?t:"");let i=et(!0),s=[],n=[];return e.split(" ").forEach((e=>{let t=e.startsWith("#");!((e=e.replace(nt,"")).length<=0)&&(t?e!==i&&n.push(e):s.push(e))})),[s,n]}function at(e,t){e=null!=e?e:"page";let i=void 0!==t?t.search:window.location.search,s=new URLSearchParams(i).get(e);if(null!==s){let e=parseInt(s);if(!isNaN(e))return Math.min(Math.max(e,1),_)}return 1}function lt(e){let t=void 0!==e?e.search:window.location.search,i=new URLSearchParams(t).get("sort");return null!==i&&Object.values(he).includes(i)?i:""}function ht(e,t){return{offset:((e=null!=e?e:1)-1)*(t=null!=t?t:L),limit:t}}function dt(e){let t=null!=e?e:window.location.pathname;return t.match(/^\/\w{2}\//)?t=t.slice(4):t.startsWith("/")&&(t=t.slice(1)),t.endsWith("/")&&(t=t.slice(0,-1)),t}function ct(e){var t;return null!=(t=dt(e).split("/")[0])?t:""}function ut(e){return"followed-cams"===ct(e)}function pt(){var e;let t=null!=(e=dt().split("/")[1])?e:"";return ut()&&"offline"===t}function mt(){return"spy-on-cams"===ct()}function gt(e){let t=dt(e);return[...te.keys()].includes(t)}function vt(e){switch(e){case Se.Gender.Female:return"female-cams";case Se.Gender.Male:return"male-cams";case Se.Gender.Couple:return"couple-cams";case Se.Gender.Trans:case Se.Gender.OldTrans:return"trans-cams";default:return""}}function ft(e){let t=[],i=new RegExp(/[a-zA-Z0-9_#\-\s]+/g),s=e.match(i),n=!1;if(null!==s){let e=s.join("").split(" ").filter((e=>e.length>0));for(let i of e){let e=i.startsWith("#")?"#":"",s=i.replace(/#/g,""),o=s.length>0?`${e}${s}`:"";t.push(o),s.length>=Ce&&(n=!0)}}return n?t.join(" ").trim():""}var yt=c(u()),bt=class{constructor(){this.listeners=new Map,this.recentlyAddedListeners=new Map,this.startGarbageCollectionOnDetachedElements()}moveRecentListenersToMainListeners(){var e;for(let[t,i]of this.recentlyAddedListeners)this.listeners.has(t)||this.listeners.set(t,[]),null==(e=this.listeners.get(t))||e.push(...i),this.recentlyAddedListeners.delete(t)}startGarbageCollectionOnDetachedElements(){window.setInterval((()=>{for(let[e]of this.listeners)this.cleanupDetachedListeners(e);this.moveRecentListenersToMainListeners()}),1e4)}listen(e,t,i){var s;for(let n of e)this.recentlyAddedListeners.has(n)||this.recentlyAddedListeners.set(n,[]),null==(s=this.recentlyAddedListeners.get(n))||s.push([t,i])}fireListenersByMap(e,t,i,s){let n=e.map((e=>{var t;return null!=(t=s.get(e))?t:[]})).flat(),o=new Map(n);for(let[e,s]of o.entries())s.isConnected&&e.call(s,t,i)}fireKeyListeners(e,t,i){this.fireListenersByMap(e,t,i,this.listeners),this.fireListenersByMap(e,t,i,this.recentlyAddedListeners)}cleanupDetachedListeners(e){var t,i;let n=null!=(t=this.listeners.get(e))?t:[],o=n.length-1;for(;o>=0;)n[o][1].isConnected||n.splice(o,1),o-=1;0===n.length&&this.listeners.delete(e),(null!=(i=this.listenersSize(e))?i:0)>300&&function(e,t,i=""){let n;void 0!==window.console&&(void 0!==console.warn||s?console.warn(i.concat("WARN "),e,f(t)):console.log(i.concat("WARN "),e,f(t)),g());try{n="object"==typeof e?JSON.stringify(e):String(e)}catch{n=`${e}`}v(i.concat("WARN"),new Error(n),t)}(`URLState has too many listeners for key ${e}`)}listenersSize(e){var t,i,s,n;return(void 0===e?this.listeners.size:null!=(i=null==(t=this.listeners.get(e))?void 0:t.length)?i:0)+(void 0===e?this.recentlyAddedListeners.size:null!=(n=null==(s=this.recentlyAddedListeners.get(e))?void 0:s.length)?n:0)}},wt=class e extends De{constructor(){super(),this.urlStateListeners=new bt,addEventListener("popstate",(()=>{this.applyUrlOrState(window.location.href)})),this.applyUrlOrState(window.location.href,!0,!0)}static get current(){return void 0===window.urlState&&(window.urlState=new e),window.urlState}syncStateWithCurrentUrl(){let e=new URL(window.location.href);this.applyUrlOrState(e)}replaceUrl(e){this.applyUrlOrState(e,!0)}pushUrl(e){this.applyUrlOrState(e,!1)}navigateTo(e,t=!1){this.applyUrlOrState(e,!1,t),window.scrollTo(0,0)}convertStateToUrl(e,t=!0){let i={...e};return Ue(i)||delete i.sort,`${window.location.origin}/${this.applyUrlPathFromState(i)}${this.getUrlParamsFromState(i,t)}`}getUrlParamsFromStateWithSearchParams(e,t){"home"===e.pageType?(Ct(e.tags)?t.delete("tag"):t.set("tag",e.tags.join(",")),Ct(e.regions)?t.delete("regions"):t.set("regions",e.regions.sort().join(",")),void 0===e.ageMin&&void 0===e.ageMax?t.delete("ages"):t.set("ages",this.getAgeUrlParam(e.ageMin,e.ageMax)),Ct(e.privatePrices)||"private"===e.showType?t.delete("private_prices"):t.set("private_prices",e.privatePrices.join(",")),Ct(e.spyShowPrices)||"private"!==e.showType?t.delete("spy_prices"):t.set("spy_prices",e.spyShowPrices.join(",")),void 0===e.roomSize?t.delete("room_size"):t.set("room_size",e.roomSize),Ct(e.spokenLanguages)?t.delete("spoken_languages"):t.set("spoken_languages",e.spokenLanguages.join(",")),Ct(e.genders)||"offline"===e.showType?t.delete("gender"):t.set("gender",e.genders.join(",")),void 0===e.keywords?t.delete("keywords"):t.set("keywords",e.keywords),void 0===e.page||1===e.page?t.delete("page"):t.set("page",String(e.page)),void 0===e.pageb||1===e.pageb?t.delete("pageb"):t.set("pageb",String(e.pageb)),void 0===e.sort||""===e.sort?t.delete("sort"):t.set("sort",e.sort)):"room"===e.pageType&&(void 0===e.nextIn?t.delete("next_in"):t.set("next_in",String(e.nextIn))),A()||t.sort();let i=t.toString().replace(/%2C/g,",");return i.length>0?`?${i}`:""}applyUrlPathFromState(e){var t,i,s,n,o,r;if("room"===e.pageType&&void 0!==e.room)return`${e.room}/`;let a;return a="tags"===e.pageType?"tags/":"discover"===e.pageType?"discover/":null!=(r=null!=(i=null!=(t=this.getAppPath(e))?t:this.getShowTypePath(e))?i:this.getTagPath(e))?r:A()&&null!=(o=null!=(n=null!=(s=this.getRegionPath(e))?s:this.getAgePath(e))?n:this.getPrivatePricePath(e))?o:"",this.appendGenderPath(a,e)}appendGenderPath(e,t){if(void 0===t.genders||0===t.genders.length||"offline"===t.showType)return e;let i=vt(t.genders[0]),s=yt.GendersSymbolToNameMap.get(t.genders[0]);return t.genders=t.genders.slice(1),""===i||void 0===s?e:""===e?`${i}/`:`${e}${s}/`}getUrlParamsFromState(e,t=!0){let i;if(t){i=new URLSearchParams(window.location.search);for(let e of Object.values(de))i.delete(e)}else i=new URLSearchParams;return this.getUrlParamsFromStateWithSearchParams(e,i)}getAgeUrlParam(e,t){return`${null!=e?e:oe}-${void 0===t?re:t-1}`}getURLForPartialState(e,t=!0){let i={...this.state,...e};return this.convertStateToUrl(i,t)}getURLFromPartialURL(e){let t=new URL(e),i=this.readStateFromURL(t);return this.convertStateToUrl({...this.state,...i})}setPartialState(e,t=!1){var i,s;let n={...this.state,...e};void 0!==e.page||void 0!==e.pageb||(n.page=null!=(i=e.page)?i:1,n.pageb=null!=(s=e.pageb)?s:1),this.setState(n,t)}clearStateKeys(e,t=!1){let i={...this.state};e.forEach((e=>{"pageType"===e?i.pageType="home":delete i[e]})),this.setState(i,t)}applyUrlOrState(t,i,s=!1){let n,o;t instanceof URL||"string"==typeof t?(o=new URL(t.toString().replace(/%2C/g,","),window.location.href),n=this.readStateFromURL(o),A()&&"home"===n.pageType&&void 0!==i&&(Et(n)||i)&&(o=new URL(this.convertStateToUrl(n)))):(n=t,e.setDefaultsToUndefined(n),o=new URL(this.convertStateToUrl(n).replace(/%2C/g,","))),Ue(n)||(delete n.sort,o.searchParams.delete("sort")),void 0!==i&&o.toString()!==window.location.href&&this.addToHistory(o,i);let r={...this.state};this.state=n,this.fireChangeListeners({...this.state},r),A()&&"home"===n.pageType&&!s&&this.areFiltersChanged(n,r)&&Rt(n)}addToHistory(e,t){t?window.history.replaceState(void 0,"",e):window.history.pushState(void 0,"",e)}setState(e,t=!1){this.applyUrlOrState(e,t)}listen(e,t,i){this.urlStateListeners.listen(e,t,i)}listenGlobal(e,t){this.urlStateListeners.listen(e,t,document)}fireChangeListeners(t,i){let s=e.getChangedKeys(t,i);s.includes("room")?s=s.filter((e=>["room","pageType"].includes(e))):0===s.length&&(s=Object.keys(t)),this.urlStateListeners.fireKeyListeners(s,t,i)}getAppPath(e){return void 0!==e.apps?`current_app_use/${e.apps[0]}/`:void 0!==e.aspApp?`app/${e.aspApp}/`:void 0}getShowTypePath(e){if(void 0!==e.showType)return`${W.get(e.showType)}/`}getTagPath(e){if(void 0!==e.tags&&e.tags.length>0){let t=`tag/${e.tags[0]}/`;return e.tags=e.tags.slice(1),t}}getRegionPath(e){if(void 0!==e.regions&&1===e.regions.length){let t=`${X.get(e.regions[0])}/`;return e.regions=e.regions.slice(1),t}}getAgePath(e){var t,i;if(void 0!==e.ageMin||void 0!==e.ageMax)for(let[s,n]of z.entries())if(n[0]===(null!=(t=e.ageMin)?t:oe)&&n[1]===(null!=(i=e.ageMax)?i:re))return e.ageMin=void 0,e.ageMax=void 0,`${s}/`}getPrivatePricePath(e){if(void 0!==e.privatePrices&&e.privatePrices.length>0)for(let[t,i]of J.entries())if(i===e.privatePrices[0])return e.privatePrices=e.privatePrices.slice(1),`${t}/`}static getChangedKeys(e,t){let i=new Set([...Object.keys(e),...Object.keys(t)]);return Array.from(i.keys()).filter((i=>JSON.stringify(e[i])!==JSON.stringify(t[i])))}areFiltersChanged(t,i){return e.getChangedKeys(t,i).some((e=>Ee.has(e)))}static setDefaultsToUndefined(e){var t,i,s,n,o,r,a,l;(0===(null==(t=e.genders)?void 0:t.length)||1===(null==(i=e.genders)?void 0:i.length)&&e.genders[0]===yt.Gender.All)&&delete e.genders,0===(null==(s=e.regions)?void 0:s.length)&&delete e.regions,0===(null==(n=e.privatePrices)?void 0:n.length)&&delete e.privatePrices,0===(null==(o=e.spyShowPrices)?void 0:o.length)&&delete e.spyShowPrices,0===(null==(r=e.spokenLanguages)?void 0:r.length)&&delete e.spokenLanguages,0===(null==(a=e.tags)?void 0:a.length)&&delete e.tags,0===(null==(l=e.apps)?void 0:l.length)&&delete e.apps,1===e.page&&delete e.page,1===e.pageb&&delete e.pageb,e.ageMin===oe&&delete e.ageMin,e.ageMax===re&&delete e.ageMax,""===e.keywords&&delete e.keywords}};function Ct(e){return void 0===e||0===e.length}var St=()=>R()&&"home"===wt.current.state.pageType;function xt(){if(A()||!Pt()||kt())return;let e=st().href;window.history.replaceState(void 0,"",e)}function Tt(e){void 0===e&&(e=wt.current.state);let t={};for(let i of Ee)void 0!==e[i]&&(t[i]=e[i]);return t}function Pt(e){if(St()&&!I())return!1;if(A()){let e=wt.current.state;return"home"===e.pageType&&"offline"!==e.showType}return gt(e)||"tag"===ct(e)}function kt(e){let t=null!=e?e:{...wt.current.state},i=M()&&"home"===t.pageType?new Set([...Ee].filter((e=>e!==("private"===t.showType?"privatePrices":"spyShowPrices")))):Ee;return Object.keys(t).some((e=>i.has(e)&&void 0!==t[e]))}function At(){return"false"!==Pe(we)}function Mt(){var e,t;let i=null!=(t=null==(e=window.sessionStorage)?void 0:e.getItem(fe))?t:Pe(fe);if(void 0===i){let e=st();return void 0!==e?Tt((new De).readStateFromURL(e)):{}}return{...JSON.parse(i)}}function Rt(e){var t;let i=Tt(e);M()&&"home"===e.pageType&&(void 0===e.privatePrices&&"private"===e.showType&&(i.privatePrices=Mt().privatePrices),void 0===e.spyShowPrices&&void 0===e.showType&&(i.spyShowPrices=Mt().spyShowPrices));let s=JSON.stringify(i);null==(t=window.sessionStorage)||t.setItem(fe,s),function(e,t,i){let s=new Date;s.setTime(s.getTime()+1e3*function(e){let t=0;return void 0!==e.days&&(t+=24*e.days*60*60),void 0!==e.hours&&(t+=60*e.hours*60),void 0!==e.minutes&&(t+=60*e.minutes),void 0!==e.seconds&&(t+=e.seconds),t}(i));let n=JSON.stringify({value:t,expiration:s.getTime()});window.localStorage.setItem(e,n)}(fe,s,ye)}function It(){var e,t;null==(e=window.sessionStorage)||e.setItem(fe,"{}"),null==(t=window.localStorage)||t.setItem(fe,"{}")}function Et(e){if(!0===window.isMobile||kt(e)||"offline"===e.showType)return!1;let t=Mt();return M()||delete t.spyShowPrices,0!==Object.keys(t).length&&(Object.assign(e,t),!0)}},9229:(e,t,i)=>{"use strict";function s(e){let t=0;return void 0!==e.days&&(t+=24*e.days*60*60),void 0!==e.hours&&(t+=60*e.hours*60),void 0!==e.minutes&&(t+=60*e.minutes),void 0!==e.seconds&&(t+=e.seconds),t}i.d(t,{X:()=>s})},4936:(e,t,i)=>{"use strict";i.d(t,{N6:()=>m,aj:()=>C,yk:()=>x,YK:()=>g,zm:()=>r,lI:()=>c,_O:()=>u,AP:()=>l,GW:()=>d,a:()=>s,WI:()=>h,gn:()=>p,nx:()=>o,VE:()=>n});var s={};function n(e){const t=e.toLowerCase().split("_");for(let e=0;e<t.length;e+=1)t[e]=t[e].charAt(0).toUpperCase()+t[e].slice(1);return t.join("_")}function o(e){const t=e.toLowerCase().split(" ");for(let e=0;e<t.length;e+=1)t[e]=t[e].charAt(0).toUpperCase()+t[e].slice(1);return t.join(" ")}function r(e,t,i,s){return void 0===s&&void 0===i?null==e||""===e?null==t?"":t:e:r(r(r(e,t),r(i,s)),"")}i.r(s),i.d(s,{addPageAction:()=>y,newRelicEnabled:()=>f,setCustomAttribute:()=>b});var a=i(7193);let l=window.gettext;void 0===l&&((0,a.R8)("gettext is undefined."),l=e=>e);let h=window.ngettext;void 0===h&&((0,a.R8)("ngettext is undefined."),h=(e,t,i)=>i>1?t:e);let d=window.interpolate;function c(e){const t=(Date.now()-e.getTime())/1e3;if(t<60)return l("now");if(t<3600){const e=Math.floor(t/60);return d(h("%(minutes)s minute ago","%(minutes)s minutes ago",e),{minutes:e},!0)}if(t<=86400){const e=Math.floor(t/3600);return d(h("%(hours)s hour ago","%(hours)s hours ago",e),{hours:e},!0)}if(t<604800){const e=Math.floor(t/86400);return d(h("%(days)s day ago","%(days)s days ago",e),{days:e},!0)}return e.toLocaleDateString()}function u(e,t=!0){if(e<=0)return"";const i=Math.floor(e/3600);e%=3600;const s=Math.floor(e/60);e%=60;let n="";(i>1||1===i)&&(n=`${i}h`);let o="";return s>=1?o=`${s}m`:0===s&&(o=t?"":"<1m"),i>0&&s>0&&(o=` ${o}`),`${n}${o}${t?`${e}s`:""}`}function p(e,t){return(e.getTime()-t.getTime())/1e3}void 0===d&&((0,a.R8)("interpolate is undefined."),d=(e,t,i)=>i?e.replace(/%\(\w+\)s/g,(e=>{const i=e.slice(2,-2);return String(t[i])})):e.replace(/%s/g,(()=>String(t.shift()))));class m{constructor(e){if(this.parsed={},this.usedFields={},this.valid=!0,"string"==typeof e){this.stringMessage=e;try{this.parsed=JSON.parse(e)}catch(t){this.parsed={},this.valid=!1,(0,a.z3)("Cannot JSON parse",{message:e})}}else"object"==typeof e?(this.parsed=e,this.stringMessage=JSON.stringify(e)):(this.parsed={},this.valid=!1,this.stringMessage=JSON.stringify(this.parsed),(0,a.z3)("Invalid input type",{message:e}))}keys(){return Object.keys(this.parsed)}unusedFields(){const e=[];for(const t in this.parsed)!0!==this.usedFields[t]&&e.push(t);return e}ignore(e){this.usedFields[e]=!0}getParsed(){return Object.assign({},this.parsed)}getAny(e){if(this.ignore(e),null!==this.parsed[e])return this.parsed[e]}getList(e,t=!0){if(this.ignore(e),Array.isArray(this.parsed[e]))return this.parsed[e].map((i=>(t&&"object"!=typeof i&&"string"!=typeof i&&(0,a.R8)(`getList(${e}): called on Array with invalid items`,{message:this.stringMessage,item:i}),new m(i))))}getStringList(e,t=!0){return this.ignore(e),Array.isArray(this.parsed[e])?this.parsed[e].map((i=>(t&&"string"!=typeof i&&(0,a.R8)(`getStringList(${e}): called on Array with invalid items`,{message:this.stringMessage,item:i}),i))):[]}getStringListOrUndefined(e,t=!0){if(this.ignore(e),Array.isArray(this.parsed[e]))return this.getStringList(e,t)}getAsString(e){return`${this.getAny(e)}`}getStringOrUndefined(e,t=!0){const i=this.getAny(e);if("string"==typeof i)return i;t&&void 0!==i&&(0,a.R8)(`getStringOrUndefined(${e}): is wrong type`,{message:this.stringMessage,item:i})}getString(e,t=!0){const i=this.getAny(e);return"string"!=typeof i?(t&&(0,a.R8)(`getString(${e}): is wrong type`,{message:this.stringMessage,item:i}),""):i}getStringWithNumbers(e,t=!0){const i=this.getAny(e);return"string"!=typeof i&&"number"!=typeof i?(t&&(0,a.R8)(`getStringWithNumbers(${e}): is wrong type`,{message:this.stringMessage,item:i}),""):`${i}`}getStringWithNumbersOrBoolean(e,t=!0){const i=this.getAny(e);return"string"!=typeof i&&"number"!=typeof i&&"boolean"!=typeof i?(t&&(0,a.R8)(`getStringWithNumbersOrBoolean(${e}): is wrong type`,{message:this.stringMessage,item:i}),""):"boolean"==typeof i?i:`${i}`}getStrings(e){const t=new Map;for(const i of e)void 0!==this.getStringOrUndefined(i,!1)&&t.set(i,this.getStringOrUndefined(i,!1));return t}getBoolean(e,t=!1,i=!0){const s=this.getAny(e);return"boolean"!=typeof s?(i&&(0,a.R8)(`getBoolean(${e}): is wrong type`,{message:this.stringMessage,item:s}),t):s}getBooleanOrUndefined(e,t=!0){const i=this.getAny(e);if("boolean"==typeof i)return i;t&&void 0!==i&&(0,a.R8)(`getBoolean(${e}): is wrong type`,{message:this.stringMessage,item:i})}getNumber(e,t=!0){const i=this.getAny(e);return"number"!=typeof i?(t&&(0,a.R8)(`getNumber(${e}): is wrong type`,{message:this.stringMessage,item:i}),NaN):i}getNumberOrUndefined(e,t=!0){const i=this.getAny(e);if("number"==typeof i)return i;t&&void 0!==i&&(0,a.R8)(`getNumberOrUndefined(${e}): is wrong type`,{message:this.stringMessage,item:i})}getParsedSubMap(e){return new m(this.getObject(e))}getParsedSubMapOrUndefined(e,t=!0){const i=this.getObjectOrUndefined(e,t);if(void 0!==i)return new m(i)}getMap(e,t=!0){const i=this.getObjectString(e,t);return new m(""===i?"{}":i)}getObjectString(e,t=!0){const i=this.getAny(e);return"object"!=typeof i?(t&&(0,a.R8)(`getObjectString(${e}): is wrong type`,{message:this.stringMessage,item:i}),""):JSON.stringify(i)}getObjectStringOrUndefined(e,t=!0){const i=this.getAny(e);if("object"==typeof i)return JSON.stringify(i);t&&void 0!==i&&(0,a.R8)(`getObjectStringOrUndefined(${e}): is wrong type`,{message:this.stringMessage,item:i})}getObject(e,t=!0){const i=this.getAny(e);return"object"!=typeof i?(t&&(0,a.R8)(`getObject(${e}): is wrong type`,{message:this.stringMessage,item:i}),{}):i}getObjectOrUndefined(e,t=!0){const i=this.getAny(e);if("object"==typeof i)return i;t&&void 0!==i&&(0,a.R8)(`getObjectOrUndefined(${e}): is wrong type`,{message:this.stringMessage,item:i})}logUnusedDebugging(e){for(const t of this.unusedFields()){const i="object"==typeof this.parsed[t]?JSON.stringify(this.parsed[t]):this.parsed[t];(0,a.Yz)(`Unhandled message argument: . Key:${t} Value:${i} in ${e}`)}}}const g=new Map([["en","English"],["id","Bahasa Indonesia"],["ms","Bahasa Melayu (Malay)"],["ca","Català (Catalan)"],["da","Dansk (Danish)"],["de","Deutsch (German)"],["es","Español (Spanish)"],["fr","Français (French)"],["it","Italiano (Italian)"],["hu","Magyar (Hungarian)"],["nl","Nederlands (Dutch)"],["no","Norsk (Norwegian)"],["pl","Polski (Polish)"],["pt","Português (Portuguese)"],["ro","Română (Romanian)"],["sk","Slovenčina (Slovak)"],["fi","Suomi (Finnish)"],["sv","Svenska (Swedish)"],["tl","Tagalog"],["vi","Tiếng Việt (Vietnamese)"],["tr","Türkçe (Turkish)"],["cs","Čeština (Czech)"],["el","Ελληνικά (Greek)"],["bg","Български (Bulgarian)"],["ru","Русский (Russian)"],["uk","Українська (Ukrainian)"],["ar","العربية (Arabic)"],["hi","मानक हिन्दी (Hindi)"],["th","ภาษาไทย (Thai)"],["zh","中文 (Chinese)"],["ja","日本語 (Japanese)"],["ko","한국어 (Korean)"]]),v=window.newrelic;function f(){return void 0!==v}function y(e,t={}){try{if(void 0===v)return void(0,a.Yz)(`New Relic is disabled, not sending metric: ${e}`);0===Object.keys(t).length?v.addPageAction(e):v.addPageAction(e,t)}catch(e){(0,a.z3)(`New Relic Error in addPageAction: ${e}`)}}function b(e,t){try{if(void 0===v)return;v.setCustomAttribute(e,t)}catch(e){(0,a.z3)(`New Relic Error in setCustomAttribute: ${e}`)}}const w={};class C{constructor(e){this.active=!1,this.eligible=!1,this.name=e;const t=window.experiments;if(void 0!==t){const i=new RegExp(`\\b${e}\\b`),s=t.active;this.active=void 0!==s&&i.test(s);const n=t.eligible;this.eligible=void 0!==n&&i.test(n)}}record(){this.eligible&&!w[this.name]&&(y("ExperimentEntered",{experimentName:this.name,experimentGroup:this.active?"active":"inactive",experimentTreatment:this.active?this.name:"control"}),w[this.name]=!0)}}const S={};class x{constructor(e,t){this.namespace=t,this.active=!1,this.eligible=!1;const i=window.experiments;if(void 0!==i){const t=i.active,s=i.eligible;if(void 0!==s){for(const t of e)if(new RegExp(`\\b${t}\\b`).test(s)){this.eligible=!0;break}if(this.eligible&&void 0!==t)for(const i of e)if(new RegExp(`\\b${i}\\b`).test(t)){this.active=!0,this.activeSide=i;break}}}}isControlGroup(){return this.eligible&&!this.active}record(){this.eligible&&!S[this.namespace]&&(y("ExperimentEntered",{experimentName:this.namespace,experimentGroup:this.active?"active":"inactive",experimentTreatment:this.active?this.activeSide:"control"}),S[this.namespace]=!0)}}},7623:(e,t,i)=>{"use strict";i.d(t,{Ni:()=>K,xv:()=>w,J8:()=>P,AD:()=>Q,yb:()=>F,ru:()=>N,m0:()=>X,o:()=>v,Hg:()=>d,H8:()=>A,_6:()=>M,UQ:()=>J,gm:()=>R,lj:()=>h,Ap:()=>b,lT:()=>H,Cc:()=>W,Pf:()=>l,Xb:()=>O,xe:()=>f,rm:()=>y,sb:()=>C,vM:()=>k,H9:()=>z,nr:()=>I,Pb:()=>L,hj:()=>E,wP:()=>Y,hl:()=>V,mz:()=>S,BS:()=>j,YU:()=>q,OF:()=>_,J0:()=>D,aq:()=>B,tJ:()=>U,p0:()=>G});var s=i(7193);const n=window.Hls;let o;const r={chrome:79,firefox:78,edge:90,safari:13},a={chrome:79,crios:79,firefox:115,fxios:115,safari:13,samsungbrowser:15};function l(){if(void 0===o){const e="cbModernizr";let t=!0;try{window.localStorage.setItem(e,e),window.localStorage.removeItem(e)}catch(e){t=!1}(0,s.Yz)(`local storage support = ${t}`),o=t}return o}function h(){return void 0!==window.history&&void 0!==window.history.pushState}function d(){try{return!!document.createElement("audio").canPlayType}catch(e){return!1}}let c,u,p,m,g;function v(){if(void 0!==c)return c;let e;c=!1;try{if("webkitAudioContext"in window)e=new webkitAudioContext;else{if(!("AudioContext"in window))return c;e=new AudioContext}if(null===e)return c;c="function"==typeof e.createGain&&"function"==typeof e.decodeAudioData&&"function"==typeof e.createBufferSource&&"function"==typeof e.createBufferSource().start,"function"==typeof e.close&&e.close()}catch(e){(0,s.z3)("Error checking for audio context",{reason:e.toString()})}return c}function f(){if(void 0!==u)return u;const e=document.createElement("audio");return u="function"==typeof e.canPlayType&&""!==e.canPlayType("audio/mpeg;codecs=mp3"),u}function y(){const e=document.createElement("video").canPlayType("application/vnd.apple.mpegurl");return"probably"===e||"maybe"===e}function b(){return y()||n.isSupported()}function w(){return window.hasOwnProperty("requestAnimationFrame")?window.requestAnimationFrame:window.hasOwnProperty("webkitRequestAnimationFrame")?window.webkitRequestAnimationFrame:window.hasOwnProperty("mozRequestAnimationFrame")?window.mozRequestAnimationFrame:e=>(window.setTimeout((()=>{e(0)}),1e3/7),Date.now())}function C(){if(void 0!==p)return p;try{const e=Object.defineProperty({},"passive",{get:function(){p=!0}}),t=()=>{};window.addEventListener("testPassive",t,e),window.removeEventListener("testPassive",t,e),void 0===p&&(p=!1)}catch(e){p=!1}return p}function S(){if(void 0!==m)return m;try{const e=document.createElement("audio");e.volume=.5,m=.5===e.volume}catch(e){m=!1}return m}let x,T=!1;function P(){if(null!==document.scrollingElement)return document.scrollingElement;if(void 0!==g&&!T)return g;const e=document.documentElement.scrollTop;return document.documentElement.style.height=`${window.innerHeight+1}px`,document.documentElement.scrollTop=e+1,g=document.documentElement.scrollTop!==e?document.documentElement:document.body,document.documentElement.style.height="",document.documentElement.scrollTop=e,T=!1,g}function k(){return void 0!==window.performance&&void 0!==window.performance.now}function A(){return void 0!==window.chrome&&(!!window.chrome.loadTimes||!!window.chrome.webstore||!!window.chrome.runtime)||/CriOS/i.test(navigator.userAgent)}function M(){return/Edge\//i.test(navigator.userAgent)}function R(){return null!==/Firefox/.exec(navigator.userAgent)||void 0!==window.InstallTrigger}function I(){const e=/CriOS|FxiOS/i.test(navigator.userAgent);if(_()&&/WebKit/i.test(navigator.userAgent)&&!e)return!0;let t=!1;return void 0!==window.safari&&void 0!==window.safari.pushNotification&&(t="[object SafariRemoteNotification]"===window.safari.pushNotification.toString()),/Safari/i.test(navigator.userAgent)&&/Version\/(\d+)/.test(navigator.userAgent)&&!e||t}function E(){return[/SM-T827R4/,/SM-T550/,/SM-T330/,/SM-T232/,/SM-T335/,/SM-T813/,/SM-T510/].some((e=>e.test(navigator.userAgent)))}function L(){return/SamsungBrowser/i.test(navigator.userAgent)}function D(){return(/iPad/i.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&void 0===window.MSStream}function B(){return/iPhone/i.test(navigator.userAgent)&&void 0===window.MSStream}function U(){return/iPod/i.test(navigator.userAgent)&&void 0===window.MSStream}function _(){return U()||B()||D()}function F(){if(_()){let e=navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/);if(null===e&&(e=navigator.userAgent.match(/Version\/(\d+)/),null===e))return;return parseInt(e[1])}}function N(){const e=navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/);if(_()&&null!==e)return{major:parseInt(e[1]),minor:parseInt(e[2]),patch:parseInt(e[3])}}function O(){return/Android|webOS|BlackBerry|IEMobile|Opera Mini|SamsungBrowser/i.test(navigator.userAgent)||_()}function H(){return!!document.documentMode}function W(){return H()&&void 0===window.atob}function $(e,t){const i=O()?a:r;return i.hasOwnProperty(e)&&t>=i[e]}function V(){const e=window.navigator.userAgent.toLowerCase(),t=e.match(/edg\/(\d+)/);if(t)return $("edge",parseFloat(t[1]));if(I()){const t=e.match(/version\/([\d.]+)/);if(t)return $("safari",parseFloat(t[1]))}const i=e.match(/(chrome|firefox|samsungbrowser|crios|fxios)/),s=e.match(/(chrome|firefox|samsungbrowser|crios|fxios)[\s\/](\d+)/);if(i&&s){const e=parseFloat(s[2]);return $(i[1],e)}return!1}function z(){return/Puffin/i.test(navigator.userAgent)}function G(){let e="unload";return _()&&I()&&(e="pagehide"),e}function q(){return"object"==typeof navigator&&"object"==typeof navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia}function j(){return Boolean(navigator.userAgent.match(/Puffin/i))}function Z(){const e=/Edg(|e|A|iOS)\/\d+/.exec(navigator.userAgent);return null!==e?parseInt(e[0].split("/")[1],10):0}function K(){const e=N();return{platform:navigator.platform,userAgent:navigator.userAgent,maxTouchPoints:void 0!==navigator.maxTouchPoints?navigator.maxTouchPoints:0,iosVersionMajor:void 0!==e?e.major:0,iosVersionMinor:void 0!==e?e.minor:0,iosVersionPatch:void 0!==e?e.patch:0,edgeVersionMajor:Z(),isDefinedMSStream:void 0!==window.MSStream,isDefinedInstallTrigger:void 0!==window.InstallTrigger,isPresentChromeLoadTimes:void 0!==window.chrome&&!!window.chrome.loadTimes,isPresentChromeWebStore:void 0!==window.chrome&&!!window.chrome.webstore,isPresentChromeRunTime:void 0!==window.chrome&&!!window.chrome.runtime,safariPushNotifications:void 0!==window.safari?window.safari.pushNotification.toString():""}}function J(){return!0===x}window.setTimeout((()=>{T=!0}),200),new Promise((e=>{if(void 0!==x)e(x);else{const t=new Image;t.onerror=()=>{e(!1)},t.onload=()=>{x=2!==t.width,e(x)},t.src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QAiRXhpZgAASUkqAAgAAAABABIBAwABAAAABgASAAAAAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAIDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD+/iiiigD/2Q=="}})).then((e=>{x=e,(0,s.Yz)("exif: ",x)})).catch((()=>{}));const Y="scroll-behavior"in document.createElement("div").style;function Q(){return!(A()||!(X()||_()||navigator.userAgent.includes("Mac")))}function X(){return/Android/i.test(navigator.userAgent)}},8861:(e,t,i)=>{"use strict";i.d(t,{$G:()=>l,I7:()=>o,Yj:()=>d,oD:()=>n,pH:()=>h,uC:()=>a});var s=i(9229);function n(e){const t=e.length+1;return document.cookie.split(";").map((e=>e.trim())).filter((i=>i.substring(0,t)===`${e}=`)).map((e=>decodeURIComponent(e.substring(t))))[0]}function o(e){var t;return null!==(t=n(e))&&void 0!==t?t:""}function r(){let e=window.location.hostname;-1!==e.indexOf("www.")&&(e=e.replace("www.",""));const t=e.match(/^(?:[a-z]{2}|zh-hans|zh-hant)\./);return t&&(e=e.replace(t[0],"")),0!==e.indexOf(".")&&(e=`.${e}`),e}function a(e,t,i,n="/",o=!1){const a=new Date;a.setTime(a.getTime()+1e3*(0,s.X)(i));let l=`${e}=${t}; expires=${a.toUTCString()}; path=${n}`;o&&(l+=`; domain=${r()}`),document.cookie=l}function l(e,t,i=!1){let s=`${e}=${t}; path=/`;i&&(s+=`; domain=${r()}`),document.cookie=s}function h(e){const t=n(e);if(void 0===t)return t;const i=parseInt(t);return isNaN(i)?void 0:i}function d(e){a(e,"",{days:-1})}},2758:(e,t,i)=>{"use strict";i.d(t,{TS:()=>o,aR:()=>l,nw:()=>r,y1:()=>a});var s=i(9229);const n=(e,t)=>{try{const s=JSON.parse(e);return"object"!=typeof(i=s)||void 0===i.expiration||"number"!=typeof i.expiration||s.expiration<(new Date).getTime()?void t():s}catch(e){return}var i};function o(e){var t;const i=window.sessionStorage.getItem(e);if(null!==i)return null===(t=n(i,(()=>window.sessionStorage.removeItem(e))))||void 0===t?void 0:t.value}function r(e,t,i){const n=new Date;n.setTime(n.getTime()+1e3*(0,s.X)(i));const o=JSON.stringify({value:t,expiration:n.getTime()});window.sessionStorage.setItem(e,o)}function a(e){var t;const i=window.localStorage.getItem(e);if(null!==i)return null===(t=n(i,(()=>window.localStorage.removeItem(e))))||void 0===t?void 0:t.value}function l(e,t,i){const n=new Date;n.setTime(n.getTime()+1e3*(0,s.X)(i));const o=JSON.stringify({value:t,expiration:n.getTime()});window.localStorage.setItem(e,o)}}}]);
//# sourceMappingURL=916-prod-4dce2208ff0e50433989.js.map