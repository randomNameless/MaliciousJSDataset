<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>luna-annotorious.html</title>
</head>
<body>

<script>
(function(Z,L){typeof exports=="object"&&typeof module<"u"?module.exports=L(require("openseadragon")):typeof define=="function"&&define.amd?define(["openseadragon"],L):(Z=typeof globalThis<"u"?globalThis:Z||self,Z.LunaAnnotorious=L(Z.OpenSeadragon))})(this,function(Z){"use strict";var mi=Object.defineProperty;var hi=(Z,L,ue)=>L in Z?mi(Z,L,{enumerable:!0,configurable:!0,writable:!0,value:ue}):Z[L]=ue;var K=(Z,L,ue)=>(hi(Z,typeof L!="symbol"?L+"":L,ue),ue);function L(){}const ue=e=>e;function It(e,t){for(const n in t)e[n]=t[n];return e}function xe(e){return e()}function et(){return Object.create(null)}function oe(e){e.forEach(xe)}function De(e){return typeof e=="function"}function de(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Ot(e){return Object.keys(e).length===0}function Ft(e){return e&&De(e.destroy)?e.destroy:L}const tt=typeof window<"u";let Ut=tt?()=>window.performance.now():()=>Date.now(),Ie=tt?e=>requestAnimationFrame(e):L;const _e=new Set;function nt(e){_e.forEach(t=>{t.c(e)||(_e.delete(t),t.f())}),_e.size!==0&&Ie(nt)}function jt(e){let t;return _e.size===0&&Ie(nt),{promise:new Promise(n=>{_e.add(t={c:e,f:n})}),abort(){_e.delete(t)}}}function v(e,t){e.appendChild(t)}function it(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function Kt(e){const t=S("style");return t.textContent="/* empty */",Zt(it(e),t),t.sheet}function Zt(e,t){return v(e.head||e,t),t.sheet}function k(e,t,n){e.insertBefore(t,n||null)}function y(e){e.parentNode&&e.parentNode.removeChild(e)}function Wt(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function S(e){return document.createElement(e)}function ot(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function V(e){return document.createTextNode(e)}function O(){return V(" ")}function ge(){return V("")}function j(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function E(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function rt(e,t){for(const n in t)E(e,n,t[n])}function Xt(e){return Array.from(e.childNodes)}function re(e,t){t=""+t,e.data!==t&&(e.data=t)}function He(e,t,n){e.classList.toggle(t,!!n)}function st(e,t,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:i})}class Yt{constructor(t=!1){K(this,"is_svg",!1);K(this,"e");K(this,"n");K(this,"t");K(this,"a");this.is_svg=t,this.e=this.n=null}c(t){this.h(t)}m(t,n,i=null){this.e||(this.is_svg?this.e=ot(n.nodeName):this.e=S(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(t)),this.i(i)}h(t){this.e.innerHTML=t,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(t){for(let n=0;n<this.n.length;n+=1)k(this.t,this.n[n],t)}p(t){this.d(),this.h(t),this.i(this.a)}d(){this.n.forEach(y)}}const $e=new Map;let Be=0;function qt(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}function Gt(e,t){const n={stylesheet:Kt(t),rules:{}};return $e.set(e,n),n}function lt(e,t,n,i,o,r,s,l=0){const c=16.666/i;let a=`{
`;for(let m=0;m<=1;m+=c){const b=t+(n-t)*r(m);a+=m*100+`%{${s(b,1-b)}}
`}const u=a+`100% {${s(n,1-n)}}
}`,f=`__svelte_${qt(u)}_${l}`,p=it(e),{stylesheet:h,rules:d}=$e.get(p)||Gt(p,e);d[f]||(d[f]=!0,h.insertRule(`@keyframes ${f} ${u}`,h.cssRules.length));const _=e.style.animation||"";return e.style.animation=`${_?`${_}, `:""}${f} ${i}ms linear ${o}ms 1 both`,Be+=1,f}function Jt(e,t){const n=(e.style.animation||"").split(", "),i=n.filter(t?r=>r.indexOf(t)<0:r=>r.indexOf("__svelte")===-1),o=n.length-i.length;o&&(e.style.animation=i.join(", "),Be-=o,Be||Qt())}function Qt(){Ie(()=>{Be||($e.forEach(e=>{const{ownerNode:t}=e.stylesheet;t&&y(t)}),$e.clear())})}let Ee;function Ce(e){Ee=e}function at(){if(!Ee)throw new Error("Function called outside component initialization");return Ee}function xt(e){at().$$.on_mount.push(e)}function Oe(){const e=at();return(t,n,{cancelable:i=!1}={})=>{const o=e.$$.callbacks[t];if(o){const r=st(t,n,{cancelable:i});return o.slice().forEach(s=>{s.call(e,r)}),!r.defaultPrevented}return!0}}function en(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(i=>i.call(this,t))}const be=[],Fe=[];let ve=[];const ct=[],ft=Promise.resolve();let Ue=!1;function ut(){Ue||(Ue=!0,ft.then(dt))}function tn(){return ut(),ft}function Ae(e){ve.push(e)}const je=new Set;let ye=0;function dt(){if(ye!==0)return;const e=Ee;do{try{for(;ye<be.length;){const t=be[ye];ye++,Ce(t),nn(t.$$)}}catch(t){throw be.length=0,ye=0,t}for(Ce(null),be.length=0,ye=0;Fe.length;)Fe.pop()();for(let t=0;t<ve.length;t+=1){const n=ve[t];je.has(n)||(je.add(n),n())}ve.length=0}while(be.length);for(;ct.length;)ct.pop()();Ue=!1,je.clear(),Ce(e)}function nn(e){if(e.fragment!==null){e.update(),oe(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ae)}}function on(e){const t=[],n=[];ve.forEach(i=>e.indexOf(i)===-1?t.push(i):n.push(i)),n.forEach(i=>i()),ve=t}let Se;function rn(){return Se||(Se=Promise.resolve(),Se.then(()=>{Se=null})),Se}function Ke(e,t,n){e.dispatchEvent(st(`${t?"intro":"outro"}${n}`))}const Ve=new Set;let se;function te(){se={r:0,c:[],p:se}}function ne(){se.r||oe(se.c),se=se.p}function A(e,t){e&&e.i&&(Ve.delete(e),e.i(t))}function N(e,t,n,i){if(e&&e.o){if(Ve.has(e))return;Ve.add(e),se.c.push(()=>{Ve.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}else i&&i()}const sn={duration:0};function pt(e,t,n,i){let r=t(e,n,{direction:"both"}),s=i?0:1,l=null,c=null,a=null,u;function f(){a&&Jt(e,a)}function p(d,_){const m=d.b-s;return _*=Math.abs(m),{a:s,b:d.b,d:m,duration:_,start:d.start,end:d.start+_,group:d.group}}function h(d){const{delay:_=0,duration:m=300,easing:b=ue,tick:P=L,css:D}=r||sn,H={start:Ut()+_,b:d};d||(H.group=se,se.r+=1),"inert"in e&&(d?u!==void 0&&(e.inert=u):(u=e.inert,e.inert=!0)),l||c?c=H:(D&&(f(),a=lt(e,s,d,m,_,b,D)),d&&P(0,1),l=p(H,m),Ae(()=>Ke(e,d,"start")),jt(z=>{if(c&&z>c.start&&(l=p(c,m),c=null,Ke(e,l.b,"start"),D&&(f(),a=lt(e,s,l.b,l.duration,0,b,r.css))),l){if(z>=l.end)P(s=l.b,1-s),Ke(e,l.b,"end"),c||(l.b?f():--l.group.r||oe(l.group.c)),l=null;else if(z>=l.start){const F=z-l.start;s=l.a+l.d*b(F/l.duration),P(s,1-s)}}return!!(l||c)}))}return{run(d){De(r)?rn().then(()=>{r=r({direction:d?"in":"out"}),h(d)}):h(d)},end(){f(),l=c=null}}}function mt(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function ln(e,t){const n={},i={},o={$$scope:1};let r=e.length;for(;r--;){const s=e[r],l=t[r];if(l){for(const c in s)c in l||(i[c]=1);for(const c in l)o[c]||(n[c]=l[c],o[c]=1);e[r]=l}else for(const c in s)o[c]=1}for(const s in i)s in n||(n[s]=void 0);return n}function G(e){e&&e.c()}function W(e,t,n){const{fragment:i,after_update:o}=e.$$;i&&i.m(t,n),Ae(()=>{const r=e.$$.on_mount.map(xe).filter(De);e.$$.on_destroy?e.$$.on_destroy.push(...r):oe(r),e.$$.on_mount=[]}),o.forEach(Ae)}function X(e,t){const n=e.$$;n.fragment!==null&&(on(n.after_update),oe(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function an(e,t){e.$$.dirty[0]===-1&&(be.push(e),ut(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function pe(e,t,n,i,o,r,s=null,l=[-1]){const c=Ee;Ce(e);const a=e.$$={fragment:null,ctx:[],props:r,update:L,not_equal:o,bound:et(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:et(),dirty:l,skip_bound:!1,root:t.target||c.$$.root};s&&s(a.root);let u=!1;if(a.ctx=n?n(e,t.props||{},(f,p,...h)=>{const d=h.length?h[0]:p;return a.ctx&&o(a.ctx[f],a.ctx[f]=d)&&(!a.skip_bound&&a.bound[f]&&a.bound[f](d),u&&an(e,f)),p}):[],a.update(),u=!0,oe(a.before_update),a.fragment=i?i(a.ctx):!1,t.target){if(t.hydrate){const f=Xt(t.target);a.fragment&&a.fragment.l(f),f.forEach(y)}else a.fragment&&a.fragment.c();t.intro&&A(e.$$.fragment),W(e,t.target,t.anchor),dt()}Ce(c)}class me{constructor(){K(this,"$$");K(this,"$$set")}$destroy(){X(this,1),this.$destroy=L}$on(t,n){if(!De(n))return L;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const o=i.indexOf(n);o!==-1&&i.splice(o,1)}}$set(t){this.$$set&&!Ot(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const cn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(cn);var Ze={dragStart:!0},ht=(e,t,n)=>Math.min(Math.max(e,t),n),We=e=>typeof e=="string",fn=([e,t],n,i)=>{const o=(r,s)=>s===0?0:Math.ceil(r/s)*s;return[o(n,e),o(i,t)]},_t=(e,t)=>e.some(n=>t.some(i=>n.contains(i)));function Xe(e,t){if(e===void 0)return;if(Ye(e))return e.getBoundingClientRect();if(typeof e=="object"){const{top:i=0,left:o=0,right:r=0,bottom:s=0}=e;return{top:i,right:window.innerWidth-r,bottom:window.innerHeight-s,left:o}}if(e==="parent")return t.parentNode.getBoundingClientRect();const n=document.querySelector(e);if(n===null)throw new Error("The selector provided for bound doesn't exists in the document.");return n.getBoundingClientRect()}var ze=(e,t,n)=>e.style.setProperty(t,n),Ye=e=>e instanceof HTMLElement,un=(e,t={})=>{let n,i,{bounds:o,axis:r="both",gpuAcceleration:s=!0,legacyTranslate:l=!0,transform:c,applyUserSelectHack:a=!0,disabled:u=!1,ignoreMultitouch:f=!1,recomputeBounds:p=Ze,grid:h,position:d,cancel:_,handle:m,defaultClass:b="neodrag",defaultClassDragging:P="neodrag-dragging",defaultClassDragged:D="neodrag-dragged",defaultPosition:H={x:0,y:0},onDragStart:z,onDrag:F,onDragEnd:w}=t,T=!1,$=0,g=0,B=0,Y=0,le=0,Le=0,{x:we,y:ke}=d?{x:(d==null?void 0:d.x)??0,y:(d==null?void 0:d.y)??0}:H;Te(we,ke);let Q,M,J,ae,ce,Re="",Qe=!!d;p={...Ze,...p};const Ne=document.body.style,ie=e.classList;function Te(C=$,I=g){if(!c){if(l){let q=`${+C}px, ${+I}px`;return ze(e,"transform",s?`translate3d(${q}, 0)`:`translate(${q})`)}return ze(e,"translate",`${+C}px ${+I}px ${s?"1px":""}`)}const U=c({offsetX:C,offsetY:I,rootNode:e});We(U)&&ze(e,"transform",U)}const Pe=(C,I)=>{const U={offsetX:$,offsetY:g,rootNode:e,currentNode:ce};e.dispatchEvent(new CustomEvent(C,{detail:U})),I==null||I(U)},Me=addEventListener;Me("pointerdown",Vt,!1),Me("pointerup",zt,!1),Me("pointermove",Rt,!1),ze(e,"touch-action","none");const Bt=()=>{let C=e.offsetWidth/M.width;return isNaN(C)&&(C=1),C};function Vt(C){if(u||C.button===2||f&&!C.isPrimary)return;if(p.dragStart&&(Q=Xe(o,e)),We(m)&&We(_)&&m===_)throw new Error("`handle` selector can't be same as `cancel` selector");if(ie.add(b),J=function(R,ee){if(!R)return[ee];if(Ye(R))return[R];if(Array.isArray(R))return R;const fe=ee.querySelectorAll(R);if(fe===null)throw new Error("Selector passed for `handle` option should be child of the element on which the action is applied");return Array.from(fe.values())}(m,e),ae=function(R,ee){if(!R)return[];if(Ye(R))return[R];if(Array.isArray(R))return R;const fe=ee.querySelectorAll(R);if(fe===null)throw new Error("Selector passed for `cancel` option should be child of the element on which the action is applied");return Array.from(fe.values())}(_,e),n=/(both|x)/.test(r),i=/(both|y)/.test(r),_t(ae,J))throw new Error("Element being dragged can't be a child of the element on which `cancel` is applied");const I=C.composedPath()[0];if(!J.some(R=>{var ee;return R.contains(I)||((ee=R.shadowRoot)==null?void 0:ee.contains(I))})||_t(ae,[I]))return;ce=J.length===1?e:J.find(R=>R.contains(I)),T=!0,M=e.getBoundingClientRect(),a&&(Re=Ne.userSelect,Ne.userSelect="none"),Pe("neodrag:start",z);const{clientX:U,clientY:q}=C,x=Bt();n&&(B=U-we/x),i&&(Y=q-ke/x),Q&&(le=U-M.left,Le=q-M.top)}function zt(){T&&(p.dragEnd&&(Q=Xe(o,e)),ie.remove(P),ie.add(D),a&&(Ne.userSelect=Re),Pe("neodrag:end",w),n&&(B=$),i&&(Y=g),T=!1)}function Rt(C){if(!T)return;p.drag&&(Q=Xe(o,e)),ie.add(P),C.preventDefault(),M=e.getBoundingClientRect();let I=C.clientX,U=C.clientY;const q=Bt();if(Q){const x={left:Q.left+le,top:Q.top+Le,right:Q.right+le-M.width,bottom:Q.bottom+Le-M.height};I=ht(I,x.left,x.right),U=ht(U,x.top,x.bottom)}if(Array.isArray(h)){let[x,R]=h;if(isNaN(+x)||x<0)throw new Error("1st argument of `grid` must be a valid positive number");if(isNaN(+R)||R<0)throw new Error("2nd argument of `grid` must be a valid positive number");let ee=I-B,fe=U-Y;[ee,fe]=fn([x/q,R/q],ee,fe),I=B+ee,U=Y+fe}n&&($=Math.round((I-B)*q)),i&&(g=Math.round((U-Y)*q)),we=$,ke=g,Pe("neodrag",F),Te()}return{destroy:()=>{const C=removeEventListener;C("pointerdown",Vt,!1),C("pointerup",zt,!1),C("pointermove",Rt,!1)},update:C=>{var U,q;r=C.axis||"both",u=C.disabled??!1,f=C.ignoreMultitouch??!1,m=C.handle,o=C.bounds,p=C.recomputeBounds??Ze,_=C.cancel,a=C.applyUserSelectHack??!0,h=C.grid,s=C.gpuAcceleration??!0,l=C.legacyTranslate??!0,c=C.transform;const I=ie.contains(D);ie.remove(b,D),b=C.defaultClass??"neodrag",P=C.defaultClassDragging??"neodrag-dragging",D=C.defaultClassDragged??"neodrag-dragged",ie.add(b),I&&ie.add(D),Qe&&(we=$=((U=C.position)==null?void 0:U.x)??$,ke=g=((q=C.position)==null?void 0:q.y)??g,Te())}}};function dn(e){let t,n=[{width:e[1]},{height:e[1]},{"stroke-width":"0"},{class:e[2]},e[0].a,e[4],{xmlns:"http://www.w3.org/2000/svg"}],i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return{c(){t=ot("svg"),rt(t,i)},m(o,r){k(o,t,r),t.innerHTML=e[3]},p(o,[r]){r&8&&(t.innerHTML=o[3]),rt(t,i=ln(n,[r&2&&{width:o[1]},r&2&&{height:o[1]},{"stroke-width":"0"},r&4&&{class:o[2]},r&1&&o[0].a,r&16&&o[4],{xmlns:"http://www.w3.org/2000/svg"}]))},i:L,o:L,d(o){o&&y(t)}}}function pn(e,t,n){let{src:i}=t,{size:o="1em"}=t,{color:r=void 0}=t,{title:s=void 0}=t,{className:l=""}=t,c,a;return e.$$set=u=>{"src"in u&&n(0,i=u.src),"size"in u&&n(1,o=u.size),"color"in u&&n(5,r=u.color),"title"in u&&n(6,s=u.title),"className"in u&&n(2,l=u.className)},e.$$.update=()=>{e.$$.dirty&33&&(n(4,a={}),r&&(i.a.stroke!=="none"&&n(4,a.stroke=r,a),i.a.fill!=="none"&&n(4,a.fill=r,a))),e.$$.dirty&65&&n(3,c=(s?`<title>${s}</title>`:"")+i.c)},[i,o,l,c,a,r,s]}class he extends me{constructor(t){super(),pe(this,t,pn,dn,de,{src:0,size:1,color:5,title:6,className:2})}}const gt={a:{viewBox:"0 0 640 512"},c:'<path d="M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"></path>'},mn={a:{viewBox:"0 0 448 512"},c:'<path d="M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432 80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z"></path>'},hn={a:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},c:'<polyline points="6 9 12 15 18 9"></polyline>'},_n={a:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},c:'<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>'};function gn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var qe="__autosizeInputGhost",bn={" ":"nbsp","<":"lt",">":"gt"};function vn(e){return"&"+bn[e]+";"}function yn(e){return e.replace(/\s|<|>/g,vn)}function wn(){var e=document.createElement("div");return e.id=qe,e.style.cssText="display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(e),e}var kn=function(e,t){var n=window.getComputedStyle(e),i="box-sizing:"+n.boxSizing+";border-left:"+n.borderLeftWidth+" solid red;border-right:"+n.borderRightWidth+" solid red;font-family:"+n.fontFamily+";font-feature-settings:"+n.fontFeatureSettings+";font-kerning:"+n.fontKerning+";font-size:"+n.fontSize+";font-stretch:"+n.fontStretch+";font-style:"+n.fontStyle+";font-variant:"+n.fontVariant+";font-variant-caps:"+n.fontVariantCaps+";font-variant-ligatures:"+n.fontVariantLigatures+";font-variant-numeric:"+n.fontVariantNumeric+";font-weight:"+n.fontWeight+";letter-spacing:"+n.letterSpacing+";margin-left:"+n.marginLeft+";margin-right:"+n.marginRight+";padding-left:"+n.paddingLeft+";padding-right:"+n.paddingRight+";text-indent:"+n.textIndent+";text-transform:"+n.textTransform;function o(){var s=e.value||e.getAttribute("placeholder")||"",l=document.getElementById(qe)||wn();l.style.cssText+=i,l.innerHTML=yn(s);var c=window.getComputedStyle(l).width;return e.style.width=c,c}e.addEventListener("input",o);var r=o();return t&&t.minWidth&&r!=="0px"&&(e.style.minWidth=r),function(){e.removeEventListener("input",o);var s=document.getElementById(qe);s&&s.parentNode.removeChild(s)}};const En=gn(kn),Cn={a:{fill:"currentColor",viewBox:"0 0 16 16"},c:'<path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"></path>'};function An(e){var u;let t,n=((u=e[0])==null?void 0:u.value)+"",i,o,r,s,l,c,a=e[2]&&bt();return{c(){t=S("span"),i=V(n),o=O(),a&&a.c(),r=ge(),E(t,"class","transcription svelte-jmvim5")},m(f,p){k(f,t,p),v(t,i),k(f,o,p),a&&a.m(f,p),k(f,r,p),s=!0,l||(c=j(t,"click",e[5]),l=!0)},p(f,p){var h;(!s||p&1)&&n!==(n=((h=f[0])==null?void 0:h.value)+"")&&re(i,n),f[2]?a?p&4&&A(a,1):(a=bt(),a.c(),A(a,1),a.m(r.parentNode,r)):a&&(te(),N(a,1,1,()=>{a=null}),ne())},i(f){s||(A(a),s=!0)},o(f){N(a),s=!1},d(f){f&&(y(t),y(o),y(r)),a&&a.d(f),l=!1,c()}}}function Sn(e){let t,n,i,o;return{c(){var r;t=S("input"),t.value=n=((r=e[0])==null?void 0:r.value)??"",E(t,"spellcheck",!1),E(t,"class","svelte-jmvim5")},m(r,s){k(r,t,s),e[6](t),i||(o=j(t,"keyup",e[4]),i=!0)},p(r,s){var l;s&1&&n!==(n=((l=r[0])==null?void 0:l.value)??"")&&t.value!==n&&(t.value=n)},i:L,o:L,d(r){r&&y(t),e[6](null),i=!1,o()}}}function bt(e){let t,n;return t=new he({props:{className:"verified-mark",src:Cn}}),{c(){G(t.$$.fragment)},m(i,o){W(t,i,o),n=!0},i(i){n||(A(t.$$.fragment,i),n=!0)},o(i){N(t.$$.fragment,i),n=!1},d(i){X(t,i)}}}function Ln(e){let t,n,i,o;const r=[Sn,An],s=[];function l(c,a){return c[1]?0:1}return t=l(e),n=s[t]=r[t](e),{c(){n.c(),i=ge()},m(c,a){s[t].m(c,a),k(c,i,a),o=!0},p(c,[a]){let u=t;t=l(c),t===u?s[t].p(c,a):(te(),N(s[u],1,1,()=>{s[u]=null}),ne(),n=s[t],n?n.p(c,a):(n=s[t]=r[t](c),n.c()),A(n,1),n.m(i.parentNode,i))},i(c){o||(A(n),o=!0)},o(c){N(n),o=!1},d(c){c&&y(i),s[t].d(c)}}}function Nn(e,t,n){const i=Oe();let{transcription:o}=t,{isEditable:r}=t,{isVerified:s}=t,l;const c=f=>{const{value:p}=l;f.key==="Enter"?i("save"):f.key==="Escape"?i("cancel"):i("change",p)};function a(f){en.call(this,e,f)}function u(f){Fe[f?"unshift":"push"](()=>{l=f,n(3,l)})}return e.$$set=f=>{"transcription"in f&&n(0,o=f.transcription),"isEditable"in f&&n(1,r=f.isEditable),"isVerified"in f&&n(2,s=f.isVerified)},e.$$.update=()=>{e.$$.dirty&10&&r&&tn().then(()=>{l&&(En(l),l.focus(),l.select())})},[o,r,s,l,c,a,u]}class Tn extends me{constructor(t){super(),pe(this,t,Nn,Ln,de,{transcription:0,isEditable:1,isVerified:2})}}function Pn(e){const t=e-1;return t*t*t+1}function vt(e,{delay:t=0,duration:n=400,easing:i=Pn,axis:o="y"}={}){const r=getComputedStyle(e),s=+r.opacity,l=o==="y"?"height":"width",c=parseFloat(r[l]),a=o==="y"?["top","bottom"]:["left","right"],u=a.map(b=>`${b[0].toUpperCase()}${b.slice(1)}`),f=parseFloat(r[`padding${u[0]}`]),p=parseFloat(r[`padding${u[1]}`]),h=parseFloat(r[`margin${u[0]}`]),d=parseFloat(r[`margin${u[1]}`]),_=parseFloat(r[`border${u[0]}Width`]),m=parseFloat(r[`border${u[1]}Width`]);return{delay:t,duration:n,easing:i,css:b=>`overflow: hidden;opacity: ${Math.min(b*20,1)*s};${l}: ${b*c}px;padding-${a[0]}: ${b*f}px;padding-${a[1]}: ${b*p}px;margin-${a[0]}: ${b*h}px;margin-${a[1]}: ${b*d}px;border-${a[0]}-width: ${b*_}px;border-${a[1]}-width: ${b*m}px;`}}var Mn=["second","minute","hour","day","week","month","year"];function Dn(e,t){if(t===0)return["just now","right now"];var n=Mn[Math.floor(t/2)];return e>1&&(n+="s"),[e+" "+n+" ago","in "+e+" "+n]}var Hn=["秒","分钟","小时","天","周","个月","年"];function $n(e,t){if(t===0)return["刚刚","片刻后"];var n=Hn[~~(t/2)];return[e+" "+n+"前",e+" "+n+"后"]}var Ge={},yt=function(e,t){Ge[e]=t},Bn=function(e){return Ge[e]||Ge.en_US},Je=[60,60,24,7,365/7/12,12];function wt(e){return e instanceof Date?e:!isNaN(e)||/^\d+$/.test(e)?new Date(parseInt(e)):(e=(e||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(e))}function Vn(e,t){var n=e<0?1:0;e=Math.abs(e);for(var i=e,o=0;e>=Je[o]&&o<Je.length;o++)e/=Je[o];return e=Math.floor(e),o*=2,e>(o===0?9:1)&&(o+=1),t(e,o,i)[n].replace("%s",e.toString())}function zn(e,t){var n=t?wt(t):new Date;return(+n-+wt(e))/1e3}var kt=function(e,t,n){var i=zn(e,n&&n.relativeDate);return Vn(i,Bn(t))};yt("en_US",Dn),yt("zh_CN",$n);function Rn(e){var c;let t,n,i,o=(((c=e[1])==null?void 0:c.displayLabel)||e[0].creator.name)+"",r,s,l;return t=new he({props:{src:gt}}),{c(){var a;G(t.$$.fragment),n=O(),i=S("span"),r=V(o),E(i,"class","model-info svelte-1txf28c"),E(i,"data-tooltip",s=(a=e[1])==null?void 0:a.displayTooltip)},m(a,u){W(t,a,u),k(a,n,u),k(a,i,u),v(i,r),l=!0},p(a,[u]){var f,p;(!l||u&3)&&o!==(o=(((f=a[1])==null?void 0:f.displayLabel)||a[0].creator.name)+"")&&re(r,o),(!l||u&2&&s!==(s=(p=a[1])==null?void 0:p.displayTooltip))&&E(i,"data-tooltip",s)},i(a){l||(A(t.$$.fragment,a),l=!0)},o(a){N(t.$$.fragment,a),l=!1},d(a){a&&(y(n),y(i)),X(t,a)}}}function In(e,t,n){let i;const o=[{creatorName:"mapKurator:ocr",displayLabel:"mapKurator",displayTooltip:"mapKurator AI text recognition model"},{creatorName:"mapKurator:post-ocr-correction",displayLabel:"mapKurator+",displayTooltip:"mapKurator AI text recognition model with Post-OCR correction"}];let{opts:r}=t,{transcription:s}=t;const l=r.models?[...r.models,...o.filter(c=>!r.models.find(a=>a.creatorName===c.creatorName))]:o;return e.$$set=c=>{"opts"in c&&n(2,r=c.opts),"transcription"in c&&n(0,s=c.transcription)},e.$$.update=()=>{e.$$.dirty&1&&n(1,i=l.find(c=>c.creatorName===s.creator.name))},[s,i,r]}class On extends me{constructor(t){super(),pe(this,t,In,Rn,de,{opts:2,transcription:0})}}function Et(e,t,n){const i=e.slice();return i[3]=t[n],i}function Ct(e){let t,n,i,o=mt(e[0]),r=[];for(let l=0;l<o.length;l+=1)r[l]=At(Et(e,o,l));const s=l=>N(r[l],1,1,()=>{r[l]=null});return{c(){t=S("ul");for(let l=0;l<r.length;l+=1)r[l].c();E(t,"class","all-transcriptions svelte-f8q5bo")},m(l,c){k(l,t,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(t,null);i=!0},p(l,c){if(c&5){o=mt(l[0]);let a;for(a=0;a<o.length;a+=1){const u=Et(l,o,a);r[a]?(r[a].p(u,c),A(r[a],1)):(r[a]=At(u),r[a].c(),A(r[a],1),r[a].m(t,null))}for(te(),a=o.length;a<r.length;a+=1)s(a);ne()}},i(l){if(!i){for(let c=0;c<o.length;c+=1)A(r[c]);l&&Ae(()=>{i&&(n||(n=pt(t,vt,{duration:120},!0)),n.run(1))}),i=!0}},o(l){r=r.filter(Boolean);for(let c=0;c<r.length;c+=1)N(r[c]);l&&(n||(n=pt(t,vt,{duration:120},!1)),n.run(0)),i=!1},d(l){l&&y(t),Wt(r,l),l&&n&&n.end()}}}function Fn(e){let t=e[3].creator.name+"",n;return{c(){n=V(t)},m(i,o){k(i,n,o)},p(i,o){o&1&&t!==(t=i[3].creator.name+"")&&re(n,t)},i:L,o:L,d(i){i&&y(n)}}}function Un(e){let t,n;return t=new On({props:{opts:e[2],transcription:e[3]}}),{c(){G(t.$$.fragment)},m(i,o){W(t,i,o),n=!0},p(i,o){const r={};o&4&&(r.opts=i[2]),o&1&&(r.transcription=i[3]),t.$set(r)},i(i){n||(A(t.$$.fragment,i),n=!0)},o(i){N(t.$$.fragment,i),n=!1},d(i){X(t,i)}}}function At(e){let t,n=e[3].value+"",i,o,r,s=kt(e[3].created)+"",l,c,a,u,f,p;const h=[Un,Fn],d=[];function _(m,b){var P;return((P=m[3].creator)==null?void 0:P.type)==="Software"?0:1}return a=_(e),u=d[a]=h[a](e),{c(){t=S("li"),i=V(n),o=O(),r=S("span"),l=V(s),c=V(" by "),u.c(),f=O(),E(r,"class","transcribed-by"),E(t,"class","svelte-f8q5bo")},m(m,b){k(m,t,b),v(t,i),v(t,o),v(t,r),v(r,l),v(r,c),d[a].m(r,null),v(t,f),p=!0},p(m,b){(!p||b&1)&&n!==(n=m[3].value+"")&&re(i,n),(!p||b&1)&&s!==(s=kt(m[3].created)+"")&&re(l,s);let P=a;a=_(m),a===P?d[a].p(m,b):(te(),N(d[P],1,1,()=>{d[P]=null}),ne(),u=d[a],u?u.p(m,b):(u=d[a]=h[a](m),u.c()),A(u,1),u.m(r,null))},i(m){p||(A(u),p=!0)},o(m){N(u),p=!1},d(m){m&&y(t),d[a].d()}}}function jn(e){let t,n,i=e[1]&&Ct(e);return{c(){i&&i.c(),t=ge()},m(o,r){i&&i.m(o,r),k(o,t,r),n=!0},p(o,[r]){o[1]?i?(i.p(o,r),r&2&&A(i,1)):(i=Ct(o),i.c(),A(i,1),i.m(t.parentNode,t)):i&&(te(),N(i,1,1,()=>{i=null}),ne())},i(o){n||(A(i),n=!0)},o(o){N(i),n=!1},d(o){o&&y(t),i&&i.d(o)}}}function Kn(e,t,n){let{transcriptions:i}=t,{open:o}=t,{opts:r}=t;return e.$$set=s=>{"transcriptions"in s&&n(0,i=s.transcriptions),"open"in s&&n(1,o=s.open),"opts"in s&&n(2,r=s.opts)},[i,o,r]}class Zn extends me{constructor(t){super(),pe(this,t,Kn,jn,de,{transcriptions:0,open:1,opts:2})}}const Wn={a:{viewBox:"0 0 24 24",fill:"none"},c:'<path d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z" fill="currentColor"></path>'};function Xn(e){let t;return{c(){t=V("Confirm Delete")},m(n,i){k(n,t,i)},p:L,d(n){n&&y(t)}}}function Yn(e){let t=e[0].deletePromptHeading+"",n;return{c(){n=V(t)},m(i,o){k(i,n,o)},p(i,o){o&1&&t!==(t=i[0].deletePromptHeading+"")&&re(n,t)},d(i){i&&y(n)}}}function qn(e){let t;return{c(){t=V("Are you sure you want to delete this transcription?")},m(n,i){k(n,t,i)},p:L,d(n){n&&y(t)}}}function Gn(e){let t=e[0].deletePromptText+"",n;return{c(){n=V(t)},m(i,o){k(i,n,o)},p(i,o){o&1&&t!==(t=i[0].deletePromptText+"")&&re(n,t)},d(i){i&&y(n)}}}function Jn(e){let t,n,i,o,r,s,l,c,a,u,f,p,h,d,_,m;o=new he({props:{src:Wn}});function b(w,T){return w[0].deletePromptHeading?Yn:Xn}let P=b(e),D=P(e);function H(w,T){return w[0].deletePromptText?Gn:qn}let z=H(e),F=z(e);return{c(){t=S("div"),n=S("div"),i=S("button"),G(o.$$.fragment),r=O(),s=S("h1"),D.c(),l=O(),c=S("p"),F.c(),a=O(),u=S("div"),f=S("button"),f.textContent="Cancel",p=O(),h=S("button"),h.textContent="Delete",E(i,"class","close svelte-8tsm9c"),E(s,"class","svelte-8tsm9c"),E(c,"class","svelte-8tsm9c"),E(f,"class","cancel svelte-8tsm9c"),E(h,"class","delete svelte-8tsm9c"),E(u,"class","buttons svelte-8tsm9c"),E(n,"class","modal svelte-8tsm9c"),E(t,"class","modal-wrapper svelte-8tsm9c")},m(w,T){k(w,t,T),v(t,n),v(n,i),W(o,i,null),v(n,r),v(n,s),D.m(s,null),v(n,l),v(n,c),F.m(c,null),v(n,a),v(n,u),v(u,f),v(u,p),v(u,h),d=!0,_||(m=[j(i,"click",e[2]),j(f,"click",e[2]),j(h,"click",e[1])],_=!0)},p(w,[T]){P===(P=b(w))&&D?D.p(w,T):(D.d(1),D=P(w),D&&(D.c(),D.m(s,null))),z===(z=H(w))&&F?F.p(w,T):(F.d(1),F=z(w),F&&(F.c(),F.m(c,null)))},i(w){d||(A(o.$$.fragment,w),d=!0)},o(w){N(o.$$.fragment,w),d=!1},d(w){w&&y(t),X(o),D.d(),F.d(),_=!1,oe(m)}}}function Qn(e,t,n){let{opts:i}=t;const o=Oe(),r=()=>o("delete"),s=()=>o("cancel");return e.$$set=l=>{"opts"in l&&n(0,i=l.opts)},[i,r,s]}class xn extends me{constructor(t){super(),pe(this,t,Qn,Jn,de,{opts:0})}}function St(e){let t,n,i,o,r,s;return{c(){t=S("div"),n=new Yt(!1),i=V(" · "),o=S("button"),o.textContent="Hide message",n.a=i,E(o,"class","svelte-rt6s8e"),E(t,"class","r8s-edit-instructions svelte-rt6s8e")},m(l,c){k(l,t,c),n.m(e[0],t),v(t,i),v(t,o),r||(s=j(o,"click",e[2]),r=!0)},p(l,c){c&1&&n.p(l[0])},d(l){l&&y(t),r=!1,s()}}}function ei(e){let t,n=e[1]&&St(e);return{c(){n&&n.c(),t=ge()},m(i,o){n&&n.m(i,o),k(i,t,o)},p(i,[o]){i[1]?n?n.p(i,o):(n=St(i),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:L,o:L,d(i){i&&y(t),n&&n.d(i)}}}function ti(e,t,n){let{text:i=`<strong>Transcribed by Artificial Intelligence.</strong> Please 
    help improve our data by confirming or 
    correcting. <a href="#">Learn more</a>`}=t,o=!localStorage.getItem("r8s-disable-ai-prompt");const r=()=>{localStorage.setItem("r8s-disable-ai-prompt","true"),n(1,o=!1)};return e.$$set=s=>{"text"in s&&n(0,i=s.text)},[i,o,r]}class ni extends me{constructor(t){super(),pe(this,t,ti,ei,de,{text:0})}}const ii=e=>(e.body?Array.isArray(e.body)?e.body:[e.body]:[]).filter(i=>!i.purpose||i.purpose==="transcribing").slice().sort((i,o)=>i.created>(o==null?void 0:o.created)?-1:1),oi=e=>{let t;const n=e.slice().sort((o,r)=>o.created<r.created?1:-1),i=n.filter(o=>{var r;return((r=o.creator)==null?void 0:r.type)==="Person"});if(i.length>0)t=i[0];else{const o=n.find(r=>{var s,l;return((s=r.creator)==null?void 0:s.type)==="Software"&&((l=r.creator)==null?void 0:l.name)==="mapKurator:ocr"});o?t=o:t=n.length>0?n[0]:void 0}return t},Lt=e=>{var t,n;return e!=null&&((t=e.creator)==null?void 0:t.type)==="Software"&&((n=e.creator)==null?void 0:n.name)==="mapKurator:ocr"},ri=e=>!!(e.body?Array.isArray(e.body)?e.body:[e.body]:[]).find(i=>i.purpose==="verifying");function si(e){let t,n,i,o,r=e[4].length-1+"",s,l,c,a,u,f,p,h;i=new he({props:{src:hn}});let d=!e[1].readOnly&&Nt(e);return u=new Zn({props:{open:e[8],transcriptions:e[4],opts:e[1]}}),{c(){t=S("p"),n=S("button"),G(i.$$.fragment),o=O(),s=V(r),l=V(" more transcriptions"),c=O(),d&&d.c(),a=O(),G(u.$$.fragment),E(n,"class","show-all svelte-15pvt5b"),He(n,"open",e[8]),E(t,"class","transcription-details transcription-count svelte-15pvt5b")},m(_,m){k(_,t,m),v(t,n),W(i,n,null),v(n,o),v(n,s),v(n,l),v(t,c),d&&d.m(t,null),k(_,a,m),W(u,_,m),f=!0,p||(h=j(n,"click",e[26]),p=!0)},p(_,m){(!f||m[0]&16)&&r!==(r=_[4].length-1+"")&&re(s,r),(!f||m[0]&256)&&He(n,"open",_[8]),_[1].readOnly?d&&(d.d(1),d=null):d?d.p(_,m):(d=Nt(_),d.c(),d.m(t,null));const b={};m[0]&256&&(b.open=_[8]),m[0]&16&&(b.transcriptions=_[4]),m[0]&2&&(b.opts=_[1]),u.$set(b)},i(_){f||(A(i.$$.fragment,_),A(u.$$.fragment,_),f=!0)},o(_){N(i.$$.fragment,_),N(u.$$.fragment,_),f=!1},d(_){_&&(y(t),y(a)),X(i),d&&d.d(),X(u,_),p=!1,h()}}}function li(e){let t,n,i,o,r,s,l;const c=[ci,ai],a=[];function u(p,h){var d;return h[0]&4&&(i=null),i==null&&(i=!!Lt(p[2])),i?0:(d=p[2].creator)!=null&&d.name?1:-1}~(o=u(e,[-1,-1]))&&(r=a[o]=c[o](e));let f=!e[1].readOnly&&Pt(e);return{c(){t=S("p"),n=V("Transcribed by "),r&&r.c(),s=ge(),f&&f.c(),E(t,"class","transcription-details transcribed-by svelte-15pvt5b")},m(p,h){k(p,t,h),v(t,n),~o&&a[o].m(t,null),v(t,s),f&&f.m(t,null),l=!0},p(p,h){let d=o;o=u(p,h),o===d?~o&&a[o].p(p,h):(r&&(te(),N(a[d],1,1,()=>{a[d]=null}),ne()),~o?(r=a[o],r?r.p(p,h):(r=a[o]=c[o](p),r.c()),A(r,1),r.m(t,s)):r=null),p[1].readOnly?f&&(f.d(1),f=null):f?f.p(p,h):(f=Pt(p),f.c(),f.m(t,null))},i(p){l||(A(r),l=!0)},o(p){N(r),l=!1},d(p){p&&y(t),~o&&a[o].d(),f&&f.d()}}}function Nt(e){let t,n,i,o,r,s=!e[3]&&Tt(e);return{c(){t=V(`· [ \r
          `),n=S("button"),n.textContent="Edit",s&&s.c(),i=V(`\r
        ]`),E(n,"class","action add-transcription svelte-15pvt5b")},m(l,c){k(l,t,c),k(l,n,c),s&&s.m(l,c),k(l,i,c),o||(r=j(n,"click",e[16]),o=!0)},p(l,c){l[3]?s&&(s.d(1),s=null):s?s.p(l,c):(s=Tt(l),s.c(),s.m(i.parentNode,i))},d(l){l&&(y(t),y(n),y(i)),s&&s.d(l),o=!1,r()}}}function Tt(e){let t,n,i,o;return{c(){t=V(" | "),n=S("button"),n.textContent="Confirm",E(n,"class","action confirm svelte-15pvt5b")},m(r,s){k(r,t,s),k(r,n,s),i||(o=j(n,"click",e[17]),i=!0)},p:L,d(r){r&&(y(t),y(n)),i=!1,o()}}}function ai(e){var o;let t=((o=e[2].creator)==null?void 0:o.name)+"",n,i;return{c(){n=V(t),i=O()},m(r,s){k(r,n,s),k(r,i,s)},p(r,s){var l;s[0]&4&&t!==(t=((l=r[2].creator)==null?void 0:l.name)+"")&&re(n,t)},i:L,o:L,d(r){r&&(y(n),y(i))}}}function ci(e){let t,n,i;return t=new he({props:{src:gt}}),{c(){G(t.$$.fragment),n=V(" mapKurator ")},m(o,r){W(t,o,r),k(o,n,r),i=!0},p:L,i(o){i||(A(t.$$.fragment,o),i=!0)},o(o){N(t.$$.fragment,o),i=!1},d(o){o&&y(n),X(t,o)}}}function Pt(e){let t,n,i,o,r,s=!e[3]&&Mt(e);return{c(){t=V(`· [ \r
          `),n=S("button"),n.textContent="Edit",s&&s.c(),i=V(`\r
        ]`),E(n,"class","action add-transcription svelte-15pvt5b")},m(l,c){k(l,t,c),k(l,n,c),s&&s.m(l,c),k(l,i,c),o||(r=j(n,"click",e[16]),o=!0)},p(l,c){l[3]?s&&(s.d(1),s=null):s?s.p(l,c):(s=Mt(l),s.c(),s.m(i.parentNode,i))},d(l){l&&(y(t),y(n),y(i)),s&&s.d(l),o=!1,r()}}}function Mt(e){let t,n,i,o;return{c(){t=V(" | "),n=S("button"),n.textContent="Confirm",E(n,"class","action confirm svelte-15pvt5b")},m(r,s){k(r,t,s),k(r,n,s),i||(o=j(n,"click",e[17]),i=!0)},p:L,d(r){r&&(y(t),y(n)),i=!1,o()}}}function Dt(e){let t,n,i,o,r,s,l,c,a,u,f,p;return o=new he({props:{src:mn}}),{c(){t=S("div"),n=S("div"),i=S("button"),G(o.$$.fragment),r=O(),s=S("div"),l=S("button"),l.textContent="Cancel",c=O(),a=S("button"),a.textContent="Save Edits",E(i,"class","delete svelte-15pvt5b"),E(n,"class","left"),E(l,"class","cancel svelte-15pvt5b"),E(a,"class","ok svelte-15pvt5b"),E(s,"class","right-slot"),E(t,"class","r8s-hover-buttons svelte-15pvt5b")},m(h,d){k(h,t,d),v(t,n),v(n,i),W(o,i,null),v(t,r),v(t,s),v(s,l),v(s,c),v(s,a),u=!0,f||(p=[j(i,"click",e[27]),j(l,"click",e[13]),j(a,"click",e[12])],f=!0)},p:L,i(h){u||(A(o.$$.fragment,h),u=!0)},o(h){N(o.$$.fragment,h),u=!1},d(h){h&&y(t),X(o),f=!1,oe(p)}}}function Ht(e){let t,n;return t=new ni({props:{text:e[1].crowdsourcePrompt}}),{c(){G(t.$$.fragment)},m(i,o){W(t,i,o),n=!0},p(i,o){const r={};o[0]&2&&(r.text=i[1].crowdsourcePrompt),t.$set(r)},i(i){n||(A(t.$$.fragment,i),n=!0)},o(i){N(t.$$.fragment,i),n=!1},d(i){X(t,i)}}}function $t(e){let t,n;return t=new xn({props:{opts:e[1]}}),t.$on("cancel",e[28]),t.$on("delete",e[15]),{c(){G(t.$$.fragment)},m(i,o){W(t,i,o),n=!0},p(i,o){const r={};o[0]&2&&(r.opts=i[1]),t.$set(r)},i(i){n||(A(t.$$.fragment,i),n=!0)},o(i){N(t.$$.fragment,i),n=!1},d(i){X(t,i)}}}function fi(e){let t,n,i,o,r,s,l,c,a,u,f,p,h,d,_,m,b,P,D;r=new he({props:{src:_n}}),c=new Tn({props:{isEditable:e[1].readOnly?!1:e[7],isVerified:e[3],transcription:e[2]}}),c.$on("click",e[25]),c.$on("change",e[11]),c.$on("save",e[12]),c.$on("cancel",e[13]);const H=[li,si],z=[];function F(g,B){return g[4].length===1?0:g[4].length>1?1:-1}~(u=F(e))&&(f=z[u]=H[u](e));let w=e[7]&&Dt(e),T=e[10]&&Ht(e),$=e[9]&&$t(e);return{c(){t=S("div"),n=S("div"),i=S("div"),o=S("button"),G(r.$$.fragment),s=O(),l=S("div"),G(c.$$.fragment),a=O(),f&&f.c(),p=O(),w&&w.c(),h=O(),T&&T.c(),_=O(),$&&$.c(),m=ge(),E(o,"class","close svelte-15pvt5b"),E(i,"class","right svelte-15pvt5b"),E(n,"class","r8s-hover-buttons top svelte-15pvt5b"),E(l,"class","r8s-hover-content svelte-15pvt5b"),E(t,"class","r8s-hover svelte-15pvt5b"),E(t,"style",d=`top: ${e[0]?e[0].offsetY:e[6]}px; left: ${e[0]?e[0].offsetX:e[5]}px`),He(t,"editable",e[7])},m(g,B){k(g,t,B),v(t,n),v(n,i),v(i,o),W(r,o,null),v(t,s),v(t,l),W(c,l,null),v(l,a),~u&&z[u].m(l,null),v(t,p),w&&w.m(t,null),v(t,h),T&&T.m(t,null),k(g,_,B),$&&$.m(g,B),k(g,m,B),b=!0,P||(D=[j(o,"click",e[14]),Ft(un.call(null,t))],P=!0)},p(g,B){const Y={};B[0]&130&&(Y.isEditable=g[1].readOnly?!1:g[7]),B[0]&8&&(Y.isVerified=g[3]),B[0]&4&&(Y.transcription=g[2]),c.$set(Y);let le=u;u=F(g),u===le?~u&&z[u].p(g,B):(f&&(te(),N(z[le],1,1,()=>{z[le]=null}),ne()),~u?(f=z[u],f?f.p(g,B):(f=z[u]=H[u](g),f.c()),A(f,1),f.m(l,null)):f=null),g[7]?w?(w.p(g,B),B[0]&128&&A(w,1)):(w=Dt(g),w.c(),A(w,1),w.m(t,h)):w&&(te(),N(w,1,1,()=>{w=null}),ne()),g[10]?T?(T.p(g,B),B[0]&1024&&A(T,1)):(T=Ht(g),T.c(),A(T,1),T.m(t,null)):T&&(te(),N(T,1,1,()=>{T=null}),ne()),(!b||B[0]&97&&d!==(d=`top: ${g[0]?g[0].offsetY:g[6]}px; left: ${g[0]?g[0].offsetX:g[5]}px`))&&E(t,"style",d),(!b||B[0]&128)&&He(t,"editable",g[7]),g[9]?$?($.p(g,B),B[0]&512&&A($,1)):($=$t(g),$.c(),A($,1),$.m(m.parentNode,m)):$&&(te(),N($,1,1,()=>{$=null}),ne())},i(g){b||(A(r.$$.fragment,g),A(c.$$.fragment,g),A(f),A(w),A(T),A($),b=!0)},o(g){N(r.$$.fragment,g),N(c.$$.fragment,g),N(f),N(w),N(T),N($),b=!1},d(g){g&&(y(t),y(_),y(m)),X(r),X(c),~u&&z[u].d(),w&&w.d(),T&&T.d(),$&&$.d(g),P=!1,oe(D)}}}function ui(e,t,n){let i,o,r,s;const l=Oe();let{viewer:c}=t,{annotation:a}=t,{originalEvent:u}=t,{user:f}=t,{opts:p}=t,{state:h}=t,{editable:d}=t,_,m;const{store:b}=h;let P=!1,D=!1,H=a,z=!1;d&&(P=!0);const F=M=>{const J=Array.isArray(H.bodies)?H.bodies:[H.bodies],ae=anno.getUser(),ce={type:"TextualBody",purpose:"transcribing",value:M.detail,creator:{id:ae.id,type:"Person",name:"name"in f?f.name:f.id},created:new Date};n(18,a={...H,bodies:[...J,ce]})},w=()=>{l("save",a),n(24,H=a),n(7,P=!1)},T=()=>{l("cancel",H),n(18,a=H),n(7,P=!1)},$=()=>{l("cancel",H),n(18,a=H),n(7,P=!1)},g=()=>l("delete"),B=()=>{n(7,P=!0),l("edit")},Y=M=>{const J=b.getAnnotation(M),{minX:ae,minY:ce,maxX:Re,maxY:Qe}=J.target.selector.geometry.bounds,Ne=14,ie=c.element.getBoundingClientRect().top,Te=c.element.getBoundingClientRect().left,Pe=c.viewport.imageToViewerElementCoordinates(new Z.Point(ae,ce)),Me=c.viewport.imageToViewerElementCoordinates(new Z.Point(Re,Qe));n(5,_=Te+Me.x+Ne),n(6,m=ie+Pe.y)},le=()=>{const M=Array.isArray(H.body)?H.body:[H.body],J=anno.getUser(),ae={type:"TextualBody",purpose:"verifying",value:o==null?void 0:o.value,creator:{id:J.id,type:"Person",name:J.name},created:new Date},ce={...H,body:[...M,ae]};n(24,H=ce),n(7,P=!1),l("confirm",ce)};xt(()=>{const M=()=>{Y(a.id)};return c.addHandler("update-viewport",M),()=>{c.removeHandler("update-viewport",M)}});const Le=()=>n(8,D=!D),we=()=>n(8,D=!D),ke=()=>n(9,z=!0),Q=()=>n(9,z=!1);return e.$$set=M=>{"viewer"in M&&n(19,c=M.viewer),"annotation"in M&&n(18,a=M.annotation),"originalEvent"in M&&n(0,u=M.originalEvent),"user"in M&&n(20,f=M.user),"opts"in M&&n(1,p=M.opts),"state"in M&&n(21,h=M.state),"editable"in M&&n(22,d=M.editable)},e.$$.update=()=>{e.$$.dirty[0]&16777216&&n(4,i=ii(H)),e.$$.dirty[0]&16&&n(2,o=oi(i)),e.$$.dirty[0]&16777216&&n(3,r=ri(H)),e.$$.dirty[0]&14&&n(10,s=!(p.readOnly||r||!Lt(o)))},[u,p,o,r,i,_,m,P,D,z,s,F,w,T,$,g,B,le,a,c,f,h,d,Y,H,Le,we,ke,Q]}class di extends me{constructor(t){super(),pe(this,t,ui,fi,de,{viewer:19,annotation:18,originalEvent:0,user:20,opts:1,state:21,editable:22,setPosition:23},null,[-1,-1])}get setPosition(){return this.$$.ctx[23]}}class pi{constructor(t,n={}){K(this,"anno");K(this,"opts");K(this,"popup");K(this,"isEditing");K(this,"beforeEdit");K(this,"showPopup",(t,n,i)=>{this.popup&&this.hidePopup(),this.beforeEdit=t,this.popup=new di({target:document.body,props:{annotation:t,originalEvent:n,user:this.anno.getUser(),opts:this.opts,state:this.anno.state,viewer:this.anno.viewer,editable:i}}),this.popup.setPosition(t.id),this.popup.$on("confirm",o=>{this.isEditing=!1,this.hidePopup(),this.anno.updateAnnotation(o.detail)}),this.popup.$on("save",o=>{this.isEditing=!1,this.hidePopup(),typeof exitEditMode=="function"&&exitEditMode(this.anno);const r=this.anno.getAnnotationById(t.id),s={...o.detail,target:{...r.target}};this.anno.updateAnnotation(s)}),this.popup.$on("cancel",()=>{this.isEditing=!1,this.anno.updateAnnotation(this.beforeEdit),this.hidePopup(),this.anno.setSelected()}),this.popup.$on("edit",()=>{this.isEditing=!0,this.anno.setSelected(t.id)}),this.popup.$on("delete",()=>{this.isEditing=!1,this.hidePopup(),this.anno.removeAnnotation(t)})});K(this,"hidePopup",()=>{this.beforeEdit=void 0,this.popup&&(this.popup.$destroy(),this.popup=void 0)});this.anno=t,this.opts=n;let i;document.body.addEventListener("pointermove",o=>i=o),t.on("clickAnnotation",(o,r)=>{console.log("click",o,r),this.isEditing||(o?this.showPopup(o,r,!1):this.hidePopup())}),t.on("createAnnotation",o=>{this.showPopup(o,i,!0)}),document.addEventListener("keydown",o=>{o.key==="Escape"&&(this.isEditing=!1,this.hidePopup(),this.anno.setSelected(),typeof exitEditMode=="function"&&exitEditMode())})}}return pi});
//# sourceMappingURL=luna-annotorious.js.map

</script>

</body>
</html>
