"use strict";var adn=adn||{};adn.calls=adn.calls||[],adn.version="9baa86eabc90fc38e2104a855d3f3974ed7b619a";try{!function(C,P,T){var c="ADN_DEV_SCRIPT",u=!!(P.getElementById(c)||{}).src;if(C.out&&!u)return C.out.devOutput("adn.out is already defined","initial check");var I,n,p,d,b,m,l,g,E={env:{localhost:{id:"localhost",as:"localhost:8078",api:"http://localhost:8079/api/v1/creativepreview/"},lcl:{id:"lcl",as:"adserver.dev.lcl.test",dt:"dev.data.lcl.test"},andemu:{id:"andemu",as:"10.0.2.2:8078"},dev:{id:"dev",as:"adserver.dev.adnuntius.com",dt:"dev.data.adnuntius.com",api:"https://api.dev.adnuntius.com/api/v1/creativepreview/"},staging:{id:"staging",as:"adserver.staging.adnuntius.com",dt:"staging.data.adnuntius.com",api:"https://api.staging.adnuntius.com/api/v1/creativepreview/"},production:{id:"production",as:"delivery.adnuntius.com",dt:"data.adnuntius.com",api:"https://api.adnuntius.com/api/v1/creativepreview/"},cloudflare:{id:"cloudflare",as:"ads.adnuntius.delivery",dt:"data.adnuntius.com",api:"https://api.adnuntius.com/api/v1/creativepreview/"},limited:{id:"limited",as:"limited.delivery.adnuntius.com",dt:"data.adnuntius.com"}},dn:{as:"delivery.",dt:"data."},sync:{PLATFORM_161:"https://ads.creative-serving.com/cm?redir=https%3A%2F%2Fdata.adnuntius.com%2Fsync%3FbrowserId%3D{BROWSER_ID}%26folderId%3D{FOLDER_ID}%26externalSystemType%3DP161%26externalSystemUserId%3D%24%7BUUID%7D"},impReg:{manual:"manual"},events:{CUSTOM:"CUSTOM"},methodEnums:{ifr:"ifr",composed:"composed",preview:"preview",previewDirect:"previewDirect",creativeTag:"creativeTag"},loadEnums:{lazy:"lazy",lazyRequest:"lazyRequest"},requestMode:{hasTarget:"hasTarget",default:"default"},requestTiming:{immediate:"immediate",onReady:"onReady",onLoad:"onLoad"},syncAds:["//pagead2.googlesyndication.com/pagead/show_ads.js"],postMessageType:{toParentImpression:"toParentImpression",toParentResponse:"toParentResponse",toParentPageLoad:"toParentPageLoad",toParentResize:"toParentResize",toParentUpdateAd:"toParentUpdateAd",toParentSubscribe:"toParentSubscribe",toParentGetAdUnitInfo:"toParentGetAdUnitInfo",toParentFunctions:"toParentFunctions",toParentAllChildrenViewed:"toParentAllChildrenViewed",toParentAdVisibilityEvent:"toParentAdVisibilityEvent",toParentCustomEvent:"toParentCustomEvent",toParentIsolateAdVisibilityEvent:"toParentIsolateAdVisibilityEvent",toChildViewability:"toChildViewability",toChildPubs:"toChildPubs",toChildAdUnitInfo:"toChildAdUnitInfo"},resizeToContent:{resize:"resize",resizeCreative:"resizeCreative",none:"none"},validFormats:{script:"script",iframe:"iframe",js:"js"},composedRequest:{noRequest:"noRequest",requestMade:"requestMade",requestReturned:"requestReturned"},container:{iframe:"iframe",div:"div"},feedback:{console:{allAndInfo:"allAndInfo",all:"all",warnings:"warnings",errors:"errors",silent:"silent"},inScreen:{inAdUnit:"inAdUnit",silent:"silent"}},cwClass:"contentWrapperPerItem",nativeClass:"adnNative",widgetIdPrefix:"adn-widget-",adIdPrefix:"adn-id-",longestTime:9e5,defaultProximity:200,defaultVisibilityPercentage:1,postMessageSrcKey:"messageSrc",postMessageSrcValue:"adn",functionContext:{parent:"parent",inIframe:"inIframe"},viewabilityStatus:{notViewed:"notViewed",divMissing:"divMissing",blocked:"blocked",viewed:"viewed",viewSent:"viewSent"},visibilityStatus:{notVisible:"notVisible",visible:"visible",visibleSent:"visibleSent"},displayStatus:{notDisplayed:"notDisplayed",displayed:"displayed"},adStatus:{init:"init",processed:"processed",procured:"procured",distributed:"distributed"},scriptOverride:{github:{id:"github",url:"https://adnuntius.github.io/examples/adn/adn.src.js"},localhost:{id:"localhost",url:"http://localhost:8001/adn.src.js"},andemu:{id:"andemu",url:"http://10.0.2.2:8001/adn.src.js"}},errorStatus:{noTarget:"noTarget"},previewId:"appPreviewId"},w=0,o=0,S=!0,A=!0,O={},x={},v={},D={},k={},R={},L={},N={},h=!1,M=new RegExp("^[0-9A-Fa-f]{1,20}$"),y="HANDLE_CHILD_PAGE_LOAD",U="allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation",F="adn-external-container",W="data-parent-top",q="data-env",j="data-dn",V="data-imp-reg",B="adn-data-div-",z="adn.metaData",H="adn.conv",r="adn.data",a="adn.data.segments",J=["auId","widgetId","auW","auH","w","h","definedDims","resizeToContent","stack","ifrStyle","targetStyle","retAdsW","retAdsH","ads","dims","retAdCount","targetId","replacements","keywords","kv","userSegments","c","ps","auml","floorPrice","requestArgs","targetClass"],_={},K=[],G={console:E.feedback.console.warnings,inScreen:E.feedback.inScreen.silent},Q=E.composedRequest.noRequest;var X,i,Y=new function(){var i={};this.getItem=function(e){return i[e]},this.setItem=function(e,t){i[e]=t},this.removeItem=function(e){delete i[e]}};C.util={dimension:function(e){if(C.util.isString(e)){var t=C.util.trim(e);return 0===t.length||C.util.endsWith(t,"%")||C.util.endsWith(t,"px")?t:t+"px"}return C.util.isNumber(e)?e+"px":e},isLoopable:function(e){if(C.util.isArray(e))return!0;var t=Object.prototype.toString.call(e);return"[object HTMLCollection]"===t||"[object NodeList]"===t},isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"object"==typeof e&&null!==e&&!C.util.isArray(e)},isInteger:function(e){return parseInt(e,10)===e},isFlexiNumber:function(e){return!isNaN(e)},isNumber:function(e){return"number"==typeof e&&isFinite(e)},isString:function(e){return"string"==typeof e},isDefined:function(e){return null!=e},isNotBlankString:function(e){return C.util.isStringWithChars(e)},isStringWithChars:function(e){return C.util.isString(e)&&0<C.util.trim(e).length},isBlankString:function(e){return C.util.isString(e)&&0===C.util.trim(e).length},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},noop:function(){},hasLocalStorage:function(){if(!1===S)return!1;try{var e=T.localStorage,t="__adn_storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}},uniques:function(e){for(var t=[],i=0,n=e.length;i<n;i++)-1===t.indexOf(e[i])&&""!==e[i]&&t.push(e[i]);return t},isTopWindow:function(){return T.top===T||"localhost:9876"===T.location.host},trim:function(e){return C.util.isString(e)?String.prototype.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):e},getFrameElement:function(){if(X.canAccessLocalStorage())try{return T.frameElement}catch(e){C.out.devOutput("Error looking up frame element")}},endsWith:function(e,t){return C.util.isStringWithChars(e)&&C.util.isStringWithChars(t)&&e.substr(e.length-t.length,t.length)===t},createDelegate:function(e,t){if(!C.util.isObject(e)&&null!==e||!C.util.isFunction(t))return C.out.output("Args not sufficient","createDelegate",e,t);var i=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,0<i.length?Array.prototype.slice.call(arguments,0).concat(i):arguments)}},detachEventListener:function(e,t,i){return C.util.isObject(e)&&t?C.util.isFunction(e.removeEventListener)?e.removeEventListener(t,i,!1):e.detachEvent?e.detachEvent("on"+t,i):C.out.output("Object to attach event listeners is not sufficient","detachEventListener",e,t):C.out.output("Args not sufficient","detachEventListener",e,t)},addEventListener:function(e,t,i,n){return n&&(v[n]=v[n]||[],v[n].push(i)),C.util.isObject(e)&&t?C.util.isFunction(e.addEventListener)?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):C.out.output("Object to attach event listeners is not sufficient","addEventListener",e,t,i):C.out.output("Args not sufficient","addEventListener",e,t,i)},getWindowDims:function(){var e=C.util.getWindowSize();return{w:e.width,h:e.height}},getWindowSize:function(){var e={width:0,height:0};return C.util.isNumber(T.innerWidth)?(e.width=T.innerWidth,e.height=T.innerHeight):P.documentElement&&(P.documentElement.clientWidth||P.documentElement.clientHeight)?(e.width=P.documentElement.clientWidth,e.height=P.documentElement.clientHeight):P.body&&(P.body.clientWidth||P.body.clientHeight)&&(e.width=P.body.clientWidth,e.height=P.body.clientHeight),e},getScrollPos:function(){var e={left:0,top:0};return C.util.isNumber(T.pageYOffset)?(e.top=T.pageYOffset,e.left=T.pageXOffset):P.body&&(P.body.scrollLeft||P.body.scrollTop)?(e.top=P.body.scrollTop,e.left=P.body.scrollLeft):P.documentElement&&(P.documentElement.scrollLeft||P.documentElement.scrollTop)&&(e.top=P.documentElement.scrollTop,e.left=P.documentElement.scrollLeft),e},getElementPosition:function(e){var t={left:0,top:0};if(e.offsetParent)for(;t.left+=e.offsetLeft,t.top+=e.offsetTop,e=e.offsetParent;);return t},getNewAjax:function(e,t,i){if(C.util.isDefined(T.XDomainRequest)&&-1===T.navigator.appVersion.indexOf("MSIE 10")){var n=new T.XDomainRequest;return n.open(e,t),n.contentType="text/plain",n.onerror=C.util.noop,n.ontimeout=C.util.noop,n.onprogress=C.util.noop,n.timeout=C.util.noop,n.onload=C.util.noop,C.util.isFunction(i)&&(n.onload=i),n}var r=new XMLHttpRequest;return r.open(e,t),r.setRequestHeader("Content-Type","text/plain"),C.util.isFunction(i)&&(r.onreadystatechange=i),r},hasValue:function(e,t){var i=!1;return C.util.forEach(e,function(e){if(e===t)return!(i=!0)}),i},find:function(i,n){if(!C.util.isFunction(n)||!C.util.isObject(i)&&!C.util.isLoopable(i)||!C.util.isDefined(i))return C.out.output("Args not sufficient","find",i,n);var r=null;return C.util.forEach(i,function(e,t){if(!0===n.call(i,e,t))return r=e,!1}),r},map:function(i,n){if(!C.util.isFunction(n)||C.util.isString(i)||!C.util.isDefined(i))return C.out.output("Args not sufficient","map",i,n);var r=[];return C.util.forEach(i,function(e,t){r.push(n.call(i,e,t))}),r},filter:function(i,n){if(!C.util.isFunction(n)||C.util.isString(i)||!C.util.isDefined(i))return C.out.output("Args not sufficient","filter",i,n);var r=[];return C.util.forEach(i,function(e,t){!0===n.call(i,e,t)&&r.push(e)}),r},forEach:function(e,t){if(!C.util.isFunction(t)||!C.util.isObject(e)&&!C.util.isLoopable(e)||!C.util.isDefined(e))return C.out.output("Args not sufficient","forEach",e,t);var i;if(C.util.isLoopable(e)){for(var n=e.length,r=[],a=0;a<n;a++)r.push(e[a]);for(a=0;a<n;a++)if(i=r[a],!1===t.call(r,i,a))return i}else for(var s in e)if(e.hasOwnProperty(s)&&(i=e[s],!1===t.call(e,i,s)))return i},loadScriptElements:function(e,a){var t=e.getElementsByTagName("script");C.util.forEach(t,function(e){if(e)if(C.util.isStringWithChars(e.type)&&"text/javascript"!==e.type)C.out.devOutput("Not executing script type","showAdContent",e.type,e);else{var t={};C.util.forEach(e.attributes,function(e){e.specified&&(t[e.name]=e.value)});var i=e.innerHTML,n=e.parentNode;if(e.src){var r=e.src;n.removeChild(e),X.loadScriptSrc(r,n.id||a,t,i)}else n.removeChild(e),X.loadScriptContent(i,n.id||a,t)}})},hasProperties:function(e){if(!C.util.isObject(e))return!1;for(var t in e)if(e.hasOwnProperty(t))return!0;return!1},getElementDimensions:function(e){try{var t=e.getBoundingClientRect();return{w:t.width||t.right-t.left,h:t.height||t.top-t.bottom}}catch(e){return C.out.output("element dimensions failed","getElementDimensions: catch block",e)}},isTrue:function(e){return!0===e||"true"===e}},function(){C.out={simple:function(e,t){T.console.log("%cAdnuntius%c "+e,"background-color: purple; color: white; padding: 2px; border-radius: 3px;","background-color: white; color: black; padding: 0",t)},devOutput:function(e,t){return!(!h&&G.console!==E.feedback.console.all&&G.console!==E.feedback.console.allAndInfo)&&C.out.output("(dev) "+e,t,Array.prototype.slice.call(arguments,2))},infoOutput:function(e,t){return!(!h&&G.console!==E.feedback.console.allAndInfo)&&C.out.output("(dev) "+e,t,Array.prototype.slice.call(arguments,2))},output:function(e,t){if(G.console!==E.feedback.console.silent){var i=Array.prototype.slice.call(arguments,2),n=C.util.filter(i,function(e){return C.util.isFunction(e)}),r=C.util.filter(i,function(e){return!C.util.isFunction(e)}),a=function(e,t,i){e(t,i),C.util.forEach(n,function(e){e({context:t,message:i,args:r})})},s=function(i){r&&r.length&&C.util.forEach(r,function(e,t){C.util.isFunction(e)?n.push(e):i("Arg #"+t,e)})};return T.console&&T.console.warn&&T.console.error&&T.console.log?(C.util.isObject(e)&&0<=e.lineNumber?a(T.console.error,"At "+t+":",e):a(T.console.warn,"At "+t+":",e),s(T.console.log),!1):!1}},warn:function(e){G.console!==E.feedback.console.silent&&T.console&&T.console.warn&&T.console.warn(e)}};function f(e,t){var i,n,r=e.env||E.env.production.id;i=E.env[r]?E.env[r]:E.env.production;var a=!!e.dn&&E.dn[t||"as"]+e.dn,s="http"+(X.isTestAddress(T.location.href)||X.isUnitTest()||r===E.env.localhost.id||r!==E.env.production.id&&"http:"===T.location.protocol?"":"s");n=("https"===e.protocol||"http"===e.protocol?e.protocol:s)+"://";var o=X.isTestAddress(r);h=o||h;var u=a||i[t||"as"];r!==E.env.limited.id&&e.subdomain&&(u=e.subdomain+"."+u),e.adServerHost&&(u=e.adServerHost);var d=h&&0===(r||"").indexOf("http")?r:n+u;return{serverUrlBase:d,baseRequestLoc:d+(o?"?":"/i?")+"tzo="+(new Date).getTimezoneOffset(),isTestEnv:o}}C.lib={setDevMode:function(e){h=!0===e},testingHook:function(e){0===T.location.origin.indexOf("http://localhost")&&(O={},R={},k={},e.adn=C,e.CONSTANTS=E,e.ev=te,e.dom=re,e.readings=ae,e.misc=X,e.conv=ee,e.gComposedAds=R,e.gWidgetSpecs=O,e.gLocalStorage=Y,e.gAdSpecs=k,e.gAdLocs=D,e.gDevMode=h,e.gKeywords=K,e.storageMetadataKey=z,e.storageConversionKey=H,e.storageDataKey=r,e.cookies=ie,e.parentMethods=se,e.pFrameMethods=ne,e.requestMethods=I)},isParentTopWindow:function(){var e=C.inIframe.getIframeArgs()[W];if(C.util.isTrue(e))return!0;var t=P.getElementsByTagName("body")[0];if(t&&t.hasAttribute(W))return C.util.isTrue(t.getAttribute(W));var i=C.util.getFrameElement();return!!C.util.isDefined(i)&&C.util.isTrue(i.getAttribute(W))},getEnv:function(){var e=C.inIframe.getIframeArgs()[q];if(C.util.isStringWithChars(e)&&E.env[e])return E.env[e].id;var t=P.getElementsByTagName("body")[0];if(e=t?t.getAttribute(q):"",C.util.isStringWithChars(e)&&E.env[e])return E.env[e].id;var i=X.getEnvFromHref(X.getParam(T.location,"host"));return i?i.id:E.env.production.id},auPadStart:function(e){return 16<=e.length?e:"0".repeat(16-e.length)+e},getDn:function(){var e=C.inIframe.getIframeArgs()[j];if(C.util.isStringWithChars(e))return e;var t=P.getElementsByTagName("body")[0];return e=t?t.getAttribute(j):"",C.util.isStringWithChars(e)?e:void 0},getAdnDataLocs:function(e){var t=X.clone(e||{});t.protocol="https";var i=f(t,"dt"),n={};return X.copyArgValues(n,t,["browserId","folderId"]),!0!==t.noCookies&&!1!==t.useCookies&&!1!==A||(n.noCookies=!0),{page:i.baseRequestLoc.replace("/i?","/page?")+X.encodeAsUrlParams(n,!0),visitor:i.baseRequestLoc.replace("/i?","/visitor?")+X.encodeAsUrlParams(n,!0),user:i.baseRequestLoc.replace("/i?","/usr?")+X.encodeAsUrlParams(n,!0),sync:i.baseRequestLoc.replace("/i?","/sync?")+X.encodeAsUrlParams(n,!0),segment:i.baseRequestLoc.replace("/i?","/segment?")+X.encodeAsUrlParams(n,!0)}},getRequestLocs:function(e,t){var i=f(e),n={};X.copyArgValues(n,e,["network","usi","siteId","latitude","longitude","segments","uui"]);var r=!1;e.adUnits&&C.util.isArray(e.adUnits)&&(r=!!C.util.find(e.adUnits,function(e){return!1===e.useCookies})),!r&&!0!==e.noCookies&&!1!==e.useCookies&&!1!==A||(n.noCookies=!0),!t||C.util.isTopWindow()||X.supportsIntersectionObserver()||(n.immeasurable=!0);var a={},s=X.getPreviewLi();if(p=!C.util.isTrue(X.getQueryParamsByName("adn-hide-warning")),C.util.isStringWithChars(s)){a.lpl=s;var o=X.getQueryParamsByName("adn-lp-c");C.util.isStringWithChars(o)&&(a.lpc=o)}if(p&&s&&C.util.isTopWindow()){var u=P.createElement("div");u.id="previewDiv",u.style.cssText="position:absolute;z-index:1000;background-color:pink;padding:10px;cursor: pointer",u.innerHTML="<div onclick=\"document.getElementById('previewDiv').style.display='none';\">You are previewing ads delivered by Adnuntius. Previewed ads should have a message like this one in their top-left corner.</div>",P.body.prepend(u),b=s,m=o}if(T.URLSearchParams){var d=new URLSearchParams(T.location.search);if(C.util.isTrue(d.get("adn-params")))for(var l,c=d.keys();(l=c.next())&&!l.done;){var g=d.get(l.value);"adn-params"!==l.value&&C.util.isDefined(g)&&(a[l.value]=g)}}return{imp:i.baseRequestLoc+X.encodeAsUrlParams(n,!0)+(C.util.hasProperties(a)?X.encodeAsUrlParams(a,!0):""),rendered:i.baseRequestLoc.replace("/i?","/b?"),viewable:i.baseRequestLoc.replace("/i?","/v?"),visible:i.baseRequestLoc.replace("/i?","/s?"),custom:i.baseRequestLoc.replace("/i?","/u?"),retargeting:i.baseRequestLoc.replace("/i?","/r?"),conversion:i.baseRequestLoc.replace("/i?","/conv?"),click:i.serverUrlBase+"/c/",preview:i.serverUrlBase+(i.isTestEnv?"?":"/preview?")}},sendRenderedImps:function(e,t,i){if(!C.util.isArray(e))return C.out.devOutput("No tokens to speak of","sendRenderedImps",e,t);var n=C.util.filter(e,function(e){return!_[e]});if(n.length!==e.length&&C.out.devOutput("Block resending same response token multiple times","sendRenderedImps",e,n),n.length<1)return!1;if(!t||C.util.isBlankString(t))return C.out.devOutput("Missing a location","sendRenderedImps",n,t);var r=t;o!==w&&0<w&&(r+="&tripTime="+(o=w)),T.screen&&T.screen.availHeight&&(X.isUnitTest()||(r+=X.encodeAsUrlParams({screen:T.screen.availWidth+"x"+T.screen.availHeight},!0)));var a=C.util.getNewAjax("POST",r,function(){if(a.readyState&&4!==a.readyState)return!1;if((!a.status||200===a.status)&&C.util.isStringWithChars(a.responseText)){var e={};try{e=JSON.parse(a.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block send event",a)}e&&e.metaData&&ie.writeAdvLs(e.metaData,e.network)}}),s={rts:n};return X.setAndReturnMetaData(s,i),a.send(JSON.stringify(s)),C.util.forEach(n,function(e){_[e]=!0}),!0},doDebug:function(n,e,t){if(b&&p&&C.util.find(n.ads,function(e){return e.lineItemId===b&&(!m||e.creativeId===m)})){var i=P.createElement("div");i.style.cssText="position:absolute;background-color:pink;padding:5px;z-index:10000;opacity:0.9;cursor:pointer";var r="div-preview-"+n.widgetId;return i.id=r,i.innerHTML="<div onclick=\"document.getElementById('"+r+"').style.display='none';\">Previewed Ad</>",e.parentNode.insertBefore(i,e),void(t.style.position="relative")}if(G.inScreen===E.feedback.inScreen.inAdUnit){var a=P.createElement("div");a.id=B+n.widgetId;var s="position: absolute;top: 0; left: 0; text-align: left;";s+="border: 1px solid red; background-color: pink; padding: 5px;z-index: 10000;opacity: 0.9;",s+="min-width: 250px;max-width: "+Math.max(e.width,350)+"px; max-height: 500px; overflow: auto",a.style.cssText=s,a.className="adnDebugDataDiv";var o=[];C.util.forEach(n.ads,function(e){o.push({adId:e.id,lineItemId:e.lineItemId,creativeId:e.creativeId,cost:e.cost?e.cost.amount+e.cost.currency:"n/a",bid:e.bid?e.bid.amount+e.bid.currency:"n/a"})});var u="<div style='min-height: 1em;height:auto;'>AU Tag id: <a target='_blank' href='https://admin.adnuntius.com/search?q="+n.auId+"'>"+n.auId+"</a></strong></div>";u+="<div style='padding-bottom: 2px; margin-bottom: 2px; border-bottom: 1px dashed #333;height:auto'><small>",C.util.forEach(n.requestArgs,function(e,t){if("adUnits"!==t)"userId"!==t&&("headerBids"===t&&C.util.isArray(e)?(u+=X.dataOutput(t,e.length+" -- see more in console"),C.out.output("headerBids passed on","debugger",e)):u+=X.dataOutput(t,e));else{var i=C.util.find(e,function(e){return!(e.auId!==n.auId||e.targetId&&e.targetId!==n.targetId||e.targetClass&&e.targetClass!==n.targetClass)});i&&C.util.forEach(i,function(e,t){"auId"!==t&&(u+=X.dataOutput(t,e))})}});var d=ie.getIdsAsObj(n);d.userId&&(u+=X.dataOutput("userId",d.userId)),u+="</small></div>",0===o.length&&(u+="<div><strong>No ads returned for ad call</strong></div>"),C.util.forEach(o,function(e){u+="<div style='min-height: 1em;height: auto;'>LI: <a target='_blank' href='http://admin.adnuntius.com/line-items/line-item/"+e.lineItemId+"'>"+e.lineItemId+"</a> | Cr: <a target='_blank' href='http://admin.adnuntius.com/creatives/creative/"+e.creativeId+"'>"+e.creativeId+"</a> | cost: "+e.cost+" | bid: "+e.bid+"</div>"}),u+="<div style='height:auto;'><small>",C.util.forEach(["Segments","Keywords"],function(e){var t="returned"+e;n[t]&&0<n[t].length&&(u+=X.dataOutput(e.toLowerCase(),n[t]))}),u+="</small></div>",a.innerHTML=u,e.parentNode.insertBefore(a,e),t.style.border="2px solid red",t.style.position="relative"}},showAdContent:function(t,e){var i=X.getDocEl(t),n=R[t.targetId];if(!i)return n&&(n.errorStatus=E.errorStatus.noTarget),C.out.output("Unable to find HTML element","showAdContent",n,t),C.out.warn("Unable to find HTML element on page with the following id: "+t.targetId);n&&(n.errorStatus=""),C.util.isTrue(t.clearTarget)&&(i.innerHTML="");var r=e.html,a=e.matchedAdCount;if((t.container===E.container.div&&C.util.isNumber(a)||0<r.indexOf('data-ad-format="')&&0<r.indexOf("adsbygoogle.js"))&&0===C.util.filter(E.syncAds,function(e){return 0<r.indexOf(e)}).length){if(t.container=E.container.div,0<i.getElementsByTagName("div").length){if(!C.util.isObject(t.refresh))return;i.innerHTML=""}return re.showTargetDiv(i,t),i.innerHTML=X.getAdContentOnly(r,t.widgetId),C.util.loadScriptElements(i,t.widgetId),C.lib.doDebug(t,P.getElementById(t.widgetId),i),!0}if(t.container=E.container.iframe,!C.util.find(i.childNodes,function(e){return e.id===t.widgetId})){var s=C.util.filter(i.childNodes,function(e){var t=e?e.id:"";return t&&0===t.indexOf(E.widgetIdPrefix)})||[];t.serverUrl=null;var o=re.insIframe(t,i),u=X.getAndSetScriptOverride();u&&r.indexOf(u)<0&&(r=r.replace(/<script src="?https?:\/\/[A-Za-z_0-9:.-]{5,50}\/adn.(src.)?js"?><\/script>/g,'<script src="'+u+'" id="'+c+'"><\/script>')),t.isolateSubFrame&&(r=r.replace(/<iframe/g,"<iframe sandbox='"+U+"'"));var d="<body id='"+t.widgetId+"' "+W+"='"+C.util.isTopWindow()+"'";if(t.env&&t.env!==E.env.production.id&&(d+=" "+q+"='"+t.env+"'"),t.impReg&&(d+=" "+V+"='"+t.impReg+"'"),t.dn&&(d+=" "+j+"='"+t.dn+"'"),r=r.replace("<body",d),X.supportsSrcDoc()&&t.isolateFrame)o.setAttribute("srcdoc",r);else{var l=o.contentDocument||o.contentWindow;l&&l.document&&(l=l.document),l||C.out.devOutput("Couldn't find iframeDoc","showAdContent",i,o,l),l.open(),l.write(r),l.close()}return C.util.forEach(s,function(e){e.style.display="none"}),C.lib.doDebug(t,o,i),!0}}}}(),i="012356789bcdfghjklmnpqrstvwxyz",X={uuid:function(){for(var e="",t=0;t<24;t++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},updateSrc:function(e,t,i){if(e.lineItemId?t+=X.encodeAsUrlParams({lineItemId:e.lineItemId},!0):e.creativeSetId?t+=X.encodeAsUrlParams({creativeSetId:e.creativeSetId},!0):e.orderId&&(t+=X.encodeAsUrlParams({orderId:e.orderId},!0)),e.creativeId&&(t+=X.encodeAsUrlParams({creativeId:e.creativeId},!0)),e.targeting&&(t+=X.encodeAsUrlParams({targeting:e.targeting},!0)),!i){var n={};X.copyArgValues(n,e,["auml","ps","c"]),e.keywords&&(n.keywords=e.keywords.slice(0,20)),e.kv&&(n.kv=JSON.stringify(e.kv)),e.replacements&&(n.replacements=JSON.stringify(e.replacements)),e.userSegments&&(n.userSegments=JSON.stringify(e.userSegments)),t+=X.encodeAsUrlParams(n,!0)}return e.dimensions&&(t+=X.encodeAsUrlParams({dimensions:JSON.stringify(e.dimensions)},!0)),t+=X.encodeAsUrlParams({cb:encodeURIComponent(X.uuid())},!0),t+="&clickTrackingUrl="+(0===e.clickTrackingUrl.indexOf("http")?3<e.clickTrackingUrl.indexOf("%3A%2F")?e.clickTrackingUrl:encodeURIComponent(e.clickTrackingUrl):"")},supportsSrcDoc:function(){return"srcdoc"in P.createElement("iframe")},isSrcdocFrame:function(){return"about:srcdoc"===X.getLocationHref()||"null"===T.location.origin},getLocationHref:function(){return T.location.href},canAccessLocalStorage:function(){try{return T.localStorage.getItem("random"),!0}catch(e){return!1}},getImpReg:function(){var e=C.inIframe.getIframeArgs()[V];if(C.util.isStringWithChars(e))return e;var t=P.getElementsByTagName("body")[0];if(t&&t.hasAttribute(V))return t.getAttribute(V);var i=C.util.getFrameElement();return C.util.isDefined(i)?i.getAttribute(V):void 0},supportsIntersectionObserver:function(){return"IntersectionObserver"in T&&"IntersectionObserverEntry"in T&&"intersectionRatio"in T.IntersectionObserverEntry.prototype},getParam:function(e,t){if(C.util.isObject(e))return e[t]},getNewViewability:function(){return{maxPercent:0,prevPercent:0,timeNone:0,timePartly:0,timeHalf:0,timeFully:0,timeIntersect:0,timeStart:0,isViewed:!1}},onDocReady:function(e){"complete"===P.readyState||"interactive"===P.readyState?e():C.util.addEventListener(T,"DOMContentLoaded",e)},onLoad:function(e){"complete"===P.readyState?e():C.util.addEventListener(T,"load",e)},getAdsFromContainer:function(e){return C.util.filter(e.getElementsByTagName("div"),function(e){return-1<e.className.indexOf(E.cwClass)&&0===e.id.indexOf(E.adIdPrefix)})},isVisible:function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},generateAdData:function(e,t,i){return e&&e.ads?e.ads:t&&t.ads&&i?C.util.map(t.ads,function(e){var t=i[e.id];return{adId:e.id,dims:e.dims,creativeId:e.creativeId,rt:e.rt,lineItemId:e.lineItemId,isPrebid:e.isPrebid,definedDims:t?t.definedDims:e.definedDims}}):[]},getAdsInfo:function(e){var n={contentDims:{},definedDims:{},adUnitContainerId:e,adServerHost:"",ads:[]};try{if(n.adsDivEl=P.getElementById(e),!n.adsDivEl)return{};if(n.contentDims=C.util.getElementDimensions(n.adsDivEl),n.adServerHost=n.adsDivEl.getAttribute("data-adserver-host"),n.network=n.adsDivEl.getAttribute("data-network"),0===n.contentDims.w||0===n.contentDims.h){var t=C.util.find(C.util.map(n.adsDivEl.getElementsByTagName("div"),function(e){if(e.style&&("absolute"===e.style.position||"fixed"===e.style.position)){var t=C.util.getElementDimensions(e);if(5<t.w&&5<t.h)return t}return null}),function(e){return!!e});t&&(n.contentDims=t,C.out.infoOutput("Dims for out-of-flow div","getAdsInfo",t,e))}n.definedDims={w:0,h:0},n.ads=C.util.map(X.getAdsFromContainer(n.adsDivEl),function(e){var t=X.dimForAttr(e.getAttribute("data-creative-width")),i=X.dimForAttr(e.getAttribute("data-creative-height"));return n.definedDims.w+=t,n.definedDims.h+=i,{id:e.id,el:e,subdomain:X.dimForAttr(e.getAttribute("data-subdomain")),creativeId:X.dimForAttr(e.getAttribute("data-creative-id")),lineItemId:X.dimForAttr(e.getAttribute("data-line-item-id")),rt:X.dimForAttr(e.getAttribute("data-response-token")),definedDims:{w:t,h:i},dims:C.util.getElementDimensions(e)}});var i=C.util.find(n.ads,function(e){return!!e.subdomain});i&&(n.subdomain=i.subdomain)}catch(e){n.contentDims={}}return n},loadScriptSrc:function(e,t,i,n){if(!C.util.isString(e))return C.out.output("src should be a string","loadScriptSrc",e);try{var r=P.createElement("script");C.util.forEach(i||[],function(e,t){r.setAttribute(t,e)}),C.util.isStringWithChars(n)&&(r.innerHTML=n),r.src=e;var a=C.util.isStringWithChars(t)?P.getElementById(t):t;if(a)a.appendChild(r);else{var s=P.getElementsByTagName("script")[0];s.parentNode.insertBefore(r,s)}}catch(e){return C.out.output(e,"loadScriptSrc: in catch block")}},dimForAttr:function(e){if(C.util.isString(e)){var t=C.util.trim(e),i=parseInt(t,10);return C.util.endsWith(t,"px")?i:i.toString(10)===t?i:e}return C.util.isNumber(e)?e:""},addWidgetIdToProcessAd:function(e,t){var i="adn.inIframe.processAdResponse({ widgetId: '"+t+"', ",n='adn.inIframe.getIframeId("'+t+'"';return e.replace(/adn.inIframe.processAdResponse\({/g,i).replace(/adn.inIframe.getIframeId\(/g,n)},loadScriptContent:function(e,t,i){if(!C.util.isString(e))return C.out.output("content should be a string","loadScriptContent",e);try{var n=P.createElement("script");C.util.forEach(i||{},function(e,t){n.setAttribute(t,e)});var r=P.createTextNode(e);n.appendChild(r),(P.getElementById(t)||P.body).appendChild(n)}catch(e){return C.out.output(e,"loadScriptContent: in catch block")}},applyStyle:function(i,e){return C.util.forEach(e,function(e,t){i.style[t]=e})},parseHashArgs:function(e){var t,i;return X.decodeUrlEncodedPairs((t=e||T.location.href||"",-1<(i=t.indexOf("#"))?t.substr(i+1):""))},parseUrlArgs:function(e){return X.decodeUrlEncodedPairs(e||T.location.search)},clone:function(e){var t=C.util.isObject(e)?{}:C.util.isArray(e)?[]:null;return t?X.assign(t,e):e},assign:function(i,e){return C.util.forEach(e,function(e,t){C.util.isObject(e)?(C.util.isObject(i[t])||(i[t]={}),X.assign(i[t],e)):C.util.isArray(e)?(C.util.isArray(i[t])||(i[t]=[]),function(e,t){for(var i=0;i<t.length;i++)e.push(X.clone(t[i]))}(i[t],e)):i[t]=e}),i},isWidgetId:function(e){var t=C.util.isString(e)?e:X.getParam(e,"widgetId");return C.util.isString(t)&&0===t.indexOf(E.widgetIdPrefix)},copyArgValues:function(i,e,n){return C.util.isArray(n)&&C.util.isObject(i)&&C.util.isObject(e)?(C.util.forEach(e,function(e,t){C.util.isDefined(e)&&C.util.hasValue(n,t)&&(i[t]=X.clone(e))}),i):C.out.output("Args not sufficient","copyArgValues",i,e,n)},decodeUrlEncodedPairs:function(e){if(!C.util.isString(e))return C.out.output("urlEncodedPairs should be a string","decodeUrlEncodedPairs");for(var t={},i=e.replace(/\?/,"").replace(/#/,"").split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(2===r.length){var a=decodeURIComponent(r[0]),s=decodeURIComponent(r[1]);C.util.isDefined(t[a])?(C.util.isArray(t[a])||(t[a]=[t[a]]),t[a].push(s)):t[a]=s}}return t},combineArgs:function(){for(var e={},t=arguments.length,i=0;i<t;i++){var n=arguments[i];C.util.isObject(n)&&X.assign(e,arguments[i])}return e},getPreviewLi:function(){return X.getQueryParamsByName("adn-lp-li")},getQueryParamsByName:function(e){if(!C.util.isString(e)||C.util.isBlankString(e))return null;var t=X.getLocationHref(),i=e.replace(/[[\]]/g,"\\$&"),n=new RegExp("[?&]"+i+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},encodeAsUrlParams:function(e,t){if(C.util.isString(e))return e;var n=[];if(C.util.forEach(e,function(e,t){var i=encodeURIComponent(t)+"=";C.util.isArray(e)?C.util.forEach(e,function(e){n.push(i+encodeURIComponent(C.util.isObject(e)?JSON.stringify(e):e))}):C.util.isObject(e)?n.push(i+encodeURIComponent(JSON.stringify(e))):C.util.isDefined(e)&&!C.util.isBlankString(e)&&n.push(i+encodeURIComponent(e))}),0===n.length)return"";var i=n.join("&");return t?"&"+i:i},isAdnPrice:function(e){return C.util.isObject(e)&&C.util.isNumber(e.amount)&&0<e.amount&&C.util.isString(e.currency)&&3===e.currency.length},postMessageToParent:function(e){return C.util.isObject(T.parent)&&T.parent.postMessage&&C.util.isObject(e)?e.isDivContainer?te.handlePostMessage(e):(e[E.postMessageSrcKey]=E.postMessageSrcValue,void T.parent.postMessage(JSON.stringify(e),"*")):C.out.output("Attributes not sufficient","postMessageToParent")},visibilityEventHandling:function(e,i){C.util.isObject(i.refresh)&&e===i.refresh.event&&0<i.refresh.count&&!d&&T.setTimeout(function(){var e=i.parentArgs||{},t=X.clone(i.auArgs);t.refresh=X.clone(i.refresh),t.refresh.count--,e.requestParams={},t.requestParams={},e.adUnits=[t],delete e.headerBids,C.request(e)},1e3*i.refresh.delay);var t=i[e+"Data"];i[e]&&C.util.isFunction(i[e])&&i[e](t);var n=P.getElementById(B+i.widgetId);n&&t.feedbackText&&(n.innerHTML+="<div><small>"+t.feedbackText+" sent - "+t.creativeId+"</small></div>")},postMessageToChild:function(e,t){return C.util.isObject(t)?C.util.isTrue(t.isDivContainer)?te.handlePostMessage(t):e&&e.contentWindow?e.contentWindow.postMessage?(t[E.postMessageSrcKey]=E.postMessageSrcValue,void e.contentWindow.postMessage(JSON.stringify(t),e.src||"*")):C.out.output("Childframe doesn't support postMessage","postMessageToChild",e,t):C.out.output("Childframe isn't really a child frame","postMessageToChild",e,t):C.out.output("Expected an object for a message","postMessageToChild",t)},dataOutput:function(e,t){return e+": "+(C.util.isObject(t)||C.util.isArray(t)?JSON.stringify(t):t)+" | "},ampCheck:function(e,t){e&&"amp"===e.mode&&T.context&&C.util.isFunction(T.context.renderStart)&&(t&&0===t.width?T.context.noContentAvailable():T.context.renderStart(t||void 0))},getUnixTimestamp:function(e,t){var i=e/(t?1440:1);return Date.now()+(C.util.isNumber(e)&&0<e?864e5*i:0)},getDocEl:function(e){if(e.targetClass){var t=P.getElementsByClassName(e.targetClass);return C.util.find(t,function(e){return!e.hasChildNodes()})||t[0]}if(e.duplicateId){var i=P.querySelectorAll("*[id='"+e.targetId+"']");return C.util.find(i,function(e){return!e.hasChildNodes()})||i[0]}return P.getElementById(e.targetId)||(e.altTargetId?P.getElementById(e.altTargetId):null)},isTestAddress:function(e){return!!(C.util.isString(e)&&0===e.indexOf("http://localhost")&&0<e.indexOf("/test"))&&(h=!0)},isUnitTest:function(){return-1<T.location.href.indexOf("http://localhost:9876/context.html")},getEnvFromHref:function(t){if(t&&C.util.isString(t))return C.util.find(E.env,function(e){return t===e.as||0<t.indexOf("://"+e.as)})},getAdContentOnly:function(e,t){var i="</body>",n=e.indexOf('<div id="adn-rsp-'),r=e.indexOf(i);if(!(n<1||r<1)){var a=e.substring(n,r);return a='<div id="'+t+'">'+a+"</div>",X.addWidgetIdToProcessAd(a,t)}if(-1<e.indexOf(E.nativeClass)){var s='<div id="'+t+'">'+e+"</div>";return X.addWidgetIdToProcessAd(s,t)}C.out.output("Something unexpected has gone on with the content of the ad server response","getAdContentOnly",i,r,e)},gatherDataParams:function(e,t,i,n){var r=[],a={},s=C.util.isFunction(t)?t:function(){return!0},o=C.util.isFunction(i)?i:C.util.noop,u=n||{},d=["auId","creativeId","targetId","c","kv","keywords","replacements","ps","auml","floorPrice","dimensions"],l=["lineItemId","creativeId","clickTrackingUrl","creativeSetId","orderId","targeting","kv","c","keywords","auml","ps","replacements","dimensions"],c=[{server:"userSegments",script:"userSegments"},{server:"context",script:"ctx"},{server:"canonical",script:"canonical"}];return C.util.forEach(e,function(t){if((t.lineItemId||t.creativeSetId||t.orderId)&&(t.creativeTag=!0),!0===s(t)){var i={};C.util.forEach(d,function(e){i[e]=t[e]}),(t.lineItemId||t.creativeSetId||t.orderId)&&(C.util.forEach(l,function(e){i[e]=t[e]}),i.creativeTag=!0),t.floorPrice&&!X.isAdnPrice(t.floorPrice)&&(C.out.output("Floor price is not valid","gatherDataParams",t),delete i.floorPrice),r.push(i),C.util.forEach(c,function(e){a[e.server]=a[e.server]||t[e.script]}),o(t)}}),C.util.forEach(d,function(e){delete u[e]}),C.util.forEach(c,function(e){delete u[e.server],delete u[e.script]}),{adUnits:C.util.filter(r,function(e){return!e.lineItemId&&!e.creativeSetId&&!e.orderId}),creativeTags:C.util.filter(r,function(e){return!!e.lineItemId||!!e.creativeSetId||!!e.orderId}),params:a}},getAndSetScriptOverride:function(e,t){if(C.util.isObject(n))return e?n.id:n.url;var i=t||X.getQueryParamsByName("script-override");return n=null,C.util.isString(i)&&0<i.length&&(n=C.util.find(E.scriptOverride,function(e){return e.id===i})||""),e&&n?n.id:(n||{}).url},gatherExclusions:function(e){function t(e,t,i){C.util.isArray(t[i])&&0<t[i].length&&(e[i]=t[i])}var i={};return C.util.isArray(e)?C.util.forEach(e,function(e){t(i,e,"excludedLineItems"),t(i,e,"excludedCreatives")}):(t(i,e,"excludedLineItems"),t(i,e,"excludedCreatives")),i},encodeUrlParams:function(e,t,i){var n=i||{};X.copyArgValues(t,n,["auml","ps","c"]),n.keywords&&(t.keywords=n.keywords.slice(0,20)),n.kv&&(t.kv=JSON.stringify(n.kv)),n.ctx&&(t.ctx=n.ctx),n.canonical&&(t.canonical=n.canonical),n.replacements&&(t.replacements=JSON.stringify(n.replacements)),n.userSegments&&(t.userSegments=JSON.stringify(n.userSegments));var r=X.getAndSetScriptOverride(!0);r&&(t.so=r),X.isAdnPrice(n.floorPrice)?t.fp=JSON.stringify(n.floorPrice):n.floorPrice&&C.out.output("Not a valid floorprice supplied.","encodeUrlParams",n);try{return e+=X.encodeAsUrlParams(t,!0)}catch(e){return C.out.output("encoding urls failed","insIframe: catch block",e)}},setAndReturnMetaData:function(e,t){var i=e,n=ie.getAllAdvStorageAsObjForAjaxSend(t);return C.util.hasProperties(n)&&((i=i||{}).metaData=n),i},normalise:function(i){var n={auW:"auW",auH:"auH"};if(C.util.forEach(i,function(e,t){n[t]&&(i[t]=e.toString())}),(i.sdk||i.requestArgs&&i.requestArgs.sdk)&&i.ads&&0<i.ads.length&&i.ads[0].dims){var e=i.ads[0].dims;e.w=C.util.isNumber(e.w)?Math.round(e.w):parseInt(e.w,10),e.h=C.util.isNumber(e.h)?Math.round(e.h):parseInt(e.h,10),i.ads[0].dims=e}return i}};var s,f,$,Z,ee={regDestination:function(){var e=X.getQueryParamsByName("adn_creative");if(C.util.isStringWithChars(e)){var t=X.getQueryParamsByName("adn_campaign"),i=X.getQueryParamsByName("adn_source");C.util.isStringWithChars(t)&&C.util.isStringWithChars(i)&&ie.writeConvLs({adn_campaign:t,adn_source:i,adn_creative:e})}}},te={handleChildPageLoad:function(t,e){var i=C.inIframe.getResponseCtrId(t.widgetId?P.getElementById(t.widgetId):""),n=X.getAdsInfo(i);if(!n.adsDivEl)return C.out.devOutput("Can't find container ID","handleChildPageLoad",C.inIframe.getResponseCtrId());if(t.containerDiv||t.pageLoadBeforeProcessAd||C.util.isArray(n.ads)&&n.ads.length&&k[n.ads[0].id]){var r=t.widgetId||C.inIframe.getIframeId();if(!r)return C.out.devOutput("Can't find a widget ID","handleChildPageLoad",t);var a=C.inIframe.getResize(),s=C.util.isNumber(e)?e:0,o=0<s?E.postMessageType.toParentResize:E.postMessageType.toParentPageLoad,u=n.adsDivEl.getElementsByTagName("iframe")[0];if(u){var d=C.util.getElementDimensions(u);d.w>n.contentDims.w&&(n.contentDims.w=d.w),d.h>n.contentDims.h&&(n.contentDims.h=d.h)}var l=X.assign({},k),c=!1;if(C.util.forEach(k,function(e){if((!t.widgetId||t.widgetId===e.widgetId)&&JSON.stringify(e.dims)!==JSON.stringify(n.contentDims)){if(n.contentDims.w<10||n.contentDims.h<10){if(e.isPrebid)return void C.out.infoOutput("Prebid ad so don't collapse",JSON.stringify(e),JSON.stringify(n));if(0<e.retAdCount)return void C.out.infoOutput("Ad returned so don't collapse",JSON.stringify(e),JSON.stringify(n))}e.dims=n.contentDims,c=!0}}),c||o===E.postMessageType.toParentPageLoad){var g={widgetId:r,messageType:o,w:n.contentDims.w,h:n.contentDims.h,hasSizeChange:c,retAdCount:n.ads.length,dims:n.contentDims,definedDims:n.definedDims,ads:X.generateAdData(null,n,l),resizeToContent:a};C.out.infoOutput("Message to parent for "+r,"handleChildPageLoad",JSON.stringify(g),JSON.stringify(k),JSON.stringify(t)),X.postMessageToParent(g)}0<n.contentDims.w&&0<n.contentDims.h&&9<s||(s<20||!X.isVisible(n.adsDivEl))&&T.setTimeout(function(){te.handleChildPageLoad({widgetId:t.widgetId,containerDiv:t.containerDiv,pageLoadBeforeProcessAd:!0},s+1)},s<20?205:1500)}else T.setTimeout(function(){te.handleChildPageLoad({pageLoadBeforeProcessAd:!0})},50)},handleChildSubs:function(e,t){if(!t.widgetId)return C.out.devOutput("Cannot find widget ID","handleChildSubs",e,t);var i=P.getElementById(t.widgetId);if(!i)return C.out.output("Cannot find widget","handleChildSubs",e,t);var n={messageType:E.postMessageType.toChildPubs,windowDims:C.util.getWindowDims(),widgetDims:C.util.getElementDimensions(i),widgetParentDims:C.util.getElementDimensions(i.parentElement),widgetId:t.widgetId,event:t.event,isDivContainer:t.isDivContainer};C.util.isDefined(t.functionCalls)&&(n.functionCalls=t.functionCalls),X.postMessageToChild(i,n)},handlePostResponse:function(e,t){t.hasResponse=!0,X.copyArgValues(t,e,["retAdsW","retAdsH","retAdCount","adServerHost"]);var i={};X.copyArgValues(i,t,J),X.copyArgValues(i,e,J),C.util.isFunction(t.onResponse)&&t.onResponse(i);var n=x[t.requestId];n&&(n.returnArgs=n.returnArgs||[],n.returnArgs.push(i),0===C.util.filter(n.widgetIds,function(e){return!O[e].hasResponse}).length&&n.onAllResponses(n.returnArgs));return i},handlePostMessage:function(t){if(!C.util.isObject(t))return C.out.output("Handle post aMessage is being used in weird ways","handlePostMessage",t);if(C.util.isString(t.data)||C.util.isTrue(t.isDivContainer)){var i={};if(C.util.isTrue(t.isDivContainer))i=X.clone(t);else{try{i=JSON.parse(t.data)}catch(e){return C.out.devOutput("Couldn't handle parsing","handlePostMessage",e,t.data,t)}if(i[E.postMessageSrcKey]!==E.postMessageSrcValue)return!1}var e=O[i.widgetId]||{};if(i.messageType===E.postMessageType.toChildPubs){if(!C.util.isString(i.event)||!C.util.isString(i.widgetId))return C.out.output("Requires more data","handlePostMessage",i);var n={widgetId:i.widgetId,event:i.event,windowDims:i.windowDims,widgetDims:i.widgetDims,widgetParentDims:i.widgetParentDims};C.util.isDefined(i.functionCalls)&&(n.functionCalls=i.functionCalls),ne.handleChildPubs(n)}else if(i.messageType===E.postMessageType.toChildAdUnitInfo){if(!C.util.isString(i.adUnitInfoId))return C.out.output("Requires more data","handlePostMessage",i);ne.handleAdUnitInfo(i)}else if(i.messageType===E.postMessageType.toParentGetAdUnitInfo){if(!C.util.isString(i.adUnitInfoId)||!C.util.hasProperties(e))return C.out.output("Needs ad unit info id and widget id","handlePostMessage",i,e);X.postMessageToChild(P.getElementById(i.widgetId),{adUnitInfoId:i.adUnitInfoId,messageType:E.postMessageType.toChildAdUnitInfo,adUnitInfo:e,isDivContainer:i.isDivContainer})}else if(i.messageType===E.postMessageType.toParentCustomEvent){if(!C.util.isDefined(i.args)||!C.util.isObject(i.customArgs)||!C.util.isObject(i.pAdSpec))return C.out.output("Missing required data to send custom event info","handlePostMessage",i);C.inIframe.sendCustomEvent(i.args,i.customArgs,i.pAdSpec)}else if(i.messageType===E.postMessageType.toParentFunctions){if(!C.util.hasProperties(e))return C.out.output("Needs valid widget id","handlePostMessage",i,e);if(!i.name)return C.out.output("Needs a function name","handlePostMessage",i,e);if(e.functions&&C.util.isArray(e.functions)){var r=C.util.find(e.functions,function(e){return e&&e.name===i.name&&C.util.isFunction(e.func)});if(r&&C.util.isFunction(r.func)){var a={};X.copyArgValues(a,e,J),r.func(a,i.args)}}}else if(i.messageType===E.postMessageType.toParentAdVisibilityEvent){if(!C.util.hasProperties(e))return C.out.output("Need widget info","toParentAdVisibility",i,e);e[i.callbackProp+"Data"]={widgetId:i.widgetId,auId:e.auId,adId:i.adId,creativeId:i.creativeId,lineItemId:i.lineItemId,viewability:i.viewability,feedbackText:i.feedbackText},i.delayedImpression?e.impReg!==E.impReg.manual||e["outside"+i.feedbackText]?(ae.sendEventFromParent(i.impRequestLoc,i.spec,i.feedbackText,e.network||e.networkId),X.visibilityEventHandling(i.callbackProp,e)):e.impReg===E.impReg.manual&&(e["inside"+i.feedbackText]={impRequestLoc:i.impRequestLoc,spec:i.spec,feedbackText:i.feedbackText}):X.visibilityEventHandling(i.callbackProp,e)}else if(i.messageType===E.postMessageType.toParentSubscribe){if(!C.util.isString(i.event)||!C.util.isString(i.widgetId))return C.out.output("Requires on event","handlePostMessage",i);C.util.addEventListener(T,i.event,C.util.createDelegate(te,te.handleChildSubs,{widgetId:i.widgetId,event:i.event,isDivContainer:i.isDivContainer}))}else if(i.messageType===E.postMessageType.toParentPageLoad||i.messageType===E.postMessageType.toParentResize){if(!1!==e.resizeOnPageLoad&&(!C.util.isFunction(e.resizeOnPageLoad)||!1!==e.resizeOnPageLoad(i))&&(i.resizeToContent===E.resizeToContent.resizeCreative||i.resizeToContent===E.resizeToContent.resize)&&C.util.isTrue(i.hasSizeChange)){var s={};X.copyArgValues(s,e,J),X.copyArgValues(s,i,J),se.iframeResizer(s,!1)}if(i.messageType===E.postMessageType.toParentPageLoad&&C.util.isFunction(e.onPageLoad)){var o={};X.copyArgValues(o,e,J),X.copyArgValues(o,i,J),e.onPageLoad(X.normalise(o))}}else{if(C.util.isStringWithChars(i.method))try{i.functionContext===E.functionContext.inIframe?C.util.isFunction(ne[i.method])?ne[i.method].call(C.inIframe,i):C.inIframe[i.method].call(C.inIframe,i):se[i.method].call(se,i)}catch(e){return C.out.output(e,"catch block for calling method",i,e)}if(i.messageType===E.postMessageType.toParentImpression||i.messageType===E.postMessageType.toParentResponse){var u=te.handlePostResponse(i,e);i.messageType===E.postMessageType.toParentImpression&&(C.util.isFunction(e.onImpressionResponse)&&e.onImpressionResponse(X.normalise(u)),te.handleChildSubs({},{event:"impRegistered",widgetId:i.widgetId,functionCalls:(e.functionCalls||[]).concat(e.cachedFunctionCalls),isDivContainer:i.isDivContainer}))}}}},registerListeners:function(){C.util.addEventListener(T,"message",C.util.createDelegate(C.lib,te.handlePostMessage)),C.util.isTopWindow()||C.util.addEventListener(T,"load",C.util.createDelegate(C.lib,te.handleChildPageLoad),y)},setFeedbackOptions:function(e){C.util.isObject(e)&&(C.util.isString(e.console)&&E.feedback.console[e.console]&&(G.console=e.console),C.util.isString(e.inScreen)&&E.feedback.inScreen[e.inScreen]&&(G.inScreen=e.inScreen)),0<T.location.href.toLowerCase().indexOf("adnlog123")&&(G.console=E.feedback.console.allAndInfo),0<T.location.href.toLowerCase().indexOf("adndebug123")&&(G.inScreen=E.feedback.inScreen.inAdUnit);var t=X.getQueryParamsByName("inScreen");C.util.isString(t)&&E.feedback.inScreen[t]&&(G.inScreen=t)}},ie=($={userId:"cX_P"},{getGdprAsObj:function(e){var t=e&&C.util.isDefined(e.gdpr)?e.gdpr:C.util.isDefined(g)?g:null;if(C.util.isDefined(t))return{gdpr:!1===t?0:!0===t?1:t}},getEuConsentAsObj:function(e){var t=e&&e.consentString?e.consentString:l||ie.get("euconsent-v2")||ie.get("euconsent");if(C.util.isStringWithChars(t))return{consentString:t}},getAllIdsAsObj:function(){var e=[],t=ie.get($.userId);t&&e.push({CXENSE:{userId:t}});var i=ie.get(Z.userId);if(i&&e.push({RELAY42:{userId:i}}),!(e.length<1))return{userAliases:JSON.stringify(e)}},getIdsAsObj:function(e){var t={userId:e.userId||ie.getAllDatStorageAsObj().browserId};return t.userId||delete t.userId,t.sessionId||delete t.sessionId,t},get:function(e){for(var t=e?e+"=":null,i=t?null:{},n=decodeURIComponent(P.cookie).split(";"),r=0;r<n.length;r++){for(var a=n[r];" "===a.charAt(0);)a=a.substring(1);if(t){if(0===a.indexOf(t))return a.substring(t.length,a.length)}else{var s=a.split("=");i[s[0]]=s[1]}}return C.util.isObject(i)?i:""},set:function(e){C.util.forEach(e,function(e,t){var i=new Date;i.setTime(i.getTime()+2592e6);var n="; expires="+i.toUTCString();P.cookie=t+"="+(e||"")+n+"; path=/"})},clearAdvLocalStorage:function(){try{T.localStorage.removeItem(z),Y.removeItem(z),T.localStorage.removeItem(H),Y.removeItem(H)}catch(e){C.out.devOutput("Problem clearing adv local storage","clearAdvLocalStorage",e)}},writeConvLs:function(t,e,r){if(!(e||C.util.isObject(t)&&C.util.hasProperties(t)))return C.out.devOutput("Not an object of data","writeAdvLs");function n(e,t){return e.adn_creative&&C.util.isStringWithChars(e.adn_creative)&&e.adn_source&&C.util.isStringWithChars(e.adn_source)&&t&&C.util.isStringWithChars(t)}function a(e,t,i,n){e[t]={adn_source:i.adn_source,adn_creative:i.adn_creative,timestamp:n||X.getUnixTimestamp(),network:r}}function i(i,e){C.util.forEach(e,function(e,t){n(e,t)&&a(i,t,e,e.timestamp)})}S||ie.clearAdvLocalStorage();var s={};if(e){var o=t;if(C.util.isStringWithChars(o))try{o=JSON.parse(o)}catch(e){return C.out.devOutput("Problem deciphering data from adserver","writeConvLs",e,t)}if(i(s,o),C.util.hasProperties(o)&&(!C.util.isObject(s)||!C.util.hasProperties(s)))return}else{s=le(H,!0,r);var u=[];C.util.forEach(s,function(e,t){n(e,t)&&e.timestamp&&C.util.isNumber(e.timestamp)||u.push(t)}),C.util.forEach(u,function(e){delete s[e]}),n(t,t.adn_campaign)?a(s,t.adn_campaign,t):i(s,t)}var d=C.util.hasLocalStorage()?T.localStorage:Y;try{C.util.hasProperties(s)?d.setItem(H,JSON.stringify(s)):d.removeItem(H)}catch(e){C.out.devOutput("Problem setting item","writeAdvLs",e,s)}},writeAdvLs:function(t,i){if(!C.util.isObject(t)||!C.util.hasProperties(t))return C.out.devOutput("Not an object of data","writeAdvLs");S||ie.clearAdvLocalStorage();var n=[],e=le(z,!0),r=["clicks","voidAuIds"];C.util.forEach(e,function(e){(C.util.isStringWithChars(e.value)||C.util.hasProperties(e.value))&&C.util.isStringWithChars(e.key)&&r.indexOf(e.key)<0&&(!t[e.key]||e.network!==i)&&e.exp&&e.exp>X.getUnixTimestamp()&&e.network&&n.push(e)}),C.util.forEach(t,function(e,t){t.toLowerCase().indexOf("session")<0&&r.indexOf(t)<0&&C.util.isStringWithChars(t)&&C.util.isStringWithChars(e)&&n.push({exp:X.getUnixTimestamp(100),key:t,value:e,network:i})});var a=C.util.map(C.util.isStringWithChars(t.voidAuIds)?t.voidAuIds.split(";"):[],function(e){return{exp:X.getUnixTimestamp(1),auId:e}})||[],s={};C.util.forEach((ie.getAllAdvStorageAsObj().voidAuIds||[]).concat(a),function(e){var t=s[e.auId];(!t||e.exp>t)&&(s[e.auId]=e.exp)});var o=C.util.map(s,function(e,t){return{exp:e,auId:t}});0<o.length&&n.push({key:"voidAuIds",value:o});var u=C.util.hasLocalStorage()?T.localStorage:Y;try{0<n.length?u.setItem(z,JSON.stringify(n)):u.removeItem(z)}catch(e){C.out.devOutput("Problem setting item","writeAdvLs",e,n)}t.clicks&&ie.writeConvLs(t.clicks,!0,i)},writeDatSegments:function(i,e){if(!C.util.isObject(e)||!C.util.hasProperties(e))return C.out.devOutput("Not an object of data","writeDatLs");var n={};n[i]={},C.util.forEach(e,function(e,t){"segments"===t&&(n[i][t]=e)}),n[i].segments||(n[i].segments=[]),n[i].exp=X.getUnixTimestamp(1,!0);var t=C.util.hasLocalStorage()?T.localStorage:Y;try{t.setItem(a,JSON.stringify(n))}catch(e){C.out.devOutput("Problem setting item","writeDatSegments",e,n)}},getDatSegments:function(e){var i={},t=C.util.hasLocalStorage()?T.localStorage:Y;try{var n=X.assign({},X.assign(de(t,a)));if(C.util.forEach(n,function(e,t){C.util.isArray(e.segments)&&e.segments.length&&e.exp&&!(e.exp<=X.getUnixTimestamp())&&(i[t]=e)}),!i||!C.util.hasProperties(i))return T.localStorage.removeItem(a),Y.removeItem(a),{}}catch(e){return C.out.devOutput("Problem getting dat segments","getDatSegments",e),{}}if(!i[e])return{};var r=i[e]||{};return r.segments=C.util.isArray(r.segments)?r.segments:[],delete r.exp,r},writeDatLs:function(e){if(!C.util.isObject(e)||!C.util.hasProperties(e))return C.out.devOutput("Not an object of data","writeDatLs");var i={};C.util.forEach(e,function(e,t){0===t.indexOf("browserId")?i[t]=e:0===t.indexOf("extSync")&&(i[t]=e)});var t=C.util.hasLocalStorage()?T.localStorage:Y;try{t.setItem(r,JSON.stringify(i))}catch(e){C.out.devOutput("Problem setting item","writeDatLs",e,i)}},getAllDatStorageAsObj:function(){var e=C.util.hasLocalStorage()?T.localStorage:Y;try{return X.assign({},de(e,r))}catch(e){return C.out.devOutput("Problem with local storage","getAllDatStorageAsObj",e),{}}},getAllAdvStorageAsObj:function(e){return X.assign({},le(z,!1,e))},getAllAdvStorageAsObjForAjaxSend:function(e){var t=ie.getAllAdvStorageAsObj(e);return delete t.voidAuIds,t},getConvStorageAsObj:function(){var e=C.util.hasLocalStorage()?T.localStorage:Y;return de(e,H)}}),ne={},re={distributeComposedAds:function(o){var u=!1,d=[],l="",c="";C.util.forEach(o.adUnits||o,function(t){var i=C.util.find(O,function(e){return e.targetId===t.targetId&&e.adStatus===E.adStatus.init});if(i)if(i.ads=t.ads,i.returnedKeywords=o.keywords,i.returnedSegments=o.segments,l=i.renderedImpRequestLoc,c=i.network,0<t.matchedAdCount&&(i.native?i.container=E.container.div:(t.renderOption?i.renderOption=t.renderOption:(0<t.html.indexOf("adnOptionContainerDiv")&&(i.container=E.container.div),0<t.html.indexOf("adnOptionContainerIframe")&&(i.container=E.container.iframe)),"IFRAME"===t.renderOption&&(i.container=E.container.iframe),"SANDBOXED_IFRAME"===t.renderOption&&(i.container=E.container.iframe,i.isolateFrame=!0),"DIV"===t.renderOption&&(i.container=E.container.div))),0===t.matchedAdCount){i.adStatus=E.adStatus.processed;var e=X.copyArgValues({matchedAdCount:t.matchedAdCount,html:t.html},i,["auId","targetId","auW","auH","kv","keywords","userSegments","c","ps","replacements","auml","floorPrice","requestArgs"]);e.retAdCount=0,e.retAdsW=0,e.retAdsH=0,e.h=0,e.w=0,te.handlePostResponse(e,i),C.util.isFunction(i.onNoMatchedAds)&&i.onNoMatchedAds(e),C.util.isFunction(i.onPageLoad)&&i.onPageLoad(e),X.ampCheck(i,{width:0,height:0})}else if(X.getParam(i.requestParams,"load")!==E.loadEnums.lazy||i.withinBounds){X.ampCheck(i);var n=C.lib.showAdContent(i,t);if(C.util.isTrue(n)){i.adStatus=E.adStatus.distributed,C.out.devOutput("renderedTokenCollection","distributeComposedAds",!!t.html,t.html&&t.html.indexOf('class="'+F)<0),(!t.html||t.html&&t.html.indexOf('class="'+F)<0)&&C.util.forEach(t.rts||[],function(e){d.push(e)});var r=document.getElementsByClassName((i.targetClass||i.targetId)+"-show");C.util.forEach(r,function(e){e.style.display=i.display||"block"})}}else{u=!0,i.adStatus=E.adStatus.procured,t.renderedImpRequestLoc=l;var a=X.getDocEl(i),s=R[t.targetId];a&&s?(s.errorStatus="",re.showTargetDiv(a,i),a.style.width=C.util.dimension(i.auW),a.style.height=C.util.dimension(i.auH)):(s.errorStatus=E.errorStatus.noTarget,C.out.output("Unable to find target element","distributeComposedAds",i))}else C.out.output("No ad unit data found, mismatched target probably or not the right status","composed",i)}),0<d.length&&C.lib.sendRenderedImps(d,l,c),u&&ae.initProximity()},showTargetDiv:function(e,t){e&&(C.util.isString(t.display)&&e.style.display!==t.display?e.style.display=t.display:"none"===e.style.display&&(e.style.display="block"))},insIframe:function(e,t){var i=t&&t.targetId===e.targetId||X.getDocEl(e);if(!i&&"script"!==e.format)return C.out.warn("Unable to find HTML element on page with the following id or class: "+e.targetId+" - "+e.targetClass),C.out.output("No targetId was found.","insIframe");function n(e,t,i){var n=e.auW||(e.creativeData?e.creativeData.creativeWidth:null),r=C.util.isString(n)||0<n?n:0;i&&(i.width=r),t.style.width=C.util.isFlexiNumber(n)&&0<parseInt(n,10)?C.util.dimension(r):r;var a=e.auH||(e.creativeData?e.creativeData.creativeHeight:null),s=C.util.isString(a)||0<a?a:0;i&&(i.height=s),t.style.height=C.util.isFlexiNumber(a)&&0<parseInt(a,10)?C.util.dimension(s):s}var r=P.createElement("iframe");r.id=e.widgetId,r.name=e.widgetId,r.setAttribute(W,C.util.isTopWindow()),r.allowTransparency=!0,r.setAttribute("data-adn-console",G.console),e.impReg&&r.setAttribute(V,e.impReg);var a={ifrId:r.id};if(e.serverUrl){e.env&&e.env!==E.env.production.id&&E.env[e.env]&&(a[q]=e.env),e.dn&&(a[j]=e.dn),e.impReg&&(a[V]=e.impReg);var s=X.encodeUrlParams(e.serverUrl,a,e);if(5<e.serverUrl.length){if(s+=X.encodeAsUrlParams(ie.getIdsAsObj(e),!0),s+=X.encodeAsUrlParams(ie.getAllIdsAsObj()||{},!0),s+=X.encodeAsUrlParams(ie.getEuConsentAsObj(e)||{},!0),s+=X.encodeAsUrlParams(ie.getGdprAsObj(e)||{},!0),C.util.isTopWindow()){var o=C.util.getWindowSize();0<o.width&&0<o.height&&(X.isUnitTest()||(s+=X.encodeAsUrlParams({viewport:o.width+"x"+o.height},!0)))}if(T.screen&&T.screen.availHeight&&(X.isUnitTest()||(s+=X.encodeAsUrlParams({screen:T.screen.availWidth+"x"+T.screen.availHeight},!0))),!C.util.isTopWindow()){var u={"data-parent-top":!1};s+=X.encodeAsUrlParams(u,!0)}}if(!s)return C.out.output("Failure to create server src","insIframe",s);r.src=s}if(r.setAttribute("style","display: block; margin: 0; border-width: 0; padding: 0;"),r.setAttribute("scrolling","no"),r.frameBorder="0",e.isolateFrame&&X.supportsSrcDoc()){var d=U;e.blockScript&&(d=d.replace("allow-scripts","")),r.setAttribute("sandbox",d)}if("script"===e.format||"js"===e.format){var l=r.src;l+=X.encodeAsUrlParams({format:e.format},!0),e.creativeTag?(l=X.updateSrc(e,l,!0),X.loadScriptSrc(l,i),n(e,i)):P.write("<script src='"+l+"'><\/script>")}else n(e,i,r),e.creativeTag&&r.src&&(r.src=X.updateSrc(e,r.src,!0)),i.appendChild(r);return re.showTargetDiv(i,e),r}},ae=(s=!(Z={userId:"_svtri"}),f=[],{sendEventFromParent:function(e,t,i,n){ue(e,t,i,n)},sendClick:function(e){ue(e,{},"Click")},sendVisibilityImpressions:function(){e("visible","visibilityStatus","visible","visibleSent","Visible","onVisible")},sendViewableImpressions:function(){e("viewable","viewabilityStatus","viewed","viewSent","Viewable","onViewable")},cancelProximityListeners:function(){C.util.detachEventListener(T,"resize",ae.takeProximity),C.util.detachEventListener(T,"scroll",ae.takeProximity)},cancelViewabilityListeners:function(){C.util.detachEventListener(T,"resize",ae.takeViewability),C.util.detachEventListener(T,"scroll",ae.takeViewability)},initViewability:function(){C.util.isTopWindow()&&!X.supportsIntersectionObserver()&&(ae.takeViewability(),!1===s&&(s=T.setInterval(ae.takeViewability,203)),C.util.addEventListener(T,"resize",ae.takeViewability),C.util.addEventListener(T,"scroll",ae.takeViewability))},initProximity:function(){C.util.isTopWindow()&&(ae.takeProximity(),C.util.addEventListener(T,"resize",ae.takeProximity),C.util.addEventListener(T,"scroll",ae.takeProximity))},takeProximity:function(){var p,m,e=C.util.filter(O,function(e){return(e.adStatus===E.adStatus.procured||X.getParam(e.requestParams,"load")===E.loadEnums.lazyRequest)&&!e.withinBounds});if(0===e.length)return ae.cancelProximityListeners(),C.out.devOutput("No more ads to proximity check","takeProximityReading",O);if(C.util.isTopWindow()){try{p=C.util.getWindowSize()}catch(e){C.out.output("takeProximityReading window size calcs off",e)}try{m=C.util.getScrollPos()}catch(e){C.out.output("takeProximityReading scroll calcs off",e)}var v=[],h="";C.util.forEach(e,function(e){try{var t=X.getDocEl(e);if(!t)return void C.out.devOutput("Missing appearance of element","takeProximity",t,e);var i=t.style.display;"none"===i.toLowerCase()&&(t.style.display="block");var n=C.util.getElementPosition(t),r=(t.offsetWidth,t.offsetHeight),a=C.util.isNumber(X.getParam(e.requestParams,"proximity"))?X.getParam(e.requestParams,"proximity"):E.defaultProximity,s=m.top,o=(m.left,m.top+p.height),u=m.left+p.width,d=n.top,l=n.left,c=n.top+r;if(n.left,d-o<a&&-1*a<c-s&&l-u<a&&(e.withinBounds=!0,e.adStatus===E.adStatus.procured)){e.adStatus=E.adStatus.distributed;var g=R[e.targetId];if(!C.util.isObject(g))return C.out.output("Can't find composed ad details","proximity",R,e);var f=C.lib.showAdContent(e,g);C.util.isTrue(f)&&(C.util.forEach(g.rts||[],function(e){v.push(e)}),h=g.renderedImpRequestLoc)}t.style.display=i}catch(e){C.out.output("some catch error for takeProximityReading",e)}}),C.lib.sendRenderedImps(v,h)}},takeViewability:function(e){var h,y,I=!1,b=!1,w=C.util.isTrue(e),t=C.util.isTopWindow()&&!w?O:k,i=C.util.filter(t,function(e){return e.displayStatus===E.displayStatus.displayed&&e.viewabilityStatus===E.viewabilityStatus.notViewed&&!e.isNested&&!e.preview});if(0===i.length)return ae.cancelViewabilityListeners(),T.clearInterval(s),s=!1,C.util.isTopWindow()&&!w||X.postMessageToParent({messageType:E.postMessageType.toParentAllChildrenViewed,widgetId:C.inIframe.getIframeId(),functionContext:E.functionContext.parent,method:"allChildrenViewed"}),C.out.devOutput("No more ads to viewability check","takeViewabilityReadings",O,k,C.util.isTopWindow());try{(h=C.util.getWindowSize()).width=Math.max(h.width,1),h.height=Math.max(h.height,1),L.prevWindowWidth===h.width&&L.prevWindowHeight===h.height||(L.prevWindowWidth=h.width,L.prevWindowHeight=h.height)}catch(e){C.out.output("takeViewabilityReading window size calcs off",e)}try{y=C.util.getScrollPos(),L.prevScrollLeft===y.left&&L.prevScrollTop===y.top||(L.prevScrollLeft=y.left,L.prevScrollTop=y.top),L.maxViewLeft=Math.max(y.left+h.width,L.maxViewLeft),L.maxViewTop=Math.max(y.top+h.height,L.maxViewTop)}catch(e){C.out.output("takeViewabilityReading scroll calcs off",e)}var S,A=(new Date).getTime();if(w){L.childPrevTime=L.childPrevTime||{};var n=i[0].widgetId;L.childPrevTime[n]=L.childPrevTime[n]||(new Date).getTime(),S=A-L.childPrevTime[n],L.childPrevTime[n]=A}else L.prevTime=L.prevTime||(new Date).getTime(),S=A-L.prevTime,L.prevTime=A;C.util.forEach(i,function(e){try{var t=P.getElementById(e.adId||e.widgetId);if(!t)return e.viewabilityStatus=E.viewabilityStatus.divMissing,void C.out.devOutput("Missing div","takeViewabilityReading",e);var i=C.util.getElementPosition(t),n={width:Math.max(t.offsetWidth,1),height:Math.max(t.offsetHeight,1)},r=Math.max(i.left,y.left),a=Math.min(i.left+n.width,y.left+h.width),s=Math.max(i.top,y.top),o=Math.min(i.top+n.height,y.top+h.height),u=L.metricsFromParent;if(!X.isVisible(t))return;if(u){var d=u.overlapPos.left+y.left,l=u.overlapPos.left+u.overlapSize.width+y.left,c=u.overlapPos.top+y.top,g=u.overlapPos.top+u.overlapSize.height+y.top;r=Math.max(d,r),a=Math.min(l,a),s=Math.max(c,s),o=Math.min(g,o)}var f=Math.max(a-r,0),p=Math.max(o-s,0),m=Math.round(f*p/(n.width*n.height)*100);if(m>E.defaultVisibilityPercentage&&e.visibilityStatus===E.visibilityStatus.notVisible&&(C.util.isTopWindow()&&!w||(e.visibilityStatus=E.visibilityStatus.visible,b=!0)),100===m&&100===e.viewability.prevPercent&&e.viewability.timeFully<E.longestTime&&(e.viewability.timeFully+=S),50<=m&&50<=e.viewability.prevPercent&&e.viewability.timeHalf<E.longestTime&&(e.viewability.timeHalf+=S),0<m&&0<e.viewability.prevPercent&&e.viewability.timePartly<E.longestTime?e.viewability.timePartly+=S:e.viewability.timeNone+=S,m>e.viewability.maxPercent&&(e.viewability.maxPercent=m),e.viewability.prevPercent=m,(1e3<e.viewability.timeFully||1e3<e.viewability.timeHalf)&&e.viewabilityStatus===E.viewabilityStatus.notViewed&&(C.util.isTopWindow()&&!w||(e.viewabilityStatus=E.viewabilityStatus.viewed,I=!0)),C.util.isTopWindow()&&!w){var v=[A,y.left,y.top,h.width,h.height,i.left,i.top,n.width,n.height,r-i.left,s-i.top,f,p];C.util.forEach(v,function(e,t){v[t]=Math.round(e)}),X.postMessageToChild(t,{messageType:E.postMessageType.toChildViewability,functionContext:E.functionContext.inIframe,method:"updateMetricsFromParent",metricsFromParent:v.join(","),metaData:ie.getAllAdvStorageAsObj(e.network),isDivContainer:e.container===E.container.div||e.isDivContainer})}}catch(e){C.out.output("takeViewabilityReading off",e)}}),b&&ae.sendVisibilityImpressions(),I&&ae.sendViewableImpressions()}}),se={allChildrenViewed:function(e){var t=O[e.widgetId];t&&(t.visibilityStatus=E.visibilityStatus.visible,t.viewabilityStatus=E.viewabilityStatus.viewed)},updateIframe:function(e){return t(e,function(e,t,i){C.util.isDefined(i.w)&&(e.width=i.w),C.util.isDefined(i.h)&&(e.height=i.h);var n=e.parentNode;"relative"===i.stack?(n.style.position="relative",e.style.position="absolute"):"fixed"===i.stack?e.style.position="fixed":"absolute"===i.stack?(C.util.isBlankString(n.style.position)||"relative"!==n.style.position||(n.style.position="static"),e.style.position="absolute"):(C.util.isBlankString(e.style.position)||"static"===e.style.position||(e.style.position="static"),C.util.isDefined(e.width)&&(n.style.width=C.util.dimension(e.width)),C.util.isDefined(e.height)&&(n.style.height=C.util.dimension(e.height))),C.util.isDefined(i.ifrStyle)&&!C.util.isBlankString(i.ifrStyle)&&X.applyStyle(e,i.ifrStyle),C.util.isDefined(i.targetStyle)&&!C.util.isBlankString(i.targetStyle)&&X.applyStyle(n,i.targetStyle),oe(t,i)})},triggerViewabilityReading:function(e){t(e,function(e,t){t.adStatus=E.adStatus.processed,t.displayStatus=E.displayStatus.displayed,ae.initViewability(t)})},iframeResizer:function(e,c,g){return t(e,function(e,t,i){var n=i.resizeToContent===E.resizeToContent.resizeCreative&&i.definedDims?i.definedDims.w:i.w,r=i.resizeToContent===E.resizeToContent.resizeCreative&&i.definedDims?i.definedDims.h:i.h,a=parseInt(n,10),s=parseInt(r,10),o=C.util.isDefined(g)?g:t.collapsible;if(a<0||s<0)return C.out.output("Invalid width ("+n+") and height ("+r+") for resize","iframeResizer");var u=0===a,d=0===s;if((u||d)&&!o)return C.out.devOutput("Resize to zero not allowed -- ad unit is not collapsible","iframeResizer",i,o);e.width=n,e.height=r;var l=e.parentNode;l.style.width=C.util.dimension(n),l.style.height=C.util.dimension(r),(u||d)&&c&&(e.style.display="none",l.style.display="none"),C.out.infoOutput("Resizing to "+e.width+"x"+e.height+" and "+l.style.width+"-"+l.style.height+" for "+i.widgetId,"iframeResizer",i),oe(t,i)})},styleFromAds:function(e){if(!X.isWidgetId(e.widgetId))return C.out.devOutput("missing widget ID","styleFromAds",e);var t=parseInt(e.retAdCount,10),i=O[e.widgetId],n={};if(X.copyArgValues(n,i,J),X.copyArgValues(n,e,J),0===t)n=X.assign(n,{w:0,h:0,retAdCount:0,ads:[]}),se.iframeResizer(n,G.inScreen!==E.feedback.inScreen.inAdUnit);else{if(!(C.util.isNumber(t)&&0<t))return C.out.output("adCount is not valid: "+t,"styleFromAds");if(!i||!C.util.hasProperties(i))return C.out.output("Missing widget spec","styleFromAds",e);i.displayStatus=E.displayStatus.displayed,ae.initViewability(i);var r=e.resizeToContent===E.resizeToContent.resizeCreative&&e.definedDims?e.definedDims.w:e.retAdsW,a=e.resizeToContent===E.resizeToContent.resizeCreative&&e.definedDims?e.definedDims.h:e.retAdsH;n=X.assign(n,{w:parseInt(r,10),h:parseInt(a,10),retAdCount:e.retAdCount,ads:X.generateAdData(e)}),se.iframeResizer(n,!1,!1)}}};function t(e,t,i){if(!X.isWidgetId(e.widgetId)){var n=P.getElementById(e.widgetId);return n?t.call(se,n,{},e):C.out.output("Couldn't find a widget ID","checkArgs",e)}var r=O[e.widgetId];if(!r&&e.widgetId!==E.previewId)return C.out.output("Couldn't find widget specs for "+e.widgetId,"checkArgs",e);var a=i||P.getElementById(e.widgetId)||P.getElementById(E.previewId);return a?r?t.call(se,a,r,e):void 0:C.out.output("Couldn't find widget in the document","checkArgs",e,a)}function oe(e,t){if(e&&C.util.isFunction(e.onRestyle)){var i={};X.copyArgValues(i,e,J),X.copyArgValues(i,t,J),e.onRestyle(X.normalise(i))}}function ue(e,t,i,n){var r=e,a=!t||!t.rt;try{if(T.screen&&T.screen.availHeight&&(r+=X.encodeAsUrlParams({screen:T.screen.availWidth+"x"+T.screen.availHeight},!0)),a||(r+=X.encodeAsUrlParams({rt:t.rt},!0)),-1<f.indexOf(r))return C.out.devOutput("URL has already been sent. Not sending again.","sendEvent",r,t);if(X.isTestAddress(r)||X.isTestAddress(X.getLocationHref()))f.push(r),C.out.devOutput(i+" being sent","sending"+i+"Event",r);else if(C.util.isStringWithChars(t.rt)&&0===t.rt.indexOf("preview-"))f.push(r),C.out.devOutput(i+" would have been sent if this was not a previewed ad","sending"+i+"Event",r);else{var s,o=C.util.getNewAjax(a?"GET":"POST",r,function(){if(o.readyState&&4!==o.readyState)return!1;if((!o.status||200===o.status)&&C.util.isStringWithChars(o.responseText)){var e={};try{e=JSON.parse(o.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block send event",o)}e&&e.metaData&&C.util.hasProperties(e.metaData)&&ie.writeAdvLs(e.metaData,e.network)}}),u=X.canAccessLocalStorage();o.withCredentials=!X.isTestAddress(r)&&u,(s=!u||L&&L.metaData?L.metaData:X.setAndReturnMetaData(null,n))?o.send(JSON.stringify(s)):o.send(),f.push(r)}return 1}catch(e){return C.out.output("sending a "+i+" event failed",e),0}}function e(n,r,a,s,o,u){C.util.forEach(k,function(e){if(C.util.isStringWithChars(e.rt)||!e.displayStatus){var t=D[n];if(C.util.isString(t)){if(e.displayStatus===E.displayStatus.displayed&&e[r]===E[r][a]){var i={messageType:E.postMessageType.toParentAdVisibilityEvent,widgetId:e.widgetId,adId:e.adId,creativeId:e.creativeId,lineItemId:e.lineItemId,creativeSetId:e.creativeSetId,orderId:e.orderId,viewability:e.viewability,spec:e,callbackProp:u,feedbackText:o,isDivContainer:e.isDivContainer,impRequestLoc:t};if(e.impReg||!X.canAccessLocalStorage()&&C.lib.isParentTopWindow()?i.delayedImpression=!0:ue(t,e,o,e.network),e[r]=E[r][s],!X.isWidgetId(e.widgetId))return C.out.devOutput("Couldn't find a widget ID","sendImpression",e);X.postMessageToParent(i)}}else C.out.output("Missing a imp request location","send"+o+"Impression",D,n)}else C.out.output("Need a response token on the spec object to send imp","send"+o+"Impression",e)})}function de(t,e){var i=t.getItem(e);if(C.util.isStringWithChars(i))try{return JSON.parse(i)}catch(e){return C.out.output("Error reading from local storage","cookie.getLs",e,t,i)}return{}}function le(e,t,i){var n,r=C.util.hasLocalStorage()?T.localStorage:Y;try{n=de(r,e)}catch(e){return C.out.devOutput("Problem with local storage","getLocalStorage",e),{}}if(e===H?C.util.hasProperties(n)||(n={}):C.util.isArray(n)||(n=[]),!0===t)return n;var a={};return C.util.forEach(n,function(e){if("voidAuIds"===e.key){if(!C.util.isArray(e.value))return;a.voidAuIds=C.util.filter(e.value,function(e){return e.auId&&e.exp&&e.exp>X.getUnixTimestamp()})}else C.util.isStringWithChars(e.key)&&e.exp&&e.exp>X.getUnixTimestamp()&&(!i||e.network===i)&&(a[e.key]=e.value)}),a}C.inIframe=function(){var e=E.resizeToContent.resize,g="",t={},n=[],f=[],r=[],a={};X.isTestAddress(T.location.href),ne={handleAdUnitInfo:function(e){if(!e||!C.util.isString(e.adUnitInfoId))return C.out.output("Missing ad unit info id for ad unit info response","handleAdUnitInfo",e);var t=a[e.adUnitInfoId];if(!t||!C.util.isArray(t)||t.length<1)return C.out.output("Missing some ad unit info response handlers","handleAdUnitInfo",a,e);var i=e.adUnitInfo,n=X.copyArgValues({},i,["auId","latitude","longitude","adStatus","auH","auW","collapsible","display","c","kv","keywords","replacements","auml","ps","displayStatus","targetId","targetClass","widgetId","functionCalls","functions","requestParams","method","onNoMatchedAds","onImpressionResponse","onPageLoad","usi","siteId","userId","segments","userSegments","resizeOnPageLoad","ctx"]);C.util.forEach(t,function(e){e(n)})},handleChildPubs:function(i){if(!C.util.isObject(i)||!C.util.isString(i.widgetId)||!C.util.isString(i.event))return C.out.output("Missing some args","handleChildPubs",i);C.util.forEach(i.functionCalls||[],function(t){if(t&&t.name){var e=C.util.filter(r,function(e){return e.name===t.name&&C.util.isFunction(e.func)&&!0!==e.isCalled});C.util.forEach(e||[],function(e){e.func(t.args),e.isCalled=i.event!==E.events.CUSTOM&&t.event!==E.events.CUSTOM})}else C.out.output("Missing a name parameter for a function call","handleChildPubs",i)}),C.util.forEach(t[i.event]||[],function(e){if(e.widgetId===i.widgetId){var t={};C.util.isObject(i.windowDims)&&(t.windowDims=i.windowDims),C.util.isObject(i.widgetDims)&&(t.widgetDims=i.widgetDims),C.util.isObject(i.widgetParentDims)&&(t.widgetParentDims=i.widgetParentDims),e.cb(t)}})},updateMetricsFromParent:function(e){if(!e||!C.util.isObject(e))return C.out.devOutput("Missing required args","updateMetricsFromParent",e);if(e.metricsFromParent&&!e.isDivContainer){var i=e.metricsFromParent.split(",");C.util.forEach(i,function(e,t){i[t]=parseInt(e,10)}),L.metricsFromParent={updateTime:i[0],scrollPos:{left:i[1],top:i[2]},windowSize:{width:i[3],height:i[4]},widgetPos:{left:i[5],top:i[6]},widgetSize:{width:i[7],height:i[8]},overlapPos:{left:i[9],top:i[10]},overlapSize:{width:i[11],height:i[12]}}}e.metaData&&(L.metaData=e.metaData),C.util.forEach(n,function(e){e()}),n=[],X.supportsIntersectionObserver()||ae.takeViewability(C.util.isTrue(e.isDivContainer))}};function p(a,s,o,u,d){var l=!1,c=!1,g=a+"Status",f=E.viewabilityStatus.notViewed,p=E.viewabilityStatus.viewed;if(-1<a.indexOf("visibility")&&(f=E.visibilityStatus.notVisible,p=E.visibilityStatus.visible),(c=new T.IntersectionObserver(function(e){var t=k[s],i=(new Date).getTime();t[a]=t[a]||X.getNewViewability(),t[g]=t[g]||f;function n(){t[a]&&(t[a].timeIntersect=t[a].timeIntersect+(new Date).getTime()-t[a].timeStart,t[g]=p,t[a].eventSent=!0,d(t[a]),T.clearTimeout(l),l=!1),c.disconnect()}if(t[g]===f)if(0<e[0].intersectionRatio&&e[0].intersectionRatio>=o||"visibility"===a&&0===o&&e[0].isIntersecting){if(t[a].timeStart=i,u<5)t[a].timeIntersect=Math.max(u,1),n();else{var r=u-t[a].timeIntersect;l=T.setTimeout(n,r)}t[a].isBeingViewed=!0}else l&&0<t[a].timeStart&&(t[a].timeIntersect=t[a].timeIntersect+(new Date).getTime()-t[a].timeStart,t[a].timeStart=0,T.clearTimeout(l),l=!1,t[a].isBeingViewed=!1)},{root:null,rootMargin:"0px",threshold:o})).observe(P.getElementById(s)),!(a.indexOf("customTiming")<0)){var t=["visibilitychange","pagehide","beforeunload","unload"],i=function(){var e=k[s];if(!e[a])return C.out.output("Could not find matching adspec for view","viewCallback",e,a);e[a].eventSent||(e[a].isBeingViewed&&(e[a].timeIntersect=e[a].timeIntersect+(new Date).getTime()-e[a].timeStart),0<e[a].timeIntersect&&d(e[a]),e[a]=null,C.util.forEach(t,function(e){C.util.detachEventListener(T,e,i)}))};C.util.forEach(t,function(e){C.util.addEventListener(T,e,i)})}}function l(e,t){return e||C.util.find(k,function(e){return e.adId===t})}return{sendCustomEvent:function(o,u,t){var e=X.getParam(o,"id")||o;if(!C.util.isDefined(e)||!C.util.isDefined(u))return C.out.output("Missing an ad ID to perform the custom event","sendCustomEvent",o,u);function i(e){if(X.isSrcdocFrame()&&!t)return X.postMessageToParent({args:o,customArgs:u,pAdSpec:e,messageType:E.postMessageType.toParentCustomEvent});!function(e){if(!C.util.isObject(e))return C.out.output("Need an ad spec to send a custom event","sendCustomEvent",k,o,u);if(!C.util.isString(e.rt))return C.out.output("Need a response token on the spec object to send imp","sendCustomEvent",e,k,o,u);var t=C.lib.getRequestLocs({env:h?"http://localhost:8000/test":C.lib.getEnv(),subdomain:e.subdomain,dn:C.lib.getDn()}).custom;if(e&&O&&O[e.widgetId]&&(t=O[e.widgetId].customRequestLoc),!t)return C.out.output("Need a custom request loc","sendCustomEvent",t,e,k,o,u);var i=X.getParam(u,"events")||[{customType:X.getParam(u,"customType"),customValue:X.getParam(u,"customValue")}],n=[];if(C.util.forEach(C.util.isArray(i)?i:[],function(e){if(C.util.isString(X.getParam(e,"customType"))){var t=parseInt(X.getParam(e,"customValue"),10),i={customType:e.customType,customValue:C.util.isNumber(t)?t:0};0===i.customValue&&delete i.customValue,n.push(i)}else C.out.output("Missing type for the custom event","sendCustomEvent",e,o,u)}),0===n.length)return C.out.output("Found no valid custom events","sendCustomEvent",o,u);try{var r=t+X.encodeAsUrlParams({rt:e.rt},!0);if(X.isTestAddress(r))C.out.devOutput("Custom request loc being send","sending",e,r);else{var a=JSON.stringify({events:n});if(T.navigator&&T.navigator&&!X.isUnitTest())T.navigator.sendBeacon(r,a);else{var s=C.util.getNewAjax("POST",r);s.withCredentials=X.canAccessLocalStorage()&&!X.isTestAddress(r),s.send(a)}}}catch(e){C.out.output("sending a custom event failed",e,k,o,u)}}(e)}var n=l(t,e);n?i(n):f.push({adId:e,func:function(){return i(l(t,e))}})},intersectionCallback:function(e,t){if(!C.util.isFunction(t.callback))return C.out.output("Need a callback registered","intersectionCallback",t);var i=X.assign({},t);i.recordType="intersection",i.maxTime=t.maxTime||0,C.inIframe.recordInScreen(e,C.util.isStringWithChars(i.id)?i.id:X.uuid(),i)},recordInScreen:function(i,n,r){if(!X.supportsIntersectionObserver())return C.out.devOutput("Browser doesn't support IntersectionObserver -- cannot do timing.","recordInScreen");var a=X.getParam(i,"id")||i,e=l(null,a),t=parseFloat(X.getParam(r,"threshold"))/100,s=0<=t&&t<=1?t:.5;C.util.isDefined(t)&&s!=t&&C.out.output("Threshold needs to be between 0 and 100. Using default value of "+100*s+" instead.","recordInScreen",r);var o=X.getParam(r,"maxTime"),u=0<=o?o:12e4;if(C.util.isDefined(u)&&o!==u&&C.out.output("Max time needs to be greater than 0. Using default value of "+u+" instead.","recordInScreen",r),!C.util.isStringWithChars(a))return C.out.output("Cannot register in screen without an adId.","recordInScreen",a,n,r);if(!C.util.isStringWithChars(n))return C.out.output("Cannot register in screen without a custom event type.","recordInScreen",a,n,r);function d(){p("customTiming"+n+"-"+X.uuid(),a,s,u,function(e){if(r&&"intersection"===r.recordType)return r.callback({adId:a,id:n,timeIntersect:e.timeIntersect,criteriaMet:e.timeIntersect>=u});var t=k[i]?k[i]:null;C.inIframe.sendCustomEvent(i,{customType:n,customValue:Math.min(e.timeIntersect,u)},t)})}e?d():f.push({adId:a,func:function(){d()}})},getResponseCtrId:function(e){var t,i=(C.util.isObject(e)&&C.util.isFunction(e.getElementsByTagName)?e:P).getElementsByTagName("div");return C.util.forEach(i,function(e){if(0===e.id.indexOf("adn-rsp-"))return t=e,!1;t||0!==e.id.indexOf(E.widgetIdPrefix)||(t=e)}),t?t.id:"responseCtr"},blockViewability:function(e){if(!C.util.isStringWithChars(e))return C.out.output("Need to supply the ad id to block viewability","blockViewability",e);k[e]=k[e]||{},k[e].viewabilityStatus=E.viewabilityStatus.blocked},resizeToCreativeDimensions:function(){e=E.resizeToContent.resizeCreative},blockResizeToContent:function(){e=E.resizeToContent.none},setAsResponsive:function(){e=E.resizeToContent.none,g="block"},isResizeToContent:function(){return e===E.resizeToContent.resize},getResize:function(){return e},getAdRequestInfo:function(e){if(!e||!C.util.isFunction(e.onInfoReceived))return C.out.output("Need onData function populated","getAdRequestInfo",e);var t=e.adUnitInfoId||"adUnitInfoId-"+Math.random();a[t]=a[t]||[],a[t].push(e.onInfoReceived),X.postMessageToParent({messageType:E.postMessageType.toParentGetAdUnitInfo,adUnitInfoId:t,widgetId:C.inIframe.getIframeId()})},registerFunction:function(e,t){if(!e)return C.out.output("Missing important parameters","registerFunction",e);var i=C.util.isString(e)?e:e.name,n=C.util.isFunction(t)?t:e.func;if(!C.util.isString(i)||!C.util.isFunction(n))return C.out.output("Missing important parameters",e);r.push({name:i,func:n})},processRenderedImps:function(t,e){if(!C.util.isArray(t))return C.out.devOutput("Problem with rendered imps","processRenderedImps",t,e);try{var i=C.util.map(t,function(e){if(!C.util.isString(e))return{loc:"",token:""};var t=e.split("/b/");return 2!==t.length&&(t=["",""]),{loc:t[0]+"/b/",token:t[1].replace(".html","")}}),n=C.util.filter(i,function(e){return 0===e.loc.indexOf("http")&&e.token.indexOf(".html")<0});if(n.length!==t.length)return C.out.devOutput("Problem figuring out things on rendered imps","processRenderedImps",t,n);var r=C.util.map(n,function(e){return e.token}),a=n[0].loc+"?tzo="+(new Date).getTimezoneOffset();return C.lib.sendRenderedImps(r,a,e)}catch(e){C.out.devOutput("Problem with rendered imps","processRenderedImps",t,e)}return!1},processAdResponse:function(e){if(!e||!C.util.isNumber(e.matchedAdCount))return C.out.output("Missing the necessary args in "+e,"resizeAds");var t=e.widgetId,i=e.widgetId;if(t||(t=C.inIframe.getIframeId(),i=C.inIframe.getResponseCtrId()),!t&&C.lib.isParentTopWindow())return C.out.devOutput("Unable to find iframeId","processAdResponse",t,e);!function(n,e,r){var a=X.getAdsInfo(e);if(!a.adsDivEl)return C.out.output("Can't find the ads container","processAd",n,e,r,a);var s=(O||{})[n]||{};D=C.lib.getRequestLocs({env:h?"http://localhost:8000/test/i":s.env||C.lib.getEnv(),dn:C.lib.getDn(),adServerHost:a.adServerHost,subdomain:a.subdomain},!1);var o=a.adsDivEl&&"div"===a.adsDivEl.tagName.toLowerCase()&&(-1<a.adsDivEl.className.indexOf(E.nativeClass)||e!==C.inIframe.getResponseCtrId()||0===e.indexOf(E.widgetIdPrefix)),u=!o&&(!n||!C.lib.isParentTopWindow())||o&&(!n||!C.util.isTopWindow()),t=a.adsDivEl.getElementsByTagName("ins");if(C.util.forEach(t,function(e){e.className&&-1<e.className.indexOf("dcmads")&&"inline-block"===e.style.display&&1===parseInt(e.style.width,10)&&1===parseInt(e.style.height,10)&&C.inIframe.setAsResponsive()}),g){var i=P.getElementsByClassName("responseCtr");C.util.forEach(i,function(e){e.style.display="block"})}if(0!==r){var d={},l=P.getElementsByClassName(F);if(C.util.forEach(a.ads,function(e){if(!k[e.id]){var t={widgetId:n,isNested:u,isDivContainer:o,network:a.network,adId:e.id,dims:e.dims,subdomain:e.subdomain,definedDims:e.definedDims,retAdCount:r,adServerHost:a.adServerHost,creativeId:e.el.getAttribute("data-creative-id"),lineItemId:e.el.getAttribute("data-line-item-id"),rt:e.el.getAttribute("data-response-token"),impReg:s.impReg||X.getImpReg(),adStatus:E.adStatus.processed,displayStatus:E.displayStatus.displayed,viewabilityStatus:E.viewabilityStatus.notViewed,visibilityStatus:E.visibilityStatus.notVisible,viewability:X.getNewViewability(),visibility:X.getNewViewability(),isPrebid:C.util.isLoopable(l)&&0<l.length};if(k[e.id]=t,d[e.id]=t,X.supportsIntersectionObserver()){var i=e.id;p("visibility",i,0,1,function(){ae.sendVisibilityImpressions()}),p("viewability",i,.5,1e3,function(){ae.sendViewableImpressions()})}}}),C.util.hasProperties(d)){if(C.util.forEach(l,function(n){var e=n.parentNode;!e||!e.className||e.className.indexOf(E.cwClass)<0||C.util.addEventListener(e,"click",function(e){for(var t=e.target;t&&"a"!==t.nodeName.toLowerCase();)t=t.parentNode;if(t){var i=[n.getAttribute("data-click-url"),n.getAttribute("data-click-tracking-url")];C.util.forEach(i,function(e){C.util.isStringWithChars(e)&&ae.sendClick(e)})}})}),C.util.forEach(f,function(e){d[e.adId]&&e.func()}),f=C.util.filter(f,function(e){return!d[e.adId]}),!X.isWidgetId(n))return C.out.devOutput("Couldn't derive a widget ID","processAd",n,e,r);var c={messageType:E.postMessageType.toParentImpression,method:C.inIframe.getResize()===E.resizeToContent.resize||C.inIframe.getResize()===E.resizeToContent.resizeCreative?"styleFromAds":"triggerViewabilityReading",resizeToContent:C.inIframe.getResize(),retAdCount:r,retAdsW:a.contentDims.w,retAdsH:a.contentDims.h,definedDims:a.definedDims,adServerHost:a.adServerHost,dims:{w:a.contentDims.w,h:a.contentDims.h},ads:X.generateAdData(null,a,d),widgetId:n,isDivContainer:o};X.postMessageToParent(c),(!C.util.isArray(v[y])||v[y].length<1)&&X.onLoad(function(){te.handleChildPageLoad({containerDiv:o,widgetId:n})})}}else X.postMessageToParent({messageType:E.postMessageType.toParentImpression,method:"styleFromAds",retAdCount:r,retAdsW:a.contentDims.w,retAdsH:a.contentDims.h,definedDims:a.definedDims,dims:{w:a.contentDims.w,h:a.contentDims.h},ads:[],widgetId:n,adServerHost:a.adServerHost,isDivContainer:o})}(t,i,e.matchedAdCount)},callParentFunction:function(e,t){if(!C.util.isStringWithChars(e))return C.out.output("Missing the necessary args in "+e,"callParentFunction");X.postMessageToParent({messageType:E.postMessageType.toParentFunctions,widgetId:C.inIframe.getIframeId(),name:e,args:t})},registerPrebidRendered:function(e,t,i){var n=D.rendered||C.lib.getRequestLocs({env:h?"http://localhost:8000/test/i":C.lib.getEnv()},!1).rendered;C.out.devOutput("Prebid rendered","registerPrebidRendered",e,t,i,n),i&&n&&C.lib.sendRenderedImps([t],n)},getIframeArgs:function(e){return X.combineArgs(X.parseUrlArgs(e),X.parseHashArgs(e))},getIframeId:function(e){if(e&&0===e.indexOf(E.widgetIdPrefix))return e;var t=P.getElementsByTagName("body")[0].id;if(t&&0===t.indexOf(E.widgetIdPrefix))return t;var i=C.inIframe.getIframeArgs().ifrId;if(C.util.isStringWithChars(i)&&i!==E.previewId)return i;var n="";i===E.previewId&&(n=E.previewId);var r=C.util.getFrameElement();return C.util.isDefined(r)&&!r.id&&(r.id="adn-sup-"+Math.random()),C.util.isDefined(r)?r.id:n},parentSubscribeEvent:function(e){if(!(C.util.isObject(e)&&C.util.isString(e.event)&&C.util.isString(e.ifrId)&&C.util.isFunction(e.cb)))return C.out.output("Need better args","parentSubscribeEvent",e);X.postMessageToParent({messageType:E.postMessageType.toParentSubscribe,event:e.event,widgetId:e.ifrId}),t[e.event]=t[e.event]||[],t[e.event].push({widgetId:e.ifrId,cb:e.cb})},updateAd:function(t){if(!t||!t.ifrId)return C.out.output("Need arguments and an iframe id","inIframe",t);var e=X.getAdsInfo(t.ifrId),i=t.method||"updateIframe",n=t.targetStyle||t.parentStyle,r={messageType:E.postMessageType.toParentUpdateAd,method:i,w:t.ifrW||"",h:t.ifrH||"",ads:X.generateAdData(null,e,k),params:C.util.isObject(t.params)?t.params:"",ifrStyle:C.util.isObject(t.ifrStyle)?t.ifrStyle:"",targetStyle:C.util.isObject(n)?n:"",widgetId:t.ifrId,stack:t.stack||"static"};t.el&&t.event?C.util.addEventListener(t.el,t.event,C.util.createDelegate(C.util,function(e){if(X.postMessageToParent(r),t.cb){if(!C.util.isFunction(t.cb))return C.out.output("Callback supplied not a function","inIframe");t.cb(e,t)}})):X.postMessageToParent(r)}}}(),function(){function a(t){var v=C.lib.getRequestLocs(t,!0);if(h=[],s=[],0===K.length){var e=P.querySelector("meta[name='keywords']");e&&e.content&&(K=C.util.uniques(C.util.map(e.content.split(","),function(e){return C.util.trim(e)})).slice(0,100))}function i(e,t,i,n,r){var a=C.util.isObject(n)?X.clone(n):{},s=Math.random(),o=i.keywords||a.keywords||[];C.util.isString(o)&&(o=[o]);var u=0<o.length?C.util.uniques(K.concat(o)):K,d=P.querySelector("link[rel='canonical']"),l=d?d.href||d.getAttribute("href"):void 0,c={requestId:e,auId:i.auId||i.targetId||i.widgetId,requestArgs:r,parentArgs:n,auArgs:i,mode:a.mode||i.mode,format:E.validFormats[i.format||"--"],clickTrackingUrl:i.clickTrackingUrl||"",creativeTag:i.creativeTag||!1,lineItemId:i.lineItemId,creativeId:i.creativeId,creativeSetId:i.creativeSetId,orderId:i.orderId,targeting:i.targeting,creativeData:i.creativeData,creativeContent:i.creativeContent,network:a.network||i.network,requestMode:E.requestMode[a.requestMode||i.requestMode]||E.requestMode.DEFAULT,networkId:i.networkId||a.networkId,timingFunc:i.timingFunc||a.timingFunc,widgetId:i.widgetId||E.widgetIdPrefix+s,hash:i.hash,auW:i.auW||i.creativeWidth||0,auH:i.auH||i.creativeHeight||0,display:i.display||void 0,dimensions:C.util.isArray(i.dimensions)&&0<i.dimensions.length&&C.util.isArray(i.dimensions[0])&&2===i.dimensions[0].length?i.dimensions:void 0,c:i.c||a.c||void 0,gdpr:i.gdpr||a.gdpr||void 0,consentString:i.consentString||a.consentString||void 0,ctx:i.ctx||a.ctx||T.location.href||P.referrer,canonical:i.canonical||a.canonical||l,kv:i.kv||a.kv||void 0,keywords:0<u.length?u:void 0,auml:i.auml||void 0,native:i.native||a.native||!1,replacements:i.replacements||a.replacements,segments:i.segments||a.segments,userSegments:a.userSegments||i.userSegments,ps:C.util.isNumber(i.ps)?i.ps:void 0,adStatus:E.adStatus.init,displayStatus:E.displayStatus.notDisplayed,container:E.container[i.container||a.container||"nothing"]||E.container.iframe,env:i.env||a.env||E.env.production.id,dn:i.dn||a.dn||!1,sdk:i.sdk||a.sdk||!1,viewabilityStatus:E.viewabilityStatus.notViewed,visibilityStatus:E.visibilityStatus.notVisible,impRequestLoc:v.imp,floorPrice:i.floorPrice||a.floorPrice||void 0,protocol:i.protocol||a.protocol||void 0,renderedImpRequestLoc:v.rendered,viewImpRequestLoc:v.viewable,visImpRequestLoc:v.visible,customRequestLoc:v.custom,previewLoc:v.preview,headerBids:i.headerBids||a.headerBids,functionCalls:i.functionCalls||a.functionCalls,functions:i.functions||a.functions,requestParams:X.assign(a.requestParams||{},i.requestParams||{}),collapsible:!1!==i.collapsible,method:a.method||i.method,devScript:i.devScript||!1,excludedCreatives:a.excludedCreatives||[],excludedLineItems:a.excludedLineItems||[],onError:i.onError||a.onError||C.util.noop,onVisible:i.onVisible||a.onVisible||C.util.noop,onViewable:i.onViewable||a.onViewable||C.util.noop,onNoMatchedAds:i.onNoMatchedAds||a.onNoMatchedAds,hasResponse:!1,onResponse:i.onResponse||a.onResponse,onImpressionResponse:i.onImpressionResponse||a.onImpressionResponse,onPageLoad:i.onPageLoad||a.onPageLoad,onRestyle:i.onRestyle||a.onRestyle,siteId:i.siteId||a.siteId,usi:i.usi||a.usi,userId:i.userId||a.userId,useCookies:!(!1===i.useCookies||!1===a.useCookies),latitude:i.latitude||a.latitude,longitude:i.longitude||a.longitude,clearTarget:C.util.isDefined(i.clearTarget)?i.clearTarget:C.util.isTrue(a.clearTarget),targetClass:a.targetClass||i.targetClass,externalId:r.externalId,impReg:E.impReg[r.impReg]?r.impReg:void 0,targetId:i.targetId||"adn-"+(i.auId||i.creativeId)+(a.targetClass||i.targetClass?s:""),isolateFrame:C.util.isDefined(i.isolateFrame)?i.isolateFrame:a.isolateFrame||!1,blockScript:C.util.isDefined(i.blockScript)?i.blockScript:a.blockScript||!1,isolateSubFrame:C.util.isDefined(i.isolateSubFrame)?i.isolateSubFrame:a.isolateSubFrame||!1,serverUrl:v.imp,resizeOnPageLoad:C.util.isDefined(i.resizeOnPageLoad)?i.resizeOnPageLoad:a.resizeOnPageLoad,viewability:X.getNewViewability()};(C.util.isStringWithChars(i.scriptOverride)||C.util.isStringWithChars(a.scriptOverride))&&X.getAndSetScriptOverride(!1,i.scriptOverride||a.scriptOverride);try{(c.ctx||"").indexOf("context.html")<0&&(T.parent.location.href||T.parent.document.referrer)&&(c.ctx=i.ctx||a.ctx||T.parent.location.href||T.parent.document.referrer,-1<(c.ctx||"").indexOf("safeframe.googlesyndication.com")&&(c.ctx=i.ctx||a.ctx||T.parent.document.referrer||T.parent.location.href))}catch(e){-1<(c.ctx||"").indexOf("safeframe.googlesyndication.com")&&(c.ctx=i.ctx||a.ctx||P.referrer||T.location.href)}if(c.auId&&!c.creativeTag&&(c.serverUrl+="&auId="+c.auId),c.cachedFunctionCalls=c.cachedFunctionCalls||[],C.util.isNumber(i.refresh)&&(c.refresh={delay:parseInt(i.refresh,10),event:"onViewable",count:1}),C.util.isObject(i.refresh)&&C.util.isNumber(i.refresh.delay)&&(c.refresh={delay:parseInt(i.refresh.delay,10),event:"onVisible"===i.refresh.event?i.refresh.event:"onViewable",count:C.util.isNumber(i.refresh.count)&&0<C.util.isNumber(i.refresh.count)?parseInt(i.refresh.count):1}),c.devScript&&(c.serverUrl+="&isDevScript=true"),t.push(c),!c.targetClass){var g=C.util.filter(O,function(e){return e.targetId===c.targetId});c.duplicateId=0<g.length}if(0===c.targetId.indexOf("adn-")&&20!==c.targetId.length){var f=c.targetId.substring(4);c.altTargetId="adn-"+C.lib.auPadStart(f)}var p=X.getDocEl(c);c.prevStyle=p?p.getAttribute("style"):"";var m=C.util.filter(O,function(e){return e.targetId===c.targetId&&e.adStatus===E.adStatus.init});C.util.forEach(m,function(e){delete O[e.widgetId]}),O[c.widgetId]=c}var n=X.assign({},t);delete n.adUnits,delete n.creatives;var r=X.uuid();C.util.isArray(t.adUnits)&&!t.isPreview?C.util.forEach(C.util.isArray(t.adUnits)?t.adUnits:[],function(e){i(r,h,e,n,t)}):C.util.isArray(t.creatives)?C.util.forEach(C.util.isArray(t.creatives)?t.creatives:[],function(e){i(r,s,e,n,t)}):C.util.isStringWithChars(t.creativeContent)?i(r,s,t,void 0,t):i(r,h,t,void 0,t),C.util.isFunction(t.onAllResponses)&&(x[r]={onAllResponses:t.onAllResponses},x[r].widgetIds=C.util.map(C.util.filter(O,function(e){return e.requestId===r}),function(e){return e.widgetId}))}var h,s;function o(t,e){var i=X.getDocEl(t);if(!i)return C.out.output("Couldn't find target element","Creative preview",t,i,t.onError);var n=C.util.find(i.childNodes,function(e){return e.id===t.widgetId});if(0<e.indexOf("adnOptionContainerDiv")&&(t.container=E.container.div),0<e.indexOf("adnOptionContainerIframe")&&(t.container=E.container.iframe),n||(t.container!==E.container.div||t.isolateFrame?(t.serverUrl=null,C.lib.showAdContent(t,{html:e,matchedAdCount:1})):(re.showTargetDiv(i,t),i.innerHTML=X.getAdContentOnly(e,t.widgetId),C.util.loadScriptElements(i,t.widgetId))),t.blockScript&&C.util.isFunction(t.onImpressionResponse)){var r={};X.copyArgValues(r,t,J),t.onImpressionResponse(X.normalise(r))}}I={ifr:function(){var e=h[0];return e&&e.auId?M.test(e.auId)?e.requestMode!==E.requestMode.hasTarget||X.getDocEl(e)?void re.insIframe(e):(C.out.devOutput("Skipping ad request","ifr",e),C.util.isFunction(e.onNoMatchedAds)&&e.onNoMatchedAds(e.requestArgs),!1):C.out.output("Invalid auId.","ifr",e.auId):C.out.output("No auId was found.","ifr")},creativeTag:function(){var e=h[0];"js"===e.format||"iframe"===e.format?re.insIframe(e):I.composed(h)},previewDirect:function(){C.util.forEach(s,function(e){O[e.widgetId].preview=!0,o(e,e.creativeContent)})},preview:function(e){var t=e&&e.widgetId?[e]:s;if(t.length<1)return C.out.output("No creatives to make request for","preview");var a=t[0].previewLoc,i=C.util.filter(t,function(e){return!O[e.widgetId].preview||e.firstPreviewFailed&&!e.apiPreviewEnabled});C.util.forEach(i,function(e){O[e.widgetId].preview=!0,e.apiPreviewEnabled=!!e.hash||!!e.firstPreviewFailed}),C.util.forEach(i,function(t){if(!C.util.isString(t.networkId)&&!C.util.isString(t.network)||!C.util.isString(t.creativeId)&&!C.util.isObject(t.creativeData))return C.out.output("Insufficient creative information for preview","preview",t,t.onError);var e="POST",i=a+"context="+t.networkId||t.network;C.util.isString(t.creativeId)&&(e="GET",i+="&creativeId="+t.creativeId,t.apiPreviewEnabled&&(i=(E.env[t.env||"production"]||E.env.production).api+t.creativeId+"?context="+(t.networkId||t.network),t.hash&&(i+="&hash="+t.hash)));var n,r=C.util.getNewAjax(e,i,function(){if(r.readyState&&4!==r.readyState)return!1;if(r.status&&200!==r.status||!C.util.isStringWithChars(r.responseText)){if(t.apiPreviewEnabled)return"Preview object not found"===r.statusText?void(C.util.isFunction(t.onNoMatchedAds)&&t.onNoMatchedAds(t)):C.out.output("Error status returned","composed",r,t.onError);t.firstPreviewFailed||(t.firstPreviewFailed=!0,I.preview(t))}else{var e;try{e=t.apiPreviewEnabled?JSON.parse(r.responseText):r.responseText}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block",t.onError)}o(t,e.html||e)}});C.util.isObject(t.creativeData)&&(n=JSON.stringify(t.creativeData)),r.send(n)})},composed:function(e,t){var d=C.util.isArray(X.getParam(t,"adUnits"))?t.adUnits:h;if(d.length<1)return C.out.output("No ad units to make request for","composed");var i=C.util.isArray(e)?e:h;ae.takeProximity();var l=d[0],c=l.impRequestLoc,g=l.headerBids,f=l.network,n=[],p=X.getParam(t,"requestId"),r=0,a=X.gatherDataParams(i,function(e){var t=O[e.widgetId];if(!t)return C.out.devOutput("Couldn't find widget details in cache","composed",e.widgetId,O),!1;if(!t.creativeTag&&!M.test(t.auId))return C.out.output("auId is not in valid format -- check it","composed",t.auId),!1;var i=X.getParam(t.requestParams,"load")!==E.loadEnums.lazyRequest||t.withinBounds;return i?i&&e.requestMode===E.requestMode.hasTarget&&!X.getDocEl(e)?(C.out.devOutput("Skipping ad request","composed",e),C.util.isFunction(e.onNoMatchedAds)&&e.onNoMatchedAds(e.requestArgs),!1):i&&50<=r?(n.push(e),!1):(r++,i):(n.push(e),!1)},function(e){O[e.widgetId].composed=!0}),s=C.util.map(ie.getAllAdvStorageAsObj().voidAuIds||[],function(e){return e.auId})||[],o=C.util.filter(a.adUnits,function(e){return s.indexOf(C.lib.auPadStart(e.auId))<0}),u=[];u.push(o),C.util.forEach(a.creativeTags,function(e){u.push(e)});var m=a.params;C.util.forEach(u,function(i){if(0!==i.length||i.creativeTag){var e=c;e+=X.encodeAsUrlParams(ie.getIdsAsObj(l),!0),e+=X.encodeAsUrlParams(ie.getAllIdsAsObj()||{},!0),e+=X.encodeAsUrlParams(ie.getEuConsentAsObj(l)||{},!0),e+=X.encodeAsUrlParams(ie.getGdprAsObj(l)||{},!0);var t=X.getAndSetScriptOverride(!0);if(t&&(e+=X.encodeAsUrlParams({so:t},!0)),p=p||"request-"+Math.random(),e+="&"+(G.inScreen===E.feedback.inScreen.inAdUnit||b?"format=json":l.native?"tt=native":"tt=multi"),T.screen&&T.screen.availHeight&&(X.isUnitTest()||(e+=X.encodeAsUrlParams({screen:T.screen.availWidth+"x"+T.screen.availHeight},!0))),C.util.isTopWindow()){var n=C.util.getWindowSize();0<n.width&&0<n.height&&(X.isUnitTest()||(e+=X.encodeAsUrlParams({viewport:n.width+"x"+n.height},!0)))}if(i.creativeTag){var r=X.clone(m);r.ctx=r.context,delete r.context,e+=X.encodeAsUrlParams(r,!0),e=X.updateSrc(i,e)}var a=Date.now(),s=C.util.getNewAjax(X.isTestAddress(e)||i.creativeTag?"GET":"POST",e,function(){if(s.readyState&&4!==s.readyState)return!1;if((!s.status||200===s.status)&&C.util.isStringWithChars(s.responseText)){var e;Q=E.composedRequest.requestReturned;try{e=JSON.parse(s.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block",l.onError)}return e.adUnits?(e.metaData&&ie.writeAdvLs(e.metaData,e.network),i.creativeTag&&1===e.adUnits.length&&(e.adUnits[0].targetId=i.targetId),C.util.forEach(e.adUnits,function(e){R[e.targetId]=e}),N[p]={requestId:p,duplicateFilter:X.getParam(e,"duplicateFilter")},w=Date.now()-a,C.util.isFunction(l.timingFunc)&&l.timingFunc(e,w),void re.distributeComposedAds(e)):C.out.output("No ad units defined in returned data","composed",l.onError)}X.ampCheck(l,{width:0,height:0});var t={};if(s.responseText)try{t=JSON.parse(s.responseText)||{}}catch(e){C.out.output("ajax.responseText: catch block","composed",s),t={}}return t.metaData&&ie.writeAdvLs(t.metaData,t.network),C.out.output("Error status returned","composed",s,l.onError)});s.withCredentials=X.canAccessLocalStorage()&&!X.isTestAddress(e);var o=X.gatherExclusions(d);o.adUnits=i,X.setAndReturnMetaData(o,f),C.util.isArray(g)&&!C.util.isStringWithChars(X.getPreviewLi())&&(o.headerBids=g);var u=X.getParam(N[p],"duplicateFilter");u&&(o.duplicateFilter=u),o=X.combineArgs(o,m),s.send(i.creativeTag?void 0:JSON.stringify(o)),Q=E.composedRequest.requestMade}}),0<n.length&&T.setTimeout(function(){I.composed(n,{requestId:p,adUnits:d})},153)}};var t={style:function(t){e(function(e){X.applyStyle(e,t.style)})},resize:function(t){e(function(e){C.util.isDefined(t.width)&&(e.style.width=C.util.dimension(t.width)),C.util.isDefined(t.height)&&(e.style.height=C.util.dimension(t.height))})}};function e(e){var t,i,n=C.util.getFrameElement()||(t=h[0],(i=X.getDocEl(t))?i.firstChild:(C.out.warn("Unable to find HTML element on page with the following id: "+t.targetId),C.out.output("No target element was found.","getWidgetEl")));n&&e(n)}function u(e,t,i){var n=e.method||i;return t[n]?t[n].call(this,e):C.out.output("Matching method not found for "+n,"init")}function i(t,i,e){if(t.externalId){var n="outside"+e,r="inside"+e;C.util.forEach(O,function(e){e.externalId===t.externalId&&(e[n]=!0,e.impReg===E.impReg.manual&&C.util.isObject(e[r])&&(ae.sendEventFromParent(e[r].impRequestLoc,e[r].spec,e[r].feedbackText,e[r].network||e[r].networkId),X.visibilityEventHandling(i,e),e[r]=null))})}}C.regVisible=function(e){i(e,"onVisible","Visible")},C.regViewable=function(e){i(e,"onViewable","Viewable")},C.clearLocalStorage=function(){ie.clearAdvLocalStorage()},C.useLocalStorage=function(e){S=!1!==e},C.useCookies=function(e){A=!1!==e},C.consent=function(){},C.regTargets=function(i){if(!C.util.isString(i.network)||!C.util.isArray(i.keyValues))return C.out.output("Not a valid network id or array object","adn.regTarget",i);var n=[];if(C.util.forEach(i.keyValues,function(e){if(C.util.isString(e.key)&&C.util.isString(e.value)){var t={key:e.key,value:e.value};e.expiry&&C.util.isInteger(e.expiry)&&(t.expiry=e.expiry),n.push(t)}else C.out.output("Missing an appropriate key and value for registering a target","adn.regTarget",e,i)}),n.length<1)return C.out.output("Missing appropriate targets to register","adn.regTarget",i);var e=C.lib.getRequestLocs(i).retargeting;if(!e)return C.out.output("Couldn't generate req url","regTargets",e,i);var t=C.util.getNewAjax("POST",e,function(){if(t.readyState&&4!==t.readyState)return!1;if(!t.status||200===t.status)return!0;var e=Math.floor(t.status/100);return 4===e?C.out.output("400 error","ajax.onreadystatechange in regTargets",t):5===e?C.out.output("500 error","ajax.onreadystatechange in regTargets",t):C.out.output("Misc error","ajax.onreadystatechange in regTargets",t)});t.open("POST",e),t.withCredentials=X.canAccessLocalStorage()&&!X.isTestAddress(e),t.send(JSON.stringify({network:i.network,keyValues:n}))},C.renderComposedAds=function(){function e(){return C.util.filter(R,function(e){return e.errorStatus===E.errorStatus.noTarget})}if(Q!==E.composedRequest.requestReturned)return-1;var t=e();return t.length<1?0:(re.distributeComposedAds(t),e().length)},C.requestData=function(e){if(!C.util.isDefined(e.auId)&&!C.util.isArray(e.adUnits))return C.out.output("Need an ad unit id or adUnits to make this work.","adn.requestData",e);var n=X.assign({},e);if(!C.util.isFunction(n.onSuccess)&&!C.util.isFunction(n.onResponse))return C.out.output("Need a callback function to make the call worthwhile","adn.requestData",n,e);n.onSuccess=C.util.isFunction(n.onSuccess)?n.onSuccess:C.util.noop,n.onError=C.util.isFunction(n.onError)?n.onError:C.util.noop,n.onResponse=C.util.isFunction(n.onResponse)?n.onResponse:C.util.noop;var t,i,r,a=C.lib.getRequestLocs(n,!0).imp;if(r=n.auId&&!C.util.isArray(n.adUnits)?(i=X.gatherDataParams([n],null,null,e).adUnits,n):(i=X.gatherDataParams(n.adUnits).adUnits)[0],!(t=X.encodeUrlParams(a,{format:"json"},e)))return C.out.output("Couldn't generate server url","requestData",t,e);t+=X.encodeAsUrlParams(ie.getIdsAsObj(r),!0),t+=X.encodeAsUrlParams(ie.getAllIdsAsObj()||{},!0),t+=X.encodeAsUrlParams(ie.getEuConsentAsObj(e)||{},!0),e.gdpr&&(t+=X.encodeAsUrlParams({gdpr:e.gdpr},!0));var s=C.util.getNewAjax("POST",t,function(){if(s.readyState&&4!==s.readyState)return!1;function t(e,t){var i=X.assign(e,{responseCode:s.status,responseText:s.responseText});n.onResponse(i),(t||n.onError)(i)}if((!s.status||200===s.status)&&C.util.isStringWithChars(s.responseText))try{var e=JSON.parse(s.responseText);return t({responseJSON:e},n.onSuccess),e.metaData&&ie.writeAdvLs(e.metaData,e.network),e}catch(e){return t({error:e,errorText:"Error with parsing the response text"}),C.out.output("Parsing response text fail","ajax.onreadystatechange: catch block",e)}var i=Math.floor(s.status/100);return 4===i?(t({errorText:"Likely error in request made"}),C.out.output("400 error","ajax.onreadystatechange",s)):5===i?(t({errorText:"Likely error in service"}),C.out.output("500 error","ajax.onreadystatechange",s)):(t({errorText:"Error"}),C.out.output("Misc error","ajax.onreadystatechange",s))}),o=X.gatherExclusions(n);X.setAndReturnMetaData(o,e.network),o.adUnits=i,s.send(JSON.stringify(o))},C.regConversion=function(e){if(!C.util.isStringWithChars(e.eventType))return C.out.output("Missing a value for eventType","regConversion",e);if(e.eventValue&&!C.util.isNumber(e.eventValue))return C.out.output("The event value must be a number","regConversion",e);var t=C.lib.getRequestLocs(e).conversion,i=C.util.getNewAjax(X.isTestAddress(t)?"GET":"POST",t,function(){if(i.readyState&&4!==i.readyState)return!1;if(i.status&&200!==i.status)return C.out.output("Error status returned","composed",i);var e;try{e=JSON.parse(i.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block",i)}e.metaData&&ie.writeAdvLs(e.metaData,e.network)});i.withCredentials=X.canAccessLocalStorage();var n=X.copyArgValues({},e,["network","adSource","eventType","eventValue"]);X.setAndReturnMetaData(n,n.network);var r=ie.getConvStorageAsObj();C.util.isObject(r)&&C.util.hasProperties(r)&&(n.metaData=n.metaData||{},n.metaData.clicks=JSON.stringify(r)),i.send(JSON.stringify(n))},C.clearDivs=function(){C.util.forEach(O,function(e){var t=X.getDocEl(e);t&&(C.util.isStringWithChars(e.prevStyle)?t.setAttribute("style",e.prevStyle):t.style.display="none",t.innerHTML="")}),C.clearOut()},C.clearOut=function(){O={},D={},k={},R={},L={},x={},N={},K=[]};var d,l,c,g,n=(d=[],l=2e3,c=4e3,g=function(e){if(!C.util.isArray(e))return!1;var t=!0;return C.util.forEach(e,function(e){C.util.isArray(e)&&2===e.length&&C.util.isInteger(e[0])&&C.util.isInteger(e[1])||(t=!1)}),t},function(e,t,i){r(e,t,i)});function f(t){return C.util.find(d,function(e){return e.reqId===t})}function p(r,a,n,e,s){if(f(e)){var t;t=e,d=C.util.filter(d,function(e){return e.reqId!==t});var i=function(){!s&&C.util.isTrue(X.getParam(n,"gptAsync"))&&r.setTargetingForGPTAsync&&r.setTargetingForGPTAsync();var e=C.util.isFunction(r.getBidResponses)?r.getBidResponses():[],t=C.util.isFunction(r.getNoBids)?r.getNoBids():[],i=C.util.isTrue(X.getParam(n,"debug"));if(i&&(s&&C.out.output("Prebid.js load timed-out","headerBidRequest"),C.out.simple("Bid responses from prebid",e),C.out.simple("Responses with no bids",t)),a.headerBids=[],C.util.forEach(e,function(e){C.util.forEach(e.bids,function(e){var t=X.clone(e);t.dealId||delete t.dealId,delete t.metrics,delete t.ad,a.headerBids.push(t)})}),C.util.forEach(t,function(e){C.util.forEach(e.bids,function(e){var t=X.clone(e);t.cpm=0,t.statusMessage="Bid returned empty or error response";var i=e.bidderCode||e.bidder;t.bidderCode=C.util.isStringWithChars(i)?i:"",C.util.isStringWithChars(i)||C.out.output("Invalid bidder code has been set. Needs to be a String.","headerBidRequest",e.bidderCode||e.bidder,e);var n=g(e.sizes);n||C.out.output("Invalid sizes have been configured. Should be an two-dimension array of integers within an array","headerBidRequest",e.sizes,e),t.sizes=n?e.sizes:[],t.dealId||delete t.dealId,a.headerBids.push(t)})}),!a.adUnits||!C.util.isArray(a.adUnits)||0===a.adUnits.length)return C.util.isFunction(r.getHighestCpmBids)?void C.util.forEach(r.getHighestCpmBids(),function(e){if(e.adId&&e.adUnitCode){var t=P.createElement("iframe"),i=P.getElementById(e.adUnitCode);if(i){i.append(t);var n=t.contentDocument||t.contentWindow.document;n.open(),r.renderAd(n,e.adId),n.close()}else C.out.output("Could not find target div for "+e.adUnitCode,"Prebid",e)}else C.out.output("Could not find required adId or adUnitCode in bid","Prebid loop",e)}):void C.out.output("Prebid.js not loaded or could not find getHighestCpmBids","Prebid loop",r,a);i&&C.out.output("Header bids sent through to Adnuntius","headerBidRequest",a.headerBids),P.location&&-1<P.location.hostname.indexOf("cosmosmagazine")&&(a.env="cloudflare"),n&&n.env&&(a.env=n.env),C.request(a)};s||!r.que?i():r.que.push(i)}}function m(){if(0<d.length){var e=d[0];r(e.prebidAdUnits,e.adnRequest,e.config,e.reqId)}}function r(e,t,i,n){var r=t||{},a=n||X.uuid();if(f(a)||d.push({reqId:a,prebidAdUnits:e,adnRequest:r,config:i}),!e||!C.util.isArray(e)||e.length<1)return p({},r,i,a),void m();if(!(1<d.length)||C.util.isString(n)){T.pbjs=T.pbjs||{};var s=T.pbjs;s.que=s.que||[];var o;o=T.setTimeout(function(){p(s,r,i,a,!0),m()},c),s.que.push(function(){o&&T.clearTimeout(o),f(a)?(s.removeAdUnit(),i&&s.setConfig(i),s.addAdUnits(e),s.requestBids({bidsBackHandler:function(){p(s,r,i,a),m()},timeout:l})):C.out.output("Prebid script loading probably timed out and only now has prebid loaded, which is after the ad request has passed through to Adnuntius","headerBid",d)})}}function v(){var e=ie.getAllDatStorageAsObj();return e.browserId=C.util.isStringWithChars(e.browserId)?e.browserId:X.uuid(),e.extSync=C.util.isObject(e.extSync)?e.extSync:{},ie.writeDatLs(e),e}function y(e,t,i,n){if(!C.util.isStringWithChars(e))return C.out.output("Need a folder Id","adnDataRequest",e,t,i);var r=X.clone(t||{});r.folderId=e;var a=v();r.browserId=r.browserId||a.browserId,r.ctx=T.location.href||P.referrer;var s,o=C.lib.getAdnDataLocs(r),u=o[i.locKey];if(u+=X.encodeAsUrlParams(ie.getEuConsentAsObj(r)||{},!0),i.pick&&i.pick.length){var d=X.copyArgValues({},r,i.pick)||{};"POST"===i.method?s=JSON.stringify(d):u+=X.encodeAsUrlParams(d,!0)}var l=C.util.getNewAjax(i.method,u,C.util.isFunction(n)?function(){n(l)}:null);l.withCredentials=X.canAccessLocalStorage()&&!X.isTestAddress(o[i.locKey]),l.send(s)}C.getSegments=function(i,n){var e=ie.getDatSegments(i);e.segments?n&&C.util.isFunction(n.onResponse)&&n.onResponse(e):y(i,n,{method:"GET",locKey:"user"},function(t){if(t.readyState&&4!==t.readyState)return!1;if((!t.status||200===t.status)&&C.util.isStringWithChars(t.responseText)){var e={};try{e=JSON.parse(t.responseText)}catch(e){C.out.output(e,"ajax.onreadystatechange: catch block send event",t)}delete(e=C.util.isObject(e)?e:{}).expiryEpochMillis,ie.writeDatSegments(i,e),n&&C.util.isFunction(n.onResponse)&&n.onResponse(e)}})},C.getBrowserId=function(){return v().browserId},C.visitor=function(e,t){y(e,t,{method:"POST",pick:["profileValues","browserId","folderId"],locKey:"visitor"})},C.view=function(e,t){y(e,t,{method:"POST",pick:["categories","keywords","domainName","ctx"],locKey:"page"})},C.assignSegment=function(e,t){y(e,{segmentId:t},{method:"GET",pick:["segmentId"],locKey:"segment"})},C.externalUserSync=function(e,t){if(!C.util.isStringWithChars(e)||!E.sync[t])return C.out.output("Need a valid folder ID and external system ID to proceed","externalUserSync",e,t);var i=v(),n=E.sync[t].replace("{BROWSER_ID}",encodeURIComponent(i.browserId)).replace("{FOLDER_ID}",encodeURIComponent(e)),r=i.extSync[t];(new Date).getTime();C.util.isInteger(r);var a=P.createElement("img");a.setAttribute("alt",""),a.setAttribute("src",n),a.setAttribute("class","adn-sync-pixel"),a.setAttribute("style","position:absolute;top:-999999px;left:-9999999px;"),a.setAttribute("height","1"),a.setAttribute("width","1"),P.body.appendChild(a)},C.sync=function(e,t){if(!C.util.isStringWithChars(t.externalSystemType)||!C.util.isStringWithChars(t.externalSystemUserId))return C.out.output("Need an external system type or external system user id","sync",e,t);y(e,t,{method:"POST",pick:["externalSystemType","externalSystemUserId","browserId"],locKey:"sync"})},C.chbRequest=n,C.regScriptServe=function(e,t){var i=P.getElementById("script-"+t);return i&&i.src&&-1<i.src.indexOf("format=js")?(O[t]?O[t].container="div":a({subdomain:-1<e.indexOf('data-subdomain="limited"')&&"limited",widgetId:t,container:"div"}),X.addWidgetIdToProcessAd(e,t)):e},C.callChildFunction=function(n){if(!n||!C.util.isStringWithChars(n.name))return C.out.output("Not enough info to proceed","callChildFunction",name);var r={name:n.name,args:n.args,event:E.events.CUSTOM},a={messageType:E.postMessageType.toChildPubs,event:E.events.CUSTOM,functionCalls:[r]};C.util.forEach(O,function(e,t){if(!(C.util.isStringWithChars(n.targetId)&&e.targetId!==n.targetId||C.util.isStringWithChars(n.targetClass)&&e.targetClass!==n.targetClass||C.util.isStringWithChars(n.auId)&&e.auId!==n.auId)){a.widgetId=e.widgetId;var i=P.getElementById(e.widgetId);if(!i)return O[t].cachedFunctionCalls=O[t].cachedFunctionCalls||[],void O[t].cachedFunctionCalls.push(r);X.postMessageToChild(i,a)}})},C.request=function(r){function e(){var i=r;if(r.amp&&r.amp.data){(i=r.amp.data).mode="amp",i.container=i.container||"div",i.adUnits=[{auId:i.auId,auW:i.width,auH:i.height}],C.util.forEach(["c","kv","segments","floorPrice"],function(t){if(C.util.isString(i[t]))try{i[t]=JSON.parse(i[t])}catch(e){i[t]=""}else i[t]=""});var e=i.targetId||"adn-"+i.auId;if(!P.getElementById(e)){var t=P.createElement("div");t.setAttribute("id",e),P.getElementById("c").appendChild(t)}}(C.util.isStringWithChars(i.lineItemId)||C.util.isStringWithChars(i.creativeSetId)||C.util.isStringWithChars(i.orderId))&&(i.creativeTag=!0),a(i);var n=E.methodEnums.ifr;C.util.isArray(i.adUnits)&&!r.isPreview?n=E.methodEnums.composed:C.util.isArray(i.creatives)?n=E.methodEnums.preview:C.util.isStringWithChars(i.creativeContent)?n=E.methodEnums.previewDirect:i.creativeTag&&(n=E.methodEnums.creativeTag),u(i,I,n)}r.requestTiming===E.requestTiming.onReady?X.onDocReady(e):r.requestTiming===E.requestTiming.onLoad?X.onLoad(e):e()},C.display=function(e){u(e,t,"style")},C.setFeedbackOptions=function(e){te.setFeedbackOptions(e)},C.preview=function(e){return C.util.isArray(e.creatives)?C.util.isStringWithChars(e.networkId)||C.util.isStringWithChars(e.network)?(e.isPreview=!0,void C.request(e)):C.out.output("A network ID is required for a preview","preview",e):C.out.output("An array of creatives is required for preview","preview",e)}}(),function(){if(!u){var t=X.getAndSetScriptOverride(),e=X.getQueryParamsByName("script-server-override");if(t&&!e){var i=function(){var e=P.createElement("script");e.id=c,e.src=t,P.body.appendChild(e)};return P.body?i():C.util.addEventListener(T,"load",i)}}var n,r=X.getQueryParamsByName("block-refresh");C.util.isString(r)&&0<r.length&&(d=!0),ee.regDestination(),te.registerListeners(),te.setFeedbackOptions();var a=0;function s(){if(n){var e=T.__tcfapi||function(){try{return T.top.__tcfapi}catch(e){C.out.devOutput("Can't reach top window",e)}}();10<++a?clearTimeout(n):e&&C.util.isFunction(e)&&(clearTimeout(n),e("addEventListener",2,function(e,t){t&&(e.hasOwnProperty("gdprApplies")&&(g=e.gdprApplies),e.hasOwnProperty("tcString")&&(l=e.tcString))}))}}n=T.setInterval(s,250);function o(){try{var t;for(s();t=C.calls.shift();)try{t()}catch(e){C.out.output(e,"executeCalls: inside while catch block",t,C.calls)}}catch(e){C.out.output(e,"executeCalls: outside while catch block",C.calls)}}T.setTimeout(o,25),C.calls.push=function(){return Array.prototype.push.apply(this,arguments),T.setTimeout(o,1),this.length}}()}(adn,document,window)}catch(e){adn.out.output(e,"Blanket catch block")}
//# sourceMappingURL=adn.js.map
