"use strict";(self.webpackChunk_amzn_stores_content_rendering_server=self.webpackChunk_amzn_stores_content_rendering_server||[]).push([[1417],{56359:function(e,t,n){n.d(t,{d:function(){return R}});n(56090),n(60802),n(6635),n(72281),n(74354),n(42955),n(74181),n(45864),n(21442),n(81892),n(19643),n(27678),n(76308),n(56750),n(60277),n(19324),n(43452),n(67237),n(27268),n(13156),n(37192);var o=n(31823),i=n.n(o),r=n(30064),a=n.n(r),s=n(85202),c=n.n(s),l=n(49350),u=n.n(l),d=n(12634),p=n.n(d),h=n(8330),f=n.n(h),v=n(13607),w=n(1473),y=n(20911),b=n(40502),g=n(14464),m=n(59733),S=n(21896),_=n(91927),C=n(55563),x=n(23153),O={wrapper:"VariationHandler__wrapper__EwrUC",container:"VariationHandler__container__dyo50",insideBottomSheet:"VariationHandler__insideBottomSheet__FYs15",expanded:"VariationHandler__expanded__CZv5C",showcaseRoot:"VariationHandler__showcaseRoot__DgkEa",portalWrapper:"VariationHandler__portalWrapper__PBTj2",active:"VariationHandler__active__D8879",wrapperWithoutVariations:"VariationHandler__wrapperWithoutVariations__wZFiL"},V=n(25266);function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){P(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function T(e,t){return T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},T(e,t)}function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=E(e);if(t){var i=E(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return function(e,t){if(t&&("object"===A(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function E(e){return E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},E(e)}var N=i().bind(O),R=function(e){var t=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}(s,t);var n,o,i,r=B(s);function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=r.call(this,e,t)).onWindowResize=function(){var e=a()("themeContext.variationInsideBottomSheetHeight")(n.context);e&&n.setState({windowHeight:window.innerHeight*e})},n.debouncedUpdateWindowSize=u()(10,n.onWindowResize),n.renderLoadingSpinner=function(){return(0,V.jsx)(v.Z,{visible:!0,backgroundAlpha:0,backgroundColor:"transparent",showSpinner:!0,icon:"spinner"})},n.context=t,n.weblabChecker=new y.ZP(t),n.state={hasVariations:e.hasVariations,variations:null,isLoading:!1,isDropdownOpen:!1,product:j({},e),windowHeight:null},n}return n=s,o=[{key:"getChildContext",value:function(){var e=this;return{dropdownCallback:{onOpen:function(t,n){return e.handleDropdownOpen(t,n)},onClose:function(t,n,o){return e.handleDropdownClose(t,n,o)},onSelected:function(t){return e.handleDropdownSelected(t,!1)},onImageDimensionSelected:function(t){return e.handleDropdownSelected(t,!0)}},portalContainer:function(){return e.portalWrapper}}}},{key:"componentDidMount",value:function(){var e,t=this.props,n=t.asin,o=t.clearVariationPreselectByAsin,i=t.insideBottomSheet,r=t.variationPreselect,a=void 0===r?{}:r;if(null!==(e=a[n])&&void 0!==e&&e.preselectedAsin){var s,c=null===(s=a[n])||void 0===s?void 0:s.preselectedAsin;o(n),this.loadVariation(c),this.loadASIN(c)}else this.needVariation&&this.loadVariation(n);i&&(this.debouncedUpdateWindowSize(),window.addEventListener("resize",this.debouncedUpdateWindowSize))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this;this.props.asin!==e.asin&&this.setState({hasVariations:e.hasVariations,variations:null,product:j({},e)},(function(){t.needVariation&&e.hasVariations&&t.loadVariation(e.asin)}))}},{key:"componentWillUnmount",value:function(){this.props.insideBottomSheet&&(this.debouncedUpdateWindowSize.cancel(),window.removeEventListener("resize",this.debouncedUpdateWindowSize))}},{key:"handleDropdownSelected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.loadASIN(e,t)}},{key:"handleDropdownOpen",value:function(){this.setState({isDropdownOpen:!0})}},{key:"handleDropdownClose",value:function(e,t,n){var o=this;this.setState({isDropdownOpen:!1}),this.portalWrapper&&this.container&&n&&this.container.addEventListener("transitionend",(function e(){n(),o.container.removeEventListener("transitionend",e)}))}},{key:"pageContext",get:function(){return j(j({},this.context.pageContext),{},{isRealASIN:!0})}},{key:"needVariation",get:function(){var e=this.props,t=e.asin,n=e.variationDetail,o=this.context,i=o.isSLP,r=o.themeContext,a=this.state.hasVariations,s=(r||{}).variationMaxDimensions,c=n.dimensionLength>s;return c&&_.Z.log("Variations","MoreThanSixDimensions","LOG","asin=".concat(t," has more than 6 dimensions")),a&&!c&&!i}},{key:"loadASIN",value:function(e,t){var n=this,o=this.context,i=o.requestContext,r=o.widgetType,a=t?this.context.pageContext:this.pageContext,s=(0,S.zz)({requestContext:i,pageContext:a,widgetType:r,sectionType:"ProductGrid"});return s.data.ASINList=[e],s.data.layout="showcase",this.setState({isLoading:!t}),(0,S.WY)(s).then((function(e){var t=e.products;if(!t||0===t.length)throw new Error("Unable to find products property or products property contain zero element");var o=t[0],i=new C.Z(o,n.context),r=n.state.product;n.setState({isLoading:!1,product:j(j({},r),i.toJSON())})})).catch((function(t){var o=n.props.href;_.Z.log("VariationUtils","RequestProductInfoAjax","ERROR",t);var i=o||"/dp/".concat(e);window.location.assign(i)}))}},{key:"loadVariation",value:function(e){var t=this,n=this.props.asin,o=this.context,i=o.requestContext,r=o.pageContext,a=o.widgetType,s=o.sectionType,l=(0,S.zz)({requestContext:i,pageContext:r,widgetType:a,sectionType:s});return l.url+="/variation",l.data.asin=e,(0,S.WY)(l).then((function(e){var o=e.product;if(!o)throw new Error("Unable to find product property");var i=new x.Z(o).toJSON();i.canonicalAsin=n;var r=t.weblabChecker.isT1Active(b.Cq.GATING_SUBSCRIBE_AND_SAVE)&&t.weblabChecker.isT1Active(b.Cq.SUBSCRIBE_AND_SAVE)||t.weblabChecker.isT1Active(b.Cq.GATING_SUBSCRIBE_AND_SAVE_COUPONS)&&t.weblabChecker.isT1ActiveAndTrigger(b.Cq.SUBSCRIBE_AND_SAVE_COUPONS),a=t.state.product;r||(0,m.qr)(a,void 0)||!(0,g.qt)(i.selectedIndexes)||(i.selectedIndexes=i.selectedIndexes.map((function(e,t){return c()(t)(i.swatchImageDimensionIndexes)&&i.dimensions.length>1||0===e&&1===i.dimensions[t].options.length?e:-1}))),t.setState({variations:i})})).catch((function(e){_.Z.log("VariationUtils","RequestProductVariationAjax","FATAL",e),_.Z.log("".concat(a,"_VariationUtils"),"RequestProductVariationAjax","FATAL",e),t.setState({hasVariations:!1})}))}},{key:"render",value:function(){var t=this,n=null,o=this.props,i=o.insideBottomSheet,r=o.variationDetail,a=o.rootClassName,s=o.textAlign,c=this.state,l=c.variations,u=c.isDropdownOpen;c.isLoading&&(n=this.renderLoadingSpinner());var d=this.state.product,p=(0,V.jsx)(e,j(j({},d),{},{textAlign:s,rootClassName:N("showcaseRoot",a),renderVariations:this.needVariation,variationDetail:r,variations:l})),h=this.state.windowHeight;return!this.needVariation&&i?(0,V.jsx)("div",{className:N("wrapperWithoutVariations"),style:{maxHeight:h},children:p}):this.needVariation?(0,V.jsxs)("div",{className:N("wrapper",{insideBottomSheet:i}),style:{height:h},children:[n,(0,V.jsxs)("div",{ref:function(e){t.container=e},className:N(O.container,{expanded:u}),children:[p,(0,V.jsx)("div",{className:N(O.portalWrapper,{active:i}),ref:function(e){e&&(t.portalWrapper=e)}})]})]}):p}}],o&&k(n.prototype,o),i&&k(n,i),Object.defineProperty(n,"prototype",{writable:!1}),s}(f().Component);return t.propTypes={asin:p().string.isRequired,clearVariationPreselectByAsin:p().func,href:p().string,hasVariations:p().bool,variationDetail:p().shape({dimensionLength:p().number,hasDefaultValue:p().bool}),variationPreselect:p().objectOf(p().shape({preselectedAsin:p().string,dimensions:p().arrayOf(p().string)})),insideBottomSheet:p().bool,textAlign:p().oneOf(["left","right"]),rootClassName:p().string},t.defaultProps={hasVariations:!1,clearVariationPreselectByAsin:function(){},insideBottomSheet:!1,href:void 0,variationDetail:{dimensionLength:0,hasDefaultValue:!1},variationPreselect:{},textAlign:void 0,rootClassName:void 0},t.contextTypes={configOverride:w.Yj,requestContext:w.ci,pageContext:w.pn,translations:p().object,themeContext:p().shape({variationMaxDimensions:p().number,variationInsideBottomSheetHeight:p().number}),widgetType:p().string,sectionType:p().string,isSLP:p().bool},t.childContextTypes={dropdownCallback:p().shape({onOpen:p().func,onClose:p().func,onSelected:p().func,onImageDimensionSelected:p().func}),portalContainer:p().func},t}}}]);