<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bird-sdk.html</title>
</head>
<body>

<script>
var autoloader=function(vt){"use strict";function Qn(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in r)){const i=Object.getOwnPropertyDescriptor(n,a);i&&Object.defineProperty(r,a,i.get?i:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}class yt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,yt.prototype)}}function oe(r,e){if(!r)throw new yt(typeof e=="function"?e():e)}const Le={off:"off",track:"track",enqueue:"enqueue",identify:"identify"},se={chatwidget:"chatwidget",form:"form",knowledgeBase:"knowledgeBase",deepLink:"deepLink",channelTemplate:"channelTemplate",website:"website",htmlEmail:"htmlEmail",popup:"popup",helpcenter:"helpcenter",adCreative:"adCreative",preferencecenter:"preferencecenter",landingpage:"landingpage"},mt={first_alias:"first_alias",first_move:"first_move"},ze={SignedIdentity:"SignedIdentity",PushToken:"PushToken",Visitor:"Visitor",ExternalIdentifier:"ExternalIdentifier",CollectedIdentifier:"CollectedIdentifier"};async function Hn(r){let e;switch(typeof r){case"string":e=await wr(r);break;case"object":e=r;break;default:throw new Error("Invalid config")}return Jn(Zn(e))}async function wr(r){return(await fetch(ei(r))).json()}function Jn(r){return oe(r,"config is required"),oe(r.tracking,"tracking is required"),oe(r.tracking.writeKey,"tracking.writeKey is required"),oe(r.tracking.endpoint,"tracking.endpoint is required"),oe(r.workspaceId,"workspaceId is required"),oe(Yn(r.tracking.anonymousTracking),"Invalid anonymous tracking mode"),r}const Yn=r=>Object.values(Le).includes(r);function Zn(r){return r.tracking&&!r.tracking.anonymousTracking&&(r.tracking.anonymousTracking=Le.off),r}function Xn(){return String(Math.floor(Date.now()/3e5))}function ei(r){const e=new URL(r),t=Xn();return e.searchParams.set("_",t),e.toString()}var gt=function(r,e){return gt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},gt(r,e)};function $(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");gt(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var b=function(){return b=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},b.apply(this,arguments)};function kr(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(t[n[a]]=r[n[a]]);return t}function _(r,e,t,n){function a(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function o(l){try{c(n.next(l))}catch(d){s(d)}}function u(l){try{c(n.throw(l))}catch(d){s(d)}}function c(l){l.done?i(l.value):a(l.value).then(o,u)}c((n=n.apply(r,e||[])).next())})}function S(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(t=0)),t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function B(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;function bt(r,e,t){e.split&&(e=e.split("."));for(var n=0,a=e.length,i=r,s,o;n<a&&(o=""+e[n++],!(o==="__proto__"||o==="constructor"||o==="prototype"));)i=i[o]=n===a?t:typeof(s=i[o])==typeof e?s:e[n]*0!==0||~(""+e[n]).indexOf(".")?{}:[]}var ti=function(r,e){return Object.keys(r).filter(function(t){return e(t,r[t])}).reduce(function(t,n){return t[n]=r[n],t},{})},he=function(r){$(e,r);function e(t,n){var a=r.call(this,"".concat(t," ").concat(n))||this;return a.field=t,a}return e}(Error);function pe(r){return typeof r=="string"}function wt(r){return typeof r=="number"}function Ie(r){return typeof r=="function"}function ri(r){return r!=null}function V(r){return Object.prototype.toString.call(r).slice(8,-1).toLowerCase()==="object"}var kt="is not a string",At="is not an object",ni="is nil";function ii(r){if(!ri(r))throw new he("Event",ni);if(typeof r!="object")throw new he("Event",At)}function ai(r){if(!pe(r.type))throw new he(".type",kt)}function oi(r){if(!pe(r.event))throw new he(".event",kt)}function si(r){if(!V(r.properties))throw new he(".properties",At)}function ui(r){if(!V(r.traits))throw new he(".traits",At)}function ci(r){if(!pe(r.messageId))throw new he(".messageId",kt)}function li(r){ii(r),ai(r),ci(r),r.type==="track"&&(oi(r),si(r)),["group","identify"].includes(r.type)&&ui(r)}var di=function(){function r(e){var t,n;this.settings=e,this.createMessageId=e.createMessageId,this.onEventMethodCall=(t=e.onEventMethodCall)!==null&&t!==void 0?t:function(){},this.onFinishedEvent=(n=e.onFinishedEvent)!==null&&n!==void 0?n:function(){}}return r}(),fi=function(){function r(e){this.settings=new di(e)}return r.prototype.track=function(e,t,n,a){return this.settings.onEventMethodCall({type:"track",options:n}),this.normalize(b(b({},this.baseEvent()),{event:e,type:"track",properties:t??{},options:b({},n),integrations:b({},a)}))},r.prototype.page=function(e,t,n,a,i){var s;this.settings.onEventMethodCall({type:"page",options:a});var o={type:"page",properties:b({},n),options:b({},a),integrations:b({},i)};return e!==null&&(o.category=e,o.properties=(s=o.properties)!==null&&s!==void 0?s:{},o.properties.category=e),t!==null&&(o.name=t),this.normalize(b(b({},this.baseEvent()),o))},r.prototype.screen=function(e,t,n,a,i){this.settings.onEventMethodCall({type:"screen",options:a});var s={type:"screen",properties:b({},n),options:b({},a),integrations:b({},i)};return e!==null&&(s.category=e),t!==null&&(s.name=t),this.normalize(b(b({},this.baseEvent()),s))},r.prototype.identify=function(e,t,n,a){return this.settings.onEventMethodCall({type:"identify",options:n}),this.normalize(b(b({},this.baseEvent()),{type:"identify",userId:e,traits:t??{},options:b({},n),integrations:a}))},r.prototype.group=function(e,t,n,a){return this.settings.onEventMethodCall({type:"group",options:n}),this.normalize(b(b({},this.baseEvent()),{type:"group",traits:t??{},options:b({},n),integrations:b({},a),groupId:e}))},r.prototype.alias=function(e,t,n,a){this.settings.onEventMethodCall({type:"alias",options:n});var i={userId:e,type:"alias",options:b({},n),integrations:b({},a)};return t!==null&&(i.previousId=t),e===void 0?this.normalize(b(b({},i),this.baseEvent())):this.normalize(b(b({},this.baseEvent()),i))},r.prototype.baseEvent=function(){return{integrations:{},options:{}}},r.prototype.context=function(e){var t,n=["userId","anonymousId","timestamp","messageId"];delete e.integrations;var a=Object.keys(e),i=(t=e.context)!==null&&t!==void 0?t:{},s={};return a.forEach(function(o){o!=="context"&&(n.includes(o)?bt(s,o,e[o]):bt(i,o,e[o]))}),[i,s]},r.prototype.normalize=function(e){var t,n,a=Object.keys((t=e.integrations)!==null&&t!==void 0?t:{}).reduce(function(f,h){var v,m;return b(b({},f),(v={},v[h]=!!(!((m=e.integrations)===null||m===void 0)&&m[h]),v))},{});e.options=ti(e.options||{},function(f,h){return h!==void 0});var i=b(b({},a),(n=e.options)===null||n===void 0?void 0:n.integrations),s=e.options?this.context(e.options):[],o=s[0],u=s[1],c=e.options,l=kr(e,["options"]),d=b(b(b(b({timestamp:new Date},l),{context:o,integrations:i}),u),{messageId:c.messageId||this.settings.createMessageId()});return this.settings.onFinishedEvent(d),li(d),d},r}();function _t(r,e){return new Promise(function(t,n){var a=setTimeout(function(){n(Error("Promise timed out"))},e);r.then(function(i){return clearTimeout(a),t(i)}).catch(n)})}function hi(r){return new Promise(function(e){return setTimeout(e,r)})}function pi(r,e,t){var n=function(){try{return Promise.resolve(e(r))}catch(a){return Promise.reject(a)}};return hi(t).then(function(){return _t(n(),1e3)}).catch(function(a){r?.log("warn","Callback Error",{error:a}),r?.stats.increment("callback_error")}).then(function(){return r})}var St=function(){var r,e,t=!1,n=new Promise(function(a,i){r=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];t=!0,a.apply(void 0,s)},e=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];t=!0,i.apply(void 0,s)}});return{resolve:r,reject:e,promise:n,isSettled:function(){return t}}},It=function(){function r(e){var t;this.callbacks={},this.warned=!1,this.maxListeners=(t=e?.maxListeners)!==null&&t!==void 0?t:10}return r.prototype.warnIfPossibleMemoryLeak=function(e){this.warned||this.maxListeners&&this.callbacks[e].length>this.maxListeners&&(console.warn("Event Emitter: Possible memory leak detected; ".concat(String(e)," has exceeded ").concat(this.maxListeners," listeners.")),this.warned=!0)},r.prototype.on=function(e,t){return this.callbacks[e]?(this.callbacks[e].push(t),this.warnIfPossibleMemoryLeak(e)):this.callbacks[e]=[t],this},r.prototype.once=function(e,t){var n=this,a=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];n.off(e,a),t.apply(n,i)};return this.on(e,a),this},r.prototype.off=function(e,t){var n,a=(n=this.callbacks[e])!==null&&n!==void 0?n:[],i=a.filter(function(s){return s!==t});return this.callbacks[e]=i,this},r.prototype.emit=function(e){for(var t=this,n,a=[],i=1;i<arguments.length;i++)a[i-1]=arguments[i];var s=(n=this.callbacks[e])!==null&&n!==void 0?n:[];return s.forEach(function(o){o.apply(t,a)}),this},r}();function vi(r){var e=Math.random()+1,t=r.minTimeout,n=t===void 0?500:t,a=r.factor,i=a===void 0?2:a,s=r.attempt,o=r.maxTimeout,u=o===void 0?1/0:o;return Math.min(e*n*Math.pow(i,s),u)}for(var Ar="onRemoveFromFuture",qe=function(r){$(e,r);function e(t,n,a){var i=r.call(this)||this;return i.future=[],i.maxAttempts=t,i.queue=n,i.seen=a??{},i}return e.prototype.push=function(){for(var t=this,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];var i=n.map(function(s){var o=t.updateAttempts(s);return o>t.maxAttempts||t.includes(s)?!1:(t.queue.push(s),!0)});return this.queue=this.queue.sort(function(s,o){return t.getAttempts(s)-t.getAttempts(o)}),i},e.prototype.pushWithBackoff=function(t,n){var a=this;if(n===void 0&&(n=0),n==0&&this.getAttempts(t)===0)return this.push(t)[0];var i=this.updateAttempts(t);if(i>this.maxAttempts||this.includes(t))return!1;var s=vi({attempt:i-1});return n>0&&s<n&&(s=n),setTimeout(function(){a.queue.push(t),a.future=a.future.filter(function(o){return o.id!==t.id}),a.emit(Ar)},s),this.future.push(t),!0},e.prototype.getAttempts=function(t){var n;return(n=this.seen[t.id])!==null&&n!==void 0?n:0},e.prototype.updateAttempts=function(t){return this.seen[t.id]=this.getAttempts(t)+1,this.getAttempts(t)},e.prototype.includes=function(t){return this.queue.includes(t)||this.future.includes(t)||!!this.queue.find(function(n){return n.id===t.id})||!!this.future.find(function(n){return n.id===t.id})},e.prototype.pop=function(){return this.queue.shift()},Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"todo",{get:function(){return this.queue.length+this.future.length},enumerable:!1,configurable:!0}),e}(It),ve=256,Ge=[],We;ve--;)Ge[ve]=(ve+256).toString(16).substring(1);function Pt(){var r=0,e,t="";if(!We||ve+16>256){for(We=Array(r=256);r--;)We[r]=256*Math.random()|0;r=ve=0}for(;r<16;r++)e=We[ve+r],r==6?t+=Ge[e&15|64]:r==8?t+=Ge[e&63|128]:t+=Ge[e],r&1&&r>1&&r<11&&(t+="-");return ve++,t}var yi=function(){function r(){this._logs=[]}return r.prototype.log=function(e,t,n){var a=new Date;this._logs.push({level:e,message:t,time:a,extras:n})},Object.defineProperty(r.prototype,"logs",{get:function(){return this._logs},enumerable:!1,configurable:!0}),r.prototype.flush=function(){if(this.logs.length>1){var e=this._logs.reduce(function(t,n){var a,i,s,o=b(b({},n),{json:JSON.stringify(n.extras,null," "),extras:n.extras});delete o.time;var u=(s=(i=n.time)===null||i===void 0?void 0:i.toISOString())!==null&&s!==void 0?s:"";return t[u]&&(u="".concat(u,"-").concat(Math.random())),b(b({},t),(a={},a[u]=o,a))},{});console.table?console.table(e):console.log(e)}else this.logs.forEach(function(t){var n=t.level,a=t.message,i=t.extras;n==="info"||n==="debug"?console.log(a,i??""):console[n](a,i??"")});this._logs=[]},r}(),mi=function(r){var e={gauge:"g",counter:"c"};return e[r]},_r=function(){function r(){this.metrics=[]}return r.prototype.increment=function(e,t,n){t===void 0&&(t=1),this.metrics.push({metric:e,value:t,tags:n??[],type:"counter",timestamp:Date.now()})},r.prototype.gauge=function(e,t,n){this.metrics.push({metric:e,value:t,tags:n??[],type:"gauge",timestamp:Date.now()})},r.prototype.flush=function(){var e=this.metrics.map(function(t){return b(b({},t),{tags:t.tags.join(",")})});console.table?console.table(e):console.log(e),this.metrics=[]},r.prototype.serialize=function(){return this.metrics.map(function(e){return{m:e.metric,v:e.value,t:e.tags,k:mi(e.type),e:e.timestamp}})},r}(),gi=function(r){$(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.gauge=function(){},e.prototype.increment=function(){},e.prototype.flush=function(){},e.prototype.serialize=function(){return[]},e}(_r),ue=function(){function r(e){var t,n,a;this.retry=(t=e.retry)!==null&&t!==void 0?t:!0,this.type=(n=e.type)!==null&&n!==void 0?n:"plugin Error",this.reason=(a=e.reason)!==null&&a!==void 0?a:""}return r}(),Qe=function(){function r(e,t,n,a){t===void 0&&(t=Pt()),n===void 0&&(n=new gi),a===void 0&&(a=new yi),this.attempts=0,this.event=e,this._id=t,this.logger=a,this.stats=n}return r.system=function(){},r.prototype.isSame=function(e){return e.id===this.id},r.prototype.cancel=function(e){throw e||new ue({reason:"Context Cancel"})},r.prototype.log=function(e,t,n){this.logger.log(e,t,n)},Object.defineProperty(r.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),r.prototype.updateEvent=function(e,t){var n;if(e.split(".")[0]==="integrations"){var a=e.split(".")[1];if(((n=this.event.integrations)===null||n===void 0?void 0:n[a])===!1)return this.event}return bt(this.event,e,t),this.event},r.prototype.failedDelivery=function(){return this._failedDelivery},r.prototype.setFailedDelivery=function(e){this._failedDelivery=e},r.prototype.logs=function(){return this.logger.logs},r.prototype.flush=function(){this.logger.flush(),this.stats.flush()},r.prototype.toJSON=function(){return{id:this._id,event:this.event,logs:this.logger.logs,metrics:this.stats.metrics}},r}();function bi(r,e){var t={};return r.forEach(function(n){var a,i=void 0;{var s=n[e];i=typeof s!="string"?JSON.stringify(s):s}i!==void 0&&(t[i]=B(B([],(a=t[i])!==null&&a!==void 0?a:[],!0),[n],!1))}),t}var wi=function(r){return typeof r=="object"&&r!==null&&"then"in r&&typeof r.then=="function"},ki=function(){var r,e,t=0;return{done:function(){return r},run:function(n){var a=n();return wi(a)&&(++t===1&&(r=new Promise(function(i){return e=i})),a.finally(function(){return--t===0&&e()})),a}}};function Ai(r){return _(this,void 0,void 0,function(){var e;return S(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,r()];case 1:return[2,t.sent()];case 2:return e=t.sent(),[2,Promise.reject(e)];case 3:return[2]}})})}function ye(r,e){r.log("debug","plugin",{plugin:e.name});var t=new Date().getTime(),n=e[r.event.type];if(n===void 0)return Promise.resolve(r);var a=Ai(function(){return n.apply(e,[r])}).then(function(i){var s=new Date().getTime()-t;return i.stats.gauge("plugin_time",s,["plugin:".concat(e.name)]),i}).catch(function(i){if(i instanceof ue&&i.type==="middleware_cancellation")throw i;return i instanceof ue?(r.log("warn",i.type,{plugin:e.name,error:i}),i):(r.log("error","plugin Error",{plugin:e.name,error:i}),r.stats.increment("plugin_error",1,["plugin:".concat(e.name)]),i)});return a}function _i(r,e){return ye(r,e).then(function(t){if(t instanceof Qe)return t;r.log("debug","Context canceled"),r.stats.increment("context_canceled"),r.cancel(t)})}var Si=function(r){$(e,r);function e(t){var n=r.call(this)||this;return n.criticalTasks=ki(),n.plugins=[],n.failedInitializations=[],n.flushing=!1,n.queue=t,n.queue.on(Ar,function(){n.scheduleFlush(0)}),n}return e.prototype.register=function(t,n,a){return _(this,void 0,void 0,function(){var i,s,o=this;return S(this,function(u){switch(u.label){case 0:return this.plugins.push(n),i=function(c){o.failedInitializations.push(n.name),o.emit("initialization_failure",n),console.warn(n.name,c),t.log("warn","Failed to load destination",{plugin:n.name,error:c}),o.plugins=o.plugins.filter(function(l){return l!==n})},n.type==="destination"&&n.name!=="Segment.io"?(n.load(t,a).catch(i),[3,4]):[3,1];case 1:return u.trys.push([1,3,,4]),[4,n.load(t,a)];case 2:return u.sent(),[3,4];case 3:return s=u.sent(),i(s),[3,4];case 4:return[2]}})})},e.prototype.deregister=function(t,n,a){return _(this,void 0,void 0,function(){var i;return S(this,function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),n.unload?[4,Promise.resolve(n.unload(t,a))]:[3,2];case 1:s.sent(),s.label=2;case 2:return this.plugins=this.plugins.filter(function(o){return o.name!==n.name}),[3,4];case 3:return i=s.sent(),t.log("warn","Failed to unload destination",{plugin:n.name,error:i}),[3,4];case 4:return[2]}})})},e.prototype.dispatch=function(t){return _(this,void 0,void 0,function(){var n;return S(this,function(a){return t.log("debug","Dispatching"),t.stats.increment("message_dispatched"),this.queue.push(t),n=this.subscribeToDelivery(t),this.scheduleFlush(0),[2,n]})})},e.prototype.subscribeToDelivery=function(t){return _(this,void 0,void 0,function(){var n=this;return S(this,function(a){return[2,new Promise(function(i){var s=function(o,u){o.isSame(t)&&(n.off("flush",s),i(o))};n.on("flush",s)})]})})},e.prototype.dispatchSingle=function(t){return _(this,void 0,void 0,function(){var n=this;return S(this,function(a){return t.log("debug","Dispatching"),t.stats.increment("message_dispatched"),this.queue.updateAttempts(t),t.attempts=1,[2,this.deliver(t).catch(function(i){var s=n.enqueuRetry(i,t);return s?n.subscribeToDelivery(t):(t.setFailedDelivery({reason:i}),t)})]})})},e.prototype.isEmpty=function(){return this.queue.length===0},e.prototype.scheduleFlush=function(t){var n=this;t===void 0&&(t=500),!this.flushing&&(this.flushing=!0,setTimeout(function(){n.flush().then(function(){setTimeout(function(){n.flushing=!1,n.queue.length&&n.scheduleFlush(0)},0)})},t))},e.prototype.deliver=function(t){return _(this,void 0,void 0,function(){var n,a,i,s;return S(this,function(o){switch(o.label){case 0:return[4,this.criticalTasks.done()];case 1:o.sent(),n=Date.now(),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this.flushOne(t)];case 3:return t=o.sent(),a=Date.now()-n,this.emit("delivery_success",t),t.stats.gauge("delivered",a),t.log("debug","Delivered",t.event),[2,t];case 4:throw i=o.sent(),s=i,t.log("error","Failed to deliver",s),this.emit("delivery_failure",t,s),t.stats.increment("delivery_failed"),i;case 5:return[2]}})})},e.prototype.enqueuRetry=function(t,n){var a=!(t instanceof ue)||t.retry;return a?this.queue.pushWithBackoff(n):!1},e.prototype.flush=function(){return _(this,void 0,void 0,function(){var t,n,a;return S(this,function(i){switch(i.label){case 0:if(this.queue.length===0)return[2,[]];if(t=this.queue.pop(),!t)return[2,[]];t.attempts=this.queue.getAttempts(t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.deliver(t)];case 2:return t=i.sent(),this.emit("flush",t,!0),[3,4];case 3:return n=i.sent(),a=this.enqueuRetry(n,t),a||(t.setFailedDelivery({reason:n}),this.emit("flush",t,!1)),[2,[]];case 4:return[2,[t]]}})})},e.prototype.isReady=function(){return!0},e.prototype.availableExtensions=function(t){var n=this.plugins.filter(function(h){var v,m,p;if(h.type!=="destination"&&h.name!=="Segment.io")return!0;var y=void 0;return(v=h.alternativeNames)===null||v===void 0||v.forEach(function(g){t[g]!==void 0&&(y=t[g])}),(p=(m=t[h.name])!==null&&m!==void 0?m:y)!==null&&p!==void 0?p:(h.name==="Segment.io"?!0:t.All)!==!1}),a=bi(n,"type"),i=a.before,s=i===void 0?[]:i,o=a.enrichment,u=o===void 0?[]:o,c=a.destination,l=c===void 0?[]:c,d=a.after,f=d===void 0?[]:d;return{before:s,enrichment:u,destinations:l,after:f}},e.prototype.flushOne=function(t){var n,a;return _(this,void 0,void 0,function(){var i,s,o,u,c,l,v,d,f,h,v,m,p,y,g;return S(this,function(w){switch(w.label){case 0:if(!this.isReady())throw new Error("Not ready");t.attempts>1&&this.emit("delivery_retry",t),i=this.availableExtensions((n=t.event.integrations)!==null&&n!==void 0?n:{}),s=i.before,o=i.enrichment,u=0,c=s,w.label=1;case 1:return u<c.length?(l=c[u],[4,_i(t,l)]):[3,4];case 2:v=w.sent(),v instanceof Qe&&(t=v),this.emit("message_enriched",t,l),w.label=3;case 3:return u++,[3,1];case 4:d=0,f=o,w.label=5;case 5:return d<f.length?(h=f[d],[4,ye(t,h)]):[3,8];case 6:v=w.sent(),v instanceof Qe&&(t=v),this.emit("message_enriched",t,h),w.label=7;case 7:return d++,[3,5];case 8:return m=this.availableExtensions((a=t.event.integrations)!==null&&a!==void 0?a:{}),p=m.destinations,y=m.after,[4,new Promise(function(k,A){setTimeout(function(){var I=p.map(function(E){return ye(t,E)});Promise.all(I).then(k).catch(A)},0)})];case 9:return w.sent(),t.stats.increment("message_delivered"),this.emit("message_delivered",t),g=y.map(function(k){return ye(t,k)}),[4,Promise.all(g)];case 10:return w.sent(),[2,t]}})})},e}(It),Ii=function(r,e){var t=Date.now()-r;return Math.max((e??300)-t,0)};function Pi(r,e,t,n){return _(this,void 0,void 0,function(){var a,i;return S(this,function(s){switch(s.label){case 0:return t.emit("dispatch_start",r),a=Date.now(),e.isEmpty()?[4,e.dispatchSingle(r)]:[3,2];case 1:return i=s.sent(),[3,4];case 2:return[4,e.dispatch(r)];case 3:i=s.sent(),s.label=4;case 4:return n?.callback?[4,pi(i,n.callback,Ii(a,n.timeout))]:[3,6];case 5:i=s.sent(),s.label=6;case 6:return n?.debug&&i.flush(),[2,i]}})})}function Ei(r,e,t,n){var a,i=[r,e,t,n],s=V(r)?r.event:r;if(!s||!pe(s))throw new Error("Event missing");var o=V(r)?(a=r.properties)!==null&&a!==void 0?a:{}:V(e)?e:{},u={};Ie(t)||(u=t??{}),V(r)&&!Ie(e)&&(u=e??{});var c=i.find(Ie);return[s,o,u,c]}function Sr(r,e,t,n,a){var i,s,o=null,u=null,c=[r,e,t,n,a],l=c.filter(pe);l[0]!==void 0&&l[1]!==void 0&&(o=l[0],u=l[1]),l.length===1&&(o=null,u=l[0]);var d=c.find(Ie),f=c.filter(function(m){return u===null?V(m):V(m)||m===null}),h=(i=f[0])!==null&&i!==void 0?i:{},v=(s=f[1])!==null&&s!==void 0?s:{};return[o,u,h,v,d]}var Ir=function(r){return function(){for(var e,t,n,a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];for(var s={},o=["callback","options","traits","id"],u=0,c=a;u<c.length;u++){var l=c[u],d=o.pop();if(d==="id"){if(pe(l)||wt(l)){s.id=l.toString();continue}if(l==null)continue;d=o.pop()}if((d==="traits"||d==="options")&&(l==null||V(l))&&(s[d]=l),Ie(l)){s.callback=l;break}}return[(e=s.id)!==null&&e!==void 0?e:r.id(),(t=s.traits)!==null&&t!==void 0?t:{},(n=s.options)!==null&&n!==void 0?n:{},s.callback]}};function Ci(r,e,t,n){wt(r)&&(r=r.toString()),wt(e)&&(e=e.toString());var a=[r,e,t,n],i=a.filter(pe),s=i[0],o=s===void 0?r:s,u=i[1],c=u===void 0?null:u,l=a.filter(V)[0],d=l===void 0?{}:l,f=a.find(Ie);return[o,c,d,f]}function Et(){return typeof window<"u"}function Pr(){return!Et()}function Er(){return Et()?window.navigator.onLine:!0}function ce(){return!Er()}function Ti(r,e){return e=e||{},new Promise(function(t,n){var a=new XMLHttpRequest,i=[],s=[],o={},u=function(){return{ok:(a.status/100|0)==2,statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:u,headers:{keys:function(){return i},entries:function(){return s},get:function(l){return o[l.toLowerCase()]},has:function(l){return l.toLowerCase()in o}}}};for(var c in a.open(e.method||"get",r,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(l,d,f){i.push(d=d.toLowerCase()),s.push([d,f]),o[d]=o[d]?o[d]+","+f:f}),t(u())},a.onerror=n,a.withCredentials=e.credentials=="include",e.headers)a.setRequestHeader(c,e.headers[c]);a.send(e.body||null)})}var Ct=function(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:null},He=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Ct();return(t&&t.fetch||Ti).apply(void 0,r)},Je="1.76.0",Cr="api.segment.io/v1",xi=function(r,e,t){var n=e.reduce(function(a,i){var s=i.split(":"),o=s[0],u=s[1];return a[o]=u,a},{});return{type:"Counter",metric:r,value:1,tags:b(b({},n),{library:"analytics.js",library_version:"npm:next-".concat(Je)})}};function Tt(r){console.error("Error sending segment performance metrics",r)}var Oi=function(){function r(e){var t=this,n,a,i,s,o;if(this.host=(n=e?.host)!==null&&n!==void 0?n:Cr,this.sampleRate=(a=e?.sampleRate)!==null&&a!==void 0?a:1,this.flushTimer=(i=e?.flushTimer)!==null&&i!==void 0?i:30*1e3,this.maxQueueSize=(s=e?.maxQueueSize)!==null&&s!==void 0?s:20,this.protocol=(o=e?.protocol)!==null&&o!==void 0?o:"https",this.queue=[],this.sampleRate>0){var u=!1,c=function(){u||(u=!0,t.flush().catch(Tt),u=!1,setTimeout(c,t.flushTimer))};c()}}return r.prototype.increment=function(e,t){if(e.includes("analytics_js.")&&t.length!==0&&!(Math.random()>this.sampleRate)&&!(this.queue.length>=this.maxQueueSize)){var n=xi(e,t);this.queue.push(n),e.includes("error")&&this.flush().catch(Tt)}},r.prototype.flush=function(){return _(this,void 0,void 0,function(){var e=this;return S(this,function(t){switch(t.label){case 0:return this.queue.length<=0?[2]:[4,this.send().catch(function(n){Tt(n),e.sampleRate=0})];case 1:return t.sent(),[2]}})})},r.prototype.send=function(){return _(this,void 0,void 0,function(){var e,t,n;return S(this,function(a){return e={series:this.queue},this.queue=[],t={"Content-Type":"text/plain"},n="".concat(this.protocol,"://").concat(this.host,"/m"),[2,He(n,{headers:t,body:JSON.stringify(e),method:"POST"})]})})},r}(),Ye,Tr=function(r){$(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.initRemoteMetrics=function(t){Ye=new Oi(t)},e.prototype.increment=function(t,n,a){r.prototype.increment.call(this,t,n,a),Ye?.increment(t,a??[])},e}(_r),J=function(r){$(e,r);function e(t,n){return r.call(this,t,n,new Tr)||this}return e.system=function(){return new this({type:"track",event:"system"})},e}(Qe),xr="bpc",Or=function(r,e,t,n,a,i){return{__t:xr,c:e,p:n,u:r,s:t,t:a,r:i}},Mi=Object.keys(Or("","","","","",""));function Ri(r){if(!V(r)||r.__t!==xr)return!1;for(var e in r)if(!Mi.includes(e))return!1;return!0}var Di=function(r,e){return r.indexOf("?")>-1?r:r+e},Ni=function(r){var e=r.indexOf("#");return e===-1?r:r.slice(0,e)},ji=function(r){try{return new URL(r).pathname}catch{return r[0]==="/"?r:"/"+r}},Mr=function(r){var e=r.c,t=r.p,n=r.s,a=r.u,i=r.r,s=r.t,o=e?ji(e):t,u=e?Di(e,n):Ni(a);return{path:o,referrer:i,search:n,title:s,url:u}},Rr=function(){var r=document.querySelector("link[rel='canonical']");return Or(location.href,r&&r.getAttribute("href")||void 0,location.search,location.pathname,document.title,document.referrer)},Bi=function(){return Mr(Rr())};function Li(r,e){return Object.assign.apply(Object,B([{}],e.map(function(t){var n;if(r&&Object.prototype.hasOwnProperty.call(r,t))return n={},n[t]=r[t],n}),!1))}var Pe=function(r,e){e===void 0&&(e=Bi());var t=r.context,n;r.type==="page"&&(n=r.properties&&Li(r.properties,Object.keys(e)),r.properties=b(b(b({},e),r.properties),r.name?{name:r.name}:{})),t.page=b(b(b({},e),n),t.page)},Ui=function(r){$(e,r);function e(t){var n=r.call(this,{createMessageId:function(){return"ajs-next-".concat(Date.now(),"-").concat(Pt())},onEventMethodCall:function(a){var i=a.options;n.maybeUpdateAnonId(i)},onFinishedEvent:function(a){return n.addIdentity(a),a}})||this;return n.user=t,n}return e.prototype.maybeUpdateAnonId=function(t){t?.anonymousId&&this.user.anonymousId(t.anonymousId)},e.prototype.addIdentity=function(t){this.user.id()&&(t.userId=this.user.id()),this.user.anonymousId()&&(t.anonymousId=this.user.anonymousId())},e.prototype.track=function(t,n,a,i,s){var o=r.prototype.track.call(this,t,n,a,i);return Pe(o,s),o},e.prototype.page=function(t,n,a,i,s,o){var u=r.prototype.page.call(this,t,n,a,i,s);return Pe(u,o),u},e.prototype.screen=function(t,n,a,i,s,o){var u=r.prototype.screen.call(this,t,n,a,i,s);return Pe(u,o),u},e.prototype.identify=function(t,n,a,i,s){var o=r.prototype.identify.call(this,t,n,a,i);return Pe(o,s),o},e.prototype.group=function(t,n,a,i,s){var o=r.prototype.group.call(this,t,n,a,i);return Pe(o,s),o},e.prototype.alias=function(t,n,a,i,s){var o=r.prototype.alias.call(this,t,n,a,i);return Pe(o,s),o},e}(fi),Fi=function(r){return"addMiddleware"in r&&r.type==="destination"},ee={getItem:function(){},setItem:function(){},removeItem:function(){}};try{ee=Et()&&window.localStorage?window.localStorage:ee}catch(r){console.warn("Unable to access localStorage",r)}function Dr(r){var e=ee.getItem(r);return(e?JSON.parse(e):[]).map(function(t){return new J(t.event,t.id)})}function Ki(r,e){var t=Dr(r),n=B(B([],e,!0),t,!0),a=n.reduce(function(i,s){var o;return b(b({},i),(o={},o[s.id]=s,o))},{});ee.setItem(r,JSON.stringify(Object.values(a)))}function Nr(r){var e=ee.getItem(r);return e?JSON.parse(e):{}}function $i(r,e){var t=Nr(r);ee.setItem(r,JSON.stringify(b(b({},t),e)))}function jr(r){ee.removeItem(r)}var Vi=function(){return new Date().getTime()};function xt(r,e,t){t===void 0&&(t=0);var n=50,a="persisted-queue:v1:".concat(r,":lock"),i=function(c){return new Date().getTime()>c},s=ee.getItem(a),o=s?JSON.parse(s):null,u=o===null||i(o);if(u){ee.setItem(a,JSON.stringify(Vi()+n)),e(),ee.removeItem(a);return}!u&&t<3?setTimeout(function(){xt(r,e,t+1)},n):console.error("Unable to retrieve lock")}var Ze=function(r){$(e,r);function e(t,n){var a=r.call(this,t,[])||this,i="persisted-queue:v1:".concat(n,":items"),s="persisted-queue:v1:".concat(n,":seen"),o=[],u={};return xt(n,function(){try{o=Dr(i),u=Nr(s),jr(i),jr(s),a.queue=B(B([],o,!0),a.queue,!0),a.seen=b(b({},u),a.seen)}catch(c){console.error(c)}}),window.addEventListener("pagehide",function(){if(a.todo>0){var c=B(B([],a.queue,!0),a.future,!0);try{xt(n,function(){Ki(i,c),$i(s,a.seen)})}catch(l){console.error(l)}}}),a}return e}(qe),zi=function(r){$(e,r);function e(t){return r.call(this,typeof t=="string"?new Ze(4,t):t)||this}return e.prototype.flush=function(){return _(this,void 0,void 0,function(){return S(this,function(t){return ce()?[2,[]]:[2,r.prototype.flush.call(this)]})})},e}(Si);function Ot(r){for(var e=r.constructor.prototype,t=0,n=Object.getOwnPropertyNames(e);t<n.length;t++){var a=n[t];if(a!=="constructor"){var i=Object.getOwnPropertyDescriptor(r.constructor.prototype,a);i&&typeof i.value=="function"&&(r[a]=r[a].bind(r))}}return r}function Xe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)r[n]=t[n]}return r}var qi={read:function(r){return r[0]==='"'&&(r=r.slice(1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){return encodeURIComponent(r).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Mt(r,e){function t(a,i,s){if(!(typeof document>"u")){s=Xe({},e,s),typeof s.expires=="number"&&(s.expires=new Date(Date.now()+s.expires*864e5)),s.expires&&(s.expires=s.expires.toUTCString()),a=encodeURIComponent(a).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var u in s)s[u]&&(o+="; "+u,s[u]!==!0&&(o+="="+s[u].split(";")[0]));return document.cookie=a+"="+r.write(i,a)+o}}function n(a){if(!(typeof document>"u"||arguments.length&&!a)){for(var i=document.cookie?document.cookie.split("; "):[],s={},o=0;o<i.length;o++){var u=i[o].split("="),c=u.slice(1).join("=");try{var l=decodeURIComponent(u[0]);if(s[l]=r.read(c,l),a===l)break}catch{}}return a?s[a]:s}}return Object.create({set:t,get:n,remove:function(a,i){t(a,"",Xe({},i,{expires:-1}))},withAttributes:function(a){return Mt(this.converter,Xe({},this.attributes,a))},withConverter:function(a){return Mt(Xe({},this.converter,a),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(r)}})}var ae=Mt(qi,{path:"/"});function Gi(r){var e=r.hostname,t=e.split("."),n=t[t.length-1],a=[];if(t.length===4&&parseInt(n,10)>0||t.length<=1)return a;for(var i=t.length-2;i>=0;--i)a.push(t.slice(i).join("."));return a}function Wi(r){try{return new URL(r)}catch{return}}function Br(r){var e=Wi(r);if(e)for(var t=Gi(e),n=0;n<t.length;++n){var a="__tld__",i=t[n],s={domain:"."+i};try{if(ae.set(a,"1",s),ae.get(a))return ae.remove(a,s),i}catch{return}}}var Qi=365,Lr=function(){function r(e){e===void 0&&(e=r.defaults),this.options=b(b({},r.defaults),e)}return Object.defineProperty(r,"defaults",{get:function(){return{maxage:Qi,domain:Br(window.location.href),path:"/",sameSite:"Lax"}},enumerable:!1,configurable:!0}),r.prototype.opts=function(){return{sameSite:this.options.sameSite,expires:this.options.maxage,domain:this.options.domain,path:this.options.path,secure:this.options.secure}},r.prototype.get=function(e){var t;try{var n=ae.get(e);if(n==null)return null;try{return(t=JSON.parse(n))!==null&&t!==void 0?t:null}catch{return n??null}}catch{return null}},r.prototype.set=function(e,t){typeof t=="string"?ae.set(e,t,this.opts()):t===null?ae.remove(e,this.opts()):ae.set(e,JSON.stringify(t),this.opts())},r.prototype.remove=function(e){return ae.remove(e,this.opts())},r}(),Hi=function(){function r(){}return r.prototype.localStorageWarning=function(e,t){console.warn("Unable to access ".concat(e,", localStorage may be ").concat(t))},r.prototype.get=function(e){var t;try{var n=localStorage.getItem(e);if(n===null)return null;try{return(t=JSON.parse(n))!==null&&t!==void 0?t:null}catch{return n??null}}catch{return this.localStorageWarning(e,"unavailable"),null}},r.prototype.set=function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch{this.localStorageWarning(e,"full")}},r.prototype.remove=function(e){try{return localStorage.removeItem(e)}catch{this.localStorageWarning(e,"unavailable")}},r}(),Rt=function(){function r(){this.cache={}}return r.prototype.get=function(e){var t;return(t=this.cache[e])!==null&&t!==void 0?t:null},r.prototype.set=function(e,t){this.cache[e]=t},r.prototype.remove=function(e){delete this.cache[e]},r}(),z={Cookie:"cookie",LocalStorage:"localStorage",Memory:"memory"};function Ur(r){return r&&r.stores&&Array.isArray(r.stores)&&r.stores.every(function(e){return Object.values(z).includes(e)})}function Ji(r){return typeof r=="object"&&r.name!==void 0}var Dt=function(r,e,t,n){console.warn("".concat(r.constructor.name,": Can't ").concat(e,' key "').concat(t,'" | Err: ').concat(n))},me=function(){function r(e){this.stores=e}return r.prototype.get=function(e){for(var t=null,n=0,a=this.stores;n<a.length;n++){var i=a[n];try{if(t=i.get(e),t!=null)return t}catch(s){Dt(i,"get",e,s)}}return null},r.prototype.set=function(e,t){this.stores.forEach(function(n){try{n.set(e,t)}catch(a){Dt(n,"set",e,a)}})},r.prototype.clear=function(e){this.stores.forEach(function(t){try{t.remove(e)}catch(n){Dt(t,"remove",e,n)}})},r.prototype.getAndSync=function(e){var t=this.get(e),n=typeof t=="number"?t.toString():t;return this.set(e,n),n},r}();function Nt(r){var e=r.map(function(t){var n,a;switch(Ji(t)?(n=t.name,a=t.settings):n=t,n){case z.Cookie:return new Lr(a);case z.LocalStorage:return new Hi;case z.Memory:return new Rt;default:throw new Error("Unknown Store Type: ".concat(t))}});return e}function Fr(r,e){return r.map(function(t){return e&&t===z.Cookie?{name:t,settings:e}:t})}var ge={persist:!0,cookie:{key:"ajs_user_id",oldKey:"ajs_user"},localStorage:{key:"ajs_user_traits"}},Kr=function(){function r(e,t){e===void 0&&(e=ge);var n=this,a,i,s,o;this.options={},this.id=function(c){if(n.options.disable)return null;var l=n.identityStore.getAndSync(n.idKey);if(c!==void 0){n.identityStore.set(n.idKey,c);var d=c!==l&&l!==null&&c!==null;d&&n.anonymousId(null)}var f=n.identityStore.getAndSync(n.idKey);if(f)return f;var h=n.legacyUserStore.get(ge.cookie.oldKey);return h?typeof h=="object"?h.id:h:null},this.anonymousId=function(c){var l,d;if(n.options.disable)return null;if(c===void 0){var f=(l=n.identityStore.getAndSync(n.anonKey))!==null&&l!==void 0?l:(d=n.legacySIO())===null||d===void 0?void 0:d[0];if(f)return f}return c===null?(n.identityStore.set(n.anonKey,null),n.identityStore.getAndSync(n.anonKey)):(n.identityStore.set(n.anonKey,c??Pt()),n.identityStore.getAndSync(n.anonKey))},this.traits=function(c){var l;if(!n.options.disable)return c===null&&(c={}),c&&n.traitsStore.set(n.traitsKey,c??{}),(l=n.traitsStore.get(n.traitsKey))!==null&&l!==void 0?l:{}},this.options=b(b({},ge),e),this.cookieOptions=t,this.idKey=(i=(a=e.cookie)===null||a===void 0?void 0:a.key)!==null&&i!==void 0?i:ge.cookie.key,this.traitsKey=(o=(s=e.localStorage)===null||s===void 0?void 0:s.key)!==null&&o!==void 0?o:ge.localStorage.key,this.anonKey="ajs_anonymous_id",this.identityStore=this.createStorage(this.options,t),this.legacyUserStore=this.createStorage(this.options,t,function(c){return c===z.Cookie}),this.traitsStore=this.createStorage(this.options,t,function(c){return c!==z.Cookie});var u=this.legacyUserStore.get(ge.cookie.oldKey);u&&typeof u=="object"&&(u.id&&this.id(u.id),u.traits&&this.traits(u.traits)),Ot(this)}return r.prototype.legacySIO=function(){var e=this.legacyUserStore.get("_sio");if(!e)return null;var t=e.split("----"),n=t[0],a=t[1];return[n,a]},r.prototype.identify=function(e,t){if(!this.options.disable){t=t??{};var n=this.id();(n===null||n===e)&&(t=b(b({},this.traits()),t)),e&&this.id(e),this.traits(t)}},r.prototype.logout=function(){this.anonymousId(null),this.id(null),this.traits({})},r.prototype.reset=function(){this.logout(),this.identityStore.clear(this.idKey),this.identityStore.clear(this.anonKey),this.traitsStore.clear(this.traitsKey)},r.prototype.load=function(){return new r(this.options,this.cookieOptions)},r.prototype.save=function(){return!0},r.prototype.createStorage=function(e,t,n){var a=[z.LocalStorage,z.Cookie,z.Memory];return e.disable?new me([]):e.persist?(e.storage!==void 0&&e.storage!==null&&Ur(e.storage)&&(a=e.storage.stores),e.localStorageFallbackDisabled&&(a=a.filter(function(i){return i!==z.LocalStorage})),n&&(a=a.filter(n)),new me(Nt(Fr(a,t)))):new me([new Rt])},r.defaults=ge,r}(),$r={persist:!0,cookie:{key:"ajs_group_id"},localStorage:{key:"ajs_group_properties"}},Yi=function(r){$(e,r);function e(t,n){t===void 0&&(t=$r);var a=r.call(this,b(b({},$r),t),n)||this;return a.anonymousId=function(i){},Ot(a),a}return e}(Kr),jt="analytics";function Vr(){return window[jt]}function Zi(r){jt=r}function Xi(r){window[jt]=r}var ea=function(r){return typeof r=="object"&&r!==null&&"then"in r&&typeof r.then=="function"},zr=function(r,e,t){t.getAndRemove(r).forEach(function(n){et(e,n).catch(console.error)})},ta=function(r,e){return _(void 0,void 0,void 0,function(){var t,n,a;return S(this,function(i){switch(i.label){case 0:t=0,n=e.getAndRemove("addSourceMiddleware"),i.label=1;case 1:return t<n.length?(a=n[t],[4,et(r,a).catch(console.error)]):[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},ra=function(r,e){return _(void 0,void 0,void 0,function(){var t,n,a;return S(this,function(i){switch(i.label){case 0:t=0,n=e.getAndRemove("register"),i.label=1;case 1:return t<n.length?(a=n[t],[4,et(r,a).catch(console.error)]):[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},na=zr.bind(void 0,"on"),ia=zr.bind(void 0,"setAnonymousId"),aa=function(r,e){Object.keys(e.calls).forEach(function(t){e.getAndRemove(t).forEach(function(n){setTimeout(function(){et(r,n).catch(console.error)},0)})})},Ee=function(r){if(qr(r)){var e=r.pop();return Mr(e)}},qr=function(r){var e=r[r.length-1];return Ri(e)},Bt=function(){function r(e,t,n,a){n===void 0&&(n=function(){}),a===void 0&&(a=console.error),this.method=e,this.resolve=n,this.reject=a,this.called=!1,this.args=t}return r}(),oa=function(){function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._callMap={},this.add.apply(this,e)}return Object.defineProperty(r.prototype,"calls",{get:function(){return this._pushSnippetWindowBuffer(),this._callMap},set:function(e){this._callMap=e},enumerable:!1,configurable:!0}),r.prototype.get=function(e){var t;return(t=this.calls[e])!==null&&t!==void 0?t:[]},r.prototype.getAndRemove=function(e){var t=this.get(e);return this.calls[e]=[],t},r.prototype.add=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach(function(a){var i=["track","screen","alias","group","page","identify"];i.includes(a.method)&&!qr(a.args)&&(a.args=B(B([],a.args,!0),[Rr()],!1)),e.calls[a.method]?e.calls[a.method].push(a):e.calls[a.method]=[a]})},r.prototype.clear=function(){this._pushSnippetWindowBuffer(),this.calls={}},r.prototype.toArray=function(){var e;return(e=[]).concat.apply(e,Object.values(this.calls))},r.prototype._pushSnippetWindowBuffer=function(){},r}();function et(r,e){return _(this,void 0,void 0,function(){var t,n;return S(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),e.called?[2,void 0]:(e.called=!0,t=r[e.method].apply(r,e.args),ea(t)?[4,t]:[3,2]);case 1:a.sent(),a.label=2;case 2:return e.resolve(t),[3,4];case 3:return n=a.sent(),e.reject(n),[3,4];case 4:return[2]}})})}var sa=function(){function r(e){var t=this;this.trackSubmit=this._createMethod("trackSubmit"),this.trackClick=this._createMethod("trackClick"),this.trackLink=this._createMethod("trackLink"),this.pageView=this._createMethod("pageview"),this.identify=this._createMethod("identify"),this.reset=this._createMethod("reset"),this.group=this._createMethod("group"),this.track=this._createMethod("track"),this.ready=this._createMethod("ready"),this.alias=this._createMethod("alias"),this.debug=this._createChainableMethod("debug"),this.page=this._createMethod("page"),this.once=this._createChainableMethod("once"),this.off=this._createChainableMethod("off"),this.on=this._createChainableMethod("on"),this.addSourceMiddleware=this._createMethod("addSourceMiddleware"),this.setAnonymousId=this._createMethod("setAnonymousId"),this.addDestinationMiddleware=this._createMethod("addDestinationMiddleware"),this.screen=this._createMethod("screen"),this.register=this._createMethod("register"),this.deregister=this._createMethod("deregister"),this.user=this._createMethod("user"),this.VERSION=Je,this._preInitBuffer=new oa,this._promise=e(this._preInitBuffer),this._promise.then(function(n){var a=n[0],i=n[1];t.instance=a,t.ctx=i}).catch(function(){})}return r.prototype.then=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this._promise).then.apply(e,t)},r.prototype.catch=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this._promise).catch.apply(e,t)},r.prototype.finally=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this._promise).finally.apply(e,t)},r.prototype._createMethod=function(e){var t=this;return function(){for(var n,a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];if(t.instance){var s=(n=t.instance)[e].apply(n,a);return Promise.resolve(s)}return new Promise(function(o,u){t._preInitBuffer.add(new Bt(e,a,o,u))})}},r.prototype._createChainableMethod=function(e){var t=this;return function(){for(var n,a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];return t.instance?((n=t.instance)[e].apply(n,a),t):(t._preInitBuffer.add(new Bt(e,a)),t)}},r}(),L=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lt(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var U={},te={},Ut={},Gr={exports:{}};(function(r){r.exports=e(t),r.exports.find=r.exports,r.exports.replace=function(o,u,c,l){return e(a).call(this,o,u,c,l),o},r.exports.del=function(o,u,c){return e(n).call(this,o,u,null,c),o};function e(o){return function(u,c,l,d){var f=d&&s(d.normalizer)?d.normalizer:i;c=f(c);for(var h,v=!1;!v;)m();function m(){for(h in u){var p=f(h);if(c.indexOf(p)===0){var y=c.substr(p.length);if(y.charAt(0)==="."||y.length===0){c=y.substr(1);var g=u[h];if(g==null){v=!0;return}if(!c.length){v=!0;return}u=g;return}}}h=void 0,v=!0}if(h)return u==null?u:o(u,h,l)}}function t(o,u){if(o.hasOwnProperty(u))return o[u]}function n(o,u){return o.hasOwnProperty(u)&&delete o[u],o}function a(o,u,c){return o.hasOwnProperty(u)&&(o[u]=c),o}function i(o){return o.replace(/[^a-zA-Z0-9\.]+/g,"").toLowerCase()}function s(o){return typeof o=="function"}})(Gr);var tt=Gr.exports,ua=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ut,"__esModule",{value:!0});var le=ua(tt);function Ce(r,e){return function(){var t=this.traits(),n=this.properties?this.properties():{};return le.default(t,"address."+r)||le.default(t,r)||(e?le.default(t,"address."+e):null)||(e?le.default(t,e):null)||le.default(n,"address."+r)||le.default(n,r)||(e?le.default(n,"address."+e):null)||(e?le.default(n,e):null)}}function ca(r){r.zip=Ce("postalCode","zip"),r.country=Ce("country"),r.street=Ce("street"),r.state=Ce("state"),r.city=Ce("city"),r.region=Ce("region")}Ut.default=ca;var rt={};Object.defineProperty(rt,"__esModule",{value:!0}),rt.clone=void 0;function Ft(r){if(typeof r!="object")return r;if(Object.prototype.toString.call(r)==="[object Object]"){var e={};for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=Ft(r[t]));return e}else return Array.isArray(r)?r.map(Ft):r}rt.clone=Ft;var Kt={};Object.defineProperty(Kt,"__esModule",{value:!0});var la={Salesforce:!0};function da(r){return!la[r]}Kt.default=da;var nt={},Wr=/^(\d{4})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:([ T])(\d{2}):?(\d{2})(?::?(\d{2})(?:[,\.](\d{1,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?)?)?$/;nt.parse=function(r){var e=[1,5,6,7,11,12],t=Wr.exec(r),n=0;if(!t)return new Date(r);for(var a=0,i;i=e[a];a++)t[i]=parseInt(t[i],10)||0;t[2]=parseInt(t[2],10)||1,t[3]=parseInt(t[3],10)||1,t[2]--,t[8]=t[8]?(t[8]+"00").substring(0,3):0,t[4]===" "?n=new Date().getTimezoneOffset():t[9]!=="Z"&&t[10]&&(n=t[11]*60+t[12],t[10]==="+"&&(n=0-n));var s=Date.UTC(t[1],t[2],t[3],t[5],t[6]+n,t[7],t[8]);return new Date(s)},nt.is=function(r,e){return typeof r!="string"||e&&/^\d{4}-\d{2}-\d{2}/.test(r)===!1?!1:Wr.test(r)};var $t={},fa=/\d{13}/;$t.is=function(r){return fa.test(r)},$t.parse=function(r){return r=parseInt(r,10),new Date(r)};var Vt={},ha=/\d{10}/;Vt.is=function(r){return ha.test(r)},Vt.parse=function(r){var e=parseInt(r,10)*1e3;return new Date(e)};var Qr=nt,Hr=$t,Jr=Vt,pa=Object.prototype,Yr=pa.toString;function va(r){return Yr.call(r)==="[object Date]"}function ya(r){return Yr.call(r)==="[object Number]"}var zt=function(e){return va(e)?e:ya(e)?new Date(ma(e)):Qr.is(e)?Qr.parse(e):Hr.is(e)?Hr.parse(e):Jr.is(e)?Jr.parse(e):new Date(e)};function ma(r){return r<315576e5?r*1e3:r}var Zr=nt,ga=qt;function qt(r,e){return e===void 0&&(e=!0),r&&typeof r=="object"?ba(r,e):Array.isArray(r)?wa(r,e):Zr.is(r,e)?Zr.parse(r):r}function ba(r,e){return Object.keys(r).forEach(function(t){r[t]=qt(r[t],e)}),r}function wa(r,e){return r.forEach(function(t,n){r[n]=qt(t,e)}),r}var Ue=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(te,"__esModule",{value:!0}),te.Facade=void 0;var ka=Ue(Ut),Te=rt,Aa=Ue(Kt),_a=Ue(zt),Gt=Ue(tt),Sa=Ue(ga);function W(r,e){e=e||{},this.raw=Te.clone(r),"clone"in e||(e.clone=!0),e.clone&&(r=Te.clone(r)),"traverse"in e||(e.traverse=!0),"timestamp"in r?r.timestamp=_a.default(r.timestamp):r.timestamp=new Date,e.traverse&&Sa.default(r),this.opts=e,this.obj=r}te.Facade=W;var N=W.prototype;N.proxy=function(r){var e=r.split(".");r=e.shift();var t=this[r]||this.obj[r];return t&&(typeof t=="function"&&(t=t.call(this)||{}),e.length===0?this.opts.clone?Wt(t):t:(t=Gt.default(t,e.join(".")),this.opts.clone?Wt(t):t))},N.field=function(r){var e=this.obj[r];return this.opts.clone?Wt(e):e},W.proxy=function(r){return function(){return this.proxy(r)}},W.field=function(r){return function(){return this.field(r)}},W.multi=function(r){return function(){var e=this.proxy(r+"s");if(Array.isArray(e))return e;var t=this.proxy(r);return t&&(t=[this.opts.clone?Te.clone(t):t]),t||[]}},W.one=function(r){return function(){var e=this.proxy(r);if(e)return e;var t=this.proxy(r+"s");if(Array.isArray(t))return t[0]}},N.json=function(){var r=this.opts.clone?Te.clone(this.obj):this.obj;return this.type&&(r.type=this.type()),r},N.rawEvent=function(){return this.raw},N.options=function(r){var e=this.obj.options||this.obj.context||{},t=this.opts.clone?Te.clone(e):e;if(!r)return t;if(this.enabled(r)){var n=this.integrations(),a=n[r]||Gt.default(n,r);return typeof a!="object"&&(a=Gt.default(this.options(),r)),typeof a=="object"?a:{}}},N.context=N.options,N.enabled=function(r){var e=this.proxy("options.providers.all");typeof e!="boolean"&&(e=this.proxy("options.all")),typeof e!="boolean"&&(e=this.proxy("integrations.all")),typeof e!="boolean"&&(e=!0);var t=e&&Aa.default(r),n=this.integrations();if(n.providers&&n.providers.hasOwnProperty(r)&&(t=n.providers[r]),n.hasOwnProperty(r)){var a=n[r];typeof a=="boolean"?t=a:t=!0}return!!t},N.integrations=function(){return this.obj.integrations||this.proxy("options.providers")||this.options()},N.active=function(){var r=this.proxy("options.active");return r==null&&(r=!0),r},N.anonymousId=function(){return this.field("anonymousId")||this.field("sessionId")},N.sessionId=N.anonymousId,N.groupId=W.proxy("options.groupId"),N.traits=function(r){var e=this.proxy("options.traits")||{},t=this.userId();r=r||{},t&&(e.id=t);for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var a=this[n]==null?this.proxy("options.traits."+n):this[n]();if(a==null)continue;e[r[n]]=a,delete e[n]}return e},N.library=function(){var r=this.proxy("options.library");return r?typeof r=="string"?{name:r,version:null}:r:{name:"unknown",version:null}},N.device=function(){var r=this.proxy("context.device");(typeof r!="object"||r===null)&&(r={});var e=this.library().name;return r.type||(e.indexOf("ios")>-1&&(r.type="ios"),e.indexOf("android")>-1&&(r.type="android")),r},N.userAgent=W.proxy("context.userAgent"),N.timezone=W.proxy("context.timezone"),N.timestamp=W.field("timestamp"),N.channel=W.field("channel"),N.ip=W.proxy("context.ip"),N.userId=W.field("userId"),ka.default(N);function Wt(r){return Te.clone(r)}var it={},Qt={exports:{}};typeof Object.create=="function"?Qt.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Qt.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var be=Qt.exports,Ia=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(it,"__esModule",{value:!0}),it.Alias=void 0;var Pa=Ia(be),Xr=te;function Y(r,e){Xr.Facade.call(this,r,e)}it.Alias=Y,Pa.default(Y,Xr.Facade),Y.prototype.action=function(){return"alias"},Y.prototype.type=Y.prototype.action,Y.prototype.previousId=function(){return this.field("previousId")||this.field("from")},Y.prototype.from=Y.prototype.previousId,Y.prototype.userId=function(){return this.field("userId")||this.field("to")},Y.prototype.to=Y.prototype.userId;var at={},xe={};Object.defineProperty(xe,"__esModule",{value:!0});var Ea=/.+\@.+\..+/;function Ca(r){return Ea.test(r)}xe.default=Ca;var Ht=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(at,"__esModule",{value:!0}),at.Group=void 0;var Ta=Ht(be),xa=Ht(xe),Oa=Ht(zt),Oe=te;function Jt(r,e){Oe.Facade.call(this,r,e)}at.Group=Jt,Ta.default(Jt,Oe.Facade);var Z=Jt.prototype;Z.action=function(){return"group"},Z.type=Z.action,Z.groupId=Oe.Facade.field("groupId"),Z.created=function(){var r=this.proxy("traits.createdAt")||this.proxy("traits.created")||this.proxy("properties.createdAt")||this.proxy("properties.created");if(r)return Oa.default(r)},Z.email=function(){var r=this.proxy("traits.email");if(r)return r;var e=this.groupId();if(xa.default(e))return e},Z.traits=function(r){var e=this.properties(),t=this.groupId();r=r||{},t&&(e.id=t);for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var a=this[n]==null?this.proxy("traits."+n):this[n]();if(a==null)continue;e[r[n]]=a,delete e[n]}return e},Z.name=Oe.Facade.proxy("traits.name"),Z.industry=Oe.Facade.proxy("traits.industry"),Z.employees=Oe.Facade.proxy("traits.employees"),Z.properties=function(){return this.field("traits")||this.field("properties")||{}};var Fe={},ot=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.Identify=void 0;var re=te,Me=ot(tt),Ma=ot(be),Ra=ot(xe),en=ot(zt),we=function(r){return r.trim()};function Yt(r,e){re.Facade.call(this,r,e)}Fe.Identify=Yt,Ma.default(Yt,re.Facade);var j=Yt.prototype;j.action=function(){return"identify"},j.type=j.action,j.traits=function(r){var e=this.field("traits")||{},t=this.userId();r=r||{},t&&(e.id=t);for(var n in r){var a=this[n]==null?this.proxy("traits."+n):this[n]();a!=null&&(e[r[n]]=a,n!==r[n]&&delete e[n])}return e},j.email=function(){var r=this.proxy("traits.email");if(r)return r;var e=this.userId();if(Ra.default(e))return e},j.created=function(){var r=this.proxy("traits.created")||this.proxy("traits.createdAt");if(r)return en.default(r)},j.companyCreated=function(){var r=this.proxy("traits.company.created")||this.proxy("traits.company.createdAt");if(r)return en.default(r)},j.companyName=function(){return this.proxy("traits.company.name")},j.name=function(){var r=this.proxy("traits.name");if(typeof r=="string")return we(r);var e=this.firstName(),t=this.lastName();if(e&&t)return we(e+" "+t)},j.firstName=function(){var r=this.proxy("traits.firstName");if(typeof r=="string")return we(r);var e=this.proxy("traits.name");if(typeof e=="string")return we(e).split(" ")[0]},j.lastName=function(){var r=this.proxy("traits.lastName");if(typeof r=="string")return we(r);var e=this.proxy("traits.name");if(typeof e=="string"){var t=we(e).indexOf(" ");if(t!==-1)return we(e.substr(t+1))}},j.uid=function(){return this.userId()||this.username()||this.email()},j.description=function(){return this.proxy("traits.description")||this.proxy("traits.background")},j.age=function(){var r=this.birthday(),e=Me.default(this.traits(),"age");if(e!=null)return e;if(r instanceof Date){var t=new Date;return t.getFullYear()-r.getFullYear()}},j.avatar=function(){var r=this.traits();return Me.default(r,"avatar")||Me.default(r,"photoUrl")||Me.default(r,"avatarUrl")},j.position=function(){var r=this.traits();return Me.default(r,"position")||Me.default(r,"jobTitle")},j.username=re.Facade.proxy("traits.username"),j.website=re.Facade.one("traits.website"),j.websites=re.Facade.multi("traits.website"),j.phone=re.Facade.one("traits.phone"),j.phones=re.Facade.multi("traits.phone"),j.address=re.Facade.proxy("traits.address"),j.gender=re.Facade.proxy("traits.gender"),j.birthday=re.Facade.proxy("traits.birthday");var Re={},Zt=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Re,"__esModule",{value:!0}),Re.Track=void 0;var Da=Zt(be),F=te,Na=Fe,ja=Zt(xe),tn=Zt(tt);function Xt(r,e){F.Facade.call(this,r,e)}Re.Track=Xt,Da.default(Xt,F.Facade);var O=Xt.prototype;O.action=function(){return"track"},O.type=O.action,O.event=F.Facade.field("event"),O.value=F.Facade.proxy("properties.value"),O.category=F.Facade.proxy("properties.category"),O.id=F.Facade.proxy("properties.id"),O.productId=function(){return this.proxy("properties.product_id")||this.proxy("properties.productId")},O.promotionId=function(){return this.proxy("properties.promotion_id")||this.proxy("properties.promotionId")},O.cartId=function(){return this.proxy("properties.cart_id")||this.proxy("properties.cartId")},O.checkoutId=function(){return this.proxy("properties.checkout_id")||this.proxy("properties.checkoutId")},O.paymentId=function(){return this.proxy("properties.payment_id")||this.proxy("properties.paymentId")},O.couponId=function(){return this.proxy("properties.coupon_id")||this.proxy("properties.couponId")},O.wishlistId=function(){return this.proxy("properties.wishlist_id")||this.proxy("properties.wishlistId")},O.reviewId=function(){return this.proxy("properties.review_id")||this.proxy("properties.reviewId")},O.orderId=function(){return this.proxy("properties.id")||this.proxy("properties.order_id")||this.proxy("properties.orderId")},O.sku=F.Facade.proxy("properties.sku"),O.tax=F.Facade.proxy("properties.tax"),O.name=F.Facade.proxy("properties.name"),O.price=F.Facade.proxy("properties.price"),O.total=F.Facade.proxy("properties.total"),O.repeat=F.Facade.proxy("properties.repeat"),O.coupon=F.Facade.proxy("properties.coupon"),O.shipping=F.Facade.proxy("properties.shipping"),O.discount=F.Facade.proxy("properties.discount"),O.shippingMethod=function(){return this.proxy("properties.shipping_method")||this.proxy("properties.shippingMethod")},O.paymentMethod=function(){return this.proxy("properties.payment_method")||this.proxy("properties.paymentMethod")},O.description=F.Facade.proxy("properties.description"),O.plan=F.Facade.proxy("properties.plan"),O.subtotal=function(){var r=tn.default(this.properties(),"subtotal"),e=this.total()||this.revenue();if(r)return r;if(!e)return 0;if(this.total()){var t=this.tax();t&&(e-=t),t=this.shipping(),t&&(e-=t),t=this.discount(),t&&(e+=t)}return e},O.products=function(){var r=this.properties(),e=tn.default(r,"products");return Array.isArray(e)?e.filter(function(t){return t!==null}):[]},O.quantity=function(){var r=this.obj.properties||{};return r.quantity||1},O.currency=function(){var r=this.obj.properties||{};return r.currency||"USD"},O.referrer=function(){return this.proxy("context.referrer.url")||this.proxy("context.page.referrer")||this.proxy("properties.referrer")},O.query=F.Facade.proxy("options.query"),O.properties=function(r){var e=this.field("properties")||{};r=r||{};for(var t in r)if(Object.prototype.hasOwnProperty.call(r,t)){var n=this[t]==null?this.proxy("properties."+t):this[t]();if(n==null)continue;e[r[t]]=n,delete e[t]}return e},O.username=function(){return this.proxy("traits.username")||this.proxy("properties.username")||this.userId()||this.sessionId()},O.email=function(){var r=this.proxy("traits.email")||this.proxy("properties.email")||this.proxy("options.traits.email");if(r)return r;var e=this.userId();if(ja.default(e))return e},O.revenue=function(){var r=this.proxy("properties.revenue"),e=this.event(),t=/^[ _]?completed[ _]?order[ _]?|^[ _]?order[ _]?completed[ _]?$/i;return!r&&e&&e.match(t)&&(r=this.proxy("properties.total")),Ba(r)},O.cents=function(){var r=this.revenue();return typeof r!="number"?this.value()||0:r*100},O.identify=function(){var r=this.json();return r.traits=this.traits(),new Na.Identify(r,this.opts)};function Ba(r){if(r){if(typeof r=="number")return r;if(typeof r=="string"&&(r=r.replace(/\$/g,""),r=parseFloat(r),!isNaN(r)))return r}}var Ke={},rn=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.Page=void 0;var La=rn(be),ke=te,Ua=Re,Fa=rn(xe);function er(r,e){ke.Facade.call(this,r,e)}Ke.Page=er,La.default(er,ke.Facade);var q=er.prototype;q.action=function(){return"page"},q.type=q.action,q.category=ke.Facade.field("category"),q.name=ke.Facade.field("name"),q.title=ke.Facade.proxy("properties.title"),q.path=ke.Facade.proxy("properties.path"),q.url=ke.Facade.proxy("properties.url"),q.referrer=function(){return this.proxy("context.referrer.url")||this.proxy("context.page.referrer")||this.proxy("properties.referrer")},q.properties=function(r){var e=this.field("properties")||{},t=this.category(),n=this.name();r=r||{},t&&(e.category=t),n&&(e.name=n);for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a)){var i=this[a]==null?this.proxy("properties."+a):this[a]();if(i==null)continue;e[r[a]]=i,a!==r[a]&&delete e[a]}return e},q.email=function(){var r=this.proxy("context.traits.email")||this.proxy("properties.email");if(r)return r;var e=this.userId();if(Fa.default(e))return e},q.fullName=function(){var r=this.category(),e=this.name();return e&&r?r+" "+e:e},q.event=function(r){return r?"Viewed "+r+" Page":"Loaded a Page"},q.track=function(r){var e=this.json();return e.event=this.event(r),e.timestamp=this.timestamp(),e.properties=this.properties(),new Ua.Track(e,this.opts)};var st={},Ka=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(st,"__esModule",{value:!0}),st.Screen=void 0;var $a=Ka(be),nn=Ke,Va=Re;function Ae(r,e){nn.Page.call(this,r,e)}st.Screen=Ae,$a.default(Ae,nn.Page),Ae.prototype.action=function(){return"screen"},Ae.prototype.type=Ae.prototype.action,Ae.prototype.event=function(r){return r?"Viewed "+r+" Screen":"Loaded a Screen"},Ae.prototype.track=function(r){var e=this.json();return e.event=this.event(r),e.timestamp=this.timestamp(),e.properties=this.properties(),new Va.Track(e,this.opts)};var ut={},za=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ut,"__esModule",{value:!0}),ut.Delete=void 0;var qa=za(be),an=te;function tr(r,e){an.Facade.call(this,r,e)}ut.Delete=tr,qa.default(tr,an.Facade),tr.prototype.type=function(){return"delete"},function(r){var e=L&&L.__assign||function(){return e=Object.assign||function(l){for(var d,f=1,h=arguments.length;f<h;f++){d=arguments[f];for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(l[v]=d[v])}return l},e.apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0}),r.Delete=r.Screen=r.Page=r.Track=r.Identify=r.Group=r.Alias=r.Facade=void 0;var t=te;Object.defineProperty(r,"Facade",{enumerable:!0,get:function(){return t.Facade}});var n=it;Object.defineProperty(r,"Alias",{enumerable:!0,get:function(){return n.Alias}});var a=at;Object.defineProperty(r,"Group",{enumerable:!0,get:function(){return a.Group}});var i=Fe;Object.defineProperty(r,"Identify",{enumerable:!0,get:function(){return i.Identify}});var s=Re;Object.defineProperty(r,"Track",{enumerable:!0,get:function(){return s.Track}});var o=Ke;Object.defineProperty(r,"Page",{enumerable:!0,get:function(){return o.Page}});var u=st;Object.defineProperty(r,"Screen",{enumerable:!0,get:function(){return u.Screen}});var c=ut;Object.defineProperty(r,"Delete",{enumerable:!0,get:function(){return c.Delete}}),r.default=e(e({},t.Facade),{Alias:n.Alias,Group:a.Group,Identify:i.Identify,Track:s.Track,Page:o.Page,Screen:u.Screen,Delete:c.Delete})}(U);function ct(r,e){var t=new U.Facade(r,e);return r.type==="track"&&(t=new U.Track(r,e)),r.type==="identify"&&(t=new U.Identify(r,e)),r.type==="page"&&(t=new U.Page(r,e)),r.type==="alias"&&(t=new U.Alias(r,e)),r.type==="group"&&(t=new U.Group(r,e)),r.type==="screen"&&(t=new U.Screen(r,e)),Object.defineProperty(t,"obj",{value:r,writable:!0}),t}var Ga=function(r){var e=!1;window.addEventListener("pagehide",function(){e||(e=!0,r(e))}),document.addEventListener("visibilitychange",function(){if(document.visibilityState=="hidden"){if(e)return;e=!0}else e=!1;r(e)})},on=function(r){$(e,r);function e(t,n){var a=r.call(this,t)||this;return a.retryTimeout=n,a.name="RateLimitError",a}return e}(Error),Wa=500,Qa=64;function rr(r){var e=encodeURI(JSON.stringify(r)).split(/%..|./).length-1;return e/1024}function Ha(r){return rr(r)>=Wa-50}function Ja(r){return rr(r)>=Qa-10}function Ya(r){var e=[],t=0;return r.forEach(function(n){var a=rr(e[t]);a>=64&&t++,e[t]?e[t].push(n):e[t]=[n]}),e}function Za(r,e){var t,n,a=[],i=!1,s=(t=e?.size)!==null&&t!==void 0?t:10,o=(n=e?.timeout)!==null&&n!==void 0?n:5e3,u=0;function c(v){var m;if(v.length!==0){var p=(m=v[0])===null||m===void 0?void 0:m.writeKey,y=v.map(function(g){var w=g;w.sentAt;var k=kr(w,["sentAt"]);return k});return He("https://".concat(r,"/b"),{keepalive:e?.keepalive||i,headers:{"Content-Type":"text/plain"},method:"post",body:JSON.stringify({writeKey:p,batch:y,sentAt:new Date().toISOString()})}).then(function(g){var w;if(g.status>=500)throw new Error("Bad response from server: ".concat(g.status));if(g.status===429){var k=(w=g.headers)===null||w===void 0?void 0:w.get("x-ratelimit-reset"),A=typeof k=="string"?parseInt(k)*1e3:o;throw new on("Rate limit exceeded: ".concat(g.status),A)}})}}function l(v){var m;return v===void 0&&(v=1),_(this,void 0,void 0,function(){var p;return S(this,function(y){return a.length?(p=a,a=[],[2,(m=c(p))===null||m===void 0?void 0:m.catch(function(g){var w,k=J.system();k.log("error","Error sending batch",g),v<=((w=e?.maxRetries)!==null&&w!==void 0?w:10)&&(g.name==="RateLimitError"&&(u=g.retryTimeout),a.push.apply(a,p),a.map(function(A){if("_metadata"in A){var I=A;I._metadata=b(b({},I._metadata),{retryCount:v})}}),f(v+1))})]):[2]})})}var d;function f(v){v===void 0&&(v=1),!d&&(d=setTimeout(function(){d=void 0,l(v).catch(console.error)},u||o),u=0)}Ga(function(v){if(i=v,i&&a.length){var m=Ya(a).map(c);Promise.all(m).catch(console.error)}});function h(v,m){return _(this,void 0,void 0,function(){var p;return S(this,function(y){return a.push(m),p=a.length>=s||Ha(a)||e?.keepalive&&Ja(a),[2,p||i?l():f()]})})}return{dispatch:h}}function Xa(r){function e(t,n){return He(t,{keepalive:r?.keepalive,headers:{"Content-Type":"text/plain"},method:"post",body:JSON.stringify(n)}).then(function(a){var i;if(a.status>=500)throw new Error("Bad response from server: ".concat(a.status));if(a.status===429){var s=(i=a.headers)===null||i===void 0?void 0:i.get("x-ratelimit-reset"),o=s?parseInt(s)*1e3:5e3;throw new on("Rate limit exceeded: ".concat(a.status),o)}})}return{dispatch:e}}function eo(r,e,t,n,a){var i,s=r.user();delete e.options,e.writeKey=t?.apiKey,e.userId=e.userId||s.id(),e.anonymousId=e.anonymousId||s.anonymousId(),e.sentAt=new Date;var o=r.queue.failedInitializations||[];o.length>0&&(e._metadata={failedInitializations:o}),a!=null&&(a.attempts>1&&(e._metadata=b(b({},e._metadata),{retryCount:a.attempts})),a.attempts++);var u=[],c=[];for(var l in n){var d=n[l];l==="Segment.io"&&u.push(l),d.bundlingStatus==="bundled"&&u.push(l),d.bundlingStatus==="unbundled"&&c.push(l)}for(var f=0,h=t?.unbundledIntegrations||[];f<h.length;f++){var v=h[f];c.includes(v)||c.push(v)}var m=(i=t?.maybeBundledConfigIds)!==null&&i!==void 0?i:{},p=[];return u.sort().forEach(function(y){var g;((g=m[y])!==null&&g!==void 0?g:[]).forEach(function(w){p.push(w)})}),t?.addBundledMetadata!==!1&&(e._metadata=b(b({},e._metadata),{bundled:u.sort(),unbundled:c.sort(),bundledIds:p})),e}var sn=function(r,e){return _(void 0,void 0,void 0,function(){var t;return S(this,function(n){return t=function(a){return _(void 0,void 0,void 0,function(){var i;return S(this,function(s){switch(s.label){case 0:return r(a)?(i=t,[4,e()]):[3,2];case 1:return[2,i.apply(void 0,[s.sent()])];case 2:return[2]}})})},[2,t(void 0)]})})};function to(r,e){return _(this,void 0,void 0,function(){var t,n=this;return S(this,function(a){switch(a.label){case 0:return t=[],ce()?[2,e]:[4,sn(function(){return e.length>0&&!ce()},function(){return _(n,void 0,void 0,function(){var i,s,o;return S(this,function(u){switch(u.label){case 0:return i=e.pop(),i?[4,ye(i,r)]:[2];case 1:return s=u.sent(),o=s instanceof J,o||t.push(i),[2]}})})})];case 1:return a.sent(),t.map(function(i){return e.pushWithBackoff(i)}),[2,e]}})})}function De(r,e,t,n){var a=this;r||setTimeout(function(){return _(a,void 0,void 0,function(){var i,s;return S(this,function(o){switch(o.label){case 0:return i=!0,[4,to(t,e)];case 1:return s=o.sent(),i=!1,e.todo>0&&n(i,s,t,n),[2]}})})},Math.random()*5e3)}function ro(r,e){var t,n,a,i,s=r.user();return e.previousId=(a=(n=(t=e.previousId)!==null&&t!==void 0?t:e.from)!==null&&n!==void 0?n:s.id())!==null&&a!==void 0?a:s.anonymousId(),e.userId=(i=e.userId)!==null&&i!==void 0?i:e.to,delete e.from,delete e.to,e}var no=function(r){return r.name==="Segment.io"};function io(r,e,t){var n,a,i;window.addEventListener("pagehide",function(){o.push.apply(o,Array.from(u)),u.clear()});var s=(n=e?.apiKey)!==null&&n!==void 0?n:"",o=r.options.disableClientPersistence?new qe(r.queue.queue.maxAttempts,[]):new Ze(r.queue.queue.maxAttempts,"".concat(s,":dest-Segment.io")),u=new Set,c=!1,l=(a=e?.apiHost)!==null&&a!==void 0?a:Cr,d=(i=e?.protocol)!==null&&i!==void 0?i:"https",f="".concat(d,"://").concat(l),h=e?.deliveryStrategy,v=h?.strategy==="batching"?Za(l,h.config):Xa(h?.config);function m(y){return _(this,void 0,void 0,function(){var g,w;return S(this,function(k){return ce()?(o.push(y),De(c,o,p,De),[2,y]):(u.add(y),g=y.event.type.charAt(0),w=ct(y.event).json(),y.event.type==="track"&&delete w.traits,y.event.type==="alias"&&(w=ro(r,w)),[2,v.dispatch("".concat(f,"/").concat(g),eo(r,w,e,t,y)).then(function(){return y}).catch(function(A){if(y.log("error","Error sending event",A),A.name==="RateLimitError"){var I=A.retryTimeout;o.pushWithBackoff(y,I)}else o.pushWithBackoff(y);return De(c,o,p,De),y}).finally(function(){u.delete(y)})])})})}var p={metadata:{writeKey:s,apiHost:l,protocol:d},name:"Segment.io",type:"destination",version:"0.1.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},track:m,identify:m,page:m,alias:m,group:m,screen:m};return o.todo&&De(c,o,p,De),p}var de="This is being deprecated and will be not be available in future releases of Analytics JS",nr=Ct(),ir=nr?.analytics;function ao(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=e?10:1,a=t?new qe(n,[]):new Ze(n,r);return new zi(a)}var oo=function(){function r(e,t){var n;this.timeout=300,this._getSegmentPluginMetadata=function(){var a;return(a=t.plugins.find(no))===null||a===void 0?void 0:a.metadata},this.writeKey=e.writeKey,this.cdnSettings=(n=e.cdnSettings)!==null&&n!==void 0?n:{integrations:{},edgeFunction:{}},this.cdnURL=e.cdnURL}return Object.defineProperty(r.prototype,"apiHost",{get:function(){var e,t;return(t=(e=this._getSegmentPluginMetadata)===null||e===void 0?void 0:e.call(this))===null||t===void 0?void 0:t.apiHost},enumerable:!1,configurable:!0}),r}();function ne(){console.warn(de)}var un=function(r){$(e,r);function e(t,n,a,i,s){var o=this,u,c;o=r.call(this)||this,o._debug=!1,o.initialized=!1,o.user=function(){return o._user},o.init=o.initialize.bind(o),o.log=ne,o.addIntegrationMiddleware=ne,o.listeners=ne,o.addEventListener=ne,o.removeAllListeners=ne,o.removeListener=ne,o.removeEventListener=ne,o.hasListeners=ne,o.add=ne,o.addIntegration=ne;var l=n?.cookie,d=(u=n?.disableClientPersistence)!==null&&u!==void 0?u:!1;o.queue=a??ao("".concat(t.writeKey,":event-queue"),n?.retryQueue,d),o.settings=new oo(t,o.queue);var f=n?.storage;return o._universalStorage=o.createStore(d,f,l),o._user=i??new Kr(b({persist:!d,storage:n?.storage},n?.user),l).load(),o._group=s??new Yi(b({persist:!d,storage:n?.storage},n?.group),l).load(),o.eventFactory=new Ui(o._user),o.integrations=(c=n?.integrations)!==null&&c!==void 0?c:{},o.options=n??{},Ot(o),o}return e.prototype.createStore=function(t,n,a){return t?new me([new Rt]):n&&Ur(n)?new me(Nt(Fr(n.stores,a))):new me(Nt([z.LocalStorage,{name:z.Cookie,settings:a},z.Memory]))},Object.defineProperty(e.prototype,"storage",{get:function(){return this._universalStorage},enumerable:!1,configurable:!0}),e.prototype.track=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return _(this,void 0,void 0,function(){var a,i,s,o,u,c,l,d=this;return S(this,function(f){return a=Ee(t),i=Ei.apply(void 0,t),s=i[0],o=i[1],u=i[2],c=i[3],l=this.eventFactory.track(s,o,u,this.integrations,a),[2,this._dispatch(l,c).then(function(h){return d.emit("track",s,h.event.properties,h.event.options),h})]})})},e.prototype.page=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return _(this,void 0,void 0,function(){var a,i,s,o,u,c,l,d,f=this;return S(this,function(h){return a=Ee(t),i=Sr.apply(void 0,t),s=i[0],o=i[1],u=i[2],c=i[3],l=i[4],d=this.eventFactory.page(s,o,u,c,this.integrations,a),[2,this._dispatch(d,l).then(function(v){return f.emit("page",s,o,v.event.properties,v.event.options),v})]})})},e.prototype.identify=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return _(this,void 0,void 0,function(){var a,i,s,o,u,c,l,d=this;return S(this,function(f){return a=Ee(t),i=Ir(this._user).apply(void 0,t),s=i[0],o=i[1],u=i[2],c=i[3],this._user.identify(s,o),l=this.eventFactory.identify(this._user.id(),this._user.traits(),u,this.integrations,a),[2,this._dispatch(l,c).then(function(h){return d.emit("identify",h.event.userId,h.event.traits,h.event.options),h})]})})},e.prototype.group=function(){for(var t=this,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];var i=Ee(n);if(n.length===0)return this._group;var s=Ir(this._group).apply(void 0,n),o=s[0],u=s[1],c=s[2],l=s[3];this._group.identify(o,u);var d=this._group.id(),f=this._group.traits(),h=this.eventFactory.group(d,f,c,this.integrations,i);return this._dispatch(h,l).then(function(v){return t.emit("group",v.event.groupId,v.event.traits,v.event.options),v})},e.prototype.alias=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return _(this,void 0,void 0,function(){var a,i,s,o,u,c,l,d=this;return S(this,function(f){return a=Ee(t),i=Ci.apply(void 0,t),s=i[0],o=i[1],u=i[2],c=i[3],l=this.eventFactory.alias(s,o,u,this.integrations,a),[2,this._dispatch(l,c).then(function(h){return d.emit("alias",s,o,h.event.options),h})]})})},e.prototype.screen=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return _(this,void 0,void 0,function(){var a,i,s,o,u,c,l,d,f=this;return S(this,function(h){return a=Ee(t),i=Sr.apply(void 0,t),s=i[0],o=i[1],u=i[2],c=i[3],l=i[4],d=this.eventFactory.screen(s,o,u,c,this.integrations,a),[2,this._dispatch(d,l).then(function(v){return f.emit("screen",s,o,v.event.properties,v.event.options),v})]})})},e.prototype.trackClick=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return _(this,void 0,void 0,function(){var a,i;return S(this,function(s){switch(s.label){case 0:return[4,Promise.resolve().then(()=>pt)];case 1:return a=s.sent(),[2,(i=a.link).call.apply(i,B([this],t,!1))]}})})},e.prototype.trackLink=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return _(this,void 0,void 0,function(){var a,i;return S(this,function(s){switch(s.label){case 0:return[4,Promise.resolve().then(()=>pt)];case 1:return a=s.sent(),[2,(i=a.link).call.apply(i,B([this],t,!1))]}})})},e.prototype.trackSubmit=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return _(this,void 0,void 0,function(){var a,i;return S(this,function(s){switch(s.label){case 0:return[4,Promise.resolve().then(()=>pt)];case 1:return a=s.sent(),[2,(i=a.form).call.apply(i,B([this],t,!1))]}})})},e.prototype.trackForm=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return _(this,void 0,void 0,function(){var a,i;return S(this,function(s){switch(s.label){case 0:return[4,Promise.resolve().then(()=>pt)];case 1:return a=s.sent(),[2,(i=a.form).call.apply(i,B([this],t,!1))]}})})},e.prototype.register=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return _(this,void 0,void 0,function(){var a,i,s=this;return S(this,function(o){switch(o.label){case 0:return a=J.system(),i=t.map(function(u){return s.queue.register(a,u,s)}),[4,Promise.all(i)];case 1:return o.sent(),[2,a]}})})},e.prototype.deregister=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return _(this,void 0,void 0,function(){var a,i,s=this;return S(this,function(o){switch(o.label){case 0:return a=J.system(),i=t.map(function(u){var c=s.queue.plugins.find(function(l){return l.name===u});if(c)return s.queue.deregister(a,c,s);a.log("warn","plugin ".concat(u," not found"))}),[4,Promise.all(i)];case 1:return o.sent(),[2,a]}})})},e.prototype.debug=function(t){return t===!1&&localStorage.getItem("debug")&&localStorage.removeItem("debug"),this._debug=t,this},e.prototype.reset=function(){this._user.reset(),this._group.reset(),this.emit("reset")},e.prototype.timeout=function(t){this.settings.timeout=t},e.prototype._dispatch=function(t,n){return _(this,void 0,void 0,function(){var a;return S(this,function(i){return a=new J(t),ce()&&!this.options.retryQueue?[2,a]:[2,Pi(a,this.queue,this,{callback:n,debug:this._debug,timeout:this.settings.timeout})]})})},e.prototype.addSourceMiddleware=function(t){return _(this,void 0,void 0,function(){var n=this;return S(this,function(a){switch(a.label){case 0:return[4,this.queue.criticalTasks.run(function(){return _(n,void 0,void 0,function(){var i,s,o;return S(this,function(u){switch(u.label){case 0:return[4,Promise.resolve().then(()=>_o)];case 1:return i=u.sent().sourceMiddlewarePlugin,s={},this.queue.plugins.forEach(function(c){if(c.type==="destination")return s[c.name]=!0}),o=i(t,s),[4,this.register(o)];case 2:return u.sent(),[2]}})})})];case 1:return a.sent(),[2,this]}})})},e.prototype.addDestinationMiddleware=function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return this.queue.plugins.filter(Fi).forEach(function(i){(t==="*"||i.name.toLowerCase()===t.toLowerCase())&&i.addMiddleware.apply(i,n)}),Promise.resolve(this)},e.prototype.setAnonymousId=function(t){return this._user.anonymousId(t)},e.prototype.queryString=function(t){return _(this,void 0,void 0,function(){var n;return S(this,function(a){switch(a.label){case 0:return this.options.useQueryString===!1?[2,[]]:[4,Promise.resolve().then(()=>Vu)];case 1:return n=a.sent().queryString,[2,n(this,t)]}})})},e.prototype.use=function(t){return t(this),this},e.prototype.ready=function(t){return t===void 0&&(t=function(n){return n}),_(this,void 0,void 0,function(){return S(this,function(n){return[2,Promise.all(this.queue.plugins.map(function(a){return a.ready?a.ready():Promise.resolve()})).then(function(a){return t(a),a})]})})},e.prototype.noConflict=function(){return console.warn(de),Xi(ir??this),this},e.prototype.normalize=function(t){return console.warn(de),this.eventFactory.normalize(t)},Object.defineProperty(e.prototype,"failedInitializations",{get:function(){return console.warn(de),this.queue.failedInitializations},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"VERSION",{get:function(){return Je},enumerable:!1,configurable:!0}),e.prototype.initialize=function(t,n){return _(this,void 0,void 0,function(){return S(this,function(a){return console.warn(de),[2,Promise.resolve(this)]})})},e.prototype.pageview=function(t){return _(this,void 0,void 0,function(){return S(this,function(n){switch(n.label){case 0:return console.warn(de),[4,this.page({path:t})];case 1:return n.sent(),[2,this]}})})},Object.defineProperty(e.prototype,"plugins",{get:function(){var t;return console.warn(de),(t=this._plugins)!==null&&t!==void 0?t:{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Integrations",{get:function(){console.warn(de);var t=this.queue.plugins.filter(function(n){return n.type==="destination"}).reduce(function(n,a){var i="".concat(a.name.toLowerCase().replace(".","").split(" ").join("-"),"Integration"),s=window[i];if(!s)return n;var o=s.Integration;return o?(n[a.name]=o,n):(n[a.name]=s,n)},{});return t},enumerable:!1,configurable:!0}),e.prototype.push=function(t){var n=this,a=t.shift();a&&!n[a]||n[a].apply(this,t)},e}(It),cn=function(r){$(e,r);function e(){var t=r.call(this,{writeKey:""},{disableClientPersistence:!0})||this;return t.initialized=!0,t}return e}(un);function ln(){return typeof process>"u"||!process.env?{}:process.env}var so=/(https:\/\/.*)\/analytics\.js\/v1\/(?:.*?)\/(?:platform|analytics.*)?/,uo=function(){var r,e=Array.prototype.slice.call(document.querySelectorAll("script"));return e.forEach(function(t){var n,a=(n=t.getAttribute("src"))!==null&&n!==void 0?n:"",i=so.exec(a);i&&i[1]&&(r=i[1])}),r},lt,co=function(){var r,e=lt??((r=Vr())===null||r===void 0?void 0:r._cdn);return e},lo=function(r){var e=Vr();e&&(e._cdn=r),lt=r},ar=function(){var r=co();if(r)return r;var e=uo();return e||"https://cdn.segment.com"},or=function(){var r=ar();return"".concat(r,"/next-integrations")};function dn(r,e){var t,n=Object.entries((t=e.integrations)!==null&&t!==void 0?t:{}).reduce(function(a,i){var s,o,u=i[0],c=i[1];return typeof c=="object"?b(b({},a),(s={},s[u]=c,s)):b(b({},a),(o={},o[u]={},o))},{});return Object.entries(r.integrations).reduce(function(a,i){var s,o=i[0],u=i[1];return b(b({},a),(s={},s[o]=b(b({},u),n[o]),s))},{})}function fn(r){try{return decodeURIComponent(r.replace(/\+/g," "))}catch{return r}}function fo(r){return _(this,void 0,void 0,function(){var e;return S(this,function(t){return e=navigator.userAgentData,e?r?[2,e.getHighEntropyValues(r).catch(function(){return e.toJSON()})]:[2,e.toJSON()]:[2,void 0]})})}var $e;function ho(){if($e)return $e;var r=Br(window.location.href);return $e={expires:31536e6,secure:!1,path:"/"},r&&($e.domain=r),$e}function po(r){var e={btid:"dataxu",urid:"millennial-media"};r.startsWith("?")&&(r=r.substring(1)),r=r.replace(/\?/g,"&");for(var t=r.split("&"),n=0,a=t;n<a.length;n++){var i=a[n],s=i.split("="),o=s[0],u=s[1];if(e[o])return{id:u,type:e[o]}}}function vo(r){return r.startsWith("?")&&(r=r.substring(1)),r=r.replace(/\?/g,"&"),r.split("&").reduce(function(e,t){var n=t.split("="),a=n[0],i=n[1],s=i===void 0?"":i;if(a.includes("utm_")&&a.length>4){var o=a.slice(4);o==="campaign"&&(o="name"),e[o]=fn(s)}return e},{})}function yo(){var r=ae.get("_ga");if(r&&r.startsWith("amp"))return r}function mo(r,e,t){var n,a=new me(t?[]:[new Lr(ho())]),i=a.get("s:context.referrer"),s=(n=po(r))!==null&&n!==void 0?n:i;s&&(e&&(e.referrer=b(b({},e.referrer),s)),a.set("s:context.referrer",s))}var go=function(r){try{var e=new URLSearchParams;return Object.entries(r).forEach(function(t){var n=t[0],a=t[1];Array.isArray(a)?a.forEach(function(i){return e.append(n,i)}):e.append(n,a)}),e.toString()}catch{return""}},bo=function(){function r(){var e=this;this.name="Page Enrichment",this.type="before",this.version="0.1.0",this.isLoaded=function(){return!0},this.load=function(t,n){return _(e,void 0,void 0,function(){var a;return S(this,function(i){switch(i.label){case 0:this.instance=n,i.label=1;case 1:return i.trys.push([1,3,,4]),a=this,[4,fo(this.instance.options.highEntropyValuesClientHints)];case 2:return a.userAgentData=i.sent(),[3,4];case 3:return i.sent(),[3,4];case 4:return[2,Promise.resolve()]}})})},this.enrich=function(t){var n,a,i=t.event.context,s=i.page.search||"",o=typeof s=="object"?go(s):s;i.userAgent=navigator.userAgent,i.userAgentData=e.userAgentData;var u=navigator.userLanguage||navigator.language;typeof i.locale>"u"&&typeof u<"u"&&(i.locale=u),(n=i.library)!==null&&n!==void 0||(i.library={name:"analytics.js",version:"".concat("npm:next","-").concat(Je)}),o&&!i.campaign&&(i.campaign=vo(o));var c=yo();c&&(i.amp={id:c}),mo(o,i,(a=e.instance.options.disableClientPersistence)!==null&&a!==void 0?a:!1);try{i.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone}catch{}return t},this.track=this.enrich,this.identify=this.enrich,this.page=this.enrich,this.group=this.enrich,this.alias=this.enrich,this.screen=this.enrich}return r}(),wo=new bo;function hn(r){var e=Array.prototype.slice.call(window.document.querySelectorAll("script"));return e.find(function(t){return t.src===r})}function Ne(r,e){var t=hn(r);if(t!==void 0){var n=t?.getAttribute("status");if(n==="loaded")return Promise.resolve(t);if(n==="loading")return new Promise(function(a,i){t.addEventListener("load",function(){return a(t)}),t.addEventListener("error",function(s){return i(s)})})}return new Promise(function(a,i){var s,o=window.document.createElement("script");o.type="text/javascript",o.src=r,o.async=!0,o.setAttribute("status","loading");for(var u=0,c=Object.entries({});u<c.length;u++){var l=c[u],d=l[0],f=l[1];o.setAttribute(d,f)}o.onload=function(){o.onerror=o.onload=null,o.setAttribute("status","loaded"),a(o)},o.onerror=function(){o.onerror=o.onload=null,o.setAttribute("status","error"),i(new Error("Failed to load ".concat(r)))};var h=window.document.querySelector("script");h?(s=h.parentElement)===null||s===void 0||s.insertBefore(o,h):window.document.head.appendChild(o)})}function ko(r){var e=hn(r);return e!==void 0&&e.remove(),Promise.resolve()}function sr(r,e,t){return _(this,void 0,void 0,function(){function n(c,l){return _(this,void 0,void 0,function(){var d,f,h;return S(this,function(v){switch(v.label){case 0:return d=!1,f=null,[4,l({payload:ct(c,{clone:!0,traverse:!1}),integration:r,next:function(m){d=!0,m===null&&(f=null),m&&(f=m.obj)}})];case 1:return v.sent(),!d&&f!==null&&(f=f,f.integrations=b(b({},c.integrations),(h={},h[r]=!1,h))),[2,f]}})})}var a,i,s,o,u;return S(this,function(c){switch(c.label){case 0:a=ct(e,{clone:!0,traverse:!1}).rawEvent(),i=0,s=t,c.label=1;case 1:return i<s.length?(o=s[i],[4,n(a,o)]):[3,4];case 2:if(u=c.sent(),u===null)return[2,null];a=u,c.label=3;case 3:return i++,[3,1];case 4:return[2,a]}})})}function Ao(r,e){function t(n){return _(this,void 0,void 0,function(){var a;return S(this,function(i){switch(i.label){case 0:return a=!1,[4,r({payload:ct(n.event,{clone:!0,traverse:!1}),integrations:e??{},next:function(s){a=!0,s&&(n.event=s.obj)}})];case 1:if(i.sent(),!a)throw new ue({retry:!1,type:"middleware_cancellation",reason:"Middleware `next` function skipped"});return[2,n]}})})}return{name:"Source Middleware ".concat(r.name),type:"before",version:"0.1.0",isLoaded:function(){return!0},load:function(n){return Promise.resolve(n)},track:t,page:t,identify:t,alias:t,group:t}}const _o=Object.freeze(Object.defineProperty({__proto__:null,applyDestinationMiddleware:sr,sourceMiddlewarePlugin:Ao},Symbol.toStringTag,{value:"Module"}));function fe(r,e){var t=e.methodName,n=e.integrationName,a=e.type,i=e.didError,s=i===void 0?!1:i;r.stats.increment("analytics_js.integration.invoke".concat(s?".error":""),1,["method:".concat(t),"integration_name:".concat(n),"type:".concat(a)])}var So=function(){function r(e,t){this.version="1.0.0",this.alternativeNames=[],this.loadPromise=St(),this.middleware=[],this.alias=this._createMethod("alias"),this.group=this._createMethod("group"),this.identify=this._createMethod("identify"),this.page=this._createMethod("page"),this.screen=this._createMethod("screen"),this.track=this._createMethod("track"),this.action=t,this.name=e,this.type=t.type,this.alternativeNames.push(t.name)}return r.prototype.addMiddleware=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.type==="destination"&&(e=this.middleware).push.apply(e,t)},r.prototype.transform=function(e){return _(this,void 0,void 0,function(){var t;return S(this,function(n){switch(n.label){case 0:return[4,sr(this.name,e.event,this.middleware)];case 1:return t=n.sent(),t===null&&e.cancel(new ue({retry:!1,reason:"dropped by destination middleware"})),[2,new J(t)]}})})},r.prototype._createMethod=function(e){var t=this;return function(n){return _(t,void 0,void 0,function(){var a,i;return S(this,function(s){switch(s.label){case 0:return this.action[e]?(a=n,this.type!=="destination"?[3,2]:[4,this.transform(n)]):[2,n];case 1:a=s.sent(),s.label=2;case 2:return s.trys.push([2,5,,6]),[4,this.ready()];case 3:if(!s.sent())throw new Error("Something prevented the destination from getting ready");return fe(n,{integrationName:this.action.name,methodName:e,type:"action"}),[4,this.action[e](a)];case 4:return s.sent(),[3,6];case 5:throw i=s.sent(),fe(n,{integrationName:this.action.name,methodName:e,type:"action",didError:!0}),i;case 6:return[2,n]}})})}},r.prototype.isLoaded=function(){return this.action.isLoaded()},r.prototype.ready=function(){return _(this,void 0,void 0,function(){return S(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.loadPromise.promise];case 1:return e.sent(),[2,!0];case 2:return e.sent(),[2,!1];case 3:return[2]}})})},r.prototype.load=function(e,t){return _(this,void 0,void 0,function(){var n,a,i,s;return S(this,function(o){switch(o.label){case 0:if(this.loadPromise.isSettled())return[2,this.loadPromise.promise];o.label=1;case 1:return o.trys.push([1,3,,4]),fe(e,{integrationName:this.action.name,methodName:"load",type:"action"}),n=this.action.load(e,t),i=(a=this.loadPromise).resolve,[4,n];case 2:return i.apply(a,[o.sent()]),[2,n];case 3:throw s=o.sent(),fe(e,{integrationName:this.action.name,methodName:"load",type:"action",didError:!0}),this.loadPromise.reject(s),s;case 4:return[2]}})})},r.prototype.unload=function(e,t){var n,a;return(a=(n=this.action).unload)===null||a===void 0?void 0:a.call(n,e,t)},r}();function Io(r){if(!Array.isArray(r))throw new Error("Not a valid list of plugins");var e=["load","isLoaded","name","version","type"];return r.forEach(function(t){e.forEach(function(n){var a;if(t[n]===void 0)throw new Error("Plugin: ".concat((a=t.name)!==null&&a!==void 0?a:"unknown"," missing required function ").concat(n))})}),!0}function Po(r,e){var t=r[e.creationName],n=r[e.name];return r.All===!1&&!t&&!n||t===!1||n===!1}function Eo(r,e){return _(this,void 0,void 0,function(){var t,n,a,i,s,o;return S(this,function(u){switch(u.label){case 0:if(u.trys.push([0,9,,10]),t=new RegExp("https://cdn.segment.(com|build)"),n=ar(),!e)return[3,6];a=r.url.split("/"),i=a[a.length-2],s=r.url.replace(i,btoa(i).replace(/=/g,"")),u.label=1;case 1:return u.trys.push([1,3,,5]),[4,Ne(s.replace(t,n))];case 2:return u.sent(),[3,5];case 3:return u.sent(),[4,Ne(r.url.replace(t,n))];case 4:return u.sent(),[3,5];case 5:return[3,8];case 6:return[4,Ne(r.url.replace(t,n))];case 7:u.sent(),u.label=8;case 8:return typeof window[r.libraryName]=="function"?[2,window[r.libraryName]]:[3,10];case 9:throw o=u.sent(),console.error("Failed to create PluginFactory",r),o;case 10:return[2]}})})}function Co(r,e,t,n,a,i){var s,o,u;return _(this,void 0,void 0,function(){var c,l,d,f=this;return S(this,function(h){switch(h.label){case 0:return c=[],l=(o=(s=r.middlewareSettings)===null||s===void 0?void 0:s.routingRules)!==null&&o!==void 0?o:[],d=((u=r.remotePlugins)!==null&&u!==void 0?u:[]).map(function(v){return _(f,void 0,void 0,function(){var m,p,y,g,w,k;return S(this,function(A){switch(A.label){case 0:if(Po(e,v))return[2];A.label=1;case 1:return A.trys.push([1,6,,7]),p=i?.find(function(I){var E=I.pluginName;return E===v.name}),p?[3,3]:[4,Eo(v,n?.obfuscate)];case 2:p=A.sent(),A.label=3;case 3:return m=p,m?[4,m(b(b({},v.settings),t[v.name]))]:[3,5];case 4:y=A.sent(),g=Array.isArray(y)?y:[y],Io(g),w=l.filter(function(I){return I.destinationName===v.creationName}),g.forEach(function(I){var E=new So(v.creationName,I);w.length&&a&&E.addMiddleware(a),c.push(E)}),A.label=5;case 5:return[3,7];case 6:return k=A.sent(),console.warn("Failed to load Remote Plugin",k),[3,7];case 7:return[2]}})})}),[4,Promise.all(d)];case 1:return h.sent(),[2,c.filter(Boolean)]}})})}var ur,pn,To=Ct(),vn=(ur=(pn=To).__SEGMENT_INSPECTOR__)!==null&&ur!==void 0?ur:pn.__SEGMENT_INSPECTOR__={},xo=function(r){var e;return(e=vn.attach)===null||e===void 0?void 0:e.call(vn,r)};function Oo(r,e){return He("".concat(e,"/v1/projects/").concat(r,"/settings")).then(function(t){return t.ok?t.json():t.text().then(function(n){throw new Error(n)})}).catch(function(t){throw console.error(t.message),t})}function Mo(r){return ln().NODE_ENV!=="test"&&Object.keys(r.integrations).length>1}function Ro(r){var e,t,n;return ln().NODE_ENV!=="test"&&((n=(t=(e=r.middlewareSettings)===null||e===void 0?void 0:e.routingRules)===null||t===void 0?void 0:t.length)!==null&&n!==void 0?n:0)>0}function Do(r,e){ia(r,e),na(r,e)}function No(r,e){return _(this,void 0,void 0,function(){return S(this,function(t){switch(t.label){case 0:return[4,ta(r,e)];case 1:return t.sent(),aa(r,e),[2]}})})}function jo(r,e,t,n,a,i,s){var o,u,c;return a===void 0&&(a=[]),_(this,void 0,void 0,function(){var l,d,f,h,v,m,p,y,g,w,k,A,I,E,T,C=this;return S(this,function(P){switch(P.label){case 0:return Do(t,s),l=a?.filter(function(x){return typeof x=="object"}),d=a?.filter(function(x){return typeof x=="function"&&typeof x.pluginName=="string"}),Ro(e)?[4,Promise.resolve().then(()=>qu).then(function(x){return x.tsubMiddleware(e.middlewareSettings.routingRules)})]:[3,2];case 1:return h=P.sent(),[3,3];case 2:h=void 0,P.label=3;case 3:return f=h,Mo(e)||i.length>0?[4,Promise.resolve().then(()=>rc).then(function(x){return x.ajsDestinations(r,e,t.integrations,n,f,i)})]:[3,5];case 4:return m=P.sent(),[3,6];case 5:m=[],P.label=6;case 6:return v=m,e.legacyVideoPluginsEnabled?[4,Promise.resolve().then(()=>ic).then(function(x){return x.loadLegacyVideoPlugins(t)})]:[3,8];case 7:P.sent(),P.label=8;case 8:return!((o=n.plan)===null||o===void 0)&&o.track?[4,Promise.resolve().then(()=>sc).then(function(x){var M;return x.schemaFilter((M=n.plan)===null||M===void 0?void 0:M.track,e)})]:[3,10];case 9:return y=P.sent(),[3,11];case 10:y=void 0,P.label=11;case 11:return p=y,g=dn(e,n),[4,Co(e,t.integrations,g,n,f,d).catch(function(){return[]})];case 12:return w=P.sent(),k=B(B([wo],v,!0),w,!0),p&&k.push(p),A=((u=n.integrations)===null||u===void 0?void 0:u.All)===!1&&!n.integrations["Segment.io"]||n.integrations&&n.integrations["Segment.io"]===!1,A?[3,14]:(E=(I=k).push,[4,io(t,g["Segment.io"],e.integrations)]);case 13:E.apply(I,[P.sent()]),P.label=14;case 14:return[4,t.register.apply(t,B(B([],k,!1),l,!1))];case 15:return T=P.sent(),[4,ra(t,s)];case 16:return P.sent(),Object.entries((c=e.enabledMiddleware)!==null&&c!==void 0?c:{}).some(function(x){var M=x[1];return M})?[4,Promise.resolve().then(()=>cc).then(function(x){var M=x.remoteMiddlewares;return _(C,void 0,void 0,function(){var K,X;return S(this,function(ie){switch(ie.label){case 0:return[4,M(T,e,n.obfuscate)];case 1:return K=ie.sent(),X=K.map(function(Se){return t.addSourceMiddleware(Se)}),[2,Promise.all(X)]}})})})]:[3,18];case 17:P.sent(),P.label=18;case 18:return[2,T]}})})}function Bo(r,e,t){var n,a,i,s,o,u,c,l,d,f,h;return e===void 0&&(e={}),_(this,void 0,void 0,function(){var v,m,p,y,g,w,k,A,I,E,T,C,P;return S(this,function(x){switch(x.label){case 0:return e.disable===!0?[2,[new cn,J.system()]]:(e.globalAnalyticsKey&&Zi(e.globalAnalyticsKey),r.cdnURL&&lo(r.cdnURL),e.initialPageview&&t.add(new Bt("page",[])),v=(n=r.cdnURL)!==null&&n!==void 0?n:ar(),(a=r.cdnSettings)!==null&&a!==void 0?(p=a,[3,3]):[3,1]);case 1:return[4,Oo(r.writeKey,v)];case 2:p=x.sent(),x.label=3;case 3:return m=p,e.updateCDNSettings&&(m=e.updateCDNSettings(m)),typeof e.disable!="function"?[3,5]:[4,e.disable(m)];case 4:if(y=x.sent(),y)return[2,[new cn,J.system()]];x.label=5;case 5:return g=(s=(i=m.integrations["Segment.io"])===null||i===void 0?void 0:i.retryQueue)!==null&&s!==void 0?s:!0,e=b({retryQueue:g},e),w=new un(b(b({},r),{cdnSettings:m,cdnURL:v}),e),xo(w),k=(o=r.plugins)!==null&&o!==void 0?o:[],A=(u=r.classicIntegrations)!==null&&u!==void 0?u:[],I=(c=e.integrations)===null||c===void 0?void 0:c["Segment.io"],Tr.initRemoteMetrics(b(b({},m.metrics),{host:(l=I?.apiHost)!==null&&l!==void 0?l:(d=m.metrics)===null||d===void 0?void 0:d.host,protocol:I?.protocol})),[4,jo(r.writeKey,m,w,e,k,A,t)];case 6:return E=x.sent(),T=(f=window.location.search)!==null&&f!==void 0?f:"",C=(h=window.location.hash)!==null&&h!==void 0?h:"",P=T.length?T:C.replace(/(?=#).*(?=\?)/,""),P.includes("ajs_")?[4,w.queryString(P).catch(console.error)]:[3,8];case 7:x.sent(),x.label=8;case 8:return w.initialized=!0,w.emit("initialize",r,e),[4,No(w,t)];case 9:return x.sent(),[2,[w,E]]}})})}var Lo=function(r){$(e,r);function e(){var t=this,n=St(),a=n.promise,i=n.resolve;return t=r.call(this,function(s){return a.then(function(o){var u=o[0],c=o[1];return Bo(u,c,s)})})||this,t._resolveLoadStart=function(s,o){return i([s,o])},t}return e.prototype.load=function(t,n){return n===void 0&&(n={}),this._resolveLoadStart(t,n),this},e.load=function(t,n){return n===void 0&&(n={}),new e().load(t,n)},e.standalone=function(t,n){return e.load({writeKey:t},n).then(function(a){return a[0]})},e}(sa);function cr(r,e,{signal:t,edges:n}={}){let a,i=null;const s=n!=null&&n.includes("leading"),o=n==null||n.includes("trailing"),u=()=>{i!==null&&(r.apply(a,i),a=void 0,i=null)},c=()=>{o&&u(),h()};let l=null;const d=()=>{l!=null&&clearTimeout(l),l=setTimeout(()=>{l=null,c()},e)},f=()=>{l!==null&&(clearTimeout(l),l=null)},h=()=>{f(),a=void 0,i=null},v=()=>{f(),u()},m=function(...p){if(t?.aborted)return;a=this,i=p;const y=l==null;d(),s&&y&&u()};return m.schedule=d,m.cancel=h,m.flush=v,t?.addEventListener("abort",h,{once:!0}),m}function Uo(r){return r==null||typeof r!="object"&&typeof r!="function"}function Fo(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Ko(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function $o(r){return je(r)}function je(r,e=new Map){if(Uo(r))return r;if(e.has(r))return e.get(r);if(Array.isArray(r)){const t=new Array(r.length);e.set(r,t);for(let n=0;n<r.length;n++)t[n]=je(r[n],e);return Object.hasOwn(r,"index")&&(t.index=r.index),Object.hasOwn(r,"input")&&(t.input=r.input),t}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp){const t=new RegExp(r.source,r.flags);return t.lastIndex=r.lastIndex,t}if(r instanceof Map){const t=new Map;e.set(r,t);for(const[n,a]of r)t.set(n,je(a,e));return t}if(r instanceof Set){const t=new Set;e.set(r,t);for(const n of r)t.add(je(n,e));return t}if(typeof Buffer<"u"&&Buffer.isBuffer(r))return r.subarray();if(Fo(r)){const t=new(Object.getPrototypeOf(r)).constructor(r.length);e.set(r,t);for(let n=0;n<r.length;n++)t[n]=je(r[n],e);return t}if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);if(r instanceof DataView){const t=new DataView(r.buffer.slice(0),r.byteOffset,r.byteLength);return e.set(r,t),Ve(t,r,e),t}if(typeof File<"u"&&r instanceof File){const t=new File([r],r.name,{type:r.type});return e.set(r,t),Ve(t,r,e),t}if(r instanceof Blob){const t=new Blob([r],{type:r.type});return e.set(r,t),Ve(t,r,e),t}if(r instanceof Error){const t=new r.constructor;return e.set(r,t),t.message=r.message,t.name=r.name,t.stack=r.stack,t.cause=r.cause,Ve(t,r,e),t}if(typeof r=="object"&&r!==null){const t=Object.create(Object.getPrototypeOf(r));return e.set(r,t),Ve(t,r,e),t}return r}function Ve(r,e,t){const n=[...Object.keys(e),...Ko(e)];for(let a=0;a<n.length;a++){const i=n[a],s=Object.getOwnPropertyDescriptor(r,i);(s==null||s.writable)&&(r[i]=je(e[i],t))}}function yn(r){if(!r||typeof r!="object")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(r)==="[object Object]":!1}function _e(r,e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const a=t[n],i=e[a],s=r[a];Array.isArray(i)?Array.isArray(s)?r[a]=_e(s,i):r[a]=_e([],i):yn(i)?yn(s)?r[a]=_e(s,i):r[a]=_e({},i):(s===void 0||i!==void 0)&&(r[a]=i)}return r}function dt(r,e){return _e($o(r),e)}class mn extends Error{name;statusCode;details;constructor(e){super(e.message),this.name=e.errorName||"ApiError",this.statusCode=e.statusCode,this.details=e.details}}async function lr(r,e){const t={"Content-Type":"application/json",...e.headers};e.authToken&&(t.Authorization=`Bearer ${e.authToken}`);const n=Vo(r,e.query),a=await fetch(n,{headers:t,method:e.method,...e.body?{body:JSON.stringify(e.body)}:{}}),i=a.headers.get("content-type"),s=i&&i.includes("application/json");if(!a.ok){const o=s?await a.json():null,u=o?.message||a.statusText,c=a.status,l=o?.details;throw new mn({message:u,statusCode:c,details:l,errorName:o?.code})}return s?a.json():a}function Vo(r,e){try{const t=new URL(r),n=new URLSearchParams(t.search);for(const[a,i]of Object.entries(e||{}))n.append(a,i);return t.search=n.toString(),t.toString()}catch{return r}}class zo{baseUrl="";workspaceId="";identityStore;constructor(e){this.identityStore=e}get identityProps(){return this.identityStore.props}init(e){this.baseUrl=e.baseUrl.replace(/\/$/,""),this.workspaceId=e.workspaceId}fetch(e,t){if(typeof e=="string"){const n=t??{};return this.requestWithAuthRetry(`${this.baseUrl}/workspaces/${this.workspaceId}/${e}`,{...n,authToken:this.identityProps.accessToken})}else if(typeof e=="function")return e(this.workspaceId,{baseUrl:this.baseUrl,authToken:this.identityProps.accessToken});throw new Error(`Invalid type of argument ${typeof e}`)}async verify(e){return this.requestWithAuthRetry(`${this.baseUrl}/workspaces/${this.workspaceId}/contacts/verify`,{body:e,method:"POST"})}async identify(e){return this.requestWithAuthRetry(`${this.baseUrl}/workspaces/${this.workspaceId}/contacts/identify`,{body:e,method:"POST"})}async auth(){const e=this.identityProps.anonymousId;if(!e)return;const t=await this.requestWithAuthRetry(`${this.baseUrl}/workspaces/${this.workspaceId}/contacts/identify`,{body:{resolutionStrategy:mt.first_move,identityClaims:[{type:ze.Visitor,claim:JSON.stringify({visitorId:e})}]},method:"POST"},!0);return this.identityStore.updateProps({accessToken:t.token}),t.token}async sendOTPRequest(e){return this.requestWithAuthRetry(`${this.baseUrl}/workspaces/${this.workspaceId}/contacts/verify/send-otp`,{body:e,method:"POST"})}async getCurrentContact(){return this.requestWithAuthRetry(`${this.baseUrl}/workspaces/${this.workspaceId}/contacts/me`,{method:"GET",authToken:this.identityProps.accessToken})}async updateCurrentContact(e){return this.requestWithAuthRetry(`${this.baseUrl}/workspaces/${this.workspaceId}/contacts/me`,{body:e,method:"POST",authToken:this.identityProps.accessToken})}async updateCurrentContactIdentifierProperties(e){return this.requestWithAuthRetry(`${this.baseUrl}/workspaces/${this.workspaceId}/contacts/me/identifiers`,{body:e,method:"PATCH",authToken:this.identityProps.accessToken})}async deleteCurrentContactIdentifier(e){return this.requestWithAuthRetry(`${this.baseUrl}/workspaces/${this.workspaceId}/contacts/me/identifiers`,{body:e,method:"DELETE",authToken:this.identityStore.getProp("accessToken")})}async requestWithAuthRetry(e,t,n){try{return await lr(e,t)}catch(a){if(a instanceof mn&&!n&&t.authToken&&a.statusCode===401){const i=await this.auth();if(i)return await this.requestWithAuthRetry(e,{...t,authToken:i})}throw a}}}class Q{analyticsBrowser;constructor(e){this.analyticsBrowser=e}track(e,t,n){this.analyticsBrowser.track(e,t??void 0,{integrations:{Bird:n}})}}class qo extends Q{checkoutUpdated(e,t){return this.track("ecommerce/checkout-updated",e,t)}checkoutAbandoned(e,t){return this.track("ecommerce/checkout-abandoned",e,t)}orderConfirmed(e,t){return this.track("ecommerce/order-confirmed",e,t)}orderCanceled(e,t){return this.track("ecommerce/order-canceled",e,t)}orderFulfilled(e,t){return this.track("ecommerce/order-fulfilled",e,t)}cartViewed(e,t){return this.track("ecommerce/cart-viewed",e,t)}cartUpdated(e,t){return this.track("ecommerce/cart-updated",e,t)}productViewed(e,t){return this.track("ecommerce/product-viewed",e,t)}collectionViewed(e,t){return this.track("ecommerce/collection-viewed",e,t)}}class Go extends Q{messageSent(e,t){return this.track("messaging/message-sent",e,t)}messageRead(e,t){return this.track("messaging/message-read",e,t)}messageBounced(e,t){return this.track("messaging/message-bounced",e,t)}messageDeliveryFailed(e,t){return this.track("messaging/message-delivery-failed",e,t)}messageDelivered(e,t){return this.track("messaging/message-delivered",e,t)}messageMarkedSpam(e,t){return this.track("messaging/message-marked-spam",e,t)}messageOpened(e,t){return this.track("messaging/message-opened",e,t)}messageSubscribed(e,t){return this.track("messaging/message-subscribed",e,t)}messageUnsubscribed(e,t){return this.track("messaging/message-unsubscribed",e,t)}messageLinkClicked(e,t){return this.track("messaging/message-link-clicked",e,t)}}class Wo extends Q{identifierSuppressed(e,t){return this.track("suppressions/identifier-suppressed",e,t)}identifierUnsuppressed(e,t){return this.track("suppressions/identifier-unsuppressed",e,t)}}class Qo extends Q{membershipChanged(e,t){return this.track("audiences/membership-changed",e,t)}}class Ho extends Q{subscriptionCreated(e,t){return this.track("subscription/subscription-created",e,t)}subscriptionUpdated(e,t){return this.track("subscription/subscription-updated",e,t)}subscriptionCanceled(e,t){return this.track("subscription/subscription-canceled",e,t)}}class Jo extends Q{pageViewed(e,t){return this.track("tracker/page-viewed",e,t)}formViewed(e,t){return this.track("tracker/form-viewed",e,t)}formSubmitted(e,t){return this.track("tracker/form-submitted",e,t)}}class Yo extends Q{csat(e,t){return this.track("survey/csat",e,t)}}class Zo extends Q{pageViewed(e,t){return this.track("web/page-viewed",e,t)}formViewed(e,t){return this.track("web/form-viewed",e,t)}formSubmitted(e,t){return this.track("web/form-submitted",e,t)}searchSubmitted(e,t){return this.track("web/search-submitted",e,t)}}class Xo extends Q{incomingCallAnswered(e,t){return this.track("conference/incoming-call-answered",e,t)}incomingCallUnanswered(e,t){return this.track("conference/incoming-call-unanswered",e,t)}outgoingCallAnswered(e,t){return this.track("conference/outgoing-call-answered",e,t)}outgoingCallUnanswered(e,t){return this.track("conference/outgoing-call-unanswered",e,t)}incomingCallVoicemail(e,t){return this.track("conference/incoming-call-voicemail",e,t)}}class es extends Q{appInstalled(e,t){return this.track("app/app-installed",e,t)}appUninstalled(e,t){return this.track("app/app-uninstalled",e,t)}appOpened(e,t){return this.track("app/app-opened",e,t)}appUpdated(e,t){return this.track("app/app-updated",e,t)}appBackgrounded(e,t){return this.track("app/app-backgrounded",e,t)}appForegrounded(e,t){return this.track("app/app-foregrounded",e,t)}appCrashed(e,t){return this.track("app/app-crashed",e,t)}linkClicked(e,t){return this.track("app/link-clicked",e,t)}screenViewed(e,t){return this.track("app/screen-viewed",e,t)}}class ts extends Q{checkedIn(e,t){return this.track("hospitality/checked-in",e,t)}checkedOut(e,t){return this.track("hospitality/checked-out",e,t)}reservationCreated(e,t){return this.track("hospitality/reservation-created",e,t)}reservationUpdated(e,t){return this.track("hospitality/reservation-updated",e,t)}reservationCanceled(e,t){return this.track("hospitality/reservation-canceled",e,t)}}class rs extends Q{paymentIntentPaid(e,t){return this.track("payments/payment-intent-paid",e,t)}paymentRefundRequested(e,t){return this.track("payments/payment-refund-requested",e,t)}}class ns extends Q{ecommerce;messaging;suppressions;audiences;subscription;tracker;survey;web;conference;app;hospitality;payments;constructor(e){super(e),this.ecommerce=new qo(e),this.messaging=new Go(e),this.suppressions=new Wo(e),this.audiences=new Qo(e),this.subscription=new Ho(e),this.tracker=new Jo(e),this.survey=new Yo(e),this.web=new Zo(e),this.conference=new Xo(e),this.app=new es(e),this.hospitality=new ts(e),this.payments=new rs(e)}formViewed(e,t){return this.analyticsBrowser.track("tracker/form-viewed",e,{integrations:{Bird:t}})}async formSubmitted(e,t){return(await this.analyticsBrowser.track("tracker/form-submitted",e,{integrations:{Bird:t}})).event}}var H=(r=>(r.DeprecatedEventQueue="$NEST_API$_SDK_eventQueue",r.DeprecatedUserIdentity="$NEST_API$_SDK_userIdentification",r.DeprecatedEventQueueRegistry="$NEST_API$_SDK_eventQueueRegistry",r.EventQueue="queue",r.UserIdentity="ident",r.EventMutexLock="event_lock",r.EventQueueRegistry="queue_registry",r.PixelMutexLock="_bird_pixel_lock_",r.QueuedPixelEvents="_bird_pixel_queue_",r))(H||{});const ft=(r,e,t)=>`_${e.toLowerCase()}_${r}_[${t}]_`;class is{ttl;constructor(e=31536e6){this.ttl=e}set(e,t){try{this.remove(e),document.cookie=`${e}=${t}; expires=${new Date(Date.now()+this.ttl).toUTCString()}; path=/;`}catch(n){console.error(n)}}get(e){try{const n=document.cookie.split(";").find(i=>i.includes(e));return(n?n.split("=")[1]:null)??null}catch(t){return console.error(t),null}}remove(e){try{document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC;`}catch(t){console.error(t)}}}class as{set(e,t){try{window.localStorage.setItem(e,t)}catch(n){console.error(n)}}get(e){try{return window.localStorage.getItem(e)}catch(t){return console.error(t),null}}remove(e){try{window.localStorage.removeItem(e)}catch(t){console.error(t)}}}const R={Visitor:"Visitor",Chat:"Chat",SignedIdentityClaims:"SignedIdentityClaims",PushToken:"PushToken",OTP:"OTP"},os={OTP:"OTP"},gn=r=>({type:ze.Visitor,claim:JSON.stringify({visitorId:r})}),ss=(r,e)=>{const{strategy:t}=e;switch(t){case R.Visitor:return{type:ze.Visitor,claim:JSON.stringify({visitorId:r,identifier:e.identifier})};case R.PushToken:return{type:ze.PushToken,claim:JSON.stringify({gateway:"web",connectorId:e.connectorId,deviceToken:e.deviceToken})};default:oe(!1,`Unsupported identity claim type: ${t}`)}},bn="contact.identify";class ht extends Event{constructor(e,t,n,a,i,s){super(bn),this.visitorId=e,this.claims=t,this.contactAttributes=n,this.contactId=a,this.accessToken=i,this.identifierKeys=s}}const us=(r,e)=>{const{strategy:t}=e;switch(t){case R.Visitor:return{strategy:t,claims:JSON.stringify({visitorId:r,identifier:e.identifier})};case R.PushToken:return{strategy:t,claims:JSON.stringify({gateway:"web",connectorId:e.connectorId,deviceToken:e.deviceToken})};case R.SignedIdentityClaims:return{strategy:t,claims:e.signedIdentity};case R.Chat:return{strategy:t,claims:JSON.stringify({value:r,channelId:e.channelId})};case R.OTP:return{strategy:t,claims:JSON.stringify({id:e.id,otpCode:e.otpCode,identifier:e.identifier})};default:oe(!1,`Unknown strategy: ${t}`)}};class cs{api;identityStore;eventTarget;constructor(e,t,n){this.api=e,this.identityStore=t,this.eventTarget=n}get anonymousId(){const e=this.identityStore.anonymousId;return e||(this.anonymousId=crypto.randomUUID(),this.anonymousId)}set anonymousId(e){this.identityStore.updateProps({anonymousId:e})}get contactId(){return this.identityStore.contactId}get deviceToken(){return this.identityStore.getProp("deviceToken")}set contactId(e){this.identityStore.updateProps({contactId:e})}getProp(e){return this.identityStore.getProp(e)}get isVerified(){return!!(this.identityStore.props.signedIdentity&&this.identityStore.props.accessToken)}getCurrent(){return this.api.getCurrentContact()}async updateCurrent(e){return this.api.updateCurrentContact({attributes:e})}reset({anonymousId:e="keep"}={}){const t=this.resolveResetAnonymousId(e);this.identityStore.clear(),this.identityStore.updateProps({anonymousId:t})}resolveResetAnonymousId(e){switch(e){case"keep":return this.anonymousId;case"refresh":return crypto.randomUUID();default:return e}}async init(e,t){const n=this.identityStore.init(e,t.conf.workspaceId);return n.anonymousId||(this.anonymousId=crypto.randomUUID()),t.signedIdentity?this.identify({signedIdentity:t.signedIdentity,strategy:R.SignedIdentityClaims}):!n.contactId&&t.conf.tracking?.anonymousTracking===Le.identify?this.identify({strategy:R.Visitor}):null}async identify(e,t){const{signedIdentity:n}=this.identityStore.props;switch(e.strategy){case R.SignedIdentityClaims:return n===e.signedIdentity?{contactId:this.contactId,accessToken:this.getProp("accessToken"),identifierKeys:this.getProp("identifierKeys")}:this.verify({signedIdentity:e.signedIdentity,strategy:R.SignedIdentityClaims},{signedIdentity:e.signedIdentity},t);case R.Visitor:return this.verify({identifier:e.identifier,strategy:R.Visitor},void 0,t);case R.Chat:return this.verify({channelId:e.channelId,strategy:R.Chat},void 0,t);case R.OTP:return this.verify({id:e.id,otpCode:e.otpCode,identifier:e.identifier,strategy:R.OTP},void 0,t);case R.PushToken:return this.twoStepsIdentify({strategy:R.PushToken,connectorId:e.connectorId,deviceToken:e.deviceToken},void 0);default:throw new Error("Invalid strategy")}}async verify(e,t={},n){const a=await this.api.verify({contactAttributes:n,visitorId:this.anonymousId,verifications:[us(this.anonymousId,e)]});return this.identityStore.updateProps({...t,anonymousId:this.anonymousId,accessToken:a.token,contactId:a.contactId,identifierKeys:a.identifierKeys}),this.eventTarget.dispatchEvent(new ht(this.anonymousId,[e],n,a.contactId,a.token)),{anonymousId:this.anonymousId,contactId:a.contactId,accessToken:a.token,identifierKeys:a.identifierKeys}}async twoStepsIdentify(e,t={}){if(!e.deviceToken)throw new Error("subscription token must be provided for push identify claim");const n={contactId:this.identityStore.contactId,accessToken:this.identityStore.getProp("accessToken"),deviceToken:this.identityStore.getProp("deviceToken"),identifierKeys:this.identityStore.getProp("identifierKeys")};if(!n.contactId||!n.accessToken){const a=[gn(this.anonymousId)],i=await this.api.identify({resolutionStrategy:mt.first_move,identityClaims:a});n.contactId=i.contactId,n.accessToken=i.token,n.identifierKeys=i.identifierKeys,this.identityStore.updateProps({...n,...t}),this.eventTarget.dispatchEvent(new ht(this.anonymousId,[],void 0,i.contactId,i.token))}if(n.contactId&&n.accessToken&&e.deviceToken!==n.deviceToken){const a=[gn(this.anonymousId),ss(this.anonymousId,e)],i=await this.api.identify({resolutionStrategy:mt.first_move,identityClaims:a});n.contactId=i.contactId,n.accessToken=i.token,n.identifierKeys=i.identifierKeys,this.identityStore.updateProps({...n,...t,deviceToken:e.deviceToken}),i.token&&this.eventTarget.dispatchEvent(new ht(this.anonymousId,[e],void 0,i.contactId,i.token))}return n}async sendVerificationRequest(e){switch(e.strategy){case"OTP":return this.sendOTPVerificationRequest(e);default:throw new Error("Invalid strategy")}}sendOTPVerificationRequest=(()=>{let e;const t=cr(async n=>{const a=await this.api.sendOTPRequest({verification:{strategy:os.OTP,claims:JSON.stringify({identifier:n.identifier})}});e&&e({id:a.id,expiresAt:a.expiresAt})},250,{edges:["leading"]});return async n=>new Promise(a=>{e=a,t(n)})})();async putAttributes(e){const t={attributes:e};return await this.api.updateCurrentContact(t)}async deleteIdentifier(e){return await this.api.deleteCurrentContactIdentifier({identifierKey:e.key,identifierValue:e.value})}}class ls{}class ds extends ls{debug(e){console.debug(e)}info(e){console.info(e)}warn(e){console.warn(e)}error(e){console.error(e)}}function fs(){return window?new URLSearchParams(window.location.search).get("ajs_signed_identity")??void 0:void 0}function hs(){if(!window)return!1;const r=window.navigator.userAgent;return/bot|googlebot|crawler|spider|robot|crawling|headless|monitoring|lighthouse/i.test(r)}function ps(r){switch(typeof r){case"number":case"symbol":return!1;case"string":return r.includes(".")||r.includes("[")||r.includes("]")}}function vs(r){return Object.is(r,-0)?"-0":r.toString()}function wn(r){const e=[],t=r.length;if(t===0)return e;let n=0,a="",i="",s=!1;for(r.charCodeAt(0)===46&&(e.push(""),n++);n<t;){const o=r[n];i?o==="\\"&&n+1<t?(n++,a+=r[n]):o===i?i="":a+=o:s?o==='"'||o==="'"?i=o:o==="]"?(s=!1,e.push(a),a=""):a+=o:o==="["?(s=!0,a&&(e.push(a),a="")):o==="."?a&&(e.push(a),a=""):a+=o,n++}return a&&e.push(a),e}function G(r,e,t){if(r==null)return t;switch(typeof e){case"string":{const n=r[e];return n===void 0?ps(e)?G(r,wn(e),t):t:n}case"number":case"symbol":{typeof e=="number"&&(e=vs(e));const n=r[e];return n===void 0?t:n}default:{if(Array.isArray(e))return ys(r,e,t);Object.is(e?.valueOf(),-0)?e="-0":e=String(e);const n=r[e];return n===void 0?t:n}}}function ys(r,e,t){if(e.length===0)return t;let n=r;for(let a=0;a<e.length;a++){if(n==null)return t;n=n[e[a]]}return n===void 0?t:n}const ms=/^(?:0|[1-9]\d*)$/;function gs(r){switch(typeof r){case"number":return Number.isInteger(r)&&r>=0&&r<Number.MAX_SAFE_INTEGER;case"symbol":return!1;case"string":return ms.test(r)}}function bs(r,e,t){const n=Array.isArray(e)?e:wn(e);let a=r;for(let s=0;s<n.length-1;s++){const o=n[s],u=n[s+1];a[o]==null&&(a[o]=gs(u)?[]:{}),a=a[o]}const i=n[n.length-1];return a[i]=t,r}const ws=r=>btoa(r),ks=r=>atob(r),dr=async()=>{},fr=()=>Date.now(),As=r=>Math.random()*r,_s=r=>r,hr=r=>new Promise(e=>setTimeout(e,r));function pr(r,e){return e in r}class Ss{key="";workspaceId="";persister;cookiePersister;constructor(e,t){this.persister=e,this.cookiePersister=t}init(e,t){return this.key=ft(H.UserIdentity,e,t),this.workspaceId=t,this.props}get props(){return this.storedProps}get contactId(){return this.getProp("contactId")}get anonymousId(){return this.getProp("anonymousId")}set props(e){const t=fr(),{contactId:n,anonymousId:a,...i}=e;Object.keys(i).length>0&&this.persister.set(this.key,JSON.stringify({...i,updatedAt:t})),this.cookiePersister.set(this.key,ws(JSON.stringify({contactId:n,anonymousId:a,updatedAt:t})))}get legacyStoredProps(){return vr(this.persister.get(H.DeprecatedUserIdentity))?.[this.workspaceId]??{}}get storedProps(){const e=vr(this.persister.get(this.key)),t=vr(this.cookiePersister.get(this.key),ks);return _e(_e(this.legacyStoredProps,e||{}),t||{})}getProp(e){return G(this.props,e)}updateProps(e){return this.props=dt(this.props,e??{}),this.props}clear(){this.persister.remove(this.key),this.cookiePersister.remove(this.key)}}function vr(r,e=_s){if(!r)return null;try{return JSON.parse(e(r))}catch{return null}}function Is(){return typeof window<"u"}function kn(){return Is()?window.navigator.onLine:!0}function An(){return!kn()}const Ps={maxRetries:5,lockTimeout:100};class _n{lockKey;options;persister;constructor(e,t,n={}){this.lockKey=e,this.persister=t,this.options=dt(Ps,n)}async execute(e,t=0){const n=await this.getCurrentLock();if(this.canExecute(n)){this.lock();try{await e()}finally{this.unlock()}}else{if(t<=this.options.maxRetries)return await hr(this.options.lockTimeout),this.execute(e,t+1);console.error("Unable to retrieve lock")}}lock(){this.persister.set(this.lockKey,JSON.stringify(fr()+this.options.lockTimeout))}unlock(){this.persister.remove(this.lockKey)}canExecute(e){return e===null||fr()>e}async getCurrentLock(){const e=await this.persister.get(this.lockKey);if(e===null)return null;const t=JSON.parse(e);return typeof t=="number"?t:null}}function Es(r){return(r?JSON.parse(r):[]).map(e=>{const t=new J(e.event,e.id),n=t.event.timestamp;return t.updateEvent("timestamp",new Date(n)),t})}const Sn=r=>`${H.DeprecatedEventQueue}:${r}:events`,In=(r,e)=>`${r}_${e}`,Cs=(r,e,t)=>ft(H.EventQueue,r,In(e,t)),Ts=(r,e,t)=>ft(H.EventMutexLock,r,In(e,t));class Pn{eventName;mu;events;maxEvents;eventsKey="";persister;persistMode;constructor(e,t,n,a,{maxEvents:i=100,maxRetries:s=5,persistMode:o="eager"}={}){this.eventName=e,this.eventsKey=Cs(t,n,e),this.maxEvents=i,this.persister=a,this.persistMode=o,this.migrateEvents(),this.events=this.persistedEvents,this.mu=new _n(Ts(t,n,e),a,{maxRetries:s}),window&&o==="lazy"&&window.addEventListener("pagehide",()=>{this.mu.execute(()=>{this.persistedEvents=this.events})})}enqueue(...e){if(this.events.length+e.length>this.maxEvents){const t=this.maxEvents-this.events.length;this.events=[...this.events,...e.slice(0,t)]}else this.events.push(...e)}get size(){return this.events.length}push(...e){return this.mu.execute(()=>{this.enqueue(...e),this.persistMode==="eager"&&(this.persistedEvents=this.events)})}async pushWithBackoff(e,t=50){this.enqueue(e),await hr(t)}peekLast(){return this.events[this.events.length-1]??null}async pop(){const e=this.peekLast();return await this.mu.execute(()=>{this.events.pop(),this.persistMode==="eager"&&(this.persistedEvents=this.events)}),e}async popWithBackoff(e=50){const t=await this.pop();return await new Promise(n=>setTimeout(n,e)),t}peek(e=0){return this.events[e]??null}async shift(){const e=this.peek();return await this.mu.execute(()=>{this.events.shift(),this.persistMode==="eager"&&(this.persistedEvents=this.events)}),e}async shiftWithBackoff(e=50){const t=await this.shift();return await new Promise(n=>setTimeout(n,e)),t}get persistedEvents(){const e=this.persister.get(this.eventsKey);return Es(e)}set persistedEvents(e){this.persister.set(this.eventsKey,JSON.stringify(Object.values(e)))}migrateEvents(){const e=this.persister.get(Sn(this.eventName));e&&(this.persister.set(this.eventsKey,e),this.persister.remove(Sn(this.eventName)))}}class xs{key;namespace;workspaceId;registry;persister;constructor(e,t,n){this.namespace=e,this.workspaceId=t,this.key=ft(H.EventQueueRegistry,e,t),this.persister=n,this.migrateRegistry(),this.registry=this.getInitialRegistry()}getQueues(){return Array.from(this.registry.values())}getQueue(e){const t=this.registry.get(e);return t||this.registerQueue(e,new Pn(e,this.namespace,this.workspaceId,this.persister))}getInitialRegistry(){const e=this.persister.get(this.key)??this.persister.get(H.DeprecatedEventQueueRegistry),t=e?JSON.parse(e):[];return!Array.isArray(t)||t.length===0?new Map:t.reduce((n,{eventName:a})=>(n.set(a,new Pn(a,this.namespace,this.workspaceId,this.persister)),n),new Map)}registerQueue(e,t){return this.registry.set(e,t),this.persister.set(this.key,JSON.stringify(Array.from(this.registry).map(([n])=>({eventName:n})))),t}migrateRegistry(){const e=this.persister.get(H.DeprecatedEventQueueRegistry);e&&(this.persister.set(this.key,e),this.persister.remove(H.DeprecatedEventQueueRegistry))}}const Os={interval:2500};class Ms{opts;plugin;registry;canDispatch;currentInterval=null;flusherRegistry=new Map;constructor(e,t,n,a){this.plugin=e,this.registry=t,this.canDispatch=n,this.opts=dt(Os,a||{})}start(){this.currentInterval=setInterval(async()=>{if(An())return;const e=this.registry.getQueues();for(const t of e){const n=this.getFlusher(t);n.flushing||await n.flush()}},this.opts.interval)}stop(){this.currentInterval&&clearInterval(this.currentInterval)}getFlusher(e){return this.flusherRegistry.get(e.eventName)??this.registerFlusher(e)}registerFlusher(e){const t=new Ds(e,this.plugin,this.canDispatch);return this.flusherRegistry.set(e.eventName,t),t}}const Rs=5;class Ds{flushing=!1;queue;plugin;canDispatch;constructor(e,t,n){this.queue=e,this.plugin=t,this.canDispatch=n}async flush(){this.flushing||!this.canFlushQueue||(this.flushing=!0,await this.flushQueue(),this.flushing=!1)}get canFlushQueue(){return this.queue.size>0&&kn()}async flushQueue(){const e=[];for(;this.canFlushQueue;){const t=await this.queue.shift();!t||t.attempts>Rs||this.canDispatch(t)&&await this.attempt(t)||e.push(t)}this.queue.push(...e)}async attempt(e){e.attempts+=1;const t=await ye(e,this.plugin);return await hr(As(250)),t instanceof J}}function Ns(r){if(r.event)return r.event;switch(r.type){case"page":return"web/page-viewed";default:throw new Error(`Unknown event type ${r.type}`)}}function js(r){switch(r.type){case"track":return U.Track;case"identify":return U.Identify;case"page":return U.Page;case"alias":return U.Alias;case"group":return U.Group;case"screen":return U.Screen;default:return U.Facade}}function Bs(r,e){const t=js(r),n=new t(r,e);return Object.defineProperty(n,"obj",{value:r,writable:!0}),n}const En="0.0.1",Ls="web-sdk";function Us(r,e,t){const n={"X-Bird-Write-Key":e.tracking.writeKey,"X-Bird-Sdk-Version":En,"X-Bird-Workspace-ID":e.workspaceId,"X-Bird-Event-Name":Ns(r.event)};return t&&bs(n,"X-Bird-Contact-ID",t),n}function Fs(r){switch(r.event.event){case"tracker/form-viewed":case"tracker/form-submitted":return r.updateEvent("properties",{platform:G(r.event,"context.userAgentData.platform"),trk_version:G(r.event,"context.library.version"),os_timezone:G(r.event,"context.timezone"),contact_id:G(r.event,"userId"),anonymous_id:G(r.event,"anonymousId"),browser_useragent:G(r.event,"context.userAgent"),url:G(r.event,"context.page.url"),page_title:G(r.event,"context.page.title"),referrer:G(r.event,"context.referrer.url"),form_step_id:G(r.event,"properties.stepId"),form_project_id:G(r.event,"properties.projectId"),form_version_id:G(r.event,"properties.versionId")}),r;default:return r}}const Cn="dummy-event";async function Ks(r){return(await r.track(Cn,{}))?.event?.context}function $s(r,e={}){return new Vs(r,e).plugin}let Vs=class{ctx;queueRegistry;flushScheduler;inflightEvents;constructor(e,t={}){this.ctx=e,this.inflightEvents=new Set,this.queueRegistry=new xs(e.namespace,this.conf.workspaceId,e.persister),this.flushScheduler=new Ms(this.plugin,this.queueRegistry,n=>!this.shouldQueueEvent(n),t.flushScheduler),this.init()}plugin={name:"Bird Tracker API",version:"0.0.1",type:"destination",load:dr,isLoaded:()=>!0,track:this.eventHandler.bind(this)};get conf(){return this.ctx.config}get contactId(){return this.ctx.contact.contactId}init(){this.flushScheduler.start(),window&&window.addEventListener("pagehide",()=>{Array.from(this.inflightEvents).forEach(e=>{this.queueRegistry.getQueue(e.event.event??e.event.type).push(e)}),this.inflightEvents.clear()})}isAnonymousEvent(e){return!!e.event.integrations?.Bird?.anonymousEvent}shouldQueueEvent(e){return An()?!0:!this.contactId&&!this.isAnonymousEvent(e)&&this.conf?.tracking?.anonymousTracking===Le.enqueue}dispatchEvent(e){this.inflightEvents.add(e);const t=Bs(Fs(e).event).json(),n=Us(e,this.conf,this.contactId);return lr(this.conf.tracking.endpoint,{headers:n,body:t,method:"POST"})}async eventHandler(e){if(this.shouldIgnoreEvent(e))return e;if(this.shouldQueueEvent(e))return this.getEventQueue(e).push(e),e;try{await this.dispatchEvent(e)}catch(t){this.ctx.logger.error(`Failed to dispatch event: ${t}`),await this.getEventQueue(e).pushWithBackoff(e)}finally{return this.inflightEvents.delete(e),e}}shouldIgnoreEvent(e){const t=!this.contactId;return this.conf.tracking.enabled===!1||e.event.integrations?.Bird?.enabled===!1||t&&!this.isAnonymousEvent(e)&&this.conf.tracking.anonymousTracking===Le.off?!0:e.event.event===Cn}getEventQueue(e){return this.queueRegistry.getQueue(e.event.event??e.event.type)}};function zs(r){return new qs(r).plugin}class qs{ctx;constructor(e){this.ctx=e}plugin={name:"Bird Tracker API",version:"0.0.1",type:"enrichment",load:dr,isLoaded:()=>!0,track:this.enrich.bind(this)};get anonymousId(){return this.ctx.contact.anonymousId}enrich(e){return e.updateEvent("anonymousId",this.anonymousId),e.updateEvent("messageId",e.event.messageId?.replace("ajs-next-","bird-tracker-")),e}}const Gs="/service-worker.js",Ws=/https:\/\/.*\/bird-push-sw\.js/,Qs="bird-sdk-push-notification";class Hs{contact;logger;eventTarget;connectorId;webVAPIDPublicKey;constructor(e,t,n){this.contact=e,this.logger=t,this.eventTarget=n}get registration(){return navigator.serviceWorker.ready}async init(e){if(e.conf?.enabled){if(!e.conf.connectorId||!e.conf.endpoint){this.logger.error("Push Notifications init failed: connectorId not defined in Application config");return}if(!e.conf.webVAPIDPublicKey){this.logger.error("Push Notifications init failed: VAPID key not defined in Application config");return}if(!("serviceWorker"in navigator)){this.logger.error("Push Notifications init failed: ServiceWorker not found in navigator");return}this.connectorId=e.conf.connectorId,this.webVAPIDPublicKey=e.conf.webVAPIDPublicKey;try{const t=e.conf.webServiceWorkerPath||Gs;await this.registerServiceWorker(t)}catch(t){this.logger.error(`Push Notifications service worker init failed: ${t}`);return}if(this.addPushInteractionsListeners(),this.sendToServiceWorker({type:"serviceWorkerInitConfig",endpoint:e.conf.endpoint,connectorId:e.conf.connectorId,automaticallyOpenDeepLinks:e.automaticallyOpenDeepLinks}),e.subscribeAutomatically)try{await this.subscribe()}catch(t){this.logger.error(`Push Notifications subscribe failed: ${t}`)}}}async subscribe(){if(!this.webVAPIDPublicKey)throw new Error("VAPID key is empty");if(!("serviceWorker"in navigator))throw new Error("push notification not supported in this browser");const e=await this.registration;if(!e?.pushManager)throw new Error("push manager init failed on service worker registration");const t=await Notification.requestPermission();if(t!=="granted")throw new Error(`push notifications permission is ${t||"empty"}`);const n=await e.pushManager.getSubscription();n&&await Promise.all([this.contact.deleteIdentifier({key:`push-${this.connectorId}`,value:`web:${this.getSubscriptionToken(n)}`}),n.unsubscribe()]);const a=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.webVAPIDPublicKey||""}),i=this.getSubscriptionToken(a);return await this.contact.identify({strategy:R.PushToken,connectorId:this.connectorId||"",deviceToken:i}),this.sendToServiceWorker({type:"subscriptionToken",subscriptionToken:i}),i}async registerServiceWorker(e){const t=await fetch(e);if(!t.ok)throw new Error(`service worker lib not found at ${e}`);const n=await t.text();if(!Ws.test(n))throw new Error(`not expected service worker script at ${e}`);const a=await navigator.serviceWorker.getRegistration();if(a){await a.update();return}await navigator.serviceWorker.register(e,{updateViaCache:"none"})}getSubscriptionToken(e){const t=e.toJSON();if(!t.endpoint)throw new Error("empty endpoint in subscription");if(!t.keys?.p256dh)throw new Error("empty p256dh in subscription");if(!t.keys?.auth)throw new Error("empty auth in subscription");const n=btoa(t.endpoint),a=btoa(t.keys.p256dh),i=btoa(t.keys.auth);return`${n}#${a}#${i}`}addPushInteractionsListeners(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(()=>{navigator.serviceWorker.addEventListener("message",e=>{const t=e.data;switch(t.type){case"notificationInteraction":const n={detail:{type:t.interactionType,action:t.action,payload:t.payload}};this.eventTarget.dispatchEvent(new CustomEvent(Qs,n));break}})})}sendToServiceWorker(e){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.active?.postMessage(e)})}}const Js=(r,e,t)=>!e?.length&&!r?.length?!0:(!r?.length||Tn(r,t))&&!Tn(e??[],t);function Tn(r,e){return r.some(t=>Xs(t).test(e))}const Ys=/[.+?^${}()|[\]\\]/g,Zs="\\$&";function Xs(r){return new RegExp(`^${r.replace(Ys,Zs).replace(/\*/g,".*")}$`)}const xn="project-id",On="workspace-id",eu={form:se.form,popup:se.popup,chat:se.chatwidget,"chat-embed":se.chatwidget};async function tu(r){if(!window||!document)return;const e=r.config;if(!e||!e.embeddablesConfig||!e.embeddablesConfig.enabled)return;const t=await r.api.fetch(async(i,{baseUrl:s})=>fetch(`${s}/workspaces/${i}/embeddables`).then(o=>o.json())),n=nu(t),a=()=>{if(!window.BirdComponentRegistry||!e||!e.embeddablesConfig)return;const i=r.namespace.toLowerCase(),{embeds:s=[]}=e.embeddablesConfig;Object.entries(window.BirdComponentRegistry).forEach(([u,c])=>{const d=eu[u];Mn(s).has(d)&&c(i,r)});const o=au(i,s);s.forEach(u=>{const c=n.get(u.projectId);if(!c)return;const l=su(u.type,c),d=Rn(e.workspaceId,u.projectId);if(!l||!iu(d,c,o))return;const f=document.createElement(Dn(i,l));f.setAttribute(xn,u.projectId),f.setAttribute(On,e.workspaceId),document.body.appendChild(f),o.add(d)})};(function(){const s=e?.embeddablesConfig?.embeds[0]?.assetUrl;if(!s)return;const o=document.createElement("script");o.id="bird-embeddables",o.src=s,o.defer=!0,o.type="module",o.onload=a,document.head.appendChild(o)})(),window.addEventListener("locationchange",function(){a()})}const ru=["popups","chatwidgets"];function nu(r){const e=new Map;return ru.forEach(t=>{r[t]&&Object.entries(r[t]).forEach(([n,a])=>{e.set(n,a)})}),e}function iu(r,e,t){return e.formType!=="embed"&&!t.has(r)&&Js(e.visiblePaths,e.excludedPaths,window.location.pathname)}function au(r,e){const t=new Set;return Mn(e).forEach(n=>{ou(Dn(r,n)).forEach(a=>{t.add(a)})}),t}function Mn(r){const e=new Set;return r.forEach(t=>{e.add(t.type)}),e}function ou(r){const e=new Set;return document.querySelectorAll(r).forEach(t=>{const n=t.getAttribute(On),a=t.getAttribute(xn);n&&a&&e.add(Rn(n,a))}),e}function su(r,e){switch(!0){case r===se.form:return"form";case r===se.popup:return"popup";case(r===se.chatwidget&&e.formType==="embed"):return"chat-embed";case r===se.chatwidget:return"chat";default:return null}}function Rn(r,e){return`${r}:${e}`}function Dn(r,e){return`${r}-${e}`}function Nn(r){return lr("/cart/update.json",{method:"POST",body:{attributes:{visitorId:r}}})}function jn(r,e){const t=r.context.document.location.origin;return{cart_id:e.token,total_price:e.total_price/100,total_quantity:e.item_count,currency:e.currency,product_ids:e.items.map(n=>String(n.id)),product_skus:e.items.map(n=>String(n.sku)),product_names:e.items.map(n=>n.title),checkout_url:`${t}/cart/c/${e.token}`,items:e.items.map(n=>({product_id:String(n.id),product_name:n.title,sku:String(n.sku),price:n.price/100,currency:e.currency,quantity:n.quantity,product_url:`${t}${n.url}`,product_image_url:n.featured_image.url}))}}function uu(r){const{email:e,phone:t}=r.properties.checkout;if(!e&&!t)throw new Error("Email or phone is required to identify a user");return{key:e?"emailaddress":"phonenumber",value:e??t}}class cu{mu;tracker;contact;persister;peekInterval;interval=null;constructor(e,t=2500){this.tracker=e.tracker,this.contact=e.contact,this.peekInterval=t,this.persister=e.persister,this.mu=new _n(H.PixelMutexLock,e.persister,{lockTimeout:50})}init(){this.handleEvents(),this.interval=setInterval(()=>{this.handleEvents()},this.peekInterval)}clear(){this.interval&&clearInterval(this.interval)}handleEvents(){this.mu.execute(async()=>{const e=this.persister.get(H.QueuedPixelEvents);e&&(this.flush(JSON.parse(e)),this.persister.remove(H.QueuedPixelEvents))})}async flush(e){e.forEach(t=>{this.dispatch(t).catch(n=>{console.error(`Error dispatching event ${t.name}`,n)})})}async dispatch(e){const{context:t}=e;switch(e.name){case"ecommerce/checkout-contact-info-submitted":this.contact.identify({strategy:"Visitor",identifier:uu(e)});break;case"web/page-viewed":this.tracker.web.pageViewed({title:t.document.title,url:t.document.location.href,path:t.document.location.pathname,search:t.document.location.search,referrer:t.document.referrer});break;case"ecommerce/cart-updated":this.tracker.ecommerce.cartUpdated(jn(e,await Nn(this.contact.anonymousId)));break;case"ecommerce/cart-viewed":this.tracker.ecommerce.cartViewed(jn(e,await Nn(this.contact.anonymousId)));break;case"ecommerce/product-viewed":const{product:n,sku:a,price:i,image:s}=e.properties.productVariant;this.tracker.ecommerce.productViewed({product_id:String(n.id),product_name:n.title,product_sku:a,price:i.amount,currency:i.currencyCode,product_url:`${t.document.location.origin}${n.url}`,product_image_url:s?.src?`${t.document.location.protocol}${s.src}`:void 0});break;default:throw new Error("Event not supported")}}}function lu(r={}){const{pollInterval:e,enablePixelEvents:t=!1}=r;return n=>{n.config&&t&&new cu(n,e).init()}}function du(r){!window||!document||r.config.tracking.trackPageViews&&r.tracker.web.pageViewed({title:document.title,url:window.location.href,search:window.location.search,path:window.location.pathname,referrer:document.referrer})}const fu={"Europe/Andorra":"AD","Asia/Dubai":"AE","Asia/Kabul":"AF","Europe/Tirane":"AL","Asia/Yerevan":"AM","Antarctica/Casey":"AQ","Antarctica/Davis":"AQ","Antarctica/Mawson":"AQ","Antarctica/Palmer":"AQ","Antarctica/Rothera":"AQ","Antarctica/Troll":"AQ","Antarctica/Vostok":"AQ","America/Argentina/Buenos_Aires":"AR","America/Argentina/Cordoba":"AR","America/Argentina/Salta":"AR","America/Argentina/Jujuy":"AR","America/Argentina/Tucuman":"AR","America/Argentina/Catamarca":"AR","America/Argentina/La_Rioja":"AR","America/Argentina/San_Juan":"AR","America/Argentina/Mendoza":"AR","America/Argentina/San_Luis":"AR","America/Argentina/Rio_Gallegos":"AR","America/Argentina/Ushuaia":"AR","Pacific/Pago_Pago":"AS","Europe/Vienna":"AT","Australia/Lord_Howe":"AU","Antarctica/Macquarie":"AU","Australia/Hobart":"AU","Australia/Melbourne":"AU","Australia/Sydney":"AU","Australia/Broken_Hill":"AU","Australia/Brisbane":"AU","Australia/Lindeman":"AU","Australia/Adelaide":"AU","Australia/Darwin":"AU","Australia/Perth":"AU","Australia/Eucla":"AU","Asia/Baku":"AZ","America/Barbados":"BB","Asia/Dhaka":"BD","Europe/Brussels":"BE","Europe/Sofia":"BG","Atlantic/Bermuda":"BM","America/La_Paz":"BO","America/Noronha":"BR","America/Belem":"BR","America/Fortaleza":"BR","America/Recife":"BR","America/Araguaina":"BR","America/Maceio":"BR","America/Bahia":"BR","America/Sao_Paulo":"BR","America/Campo_Grande":"BR","America/Cuiaba":"BR","America/Santarem":"BR","America/Porto_Velho":"BR","America/Boa_Vista":"BR","America/Manaus":"BR","America/Eirunepe":"BR","America/Rio_Branco":"BR","Asia/Thimphu":"BT","Europe/Minsk":"BY","America/Belize":"BZ","America/St_Johns":"CA","America/Halifax":"CA","America/Glace_Bay":"CA","America/Moncton":"CA","America/Goose_Bay":"CA","America/Toronto":"CA","America/Iqaluit":"CA","America/Winnipeg":"CA","America/Resolute":"CA","America/Rankin_Inlet":"CA","America/Regina":"CA","America/Swift_Current":"CA","America/Edmonton":"CA","America/Cambridge_Bay":"CA","America/Inuvik":"CA","America/Dawson_Creek":"CA","America/Fort_Nelson":"CA","America/Whitehorse":"CA","America/Dawson":"CA","America/Vancouver":"CA","Europe/Zurich":"CH","Africa/Abidjan":"CI","Pacific/Rarotonga":"CK","America/Santiago":"CL","America/Punta_Arenas":"CL","Pacific/Easter":"CL","Asia/Shanghai":"CN","Asia/Urumqi":"CN","America/Bogota":"CO","America/Costa_Rica":"CR","America/Havana":"CU","Atlantic/Cape_Verde":"CV","Asia/Nicosia":"CY","Asia/Famagusta":"CY","Europe/Prague":"CZ","Europe/Berlin":"DE","America/Santo_Domingo":"DO","Africa/Algiers":"DZ","America/Guayaquil":"EC","Pacific/Galapagos":"EC","Europe/Tallinn":"EE","Africa/Cairo":"EG","Africa/El_Aaiun":"EH","Europe/Madrid":"ES","Africa/Ceuta":"ES","Atlantic/Canary":"ES","Europe/Helsinki":"FI","Pacific/Fiji":"FJ","Atlantic/Stanley":"FK","Pacific/Kosrae":"FM","Atlantic/Faroe":"FO","Europe/Paris":"FR","Europe/London":"GB","Asia/Tbilisi":"GE","America/Cayenne":"GF","Europe/Gibraltar":"GI","America/Nuuk":"GL","America/Danmarkshavn":"GL","America/Scoresbysund":"GL","America/Thule":"GL","Europe/Athens":"GR","Atlantic/South_Georgia":"GS","America/Guatemala":"GT","Pacific/Guam":"GU","Africa/Bissau":"GW","America/Guyana":"GY","Asia/Hong_Kong":"HK","America/Tegucigalpa":"HN","America/Port-au-Prince":"HT","Europe/Budapest":"HU","Asia/Jakarta":"ID","Asia/Pontianak":"ID","Asia/Makassar":"ID","Asia/Jayapura":"ID","Europe/Dublin":"IE","Asia/Jerusalem":"IL","Asia/Kolkata":"IN","Indian/Chagos":"IO","Asia/Baghdad":"IQ","Asia/Tehran":"IR","Europe/Rome":"IT","America/Jamaica":"JM","Asia/Amman":"JO","Asia/Tokyo":"JP","Africa/Nairobi":"KE","Asia/Bishkek":"KG","Pacific/Tarawa":"KI","Pacific/Kanton":"KI","Pacific/Kiritimati":"KI","Asia/Pyongyang":"KP","Asia/Seoul":"KR","Asia/Almaty":"KZ","Asia/Qyzylorda":"KZ","Asia/Qostanay":"KZ","Asia/Aqtobe":"KZ","Asia/Aqtau":"KZ","Asia/Atyrau":"KZ","Asia/Oral":"KZ","Asia/Beirut":"LB","Asia/Colombo":"LK","Africa/Monrovia":"LR","Europe/Vilnius":"LT","Europe/Riga":"LV","Africa/Tripoli":"LY","Africa/Casablanca":"MA","Europe/Chisinau":"MD","Pacific/Kwajalein":"MH","Asia/Yangon":"MM","Asia/Ulaanbaatar":"MN","Asia/Hovd":"MN","Asia/Choibalsan":"MN","Asia/Macau":"MO","America/Martinique":"MQ","Europe/Malta":"MT","Indian/Mauritius":"MU","Indian/Maldives":"MV","America/Mexico_City":"MX","America/Cancun":"MX","America/Merida":"MX","America/Monterrey":"MX","America/Matamoros":"MX","America/Chihuahua":"MX","America/Ciudad_Juarez":"MX","America/Ojinaga":"MX","America/Mazatlan":"MX","America/Bahia_Banderas":"MX","America/Hermosillo":"MX","America/Tijuana":"MX","Asia/Kuching":"MY","Africa/Maputo":"MZ","Africa/Windhoek":"NA","Pacific/Noumea":"NC","Pacific/Norfolk":"NF","Africa/Lagos":"NG","America/Managua":"NI","Asia/Kathmandu":"NP","Pacific/Nauru":"NR","Pacific/Niue":"NU","Pacific/Auckland":"NZ","Pacific/Chatham":"NZ","America/Panama":"PA","America/Lima":"PE","Pacific/Tahiti":"PF","Pacific/Marquesas":"PF","Pacific/Gambier":"PF","Pacific/Port_Moresby":"PG","Pacific/Bougainville":"PG","Asia/Manila":"PH","Asia/Karachi":"PK","Europe/Warsaw":"PL","America/Miquelon":"PM","Pacific/Pitcairn":"PN","America/Puerto_Rico":"PR","Asia/Gaza":"PS","Asia/Hebron":"PS","Europe/Lisbon":"PT","Atlantic/Madeira":"PT","Atlantic/Azores":"PT","Pacific/Palau":"PW","America/Asuncion":"PY","Asia/Qatar":"QA","Europe/Bucharest":"RO","Europe/Belgrade":"RS","Europe/Kaliningrad":"RU","Europe/Moscow":"RU","Europe/Simferopol":"RU","Europe/Kirov":"RU","Europe/Volgograd":"RU","Europe/Astrakhan":"RU","Europe/Saratov":"RU","Europe/Ulyanovsk":"RU","Europe/Samara":"RU","Asia/Yekaterinburg":"RU","Asia/Omsk":"RU","Asia/Novosibirsk":"RU","Asia/Barnaul":"RU","Asia/Tomsk":"RU","Asia/Novokuznetsk":"RU","Asia/Krasnoyarsk":"RU","Asia/Irkutsk":"RU","Asia/Chita":"RU","Asia/Yakutsk":"RU","Asia/Khandyga":"RU","Asia/Vladivostok":"RU","Asia/Ust-Nera":"RU","Asia/Magadan":"RU","Asia/Sakhalin":"RU","Asia/Srednekolymsk":"RU","Asia/Kamchatka":"RU","Asia/Anadyr":"RU","Asia/Riyadh":"SA","Pacific/Guadalcanal":"SB","Africa/Khartoum":"SD","Asia/Singapore":"SG","America/Paramaribo":"SR","Africa/Juba":"SS","Africa/Sao_Tome":"ST","America/El_Salvador":"SV","Asia/Damascus":"SY","America/Grand_Turk":"TC","Africa/Ndjamena":"TD","Asia/Bangkok":"TH","Asia/Dushanbe":"TJ","Pacific/Fakaofo":"TK","Asia/Dili":"TL","Asia/Ashgabat":"TM","Africa/Tunis":"TN","Pacific/Tongatapu":"TO","Europe/Istanbul":"TR","Asia/Taipei":"TW","Europe/Kyiv":"UA","America/New_York":"US","America/Detroit":"US","America/Kentucky/Louisville":"US","America/Kentucky/Monticello":"US","America/Indiana/Indianapolis":"US","America/Indiana/Vincennes":"US","America/Indiana/Winamac":"US","America/Indiana/Marengo":"US","America/Indiana/Petersburg":"US","America/Indiana/Vevay":"US","America/Chicago":"US","America/Indiana/Tell_City":"US","America/Indiana/Knox":"US","America/Menominee":"US","America/North_Dakota/Center":"US","America/North_Dakota/New_Salem":"US","America/North_Dakota/Beulah":"US","America/Denver":"US","America/Boise":"US","America/Phoenix":"US","America/Los_Angeles":"US","America/Anchorage":"US","America/Juneau":"US","America/Sitka":"US","America/Metlakatla":"US","America/Yakutat":"US","America/Nome":"US","America/Adak":"US","Pacific/Honolulu":"US","America/Montevideo":"UY","Asia/Samarkand":"UZ","Asia/Tashkent":"UZ","America/Caracas":"VE","Asia/Ho_Chi_Minh":"VN","Pacific/Efate":"VU","Pacific/Apia":"WS","Africa/Johannesburg":"ZA","America/Antigua":"AG","America/Anguilla":"AI","Africa/Luanda":"AO","Antarctica/McMurdo":"AQ","Antarctica/DumontDUrville":"AQ","Antarctica/Syowa":"AQ","America/Aruba":"AW","Europe/Mariehamn":"AX","Europe/Sarajevo":"BA","Africa/Ouagadougou":"BF","Asia/Bahrain":"BH","Africa/Bujumbura":"BI","Africa/Porto-Novo":"BJ","America/St_Barthelemy":"BL","Asia/Brunei":"BN","America/Kralendijk":"BQ","America/Nassau":"BS","Africa/Gaborone":"BW","America/Blanc-Sablon":"CA","America/Atikokan":"CA","America/Creston":"CA","Indian/Cocos":"CC","Africa/Kinshasa":"CD","Africa/Lubumbashi":"CD","Africa/Bangui":"CF","Africa/Brazzaville":"CG","Africa/Douala":"CM","America/Curacao":"CW","Indian/Christmas":"CX","Europe/Busingen":"DE","Africa/Djibouti":"DJ","Europe/Copenhagen":"DK","America/Dominica":"DM","Africa/Asmara":"ER","Africa/Addis_Ababa":"ET","Pacific/Chuuk":"FM","Pacific/Pohnpei":"FM","Africa/Libreville":"GA","America/Grenada":"GD","Europe/Guernsey":"GG","Africa/Accra":"GH","Africa/Banjul":"GM","Africa/Conakry":"GN","America/Guadeloupe":"GP","Africa/Malabo":"GQ","Europe/Zagreb":"HR","Europe/Isle_of_Man":"IM","Atlantic/Reykjavik":"IS","Europe/Jersey":"JE","Asia/Phnom_Penh":"KH","Indian/Comoro":"KM","America/St_Kitts":"KN","Asia/Kuwait":"KW","America/Cayman":"KY","Asia/Vientiane":"LA","America/St_Lucia":"LC","Europe/Vaduz":"LI","Africa/Maseru":"LS","Europe/Luxembourg":"LU","Europe/Monaco":"MC","Europe/Podgorica":"ME","America/Marigot":"MF","Indian/Antananarivo":"MG","Pacific/Majuro":"MH","Europe/Skopje":"MK","Africa/Bamako":"ML","Pacific/Saipan":"MP","Africa/Nouakchott":"MR","America/Montserrat":"MS","Africa/Blantyre":"MW","Asia/Kuala_Lumpur":"MY","Africa/Niamey":"NE","Europe/Amsterdam":"NL","Europe/Oslo":"NO","Asia/Muscat":"OM","Indian/Reunion":"RE","Africa/Kigali":"RW","Indian/Mahe":"SC","Europe/Stockholm":"SE","Atlantic/St_Helena":"SH","Europe/Ljubljana":"SI","Arctic/Longyearbyen":"SJ","Europe/Bratislava":"SK","Africa/Freetown":"SL","Europe/San_Marino":"SM","Africa/Dakar":"SN","Africa/Mogadishu":"SO","America/Lower_Princes":"SX","Africa/Mbabane":"SZ","Indian/Kerguelen":"TF","Africa/Lome":"TG","America/Port_of_Spain":"TT","Pacific/Funafuti":"TV","Africa/Dar_es_Salaam":"TZ","Africa/Kampala":"UG","Pacific/Midway":"UM","Pacific/Wake":"UM","Europe/Vatican":"VA","America/St_Vincent":"VC","America/Tortola":"VG","America/St_Thomas":"VI","Pacific/Wallis":"WF","Asia/Aden":"YE","Indian/Mayotte":"YT","Africa/Lusaka":"ZM","Africa/Harare":"ZW"};function hu(r,e){const t=new pu(r);e.addEventListener(bn,t.onContactIdentify.bind(t))}class pu{ctx;constructor(e){this.ctx=e}async onContactIdentify(e){if(!this.ctx||!(e instanceof ht))return;const t=[],n=await this.getBasicAttributes(e.contactAttributes);e.visitorId&&t.push(this.ctx.api.updateCurrentContactIdentifierProperties({identifierKey:"visitorid",identifierValue:e.visitorId,properties:await this.getVisitorIdentifierProperties(n)}));for(const a of e.claims){let i,s;const{strategy:o}=a;switch(o){case R.Visitor:continue;case R.PushToken:if(!a.connectorId||!a.deviceToken)continue;i=`push-${a.connectorId}`,s=`web:${a.deviceToken}`;break;case R.Chat:case R.SignedIdentityClaims:case R.OTP:continue}i&&s&&t.push(this.ctx.api.updateCurrentContactIdentifierProperties({identifierKey:i,identifierValue:s,properties:await this.getVisitorIdentifierProperties(n)}))}await Promise.all(t)}async getBasicAttributes(e){const t=await this.getPageContext(),n={};if(e&&pr(e,"timezone")?n.timezone=e.timezone:t?.timezone&&(n.timezone=t.timezone),e&&pr(e,"locales")?n.locales=e.locales:t?.locale&&(n.locales=[t.locale]),e&&pr(e,"country"))n.country=e.country;else if(t?.timezone){const a=fu[t.timezone];a&&(n.country=a)}return n}async getVisitorIdentifierProperties(e){const n={context:await this.getPageContext(),sdk:Ls,sdkVersion:En};return e?.country&&(n.countryCode=e.country),n}async getPageContext(){const e=this.ctx?.tracker.analyticsBrowser.instance;if(e)return Ks(e)}}class vu{ctx;eventTarget;status="idle";plugins=[du,tu,hu];constructor(e,t){this.ctx=e,this.eventTarget=t}init(e){const{plugins:t=[]}=e;this.register(...t,lu(e.shopify)),this.plugins.forEach(n=>{n(this.ctx,this.eventTarget)}),this.status="initialized"}register(...e){this.plugins.push(...e),this.status==="initialized"&&e.forEach(t=>{t(this.ctx,this.eventTarget)})}}const Bn={initializing:"Bird SDK is already initializing",initialized:"Bird SDK is already initialized",idle:"Bird SDK has not been initialized yet and using it in this state can lead to unexpected behavior. You need to call 'init' method before using the SDK.",error:"Bird SDK has errored when initializing and using it in this state can lead to unexpected behavior. Try reinitializing it by calling 'init' method."};var Ln={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function a(u,c,l){this.fn=u,this.context=c,this.once=l||!1}function i(u,c,l,d,f){if(typeof l!="function")throw new TypeError("The listener must be a function");var h=new a(l,d||u,f),v=t?t+c:c;return u._events[v]?u._events[v].fn?u._events[v]=[u._events[v],h]:u._events[v].push(h):(u._events[v]=h,u._eventsCount++),u}function s(u,c){--u._eventsCount===0?u._events=new n:delete u._events[c]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],l,d;if(this._eventsCount===0)return c;for(d in l=this._events)e.call(l,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},o.prototype.listeners=function(c){var l=t?t+c:c,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,v=new Array(h);f<h;f++)v[f]=d[f].fn;return v},o.prototype.listenerCount=function(c){var l=t?t+c:c,d=this._events[l];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,l,d,f,h,v){var m=t?t+c:c;if(!this._events[m])return!1;var p=this._events[m],y=arguments.length,g,w;if(p.fn){switch(p.once&&this.removeListener(c,p.fn,void 0,!0),y){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,l),!0;case 3:return p.fn.call(p.context,l,d),!0;case 4:return p.fn.call(p.context,l,d,f),!0;case 5:return p.fn.call(p.context,l,d,f,h),!0;case 6:return p.fn.call(p.context,l,d,f,h,v),!0}for(w=1,g=new Array(y-1);w<y;w++)g[w-1]=arguments[w];p.fn.apply(p.context,g)}else{var k=p.length,A;for(w=0;w<k;w++)switch(p[w].once&&this.removeListener(c,p[w].fn,void 0,!0),y){case 1:p[w].fn.call(p[w].context);break;case 2:p[w].fn.call(p[w].context,l);break;case 3:p[w].fn.call(p[w].context,l,d);break;case 4:p[w].fn.call(p[w].context,l,d,f);break;default:if(!g)for(A=1,g=new Array(y-1);A<y;A++)g[A-1]=arguments[A];p[w].fn.apply(p[w].context,g)}}return!0},o.prototype.on=function(c,l,d){return i(this,c,l,d,!1)},o.prototype.once=function(c,l,d){return i(this,c,l,d,!0)},o.prototype.removeListener=function(c,l,d,f){var h=t?t+c:c;if(!this._events[h])return this;if(!l)return s(this,h),this;var v=this._events[h];if(v.fn)v.fn===l&&(!f||v.once)&&(!d||v.context===d)&&s(this,h);else{for(var m=0,p=[],y=v.length;m<y;m++)(v[m].fn!==l||f&&!v[m].once||d&&v[m].context!==d)&&p.push(v[m]);p.length?this._events[h]=p.length===1?p[0]:p:s(this,h)}return this},o.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&s(this,l)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o})(Ln);var yu=Ln.exports;const mu=Lt(yu),gu="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let bu=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=gu[t[r]&63];return e};var wu=Be;function Be(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Be.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0},Be.prototype.reset=function(){this.attempts=0},Be.prototype.setMin=function(r){this.ms=r},Be.prototype.setMax=function(r){this.max=r},Be.prototype.setJitter=function(r){this.jitter=r};const ku=Lt(wu);var Au=Object.defineProperty,_u=(r,e,t)=>e in r?Au(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,D=(r,e,t)=>_u(r,typeof e!="symbol"?e+"":e,t);const Su=async(r,e,t)=>r({adapter:["xhr","http"],url:"/me/access-token",method:"post",data:e,signal:t}).then(({data:n})=>n),Iu=["conversation","notification","message","participant","feed_item","user_feed","feed","activity","conference","agent","channel_contact_event"];function Pu(r){return Iu.some(e=>r.startsWith(e))}function Eu(r){return Pu(r.event)?r:null}const Cu=1e3,Tu={attempts:1/0,minInterval:1e3,maxInterval:1e4};class xu{constructor(e){D(this,"url"),D(this,"subProtocols"),D(this,"isCloseRequested",!1),D(this,"onMessage"),D(this,"onStatusChange"),D(this,"onTokenInvalid"),D(this,"authToken",null),D(this,"uris"),D(this,"reconnectionAttempts"),D(this,"backoff"),D(this,"reconnectTimeout"),D(this,"socket",null),this.url=e.url,this.subProtocols=e.subprotocols;const t=Object.assign({},Tu,e.reconnectOptions);this.reconnectionAttempts=t.attempts,this.backoff=new ku({min:t.minInterval,max:t.maxInterval,jitter:.5}),this.onMessage=e.onMessage,this.onStatusChange=e.onStatusChange,this.onTokenInvalid=e.onTokenInvalid}open(){var e,t;this.isCloseRequested=!1,!(((e=this.socket)==null?void 0:e.readyState)===WebSocket.OPEN||((t=this.socket)==null?void 0:t.readyState)===WebSocket.CONNECTING)&&(this.socket=new WebSocket(this.url,this.subProtocols),this.emitReadyState(),this.socket.onopen=this.onSocketOpen.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onerror=()=>this.emitReadyState(),this.socket.onmessage=n=>{const a=JSON.parse(n.data);a.type==="ack"&&this.backoff.reset(),this.onMessage(a)})}doCloseSocket(){this.socket&&(this.socket.readyState===WebSocket.OPEN&&this.socket.close(Cu),this.socket.onopen=null,this.socket.onclose=null,this.socket.onmessage=null,this.socket=null)}closeSocket(){this.isCloseRequested=!0,this.socket!=null&&this.socket.readyState===WebSocket.OPEN&&(this.doCloseSocket(),clearTimeout(this.reconnectTimeout)),this.emitReadyState()}setAuthToken(e,t){this.authToken=e,this.uris=t,this.write({type:"auth",args:{token:e,uris:t}})}get status(){var e;let t="closed";switch((e=this.socket)==null?void 0:e.readyState){case WebSocket.OPEN:t="open";break;case WebSocket.CLOSED:case WebSocket.CLOSING:t="closed";break;case WebSocket.CONNECTING:{t="opening";break}}return t}write(e){var t;this.status==="open"&&((t=this.socket)==null||t.send(JSON.stringify(e)))}async onClose(e){if(this.socket){if(this.emitReadyState(),e.reason==="invalid access token"){this.onTokenInvalid();return}this.reconnect()}}emitReadyState(){this.onStatusChange(this.status)}reconnect(){if(this.backoff.attempts>=this.reconnectionAttempts){this.emitReadyState();return}else{const e=this.backoff.duration();this.reconnectTimeout=window.setTimeout(()=>{this.open()},e)}}onSocketOpen(){if(this.isCloseRequested){this.doCloseSocket();return}this.emitReadyState(),this.authToken&&this.write({type:"auth",args:{token:this.authToken,uris:this.uris}})}}const Ou=(r,e)=>{const t=new Set,n=[];for(const a of r){const i=e(a);t.has(i)||(t.add(i),n.push(a))}return n},Mu="notifications.nest.messagebird.one";class Ru{constructor(e){D(this,"emitter",new mu),D(this,"subscribedResources",new Map),D(this,"accessTokenConfig"),D(this,"audience"),D(this,"expirationDuration"),D(this,"socket"),D(this,"abortController",null),D(this,"onError"),D(this,"debouncedFlush"),D(this,"maxBufferSize"),D(this,"eventsBuffer",[]),D(this,"handleSocketMessage",n=>{var a,i;switch(n.type){case"event":const s=Eu(n.args);s?this.eventsBuffer.push(s):(i=this.onError)==null||i.call(this,new Error(`notifications-client: unknown event type: ${(a=n.args)==null?void 0:a.event}`)),this.eventsBuffer.length>=this.maxBufferSize?this.flushEvents():(this.debouncedFlush.cancel(),this.debouncedFlush());break}}),D(this,"handleSubscriptionsChanged",cr(async()=>{var n;if(this.subscribedResources.size===0){this.socket.closeSocket();return}this.socket.open();try{const{token:a}=await this.fetchAccessToken();let i;this.accessTokenConfig.method==="token"&&(i=this.accessTokenConfig.uris),i?this.socket.setAuthToken(a,i):this.socket.setAuthToken(a)}catch(a){if((n=this.abortController)!=null&&n.signal.aborted)return;this.socket.closeSocket(),this.emitter.emit("connect_error",a)}},0)),this.accessTokenConfig=e.accessTokenConfig,e.debugUrlInternal&&console.warn("Using internal debugging URL in notifications client"),this.socket=new xu({url:e.debugUrlInternal??e.url,subprotocols:[Mu],onTokenInvalid:this.handleSubscriptionsChanged,onMessage:this.handleSocketMessage,onStatusChange:()=>{this.emitter.emit("client_status",this.status)},reconnectOptions:e.reconnectOptions});const t=new URL(e.url);this.audience=`${t.protocol}//${t.hostname}`,this.expirationDuration=e.expirationDuration??60,this.debouncedFlush=cr(()=>{this.flushEvents()},e.debounceEventsMs),this.maxBufferSize=e.maxBufferSize,this.onError=e.onError}listenEvents(e){return this.emitter.addListener("events",e),()=>{this.emitter.removeListener("events",e)}}subscribeToResources(e){const t=e.map(a=>{const i=bu();return this.subscribedResources.set(i,a),()=>{this.subscribedResources.delete(i)}}),n=()=>{var a;(a=this.abortController)==null||a.abort(),this.handleSubscriptionsChanged.cancel(),this.handleSubscriptionsChanged()};return n(),()=>{t.forEach(a=>a()),n()}}sendEvent(e){this.socket.write(e)}flushEvents(){this.eventsBuffer.length>0&&(this.emitter.emit("events",this.eventsBuffer),this.eventsBuffer=[])}fetchAccessToken(){this.abortController=new AbortController;const e=Ou(Array.from(this.subscribedResources.values()),n=>n),t={audience:this.audience,expiration:this.expirationDuration,operations:e.map(n=>({method:"GET",uri:n}))};switch(this.accessTokenConfig.method){case"axios":return Su(this.accessTokenConfig.axiosInstance,t,this.abortController.signal);case"callback":return this.accessTokenConfig.generateAccessToken({accountsAccessTokenRequestBody:t,signal:this.abortController.signal});case"token":return Promise.resolve({token:this.accessTokenConfig.token})}}addEventListener(e,t){return this.emitter.on(e,t),()=>this.emitter.off(e,t)}get status(){return this.socket.status==="closed"&&this.subscribedResources.size>0?"error":this.socket.status}}class Du{logger;identityStore;resources=new Set;client=null;eventListeners=[];constructor(e,t){this.logger=e,this.identityStore=t}init(e,t){const n=this.identityStore.getProp("accessToken");if(!n){this.logger.error("No access token found");return}for(const a of e)this.resources.add(a);this.client=new Ru({url:t,debounceEventsMs:300,maxBufferSize:10,onError:a=>this.logger.error(a.message),accessTokenConfig:{method:"token",token:n,uris:[...this.resources]},reconnectOptions:{minInterval:3e4,maxInterval:6e4}}),this.eventListeners.push(this.client.subscribeToResources(e))}addEventListener=(e,t)=>this.client?.addEventListener(e,t)??dr;listen(e){if(!this.client){this.logger.error("Notifications client not initialized");return}const t=a=>{for(let i of a)e(i)},n=this.client?.listenEvents(t);this.eventListeners.push(n)}cleanUp(){this.eventListeners.forEach(e=>e()),this.resources.clear(),this.client=null}}class Nu{api;plugin;logger;tracker;contact;persister;notifications;pushNotifications;namespace="Bird";_status="idle";_config={apiEndpoint:"",workspaceId:"",tracking:{writeKey:"",enabled:!0,endpoint:""},allowedDomains:null};eventTarget;constructor({api:e,logger:t,contact:n,persister:a,analyticsBrowser:i,notifications:s,eventTarget:o,pushManager:u}){return this.api=e,this.logger=t,this.contact=n,this.persister=a,this.notifications=s,this.pushNotifications=u,this.eventTarget=o,this.tracker=new ns(i),this.plugin=new vu(this.self,o),new Proxy(this,{get(c,l,d){return(c.status==="error"||c.status==="idle")&&(l==="tracker"||l==="contact"||l==="api")&&console.warn(Bn[c.status]),Reflect.get(c,l,d)}})}self=this;get config(){return this._config}set config(e){this._config=e}get status(){return this._status}set status(e){this._status=e}async init(e){if(this.shouldInit){this.status="initializing";try{e.namespace&&(this.namespace=e.namespace),await this.loadConfig(e.config),this.initApi(),await this.initContact(e),this.plugin.init(e),this.loadSegmentPlugins(this.tracker.analyticsBrowser),await this.pushNotifications.init({conf:this.config.pushNotifications,subscribeAutomatically:!1,automaticallyOpenDeepLinks:!1}),this.status="initialized",this.logger.info("Bird SDK initialized"),this.eventTarget.dispatchEvent(new Event("bird-sdk-initialized"))}catch(t){this.status="error",this.logger.error(`Failed to load Bird SDK: ${t}`)}}}get shouldInit(){return this.status==="initializing"||this.status==="initialized"?(this.logger.warn(Bn[this.status]),!1):hs()?(this.logger.warn("Bird SDK not initialized for bots"),!1):!0}async loadConfig(e){const t=await Hn(e);return this.config=dt(this.config,t??{}),this.config}initApi(){this.api.init({baseUrl:this.config.apiEndpoint,workspaceId:this.config.workspaceId})}async initContact(e){await this.contact.init(this.namespace,{conf:this.config,signedIdentity:e.signedIdentity??fs()})}loadSegmentPlugins(e){const t={integrations:{"Segment.io":!1},useQueryString:!0},n={writeKey:this.config.tracking.writeKey,cdnSettings:{integrations:{}},plugins:[zs,$s].map(a=>a(this.self))};return e.load(n,t)}}function ju(r={}){const e=r.persister??new as,t=r.identityStore??new Ss(e,new is),n=r.logger??new ds,a=window,i=new zo(t),s=new cs(i,t,a),o=new Lo,u=new Hs(s,n,a),c=new Du(n,t);return new Nu({api:i,logger:n,contact:s,persister:e,analyticsBrowser:o,notifications:c,eventTarget:a,pushManager:u})}async function Un(){const{config:r,signedIdentity:e,namespace:t="Bird"}=Bu();if(!window||window[t])return;const n=ju();if(window[t]=n,window.birdAsyncInit)window.birdAsyncInit(n,r?await wr(r):void 0);else{if(!r)throw new Error("data-config-url attribute is required");await window[t].init({config:r,namespace:t,signedIdentity:e})}}function Bu(){if(!document||!document.currentScript)throw new Error("document.currentScript is not available");const e=document.currentScript.attributes,t=e.getNamedItem("data-config-url"),n=e.getNamedItem("data-namespace");return{config:t?.value,namespace:n?.value,signedIdentity:e.getNamedItem("data-signed-identity")?.value}}Un();function Lu(r){var e=r;return!!(e.ctrlKey||e.shiftKey||e.metaKey||e.button&&e.button==1)}function Uu(r,e){return!!(r.target==="_blank"&&e)}function Fu(r,e,t,n){var a=this,i=[];return r?(r instanceof Element?i=[r]:"toArray"in r?i=r.toArray():i=r,i.forEach(function(s){s.addEventListener("click",function(o){var u,c,l=e instanceof Function?e(s):e,d=t instanceof Function?t(s):t,f=s.getAttribute("href")||s.getAttributeNS("http://www.w3.org/1999/xlink","href")||s.getAttribute("xlink:href")||((u=s.getElementsByTagName("a")[0])===null||u===void 0?void 0:u.getAttribute("href")),h=_t(a.track(l,d,n??{}),(c=a.settings.timeout)!==null&&c!==void 0?c:500);!Uu(s,f)&&!Lu(o)&&f&&(o.preventDefault?o.preventDefault():o.returnValue=!1,h.catch(console.error).then(function(){window.location.href=f}).catch(console.error))},!1)}),this):this}function Ku(r,e,t,n){var a=this;if(!r)return this;r instanceof HTMLFormElement&&(r=[r]);var i=r;return i.forEach(function(s){if(!(s instanceof Element))throw new TypeError("Must pass HTMLElement to trackForm/trackSubmit.");var o=function(c){var l;c.preventDefault?c.preventDefault():c.returnValue=!1;var d=e instanceof Function?e(s):e,f=t instanceof Function?t(s):t,h=_t(a.track(d,f,n??{}),(l=a.settings.timeout)!==null&&l!==void 0?l:500);h.catch(console.error).then(function(){s.submit()}).catch(console.error)},u=window.jQuery||window.Zepto;u?u(s).submit(o):s.addEventListener("submit",o,!1)}),this}const pt=Object.freeze(Object.defineProperty({__proto__:null,form:Ku,link:Fu},Symbol.toStringTag,{value:"Module"}));function Fn(r,e){return Object.keys(e).reduce(function(t,n){if(n.startsWith(r)){var a=n.substr(r.length);t[a]=e[n]}return t},{})}function $u(r,e){var t=document.createElement("a");t.href=e;var n=t.search.slice(1),a=n.split("&").reduce(function(w,k){var A=k.split("="),I=A[0],E=A[1];return w[I]=fn(E),w},{}),i=[],s=a.ajs_uid,o=a.ajs_event,u=a.ajs_aid,c=V(r.options.useQueryString)?r.options.useQueryString:{},l=c.aid,d=l===void 0?/.+/:l,f=c.uid,h=f===void 0?/.+/:f;if(u){var v=Array.isArray(a.ajs_aid)?a.ajs_aid[0]:a.ajs_aid;d.test(v)&&r.setAnonymousId(v)}if(s){var m=Array.isArray(a.ajs_uid)?a.ajs_uid[0]:a.ajs_uid;if(h.test(m)){var p=Fn("ajs_trait_",a);i.push(r.identify(m,p))}}if(o){var y=Array.isArray(a.ajs_event)?a.ajs_event[0]:a.ajs_event,g=Fn("ajs_prop_",a);i.push(r.track(y,g))}return Promise.all(i)}const Vu=Object.freeze(Object.defineProperty({__proto__:null,queryString:$u},Symbol.toStringTag,{value:"Module"}));var Kn={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(self,function(){return function(){var t={2870:function(i,s,o){var u=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(s,"__esModule",{value:!0}),s.Store=s.matches=s.transform=void 0;var c=o(4303);Object.defineProperty(s,"transform",{enumerable:!0,get:function(){return u(c).default}});var l=o(2370);Object.defineProperty(s,"matches",{enumerable:!0,get:function(){return u(l).default}});var d=o(1444);Object.defineProperty(s,"Store",{enumerable:!0,get:function(){return u(d).default}})},2370:function(i,s,o){var u=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(s,"__esModule",{value:!0});var c=u(o(7843));function l(p,y){if(!Array.isArray(p))return d(p,y)===!0;var g,w,k,A,I=p[0];switch(I){case"!":return!l(p[1],y);case"or":for(var E=1;E<p.length;E++)if(l(p[E],y))return!0;return!1;case"and":for(E=1;E<p.length;E++)if(!l(p[E],y))return!1;return!0;case"=":case"!=":return function(C,P,x,M){switch(f(C)&&(C=l(C,M)),f(P)&&(P=l(P,M)),typeof C=="object"&&typeof P=="object"&&(C=JSON.stringify(C),P=JSON.stringify(P)),x){case"=":return C===P;case"!=":return C!==P;default:throw new Error("Invalid operator in compareItems: ".concat(x))}}(d(p[1],y),d(p[2],y),I,y);case"<=":case"<":case">":case">=":return function(C,P,x,M){if(f(C)&&(C=l(C,M)),f(P)&&(P=l(P,M)),typeof C!="number"||typeof P!="number")return!1;switch(x){case"<=":return C<=P;case">=":return C>=P;case"<":return C<P;case">":return C>P;default:throw new Error("Invalid operator in compareNumbers: ".concat(x))}}(d(p[1],y),d(p[2],y),I,y);case"in":return function(C,P,x){return P.find(function(M){return d(M,x)===C})!==void 0}(d(p[1],y),d(p[2],y),y);case"contains":return k=d(p[1],y),A=d(p[2],y),typeof k=="string"&&typeof A=="string"&&k.indexOf(A)!==-1;case"match":return g=d(p[1],y),w=d(p[2],y),typeof g=="string"&&typeof w=="string"&&function(C,P){var x,M;e:for(;C.length>0;){var K,X;if(K=(x=h(C)).star,X=x.chunk,C=x.pattern,K&&X==="")return!0;var ie=v(X,P),Se=ie.t,mr=ie.ok,gr=ie.err;if(gr)return!1;if(!mr||!(Se.length===0||C.length>0)){if(K)for(var br=0;br<P.length;br++){if(Se=(M=v(X,P.slice(br+1))).t,mr=M.ok,gr=M.err,mr){if(C.length===0&&Se.length>0)continue;P=Se;continue e}if(gr)return!1}return!1}P=Se}return P.length===0}(w,g);case"lowercase":var T=d(p[1],y);return typeof T!="string"?null:T.toLowerCase();case"typeof":return typeof d(p[1],y);case"length":return function(C){return C===null?0:Array.isArray(C)||typeof C=="string"?C.length:NaN}(d(p[1],y));default:throw new Error("FQL IR could not evaluate for token: ".concat(I))}}function d(p,y){return Array.isArray(p)?p:typeof p=="object"?p.value:(0,c.default)(y,p)}function f(p){return!!Array.isArray(p)&&((p[0]==="lowercase"||p[0]==="length"||p[0]==="typeof")&&p.length===2||(p[0]==="contains"||p[0]==="match")&&p.length===3)}function h(p){for(var y={star:!1,chunk:"",pattern:""};p.length>0&&p[0]==="*";)p=p.slice(1),y.star=!0;var g,w=!1;e:for(g=0;g<p.length;g++)switch(p[g]){case"\\":g+1<p.length&&g++;break;case"[":w=!0;break;case"]":w=!1;break;case"*":if(!w)break e}return y.chunk=p.slice(0,g),y.pattern=p.slice(g),y}function v(p,y){for(var g,w,k={t:"",ok:!1,err:!1};p.length>0;){if(y.length===0)return k;switch(p[0]){case"[":var A=y[0];y=y.slice(1);var I=!0;(p=p.slice(1)).length>0&&p[0]==="^"&&(I=!1,p=p.slice(1));for(var E=!1,T=0;;){if(p.length>0&&p[0]==="]"&&T>0){p=p.slice(1);break}var C,P="";if(C=(g=m(p)).char,p=g.newChunk,g.err||(P=C,p[0]==="-"&&(P=(w=m(p.slice(1))).char,p=w.newChunk,w.err)))return k;C<=A&&A<=P&&(E=!0),T++}if(E!==I)return k;break;case"?":y=y.slice(1),p=p.slice(1);break;case"\\":if((p=p.slice(1)).length===0)return k.err=!0,k;default:if(p[0]!==y[0])return k;y=y.slice(1),p=p.slice(1)}}return k.t=y,k.ok=!0,k.err=!1,k}function m(p){var y={char:"",newChunk:"",err:!1};return p.length===0||p[0]==="-"||p[0]==="]"||p[0]==="\\"&&(p=p.slice(1)).length===0?(y.err=!0,y):(y.char=p[0],y.newChunk=p.slice(1),y.newChunk.length===0&&(y.err=!0),y)}s.default=function(p,y){if(!y)throw new Error("No matcher supplied!");switch(y.type){case"all":return!0;case"fql":return function(g,w){if(!g)return!1;try{g=JSON.parse(g)}catch(A){throw new Error('Failed to JSON.parse FQL intermediate representation "'.concat(g,'": ').concat(A))}var k=l(g,w);return typeof k=="boolean"&&k}(y.ir,p);default:throw new Error("Matcher of type ".concat(y.type," unsupported."))}}},1444:function(i,s){Object.defineProperty(s,"__esModule",{value:!0});var o=function(){function u(c){this.rules=[],this.rules=c||[]}return u.prototype.getRulesByDestinationName=function(c){for(var l=[],d=0,f=this.rules;d<f.length;d++){var h=f[d];h.destinationName!==c&&h.destinationName!==void 0||l.push(h)}return l},u}();s.default=o},4303:function(i,s,o){var u=this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(s,"__esModule",{value:!0});var c=u(o(374)),l=u(o(7843)),d=u(o(5500)),f=o(9014),h=o(4966);function v(k,A){p(k,A.drop,function(I,E){E.forEach(function(T){return delete I[T]})})}function m(k,A){p(k,A.allow,function(I,E){Object.keys(I).forEach(function(T){E.includes(T)||delete I[T]})})}function p(k,A,I){Object.entries(A).forEach(function(E){var T=E[0],C=E[1],P=function(M){typeof M=="object"&&M!==null&&I(M,C)},x=T===""?k:(0,l.default)(k,T);Array.isArray(x)?x.forEach(P):P(x)})}function y(k,A){var I=JSON.parse(JSON.stringify(k));for(var E in A.map)if(A.map.hasOwnProperty(E)){var T=A.map[E],C=E.split("."),P=void 0;if(C.length>1?(C.pop(),P=(0,l.default)(I,C.join("."))):P=k,typeof P=="object"){if(T.copy){var x=(0,l.default)(I,T.copy);x!==void 0&&(0,f.dset)(k,E,x)}else if(T.move){var M=(0,l.default)(I,T.move);M!==void 0&&(0,f.dset)(k,E,M),(0,h.unset)(k,T.move)}else T.hasOwnProperty("set")&&(0,f.dset)(k,E,T.set);if(T.to_string){var K=(0,l.default)(k,E);if(typeof K=="string"||typeof K=="object"&&K!==null)continue;K!==void 0?(0,f.dset)(k,E,JSON.stringify(K)):(0,f.dset)(k,E,"undefined")}}}}function g(k,A){return!(A.sample.percent<=0)&&(A.sample.percent>=1||(A.sample.path?function(E,T){var C=(0,l.default)(E,T.sample.path),P=(0,c.default)(JSON.stringify(C)),x=-64,M=[];w(P.slice(0,8),M);for(var K=0,X=0;X<64&&M[X]!==1;X++)K++;if(K!==0){var ie=[];w(P.slice(9,16),ie),x-=K,M.splice(0,K),ie.splice(64-K),M=M.concat(ie)}return M[63]=M[63]===0?1:0,(0,d.default)(parseInt(M.join(""),2),x)<T.sample.percent}(k,A):(I=A.sample.percent,Math.random()<=I)));var I}function w(k,A){for(var I=0;I<8;I++)for(var E=k[I],T=128;T>=1;T/=2)E-T>=0?(E-=T,A.push(1)):A.push(0)}s.default=function(k,A){for(var I=k,E=0,T=A;E<T.length;E++){var C=T[E];switch(C.type){case"drop":return null;case"drop_properties":v(I,C.config);break;case"allow_properties":m(I,C.config);break;case"sample_event":if(g(I,C.config))break;return null;case"map_properties":y(I,C.config);break;case"hash_properties":break;default:throw new Error('Transformer of type "'.concat(C.type,'" is unsupported.'))}}return I}},4966:function(i,s,o){var u=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(s,"__esModule",{value:!0}),s.unset=void 0;var c=u(o(7843));s.unset=function(l,d){if((0,c.default)(l,d)){for(var f=d.split("."),h=f.pop();f.length&&f[f.length-1].slice(-1)==="\\";)h=f.pop().slice(0,-1)+"."+h;for(;f.length;)l=l[d=f.shift()];return delete l[h]}return!0}},9014:function(i,s){s.dset=function(o,u,c){u.split&&(u=u.split("."));for(var l,d,f=0,h=u.length,v=o;f<h&&(d=u[f++])!=="__proto__"&&d!=="constructor"&&d!=="prototype";)v=v[d]=f===h?c:typeof(l=v[d])==typeof u?l:0*u[f]!=0||~(""+u[f]).indexOf(".")?{}:[]}},3304:function(i){var s=typeof Float64Array=="function"?Float64Array:void 0;i.exports=s},7382:function(i,s,o){var u,c=o(5569),l=o(3304),d=o(8482);u=c()?l:d,i.exports=u},8482:function(i){i.exports=function(){throw new Error("not implemented")}},6322:function(i,s,o){var u,c=o(2508),l=o(5679),d=o(882);u=c()?l:d,i.exports=u},882:function(i){i.exports=function(){throw new Error("not implemented")}},5679:function(i){var s=typeof Uint16Array=="function"?Uint16Array:void 0;i.exports=s},4773:function(i,s,o){var u,c=o(9773),l=o(3004),d=o(3078);u=c()?l:d,i.exports=u},3078:function(i){i.exports=function(){throw new Error("not implemented")}},3004:function(i){var s=typeof Uint32Array=="function"?Uint32Array:void 0;i.exports=s},7980:function(i,s,o){var u,c=o(8114),l=o(6737),d=o(3357);u=c()?l:d,i.exports=u},3357:function(i){i.exports=function(){throw new Error("not implemented")}},6737:function(i){var s=typeof Uint8Array=="function"?Uint8Array:void 0;i.exports=s},2684:function(i){var s=typeof Float64Array=="function"?Float64Array:null;i.exports=s},5569:function(i,s,o){var u=o(3876);i.exports=u},3876:function(i,s,o){var u=o(1448),c=o(2684);i.exports=function(){var l,d;if(typeof c!="function")return!1;try{d=new c([1,3.14,-3.14,NaN]),l=u(d)&&d[0]===1&&d[1]===3.14&&d[2]===-3.14&&d[3]!=d[3]}catch{l=!1}return l}},9048:function(i,s,o){var u=o(3763);i.exports=u},3763:function(i){var s=Object.prototype.hasOwnProperty;i.exports=function(o,u){return o!=null&&s.call(o,u)}},7009:function(i,s,o){var u=o(6784);i.exports=u},6784:function(i){i.exports=function(){return typeof Symbol=="function"&&typeof Symbol("foo")=="symbol"}},3123:function(i,s,o){var u=o(8481);i.exports=u},8481:function(i,s,o){var u=o(7009)();i.exports=function(){return u&&typeof Symbol.toStringTag=="symbol"}},2508:function(i,s,o){var u=o(3403);i.exports=u},3403:function(i,s,o){var u=o(768),c=o(9668),l=o(187);i.exports=function(){var d,f;if(typeof l!="function")return!1;try{f=new l(f=[1,3.14,-3.14,c+1,c+2]),d=u(f)&&f[0]===1&&f[1]===3&&f[2]===c-2&&f[3]===0&&f[4]===1}catch{d=!1}return d}},187:function(i){var s=typeof Uint16Array=="function"?Uint16Array:null;i.exports=s},9773:function(i,s,o){var u=o(2822);i.exports=u},2822:function(i,s,o){var u=o(2744),c=o(3899),l=o(746);i.exports=function(){var d,f;if(typeof l!="function")return!1;try{f=new l(f=[1,3.14,-3.14,c+1,c+2]),d=u(f)&&f[0]===1&&f[1]===3&&f[2]===c-2&&f[3]===0&&f[4]===1}catch{d=!1}return d}},746:function(i){var s=typeof Uint32Array=="function"?Uint32Array:null;i.exports=s},8114:function(i,s,o){var u=o(8066);i.exports=u},8066:function(i,s,o){var u=o(8279),c=o(3443),l=o(2731);i.exports=function(){var d,f;if(typeof l!="function")return!1;try{f=new l(f=[1,3.14,-3.14,c+1,c+2]),d=u(f)&&f[0]===1&&f[1]===3&&f[2]===c-2&&f[3]===0&&f[4]===1}catch{d=!1}return d}},2731:function(i){var s=typeof Uint8Array=="function"?Uint8Array:null;i.exports=s},1448:function(i,s,o){var u=o(1453);i.exports=u},1453:function(i,s,o){var u=o(6208),c=typeof Float64Array=="function";i.exports=function(l){return c&&l instanceof Float64Array||u(l)==="[object Float64Array]"}},9331:function(i,s,o){var u=o(7980),c={uint16:o(6322),uint8:u};i.exports=c},5902:function(i,s,o){var u=o(4106);i.exports=u},4106:function(i,s,o){var u,c,l=o(9331);(c=new l.uint16(1))[0]=4660,u=new l.uint8(c.buffer)[0]===52,i.exports=u},768:function(i,s,o){var u=o(3823);i.exports=u},3823:function(i,s,o){var u=o(6208),c=typeof Uint16Array=="function";i.exports=function(l){return c&&l instanceof Uint16Array||u(l)==="[object Uint16Array]"}},2744:function(i,s,o){var u=o(2326);i.exports=u},2326:function(i,s,o){var u=o(6208),c=typeof Uint32Array=="function";i.exports=function(l){return c&&l instanceof Uint32Array||u(l)==="[object Uint32Array]"}},8279:function(i,s,o){var u=o(208);i.exports=u},208:function(i,s,o){var u=o(6208),c=typeof Uint8Array=="function";i.exports=function(l){return c&&l instanceof Uint8Array||u(l)==="[object Uint8Array]"}},6315:function(i){i.exports=1023},1686:function(i){i.exports=2147483647},3105:function(i){i.exports=2146435072},3449:function(i){i.exports=2147483648},6988:function(i){i.exports=-1023},9777:function(i){i.exports=1023},3690:function(i){i.exports=-1074},2918:function(i,s,o){var u=o(4772).NEGATIVE_INFINITY;i.exports=u},4165:function(i){var s=Number.POSITIVE_INFINITY;i.exports=s},6488:function(i){i.exports=22250738585072014e-324},9668:function(i){i.exports=65535},3899:function(i){i.exports=4294967295},3443:function(i){i.exports=255},7011:function(i,s,o){var u=o(812);i.exports=u},812:function(i,s,o){var u=o(4165),c=o(2918);i.exports=function(l){return l===u||l===c}},1883:function(i,s,o){var u=o(1797);i.exports=u},1797:function(i){i.exports=function(s){return s!=s}},513:function(i,s,o){var u=o(5760);i.exports=u},5760:function(i){i.exports=function(s){return Math.abs(s)}},5848:function(i,s,o){var u=o(677);i.exports=u},677:function(i,s,o){var u=o(3449),c=o(1686),l=o(7838),d=o(1921),f=o(2490),h=[0,0];i.exports=function(v,m){var p,y;return l.assign(v,h,1,0),p=h[0],p&=c,y=d(m),f(p|=y&=u,h[1])}},5500:function(i,s,o){var u=o(8397);i.exports=u},8397:function(i,s,o){var u=o(4165),c=o(2918),l=o(6315),d=o(9777),f=o(6988),h=o(3690),v=o(1883),m=o(7011),p=o(5848),y=o(4948),g=o(8478),w=o(7838),k=o(2490),A=[0,0],I=[0,0];i.exports=function(E,T){var C,P;return E===0||v(E)||m(E)?E:(y(A,E),T+=A[1],(T+=g(E=A[0]))<h?p(0,E):T>d?E<0?c:u:(T<=f?(T+=52,P=2220446049250313e-31):P=1,w(I,E),C=I[0],C&=2148532223,P*k(C|=T+l<<20,I[1])))}},4772:function(i,s,o){var u=o(7548);i.exports=u},7548:function(i){i.exports=Number},8478:function(i,s,o){var u=o(4500);i.exports=u},4500:function(i,s,o){var u=o(1921),c=o(3105),l=o(6315);i.exports=function(d){var f=u(d);return(f=(f&c)>>>20)-l|0}},2490:function(i,s,o){var u=o(9639);i.exports=u},4445:function(i,s,o){var u,c,l;o(5902)===!0?(c=1,l=0):(c=0,l=1),u={HIGH:c,LOW:l},i.exports=u},9639:function(i,s,o){var u=o(4773),c=o(7382),l=o(4445),d=new c(1),f=new u(d.buffer),h=l.HIGH,v=l.LOW;i.exports=function(m,p){return f[h]=m,f[v]=p,d[0]}},5646:function(i,s,o){var u;u=o(5902)===!0?1:0,i.exports=u},1921:function(i,s,o){var u=o(6285);i.exports=u},6285:function(i,s,o){var u=o(4773),c=o(7382),l=o(5646),d=new c(1),f=new u(d.buffer);i.exports=function(h){return d[0]=h,f[l]}},9024:function(i,s,o){var u=o(6488),c=o(7011),l=o(1883),d=o(513);i.exports=function(f,h,v,m){return l(f)||c(f)?(h[m]=f,h[m+v]=0,h):f!==0&&d(f)<u?(h[m]=4503599627370496*f,h[m+v]=-52,h):(h[m]=f,h[m+v]=0,h)}},4948:function(i,s,o){var u=o(7576),c=o(9422);u(c,"assign",o(9024)),i.exports=c},9422:function(i,s,o){var u=o(9024);i.exports=function(c){return u(c,[0,0],1,0)}},5239:function(i,s,o){var u=o(4773),c=o(7382),l=o(5782),d=new c(1),f=new u(d.buffer),h=l.HIGH,v=l.LOW;i.exports=function(m,p,y,g){return d[0]=m,p[g]=f[h],p[g+y]=f[v],p}},7838:function(i,s,o){var u=o(7576),c=o(4010);u(c,"assign",o(5239)),i.exports=c},5782:function(i,s,o){var u,c,l;o(5902)===!0?(c=1,l=0):(c=0,l=1),u={HIGH:c,LOW:l},i.exports=u},4010:function(i,s,o){var u=o(5239);i.exports=function(c){return u(c,[0,0],1,0)}},7576:function(i,s,o){var u=o(7063);i.exports=u},7063:function(i,s,o){var u=o(6691);i.exports=function(c,l,d){u(c,l,{configurable:!1,enumerable:!1,writable:!1,value:d})}},2073:function(i){var s=Object.defineProperty;i.exports=s},1680:function(i){var s=typeof Object.defineProperty=="function"?Object.defineProperty:null;i.exports=s},1471:function(i,s,o){var u=o(1680);i.exports=function(){try{return u({},"x",{}),!0}catch{return!1}}},6691:function(i,s,o){var u,c=o(1471),l=o(2073),d=o(1309);u=c()?l:d,i.exports=u},1309:function(i){var s=Object.prototype,o=s.toString,u=s.__defineGetter__,c=s.__defineSetter__,l=s.__lookupGetter__,d=s.__lookupSetter__;i.exports=function(f,h,v){var m,p,y,g;if(typeof f!="object"||f===null||o.call(f)==="[object Array]")throw new TypeError("invalid argument. First argument must be an object. Value: `"+f+"`.");if(typeof v!="object"||v===null||o.call(v)==="[object Array]")throw new TypeError("invalid argument. Property descriptor must be an object. Value: `"+v+"`.");if((p="value"in v)&&(l.call(f,h)||d.call(f,h)?(m=f.__proto__,f.__proto__=s,delete f[h],f[h]=v.value,f.__proto__=m):f[h]=v.value),y="get"in v,g="set"in v,p&&(y||g))throw new Error("invalid argument. Cannot specify one or more accessors and a value or writable attribute in the property descriptor.");return y&&u&&u.call(f,h,v.get),g&&c&&c.call(f,h,v.set),f}},6208:function(i,s,o){var u,c=o(3123),l=o(7407),d=o(4210);u=c()?d:l,i.exports=u},7407:function(i,s,o){var u=o(173);i.exports=function(c){return u.call(c)}},4210:function(i,s,o){var u=o(9048),c=o(1403),l=o(173);i.exports=function(d){var f,h,v;if(d==null)return l.call(d);h=d[c],f=u(d,c);try{d[c]=void 0}catch{return l.call(d)}return v=l.call(d),f?d[c]=h:delete d[c],v}},173:function(i){var s=Object.prototype.toString;i.exports=s},1403:function(i){var s=typeof Symbol=="function"?Symbol.toStringTag:"";i.exports=s},7843:function(i){i.exports=function(s,o,u,c,l){for(o=o.split?o.split("."):o,c=0;c<o.length;c++)s=s?s[o[c]]:l;return s===l?u:s}},374:function(i,s,o){o.r(s),o.d(s,{default:function(){return l}});for(var u=[],c=0;c<64;)u[c]=0|4294967296*Math.sin(++c%Math.PI);function l(d){var f,h,v,m=[f=1732584193,h=4023233417,~f,~h],p=[],y=unescape(encodeURI(d))+"",g=y.length;for(d=--g/4+2|15,p[--d]=8*g;~g;)p[g>>2]|=y.charCodeAt(g)<<8*g--;for(c=y=0;c<d;c+=16){for(g=m;y<64;g=[v=g[3],f+((v=g[0]+[f&h|~f&v,v&f|~v&h,f^h^v,h^(f|~v)][g=y>>4]+u[y]+~~p[c|15&[y,5*y+1,3*y+5,7*y][g]])<<(g=[7,12,17,22,5,9,14,20,4,11,16,23,6,10,15,21][4*g+y++%4])|v>>>-g),f,h])f=0|g[1],h=g[2];for(y=4;y;)m[--y]+=g[y]}for(d="";y<32;)d+=(m[y>>3]>>4*(1^y++)&15).toString(16);return d}}},n={};function a(i){var s=n[i];if(s!==void 0)return s.exports;var o=n[i]={exports:{}};return t[i].call(o.exports,o,o.exports,a),o.exports}return a.d=function(i,s){for(var o in s)a.o(s,o)&&!a.o(i,o)&&Object.defineProperty(i,o,{enumerable:!0,get:s[o]})},a.o=function(i,s){return Object.prototype.hasOwnProperty.call(i,s)},a.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},a(2870)}()})})(Kn);var yr=Kn.exports,zu=function(r){return function(e){var t=e.payload,n=e.integration,a=e.next,i=new yr.Store(r),s=i.getRulesByDestinationName(n);s.forEach(function(o){for(var u=o.matchers,c=o.transformers,l=0;l<u.length;l++)if(yr.matches(t.obj,u[l])&&(t.obj=yr.transform(t.obj,c[l]),t.obj===null))return a(null)}),a(t)}};const qu=Object.freeze(Object.defineProperty({__proto__:null,tsubMiddleware:zu},Symbol.toStringTag,{value:"Module"}));function $n(r,e){var t,n;return typeof e?.enabled=="boolean"?e.enabled:(n=(t=r?.__default)===null||t===void 0?void 0:t.enabled)!==null&&n!==void 0?n:!0}function Vn(r){return r.toLowerCase().replace(".","").replace(/\s+/g,"-")}function zn(r,e){return e===void 0&&(e=!1),e?btoa(r).replace(/=/g,""):void 0}function Gu(r){return("Integration"in r?r.Integration:r).prototype.name}function Wu(r,e,t){var n,a;try{var i=((a=(n=window?.performance)===null||n===void 0?void 0:n.getEntriesByName(r,"resource"))!==null&&a!==void 0?a:[])[0];i&&e.stats.gauge("legacy_destination_time",Math.round(i.duration),B([t],i.duration<100?["cached"]:[],!0))}catch{}}function Qu(r,e,t){var n;if("Integration"in r){var a={user:function(){return t.user()},addIntegration:function(){}};r(a),n=r.Integration}else n=r;var i=new n(e);return i.analytics=t,i}function Hu(r,e,t,n){return _(this,void 0,void 0,function(){var a,i,s,o,u,c;return S(this,function(l){switch(l.label){case 0:a=Vn(e),i=zn(a,n),s=or(),o="".concat(s,"/integrations/").concat(i??a,"/").concat(t,"/").concat(i??a,".dynamic.js.gz"),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,Ne(o)];case 2:return l.sent(),Wu(o,r,e),[3,4];case 3:throw u=l.sent(),r.stats.gauge("legacy_destination_time",-1,["plugin:".concat(e),"failed"]),u;case 4:return c=window["".concat(a,"Deps")],[4,Promise.all(c.map(function(d){return Ne(s+d+".gz")}))];case 5:return l.sent(),window["".concat(a,"Loader")](),[2,window["".concat(a,"Integration")]]}})})}function Ju(r,e,t){return _(this,void 0,void 0,function(){var n,a,i,s;return S(this,function(o){return n=or(),a=Vn(r),i=zn(r,t),s="".concat(n,"/integrations/").concat(i??a,"/").concat(e,"/").concat(i??a,".dynamic.js.gz"),[2,ko(s)]})})}function Yu(r){var e,t,n,a;return(a=(t=(e=r?.versionSettings)===null||e===void 0?void 0:e.override)!==null&&t!==void 0?t:(n=r?.versionSettings)===null||n===void 0?void 0:n.version)!==null&&a!==void 0?a:"latest"}var Zu=function(r,e){var t,n=e.type,a=e.bundlingStatus,i=e.versionSettings,s=a!=="unbundled"&&(n==="browser"||((t=i?.componentTypes)===null||t===void 0?void 0:t.includes("browser")));return!r.startsWith("Segment")&&r!=="Iterable"&&s},Xu=function(r,e){var t=e.All===!1&&e[r]===void 0;return e[r]===!1||t};function ec(r,e){return _(this,void 0,void 0,function(){var t,n=this;return S(this,function(a){switch(a.label){case 0:return t=[],ce()?[2,e]:[4,sn(function(){return e.length>0&&Er()},function(){return _(n,void 0,void 0,function(){var i,s,o;return S(this,function(u){switch(u.label){case 0:return i=e.pop(),i?[4,ye(i,r)]:[2];case 1:return s=u.sent(),o=s instanceof J,o||t.push(i),[2]}})})})];case 1:return a.sent(),t.map(function(i){return e.pushWithBackoff(i)}),[2,e]}})})}var qn=function(){function r(e,t,n,a,i,s){a===void 0&&(a={});var o=this;this.options={},this.type="destination",this.middleware=[],this.initializePromise=St(),this.flushing=!1,this.name=e,this.version=t,this.settings=b({},a),this.disableAutoISOConversion=i.disableAutoISOConversion||!1,this.integrationSource=s,this.settings.type&&this.settings.type==="browser"&&delete this.settings.type,this.initializePromise.promise.then(function(u){return o._initialized=u},function(){}),this.options=i,this.buffer=i.disableClientPersistence?new qe(4,[]):new Ze(4,"".concat(n,":dest-").concat(e)),this.scheduleFlush()}return r.prototype.isLoaded=function(){return!!this._ready},r.prototype.ready=function(){var e=this;return this.initializePromise.promise.then(function(){var t;return(t=e.onReady)!==null&&t!==void 0?t:Promise.resolve()})},r.prototype.load=function(e,t){var n;return _(this,void 0,void 0,function(){var a,i,s=this;return S(this,function(o){switch(o.label){case 0:return this._ready||this.onReady!==void 0?[2]:(n=this.integrationSource)!==null&&n!==void 0?(i=n,[3,3]):[3,1];case 1:return[4,Hu(e,this.name,this.version,this.options.obfuscate)];case 2:i=o.sent(),o.label=3;case 3:a=i,this.integration=Qu(a,this.settings,t),this.onReady=new Promise(function(u){var c=function(){s._ready=!0,u(!0)};s.integration.once("ready",c)}),this.integration.on("initialize",function(){s.initializePromise.resolve(!0)});try{fe(e,{integrationName:this.name,methodName:"initialize",type:"classic"}),this.integration.initialize()}catch(u){throw fe(e,{integrationName:this.name,methodName:"initialize",type:"classic",didError:!0}),this.initializePromise.resolve(!1),u}return[2]}})})},r.prototype.unload=function(e,t){return Ju(this.name,this.version,this.options.obfuscate)},r.prototype.addMiddleware=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.middleware=(e=this.middleware).concat.apply(e,t)},r.prototype.shouldBuffer=function(e){return e.event.type!=="page"&&(ce()||this._ready!==!0||this._initialized!==!0)},r.prototype.send=function(e,t,n){var a,i;return _(this,void 0,void 0,function(){var s,o,u,c,l,d;return S(this,function(f){switch(f.label){case 0:return this.shouldBuffer(e)?(this.buffer.push(e),this.scheduleFlush(),[2,e]):(s=(i=(a=this.options)===null||a===void 0?void 0:a.plan)===null||i===void 0?void 0:i.track,o=e.event.event,s&&o&&this.name!=="Segment.io"&&(u=s[o],$n(s,u)?e.updateEvent("integrations",b(b({},e.event.integrations),u?.integrations)):(e.updateEvent("integrations",b(b({},e.event.integrations),{All:!1,"Segment.io":!0})),e.cancel(new ue({retry:!1,reason:"Event ".concat(o," disabled for integration ").concat(this.name," in tracking plan"),type:"Dropped by plan"}))),u?.enabled&&u?.integrations[this.name]===!1&&e.cancel(new ue({retry:!1,reason:"Event ".concat(o," disabled for integration ").concat(this.name," in tracking plan"),type:"Dropped by plan"}))),[4,sr(this.name,e.event,this.middleware)]);case 1:if(c=f.sent(),c===null)return[2,e];l=new t(c,{traverse:!this.disableAutoISOConversion}),fe(e,{integrationName:this.name,methodName:n,type:"classic"}),f.label=2;case 2:return f.trys.push([2,5,,6]),this.integration?[4,this.integration.invoke.call(this.integration,n,l)]:[3,4];case 3:f.sent(),f.label=4;case 4:return[3,6];case 5:throw d=f.sent(),fe(e,{integrationName:this.name,methodName:n,type:"classic",didError:!0}),d;case 6:return[2,e]}})})},r.prototype.track=function(e){return _(this,void 0,void 0,function(){return S(this,function(t){return[2,this.send(e,U.Track,"track")]})})},r.prototype.page=function(e){var t;return _(this,void 0,void 0,function(){return S(this,function(n){switch(n.label){case 0:return!((t=this.integration)===null||t===void 0)&&t._assumesPageview&&!this._initialized&&this.integration.initialize(),[4,this.initializePromise.promise];case 1:return n.sent(),[2,this.send(e,U.Page,"page")]}})})},r.prototype.identify=function(e){return _(this,void 0,void 0,function(){return S(this,function(t){return[2,this.send(e,U.Identify,"identify")]})})},r.prototype.alias=function(e){return _(this,void 0,void 0,function(){return S(this,function(t){return[2,this.send(e,U.Alias,"alias")]})})},r.prototype.group=function(e){return _(this,void 0,void 0,function(){return S(this,function(t){return[2,this.send(e,U.Group,"group")]})})},r.prototype.scheduleFlush=function(){var e=this;this.flushing||setTimeout(function(){return _(e,void 0,void 0,function(){var t;return S(this,function(n){switch(n.label){case 0:return ce()||this._ready!==!0||this._initialized!==!0?(this.scheduleFlush(),[2]):(this.flushing=!0,t=this,[4,ec(this,this.buffer)]);case 1:return t.buffer=n.sent(),this.flushing=!1,this.buffer.todo>0&&this.scheduleFlush(),[2]}})})},Math.random()*5e3)},r}();function tc(r,e,t,n,a,i){var s,o;if(t===void 0&&(t={}),n===void 0&&(n={}),Pr())return[];e.plan&&(n=n??{},n.plan=e.plan);var u=(o=(s=e.middlewareSettings)===null||s===void 0?void 0:s.routingRules)!==null&&o!==void 0?o:[],c=e.integrations,l=n.integrations,d=dn(e,n??{}),f=i?.reduce(function(v,m){var p;return b(b({},v),(p={},p[Gu(m)]=m,p))},{}),h=new Set(B(B([],Object.keys(c).filter(function(v){return Zu(v,c[v])}),!0),Object.keys(f||{}).filter(function(v){return V(c[v])||V(l?.[v])}),!0));return Array.from(h).filter(function(v){return!Xu(v,t)}).map(function(v){var m=c[v],p=Yu(m),y=new qn(v,p,r,d[v],n,f?.[v]),g=u.filter(function(w){return w.destinationName===v});return g.length>0&&a&&y.addMiddleware(a),y})}const rc=Object.freeze(Object.defineProperty({__proto__:null,LegacyDestination:qn,ajsDestinations:tc},Symbol.toStringTag,{value:"Module"}));function nc(r){return _(this,void 0,void 0,function(){var e;return S(this,function(t){switch(t.label){case 0:return[4,Promise.resolve().then(()=>dc)];case 1:return e=t.sent(),r._plugins=e,[2]}})})}const ic=Object.freeze(Object.defineProperty({__proto__:null,loadLegacyVideoPlugins:nc},Symbol.toStringTag,{value:"Module"}));function ac(r,e){var t,n;if(!r||!Object.keys(r))return{};var a=r.integrations?Object.keys(r.integrations).filter(function(s){return r.integrations[s]===!1}):[],i=[];return((t=e.remotePlugins)!==null&&t!==void 0?t:[]).forEach(function(s){a.forEach(function(o){s.creationName==o&&i.push(s.name)})}),((n=e.remotePlugins)!==null&&n!==void 0?n:[]).reduce(function(s,o){return o.settings.subscriptions&&i.includes(o.name)&&o.settings.subscriptions.forEach(function(u){return s["".concat(o.name," ").concat(u.partnerAction)]=!1}),s},{})}function oc(r,e){function t(n){var a=r,i=n.event.event;if(a&&i){var s=a[i];if($n(a,s)){var o=ac(s,e);n.updateEvent("integrations",b(b(b({},n.event.integrations),s?.integrations),o))}else return n.updateEvent("integrations",b(b({},n.event.integrations),{All:!1,"Segment.io":!0})),n}return n}return{name:"Schema Filter",version:"0.1.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},type:"before",page:t,alias:t,track:t,identify:t,group:t}}const sc=Object.freeze(Object.defineProperty({__proto__:null,schemaFilter:oc},Symbol.toStringTag,{value:"Module"}));function uc(r,e,t){var n;return _(this,void 0,void 0,function(){var a,i,s,o,u,c=this;return S(this,function(l){switch(l.label){case 0:return Pr()?[2,[]]:(a=or(),i=(n=e.enabledMiddleware)!==null&&n!==void 0?n:{},s=Object.entries(i).filter(function(d){d[0];var f=d[1];return f}).map(function(d){var f=d[0];return f}),o=s.map(function(d){return _(c,void 0,void 0,function(){var f,h,v,m;return S(this,function(p){switch(p.label){case 0:f=d.replace("@segment/",""),h=f,t&&(h=btoa(f).replace(/=/g,"")),v="".concat(a,"/middleware/").concat(h,"/latest/").concat(h,".js.gz"),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,Ne(v)];case 2:return p.sent(),[2,window["".concat(f,"Middleware")]];case 3:return m=p.sent(),r.log("error",m),r.stats.increment("failed_remote_middleware"),[3,4];case 4:return[2]}})})}),[4,Promise.all(o)]);case 1:return u=l.sent(),u=u.filter(Boolean),[2,u]}})})}const cc=Object.freeze(Object.defineProperty({__proto__:null,remoteMiddlewares:uc},Symbol.toStringTag,{value:"Module"}));var Gn={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(window,function(){return function(t){var n={};function a(i){if(n[i])return n[i].exports;var s=n[i]={i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=t,a.c=n,a.d=function(i,s,o){a.o(i,s)||Object.defineProperty(i,s,{enumerable:!0,get:o})},a.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},a.t=function(i,s){if(1&s&&(i=a(i)),8&s||4&s&&typeof i=="object"&&i&&i.__esModule)return i;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:i}),2&s&&typeof i!="string")for(var u in i)a.d(o,u,function(c){return i[c]}.bind(null,u));return o},a.n=function(i){var s=i&&i.__esModule?function(){return i.default}:function(){return i};return a.d(s,"a",s),s},a.o=function(i,s){return Object.prototype.hasOwnProperty.call(i,s)},a.p="",a(a.s=2)}([function(t,n,a){a.r(n);var i=typeof fetch=="function"?fetch.bind():function(s,o){return o=o||{},new Promise(function(u,c){var l=new XMLHttpRequest;for(var d in l.open(o.method||"get",s,!0),o.headers)l.setRequestHeader(d,o.headers[d]);function f(){var h,v=[],m=[],p={};return l.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(y,g,w){v.push(g=g.toLowerCase()),m.push([g,w]),h=p[g],p[g]=h?h+","+w:w}),{ok:(l.status/100|0)==2,status:l.status,statusText:l.statusText,url:l.responseURL,clone:f,text:function(){return Promise.resolve(l.responseText)},json:function(){return Promise.resolve(l.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([l.response]))},headers:{keys:function(){return v},entries:function(){return m},get:function(y){return p[y.toLowerCase()]},has:function(y){return y.toLowerCase()in p}}}}l.withCredentials=o.credentials=="include",l.onload=function(){u(f())},l.onerror=c,l.send(o.body)})};n.default=i},function(t,n,a){Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function o(u,c){for(var l=0;l<c.length;l++){var d=c[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(u,d.key,d)}}return function(u,c,l){return c&&o(u.prototype,c),l&&o(u,l),u}}(),s=function(){function o(u,c){(function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")})(this,o),this.pluginName=u}return i(o,[{key:"track",value:function(u,c){window.analytics.track(u,c,{integration:{name:this.pluginName}})}}]),o}();n.default=s},function(t,n,a){Object.defineProperty(n,"__esModule",{value:!0}),n.YouTubeAnalytics=n.VimeoAnalytics=void 0;var i=o(a(3)),s=o(a(4));function o(u){return u&&u.__esModule?u:{default:u}}n.VimeoAnalytics=i.default,n.YouTubeAnalytics=s.default},function(t,n,a){Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function c(l,d){for(var f=0;f<d.length;f++){var h=d[f];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(l,h.key,h)}}return function(l,d,f){return d&&c(l.prototype,d),f&&c(l,f),l}}(),s=o(a(0));function o(c){return c&&c.__esModule?c:{default:c}}var u=function(c){function l(d,f){(function(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,l);var h=function(v,m){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!m||typeof m!="object"&&typeof m!="function"?v:m}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,"VimeoAnalytics"));return h.authToken=f,h.player=d,h.metadata={content:{},playback:{videoPlayer:"Vimeo"}},h.mostRecentHeartbeat=0,h.isPaused=!1,h}return function(d,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);d.prototype=Object.create(f&&f.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(d,f):d.__proto__=f)}(l,c),i(l,[{key:"initialize",value:function(){var d=this,f={loaded:this.retrieveMetadata,play:this.trackPlay,pause:this.trackPause,ended:this.trackEnded,timeupdate:this.trackHeartbeat};for(var h in f)this.registerHandler(h,f[h]);this.player.getVideoId().then(function(v){d.retrieveMetadata({id:v})}).catch(console.error)}},{key:"registerHandler",value:function(d,f){var h=this;this.player.on(d,function(v){h.updateMetadata(v),f.call(h,v)})}},{key:"trackPlay",value:function(){this.isPaused?(this.track("Video Playback Resumed",this.metadata.playback),this.isPaused=!1):(this.track("Video Playback Started",this.metadata.playback),this.track("Video Content Started",this.metadata.content))}},{key:"trackEnded",value:function(){this.track("Video Playback Completed",this.metadata.playback),this.track("Video Content Completed",this.metadata.content)}},{key:"trackHeartbeat",value:function(){var d=this.mostRecentHeartbeat,f=this.metadata.playback.position;f!==d&&f-d>=10&&(this.track("Video Content Playing",this.metadata.content),this.mostRecentHeartbeat=Math.floor(f))}},{key:"trackPause",value:function(){this.isPaused=!0,this.track("Video Playback Paused",this.metadata.playback)}},{key:"retrieveMetadata",value:function(d){var f=this;return new Promise(function(h,v){var m=d.id;(0,s.default)("https://api.vimeo.com/videos/"+m,{headers:{Authorization:"Bearer "+f.authToken}}).then(function(p){return p.ok?p.json():v(p)}).then(function(p){f.metadata.content.title=p.name,f.metadata.content.description=p.description,f.metadata.content.publisher=p.user.name,f.metadata.playback.position=0,f.metadata.playback.totalLength=p.duration}).catch(function(p){return console.error("Request to Vimeo API Failed with: ",p),v(p)})})}},{key:"updateMetadata",value:function(d){var f=this;return new Promise(function(h,v){f.player.getVolume().then(function(m){m&&(f.metadata.playback.sound=100*m),f.metadata.playback.position=d.seconds,h()}).catch(v)})}}]),l}(o(a(1)).default);n.default=u},function(t,n,a){Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function d(f,h){for(var v=0;v<h.length;v++){var m=h[v];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(f,m.key,m)}}return function(f,h,v){return h&&d(f.prototype,h),v&&d(f,v),f}}(),s=u(a(0)),o=u(a(1));function u(d){return d&&d.__esModule?d:{default:d}}var c=function(d){function f(h,v){(function(p,y){if(!(p instanceof y))throw new TypeError("Cannot call a class as a function")})(this,f);var m=function(p,y){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!y||typeof y!="object"&&typeof y!="function"?p:y}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,"YoutubeAnalytics"));return m.player=h,m.apiKey=v,m.playerLoaded=!1,m.playbackStarted=!1,m.contentStarted=!1,m.isPaused=!1,m.isBuffering=!1,m.isSeeking=!1,m.lastRecordedTime={timeReported:Date.now(),timeElapsed:0},m.metadata=[{playback:{video_player:"youtube"},content:{}}],m.playlistIndex=0,m}return function(h,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);h.prototype=Object.create(v&&v.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(h,v):h.__proto__=v)}(f,d),i(f,[{key:"initialize",value:function(){window.segmentYoutubeOnStateChange=this.onPlayerStateChange.bind(this),window.segmentYoutubeOnReady=this.onPlayerReady.bind(this),this.player.addEventListener("onReady","segmentYoutubeOnReady"),this.player.addEventListener("onStateChange","segmentYoutubeOnStateChange")}},{key:"onPlayerReady",value:function(h){this.retrieveMetadata()}},{key:"onPlayerStateChange",value:function(h){var v=this.player.getCurrentTime();switch(this.metadata[this.playlistIndex]&&(this.metadata[this.playlistIndex].playback.position=this.metadata[this.playlistIndex].content.position=v,this.metadata[this.playlistIndex].playback.quality=this.player.getPlaybackQuality(),this.metadata[this.playlistIndex].playback.sound=this.player.isMuted()?0:this.player.getVolume()),h.data){case-1:if(this.playerLoaded)break;this.retrieveMetadata(),this.playerLoaded=!0;break;case YT.PlayerState.BUFFERING:this.handleBuffer();break;case YT.PlayerState.PLAYING:this.handlePlay();break;case YT.PlayerState.PAUSED:this.handlePause();break;case YT.PlayerState.ENDED:this.handleEnd()}this.lastRecordedTime={timeReported:Date.now(),timeElapsed:1e3*this.player.getCurrentTime()}}},{key:"retrieveMetadata",value:function(){var h=this;return new Promise(function(v,m){var p=h.player.getVideoData(),y=h.player.getPlaylist()||[p.video_id],g=y.join();(0,s.default)("https://www.googleapis.com/youtube/v3/videos?id="+g+"&part=snippet,contentDetails&key="+h.apiKey).then(function(w){if(!w.ok){var k=new Error("Segment request to Youtube API failed (likely due to a bad API Key. Events will still be sent but will not contain video metadata)");throw k.response=w,k}return w.json()}).then(function(w){h.metadata=[];for(var k=0,A=0;A<y.length;A++){var I=w.items[A];h.metadata.push({content:{title:I.snippet.title,description:I.snippet.description,keywords:I.snippet.tags,channel:I.snippet.channelTitle,airdate:I.snippet.publishedAt}}),k+=l(I.contentDetails.duration)}for(A=0;A<y.length;A++)h.metadata[A].playback={total_length:k,video_player:"youtube"};v()}).catch(function(w){h.metadata=y.map(function(k){return{playback:{video_player:"youtube"},content:{}}}),m(w)})})}},{key:"handleBuffer",value:function(){var h=this.determineSeek();this.playbackStarted||(this.playbackStarted=!0,this.track("Video Playback Started",this.metadata[this.playlistIndex].playback)),h&&!this.isSeeking&&(this.isSeeking=!0,this.track("Video Playback Seek Started",this.metadata[this.playlistIndex].playback)),this.isSeeking&&(this.track("Video Playback Seek Completed",this.metadata[this.playlistIndex].playback),this.isSeeking=!1);var v=this.player.getPlaylist();v&&this.player.getCurrentTime()===0&&this.player.getPlaylistIndex()!==this.playlistIndex&&(this.contentStarted=!1,this.playlistIndex===v.length-1&&this.player.getPlaylistIndex()===0&&(this.track("Video Playback Completed",this.metadata[this.player.getPlaylistIndex()].playback),this.track("Video Playback Started",this.metadata[this.player.getPlaylistIndex()].playback))),this.track("Video Playback Buffer Started",this.metadata[this.playlistIndex].playback),this.isBuffering=!0}},{key:"handlePlay",value:function(){this.contentStarted||(this.playlistIndex=this.player.getPlaylistIndex(),this.playlistIndex===-1&&(this.playlistIndex=0),this.track("Video Content Started",this.metadata[this.playlistIndex].content),this.contentStarted=!0),this.isBuffering&&(this.track("Video Playback Buffer Completed",this.metadata[this.playlistIndex].playback),this.isBuffering=!1),this.isPaused&&(this.track("Video Playback Resumed",this.metadata[this.playlistIndex].playback),this.isPaused=!1)}},{key:"handlePause",value:function(){var h=this.determineSeek();this.isBuffering&&(this.track("Video Playback Buffer Completed",this.metadata[this.playlistIndex].playback),this.isBuffering=!1),this.isPaused||(h?(this.track("Video Playback Seek Started",this.metadata[this.playlistIndex].playback),this.isSeeking=!0):(this.track("Video Playback Paused",this.metadata[this.playlistIndex].playback),this.isPaused=!0))}},{key:"handleEnd",value:function(){this.track("Video Content Completed",this.metadata[this.playlistIndex].content),this.contentStarted=!1;var h=this.player.getPlaylistIndex(),v=this.player.getPlaylist();(v&&h===v.length-1||h===-1)&&(this.track("Video Playback Completed",this.metadata[this.playlistIndex].playback),this.playbackStarted=!1)}},{key:"determineSeek",value:function(){var h=this.isPaused||this.isBuffering?0:Date.now()-this.lastRecordedTime.timeReported,v=1e3*this.player.getCurrentTime()-this.lastRecordedTime.timeElapsed;return Math.abs(h-v)>2e3}}]),f}(o.default);function l(d){var f=d.match(/PT(\d+H)?(\d+M)?(\d+S)?/);return f=f.slice(1).map(function(h){if(h!=null)return h.replace(/\D/,"")}),3600*(parseInt(f[0])||0)+60*(parseInt(f[1])||0)+(parseInt(f[2])||0)}n.default=c}])})})(Gn);var Wn=Gn.exports;const lc=Lt(Wn),dc=Qn({__proto__:null,default:lc},[Wn]);return vt.scriptloader=Un,Object.defineProperty(vt,Symbol.toStringTag,{value:"Module"}),vt}({});

</script>

</body>
</html>
